begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	$NetBSD$	*/
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|__IP_HTABLE_H__
end_ifndef

begin_define
define|#
directive|define
name|__IP_HTABLE_H__
end_define

begin_include
include|#
directive|include
file|"netinet/ip_lookup.h"
end_include

begin_typedef
typedef|typedef
struct|struct
name|iphtent_s
block|{
name|struct
name|iphtent_s
modifier|*
name|ipe_next
decl_stmt|,
modifier|*
modifier|*
name|ipe_pnext
decl_stmt|;
name|void
modifier|*
name|ipe_ptr
decl_stmt|;
name|i6addr_t
name|ipe_addr
decl_stmt|;
name|i6addr_t
name|ipe_mask
decl_stmt|;
name|int
name|ipe_ref
decl_stmt|;
union|union
block|{
name|char
name|ipeu_char
index|[
literal|16
index|]
decl_stmt|;
name|u_long
name|ipeu_long
decl_stmt|;
name|u_int
name|ipeu_int
decl_stmt|;
block|}
name|ipe_un
union|;
block|}
name|iphtent_t
typedef|;
end_typedef

begin_define
define|#
directive|define
name|ipe_value
value|ipe_un.ipeu_int
end_define

begin_define
define|#
directive|define
name|ipe_group
value|ipe_un.ipeu_char
end_define

begin_define
define|#
directive|define
name|IPE_HASH_FN
parameter_list|(
name|a
parameter_list|,
name|m
parameter_list|,
name|s
parameter_list|)
value|(((a) * (m)) % (s))
end_define

begin_typedef
typedef|typedef
struct|struct
name|iphtable_s
block|{
name|ipfrwlock_t
name|iph_rwlock
decl_stmt|;
name|struct
name|iphtable_s
modifier|*
name|iph_next
decl_stmt|,
modifier|*
modifier|*
name|iph_pnext
decl_stmt|;
name|struct
name|iphtent_s
modifier|*
modifier|*
name|iph_table
decl_stmt|;
name|size_t
name|iph_size
decl_stmt|;
comment|/* size of hash table */
name|u_long
name|iph_seed
decl_stmt|;
comment|/* hashing seed */
name|u_32_t
name|iph_flags
decl_stmt|;
name|u_int
name|iph_unit
decl_stmt|;
comment|/* IPL_LOG* */
name|u_int
name|iph_ref
decl_stmt|;
name|u_int
name|iph_type
decl_stmt|;
comment|/* lookup or group map  - IPHASH_* */
name|u_int
name|iph_masks
decl_stmt|;
comment|/* IPv4 netmasks in use */
name|char
name|iph_name
index|[
name|FR_GROUPLEN
index|]
decl_stmt|;
comment|/* hash table number */
block|}
name|iphtable_t
typedef|;
end_typedef

begin_comment
comment|/* iph_type */
end_comment

begin_define
define|#
directive|define
name|IPHASH_LOOKUP
value|0
end_define

begin_define
define|#
directive|define
name|IPHASH_GROUPMAP
value|1
end_define

begin_define
define|#
directive|define
name|IPHASH_ANON
value|0x80000000
end_define

begin_typedef
typedef|typedef
struct|struct
name|iphtstat_s
block|{
name|iphtable_t
modifier|*
name|iphs_tables
decl_stmt|;
name|u_long
name|iphs_numtables
decl_stmt|;
name|u_long
name|iphs_numnodes
decl_stmt|;
name|u_long
name|iphs_nomem
decl_stmt|;
name|u_long
name|iphs_pad
index|[
literal|16
index|]
decl_stmt|;
block|}
name|iphtstat_t
typedef|;
end_typedef

begin_decl_stmt
specifier|extern
name|iphtable_t
modifier|*
name|ipf_htables
index|[
name|IPL_LOGSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|void
name|fr_htable_unload
name|__P
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|fr_newhtable
name|__P
argument_list|(
operator|(
name|iplookupop_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|iphtable_t
modifier|*
name|fr_findhtable
name|__P
argument_list|(
operator|(
name|int
operator|,
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|fr_removehtable
name|__P
argument_list|(
operator|(
name|iplookupop_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|size_t
name|fr_flushhtable
name|__P
argument_list|(
operator|(
name|iplookupflush_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|fr_addhtent
name|__P
argument_list|(
operator|(
name|iphtable_t
operator|*
operator|,
name|iphtent_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|fr_delhtent
name|__P
argument_list|(
operator|(
name|iphtable_t
operator|*
operator|,
name|iphtent_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|void
name|fr_derefhtable
name|__P
argument_list|(
operator|(
name|iphtable_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|void
name|fr_delhtable
name|__P
argument_list|(
operator|(
name|iphtable_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|void
modifier|*
name|fr_iphmfindgroup
name|__P
argument_list|(
operator|(
name|void
operator|*
operator|,
name|void
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|fr_iphmfindip
name|__P
argument_list|(
operator|(
name|void
operator|*
operator|,
name|int
operator|,
name|void
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|fr_gethtablestat
name|__P
argument_list|(
operator|(
name|iplookupop_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* __IP_HTABLE_H__ */
end_comment

end_unit

