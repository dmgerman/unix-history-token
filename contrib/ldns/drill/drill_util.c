begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * util.c  * some handy function needed in drill and not implemented  * in ldns  * (c) 2005 NLnet Labs  *  * See the file LICENSE for the license  *  */
end_comment

begin_include
include|#
directive|include
file|"drill.h"
end_include

begin_include
include|#
directive|include
file|<ldns/ldns.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_function
specifier|static
name|int
name|read_line
parameter_list|(
name|FILE
modifier|*
name|input
parameter_list|,
name|char
modifier|*
name|line
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|int
name|c
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|int
operator|)
name|len
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
name|c
operator|=
name|getc
argument_list|(
name|input
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
block|{
return|return
operator|-
literal|1
return|;
block|}
elseif|else
if|if
condition|(
name|c
operator|!=
literal|'\n'
condition|)
block|{
name|line
index|[
name|i
index|]
operator|=
name|c
expr_stmt|;
block|}
else|else
block|{
break|break;
block|}
block|}
name|line
index|[
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
name|i
return|;
block|}
end_function

begin_comment
comment|/* key_list must be initialized with ldns_rr_list_new() */
end_comment

begin_function
name|ldns_status
name|read_key_file
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
parameter_list|,
name|ldns_rr_list
modifier|*
name|key_list
parameter_list|,
name|bool
name|silently
parameter_list|)
block|{
name|int
name|line_len
init|=
literal|0
decl_stmt|;
name|int
name|line_nr
init|=
literal|0
decl_stmt|;
name|int
name|key_count
init|=
literal|0
decl_stmt|;
name|char
name|line
index|[
name|LDNS_MAX_LINELEN
index|]
decl_stmt|;
name|ldns_status
name|status
decl_stmt|;
name|FILE
modifier|*
name|input_file
decl_stmt|;
name|ldns_rr
modifier|*
name|rr
decl_stmt|;
name|input_file
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|input_file
condition|)
block|{
if|if
condition|(
operator|!
name|silently
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Error opening %s: %s\n"
argument_list|,
name|filename
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|LDNS_STATUS_ERR
return|;
block|}
while|while
condition|(
name|line_len
operator|>=
literal|0
condition|)
block|{
name|line_len
operator|=
operator|(
name|int
operator|)
name|read_line
argument_list|(
name|input_file
argument_list|,
name|line
argument_list|,
sizeof|sizeof
argument_list|(
name|line
argument_list|)
argument_list|)
expr_stmt|;
name|line_nr
operator|++
expr_stmt|;
if|if
condition|(
name|line_len
operator|>
literal|0
operator|&&
name|line
index|[
literal|0
index|]
operator|!=
literal|';'
condition|)
block|{
name|status
operator|=
name|ldns_rr_new_frm_str
argument_list|(
operator|&
name|rr
argument_list|,
name|line
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
if|if
condition|(
operator|!
name|silently
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Error parsing DNSKEY RR "
literal|"in line %d: %s\n"
argument_list|,
name|line_nr
argument_list|,
name|ldns_get_errorstr_by_id
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|ldns_rr_get_type
argument_list|(
name|rr
argument_list|)
operator|==
name|LDNS_RR_TYPE_DNSKEY
operator|||
name|ldns_rr_get_type
argument_list|(
name|rr
argument_list|)
operator|==
name|LDNS_RR_TYPE_DS
condition|)
block|{
name|ldns_rr_list_push_rr
argument_list|(
name|key_list
argument_list|,
name|rr
argument_list|)
expr_stmt|;
name|key_count
operator|++
expr_stmt|;
block|}
else|else
block|{
name|ldns_rr_free
argument_list|(
name|rr
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|fclose
argument_list|(
name|input_file
argument_list|)
expr_stmt|;
if|if
condition|(
name|key_count
operator|>
literal|0
condition|)
block|{
return|return
name|LDNS_STATUS_OK
return|;
block|}
else|else
block|{
comment|/*fprintf(stderr, "No keys read\n");*/
return|return
name|LDNS_STATUS_ERR
return|;
block|}
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rdf_new_addr_frm_str
parameter_list|(
name|char
modifier|*
name|str
parameter_list|)
block|{
name|ldns_rdf
modifier|*
name|a
decl_stmt|;
name|a
operator|=
name|ldns_rdf_new_frm_str
argument_list|(
name|LDNS_RDF_TYPE_A
argument_list|,
name|str
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|a
condition|)
block|{
comment|/* maybe ip6 */
name|a
operator|=
name|ldns_rdf_new_frm_str
argument_list|(
name|LDNS_RDF_TYPE_AAAA
argument_list|,
name|str
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|a
condition|)
block|{
return|return
name|NULL
return|;
block|}
block|}
return|return
name|a
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|void
name|local_print_ds
parameter_list|(
name|FILE
modifier|*
name|out
parameter_list|,
specifier|const
name|char
modifier|*
name|pre
parameter_list|,
name|ldns_rr
modifier|*
name|ds
parameter_list|)
block|{
if|if
condition|(
name|out
operator|&&
name|ds
condition|)
block|{
name|fprintf
argument_list|(
name|out
argument_list|,
literal|"%s"
argument_list|,
name|pre
argument_list|)
expr_stmt|;
name|ldns_rr_print
argument_list|(
name|out
argument_list|,
name|ds
argument_list|)
expr_stmt|;
name|ldns_rr_free
argument_list|(
name|ds
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * For all keys in a packet print the DS   */
end_comment

begin_function
name|void
name|print_ds_of_keys
parameter_list|(
name|ldns_pkt
modifier|*
name|p
parameter_list|)
block|{
name|ldns_rr_list
modifier|*
name|keys
decl_stmt|;
name|uint16_t
name|i
decl_stmt|;
name|ldns_rr
modifier|*
name|ds
decl_stmt|;
comment|/* TODO fix the section stuff, here or in ldns */
name|keys
operator|=
name|ldns_pkt_rr_list_by_type
argument_list|(
name|p
argument_list|,
name|LDNS_RR_TYPE_DNSKEY
argument_list|,
name|LDNS_SECTION_ANSWER
argument_list|)
expr_stmt|;
comment|/* this also returns the question section rr, which does not 	 * have any data.... and this inturn crashes everything */
if|if
condition|(
name|keys
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_list_rr_count
argument_list|(
name|keys
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|";\n; equivalent DS records for key %u:\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|ldns_calc_keytag
argument_list|(
name|ldns_rr_list_rr
argument_list|(
name|keys
argument_list|,
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|ds
operator|=
name|ldns_key_rr2ds
argument_list|(
name|ldns_rr_list_rr
argument_list|(
name|keys
argument_list|,
name|i
argument_list|)
argument_list|,
name|LDNS_SHA1
argument_list|)
expr_stmt|;
name|local_print_ds
argument_list|(
name|stdout
argument_list|,
literal|"; sha1: "
argument_list|,
name|ds
argument_list|)
expr_stmt|;
name|ds
operator|=
name|ldns_key_rr2ds
argument_list|(
name|ldns_rr_list_rr
argument_list|(
name|keys
argument_list|,
name|i
argument_list|)
argument_list|,
name|LDNS_SHA256
argument_list|)
expr_stmt|;
name|local_print_ds
argument_list|(
name|stdout
argument_list|,
literal|"; sha256: "
argument_list|,
name|ds
argument_list|)
expr_stmt|;
block|}
name|ldns_rr_list_deep_free
argument_list|(
name|keys
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_class_type
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
name|ldns_lookup_table
modifier|*
name|lt
decl_stmt|;
name|lt
operator|=
name|ldns_lookup_by_id
argument_list|(
name|ldns_rr_classes
argument_list|,
name|ldns_rr_get_class
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|lt
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" %s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" CLASS%d"
argument_list|,
name|ldns_rr_get_class
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* okay not THE way - but the quickest */
switch|switch
condition|(
name|ldns_rr_get_type
argument_list|(
name|r
argument_list|)
condition|)
block|{
case|case
name|LDNS_RR_TYPE_RRSIG
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" RRSIG "
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RR_TYPE_DNSKEY
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" DNSKEY "
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RR_TYPE_DS
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" DS "
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
name|void
name|print_ds_abbr
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|ldns_rr
modifier|*
name|ds
parameter_list|)
block|{
if|if
condition|(
operator|!
name|ds
operator|||
operator|(
name|ldns_rr_get_type
argument_list|(
name|ds
argument_list|)
operator|!=
name|LDNS_RR_TYPE_DS
operator|)
condition|)
block|{
return|return;
block|}
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_owner
argument_list|(
name|ds
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" %d"
argument_list|,
operator|(
name|int
operator|)
name|ldns_rr_ttl
argument_list|(
name|ds
argument_list|)
argument_list|)
expr_stmt|;
name|print_class_type
argument_list|(
name|fp
argument_list|,
name|ds
argument_list|)
expr_stmt|;
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|ds
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|ds
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|ds
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|ds
argument_list|,
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* print some of the elements of a signature */
end_comment

begin_function
name|void
name|print_rrsig_abbr
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|ldns_rr
modifier|*
name|sig
parameter_list|)
block|{
if|if
condition|(
operator|!
name|sig
operator|||
operator|(
name|ldns_rr_get_type
argument_list|(
name|sig
argument_list|)
operator|!=
name|LDNS_RR_TYPE_RRSIG
operator|)
condition|)
block|{
return|return;
block|}
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_owner
argument_list|(
name|sig
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" %d"
argument_list|,
operator|(
name|int
operator|)
name|ldns_rr_ttl
argument_list|(
name|sig
argument_list|)
argument_list|)
expr_stmt|;
name|print_class_type
argument_list|(
name|fp
argument_list|,
name|sig
argument_list|)
expr_stmt|;
comment|/* print a number of rdf's */
comment|/* typecovered */
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|sig
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
comment|/* algo */
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|sig
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
comment|/* labels */
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|sig
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" (\n\t\t\t"
argument_list|)
expr_stmt|;
comment|/* expir */
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|sig
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
comment|/* incep */
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|sig
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
comment|/* key-id */
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|sig
argument_list|,
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
comment|/* key owner */
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|sig
argument_list|,
literal|7
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|print_dnskey_abbr
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|ldns_rr
modifier|*
name|key
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
operator|||
operator|(
name|ldns_rr_get_type
argument_list|(
name|key
argument_list|)
operator|!=
name|LDNS_RR_TYPE_DNSKEY
operator|)
condition|)
block|{
return|return;
block|}
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_owner
argument_list|(
name|key
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" %d"
argument_list|,
operator|(
name|int
operator|)
name|ldns_rr_ttl
argument_list|(
name|key
argument_list|)
argument_list|)
expr_stmt|;
name|print_class_type
argument_list|(
name|fp
argument_list|,
name|key
argument_list|)
expr_stmt|;
comment|/* print a number of rdf's */
comment|/* flags */
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|key
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
comment|/* proto */
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|key
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
comment|/* algo */
name|ldns_rdf_print
argument_list|(
name|fp
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|key
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2native_int16
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|key
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|==
literal|256
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" ;{id = %u (zsk), size = %db}"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|ldns_calc_keytag
argument_list|(
name|key
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|ldns_rr_dnskey_key_size
argument_list|(
name|key
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|ldns_rdf2native_int16
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|key
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|==
literal|257
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" ;{id = %u (ksk), size = %db}"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|ldns_calc_keytag
argument_list|(
name|key
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|ldns_rr_dnskey_key_size
argument_list|(
name|key
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" ;{id = %u, size = %db}"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|ldns_calc_keytag
argument_list|(
name|key
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|ldns_rr_dnskey_key_size
argument_list|(
name|key
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|print_rr_list_abbr
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|ldns_rr_list
modifier|*
name|rrlist
parameter_list|,
specifier|const
name|char
modifier|*
name|usr
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
name|ldns_rr_type
name|tp
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_list_rr_count
argument_list|(
name|rrlist
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|tp
operator|=
name|ldns_rr_get_type
argument_list|(
name|ldns_rr_list_rr
argument_list|(
name|rrlist
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
operator|&&
name|tp
operator|!=
name|LDNS_RR_TYPE_RRSIG
condition|)
block|{
if|if
condition|(
name|usr
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s "
argument_list|,
name|usr
argument_list|)
expr_stmt|;
block|}
block|}
switch|switch
condition|(
name|tp
condition|)
block|{
case|case
name|LDNS_RR_TYPE_DNSKEY
case|:
name|print_dnskey_abbr
argument_list|(
name|fp
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|rrlist
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RR_TYPE_RRSIG
case|:
name|print_rrsig_abbr
argument_list|(
name|fp
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|rrlist
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RR_TYPE_DS
case|:
name|print_ds_abbr
argument_list|(
name|fp
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|rrlist
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* not handled */
break|break;
block|}
name|fputs
argument_list|(
literal|"\n"
argument_list|,
name|fp
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
modifier|*
name|xmalloc
parameter_list|(
name|size_t
name|s
parameter_list|)
block|{
name|void
modifier|*
name|p
decl_stmt|;
name|p
operator|=
name|malloc
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p
condition|)
block|{
name|printf
argument_list|(
literal|"Mem failure\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
return|return
name|p
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|xrealloc
parameter_list|(
name|void
modifier|*
name|p
parameter_list|,
name|size_t
name|size
parameter_list|)
block|{
name|void
modifier|*
name|q
decl_stmt|;
name|q
operator|=
name|realloc
argument_list|(
name|p
argument_list|,
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|q
condition|)
block|{
name|printf
argument_list|(
literal|"Mem failure\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
return|return
name|q
return|;
block|}
end_function

begin_function
name|void
name|xfree
parameter_list|(
name|void
modifier|*
name|p
parameter_list|)
block|{
if|if
condition|(
name|p
condition|)
block|{
name|free
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

