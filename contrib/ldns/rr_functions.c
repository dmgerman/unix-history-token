begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * rr_function.c  *  * function that operate on specific rr types  *  * (c) NLnet Labs, 2004-2006  * See the file LICENSE for the license  */
end_comment

begin_comment
comment|/*  * These come strait from perldoc Net::DNS::RR::xxx  * first the read variant, then the write. This is  * not complete.  */
end_comment

begin_include
include|#
directive|include
file|<ldns/config.h>
end_include

begin_include
include|#
directive|include
file|<ldns/ldns.h>
end_include

begin_include
include|#
directive|include
file|<limits.h>
end_include

begin_include
include|#
directive|include
file|<strings.h>
end_include

begin_comment
comment|/**  * return a specific rdf  * \param[in] type type of RR  * \param[in] rr   the rr itself  * \param[in] pos  at which postion to get it  * \return the rdf sought  */
end_comment

begin_function
specifier|static
name|ldns_rdf
modifier|*
name|ldns_rr_function
parameter_list|(
name|ldns_rr_type
name|type
parameter_list|,
specifier|const
name|ldns_rr
modifier|*
name|rr
parameter_list|,
name|size_t
name|pos
parameter_list|)
block|{
if|if
condition|(
operator|!
name|rr
operator|||
name|ldns_rr_get_type
argument_list|(
name|rr
argument_list|)
operator|!=
name|type
condition|)
block|{
return|return
name|NULL
return|;
block|}
return|return
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
name|pos
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * set a specific rdf  * \param[in] type type of RR  * \param[in] rr   the rr itself  * \param[in] rdf  the rdf to set  * \param[in] pos  at which postion to set it  * \return true or false  */
end_comment

begin_function
specifier|static
name|bool
name|ldns_rr_set_function
parameter_list|(
name|ldns_rr_type
name|type
parameter_list|,
name|ldns_rr
modifier|*
name|rr
parameter_list|,
name|ldns_rdf
modifier|*
name|rdf
parameter_list|,
name|size_t
name|pos
parameter_list|)
block|{
name|ldns_rdf
modifier|*
name|pop
decl_stmt|;
if|if
condition|(
operator|!
name|rr
operator|||
name|ldns_rr_get_type
argument_list|(
name|rr
argument_list|)
operator|!=
name|type
condition|)
block|{
return|return
name|false
return|;
block|}
name|pop
operator|=
name|ldns_rr_set_rdf
argument_list|(
name|rr
argument_list|,
name|rdf
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|ldns_rdf_deep_free
argument_list|(
name|pop
argument_list|)
expr_stmt|;
return|return
name|true
return|;
block|}
end_function

begin_comment
comment|/* A/AAAA records */
end_comment

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_a_address
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
comment|/* 2 types to check, cannot use the macro */
if|if
condition|(
operator|!
name|r
operator|||
operator|(
name|ldns_rr_get_type
argument_list|(
name|r
argument_list|)
operator|!=
name|LDNS_RR_TYPE_A
operator|&&
name|ldns_rr_get_type
argument_list|(
name|r
argument_list|)
operator|!=
name|LDNS_RR_TYPE_AAAA
operator|)
condition|)
block|{
return|return
name|NULL
return|;
block|}
return|return
name|ldns_rr_rdf
argument_list|(
name|r
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_a_set_address
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
comment|/* 2 types to check, cannot use the macro... */
name|ldns_rdf
modifier|*
name|pop
decl_stmt|;
if|if
condition|(
operator|!
name|r
operator|||
operator|(
name|ldns_rr_get_type
argument_list|(
name|r
argument_list|)
operator|!=
name|LDNS_RR_TYPE_A
operator|&&
name|ldns_rr_get_type
argument_list|(
name|r
argument_list|)
operator|!=
name|LDNS_RR_TYPE_AAAA
operator|)
condition|)
block|{
return|return
name|false
return|;
block|}
name|pop
operator|=
name|ldns_rr_set_rdf
argument_list|(
name|r
argument_list|,
name|f
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|pop
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|pop
argument_list|)
expr_stmt|;
return|return
name|true
return|;
block|}
else|else
block|{
return|return
name|false
return|;
block|}
block|}
end_function

begin_comment
comment|/* NS record */
end_comment

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_ns_nsdname
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_NS
argument_list|,
name|r
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* MX record */
end_comment

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_mx_preference
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_MX
argument_list|,
name|r
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_mx_exchange
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_MX
argument_list|,
name|r
argument_list|,
literal|1
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* RRSIG record */
end_comment

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_rrsig_typecovered
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_rrsig_set_typecovered
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_rrsig_algorithm
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
literal|1
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_rrsig_set_algorithm
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|1
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_rrsig_labels
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
literal|2
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_rrsig_set_labels
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|2
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_rrsig_origttl
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
literal|3
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_rrsig_set_origttl
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|3
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_rrsig_expiration
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
literal|4
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_rrsig_set_expiration
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|4
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_rrsig_inception
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
literal|5
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_rrsig_set_inception
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|5
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_rrsig_keytag
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
literal|6
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_rrsig_set_keytag
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|6
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_rrsig_signame
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
literal|7
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_rrsig_set_signame
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|7
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_rrsig_sig
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
literal|8
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_rrsig_set_sig
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_RRSIG
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|8
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* DNSKEY record */
end_comment

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_dnskey_flags
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_DNSKEY
argument_list|,
name|r
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_dnskey_set_flags
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_DNSKEY
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_dnskey_protocol
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_DNSKEY
argument_list|,
name|r
argument_list|,
literal|1
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_dnskey_set_protocol
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_DNSKEY
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|1
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_dnskey_algorithm
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_DNSKEY
argument_list|,
name|r
argument_list|,
literal|2
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_dnskey_set_algorithm
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_DNSKEY
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|2
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_rr_dnskey_key
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|r
parameter_list|)
block|{
return|return
name|ldns_rr_function
argument_list|(
name|LDNS_RR_TYPE_DNSKEY
argument_list|,
name|r
argument_list|,
literal|3
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_rr_dnskey_set_key
parameter_list|(
name|ldns_rr
modifier|*
name|r
parameter_list|,
name|ldns_rdf
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ldns_rr_set_function
argument_list|(
name|LDNS_RR_TYPE_DNSKEY
argument_list|,
name|r
argument_list|,
name|f
argument_list|,
literal|3
argument_list|)
return|;
block|}
end_function

begin_function
name|size_t
name|ldns_rr_dnskey_key_size_raw
parameter_list|(
specifier|const
name|unsigned
name|char
modifier|*
name|keydata
parameter_list|,
specifier|const
name|size_t
name|len
parameter_list|,
specifier|const
name|ldns_algorithm
name|alg
parameter_list|)
block|{
comment|/* for DSA keys */
name|uint8_t
name|t
decl_stmt|;
comment|/* for RSA keys */
name|uint16_t
name|exp
decl_stmt|;
name|uint16_t
name|int16
decl_stmt|;
switch|switch
condition|(
operator|(
name|ldns_signing_algorithm
operator|)
name|alg
condition|)
block|{
case|case
name|LDNS_SIGN_DSA
case|:
case|case
name|LDNS_SIGN_DSA_NSEC3
case|:
if|if
condition|(
name|len
operator|>
literal|0
condition|)
block|{
name|t
operator|=
name|keydata
index|[
literal|0
index|]
expr_stmt|;
return|return
operator|(
literal|64
operator|+
name|t
operator|*
literal|8
operator|)
operator|*
literal|8
return|;
block|}
else|else
block|{
return|return
literal|0
return|;
block|}
break|break;
case|case
name|LDNS_SIGN_RSAMD5
case|:
case|case
name|LDNS_SIGN_RSASHA1
case|:
case|case
name|LDNS_SIGN_RSASHA1_NSEC3
case|:
ifdef|#
directive|ifdef
name|USE_SHA2
case|case
name|LDNS_SIGN_RSASHA256
case|:
case|case
name|LDNS_SIGN_RSASHA512
case|:
endif|#
directive|endif
if|if
condition|(
name|len
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|keydata
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
comment|/* big exponent */
if|if
condition|(
name|len
operator|>
literal|3
condition|)
block|{
name|memmove
argument_list|(
operator|&
name|int16
argument_list|,
name|keydata
operator|+
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|exp
operator|=
name|ntohs
argument_list|(
name|int16
argument_list|)
expr_stmt|;
return|return
operator|(
name|len
operator|-
name|exp
operator|-
literal|3
operator|)
operator|*
literal|8
return|;
block|}
else|else
block|{
return|return
literal|0
return|;
block|}
block|}
else|else
block|{
name|exp
operator|=
name|keydata
index|[
literal|0
index|]
expr_stmt|;
return|return
operator|(
name|len
operator|-
name|exp
operator|-
literal|1
operator|)
operator|*
literal|8
return|;
block|}
block|}
else|else
block|{
return|return
literal|0
return|;
block|}
break|break;
ifdef|#
directive|ifdef
name|USE_GOST
case|case
name|LDNS_SIGN_ECC_GOST
case|:
return|return
literal|512
return|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|USE_ECDSA
case|case
name|LDNS_SIGN_ECDSAP256SHA256
case|:
return|return
literal|256
return|;
case|case
name|LDNS_SIGN_ECDSAP384SHA384
case|:
return|return
literal|384
return|;
endif|#
directive|endif
case|case
name|LDNS_SIGN_HMACMD5
case|:
return|return
name|len
return|;
default|default:
return|return
literal|0
return|;
block|}
block|}
end_function

begin_function
name|size_t
name|ldns_rr_dnskey_key_size
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|key
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
operator|||
operator|!
name|ldns_rr_dnskey_key
argument_list|(
name|key
argument_list|)
operator|||
operator|!
name|ldns_rr_dnskey_algorithm
argument_list|(
name|key
argument_list|)
condition|)
block|{
return|return
literal|0
return|;
block|}
return|return
name|ldns_rr_dnskey_key_size_raw
argument_list|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|ldns_rdf_data
argument_list|(
name|ldns_rr_dnskey_key
argument_list|(
name|key
argument_list|)
argument_list|)
argument_list|,
name|ldns_rdf_size
argument_list|(
name|ldns_rr_dnskey_key
argument_list|(
name|key
argument_list|)
argument_list|)
argument_list|,
name|ldns_rdf2native_int8
argument_list|(
name|ldns_rr_dnskey_algorithm
argument_list|(
name|key
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|uint32_t
name|ldns_soa_serial_identity
parameter_list|(
name|uint32_t
name|ATTR_UNUSED
parameter_list|(
name|unused
parameter_list|)
parameter_list|,
name|void
modifier|*
name|data
parameter_list|)
block|{
return|return
operator|(
name|uint32_t
operator|)
operator|(
name|intptr_t
operator|)
name|data
return|;
block|}
end_function

begin_function
name|uint32_t
name|ldns_soa_serial_increment
parameter_list|(
name|uint32_t
name|s
parameter_list|,
name|void
modifier|*
name|ATTR_UNUSED
parameter_list|(
name|unused
parameter_list|)
parameter_list|)
block|{
return|return
name|ldns_soa_serial_increment_by
argument_list|(
name|s
argument_list|,
operator|(
name|void
operator|*
operator|)
literal|1
argument_list|)
return|;
block|}
end_function

begin_function
name|uint32_t
name|ldns_soa_serial_increment_by
parameter_list|(
name|uint32_t
name|s
parameter_list|,
name|void
modifier|*
name|data
parameter_list|)
block|{
return|return
name|s
operator|+
operator|(
name|intptr_t
operator|)
name|data
return|;
block|}
end_function

begin_function
name|uint32_t
name|ldns_soa_serial_datecounter
parameter_list|(
name|uint32_t
name|s
parameter_list|,
name|void
modifier|*
name|data
parameter_list|)
block|{
name|struct
name|tm
name|tm
decl_stmt|;
name|char
name|s_str
index|[
literal|11
index|]
decl_stmt|;
name|int32_t
name|new_s
decl_stmt|;
name|time_t
name|t
init|=
name|data
condition|?
operator|(
name|time_t
operator|)
operator|(
name|intptr_t
operator|)
name|data
else|:
name|ldns_time
argument_list|(
name|NULL
argument_list|)
decl_stmt|;
operator|(
name|void
operator|)
name|strftime
argument_list|(
name|s_str
argument_list|,
literal|11
argument_list|,
literal|"%Y%m%d00"
argument_list|,
name|localtime_r
argument_list|(
operator|&
name|t
argument_list|,
operator|&
name|tm
argument_list|)
argument_list|)
expr_stmt|;
name|new_s
operator|=
operator|(
name|int32_t
operator|)
name|atoi
argument_list|(
name|s_str
argument_list|)
expr_stmt|;
return|return
name|new_s
operator|-
operator|(
operator|(
name|int32_t
operator|)
name|s
operator|)
operator|<=
literal|0
condition|?
name|s
operator|+
literal|1
else|:
operator|(
operator|(
name|uint32_t
operator|)
name|new_s
operator|)
return|;
block|}
end_function

begin_function
name|uint32_t
name|ldns_soa_serial_unixtime
parameter_list|(
name|uint32_t
name|s
parameter_list|,
name|void
modifier|*
name|data
parameter_list|)
block|{
name|int32_t
name|new_s
init|=
name|data
condition|?
operator|(
name|int32_t
operator|)
operator|(
name|intptr_t
operator|)
name|data
else|:
operator|(
name|int32_t
operator|)
name|ldns_time
argument_list|(
name|NULL
argument_list|)
decl_stmt|;
return|return
name|new_s
operator|-
operator|(
operator|(
name|int32_t
operator|)
name|s
operator|)
operator|<=
literal|0
condition|?
name|s
operator|+
literal|1
else|:
operator|(
operator|(
name|uint32_t
operator|)
name|new_s
operator|)
return|;
block|}
end_function

begin_function
name|void
name|ldns_rr_soa_increment
parameter_list|(
name|ldns_rr
modifier|*
name|soa
parameter_list|)
block|{
name|ldns_rr_soa_increment_func_data
argument_list|(
name|soa
argument_list|,
name|ldns_soa_serial_increment
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_rr_soa_increment_func
parameter_list|(
name|ldns_rr
modifier|*
name|soa
parameter_list|,
name|ldns_soa_serial_increment_func_t
name|f
parameter_list|)
block|{
name|ldns_rr_soa_increment_func_data
argument_list|(
name|soa
argument_list|,
name|f
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_rr_soa_increment_func_data
parameter_list|(
name|ldns_rr
modifier|*
name|soa
parameter_list|,
name|ldns_soa_serial_increment_func_t
name|f
parameter_list|,
name|void
modifier|*
name|data
parameter_list|)
block|{
name|ldns_rdf
modifier|*
name|prev_soa_serial_rdf
decl_stmt|;
if|if
condition|(
operator|!
name|soa
operator|||
operator|!
name|f
operator|||
name|ldns_rr_get_type
argument_list|(
name|soa
argument_list|)
operator|!=
name|LDNS_RR_TYPE_SOA
operator|||
operator|!
name|ldns_rr_rdf
argument_list|(
name|soa
argument_list|,
literal|2
argument_list|)
condition|)
block|{
return|return;
block|}
name|prev_soa_serial_rdf
operator|=
name|ldns_rr_set_rdf
argument_list|(
name|soa
argument_list|,
name|ldns_native2rdf_int32
argument_list|(
name|LDNS_RDF_TYPE_INT32
argument_list|,
call|(
modifier|*
name|f
call|)
argument_list|(
name|ldns_rdf2native_int32
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|soa
argument_list|,
literal|2
argument_list|)
argument_list|)
argument_list|,
name|data
argument_list|)
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|prev_soa_serial_rdf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_rr_soa_increment_func_int
parameter_list|(
name|ldns_rr
modifier|*
name|soa
parameter_list|,
name|ldns_soa_serial_increment_func_t
name|f
parameter_list|,
name|int
name|data
parameter_list|)
block|{
name|ldns_rr_soa_increment_func_data
argument_list|(
name|soa
argument_list|,
name|f
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|(
name|intptr_t
operator|)
name|data
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

