begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * str2host.c  *  * conversion routines from the presentation format  * to the host format  *  * a Net::DNS like library for C  *  * (c) NLnet Labs, 2004-2006  *  * See the file LICENSE for the license  */
end_comment

begin_include
include|#
directive|include
file|<ldns/config.h>
end_include

begin_include
include|#
directive|include
file|<ldns/ldns.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SYS_SOCKET_H
end_ifdef

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_ARPA_INET_H
end_ifdef

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_NETDB_H
end_ifdef

begin_include
include|#
directive|include
file|<netdb.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<limits.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SYS_PARAM_H
end_ifdef

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|ldns_status
name|ldns_str2rdf_int16
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|shortstr
parameter_list|)
block|{
name|char
modifier|*
name|end
init|=
name|NULL
decl_stmt|;
name|uint16_t
modifier|*
name|r
decl_stmt|;
name|r
operator|=
name|LDNS_MALLOC
argument_list|(
name|uint16_t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|r
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
operator|*
name|r
operator|=
name|htons
argument_list|(
operator|(
name|uint16_t
operator|)
name|strtol
argument_list|(
operator|(
name|char
operator|*
operator|)
name|shortstr
argument_list|,
operator|&
name|end
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|end
operator|!=
literal|0
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_INT
return|;
block|}
else|else
block|{
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_INT16
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_time
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|time
parameter_list|)
block|{
comment|/* convert a time YYYYDDMMHHMMSS to wireformat */
name|uint16_t
modifier|*
name|r
init|=
name|NULL
decl_stmt|;
name|struct
name|tm
name|tm
decl_stmt|;
name|uint32_t
name|l
decl_stmt|;
name|char
modifier|*
name|end
decl_stmt|;
comment|/* Try to scan the time... */
name|r
operator|=
operator|(
name|uint16_t
operator|*
operator|)
name|LDNS_MALLOC
argument_list|(
name|uint32_t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|r
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
name|memset
argument_list|(
operator|&
name|tm
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|tm
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|time
argument_list|)
operator|==
literal|14
operator|&&
name|sscanf
argument_list|(
name|time
argument_list|,
literal|"%4d%2d%2d%2d%2d%2d"
argument_list|,
operator|&
name|tm
operator|.
name|tm_year
argument_list|,
operator|&
name|tm
operator|.
name|tm_mon
argument_list|,
operator|&
name|tm
operator|.
name|tm_mday
argument_list|,
operator|&
name|tm
operator|.
name|tm_hour
argument_list|,
operator|&
name|tm
operator|.
name|tm_min
argument_list|,
operator|&
name|tm
operator|.
name|tm_sec
argument_list|)
operator|==
literal|6
condition|)
block|{
name|tm
operator|.
name|tm_year
operator|-=
literal|1900
expr_stmt|;
name|tm
operator|.
name|tm_mon
operator|--
expr_stmt|;
comment|/* Check values */
if|if
condition|(
name|tm
operator|.
name|tm_year
operator|<
literal|70
condition|)
block|{
goto|goto
name|bad_format
goto|;
block|}
if|if
condition|(
name|tm
operator|.
name|tm_mon
operator|<
literal|0
operator|||
name|tm
operator|.
name|tm_mon
operator|>
literal|11
condition|)
block|{
goto|goto
name|bad_format
goto|;
block|}
if|if
condition|(
name|tm
operator|.
name|tm_mday
operator|<
literal|1
operator|||
name|tm
operator|.
name|tm_mday
operator|>
literal|31
condition|)
block|{
goto|goto
name|bad_format
goto|;
block|}
if|if
condition|(
name|tm
operator|.
name|tm_hour
operator|<
literal|0
operator|||
name|tm
operator|.
name|tm_hour
operator|>
literal|23
condition|)
block|{
goto|goto
name|bad_format
goto|;
block|}
if|if
condition|(
name|tm
operator|.
name|tm_min
operator|<
literal|0
operator|||
name|tm
operator|.
name|tm_min
operator|>
literal|59
condition|)
block|{
goto|goto
name|bad_format
goto|;
block|}
if|if
condition|(
name|tm
operator|.
name|tm_sec
operator|<
literal|0
operator|||
name|tm
operator|.
name|tm_sec
operator|>
literal|59
condition|)
block|{
goto|goto
name|bad_format
goto|;
block|}
name|l
operator|=
name|htonl
argument_list|(
name|ldns_mktime_from_utc
argument_list|(
operator|&
name|tm
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|r
argument_list|,
operator|&
name|l
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_TIME
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
else|else
block|{
comment|/* handle it as 32 bits timestamp */
name|l
operator|=
name|htonl
argument_list|(
operator|(
name|uint32_t
operator|)
name|strtol
argument_list|(
operator|(
name|char
operator|*
operator|)
name|time
argument_list|,
operator|&
name|end
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|end
operator|!=
literal|0
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_ERR
return|;
block|}
else|else
block|{
name|memcpy
argument_list|(
name|r
argument_list|,
operator|&
name|l
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_INT32
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
block|}
name|bad_format
label|:
name|LDNS_FREE
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_TIME
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_nsec3_salt
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|salt_str
parameter_list|)
block|{
name|uint8_t
name|salt_length
decl_stmt|;
name|int
name|c
decl_stmt|;
name|int
name|salt_length_str
decl_stmt|;
name|uint8_t
modifier|*
name|salt
decl_stmt|;
name|uint8_t
modifier|*
name|data
decl_stmt|;
if|if
condition|(
name|rd
operator|==
name|NULL
condition|)
block|{
return|return
name|LDNS_STATUS_NULL
return|;
block|}
name|salt_length_str
operator|=
operator|(
name|int
operator|)
name|strlen
argument_list|(
name|salt_str
argument_list|)
expr_stmt|;
if|if
condition|(
name|salt_length_str
operator|==
literal|1
operator|&&
name|salt_str
index|[
literal|0
index|]
operator|==
literal|'-'
condition|)
block|{
name|salt_length_str
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|salt_length_str
operator|%
literal|2
operator|!=
literal|0
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_HEX
return|;
block|}
if|if
condition|(
name|salt_length_str
operator|>
literal|512
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_HEX
return|;
block|}
name|salt
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|salt_length_str
operator|/
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|salt
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
for|for
control|(
name|c
operator|=
literal|0
init|;
name|c
operator|<
name|salt_length_str
condition|;
name|c
operator|+=
literal|2
control|)
block|{
if|if
condition|(
name|isxdigit
argument_list|(
operator|(
name|int
operator|)
name|salt_str
index|[
name|c
index|]
argument_list|)
operator|&&
name|isxdigit
argument_list|(
operator|(
name|int
operator|)
name|salt_str
index|[
name|c
operator|+
literal|1
index|]
argument_list|)
condition|)
block|{
name|salt
index|[
name|c
operator|/
literal|2
index|]
operator|=
operator|(
name|uint8_t
operator|)
name|ldns_hexdigit_to_int
argument_list|(
name|salt_str
index|[
name|c
index|]
argument_list|)
operator|*
literal|16
operator|+
name|ldns_hexdigit_to_int
argument_list|(
name|salt_str
index|[
name|c
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|LDNS_FREE
argument_list|(
name|salt
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_HEX
return|;
block|}
block|}
name|salt_length
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|salt_length_str
operator|/
literal|2
argument_list|)
expr_stmt|;
name|data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
literal|1
operator|+
name|salt_length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|data
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|salt
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|data
index|[
literal|0
index|]
operator|=
name|salt_length
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|data
index|[
literal|1
index|]
argument_list|,
name|salt
argument_list|,
name|salt_length
argument_list|)
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_NSEC3_SALT
argument_list|,
literal|1
operator|+
name|salt_length
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|salt
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_period
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|period
parameter_list|)
block|{
name|uint32_t
name|p
decl_stmt|;
specifier|const
name|char
modifier|*
name|end
decl_stmt|;
comment|/* Allocate required space... */
name|p
operator|=
name|ldns_str2period
argument_list|(
name|period
argument_list|,
operator|&
name|end
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|end
operator|!=
literal|0
condition|)
block|{
return|return
name|LDNS_STATUS_ERR
return|;
block|}
else|else
block|{
name|p
operator|=
operator|(
name|uint32_t
operator|)
name|htonl
argument_list|(
name|p
argument_list|)
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_PERIOD
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
block|}
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_int32
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|longstr
parameter_list|)
block|{
name|char
modifier|*
name|end
decl_stmt|;
name|uint16_t
modifier|*
name|r
init|=
name|NULL
decl_stmt|;
name|uint32_t
name|l
decl_stmt|;
name|r
operator|=
operator|(
name|uint16_t
operator|*
operator|)
name|LDNS_MALLOC
argument_list|(
name|uint32_t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|r
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
name|errno
operator|=
literal|0
expr_stmt|;
comment|/* must set to zero before call, 			note race condition on errno */
if|if
condition|(
operator|*
name|longstr
operator|==
literal|'-'
condition|)
name|l
operator|=
name|htonl
argument_list|(
operator|(
name|uint32_t
operator|)
name|strtol
argument_list|(
operator|(
name|char
operator|*
operator|)
name|longstr
argument_list|,
operator|&
name|end
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|l
operator|=
name|htonl
argument_list|(
operator|(
name|uint32_t
operator|)
name|strtoul
argument_list|(
operator|(
name|char
operator|*
operator|)
name|longstr
argument_list|,
operator|&
name|end
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|end
operator|!=
literal|0
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_ERR
return|;
block|}
else|else
block|{
if|if
condition|(
name|errno
operator|==
name|ERANGE
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_SYNTAX_INTEGER_OVERFLOW
return|;
block|}
name|memcpy
argument_list|(
name|r
argument_list|,
operator|&
name|l
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_INT32
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_int8
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|bytestr
parameter_list|)
block|{
name|char
modifier|*
name|end
decl_stmt|;
name|uint8_t
modifier|*
name|r
init|=
name|NULL
decl_stmt|;
name|r
operator|=
name|LDNS_MALLOC
argument_list|(
name|uint8_t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|r
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
operator|*
name|r
operator|=
operator|(
name|uint8_t
operator|)
name|strtol
argument_list|(
operator|(
name|char
operator|*
operator|)
name|bytestr
argument_list|,
operator|&
name|end
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|end
operator|!=
literal|0
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_ERR
return|;
block|}
else|else
block|{
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_INT8
argument_list|,
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * Checks whether the escaped value at **s is an octal value or  * a 'normally' escaped character (and not eos)  *  * The string pointer at *s is increased by either 0 (on error), 1 (on  * normal escapes), or 3 (on octals)  *  * Returns the number of bytes read from the escaped string, or  * 0 on error  */
end_comment

begin_function
name|INLINE
name|bool
name|parse_escape
parameter_list|(
name|uint8_t
modifier|*
name|ch_p
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|str_p
parameter_list|)
block|{
name|uint16_t
name|val
decl_stmt|;
if|if
condition|(
operator|(
operator|*
name|str_p
operator|)
index|[
literal|0
index|]
operator|&&
name|isdigit
argument_list|(
operator|(
operator|*
name|str_p
operator|)
index|[
literal|0
index|]
argument_list|)
operator|&&
operator|(
operator|*
name|str_p
operator|)
index|[
literal|1
index|]
operator|&&
name|isdigit
argument_list|(
operator|(
operator|*
name|str_p
operator|)
index|[
literal|1
index|]
argument_list|)
operator|&&
operator|(
operator|*
name|str_p
operator|)
index|[
literal|2
index|]
operator|&&
name|isdigit
argument_list|(
operator|(
operator|*
name|str_p
operator|)
index|[
literal|2
index|]
argument_list|)
condition|)
block|{
name|val
operator|=
call|(
name|uint16_t
call|)
argument_list|(
operator|(
operator|(
operator|*
name|str_p
operator|)
index|[
literal|0
index|]
operator|-
literal|'0'
operator|)
operator|*
literal|100
operator|+
operator|(
operator|(
operator|*
name|str_p
operator|)
index|[
literal|1
index|]
operator|-
literal|'0'
operator|)
operator|*
literal|10
operator|+
operator|(
operator|(
operator|*
name|str_p
operator|)
index|[
literal|2
index|]
operator|-
literal|'0'
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|>
literal|255
condition|)
block|{
goto|goto
name|error
goto|;
block|}
operator|*
name|ch_p
operator|=
operator|(
name|uint8_t
operator|)
name|val
expr_stmt|;
operator|*
name|str_p
operator|+=
literal|3
expr_stmt|;
return|return
name|true
return|;
block|}
elseif|else
if|if
condition|(
operator|(
operator|*
name|str_p
operator|)
index|[
literal|0
index|]
operator|&&
operator|!
name|isdigit
argument_list|(
operator|(
operator|*
name|str_p
operator|)
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
operator|*
name|ch_p
operator|=
operator|(
name|uint8_t
operator|)
operator|*
operator|(
operator|*
name|str_p
operator|)
operator|++
expr_stmt|;
return|return
name|true
return|;
block|}
name|error
label|:
operator|*
name|str_p
operator|=
name|NULL
expr_stmt|;
return|return
name|false
return|;
comment|/* LDNS_STATUS_SYNTAX_BAD_ESCAPE */
block|}
end_function

begin_function
name|INLINE
name|bool
name|parse_char
parameter_list|(
name|uint8_t
modifier|*
name|ch_p
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|str_p
parameter_list|)
block|{
switch|switch
condition|(
operator|*
operator|*
name|str_p
condition|)
block|{
case|case
literal|'\0'
case|:
return|return
name|false
return|;
case|case
literal|'\\'
case|:
operator|*
name|str_p
operator|+=
literal|1
expr_stmt|;
return|return
name|parse_escape
argument_list|(
name|ch_p
argument_list|,
name|str_p
argument_list|)
return|;
default|default:
operator|*
name|ch_p
operator|=
operator|(
name|uint8_t
operator|)
operator|*
operator|(
operator|*
name|str_p
operator|)
operator|++
expr_stmt|;
return|return
name|true
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * No special care is taken, all dots are translated into  * label seperators.  * Could be made more efficient....we do 3 memcpy's in total...  */
end_comment

begin_function
name|ldns_status
name|ldns_str2rdf_dname
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|d
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|size_t
name|len
decl_stmt|;
specifier|const
name|char
modifier|*
name|s
decl_stmt|;
name|uint8_t
modifier|*
name|q
decl_stmt|,
modifier|*
name|pq
decl_stmt|,
name|label_len
decl_stmt|;
name|uint8_t
name|buf
index|[
name|LDNS_MAX_DOMAINLEN
operator|+
literal|1
index|]
decl_stmt|;
operator|*
name|d
operator|=
name|NULL
expr_stmt|;
name|len
operator|=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|str
argument_list|)
expr_stmt|;
comment|/* octet representation can make strings a lot longer than actual length */
if|if
condition|(
name|len
operator|>
name|LDNS_MAX_DOMAINLEN
operator|*
literal|4
condition|)
block|{
return|return
name|LDNS_STATUS_DOMAINNAME_OVERFLOW
return|;
block|}
if|if
condition|(
literal|0
operator|==
name|len
condition|)
block|{
return|return
name|LDNS_STATUS_DOMAINNAME_UNDERFLOW
return|;
block|}
comment|/* root label */
if|if
condition|(
literal|1
operator|==
name|len
operator|&&
operator|*
name|str
operator|==
literal|'.'
condition|)
block|{
operator|*
name|d
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_DNAME
argument_list|,
literal|1
argument_list|,
literal|"\0"
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_OK
return|;
block|}
comment|/* get on with the rest */
comment|/* s is on the current character in the string          * pq points to where the labellength is going to go          * label_len keeps track of the current label's length 	 * q builds the dname inside the buf array 	 */
name|len
operator|=
literal|0
expr_stmt|;
name|q
operator|=
name|buf
operator|+
literal|1
expr_stmt|;
name|pq
operator|=
name|buf
expr_stmt|;
name|label_len
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|s
operator|=
name|str
init|;
operator|*
name|s
condition|;
name|s
operator|++
operator|,
name|q
operator|++
control|)
block|{
if|if
condition|(
name|q
operator|>
name|buf
operator|+
name|LDNS_MAX_DOMAINLEN
condition|)
block|{
return|return
name|LDNS_STATUS_DOMAINNAME_OVERFLOW
return|;
block|}
operator|*
name|q
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
operator|*
name|s
condition|)
block|{
case|case
literal|'.'
case|:
if|if
condition|(
name|label_len
operator|>
name|LDNS_MAX_LABELLEN
condition|)
block|{
return|return
name|LDNS_STATUS_LABEL_OVERFLOW
return|;
block|}
if|if
condition|(
name|label_len
operator|==
literal|0
condition|)
block|{
return|return
name|LDNS_STATUS_EMPTY_LABEL
return|;
block|}
name|len
operator|+=
name|label_len
operator|+
literal|1
expr_stmt|;
operator|*
name|pq
operator|=
name|label_len
expr_stmt|;
name|label_len
operator|=
literal|0
expr_stmt|;
name|pq
operator|=
name|q
expr_stmt|;
break|break;
case|case
literal|'\\'
case|:
comment|/* octet value or literal char */
name|s
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
name|parse_escape
argument_list|(
name|q
argument_list|,
operator|&
name|s
argument_list|)
condition|)
block|{
return|return
name|LDNS_STATUS_SYNTAX_BAD_ESCAPE
return|;
block|}
name|s
operator|-=
literal|1
expr_stmt|;
name|label_len
operator|++
expr_stmt|;
break|break;
default|default:
operator|*
name|q
operator|=
operator|(
name|uint8_t
operator|)
operator|*
name|s
expr_stmt|;
name|label_len
operator|++
expr_stmt|;
block|}
block|}
comment|/* add root label if last char was not '.' */
if|if
condition|(
operator|!
name|ldns_dname_str_absolute
argument_list|(
name|str
argument_list|)
condition|)
block|{
if|if
condition|(
name|q
operator|>
name|buf
operator|+
name|LDNS_MAX_DOMAINLEN
condition|)
block|{
return|return
name|LDNS_STATUS_DOMAINNAME_OVERFLOW
return|;
block|}
if|if
condition|(
name|label_len
operator|>
name|LDNS_MAX_LABELLEN
condition|)
block|{
return|return
name|LDNS_STATUS_LABEL_OVERFLOW
return|;
block|}
if|if
condition|(
name|label_len
operator|==
literal|0
condition|)
block|{
comment|/* label_len 0 but not . at end? */
return|return
name|LDNS_STATUS_EMPTY_LABEL
return|;
block|}
name|len
operator|+=
name|label_len
operator|+
literal|1
expr_stmt|;
operator|*
name|pq
operator|=
name|label_len
expr_stmt|;
operator|*
name|q
operator|=
literal|0
expr_stmt|;
block|}
name|len
operator|++
expr_stmt|;
operator|*
name|d
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_DNAME
argument_list|,
name|len
argument_list|,
name|buf
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_OK
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_a
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|in_addr_t
name|address
decl_stmt|;
if|if
condition|(
name|inet_pton
argument_list|(
name|AF_INET
argument_list|,
operator|(
name|char
operator|*
operator|)
name|str
argument_list|,
operator|&
name|address
argument_list|)
operator|!=
literal|1
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_IP4
return|;
block|}
else|else
block|{
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_A
argument_list|,
sizeof|sizeof
argument_list|(
name|address
argument_list|)
argument_list|,
operator|&
name|address
argument_list|)
expr_stmt|;
block|}
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_aaaa
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint8_t
name|address
index|[
name|LDNS_IP6ADDRLEN
operator|+
literal|1
index|]
decl_stmt|;
if|if
condition|(
name|inet_pton
argument_list|(
name|AF_INET6
argument_list|,
operator|(
name|char
operator|*
operator|)
name|str
argument_list|,
name|address
argument_list|)
operator|!=
literal|1
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_IP6
return|;
block|}
else|else
block|{
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_AAAA
argument_list|,
sizeof|sizeof
argument_list|(
name|address
argument_list|)
operator|-
literal|1
argument_list|,
operator|&
name|address
argument_list|)
expr_stmt|;
block|}
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_str
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint8_t
modifier|*
name|data
decl_stmt|,
modifier|*
name|dp
decl_stmt|,
name|ch
init|=
literal|0
decl_stmt|;
name|size_t
name|length
decl_stmt|;
comment|/* Worst case space requirement. We'll realloc to actual size later. */
name|dp
operator|=
name|data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
operator|>
literal|255
condition|?
literal|256
else|:
operator|(
name|strlen
argument_list|(
name|str
argument_list|)
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|data
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
comment|/* Fill data (up to 255 characters) */
while|while
condition|(
name|parse_char
argument_list|(
operator|&
name|ch
argument_list|,
operator|&
name|str
argument_list|)
condition|)
block|{
if|if
condition|(
name|dp
operator|-
name|data
operator|>=
literal|255
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
operator|*
operator|++
name|dp
operator|=
name|ch
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|str
condition|)
block|{
return|return
name|LDNS_STATUS_SYNTAX_BAD_ESCAPE
return|;
block|}
name|length
operator|=
call|(
name|size_t
call|)
argument_list|(
name|dp
operator|-
name|data
argument_list|)
expr_stmt|;
comment|/* Fix last length byte */
name|data
index|[
literal|0
index|]
operator|=
operator|(
name|uint8_t
operator|)
name|length
expr_stmt|;
comment|/* Lose the overmeasure */
name|data
operator|=
name|LDNS_XREALLOC
argument_list|(
name|dp
operator|=
name|data
argument_list|,
name|uint8_t
argument_list|,
name|length
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|data
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|dp
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
comment|/* Create rdf */
operator|*
name|rd
operator|=
name|ldns_rdf_new
argument_list|(
name|LDNS_RDF_TYPE_STR
argument_list|,
name|length
operator|+
literal|1
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|rd
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
return|return
name|LDNS_STATUS_OK
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_apl
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|my_str
init|=
name|str
decl_stmt|;
name|char
modifier|*
name|my_ip_str
decl_stmt|;
name|size_t
name|ip_str_len
decl_stmt|;
name|uint16_t
name|family
decl_stmt|;
name|bool
name|negation
decl_stmt|;
name|uint8_t
name|afdlength
init|=
literal|0
decl_stmt|;
name|uint8_t
modifier|*
name|afdpart
decl_stmt|;
name|uint8_t
name|prefix
decl_stmt|;
name|uint8_t
modifier|*
name|data
decl_stmt|;
name|size_t
name|i
init|=
literal|0
decl_stmt|;
comment|/* [!]afi:address/prefix */
if|if
condition|(
name|strlen
argument_list|(
name|my_str
argument_list|)
operator|<
literal|2
operator|||
name|strchr
argument_list|(
name|my_str
argument_list|,
literal|':'
argument_list|)
operator|==
name|NULL
operator|||
name|strchr
argument_list|(
name|my_str
argument_list|,
literal|'/'
argument_list|)
operator|==
name|NULL
operator|||
name|strchr
argument_list|(
name|my_str
argument_list|,
literal|':'
argument_list|)
operator|>
name|strchr
argument_list|(
name|my_str
argument_list|,
literal|'/'
argument_list|)
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
if|if
condition|(
name|my_str
index|[
literal|0
index|]
operator|==
literal|'!'
condition|)
block|{
name|negation
operator|=
name|true
expr_stmt|;
name|my_str
operator|+=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|negation
operator|=
name|false
expr_stmt|;
block|}
name|family
operator|=
operator|(
name|uint16_t
operator|)
name|atoi
argument_list|(
name|my_str
argument_list|)
expr_stmt|;
name|my_str
operator|=
name|strchr
argument_list|(
name|my_str
argument_list|,
literal|':'
argument_list|)
operator|+
literal|1
expr_stmt|;
comment|/* need ip addr and only ip addr for inet_pton */
name|ip_str_len
operator|=
call|(
name|size_t
call|)
argument_list|(
name|strchr
argument_list|(
name|my_str
argument_list|,
literal|'/'
argument_list|)
operator|-
name|my_str
argument_list|)
expr_stmt|;
name|my_ip_str
operator|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
name|ip_str_len
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|my_ip_str
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
name|strncpy
argument_list|(
name|my_ip_str
argument_list|,
name|my_str
argument_list|,
name|ip_str_len
operator|+
literal|1
argument_list|)
expr_stmt|;
name|my_ip_str
index|[
name|ip_str_len
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|family
operator|==
literal|1
condition|)
block|{
comment|/* ipv4 */
name|afdpart
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|afdpart
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|my_ip_str
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
if|if
condition|(
name|inet_pton
argument_list|(
name|AF_INET
argument_list|,
name|my_ip_str
argument_list|,
name|afdpart
argument_list|)
operator|==
literal|0
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|my_ip_str
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|afdpart
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|afdpart
index|[
name|i
index|]
operator|!=
literal|0
condition|)
block|{
name|afdlength
operator|=
name|i
operator|+
literal|1
expr_stmt|;
block|}
block|}
block|}
elseif|else
if|if
condition|(
name|family
operator|==
literal|2
condition|)
block|{
comment|/* ipv6 */
name|afdpart
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|afdpart
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|my_ip_str
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
if|if
condition|(
name|inet_pton
argument_list|(
name|AF_INET6
argument_list|,
name|my_ip_str
argument_list|,
name|afdpart
argument_list|)
operator|==
literal|0
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|my_ip_str
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|afdpart
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|afdpart
index|[
name|i
index|]
operator|!=
literal|0
condition|)
block|{
name|afdlength
operator|=
name|i
operator|+
literal|1
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
comment|/* unknown family */
name|LDNS_FREE
argument_list|(
name|my_ip_str
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
name|my_str
operator|=
name|strchr
argument_list|(
name|my_str
argument_list|,
literal|'/'
argument_list|)
operator|+
literal|1
expr_stmt|;
name|prefix
operator|=
operator|(
name|uint8_t
operator|)
name|atoi
argument_list|(
name|my_str
argument_list|)
expr_stmt|;
name|data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
literal|4
operator|+
name|afdlength
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|data
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|afdpart
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|my_ip_str
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
name|ldns_write_uint16
argument_list|(
name|data
argument_list|,
name|family
argument_list|)
expr_stmt|;
name|data
index|[
literal|2
index|]
operator|=
name|prefix
expr_stmt|;
name|data
index|[
literal|3
index|]
operator|=
name|afdlength
expr_stmt|;
if|if
condition|(
name|negation
condition|)
block|{
comment|/* set bit 1 of byte 3 */
name|data
index|[
literal|3
index|]
operator|=
name|data
index|[
literal|3
index|]
operator||
literal|0x80
expr_stmt|;
block|}
name|memcpy
argument_list|(
name|data
operator|+
literal|4
argument_list|,
name|afdpart
argument_list|,
name|afdlength
argument_list|)
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_APL
argument_list|,
name|afdlength
operator|+
literal|4
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|afdpart
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|my_ip_str
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_b64
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint8_t
modifier|*
name|buffer
decl_stmt|;
name|int16_t
name|i
decl_stmt|;
name|buffer
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|ldns_b64_ntop_calculate_size
argument_list|(
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|buffer
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|ldns_b64_pton
argument_list|(
operator|(
specifier|const
name|char
operator|*
operator|)
name|str
argument_list|,
name|buffer
argument_list|,
name|ldns_b64_ntop_calculate_size
argument_list|(
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|-
literal|1
operator|==
name|i
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_B64
return|;
block|}
else|else
block|{
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
operator|(
name|uint16_t
operator|)
name|i
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
block|}
name|LDNS_FREE
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_b32_ext
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint8_t
modifier|*
name|buffer
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/* first byte contains length of actual b32 data */
name|uint8_t
name|len
init|=
name|ldns_b32_pton_calculate_size
argument_list|(
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
decl_stmt|;
name|buffer
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|len
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|buffer
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|buffer
index|[
literal|0
index|]
operator|=
name|len
expr_stmt|;
name|i
operator|=
name|ldns_b32_pton_extended_hex
argument_list|(
operator|(
specifier|const
name|char
operator|*
operator|)
name|str
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|,
name|buffer
operator|+
literal|1
argument_list|,
name|ldns_b32_ntop_calculate_size
argument_list|(
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
literal|0
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_B32_EXT
return|;
block|}
else|else
block|{
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B32_EXT
argument_list|,
operator|(
name|uint16_t
operator|)
name|i
operator|+
literal|1
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
block|}
name|LDNS_FREE
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_hex
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint8_t
modifier|*
name|t
decl_stmt|,
modifier|*
name|t_orig
decl_stmt|;
name|int
name|i
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|str
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|LDNS_MAX_RDFLEN
operator|*
literal|2
condition|)
block|{
return|return
name|LDNS_STATUS_LABEL_OVERFLOW
return|;
block|}
else|else
block|{
name|t
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
operator|(
name|len
operator|/
literal|2
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|t
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|t_orig
operator|=
name|t
expr_stmt|;
comment|/* Now process octet by octet... */
while|while
condition|(
operator|*
name|str
condition|)
block|{
operator|*
name|t
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|isspace
argument_list|(
operator|(
name|int
operator|)
operator|*
name|str
argument_list|)
condition|)
block|{
name|str
operator|++
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|16
init|;
name|i
operator|>=
literal|1
condition|;
name|i
operator|-=
literal|15
control|)
block|{
while|while
condition|(
operator|*
name|str
operator|&&
name|isspace
argument_list|(
operator|(
name|int
operator|)
operator|*
name|str
argument_list|)
condition|)
block|{
name|str
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|str
condition|)
block|{
if|if
condition|(
name|isxdigit
argument_list|(
operator|(
name|int
operator|)
operator|*
name|str
argument_list|)
condition|)
block|{
operator|*
name|t
operator|+=
name|ldns_hexdigit_to_int
argument_list|(
operator|*
name|str
argument_list|)
operator|*
name|i
expr_stmt|;
block|}
else|else
block|{
name|LDNS_FREE
argument_list|(
name|t_orig
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_ERR
return|;
block|}
operator|++
name|str
expr_stmt|;
block|}
block|}
operator|++
name|t
expr_stmt|;
block|}
block|}
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_HEX
argument_list|,
call|(
name|size_t
call|)
argument_list|(
name|t
operator|-
name|t_orig
argument_list|)
argument_list|,
name|t_orig
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|t_orig
argument_list|)
expr_stmt|;
block|}
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_nsec
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|delimiters
init|=
literal|"\n\t "
decl_stmt|;
name|char
modifier|*
name|token
init|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
name|LDNS_MAX_RDFLEN
argument_list|)
decl_stmt|;
name|ldns_buffer
modifier|*
name|str_buf
decl_stmt|;
name|ssize_t
name|c
decl_stmt|;
name|uint16_t
name|cur_type
decl_stmt|;
name|size_t
name|type_count
init|=
literal|0
decl_stmt|;
name|ldns_rr_type
name|type_list
index|[
literal|65536
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|token
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
if|if
condition|(
name|rd
operator|==
name|NULL
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_NULL
return|;
block|}
name|str_buf
operator|=
name|LDNS_MALLOC
argument_list|(
name|ldns_buffer
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|str_buf
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|ldns_buffer_new_frm_data
argument_list|(
name|str_buf
argument_list|,
operator|(
name|char
operator|*
operator|)
name|str
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_buffer_status
argument_list|(
name|str_buf
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
while|while
condition|(
operator|(
name|c
operator|=
name|ldns_bget_token
argument_list|(
name|str_buf
argument_list|,
name|token
argument_list|,
name|delimiters
argument_list|,
name|LDNS_MAX_RDFLEN
argument_list|)
operator|)
operator|!=
operator|-
literal|1
operator|&&
name|c
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|type_count
operator|>=
sizeof|sizeof
argument_list|(
name|type_list
argument_list|)
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_ERR
return|;
block|}
name|cur_type
operator|=
name|ldns_get_rr_type_by_name
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|type_list
index|[
name|type_count
index|]
operator|=
name|cur_type
expr_stmt|;
name|type_count
operator|++
expr_stmt|;
block|}
operator|*
name|rd
operator|=
name|ldns_dnssec_create_nsec_bitmap
argument_list|(
name|type_list
argument_list|,
name|type_count
argument_list|,
name|LDNS_RR_TYPE_NSEC
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_type
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint16_t
name|type
decl_stmt|;
name|type
operator|=
name|htons
argument_list|(
name|ldns_get_rr_type_by_name
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ldns_rr_type is a 16 bit value */
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_TYPE
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
operator|&
name|type
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_class
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint16_t
name|klass
decl_stmt|;
name|klass
operator|=
name|htons
argument_list|(
name|ldns_get_rr_class_by_name
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
comment|/* class is 16 bit */
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_CLASS
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
operator|&
name|klass
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_comment
comment|/* An certificate alg field can either be specified as a 8 bits number  * or by its symbolic name. Handle both  */
end_comment

begin_function
name|ldns_status
name|ldns_str2rdf_cert_alg
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|ldns_lookup_table
modifier|*
name|lt
decl_stmt|;
name|ldns_status
name|st
decl_stmt|;
name|uint8_t
name|idd
index|[
literal|2
index|]
decl_stmt|;
name|lt
operator|=
name|ldns_lookup_by_name
argument_list|(
name|ldns_cert_algorithms
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|st
operator|=
name|LDNS_STATUS_OK
expr_stmt|;
if|if
condition|(
name|lt
condition|)
block|{
name|ldns_write_uint16
argument_list|(
name|idd
argument_list|,
operator|(
name|uint16_t
operator|)
name|lt
operator|->
name|id
argument_list|)
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_INT16
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|idd
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|rd
condition|)
block|{
name|st
operator|=
name|LDNS_STATUS_ERR
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* try as-is (a number) */
name|st
operator|=
name|ldns_str2rdf_int16
argument_list|(
name|rd
argument_list|,
name|str
argument_list|)
expr_stmt|;
if|if
condition|(
name|st
operator|==
name|LDNS_STATUS_OK
operator|&&
name|ldns_rdf2native_int16
argument_list|(
operator|*
name|rd
argument_list|)
operator|==
literal|0
condition|)
block|{
name|st
operator|=
name|LDNS_STATUS_CERT_BAD_ALGORITHM
expr_stmt|;
block|}
block|}
return|return
name|st
return|;
block|}
end_function

begin_comment
comment|/* An alg field can either be specified as a 8 bits number  * or by its symbolic name. Handle both  */
end_comment

begin_function
name|ldns_status
name|ldns_str2rdf_alg
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|ldns_lookup_table
modifier|*
name|lt
decl_stmt|;
name|ldns_status
name|st
decl_stmt|;
name|lt
operator|=
name|ldns_lookup_by_name
argument_list|(
name|ldns_algorithms
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|st
operator|=
name|LDNS_STATUS_OK
expr_stmt|;
if|if
condition|(
name|lt
condition|)
block|{
comment|/* it was given as a integer */
operator|*
name|rd
operator|=
name|ldns_native2rdf_int8
argument_list|(
name|LDNS_RDF_TYPE_INT8
argument_list|,
operator|(
name|uint8_t
operator|)
name|lt
operator|->
name|id
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|rd
condition|)
block|{
name|st
operator|=
name|LDNS_STATUS_ERR
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* try as-is (a number) */
name|st
operator|=
name|ldns_str2rdf_int8
argument_list|(
name|rd
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
return|return
name|st
return|;
block|}
end_function

begin_decl_stmt
name|ldns_status
name|ldns_str2rdf_unknown
argument_list|(
name|ATTR_UNUSED
argument_list|(
name|ldns_rdf
operator|*
operator|*
name|rd
argument_list|)
argument_list|,
name|ATTR_UNUSED
argument_list|(
specifier|const
name|char
operator|*
name|str
argument_list|)
argument_list|)
block|{
comment|/* this should be caught in an earlier time (general str2host for 	   rr's */
return|return
name|LDNS_STATUS_NOT_IMPL
return|;
block|}
end_decl_stmt

begin_decl_stmt
name|ldns_status
name|ldns_str2rdf_service
argument_list|(
name|ATTR_UNUSED
argument_list|(
name|ldns_rdf
operator|*
operator|*
name|rd
argument_list|)
argument_list|,
name|ATTR_UNUSED
argument_list|(
specifier|const
name|char
operator|*
name|str
argument_list|)
argument_list|)
block|{
comment|/* is this used? is this actually WKS? or SRV? */
return|return
name|LDNS_STATUS_NOT_IMPL
return|;
block|}
end_decl_stmt

begin_function
specifier|static
name|int
name|loc_parse_cm
parameter_list|(
name|char
modifier|*
name|my_str
parameter_list|,
name|char
modifier|*
modifier|*
name|endstr
parameter_list|,
name|uint8_t
modifier|*
name|m
parameter_list|,
name|uint8_t
modifier|*
name|e
parameter_list|)
block|{
comment|/* read<digits>[.<digits>][mM] */
comment|/* into mantissa exponent format for LOC type */
name|uint32_t
name|meters
init|=
literal|0
decl_stmt|,
name|cm
init|=
literal|0
decl_stmt|,
name|val
decl_stmt|;
while|while
condition|(
name|isblank
argument_list|(
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|my_str
operator|++
expr_stmt|;
block|}
name|meters
operator|=
operator|(
name|uint32_t
operator|)
name|strtol
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|my_str
operator|==
literal|'.'
condition|)
block|{
name|my_str
operator|++
expr_stmt|;
name|cm
operator|=
operator|(
name|uint32_t
operator|)
name|strtol
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|meters
operator|>=
literal|1
condition|)
block|{
operator|*
name|e
operator|=
literal|2
expr_stmt|;
name|val
operator|=
name|meters
expr_stmt|;
block|}
else|else
block|{
operator|*
name|e
operator|=
literal|0
expr_stmt|;
name|val
operator|=
name|cm
expr_stmt|;
block|}
while|while
condition|(
name|val
operator|>=
literal|10
condition|)
block|{
operator|(
operator|*
name|e
operator|)
operator|++
expr_stmt|;
name|val
operator|/=
literal|10
expr_stmt|;
block|}
operator|*
name|m
operator|=
operator|(
name|uint8_t
operator|)
name|val
expr_stmt|;
if|if
condition|(
operator|*
name|e
operator|>
literal|9
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|*
name|my_str
operator|==
literal|'m'
operator|||
operator|*
name|my_str
operator|==
literal|'M'
condition|)
block|{
name|my_str
operator|++
expr_stmt|;
block|}
operator|*
name|endstr
operator|=
name|my_str
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_loc
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint32_t
name|latitude
init|=
literal|0
decl_stmt|;
name|uint32_t
name|longitude
init|=
literal|0
decl_stmt|;
name|uint32_t
name|altitude
init|=
literal|0
decl_stmt|;
name|uint8_t
modifier|*
name|data
decl_stmt|;
name|uint32_t
name|equator
init|=
operator|(
name|uint32_t
operator|)
name|ldns_power
argument_list|(
literal|2
argument_list|,
literal|31
argument_list|)
decl_stmt|;
name|uint32_t
name|h
init|=
literal|0
decl_stmt|;
name|uint32_t
name|m
init|=
literal|0
decl_stmt|;
name|uint8_t
name|size_b
init|=
literal|1
decl_stmt|,
name|size_e
init|=
literal|2
decl_stmt|;
name|uint8_t
name|horiz_pre_b
init|=
literal|1
decl_stmt|,
name|horiz_pre_e
init|=
literal|6
decl_stmt|;
name|uint8_t
name|vert_pre_b
init|=
literal|1
decl_stmt|,
name|vert_pre_e
init|=
literal|3
decl_stmt|;
name|double
name|s
init|=
literal|0.0
decl_stmt|;
name|bool
name|northerness
decl_stmt|;
name|bool
name|easterness
decl_stmt|;
name|char
modifier|*
name|my_str
init|=
operator|(
name|char
operator|*
operator|)
name|str
decl_stmt|;
comment|/* only support version 0 */
if|if
condition|(
name|isdigit
argument_list|(
operator|(
name|int
operator|)
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|h
operator|=
operator|(
name|uint32_t
operator|)
name|strtol
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
else|else
block|{
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
while|while
condition|(
name|isblank
argument_list|(
operator|(
name|int
operator|)
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|my_str
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|isdigit
argument_list|(
operator|(
name|int
operator|)
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|m
operator|=
operator|(
name|uint32_t
operator|)
name|strtol
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|my_str
operator|==
literal|'N'
operator|||
operator|*
name|my_str
operator|==
literal|'S'
condition|)
block|{
goto|goto
name|north
goto|;
block|}
else|else
block|{
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
while|while
condition|(
name|isblank
argument_list|(
operator|(
name|int
operator|)
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|my_str
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|isdigit
argument_list|(
operator|(
name|int
operator|)
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|s
operator|=
name|strtod
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|)
expr_stmt|;
block|}
name|north
label|:
while|while
condition|(
name|isblank
argument_list|(
operator|(
name|int
operator|)
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|my_str
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|my_str
operator|==
literal|'N'
condition|)
block|{
name|northerness
operator|=
name|true
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|my_str
operator|==
literal|'S'
condition|)
block|{
name|northerness
operator|=
name|false
expr_stmt|;
block|}
else|else
block|{
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
name|my_str
operator|++
expr_stmt|;
comment|/* store number */
name|s
operator|=
literal|1000.0
operator|*
name|s
expr_stmt|;
comment|/* add a little to make floor in conversion a round */
name|s
operator|+=
literal|0.0005
expr_stmt|;
name|latitude
operator|=
operator|(
name|uint32_t
operator|)
name|s
expr_stmt|;
name|latitude
operator|+=
literal|1000
operator|*
literal|60
operator|*
name|m
expr_stmt|;
name|latitude
operator|+=
literal|1000
operator|*
literal|60
operator|*
literal|60
operator|*
name|h
expr_stmt|;
if|if
condition|(
name|northerness
condition|)
block|{
name|latitude
operator|=
name|equator
operator|+
name|latitude
expr_stmt|;
block|}
else|else
block|{
name|latitude
operator|=
name|equator
operator|-
name|latitude
expr_stmt|;
block|}
while|while
condition|(
name|isblank
argument_list|(
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|my_str
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|isdigit
argument_list|(
operator|(
name|int
operator|)
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|h
operator|=
operator|(
name|uint32_t
operator|)
name|strtol
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
else|else
block|{
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
while|while
condition|(
name|isblank
argument_list|(
operator|(
name|int
operator|)
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|my_str
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|isdigit
argument_list|(
operator|(
name|int
operator|)
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|m
operator|=
operator|(
name|uint32_t
operator|)
name|strtol
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|my_str
operator|==
literal|'E'
operator|||
operator|*
name|my_str
operator|==
literal|'W'
condition|)
block|{
goto|goto
name|east
goto|;
block|}
else|else
block|{
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
while|while
condition|(
name|isblank
argument_list|(
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|my_str
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|isdigit
argument_list|(
operator|(
name|int
operator|)
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|s
operator|=
name|strtod
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|)
expr_stmt|;
block|}
name|east
label|:
while|while
condition|(
name|isblank
argument_list|(
operator|*
name|my_str
argument_list|)
condition|)
block|{
name|my_str
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|my_str
operator|==
literal|'E'
condition|)
block|{
name|easterness
operator|=
name|true
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|my_str
operator|==
literal|'W'
condition|)
block|{
name|easterness
operator|=
name|false
expr_stmt|;
block|}
else|else
block|{
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
name|my_str
operator|++
expr_stmt|;
comment|/* store number */
name|s
operator|*=
literal|1000.0
expr_stmt|;
comment|/* add a little to make floor in conversion a round */
name|s
operator|+=
literal|0.0005
expr_stmt|;
name|longitude
operator|=
operator|(
name|uint32_t
operator|)
name|s
expr_stmt|;
name|longitude
operator|+=
literal|1000
operator|*
literal|60
operator|*
name|m
expr_stmt|;
name|longitude
operator|+=
literal|1000
operator|*
literal|60
operator|*
literal|60
operator|*
name|h
expr_stmt|;
if|if
condition|(
name|easterness
condition|)
block|{
name|longitude
operator|+=
name|equator
expr_stmt|;
block|}
else|else
block|{
name|longitude
operator|=
name|equator
operator|-
name|longitude
expr_stmt|;
block|}
name|altitude
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|strtod
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|)
operator|*
literal|100.0
operator|+
literal|10000000.0
operator|+
literal|0.5
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|my_str
operator|==
literal|'m'
operator|||
operator|*
name|my_str
operator|==
literal|'M'
condition|)
block|{
name|my_str
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|strlen
argument_list|(
name|my_str
argument_list|)
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|loc_parse_cm
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|,
operator|&
name|size_b
argument_list|,
operator|&
name|size_e
argument_list|)
condition|)
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
if|if
condition|(
name|strlen
argument_list|(
name|my_str
argument_list|)
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|loc_parse_cm
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|,
operator|&
name|horiz_pre_b
argument_list|,
operator|&
name|horiz_pre_e
argument_list|)
condition|)
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
if|if
condition|(
name|strlen
argument_list|(
name|my_str
argument_list|)
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|loc_parse_cm
argument_list|(
name|my_str
argument_list|,
operator|&
name|my_str
argument_list|,
operator|&
name|vert_pre_b
argument_list|,
operator|&
name|vert_pre_e
argument_list|)
condition|)
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
name|data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|data
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|data
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|data
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|data
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|size_b
operator|<<
literal|4
operator|)
operator|&
literal|0xf0
operator|)
operator||
operator|(
name|size_e
operator|&
literal|0x0f
operator|)
expr_stmt|;
name|data
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|horiz_pre_b
operator|<<
literal|4
operator|)
operator|&
literal|0xf0
operator|)
operator||
operator|(
name|horiz_pre_e
operator|&
literal|0x0f
operator|)
expr_stmt|;
name|data
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|vert_pre_b
operator|<<
literal|4
operator|)
operator|&
literal|0xf0
operator|)
operator||
operator|(
name|vert_pre_e
operator|&
literal|0x0f
operator|)
expr_stmt|;
name|ldns_write_uint32
argument_list|(
name|data
operator|+
literal|4
argument_list|,
name|latitude
argument_list|)
expr_stmt|;
name|ldns_write_uint32
argument_list|(
name|data
operator|+
literal|8
argument_list|,
name|longitude
argument_list|)
expr_stmt|;
name|ldns_write_uint32
argument_list|(
name|data
operator|+
literal|12
argument_list|,
name|altitude
argument_list|)
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_LOC
argument_list|,
literal|16
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_wks
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint8_t
modifier|*
name|bitmap
init|=
name|NULL
decl_stmt|;
name|uint8_t
modifier|*
name|data
decl_stmt|;
name|int
name|bm_len
init|=
literal|0
decl_stmt|;
name|struct
name|protoent
modifier|*
name|proto
init|=
name|NULL
decl_stmt|;
name|struct
name|servent
modifier|*
name|serv
init|=
name|NULL
decl_stmt|;
name|int
name|serv_port
decl_stmt|;
name|ldns_buffer
modifier|*
name|str_buf
decl_stmt|;
name|char
modifier|*
name|proto_str
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|token
decl_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|str
argument_list|)
operator|==
literal|0
condition|)
name|token
operator|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
literal|50
argument_list|)
expr_stmt|;
else|else
name|token
operator|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|token
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
name|str_buf
operator|=
name|LDNS_MALLOC
argument_list|(
name|ldns_buffer
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|str_buf
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|ldns_buffer_new_frm_data
argument_list|(
name|str_buf
argument_list|,
operator|(
name|char
operator|*
operator|)
name|str
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_buffer_status
argument_list|(
name|str_buf
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
while|while
condition|(
name|ldns_bget_token
argument_list|(
name|str_buf
argument_list|,
name|token
argument_list|,
literal|"\t\n "
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|proto_str
condition|)
block|{
name|proto_str
operator|=
name|strdup
argument_list|(
name|token
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|proto_str
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|bitmap
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
block|}
else|else
block|{
name|serv
operator|=
name|getservbyname
argument_list|(
name|token
argument_list|,
name|proto_str
argument_list|)
expr_stmt|;
if|if
condition|(
name|serv
condition|)
block|{
name|serv_port
operator|=
operator|(
name|int
operator|)
name|ntohs
argument_list|(
operator|(
name|uint16_t
operator|)
name|serv
operator|->
name|s_port
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|serv_port
operator|=
name|atoi
argument_list|(
name|token
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|serv_port
operator|/
literal|8
operator|>=
name|bm_len
condition|)
block|{
name|uint8_t
modifier|*
name|b2
init|=
name|LDNS_XREALLOC
argument_list|(
name|bitmap
argument_list|,
name|uint8_t
argument_list|,
operator|(
name|serv_port
operator|/
literal|8
operator|)
operator|+
literal|1
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|b2
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|bitmap
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|proto_str
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
name|bitmap
operator|=
name|b2
expr_stmt|;
comment|/* set to zero to be sure */
for|for
control|(
init|;
name|bm_len
operator|<=
name|serv_port
operator|/
literal|8
condition|;
name|bm_len
operator|++
control|)
block|{
name|bitmap
index|[
name|bm_len
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
name|ldns_set_bit
argument_list|(
name|bitmap
operator|+
operator|(
name|serv_port
operator|/
literal|8
operator|)
argument_list|,
literal|7
operator|-
operator|(
name|serv_port
operator|%
literal|8
operator|)
argument_list|,
name|true
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|proto_str
operator|||
operator|!
name|bitmap
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|bitmap
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|proto_str
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
name|data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|bm_len
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|data
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|bitmap
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|proto_str
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
if|if
condition|(
name|proto_str
condition|)
name|proto
operator|=
name|getprotobyname
argument_list|(
name|proto_str
argument_list|)
expr_stmt|;
if|if
condition|(
name|proto
condition|)
block|{
name|data
index|[
literal|0
index|]
operator|=
operator|(
name|uint8_t
operator|)
name|proto
operator|->
name|p_proto
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|proto_str
condition|)
block|{
name|data
index|[
literal|0
index|]
operator|=
operator|(
name|uint8_t
operator|)
name|atoi
argument_list|(
name|proto_str
argument_list|)
expr_stmt|;
block|}
name|memcpy
argument_list|(
name|data
operator|+
literal|1
argument_list|,
name|bitmap
argument_list|,
operator|(
name|size_t
operator|)
name|bm_len
argument_list|)
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_WKS
argument_list|,
call|(
name|uint16_t
call|)
argument_list|(
name|bm_len
operator|+
literal|1
argument_list|)
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|bitmap
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|proto_str
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|HAVE_ENDSERVENT
name|endservent
argument_list|()
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|HAVE_ENDPROTOENT
name|endprotoent
argument_list|()
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
operator|*
name|rd
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
return|return
name|LDNS_STATUS_OK
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_nsap
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|size_t
name|len
decl_stmt|,
name|i
decl_stmt|;
name|char
modifier|*
name|nsap_str
init|=
operator|(
name|char
operator|*
operator|)
name|str
decl_stmt|;
comment|/* just a hex string with optional dots? */
if|if
condition|(
name|str
index|[
literal|0
index|]
operator|!=
literal|'0'
operator|||
name|str
index|[
literal|1
index|]
operator|!=
literal|'x'
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
else|else
block|{
name|len
operator|=
name|strlen
argument_list|(
name|str
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|nsap_str
index|[
name|i
index|]
operator|==
literal|'.'
condition|)
name|nsap_str
index|[
name|i
index|]
operator|=
literal|' '
expr_stmt|;
block|}
return|return
name|ldns_str2rdf_hex
argument_list|(
name|rd
argument_list|,
name|str
operator|+
literal|2
argument_list|)
return|;
block|}
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_atma
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|size_t
name|len
decl_stmt|,
name|i
decl_stmt|;
name|char
modifier|*
name|atma_str
init|=
operator|(
name|char
operator|*
operator|)
name|str
decl_stmt|;
name|ldns_status
name|status
decl_stmt|;
comment|/* just a hex string with optional dots? */
name|len
operator|=
name|strlen
argument_list|(
name|str
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|atma_str
index|[
name|i
index|]
operator|==
literal|'.'
condition|)
name|atma_str
index|[
name|i
index|]
operator|=
literal|' '
expr_stmt|;
block|}
name|status
operator|=
name|ldns_str2rdf_hex
argument_list|(
name|rd
argument_list|,
name|str
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
empty_stmt|;
comment|/* probably in e.164 format than */
block|}
return|return
name|status
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_ipseckey
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint8_t
name|precedence
init|=
literal|0
decl_stmt|;
name|uint8_t
name|gateway_type
init|=
literal|0
decl_stmt|;
name|uint8_t
name|algorithm
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|gateway
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|publickey
init|=
name|NULL
decl_stmt|;
name|uint8_t
modifier|*
name|data
decl_stmt|;
name|ldns_buffer
modifier|*
name|str_buf
decl_stmt|;
name|char
modifier|*
name|token
decl_stmt|;
name|int
name|token_count
init|=
literal|0
decl_stmt|;
name|int
name|ipseckey_len
init|=
literal|0
decl_stmt|;
name|ldns_rdf
modifier|*
name|gateway_rdf
init|=
name|NULL
decl_stmt|;
name|ldns_rdf
modifier|*
name|publickey_rdf
init|=
name|NULL
decl_stmt|;
name|ldns_status
name|status
init|=
name|LDNS_STATUS_OK
decl_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|str
argument_list|)
operator|==
literal|0
condition|)
name|token
operator|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
literal|256
argument_list|)
expr_stmt|;
else|else
name|token
operator|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|token
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
name|str_buf
operator|=
name|LDNS_MALLOC
argument_list|(
name|ldns_buffer
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|str_buf
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|ldns_buffer_new_frm_data
argument_list|(
name|str_buf
argument_list|,
operator|(
name|char
operator|*
operator|)
name|str
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_buffer_status
argument_list|(
name|str_buf
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
while|while
condition|(
name|ldns_bget_token
argument_list|(
name|str_buf
argument_list|,
name|token
argument_list|,
literal|"\t\n "
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
operator|>
literal|0
condition|)
block|{
switch|switch
condition|(
name|token_count
condition|)
block|{
case|case
literal|0
case|:
name|precedence
operator|=
operator|(
name|uint8_t
operator|)
name|atoi
argument_list|(
name|token
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|gateway_type
operator|=
operator|(
name|uint8_t
operator|)
name|atoi
argument_list|(
name|token
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|algorithm
operator|=
operator|(
name|uint8_t
operator|)
name|atoi
argument_list|(
name|token
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|gateway
operator|=
name|strdup
argument_list|(
name|token
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gateway
operator|||
operator|(
name|gateway_type
operator|==
literal|0
operator|&&
operator|(
name|token
index|[
literal|0
index|]
operator|!=
literal|'.'
operator|||
name|token
index|[
literal|1
index|]
operator|!=
literal|'\0'
operator|)
operator|)
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|gateway
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
break|break;
case|case
literal|4
case|:
name|publickey
operator|=
name|strdup
argument_list|(
name|token
argument_list|)
expr_stmt|;
break|break;
default|default:
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
break|break;
block|}
name|token_count
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|gateway
operator|||
operator|!
name|publickey
condition|)
block|{
if|if
condition|(
name|gateway
condition|)
name|LDNS_FREE
argument_list|(
name|gateway
argument_list|)
expr_stmt|;
if|if
condition|(
name|publickey
condition|)
name|LDNS_FREE
argument_list|(
name|publickey
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
if|if
condition|(
name|gateway_type
operator|==
literal|1
condition|)
block|{
name|status
operator|=
name|ldns_str2rdf_a
argument_list|(
operator|&
name|gateway_rdf
argument_list|,
name|gateway
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|gateway_type
operator|==
literal|2
condition|)
block|{
name|status
operator|=
name|ldns_str2rdf_aaaa
argument_list|(
operator|&
name|gateway_rdf
argument_list|,
name|gateway
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|gateway_type
operator|==
literal|3
condition|)
block|{
name|status
operator|=
name|ldns_str2rdf_dname
argument_list|(
operator|&
name|gateway_rdf
argument_list|,
name|gateway
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
if|if
condition|(
name|gateway
condition|)
name|LDNS_FREE
argument_list|(
name|gateway
argument_list|)
expr_stmt|;
if|if
condition|(
name|publickey
condition|)
name|LDNS_FREE
argument_list|(
name|publickey
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
name|status
operator|=
name|ldns_str2rdf_b64
argument_list|(
operator|&
name|publickey_rdf
argument_list|,
name|publickey
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
if|if
condition|(
name|gateway
condition|)
name|LDNS_FREE
argument_list|(
name|gateway
argument_list|)
expr_stmt|;
if|if
condition|(
name|publickey
condition|)
name|LDNS_FREE
argument_list|(
name|publickey
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|gateway_rdf
condition|)
name|ldns_rdf_free
argument_list|(
name|gateway_rdf
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
comment|/* now copy all into one ipseckey rdf */
if|if
condition|(
name|gateway_type
condition|)
name|ipseckey_len
operator|=
literal|3
operator|+
operator|(
name|int
operator|)
name|ldns_rdf_size
argument_list|(
name|gateway_rdf
argument_list|)
operator|+
operator|(
name|int
operator|)
name|ldns_rdf_size
argument_list|(
name|publickey_rdf
argument_list|)
expr_stmt|;
else|else
name|ipseckey_len
operator|=
literal|3
operator|+
operator|(
name|int
operator|)
name|ldns_rdf_size
argument_list|(
name|publickey_rdf
argument_list|)
expr_stmt|;
name|data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|ipseckey_len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|data
condition|)
block|{
if|if
condition|(
name|gateway
condition|)
name|LDNS_FREE
argument_list|(
name|gateway
argument_list|)
expr_stmt|;
if|if
condition|(
name|publickey
condition|)
name|LDNS_FREE
argument_list|(
name|publickey
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|gateway_rdf
condition|)
name|ldns_rdf_free
argument_list|(
name|gateway_rdf
argument_list|)
expr_stmt|;
if|if
condition|(
name|publickey_rdf
condition|)
name|ldns_rdf_free
argument_list|(
name|publickey_rdf
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|data
index|[
literal|0
index|]
operator|=
name|precedence
expr_stmt|;
name|data
index|[
literal|1
index|]
operator|=
name|gateway_type
expr_stmt|;
name|data
index|[
literal|2
index|]
operator|=
name|algorithm
expr_stmt|;
if|if
condition|(
name|gateway_type
condition|)
block|{
name|memcpy
argument_list|(
name|data
operator|+
literal|3
argument_list|,
name|ldns_rdf_data
argument_list|(
name|gateway_rdf
argument_list|)
argument_list|,
name|ldns_rdf_size
argument_list|(
name|gateway_rdf
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|data
operator|+
literal|3
operator|+
name|ldns_rdf_size
argument_list|(
name|gateway_rdf
argument_list|)
argument_list|,
name|ldns_rdf_data
argument_list|(
name|publickey_rdf
argument_list|)
argument_list|,
name|ldns_rdf_size
argument_list|(
name|publickey_rdf
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|memcpy
argument_list|(
name|data
operator|+
literal|3
argument_list|,
name|ldns_rdf_data
argument_list|(
name|publickey_rdf
argument_list|)
argument_list|,
name|ldns_rdf_size
argument_list|(
name|publickey_rdf
argument_list|)
argument_list|)
expr_stmt|;
block|}
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_IPSECKEY
argument_list|,
operator|(
name|uint16_t
operator|)
name|ipseckey_len
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|gateway
condition|)
name|LDNS_FREE
argument_list|(
name|gateway
argument_list|)
expr_stmt|;
if|if
condition|(
name|publickey
condition|)
name|LDNS_FREE
argument_list|(
name|publickey
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|str_buf
argument_list|)
expr_stmt|;
name|ldns_rdf_free
argument_list|(
name|gateway_rdf
argument_list|)
expr_stmt|;
name|ldns_rdf_free
argument_list|(
name|publickey_rdf
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|rd
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
return|return
name|LDNS_STATUS_OK
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_ilnp64
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|unsigned
name|int
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|;
name|uint16_t
name|shorts
index|[
literal|4
index|]
decl_stmt|;
name|int
name|l
decl_stmt|;
if|if
condition|(
name|sscanf
argument_list|(
name|str
argument_list|,
literal|"%4x:%4x:%4x:%4x%n"
argument_list|,
operator|&
name|a
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|d
argument_list|,
operator|&
name|l
argument_list|)
operator|!=
literal|4
operator|||
name|l
operator|!=
operator|(
name|int
operator|)
name|strlen
argument_list|(
name|str
argument_list|)
operator|||
comment|/* more data to read */
name|strpbrk
argument_list|(
name|str
argument_list|,
literal|"+-"
argument_list|)
comment|/* signed hexes */
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_ILNP64
return|;
block|}
else|else
block|{
name|shorts
index|[
literal|0
index|]
operator|=
name|htons
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|shorts
index|[
literal|1
index|]
operator|=
name|htons
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|shorts
index|[
literal|2
index|]
operator|=
name|htons
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|shorts
index|[
literal|3
index|]
operator|=
name|htons
argument_list|(
name|d
argument_list|)
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_ILNP64
argument_list|,
literal|4
operator|*
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
operator|&
name|shorts
argument_list|)
expr_stmt|;
block|}
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_eui48
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|unsigned
name|int
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|,
name|e
decl_stmt|,
name|f
decl_stmt|;
name|uint8_t
name|bytes
index|[
literal|6
index|]
decl_stmt|;
name|int
name|l
decl_stmt|;
if|if
condition|(
name|sscanf
argument_list|(
name|str
argument_list|,
literal|"%2x-%2x-%2x-%2x-%2x-%2x%n"
argument_list|,
operator|&
name|a
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|d
argument_list|,
operator|&
name|e
argument_list|,
operator|&
name|f
argument_list|,
operator|&
name|l
argument_list|)
operator|!=
literal|6
operator|||
name|l
operator|!=
operator|(
name|int
operator|)
name|strlen
argument_list|(
name|str
argument_list|)
operator|||
comment|/* more data to read */
name|strpbrk
argument_list|(
name|str
argument_list|,
literal|"+-"
argument_list|)
comment|/* signed hexes */
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_EUI48
return|;
block|}
else|else
block|{
name|bytes
index|[
literal|0
index|]
operator|=
name|a
expr_stmt|;
name|bytes
index|[
literal|1
index|]
operator|=
name|b
expr_stmt|;
name|bytes
index|[
literal|2
index|]
operator|=
name|c
expr_stmt|;
name|bytes
index|[
literal|3
index|]
operator|=
name|d
expr_stmt|;
name|bytes
index|[
literal|4
index|]
operator|=
name|e
expr_stmt|;
name|bytes
index|[
literal|5
index|]
operator|=
name|f
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_EUI48
argument_list|,
literal|6
argument_list|,
operator|&
name|bytes
argument_list|)
expr_stmt|;
block|}
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_eui64
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|unsigned
name|int
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|,
name|e
decl_stmt|,
name|f
decl_stmt|,
name|g
decl_stmt|,
name|h
decl_stmt|;
name|uint8_t
name|bytes
index|[
literal|8
index|]
decl_stmt|;
name|int
name|l
decl_stmt|;
if|if
condition|(
name|sscanf
argument_list|(
name|str
argument_list|,
literal|"%2x-%2x-%2x-%2x-%2x-%2x-%2x-%2x%n"
argument_list|,
operator|&
name|a
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|d
argument_list|,
operator|&
name|e
argument_list|,
operator|&
name|f
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|h
argument_list|,
operator|&
name|l
argument_list|)
operator|!=
literal|8
operator|||
name|l
operator|!=
operator|(
name|int
operator|)
name|strlen
argument_list|(
name|str
argument_list|)
operator|||
comment|/* more data to read */
name|strpbrk
argument_list|(
name|str
argument_list|,
literal|"+-"
argument_list|)
comment|/* signed hexes */
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_EUI64
return|;
block|}
else|else
block|{
name|bytes
index|[
literal|0
index|]
operator|=
name|a
expr_stmt|;
name|bytes
index|[
literal|1
index|]
operator|=
name|b
expr_stmt|;
name|bytes
index|[
literal|2
index|]
operator|=
name|c
expr_stmt|;
name|bytes
index|[
literal|3
index|]
operator|=
name|d
expr_stmt|;
name|bytes
index|[
literal|4
index|]
operator|=
name|e
expr_stmt|;
name|bytes
index|[
literal|5
index|]
operator|=
name|f
expr_stmt|;
name|bytes
index|[
literal|6
index|]
operator|=
name|g
expr_stmt|;
name|bytes
index|[
literal|7
index|]
operator|=
name|h
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_EUI64
argument_list|,
literal|8
argument_list|,
operator|&
name|bytes
argument_list|)
expr_stmt|;
block|}
return|return
operator|*
name|rd
condition|?
name|LDNS_STATUS_OK
else|:
name|LDNS_STATUS_MEM_ERR
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_tag
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint8_t
modifier|*
name|data
decl_stmt|;
specifier|const
name|char
modifier|*
name|ptr
decl_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|str
argument_list|)
operator|>
literal|255
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_TAG
return|;
block|}
for|for
control|(
name|ptr
operator|=
name|str
init|;
operator|*
name|ptr
condition|;
name|ptr
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|isalnum
argument_list|(
operator|*
name|ptr
argument_list|)
condition|)
block|{
return|return
name|LDNS_STATUS_INVALID_TAG
return|;
block|}
block|}
name|data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|data
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|data
index|[
literal|0
index|]
operator|=
name|strlen
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|data
operator|+
literal|1
argument_list|,
name|str
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|rd
operator|=
name|ldns_rdf_new
argument_list|(
name|LDNS_RDF_TYPE_TAG
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
operator|+
literal|1
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|rd
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
return|return
name|LDNS_STATUS_OK
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_long_str
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|uint8_t
modifier|*
name|data
decl_stmt|,
modifier|*
name|dp
decl_stmt|,
name|ch
init|=
literal|0
decl_stmt|;
name|size_t
name|length
decl_stmt|;
comment|/* Worst case space requirement. We'll realloc to actual size later. */
name|dp
operator|=
name|data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|data
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
comment|/* Fill data with parsed bytes */
while|while
condition|(
name|parse_char
argument_list|(
operator|&
name|ch
argument_list|,
operator|&
name|str
argument_list|)
condition|)
block|{
operator|*
name|dp
operator|++
operator|=
name|ch
expr_stmt|;
if|if
condition|(
name|dp
operator|-
name|data
operator|>
name|LDNS_MAX_RDFLEN
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_STR
return|;
block|}
block|}
if|if
condition|(
operator|!
name|str
condition|)
block|{
return|return
name|LDNS_STATUS_SYNTAX_BAD_ESCAPE
return|;
block|}
name|length
operator|=
call|(
name|size_t
call|)
argument_list|(
name|dp
operator|-
name|data
argument_list|)
expr_stmt|;
comment|/* Lose the overmeasure */
name|data
operator|=
name|LDNS_XREALLOC
argument_list|(
name|dp
operator|=
name|data
argument_list|,
name|uint8_t
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|data
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|dp
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
comment|/* Create rdf */
operator|*
name|rd
operator|=
name|ldns_rdf_new
argument_list|(
name|LDNS_RDF_TYPE_LONG_STR
argument_list|,
name|length
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|rd
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
return|return
name|LDNS_STATUS_OK
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_str2rdf_hip
parameter_list|(
name|ldns_rdf
modifier|*
modifier|*
name|rd
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|hit
init|=
name|strchr
argument_list|(
name|str
argument_list|,
literal|' '
argument_list|)
operator|+
literal|1
decl_stmt|;
specifier|const
name|char
modifier|*
name|pk
init|=
name|hit
operator|==
name|NULL
condition|?
name|NULL
else|:
name|strchr
argument_list|(
name|hit
argument_list|,
literal|' '
argument_list|)
operator|+
literal|1
decl_stmt|;
name|size_t
name|hit_size
init|=
name|hit
operator|==
name|NULL
condition|?
literal|0
else|:
name|pk
operator|==
name|NULL
condition|?
name|strlen
argument_list|(
name|hit
argument_list|)
else|:
call|(
name|size_t
call|)
argument_list|(
name|pk
operator|-
name|hit
argument_list|)
operator|-
literal|1
decl_stmt|;
name|size_t
name|pk_size
init|=
name|pk
operator|==
name|NULL
condition|?
literal|0
else|:
name|strlen
argument_list|(
name|pk
argument_list|)
decl_stmt|;
name|size_t
name|hit_wire_size
init|=
operator|(
name|hit_size
operator|+
literal|1
operator|)
operator|/
literal|2
decl_stmt|;
name|size_t
name|pk_wire_size
init|=
name|ldns_b64_pton_calculate_size
argument_list|(
name|pk_size
argument_list|)
decl_stmt|;
name|size_t
name|rdf_size
init|=
literal|4
operator|+
name|hit_wire_size
operator|+
name|pk_wire_size
decl_stmt|;
name|char
modifier|*
name|endptr
decl_stmt|;
comment|/* utility var for strtol usage */
name|int
name|algorithm
init|=
name|strtol
argument_list|(
name|str
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|uint8_t
modifier|*
name|data
decl_stmt|,
modifier|*
name|dp
decl_stmt|;
name|int
name|hi
decl_stmt|,
name|lo
decl_stmt|,
name|written
decl_stmt|;
if|if
condition|(
name|hit_size
operator|==
literal|0
operator|||
name|pk_size
operator|==
literal|0
operator|||
operator|(
name|hit_size
operator|+
literal|1
operator|)
operator|/
literal|2
operator|>
literal|255
operator|||
name|rdf_size
operator|>
name|LDNS_MAX_RDFLEN
operator|||
name|algorithm
operator|<
literal|0
operator|||
name|algorithm
operator|>
literal|255
operator|||
operator|(
name|errno
operator|!=
literal|0
operator|&&
name|algorithm
operator|==
literal|0
operator|)
comment|/* out of range */
operator|||
name|endptr
operator|==
name|str
comment|/* no digits    */
condition|)
block|{
return|return
name|LDNS_STATUS_SYNTAX_ERR
return|;
block|}
if|if
condition|(
operator|(
name|data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|rdf_size
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
comment|/* From RFC 5205 section 5. HIP RR Storage Format: 	 *************************************************  	0                   1                   2                   3 	0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 	|  HIT length   | PK algorithm  |          PK length            | 	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 	|                                                               | 	~                           HIT                                 ~ 	|                                                               | 	+                     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 	|                     |                                         | 	+-+-+-+-+-+-+-+-+-+-+-+                                         + 	|                           Public Key                          | 	~                                                               ~ 	|                                                               | 	+                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 	|                               |                               | 	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               + 	|                                                               | 	~                       Rendezvous Servers                      ~ 	|                                                               | 	+             +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 	|             | 	+-+-+-+-+-+-+-+                                                    */
name|data
index|[
literal|0
index|]
operator|=
operator|(
name|uint8_t
operator|)
name|hit_wire_size
expr_stmt|;
name|data
index|[
literal|1
index|]
operator|=
operator|(
name|uint8_t
operator|)
name|algorithm
expr_stmt|;
for|for
control|(
name|dp
operator|=
name|data
operator|+
literal|4
init|;
operator|*
name|hit
operator|&&
operator|*
name|hit
operator|!=
literal|' '
condition|;
name|dp
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|hi
operator|=
name|ldns_hexdigit_to_int
argument_list|(
operator|*
name|hit
operator|++
argument_list|)
operator|)
operator|==
operator|-
literal|1
operator|||
operator|(
name|lo
operator|=
name|ldns_hexdigit_to_int
argument_list|(
operator|*
name|hit
operator|++
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_HEX
return|;
block|}
operator|*
name|dp
operator|=
operator|(
name|uint8_t
operator|)
name|hi
operator|<<
literal|4
operator||
name|lo
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|written
operator|=
name|ldns_b64_pton
argument_list|(
name|pk
argument_list|,
name|dp
argument_list|,
name|pk_wire_size
argument_list|)
operator|)
operator|<=
literal|0
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_INVALID_B64
return|;
block|}
comment|/* Because ldns_b64_pton_calculate_size isn't always correct: 	 * (we have to fix it at some point) 	 */
name|pk_wire_size
operator|=
operator|(
name|uint16_t
operator|)
name|written
expr_stmt|;
name|ldns_write_uint16
argument_list|(
name|data
operator|+
literal|2
argument_list|,
name|pk_wire_size
argument_list|)
expr_stmt|;
name|rdf_size
operator|=
literal|4
operator|+
name|hit_wire_size
operator|+
name|pk_wire_size
expr_stmt|;
comment|/* Create rdf */
if|if
condition|(
operator|!
operator|(
operator|*
name|rd
operator|=
name|ldns_rdf_new
argument_list|(
name|LDNS_RDF_TYPE_HIP
argument_list|,
name|rdf_size
argument_list|,
name|data
argument_list|)
operator|)
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
return|return
name|LDNS_STATUS_OK
return|;
block|}
end_function

end_unit

