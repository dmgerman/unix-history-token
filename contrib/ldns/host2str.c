begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * host2str.c  *  * conversion routines from the host format  * to the presentation format (strings)  *  * a Net::DNS like library for C  *  * (c) NLnet Labs, 2004-2006  *  * See the file LICENSE for the license  */
end_comment

begin_include
include|#
directive|include
file|<ldns/config.h>
end_include

begin_include
include|#
directive|include
file|<ldns/ldns.h>
end_include

begin_include
include|#
directive|include
file|<limits.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SYS_SOCKET_H
end_ifdef

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_ARPA_INET_H
end_ifdef

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_NETDB_H
end_ifdef

begin_include
include|#
directive|include
file|<netdb.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|INET_ADDRSTRLEN
end_ifndef

begin_define
define|#
directive|define
name|INET_ADDRSTRLEN
value|16
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|INET6_ADDRSTRLEN
end_ifndef

begin_define
define|#
directive|define
name|INET6_ADDRSTRLEN
value|46
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* lookup tables for standard DNS stuff  */
end_comment

begin_comment
comment|/* Taken from RFC 2535, section 7.  */
end_comment

begin_decl_stmt
name|ldns_lookup_table
name|ldns_algorithms
index|[]
init|=
block|{
block|{
name|LDNS_RSAMD5
block|,
literal|"RSAMD5"
block|}
block|,
block|{
name|LDNS_DH
block|,
literal|"DH"
block|}
block|,
block|{
name|LDNS_DSA
block|,
literal|"DSA"
block|}
block|,
block|{
name|LDNS_ECC
block|,
literal|"ECC"
block|}
block|,
block|{
name|LDNS_RSASHA1
block|,
literal|"RSASHA1"
block|}
block|,
block|{
name|LDNS_DSA_NSEC3
block|,
literal|"DSA-NSEC3-SHA1"
block|}
block|,
block|{
name|LDNS_RSASHA1_NSEC3
block|,
literal|"RSASHA1-NSEC3-SHA1"
block|}
block|,
ifdef|#
directive|ifdef
name|USE_SHA2
block|{
name|LDNS_RSASHA256
block|,
literal|"RSASHA256"
block|}
block|,
block|{
name|LDNS_RSASHA512
block|,
literal|"RSASHA512"
block|}
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|USE_GOST
block|{
name|LDNS_ECC_GOST
block|,
literal|"ECC-GOST"
block|}
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|USE_ECDSA
block|{
name|LDNS_ECDSAP256SHA256
block|,
literal|"ECDSAP256SHA256"
block|}
block|,
block|{
name|LDNS_ECDSAP384SHA384
block|,
literal|"ECDSAP384SHA384"
block|}
block|,
endif|#
directive|endif
block|{
name|LDNS_INDIRECT
block|,
literal|"INDIRECT"
block|}
block|,
block|{
name|LDNS_PRIVATEDNS
block|,
literal|"PRIVATEDNS"
block|}
block|,
block|{
name|LDNS_PRIVATEOID
block|,
literal|"PRIVATEOID"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Taken from RFC 4398  */
end_comment

begin_decl_stmt
name|ldns_lookup_table
name|ldns_cert_algorithms
index|[]
init|=
block|{
block|{
name|LDNS_CERT_PKIX
block|,
literal|"PKIX"
block|}
block|,
block|{
name|LDNS_CERT_SPKI
block|,
literal|"SPKI"
block|}
block|,
block|{
name|LDNS_CERT_PGP
block|,
literal|"PGP"
block|}
block|,
block|{
name|LDNS_CERT_IPKIX
block|,
literal|"IPKIX"
block|}
block|,
block|{
name|LDNS_CERT_ISPKI
block|,
literal|"ISPKI"
block|}
block|,
block|{
name|LDNS_CERT_IPGP
block|,
literal|"IPGP"
block|}
block|,
block|{
name|LDNS_CERT_ACPKIX
block|,
literal|"ACPKIX"
block|}
block|,
block|{
name|LDNS_CERT_IACPKIX
block|,
literal|"IACPKIX"
block|}
block|,
block|{
name|LDNS_CERT_URI
block|,
literal|"URI"
block|}
block|,
block|{
name|LDNS_CERT_OID
block|,
literal|"OID"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* classes  */
end_comment

begin_decl_stmt
name|ldns_lookup_table
name|ldns_rr_classes
index|[]
init|=
block|{
block|{
name|LDNS_RR_CLASS_IN
block|,
literal|"IN"
block|}
block|,
block|{
name|LDNS_RR_CLASS_CH
block|,
literal|"CH"
block|}
block|,
block|{
name|LDNS_RR_CLASS_HS
block|,
literal|"HS"
block|}
block|,
block|{
name|LDNS_RR_CLASS_NONE
block|,
literal|"NONE"
block|}
block|,
block|{
name|LDNS_RR_CLASS_ANY
block|,
literal|"ANY"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* if these are used elsewhere */
end_comment

begin_decl_stmt
name|ldns_lookup_table
name|ldns_rcodes
index|[]
init|=
block|{
block|{
name|LDNS_RCODE_NOERROR
block|,
literal|"NOERROR"
block|}
block|,
block|{
name|LDNS_RCODE_FORMERR
block|,
literal|"FORMERR"
block|}
block|,
block|{
name|LDNS_RCODE_SERVFAIL
block|,
literal|"SERVFAIL"
block|}
block|,
block|{
name|LDNS_RCODE_NXDOMAIN
block|,
literal|"NXDOMAIN"
block|}
block|,
block|{
name|LDNS_RCODE_NOTIMPL
block|,
literal|"NOTIMPL"
block|}
block|,
block|{
name|LDNS_RCODE_REFUSED
block|,
literal|"REFUSED"
block|}
block|,
block|{
name|LDNS_RCODE_YXDOMAIN
block|,
literal|"YXDOMAIN"
block|}
block|,
block|{
name|LDNS_RCODE_YXRRSET
block|,
literal|"YXRRSET"
block|}
block|,
block|{
name|LDNS_RCODE_NXRRSET
block|,
literal|"NXRRSET"
block|}
block|,
block|{
name|LDNS_RCODE_NOTAUTH
block|,
literal|"NOTAUTH"
block|}
block|,
block|{
name|LDNS_RCODE_NOTZONE
block|,
literal|"NOTZONE"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|ldns_lookup_table
name|ldns_opcodes
index|[]
init|=
block|{
block|{
name|LDNS_PACKET_QUERY
block|,
literal|"QUERY"
block|}
block|,
block|{
name|LDNS_PACKET_IQUERY
block|,
literal|"IQUERY"
block|}
block|,
block|{
name|LDNS_PACKET_STATUS
block|,
literal|"STATUS"
block|}
block|,
block|{
name|LDNS_PACKET_NOTIFY
block|,
literal|"NOTIFY"
block|}
block|,
block|{
name|LDNS_PACKET_UPDATE
block|,
literal|"UPDATE"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|ldns_output_format
name|ldns_output_format_nocomments_record
init|=
block|{
literal|0
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|ldns_output_format
modifier|*
name|ldns_output_format_nocomments
init|=
operator|&
name|ldns_output_format_nocomments_record
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|ldns_output_format
name|ldns_output_format_onlykeyids_record
init|=
block|{
name|LDNS_COMMENT_KEY
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|ldns_output_format
modifier|*
name|ldns_output_format_onlykeyids
init|=
operator|&
name|ldns_output_format_onlykeyids_record
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|ldns_output_format
modifier|*
name|ldns_output_format_default
init|=
operator|&
name|ldns_output_format_onlykeyids_record
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|ldns_output_format
name|ldns_output_format_bubblebabble_record
init|=
block|{
name|LDNS_COMMENT_KEY
operator||
name|LDNS_COMMENT_BUBBLEBABBLE
operator||
name|LDNS_COMMENT_FLAGS
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|ldns_output_format
modifier|*
name|ldns_output_format_bubblebabble
init|=
operator|&
name|ldns_output_format_bubblebabble_record
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|bool
name|ldns_output_format_covers_type
parameter_list|(
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
name|ldns_rr_type
name|t
parameter_list|)
block|{
return|return
name|fmt
operator|&&
operator|(
name|fmt
operator|->
name|flags
operator|&
name|LDNS_FMT_RFC3597
operator|)
operator|&&
operator|(
operator|(
name|ldns_output_format_storage
operator|*
operator|)
name|fmt
operator|)
operator|->
name|bitmap
operator|&&
name|ldns_nsec_bitmap_covers_type
argument_list|(
operator|(
operator|(
name|ldns_output_format_storage
operator|*
operator|)
name|fmt
operator|)
operator|->
name|bitmap
argument_list|,
name|t
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_output_format_set_type
parameter_list|(
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
name|ldns_rr_type
name|t
parameter_list|)
block|{
name|ldns_output_format_storage
modifier|*
name|fmt_st
init|=
operator|(
name|ldns_output_format_storage
operator|*
operator|)
name|fmt
decl_stmt|;
name|ldns_status
name|s
decl_stmt|;
name|assert
argument_list|(
name|fmt
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_FMT_RFC3597
operator|)
condition|)
block|{
name|ldns_output_format_set
argument_list|(
name|fmt
argument_list|,
name|LDNS_FMT_RFC3597
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|fmt_st
operator|->
name|bitmap
condition|)
block|{
name|s
operator|=
name|ldns_rdf_bitmap_known_rr_types_space
argument_list|(
operator|&
name|fmt_st
operator|->
name|bitmap
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
return|return
name|s
return|;
block|}
block|}
return|return
name|ldns_nsec_bitmap_set_type
argument_list|(
name|fmt_st
operator|->
name|bitmap
argument_list|,
name|t
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_output_format_clear_type
parameter_list|(
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
name|ldns_rr_type
name|t
parameter_list|)
block|{
name|ldns_output_format_storage
modifier|*
name|fmt_st
init|=
operator|(
name|ldns_output_format_storage
operator|*
operator|)
name|fmt
decl_stmt|;
name|ldns_status
name|s
decl_stmt|;
name|assert
argument_list|(
name|fmt
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_FMT_RFC3597
operator|)
condition|)
block|{
name|ldns_output_format_set
argument_list|(
name|fmt
argument_list|,
name|LDNS_FMT_RFC3597
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|fmt_st
operator|->
name|bitmap
condition|)
block|{
name|s
operator|=
name|ldns_rdf_bitmap_known_rr_types
argument_list|(
operator|&
name|fmt_st
operator|->
name|bitmap
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
return|return
name|s
return|;
block|}
block|}
return|return
name|ldns_nsec_bitmap_clear_type
argument_list|(
name|fmt_st
operator|->
name|bitmap
argument_list|,
name|t
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_pkt_opcode2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
name|ldns_pkt_opcode
name|opcode
parameter_list|)
block|{
name|ldns_lookup_table
modifier|*
name|lt
init|=
name|ldns_lookup_by_id
argument_list|(
name|ldns_opcodes
argument_list|,
name|opcode
argument_list|)
decl_stmt|;
if|if
condition|(
name|lt
operator|&&
name|lt
operator|->
name|name
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"OPCODE%u"
argument_list|,
name|opcode
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_pkt_rcode2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
name|ldns_pkt_rcode
name|rcode
parameter_list|)
block|{
name|ldns_lookup_table
modifier|*
name|lt
init|=
name|ldns_lookup_by_id
argument_list|(
name|ldns_rcodes
argument_list|,
name|rcode
argument_list|)
decl_stmt|;
if|if
condition|(
name|lt
operator|&&
name|lt
operator|->
name|name
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"RCODE%u"
argument_list|,
name|rcode
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_algorithm2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
name|ldns_algorithm
name|algorithm
parameter_list|)
block|{
name|ldns_lookup_table
modifier|*
name|lt
init|=
name|ldns_lookup_by_id
argument_list|(
name|ldns_algorithms
argument_list|,
name|algorithm
argument_list|)
decl_stmt|;
if|if
condition|(
name|lt
operator|&&
name|lt
operator|->
name|name
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"ALG%u"
argument_list|,
name|algorithm
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_cert_algorithm2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
name|ldns_cert_algorithm
name|cert_algorithm
parameter_list|)
block|{
name|ldns_lookup_table
modifier|*
name|lt
init|=
name|ldns_lookup_by_id
argument_list|(
name|ldns_cert_algorithms
argument_list|,
name|cert_algorithm
argument_list|)
decl_stmt|;
if|if
condition|(
name|lt
operator|&&
name|lt
operator|->
name|name
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"CERT_ALG%u"
argument_list|,
name|cert_algorithm
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_pkt_opcode2str
parameter_list|(
name|ldns_pkt_opcode
name|opcode
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|ldns_buffer
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|ldns_buffer_new
argument_list|(
literal|12
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|buf
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|str
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|ldns_pkt_opcode2buffer_str
argument_list|(
name|buf
argument_list|,
name|opcode
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
name|str
operator|=
name|ldns_buffer_export2str
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_pkt_rcode2str
parameter_list|(
name|ldns_pkt_rcode
name|rcode
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|ldns_buffer
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|ldns_buffer_new
argument_list|(
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|buf
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|str
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|ldns_pkt_rcode2buffer_str
argument_list|(
name|buf
argument_list|,
name|rcode
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
name|str
operator|=
name|ldns_buffer_export2str
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_pkt_algorithm2str
parameter_list|(
name|ldns_algorithm
name|algorithm
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|ldns_buffer
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|ldns_buffer_new
argument_list|(
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|buf
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|str
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|ldns_algorithm2buffer_str
argument_list|(
name|buf
argument_list|,
name|algorithm
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
name|str
operator|=
name|ldns_buffer_export2str
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_pkt_cert_algorithm2str
parameter_list|(
name|ldns_cert_algorithm
name|cert_algorithm
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|ldns_buffer
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|ldns_buffer_new
argument_list|(
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|buf
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|str
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|ldns_cert_algorithm2buffer_str
argument_list|(
name|buf
argument_list|,
name|cert_algorithm
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
name|str
operator|=
name|ldns_buffer_export2str
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_comment
comment|/* do NOT pass compressed data here :p */
end_comment

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_dname
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|dname
parameter_list|)
block|{
comment|/* can we do with 1 pos var? or without at all? */
name|uint8_t
name|src_pos
init|=
literal|0
decl_stmt|;
name|uint8_t
name|len
decl_stmt|;
name|uint8_t
modifier|*
name|data
decl_stmt|;
name|uint8_t
name|i
decl_stmt|;
name|unsigned
name|char
name|c
decl_stmt|;
name|data
operator|=
operator|(
name|uint8_t
operator|*
operator|)
name|ldns_rdf_data
argument_list|(
name|dname
argument_list|)
expr_stmt|;
name|len
operator|=
name|data
index|[
name|src_pos
index|]
expr_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|dname
argument_list|)
operator|>
name|LDNS_MAX_DOMAINLEN
condition|)
block|{
comment|/* too large, return */
return|return
name|LDNS_STATUS_DOMAINNAME_OVERFLOW
return|;
block|}
comment|/* special case: root label */
if|if
condition|(
literal|1
operator|==
name|ldns_rdf_size
argument_list|(
name|dname
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
block|}
else|else
block|{
while|while
condition|(
operator|(
name|len
operator|>
literal|0
operator|)
operator|&&
name|src_pos
operator|<
name|ldns_rdf_size
argument_list|(
name|dname
argument_list|)
condition|)
block|{
name|src_pos
operator|++
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
comment|/* paranoia check for various 'strange' 				   characters in dnames 				*/
name|c
operator|=
operator|(
name|unsigned
name|char
operator|)
name|data
index|[
name|src_pos
index|]
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'.'
operator|||
name|c
operator|==
literal|';'
operator|||
name|c
operator|==
literal|'('
operator|||
name|c
operator|==
literal|')'
operator|||
name|c
operator|==
literal|'\\'
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\\%c"
argument_list|,
name|data
index|[
name|src_pos
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
operator|(
name|isascii
argument_list|(
name|c
argument_list|)
operator|&&
name|isgraph
argument_list|(
name|c
argument_list|)
operator|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\\%03u"
argument_list|,
name|data
index|[
name|src_pos
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%c"
argument_list|,
name|data
index|[
name|src_pos
index|]
argument_list|)
expr_stmt|;
block|}
name|src_pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|src_pos
operator|<
name|ldns_rdf_size
argument_list|(
name|dname
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
block|}
name|len
operator|=
name|data
index|[
name|src_pos
index|]
expr_stmt|;
block|}
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_int8
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|uint8_t
name|data
init|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|0
index|]
decl_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|data
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_int16
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|uint16_t
name|data
init|=
name|ldns_read_uint16
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
argument_list|)
decl_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|data
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_int32
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|uint32_t
name|data
init|=
name|ldns_read_uint32
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
argument_list|)
decl_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|data
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_time
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
comment|/* create a YYYYMMDDHHMMSS string if possible */
name|struct
name|tm
name|tm
decl_stmt|;
name|char
name|date_buf
index|[
literal|16
index|]
decl_stmt|;
name|memset
argument_list|(
operator|&
name|tm
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|tm
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_serial_arithmitics_gmtime_r
argument_list|(
name|ldns_rdf2native_int32
argument_list|(
name|rdf
argument_list|)
argument_list|,
name|time
argument_list|(
name|NULL
argument_list|)
argument_list|,
operator|&
name|tm
argument_list|)
operator|&&
name|strftime
argument_list|(
name|date_buf
argument_list|,
literal|15
argument_list|,
literal|"%Y%m%d%H%M%S"
argument_list|,
operator|&
name|tm
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|date_buf
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_a
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|char
name|str
index|[
name|INET_ADDRSTRLEN
index|]
decl_stmt|;
if|if
condition|(
name|inet_ntop
argument_list|(
name|AF_INET
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
argument_list|,
name|str
argument_list|,
name|INET_ADDRSTRLEN
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_aaaa
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|char
name|str
index|[
name|INET6_ADDRSTRLEN
index|]
decl_stmt|;
if|if
condition|(
name|inet_ntop
argument_list|(
name|AF_INET6
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
argument_list|,
name|str
argument_list|,
name|INET6_ADDRSTRLEN
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|ldns_characters2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
name|size_t
name|amount
parameter_list|,
specifier|const
name|uint8_t
modifier|*
name|characters
parameter_list|)
block|{
name|uint8_t
name|ch
decl_stmt|;
while|while
condition|(
name|amount
operator|>
literal|0
condition|)
block|{
name|ch
operator|=
operator|*
name|characters
operator|++
expr_stmt|;
if|if
condition|(
name|isprint
argument_list|(
operator|(
name|int
operator|)
name|ch
argument_list|)
operator|||
name|ch
operator|==
literal|'\t'
condition|)
block|{
if|if
condition|(
name|ch
operator|==
literal|'\"'
operator|||
name|ch
operator|==
literal|'\\'
condition|)
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\\%c"
argument_list|,
name|ch
argument_list|)
expr_stmt|;
else|else
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%c"
argument_list|,
name|ch
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\\%03u"
argument_list|,
operator|(
name|unsigned
operator|)
operator|(
name|uint8_t
operator|)
name|ch
argument_list|)
expr_stmt|;
block|}
name|amount
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
literal|1
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
if|if
condition|(
operator|(
name|int
operator|)
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
operator|(
name|int
operator|)
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|0
index|]
operator|+
literal|1
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
name|ldns_characters2buffer_str
argument_list|(
name|output
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|0
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_b64
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|size_t
name|size
init|=
name|ldns_b64_ntop_calculate_size
argument_list|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
argument_list|)
decl_stmt|;
name|char
modifier|*
name|b64
init|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
name|size
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|b64
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
if|if
condition|(
name|ldns_b64_ntop
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
argument_list|,
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
argument_list|,
name|b64
argument_list|,
name|size
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|b64
argument_list|)
expr_stmt|;
block|}
name|LDNS_FREE
argument_list|(
name|b64
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_b32_ext
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|size_t
name|size
decl_stmt|;
name|char
modifier|*
name|b32
decl_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|==
literal|0
condition|)
return|return
name|LDNS_STATUS_OK
return|;
comment|/* remove -1 for the b32-hash-len octet */
name|size
operator|=
name|ldns_b32_ntop_calculate_size
argument_list|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* add one for the end nul for the string */
name|b32
operator|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|b32
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
name|size
operator|=
operator|(
name|size_t
operator|)
name|ldns_b32_ntop_extended_hex
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
operator|+
literal|1
argument_list|,
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|-
literal|1
argument_list|,
name|b32
argument_list|,
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|>
literal|0
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|b32
argument_list|)
expr_stmt|;
block|}
name|LDNS_FREE
argument_list|(
name|b32
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_hex
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%02x"
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|ldns_status
name|ldns_rdf2buffer_str_type_fmt
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|uint16_t
name|data
init|=
name|ldns_read_uint16
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|ldns_output_format_covers_type
argument_list|(
name|fmt
argument_list|,
name|data
argument_list|)
operator|&&
name|ldns_rr_descript
argument_list|(
name|data
argument_list|)
operator|&&
name|ldns_rr_descript
argument_list|(
name|data
argument_list|)
operator|->
name|_name
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|ldns_rr_descript
argument_list|(
name|data
argument_list|)
operator|->
name|_name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"TYPE%u"
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_type
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
return|return
name|ldns_rdf2buffer_str_type_fmt
argument_list|(
name|output
argument_list|,
name|ldns_output_format_default
argument_list|,
name|rdf
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_class
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|uint16_t
name|data
init|=
name|ldns_read_uint16
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
argument_list|)
decl_stmt|;
name|ldns_lookup_table
modifier|*
name|lt
decl_stmt|;
name|lt
operator|=
name|ldns_lookup_by_id
argument_list|(
name|ldns_rr_classes
argument_list|,
operator|(
name|int
operator|)
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|lt
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\t%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\tCLASS%d"
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_cert_alg
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|uint16_t
name|data
init|=
name|ldns_read_uint16
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
argument_list|)
decl_stmt|;
name|ldns_lookup_table
modifier|*
name|lt
decl_stmt|;
name|lt
operator|=
name|ldns_lookup_by_id
argument_list|(
name|ldns_cert_algorithms
argument_list|,
operator|(
name|int
operator|)
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|lt
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%d"
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_alg
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
comment|/* don't use algorithm mnemonics in the presentation format 	   this kind of got sneaked into the rfc's */
name|uint8_t
name|data
init|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|0
index|]
decl_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%d"
argument_list|,
name|data
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|loc_cm_print
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
name|uint8_t
name|mantissa
parameter_list|,
name|uint8_t
name|exponent
parameter_list|)
block|{
name|uint8_t
name|i
decl_stmt|;
comment|/* is it 0.<two digits> ? */
if|if
condition|(
name|exponent
operator|<
literal|2
condition|)
block|{
if|if
condition|(
name|exponent
operator|==
literal|1
condition|)
name|mantissa
operator|*=
literal|10
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"0.%02ld"
argument_list|,
operator|(
name|long
operator|)
name|mantissa
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* always<digit><string of zeros> */
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%d"
argument_list|,
operator|(
name|int
operator|)
name|mantissa
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|exponent
operator|-
literal|2
condition|;
name|i
operator|++
control|)
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rr_type2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rr_type
name|type
parameter_list|)
block|{
specifier|const
name|ldns_rr_descriptor
modifier|*
name|descriptor
decl_stmt|;
name|descriptor
operator|=
name|ldns_rr_descript
argument_list|(
name|type
argument_list|)
expr_stmt|;
if|if
condition|(
name|descriptor
operator|&&
name|descriptor
operator|->
name|_name
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|descriptor
operator|->
name|_name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* exceptions for pseudotypes */
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|LDNS_RR_TYPE_IXFR
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"IXFR"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RR_TYPE_AXFR
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"AXFR"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RR_TYPE_MAILA
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"MAILA"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RR_TYPE_MAILB
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"MAILB"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RR_TYPE_ANY
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"ANY"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"TYPE%u"
argument_list|,
name|type
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_rr_type2str
parameter_list|(
specifier|const
name|ldns_rr_type
name|type
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|ldns_buffer
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|ldns_buffer_new
argument_list|(
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|buf
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|str
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|ldns_rr_type2buffer_str
argument_list|(
name|buf
argument_list|,
name|type
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
name|str
operator|=
name|ldns_buffer_export2str
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rr_class2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rr_class
name|klass
parameter_list|)
block|{
name|ldns_lookup_table
modifier|*
name|lt
decl_stmt|;
name|lt
operator|=
name|ldns_lookup_by_id
argument_list|(
name|ldns_rr_classes
argument_list|,
name|klass
argument_list|)
expr_stmt|;
if|if
condition|(
name|lt
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"CLASS%d"
argument_list|,
name|klass
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_rr_class2str
parameter_list|(
specifier|const
name|ldns_rr_class
name|klass
parameter_list|)
block|{
name|ldns_buffer
modifier|*
name|buf
decl_stmt|;
name|char
modifier|*
name|str
decl_stmt|;
name|buf
operator|=
name|ldns_buffer_new
argument_list|(
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|buf
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|str
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|ldns_rr_class2buffer_str
argument_list|(
name|buf
argument_list|,
name|klass
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
name|str
operator|=
name|ldns_buffer_export2str
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_loc
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
comment|/* we could do checking (ie degrees< 90 etc)? */
name|uint8_t
name|version
decl_stmt|;
name|uint8_t
name|size
decl_stmt|;
name|uint8_t
name|horizontal_precision
decl_stmt|;
name|uint8_t
name|vertical_precision
decl_stmt|;
name|uint32_t
name|longitude
decl_stmt|;
name|uint32_t
name|latitude
decl_stmt|;
name|uint32_t
name|altitude
decl_stmt|;
name|char
name|northerness
decl_stmt|;
name|char
name|easterness
decl_stmt|;
name|uint32_t
name|h
decl_stmt|;
name|uint32_t
name|m
decl_stmt|;
name|double
name|s
decl_stmt|;
name|uint32_t
name|equator
init|=
operator|(
name|uint32_t
operator|)
name|ldns_power
argument_list|(
literal|2
argument_list|,
literal|31
argument_list|)
decl_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
literal|1
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|version
operator|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|version
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
literal|16
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|size
operator|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|1
index|]
expr_stmt|;
name|horizontal_precision
operator|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|2
index|]
expr_stmt|;
name|vertical_precision
operator|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|3
index|]
expr_stmt|;
name|latitude
operator|=
name|ldns_read_uint32
argument_list|(
operator|&
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|longitude
operator|=
name|ldns_read_uint32
argument_list|(
operator|&
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
name|altitude
operator|=
name|ldns_read_uint32
argument_list|(
operator|&
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|latitude
operator|>
name|equator
condition|)
block|{
name|northerness
operator|=
literal|'N'
expr_stmt|;
name|latitude
operator|=
name|latitude
operator|-
name|equator
expr_stmt|;
block|}
else|else
block|{
name|northerness
operator|=
literal|'S'
expr_stmt|;
name|latitude
operator|=
name|equator
operator|-
name|latitude
expr_stmt|;
block|}
name|h
operator|=
name|latitude
operator|/
operator|(
literal|1000
operator|*
literal|60
operator|*
literal|60
operator|)
expr_stmt|;
name|latitude
operator|=
name|latitude
operator|%
operator|(
literal|1000
operator|*
literal|60
operator|*
literal|60
operator|)
expr_stmt|;
name|m
operator|=
name|latitude
operator|/
operator|(
literal|1000
operator|*
literal|60
operator|)
expr_stmt|;
name|latitude
operator|=
name|latitude
operator|%
operator|(
literal|1000
operator|*
literal|60
operator|)
expr_stmt|;
name|s
operator|=
operator|(
name|double
operator|)
name|latitude
operator|/
literal|1000.0
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%02u %02u %0.3f %c "
argument_list|,
name|h
argument_list|,
name|m
argument_list|,
name|s
argument_list|,
name|northerness
argument_list|)
expr_stmt|;
if|if
condition|(
name|longitude
operator|>
name|equator
condition|)
block|{
name|easterness
operator|=
literal|'E'
expr_stmt|;
name|longitude
operator|=
name|longitude
operator|-
name|equator
expr_stmt|;
block|}
else|else
block|{
name|easterness
operator|=
literal|'W'
expr_stmt|;
name|longitude
operator|=
name|equator
operator|-
name|longitude
expr_stmt|;
block|}
name|h
operator|=
name|longitude
operator|/
operator|(
literal|1000
operator|*
literal|60
operator|*
literal|60
operator|)
expr_stmt|;
name|longitude
operator|=
name|longitude
operator|%
operator|(
literal|1000
operator|*
literal|60
operator|*
literal|60
operator|)
expr_stmt|;
name|m
operator|=
name|longitude
operator|/
operator|(
literal|1000
operator|*
literal|60
operator|)
expr_stmt|;
name|longitude
operator|=
name|longitude
operator|%
operator|(
literal|1000
operator|*
literal|60
operator|)
expr_stmt|;
name|s
operator|=
operator|(
name|double
operator|)
name|longitude
operator|/
operator|(
literal|1000.0
operator|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%02u %02u %0.3f %c "
argument_list|,
name|h
argument_list|,
name|m
argument_list|,
name|s
argument_list|,
name|easterness
argument_list|)
expr_stmt|;
name|s
operator|=
operator|(
operator|(
name|double
operator|)
name|altitude
operator|)
operator|/
literal|100
expr_stmt|;
name|s
operator|-=
literal|100000
expr_stmt|;
if|if
condition|(
name|altitude
operator|%
literal|100
operator|!=
literal|0
condition|)
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%.2f"
argument_list|,
name|s
argument_list|)
expr_stmt|;
else|else
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%.0f"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"m "
argument_list|)
expr_stmt|;
name|loc_cm_print
argument_list|(
name|output
argument_list|,
operator|(
name|size
operator|&
literal|0xf0
operator|)
operator|>>
literal|4
argument_list|,
name|size
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"m "
argument_list|)
expr_stmt|;
name|loc_cm_print
argument_list|(
name|output
argument_list|,
operator|(
name|horizontal_precision
operator|&
literal|0xf0
operator|)
operator|>>
literal|4
argument_list|,
name|horizontal_precision
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"m "
argument_list|)
expr_stmt|;
name|loc_cm_print
argument_list|(
name|output
argument_list|,
operator|(
name|vertical_precision
operator|&
literal|0xf0
operator|)
operator|>>
literal|4
argument_list|,
name|vertical_precision
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"m"
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
else|else
block|{
return|return
name|ldns_rdf2buffer_str_hex
argument_list|(
name|output
argument_list|,
name|rdf
argument_list|)
return|;
block|}
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_unknown
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\\# %u "
argument_list|,
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ldns_rdf2buffer_str_hex
argument_list|(
name|output
argument_list|,
name|rdf
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_nsap
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"0x"
argument_list|)
expr_stmt|;
return|return
name|ldns_rdf2buffer_str_hex
argument_list|(
name|output
argument_list|,
name|rdf
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_atma
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
return|return
name|ldns_rdf2buffer_str_hex
argument_list|(
name|output
argument_list|,
name|rdf
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_wks
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
comment|/* protocol, followed by bitmap of services */
name|struct
name|protoent
modifier|*
name|protocol
decl_stmt|;
name|char
modifier|*
name|proto_name
init|=
name|NULL
decl_stmt|;
name|uint8_t
name|protocol_nr
decl_stmt|;
name|struct
name|servent
modifier|*
name|service
decl_stmt|;
name|uint16_t
name|current_service
decl_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
literal|1
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|protocol_nr
operator|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|0
index|]
expr_stmt|;
name|protocol
operator|=
name|getprotobynumber
argument_list|(
operator|(
name|int
operator|)
name|protocol_nr
argument_list|)
expr_stmt|;
if|if
condition|(
name|protocol
operator|&&
operator|(
name|protocol
operator|->
name|p_name
operator|!=
name|NULL
operator|)
condition|)
block|{
name|proto_name
operator|=
name|protocol
operator|->
name|p_name
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s "
argument_list|,
name|protocol
operator|->
name|p_name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%u "
argument_list|,
name|protocol_nr
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|HAVE_ENDPROTOENT
name|endprotoent
argument_list|()
expr_stmt|;
endif|#
directive|endif
for|for
control|(
name|current_service
operator|=
literal|0
init|;
name|current_service
operator|<
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|*
literal|7
condition|;
name|current_service
operator|++
control|)
block|{
if|if
condition|(
name|ldns_get_bit
argument_list|(
operator|&
operator|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|1
index|]
operator|)
argument_list|,
name|current_service
argument_list|)
condition|)
block|{
name|service
operator|=
name|getservbyport
argument_list|(
operator|(
name|int
operator|)
name|htons
argument_list|(
name|current_service
argument_list|)
argument_list|,
name|proto_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|service
operator|&&
name|service
operator|->
name|s_name
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s "
argument_list|,
name|service
operator|->
name|s_name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%u "
argument_list|,
name|current_service
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|HAVE_ENDSERVENT
name|endservent
argument_list|()
expr_stmt|;
endif|#
directive|endif
block|}
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|ldns_status
name|ldns_rdf2buffer_str_nsec_fmt
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
comment|/* Note: this code is duplicated in higher.c in 	 * ldns_nsec_type_check() function 	 */
name|uint8_t
name|window_block_nr
decl_stmt|;
name|uint8_t
name|bitmap_length
decl_stmt|;
name|uint16_t
name|type
decl_stmt|;
name|uint16_t
name|pos
init|=
literal|0
decl_stmt|;
name|uint16_t
name|bit_pos
decl_stmt|;
name|uint8_t
modifier|*
name|data
init|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
decl_stmt|;
while|while
condition|(
call|(
name|size_t
call|)
argument_list|(
name|pos
operator|+
literal|2
argument_list|)
operator|<
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
condition|)
block|{
name|window_block_nr
operator|=
name|data
index|[
name|pos
index|]
expr_stmt|;
name|bitmap_length
operator|=
name|data
index|[
name|pos
operator|+
literal|1
index|]
expr_stmt|;
name|pos
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
name|pos
operator|+
name|bitmap_length
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
for|for
control|(
name|bit_pos
operator|=
literal|0
init|;
name|bit_pos
operator|<
operator|(
name|bitmap_length
operator|)
operator|*
literal|8
condition|;
name|bit_pos
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|ldns_get_bit
argument_list|(
operator|&
name|data
index|[
name|pos
index|]
argument_list|,
name|bit_pos
argument_list|)
condition|)
block|{
continue|continue;
block|}
name|type
operator|=
literal|256
operator|*
operator|(
name|uint16_t
operator|)
name|window_block_nr
operator|+
name|bit_pos
expr_stmt|;
if|if
condition|(
operator|!
name|ldns_output_format_covers_type
argument_list|(
name|fmt
argument_list|,
name|type
argument_list|)
operator|&&
name|ldns_rr_descript
argument_list|(
name|type
argument_list|)
operator|&&
name|ldns_rr_descript
argument_list|(
name|type
argument_list|)
operator|->
name|_name
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s "
argument_list|,
name|ldns_rr_descript
argument_list|(
name|type
argument_list|)
operator|->
name|_name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"TYPE%u "
argument_list|,
name|type
argument_list|)
expr_stmt|;
block|}
block|}
name|pos
operator|+=
operator|(
name|uint16_t
operator|)
name|bitmap_length
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_nsec
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
return|return
name|ldns_rdf2buffer_str_nsec_fmt
argument_list|(
name|output
argument_list|,
name|ldns_output_format_default
argument_list|,
name|rdf
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_nsec3_salt
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|uint8_t
name|salt_length
decl_stmt|;
name|uint8_t
name|salt_pos
decl_stmt|;
name|uint8_t
modifier|*
name|data
init|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
decl_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
literal|1
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|salt_length
operator|=
name|data
index|[
literal|0
index|]
expr_stmt|;
comment|/* from now there are variable length entries so remember pos */
if|if
condition|(
name|salt_length
operator|==
literal|0
operator|||
operator|(
operator|(
name|size_t
operator|)
name|salt_length
operator|)
operator|+
literal|1
operator|>
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"- "
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|salt_pos
operator|=
literal|0
init|;
name|salt_pos
operator|<
name|salt_length
condition|;
name|salt_pos
operator|++
control|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%02x"
argument_list|,
name|data
index|[
literal|1
operator|+
name|salt_pos
index|]
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_period
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
comment|/* period is the number of seconds */
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|!=
literal|4
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%u"
argument_list|,
name|ldns_read_uint32
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_tsigtime
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
comment|/* tsigtime is 48 bits network order unsigned integer */
name|uint64_t
name|tsigtime
init|=
literal|0
decl_stmt|;
name|uint8_t
modifier|*
name|data
init|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
decl_stmt|;
name|uint64_t
name|d0
decl_stmt|,
name|d1
decl_stmt|,
name|d2
decl_stmt|,
name|d3
decl_stmt|,
name|d4
decl_stmt|,
name|d5
decl_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
literal|6
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|d0
operator|=
name|data
index|[
literal|0
index|]
expr_stmt|;
comment|/* cast to uint64 for shift operations */
name|d1
operator|=
name|data
index|[
literal|1
index|]
expr_stmt|;
name|d2
operator|=
name|data
index|[
literal|2
index|]
expr_stmt|;
name|d3
operator|=
name|data
index|[
literal|3
index|]
expr_stmt|;
name|d4
operator|=
name|data
index|[
literal|4
index|]
expr_stmt|;
name|d5
operator|=
name|data
index|[
literal|5
index|]
expr_stmt|;
name|tsigtime
operator|=
operator|(
name|d0
operator|<<
literal|40
operator|)
operator||
operator|(
name|d1
operator|<<
literal|32
operator|)
operator||
operator|(
name|d2
operator|<<
literal|24
operator|)
operator||
operator|(
name|d3
operator|<<
literal|16
operator|)
operator||
operator|(
name|d4
operator|<<
literal|8
operator|)
operator||
name|d5
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%llu "
argument_list|,
operator|(
name|long
name|long
operator|)
name|tsigtime
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_apl
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|uint8_t
modifier|*
name|data
init|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
decl_stmt|;
name|uint16_t
name|address_family
decl_stmt|;
name|uint8_t
name|prefix
decl_stmt|;
name|bool
name|negation
decl_stmt|;
name|uint8_t
name|adf_length
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|size_t
name|pos
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|pos
operator|<
operator|(
name|unsigned
name|int
operator|)
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
condition|)
block|{
if|if
condition|(
name|pos
operator|+
literal|3
operator|>=
operator|(
name|unsigned
operator|)
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
condition|)
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
name|address_family
operator|=
name|ldns_read_uint16
argument_list|(
operator|&
name|data
index|[
name|pos
index|]
argument_list|)
expr_stmt|;
name|prefix
operator|=
name|data
index|[
name|pos
operator|+
literal|2
index|]
expr_stmt|;
name|negation
operator|=
name|data
index|[
name|pos
operator|+
literal|3
index|]
operator|&
name|LDNS_APL_NEGATION
expr_stmt|;
name|adf_length
operator|=
name|data
index|[
name|pos
operator|+
literal|3
index|]
operator|&
name|LDNS_APL_MASK
expr_stmt|;
if|if
condition|(
name|address_family
operator|==
name|LDNS_APL_IP4
condition|)
block|{
comment|/* check if prefix< 32? */
if|if
condition|(
name|negation
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"!"
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%u:"
argument_list|,
name|address_family
argument_list|)
expr_stmt|;
comment|/* address is variable length 0 - 4 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|>
literal|0
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|<
operator|(
name|unsigned
name|short
operator|)
name|adf_length
condition|)
block|{
if|if
condition|(
name|pos
operator|+
name|i
operator|+
literal|4
operator|>=
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
condition|)
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%d"
argument_list|,
name|data
index|[
name|pos
operator|+
name|i
operator|+
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
block|}
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"/%u "
argument_list|,
name|prefix
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|address_family
operator|==
name|LDNS_APL_IP6
condition|)
block|{
comment|/* check if prefix< 128? */
if|if
condition|(
name|negation
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"!"
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%u:"
argument_list|,
name|address_family
argument_list|)
expr_stmt|;
comment|/* address is variable length 0 - 16 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|%
literal|2
operator|==
literal|0
operator|&&
name|i
operator|>
literal|0
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|<
operator|(
name|unsigned
name|short
operator|)
name|adf_length
condition|)
block|{
if|if
condition|(
name|pos
operator|+
name|i
operator|+
literal|4
operator|>=
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
condition|)
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%02x"
argument_list|,
name|data
index|[
name|pos
operator|+
name|i
operator|+
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"00"
argument_list|)
expr_stmt|;
block|}
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"/%u "
argument_list|,
name|prefix
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* unknown address family */
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Unknown address family: %u data: "
argument_list|,
name|address_family
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
call|(
name|unsigned
name|short
call|)
argument_list|(
literal|4
operator|+
name|adf_length
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|pos
operator|+
name|i
operator|>=
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
condition|)
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%02x"
argument_list|,
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
name|pos
operator|+=
literal|4
operator|+
name|adf_length
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_int16_data
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|size_t
name|size
decl_stmt|;
name|char
modifier|*
name|b64
decl_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
literal|2
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
comment|/* Subtract the size (2) of the number that specifies the length */
name|size
operator|=
name|ldns_b64_ntop_calculate_size
argument_list|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|-
literal|2
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%u "
argument_list|,
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|-
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|>
literal|2
condition|)
block|{
name|b64
operator|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|b64
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|>
literal|2
operator|&&
name|ldns_b64_ntop
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
operator|+
literal|2
argument_list|,
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|-
literal|2
argument_list|,
name|b64
argument_list|,
name|size
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|b64
argument_list|)
expr_stmt|;
block|}
name|LDNS_FREE
argument_list|(
name|b64
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_ipseckey
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
comment|/* wire format from 	   http://www.ietf.org/internet-drafts/draft-ietf-ipseckey-rr-12.txt 	*/
name|uint8_t
modifier|*
name|data
init|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
decl_stmt|;
name|uint8_t
name|precedence
decl_stmt|;
name|uint8_t
name|gateway_type
decl_stmt|;
name|uint8_t
name|algorithm
decl_stmt|;
name|ldns_rdf
modifier|*
name|gateway
init|=
name|NULL
decl_stmt|;
name|uint8_t
modifier|*
name|gateway_data
decl_stmt|;
name|size_t
name|public_key_size
decl_stmt|;
name|uint8_t
modifier|*
name|public_key_data
decl_stmt|;
name|ldns_rdf
modifier|*
name|public_key
decl_stmt|;
name|size_t
name|offset
init|=
literal|0
decl_stmt|;
name|ldns_status
name|status
decl_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
literal|3
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|precedence
operator|=
name|data
index|[
literal|0
index|]
expr_stmt|;
name|gateway_type
operator|=
name|data
index|[
literal|1
index|]
expr_stmt|;
name|algorithm
operator|=
name|data
index|[
literal|2
index|]
expr_stmt|;
name|offset
operator|=
literal|3
expr_stmt|;
switch|switch
condition|(
name|gateway_type
condition|)
block|{
case|case
literal|0
case|:
comment|/* no gateway */
break|break;
case|case
literal|1
case|:
name|gateway_data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|LDNS_IP4ADDRLEN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gateway_data
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
name|offset
operator|+
name|LDNS_IP4ADDRLEN
condition|)
block|{
return|return
name|LDNS_STATUS_ERR
return|;
block|}
name|memcpy
argument_list|(
name|gateway_data
argument_list|,
operator|&
name|data
index|[
name|offset
index|]
argument_list|,
name|LDNS_IP4ADDRLEN
argument_list|)
expr_stmt|;
name|gateway
operator|=
name|ldns_rdf_new
argument_list|(
name|LDNS_RDF_TYPE_A
argument_list|,
name|LDNS_IP4ADDRLEN
argument_list|,
name|gateway_data
argument_list|)
expr_stmt|;
name|offset
operator|+=
name|LDNS_IP4ADDRLEN
expr_stmt|;
if|if
condition|(
operator|!
name|gateway
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|gateway_data
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
break|break;
case|case
literal|2
case|:
name|gateway_data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|LDNS_IP6ADDRLEN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gateway_data
condition|)
return|return
name|LDNS_STATUS_MEM_ERR
return|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
name|offset
operator|+
name|LDNS_IP6ADDRLEN
condition|)
block|{
return|return
name|LDNS_STATUS_ERR
return|;
block|}
name|memcpy
argument_list|(
name|gateway_data
argument_list|,
operator|&
name|data
index|[
name|offset
index|]
argument_list|,
name|LDNS_IP6ADDRLEN
argument_list|)
expr_stmt|;
name|offset
operator|+=
name|LDNS_IP6ADDRLEN
expr_stmt|;
name|gateway
operator|=
name|ldns_rdf_new
argument_list|(
name|LDNS_RDF_TYPE_AAAA
argument_list|,
name|LDNS_IP6ADDRLEN
argument_list|,
name|gateway_data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gateway
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|gateway_data
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
break|break;
case|case
literal|3
case|:
name|status
operator|=
name|ldns_wire2dname
argument_list|(
operator|&
name|gateway
argument_list|,
name|data
argument_list|,
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
argument_list|,
operator|&
name|offset
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
return|return
name|status
return|;
break|break;
default|default:
comment|/* error? */
break|break;
block|}
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<=
name|offset
condition|)
block|{
return|return
name|LDNS_STATUS_ERR
return|;
block|}
name|public_key_size
operator|=
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|-
name|offset
expr_stmt|;
name|public_key_data
operator|=
name|LDNS_XMALLOC
argument_list|(
name|uint8_t
argument_list|,
name|public_key_size
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|public_key_data
condition|)
block|{
name|ldns_rdf_free
argument_list|(
name|gateway
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|memcpy
argument_list|(
name|public_key_data
argument_list|,
operator|&
name|data
index|[
name|offset
index|]
argument_list|,
name|public_key_size
argument_list|)
expr_stmt|;
name|public_key
operator|=
name|ldns_rdf_new
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|public_key_size
argument_list|,
name|public_key_data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|public_key
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|public_key_data
argument_list|)
expr_stmt|;
name|ldns_rdf_free
argument_list|(
name|gateway
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%u %u %u "
argument_list|,
name|precedence
argument_list|,
name|gateway_type
argument_list|,
name|algorithm
argument_list|)
expr_stmt|;
if|if
condition|(
name|gateway
condition|)
operator|(
name|void
operator|)
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|gateway
argument_list|)
expr_stmt|;
else|else
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|public_key
argument_list|)
expr_stmt|;
name|ldns_rdf_free
argument_list|(
name|gateway
argument_list|)
expr_stmt|;
name|ldns_rdf_free
argument_list|(
name|public_key
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_ilnp64
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|!=
literal|8
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%.4x:%.4x:%.4x:%.4x"
argument_list|,
name|ldns_read_uint16
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
argument_list|)
argument_list|,
name|ldns_read_uint16
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
operator|+
literal|2
argument_list|)
argument_list|,
name|ldns_read_uint16
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
operator|+
literal|4
argument_list|)
argument_list|,
name|ldns_read_uint16
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
operator|+
literal|6
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_eui48
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|!=
literal|6
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%.2x-%.2x-%.2x-%.2x-%.2x-%.2x"
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|0
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|1
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|2
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|3
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|4
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_eui64
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|!=
literal|8
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%.2x-%.2x-%.2x-%.2x-%.2x-%.2x-%.2x-%.2x"
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|0
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|1
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|2
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|3
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|4
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|5
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|6
index|]
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_tag
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|size_t
name|nchars
decl_stmt|;
specifier|const
name|uint8_t
modifier|*
name|chars
decl_stmt|;
name|char
name|ch
decl_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|<
literal|2
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|nchars
operator|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|nchars
operator|>=
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|||
comment|/* should be rdf_size - 1 */
name|nchars
operator|<
literal|1
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|chars
operator|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
operator|+
literal|1
expr_stmt|;
while|while
condition|(
name|nchars
operator|>
literal|0
condition|)
block|{
name|ch
operator|=
operator|(
name|char
operator|)
operator|*
name|chars
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|isalnum
argument_list|(
name|ch
argument_list|)
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%c"
argument_list|,
name|ch
argument_list|)
expr_stmt|;
name|nchars
operator|--
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_long_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
name|ldns_characters2buffer_str
argument_list|(
name|output
argument_list|,
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
argument_list|,
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str_hip
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|uint8_t
modifier|*
name|data
init|=
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
decl_stmt|;
name|size_t
name|rdf_size
init|=
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
decl_stmt|;
name|uint8_t
name|hit_size
decl_stmt|;
name|uint16_t
name|pk_size
decl_stmt|;
name|int
name|written
decl_stmt|;
if|if
condition|(
name|rdf_size
operator|<
literal|6
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
if|if
condition|(
operator|(
name|hit_size
operator|=
name|data
index|[
literal|0
index|]
operator|)
operator|==
literal|0
operator|||
operator|(
name|pk_size
operator|=
name|ldns_read_uint16
argument_list|(
name|data
operator|+
literal|2
argument_list|)
operator|)
operator|==
literal|0
operator|||
name|rdf_size
operator|<
operator|(
name|size_t
operator|)
name|hit_size
operator|+
name|pk_size
operator|+
literal|4
condition|)
block|{
return|return
name|LDNS_STATUS_WIRE_RDATA_ERR
return|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%d "
argument_list|,
operator|(
name|int
operator|)
name|data
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|data
operator|+=
literal|4
init|;
name|hit_size
operator|>
literal|0
condition|;
name|hit_size
operator|--
operator|,
name|data
operator|++
control|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%02x"
argument_list|,
operator|(
name|int
operator|)
operator|*
name|data
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_write_u8
argument_list|(
name|output
argument_list|,
operator|(
name|uint8_t
operator|)
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_buffer_reserve
argument_list|(
name|output
argument_list|,
name|ldns_b64_ntop_calculate_size
argument_list|(
name|pk_size
argument_list|)
argument_list|)
condition|)
block|{
name|written
operator|=
name|ldns_b64_ntop
argument_list|(
name|data
argument_list|,
name|pk_size
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ldns_buffer_current
argument_list|(
name|output
argument_list|)
argument_list|,
name|ldns_buffer_remaining
argument_list|(
name|output
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|written
operator|>
literal|0
operator|&&
name|written
operator|<
operator|(
name|int
operator|)
name|ldns_buffer_remaining
argument_list|(
name|output
argument_list|)
condition|)
block|{
name|output
operator|->
name|_position
operator|+=
name|written
expr_stmt|;
block|}
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|ldns_status
name|ldns_rdf2buffer_str_fmt
parameter_list|(
name|ldns_buffer
modifier|*
name|buffer
parameter_list|,
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|ldns_status
name|res
init|=
name|LDNS_STATUS_OK
decl_stmt|;
comment|/*ldns_buffer_printf(buffer, "%u:", ldns_rdf_get_type(rdf));*/
if|if
condition|(
name|rdf
condition|)
block|{
switch|switch
condition|(
name|ldns_rdf_get_type
argument_list|(
name|rdf
argument_list|)
condition|)
block|{
case|case
name|LDNS_RDF_TYPE_NONE
case|:
break|break;
case|case
name|LDNS_RDF_TYPE_DNAME
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_dname
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_INT8
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_int8
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_INT16
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_int16
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_INT32
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_int32
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_PERIOD
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_period
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_TSIGTIME
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_tsigtime
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_A
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_a
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_AAAA
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_aaaa
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_STR
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_str
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_APL
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_apl
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_B32_EXT
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_b32_ext
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_B64
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_b64
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_HEX
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_hex
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_NSEC
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_nsec_fmt
argument_list|(
name|buffer
argument_list|,
name|fmt
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_NSEC3_SALT
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_nsec3_salt
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_TYPE
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_type_fmt
argument_list|(
name|buffer
argument_list|,
name|fmt
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_CLASS
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_class
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_CERT_ALG
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_cert_alg
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_ALG
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_alg
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_UNKNOWN
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_unknown
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_TIME
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_time
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_HIP
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_hip
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_LOC
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_loc
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_WKS
case|:
case|case
name|LDNS_RDF_TYPE_SERVICE
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_wks
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_NSAP
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_nsap
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_ATMA
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_atma
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_IPSECKEY
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_ipseckey
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_INT16_DATA
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_int16_data
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_NSEC3_NEXT_OWNER
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_b32_ext
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_ILNP64
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_ilnp64
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_EUI48
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_eui48
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_EUI64
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_eui64
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_TAG
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_tag
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RDF_TYPE_LONG_STR
case|:
name|res
operator|=
name|ldns_rdf2buffer_str_long_str
argument_list|(
name|buffer
argument_list|,
name|rdf
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
else|else
block|{
comment|/** This will write mangled RRs */
name|ldns_buffer_printf
argument_list|(
name|buffer
argument_list|,
literal|"(null) "
argument_list|)
expr_stmt|;
name|res
operator|=
name|LDNS_STATUS_ERR
expr_stmt|;
block|}
return|return
name|res
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rdf2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|buffer
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
return|return
name|ldns_rdf2buffer_str_fmt
argument_list|(
name|buffer
argument_list|,
name|ldns_output_format_default
argument_list|,
name|rdf
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|ldns_rdf
modifier|*
name|ldns_b32_ext2dname
parameter_list|(
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|size_t
name|size
decl_stmt|;
name|char
modifier|*
name|b32
decl_stmt|;
name|ldns_rdf
modifier|*
name|out
decl_stmt|;
if|if
condition|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|==
literal|0
condition|)
return|return
name|NULL
return|;
comment|/* remove -1 for the b32-hash-len octet */
name|size
operator|=
name|ldns_b32_ntop_calculate_size
argument_list|(
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* add one for the end nul for the string */
name|b32
operator|=
name|LDNS_XMALLOC
argument_list|(
name|char
argument_list|,
name|size
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|b32
condition|)
block|{
if|if
condition|(
name|ldns_b32_ntop_extended_hex
argument_list|(
name|ldns_rdf_data
argument_list|(
name|rdf
argument_list|)
operator|+
literal|1
argument_list|,
name|ldns_rdf_size
argument_list|(
name|rdf
argument_list|)
operator|-
literal|1
argument_list|,
name|b32
argument_list|,
name|size
operator|+
literal|1
argument_list|)
operator|>
literal|0
condition|)
block|{
name|b32
index|[
name|size
index|]
operator|=
literal|'.'
expr_stmt|;
name|b32
index|[
name|size
operator|+
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|ldns_str2rdf_dname
argument_list|(
operator|&
name|out
argument_list|,
name|b32
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|b32
argument_list|)
expr_stmt|;
return|return
name|out
return|;
block|}
block|}
name|LDNS_FREE
argument_list|(
name|b32
argument_list|)
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|ldns_status
name|ldns_rr2buffer_str_rfc3597
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rr
modifier|*
name|rr
parameter_list|)
block|{
name|size_t
name|total_rdfsize
init|=
literal|0
decl_stmt|;
name|size_t
name|i
decl_stmt|,
name|j
decl_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"TYPE%u\t"
argument_list|,
name|ldns_rr_get_type
argument_list|(
name|rr
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_rd_count
argument_list|(
name|rr
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|total_rdfsize
operator|+=
name|ldns_rdf_size
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|total_rdfsize
operator|==
literal|0
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\\# 0\n"
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\\# %d "
argument_list|,
name|total_rdfsize
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_rd_count
argument_list|(
name|rr
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|ldns_rdf_size
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
name|i
argument_list|)
argument_list|)
condition|;
name|j
operator|++
control|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%.2x"
argument_list|,
name|ldns_rdf_data
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
name|i
argument_list|)
argument_list|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
block|}
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rr2buffer_str_fmt
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_rr
modifier|*
name|rr
parameter_list|)
block|{
name|uint16_t
name|i
decl_stmt|,
name|flags
decl_stmt|;
name|ldns_status
name|status
init|=
name|LDNS_STATUS_OK
decl_stmt|;
name|ldns_output_format_storage
modifier|*
name|fmt_st
init|=
operator|(
name|ldns_output_format_storage
operator|*
operator|)
name|fmt
decl_stmt|;
if|if
condition|(
name|fmt_st
operator|==
name|NULL
condition|)
block|{
name|fmt_st
operator|=
operator|(
name|ldns_output_format_storage
operator|*
operator|)
name|ldns_output_format_default
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|rr
condition|)
block|{
if|if
condition|(
name|LDNS_COMMENT_NULLS
operator|&
name|fmt_st
operator|->
name|flags
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"; (null)\n"
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
if|if
condition|(
name|ldns_rr_owner
argument_list|(
name|rr
argument_list|)
condition|)
block|{
name|status
operator|=
name|ldns_rdf2buffer_str_dname
argument_list|(
name|output
argument_list|,
name|ldns_rr_owner
argument_list|(
name|rr
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
return|return
name|status
return|;
block|}
comment|/* TTL should NOT be printed if it is a question */
if|if
condition|(
operator|!
name|ldns_rr_is_question
argument_list|(
name|rr
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\t%d"
argument_list|,
name|ldns_rr_ttl
argument_list|(
name|rr
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
name|status
operator|=
name|ldns_rr_class2buffer_str
argument_list|(
name|output
argument_list|,
name|ldns_rr_get_class
argument_list|(
name|rr
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
return|return
name|status
return|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_output_format_covers_type
argument_list|(
name|fmt
argument_list|,
name|ldns_rr_get_type
argument_list|(
name|rr
argument_list|)
argument_list|)
condition|)
block|{
return|return
name|ldns_rr2buffer_str_rfc3597
argument_list|(
name|output
argument_list|,
name|rr
argument_list|)
return|;
block|}
name|status
operator|=
name|ldns_rr_type2buffer_str
argument_list|(
name|output
argument_list|,
name|ldns_rr_get_type
argument_list|(
name|rr
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
return|return
name|status
return|;
block|}
if|if
condition|(
name|ldns_rr_rd_count
argument_list|(
name|rr
argument_list|)
operator|>
literal|0
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|ldns_rr_is_question
argument_list|(
name|rr
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\t\\# 0"
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_rd_count
argument_list|(
name|rr
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
comment|/* ldns_rdf2buffer_str handles NULL input fine! */
if|if
condition|(
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_FMT_ZEROIZE_RRSIGS
operator|)
operator|&&
operator|(
name|ldns_rr_get_type
argument_list|(
name|rr
argument_list|)
operator|==
name|LDNS_RR_TYPE_RRSIG
operator|)
operator|&&
operator|(
operator|(
comment|/* inception  */
name|i
operator|==
literal|4
operator|&&
name|ldns_rdf_get_type
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
literal|4
argument_list|)
argument_list|)
operator|==
name|LDNS_RDF_TYPE_TIME
operator|)
operator|||
operator|(
comment|/* expiration */
name|i
operator|==
literal|5
operator|&&
name|ldns_rdf_get_type
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
literal|5
argument_list|)
argument_list|)
operator|==
name|LDNS_RDF_TYPE_TIME
operator|)
operator|||
operator|(
comment|/* signature  */
name|i
operator|==
literal|8
operator|&&
name|ldns_rdf_get_type
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
literal|8
argument_list|)
argument_list|)
operator|==
name|LDNS_RDF_TYPE_B64
operator|)
operator|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"(null)"
argument_list|)
expr_stmt|;
name|status
operator|=
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_FMT_PAD_SOA_SERIAL
operator|)
operator|&&
operator|(
name|ldns_rr_get_type
argument_list|(
name|rr
argument_list|)
operator|==
name|LDNS_RR_TYPE_SOA
operator|)
operator|&&
comment|/* serial */
name|i
operator|==
literal|2
operator|&&
name|ldns_rdf_get_type
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
literal|2
argument_list|)
argument_list|)
operator|==
name|LDNS_RDF_TYPE_INT32
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"%10lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ldns_read_uint32
argument_list|(
name|ldns_rdf_data
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
literal|2
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|ldns_rdf2buffer_str_fmt
argument_list|(
name|output
argument_list|,
name|fmt
argument_list|,
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
return|return
name|status
return|;
if|if
condition|(
name|i
operator|<
name|ldns_rr_rd_count
argument_list|(
name|rr
argument_list|)
operator|-
literal|1
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* per RR special comments - handy for DNSSEC types */
comment|/* check to prevent question sec. rr from 	 * getting here */
if|if
condition|(
name|ldns_rr_rd_count
argument_list|(
name|rr
argument_list|)
operator|>
literal|0
condition|)
block|{
switch|switch
condition|(
name|ldns_rr_get_type
argument_list|(
name|rr
argument_list|)
condition|)
block|{
case|case
name|LDNS_RR_TYPE_DNSKEY
case|:
comment|/* if ldns_rr_rd_count(rr)> 0 				then ldns_rr_rdf(rr, 0) exists! */
if|if
condition|(
operator|!
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_KEY
operator|)
condition|)
block|{
break|break;
block|}
name|flags
operator|=
name|ldns_rdf2native_int16
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" ;{"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_KEY_ID
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"id = %u"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|ldns_calc_keytag
argument_list|(
name|rr
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_KEY_TYPE
operator|)
operator|&&
operator|(
name|flags
operator|&
name|LDNS_KEY_ZONE_KEY
operator|)
condition|)
block|{
if|if
condition|(
name|flags
operator|&
name|LDNS_KEY_SEP_KEY
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" (ksk)"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" (zsk)"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_KEY_SIZE
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|fmt_st
operator|->
name|flags
operator|&
operator|(
name|LDNS_COMMENT_KEY_ID
operator||
name|LDNS_COMMENT_KEY_SIZE
operator|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_KEY_SIZE
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"size = %db"
argument_list|,
name|ldns_rr_dnskey_key_size
argument_list|(
name|rr
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"}"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RR_TYPE_RRSIG
case|:
if|if
condition|(
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_KEY
operator|)
operator|&&
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_RRSIGS
operator|)
operator|&&
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
literal|6
argument_list|)
operator|!=
name|NULL
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" ;{id = %d}"
argument_list|,
name|ldns_rdf2native_int16
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
literal|6
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LDNS_RR_TYPE_DS
case|:
if|if
condition|(
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_BUBBLEBABBLE
operator|)
operator|&&
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
literal|3
argument_list|)
operator|!=
name|NULL
condition|)
block|{
name|uint8_t
modifier|*
name|data
init|=
name|ldns_rdf_data
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
literal|3
argument_list|)
argument_list|)
decl_stmt|;
name|size_t
name|len
init|=
name|ldns_rdf_size
argument_list|(
name|ldns_rr_rdf
argument_list|(
name|rr
argument_list|,
literal|3
argument_list|)
argument_list|)
decl_stmt|;
name|char
modifier|*
name|babble
init|=
name|ldns_bubblebabble
argument_list|(
name|data
argument_list|,
name|len
argument_list|)
decl_stmt|;
if|if
condition|(
name|babble
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" ;{%s}"
argument_list|,
name|babble
argument_list|)
expr_stmt|;
block|}
name|LDNS_FREE
argument_list|(
name|babble
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LDNS_RR_TYPE_NSEC3
case|:
if|if
condition|(
operator|!
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_FLAGS
operator|)
operator|&&
operator|!
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_NSEC3_CHAIN
operator|)
condition|)
block|{
break|break;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" ;{"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_FLAGS
operator|)
condition|)
block|{
if|if
condition|(
name|ldns_nsec3_optout
argument_list|(
name|rr
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" flags: optout"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" flags: -"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_NSEC3_CHAIN
operator|&&
name|fmt_st
operator|->
name|hashmap
operator|!=
name|NULL
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|fmt_st
operator|->
name|flags
operator|&
name|LDNS_COMMENT_NSEC3_CHAIN
operator|&&
name|fmt_st
operator|->
name|hashmap
operator|!=
name|NULL
condition|)
block|{
name|ldns_rbnode_t
modifier|*
name|node
decl_stmt|;
name|ldns_rdf
modifier|*
name|key
init|=
name|ldns_dname_label
argument_list|(
name|ldns_rr_owner
argument_list|(
name|rr
argument_list|)
argument_list|,
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|key
condition|)
block|{
name|node
operator|=
name|ldns_rbtree_search
argument_list|(
name|fmt_st
operator|->
name|hashmap
argument_list|,
operator|(
name|void
operator|*
operator|)
name|key
argument_list|)
expr_stmt|;
if|if
condition|(
name|node
operator|->
name|data
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"from: "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|ldns_dnssec_name_name
argument_list|(
operator|(
name|ldns_dnssec_name
operator|*
operator|)
name|node
operator|->
name|data
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|ldns_rdf_free
argument_list|(
name|key
argument_list|)
expr_stmt|;
block|}
name|key
operator|=
name|ldns_b32_ext2dname
argument_list|(
name|ldns_nsec3_next_owner
argument_list|(
name|rr
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|key
condition|)
block|{
name|node
operator|=
name|ldns_rbtree_search
argument_list|(
name|fmt_st
operator|->
name|hashmap
argument_list|,
operator|(
name|void
operator|*
operator|)
name|key
argument_list|)
expr_stmt|;
if|if
condition|(
name|node
operator|->
name|data
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" to: "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|ldns_dnssec_name_name
argument_list|(
operator|(
name|ldns_dnssec_name
operator|*
operator|)
name|node
operator|->
name|data
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|ldns_rdf_free
argument_list|(
name|key
argument_list|)
expr_stmt|;
block|}
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"}"
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
comment|/* last */
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rr2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rr
modifier|*
name|rr
parameter_list|)
block|{
return|return
name|ldns_rr2buffer_str_fmt
argument_list|(
name|output
argument_list|,
name|ldns_output_format_default
argument_list|,
name|rr
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rr_list2buffer_str_fmt
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_rr_list
modifier|*
name|list
parameter_list|)
block|{
name|uint16_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_list_rr_count
argument_list|(
name|list
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
operator|(
name|void
operator|)
name|ldns_rr2buffer_str_fmt
argument_list|(
name|output
argument_list|,
name|fmt
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|list
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_rr_list2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rr_list
modifier|*
name|list
parameter_list|)
block|{
return|return
name|ldns_rr_list2buffer_str_fmt
argument_list|(
name|output
argument_list|,
name|ldns_output_format_default
argument_list|,
name|list
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_pktheader2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_pkt
modifier|*
name|pkt
parameter_list|)
block|{
name|ldns_lookup_table
modifier|*
name|opcode
init|=
name|ldns_lookup_by_id
argument_list|(
name|ldns_opcodes
argument_list|,
operator|(
name|int
operator|)
name|ldns_pkt_get_opcode
argument_list|(
name|pkt
argument_list|)
argument_list|)
decl_stmt|;
name|ldns_lookup_table
modifier|*
name|rcode
init|=
name|ldns_lookup_by_id
argument_list|(
name|ldns_rcodes
argument_list|,
operator|(
name|int
operator|)
name|ldns_pkt_get_rcode
argument_list|(
name|pkt
argument_list|)
argument_list|)
decl_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; ->>HEADER<<- "
argument_list|)
expr_stmt|;
if|if
condition|(
name|opcode
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"opcode: %s, "
argument_list|,
name|opcode
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"opcode: ?? (%u), "
argument_list|,
name|ldns_pkt_get_opcode
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|rcode
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"rcode: %s, "
argument_list|,
name|rcode
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"rcode: ?? (%u), "
argument_list|,
name|ldns_pkt_get_rcode
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"id: %d\n"
argument_list|,
name|ldns_pkt_id
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; flags: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_pkt_qr
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"qr "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ldns_pkt_aa
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"aa "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ldns_pkt_tc
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"tc "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ldns_pkt_rd
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"rd "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ldns_pkt_cd
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"cd "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ldns_pkt_ra
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"ra "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ldns_pkt_ad
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"ad "
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"; "
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"QUERY: %u, "
argument_list|,
name|ldns_pkt_qdcount
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"ANSWER: %u, "
argument_list|,
name|ldns_pkt_ancount
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"AUTHORITY: %u, "
argument_list|,
name|ldns_pkt_nscount
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"ADDITIONAL: %u "
argument_list|,
name|ldns_pkt_arcount
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_pkt2buffer_str_fmt
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_pkt
modifier|*
name|pkt
parameter_list|)
block|{
name|uint16_t
name|i
decl_stmt|;
name|ldns_status
name|status
init|=
name|LDNS_STATUS_OK
decl_stmt|;
name|char
modifier|*
name|tmp
decl_stmt|;
name|struct
name|timeval
name|time
decl_stmt|;
name|time_t
name|time_tt
decl_stmt|;
if|if
condition|(
operator|!
name|pkt
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"null"
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_OK
return|;
block|}
if|if
condition|(
name|ldns_buffer_status_ok
argument_list|(
name|output
argument_list|)
condition|)
block|{
name|status
operator|=
name|ldns_pktheader2buffer_str
argument_list|(
name|output
argument_list|,
name|pkt
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
return|return
name|status
return|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; QUESTION SECTION:\n;; "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_pkt_qdcount
argument_list|(
name|pkt
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|status
operator|=
name|ldns_rr2buffer_str_fmt
argument_list|(
name|output
argument_list|,
name|fmt
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|ldns_pkt_question
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
return|return
name|status
return|;
block|}
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; ANSWER SECTION:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_pkt_ancount
argument_list|(
name|pkt
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|status
operator|=
name|ldns_rr2buffer_str_fmt
argument_list|(
name|output
argument_list|,
name|fmt
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|ldns_pkt_answer
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
return|return
name|status
return|;
block|}
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; AUTHORITY SECTION:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_pkt_nscount
argument_list|(
name|pkt
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|status
operator|=
name|ldns_rr2buffer_str_fmt
argument_list|(
name|output
argument_list|,
name|fmt
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|ldns_pkt_authority
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
return|return
name|status
return|;
block|}
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; ADDITIONAL SECTION:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_pkt_arcount
argument_list|(
name|pkt
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|status
operator|=
name|ldns_rr2buffer_str_fmt
argument_list|(
name|output
argument_list|,
name|fmt
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|ldns_pkt_additional
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
return|return
name|status
return|;
block|}
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* add some futher fields */
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; Query time: %d msec\n"
argument_list|,
name|ldns_pkt_querytime
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_pkt_edns
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; EDNS: version %u; flags:"
argument_list|,
name|ldns_pkt_edns_version
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_pkt_edns_do
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" do"
argument_list|)
expr_stmt|;
block|}
comment|/* the extended rcode is the value set, shifted four bits, 			 * and or'd with the original rcode */
if|if
condition|(
name|ldns_pkt_edns_extended_rcode
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" ; ext-rcode: %d"
argument_list|,
operator|(
name|ldns_pkt_edns_extended_rcode
argument_list|(
name|pkt
argument_list|)
operator|<<
literal|4
operator||
name|ldns_pkt_get_rcode
argument_list|(
name|pkt
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|" ; udp: %u\n"
argument_list|,
name|ldns_pkt_edns_udp_size
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_pkt_edns_data
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; Data: "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|ldns_pkt_edns_data
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|ldns_pkt_tsig
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; TSIG:\n;; "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|ldns_rr2buffer_str_fmt
argument_list|(
name|output
argument_list|,
name|fmt
argument_list|,
name|ldns_pkt_tsig
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ldns_pkt_answerfrom
argument_list|(
name|pkt
argument_list|)
condition|)
block|{
name|tmp
operator|=
name|ldns_rdf2str
argument_list|(
name|ldns_pkt_answerfrom
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; SERVER: %s\n"
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
name|time
operator|=
name|ldns_pkt_timestamp
argument_list|(
name|pkt
argument_list|)
expr_stmt|;
name|time_tt
operator|=
operator|(
name|time_t
operator|)
name|time
operator|.
name|tv_sec
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; WHEN: %s"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ctime
argument_list|(
operator|&
name|time_tt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|";; MSG SIZE  rcvd: %d\n"
argument_list|,
operator|(
name|int
operator|)
name|ldns_pkt_size
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_pkt2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_pkt
modifier|*
name|pkt
parameter_list|)
block|{
return|return
name|ldns_pkt2buffer_str_fmt
argument_list|(
name|output
argument_list|,
name|ldns_output_format_default
argument_list|,
name|pkt
argument_list|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SSL
end_ifdef

begin_function
specifier|static
name|ldns_status
name|ldns_hmac_key2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_key
modifier|*
name|k
parameter_list|)
block|{
name|ldns_status
name|status
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|ldns_rdf
modifier|*
name|b64_bignum
decl_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Key: "
argument_list|)
expr_stmt|;
name|i
operator|=
name|ldns_key_hmac_size
argument_list|(
name|k
argument_list|)
expr_stmt|;
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|ldns_key_hmac_key
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|defined
argument_list|(
name|HAVE_SSL
argument_list|)
operator|&&
name|defined
argument_list|(
name|USE_GOST
argument_list|)
end_if

begin_function
specifier|static
name|ldns_status
name|ldns_gost_key2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
name|EVP_PKEY
modifier|*
name|p
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|pp
init|=
name|NULL
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|ldns_rdf
modifier|*
name|b64_bignum
decl_stmt|;
name|ldns_status
name|status
decl_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"GostAsn1: "
argument_list|)
expr_stmt|;
name|ret
operator|=
name|i2d_PrivateKey
argument_list|(
name|p
argument_list|,
operator|&
name|pp
argument_list|)
expr_stmt|;
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
operator|(
name|size_t
operator|)
name|ret
argument_list|,
name|pp
argument_list|)
expr_stmt|;
name|status
operator|=
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|OPENSSL_free
argument_list|(
name|pp
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|ldns_status
name|ldns_key2buffer_str
parameter_list|(
name|ldns_buffer
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_key
modifier|*
name|k
parameter_list|)
block|{
name|ldns_status
name|status
init|=
name|LDNS_STATUS_OK
decl_stmt|;
name|unsigned
name|char
modifier|*
name|bignum
decl_stmt|;
ifdef|#
directive|ifdef
name|HAVE_SSL
ifndef|#
directive|ifndef
name|S_SPLINT_S
name|uint16_t
name|i
decl_stmt|;
endif|#
directive|endif
comment|/* not used when ssl is not defined */
comment|/*@unused@*/
name|ldns_rdf
modifier|*
name|b64_bignum
init|=
name|NULL
decl_stmt|;
name|RSA
modifier|*
name|rsa
decl_stmt|;
name|DSA
modifier|*
name|dsa
decl_stmt|;
endif|#
directive|endif
comment|/* HAVE_SSL */
if|if
condition|(
operator|!
name|k
condition|)
block|{
return|return
name|LDNS_STATUS_ERR
return|;
block|}
name|bignum
operator|=
name|LDNS_XMALLOC
argument_list|(
argument|unsigned char
argument_list|,
argument|LDNS_MAX_KEYLEN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bignum
condition|)
block|{
return|return
name|LDNS_STATUS_ERR
return|;
block|}
if|if
condition|(
name|ldns_buffer_status_ok
argument_list|(
name|output
argument_list|)
condition|)
block|{
ifdef|#
directive|ifdef
name|HAVE_SSL
switch|switch
condition|(
name|ldns_key_algorithm
argument_list|(
name|k
argument_list|)
condition|)
block|{
case|case
name|LDNS_SIGN_RSASHA1
case|:
case|case
name|LDNS_SIGN_RSASHA1_NSEC3
case|:
case|case
name|LDNS_SIGN_RSASHA256
case|:
case|case
name|LDNS_SIGN_RSASHA512
case|:
case|case
name|LDNS_SIGN_RSAMD5
case|:
comment|/* copied by looking at dnssec-keygen output */
comment|/* header */
name|rsa
operator|=
name|ldns_key_rsa_key
argument_list|(
name|k
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Private-key-format: v1.2\n"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|ldns_key_algorithm
argument_list|(
name|k
argument_list|)
condition|)
block|{
case|case
name|LDNS_SIGN_RSAMD5
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: %u (RSA)\n"
argument_list|,
name|LDNS_RSAMD5
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SIGN_RSASHA1
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: %u (RSASHA1)\n"
argument_list|,
name|LDNS_RSASHA1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SIGN_RSASHA1_NSEC3
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: %u (RSASHA1_NSEC3)\n"
argument_list|,
name|LDNS_RSASHA1_NSEC3
argument_list|)
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|USE_SHA2
case|case
name|LDNS_SIGN_RSASHA256
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: %u (RSASHA256)\n"
argument_list|,
name|LDNS_RSASHA256
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SIGN_RSASHA512
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: %u (RSASHA512)\n"
argument_list|,
name|LDNS_RSASHA512
argument_list|)
expr_stmt|;
break|break;
endif|#
directive|endif
default|default:
ifdef|#
directive|ifdef
name|STDERR_MSGS
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Warning: unknown signature "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"algorithm type %u\n"
argument_list|,
name|ldns_key_algorithm
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: %u (Unknown)\n"
argument_list|,
name|ldns_key_algorithm
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* print to buf, convert to bin, convert to b64, 				 * print to buf */
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Modulus: "
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|S_SPLINT_S
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|rsa
operator|->
name|n
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"PublicExponent: "
argument_list|)
expr_stmt|;
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|rsa
operator|->
name|e
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"PrivateExponent: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|rsa
operator|->
name|d
condition|)
block|{
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|rsa
operator|->
name|d
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"(Not available)\n"
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Prime1: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|rsa
operator|->
name|p
condition|)
block|{
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|rsa
operator|->
name|p
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"(Not available)\n"
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Prime2: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|rsa
operator|->
name|q
condition|)
block|{
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|rsa
operator|->
name|q
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"(Not available)\n"
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Exponent1: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|rsa
operator|->
name|dmp1
condition|)
block|{
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|rsa
operator|->
name|dmp1
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"(Not available)\n"
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Exponent2: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|rsa
operator|->
name|dmq1
condition|)
block|{
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|rsa
operator|->
name|dmq1
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"(Not available)\n"
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Coefficient: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|rsa
operator|->
name|iqmp
condition|)
block|{
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|rsa
operator|->
name|iqmp
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"(Not available)\n"
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* splint */
name|RSA_free
argument_list|(
name|rsa
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SIGN_DSA
case|:
case|case
name|LDNS_SIGN_DSA_NSEC3
case|:
name|dsa
operator|=
name|ldns_key_dsa_key
argument_list|(
name|k
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Private-key-format: v1.2\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_key_algorithm
argument_list|(
name|k
argument_list|)
operator|==
name|LDNS_SIGN_DSA
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: 3 (DSA)\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ldns_key_algorithm
argument_list|(
name|k
argument_list|)
operator|==
name|LDNS_SIGN_DSA_NSEC3
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: 6 (DSA_NSEC3)\n"
argument_list|)
expr_stmt|;
block|}
comment|/* print to buf, convert to bin, convert to b64, 				 * print to buf */
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Prime(p): "
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|S_SPLINT_S
if|if
condition|(
name|dsa
operator|->
name|p
condition|)
block|{
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|dsa
operator|->
name|p
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"(Not available)\n"
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Subprime(q): "
argument_list|)
expr_stmt|;
if|if
condition|(
name|dsa
operator|->
name|q
condition|)
block|{
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|dsa
operator|->
name|q
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"(Not available)\n"
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Base(g): "
argument_list|)
expr_stmt|;
if|if
condition|(
name|dsa
operator|->
name|g
condition|)
block|{
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|dsa
operator|->
name|g
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"(Not available)\n"
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Private_value(x): "
argument_list|)
expr_stmt|;
if|if
condition|(
name|dsa
operator|->
name|priv_key
condition|)
block|{
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|dsa
operator|->
name|priv_key
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"(Not available)\n"
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Public_value(y): "
argument_list|)
expr_stmt|;
if|if
condition|(
name|dsa
operator|->
name|pub_key
condition|)
block|{
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|dsa
operator|->
name|pub_key
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"(Not available)\n"
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* splint */
break|break;
case|case
name|LDNS_SIGN_ECC_GOST
case|:
comment|/* no format defined, use blob */
if|#
directive|if
name|defined
argument_list|(
name|HAVE_SSL
argument_list|)
operator|&&
name|defined
argument_list|(
name|USE_GOST
argument_list|)
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Private-key-format: v1.2\n"
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: %d (ECC-GOST)\n"
argument_list|,
name|LDNS_SIGN_ECC_GOST
argument_list|)
expr_stmt|;
name|status
operator|=
name|ldns_gost_key2buffer_str
argument_list|(
argument|output
argument_list|,
ifndef|#
directive|ifndef
name|S_SPLINT_S
argument|k->_key.key
else|#
directive|else
argument|NULL
endif|#
directive|endif
argument_list|)
expr_stmt|;
else|#
directive|else
goto|goto
name|error
goto|;
endif|#
directive|endif
comment|/* GOST */
break|break;
case|case
name|LDNS_SIGN_ECDSAP256SHA256
case|:
case|case
name|LDNS_SIGN_ECDSAP384SHA384
case|:
ifdef|#
directive|ifdef
name|USE_ECDSA
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Private-key-format: v1.2\n"
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: %d ("
argument_list|,
name|ldns_key_algorithm
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|ldns_algorithm2buffer_str
argument_list|(
name|output
argument_list|,
operator|(
name|ldns_algorithm
operator|)
name|ldns_key_algorithm
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|S_SPLINT_S
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|")\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|k
operator|->
name|_key
operator|.
name|key
condition|)
block|{
name|EC_KEY
modifier|*
name|ec
init|=
name|EVP_PKEY_get1_EC_KEY
argument_list|(
name|k
operator|->
name|_key
operator|.
name|key
argument_list|)
decl_stmt|;
specifier|const
name|BIGNUM
modifier|*
name|b
init|=
name|EC_KEY_get0_private_key
argument_list|(
name|ec
argument_list|)
decl_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"PrivateKey: "
argument_list|)
expr_stmt|;
name|i
operator|=
operator|(
name|uint16_t
operator|)
name|BN_bn2bin
argument_list|(
name|b
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|LDNS_MAX_KEYLEN
condition|)
block|{
goto|goto
name|error
goto|;
block|}
name|b64_bignum
operator|=
name|ldns_rdf_new_frm_data
argument_list|(
name|LDNS_RDF_TYPE_B64
argument_list|,
name|i
argument_list|,
name|bignum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|output
argument_list|,
name|b64_bignum
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
goto|goto
name|error
goto|;
block|}
name|ldns_rdf_deep_free
argument_list|(
name|b64_bignum
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* down reference count in EC_KEY                                          * its still assigned to the PKEY */
name|EC_KEY_free
argument_list|(
name|ec
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* splint */
else|#
directive|else
goto|goto
name|error
goto|;
endif|#
directive|endif
comment|/* ECDSA */
break|break;
case|case
name|LDNS_SIGN_HMACMD5
case|:
comment|/* there's not much of a format defined for TSIG */
comment|/* It's just a binary blob, Same for all algorithms */
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Private-key-format: v1.2\n"
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: 157 (HMAC_MD5)\n"
argument_list|)
expr_stmt|;
name|status
operator|=
name|ldns_hmac_key2buffer_str
argument_list|(
name|output
argument_list|,
name|k
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SIGN_HMACSHA1
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Private-key-format: v1.2\n"
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: 158 (HMAC_SHA1)\n"
argument_list|)
expr_stmt|;
name|status
operator|=
name|ldns_hmac_key2buffer_str
argument_list|(
name|output
argument_list|,
name|k
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SIGN_HMACSHA256
case|:
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Private-key-format: v1.2\n"
argument_list|)
expr_stmt|;
name|ldns_buffer_printf
argument_list|(
name|output
argument_list|,
literal|"Algorithm: 159 (HMAC_SHA256)\n"
argument_list|)
expr_stmt|;
name|status
operator|=
name|ldns_hmac_key2buffer_str
argument_list|(
name|output
argument_list|,
name|k
argument_list|)
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
comment|/* HAVE_SSL */
block|}
else|else
block|{
name|LDNS_FREE
argument_list|(
name|bignum
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_status
argument_list|(
name|output
argument_list|)
return|;
block|}
name|LDNS_FREE
argument_list|(
name|bignum
argument_list|)
expr_stmt|;
return|return
name|status
return|;
ifdef|#
directive|ifdef
name|HAVE_SSL
comment|/* compiles warn the label isn't used */
name|error
label|:
name|LDNS_FREE
argument_list|(
name|bignum
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_ERR
return|;
endif|#
directive|endif
comment|/* HAVE_SSL */
block|}
end_function

begin_comment
comment|/*  * Zero terminate the buffer and copy data.  */
end_comment

begin_function
name|char
modifier|*
name|ldns_buffer2str
parameter_list|(
name|ldns_buffer
modifier|*
name|buffer
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
comment|/* check if buffer ends with \0, if not, and 	   if there is space, add it */
if|if
condition|(
operator|*
operator|(
name|ldns_buffer_at
argument_list|(
name|buffer
argument_list|,
name|ldns_buffer_position
argument_list|(
name|buffer
argument_list|)
argument_list|)
operator|)
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|ldns_buffer_reserve
argument_list|(
name|buffer
argument_list|,
literal|1
argument_list|)
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|ldns_buffer_write_u8
argument_list|(
name|buffer
argument_list|,
operator|(
name|uint8_t
operator|)
literal|'\0'
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ldns_buffer_set_capacity
argument_list|(
name|buffer
argument_list|,
name|ldns_buffer_position
argument_list|(
name|buffer
argument_list|)
argument_list|)
condition|)
block|{
return|return
name|NULL
return|;
block|}
block|}
name|str
operator|=
name|strdup
argument_list|(
operator|(
specifier|const
name|char
operator|*
operator|)
name|ldns_buffer_begin
argument_list|(
name|buffer
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|str
condition|)
block|{
return|return
name|NULL
return|;
block|}
return|return
name|str
return|;
block|}
end_function

begin_comment
comment|/*  * Zero terminate the buffer and export data.  */
end_comment

begin_function
name|char
modifier|*
name|ldns_buffer_export2str
parameter_list|(
name|ldns_buffer
modifier|*
name|buffer
parameter_list|)
block|{
comment|/* Append '\0' as string terminator */
if|if
condition|(
operator|!
name|ldns_buffer_reserve
argument_list|(
name|buffer
argument_list|,
literal|1
argument_list|)
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|ldns_buffer_write_u8
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* reallocate memory to the size of the string and export */
name|ldns_buffer_set_capacity
argument_list|(
name|buffer
argument_list|,
name|ldns_buffer_position
argument_list|(
name|buffer
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ldns_buffer_export
argument_list|(
name|buffer
argument_list|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_rdf2str
parameter_list|(
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|char
modifier|*
name|result
init|=
name|NULL
decl_stmt|;
name|ldns_buffer
modifier|*
name|tmp_buffer
init|=
name|ldns_buffer_new
argument_list|(
name|LDNS_MAX_PACKETLEN
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|tmp_buffer
condition|)
block|{
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|ldns_rdf2buffer_str
argument_list|(
name|tmp_buffer
argument_list|,
name|rdf
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
comment|/* export and return string, destroy rest */
name|result
operator|=
name|ldns_buffer_export2str
argument_list|(
name|tmp_buffer
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_free
argument_list|(
name|tmp_buffer
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_rr2str_fmt
parameter_list|(
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_rr
modifier|*
name|rr
parameter_list|)
block|{
name|char
modifier|*
name|result
init|=
name|NULL
decl_stmt|;
name|ldns_buffer
modifier|*
name|tmp_buffer
init|=
name|ldns_buffer_new
argument_list|(
name|LDNS_MAX_PACKETLEN
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|tmp_buffer
condition|)
block|{
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|ldns_rr2buffer_str_fmt
argument_list|(
name|tmp_buffer
argument_list|,
name|fmt
argument_list|,
name|rr
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
comment|/* export and return string, destroy rest */
name|result
operator|=
name|ldns_buffer_export2str
argument_list|(
name|tmp_buffer
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_free
argument_list|(
name|tmp_buffer
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_rr2str
parameter_list|(
specifier|const
name|ldns_rr
modifier|*
name|rr
parameter_list|)
block|{
return|return
name|ldns_rr2str_fmt
argument_list|(
name|ldns_output_format_default
argument_list|,
name|rr
argument_list|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_pkt2str_fmt
parameter_list|(
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_pkt
modifier|*
name|pkt
parameter_list|)
block|{
name|char
modifier|*
name|result
init|=
name|NULL
decl_stmt|;
name|ldns_buffer
modifier|*
name|tmp_buffer
init|=
name|ldns_buffer_new
argument_list|(
name|LDNS_MAX_PACKETLEN
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|tmp_buffer
condition|)
block|{
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|ldns_pkt2buffer_str_fmt
argument_list|(
name|tmp_buffer
argument_list|,
name|fmt
argument_list|,
name|pkt
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
comment|/* export and return string, destroy rest */
name|result
operator|=
name|ldns_buffer_export2str
argument_list|(
name|tmp_buffer
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_free
argument_list|(
name|tmp_buffer
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_pkt2str
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|pkt
parameter_list|)
block|{
return|return
name|ldns_pkt2str_fmt
argument_list|(
name|ldns_output_format_default
argument_list|,
name|pkt
argument_list|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_key2str
parameter_list|(
specifier|const
name|ldns_key
modifier|*
name|k
parameter_list|)
block|{
name|char
modifier|*
name|result
init|=
name|NULL
decl_stmt|;
name|ldns_buffer
modifier|*
name|tmp_buffer
init|=
name|ldns_buffer_new
argument_list|(
name|LDNS_MAX_PACKETLEN
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|tmp_buffer
condition|)
block|{
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|ldns_key2buffer_str
argument_list|(
name|tmp_buffer
argument_list|,
name|k
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
comment|/* export and return string, destroy rest */
name|result
operator|=
name|ldns_buffer_export2str
argument_list|(
name|tmp_buffer
argument_list|)
expr_stmt|;
block|}
name|ldns_buffer_free
argument_list|(
name|tmp_buffer
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_rr_list2str_fmt
parameter_list|(
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_rr_list
modifier|*
name|list
parameter_list|)
block|{
name|char
modifier|*
name|result
init|=
name|NULL
decl_stmt|;
name|ldns_buffer
modifier|*
name|tmp_buffer
init|=
name|ldns_buffer_new
argument_list|(
name|LDNS_MAX_PACKETLEN
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|tmp_buffer
condition|)
block|{
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|list
condition|)
block|{
if|if
condition|(
name|ldns_rr_list2buffer_str_fmt
argument_list|(
name|tmp_buffer
argument_list|,
name|fmt
argument_list|,
name|list
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{ 		}
block|}
else|else
block|{
if|if
condition|(
name|fmt
operator|==
name|NULL
condition|)
block|{
name|fmt
operator|=
name|ldns_output_format_default
expr_stmt|;
block|}
if|if
condition|(
name|fmt
operator|->
name|flags
operator|&
name|LDNS_COMMENT_NULLS
condition|)
block|{
name|ldns_buffer_printf
argument_list|(
name|tmp_buffer
argument_list|,
literal|"; (null)\n"
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* export and return string, destroy rest */
name|result
operator|=
name|ldns_buffer_export2str
argument_list|(
name|tmp_buffer
argument_list|)
expr_stmt|;
name|ldns_buffer_free
argument_list|(
name|tmp_buffer
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|ldns_rr_list2str
parameter_list|(
specifier|const
name|ldns_rr_list
modifier|*
name|list
parameter_list|)
block|{
return|return
name|ldns_rr_list2str_fmt
argument_list|(
name|ldns_output_format_default
argument_list|,
name|list
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|ldns_rdf_print
parameter_list|(
name|FILE
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|rdf
parameter_list|)
block|{
name|char
modifier|*
name|str
init|=
name|ldns_rdf2str
argument_list|(
name|rdf
argument_list|)
decl_stmt|;
if|if
condition|(
name|str
condition|)
block|{
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|output
argument_list|,
literal|";Unable to convert rdf to string\n"
argument_list|)
expr_stmt|;
block|}
name|LDNS_FREE
argument_list|(
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_rr_print_fmt
parameter_list|(
name|FILE
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_rr
modifier|*
name|rr
parameter_list|)
block|{
name|char
modifier|*
name|str
init|=
name|ldns_rr2str_fmt
argument_list|(
name|fmt
argument_list|,
name|rr
argument_list|)
decl_stmt|;
if|if
condition|(
name|str
condition|)
block|{
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|output
argument_list|,
literal|";Unable to convert rr to string\n"
argument_list|)
expr_stmt|;
block|}
name|LDNS_FREE
argument_list|(
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_rr_print
parameter_list|(
name|FILE
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rr
modifier|*
name|rr
parameter_list|)
block|{
name|ldns_rr_print_fmt
argument_list|(
name|output
argument_list|,
name|ldns_output_format_default
argument_list|,
name|rr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_print_fmt
parameter_list|(
name|FILE
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_pkt
modifier|*
name|pkt
parameter_list|)
block|{
name|char
modifier|*
name|str
init|=
name|ldns_pkt2str_fmt
argument_list|(
name|fmt
argument_list|,
name|pkt
argument_list|)
decl_stmt|;
if|if
condition|(
name|str
condition|)
block|{
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"%s"
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|output
argument_list|,
literal|";Unable to convert packet to string\n"
argument_list|)
expr_stmt|;
block|}
name|LDNS_FREE
argument_list|(
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_print
parameter_list|(
name|FILE
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_pkt
modifier|*
name|pkt
parameter_list|)
block|{
name|ldns_pkt_print_fmt
argument_list|(
name|output
argument_list|,
name|ldns_output_format_default
argument_list|,
name|pkt
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_rr_list_print_fmt
parameter_list|(
name|FILE
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_rr_list
modifier|*
name|lst
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_list_rr_count
argument_list|(
name|lst
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|ldns_rr_print_fmt
argument_list|(
name|output
argument_list|,
name|fmt
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|lst
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|ldns_rr_list_print
parameter_list|(
name|FILE
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_rr_list
modifier|*
name|lst
parameter_list|)
block|{
name|ldns_rr_list_print_fmt
argument_list|(
name|output
argument_list|,
name|ldns_output_format_default
argument_list|,
name|lst
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_resolver_print_fmt
parameter_list|(
name|FILE
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_resolver
modifier|*
name|r
parameter_list|)
block|{
name|uint16_t
name|i
decl_stmt|;
name|ldns_rdf
modifier|*
modifier|*
name|n
decl_stmt|;
name|ldns_rdf
modifier|*
modifier|*
name|s
decl_stmt|;
name|size_t
modifier|*
name|rtt
decl_stmt|;
if|if
condition|(
operator|!
name|r
condition|)
block|{
return|return;
block|}
name|n
operator|=
name|ldns_resolver_nameservers
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|s
operator|=
name|ldns_resolver_searchlist
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|rtt
operator|=
name|ldns_resolver_rtt
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"port: %d\n"
argument_list|,
operator|(
name|int
operator|)
name|ldns_resolver_port
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"edns0 size: %d\n"
argument_list|,
operator|(
name|int
operator|)
name|ldns_resolver_edns_udp_size
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"use ip6: %d\n"
argument_list|,
operator|(
name|int
operator|)
name|ldns_resolver_ip6
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"recursive: %d\n"
argument_list|,
name|ldns_resolver_recursive
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"usevc: %d\n"
argument_list|,
name|ldns_resolver_usevc
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"igntc: %d\n"
argument_list|,
name|ldns_resolver_igntc
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"fail: %d\n"
argument_list|,
name|ldns_resolver_fail
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"retry: %d\n"
argument_list|,
operator|(
name|int
operator|)
name|ldns_resolver_retry
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"retrans: %d\n"
argument_list|,
operator|(
name|int
operator|)
name|ldns_resolver_retrans
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"fallback: %d\n"
argument_list|,
name|ldns_resolver_fallback
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"random: %d\n"
argument_list|,
name|ldns_resolver_random
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"timeout: %d\n"
argument_list|,
operator|(
name|int
operator|)
name|ldns_resolver_timeout
argument_list|(
name|r
argument_list|)
operator|.
name|tv_sec
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"dnssec: %d\n"
argument_list|,
name|ldns_resolver_dnssec
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"dnssec cd: %d\n"
argument_list|,
name|ldns_resolver_dnssec_cd
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"trust anchors (%d listed):\n"
argument_list|,
operator|(
name|int
operator|)
name|ldns_rr_list_rr_count
argument_list|(
name|ldns_resolver_dnssec_anchors
argument_list|(
name|r
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_rr_list_print_fmt
argument_list|(
name|output
argument_list|,
name|fmt
argument_list|,
name|ldns_resolver_dnssec_anchors
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"tsig: %s %s\n"
argument_list|,
name|ldns_resolver_tsig_keyname
argument_list|(
name|r
argument_list|)
condition|?
name|ldns_resolver_tsig_keyname
argument_list|(
name|r
argument_list|)
else|:
literal|"-"
argument_list|,
name|ldns_resolver_tsig_algorithm
argument_list|(
name|r
argument_list|)
condition|?
name|ldns_resolver_tsig_algorithm
argument_list|(
name|r
argument_list|)
else|:
literal|"-"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"debug: %d\n"
argument_list|,
name|ldns_resolver_debug
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"default domain: "
argument_list|)
expr_stmt|;
name|ldns_rdf_print
argument_list|(
name|output
argument_list|,
name|ldns_resolver_domain
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"apply default domain: %d\n"
argument_list|,
name|ldns_resolver_defnames
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"searchlist (%d listed):\n"
argument_list|,
operator|(
name|int
operator|)
name|ldns_resolver_searchlist_count
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_resolver_searchlist_count
argument_list|(
name|r
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
name|ldns_rdf_print
argument_list|(
name|output
argument_list|,
name|s
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"apply search list: %d\n"
argument_list|,
name|ldns_resolver_dnsrch
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"nameservers (%d listed):\n"
argument_list|,
operator|(
name|int
operator|)
name|ldns_resolver_nameserver_count
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_resolver_nameserver_count
argument_list|(
name|r
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|output
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
name|ldns_rdf_print
argument_list|(
name|output
argument_list|,
name|n
index|[
name|i
index|]
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|int
operator|)
name|rtt
index|[
name|i
index|]
condition|)
block|{
case|case
name|LDNS_RESOLV_RTT_MIN
case|:
name|fprintf
argument_list|(
name|output
argument_list|,
literal|" - reachable\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_RESOLV_RTT_INF
case|:
name|fprintf
argument_list|(
name|output
argument_list|,
literal|" - unreachable\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_function
name|void
name|ldns_resolver_print
parameter_list|(
name|FILE
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_resolver
modifier|*
name|r
parameter_list|)
block|{
name|ldns_resolver_print_fmt
argument_list|(
name|output
argument_list|,
name|ldns_output_format_default
argument_list|,
name|r
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_zone_print_fmt
parameter_list|(
name|FILE
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_output_format
modifier|*
name|fmt
parameter_list|,
specifier|const
name|ldns_zone
modifier|*
name|z
parameter_list|)
block|{
if|if
condition|(
name|ldns_zone_soa
argument_list|(
name|z
argument_list|)
condition|)
name|ldns_rr_print_fmt
argument_list|(
name|output
argument_list|,
name|fmt
argument_list|,
name|ldns_zone_soa
argument_list|(
name|z
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_rr_list_print_fmt
argument_list|(
name|output
argument_list|,
name|fmt
argument_list|,
name|ldns_zone_rrs
argument_list|(
name|z
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_zone_print
parameter_list|(
name|FILE
modifier|*
name|output
parameter_list|,
specifier|const
name|ldns_zone
modifier|*
name|z
parameter_list|)
block|{
name|ldns_zone_print_fmt
argument_list|(
name|output
argument_list|,
name|ldns_output_format_default
argument_list|,
name|z
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

