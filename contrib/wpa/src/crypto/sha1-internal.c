begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * SHA1 hash implementation and interface functions  * Copyright (c) 2003-2005, Jouni Malinen<j@w1.fi>  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_include
include|#
directive|include
file|"common.h"
end_include

begin_include
include|#
directive|include
file|"sha1.h"
end_include

begin_include
include|#
directive|include
file|"sha1_i.h"
end_include

begin_include
include|#
directive|include
file|"md5.h"
end_include

begin_include
include|#
directive|include
file|"crypto.h"
end_include

begin_typedef
typedef|typedef
name|struct
name|SHA1Context
name|SHA1_CTX
typedef|;
end_typedef

begin_function_decl
name|void
name|SHA1Transform
parameter_list|(
name|u32
name|state
index|[
literal|5
index|]
parameter_list|,
specifier|const
name|unsigned
name|char
name|buffer
index|[
literal|64
index|]
parameter_list|)
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_CRYPTO_INTERNAL
end_ifdef

begin_comment
comment|/**  * sha1_vector - SHA-1 hash for data vector  * @num_elem: Number of elements in the data vector  * @addr: Pointers to the data areas  * @len: Lengths of the data blocks  * @mac: Buffer for the hash  * Returns: 0 on success, -1 of failure  */
end_comment

begin_function
name|int
name|sha1_vector
parameter_list|(
name|size_t
name|num_elem
parameter_list|,
specifier|const
name|u8
modifier|*
name|addr
index|[]
parameter_list|,
specifier|const
name|size_t
modifier|*
name|len
parameter_list|,
name|u8
modifier|*
name|mac
parameter_list|)
block|{
name|SHA1_CTX
name|ctx
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|SHA1Init
argument_list|(
operator|&
name|ctx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_elem
condition|;
name|i
operator|++
control|)
name|SHA1Update
argument_list|(
operator|&
name|ctx
argument_list|,
name|addr
index|[
name|i
index|]
argument_list|,
name|len
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|SHA1Final
argument_list|(
name|mac
argument_list|,
operator|&
name|ctx
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_CRYPTO_INTERNAL */
end_comment

begin_comment
comment|/* ===== start - public domain SHA1 implementation ===== */
end_comment

begin_comment
comment|/* SHA-1 in C By Steve Reid<sreid@sea-to-sky.net> 100% Public Domain  ----------------- Modified 7/98  By James H. Brown<jbrown@burgoyne.com> Still 100% Public Domain  Corrected a problem which generated improper hash values on 16 bit machines Routine SHA1Update changed from 	void SHA1Update(SHA1_CTX* context, unsigned char* data, unsigned int len) to 	void SHA1Update(SHA1_CTX* context, unsigned char* data, unsigned long len)  The 'len' parameter was declared an int which works fine on 32 bit machines. However, on 16 bit machines an int is too small for the shifts being done against it.  This caused the hash function to generate incorrect values if len was greater than 8191 (8K - 1) due to the 'len<< 3' on line 3 of SHA1Update().  Since the file IO in main() reads 16K at a time, any file 8K or larger would be guaranteed to generate the wrong hash (e.g. Test Vector #3, a million "a"s).  I also changed the declaration of variables i& j in SHA1Update to  unsigned long from unsigned int for the same reason.  These changes should make no difference to any 32 bit implementations since an int and a long are the same size in those environments.  -- I also corrected a few compiler warnings generated by Borland C. 1. Added #include<process.h> for exit() prototype 2. Removed unused variable 'j' in SHA1Final 3. Changed exit(0) to return(0) at end of main.  ALL changes I made can be located by searching for comments containing 'JHB' ----------------- Modified 8/98 By Steve Reid<sreid@sea-to-sky.net> Still 100% public domain  1- Removed #include<process.h> and used return() instead of exit() 2- Fixed overwriting of finalcount in SHA1Final() (discovered by Chris Hall) 3- Changed email address from steve@edmweb.com to sreid@sea-to-sky.net  ----------------- Modified 4/01 By Saul Kravitz<Saul.Kravitz@celera.com> Still 100% PD Modified to run on Compaq Alpha hardware.    ----------------- Modified 4/01 By Jouni Malinen<j@w1.fi> Minor changes to match the coding style used in Dynamics.  Modified September 24, 2004 By Jouni Malinen<j@w1.fi> Fixed alignment issue in SHA1Transform when SHA1HANDSOFF is defined.  */
end_comment

begin_comment
comment|/* Test Vectors (from FIPS PUB 180-1) "abc"   A9993E36 4706816A BA3E2571 7850C26C 9CD0D89D "abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq"   84983E44 1C3BD26E BAAE4AA1 F95129E5 E54670F1 A million repetitions of "a"   34AA973C D4C4DAA4 F61EEB2B DBAD2731 6534016F */
end_comment

begin_define
define|#
directive|define
name|SHA1HANDSOFF
end_define

begin_define
define|#
directive|define
name|rol
parameter_list|(
name|value
parameter_list|,
name|bits
parameter_list|)
value|(((value)<< (bits)) | ((value)>> (32 - (bits))))
end_define

begin_comment
comment|/* blk0() and blk() perform the initial expand. */
end_comment

begin_comment
comment|/* I got the idea of expanding during the round function from SSLeay */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|WORDS_BIGENDIAN
end_ifndef

begin_define
define|#
directive|define
name|blk0
parameter_list|(
name|i
parameter_list|)
value|(block->l[i] = (rol(block->l[i], 24)& 0xFF00FF00) | \ 	(rol(block->l[i], 8)& 0x00FF00FF))
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|blk0
parameter_list|(
name|i
parameter_list|)
value|block->l[i]
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|blk
parameter_list|(
name|i
parameter_list|)
value|(block->l[i& 15] = rol(block->l[(i + 13)& 15] ^ \ 	block->l[(i + 8)& 15] ^ block->l[(i + 2)& 15] ^ block->l[i& 15], 1))
end_define

begin_comment
comment|/* (R0+R1), R2, R3, R4 are the different operations used in SHA1 */
end_comment

begin_define
define|#
directive|define
name|R0
parameter_list|(
name|v
parameter_list|,
name|w
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|,
name|i
parameter_list|)
define|\
value|z += ((w& (x ^ y)) ^ y) + blk0(i) + 0x5A827999 + rol(v, 5); \ 	w = rol(w, 30);
end_define

begin_define
define|#
directive|define
name|R1
parameter_list|(
name|v
parameter_list|,
name|w
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|,
name|i
parameter_list|)
define|\
value|z += ((w& (x ^ y)) ^ y) + blk(i) + 0x5A827999 + rol(v, 5); \ 	w = rol(w, 30);
end_define

begin_define
define|#
directive|define
name|R2
parameter_list|(
name|v
parameter_list|,
name|w
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|,
name|i
parameter_list|)
define|\
value|z += (w ^ x ^ y) + blk(i) + 0x6ED9EBA1 + rol(v, 5); w = rol(w, 30);
end_define

begin_define
define|#
directive|define
name|R3
parameter_list|(
name|v
parameter_list|,
name|w
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|,
name|i
parameter_list|)
define|\
value|z += (((w | x)& y) | (w& x)) + blk(i) + 0x8F1BBCDC + rol(v, 5); \ 	w = rol(w, 30);
end_define

begin_define
define|#
directive|define
name|R4
parameter_list|(
name|v
parameter_list|,
name|w
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|,
name|i
parameter_list|)
define|\
value|z += (w ^ x ^ y) + blk(i) + 0xCA62C1D6 + rol(v, 5); \ 	w=rol(w, 30);
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|VERBOSE
end_ifdef

begin_comment
comment|/* SAK */
end_comment

begin_function
name|void
name|SHAPrintContext
parameter_list|(
name|SHA1_CTX
modifier|*
name|context
parameter_list|,
name|char
modifier|*
name|msg
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s (%d,%d) %x %x %x %x %x\n"
argument_list|,
name|msg
argument_list|,
name|context
operator|->
name|count
index|[
literal|0
index|]
argument_list|,
name|context
operator|->
name|count
index|[
literal|1
index|]
argument_list|,
name|context
operator|->
name|state
index|[
literal|0
index|]
argument_list|,
name|context
operator|->
name|state
index|[
literal|1
index|]
argument_list|,
name|context
operator|->
name|state
index|[
literal|2
index|]
argument_list|,
name|context
operator|->
name|state
index|[
literal|3
index|]
argument_list|,
name|context
operator|->
name|state
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* Hash a single 512-bit block. This is the core of the algorithm. */
end_comment

begin_function
name|void
name|SHA1Transform
parameter_list|(
name|u32
name|state
index|[
literal|5
index|]
parameter_list|,
specifier|const
name|unsigned
name|char
name|buffer
index|[
literal|64
index|]
parameter_list|)
block|{
name|u32
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|,
name|e
decl_stmt|;
typedef|typedef
union|union
block|{
name|unsigned
name|char
name|c
index|[
literal|64
index|]
decl_stmt|;
name|u32
name|l
index|[
literal|16
index|]
decl_stmt|;
block|}
name|CHAR64LONG16
typedef|;
name|CHAR64LONG16
modifier|*
name|block
decl_stmt|;
ifdef|#
directive|ifdef
name|SHA1HANDSOFF
name|CHAR64LONG16
name|workspace
decl_stmt|;
name|block
operator|=
operator|&
name|workspace
expr_stmt|;
name|os_memcpy
argument_list|(
name|block
argument_list|,
name|buffer
argument_list|,
literal|64
argument_list|)
expr_stmt|;
else|#
directive|else
name|block
operator|=
operator|(
name|CHAR64LONG16
operator|*
operator|)
name|buffer
expr_stmt|;
endif|#
directive|endif
comment|/* Copy context->state[] to working vars */
name|a
operator|=
name|state
index|[
literal|0
index|]
expr_stmt|;
name|b
operator|=
name|state
index|[
literal|1
index|]
expr_stmt|;
name|c
operator|=
name|state
index|[
literal|2
index|]
expr_stmt|;
name|d
operator|=
name|state
index|[
literal|3
index|]
expr_stmt|;
name|e
operator|=
name|state
index|[
literal|4
index|]
expr_stmt|;
comment|/* 4 rounds of 20 operations each. Loop unrolled. */
name|R0
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|13
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|14
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|15
argument_list|)
expr_stmt|;
name|R1
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|R1
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|17
argument_list|)
expr_stmt|;
name|R1
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|18
argument_list|)
expr_stmt|;
name|R1
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|19
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|22
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|23
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|26
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|27
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|28
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|29
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|31
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|32
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|33
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|34
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|35
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|36
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|37
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|38
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|39
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|41
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|42
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|43
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|44
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|45
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|46
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|47
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|48
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|49
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|51
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|52
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|53
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|54
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|55
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|56
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|57
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|58
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|59
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|60
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|61
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|62
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|63
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|64
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|65
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|66
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|67
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|68
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|69
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|70
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|71
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|72
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|73
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|74
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|75
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|76
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|77
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|78
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|79
argument_list|)
expr_stmt|;
comment|/* Add the working vars back into context.state[] */
name|state
index|[
literal|0
index|]
operator|+=
name|a
expr_stmt|;
name|state
index|[
literal|1
index|]
operator|+=
name|b
expr_stmt|;
name|state
index|[
literal|2
index|]
operator|+=
name|c
expr_stmt|;
name|state
index|[
literal|3
index|]
operator|+=
name|d
expr_stmt|;
name|state
index|[
literal|4
index|]
operator|+=
name|e
expr_stmt|;
comment|/* Wipe variables */
name|a
operator|=
name|b
operator|=
name|c
operator|=
name|d
operator|=
name|e
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|SHA1HANDSOFF
name|os_memset
argument_list|(
name|block
argument_list|,
literal|0
argument_list|,
literal|64
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* SHA1Init - Initialize new context */
end_comment

begin_function
name|void
name|SHA1Init
parameter_list|(
name|SHA1_CTX
modifier|*
name|context
parameter_list|)
block|{
comment|/* SHA1 initialization constants */
name|context
operator|->
name|state
index|[
literal|0
index|]
operator|=
literal|0x67452301
expr_stmt|;
name|context
operator|->
name|state
index|[
literal|1
index|]
operator|=
literal|0xEFCDAB89
expr_stmt|;
name|context
operator|->
name|state
index|[
literal|2
index|]
operator|=
literal|0x98BADCFE
expr_stmt|;
name|context
operator|->
name|state
index|[
literal|3
index|]
operator|=
literal|0x10325476
expr_stmt|;
name|context
operator|->
name|state
index|[
literal|4
index|]
operator|=
literal|0xC3D2E1F0
expr_stmt|;
name|context
operator|->
name|count
index|[
literal|0
index|]
operator|=
name|context
operator|->
name|count
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Run your data through this. */
end_comment

begin_function
name|void
name|SHA1Update
parameter_list|(
name|SHA1_CTX
modifier|*
name|context
parameter_list|,
specifier|const
name|void
modifier|*
name|_data
parameter_list|,
name|u32
name|len
parameter_list|)
block|{
name|u32
name|i
decl_stmt|,
name|j
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|data
init|=
name|_data
decl_stmt|;
ifdef|#
directive|ifdef
name|VERBOSE
name|SHAPrintContext
argument_list|(
name|context
argument_list|,
literal|"before"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|j
operator|=
operator|(
name|context
operator|->
name|count
index|[
literal|0
index|]
operator|>>
literal|3
operator|)
operator|&
literal|63
expr_stmt|;
if|if
condition|(
operator|(
name|context
operator|->
name|count
index|[
literal|0
index|]
operator|+=
name|len
operator|<<
literal|3
operator|)
operator|<
operator|(
name|len
operator|<<
literal|3
operator|)
condition|)
name|context
operator|->
name|count
index|[
literal|1
index|]
operator|++
expr_stmt|;
name|context
operator|->
name|count
index|[
literal|1
index|]
operator|+=
operator|(
name|len
operator|>>
literal|29
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|j
operator|+
name|len
operator|)
operator|>
literal|63
condition|)
block|{
name|os_memcpy
argument_list|(
operator|&
name|context
operator|->
name|buffer
index|[
name|j
index|]
argument_list|,
name|data
argument_list|,
operator|(
name|i
operator|=
literal|64
operator|-
name|j
operator|)
argument_list|)
expr_stmt|;
name|SHA1Transform
argument_list|(
name|context
operator|->
name|state
argument_list|,
name|context
operator|->
name|buffer
argument_list|)
expr_stmt|;
for|for
control|(
init|;
name|i
operator|+
literal|63
operator|<
name|len
condition|;
name|i
operator|+=
literal|64
control|)
block|{
name|SHA1Transform
argument_list|(
name|context
operator|->
name|state
argument_list|,
operator|&
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|j
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|i
operator|=
literal|0
expr_stmt|;
name|os_memcpy
argument_list|(
operator|&
name|context
operator|->
name|buffer
index|[
name|j
index|]
argument_list|,
operator|&
name|data
index|[
name|i
index|]
argument_list|,
name|len
operator|-
name|i
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|VERBOSE
name|SHAPrintContext
argument_list|(
name|context
argument_list|,
literal|"after "
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Add padding and return the message digest. */
end_comment

begin_function
name|void
name|SHA1Final
parameter_list|(
name|unsigned
name|char
name|digest
index|[
literal|20
index|]
parameter_list|,
name|SHA1_CTX
modifier|*
name|context
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|unsigned
name|char
name|finalcount
index|[
literal|8
index|]
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|finalcount
index|[
name|i
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
operator|(
name|context
operator|->
name|count
index|[
operator|(
name|i
operator|>=
literal|4
condition|?
literal|0
else|:
literal|1
operator|)
index|]
operator|>>
operator|(
operator|(
literal|3
operator|-
operator|(
name|i
operator|&
literal|3
operator|)
operator|)
operator|*
literal|8
operator|)
operator|)
operator|&
literal|255
argument_list|)
expr_stmt|;
comment|/* Endian independent */
block|}
name|SHA1Update
argument_list|(
name|context
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
literal|"\200"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|context
operator|->
name|count
index|[
literal|0
index|]
operator|&
literal|504
operator|)
operator|!=
literal|448
condition|)
block|{
name|SHA1Update
argument_list|(
name|context
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
literal|"\0"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
name|SHA1Update
argument_list|(
name|context
argument_list|,
name|finalcount
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* Should cause a SHA1Transform() 					      */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|20
condition|;
name|i
operator|++
control|)
block|{
name|digest
index|[
name|i
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
operator|(
name|context
operator|->
name|state
index|[
name|i
operator|>>
literal|2
index|]
operator|>>
operator|(
operator|(
literal|3
operator|-
operator|(
name|i
operator|&
literal|3
operator|)
operator|)
operator|*
literal|8
operator|)
operator|)
operator|&
literal|255
argument_list|)
expr_stmt|;
block|}
comment|/* Wipe variables */
name|i
operator|=
literal|0
expr_stmt|;
name|os_memset
argument_list|(
name|context
operator|->
name|buffer
argument_list|,
literal|0
argument_list|,
literal|64
argument_list|)
expr_stmt|;
name|os_memset
argument_list|(
name|context
operator|->
name|state
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|os_memset
argument_list|(
name|context
operator|->
name|count
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|os_memset
argument_list|(
name|finalcount
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ===== end - public domain SHA1 implementation ===== */
end_comment

end_unit

