begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * hostapd / EAP Authenticator state machine internal structures (RFC 4137)  * Copyright (c) 2004-2007, Jouni Malinen<j@w1.fi>  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|EAP_I_H
end_ifndef

begin_define
define|#
directive|define
name|EAP_I_H
end_define

begin_include
include|#
directive|include
file|"wpabuf.h"
end_include

begin_include
include|#
directive|include
file|"eap_server/eap.h"
end_include

begin_include
include|#
directive|include
file|"eap_common/eap_common.h"
end_include

begin_comment
comment|/* RFC 4137 - EAP Standalone Authenticator */
end_comment

begin_comment
comment|/**  * struct eap_method - EAP method interface  * This structure defines the EAP method interface. Each method will need to  * register its own EAP type, EAP name, and set of function pointers for method  * specific operations. This interface is based on section 5.4 of RFC 4137.  */
end_comment

begin_struct
struct|struct
name|eap_method
block|{
name|int
name|vendor
decl_stmt|;
name|EapType
name|method
decl_stmt|;
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|void
modifier|*
function_decl|(
modifier|*
name|init
function_decl|)
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|)
function_decl|;
name|void
modifier|*
function_decl|(
modifier|*
name|initPickUp
function_decl|)
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|)
function_decl|;
name|void
function_decl|(
modifier|*
name|reset
function_decl|)
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|,
name|void
modifier|*
name|priv
parameter_list|)
function_decl|;
name|struct
name|wpabuf
modifier|*
function_decl|(
modifier|*
name|buildReq
function_decl|)
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|,
name|void
modifier|*
name|priv
parameter_list|,
name|u8
name|id
parameter_list|)
function_decl|;
name|int
function_decl|(
modifier|*
name|getTimeout
function_decl|)
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|,
name|void
modifier|*
name|priv
parameter_list|)
function_decl|;
name|Boolean
function_decl|(
modifier|*
name|check
function_decl|)
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|,
name|void
modifier|*
name|priv
parameter_list|,
name|struct
name|wpabuf
modifier|*
name|respData
parameter_list|)
function_decl|;
name|void
function_decl|(
modifier|*
name|process
function_decl|)
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|,
name|void
modifier|*
name|priv
parameter_list|,
name|struct
name|wpabuf
modifier|*
name|respData
parameter_list|)
function_decl|;
name|Boolean
function_decl|(
modifier|*
name|isDone
function_decl|)
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|,
name|void
modifier|*
name|priv
parameter_list|)
function_decl|;
name|u8
modifier|*
function_decl|(
modifier|*
name|getKey
function_decl|)
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|,
name|void
modifier|*
name|priv
parameter_list|,
name|size_t
modifier|*
name|len
parameter_list|)
function_decl|;
comment|/* isSuccess is not specified in draft-ietf-eap-statemachine-05.txt, 	 * but it is useful in implementing Policy.getDecision() */
name|Boolean
function_decl|(
modifier|*
name|isSuccess
function_decl|)
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|,
name|void
modifier|*
name|priv
parameter_list|)
function_decl|;
comment|/** 	 * free - Free EAP method data 	 * @method: Pointer to the method data registered with 	 * eap_server_method_register(). 	 * 	 * This function will be called when the EAP method is being 	 * unregistered. If the EAP method allocated resources during 	 * registration (e.g., allocated struct eap_method), they should be 	 * freed in this function. No other method functions will be called 	 * after this call. If this function is not defined (i.e., function 	 * pointer is %NULL), a default handler is used to release the method 	 * data with free(method). This is suitable for most cases. 	 */
name|void
function_decl|(
modifier|*
name|free
function_decl|)
parameter_list|(
name|struct
name|eap_method
modifier|*
name|method
parameter_list|)
function_decl|;
define|#
directive|define
name|EAP_SERVER_METHOD_INTERFACE_VERSION
value|1
comment|/** 	 * version - Version of the EAP server method interface 	 * 	 * The EAP server method implementation should set this variable to 	 * EAP_SERVER_METHOD_INTERFACE_VERSION. This is used to verify that the 	 * EAP method is using supported API version when using dynamically 	 * loadable EAP methods. 	 */
name|int
name|version
decl_stmt|;
comment|/** 	 * next - Pointer to the next EAP method 	 * 	 * This variable is used internally in the EAP method registration code 	 * to create a linked list of registered EAP methods. 	 */
name|struct
name|eap_method
modifier|*
name|next
decl_stmt|;
comment|/** 	 * get_emsk - Get EAP method specific keying extended material (EMSK) 	 * @sm: Pointer to EAP state machine allocated with eap_sm_init() 	 * @priv: Pointer to private EAP method data from eap_method::init() 	 * @len: Pointer to a variable to store EMSK length 	 * Returns: EMSK or %NULL if not available 	 * 	 * This function can be used to get the extended keying material from 	 * the EAP method. The key may already be stored in the method-specific 	 * private data or this function may derive the key. 	 */
name|u8
modifier|*
function_decl|(
modifier|*
name|get_emsk
function_decl|)
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|,
name|void
modifier|*
name|priv
parameter_list|,
name|size_t
modifier|*
name|len
parameter_list|)
function_decl|;
block|}
struct|;
end_struct

begin_comment
comment|/**  * struct eap_sm - EAP server state machine data  */
end_comment

begin_struct
struct|struct
name|eap_sm
block|{
enum|enum
block|{
name|EAP_DISABLED
block|,
name|EAP_INITIALIZE
block|,
name|EAP_IDLE
block|,
name|EAP_RECEIVED
block|,
name|EAP_INTEGRITY_CHECK
block|,
name|EAP_METHOD_RESPONSE
block|,
name|EAP_METHOD_REQUEST
block|,
name|EAP_PROPOSE_METHOD
block|,
name|EAP_SELECT_ACTION
block|,
name|EAP_SEND_REQUEST
block|,
name|EAP_DISCARD
block|,
name|EAP_NAK
block|,
name|EAP_RETRANSMIT
block|,
name|EAP_SUCCESS
block|,
name|EAP_FAILURE
block|,
name|EAP_TIMEOUT_FAILURE
block|,
name|EAP_PICK_UP_METHOD
block|,
name|EAP_INITIALIZE_PASSTHROUGH
block|,
name|EAP_IDLE2
block|,
name|EAP_RETRANSMIT2
block|,
name|EAP_RECEIVED2
block|,
name|EAP_DISCARD2
block|,
name|EAP_SEND_REQUEST2
block|,
name|EAP_AAA_REQUEST
block|,
name|EAP_AAA_RESPONSE
block|,
name|EAP_AAA_IDLE
block|,
name|EAP_TIMEOUT_FAILURE2
block|,
name|EAP_FAILURE2
block|,
name|EAP_SUCCESS2
block|}
name|EAP_state
enum|;
comment|/* Constants */
name|int
name|MaxRetrans
decl_stmt|;
name|struct
name|eap_eapol_interface
name|eap_if
decl_stmt|;
comment|/* Full authenticator state machine local variables */
comment|/* Long-term (maintained between packets) */
name|EapType
name|currentMethod
decl_stmt|;
name|int
name|currentId
decl_stmt|;
enum|enum
block|{
name|METHOD_PROPOSED
block|,
name|METHOD_CONTINUE
block|,
name|METHOD_END
block|}
name|methodState
enum|;
name|int
name|retransCount
decl_stmt|;
name|struct
name|wpabuf
modifier|*
name|lastReqData
decl_stmt|;
name|int
name|methodTimeout
decl_stmt|;
comment|/* Short-term (not maintained between packets) */
name|Boolean
name|rxResp
decl_stmt|;
name|int
name|respId
decl_stmt|;
name|EapType
name|respMethod
decl_stmt|;
name|int
name|respVendor
decl_stmt|;
name|u32
name|respVendorMethod
decl_stmt|;
name|Boolean
name|ignore
decl_stmt|;
enum|enum
block|{
name|DECISION_SUCCESS
block|,
name|DECISION_FAILURE
block|,
name|DECISION_CONTINUE
block|,
name|DECISION_PASSTHROUGH
block|}
name|decision
enum|;
comment|/* Miscellaneous variables */
specifier|const
name|struct
name|eap_method
modifier|*
name|m
decl_stmt|;
comment|/* selected EAP method */
comment|/* not defined in RFC 4137 */
name|Boolean
name|changed
decl_stmt|;
name|void
modifier|*
name|eapol_ctx
decl_stmt|,
modifier|*
name|msg_ctx
decl_stmt|;
name|struct
name|eapol_callbacks
modifier|*
name|eapol_cb
decl_stmt|;
name|void
modifier|*
name|eap_method_priv
decl_stmt|;
name|u8
modifier|*
name|identity
decl_stmt|;
name|size_t
name|identity_len
decl_stmt|;
comment|/* Whether Phase 2 method should validate identity match */
name|int
name|require_identity_match
decl_stmt|;
name|int
name|lastId
decl_stmt|;
comment|/* Identifier used in the last EAP-Packet */
name|struct
name|eap_user
modifier|*
name|user
decl_stmt|;
name|int
name|user_eap_method_index
decl_stmt|;
name|int
name|init_phase2
decl_stmt|;
name|void
modifier|*
name|ssl_ctx
decl_stmt|;
name|struct
name|eap_sim_db_data
modifier|*
name|eap_sim_db_priv
decl_stmt|;
name|Boolean
name|backend_auth
decl_stmt|;
name|Boolean
name|update_user
decl_stmt|;
name|int
name|eap_server
decl_stmt|;
name|int
name|num_rounds
decl_stmt|;
enum|enum
block|{
name|METHOD_PENDING_NONE
block|,
name|METHOD_PENDING_WAIT
block|,
name|METHOD_PENDING_CONT
block|}
name|method_pending
enum|;
name|u8
modifier|*
name|auth_challenge
decl_stmt|;
name|u8
modifier|*
name|peer_challenge
decl_stmt|;
name|u8
modifier|*
name|pac_opaque_encr_key
decl_stmt|;
name|u8
modifier|*
name|eap_fast_a_id
decl_stmt|;
name|size_t
name|eap_fast_a_id_len
decl_stmt|;
name|char
modifier|*
name|eap_fast_a_id_info
decl_stmt|;
enum|enum
block|{
name|NO_PROV
block|,
name|ANON_PROV
block|,
name|AUTH_PROV
block|,
name|BOTH_PROV
block|}
name|eap_fast_prov
enum|;
name|int
name|pac_key_lifetime
decl_stmt|;
name|int
name|pac_key_refresh_time
decl_stmt|;
name|int
name|eap_sim_aka_result_ind
decl_stmt|;
name|int
name|tnc
decl_stmt|;
name|u16
name|pwd_group
decl_stmt|;
name|struct
name|wps_context
modifier|*
name|wps
decl_stmt|;
name|struct
name|wpabuf
modifier|*
name|assoc_wps_ie
decl_stmt|;
name|struct
name|wpabuf
modifier|*
name|assoc_p2p_ie
decl_stmt|;
name|Boolean
name|start_reauth
decl_stmt|;
name|u8
name|peer_addr
index|[
name|ETH_ALEN
index|]
decl_stmt|;
comment|/* Fragmentation size for EAP method init() handler */
name|int
name|fragment_size
decl_stmt|;
name|int
name|pbc_in_m1
decl_stmt|;
block|}
struct|;
end_struct

begin_function_decl
name|int
name|eap_user_get
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|,
specifier|const
name|u8
modifier|*
name|identity
parameter_list|,
name|size_t
name|identity_len
parameter_list|,
name|int
name|phase2
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|eap_sm_process_nak
parameter_list|(
name|struct
name|eap_sm
modifier|*
name|sm
parameter_list|,
specifier|const
name|u8
modifier|*
name|nak_list
parameter_list|,
name|size_t
name|len
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* EAP_I_H */
end_comment

end_unit

