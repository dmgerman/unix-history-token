begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * WPA Supplicant - PeerKey for Direct Link Setup (DLS)  * Copyright (c) 2006-2008, Jouni Malinen<j@w1.fi>  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|PEERKEY_H
end_ifndef

begin_define
define|#
directive|define
name|PEERKEY_H
end_define

begin_define
define|#
directive|define
name|PEERKEY_MAX_IE_LEN
value|80
end_define

begin_struct
struct|struct
name|wpa_peerkey
block|{
name|struct
name|wpa_peerkey
modifier|*
name|next
decl_stmt|;
name|int
name|initiator
decl_stmt|;
comment|/* whether this end was initator for SMK handshake */
name|u8
name|addr
index|[
name|ETH_ALEN
index|]
decl_stmt|;
comment|/* other end MAC address */
name|u8
name|inonce
index|[
name|WPA_NONCE_LEN
index|]
decl_stmt|;
comment|/* Initiator Nonce */
name|u8
name|pnonce
index|[
name|WPA_NONCE_LEN
index|]
decl_stmt|;
comment|/* Peer Nonce */
name|u8
name|rsnie_i
index|[
name|PEERKEY_MAX_IE_LEN
index|]
decl_stmt|;
comment|/* Initiator RSN IE */
name|size_t
name|rsnie_i_len
decl_stmt|;
name|u8
name|rsnie_p
index|[
name|PEERKEY_MAX_IE_LEN
index|]
decl_stmt|;
comment|/* Peer RSN IE */
name|size_t
name|rsnie_p_len
decl_stmt|;
name|u8
name|smk
index|[
name|PMK_LEN
index|]
decl_stmt|;
name|int
name|smk_complete
decl_stmt|;
name|u8
name|smkid
index|[
name|PMKID_LEN
index|]
decl_stmt|;
name|u32
name|lifetime
decl_stmt|;
name|os_time_t
name|expiration
decl_stmt|;
name|int
name|cipher
decl_stmt|;
comment|/* Selected cipher (WPA_CIPHER_*) */
name|u8
name|replay_counter
index|[
name|WPA_REPLAY_COUNTER_LEN
index|]
decl_stmt|;
name|int
name|replay_counter_set
decl_stmt|;
name|int
name|use_sha256
decl_stmt|;
comment|/* whether AKMP indicate SHA256-based derivations */
name|struct
name|wpa_ptk
name|stk
decl_stmt|,
name|tstk
decl_stmt|;
name|int
name|stk_set
decl_stmt|,
name|tstk_set
decl_stmt|;
block|}
struct|;
end_struct

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_PEERKEY
end_ifdef

begin_function_decl
name|int
name|peerkey_verify_eapol_key_mic
parameter_list|(
name|struct
name|wpa_sm
modifier|*
name|sm
parameter_list|,
name|struct
name|wpa_peerkey
modifier|*
name|peerkey
parameter_list|,
name|struct
name|wpa_eapol_key
modifier|*
name|key
parameter_list|,
name|u16
name|ver
parameter_list|,
specifier|const
name|u8
modifier|*
name|buf
parameter_list|,
name|size_t
name|len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|peerkey_rx_eapol_4way
parameter_list|(
name|struct
name|wpa_sm
modifier|*
name|sm
parameter_list|,
name|struct
name|wpa_peerkey
modifier|*
name|peerkey
parameter_list|,
name|struct
name|wpa_eapol_key
modifier|*
name|key
parameter_list|,
name|u16
name|key_info
parameter_list|,
name|u16
name|ver
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|peerkey_rx_eapol_smk
parameter_list|(
name|struct
name|wpa_sm
modifier|*
name|sm
parameter_list|,
specifier|const
name|u8
modifier|*
name|src_addr
parameter_list|,
name|struct
name|wpa_eapol_key
modifier|*
name|key
parameter_list|,
name|size_t
name|extra_len
parameter_list|,
name|u16
name|key_info
parameter_list|,
name|u16
name|ver
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|peerkey_deinit
parameter_list|(
name|struct
name|wpa_sm
modifier|*
name|sm
parameter_list|)
function_decl|;
end_function_decl

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* CONFIG_PEERKEY */
end_comment

begin_function
specifier|static
specifier|inline
name|int
name|peerkey_verify_eapol_key_mic
parameter_list|(
name|struct
name|wpa_sm
modifier|*
name|sm
parameter_list|,
name|struct
name|wpa_peerkey
modifier|*
name|peerkey
parameter_list|,
name|struct
name|wpa_eapol_key
modifier|*
name|key
parameter_list|,
name|u16
name|ver
parameter_list|,
specifier|const
name|u8
modifier|*
name|buf
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|void
name|peerkey_rx_eapol_4way
parameter_list|(
name|struct
name|wpa_sm
modifier|*
name|sm
parameter_list|,
name|struct
name|wpa_peerkey
modifier|*
name|peerkey
parameter_list|,
name|struct
name|wpa_eapol_key
modifier|*
name|key
parameter_list|,
name|u16
name|key_info
parameter_list|,
name|u16
name|ver
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
specifier|inline
name|void
name|peerkey_rx_eapol_smk
parameter_list|(
name|struct
name|wpa_sm
modifier|*
name|sm
parameter_list|,
specifier|const
name|u8
modifier|*
name|src_addr
parameter_list|,
name|struct
name|wpa_eapol_key
modifier|*
name|key
parameter_list|,
name|size_t
name|extra_len
parameter_list|,
name|u16
name|key_info
parameter_list|,
name|u16
name|ver
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
specifier|inline
name|void
name|peerkey_deinit
parameter_list|(
name|struct
name|wpa_sm
modifier|*
name|sm
parameter_list|)
block|{ }
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_PEERKEY */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* PEERKEY_H */
end_comment

end_unit

