begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * SecY Operations  * Copyright (c) 2013, Qualcomm Atheros, Inc.  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_include
include|#
directive|include
file|"utils/includes.h"
end_include

begin_include
include|#
directive|include
file|"utils/common.h"
end_include

begin_include
include|#
directive|include
file|"utils/eloop.h"
end_include

begin_include
include|#
directive|include
file|"common/defs.h"
end_include

begin_include
include|#
directive|include
file|"drivers/driver.h"
end_include

begin_include
include|#
directive|include
file|"pae/ieee802_1x_kay.h"
end_include

begin_include
include|#
directive|include
file|"pae/ieee802_1x_kay_i.h"
end_include

begin_include
include|#
directive|include
file|"pae/ieee802_1x_secy_ops.h"
end_include

begin_function
name|int
name|secy_cp_control_validate_frames
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|enum
name|validate_frames
name|vf
parameter_list|)
block|{
name|kay
operator|->
name|vf
operator|=
name|vf
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|secy_cp_control_protect_frames
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|Boolean
name|enabled
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|enable_protect_frames
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy enable_protect_frames operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|enable_protect_frames
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|enabled
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_cp_control_replay
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|Boolean
name|enabled
parameter_list|,
name|u32
name|win
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|set_replay_protect
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy set_replay_protect operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|set_replay_protect
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|enabled
argument_list|,
name|win
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_cp_control_current_cipher_suite
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
specifier|const
name|u8
modifier|*
name|cs
parameter_list|,
name|size_t
name|cs_len
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|set_current_cipher_suite
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy set_current_cipher_suite operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|set_current_cipher_suite
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|cs
argument_list|,
name|cs_len
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_cp_control_confidentiality_offset
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|enum
name|confidentiality_offset
name|co
parameter_list|)
block|{
name|kay
operator|->
name|co
operator|=
name|co
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|secy_cp_control_enable_port
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|Boolean
name|enabled
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|enable_controlled_port
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy enable_controlled_port operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|enable_controlled_port
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|enabled
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_get_receive_lowest_pn
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|receive_sa
modifier|*
name|rxsa
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|rxsa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|get_receive_lowest_pn
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy get_receive_lowest_pn operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|get_receive_lowest_pn
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|rxsa
operator|->
name|sc
operator|->
name|channel
argument_list|,
name|rxsa
operator|->
name|an
argument_list|,
operator|&
name|rxsa
operator|->
name|lowest_pn
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_get_transmit_next_pn
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|transmit_sa
modifier|*
name|txsa
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|txsa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|get_transmit_next_pn
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy get_receive_lowest_pn operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|get_transmit_next_pn
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|txsa
operator|->
name|sc
operator|->
name|channel
argument_list|,
name|txsa
operator|->
name|an
argument_list|,
operator|&
name|txsa
operator|->
name|next_pn
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_set_transmit_next_pn
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|transmit_sa
modifier|*
name|txsa
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|txsa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|set_transmit_next_pn
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy get_receive_lowest_pn operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|set_transmit_next_pn
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|txsa
operator|->
name|sc
operator|->
name|channel
argument_list|,
name|txsa
operator|->
name|an
argument_list|,
name|txsa
operator|->
name|next_pn
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_get_available_receive_sc
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|u32
modifier|*
name|channel
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|get_available_receive_sc
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy get_available_receive_sc operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|get_available_receive_sc
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|channel
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_create_receive_sc
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|receive_sc
modifier|*
name|rxsc
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|rxsc
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|create_receive_sc
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy create_receive_sc operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|create_receive_sc
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|rxsc
operator|->
name|channel
argument_list|,
operator|&
name|rxsc
operator|->
name|sci
argument_list|,
name|kay
operator|->
name|vf
argument_list|,
name|kay
operator|->
name|co
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_delete_receive_sc
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|receive_sc
modifier|*
name|rxsc
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|rxsc
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|delete_receive_sc
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy delete_receive_sc operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|delete_receive_sc
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|rxsc
operator|->
name|channel
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_create_receive_sa
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|receive_sa
modifier|*
name|rxsa
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|rxsa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|create_receive_sa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy create_receive_sa operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|create_receive_sa
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|rxsa
operator|->
name|sc
operator|->
name|channel
argument_list|,
name|rxsa
operator|->
name|an
argument_list|,
name|rxsa
operator|->
name|lowest_pn
argument_list|,
name|rxsa
operator|->
name|pkey
operator|->
name|key
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_enable_receive_sa
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|receive_sa
modifier|*
name|rxsa
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|rxsa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|enable_receive_sa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy enable_receive_sa operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|rxsa
operator|->
name|enable_receive
operator|=
name|TRUE
expr_stmt|;
return|return
name|ops
operator|->
name|enable_receive_sa
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|rxsa
operator|->
name|sc
operator|->
name|channel
argument_list|,
name|rxsa
operator|->
name|an
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_disable_receive_sa
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|receive_sa
modifier|*
name|rxsa
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|rxsa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|disable_receive_sa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy disable_receive_sa operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|rxsa
operator|->
name|enable_receive
operator|=
name|FALSE
expr_stmt|;
return|return
name|ops
operator|->
name|disable_receive_sa
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|rxsa
operator|->
name|sc
operator|->
name|channel
argument_list|,
name|rxsa
operator|->
name|an
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_get_available_transmit_sc
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|u32
modifier|*
name|channel
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|get_available_transmit_sc
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy get_available_transmit_sc operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|get_available_transmit_sc
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|channel
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_create_transmit_sc
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|transmit_sc
modifier|*
name|txsc
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|txsc
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|create_transmit_sc
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy create_transmit_sc operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|create_transmit_sc
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|txsc
operator|->
name|channel
argument_list|,
operator|&
name|txsc
operator|->
name|sci
argument_list|,
name|kay
operator|->
name|co
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_delete_transmit_sc
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|transmit_sc
modifier|*
name|txsc
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|txsc
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|delete_transmit_sc
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy delete_transmit_sc operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|delete_transmit_sc
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|txsc
operator|->
name|channel
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_create_transmit_sa
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|transmit_sa
modifier|*
name|txsa
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|txsa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|create_transmit_sa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy create_transmit_sa operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|create_transmit_sa
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|txsa
operator|->
name|sc
operator|->
name|channel
argument_list|,
name|txsa
operator|->
name|an
argument_list|,
name|txsa
operator|->
name|next_pn
argument_list|,
name|txsa
operator|->
name|confidentiality
argument_list|,
name|txsa
operator|->
name|pkey
operator|->
name|key
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_enable_transmit_sa
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|transmit_sa
modifier|*
name|txsa
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|txsa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|enable_transmit_sa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy enable_transmit_sa operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|txsa
operator|->
name|enable_transmit
operator|=
name|TRUE
expr_stmt|;
return|return
name|ops
operator|->
name|enable_transmit_sa
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|txsa
operator|->
name|sc
operator|->
name|channel
argument_list|,
name|txsa
operator|->
name|an
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_disable_transmit_sa
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|,
name|struct
name|transmit_sa
modifier|*
name|txsa
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
operator|||
operator|!
name|txsa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|disable_transmit_sa
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy disable_transmit_sa operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|txsa
operator|->
name|enable_transmit
operator|=
name|FALSE
expr_stmt|;
return|return
name|ops
operator|->
name|disable_transmit_sa
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
name|txsa
operator|->
name|sc
operator|->
name|channel
argument_list|,
name|txsa
operator|->
name|an
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|secy_init_macsec
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
name|struct
name|macsec_init_params
name|params
decl_stmt|;
if|if
condition|(
operator|!
name|kay
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|macsec_init
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy macsec_init operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|params
operator|.
name|use_es
operator|=
name|FALSE
expr_stmt|;
name|params
operator|.
name|use_scb
operator|=
name|FALSE
expr_stmt|;
name|params
operator|.
name|always_include_sci
operator|=
name|TRUE
expr_stmt|;
name|ret
operator|=
name|ops
operator|->
name|macsec_init
argument_list|(
name|ops
operator|->
name|ctx
argument_list|,
operator|&
name|params
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
name|int
name|secy_deinit_macsec
parameter_list|(
name|struct
name|ieee802_1x_kay
modifier|*
name|kay
parameter_list|)
block|{
name|struct
name|ieee802_1x_kay_ctx
modifier|*
name|ops
decl_stmt|;
if|if
condition|(
operator|!
name|kay
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: %s params invalid"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ops
operator|=
name|kay
operator|->
name|ctx
expr_stmt|;
if|if
condition|(
operator|!
name|ops
operator|||
operator|!
name|ops
operator|->
name|macsec_deinit
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"KaY: secy macsec_deinit operation not supported"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|ops
operator|->
name|macsec_deinit
argument_list|(
name|ops
operator|->
name|ctx
argument_list|)
return|;
block|}
end_function

end_unit

