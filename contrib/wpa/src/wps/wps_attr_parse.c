begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Wi-Fi Protected Setup - attribute parsing  * Copyright (c) 2008, Jouni Malinen<j@w1.fi>  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License version 2 as  * published by the Free Software Foundation.  *  * Alternatively, this software may be distributed under the terms of BSD  * license.  *  * See README and COPYING for more details.  */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_include
include|#
directive|include
file|"common.h"
end_include

begin_include
include|#
directive|include
file|"wps_i.h"
end_include

begin_function
specifier|static
name|int
name|wps_set_attr
parameter_list|(
name|struct
name|wps_parse_attr
modifier|*
name|attr
parameter_list|,
name|u16
name|type
parameter_list|,
specifier|const
name|u8
modifier|*
name|pos
parameter_list|,
name|u16
name|len
parameter_list|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|ATTR_VERSION
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Version length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|version
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_MSG_TYPE
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Message Type "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|msg_type
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_ENROLLEE_NONCE
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_NONCE_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Enrollee Nonce "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|enrollee_nonce
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_REGISTRAR_NONCE
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_NONCE_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Registrar Nonce "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|registrar_nonce
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_UUID_E
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_UUID_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid UUID-E length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|uuid_e
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_UUID_R
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_UUID_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid UUID-R length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|uuid_r
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_AUTH_TYPE_FLAGS
case|:
if|if
condition|(
name|len
operator|!=
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Authentication "
literal|"Type Flags length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|auth_type_flags
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_ENCR_TYPE_FLAGS
case|:
if|if
condition|(
name|len
operator|!=
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Encryption Type "
literal|"Flags length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|encr_type_flags
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_CONN_TYPE_FLAGS
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Connection Type "
literal|"Flags length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|conn_type_flags
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_CONFIG_METHODS
case|:
if|if
condition|(
name|len
operator|!=
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Config Methods "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|config_methods
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_SELECTED_REGISTRAR_CONFIG_METHODS
case|:
if|if
condition|(
name|len
operator|!=
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Selected "
literal|"Registrar Config Methods length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|sel_reg_config_methods
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_PRIMARY_DEV_TYPE
case|:
if|if
condition|(
name|len
operator|!=
sizeof|sizeof
argument_list|(
expr|struct
name|wps_dev_type
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Primary Device "
literal|"Type length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|primary_dev_type
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_RF_BANDS
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid RF Bands length "
literal|"%u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|rf_bands
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_ASSOC_STATE
case|:
if|if
condition|(
name|len
operator|!=
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Association State "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|assoc_state
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_CONFIG_ERROR
case|:
if|if
condition|(
name|len
operator|!=
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Configuration "
literal|"Error length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|config_error
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_DEV_PASSWORD_ID
case|:
if|if
condition|(
name|len
operator|!=
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Device Password "
literal|"ID length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|dev_password_id
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_OS_VERSION
case|:
if|if
condition|(
name|len
operator|!=
literal|4
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid OS Version length "
literal|"%u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|os_version
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_WPS_STATE
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Wi-Fi Protected "
literal|"Setup State length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|wps_state
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_AUTHENTICATOR
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_AUTHENTICATOR_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Authenticator "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|authenticator
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_R_HASH1
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_HASH_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid R-Hash1 length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|r_hash1
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_R_HASH2
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_HASH_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid R-Hash2 length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|r_hash2
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_E_HASH1
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_HASH_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid E-Hash1 length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|e_hash1
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_E_HASH2
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_HASH_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid E-Hash2 length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|e_hash2
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_R_SNONCE1
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_SECRET_NONCE_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid R-SNonce1 length "
literal|"%u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|r_snonce1
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_R_SNONCE2
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_SECRET_NONCE_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid R-SNonce2 length "
literal|"%u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|r_snonce2
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_E_SNONCE1
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_SECRET_NONCE_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid E-SNonce1 length "
literal|"%u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|e_snonce1
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_E_SNONCE2
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_SECRET_NONCE_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid E-SNonce2 length "
literal|"%u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|e_snonce2
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_KEY_WRAP_AUTH
case|:
if|if
condition|(
name|len
operator|!=
name|WPS_KWA_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Key Wrap "
literal|"Authenticator length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|key_wrap_auth
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_AUTH_TYPE
case|:
if|if
condition|(
name|len
operator|!=
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Authentication "
literal|"Type length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|auth_type
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_ENCR_TYPE
case|:
if|if
condition|(
name|len
operator|!=
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Encryption "
literal|"Type length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|encr_type
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_NETWORK_INDEX
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Network Index "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|network_idx
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_NETWORK_KEY_INDEX
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Network Key Index "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|network_key_idx
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_MAC_ADDR
case|:
if|if
condition|(
name|len
operator|!=
name|ETH_ALEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid MAC Address "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|mac_addr
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_KEY_PROVIDED_AUTO
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Key Provided "
literal|"Automatically length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|key_prov_auto
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_802_1X_ENABLED
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid 802.1X Enabled "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|dot1x_enabled
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_SELECTED_REGISTRAR
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Selected Registrar"
literal|" length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|selected_registrar
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_REQUEST_TYPE
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Request Type "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|request_type
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_RESPONSE_TYPE
case|:
if|if
condition|(
name|len
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid Response Type "
literal|"length %u"
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|attr
operator|->
name|request_type
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|ATTR_MANUFACTURER
case|:
name|attr
operator|->
name|manufacturer
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|manufacturer_len
operator|=
name|len
expr_stmt|;
break|break;
case|case
name|ATTR_MODEL_NAME
case|:
name|attr
operator|->
name|model_name
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|model_name_len
operator|=
name|len
expr_stmt|;
break|break;
case|case
name|ATTR_MODEL_NUMBER
case|:
name|attr
operator|->
name|model_number
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|model_number_len
operator|=
name|len
expr_stmt|;
break|break;
case|case
name|ATTR_SERIAL_NUMBER
case|:
name|attr
operator|->
name|serial_number
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|serial_number_len
operator|=
name|len
expr_stmt|;
break|break;
case|case
name|ATTR_DEV_NAME
case|:
name|attr
operator|->
name|dev_name
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|dev_name_len
operator|=
name|len
expr_stmt|;
break|break;
case|case
name|ATTR_PUBLIC_KEY
case|:
name|attr
operator|->
name|public_key
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|public_key_len
operator|=
name|len
expr_stmt|;
break|break;
case|case
name|ATTR_ENCR_SETTINGS
case|:
name|attr
operator|->
name|encr_settings
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|encr_settings_len
operator|=
name|len
expr_stmt|;
break|break;
case|case
name|ATTR_CRED
case|:
if|if
condition|(
name|attr
operator|->
name|num_cred
operator|>=
name|MAX_CRED_COUNT
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Skipped Credential "
literal|"attribute (max %d credentials)"
argument_list|,
name|MAX_CRED_COUNT
argument_list|)
expr_stmt|;
break|break;
block|}
name|attr
operator|->
name|cred
index|[
name|attr
operator|->
name|num_cred
index|]
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|cred_len
index|[
name|attr
operator|->
name|num_cred
index|]
operator|=
name|len
expr_stmt|;
name|attr
operator|->
name|num_cred
operator|++
expr_stmt|;
break|break;
case|case
name|ATTR_SSID
case|:
name|attr
operator|->
name|ssid
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|ssid_len
operator|=
name|len
expr_stmt|;
break|break;
case|case
name|ATTR_NETWORK_KEY
case|:
name|attr
operator|->
name|network_key
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|network_key_len
operator|=
name|len
expr_stmt|;
break|break;
case|case
name|ATTR_EAP_TYPE
case|:
name|attr
operator|->
name|eap_type
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|eap_type_len
operator|=
name|len
expr_stmt|;
break|break;
case|case
name|ATTR_EAP_IDENTITY
case|:
name|attr
operator|->
name|eap_identity
operator|=
name|pos
expr_stmt|;
name|attr
operator|->
name|eap_identity_len
operator|=
name|len
expr_stmt|;
break|break;
default|default:
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Unsupported attribute type 0x%x "
literal|"len=%u"
argument_list|,
name|type
argument_list|,
name|len
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_parse_msg
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|msg
parameter_list|,
name|struct
name|wps_parse_attr
modifier|*
name|attr
parameter_list|)
block|{
specifier|const
name|u8
modifier|*
name|pos
decl_stmt|,
modifier|*
name|end
decl_stmt|;
name|u16
name|type
decl_stmt|,
name|len
decl_stmt|;
name|os_memset
argument_list|(
name|attr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|attr
argument_list|)
argument_list|)
expr_stmt|;
name|pos
operator|=
name|wpabuf_head
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|end
operator|=
name|pos
operator|+
name|wpabuf_len
argument_list|(
name|msg
argument_list|)
expr_stmt|;
while|while
condition|(
name|pos
operator|<
name|end
condition|)
block|{
if|if
condition|(
name|end
operator|-
name|pos
operator|<
literal|4
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid message - "
literal|"%lu bytes remaining"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|end
operator|-
name|pos
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|type
operator|=
name|WPA_GET_BE16
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|pos
operator|+=
literal|2
expr_stmt|;
name|len
operator|=
name|WPA_GET_BE16
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|pos
operator|+=
literal|2
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_MSGDUMP
argument_list|,
literal|"WPS: attr type=0x%x len=%u"
argument_list|,
name|type
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|end
operator|-
name|pos
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Attribute overflow"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_set_attr
argument_list|(
name|attr
argument_list|,
name|type
argument_list|,
name|pos
argument_list|,
name|len
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
name|pos
operator|+=
name|len
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

end_unit

