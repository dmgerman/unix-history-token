begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Wi-Fi Protected Setup - common functionality  * Copyright (c) 2008-2012, Jouni Malinen<j@w1.fi>  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_include
include|#
directive|include
file|"common.h"
end_include

begin_include
include|#
directive|include
file|"crypto/aes_wrap.h"
end_include

begin_include
include|#
directive|include
file|"crypto/crypto.h"
end_include

begin_include
include|#
directive|include
file|"crypto/dh_group5.h"
end_include

begin_include
include|#
directive|include
file|"crypto/sha1.h"
end_include

begin_include
include|#
directive|include
file|"crypto/sha256.h"
end_include

begin_include
include|#
directive|include
file|"crypto/random.h"
end_include

begin_include
include|#
directive|include
file|"wps_i.h"
end_include

begin_function
name|void
name|wps_kdf
parameter_list|(
specifier|const
name|u8
modifier|*
name|key
parameter_list|,
specifier|const
name|u8
modifier|*
name|label_prefix
parameter_list|,
name|size_t
name|label_prefix_len
parameter_list|,
specifier|const
name|char
modifier|*
name|label
parameter_list|,
name|u8
modifier|*
name|res
parameter_list|,
name|size_t
name|res_len
parameter_list|)
block|{
name|u8
name|i_buf
index|[
literal|4
index|]
decl_stmt|,
name|key_bits
index|[
literal|4
index|]
decl_stmt|;
specifier|const
name|u8
modifier|*
name|addr
index|[
literal|4
index|]
decl_stmt|;
name|size_t
name|len
index|[
literal|4
index|]
decl_stmt|;
name|int
name|i
decl_stmt|,
name|iter
decl_stmt|;
name|u8
name|hash
index|[
name|SHA256_MAC_LEN
index|]
decl_stmt|,
modifier|*
name|opos
decl_stmt|;
name|size_t
name|left
decl_stmt|;
name|WPA_PUT_BE32
argument_list|(
name|key_bits
argument_list|,
name|res_len
operator|*
literal|8
argument_list|)
expr_stmt|;
name|addr
index|[
literal|0
index|]
operator|=
name|i_buf
expr_stmt|;
name|len
index|[
literal|0
index|]
operator|=
sizeof|sizeof
argument_list|(
name|i_buf
argument_list|)
expr_stmt|;
name|addr
index|[
literal|1
index|]
operator|=
name|label_prefix
expr_stmt|;
name|len
index|[
literal|1
index|]
operator|=
name|label_prefix_len
expr_stmt|;
name|addr
index|[
literal|2
index|]
operator|=
operator|(
specifier|const
name|u8
operator|*
operator|)
name|label
expr_stmt|;
name|len
index|[
literal|2
index|]
operator|=
name|os_strlen
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|addr
index|[
literal|3
index|]
operator|=
name|key_bits
expr_stmt|;
name|len
index|[
literal|3
index|]
operator|=
sizeof|sizeof
argument_list|(
name|key_bits
argument_list|)
expr_stmt|;
name|iter
operator|=
operator|(
name|res_len
operator|+
name|SHA256_MAC_LEN
operator|-
literal|1
operator|)
operator|/
name|SHA256_MAC_LEN
expr_stmt|;
name|opos
operator|=
name|res
expr_stmt|;
name|left
operator|=
name|res_len
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|iter
condition|;
name|i
operator|++
control|)
block|{
name|WPA_PUT_BE32
argument_list|(
name|i_buf
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|hmac_sha256_vector
argument_list|(
name|key
argument_list|,
name|SHA256_MAC_LEN
argument_list|,
literal|4
argument_list|,
name|addr
argument_list|,
name|len
argument_list|,
name|hash
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
name|iter
condition|)
block|{
name|os_memcpy
argument_list|(
name|opos
argument_list|,
name|hash
argument_list|,
name|SHA256_MAC_LEN
argument_list|)
expr_stmt|;
name|opos
operator|+=
name|SHA256_MAC_LEN
expr_stmt|;
name|left
operator|-=
name|SHA256_MAC_LEN
expr_stmt|;
block|}
else|else
name|os_memcpy
argument_list|(
name|opos
argument_list|,
name|hash
argument_list|,
name|left
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|wps_derive_keys
parameter_list|(
name|struct
name|wps_data
modifier|*
name|wps
parameter_list|)
block|{
name|struct
name|wpabuf
modifier|*
name|pubkey
decl_stmt|,
modifier|*
name|dh_shared
decl_stmt|;
name|u8
name|dhkey
index|[
name|SHA256_MAC_LEN
index|]
decl_stmt|,
name|kdk
index|[
name|SHA256_MAC_LEN
index|]
decl_stmt|;
specifier|const
name|u8
modifier|*
name|addr
index|[
literal|3
index|]
decl_stmt|;
name|size_t
name|len
index|[
literal|3
index|]
decl_stmt|;
name|u8
name|keys
index|[
name|WPS_AUTHKEY_LEN
operator|+
name|WPS_KEYWRAPKEY_LEN
operator|+
name|WPS_EMSK_LEN
index|]
decl_stmt|;
if|if
condition|(
name|wps
operator|->
name|dh_privkey
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Own DH private key not available"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|pubkey
operator|=
name|wps
operator|->
name|registrar
condition|?
name|wps
operator|->
name|dh_pubkey_e
else|:
name|wps
operator|->
name|dh_pubkey_r
expr_stmt|;
if|if
condition|(
name|pubkey
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Peer DH public key not available"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wpa_hexdump_buf_key
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: DH Private Key"
argument_list|,
name|wps
operator|->
name|dh_privkey
argument_list|)
expr_stmt|;
name|wpa_hexdump_buf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: DH peer Public Key"
argument_list|,
name|pubkey
argument_list|)
expr_stmt|;
name|dh_shared
operator|=
name|dh5_derive_shared
argument_list|(
name|wps
operator|->
name|dh_ctx
argument_list|,
name|pubkey
argument_list|,
name|wps
operator|->
name|dh_privkey
argument_list|)
expr_stmt|;
name|dh5_free
argument_list|(
name|wps
operator|->
name|dh_ctx
argument_list|)
expr_stmt|;
name|wps
operator|->
name|dh_ctx
operator|=
name|NULL
expr_stmt|;
name|dh_shared
operator|=
name|wpabuf_zeropad
argument_list|(
name|dh_shared
argument_list|,
literal|192
argument_list|)
expr_stmt|;
if|if
condition|(
name|dh_shared
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Failed to derive DH shared key"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
comment|/* Own DH private key is not needed anymore */
name|wpabuf_free
argument_list|(
name|wps
operator|->
name|dh_privkey
argument_list|)
expr_stmt|;
name|wps
operator|->
name|dh_privkey
operator|=
name|NULL
expr_stmt|;
name|wpa_hexdump_buf_key
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: DH shared key"
argument_list|,
name|dh_shared
argument_list|)
expr_stmt|;
comment|/* DHKey = SHA-256(g^AB mod p) */
name|addr
index|[
literal|0
index|]
operator|=
name|wpabuf_head
argument_list|(
name|dh_shared
argument_list|)
expr_stmt|;
name|len
index|[
literal|0
index|]
operator|=
name|wpabuf_len
argument_list|(
name|dh_shared
argument_list|)
expr_stmt|;
name|sha256_vector
argument_list|(
literal|1
argument_list|,
name|addr
argument_list|,
name|len
argument_list|,
name|dhkey
argument_list|)
expr_stmt|;
name|wpa_hexdump_key
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: DHKey"
argument_list|,
name|dhkey
argument_list|,
sizeof|sizeof
argument_list|(
name|dhkey
argument_list|)
argument_list|)
expr_stmt|;
name|wpabuf_free
argument_list|(
name|dh_shared
argument_list|)
expr_stmt|;
comment|/* KDK = HMAC-SHA-256_DHKey(N1 || EnrolleeMAC || N2) */
name|addr
index|[
literal|0
index|]
operator|=
name|wps
operator|->
name|nonce_e
expr_stmt|;
name|len
index|[
literal|0
index|]
operator|=
name|WPS_NONCE_LEN
expr_stmt|;
name|addr
index|[
literal|1
index|]
operator|=
name|wps
operator|->
name|mac_addr_e
expr_stmt|;
name|len
index|[
literal|1
index|]
operator|=
name|ETH_ALEN
expr_stmt|;
name|addr
index|[
literal|2
index|]
operator|=
name|wps
operator|->
name|nonce_r
expr_stmt|;
name|len
index|[
literal|2
index|]
operator|=
name|WPS_NONCE_LEN
expr_stmt|;
name|hmac_sha256_vector
argument_list|(
name|dhkey
argument_list|,
sizeof|sizeof
argument_list|(
name|dhkey
argument_list|)
argument_list|,
literal|3
argument_list|,
name|addr
argument_list|,
name|len
argument_list|,
name|kdk
argument_list|)
expr_stmt|;
name|wpa_hexdump_key
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: KDK"
argument_list|,
name|kdk
argument_list|,
sizeof|sizeof
argument_list|(
name|kdk
argument_list|)
argument_list|)
expr_stmt|;
name|wps_kdf
argument_list|(
name|kdk
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|"Wi-Fi Easy and Secure Key Derivation"
argument_list|,
name|keys
argument_list|,
sizeof|sizeof
argument_list|(
name|keys
argument_list|)
argument_list|)
expr_stmt|;
name|os_memcpy
argument_list|(
name|wps
operator|->
name|authkey
argument_list|,
name|keys
argument_list|,
name|WPS_AUTHKEY_LEN
argument_list|)
expr_stmt|;
name|os_memcpy
argument_list|(
name|wps
operator|->
name|keywrapkey
argument_list|,
name|keys
operator|+
name|WPS_AUTHKEY_LEN
argument_list|,
name|WPS_KEYWRAPKEY_LEN
argument_list|)
expr_stmt|;
name|os_memcpy
argument_list|(
name|wps
operator|->
name|emsk
argument_list|,
name|keys
operator|+
name|WPS_AUTHKEY_LEN
operator|+
name|WPS_KEYWRAPKEY_LEN
argument_list|,
name|WPS_EMSK_LEN
argument_list|)
expr_stmt|;
name|wpa_hexdump_key
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: AuthKey"
argument_list|,
name|wps
operator|->
name|authkey
argument_list|,
name|WPS_AUTHKEY_LEN
argument_list|)
expr_stmt|;
name|wpa_hexdump_key
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: KeyWrapKey"
argument_list|,
name|wps
operator|->
name|keywrapkey
argument_list|,
name|WPS_KEYWRAPKEY_LEN
argument_list|)
expr_stmt|;
name|wpa_hexdump_key
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: EMSK"
argument_list|,
name|wps
operator|->
name|emsk
argument_list|,
name|WPS_EMSK_LEN
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|wps_derive_psk
parameter_list|(
name|struct
name|wps_data
modifier|*
name|wps
parameter_list|,
specifier|const
name|u8
modifier|*
name|dev_passwd
parameter_list|,
name|size_t
name|dev_passwd_len
parameter_list|)
block|{
name|u8
name|hash
index|[
name|SHA256_MAC_LEN
index|]
decl_stmt|;
name|hmac_sha256
argument_list|(
name|wps
operator|->
name|authkey
argument_list|,
name|WPS_AUTHKEY_LEN
argument_list|,
name|dev_passwd
argument_list|,
operator|(
name|dev_passwd_len
operator|+
literal|1
operator|)
operator|/
literal|2
argument_list|,
name|hash
argument_list|)
expr_stmt|;
name|os_memcpy
argument_list|(
name|wps
operator|->
name|psk1
argument_list|,
name|hash
argument_list|,
name|WPS_PSK_LEN
argument_list|)
expr_stmt|;
name|hmac_sha256
argument_list|(
name|wps
operator|->
name|authkey
argument_list|,
name|WPS_AUTHKEY_LEN
argument_list|,
name|dev_passwd
operator|+
operator|(
name|dev_passwd_len
operator|+
literal|1
operator|)
operator|/
literal|2
argument_list|,
name|dev_passwd_len
operator|/
literal|2
argument_list|,
name|hash
argument_list|)
expr_stmt|;
name|os_memcpy
argument_list|(
name|wps
operator|->
name|psk2
argument_list|,
name|hash
argument_list|,
name|WPS_PSK_LEN
argument_list|)
expr_stmt|;
name|wpa_hexdump_ascii_key
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Device Password"
argument_list|,
name|dev_passwd
argument_list|,
name|dev_passwd_len
argument_list|)
expr_stmt|;
name|wpa_hexdump_key
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: PSK1"
argument_list|,
name|wps
operator|->
name|psk1
argument_list|,
name|WPS_PSK_LEN
argument_list|)
expr_stmt|;
name|wpa_hexdump_key
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: PSK2"
argument_list|,
name|wps
operator|->
name|psk2
argument_list|,
name|WPS_PSK_LEN
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|struct
name|wpabuf
modifier|*
name|wps_decrypt_encr_settings
parameter_list|(
name|struct
name|wps_data
modifier|*
name|wps
parameter_list|,
specifier|const
name|u8
modifier|*
name|encr
parameter_list|,
name|size_t
name|encr_len
parameter_list|)
block|{
name|struct
name|wpabuf
modifier|*
name|decrypted
decl_stmt|;
specifier|const
name|size_t
name|block_size
init|=
literal|16
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|u8
name|pad
decl_stmt|;
specifier|const
name|u8
modifier|*
name|pos
decl_stmt|;
comment|/* AES-128-CBC */
if|if
condition|(
name|encr
operator|==
name|NULL
operator|||
name|encr_len
operator|<
literal|2
operator|*
name|block_size
operator|||
name|encr_len
operator|%
name|block_size
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: No Encrypted Settings received"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|decrypted
operator|=
name|wpabuf_alloc
argument_list|(
name|encr_len
operator|-
name|block_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|decrypted
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|wpa_hexdump
argument_list|(
name|MSG_MSGDUMP
argument_list|,
literal|"WPS: Encrypted Settings"
argument_list|,
name|encr
argument_list|,
name|encr_len
argument_list|)
expr_stmt|;
name|wpabuf_put_data
argument_list|(
name|decrypted
argument_list|,
name|encr
operator|+
name|block_size
argument_list|,
name|encr_len
operator|-
name|block_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|aes_128_cbc_decrypt
argument_list|(
name|wps
operator|->
name|keywrapkey
argument_list|,
name|encr
argument_list|,
name|wpabuf_mhead
argument_list|(
name|decrypted
argument_list|)
argument_list|,
name|wpabuf_len
argument_list|(
name|decrypted
argument_list|)
argument_list|)
condition|)
block|{
name|wpabuf_free
argument_list|(
name|decrypted
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|wpa_hexdump_buf_key
argument_list|(
name|MSG_MSGDUMP
argument_list|,
literal|"WPS: Decrypted Encrypted Settings"
argument_list|,
name|decrypted
argument_list|)
expr_stmt|;
name|pos
operator|=
name|wpabuf_head_u8
argument_list|(
name|decrypted
argument_list|)
operator|+
name|wpabuf_len
argument_list|(
name|decrypted
argument_list|)
operator|-
literal|1
expr_stmt|;
name|pad
operator|=
operator|*
name|pos
expr_stmt|;
if|if
condition|(
name|pad
operator|>
name|wpabuf_len
argument_list|(
name|decrypted
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid PKCS#5 v2.0 pad value"
argument_list|)
expr_stmt|;
name|wpabuf_free
argument_list|(
name|decrypted
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pad
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|pos
operator|--
operator|!=
name|pad
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Invalid PKCS#5 v2.0 pad "
literal|"string"
argument_list|)
expr_stmt|;
name|wpabuf_free
argument_list|(
name|decrypted
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
name|decrypted
operator|->
name|used
operator|-=
name|pad
expr_stmt|;
return|return
name|decrypted
return|;
block|}
end_function

begin_comment
comment|/**  * wps_pin_checksum - Compute PIN checksum  * @pin: Seven digit PIN (i.e., eight digit PIN without the checksum digit)  * Returns: Checksum digit  */
end_comment

begin_function
name|unsigned
name|int
name|wps_pin_checksum
parameter_list|(
name|unsigned
name|int
name|pin
parameter_list|)
block|{
name|unsigned
name|int
name|accum
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|pin
condition|)
block|{
name|accum
operator|+=
literal|3
operator|*
operator|(
name|pin
operator|%
literal|10
operator|)
expr_stmt|;
name|pin
operator|/=
literal|10
expr_stmt|;
name|accum
operator|+=
name|pin
operator|%
literal|10
expr_stmt|;
name|pin
operator|/=
literal|10
expr_stmt|;
block|}
return|return
operator|(
literal|10
operator|-
name|accum
operator|%
literal|10
operator|)
operator|%
literal|10
return|;
block|}
end_function

begin_comment
comment|/**  * wps_pin_valid - Check whether a PIN has a valid checksum  * @pin: Eight digit PIN (i.e., including the checksum digit)  * Returns: 1 if checksum digit is valid, or 0 if not  */
end_comment

begin_function
name|unsigned
name|int
name|wps_pin_valid
parameter_list|(
name|unsigned
name|int
name|pin
parameter_list|)
block|{
return|return
name|wps_pin_checksum
argument_list|(
name|pin
operator|/
literal|10
argument_list|)
operator|==
operator|(
name|pin
operator|%
literal|10
operator|)
return|;
block|}
end_function

begin_comment
comment|/**  * wps_generate_pin - Generate a random PIN  * Returns: Eight digit PIN (i.e., including the checksum digit)  */
end_comment

begin_function
name|unsigned
name|int
name|wps_generate_pin
parameter_list|(
name|void
parameter_list|)
block|{
name|unsigned
name|int
name|val
decl_stmt|;
comment|/* Generate seven random digits for the PIN */
if|if
condition|(
name|random_get_bytes
argument_list|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|val
argument_list|,
sizeof|sizeof
argument_list|(
name|val
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
block|{
name|struct
name|os_time
name|now
decl_stmt|;
name|os_get_time
argument_list|(
operator|&
name|now
argument_list|)
expr_stmt|;
name|val
operator|=
name|os_random
argument_list|()
operator|^
name|now
operator|.
name|sec
operator|^
name|now
operator|.
name|usec
expr_stmt|;
block|}
name|val
operator|%=
literal|10000000
expr_stmt|;
comment|/* Append checksum digit */
return|return
name|val
operator|*
literal|10
operator|+
name|wps_pin_checksum
argument_list|(
name|val
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|wps_pin_str_valid
parameter_list|(
specifier|const
name|char
modifier|*
name|pin
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|p
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|p
operator|=
name|pin
expr_stmt|;
while|while
condition|(
operator|*
name|p
operator|>=
literal|'0'
operator|&&
operator|*
name|p
operator|<=
literal|'9'
condition|)
name|p
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|!=
literal|'\0'
condition|)
return|return
literal|0
return|;
name|len
operator|=
name|p
operator|-
name|pin
expr_stmt|;
return|return
name|len
operator|==
literal|4
operator|||
name|len
operator|==
literal|8
return|;
block|}
end_function

begin_function
name|void
name|wps_fail_event
parameter_list|(
name|struct
name|wps_context
modifier|*
name|wps
parameter_list|,
name|enum
name|wps_msg_type
name|msg
parameter_list|,
name|u16
name|config_error
parameter_list|,
name|u16
name|error_indication
parameter_list|)
block|{
name|union
name|wps_event_data
name|data
decl_stmt|;
if|if
condition|(
name|wps
operator|->
name|event_cb
operator|==
name|NULL
condition|)
return|return;
name|os_memset
argument_list|(
operator|&
name|data
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|.
name|fail
operator|.
name|msg
operator|=
name|msg
expr_stmt|;
name|data
operator|.
name|fail
operator|.
name|config_error
operator|=
name|config_error
expr_stmt|;
name|data
operator|.
name|fail
operator|.
name|error_indication
operator|=
name|error_indication
expr_stmt|;
name|wps
operator|->
name|event_cb
argument_list|(
name|wps
operator|->
name|cb_ctx
argument_list|,
name|WPS_EV_FAIL
argument_list|,
operator|&
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|wps_success_event
parameter_list|(
name|struct
name|wps_context
modifier|*
name|wps
parameter_list|)
block|{
if|if
condition|(
name|wps
operator|->
name|event_cb
operator|==
name|NULL
condition|)
return|return;
name|wps
operator|->
name|event_cb
argument_list|(
name|wps
operator|->
name|cb_ctx
argument_list|,
name|WPS_EV_SUCCESS
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|wps_pwd_auth_fail_event
parameter_list|(
name|struct
name|wps_context
modifier|*
name|wps
parameter_list|,
name|int
name|enrollee
parameter_list|,
name|int
name|part
parameter_list|)
block|{
name|union
name|wps_event_data
name|data
decl_stmt|;
if|if
condition|(
name|wps
operator|->
name|event_cb
operator|==
name|NULL
condition|)
return|return;
name|os_memset
argument_list|(
operator|&
name|data
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|.
name|pwd_auth_fail
operator|.
name|enrollee
operator|=
name|enrollee
expr_stmt|;
name|data
operator|.
name|pwd_auth_fail
operator|.
name|part
operator|=
name|part
expr_stmt|;
name|wps
operator|->
name|event_cb
argument_list|(
name|wps
operator|->
name|cb_ctx
argument_list|,
name|WPS_EV_PWD_AUTH_FAIL
argument_list|,
operator|&
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|wps_pbc_overlap_event
parameter_list|(
name|struct
name|wps_context
modifier|*
name|wps
parameter_list|)
block|{
if|if
condition|(
name|wps
operator|->
name|event_cb
operator|==
name|NULL
condition|)
return|return;
name|wps
operator|->
name|event_cb
argument_list|(
name|wps
operator|->
name|cb_ctx
argument_list|,
name|WPS_EV_PBC_OVERLAP
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|wps_pbc_timeout_event
parameter_list|(
name|struct
name|wps_context
modifier|*
name|wps
parameter_list|)
block|{
if|if
condition|(
name|wps
operator|->
name|event_cb
operator|==
name|NULL
condition|)
return|return;
name|wps
operator|->
name|event_cb
argument_list|(
name|wps
operator|->
name|cb_ctx
argument_list|,
name|WPS_EV_PBC_TIMEOUT
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_WPS_OOB
end_ifdef

begin_function
name|struct
name|wpabuf
modifier|*
name|wps_get_oob_cred
parameter_list|(
name|struct
name|wps_context
modifier|*
name|wps
parameter_list|)
block|{
name|struct
name|wps_data
name|data
decl_stmt|;
name|struct
name|wpabuf
modifier|*
name|plain
decl_stmt|;
name|plain
operator|=
name|wpabuf_alloc
argument_list|(
literal|500
argument_list|)
expr_stmt|;
if|if
condition|(
name|plain
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"WPS: Failed to allocate memory for OOB "
literal|"credential"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|os_memset
argument_list|(
operator|&
name|data
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|.
name|wps
operator|=
name|wps
expr_stmt|;
name|data
operator|.
name|auth_type
operator|=
name|wps
operator|->
name|auth_types
expr_stmt|;
name|data
operator|.
name|encr_type
operator|=
name|wps
operator|->
name|encr_types
expr_stmt|;
if|if
condition|(
name|wps_build_version
argument_list|(
name|plain
argument_list|)
operator|||
name|wps_build_cred
argument_list|(
operator|&
name|data
argument_list|,
name|plain
argument_list|)
operator|||
name|wps_build_wfa_ext
argument_list|(
name|plain
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|wpabuf_free
argument_list|(
name|plain
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|plain
return|;
block|}
end_function

begin_function
name|struct
name|wpabuf
modifier|*
name|wps_build_nfc_pw_token
parameter_list|(
name|u16
name|dev_pw_id
parameter_list|,
specifier|const
name|struct
name|wpabuf
modifier|*
name|pubkey
parameter_list|,
specifier|const
name|struct
name|wpabuf
modifier|*
name|dev_pw
parameter_list|)
block|{
name|struct
name|wpabuf
modifier|*
name|data
decl_stmt|;
name|data
operator|=
name|wpabuf_alloc
argument_list|(
literal|200
argument_list|)
expr_stmt|;
if|if
condition|(
name|data
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|wps_build_version
argument_list|(
name|data
argument_list|)
operator|||
name|wps_build_oob_dev_pw
argument_list|(
name|data
argument_list|,
name|dev_pw_id
argument_list|,
name|pubkey
argument_list|,
name|wpabuf_head
argument_list|(
name|dev_pw
argument_list|)
argument_list|,
name|wpabuf_len
argument_list|(
name|dev_pw
argument_list|)
argument_list|)
operator|||
name|wps_build_wfa_ext
argument_list|(
name|data
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"WPS: Failed to build NFC password "
literal|"token"
argument_list|)
expr_stmt|;
name|wpabuf_free
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|data
return|;
block|}
end_function

begin_function
name|int
name|wps_oob_use_cred
parameter_list|(
name|struct
name|wps_context
modifier|*
name|wps
parameter_list|,
name|struct
name|wps_parse_attr
modifier|*
name|attr
parameter_list|)
block|{
name|struct
name|wpabuf
name|msg
decl_stmt|;
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|attr
operator|->
name|num_cred
condition|;
name|i
operator|++
control|)
block|{
name|struct
name|wps_credential
name|local_cred
decl_stmt|;
name|struct
name|wps_parse_attr
name|cattr
decl_stmt|;
name|os_memset
argument_list|(
operator|&
name|local_cred
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|local_cred
argument_list|)
argument_list|)
expr_stmt|;
name|wpabuf_set
argument_list|(
operator|&
name|msg
argument_list|,
name|attr
operator|->
name|cred
index|[
name|i
index|]
argument_list|,
name|attr
operator|->
name|cred_len
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|wps_parse_msg
argument_list|(
operator|&
name|msg
argument_list|,
operator|&
name|cattr
argument_list|)
operator|<
literal|0
operator|||
name|wps_process_cred
argument_list|(
operator|&
name|cattr
argument_list|,
operator|&
name|local_cred
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"WPS: Failed to parse OOB "
literal|"credential"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps
operator|->
name|cred_cb
argument_list|(
name|wps
operator|->
name|cb_ctx
argument_list|,
operator|&
name|local_cred
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_WPS_OOB */
end_comment

begin_function
name|int
name|wps_dev_type_str2bin
parameter_list|(
specifier|const
name|char
modifier|*
name|str
parameter_list|,
name|u8
name|dev_type
index|[
name|WPS_DEV_TYPE_LEN
index|]
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|pos
decl_stmt|;
comment|/*<categ>-<OUI>-<subcateg> */
name|WPA_PUT_BE16
argument_list|(
name|dev_type
argument_list|,
name|atoi
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|str
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|pos
operator|++
expr_stmt|;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
operator|&
name|dev_type
index|[
literal|2
index|]
argument_list|,
literal|4
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|pos
operator|++
expr_stmt|;
name|WPA_PUT_BE16
argument_list|(
operator|&
name|dev_type
index|[
literal|6
index|]
argument_list|,
name|atoi
argument_list|(
name|pos
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|wps_dev_type_bin2str
parameter_list|(
specifier|const
name|u8
name|dev_type
index|[
name|WPS_DEV_TYPE_LEN
index|]
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|size_t
name|buf_len
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|ret
operator|=
name|os_snprintf
argument_list|(
name|buf
argument_list|,
name|buf_len
argument_list|,
literal|"%u-%08X-%u"
argument_list|,
name|WPA_GET_BE16
argument_list|(
name|dev_type
argument_list|)
argument_list|,
name|WPA_GET_BE32
argument_list|(
operator|&
name|dev_type
index|[
literal|2
index|]
argument_list|)
argument_list|,
name|WPA_GET_BE16
argument_list|(
operator|&
name|dev_type
index|[
literal|6
index|]
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
operator|||
operator|(
name|unsigned
name|int
operator|)
name|ret
operator|>=
name|buf_len
condition|)
return|return
name|NULL
return|;
return|return
name|buf
return|;
block|}
end_function

begin_function
name|void
name|uuid_gen_mac_addr
parameter_list|(
specifier|const
name|u8
modifier|*
name|mac_addr
parameter_list|,
name|u8
modifier|*
name|uuid
parameter_list|)
block|{
specifier|const
name|u8
modifier|*
name|addr
index|[
literal|2
index|]
decl_stmt|;
name|size_t
name|len
index|[
literal|2
index|]
decl_stmt|;
name|u8
name|hash
index|[
name|SHA1_MAC_LEN
index|]
decl_stmt|;
name|u8
name|nsid
index|[
literal|16
index|]
init|=
block|{
literal|0x52
block|,
literal|0x64
block|,
literal|0x80
block|,
literal|0xf8
block|,
literal|0xc9
block|,
literal|0x9b
block|,
literal|0x4b
block|,
literal|0xe5
block|,
literal|0xa6
block|,
literal|0x55
block|,
literal|0x58
block|,
literal|0xed
block|,
literal|0x5f
block|,
literal|0x5d
block|,
literal|0x60
block|,
literal|0x84
block|}
decl_stmt|;
name|addr
index|[
literal|0
index|]
operator|=
name|nsid
expr_stmt|;
name|len
index|[
literal|0
index|]
operator|=
sizeof|sizeof
argument_list|(
name|nsid
argument_list|)
expr_stmt|;
name|addr
index|[
literal|1
index|]
operator|=
name|mac_addr
expr_stmt|;
name|len
index|[
literal|1
index|]
operator|=
literal|6
expr_stmt|;
name|sha1_vector
argument_list|(
literal|2
argument_list|,
name|addr
argument_list|,
name|len
argument_list|,
name|hash
argument_list|)
expr_stmt|;
name|os_memcpy
argument_list|(
name|uuid
argument_list|,
name|hash
argument_list|,
literal|16
argument_list|)
expr_stmt|;
comment|/* Version: 5 = named-based version using SHA-1 */
name|uuid
index|[
literal|6
index|]
operator|=
operator|(
literal|5
operator|<<
literal|4
operator|)
operator||
operator|(
name|uuid
index|[
literal|6
index|]
operator|&
literal|0x0f
operator|)
expr_stmt|;
comment|/* Variant specified in RFC 4122 */
name|uuid
index|[
literal|8
index|]
operator|=
literal|0x80
operator||
operator|(
name|uuid
index|[
literal|8
index|]
operator|&
literal|0x3f
operator|)
expr_stmt|;
block|}
end_function

begin_function
name|u16
name|wps_config_methods_str2bin
parameter_list|(
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|u16
name|methods
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|str
operator|==
name|NULL
condition|)
block|{
comment|/* Default to enabling methods based on build configuration */
name|methods
operator||=
name|WPS_CONFIG_DISPLAY
operator||
name|WPS_CONFIG_KEYPAD
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_WPS2
name|methods
operator||=
name|WPS_CONFIG_VIRT_DISPLAY
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_WPS2 */
ifdef|#
directive|ifdef
name|CONFIG_WPS_NFC
name|methods
operator||=
name|WPS_CONFIG_NFC_INTERFACE
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_WPS_NFC */
block|}
else|else
block|{
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"ethernet"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_ETHERNET
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"label"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_LABEL
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"display"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_DISPLAY
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"ext_nfc_token"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_EXT_NFC_TOKEN
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"int_nfc_token"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_INT_NFC_TOKEN
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"nfc_interface"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_NFC_INTERFACE
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"push_button"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_PUSHBUTTON
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"keypad"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_KEYPAD
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_WPS2
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"virtual_display"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_VIRT_DISPLAY
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"physical_display"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_PHY_DISPLAY
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"virtual_push_button"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_VIRT_PUSHBUTTON
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|str
argument_list|,
literal|"physical_push_button"
argument_list|)
condition|)
name|methods
operator||=
name|WPS_CONFIG_PHY_PUSHBUTTON
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_WPS2 */
block|}
return|return
name|methods
return|;
block|}
end_function

begin_function
name|struct
name|wpabuf
modifier|*
name|wps_build_wsc_ack
parameter_list|(
name|struct
name|wps_data
modifier|*
name|wps
parameter_list|)
block|{
name|struct
name|wpabuf
modifier|*
name|msg
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Building Message WSC_ACK"
argument_list|)
expr_stmt|;
name|msg
operator|=
name|wpabuf_alloc
argument_list|(
literal|1000
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|wps_build_version
argument_list|(
name|msg
argument_list|)
operator|||
name|wps_build_msg_type
argument_list|(
name|msg
argument_list|,
name|WPS_WSC_ACK
argument_list|)
operator|||
name|wps_build_enrollee_nonce
argument_list|(
name|wps
argument_list|,
name|msg
argument_list|)
operator|||
name|wps_build_registrar_nonce
argument_list|(
name|wps
argument_list|,
name|msg
argument_list|)
operator|||
name|wps_build_wfa_ext
argument_list|(
name|msg
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|wpabuf_free
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|msg
return|;
block|}
end_function

begin_function
name|struct
name|wpabuf
modifier|*
name|wps_build_wsc_nack
parameter_list|(
name|struct
name|wps_data
modifier|*
name|wps
parameter_list|)
block|{
name|struct
name|wpabuf
modifier|*
name|msg
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Building Message WSC_NACK"
argument_list|)
expr_stmt|;
name|msg
operator|=
name|wpabuf_alloc
argument_list|(
literal|1000
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|wps_build_version
argument_list|(
name|msg
argument_list|)
operator|||
name|wps_build_msg_type
argument_list|(
name|msg
argument_list|,
name|WPS_WSC_NACK
argument_list|)
operator|||
name|wps_build_enrollee_nonce
argument_list|(
name|wps
argument_list|,
name|msg
argument_list|)
operator|||
name|wps_build_registrar_nonce
argument_list|(
name|wps
argument_list|,
name|msg
argument_list|)
operator|||
name|wps_build_config_error
argument_list|(
name|msg
argument_list|,
name|wps
operator|->
name|config_error
argument_list|)
operator|||
name|wps_build_wfa_ext
argument_list|(
name|msg
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|wpabuf_free
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|msg
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_WPS_NFC
end_ifdef

begin_function
name|struct
name|wpabuf
modifier|*
name|wps_nfc_token_gen
parameter_list|(
name|int
name|ndef
parameter_list|,
name|int
modifier|*
name|id
parameter_list|,
name|struct
name|wpabuf
modifier|*
modifier|*
name|pubkey
parameter_list|,
name|struct
name|wpabuf
modifier|*
modifier|*
name|privkey
parameter_list|,
name|struct
name|wpabuf
modifier|*
modifier|*
name|dev_pw
parameter_list|)
block|{
name|struct
name|wpabuf
modifier|*
name|priv
init|=
name|NULL
decl_stmt|,
modifier|*
name|pub
init|=
name|NULL
decl_stmt|,
modifier|*
name|pw
decl_stmt|,
modifier|*
name|ret
decl_stmt|;
name|void
modifier|*
name|dh_ctx
decl_stmt|;
name|u16
name|val
decl_stmt|;
name|pw
operator|=
name|wpabuf_alloc
argument_list|(
name|WPS_OOB_DEVICE_PASSWORD_LEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|pw
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|random_get_bytes
argument_list|(
name|wpabuf_put
argument_list|(
name|pw
argument_list|,
name|WPS_OOB_DEVICE_PASSWORD_LEN
argument_list|)
argument_list|,
name|WPS_OOB_DEVICE_PASSWORD_LEN
argument_list|)
operator|||
name|random_get_bytes
argument_list|(
operator|(
name|u8
operator|*
operator|)
operator|&
name|val
argument_list|,
sizeof|sizeof
argument_list|(
name|val
argument_list|)
argument_list|)
condition|)
block|{
name|wpabuf_free
argument_list|(
name|pw
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|dh_ctx
operator|=
name|dh5_init
argument_list|(
operator|&
name|priv
argument_list|,
operator|&
name|pub
argument_list|)
expr_stmt|;
if|if
condition|(
name|dh_ctx
operator|==
name|NULL
condition|)
block|{
name|wpabuf_free
argument_list|(
name|pw
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|dh5_free
argument_list|(
name|dh_ctx
argument_list|)
expr_stmt|;
operator|*
name|id
operator|=
literal|0x10
operator|+
name|val
operator|%
literal|0xfff0
expr_stmt|;
name|wpabuf_free
argument_list|(
operator|*
name|pubkey
argument_list|)
expr_stmt|;
operator|*
name|pubkey
operator|=
name|pub
expr_stmt|;
name|wpabuf_free
argument_list|(
operator|*
name|privkey
argument_list|)
expr_stmt|;
operator|*
name|privkey
operator|=
name|priv
expr_stmt|;
name|wpabuf_free
argument_list|(
operator|*
name|dev_pw
argument_list|)
expr_stmt|;
operator|*
name|dev_pw
operator|=
name|pw
expr_stmt|;
name|ret
operator|=
name|wps_build_nfc_pw_token
argument_list|(
operator|*
name|id
argument_list|,
operator|*
name|pubkey
argument_list|,
operator|*
name|dev_pw
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndef
operator|&&
name|ret
condition|)
block|{
name|struct
name|wpabuf
modifier|*
name|tmp
decl_stmt|;
name|tmp
operator|=
name|ndef_build_wifi
argument_list|(
name|ret
argument_list|)
expr_stmt|;
name|wpabuf_free
argument_list|(
name|ret
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|ret
operator|=
name|tmp
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_WPS_NFC */
end_comment

end_unit

