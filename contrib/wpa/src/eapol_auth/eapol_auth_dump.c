begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * IEEE 802.1X-2004 Authenticator - State dump  * Copyright (c) 2002-2013, Jouni Malinen<j@w1.fi>  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_include
include|#
directive|include
file|"common.h"
end_include

begin_include
include|#
directive|include
file|"eap_server/eap.h"
end_include

begin_include
include|#
directive|include
file|"eapol_auth_sm.h"
end_include

begin_include
include|#
directive|include
file|"eapol_auth_sm_i.h"
end_include

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|port_type_txt
parameter_list|(
name|PortTypes
name|pt
parameter_list|)
block|{
switch|switch
condition|(
name|pt
condition|)
block|{
case|case
name|ForceUnauthorized
case|:
return|return
literal|"ForceUnauthorized"
return|;
case|case
name|ForceAuthorized
case|:
return|return
literal|"ForceAuthorized"
return|;
case|case
name|Auto
case|:
return|return
literal|"Auto"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|port_state_txt
parameter_list|(
name|PortState
name|ps
parameter_list|)
block|{
switch|switch
condition|(
name|ps
condition|)
block|{
case|case
name|Unauthorized
case|:
return|return
literal|"Unauthorized"
return|;
case|case
name|Authorized
case|:
return|return
literal|"Authorized"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|ctrl_dir_txt
parameter_list|(
name|ControlledDirection
name|dir
parameter_list|)
block|{
switch|switch
condition|(
name|dir
condition|)
block|{
case|case
name|Both
case|:
return|return
literal|"Both"
return|;
case|case
name|In
case|:
return|return
literal|"In"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|auth_pae_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|AUTH_PAE_INITIALIZE
case|:
return|return
literal|"INITIALIZE"
return|;
case|case
name|AUTH_PAE_DISCONNECTED
case|:
return|return
literal|"DISCONNECTED"
return|;
case|case
name|AUTH_PAE_CONNECTING
case|:
return|return
literal|"CONNECTING"
return|;
case|case
name|AUTH_PAE_AUTHENTICATING
case|:
return|return
literal|"AUTHENTICATING"
return|;
case|case
name|AUTH_PAE_AUTHENTICATED
case|:
return|return
literal|"AUTHENTICATED"
return|;
case|case
name|AUTH_PAE_ABORTING
case|:
return|return
literal|"ABORTING"
return|;
case|case
name|AUTH_PAE_HELD
case|:
return|return
literal|"HELD"
return|;
case|case
name|AUTH_PAE_FORCE_AUTH
case|:
return|return
literal|"FORCE_AUTH"
return|;
case|case
name|AUTH_PAE_FORCE_UNAUTH
case|:
return|return
literal|"FORCE_UNAUTH"
return|;
case|case
name|AUTH_PAE_RESTART
case|:
return|return
literal|"RESTART"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|be_auth_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|BE_AUTH_REQUEST
case|:
return|return
literal|"REQUEST"
return|;
case|case
name|BE_AUTH_RESPONSE
case|:
return|return
literal|"RESPONSE"
return|;
case|case
name|BE_AUTH_SUCCESS
case|:
return|return
literal|"SUCCESS"
return|;
case|case
name|BE_AUTH_FAIL
case|:
return|return
literal|"FAIL"
return|;
case|case
name|BE_AUTH_TIMEOUT
case|:
return|return
literal|"TIMEOUT"
return|;
case|case
name|BE_AUTH_IDLE
case|:
return|return
literal|"IDLE"
return|;
case|case
name|BE_AUTH_INITIALIZE
case|:
return|return
literal|"INITIALIZE"
return|;
case|case
name|BE_AUTH_IGNORE
case|:
return|return
literal|"IGNORE"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|reauth_timer_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|REAUTH_TIMER_INITIALIZE
case|:
return|return
literal|"INITIALIZE"
return|;
case|case
name|REAUTH_TIMER_REAUTHENTICATE
case|:
return|return
literal|"REAUTHENTICATE"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|auth_key_tx_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|AUTH_KEY_TX_NO_KEY_TRANSMIT
case|:
return|return
literal|"NO_KEY_TRANSMIT"
return|;
case|case
name|AUTH_KEY_TX_KEY_TRANSMIT
case|:
return|return
literal|"KEY_TRANSMIT"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|key_rx_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|KEY_RX_NO_KEY_RECEIVE
case|:
return|return
literal|"NO_KEY_RECEIVE"
return|;
case|case
name|KEY_RX_KEY_RECEIVE
case|:
return|return
literal|"KEY_RECEIVE"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|ctrl_dir_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|CTRL_DIR_FORCE_BOTH
case|:
return|return
literal|"FORCE_BOTH"
return|;
case|case
name|CTRL_DIR_IN_OR_BOTH
case|:
return|return
literal|"IN_OR_BOTH"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
name|int
name|eapol_auth_dump_state
parameter_list|(
name|struct
name|eapol_state_machine
modifier|*
name|sm
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|size_t
name|buflen
parameter_list|)
block|{
name|char
modifier|*
name|pos
decl_stmt|,
modifier|*
name|end
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|pos
operator|=
name|buf
expr_stmt|;
name|end
operator|=
name|pos
operator|+
name|buflen
expr_stmt|;
name|ret
operator|=
name|os_snprintf
argument_list|(
name|pos
argument_list|,
name|end
operator|-
name|pos
argument_list|,
literal|"aWhile=%d\nquietWhile=%d\n"
literal|"reAuthWhen=%d\n"
argument_list|,
name|sm
operator|->
name|aWhile
argument_list|,
name|sm
operator|->
name|quietWhile
argument_list|,
name|sm
operator|->
name|reAuthWhen
argument_list|)
expr_stmt|;
if|if
condition|(
name|os_snprintf_error
argument_list|(
name|end
operator|-
name|pos
argument_list|,
name|ret
argument_list|)
condition|)
return|return
name|pos
operator|-
name|buf
return|;
name|pos
operator|+=
name|ret
expr_stmt|;
define|#
directive|define
name|_SB
parameter_list|(
name|b
parameter_list|)
value|((b) ? "TRUE" : "FALSE")
name|ret
operator|=
name|os_snprintf
argument_list|(
name|pos
argument_list|,
name|end
operator|-
name|pos
argument_list|,
literal|"authAbort=%s\n"
literal|"authFail=%s\n"
literal|"authPortStatus=%s\n"
literal|"authStart=%s\n"
literal|"authTimeout=%s\n"
literal|"authSuccess=%s\n"
literal|"eapFail=%s\n"
literal|"eapolEap=%s\n"
literal|"eapSuccess=%s\n"
literal|"eapTimeout=%s\n"
literal|"initialize=%s\n"
literal|"keyAvailable=%s\n"
literal|"keyDone=%s\n"
literal|"keyRun=%s\n"
literal|"keyTxEnabled=%s\n"
literal|"portControl=%s\n"
literal|"portEnabled=%s\n"
literal|"portValid=%s\n"
literal|"reAuthenticate=%s\n"
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|authAbort
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|authFail
argument_list|)
argument_list|,
name|port_state_txt
argument_list|(
name|sm
operator|->
name|authPortStatus
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|authStart
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|authTimeout
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|authSuccess
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapFail
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eapolEap
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapSuccess
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapTimeout
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|initialize
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapKeyAvailable
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|keyDone
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|keyRun
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|keyTxEnabled
argument_list|)
argument_list|,
name|port_type_txt
argument_list|(
name|sm
operator|->
name|portControl
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|portEnabled
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|portValid
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|reAuthenticate
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|os_snprintf_error
argument_list|(
name|end
operator|-
name|pos
argument_list|,
name|ret
argument_list|)
condition|)
return|return
name|pos
operator|-
name|buf
return|;
name|pos
operator|+=
name|ret
expr_stmt|;
name|ret
operator|=
name|os_snprintf
argument_list|(
name|pos
argument_list|,
name|end
operator|-
name|pos
argument_list|,
literal|"auth_pae_state=%s\n"
literal|"eapolLogoff=%s\n"
literal|"eapolStart=%s\n"
literal|"eapRestart=%s\n"
literal|"portMode=%s\n"
literal|"reAuthCount=%d\n"
literal|"quietPeriod=%d\n"
literal|"reAuthMax=%d\n"
literal|"authEntersConnecting=%d\n"
literal|"authEapLogoffsWhileConnecting=%d\n"
literal|"authEntersAuthenticating=%d\n"
literal|"authAuthSuccessesWhileAuthenticating=%d\n"
literal|"authAuthTimeoutsWhileAuthenticating=%d\n"
literal|"authAuthFailWhileAuthenticating=%d\n"
literal|"authAuthEapStartsWhileAuthenticating=%d\n"
literal|"authAuthEapLogoffWhileAuthenticating=%d\n"
literal|"authAuthReauthsWhileAuthenticated=%d\n"
literal|"authAuthEapStartsWhileAuthenticated=%d\n"
literal|"authAuthEapLogoffWhileAuthenticated=%d\n"
argument_list|,
name|auth_pae_state_txt
argument_list|(
name|sm
operator|->
name|auth_pae_state
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eapolLogoff
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eapolStart
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapRestart
argument_list|)
argument_list|,
name|port_type_txt
argument_list|(
name|sm
operator|->
name|portMode
argument_list|)
argument_list|,
name|sm
operator|->
name|reAuthCount
argument_list|,
name|sm
operator|->
name|quietPeriod
argument_list|,
name|sm
operator|->
name|reAuthMax
argument_list|,
name|sm
operator|->
name|authEntersConnecting
argument_list|,
name|sm
operator|->
name|authEapLogoffsWhileConnecting
argument_list|,
name|sm
operator|->
name|authEntersAuthenticating
argument_list|,
name|sm
operator|->
name|authAuthSuccessesWhileAuthenticating
argument_list|,
name|sm
operator|->
name|authAuthTimeoutsWhileAuthenticating
argument_list|,
name|sm
operator|->
name|authAuthFailWhileAuthenticating
argument_list|,
name|sm
operator|->
name|authAuthEapStartsWhileAuthenticating
argument_list|,
name|sm
operator|->
name|authAuthEapLogoffWhileAuthenticating
argument_list|,
name|sm
operator|->
name|authAuthReauthsWhileAuthenticated
argument_list|,
name|sm
operator|->
name|authAuthEapStartsWhileAuthenticated
argument_list|,
name|sm
operator|->
name|authAuthEapLogoffWhileAuthenticated
argument_list|)
expr_stmt|;
if|if
condition|(
name|os_snprintf_error
argument_list|(
name|end
operator|-
name|pos
argument_list|,
name|ret
argument_list|)
condition|)
return|return
name|pos
operator|-
name|buf
return|;
name|pos
operator|+=
name|ret
expr_stmt|;
name|ret
operator|=
name|os_snprintf
argument_list|(
name|pos
argument_list|,
name|end
operator|-
name|pos
argument_list|,
literal|"be_auth_state=%s\n"
literal|"eapNoReq=%s\n"
literal|"eapReq=%s\n"
literal|"eapResp=%s\n"
literal|"serverTimeout=%d\n"
literal|"backendResponses=%d\n"
literal|"backendAccessChallenges=%d\n"
literal|"backendOtherRequestsToSupplicant=%d\n"
literal|"backendAuthSuccesses=%d\n"
literal|"backendAuthFails=%d\n"
argument_list|,
name|be_auth_state_txt
argument_list|(
name|sm
operator|->
name|be_auth_state
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapNoReq
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapReq
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapResp
argument_list|)
argument_list|,
name|sm
operator|->
name|serverTimeout
argument_list|,
name|sm
operator|->
name|backendResponses
argument_list|,
name|sm
operator|->
name|backendAccessChallenges
argument_list|,
name|sm
operator|->
name|backendOtherRequestsToSupplicant
argument_list|,
name|sm
operator|->
name|backendAuthSuccesses
argument_list|,
name|sm
operator|->
name|backendAuthFails
argument_list|)
expr_stmt|;
if|if
condition|(
name|os_snprintf_error
argument_list|(
name|end
operator|-
name|pos
argument_list|,
name|ret
argument_list|)
condition|)
return|return
name|pos
operator|-
name|buf
return|;
name|pos
operator|+=
name|ret
expr_stmt|;
name|ret
operator|=
name|os_snprintf
argument_list|(
name|pos
argument_list|,
name|end
operator|-
name|pos
argument_list|,
literal|"reauth_timer_state=%s\n"
literal|"reAuthPeriod=%d\n"
literal|"reAuthEnabled=%s\n"
argument_list|,
name|reauth_timer_state_txt
argument_list|(
name|sm
operator|->
name|reauth_timer_state
argument_list|)
argument_list|,
name|sm
operator|->
name|reAuthPeriod
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|reAuthEnabled
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|os_snprintf_error
argument_list|(
name|end
operator|-
name|pos
argument_list|,
name|ret
argument_list|)
condition|)
return|return
name|pos
operator|-
name|buf
return|;
name|pos
operator|+=
name|ret
expr_stmt|;
name|ret
operator|=
name|os_snprintf
argument_list|(
name|pos
argument_list|,
name|end
operator|-
name|pos
argument_list|,
literal|"auth_key_tx_state=%s\n"
argument_list|,
name|auth_key_tx_state_txt
argument_list|(
name|sm
operator|->
name|auth_key_tx_state
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|os_snprintf_error
argument_list|(
name|end
operator|-
name|pos
argument_list|,
name|ret
argument_list|)
condition|)
return|return
name|pos
operator|-
name|buf
return|;
name|pos
operator|+=
name|ret
expr_stmt|;
name|ret
operator|=
name|os_snprintf
argument_list|(
name|pos
argument_list|,
name|end
operator|-
name|pos
argument_list|,
literal|"key_rx_state=%s\n"
literal|"rxKey=%s\n"
argument_list|,
name|key_rx_state_txt
argument_list|(
name|sm
operator|->
name|key_rx_state
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|rxKey
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|os_snprintf_error
argument_list|(
name|end
operator|-
name|pos
argument_list|,
name|ret
argument_list|)
condition|)
return|return
name|pos
operator|-
name|buf
return|;
name|pos
operator|+=
name|ret
expr_stmt|;
name|ret
operator|=
name|os_snprintf
argument_list|(
name|pos
argument_list|,
name|end
operator|-
name|pos
argument_list|,
literal|"ctrl_dir_state=%s\n"
literal|"adminControlledDirections=%s\n"
literal|"operControlledDirections=%s\n"
literal|"operEdge=%s\n"
argument_list|,
name|ctrl_dir_state_txt
argument_list|(
name|sm
operator|->
name|ctrl_dir_state
argument_list|)
argument_list|,
name|ctrl_dir_txt
argument_list|(
name|sm
operator|->
name|adminControlledDirections
argument_list|)
argument_list|,
name|ctrl_dir_txt
argument_list|(
name|sm
operator|->
name|operControlledDirections
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|operEdge
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|os_snprintf_error
argument_list|(
name|end
operator|-
name|pos
argument_list|,
name|ret
argument_list|)
condition|)
return|return
name|pos
operator|-
name|buf
return|;
name|pos
operator|+=
name|ret
expr_stmt|;
undef|#
directive|undef
name|_SB
return|return
name|pos
operator|-
name|buf
return|;
block|}
end_function

end_unit

