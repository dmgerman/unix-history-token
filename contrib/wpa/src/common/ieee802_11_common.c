begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * IEEE 802.11 Common routines  * Copyright (c) 2002-2012, Jouni Malinen<j@w1.fi>  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_include
include|#
directive|include
file|"common.h"
end_include

begin_include
include|#
directive|include
file|"ieee802_11_defs.h"
end_include

begin_include
include|#
directive|include
file|"ieee802_11_common.h"
end_include

begin_function
specifier|static
name|int
name|ieee802_11_parse_vendor_specific
parameter_list|(
specifier|const
name|u8
modifier|*
name|pos
parameter_list|,
name|size_t
name|elen
parameter_list|,
name|struct
name|ieee802_11_elems
modifier|*
name|elems
parameter_list|,
name|int
name|show_errors
parameter_list|)
block|{
name|unsigned
name|int
name|oui
decl_stmt|;
comment|/* first 3 bytes in vendor specific information element are the IEEE 	 * OUI of the vendor. The following byte is used a vendor specific 	 * sub-type. */
if|if
condition|(
name|elen
operator|<
literal|4
condition|)
block|{
if|if
condition|(
name|show_errors
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_MSGDUMP
argument_list|,
literal|"short vendor specific "
literal|"information element ignored (len=%lu)"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|elen
argument_list|)
expr_stmt|;
block|}
return|return
operator|-
literal|1
return|;
block|}
name|oui
operator|=
name|WPA_GET_BE24
argument_list|(
name|pos
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|oui
condition|)
block|{
case|case
name|OUI_MICROSOFT
case|:
comment|/* Microsoft/Wi-Fi information elements are further typed and 		 * subtyped */
switch|switch
condition|(
name|pos
index|[
literal|3
index|]
condition|)
block|{
case|case
literal|1
case|:
comment|/* Microsoft OUI (00:50:F2) with OUI Type 1: 			 * real WPA information element */
name|elems
operator|->
name|wpa_ie
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|wpa_ie_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WMM_OUI_TYPE
case|:
comment|/* WMM information element */
if|if
condition|(
name|elen
operator|<
literal|5
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_MSGDUMP
argument_list|,
literal|"short WMM "
literal|"information element ignored "
literal|"(len=%lu)"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|elen
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
switch|switch
condition|(
name|pos
index|[
literal|4
index|]
condition|)
block|{
case|case
name|WMM_OUI_SUBTYPE_INFORMATION_ELEMENT
case|:
case|case
name|WMM_OUI_SUBTYPE_PARAMETER_ELEMENT
case|:
comment|/* 				 * Share same pointer since only one of these 				 * is used and they start with same data. 				 * Length field can be used to distinguish the 				 * IEs. 				 */
name|elems
operator|->
name|wmm
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|wmm_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WMM_OUI_SUBTYPE_TSPEC_ELEMENT
case|:
name|elems
operator|->
name|wmm_tspec
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|wmm_tspec_len
operator|=
name|elen
expr_stmt|;
break|break;
default|default:
name|wpa_printf
argument_list|(
name|MSG_EXCESSIVE
argument_list|,
literal|"unknown WMM "
literal|"information element ignored "
literal|"(subtype=%d len=%lu)"
argument_list|,
name|pos
index|[
literal|4
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|elen
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
break|break;
case|case
literal|4
case|:
comment|/* Wi-Fi Protected Setup (WPS) IE */
name|elems
operator|->
name|wps_ie
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|wps_ie_len
operator|=
name|elen
expr_stmt|;
break|break;
default|default:
name|wpa_printf
argument_list|(
name|MSG_EXCESSIVE
argument_list|,
literal|"Unknown Microsoft "
literal|"information element ignored "
literal|"(type=%d len=%lu)"
argument_list|,
name|pos
index|[
literal|3
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|elen
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
break|break;
case|case
name|OUI_WFA
case|:
switch|switch
condition|(
name|pos
index|[
literal|3
index|]
condition|)
block|{
case|case
name|P2P_OUI_TYPE
case|:
comment|/* Wi-Fi Alliance - P2P IE */
name|elems
operator|->
name|p2p
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|p2p_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WFD_OUI_TYPE
case|:
comment|/* Wi-Fi Alliance - WFD IE */
name|elems
operator|->
name|wfd
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|wfd_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|HS20_INDICATION_OUI_TYPE
case|:
comment|/* Hotspot 2.0 */
name|elems
operator|->
name|hs20
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|hs20_len
operator|=
name|elen
expr_stmt|;
break|break;
default|default:
name|wpa_printf
argument_list|(
name|MSG_MSGDUMP
argument_list|,
literal|"Unknown WFA "
literal|"information element ignored "
literal|"(type=%d len=%lu)\n"
argument_list|,
name|pos
index|[
literal|3
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|elen
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
break|break;
case|case
name|OUI_BROADCOM
case|:
switch|switch
condition|(
name|pos
index|[
literal|3
index|]
condition|)
block|{
case|case
name|VENDOR_HT_CAPAB_OUI_TYPE
case|:
name|elems
operator|->
name|vendor_ht_cap
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|vendor_ht_cap_len
operator|=
name|elen
expr_stmt|;
break|break;
default|default:
name|wpa_printf
argument_list|(
name|MSG_EXCESSIVE
argument_list|,
literal|"Unknown Broadcom "
literal|"information element ignored "
literal|"(type=%d len=%lu)"
argument_list|,
name|pos
index|[
literal|3
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|elen
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
break|break;
default|default:
name|wpa_printf
argument_list|(
name|MSG_EXCESSIVE
argument_list|,
literal|"unknown vendor specific "
literal|"information element ignored (vendor OUI "
literal|"%02x:%02x:%02x len=%lu)"
argument_list|,
name|pos
index|[
literal|0
index|]
argument_list|,
name|pos
index|[
literal|1
index|]
argument_list|,
name|pos
index|[
literal|2
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|elen
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/**  * ieee802_11_parse_elems - Parse information elements in management frames  * @start: Pointer to the start of IEs  * @len: Length of IE buffer in octets  * @elems: Data structure for parsed elements  * @show_errors: Whether to show parsing errors in debug log  * Returns: Parsing result  */
end_comment

begin_function
name|ParseRes
name|ieee802_11_parse_elems
parameter_list|(
specifier|const
name|u8
modifier|*
name|start
parameter_list|,
name|size_t
name|len
parameter_list|,
name|struct
name|ieee802_11_elems
modifier|*
name|elems
parameter_list|,
name|int
name|show_errors
parameter_list|)
block|{
name|size_t
name|left
init|=
name|len
decl_stmt|;
specifier|const
name|u8
modifier|*
name|pos
init|=
name|start
decl_stmt|;
name|int
name|unknown
init|=
literal|0
decl_stmt|;
name|os_memset
argument_list|(
name|elems
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|elems
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|left
operator|>=
literal|2
condition|)
block|{
name|u8
name|id
decl_stmt|,
name|elen
decl_stmt|;
name|id
operator|=
operator|*
name|pos
operator|++
expr_stmt|;
name|elen
operator|=
operator|*
name|pos
operator|++
expr_stmt|;
name|left
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|elen
operator|>
name|left
condition|)
block|{
if|if
condition|(
name|show_errors
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"IEEE 802.11 element "
literal|"parse failed (id=%d elen=%d "
literal|"left=%lu)"
argument_list|,
name|id
argument_list|,
name|elen
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|left
argument_list|)
expr_stmt|;
name|wpa_hexdump
argument_list|(
name|MSG_MSGDUMP
argument_list|,
literal|"IEs"
argument_list|,
name|start
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
return|return
name|ParseFailed
return|;
block|}
switch|switch
condition|(
name|id
condition|)
block|{
case|case
name|WLAN_EID_SSID
case|:
name|elems
operator|->
name|ssid
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|ssid_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_SUPP_RATES
case|:
name|elems
operator|->
name|supp_rates
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|supp_rates_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_FH_PARAMS
case|:
name|elems
operator|->
name|fh_params
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|fh_params_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_DS_PARAMS
case|:
name|elems
operator|->
name|ds_params
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|ds_params_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_CF_PARAMS
case|:
name|elems
operator|->
name|cf_params
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|cf_params_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_TIM
case|:
name|elems
operator|->
name|tim
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|tim_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_IBSS_PARAMS
case|:
name|elems
operator|->
name|ibss_params
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|ibss_params_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_CHALLENGE
case|:
name|elems
operator|->
name|challenge
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|challenge_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_ERP_INFO
case|:
name|elems
operator|->
name|erp_info
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|erp_info_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_EXT_SUPP_RATES
case|:
name|elems
operator|->
name|ext_supp_rates
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|ext_supp_rates_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_VENDOR_SPECIFIC
case|:
if|if
condition|(
name|ieee802_11_parse_vendor_specific
argument_list|(
name|pos
argument_list|,
name|elen
argument_list|,
name|elems
argument_list|,
name|show_errors
argument_list|)
condition|)
name|unknown
operator|++
expr_stmt|;
break|break;
case|case
name|WLAN_EID_RSN
case|:
name|elems
operator|->
name|rsn_ie
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|rsn_ie_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_PWR_CAPABILITY
case|:
name|elems
operator|->
name|power_cap
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|power_cap_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_SUPPORTED_CHANNELS
case|:
name|elems
operator|->
name|supp_channels
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|supp_channels_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_MOBILITY_DOMAIN
case|:
name|elems
operator|->
name|mdie
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|mdie_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_FAST_BSS_TRANSITION
case|:
name|elems
operator|->
name|ftie
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|ftie_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_TIMEOUT_INTERVAL
case|:
name|elems
operator|->
name|timeout_int
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|timeout_int_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_HT_CAP
case|:
name|elems
operator|->
name|ht_capabilities
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|ht_capabilities_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_HT_OPERATION
case|:
name|elems
operator|->
name|ht_operation
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|ht_operation_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_VHT_CAP
case|:
name|elems
operator|->
name|vht_capabilities
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|vht_capabilities_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_VHT_OPERATION
case|:
name|elems
operator|->
name|vht_operation
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|vht_operation_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_LINK_ID
case|:
if|if
condition|(
name|elen
operator|<
literal|18
condition|)
break|break;
name|elems
operator|->
name|link_id
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|WLAN_EID_INTERWORKING
case|:
name|elems
operator|->
name|interworking
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|interworking_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_EXT_CAPAB
case|:
name|elems
operator|->
name|ext_capab
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|ext_capab_len
operator|=
name|elen
expr_stmt|;
break|break;
case|case
name|WLAN_EID_BSS_MAX_IDLE_PERIOD
case|:
if|if
condition|(
name|elen
operator|<
literal|3
condition|)
break|break;
name|elems
operator|->
name|bss_max_idle_period
operator|=
name|pos
expr_stmt|;
break|break;
case|case
name|WLAN_EID_SSID_LIST
case|:
name|elems
operator|->
name|ssid_list
operator|=
name|pos
expr_stmt|;
name|elems
operator|->
name|ssid_list_len
operator|=
name|elen
expr_stmt|;
break|break;
default|default:
name|unknown
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|show_errors
condition|)
break|break;
name|wpa_printf
argument_list|(
name|MSG_MSGDUMP
argument_list|,
literal|"IEEE 802.11 element parse "
literal|"ignored unknown element (id=%d elen=%d)"
argument_list|,
name|id
argument_list|,
name|elen
argument_list|)
expr_stmt|;
break|break;
block|}
name|left
operator|-=
name|elen
expr_stmt|;
name|pos
operator|+=
name|elen
expr_stmt|;
block|}
if|if
condition|(
name|left
condition|)
return|return
name|ParseFailed
return|;
return|return
name|unknown
condition|?
name|ParseUnknown
else|:
name|ParseOK
return|;
block|}
end_function

begin_function
name|int
name|ieee802_11_ie_count
parameter_list|(
specifier|const
name|u8
modifier|*
name|ies
parameter_list|,
name|size_t
name|ies_len
parameter_list|)
block|{
name|int
name|count
init|=
literal|0
decl_stmt|;
specifier|const
name|u8
modifier|*
name|pos
decl_stmt|,
modifier|*
name|end
decl_stmt|;
if|if
condition|(
name|ies
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
name|pos
operator|=
name|ies
expr_stmt|;
name|end
operator|=
name|ies
operator|+
name|ies_len
expr_stmt|;
while|while
condition|(
name|pos
operator|+
literal|2
operator|<=
name|end
condition|)
block|{
if|if
condition|(
name|pos
operator|+
literal|2
operator|+
name|pos
index|[
literal|1
index|]
operator|>
name|end
condition|)
break|break;
name|count
operator|++
expr_stmt|;
name|pos
operator|+=
literal|2
operator|+
name|pos
index|[
literal|1
index|]
expr_stmt|;
block|}
return|return
name|count
return|;
block|}
end_function

begin_function
name|struct
name|wpabuf
modifier|*
name|ieee802_11_vendor_ie_concat
parameter_list|(
specifier|const
name|u8
modifier|*
name|ies
parameter_list|,
name|size_t
name|ies_len
parameter_list|,
name|u32
name|oui_type
parameter_list|)
block|{
name|struct
name|wpabuf
modifier|*
name|buf
decl_stmt|;
specifier|const
name|u8
modifier|*
name|end
decl_stmt|,
modifier|*
name|pos
decl_stmt|,
modifier|*
name|ie
decl_stmt|;
name|pos
operator|=
name|ies
expr_stmt|;
name|end
operator|=
name|ies
operator|+
name|ies_len
expr_stmt|;
name|ie
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
name|pos
operator|+
literal|1
operator|<
name|end
condition|)
block|{
if|if
condition|(
name|pos
operator|+
literal|2
operator|+
name|pos
index|[
literal|1
index|]
operator|>
name|end
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|pos
index|[
literal|0
index|]
operator|==
name|WLAN_EID_VENDOR_SPECIFIC
operator|&&
name|pos
index|[
literal|1
index|]
operator|>=
literal|4
operator|&&
name|WPA_GET_BE32
argument_list|(
operator|&
name|pos
index|[
literal|2
index|]
argument_list|)
operator|==
name|oui_type
condition|)
block|{
name|ie
operator|=
name|pos
expr_stmt|;
break|break;
block|}
name|pos
operator|+=
literal|2
operator|+
name|pos
index|[
literal|1
index|]
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
comment|/* No specified vendor IE found */
name|buf
operator|=
name|wpabuf_alloc
argument_list|(
name|ies_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
comment|/* 	 * There may be multiple vendor IEs in the message, so need to 	 * concatenate their data fields. 	 */
while|while
condition|(
name|pos
operator|+
literal|1
operator|<
name|end
condition|)
block|{
if|if
condition|(
name|pos
operator|+
literal|2
operator|+
name|pos
index|[
literal|1
index|]
operator|>
name|end
condition|)
break|break;
if|if
condition|(
name|pos
index|[
literal|0
index|]
operator|==
name|WLAN_EID_VENDOR_SPECIFIC
operator|&&
name|pos
index|[
literal|1
index|]
operator|>=
literal|4
operator|&&
name|WPA_GET_BE32
argument_list|(
operator|&
name|pos
index|[
literal|2
index|]
argument_list|)
operator|==
name|oui_type
condition|)
name|wpabuf_put_data
argument_list|(
name|buf
argument_list|,
name|pos
operator|+
literal|6
argument_list|,
name|pos
index|[
literal|1
index|]
operator|-
literal|4
argument_list|)
expr_stmt|;
name|pos
operator|+=
literal|2
operator|+
name|pos
index|[
literal|1
index|]
expr_stmt|;
block|}
return|return
name|buf
return|;
block|}
end_function

begin_function
specifier|const
name|u8
modifier|*
name|get_hdr_bssid
parameter_list|(
specifier|const
name|struct
name|ieee80211_hdr
modifier|*
name|hdr
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|u16
name|fc
decl_stmt|,
name|type
decl_stmt|,
name|stype
decl_stmt|;
comment|/* 	 * PS-Poll frames are 16 bytes. All other frames are 	 * 24 bytes or longer. 	 */
if|if
condition|(
name|len
operator|<
literal|16
condition|)
return|return
name|NULL
return|;
name|fc
operator|=
name|le_to_host16
argument_list|(
name|hdr
operator|->
name|frame_control
argument_list|)
expr_stmt|;
name|type
operator|=
name|WLAN_FC_GET_TYPE
argument_list|(
name|fc
argument_list|)
expr_stmt|;
name|stype
operator|=
name|WLAN_FC_GET_STYPE
argument_list|(
name|fc
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|WLAN_FC_TYPE_DATA
case|:
if|if
condition|(
name|len
operator|<
literal|24
condition|)
return|return
name|NULL
return|;
switch|switch
condition|(
name|fc
operator|&
operator|(
name|WLAN_FC_FROMDS
operator||
name|WLAN_FC_TODS
operator|)
condition|)
block|{
case|case
name|WLAN_FC_FROMDS
operator||
name|WLAN_FC_TODS
case|:
case|case
name|WLAN_FC_TODS
case|:
return|return
name|hdr
operator|->
name|addr1
return|;
case|case
name|WLAN_FC_FROMDS
case|:
return|return
name|hdr
operator|->
name|addr2
return|;
default|default:
return|return
name|NULL
return|;
block|}
case|case
name|WLAN_FC_TYPE_CTRL
case|:
if|if
condition|(
name|stype
operator|!=
name|WLAN_FC_STYPE_PSPOLL
condition|)
return|return
name|NULL
return|;
return|return
name|hdr
operator|->
name|addr1
return|;
case|case
name|WLAN_FC_TYPE_MGMT
case|:
return|return
name|hdr
operator|->
name|addr3
return|;
default|default:
return|return
name|NULL
return|;
block|}
block|}
end_function

begin_function
name|int
name|hostapd_config_wmm_ac
parameter_list|(
name|struct
name|hostapd_wmm_ac_params
name|wmm_ac_params
index|[]
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|char
modifier|*
name|val
parameter_list|)
block|{
name|int
name|num
decl_stmt|,
name|v
decl_stmt|;
specifier|const
name|char
modifier|*
name|pos
decl_stmt|;
name|struct
name|hostapd_wmm_ac_params
modifier|*
name|ac
decl_stmt|;
comment|/* skip 'wme_ac_' or 'wmm_ac_' prefix */
name|pos
operator|=
name|name
operator|+
literal|7
expr_stmt|;
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"be_"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|num
operator|=
literal|0
expr_stmt|;
name|pos
operator|+=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"bk_"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|num
operator|=
literal|1
expr_stmt|;
name|pos
operator|+=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"vi_"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|num
operator|=
literal|2
expr_stmt|;
name|pos
operator|+=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"vo_"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|num
operator|=
literal|3
expr_stmt|;
name|pos
operator|+=
literal|3
expr_stmt|;
block|}
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Unknown WMM name '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|=
operator|&
name|wmm_ac_params
index|[
name|num
index|]
expr_stmt|;
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"aifs"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|v
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|1
operator|||
name|v
operator|>
literal|255
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid AIFS value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|->
name|aifs
operator|=
name|v
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"cwmin"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|v
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
operator|||
name|v
operator|>
literal|12
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid cwMin value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|->
name|cwmin
operator|=
name|v
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"cwmax"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|v
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
operator|||
name|v
operator|>
literal|12
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid cwMax value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|->
name|cwmax
operator|=
name|v
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"txop_limit"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|v
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
operator|||
name|v
operator|>
literal|0xffff
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid txop value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|->
name|txop_limit
operator|=
name|v
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"acm"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|v
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
operator|||
name|v
operator|>
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid acm value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|->
name|admission_control_mandatory
operator|=
name|v
expr_stmt|;
block|}
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Unknown wmm_ac_ field '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

end_unit

