begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * hostapd / Configuration file parser  * Copyright (c) 2003-2012, Jouni Malinen<j@w1.fi>  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_include
include|#
directive|include
file|"utils/includes.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|CONFIG_NATIVE_WINDOWS
end_ifndef

begin_include
include|#
directive|include
file|<grp.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_NATIVE_WINDOWS */
end_comment

begin_include
include|#
directive|include
file|"utils/common.h"
end_include

begin_include
include|#
directive|include
file|"utils/uuid.h"
end_include

begin_include
include|#
directive|include
file|"common/ieee802_11_defs.h"
end_include

begin_include
include|#
directive|include
file|"drivers/driver.h"
end_include

begin_include
include|#
directive|include
file|"eap_server/eap.h"
end_include

begin_include
include|#
directive|include
file|"radius/radius_client.h"
end_include

begin_include
include|#
directive|include
file|"ap/wpa_auth.h"
end_include

begin_include
include|#
directive|include
file|"ap/ap_config.h"
end_include

begin_include
include|#
directive|include
file|"config_file.h"
end_include

begin_decl_stmt
specifier|extern
name|struct
name|wpa_driver_ops
modifier|*
name|wpa_drivers
index|[]
decl_stmt|;
end_decl_stmt

begin_ifndef
ifndef|#
directive|ifndef
name|CONFIG_NO_VLAN
end_ifndef

begin_function
specifier|static
name|int
name|hostapd_config_read_vlan_file
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
specifier|const
name|char
modifier|*
name|fname
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|128
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|,
modifier|*
name|pos2
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|,
name|vlan_id
decl_stmt|;
name|struct
name|hostapd_vlan
modifier|*
name|vlan
decl_stmt|;
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|f
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"VLAN file '%s' not readable."
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'*'
condition|)
block|{
name|vlan_id
operator|=
name|VLAN_ID_WILDCARD
expr_stmt|;
name|pos
operator|=
name|buf
operator|+
literal|1
expr_stmt|;
block|}
else|else
block|{
name|vlan_id
operator|=
name|strtol
argument_list|(
name|buf
argument_list|,
operator|&
name|pos
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|pos
operator|||
name|vlan_id
operator|<
literal|1
operator|||
name|vlan_id
operator|>
name|MAX_VLAN_ID
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid VLAN ID at "
literal|"line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
name|pos2
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos2
operator|!=
literal|' '
operator|&&
operator|*
name|pos2
operator|!=
literal|'\t'
operator|&&
operator|*
name|pos2
operator|!=
literal|'\0'
condition|)
name|pos2
operator|++
expr_stmt|;
operator|*
name|pos2
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
operator|||
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
name|IFNAMSIZ
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid VLAN ifname at line %d "
literal|"in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|vlan
operator|=
name|os_malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|vlan
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|vlan
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Out of memory while reading "
literal|"VLAN interfaces from '%s'"
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|os_memset
argument_list|(
name|vlan
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|vlan
argument_list|)
argument_list|)
expr_stmt|;
name|vlan
operator|->
name|vlan_id
operator|=
name|vlan_id
expr_stmt|;
name|os_strlcpy
argument_list|(
name|vlan
operator|->
name|ifname
argument_list|,
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|vlan
operator|->
name|ifname
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|vlan_tail
condition|)
name|bss
operator|->
name|vlan_tail
operator|->
name|next
operator|=
name|vlan
expr_stmt|;
else|else
name|bss
operator|->
name|vlan
operator|=
name|vlan
expr_stmt|;
name|bss
operator|->
name|vlan_tail
operator|=
name|vlan
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_NO_VLAN */
end_comment

begin_function
specifier|static
name|int
name|hostapd_acl_comp
parameter_list|(
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|b
parameter_list|)
block|{
specifier|const
name|struct
name|mac_acl_entry
modifier|*
name|aa
init|=
name|a
decl_stmt|;
specifier|const
name|struct
name|mac_acl_entry
modifier|*
name|bb
init|=
name|b
decl_stmt|;
return|return
name|os_memcmp
argument_list|(
name|aa
operator|->
name|addr
argument_list|,
name|bb
operator|->
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|macaddr
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_read_maclist
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|,
name|struct
name|mac_acl_entry
modifier|*
modifier|*
name|acl
parameter_list|,
name|int
modifier|*
name|num
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|128
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|;
name|u8
name|addr
index|[
name|ETH_ALEN
index|]
decl_stmt|;
name|struct
name|mac_acl_entry
modifier|*
name|newacl
decl_stmt|;
name|int
name|vlan_id
decl_stmt|;
if|if
condition|(
operator|!
name|fname
condition|)
return|return
literal|0
return|;
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|f
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"MAC list file '%s' not found."
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
if|if
condition|(
name|hwaddr_aton
argument_list|(
name|buf
argument_list|,
name|addr
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid MAC address '%s' at "
literal|"line %d in '%s'"
argument_list|,
name|buf
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|vlan_id
operator|=
literal|0
expr_stmt|;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
operator|&&
operator|*
name|pos
operator|!=
literal|' '
operator|&&
operator|*
name|pos
operator|!=
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
name|vlan_id
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|newacl
operator|=
name|os_realloc_array
argument_list|(
operator|*
name|acl
argument_list|,
operator|*
name|num
operator|+
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
operator|*
name|acl
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|newacl
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"MAC list reallocation failed"
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
operator|*
name|acl
operator|=
name|newacl
expr_stmt|;
name|os_memcpy
argument_list|(
operator|(
operator|*
name|acl
operator|)
index|[
operator|*
name|num
index|]
operator|.
name|addr
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
expr_stmt|;
operator|(
operator|*
name|acl
operator|)
index|[
operator|*
name|num
index|]
operator|.
name|vlan_id
operator|=
name|vlan_id
expr_stmt|;
operator|(
operator|*
name|num
operator|)
operator|++
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|qsort
argument_list|(
operator|*
name|acl
argument_list|,
operator|*
name|num
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
operator|*
name|acl
argument_list|)
argument_list|,
name|hostapd_acl_comp
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|EAP_SERVER
end_ifdef

begin_function
specifier|static
name|int
name|hostapd_config_read_eap_user
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|,
name|struct
name|hostapd_bss_config
modifier|*
name|conf
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|512
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|,
modifier|*
name|start
decl_stmt|,
modifier|*
name|pos2
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|,
name|ret
init|=
literal|0
decl_stmt|,
name|num_methods
decl_stmt|;
name|struct
name|hostapd_eap_user
modifier|*
name|user
decl_stmt|,
modifier|*
name|tail
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|fname
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|os_strncmp
argument_list|(
name|fname
argument_list|,
literal|"sqlite:"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|conf
operator|->
name|eap_user_sqlite
argument_list|)
expr_stmt|;
name|conf
operator|->
name|eap_user_sqlite
operator|=
name|os_strdup
argument_list|(
name|fname
operator|+
literal|7
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|f
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"EAP user file '%s' not found."
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
comment|/* Lines: "user" METHOD,METHOD2 "password" (password optional) */
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
name|user
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|!=
literal|'"'
operator|&&
name|buf
index|[
literal|0
index|]
operator|!=
literal|'*'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid EAP identity (no \" in "
literal|"start) on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|user
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"EAP user allocation failed"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|force_version
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'*'
condition|)
block|{
name|pos
operator|=
name|buf
expr_stmt|;
block|}
else|else
block|{
name|pos
operator|=
name|buf
operator|+
literal|1
expr_stmt|;
name|start
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'"'
operator|&&
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid EAP identity "
literal|"(no \" in end) on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|identity
operator|=
name|os_malloc
argument_list|(
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|identity
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate "
literal|"memory for EAP identity"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|os_memcpy
argument_list|(
name|user
operator|->
name|identity
argument_list|,
name|start
argument_list|,
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
name|user
operator|->
name|identity_len
operator|=
name|pos
operator|-
name|start
expr_stmt|;
if|if
condition|(
name|pos
index|[
literal|0
index|]
operator|==
literal|'"'
operator|&&
name|pos
index|[
literal|1
index|]
operator|==
literal|'*'
condition|)
block|{
name|user
operator|->
name|wildcard_prefix
operator|=
literal|1
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
block|}
name|pos
operator|++
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"No EAP method on line %d in "
literal|"'%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|start
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|' '
operator|&&
operator|*
name|pos
operator|!=
literal|'\t'
operator|&&
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|pos
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
name|num_methods
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|start
condition|)
block|{
name|char
modifier|*
name|pos3
init|=
name|os_strchr
argument_list|(
name|start
argument_list|,
literal|','
argument_list|)
decl_stmt|;
if|if
condition|(
name|pos3
condition|)
block|{
operator|*
name|pos3
operator|++
operator|=
literal|'\0'
expr_stmt|;
block|}
name|user
operator|->
name|methods
index|[
name|num_methods
index|]
operator|.
name|method
operator|=
name|eap_server_get_type
argument_list|(
name|start
argument_list|,
operator|&
name|user
operator|->
name|methods
index|[
name|num_methods
index|]
operator|.
name|vendor
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|methods
index|[
name|num_methods
index|]
operator|.
name|vendor
operator|==
name|EAP_VENDOR_IETF
operator|&&
name|user
operator|->
name|methods
index|[
name|num_methods
index|]
operator|.
name|method
operator|==
name|EAP_TYPE_NONE
condition|)
block|{
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"TTLS-PAP"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|ttls_auth
operator||=
name|EAP_TTLS_AUTH_PAP
expr_stmt|;
goto|goto
name|skip_eap
goto|;
block|}
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"TTLS-CHAP"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|ttls_auth
operator||=
name|EAP_TTLS_AUTH_CHAP
expr_stmt|;
goto|goto
name|skip_eap
goto|;
block|}
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"TTLS-MSCHAP"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|ttls_auth
operator||=
name|EAP_TTLS_AUTH_MSCHAP
expr_stmt|;
goto|goto
name|skip_eap
goto|;
block|}
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"TTLS-MSCHAPV2"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|ttls_auth
operator||=
name|EAP_TTLS_AUTH_MSCHAPV2
expr_stmt|;
goto|goto
name|skip_eap
goto|;
block|}
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Unsupported EAP type "
literal|"'%s' on line %d in '%s'"
argument_list|,
name|start
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|num_methods
operator|++
expr_stmt|;
if|if
condition|(
name|num_methods
operator|>=
name|EAP_MAX_METHODS
condition|)
break|break;
name|skip_eap
label|:
if|if
condition|(
name|pos3
operator|==
name|NULL
condition|)
break|break;
name|start
operator|=
name|pos3
expr_stmt|;
block|}
if|if
condition|(
name|num_methods
operator|==
literal|0
operator|&&
name|user
operator|->
name|ttls_auth
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"No EAP types configured on "
literal|"line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
goto|goto
name|done
goto|;
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
goto|goto
name|done
goto|;
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"[ver=0]"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|force_version
operator|=
literal|0
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"[ver=1]"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|force_version
operator|=
literal|1
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"[2]"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|phase2
operator|=
literal|1
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
operator|*
name|pos
operator|==
literal|'"'
condition|)
block|{
name|pos
operator|++
expr_stmt|;
name|start
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'"'
operator|&&
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid EAP password "
literal|"(no \" in end) on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password
operator|=
name|os_malloc
argument_list|(
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|password
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate "
literal|"memory for EAP password"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|os_memcpy
argument_list|(
name|user
operator|->
name|password
argument_list|,
name|start
argument_list|,
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
name|user
operator|->
name|password_len
operator|=
name|pos
operator|-
name|start
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"hash:"
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
block|{
name|pos
operator|+=
literal|5
expr_stmt|;
name|pos2
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos2
operator|!=
literal|'\0'
operator|&&
operator|*
name|pos2
operator|!=
literal|' '
operator|&&
operator|*
name|pos2
operator|!=
literal|'\t'
operator|&&
operator|*
name|pos2
operator|!=
literal|'#'
condition|)
name|pos2
operator|++
expr_stmt|;
if|if
condition|(
name|pos2
operator|-
name|pos
operator|!=
literal|32
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid password hash "
literal|"on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password
operator|=
name|os_malloc
argument_list|(
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|password
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate "
literal|"memory for EAP password hash"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|user
operator|->
name|password
argument_list|,
literal|16
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid hash password "
literal|"on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password_len
operator|=
literal|16
expr_stmt|;
name|user
operator|->
name|password_hash
operator|=
literal|1
expr_stmt|;
name|pos
operator|=
name|pos2
expr_stmt|;
block|}
else|else
block|{
name|pos2
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos2
operator|!=
literal|'\0'
operator|&&
operator|*
name|pos2
operator|!=
literal|' '
operator|&&
operator|*
name|pos2
operator|!=
literal|'\t'
operator|&&
operator|*
name|pos2
operator|!=
literal|'#'
condition|)
name|pos2
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|&
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid hex password "
literal|"on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password
operator|=
name|os_malloc
argument_list|(
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|/
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|password
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate "
literal|"memory for EAP password"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|user
operator|->
name|password
argument_list|,
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|/
literal|2
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid hex password "
literal|"on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password_len
operator|=
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|/
literal|2
expr_stmt|;
name|pos
operator|=
name|pos2
expr_stmt|;
block|}
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"[2]"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|phase2
operator|=
literal|1
expr_stmt|;
block|}
name|done
label|:
if|if
condition|(
name|tail
operator|==
name|NULL
condition|)
block|{
name|tail
operator|=
name|conf
operator|->
name|eap_user
operator|=
name|user
expr_stmt|;
block|}
else|else
block|{
name|tail
operator|->
name|next
operator|=
name|user
expr_stmt|;
name|tail
operator|=
name|user
expr_stmt|;
block|}
continue|continue;
name|failed
label|:
if|if
condition|(
name|user
condition|)
block|{
name|os_free
argument_list|(
name|user
operator|->
name|password
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|user
operator|->
name|identity
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|user
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* EAP_SERVER */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|CONFIG_NO_RADIUS
end_ifndef

begin_function
specifier|static
name|int
name|hostapd_config_read_radius_addr
parameter_list|(
name|struct
name|hostapd_radius_server
modifier|*
modifier|*
name|server
parameter_list|,
name|int
modifier|*
name|num_server
parameter_list|,
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|def_port
parameter_list|,
name|struct
name|hostapd_radius_server
modifier|*
modifier|*
name|curr_serv
parameter_list|)
block|{
name|struct
name|hostapd_radius_server
modifier|*
name|nserv
decl_stmt|;
name|int
name|ret
decl_stmt|;
specifier|static
name|int
name|server_index
init|=
literal|1
decl_stmt|;
name|nserv
operator|=
name|os_realloc_array
argument_list|(
operator|*
name|server
argument_list|,
operator|*
name|num_server
operator|+
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|nserv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|nserv
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
operator|*
name|server
operator|=
name|nserv
expr_stmt|;
name|nserv
operator|=
operator|&
name|nserv
index|[
operator|*
name|num_server
index|]
expr_stmt|;
operator|(
operator|*
name|num_server
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|curr_serv
operator|)
operator|=
name|nserv
expr_stmt|;
name|os_memset
argument_list|(
name|nserv
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|nserv
argument_list|)
argument_list|)
expr_stmt|;
name|nserv
operator|->
name|port
operator|=
name|def_port
expr_stmt|;
name|ret
operator|=
name|hostapd_parse_ip_addr
argument_list|(
name|val
argument_list|,
operator|&
name|nserv
operator|->
name|addr
argument_list|)
expr_stmt|;
name|nserv
operator|->
name|index
operator|=
name|server_index
operator|++
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|hostapd_radius_attr
modifier|*
name|hostapd_parse_radius_attr
parameter_list|(
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|pos
decl_stmt|;
name|char
name|syntax
decl_stmt|;
name|struct
name|hostapd_radius_attr
modifier|*
name|attr
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|attr
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|attr
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|attr
operator|->
name|type
operator|=
name|atoi
argument_list|(
name|value
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|value
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
block|{
name|attr
operator|->
name|val
operator|=
name|wpabuf_alloc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr
operator|->
name|val
operator|==
name|NULL
condition|)
block|{
name|os_free
argument_list|(
name|attr
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|wpabuf_put_u8
argument_list|(
name|attr
operator|->
name|val
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|attr
return|;
block|}
name|pos
operator|++
expr_stmt|;
if|if
condition|(
name|pos
index|[
literal|0
index|]
operator|==
literal|'\0'
operator|||
name|pos
index|[
literal|1
index|]
operator|!=
literal|':'
condition|)
block|{
name|os_free
argument_list|(
name|attr
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|syntax
operator|=
operator|*
name|pos
operator|++
expr_stmt|;
name|pos
operator|++
expr_stmt|;
switch|switch
condition|(
name|syntax
condition|)
block|{
case|case
literal|'s'
case|:
name|attr
operator|->
name|val
operator|=
name|wpabuf_alloc_copy
argument_list|(
name|pos
argument_list|,
name|os_strlen
argument_list|(
name|pos
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'x'
case|:
name|len
operator|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|&
literal|1
condition|)
break|break;
name|len
operator|/=
literal|2
expr_stmt|;
name|attr
operator|->
name|val
operator|=
name|wpabuf_alloc
argument_list|(
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr
operator|->
name|val
operator|==
name|NULL
condition|)
break|break;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|wpabuf_put
argument_list|(
name|attr
operator|->
name|val
argument_list|,
name|len
argument_list|)
argument_list|,
name|len
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpabuf_free
argument_list|(
name|attr
operator|->
name|val
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|attr
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
break|break;
case|case
literal|'d'
case|:
name|attr
operator|->
name|val
operator|=
name|wpabuf_alloc
argument_list|(
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr
operator|->
name|val
condition|)
name|wpabuf_put_be32
argument_list|(
name|attr
operator|->
name|val
argument_list|,
name|atoi
argument_list|(
name|pos
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|os_free
argument_list|(
name|attr
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|attr
operator|->
name|val
operator|==
name|NULL
condition|)
block|{
name|os_free
argument_list|(
name|attr
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|attr
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_parse_das_client
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
specifier|const
name|char
modifier|*
name|val
parameter_list|)
block|{
name|char
modifier|*
name|secret
decl_stmt|;
name|secret
operator|=
name|os_strchr
argument_list|(
name|val
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|secret
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|secret
operator|++
expr_stmt|;
if|if
condition|(
name|hostapd_parse_ip_addr
argument_list|(
name|val
argument_list|,
operator|&
name|bss
operator|->
name|radius_das_client_addr
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|os_free
argument_list|(
name|bss
operator|->
name|radius_das_shared_secret
argument_list|)
expr_stmt|;
name|bss
operator|->
name|radius_das_shared_secret
operator|=
operator|(
name|u8
operator|*
operator|)
name|os_strdup
argument_list|(
name|secret
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|radius_das_shared_secret
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|bss
operator|->
name|radius_das_shared_secret_len
operator|=
name|os_strlen
argument_list|(
name|secret
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_NO_RADIUS */
end_comment

begin_function
specifier|static
name|int
name|hostapd_config_parse_key_mgmt
parameter_list|(
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|,
name|last
decl_stmt|;
name|char
modifier|*
name|start
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|os_strdup
argument_list|(
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|start
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|start
operator|!=
literal|'\0'
condition|)
block|{
while|while
condition|(
operator|*
name|start
operator|==
literal|' '
operator|||
operator|*
name|start
operator|==
literal|'\t'
condition|)
name|start
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|start
operator|==
literal|'\0'
condition|)
break|break;
name|end
operator|=
name|start
expr_stmt|;
while|while
condition|(
operator|*
name|end
operator|!=
literal|' '
operator|&&
operator|*
name|end
operator|!=
literal|'\t'
operator|&&
operator|*
name|end
operator|!=
literal|'\0'
condition|)
name|end
operator|++
expr_stmt|;
name|last
operator|=
operator|*
name|end
operator|==
literal|'\0'
expr_stmt|;
operator|*
name|end
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WPA-PSK"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_PSK
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WPA-EAP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_IEEE8021X
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211R
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"FT-PSK"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_FT_PSK
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"FT-EAP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_FT_IEEE8021X
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IEEE80211R */
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211W
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WPA-PSK-SHA256"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_PSK_SHA256
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WPA-EAP-SHA256"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_IEEE8021X_SHA256
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IEEE80211W */
ifdef|#
directive|ifdef
name|CONFIG_SAE
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"SAE"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_SAE
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"FT-SAE"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_FT_SAE
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_SAE */
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid key_mgmt '%s'"
argument_list|,
name|line
argument_list|,
name|start
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|last
condition|)
break|break;
name|start
operator|=
name|end
operator|+
literal|1
expr_stmt|;
block|}
name|os_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: no key_mgmt values "
literal|"configured."
argument_list|,
name|line
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|val
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_parse_cipher
parameter_list|(
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|,
name|last
decl_stmt|;
name|char
modifier|*
name|start
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|os_strdup
argument_list|(
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|start
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|start
operator|!=
literal|'\0'
condition|)
block|{
while|while
condition|(
operator|*
name|start
operator|==
literal|' '
operator|||
operator|*
name|start
operator|==
literal|'\t'
condition|)
name|start
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|start
operator|==
literal|'\0'
condition|)
break|break;
name|end
operator|=
name|start
expr_stmt|;
while|while
condition|(
operator|*
name|end
operator|!=
literal|' '
operator|&&
operator|*
name|end
operator|!=
literal|'\t'
operator|&&
operator|*
name|end
operator|!=
literal|'\0'
condition|)
name|end
operator|++
expr_stmt|;
name|last
operator|=
operator|*
name|end
operator|==
literal|'\0'
expr_stmt|;
operator|*
name|end
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"CCMP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_CCMP
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"GCMP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_GCMP
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"TKIP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_TKIP
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WEP104"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_WEP104
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WEP40"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_WEP40
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"NONE"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_NONE
expr_stmt|;
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid cipher '%s'."
argument_list|,
name|line
argument_list|,
name|start
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|last
condition|)
break|break;
name|start
operator|=
name|end
operator|+
literal|1
expr_stmt|;
block|}
name|os_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: no cipher values configured."
argument_list|,
name|line
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|val
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_read_wep
parameter_list|(
name|struct
name|hostapd_wep_keys
modifier|*
name|wep
parameter_list|,
name|int
name|keyidx
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|size_t
name|len
init|=
name|os_strlen
argument_list|(
name|val
argument_list|)
decl_stmt|;
if|if
condition|(
name|keyidx
operator|<
literal|0
operator|||
name|keyidx
operator|>
literal|3
operator|||
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
operator|!=
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|val
index|[
literal|0
index|]
operator|==
literal|'"'
condition|)
block|{
if|if
condition|(
name|len
operator|<
literal|2
operator|||
name|val
index|[
name|len
operator|-
literal|1
index|]
operator|!=
literal|'"'
condition|)
return|return
operator|-
literal|1
return|;
name|len
operator|-=
literal|2
expr_stmt|;
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
operator|=
name|os_malloc
argument_list|(
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|os_memcpy
argument_list|(
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
argument_list|,
name|val
operator|+
literal|1
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|wep
operator|->
name|len
index|[
name|keyidx
index|]
operator|=
name|len
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|len
operator|&
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|len
operator|/=
literal|2
expr_stmt|;
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
operator|=
name|os_malloc
argument_list|(
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|wep
operator|->
name|len
index|[
name|keyidx
index|]
operator|=
name|len
expr_stmt|;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|val
argument_list|,
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
argument_list|,
name|len
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
block|}
name|wep
operator|->
name|keys_set
operator|++
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_parse_rates
parameter_list|(
name|int
modifier|*
modifier|*
name|rate_list
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|int
modifier|*
name|list
decl_stmt|;
name|int
name|count
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|,
modifier|*
name|end
decl_stmt|;
name|os_free
argument_list|(
operator|*
name|rate_list
argument_list|)
expr_stmt|;
operator|*
name|rate_list
operator|=
name|NULL
expr_stmt|;
name|pos
operator|=
name|val
expr_stmt|;
name|count
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|' '
condition|)
name|count
operator|++
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
name|list
operator|=
name|os_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|int
argument_list|)
operator|*
operator|(
name|count
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|list
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|pos
operator|=
name|val
expr_stmt|;
name|count
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
name|end
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|end
condition|)
operator|*
name|end
operator|=
literal|'\0'
expr_stmt|;
name|list
index|[
name|count
operator|++
index|]
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|end
condition|)
break|break;
name|pos
operator|=
name|end
operator|+
literal|1
expr_stmt|;
block|}
name|list
index|[
name|count
index|]
operator|=
operator|-
literal|1
expr_stmt|;
operator|*
name|rate_list
operator|=
name|list
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_bss
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
specifier|const
name|char
modifier|*
name|ifname
parameter_list|)
block|{
name|struct
name|hostapd_bss_config
modifier|*
name|bss
decl_stmt|;
if|if
condition|(
operator|*
name|ifname
operator|==
literal|'\0'
condition|)
return|return
operator|-
literal|1
return|;
name|bss
operator|=
name|os_realloc_array
argument_list|(
name|conf
operator|->
name|bss
argument_list|,
name|conf
operator|->
name|num_bss
operator|+
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_bss_config
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate memory for "
literal|"multi-BSS entry"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|conf
operator|->
name|bss
operator|=
name|bss
expr_stmt|;
name|bss
operator|=
operator|&
operator|(
name|conf
operator|->
name|bss
index|[
name|conf
operator|->
name|num_bss
index|]
operator|)
expr_stmt|;
name|os_memset
argument_list|(
name|bss
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|bss
argument_list|)
argument_list|)
expr_stmt|;
name|bss
operator|->
name|radius
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|bss
operator|->
name|radius
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|radius
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate memory for "
literal|"multi-BSS RADIUS data"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|conf
operator|->
name|num_bss
operator|++
expr_stmt|;
name|conf
operator|->
name|last_bss
operator|=
name|bss
expr_stmt|;
name|hostapd_config_defaults_bss
argument_list|(
name|bss
argument_list|)
expr_stmt|;
name|os_strlcpy
argument_list|(
name|bss
operator|->
name|iface
argument_list|,
name|ifname
argument_list|,
sizeof|sizeof
argument_list|(
name|bss
operator|->
name|iface
argument_list|)
argument_list|)
expr_stmt|;
name|os_memcpy
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|vlan
argument_list|,
name|bss
operator|->
name|iface
argument_list|,
name|IFNAMSIZ
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* convert floats with one decimal place to value*10 int, i.e.,  * "1.5" will return 15 */
end_comment

begin_function
specifier|static
name|int
name|hostapd_config_read_int10
parameter_list|(
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|d
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|;
name|i
operator|=
name|atoi
argument_list|(
name|value
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|value
argument_list|,
literal|'.'
argument_list|)
expr_stmt|;
name|d
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|pos
condition|)
block|{
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|>=
literal|'0'
operator|&&
operator|*
name|pos
operator|<=
literal|'9'
condition|)
name|d
operator|=
operator|*
name|pos
operator|-
literal|'0'
expr_stmt|;
block|}
return|return
name|i
operator|*
literal|10
operator|+
name|d
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|valid_cw
parameter_list|(
name|int
name|cw
parameter_list|)
block|{
return|return
operator|(
name|cw
operator|==
literal|1
operator|||
name|cw
operator|==
literal|3
operator|||
name|cw
operator|==
literal|7
operator|||
name|cw
operator|==
literal|15
operator|||
name|cw
operator|==
literal|31
operator|||
name|cw
operator|==
literal|63
operator|||
name|cw
operator|==
literal|127
operator|||
name|cw
operator|==
literal|255
operator|||
name|cw
operator|==
literal|511
operator|||
name|cw
operator|==
literal|1023
operator|)
return|;
block|}
end_function

begin_enum
enum|enum
block|{
name|IEEE80211_TX_QUEUE_DATA0
init|=
literal|0
block|,
comment|/* used for EDCA AC_VO data */
name|IEEE80211_TX_QUEUE_DATA1
init|=
literal|1
block|,
comment|/* used for EDCA AC_VI data */
name|IEEE80211_TX_QUEUE_DATA2
init|=
literal|2
block|,
comment|/* used for EDCA AC_BE data */
name|IEEE80211_TX_QUEUE_DATA3
init|=
literal|3
comment|/* used for EDCA AC_BK data */
block|}
enum|;
end_enum

begin_function
specifier|static
name|int
name|hostapd_config_tx_queue
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
name|char
modifier|*
name|name
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|int
name|num
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|;
name|struct
name|hostapd_tx_queue_params
modifier|*
name|queue
decl_stmt|;
comment|/* skip 'tx_queue_' prefix */
name|pos
operator|=
name|name
operator|+
literal|9
expr_stmt|;
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"data"
argument_list|,
literal|4
argument_list|)
operator|==
literal|0
operator|&&
name|pos
index|[
literal|4
index|]
operator|>=
literal|'0'
operator|&&
name|pos
index|[
literal|4
index|]
operator|<=
literal|'9'
operator|&&
name|pos
index|[
literal|5
index|]
operator|==
literal|'_'
condition|)
block|{
name|num
operator|=
name|pos
index|[
literal|4
index|]
operator|-
literal|'0'
expr_stmt|;
name|pos
operator|+=
literal|6
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"after_beacon_"
argument_list|,
literal|13
argument_list|)
operator|==
literal|0
operator|||
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"beacon_"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"DEPRECATED: '%s' not used"
argument_list|,
name|name
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Unknown tx_queue name '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|num
operator|>=
name|NUM_TX_QUEUES
condition|)
block|{
comment|/* for backwards compatibility, do not trigger failure */
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"DEPRECATED: '%s' not used"
argument_list|,
name|name
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|queue
operator|=
operator|&
name|conf
operator|->
name|tx_queue
index|[
name|num
index|]
expr_stmt|;
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"aifs"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|queue
operator|->
name|aifs
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|queue
operator|->
name|aifs
operator|<
literal|0
operator|||
name|queue
operator|->
name|aifs
operator|>
literal|255
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid AIFS value %d"
argument_list|,
name|queue
operator|->
name|aifs
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"cwmin"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|queue
operator|->
name|cwmin
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|valid_cw
argument_list|(
name|queue
operator|->
name|cwmin
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid cwMin value %d"
argument_list|,
name|queue
operator|->
name|cwmin
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"cwmax"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|queue
operator|->
name|cwmax
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|valid_cw
argument_list|(
name|queue
operator|->
name|cwmax
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid cwMax value %d"
argument_list|,
name|queue
operator|->
name|cwmax
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"burst"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|queue
operator|->
name|burst
operator|=
name|hostapd_config_read_int10
argument_list|(
name|val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Unknown tx_queue field '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211R
end_ifdef

begin_function
specifier|static
name|int
name|add_r0kh
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|value
parameter_list|)
block|{
name|struct
name|ft_remote_r0kh
modifier|*
name|r0kh
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|,
modifier|*
name|next
decl_stmt|;
name|r0kh
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|r0kh
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|r0kh
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
comment|/* 02:01:02:03:04:05 a.example.com 000102030405060708090a0b0c0d0e0f */
name|pos
operator|=
name|value
expr_stmt|;
name|next
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|next
condition|)
operator|*
name|next
operator|++
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|next
operator|==
name|NULL
operator|||
name|hwaddr_aton
argument_list|(
name|pos
argument_list|,
name|r0kh
operator|->
name|addr
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R0KH MAC address: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r0kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|pos
operator|=
name|next
expr_stmt|;
name|next
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|next
condition|)
operator|*
name|next
operator|++
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|next
operator|==
name|NULL
operator|||
name|next
operator|-
name|pos
operator|>
name|FT_R0KH_ID_MAX_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R0KH-ID: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r0kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|r0kh
operator|->
name|id_len
operator|=
name|next
operator|-
name|pos
operator|-
literal|1
expr_stmt|;
name|os_memcpy
argument_list|(
name|r0kh
operator|->
name|id
argument_list|,
name|pos
argument_list|,
name|r0kh
operator|->
name|id_len
argument_list|)
expr_stmt|;
name|pos
operator|=
name|next
expr_stmt|;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|r0kh
operator|->
name|key
argument_list|,
sizeof|sizeof
argument_list|(
name|r0kh
operator|->
name|key
argument_list|)
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R0KH key: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r0kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|r0kh
operator|->
name|next
operator|=
name|bss
operator|->
name|r0kh_list
expr_stmt|;
name|bss
operator|->
name|r0kh_list
operator|=
name|r0kh
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|add_r1kh
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|value
parameter_list|)
block|{
name|struct
name|ft_remote_r1kh
modifier|*
name|r1kh
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|,
modifier|*
name|next
decl_stmt|;
name|r1kh
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|r1kh
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|r1kh
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
comment|/* 02:01:02:03:04:05 02:01:02:03:04:05 	 * 000102030405060708090a0b0c0d0e0f */
name|pos
operator|=
name|value
expr_stmt|;
name|next
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|next
condition|)
operator|*
name|next
operator|++
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|next
operator|==
name|NULL
operator|||
name|hwaddr_aton
argument_list|(
name|pos
argument_list|,
name|r1kh
operator|->
name|addr
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R1KH MAC address: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r1kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|pos
operator|=
name|next
expr_stmt|;
name|next
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|next
condition|)
operator|*
name|next
operator|++
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|next
operator|==
name|NULL
operator|||
name|hwaddr_aton
argument_list|(
name|pos
argument_list|,
name|r1kh
operator|->
name|id
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R1KH-ID: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r1kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|pos
operator|=
name|next
expr_stmt|;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|r1kh
operator|->
name|key
argument_list|,
sizeof|sizeof
argument_list|(
name|r1kh
operator|->
name|key
argument_list|)
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R1KH key: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r1kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|r1kh
operator|->
name|next
operator|=
name|bss
operator|->
name|r1kh_list
expr_stmt|;
name|bss
operator|->
name|r1kh_list
operator|=
name|r1kh
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_IEEE80211R */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211N
end_ifdef

begin_function
specifier|static
name|int
name|hostapd_config_ht_capab
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
specifier|const
name|char
modifier|*
name|capab
parameter_list|)
block|{
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[LDPC]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_LDPC_CODING_CAP
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[HT40-]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SUPP_CHANNEL_WIDTH_SET
expr_stmt|;
name|conf
operator|->
name|secondary_channel
operator|=
operator|-
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[HT40+]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SUPP_CHANNEL_WIDTH_SET
expr_stmt|;
name|conf
operator|->
name|secondary_channel
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SMPS-STATIC]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator|&=
operator|~
name|HT_CAP_INFO_SMPS_MASK
expr_stmt|;
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SMPS_STATIC
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SMPS-DYNAMIC]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator|&=
operator|~
name|HT_CAP_INFO_SMPS_MASK
expr_stmt|;
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SMPS_DYNAMIC
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[GF]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_GREEN_FIELD
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SHORT-GI-20]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SHORT_GI20MHZ
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SHORT-GI-40]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SHORT_GI40MHZ
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[TX-STBC]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_TX_STBC
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RX-STBC1]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator|&=
operator|~
name|HT_CAP_INFO_RX_STBC_MASK
expr_stmt|;
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_RX_STBC_1
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RX-STBC12]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator|&=
operator|~
name|HT_CAP_INFO_RX_STBC_MASK
expr_stmt|;
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_RX_STBC_12
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RX-STBC123]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator|&=
operator|~
name|HT_CAP_INFO_RX_STBC_MASK
expr_stmt|;
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_RX_STBC_123
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[DELAYED-BA]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_DELAYED_BA
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[MAX-AMSDU-7935]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_MAX_AMSDU_SIZE
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[DSSS_CCK-40]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_DSSS_CCK40MHZ
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[PSMP]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_PSMP_SUPP
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[LSIG-TXOP-PROT]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_LSIG_TXOP_PROTECT_SUPPORT
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_IEEE80211N */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211AC
end_ifdef

begin_function
specifier|static
name|int
name|hostapd_config_vht_capab
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
specifier|const
name|char
modifier|*
name|capab
parameter_list|)
block|{
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[MAX-MPDU-7991]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_MAX_MPDU_LENGTH_7991
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[MAX-MPDU-11454]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_MAX_MPDU_LENGTH_11454
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[VHT160]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_SUPP_CHAN_WIDTH_160MHZ
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[VHT160-80PLUS80]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_SUPP_CHAN_WIDTH_160_80PLUS80MHZ
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[VHT160-80PLUS80]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_SUPP_CHAN_WIDTH_160_80PLUS80MHZ
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RXLDPC]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_RXLDPC
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SHORT-GI-80]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_SHORT_GI_80
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SHORT-GI-160]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_SHORT_GI_160
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[TX-STBC-2BY1]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_TXSTBC
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RX-STBC-1]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_RXSTBC_1
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RX-STBC-12]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_RXSTBC_2
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RX-STBC-123]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_RXSTBC_3
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RX-STBC-1234]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_RXSTBC_4
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SU-BEAMFORMER]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_MU_BEAMFORMER_CAPABLE
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SU-BEAMFORMEE]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_MU_BEAMFORMEE_CAPABLE
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[BF-ANTENNA-2]"
argument_list|)
operator|&&
operator|(
name|conf
operator|->
name|vht_capab
operator|&
name|VHT_CAP_MU_BEAMFORMER_CAPABLE
operator|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_BEAMFORMER_ANTENNAS_MAX
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SOUNDING-DIMENSION-2]"
argument_list|)
operator|&&
operator|(
name|conf
operator|->
name|vht_capab
operator|&
name|VHT_CAP_MU_BEAMFORMER_CAPABLE
operator|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_SOUNDING_DIMENTION_MAX
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[MU-BEAMFORMER]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_MU_BEAMFORMER_CAPABLE
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[MU-BEAMFORMEE]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_MU_BEAMFORMEE_CAPABLE
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[VHT-TXOP-PS]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_VHT_TXOP_PS
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[HTC-VHT]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_HTC_VHT
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[MAX-A-MPDU-LEN-EXP0]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[VHT-LINK-ADAPT2]"
argument_list|)
operator|&&
operator|(
name|conf
operator|->
name|vht_capab
operator|&
name|VHT_CAP_HTC_VHT
operator|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_VHT_LINK_ADAPTATION_VHT_UNSOL_MFB
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[VHT-LINK-ADAPT3]"
argument_list|)
operator|&&
operator|(
name|conf
operator|->
name|vht_capab
operator|&
name|VHT_CAP_HTC_VHT
operator|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_VHT_LINK_ADAPTATION_VHT_MRQ_MFB
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RX-ANTENNA-PATTERN]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_RX_ANTENNA_PATTERN
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[TX-ANTENNA-PATTERN]"
argument_list|)
condition|)
name|conf
operator|->
name|vht_capab
operator||=
name|VHT_CAP_TX_ANTENNA_PATTERN
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_IEEE80211AC */
end_comment

begin_function
specifier|static
name|int
name|hostapd_config_check_bss
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|)
block|{
if|if
condition|(
name|bss
operator|->
name|ieee802_1x
operator|&&
operator|!
name|bss
operator|->
name|eap_server
operator|&&
operator|!
name|bss
operator|->
name|radius
operator|->
name|auth_servers
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid IEEE 802.1X configuration (no "
literal|"EAP authenticator configured)."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|bss
operator|->
name|wpa
operator|&&
name|bss
operator|->
name|wpa_psk_radius
operator|!=
name|PSK_RADIUS_IGNORED
operator|&&
name|bss
operator|->
name|macaddr_acl
operator|!=
name|USE_EXTERNAL_RADIUS_AUTH
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"WPA-PSK using RADIUS enabled, but no "
literal|"RADIUS checking (macaddr_acl=2) enabled."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|bss
operator|->
name|wpa
operator|&&
operator|(
name|bss
operator|->
name|wpa_key_mgmt
operator|&
name|WPA_KEY_MGMT_PSK
operator|)
operator|&&
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
operator|==
name|NULL
operator|&&
name|bss
operator|->
name|ssid
operator|.
name|wpa_passphrase
operator|==
name|NULL
operator|&&
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk_file
operator|==
name|NULL
operator|&&
operator|(
name|bss
operator|->
name|wpa_psk_radius
operator|!=
name|PSK_RADIUS_REQUIRED
operator|||
name|bss
operator|->
name|macaddr_acl
operator|!=
name|USE_EXTERNAL_RADIUS_AUTH
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"WPA-PSK enabled, but PSK or passphrase "
literal|"is not configured."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|hostapd_mac_comp_empty
argument_list|(
name|bss
operator|->
name|bssid
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|conf
operator|->
name|num_bss
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
operator|&
name|conf
operator|->
name|bss
index|[
name|i
index|]
operator|!=
name|bss
operator|)
operator|&&
operator|(
name|hostapd_mac_comp
argument_list|(
name|conf
operator|->
name|bss
index|[
name|i
index|]
operator|.
name|bssid
argument_list|,
name|bss
operator|->
name|bssid
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Duplicate BSSID "
name|MACSTR
literal|" on interface '%s' and '%s'."
argument_list|,
name|MAC2STR
argument_list|(
name|bss
operator|->
name|bssid
argument_list|)
argument_list|,
name|conf
operator|->
name|bss
index|[
name|i
index|]
operator|.
name|iface
argument_list|,
name|bss
operator|->
name|iface
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
block|}
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211R
if|if
condition|(
name|wpa_key_mgmt_ft
argument_list|(
name|bss
operator|->
name|wpa_key_mgmt
argument_list|)
operator|&&
operator|(
name|bss
operator|->
name|nas_identifier
operator|==
name|NULL
operator|||
name|os_strlen
argument_list|(
name|bss
operator|->
name|nas_identifier
argument_list|)
operator|<
literal|1
operator|||
name|os_strlen
argument_list|(
name|bss
operator|->
name|nas_identifier
argument_list|)
operator|>
name|FT_R0KH_ID_MAX_LEN
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"FT (IEEE 802.11r) requires "
literal|"nas_identifier to be configured as a 1..48 octet "
literal|"string"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
endif|#
directive|endif
comment|/* CONFIG_IEEE80211R */
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211N
if|if
condition|(
name|conf
operator|->
name|ieee80211n
operator|&&
name|conf
operator|->
name|hw_mode
operator|==
name|HOSTAPD_MODE_IEEE80211B
condition|)
block|{
name|bss
operator|->
name|disable_11n
operator|=
literal|1
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"HT (IEEE 802.11n) in 11b mode is not "
literal|"allowed, disabling HT capabilites"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|conf
operator|->
name|ieee80211n
operator|&&
name|bss
operator|->
name|ssid
operator|.
name|security_policy
operator|==
name|SECURITY_STATIC_WEP
condition|)
block|{
name|bss
operator|->
name|disable_11n
operator|=
literal|1
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"HT (IEEE 802.11n) with WEP is not "
literal|"allowed, disabling HT capabilities"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|conf
operator|->
name|ieee80211n
operator|&&
name|bss
operator|->
name|wpa
operator|&&
operator|!
operator|(
name|bss
operator|->
name|wpa_pairwise
operator|&
name|WPA_CIPHER_CCMP
operator|)
operator|&&
operator|!
operator|(
name|bss
operator|->
name|rsn_pairwise
operator|&
operator|(
name|WPA_CIPHER_CCMP
operator||
name|WPA_CIPHER_GCMP
operator|)
operator|)
condition|)
block|{
name|bss
operator|->
name|disable_11n
operator|=
literal|1
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"HT (IEEE 802.11n) with WPA/WPA2 "
literal|"requires CCMP/GCMP to be enabled, disabling HT "
literal|"capabilities"
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* CONFIG_IEEE80211N */
ifdef|#
directive|ifdef
name|CONFIG_WPS2
if|if
condition|(
name|bss
operator|->
name|wps_state
operator|&&
name|bss
operator|->
name|ignore_broadcast_ssid
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS: ignore_broadcast_ssid "
literal|"configuration forced WPS to be disabled"
argument_list|)
expr_stmt|;
name|bss
operator|->
name|wps_state
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|bss
operator|->
name|wps_state
operator|&&
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|keys_set
operator|&&
name|bss
operator|->
name|wpa
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS: WEP configuration forced WPS to be "
literal|"disabled"
argument_list|)
expr_stmt|;
name|bss
operator|->
name|wps_state
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|bss
operator|->
name|wps_state
operator|&&
name|bss
operator|->
name|wpa
operator|&&
operator|(
operator|!
operator|(
name|bss
operator|->
name|wpa
operator|&
literal|2
operator|)
operator|||
operator|!
operator|(
name|bss
operator|->
name|rsn_pairwise
operator|&
name|WPA_CIPHER_CCMP
operator|)
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS: WPA/TKIP configuration without "
literal|"WPA2/CCMP forced WPS to be disabled"
argument_list|)
expr_stmt|;
name|bss
operator|->
name|wps_state
operator|=
literal|0
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* CONFIG_WPS2 */
ifdef|#
directive|ifdef
name|CONFIG_HS20
if|if
condition|(
name|bss
operator|->
name|hs20
operator|&&
operator|(
operator|!
operator|(
name|bss
operator|->
name|wpa
operator|&
literal|2
operator|)
operator|||
operator|!
operator|(
name|bss
operator|->
name|rsn_pairwise
operator|&
operator|(
name|WPA_CIPHER_CCMP
operator||
name|WPA_CIPHER_GCMP
operator|)
operator|)
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"HS 2.0: WPA2-Enterprise/CCMP "
literal|"configuration is required for Hotspot 2.0 "
literal|"functionality"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
endif|#
directive|endif
comment|/* CONFIG_HS20 */
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_check
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
if|if
condition|(
name|conf
operator|->
name|ieee80211d
operator|&&
operator|(
operator|!
name|conf
operator|->
name|country
index|[
literal|0
index|]
operator|||
operator|!
name|conf
operator|->
name|country
index|[
literal|1
index|]
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Cannot enable IEEE 802.11d without "
literal|"setting the country_code"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|conf
operator|->
name|num_bss
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|hostapd_config_check_bss
argument_list|(
operator|&
name|conf
operator|->
name|bss
index|[
name|i
index|]
argument_list|,
name|conf
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_INTERWORKING
end_ifdef

begin_function
specifier|static
name|int
name|parse_roaming_consortium
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|pos
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|size_t
name|len
init|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
name|u8
name|oi
index|[
name|MAX_ROAMING_CONSORTIUM_LEN
index|]
decl_stmt|;
name|struct
name|hostapd_roaming_consortium
modifier|*
name|rc
decl_stmt|;
if|if
condition|(
operator|(
name|len
operator|&
literal|1
operator|)
operator|||
name|len
operator|<
literal|2
operator|*
literal|3
operator|||
name|len
operator|/
literal|2
operator|>
name|MAX_ROAMING_CONSORTIUM_LEN
operator|||
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|oi
argument_list|,
name|len
operator|/
literal|2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid roaming_consortium "
literal|"'%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|len
operator|/=
literal|2
expr_stmt|;
name|rc
operator|=
name|os_realloc_array
argument_list|(
name|bss
operator|->
name|roaming_consortium
argument_list|,
name|bss
operator|->
name|roaming_consortium_count
operator|+
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_roaming_consortium
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|os_memcpy
argument_list|(
name|rc
index|[
name|bss
operator|->
name|roaming_consortium_count
index|]
operator|.
name|oi
argument_list|,
name|oi
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|rc
index|[
name|bss
operator|->
name|roaming_consortium_count
index|]
operator|.
name|len
operator|=
name|len
expr_stmt|;
name|bss
operator|->
name|roaming_consortium
operator|=
name|rc
expr_stmt|;
name|bss
operator|->
name|roaming_consortium_count
operator|++
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|parse_lang_string
parameter_list|(
name|struct
name|hostapd_lang_string
modifier|*
modifier|*
name|array
parameter_list|,
name|unsigned
name|int
modifier|*
name|count
parameter_list|,
name|char
modifier|*
name|pos
parameter_list|)
block|{
name|char
modifier|*
name|sep
decl_stmt|;
name|size_t
name|clen
decl_stmt|,
name|nlen
decl_stmt|;
name|struct
name|hostapd_lang_string
modifier|*
name|ls
decl_stmt|;
name|sep
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|sep
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
operator|*
name|sep
operator|++
operator|=
literal|'\0'
expr_stmt|;
name|clen
operator|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|clen
operator|<
literal|2
condition|)
return|return
operator|-
literal|1
return|;
name|nlen
operator|=
name|os_strlen
argument_list|(
name|sep
argument_list|)
expr_stmt|;
if|if
condition|(
name|nlen
operator|>
literal|252
condition|)
return|return
operator|-
literal|1
return|;
name|ls
operator|=
name|os_realloc_array
argument_list|(
operator|*
name|array
argument_list|,
operator|*
name|count
operator|+
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_lang_string
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ls
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
operator|*
name|array
operator|=
name|ls
expr_stmt|;
name|ls
operator|=
operator|&
operator|(
operator|*
name|array
operator|)
index|[
operator|*
name|count
index|]
expr_stmt|;
operator|(
operator|*
name|count
operator|)
operator|++
expr_stmt|;
name|os_memset
argument_list|(
name|ls
operator|->
name|lang
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ls
operator|->
name|lang
argument_list|)
argument_list|)
expr_stmt|;
name|os_memcpy
argument_list|(
name|ls
operator|->
name|lang
argument_list|,
name|pos
argument_list|,
name|clen
argument_list|)
expr_stmt|;
name|ls
operator|->
name|name_len
operator|=
name|nlen
expr_stmt|;
name|os_memcpy
argument_list|(
name|ls
operator|->
name|name
argument_list|,
name|sep
argument_list|,
name|nlen
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|parse_venue_name
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|pos
parameter_list|,
name|int
name|line
parameter_list|)
block|{
if|if
condition|(
name|parse_lang_string
argument_list|(
operator|&
name|bss
operator|->
name|venue_name
argument_list|,
operator|&
name|bss
operator|->
name|venue_name_count
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid venue_name '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|parse_3gpp_cell_net
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|size_t
name|count
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|;
name|u8
modifier|*
name|info
init|=
name|NULL
decl_stmt|,
modifier|*
name|ipos
decl_stmt|;
comment|/* format:<MCC1,MNC1>[;<MCC2,MNC2>][;...] */
name|count
operator|=
literal|1
expr_stmt|;
for|for
control|(
name|pos
operator|=
name|buf
init|;
operator|*
name|pos
condition|;
name|pos
operator|++
control|)
block|{
if|if
condition|(
operator|(
operator|*
name|pos
operator|<
literal|'0'
operator|&&
operator|*
name|pos
operator|>
literal|'9'
operator|)
operator|&&
operator|*
name|pos
operator|!=
literal|';'
operator|&&
operator|*
name|pos
operator|!=
literal|','
condition|)
goto|goto
name|fail
goto|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|';'
condition|)
name|count
operator|++
expr_stmt|;
block|}
if|if
condition|(
literal|1
operator|+
name|count
operator|*
literal|3
operator|>
literal|0x7f
condition|)
goto|goto
name|fail
goto|;
name|info
operator|=
name|os_zalloc
argument_list|(
literal|2
operator|+
literal|3
operator|+
name|count
operator|*
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|ipos
operator|=
name|info
expr_stmt|;
operator|*
name|ipos
operator|++
operator|=
literal|0
expr_stmt|;
comment|/* GUD - Version 1 */
operator|*
name|ipos
operator|++
operator|=
literal|3
operator|+
name|count
operator|*
literal|3
expr_stmt|;
comment|/* User Data Header Length (UDHL) */
operator|*
name|ipos
operator|++
operator|=
literal|0
expr_stmt|;
comment|/* PLMN List IEI */
comment|/* ext(b8) | Length of PLMN List value contents(b7..1) */
operator|*
name|ipos
operator|++
operator|=
literal|1
operator|+
name|count
operator|*
literal|3
expr_stmt|;
operator|*
name|ipos
operator|++
operator|=
name|count
expr_stmt|;
comment|/* Number of PLMNs */
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
name|pos
operator|&&
operator|*
name|pos
condition|)
block|{
name|char
modifier|*
name|mcc
decl_stmt|,
modifier|*
name|mnc
decl_stmt|;
name|size_t
name|mnc_len
decl_stmt|;
name|mcc
operator|=
name|pos
expr_stmt|;
name|mnc
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|','
argument_list|)
expr_stmt|;
if|if
condition|(
name|mnc
operator|==
name|NULL
condition|)
goto|goto
name|fail
goto|;
operator|*
name|mnc
operator|++
operator|=
literal|'\0'
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|mnc
argument_list|,
literal|';'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
condition|)
operator|*
name|pos
operator|++
operator|=
literal|'\0'
expr_stmt|;
name|mnc_len
operator|=
name|os_strlen
argument_list|(
name|mnc
argument_list|)
expr_stmt|;
if|if
condition|(
name|os_strlen
argument_list|(
name|mcc
argument_list|)
operator|!=
literal|3
operator|||
operator|(
name|mnc_len
operator|!=
literal|2
operator|&&
name|mnc_len
operator|!=
literal|3
operator|)
condition|)
goto|goto
name|fail
goto|;
comment|/* BC coded MCC,MNC */
comment|/* MCC digit 2 | MCC digit 1 */
operator|*
name|ipos
operator|++
operator|=
operator|(
operator|(
name|mcc
index|[
literal|1
index|]
operator|-
literal|'0'
operator|)
operator|<<
literal|4
operator|)
operator||
operator|(
name|mcc
index|[
literal|0
index|]
operator|-
literal|'0'
operator|)
expr_stmt|;
comment|/* MNC digit 3 | MCC digit 3 */
operator|*
name|ipos
operator|++
operator|=
operator|(
operator|(
operator|(
name|mnc_len
operator|==
literal|2
operator|)
condition|?
literal|0xf0
else|:
operator|(
operator|(
name|mnc
index|[
literal|2
index|]
operator|-
literal|'0'
operator|)
operator|<<
literal|4
operator|)
operator|)
operator|)
operator||
operator|(
name|mcc
index|[
literal|2
index|]
operator|-
literal|'0'
operator|)
expr_stmt|;
comment|/* MNC digit 2 | MNC digit 1 */
operator|*
name|ipos
operator|++
operator|=
operator|(
operator|(
name|mnc
index|[
literal|1
index|]
operator|-
literal|'0'
operator|)
operator|<<
literal|4
operator|)
operator||
operator|(
name|mnc
index|[
literal|0
index|]
operator|-
literal|'0'
operator|)
expr_stmt|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|anqp_3gpp_cell_net
argument_list|)
expr_stmt|;
name|bss
operator|->
name|anqp_3gpp_cell_net
operator|=
name|info
expr_stmt|;
name|bss
operator|->
name|anqp_3gpp_cell_net_len
operator|=
literal|2
operator|+
literal|3
operator|+
literal|3
operator|*
name|count
expr_stmt|;
name|wpa_hexdump
argument_list|(
name|MSG_MSGDUMP
argument_list|,
literal|"3GPP Cellular Network information"
argument_list|,
name|bss
operator|->
name|anqp_3gpp_cell_net
argument_list|,
name|bss
operator|->
name|anqp_3gpp_cell_net_len
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
name|fail
label|:
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid anqp_3gpp_cell_net: %s"
argument_list|,
name|line
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|info
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|parse_nai_realm
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|struct
name|hostapd_nai_realm_data
modifier|*
name|realm
decl_stmt|;
name|size_t
name|i
decl_stmt|,
name|j
decl_stmt|,
name|len
decl_stmt|;
name|int
modifier|*
name|offsets
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|rpos
decl_stmt|;
name|offsets
operator|=
name|os_calloc
argument_list|(
name|bss
operator|->
name|nai_realm_count
operator|*
name|MAX_NAI_REALMS
argument_list|,
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|offsets
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|bss
operator|->
name|nai_realm_count
condition|;
name|i
operator|++
control|)
block|{
name|realm
operator|=
operator|&
name|bss
operator|->
name|nai_realm_data
index|[
name|i
index|]
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|MAX_NAI_REALMS
condition|;
name|j
operator|++
control|)
block|{
name|offsets
index|[
name|i
operator|*
name|MAX_NAI_REALMS
operator|+
name|j
index|]
operator|=
name|realm
operator|->
name|realm
index|[
name|j
index|]
condition|?
name|realm
operator|->
name|realm
index|[
name|j
index|]
operator|-
name|realm
operator|->
name|realm_buf
else|:
operator|-
literal|1
expr_stmt|;
block|}
block|}
name|realm
operator|=
name|os_realloc_array
argument_list|(
name|bss
operator|->
name|nai_realm_data
argument_list|,
name|bss
operator|->
name|nai_realm_count
operator|+
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_nai_realm_data
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|realm
operator|==
name|NULL
condition|)
block|{
name|os_free
argument_list|(
name|offsets
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|bss
operator|->
name|nai_realm_data
operator|=
name|realm
expr_stmt|;
comment|/* patch the pointers after realloc */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|bss
operator|->
name|nai_realm_count
condition|;
name|i
operator|++
control|)
block|{
name|realm
operator|=
operator|&
name|bss
operator|->
name|nai_realm_data
index|[
name|i
index|]
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|MAX_NAI_REALMS
condition|;
name|j
operator|++
control|)
block|{
name|int
name|offs
init|=
name|offsets
index|[
name|i
operator|*
name|MAX_NAI_REALMS
operator|+
name|j
index|]
decl_stmt|;
if|if
condition|(
name|offs
operator|>=
literal|0
condition|)
name|realm
operator|->
name|realm
index|[
name|j
index|]
operator|=
name|realm
operator|->
name|realm_buf
operator|+
name|offs
expr_stmt|;
else|else
name|realm
operator|->
name|realm
index|[
name|j
index|]
operator|=
name|NULL
expr_stmt|;
block|}
block|}
name|os_free
argument_list|(
name|offsets
argument_list|)
expr_stmt|;
name|realm
operator|=
operator|&
name|bss
operator|->
name|nai_realm_data
index|[
name|bss
operator|->
name|nai_realm_count
index|]
expr_stmt|;
name|os_memset
argument_list|(
name|realm
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|realm
argument_list|)
argument_list|)
expr_stmt|;
name|pos
operator|=
name|buf
expr_stmt|;
name|realm
operator|->
name|encoding
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|','
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
goto|goto
name|fail
goto|;
name|pos
operator|++
expr_stmt|;
name|end
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|','
argument_list|)
expr_stmt|;
if|if
condition|(
name|end
condition|)
block|{
name|len
operator|=
name|end
operator|-
name|pos
expr_stmt|;
operator|*
name|end
operator|=
literal|'\0'
expr_stmt|;
block|}
else|else
block|{
name|len
operator|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|len
operator|>
name|MAX_NAI_REALMLEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Too long a realm string (%d> max %d "
literal|"characters)"
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|,
name|MAX_NAI_REALMLEN
argument_list|)
expr_stmt|;
goto|goto
name|fail
goto|;
block|}
name|os_memcpy
argument_list|(
name|realm
operator|->
name|realm_buf
argument_list|,
name|pos
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|end
condition|)
name|pos
operator|=
name|end
operator|+
literal|1
expr_stmt|;
else|else
name|pos
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
name|pos
operator|&&
operator|*
name|pos
condition|)
block|{
name|struct
name|hostapd_nai_realm_eap
modifier|*
name|eap
decl_stmt|;
if|if
condition|(
name|realm
operator|->
name|eap_method_count
operator|>=
name|MAX_NAI_EAP_METHODS
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Too many EAP methods"
argument_list|)
expr_stmt|;
goto|goto
name|fail
goto|;
block|}
name|eap
operator|=
operator|&
name|realm
operator|->
name|eap_method
index|[
name|realm
operator|->
name|eap_method_count
index|]
expr_stmt|;
name|realm
operator|->
name|eap_method_count
operator|++
expr_stmt|;
name|end
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|','
argument_list|)
expr_stmt|;
if|if
condition|(
name|end
operator|==
name|NULL
condition|)
name|end
operator|=
name|pos
operator|+
name|os_strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|eap
operator|->
name|eap_method
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|pos
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|'['
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
operator|||
name|pos
operator|>
name|end
condition|)
break|break;
name|pos
operator|++
expr_stmt|;
if|if
condition|(
name|eap
operator|->
name|num_auths
operator|>=
name|MAX_NAI_AUTH_TYPES
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Too many auth params"
argument_list|)
expr_stmt|;
goto|goto
name|fail
goto|;
block|}
name|eap
operator|->
name|auth_id
index|[
name|eap
operator|->
name|num_auths
index|]
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
operator|||
name|pos
operator|>
name|end
condition|)
goto|goto
name|fail
goto|;
name|pos
operator|++
expr_stmt|;
name|eap
operator|->
name|auth_val
index|[
name|eap
operator|->
name|num_auths
index|]
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|']'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
operator|||
name|pos
operator|>
name|end
condition|)
goto|goto
name|fail
goto|;
name|pos
operator|++
expr_stmt|;
name|eap
operator|->
name|num_auths
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|end
operator|!=
literal|','
condition|)
break|break;
name|pos
operator|=
name|end
operator|+
literal|1
expr_stmt|;
block|}
comment|/* Split realm list into null terminated realms */
name|rpos
operator|=
name|realm
operator|->
name|realm_buf
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|rpos
condition|)
block|{
if|if
condition|(
name|i
operator|>=
name|MAX_NAI_REALMS
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Too many realms"
argument_list|)
expr_stmt|;
goto|goto
name|fail
goto|;
block|}
name|realm
operator|->
name|realm
index|[
name|i
operator|++
index|]
operator|=
name|rpos
expr_stmt|;
name|rpos
operator|=
name|os_strchr
argument_list|(
name|rpos
argument_list|,
literal|';'
argument_list|)
expr_stmt|;
if|if
condition|(
name|rpos
operator|==
name|NULL
condition|)
break|break;
operator|*
name|rpos
operator|++
operator|=
literal|'\0'
expr_stmt|;
block|}
name|bss
operator|->
name|nai_realm_count
operator|++
expr_stmt|;
return|return
literal|0
return|;
name|fail
label|:
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid nai_realm '%s'"
argument_list|,
name|line
argument_list|,
name|buf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_INTERWORKING */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_HS20
end_ifdef

begin_function
specifier|static
name|int
name|hs20_parse_conn_capab
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|u8
modifier|*
name|conn_cap
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|;
if|if
condition|(
name|bss
operator|->
name|hs20_connection_capability_len
operator|>=
literal|0xfff0
condition|)
return|return
operator|-
literal|1
return|;
name|conn_cap
operator|=
name|os_realloc
argument_list|(
name|bss
operator|->
name|hs20_connection_capability
argument_list|,
name|bss
operator|->
name|hs20_connection_capability_len
operator|+
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
name|conn_cap
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|bss
operator|->
name|hs20_connection_capability
operator|=
name|conn_cap
expr_stmt|;
name|conn_cap
operator|+=
name|bss
operator|->
name|hs20_connection_capability_len
expr_stmt|;
name|pos
operator|=
name|buf
expr_stmt|;
name|conn_cap
index|[
literal|0
index|]
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|pos
operator|++
expr_stmt|;
name|WPA_PUT_LE16
argument_list|(
name|conn_cap
operator|+
literal|1
argument_list|,
name|atoi
argument_list|(
name|pos
argument_list|)
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|pos
operator|++
expr_stmt|;
name|conn_cap
index|[
literal|3
index|]
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|bss
operator|->
name|hs20_connection_capability_len
operator|+=
literal|4
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hs20_parse_wan_metrics
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|u8
modifier|*
name|wan_metrics
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|;
comment|/*<WAN Info>:<DL Speed>:<UL Speed>:<DL Load>:<UL Load>:<LMD> */
name|wan_metrics
operator|=
name|os_zalloc
argument_list|(
literal|13
argument_list|)
expr_stmt|;
if|if
condition|(
name|wan_metrics
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|pos
operator|=
name|buf
expr_stmt|;
comment|/* WAN Info */
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|wan_metrics
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
goto|goto
name|fail
goto|;
name|pos
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|!=
literal|':'
condition|)
goto|goto
name|fail
goto|;
name|pos
operator|++
expr_stmt|;
comment|/* Downlink Speed */
name|WPA_PUT_LE32
argument_list|(
name|wan_metrics
operator|+
literal|1
argument_list|,
name|atoi
argument_list|(
name|pos
argument_list|)
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
goto|goto
name|fail
goto|;
name|pos
operator|++
expr_stmt|;
comment|/* Uplink Speed */
name|WPA_PUT_LE32
argument_list|(
name|wan_metrics
operator|+
literal|5
argument_list|,
name|atoi
argument_list|(
name|pos
argument_list|)
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
goto|goto
name|fail
goto|;
name|pos
operator|++
expr_stmt|;
comment|/* Downlink Load */
name|wan_metrics
index|[
literal|9
index|]
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
goto|goto
name|fail
goto|;
name|pos
operator|++
expr_stmt|;
comment|/* Uplink Load */
name|wan_metrics
index|[
literal|10
index|]
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
goto|goto
name|fail
goto|;
name|pos
operator|++
expr_stmt|;
comment|/* LMD */
name|WPA_PUT_LE16
argument_list|(
name|wan_metrics
operator|+
literal|11
argument_list|,
name|atoi
argument_list|(
name|pos
argument_list|)
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|bss
operator|->
name|hs20_wan_metrics
argument_list|)
expr_stmt|;
name|bss
operator|->
name|hs20_wan_metrics
operator|=
name|wan_metrics
expr_stmt|;
return|return
literal|0
return|;
name|fail
label|:
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid hs20_wan_metrics '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|wan_metrics
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hs20_parse_oper_friendly_name
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|pos
parameter_list|,
name|int
name|line
parameter_list|)
block|{
if|if
condition|(
name|parse_lang_string
argument_list|(
operator|&
name|bss
operator|->
name|hs20_oper_friendly_name
argument_list|,
operator|&
name|bss
operator|->
name|hs20_oper_friendly_name_count
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"hs20_oper_friendly_name '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_HS20 */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_WPS_NFC
end_ifdef

begin_function
specifier|static
name|struct
name|wpabuf
modifier|*
name|hostapd_parse_bin
parameter_list|(
specifier|const
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|size_t
name|len
decl_stmt|;
name|struct
name|wpabuf
modifier|*
name|ret
decl_stmt|;
name|len
operator|=
name|os_strlen
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|&
literal|0x01
condition|)
return|return
name|NULL
return|;
name|len
operator|/=
literal|2
expr_stmt|;
name|ret
operator|=
name|wpabuf_alloc
argument_list|(
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|buf
argument_list|,
name|wpabuf_put
argument_list|(
name|ret
argument_list|,
name|len
argument_list|)
argument_list|,
name|len
argument_list|)
condition|)
block|{
name|wpabuf_free
argument_list|(
name|ret
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_WPS_NFC */
end_comment

begin_function
specifier|static
name|int
name|hostapd_config_fill
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|char
modifier|*
name|pos
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|int
name|errors
init|=
literal|0
decl_stmt|;
block|{
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"interface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_strlcpy
argument_list|(
name|conf
operator|->
name|bss
index|[
literal|0
index|]
operator|.
name|iface
argument_list|,
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|conf
operator|->
name|bss
index|[
literal|0
index|]
operator|.
name|iface
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"bridge"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_strlcpy
argument_list|(
name|bss
operator|->
name|bridge
argument_list|,
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|bss
operator|->
name|bridge
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wds_bridge"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_strlcpy
argument_list|(
name|bss
operator|->
name|wds_bridge
argument_list|,
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|bss
operator|->
name|wds_bridge
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"driver"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|j
decl_stmt|;
comment|/* clear to get error below if setting is invalid */
name|conf
operator|->
name|driver
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|wpa_drivers
index|[
name|j
index|]
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
name|wpa_drivers
index|[
name|j
index|]
operator|->
name|name
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|driver
operator|=
name|wpa_drivers
index|[
name|j
index|]
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|conf
operator|->
name|driver
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid/"
literal|"unknown driver '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"debug"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: DEPRECATED: 'debug' "
literal|"configuration variable is not used "
literal|"anymore"
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_syslog_level"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|logger_syslog_level
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_stdout_level"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|logger_stdout_level
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_syslog"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|logger_syslog
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_stdout"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|logger_stdout
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"dump_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|dump_log_name
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ssid"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|ssid_len
operator|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|ssid
operator|.
name|ssid_len
operator|>
name|HOSTAPD_MAX_SSID_LEN
operator|||
name|bss
operator|->
name|ssid
operator|.
name|ssid_len
operator|<
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid SSID "
literal|"'%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
name|os_memcpy
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|ssid
argument_list|,
name|pos
argument_list|,
name|bss
operator|->
name|ssid
operator|.
name|ssid_len
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|ssid_set
operator|=
literal|1
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ssid2"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|size_t
name|slen
decl_stmt|;
name|char
modifier|*
name|str
init|=
name|wpa_config_parse_string
argument_list|(
name|pos
argument_list|,
operator|&
name|slen
argument_list|)
decl_stmt|;
if|if
condition|(
name|str
operator|==
name|NULL
operator|||
name|slen
operator|<
literal|1
operator|||
name|slen
operator|>
name|HOSTAPD_MAX_SSID_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid SSID "
literal|"'%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
name|os_memcpy
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|ssid
argument_list|,
name|str
argument_list|,
name|slen
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|ssid_len
operator|=
name|slen
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|ssid_set
operator|=
literal|1
expr_stmt|;
block|}
name|os_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"utf8_ssid"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|utf8_ssid
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
operator|>
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"macaddr_acl"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|macaddr_acl
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|macaddr_acl
operator|!=
name|ACCEPT_UNLESS_DENIED
operator|&&
name|bss
operator|->
name|macaddr_acl
operator|!=
name|DENY_UNLESS_ACCEPTED
operator|&&
name|bss
operator|->
name|macaddr_acl
operator|!=
name|USE_EXTERNAL_RADIUS_AUTH
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unknown "
literal|"macaddr_acl %d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|macaddr_acl
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"accept_mac_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_maclist
argument_list|(
name|pos
argument_list|,
operator|&
name|bss
operator|->
name|accept_mac
argument_list|,
operator|&
name|bss
operator|->
name|num_accept_mac
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Failed to "
literal|"read accept_mac_file '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"deny_mac_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_maclist
argument_list|(
name|pos
argument_list|,
operator|&
name|bss
operator|->
name|deny_mac
argument_list|,
operator|&
name|bss
operator|->
name|num_deny_mac
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Failed to "
literal|"read deny_mac_file '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wds_sta"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wds_sta
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_isolate"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|isolate
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_max_inactivity"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ap_max_inactivity
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"skip_inactivity_poll"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|skip_inactivity_poll
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"country_code"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_memcpy
argument_list|(
name|conf
operator|->
name|country
argument_list|,
name|pos
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* FIX: make this configurable */
name|conf
operator|->
name|country
index|[
literal|2
index|]
operator|=
literal|' '
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ieee80211d"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ieee80211d
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ieee8021x"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ieee802_1x
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eapol_version"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eapol_version
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|eapol_version
operator|<
literal|1
operator|||
name|bss
operator|->
name|eapol_version
operator|>
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid EAPOL "
literal|"version (%d): '%s'."
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|eapol_version
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"eapol_version=%d"
argument_list|,
name|bss
operator|->
name|eapol_version
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|EAP_SERVER
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_authenticator"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eap_server
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: obsolete "
literal|"eap_authenticator used; this has been "
literal|"renamed to eap_server"
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_server"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eap_server
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_user_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_eap_user
argument_list|(
name|pos
argument_list|,
name|bss
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ca_cert"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ca_cert
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ca_cert
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"server_cert"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|server_cert
argument_list|)
expr_stmt|;
name|bss
operator|->
name|server_cert
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"private_key"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|private_key
argument_list|)
expr_stmt|;
name|bss
operator|->
name|private_key
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"private_key_passwd"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|private_key_passwd
argument_list|)
expr_stmt|;
name|bss
operator|->
name|private_key_passwd
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"check_crl"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|check_crl
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"dh_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|dh_file
argument_list|)
expr_stmt|;
name|bss
operator|->
name|dh_file
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"fragment_size"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|fragment_size
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|EAP_SERVER_FAST
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"pac_opaque_encr_key"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|pac_opaque_encr_key
argument_list|)
expr_stmt|;
name|bss
operator|->
name|pac_opaque_encr_key
operator|=
name|os_malloc
argument_list|(
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|pac_opaque_encr_key
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: No memory for "
literal|"pac_opaque_encr_key"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|pac_opaque_encr_key
argument_list|,
literal|16
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"pac_opaque_encr_key"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_fast_a_id"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|size_t
name|idlen
init|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|idlen
operator|&
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"eap_fast_a_id"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|eap_fast_a_id
argument_list|)
expr_stmt|;
name|bss
operator|->
name|eap_fast_a_id
operator|=
name|os_malloc
argument_list|(
name|idlen
operator|/
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|eap_fast_a_id
operator|==
name|NULL
operator|||
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|eap_fast_a_id
argument_list|,
name|idlen
operator|/
literal|2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: "
literal|"Failed to parse "
literal|"eap_fast_a_id"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
name|bss
operator|->
name|eap_fast_a_id_len
operator|=
name|idlen
operator|/
literal|2
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_fast_a_id_info"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|eap_fast_a_id_info
argument_list|)
expr_stmt|;
name|bss
operator|->
name|eap_fast_a_id_info
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_fast_prov"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eap_fast_prov
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"pac_key_lifetime"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|pac_key_lifetime
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"pac_key_refresh_time"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|pac_key_refresh_time
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_SERVER_FAST */
ifdef|#
directive|ifdef
name|EAP_SERVER_SIM
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_sim_db"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|eap_sim_db
argument_list|)
expr_stmt|;
name|bss
operator|->
name|eap_sim_db
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_sim_aka_result_ind"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eap_sim_aka_result_ind
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_SERVER_SIM */
ifdef|#
directive|ifdef
name|EAP_SERVER_TNC
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"tnc"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|tnc
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_SERVER_TNC */
ifdef|#
directive|ifdef
name|EAP_SERVER_PWD
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"pwd_group"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|pwd_group
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_SERVER_PWD */
endif|#
directive|endif
comment|/* EAP_SERVER */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_message"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|char
modifier|*
name|term
decl_stmt|;
name|bss
operator|->
name|eap_req_id_text
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|eap_req_id_text
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Failed to "
literal|"allocate memory for "
literal|"eap_req_id_text"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
name|bss
operator|->
name|eap_req_id_text_len
operator|=
name|os_strlen
argument_list|(
name|bss
operator|->
name|eap_req_id_text
argument_list|)
expr_stmt|;
name|term
operator|=
name|os_strstr
argument_list|(
name|bss
operator|->
name|eap_req_id_text
argument_list|,
literal|"\\0"
argument_list|)
expr_stmt|;
if|if
condition|(
name|term
condition|)
block|{
operator|*
name|term
operator|++
operator|=
literal|'\0'
expr_stmt|;
name|os_memmove
argument_list|(
name|term
argument_list|,
name|term
operator|+
literal|1
argument_list|,
name|bss
operator|->
name|eap_req_id_text_len
operator|-
operator|(
name|term
operator|-
name|bss
operator|->
name|eap_req_id_text
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|bss
operator|->
name|eap_req_id_text_len
operator|--
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key_len_broadcast"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|default_wep_key_len
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|default_wep_key_len
operator|>
literal|13
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid WEP "
literal|"key len %lu (= %lu bits)"
argument_list|,
name|line
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|bss
operator|->
name|default_wep_key_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|bss
operator|->
name|default_wep_key_len
operator|*
literal|8
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key_len_unicast"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|individual_wep_key_len
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|individual_wep_key_len
operator|<
literal|0
operator|||
name|bss
operator|->
name|individual_wep_key_len
operator|>
literal|13
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid WEP "
literal|"key len %d (= %d bits)"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|individual_wep_key_len
argument_list|,
name|bss
operator|->
name|individual_wep_key_len
operator|*
literal|8
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_rekey_period"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wep_rekeying_period
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wep_rekeying_period
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"period %d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|wep_rekeying_period
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_reauth_period"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eap_reauth_period
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|eap_reauth_period
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"period %d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|eap_reauth_period
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eapol_key_index_workaround"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eapol_key_index_workaround
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_IAPP
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"iapp_interface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ieee802_11f
operator|=
literal|1
expr_stmt|;
name|os_strlcpy
argument_list|(
name|bss
operator|->
name|iapp_iface
argument_list|,
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|bss
operator|->
name|iapp_iface
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IAPP */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"own_ip_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_parse_ip_addr
argument_list|(
name|pos
argument_list|,
operator|&
name|bss
operator|->
name|own_ip_addr
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid IP "
literal|"address '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"nas_identifier"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|nas_identifier
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|CONFIG_NO_RADIUS
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_server_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_radius_addr
argument_list|(
operator|&
name|bss
operator|->
name|radius
operator|->
name|auth_servers
argument_list|,
operator|&
name|bss
operator|->
name|radius
operator|->
name|num_auth_servers
argument_list|,
name|pos
argument_list|,
literal|1812
argument_list|,
operator|&
name|bss
operator|->
name|radius
operator|->
name|auth_server
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid IP "
literal|"address '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|&&
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_server_port"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|->
name|port
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|&&
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_server_shared_secret"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|len
init|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
block|{
comment|/* RFC 2865, Ch. 3 */
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: empty shared "
literal|"secret is not allowed."
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|->
name|shared_secret
operator|=
operator|(
name|u8
operator|*
operator|)
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|->
name|shared_secret_len
operator|=
name|len
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"acct_server_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_radius_addr
argument_list|(
operator|&
name|bss
operator|->
name|radius
operator|->
name|acct_servers
argument_list|,
operator|&
name|bss
operator|->
name|radius
operator|->
name|num_acct_servers
argument_list|,
name|pos
argument_list|,
literal|1813
argument_list|,
operator|&
name|bss
operator|->
name|radius
operator|->
name|acct_server
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid IP "
literal|"address '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|&&
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"acct_server_port"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|->
name|port
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|&&
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"acct_server_shared_secret"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|len
init|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
block|{
comment|/* RFC 2865, Ch. 3 */
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: empty shared "
literal|"secret is not allowed."
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|->
name|shared_secret
operator|=
operator|(
name|u8
operator|*
operator|)
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|->
name|shared_secret_len
operator|=
name|len
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_retry_primary_interval"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius
operator|->
name|retry_primary_interval
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_acct_interim_interval"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|acct_interim_interval
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_request_cui"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius_request_cui
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_auth_req_attr"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|struct
name|hostapd_radius_attr
modifier|*
name|attr
decl_stmt|,
modifier|*
name|a
decl_stmt|;
name|attr
operator|=
name|hostapd_parse_radius_attr
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"radius_auth_req_attr"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|radius_auth_req_attr
operator|==
name|NULL
condition|)
block|{
name|bss
operator|->
name|radius_auth_req_attr
operator|=
name|attr
expr_stmt|;
block|}
else|else
block|{
name|a
operator|=
name|bss
operator|->
name|radius_auth_req_attr
expr_stmt|;
while|while
condition|(
name|a
operator|->
name|next
condition|)
name|a
operator|=
name|a
operator|->
name|next
expr_stmt|;
name|a
operator|->
name|next
operator|=
name|attr
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_acct_req_attr"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|struct
name|hostapd_radius_attr
modifier|*
name|attr
decl_stmt|,
modifier|*
name|a
decl_stmt|;
name|attr
operator|=
name|hostapd_parse_radius_attr
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"radius_acct_req_attr"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|radius_acct_req_attr
operator|==
name|NULL
condition|)
block|{
name|bss
operator|->
name|radius_acct_req_attr
operator|=
name|attr
expr_stmt|;
block|}
else|else
block|{
name|a
operator|=
name|bss
operator|->
name|radius_acct_req_attr
expr_stmt|;
while|while
condition|(
name|a
operator|->
name|next
condition|)
name|a
operator|=
name|a
operator|->
name|next
expr_stmt|;
name|a
operator|->
name|next
operator|=
name|attr
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_das_port"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius_das_port
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_das_client"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_parse_das_client
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"DAS client"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_das_time_window"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius_das_time_window
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_das_require_event_timestamp"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius_das_require_event_timestamp
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_NO_RADIUS */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_algs"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|auth_algs
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|auth_algs
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: no "
literal|"authentication algorithms allowed"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"max_num_sta"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|max_num_sta
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|max_num_sta
operator|<
literal|0
operator|||
name|bss
operator|->
name|max_num_sta
operator|>
name|MAX_STA_COUNT
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"max_num_sta=%d; allowed range "
literal|"0..%d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|max_num_sta
argument_list|,
name|MAX_STA_COUNT
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_group_rekey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_group_rekey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_strict_rekey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_strict_rekey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_gmk_rekey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_gmk_rekey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_ptk_rekey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_ptk_rekey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_passphrase"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|len
init|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|len
operator|<
literal|8
operator|||
name|len
operator|>
literal|63
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid WPA "
literal|"passphrase length %d (expected "
literal|"8..63)"
argument_list|,
name|line
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|wpa_passphrase
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|wpa_passphrase
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
operator|=
name|NULL
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_psk"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_wpa_psk
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
operator|==
name|NULL
condition|)
name|errors
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
operator|->
name|psk
argument_list|,
name|PMK_LEN
argument_list|)
operator|||
name|pos
index|[
name|PMK_LEN
operator|*
literal|2
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid PSK "
literal|"'%s'."
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
operator|->
name|group
operator|=
literal|1
expr_stmt|;
name|os_free
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|wpa_passphrase
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|wpa_passphrase
operator|=
name|NULL
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_psk_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk_file
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk_file
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk_file
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: allocation "
literal|"failed"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_key_mgmt"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_key_mgmt
operator|=
name|hostapd_config_parse_key_mgmt
argument_list|(
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wpa_key_mgmt
operator|==
operator|-
literal|1
condition|)
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_psk_radius"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_psk_radius
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wpa_psk_radius
operator|!=
name|PSK_RADIUS_IGNORED
operator|&&
name|bss
operator|->
name|wpa_psk_radius
operator|!=
name|PSK_RADIUS_ACCEPTED
operator|&&
name|bss
operator|->
name|wpa_psk_radius
operator|!=
name|PSK_RADIUS_REQUIRED
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unknown "
literal|"wpa_psk_radius %d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|wpa_psk_radius
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_pairwise"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_pairwise
operator|=
name|hostapd_config_parse_cipher
argument_list|(
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wpa_pairwise
operator|==
operator|-
literal|1
operator|||
name|bss
operator|->
name|wpa_pairwise
operator|==
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|bss
operator|->
name|wpa_pairwise
operator|&
operator|(
name|WPA_CIPHER_NONE
operator||
name|WPA_CIPHER_WEP40
operator||
name|WPA_CIPHER_WEP104
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unsupported "
literal|"pairwise cipher suite '%s'"
argument_list|,
name|bss
operator|->
name|wpa_pairwise
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"rsn_pairwise"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|rsn_pairwise
operator|=
name|hostapd_config_parse_cipher
argument_list|(
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|rsn_pairwise
operator|==
operator|-
literal|1
operator|||
name|bss
operator|->
name|rsn_pairwise
operator|==
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|bss
operator|->
name|rsn_pairwise
operator|&
operator|(
name|WPA_CIPHER_NONE
operator||
name|WPA_CIPHER_WEP40
operator||
name|WPA_CIPHER_WEP104
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unsupported "
literal|"pairwise cipher suite '%s'"
argument_list|,
name|bss
operator|->
name|rsn_pairwise
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|CONFIG_RSN_PREAUTH
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"rsn_preauth"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|rsn_preauth
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"rsn_preauth_interfaces"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|rsn_preauth_interfaces
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_RSN_PREAUTH */
ifdef|#
directive|ifdef
name|CONFIG_PEERKEY
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"peerkey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|peerkey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_PEERKEY */
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211R
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"mobility_domain"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|!=
literal|2
operator|*
name|MOBILITY_DOMAIN_ID_LEN
operator|||
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|mobility_domain
argument_list|,
name|MOBILITY_DOMAIN_ID_LEN
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: Invalid "
literal|"mobility_domain '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"r1_key_holder"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|!=
literal|2
operator|*
name|FT_R1KH_ID_LEN
operator|||
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|r1_key_holder
argument_list|,
name|FT_R1KH_ID_LEN
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: Invalid "
literal|"r1_key_holder '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"r0_key_lifetime"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|r0_key_lifetime
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"reassociation_deadline"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|reassociation_deadline
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"r0kh"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|add_r0kh
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: Invalid "
literal|"r0kh '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"r1kh"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|add_r1kh
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: Invalid "
literal|"r1kh '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"pmk_r1_push"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|pmk_r1_push
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ft_over_ds"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ft_over_ds
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IEEE80211R */
ifndef|#
directive|ifndef
name|CONFIG_NO_CTRL_IFACE
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ctrl_interface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ctrl_interface
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ctrl_interface
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ctrl_interface_group"
argument_list|)
operator|==
literal|0
condition|)
block|{
ifndef|#
directive|ifndef
name|CONFIG_NATIVE_WINDOWS
name|struct
name|group
modifier|*
name|grp
decl_stmt|;
name|char
modifier|*
name|endp
decl_stmt|;
specifier|const
name|char
modifier|*
name|group
init|=
name|pos
decl_stmt|;
name|grp
operator|=
name|getgrnam
argument_list|(
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
name|grp
condition|)
block|{
name|bss
operator|->
name|ctrl_interface_gid
operator|=
name|grp
operator|->
name|gr_gid
expr_stmt|;
name|bss
operator|->
name|ctrl_interface_gid_set
operator|=
literal|1
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"ctrl_interface_group=%d"
literal|" (from group name '%s')"
argument_list|,
name|bss
operator|->
name|ctrl_interface_gid
argument_list|,
name|group
argument_list|)
expr_stmt|;
return|return
name|errors
return|;
block|}
comment|/* Group name not found - try to parse this as gid */
name|bss
operator|->
name|ctrl_interface_gid
operator|=
name|strtol
argument_list|(
name|group
argument_list|,
operator|&
name|endp
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|group
operator|==
literal|'\0'
operator|||
operator|*
name|endp
operator|!=
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: Invalid group "
literal|"'%s'"
argument_list|,
name|line
argument_list|,
name|group
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
name|bss
operator|->
name|ctrl_interface_gid_set
operator|=
literal|1
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"ctrl_interface_group=%d"
argument_list|,
name|bss
operator|->
name|ctrl_interface_gid
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_NATIVE_WINDOWS */
endif|#
directive|endif
comment|/* CONFIG_NO_CTRL_IFACE */
ifdef|#
directive|ifdef
name|RADIUS_SERVER
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_server_clients"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|radius_server_clients
argument_list|)
expr_stmt|;
name|bss
operator|->
name|radius_server_clients
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_server_auth_port"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius_server_auth_port
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_server_ipv6"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius_server_ipv6
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* RADIUS_SERVER */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"test_socket"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|test_socket
argument_list|)
expr_stmt|;
name|bss
operator|->
name|test_socket
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"use_pae_group_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|use_pae_group_addr
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"hw_mode"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"a"
argument_list|)
operator|==
literal|0
condition|)
name|conf
operator|->
name|hw_mode
operator|=
name|HOSTAPD_MODE_IEEE80211A
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"b"
argument_list|)
operator|==
literal|0
condition|)
name|conf
operator|->
name|hw_mode
operator|=
name|HOSTAPD_MODE_IEEE80211B
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"g"
argument_list|)
operator|==
literal|0
condition|)
name|conf
operator|->
name|hw_mode
operator|=
name|HOSTAPD_MODE_IEEE80211G
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"ad"
argument_list|)
operator|==
literal|0
condition|)
name|conf
operator|->
name|hw_mode
operator|=
name|HOSTAPD_MODE_IEEE80211AD
expr_stmt|;
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unknown "
literal|"hw_mode '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wps_rf_bands"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"a"
argument_list|)
operator|==
literal|0
condition|)
name|bss
operator|->
name|wps_rf_bands
operator|=
name|WPS_RF_50GHZ
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"g"
argument_list|)
operator|==
literal|0
operator|||
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"b"
argument_list|)
operator|==
literal|0
condition|)
name|bss
operator|->
name|wps_rf_bands
operator|=
name|WPS_RF_24GHZ
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"ag"
argument_list|)
operator|==
literal|0
operator|||
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"ga"
argument_list|)
operator|==
literal|0
condition|)
name|bss
operator|->
name|wps_rf_bands
operator|=
name|WPS_RF_24GHZ
operator||
name|WPS_RF_50GHZ
expr_stmt|;
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unknown "
literal|"wps_rf_band '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"channel"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|channel
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"beacon_int"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|val
init|=
name|atoi
argument_list|(
name|pos
argument_list|)
decl_stmt|;
comment|/* MIB defines range as 1..65535, but very small values 			 * cause problems with the current implementation. 			 * Since it is unlikely that this small numbers are 			 * useful in real life scenarios, do not allow beacon 			 * period to be set below 15 TU. */
if|if
condition|(
name|val
operator|<
literal|15
operator|||
name|val
operator|>
literal|65535
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"beacon_int %d (expected "
literal|"15..65535)"
argument_list|,
name|line
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
name|conf
operator|->
name|beacon_int
operator|=
name|val
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"dtim_period"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|dtim_period
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|dtim_period
operator|<
literal|1
operator|||
name|bss
operator|->
name|dtim_period
operator|>
literal|255
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"dtim_period %d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|dtim_period
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"rts_threshold"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|rts_threshold
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|rts_threshold
operator|<
literal|0
operator|||
name|conf
operator|->
name|rts_threshold
operator|>
literal|2347
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"rts_threshold %d"
argument_list|,
name|line
argument_list|,
name|conf
operator|->
name|rts_threshold
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"fragm_threshold"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|fragm_threshold
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|fragm_threshold
operator|<
literal|256
operator|||
name|conf
operator|->
name|fragm_threshold
operator|>
literal|2346
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"fragm_threshold %d"
argument_list|,
name|line
argument_list|,
name|conf
operator|->
name|fragm_threshold
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"send_probe_response"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|val
init|=
name|atoi
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|val
operator|!=
literal|0
operator|&&
name|val
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"send_probe_response %d (expected "
literal|"0 or 1)"
argument_list|,
name|line
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
else|else
name|conf
operator|->
name|send_probe_response
operator|=
name|val
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"supported_rates"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_parse_rates
argument_list|(
operator|&
name|conf
operator|->
name|supported_rates
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid rate "
literal|"list"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"basic_rates"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_parse_rates
argument_list|(
operator|&
name|conf
operator|->
name|basic_rates
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid rate "
literal|"list"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"preamble"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|atoi
argument_list|(
name|pos
argument_list|)
condition|)
name|conf
operator|->
name|preamble
operator|=
name|SHORT_PREAMBLE
expr_stmt|;
else|else
name|conf
operator|->
name|preamble
operator|=
name|LONG_PREAMBLE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ignore_broadcast_ssid"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ignore_broadcast_ssid
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_default_key"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|idx
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|idx
operator|>
literal|3
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid "
literal|"wep_default_key index %d"
argument_list|,
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|idx
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key0"
argument_list|)
operator|==
literal|0
operator|||
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key1"
argument_list|)
operator|==
literal|0
operator|||
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key2"
argument_list|)
operator|==
literal|0
operator|||
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key3"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_wep
argument_list|(
operator|&
name|bss
operator|->
name|ssid
operator|.
name|wep
argument_list|,
name|buf
index|[
literal|7
index|]
operator|-
literal|'0'
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid WEP "
literal|"key '%s'"
argument_list|,
name|line
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|CONFIG_NO_VLAN
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"dynamic_vlan"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|dynamic_vlan
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"vlan_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_vlan_file
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: failed to "
literal|"read VLAN file '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"vlan_naming"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|vlan_naming
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|ssid
operator|.
name|vlan_naming
operator|>=
name|DYNAMIC_VLAN_NAMING_END
operator|||
name|bss
operator|->
name|ssid
operator|.
name|vlan_naming
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"naming scheme %d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|ssid
operator|.
name|vlan_naming
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|CONFIG_FULL_DYNAMIC_VLAN
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"vlan_tagged_interface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|vlan_tagged_interface
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_FULL_DYNAMIC_VLAN */
endif|#
directive|endif
comment|/* CONFIG_NO_VLAN */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_table_max_size"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ap_table_max_size
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_table_expiration_time"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ap_table_expiration_time
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|buf
argument_list|,
literal|"tx_queue_"
argument_list|,
literal|9
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_tx_queue
argument_list|(
name|conf
argument_list|,
name|buf
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid TX "
literal|"queue item"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wme_enabled"
argument_list|)
operator|==
literal|0
operator|||
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wmm_enabled"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wmm_enabled
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"uapsd_advertisement_enabled"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wmm_uapsd
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|buf
argument_list|,
literal|"wme_ac_"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
operator|||
name|os_strncmp
argument_list|(
name|buf
argument_list|,
literal|"wmm_ac_"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_wmm_ac
argument_list|(
name|conf
operator|->
name|wmm_ac_params
argument_list|,
name|buf
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid WMM "
literal|"ac item"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"bss"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_bss
argument_list|(
name|conf
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid bss "
literal|"item"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"bssid"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hwaddr_aton
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|bssid
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid bssid "
literal|"item"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211W
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ieee80211w"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ieee80211w
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"assoc_sa_query_max_timeout"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|assoc_sa_query_max_timeout
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|assoc_sa_query_max_timeout
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"assoc_sa_query_max_timeout"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"assoc_sa_query_retry_timeout"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|assoc_sa_query_retry_timeout
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|assoc_sa_query_retry_timeout
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"assoc_sa_query_retry_timeout"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* CONFIG_IEEE80211W */
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211N
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ieee80211n"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ieee80211n
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ht_capab"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_ht_capab
argument_list|(
name|conf
argument_list|,
name|pos
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"ht_capab"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"require_ht"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|require_ht
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IEEE80211N */
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211AC
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ieee80211ac"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ieee80211ac
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"vht_capab"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_vht_capab
argument_list|(
name|conf
argument_list|,
name|pos
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"vht_capab"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"require_vht"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|require_vht
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"vht_oper_chwidth"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|vht_oper_chwidth
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"vht_oper_centr_freq_seg0_idx"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|vht_oper_centr_freq_seg0_idx
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"vht_oper_centr_freq_seg1_idx"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|vht_oper_centr_freq_seg1_idx
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IEEE80211AC */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"max_listen_interval"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|max_listen_interval
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"disable_pmksa_caching"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|disable_pmksa_caching
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"okc"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|okc
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_WPS
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wps_state"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wps_state
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wps_state
operator|<
literal|0
operator|||
name|bss
operator|->
name|wps_state
operator|>
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"wps_state"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_setup_locked"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ap_setup_locked
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"uuid"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|uuid_str2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|uuid
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid UUID"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wps_pin_requests"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|wps_pin_requests
argument_list|)
expr_stmt|;
name|bss
operator|->
name|wps_pin_requests
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"device_name"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
literal|32
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Too long "
literal|"device_name"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|device_name
argument_list|)
expr_stmt|;
name|bss
operator|->
name|device_name
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"manufacturer"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
literal|64
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Too long "
literal|"manufacturer"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|manufacturer
argument_list|)
expr_stmt|;
name|bss
operator|->
name|manufacturer
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"model_name"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
literal|32
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Too long "
literal|"model_name"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|model_name
argument_list|)
expr_stmt|;
name|bss
operator|->
name|model_name
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"model_number"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
literal|32
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Too long "
literal|"model_number"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|model_number
argument_list|)
expr_stmt|;
name|bss
operator|->
name|model_number
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"serial_number"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
literal|32
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Too long "
literal|"serial_number"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|serial_number
argument_list|)
expr_stmt|;
name|bss
operator|->
name|serial_number
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"device_type"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|wps_dev_type_str2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|device_type
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"config_methods"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|config_methods
argument_list|)
expr_stmt|;
name|bss
operator|->
name|config_methods
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"os_version"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|os_version
argument_list|,
literal|4
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"os_version"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_pin"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ap_pin
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ap_pin
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"skip_cred_build"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|skip_cred_build
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"extra_cred"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|extra_cred
argument_list|)
expr_stmt|;
name|bss
operator|->
name|extra_cred
operator|=
operator|(
name|u8
operator|*
operator|)
name|os_readfile
argument_list|(
name|pos
argument_list|,
operator|&
name|bss
operator|->
name|extra_cred_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|extra_cred
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: could not "
literal|"read Credentials from '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wps_cred_processing"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wps_cred_processing
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_settings"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ap_settings
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ap_settings
operator|=
operator|(
name|u8
operator|*
operator|)
name|os_readfile
argument_list|(
name|pos
argument_list|,
operator|&
name|bss
operator|->
name|ap_settings_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|ap_settings
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: could not "
literal|"read AP Settings from '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"upnp_iface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|upnp_iface
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"friendly_name"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|friendly_name
argument_list|)
expr_stmt|;
name|bss
operator|->
name|friendly_name
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"manufacturer_url"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|manufacturer_url
argument_list|)
expr_stmt|;
name|bss
operator|->
name|manufacturer_url
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"model_description"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|model_description
argument_list|)
expr_stmt|;
name|bss
operator|->
name|model_description
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"model_url"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|model_url
argument_list|)
expr_stmt|;
name|bss
operator|->
name|model_url
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"upc"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|upc
argument_list|)
expr_stmt|;
name|bss
operator|->
name|upc
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"pbc_in_m1"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|pbc_in_m1
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_WPS_NFC
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wps_nfc_dev_pw_id"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wps_nfc_dev_pw_id
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wps_nfc_dev_pw_id
operator|<
literal|0x10
operator|||
name|bss
operator|->
name|wps_nfc_dev_pw_id
operator|>
literal|0xffff
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"wps_nfc_dev_pw_id value"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wps_nfc_dh_pubkey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|wpabuf_free
argument_list|(
name|bss
operator|->
name|wps_nfc_dh_pubkey
argument_list|)
expr_stmt|;
name|bss
operator|->
name|wps_nfc_dh_pubkey
operator|=
name|hostapd_parse_bin
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wps_nfc_dh_privkey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|wpabuf_free
argument_list|(
name|bss
operator|->
name|wps_nfc_dh_privkey
argument_list|)
expr_stmt|;
name|bss
operator|->
name|wps_nfc_dh_privkey
operator|=
name|hostapd_parse_bin
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wps_nfc_dev_pw"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|wpabuf_free
argument_list|(
name|bss
operator|->
name|wps_nfc_dev_pw
argument_list|)
expr_stmt|;
name|bss
operator|->
name|wps_nfc_dev_pw
operator|=
name|hostapd_parse_bin
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_WPS_NFC */
endif|#
directive|endif
comment|/* CONFIG_WPS */
ifdef|#
directive|ifdef
name|CONFIG_P2P_MANAGER
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"manage_p2p"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|manage
init|=
name|atoi
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|manage
condition|)
name|bss
operator|->
name|p2p
operator||=
name|P2P_MANAGE
expr_stmt|;
else|else
name|bss
operator|->
name|p2p
operator|&=
operator|~
name|P2P_MANAGE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"allow_cross_connection"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|atoi
argument_list|(
name|pos
argument_list|)
condition|)
name|bss
operator|->
name|p2p
operator||=
name|P2P_ALLOW_CROSS_CONNECTION
expr_stmt|;
else|else
name|bss
operator|->
name|p2p
operator|&=
operator|~
name|P2P_ALLOW_CROSS_CONNECTION
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_P2P_MANAGER */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"disassoc_low_ack"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|disassoc_low_ack
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"tdls_prohibit"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|val
init|=
name|atoi
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|val
condition|)
name|bss
operator|->
name|tdls
operator||=
name|TDLS_PROHIBIT
expr_stmt|;
else|else
name|bss
operator|->
name|tdls
operator|&=
operator|~
name|TDLS_PROHIBIT
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"tdls_prohibit_chan_switch"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|val
init|=
name|atoi
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|val
condition|)
name|bss
operator|->
name|tdls
operator||=
name|TDLS_PROHIBIT_CHAN_SWITCH
expr_stmt|;
else|else
name|bss
operator|->
name|tdls
operator|&=
operator|~
name|TDLS_PROHIBIT_CHAN_SWITCH
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_RSN_TESTING
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"rsn_testing"
argument_list|)
operator|==
literal|0
condition|)
block|{
specifier|extern
name|int
name|rsn_testing
decl_stmt|;
name|rsn_testing
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_RSN_TESTING */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"time_advertisement"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|time_advertisement
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"time_zone"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|size_t
name|tz_len
init|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|tz_len
operator|<
literal|4
operator|||
name|tz_len
operator|>
literal|255
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: invalid "
literal|"time_zone"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|time_zone
argument_list|)
expr_stmt|;
name|bss
operator|->
name|time_zone
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|time_zone
operator|==
name|NULL
condition|)
name|errors
operator|++
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_WNM
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wnm_sleep_mode"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wnm_sleep_mode
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"bss_transition"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|bss_transition
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_WNM */
ifdef|#
directive|ifdef
name|CONFIG_INTERWORKING
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"interworking"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|interworking
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"access_network_type"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|access_network_type
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|access_network_type
operator|<
literal|0
operator|||
name|bss
operator|->
name|access_network_type
operator|>
literal|15
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"access_network_type"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"internet"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|internet
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"asra"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|asra
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"esr"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|esr
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"uesa"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|uesa
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"venue_group"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|venue_group
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|bss
operator|->
name|venue_info_set
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"venue_type"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|venue_type
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|bss
operator|->
name|venue_info_set
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"hessid"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hwaddr_aton
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|hessid
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"hessid"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"roaming_consortium"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|parse_roaming_consortium
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|,
name|line
argument_list|)
operator|<
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"venue_name"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|parse_venue_name
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|,
name|line
argument_list|)
operator|<
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"network_auth_type"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|u8
name|auth_type
decl_stmt|;
name|u16
name|redirect_url_len
decl_stmt|;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
operator|&
name|auth_type
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"network_auth_type '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
if|if
condition|(
name|auth_type
operator|==
literal|0
operator|||
name|auth_type
operator|==
literal|2
condition|)
name|redirect_url_len
operator|=
name|os_strlen
argument_list|(
name|pos
operator|+
literal|2
argument_list|)
expr_stmt|;
else|else
name|redirect_url_len
operator|=
literal|0
expr_stmt|;
name|os_free
argument_list|(
name|bss
operator|->
name|network_auth_type
argument_list|)
expr_stmt|;
name|bss
operator|->
name|network_auth_type
operator|=
name|os_malloc
argument_list|(
name|redirect_url_len
operator|+
literal|3
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|network_auth_type
operator|==
name|NULL
condition|)
block|{
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
operator|*
name|bss
operator|->
name|network_auth_type
operator|=
name|auth_type
expr_stmt|;
name|WPA_PUT_LE16
argument_list|(
name|bss
operator|->
name|network_auth_type
operator|+
literal|1
argument_list|,
name|redirect_url_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|redirect_url_len
condition|)
name|os_memcpy
argument_list|(
name|bss
operator|->
name|network_auth_type
operator|+
literal|3
argument_list|,
name|pos
operator|+
literal|2
argument_list|,
name|redirect_url_len
argument_list|)
expr_stmt|;
name|bss
operator|->
name|network_auth_type_len
operator|=
literal|3
operator|+
name|redirect_url_len
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ipaddr_type_availability"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
operator|&
name|bss
operator|->
name|ipaddr_type_availability
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"ipaddr_type_availability '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ipaddr_type_configured
operator|=
literal|0
expr_stmt|;
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
name|bss
operator|->
name|ipaddr_type_configured
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"domain_name"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|j
decl_stmt|,
name|num_domains
decl_stmt|,
name|domain_len
decl_stmt|,
name|domain_list_len
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|tok_start
decl_stmt|,
modifier|*
name|tok_prev
decl_stmt|;
name|u8
modifier|*
name|domain_list
decl_stmt|,
modifier|*
name|domain_ptr
decl_stmt|;
name|domain_list_len
operator|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|+
literal|1
expr_stmt|;
name|domain_list
operator|=
name|os_malloc
argument_list|(
name|domain_list_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|domain_list
operator|==
name|NULL
condition|)
block|{
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
name|domain_ptr
operator|=
name|domain_list
expr_stmt|;
name|tok_prev
operator|=
name|pos
expr_stmt|;
name|num_domains
operator|=
literal|1
expr_stmt|;
while|while
condition|(
operator|(
name|tok_prev
operator|=
name|os_strchr
argument_list|(
name|tok_prev
argument_list|,
literal|','
argument_list|)
operator|)
condition|)
block|{
name|num_domains
operator|++
expr_stmt|;
name|tok_prev
operator|++
expr_stmt|;
block|}
name|tok_prev
operator|=
name|pos
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|num_domains
condition|;
name|j
operator|++
control|)
block|{
name|tok_start
operator|=
name|os_strchr
argument_list|(
name|tok_prev
argument_list|,
literal|','
argument_list|)
expr_stmt|;
if|if
condition|(
name|tok_start
condition|)
block|{
name|domain_len
operator|=
name|tok_start
operator|-
name|tok_prev
expr_stmt|;
operator|*
name|domain_ptr
operator|=
name|domain_len
expr_stmt|;
name|os_memcpy
argument_list|(
name|domain_ptr
operator|+
literal|1
argument_list|,
name|tok_prev
argument_list|,
name|domain_len
argument_list|)
expr_stmt|;
name|domain_ptr
operator|+=
name|domain_len
operator|+
literal|1
expr_stmt|;
name|tok_prev
operator|=
operator|++
name|tok_start
expr_stmt|;
block|}
else|else
block|{
name|domain_len
operator|=
name|os_strlen
argument_list|(
name|tok_prev
argument_list|)
expr_stmt|;
operator|*
name|domain_ptr
operator|=
name|domain_len
expr_stmt|;
name|os_memcpy
argument_list|(
name|domain_ptr
operator|+
literal|1
argument_list|,
name|tok_prev
argument_list|,
name|domain_len
argument_list|)
expr_stmt|;
name|domain_ptr
operator|+=
name|domain_len
operator|+
literal|1
expr_stmt|;
block|}
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|domain_name
argument_list|)
expr_stmt|;
name|bss
operator|->
name|domain_name
operator|=
name|domain_list
expr_stmt|;
name|bss
operator|->
name|domain_name_len
operator|=
name|domain_list_len
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"anqp_3gpp_cell_net"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|parse_3gpp_cell_net
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|,
name|line
argument_list|)
operator|<
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"nai_realm"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|parse_nai_realm
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|,
name|line
argument_list|)
operator|<
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"gas_frag_limit"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|gas_frag_limit
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"gas_comeback_delay"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|gas_comeback_delay
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_INTERWORKING */
ifdef|#
directive|ifdef
name|CONFIG_RADIUS_TEST
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"dump_msk_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|dump_msk_file
argument_list|)
expr_stmt|;
name|bss
operator|->
name|dump_msk_file
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_RADIUS_TEST */
ifdef|#
directive|ifdef
name|CONFIG_HS20
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"hs20"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|hs20
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"disable_dgaf"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|disable_dgaf
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"hs20_oper_friendly_name"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hs20_parse_oper_friendly_name
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|,
name|line
argument_list|)
operator|<
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"hs20_wan_metrics"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hs20_parse_wan_metrics
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|,
name|line
argument_list|)
operator|<
literal|0
condition|)
block|{
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"hs20_conn_capab"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hs20_parse_conn_capab
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|,
name|line
argument_list|)
operator|<
literal|0
condition|)
block|{
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"hs20_operating_class"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|u8
modifier|*
name|oper_class
decl_stmt|;
name|size_t
name|oper_class_len
decl_stmt|;
name|oper_class_len
operator|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|oper_class_len
operator|<
literal|2
operator|||
operator|(
name|oper_class_len
operator|&
literal|0x01
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"hs20_operating_class '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
name|oper_class_len
operator|/=
literal|2
expr_stmt|;
name|oper_class
operator|=
name|os_malloc
argument_list|(
name|oper_class_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|oper_class
operator|==
name|NULL
condition|)
block|{
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|oper_class
argument_list|,
name|oper_class_len
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"hs20_operating_class '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|oper_class
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
return|return
name|errors
return|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|hs20_operating_class
argument_list|)
expr_stmt|;
name|bss
operator|->
name|hs20_operating_class
operator|=
name|oper_class
expr_stmt|;
name|bss
operator|->
name|hs20_operating_class_len
operator|=
name|oper_class_len
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_HS20 */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"vendor_elements"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|struct
name|wpabuf
modifier|*
name|elems
decl_stmt|;
name|size_t
name|len
init|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|len
operator|&
literal|0x01
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"vendor_elements '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|len
operator|/=
literal|2
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
block|{
name|wpabuf_free
argument_list|(
name|bss
operator|->
name|vendor_elements
argument_list|)
expr_stmt|;
name|bss
operator|->
name|vendor_elements
operator|=
name|NULL
expr_stmt|;
return|return
literal|0
return|;
block|}
name|elems
operator|=
name|wpabuf_alloc
argument_list|(
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|elems
operator|==
name|NULL
condition|)
return|return
literal|1
return|;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|wpabuf_put
argument_list|(
name|elems
argument_list|,
name|len
argument_list|)
argument_list|,
name|len
argument_list|)
condition|)
block|{
name|wpabuf_free
argument_list|(
name|elems
argument_list|)
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"vendor_elements '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|wpabuf_free
argument_list|(
name|bss
operator|->
name|vendor_elements
argument_list|)
expr_stmt|;
name|bss
operator|->
name|vendor_elements
operator|=
name|elems
expr_stmt|;
block|}
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unknown configuration "
literal|"item '%s'"
argument_list|,
name|line
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
return|return
name|errors
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|hostapd_set_security_params
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|)
block|{
name|int
name|pairwise
decl_stmt|;
if|if
condition|(
name|bss
operator|->
name|individual_wep_key_len
operator|==
literal|0
condition|)
block|{
comment|/* individual keys are not use; can use key idx0 for 		 * broadcast keys */
name|bss
operator|->
name|broadcast_key_idx_min
operator|=
literal|0
expr_stmt|;
block|}
comment|/* Select group cipher based on the enabled pairwise cipher 	 * suites */
name|pairwise
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wpa
operator|&
literal|1
condition|)
name|pairwise
operator||=
name|bss
operator|->
name|wpa_pairwise
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wpa
operator|&
literal|2
condition|)
block|{
if|if
condition|(
name|bss
operator|->
name|rsn_pairwise
operator|==
literal|0
condition|)
name|bss
operator|->
name|rsn_pairwise
operator|=
name|bss
operator|->
name|wpa_pairwise
expr_stmt|;
name|pairwise
operator||=
name|bss
operator|->
name|rsn_pairwise
expr_stmt|;
block|}
if|if
condition|(
name|pairwise
operator|&
name|WPA_CIPHER_TKIP
condition|)
name|bss
operator|->
name|wpa_group
operator|=
name|WPA_CIPHER_TKIP
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|pairwise
operator|&
operator|(
name|WPA_CIPHER_CCMP
operator||
name|WPA_CIPHER_GCMP
operator|)
operator|)
operator|==
name|WPA_CIPHER_GCMP
condition|)
name|bss
operator|->
name|wpa_group
operator|=
name|WPA_CIPHER_GCMP
expr_stmt|;
else|else
name|bss
operator|->
name|wpa_group
operator|=
name|WPA_CIPHER_CCMP
expr_stmt|;
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|=
name|bss
operator|->
name|radius
operator|->
name|auth_servers
expr_stmt|;
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|=
name|bss
operator|->
name|radius
operator|->
name|acct_servers
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wpa
operator|&&
name|bss
operator|->
name|ieee802_1x
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|security_policy
operator|=
name|SECURITY_WPA
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|wpa
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|security_policy
operator|=
name|SECURITY_WPA_PSK
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|ieee802_1x
condition|)
block|{
name|int
name|cipher
init|=
name|WPA_CIPHER_NONE
decl_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|security_policy
operator|=
name|SECURITY_IEEE_802_1X
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|default_len
operator|=
name|bss
operator|->
name|default_wep_key_len
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|default_wep_key_len
condition|)
name|cipher
operator|=
name|bss
operator|->
name|default_wep_key_len
operator|>=
literal|13
condition|?
name|WPA_CIPHER_WEP104
else|:
name|WPA_CIPHER_WEP40
expr_stmt|;
name|bss
operator|->
name|wpa_group
operator|=
name|cipher
expr_stmt|;
name|bss
operator|->
name|wpa_pairwise
operator|=
name|cipher
expr_stmt|;
name|bss
operator|->
name|rsn_pairwise
operator|=
name|cipher
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|keys_set
condition|)
block|{
name|int
name|cipher
init|=
name|WPA_CIPHER_WEP40
decl_stmt|;
if|if
condition|(
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|len
index|[
literal|0
index|]
operator|>=
literal|13
condition|)
name|cipher
operator|=
name|WPA_CIPHER_WEP104
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|security_policy
operator|=
name|SECURITY_STATIC_WEP
expr_stmt|;
name|bss
operator|->
name|wpa_group
operator|=
name|cipher
expr_stmt|;
name|bss
operator|->
name|wpa_pairwise
operator|=
name|cipher
expr_stmt|;
name|bss
operator|->
name|rsn_pairwise
operator|=
name|cipher
expr_stmt|;
block|}
else|else
block|{
name|bss
operator|->
name|ssid
operator|.
name|security_policy
operator|=
name|SECURITY_PLAINTEXT
expr_stmt|;
name|bss
operator|->
name|wpa_group
operator|=
name|WPA_CIPHER_NONE
expr_stmt|;
name|bss
operator|->
name|wpa_pairwise
operator|=
name|WPA_CIPHER_NONE
expr_stmt|;
name|bss
operator|->
name|rsn_pairwise
operator|=
name|WPA_CIPHER_NONE
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * hostapd_config_read - Read and parse a configuration file  * @fname: Configuration file name (including path, if needed)  * Returns: Allocated configuration data structure  */
end_comment

begin_function
name|struct
name|hostapd_config
modifier|*
name|hostapd_config_read
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|)
block|{
name|struct
name|hostapd_config
modifier|*
name|conf
decl_stmt|;
name|struct
name|hostapd_bss_config
modifier|*
name|bss
decl_stmt|;
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|512
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|;
name|int
name|errors
init|=
literal|0
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|f
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Could not open configuration file '%s' "
literal|"for reading."
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|conf
operator|=
name|hostapd_config_defaults
argument_list|()
expr_stmt|;
if|if
condition|(
name|conf
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
comment|/* set default driver based on configuration */
name|conf
operator|->
name|driver
operator|=
name|wpa_drivers
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|driver
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"No driver wrappers registered!"
argument_list|)
expr_stmt|;
name|hostapd_config_free
argument_list|(
name|conf
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|bss
operator|=
name|conf
operator|->
name|last_bss
operator|=
name|conf
operator|->
name|bss
expr_stmt|;
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|bss
operator|=
name|conf
operator|->
name|last_bss
expr_stmt|;
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
name|pos
operator|=
name|os_strchr
argument_list|(
name|buf
argument_list|,
literal|'='
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid line '%s'"
argument_list|,
name|line
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
name|pos
operator|++
expr_stmt|;
name|errors
operator|+=
name|hostapd_config_fill
argument_list|(
name|conf
argument_list|,
name|bss
argument_list|,
name|buf
argument_list|,
name|pos
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|conf
operator|->
name|num_bss
condition|;
name|i
operator|++
control|)
name|hostapd_set_security_params
argument_list|(
operator|&
name|conf
operator|->
name|bss
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|hostapd_config_check
argument_list|(
name|conf
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
ifndef|#
directive|ifndef
name|WPA_IGNORE_CONFIG_ERRORS
if|if
condition|(
name|errors
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"%d errors found in configuration file "
literal|"'%s'"
argument_list|,
name|errors
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|hostapd_config_free
argument_list|(
name|conf
argument_list|)
expr_stmt|;
name|conf
operator|=
name|NULL
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* WPA_IGNORE_CONFIG_ERRORS */
return|return
name|conf
return|;
block|}
end_function

begin_function
name|int
name|hostapd_set_iface
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|field
parameter_list|,
name|char
modifier|*
name|value
parameter_list|)
block|{
name|int
name|errors
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|errors
operator|=
name|hostapd_config_fill
argument_list|(
name|conf
argument_list|,
name|bss
argument_list|,
name|field
argument_list|,
name|value
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|errors
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"Failed to set configuration field '%s' "
literal|"to value '%s'"
argument_list|,
name|field
argument_list|,
name|value
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|conf
operator|->
name|num_bss
condition|;
name|i
operator|++
control|)
name|hostapd_set_security_params
argument_list|(
operator|&
name|conf
operator|->
name|bss
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|hostapd_config_check
argument_list|(
name|conf
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Configuration check failed"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

end_unit

