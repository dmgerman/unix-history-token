begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * hostapd / Configuration file  * Copyright (c) 2003-2008, Jouni Malinen<j@w1.fi>  * Copyright (c) 2007-2008, Intel Corporation  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License version 2 as  * published by the Free Software Foundation.  *  * Alternatively, this software may be distributed under the terms of BSD  * license.  *  * See README and COPYING for more details.  */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|CONFIG_NATIVE_WINDOWS
end_ifndef

begin_include
include|#
directive|include
file|<grp.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_NATIVE_WINDOWS */
end_comment

begin_include
include|#
directive|include
file|"hostapd.h"
end_include

begin_include
include|#
directive|include
file|"driver.h"
end_include

begin_include
include|#
directive|include
file|"sha1.h"
end_include

begin_include
include|#
directive|include
file|"eap_server/eap.h"
end_include

begin_include
include|#
directive|include
file|"radius/radius_client.h"
end_include

begin_include
include|#
directive|include
file|"wpa_common.h"
end_include

begin_include
include|#
directive|include
file|"wpa.h"
end_include

begin_include
include|#
directive|include
file|"uuid.h"
end_include

begin_include
include|#
directive|include
file|"eap_common/eap_wsc_common.h"
end_include

begin_define
define|#
directive|define
name|MAX_STA_COUNT
value|2007
end_define

begin_decl_stmt
specifier|extern
name|struct
name|wpa_driver_ops
modifier|*
name|hostapd_drivers
index|[]
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|hostapd_config_read_vlan_file
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
specifier|const
name|char
modifier|*
name|fname
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|128
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|,
modifier|*
name|pos2
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|,
name|vlan_id
decl_stmt|;
name|struct
name|hostapd_vlan
modifier|*
name|vlan
decl_stmt|;
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|f
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"VLAN file '%s' not readable."
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'*'
condition|)
block|{
name|vlan_id
operator|=
name|VLAN_ID_WILDCARD
expr_stmt|;
name|pos
operator|=
name|buf
operator|+
literal|1
expr_stmt|;
block|}
else|else
block|{
name|vlan_id
operator|=
name|strtol
argument_list|(
name|buf
argument_list|,
operator|&
name|pos
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|pos
operator|||
name|vlan_id
operator|<
literal|1
operator|||
name|vlan_id
operator|>
name|MAX_VLAN_ID
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid VLAN ID at "
literal|"line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
name|pos2
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos2
operator|!=
literal|' '
operator|&&
operator|*
name|pos2
operator|!=
literal|'\t'
operator|&&
operator|*
name|pos2
operator|!=
literal|'\0'
condition|)
name|pos2
operator|++
expr_stmt|;
operator|*
name|pos2
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
operator|||
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
name|IFNAMSIZ
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid VLAN ifname at line %d "
literal|"in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|vlan
operator|=
name|os_malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|vlan
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|vlan
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Out of memory while reading "
literal|"VLAN interfaces from '%s'"
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|os_memset
argument_list|(
name|vlan
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|vlan
argument_list|)
argument_list|)
expr_stmt|;
name|vlan
operator|->
name|vlan_id
operator|=
name|vlan_id
expr_stmt|;
name|os_strlcpy
argument_list|(
name|vlan
operator|->
name|ifname
argument_list|,
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|vlan
operator|->
name|ifname
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|vlan_tail
condition|)
name|bss
operator|->
name|vlan_tail
operator|->
name|next
operator|=
name|vlan
expr_stmt|;
else|else
name|bss
operator|->
name|vlan
operator|=
name|vlan
expr_stmt|;
name|bss
operator|->
name|vlan_tail
operator|=
name|vlan
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|hostapd_config_free_vlan
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|)
block|{
name|struct
name|hostapd_vlan
modifier|*
name|vlan
decl_stmt|,
modifier|*
name|prev
decl_stmt|;
name|vlan
operator|=
name|bss
operator|->
name|vlan
expr_stmt|;
name|prev
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
name|vlan
condition|)
block|{
name|prev
operator|=
name|vlan
expr_stmt|;
name|vlan
operator|=
name|vlan
operator|->
name|next
expr_stmt|;
name|os_free
argument_list|(
name|prev
argument_list|)
expr_stmt|;
block|}
name|bss
operator|->
name|vlan
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_comment
comment|/* convert floats with one decimal place to value*10 int, i.e.,  * "1.5" will return 15 */
end_comment

begin_function
specifier|static
name|int
name|hostapd_config_read_int10
parameter_list|(
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|d
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|;
name|i
operator|=
name|atoi
argument_list|(
name|value
argument_list|)
expr_stmt|;
name|pos
operator|=
name|os_strchr
argument_list|(
name|value
argument_list|,
literal|'.'
argument_list|)
expr_stmt|;
name|d
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|pos
condition|)
block|{
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|>=
literal|'0'
operator|&&
operator|*
name|pos
operator|<=
literal|'9'
condition|)
name|d
operator|=
operator|*
name|pos
operator|-
literal|'0'
expr_stmt|;
block|}
return|return
name|i
operator|*
literal|10
operator|+
name|d
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|hostapd_config_defaults_bss
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|)
block|{
name|bss
operator|->
name|logger_syslog_level
operator|=
name|HOSTAPD_LEVEL_INFO
expr_stmt|;
name|bss
operator|->
name|logger_stdout_level
operator|=
name|HOSTAPD_LEVEL_INFO
expr_stmt|;
name|bss
operator|->
name|logger_syslog
operator|=
operator|(
name|unsigned
name|int
operator|)
operator|-
literal|1
expr_stmt|;
name|bss
operator|->
name|logger_stdout
operator|=
operator|(
name|unsigned
name|int
operator|)
operator|-
literal|1
expr_stmt|;
name|bss
operator|->
name|auth_algs
operator|=
name|WPA_AUTH_ALG_OPEN
operator||
name|WPA_AUTH_ALG_SHARED
expr_stmt|;
name|bss
operator|->
name|wep_rekeying_period
operator|=
literal|300
expr_stmt|;
comment|/* use key0 in individual key and key1 in broadcast key */
name|bss
operator|->
name|broadcast_key_idx_min
operator|=
literal|1
expr_stmt|;
name|bss
operator|->
name|broadcast_key_idx_max
operator|=
literal|2
expr_stmt|;
name|bss
operator|->
name|eap_reauth_period
operator|=
literal|3600
expr_stmt|;
name|bss
operator|->
name|wpa_group_rekey
operator|=
literal|600
expr_stmt|;
name|bss
operator|->
name|wpa_gmk_rekey
operator|=
literal|86400
expr_stmt|;
name|bss
operator|->
name|wpa_key_mgmt
operator|=
name|WPA_KEY_MGMT_PSK
expr_stmt|;
name|bss
operator|->
name|wpa_pairwise
operator|=
name|WPA_CIPHER_TKIP
expr_stmt|;
name|bss
operator|->
name|wpa_group
operator|=
name|WPA_CIPHER_TKIP
expr_stmt|;
name|bss
operator|->
name|rsn_pairwise
operator|=
literal|0
expr_stmt|;
name|bss
operator|->
name|max_num_sta
operator|=
name|MAX_STA_COUNT
expr_stmt|;
name|bss
operator|->
name|dtim_period
operator|=
literal|2
expr_stmt|;
name|bss
operator|->
name|radius_server_auth_port
operator|=
literal|1812
expr_stmt|;
name|bss
operator|->
name|ap_max_inactivity
operator|=
name|AP_MAX_INACTIVITY
expr_stmt|;
name|bss
operator|->
name|eapol_version
operator|=
name|EAPOL_VERSION
expr_stmt|;
name|bss
operator|->
name|max_listen_interval
operator|=
literal|65535
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211W
name|bss
operator|->
name|assoc_sa_query_max_timeout
operator|=
literal|1000
expr_stmt|;
name|bss
operator|->
name|assoc_sa_query_retry_timeout
operator|=
literal|201
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IEEE80211W */
ifdef|#
directive|ifdef
name|EAP_FAST
comment|/* both anonymous and authenticated provisioning */
name|bss
operator|->
name|eap_fast_prov
operator|=
literal|3
expr_stmt|;
name|bss
operator|->
name|pac_key_lifetime
operator|=
literal|7
operator|*
literal|24
operator|*
literal|60
operator|*
literal|60
expr_stmt|;
name|bss
operator|->
name|pac_key_refresh_time
operator|=
literal|1
operator|*
literal|24
operator|*
literal|60
operator|*
literal|60
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_FAST */
block|}
end_function

begin_function
specifier|static
name|struct
name|hostapd_config
modifier|*
name|hostapd_config_defaults
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|hostapd_config
modifier|*
name|conf
decl_stmt|;
name|struct
name|hostapd_bss_config
modifier|*
name|bss
decl_stmt|;
name|int
name|i
decl_stmt|;
specifier|const
name|int
name|aCWmin
init|=
literal|15
decl_stmt|,
name|aCWmax
init|=
literal|1024
decl_stmt|;
specifier|const
name|struct
name|hostapd_wme_ac_params
name|ac_bk
init|=
block|{
name|aCWmin
block|,
name|aCWmax
block|,
literal|7
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
comment|/* background traffic */
specifier|const
name|struct
name|hostapd_wme_ac_params
name|ac_be
init|=
block|{
name|aCWmin
block|,
name|aCWmax
block|,
literal|3
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
comment|/* best effort traffic */
specifier|const
name|struct
name|hostapd_wme_ac_params
name|ac_vi
init|=
comment|/* video traffic */
block|{
name|aCWmin
operator|>>
literal|1
block|,
name|aCWmin
block|,
literal|2
block|,
literal|3000
operator|/
literal|32
block|,
literal|1
block|}
decl_stmt|;
specifier|const
name|struct
name|hostapd_wme_ac_params
name|ac_vo
init|=
comment|/* voice traffic */
block|{
name|aCWmin
operator|>>
literal|2
block|,
name|aCWmin
operator|>>
literal|1
block|,
literal|2
block|,
literal|1500
operator|/
literal|32
block|,
literal|1
block|}
decl_stmt|;
name|conf
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|conf
argument_list|)
argument_list|)
expr_stmt|;
name|bss
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|bss
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|==
name|NULL
operator|||
name|bss
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate memory for "
literal|"configuration data."
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|bss
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
comment|/* set default driver based on configuration */
name|conf
operator|->
name|driver
operator|=
name|hostapd_drivers
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|driver
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"No driver wrappers registered!"
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|bss
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|bss
operator|->
name|radius
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|bss
operator|->
name|radius
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|radius
operator|==
name|NULL
condition|)
block|{
name|os_free
argument_list|(
name|conf
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|bss
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|hostapd_config_defaults_bss
argument_list|(
name|bss
argument_list|)
expr_stmt|;
name|conf
operator|->
name|num_bss
operator|=
literal|1
expr_stmt|;
name|conf
operator|->
name|bss
operator|=
name|bss
expr_stmt|;
name|conf
operator|->
name|beacon_int
operator|=
literal|100
expr_stmt|;
name|conf
operator|->
name|rts_threshold
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* use driver default: 2347 */
name|conf
operator|->
name|fragm_threshold
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* user driver default: 2346 */
name|conf
operator|->
name|send_probe_response
operator|=
literal|1
expr_stmt|;
name|conf
operator|->
name|bridge_packets
operator|=
name|INTERNAL_BRIDGE_DO_NOT_CONTROL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NUM_TX_QUEUES
condition|;
name|i
operator|++
control|)
name|conf
operator|->
name|tx_queue
index|[
name|i
index|]
operator|.
name|aifs
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* use hw default */
name|conf
operator|->
name|wme_ac_params
index|[
literal|0
index|]
operator|=
name|ac_be
expr_stmt|;
name|conf
operator|->
name|wme_ac_params
index|[
literal|1
index|]
operator|=
name|ac_bk
expr_stmt|;
name|conf
operator|->
name|wme_ac_params
index|[
literal|2
index|]
operator|=
name|ac_vi
expr_stmt|;
name|conf
operator|->
name|wme_ac_params
index|[
literal|3
index|]
operator|=
name|ac_vo
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211N
name|conf
operator|->
name|ht_capab
operator|=
name|HT_CAP_INFO_SMPS_DISABLED
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IEEE80211N */
return|return
name|conf
return|;
block|}
end_function

begin_function
name|int
name|hostapd_mac_comp
parameter_list|(
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|b
parameter_list|)
block|{
return|return
name|os_memcmp
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
sizeof|sizeof
argument_list|(
name|macaddr
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|hostapd_mac_comp_empty
parameter_list|(
specifier|const
name|void
modifier|*
name|a
parameter_list|)
block|{
name|macaddr
name|empty
init|=
block|{
literal|0
block|}
decl_stmt|;
return|return
name|os_memcmp
argument_list|(
name|a
argument_list|,
name|empty
argument_list|,
sizeof|sizeof
argument_list|(
name|macaddr
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_acl_comp
parameter_list|(
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|b
parameter_list|)
block|{
specifier|const
name|struct
name|mac_acl_entry
modifier|*
name|aa
init|=
name|a
decl_stmt|;
specifier|const
name|struct
name|mac_acl_entry
modifier|*
name|bb
init|=
name|b
decl_stmt|;
return|return
name|os_memcmp
argument_list|(
name|aa
operator|->
name|addr
argument_list|,
name|bb
operator|->
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|macaddr
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_read_maclist
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|,
name|struct
name|mac_acl_entry
modifier|*
modifier|*
name|acl
parameter_list|,
name|int
modifier|*
name|num
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|128
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|;
name|u8
name|addr
index|[
name|ETH_ALEN
index|]
decl_stmt|;
name|struct
name|mac_acl_entry
modifier|*
name|newacl
decl_stmt|;
name|int
name|vlan_id
decl_stmt|;
if|if
condition|(
operator|!
name|fname
condition|)
return|return
literal|0
return|;
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|f
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"MAC list file '%s' not found."
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
if|if
condition|(
name|hwaddr_aton
argument_list|(
name|buf
argument_list|,
name|addr
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid MAC address '%s' at "
literal|"line %d in '%s'"
argument_list|,
name|buf
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|vlan_id
operator|=
literal|0
expr_stmt|;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
operator|&&
operator|*
name|pos
operator|!=
literal|' '
operator|&&
operator|*
name|pos
operator|!=
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
name|vlan_id
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|newacl
operator|=
name|os_realloc
argument_list|(
operator|*
name|acl
argument_list|,
operator|(
operator|*
name|num
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
operator|*
operator|*
name|acl
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|newacl
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"MAC list reallocation failed"
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
operator|*
name|acl
operator|=
name|newacl
expr_stmt|;
name|os_memcpy
argument_list|(
operator|(
operator|*
name|acl
operator|)
index|[
operator|*
name|num
index|]
operator|.
name|addr
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
expr_stmt|;
operator|(
operator|*
name|acl
operator|)
index|[
operator|*
name|num
index|]
operator|.
name|vlan_id
operator|=
name|vlan_id
expr_stmt|;
operator|(
operator|*
name|num
operator|)
operator|++
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|qsort
argument_list|(
operator|*
name|acl
argument_list|,
operator|*
name|num
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
operator|*
name|acl
argument_list|)
argument_list|,
name|hostapd_acl_comp
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_read_wpa_psk
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|,
name|struct
name|hostapd_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|128
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|,
name|ret
init|=
literal|0
decl_stmt|,
name|len
decl_stmt|,
name|ok
decl_stmt|;
name|u8
name|addr
index|[
name|ETH_ALEN
index|]
decl_stmt|;
name|struct
name|hostapd_wpa_psk
modifier|*
name|psk
decl_stmt|;
if|if
condition|(
operator|!
name|fname
condition|)
return|return
literal|0
return|;
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|f
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"WPA PSK file '%s' not found."
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
if|if
condition|(
name|hwaddr_aton
argument_list|(
name|buf
argument_list|,
name|addr
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid MAC address '%s' on "
literal|"line %d in '%s'"
argument_list|,
name|buf
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|psk
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|psk
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|psk
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"WPA PSK allocation failed"
argument_list|)
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|is_zero_ether_addr
argument_list|(
name|addr
argument_list|)
condition|)
name|psk
operator|->
name|group
operator|=
literal|1
expr_stmt|;
else|else
name|os_memcpy
argument_list|(
name|psk
operator|->
name|addr
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
expr_stmt|;
name|pos
operator|=
name|buf
operator|+
literal|17
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"No PSK on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|psk
argument_list|)
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
name|ok
operator|=
literal|0
expr_stmt|;
name|len
operator|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|64
operator|&&
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|psk
operator|->
name|psk
argument_list|,
name|PMK_LEN
argument_list|)
operator|==
literal|0
condition|)
name|ok
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|len
operator|>=
literal|8
operator|&&
name|len
operator|<
literal|64
condition|)
block|{
name|pbkdf2_sha1
argument_list|(
name|pos
argument_list|,
name|ssid
operator|->
name|ssid
argument_list|,
name|ssid
operator|->
name|ssid_len
argument_list|,
literal|4096
argument_list|,
name|psk
operator|->
name|psk
argument_list|,
name|PMK_LEN
argument_list|)
expr_stmt|;
name|ok
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|ok
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid PSK '%s' on line %d in "
literal|"'%s'"
argument_list|,
name|pos
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|psk
argument_list|)
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|psk
operator|->
name|next
operator|=
name|ssid
operator|->
name|wpa_psk
expr_stmt|;
name|ssid
operator|->
name|wpa_psk
operator|=
name|psk
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
name|int
name|hostapd_setup_wpa_psk
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|conf
parameter_list|)
block|{
name|struct
name|hostapd_ssid
modifier|*
name|ssid
init|=
operator|&
name|conf
operator|->
name|ssid
decl_stmt|;
if|if
condition|(
name|ssid
operator|->
name|wpa_passphrase
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|ssid
operator|->
name|wpa_psk
operator|!=
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Warning: both WPA PSK and "
literal|"passphrase set. Using passphrase."
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|ssid
operator|->
name|wpa_psk
argument_list|)
expr_stmt|;
block|}
name|ssid
operator|->
name|wpa_psk
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_wpa_psk
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ssid
operator|->
name|wpa_psk
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Unable to alloc space for PSK"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wpa_hexdump_ascii
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"SSID"
argument_list|,
operator|(
name|u8
operator|*
operator|)
name|ssid
operator|->
name|ssid
argument_list|,
name|ssid
operator|->
name|ssid_len
argument_list|)
expr_stmt|;
name|wpa_hexdump_ascii
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"PSK (ASCII passphrase)"
argument_list|,
operator|(
name|u8
operator|*
operator|)
name|ssid
operator|->
name|wpa_passphrase
argument_list|,
name|os_strlen
argument_list|(
name|ssid
operator|->
name|wpa_passphrase
argument_list|)
argument_list|)
expr_stmt|;
name|pbkdf2_sha1
argument_list|(
name|ssid
operator|->
name|wpa_passphrase
argument_list|,
name|ssid
operator|->
name|ssid
argument_list|,
name|ssid
operator|->
name|ssid_len
argument_list|,
literal|4096
argument_list|,
name|ssid
operator|->
name|wpa_psk
operator|->
name|psk
argument_list|,
name|PMK_LEN
argument_list|)
expr_stmt|;
name|wpa_hexdump
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"PSK (from passphrase)"
argument_list|,
name|ssid
operator|->
name|wpa_psk
operator|->
name|psk
argument_list|,
name|PMK_LEN
argument_list|)
expr_stmt|;
name|ssid
operator|->
name|wpa_psk
operator|->
name|group
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|ssid
operator|->
name|wpa_psk_file
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_wpa_psk
argument_list|(
name|ssid
operator|->
name|wpa_psk_file
argument_list|,
operator|&
name|conf
operator|->
name|ssid
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|EAP_SERVER
end_ifdef

begin_function
specifier|static
name|int
name|hostapd_config_read_eap_user
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|,
name|struct
name|hostapd_bss_config
modifier|*
name|conf
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|512
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|,
modifier|*
name|start
decl_stmt|,
modifier|*
name|pos2
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|,
name|ret
init|=
literal|0
decl_stmt|,
name|num_methods
decl_stmt|;
name|struct
name|hostapd_eap_user
modifier|*
name|user
decl_stmt|,
modifier|*
name|tail
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|fname
condition|)
return|return
literal|0
return|;
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|f
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"EAP user file '%s' not found."
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
comment|/* Lines: "user" METHOD,METHOD2 "password" (password optional) */
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
name|user
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|!=
literal|'"'
operator|&&
name|buf
index|[
literal|0
index|]
operator|!=
literal|'*'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid EAP identity (no \" in "
literal|"start) on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|user
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"EAP user allocation failed"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|force_version
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'*'
condition|)
block|{
name|pos
operator|=
name|buf
expr_stmt|;
block|}
else|else
block|{
name|pos
operator|=
name|buf
operator|+
literal|1
expr_stmt|;
name|start
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'"'
operator|&&
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid EAP identity "
literal|"(no \" in end) on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|identity
operator|=
name|os_malloc
argument_list|(
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|identity
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate "
literal|"memory for EAP identity"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|os_memcpy
argument_list|(
name|user
operator|->
name|identity
argument_list|,
name|start
argument_list|,
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
name|user
operator|->
name|identity_len
operator|=
name|pos
operator|-
name|start
expr_stmt|;
if|if
condition|(
name|pos
index|[
literal|0
index|]
operator|==
literal|'"'
operator|&&
name|pos
index|[
literal|1
index|]
operator|==
literal|'*'
condition|)
block|{
name|user
operator|->
name|wildcard_prefix
operator|=
literal|1
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
block|}
name|pos
operator|++
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"No EAP method on line %d in "
literal|"'%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|start
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|' '
operator|&&
operator|*
name|pos
operator|!=
literal|'\t'
operator|&&
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|pos
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
name|num_methods
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|start
condition|)
block|{
name|char
modifier|*
name|pos3
init|=
name|os_strchr
argument_list|(
name|start
argument_list|,
literal|','
argument_list|)
decl_stmt|;
if|if
condition|(
name|pos3
condition|)
block|{
operator|*
name|pos3
operator|++
operator|=
literal|'\0'
expr_stmt|;
block|}
name|user
operator|->
name|methods
index|[
name|num_methods
index|]
operator|.
name|method
operator|=
name|eap_server_get_type
argument_list|(
name|start
argument_list|,
operator|&
name|user
operator|->
name|methods
index|[
name|num_methods
index|]
operator|.
name|vendor
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|methods
index|[
name|num_methods
index|]
operator|.
name|vendor
operator|==
name|EAP_VENDOR_IETF
operator|&&
name|user
operator|->
name|methods
index|[
name|num_methods
index|]
operator|.
name|method
operator|==
name|EAP_TYPE_NONE
condition|)
block|{
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"TTLS-PAP"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|ttls_auth
operator||=
name|EAP_TTLS_AUTH_PAP
expr_stmt|;
goto|goto
name|skip_eap
goto|;
block|}
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"TTLS-CHAP"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|ttls_auth
operator||=
name|EAP_TTLS_AUTH_CHAP
expr_stmt|;
goto|goto
name|skip_eap
goto|;
block|}
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"TTLS-MSCHAP"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|ttls_auth
operator||=
name|EAP_TTLS_AUTH_MSCHAP
expr_stmt|;
goto|goto
name|skip_eap
goto|;
block|}
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"TTLS-MSCHAPV2"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|ttls_auth
operator||=
name|EAP_TTLS_AUTH_MSCHAPV2
expr_stmt|;
goto|goto
name|skip_eap
goto|;
block|}
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Unsupported EAP type "
literal|"'%s' on line %d in '%s'"
argument_list|,
name|start
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|num_methods
operator|++
expr_stmt|;
if|if
condition|(
name|num_methods
operator|>=
name|EAP_USER_MAX_METHODS
condition|)
break|break;
name|skip_eap
label|:
if|if
condition|(
name|pos3
operator|==
name|NULL
condition|)
break|break;
name|start
operator|=
name|pos3
expr_stmt|;
block|}
if|if
condition|(
name|num_methods
operator|==
literal|0
operator|&&
name|user
operator|->
name|ttls_auth
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"No EAP types configured on "
literal|"line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
goto|goto
name|done
goto|;
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
goto|goto
name|done
goto|;
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"[ver=0]"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|force_version
operator|=
literal|0
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"[ver=1]"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|force_version
operator|=
literal|1
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"[2]"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|phase2
operator|=
literal|1
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
operator|*
name|pos
operator|==
literal|'"'
condition|)
block|{
name|pos
operator|++
expr_stmt|;
name|start
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'"'
operator|&&
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid EAP password "
literal|"(no \" in end) on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password
operator|=
name|os_malloc
argument_list|(
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|password
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate "
literal|"memory for EAP password"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|os_memcpy
argument_list|(
name|user
operator|->
name|password
argument_list|,
name|start
argument_list|,
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
name|user
operator|->
name|password_len
operator|=
name|pos
operator|-
name|start
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"hash:"
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
block|{
name|pos
operator|+=
literal|5
expr_stmt|;
name|pos2
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos2
operator|!=
literal|'\0'
operator|&&
operator|*
name|pos2
operator|!=
literal|' '
operator|&&
operator|*
name|pos2
operator|!=
literal|'\t'
operator|&&
operator|*
name|pos2
operator|!=
literal|'#'
condition|)
name|pos2
operator|++
expr_stmt|;
if|if
condition|(
name|pos2
operator|-
name|pos
operator|!=
literal|32
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid password hash "
literal|"on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password
operator|=
name|os_malloc
argument_list|(
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|password
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate "
literal|"memory for EAP password hash"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|user
operator|->
name|password
argument_list|,
literal|16
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid hash password "
literal|"on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password_len
operator|=
literal|16
expr_stmt|;
name|user
operator|->
name|password_hash
operator|=
literal|1
expr_stmt|;
name|pos
operator|=
name|pos2
expr_stmt|;
block|}
else|else
block|{
name|pos2
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos2
operator|!=
literal|'\0'
operator|&&
operator|*
name|pos2
operator|!=
literal|' '
operator|&&
operator|*
name|pos2
operator|!=
literal|'\t'
operator|&&
operator|*
name|pos2
operator|!=
literal|'#'
condition|)
name|pos2
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|&
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid hex password "
literal|"on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password
operator|=
name|os_malloc
argument_list|(
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|/
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|password
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate "
literal|"memory for EAP password"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|user
operator|->
name|password
argument_list|,
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|/
literal|2
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid hex password "
literal|"on line %d in '%s'"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password_len
operator|=
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|/
literal|2
expr_stmt|;
name|pos
operator|=
name|pos2
expr_stmt|;
block|}
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"[2]"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|phase2
operator|=
literal|1
expr_stmt|;
block|}
name|done
label|:
if|if
condition|(
name|tail
operator|==
name|NULL
condition|)
block|{
name|tail
operator|=
name|conf
operator|->
name|eap_user
operator|=
name|user
expr_stmt|;
block|}
else|else
block|{
name|tail
operator|->
name|next
operator|=
name|user
expr_stmt|;
name|tail
operator|=
name|user
expr_stmt|;
block|}
continue|continue;
name|failed
label|:
if|if
condition|(
name|user
condition|)
block|{
name|os_free
argument_list|(
name|user
operator|->
name|password
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|user
operator|->
name|identity
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|user
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* EAP_SERVER */
end_comment

begin_function
specifier|static
name|int
name|hostapd_config_read_radius_addr
parameter_list|(
name|struct
name|hostapd_radius_server
modifier|*
modifier|*
name|server
parameter_list|,
name|int
modifier|*
name|num_server
parameter_list|,
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|def_port
parameter_list|,
name|struct
name|hostapd_radius_server
modifier|*
modifier|*
name|curr_serv
parameter_list|)
block|{
name|struct
name|hostapd_radius_server
modifier|*
name|nserv
decl_stmt|;
name|int
name|ret
decl_stmt|;
specifier|static
name|int
name|server_index
init|=
literal|1
decl_stmt|;
name|nserv
operator|=
name|os_realloc
argument_list|(
operator|*
name|server
argument_list|,
operator|(
operator|*
name|num_server
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|nserv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|nserv
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
operator|*
name|server
operator|=
name|nserv
expr_stmt|;
name|nserv
operator|=
operator|&
name|nserv
index|[
operator|*
name|num_server
index|]
expr_stmt|;
operator|(
operator|*
name|num_server
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|curr_serv
operator|)
operator|=
name|nserv
expr_stmt|;
name|os_memset
argument_list|(
name|nserv
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|nserv
argument_list|)
argument_list|)
expr_stmt|;
name|nserv
operator|->
name|port
operator|=
name|def_port
expr_stmt|;
name|ret
operator|=
name|hostapd_parse_ip_addr
argument_list|(
name|val
argument_list|,
operator|&
name|nserv
operator|->
name|addr
argument_list|)
expr_stmt|;
name|nserv
operator|->
name|index
operator|=
name|server_index
operator|++
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_parse_key_mgmt
parameter_list|(
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|,
name|last
decl_stmt|;
name|char
modifier|*
name|start
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|os_strdup
argument_list|(
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|start
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|start
operator|!=
literal|'\0'
condition|)
block|{
while|while
condition|(
operator|*
name|start
operator|==
literal|' '
operator|||
operator|*
name|start
operator|==
literal|'\t'
condition|)
name|start
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|start
operator|==
literal|'\0'
condition|)
break|break;
name|end
operator|=
name|start
expr_stmt|;
while|while
condition|(
operator|*
name|end
operator|!=
literal|' '
operator|&&
operator|*
name|end
operator|!=
literal|'\t'
operator|&&
operator|*
name|end
operator|!=
literal|'\0'
condition|)
name|end
operator|++
expr_stmt|;
name|last
operator|=
operator|*
name|end
operator|==
literal|'\0'
expr_stmt|;
operator|*
name|end
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WPA-PSK"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_PSK
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WPA-EAP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_IEEE8021X
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211R
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"FT-PSK"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_FT_PSK
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"FT-EAP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_FT_IEEE8021X
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IEEE80211R */
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211W
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WPA-PSK-SHA256"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_PSK_SHA256
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WPA-EAP-SHA256"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_IEEE8021X_SHA256
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IEEE80211W */
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid key_mgmt '%s'"
argument_list|,
name|line
argument_list|,
name|start
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|last
condition|)
break|break;
name|start
operator|=
name|end
operator|+
literal|1
expr_stmt|;
block|}
name|os_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: no key_mgmt values "
literal|"configured."
argument_list|,
name|line
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|val
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_parse_cipher
parameter_list|(
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|,
name|last
decl_stmt|;
name|char
modifier|*
name|start
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|os_strdup
argument_list|(
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|start
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|start
operator|!=
literal|'\0'
condition|)
block|{
while|while
condition|(
operator|*
name|start
operator|==
literal|' '
operator|||
operator|*
name|start
operator|==
literal|'\t'
condition|)
name|start
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|start
operator|==
literal|'\0'
condition|)
break|break;
name|end
operator|=
name|start
expr_stmt|;
while|while
condition|(
operator|*
name|end
operator|!=
literal|' '
operator|&&
operator|*
name|end
operator|!=
literal|'\t'
operator|&&
operator|*
name|end
operator|!=
literal|'\0'
condition|)
name|end
operator|++
expr_stmt|;
name|last
operator|=
operator|*
name|end
operator|==
literal|'\0'
expr_stmt|;
operator|*
name|end
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"CCMP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_CCMP
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"TKIP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_TKIP
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WEP104"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_WEP104
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"WEP40"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_WEP40
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|start
argument_list|,
literal|"NONE"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_NONE
expr_stmt|;
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid cipher '%s'."
argument_list|,
name|line
argument_list|,
name|start
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|last
condition|)
break|break;
name|start
operator|=
name|end
operator|+
literal|1
expr_stmt|;
block|}
name|os_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: no cipher values configured."
argument_list|,
name|line
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|val
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_check_bss
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|)
block|{
if|if
condition|(
name|bss
operator|->
name|ieee802_1x
operator|&&
operator|!
name|bss
operator|->
name|eap_server
operator|&&
operator|!
name|bss
operator|->
name|radius
operator|->
name|auth_servers
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid IEEE 802.1X configuration (no "
literal|"EAP authenticator configured)."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|bss
operator|->
name|wpa
operator|&&
operator|(
name|bss
operator|->
name|wpa_key_mgmt
operator|&
name|WPA_KEY_MGMT_PSK
operator|)
operator|&&
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
operator|==
name|NULL
operator|&&
name|bss
operator|->
name|ssid
operator|.
name|wpa_passphrase
operator|==
name|NULL
operator|&&
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk_file
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"WPA-PSK enabled, but PSK or passphrase "
literal|"is not configured."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|hostapd_mac_comp_empty
argument_list|(
name|bss
operator|->
name|bssid
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|conf
operator|->
name|num_bss
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
operator|&
name|conf
operator|->
name|bss
index|[
name|i
index|]
operator|!=
name|bss
operator|)
operator|&&
operator|(
name|hostapd_mac_comp
argument_list|(
name|conf
operator|->
name|bss
index|[
name|i
index|]
operator|.
name|bssid
argument_list|,
name|bss
operator|->
name|bssid
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Duplicate BSSID "
name|MACSTR
literal|" on interface '%s' and '%s'."
argument_list|,
name|MAC2STR
argument_list|(
name|bss
operator|->
name|bssid
argument_list|)
argument_list|,
name|conf
operator|->
name|bss
index|[
name|i
index|]
operator|.
name|iface
argument_list|,
name|bss
operator|->
name|iface
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
block|}
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211R
if|if
condition|(
operator|(
name|bss
operator|->
name|wpa_key_mgmt
operator|&
operator|(
name|WPA_KEY_MGMT_FT_PSK
operator||
name|WPA_KEY_MGMT_FT_IEEE8021X
operator|)
operator|)
operator|&&
operator|(
name|bss
operator|->
name|nas_identifier
operator|==
name|NULL
operator|||
name|os_strlen
argument_list|(
name|bss
operator|->
name|nas_identifier
argument_list|)
operator|<
literal|1
operator|||
name|os_strlen
argument_list|(
name|bss
operator|->
name|nas_identifier
argument_list|)
operator|>
name|FT_R0KH_ID_MAX_LEN
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"FT (IEEE 802.11r) requires "
literal|"nas_identifier to be configured as a 1..48 octet "
literal|"string"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
endif|#
directive|endif
comment|/* CONFIG_IEEE80211R */
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211N
if|if
condition|(
name|conf
operator|->
name|ieee80211n
operator|&&
name|bss
operator|->
name|wpa
operator|&&
operator|!
operator|(
name|bss
operator|->
name|wpa_pairwise
operator|&
name|WPA_CIPHER_CCMP
operator|)
operator|&&
operator|!
operator|(
name|bss
operator|->
name|rsn_pairwise
operator|&
name|WPA_CIPHER_CCMP
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"HT (IEEE 802.11n) with WPA/WPA2 "
literal|"requires CCMP to be enabled"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
endif|#
directive|endif
comment|/* CONFIG_IEEE80211N */
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_check
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
if|if
condition|(
name|conf
operator|->
name|ieee80211d
operator|&&
operator|(
operator|!
name|conf
operator|->
name|country
index|[
literal|0
index|]
operator|||
operator|!
name|conf
operator|->
name|country
index|[
literal|1
index|]
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Cannot enable IEEE 802.11d without "
literal|"setting the country_code"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|conf
operator|->
name|num_bss
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|hostapd_config_check_bss
argument_list|(
operator|&
name|conf
operator|->
name|bss
index|[
name|i
index|]
argument_list|,
name|conf
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_read_wep
parameter_list|(
name|struct
name|hostapd_wep_keys
modifier|*
name|wep
parameter_list|,
name|int
name|keyidx
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|size_t
name|len
init|=
name|os_strlen
argument_list|(
name|val
argument_list|)
decl_stmt|;
if|if
condition|(
name|keyidx
operator|<
literal|0
operator|||
name|keyidx
operator|>
literal|3
operator|||
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
operator|!=
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|val
index|[
literal|0
index|]
operator|==
literal|'"'
condition|)
block|{
if|if
condition|(
name|len
operator|<
literal|2
operator|||
name|val
index|[
name|len
operator|-
literal|1
index|]
operator|!=
literal|'"'
condition|)
return|return
operator|-
literal|1
return|;
name|len
operator|-=
literal|2
expr_stmt|;
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
operator|=
name|os_malloc
argument_list|(
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|os_memcpy
argument_list|(
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
argument_list|,
name|val
operator|+
literal|1
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|wep
operator|->
name|len
index|[
name|keyidx
index|]
operator|=
name|len
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|len
operator|&
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|len
operator|/=
literal|2
expr_stmt|;
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
operator|=
name|os_malloc
argument_list|(
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|wep
operator|->
name|len
index|[
name|keyidx
index|]
operator|=
name|len
expr_stmt|;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|val
argument_list|,
name|wep
operator|->
name|key
index|[
name|keyidx
index|]
argument_list|,
name|len
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
block|}
name|wep
operator|->
name|keys_set
operator|++
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_parse_rates
parameter_list|(
name|int
modifier|*
modifier|*
name|rate_list
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|int
modifier|*
name|list
decl_stmt|;
name|int
name|count
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|,
modifier|*
name|end
decl_stmt|;
name|os_free
argument_list|(
operator|*
name|rate_list
argument_list|)
expr_stmt|;
operator|*
name|rate_list
operator|=
name|NULL
expr_stmt|;
name|pos
operator|=
name|val
expr_stmt|;
name|count
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|' '
condition|)
name|count
operator|++
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
name|list
operator|=
name|os_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|int
argument_list|)
operator|*
operator|(
name|count
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|list
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|pos
operator|=
name|val
expr_stmt|;
name|count
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
name|end
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|end
condition|)
operator|*
name|end
operator|=
literal|'\0'
expr_stmt|;
name|list
index|[
name|count
operator|++
index|]
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|end
condition|)
break|break;
name|pos
operator|=
name|end
operator|+
literal|1
expr_stmt|;
block|}
name|list
index|[
name|count
index|]
operator|=
operator|-
literal|1
expr_stmt|;
operator|*
name|rate_list
operator|=
name|list
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_bss
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
specifier|const
name|char
modifier|*
name|ifname
parameter_list|)
block|{
name|struct
name|hostapd_bss_config
modifier|*
name|bss
decl_stmt|;
if|if
condition|(
operator|*
name|ifname
operator|==
literal|'\0'
condition|)
return|return
operator|-
literal|1
return|;
name|bss
operator|=
name|os_realloc
argument_list|(
name|conf
operator|->
name|bss
argument_list|,
operator|(
name|conf
operator|->
name|num_bss
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_bss_config
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate memory for "
literal|"multi-BSS entry"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|conf
operator|->
name|bss
operator|=
name|bss
expr_stmt|;
name|bss
operator|=
operator|&
operator|(
name|conf
operator|->
name|bss
index|[
name|conf
operator|->
name|num_bss
index|]
operator|)
expr_stmt|;
name|os_memset
argument_list|(
name|bss
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|bss
argument_list|)
argument_list|)
expr_stmt|;
name|bss
operator|->
name|radius
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|bss
operator|->
name|radius
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|radius
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Failed to allocate memory for "
literal|"multi-BSS RADIUS data"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|conf
operator|->
name|num_bss
operator|++
expr_stmt|;
name|conf
operator|->
name|last_bss
operator|=
name|bss
expr_stmt|;
name|hostapd_config_defaults_bss
argument_list|(
name|bss
argument_list|)
expr_stmt|;
name|os_strlcpy
argument_list|(
name|bss
operator|->
name|iface
argument_list|,
name|ifname
argument_list|,
sizeof|sizeof
argument_list|(
name|bss
operator|->
name|iface
argument_list|)
argument_list|)
expr_stmt|;
name|os_memcpy
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|vlan
argument_list|,
name|bss
operator|->
name|iface
argument_list|,
name|IFNAMSIZ
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|valid_cw
parameter_list|(
name|int
name|cw
parameter_list|)
block|{
return|return
operator|(
name|cw
operator|==
literal|1
operator|||
name|cw
operator|==
literal|3
operator|||
name|cw
operator|==
literal|7
operator|||
name|cw
operator|==
literal|15
operator|||
name|cw
operator|==
literal|31
operator|||
name|cw
operator|==
literal|63
operator|||
name|cw
operator|==
literal|127
operator|||
name|cw
operator|==
literal|255
operator|||
name|cw
operator|==
literal|511
operator|||
name|cw
operator|==
literal|1023
operator|)
return|;
block|}
end_function

begin_enum
enum|enum
block|{
name|IEEE80211_TX_QUEUE_DATA0
init|=
literal|0
block|,
comment|/* used for EDCA AC_VO data */
name|IEEE80211_TX_QUEUE_DATA1
init|=
literal|1
block|,
comment|/* used for EDCA AC_VI data */
name|IEEE80211_TX_QUEUE_DATA2
init|=
literal|2
block|,
comment|/* used for EDCA AC_BE data */
name|IEEE80211_TX_QUEUE_DATA3
init|=
literal|3
block|,
comment|/* used for EDCA AC_BK data */
name|IEEE80211_TX_QUEUE_DATA4
init|=
literal|4
block|,
name|IEEE80211_TX_QUEUE_AFTER_BEACON
init|=
literal|6
block|,
name|IEEE80211_TX_QUEUE_BEACON
init|=
literal|7
block|}
enum|;
end_enum

begin_function
specifier|static
name|int
name|hostapd_config_tx_queue
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
name|char
modifier|*
name|name
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|int
name|num
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|;
name|struct
name|hostapd_tx_queue_params
modifier|*
name|queue
decl_stmt|;
comment|/* skip 'tx_queue_' prefix */
name|pos
operator|=
name|name
operator|+
literal|9
expr_stmt|;
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"data"
argument_list|,
literal|4
argument_list|)
operator|==
literal|0
operator|&&
name|pos
index|[
literal|4
index|]
operator|>=
literal|'0'
operator|&&
name|pos
index|[
literal|4
index|]
operator|<=
literal|'9'
operator|&&
name|pos
index|[
literal|5
index|]
operator|==
literal|'_'
condition|)
block|{
name|num
operator|=
name|pos
index|[
literal|4
index|]
operator|-
literal|'0'
expr_stmt|;
name|pos
operator|+=
literal|6
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"after_beacon_"
argument_list|,
literal|13
argument_list|)
operator|==
literal|0
condition|)
block|{
name|num
operator|=
name|IEEE80211_TX_QUEUE_AFTER_BEACON
expr_stmt|;
name|pos
operator|+=
literal|13
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"beacon_"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
name|num
operator|=
name|IEEE80211_TX_QUEUE_BEACON
expr_stmt|;
name|pos
operator|+=
literal|7
expr_stmt|;
block|}
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Unknown tx_queue name '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|queue
operator|=
operator|&
name|conf
operator|->
name|tx_queue
index|[
name|num
index|]
expr_stmt|;
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"aifs"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|queue
operator|->
name|aifs
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|queue
operator|->
name|aifs
operator|<
literal|0
operator|||
name|queue
operator|->
name|aifs
operator|>
literal|255
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid AIFS value %d"
argument_list|,
name|queue
operator|->
name|aifs
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"cwmin"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|queue
operator|->
name|cwmin
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|valid_cw
argument_list|(
name|queue
operator|->
name|cwmin
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid cwMin value %d"
argument_list|,
name|queue
operator|->
name|cwmin
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"cwmax"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|queue
operator|->
name|cwmax
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|valid_cw
argument_list|(
name|queue
operator|->
name|cwmax
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid cwMax value %d"
argument_list|,
name|queue
operator|->
name|cwmax
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"burst"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|queue
operator|->
name|burst
operator|=
name|hostapd_config_read_int10
argument_list|(
name|val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Unknown tx_queue field '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|queue
operator|->
name|configured
operator|=
literal|1
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_wme_ac
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
name|char
modifier|*
name|name
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|int
name|num
decl_stmt|,
name|v
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|;
name|struct
name|hostapd_wme_ac_params
modifier|*
name|ac
decl_stmt|;
comment|/* skip 'wme_ac_' prefix */
name|pos
operator|=
name|name
operator|+
literal|7
expr_stmt|;
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"be_"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|num
operator|=
literal|0
expr_stmt|;
name|pos
operator|+=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"bk_"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|num
operator|=
literal|1
expr_stmt|;
name|pos
operator|+=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"vi_"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|num
operator|=
literal|2
expr_stmt|;
name|pos
operator|+=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"vo_"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|num
operator|=
literal|3
expr_stmt|;
name|pos
operator|+=
literal|3
expr_stmt|;
block|}
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Unknown wme name '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|=
operator|&
name|conf
operator|->
name|wme_ac_params
index|[
name|num
index|]
expr_stmt|;
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"aifs"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|v
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|1
operator|||
name|v
operator|>
literal|255
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid AIFS value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|->
name|aifs
operator|=
name|v
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"cwmin"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|v
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
operator|||
name|v
operator|>
literal|12
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid cwMin value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|->
name|cwmin
operator|=
name|v
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"cwmax"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|v
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
operator|||
name|v
operator|>
literal|12
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid cwMax value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|->
name|cwmax
operator|=
name|v
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"txop_limit"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|v
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
operator|||
name|v
operator|>
literal|0xffff
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid txop value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|->
name|txopLimit
operator|=
name|v
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"acm"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|v
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
operator|||
name|v
operator|>
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid acm value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ac
operator|->
name|admission_control_mandatory
operator|=
name|v
expr_stmt|;
block|}
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Unknown wme_ac_ field '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211R
end_ifdef

begin_function
specifier|static
name|int
name|add_r0kh
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|value
parameter_list|)
block|{
name|struct
name|ft_remote_r0kh
modifier|*
name|r0kh
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|,
modifier|*
name|next
decl_stmt|;
name|r0kh
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|r0kh
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|r0kh
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
comment|/* 02:01:02:03:04:05 a.example.com 000102030405060708090a0b0c0d0e0f */
name|pos
operator|=
name|value
expr_stmt|;
name|next
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|next
condition|)
operator|*
name|next
operator|++
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|next
operator|==
name|NULL
operator|||
name|hwaddr_aton
argument_list|(
name|pos
argument_list|,
name|r0kh
operator|->
name|addr
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R0KH MAC address: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r0kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|pos
operator|=
name|next
expr_stmt|;
name|next
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|next
condition|)
operator|*
name|next
operator|++
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|next
operator|==
name|NULL
operator|||
name|next
operator|-
name|pos
operator|>
name|FT_R0KH_ID_MAX_LEN
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R0KH-ID: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r0kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|r0kh
operator|->
name|id_len
operator|=
name|next
operator|-
name|pos
operator|-
literal|1
expr_stmt|;
name|os_memcpy
argument_list|(
name|r0kh
operator|->
name|id
argument_list|,
name|pos
argument_list|,
name|r0kh
operator|->
name|id_len
argument_list|)
expr_stmt|;
name|pos
operator|=
name|next
expr_stmt|;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|r0kh
operator|->
name|key
argument_list|,
sizeof|sizeof
argument_list|(
name|r0kh
operator|->
name|key
argument_list|)
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R0KH key: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r0kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|r0kh
operator|->
name|next
operator|=
name|bss
operator|->
name|r0kh_list
expr_stmt|;
name|bss
operator|->
name|r0kh_list
operator|=
name|r0kh
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|add_r1kh
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|bss
parameter_list|,
name|char
modifier|*
name|value
parameter_list|)
block|{
name|struct
name|ft_remote_r1kh
modifier|*
name|r1kh
decl_stmt|;
name|char
modifier|*
name|pos
decl_stmt|,
modifier|*
name|next
decl_stmt|;
name|r1kh
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|r1kh
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|r1kh
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
comment|/* 02:01:02:03:04:05 02:01:02:03:04:05 	 * 000102030405060708090a0b0c0d0e0f */
name|pos
operator|=
name|value
expr_stmt|;
name|next
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|next
condition|)
operator|*
name|next
operator|++
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|next
operator|==
name|NULL
operator|||
name|hwaddr_aton
argument_list|(
name|pos
argument_list|,
name|r1kh
operator|->
name|addr
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R1KH MAC address: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r1kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|pos
operator|=
name|next
expr_stmt|;
name|next
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|next
condition|)
operator|*
name|next
operator|++
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|next
operator|==
name|NULL
operator|||
name|hwaddr_aton
argument_list|(
name|pos
argument_list|,
name|r1kh
operator|->
name|id
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R1KH-ID: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r1kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|pos
operator|=
name|next
expr_stmt|;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|r1kh
operator|->
name|key
argument_list|,
sizeof|sizeof
argument_list|(
name|r1kh
operator|->
name|key
argument_list|)
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid R1KH key: '%s'"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|r1kh
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|r1kh
operator|->
name|next
operator|=
name|bss
operator|->
name|r1kh_list
expr_stmt|;
name|bss
operator|->
name|r1kh_list
operator|=
name|r1kh
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_IEEE80211R */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211N
end_ifdef

begin_function
specifier|static
name|int
name|hostapd_config_ht_capab
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
specifier|const
name|char
modifier|*
name|capab
parameter_list|)
block|{
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[LDPC]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_LDPC_CODING_CAP
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[HT40-]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SUPP_CHANNEL_WIDTH_SET
expr_stmt|;
name|conf
operator|->
name|secondary_channel
operator|=
operator|-
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[HT40+]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SUPP_CHANNEL_WIDTH_SET
expr_stmt|;
name|conf
operator|->
name|secondary_channel
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SMPS-STATIC]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator|&=
operator|~
name|HT_CAP_INFO_SMPS_MASK
expr_stmt|;
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SMPS_STATIC
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SMPS-DYNAMIC]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator|&=
operator|~
name|HT_CAP_INFO_SMPS_MASK
expr_stmt|;
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SMPS_DYNAMIC
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[GF]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_GREEN_FIELD
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SHORT-GI-20]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SHORT_GI20MHZ
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[SHORT-GI-40]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_SHORT_GI40MHZ
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[TX-STBC]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_TX_STBC
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RX-STBC1]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator|&=
operator|~
name|HT_CAP_INFO_RX_STBC_MASK
expr_stmt|;
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_RX_STBC_1
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RX-STBC12]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator|&=
operator|~
name|HT_CAP_INFO_RX_STBC_MASK
expr_stmt|;
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_RX_STBC_12
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[RX-STBC123]"
argument_list|)
condition|)
block|{
name|conf
operator|->
name|ht_capab
operator|&=
operator|~
name|HT_CAP_INFO_RX_STBC_MASK
expr_stmt|;
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_RX_STBC_123
expr_stmt|;
block|}
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[DELAYED-BA]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_DELAYED_BA
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[MAX-AMSDU-7935]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_MAX_AMSDU_SIZE
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[DSSS_CCK-40]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_DSSS_CCK40MHZ
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[PSMP]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_PSMP_SUPP
expr_stmt|;
if|if
condition|(
name|os_strstr
argument_list|(
name|capab
argument_list|,
literal|"[LSIG-TXOP-PROT]"
argument_list|)
condition|)
name|conf
operator|->
name|ht_capab
operator||=
name|HT_CAP_INFO_LSIG_TXOP_PROTECT_SUPPORT
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_IEEE80211N */
end_comment

begin_comment
comment|/**  * hostapd_config_read - Read and parse a configuration file  * @fname: Configuration file name (including path, if needed)  * Returns: Allocated configuration data structure  */
end_comment

begin_function
name|struct
name|hostapd_config
modifier|*
name|hostapd_config_read
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|)
block|{
name|struct
name|hostapd_config
modifier|*
name|conf
decl_stmt|;
name|struct
name|hostapd_bss_config
modifier|*
name|bss
decl_stmt|;
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|;
name|int
name|errors
init|=
literal|0
decl_stmt|;
name|int
name|pairwise
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|f
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Could not open configuration file '%s' "
literal|"for reading."
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|conf
operator|=
name|hostapd_config_defaults
argument_list|()
expr_stmt|;
if|if
condition|(
name|conf
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|bss
operator|=
name|conf
operator|->
name|last_bss
operator|=
name|conf
operator|->
name|bss
expr_stmt|;
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|bss
operator|=
name|conf
operator|->
name|last_bss
expr_stmt|;
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
name|pos
operator|=
name|os_strchr
argument_list|(
name|buf
argument_list|,
literal|'='
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid line '%s'"
argument_list|,
name|line
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
name|pos
operator|++
expr_stmt|;
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"interface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_strlcpy
argument_list|(
name|conf
operator|->
name|bss
index|[
literal|0
index|]
operator|.
name|iface
argument_list|,
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|conf
operator|->
name|bss
index|[
literal|0
index|]
operator|.
name|iface
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"bridge"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_strlcpy
argument_list|(
name|bss
operator|->
name|bridge
argument_list|,
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|bss
operator|->
name|bridge
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"driver"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|i
decl_stmt|;
comment|/* clear to get error below if setting is invalid */
name|conf
operator|->
name|driver
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|hostapd_drivers
index|[
name|i
index|]
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
name|hostapd_drivers
index|[
name|i
index|]
operator|->
name|name
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|driver
operator|=
name|hostapd_drivers
index|[
name|i
index|]
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|conf
operator|->
name|driver
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid/"
literal|"unknown driver '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"debug"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: DEPRECATED: 'debug' "
literal|"configuration variable is not used "
literal|"anymore"
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_syslog_level"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|logger_syslog_level
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_stdout_level"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|logger_stdout_level
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_syslog"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|logger_syslog
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_stdout"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|logger_stdout
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"dump_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|dump_log_name
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ssid"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|ssid_len
operator|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|ssid
operator|.
name|ssid_len
operator|>
name|HOSTAPD_MAX_SSID_LEN
operator|||
name|bss
operator|->
name|ssid
operator|.
name|ssid_len
operator|<
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid SSID "
literal|"'%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
name|os_memcpy
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|ssid
argument_list|,
name|pos
argument_list|,
name|bss
operator|->
name|ssid
operator|.
name|ssid_len
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|ssid
index|[
name|bss
operator|->
name|ssid
operator|.
name|ssid_len
index|]
operator|=
literal|'\0'
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|ssid_set
operator|=
literal|1
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"macaddr_acl"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|macaddr_acl
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|macaddr_acl
operator|!=
name|ACCEPT_UNLESS_DENIED
operator|&&
name|bss
operator|->
name|macaddr_acl
operator|!=
name|DENY_UNLESS_ACCEPTED
operator|&&
name|bss
operator|->
name|macaddr_acl
operator|!=
name|USE_EXTERNAL_RADIUS_AUTH
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unknown "
literal|"macaddr_acl %d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|macaddr_acl
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"accept_mac_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_maclist
argument_list|(
name|pos
argument_list|,
operator|&
name|bss
operator|->
name|accept_mac
argument_list|,
operator|&
name|bss
operator|->
name|num_accept_mac
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Failed to "
literal|"read accept_mac_file '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"deny_mac_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_maclist
argument_list|(
name|pos
argument_list|,
operator|&
name|bss
operator|->
name|deny_mac
argument_list|,
operator|&
name|bss
operator|->
name|num_deny_mac
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Failed to "
literal|"read deny_mac_file '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_max_inactivity"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ap_max_inactivity
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"country_code"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_memcpy
argument_list|(
name|conf
operator|->
name|country
argument_list|,
name|pos
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* FIX: make this configurable */
name|conf
operator|->
name|country
index|[
literal|2
index|]
operator|=
literal|' '
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ieee80211d"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ieee80211d
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ieee8021x"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ieee802_1x
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eapol_version"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eapol_version
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|eapol_version
operator|<
literal|1
operator|||
name|bss
operator|->
name|eapol_version
operator|>
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid EAPOL "
literal|"version (%d): '%s'."
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|eapol_version
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"eapol_version=%d"
argument_list|,
name|bss
operator|->
name|eapol_version
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|EAP_SERVER
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_authenticator"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eap_server
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: obsolete "
literal|"eap_authenticator used; this has been "
literal|"renamed to eap_server"
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_server"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eap_server
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_user_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_eap_user
argument_list|(
name|pos
argument_list|,
name|bss
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ca_cert"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ca_cert
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ca_cert
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"server_cert"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|server_cert
argument_list|)
expr_stmt|;
name|bss
operator|->
name|server_cert
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"private_key"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|private_key
argument_list|)
expr_stmt|;
name|bss
operator|->
name|private_key
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"private_key_passwd"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|private_key_passwd
argument_list|)
expr_stmt|;
name|bss
operator|->
name|private_key_passwd
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"check_crl"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|check_crl
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"dh_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|dh_file
argument_list|)
expr_stmt|;
name|bss
operator|->
name|dh_file
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|EAP_FAST
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"pac_opaque_encr_key"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|pac_opaque_encr_key
argument_list|)
expr_stmt|;
name|bss
operator|->
name|pac_opaque_encr_key
operator|=
name|os_malloc
argument_list|(
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|pac_opaque_encr_key
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: No memory for "
literal|"pac_opaque_encr_key"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|pac_opaque_encr_key
argument_list|,
literal|16
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"pac_opaque_encr_key"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_fast_a_id"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|size_t
name|idlen
init|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|idlen
operator|&
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"eap_fast_a_id"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|eap_fast_a_id
argument_list|)
expr_stmt|;
name|bss
operator|->
name|eap_fast_a_id
operator|=
name|os_malloc
argument_list|(
name|idlen
operator|/
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|eap_fast_a_id
operator|==
name|NULL
operator|||
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|eap_fast_a_id
argument_list|,
name|idlen
operator|/
literal|2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: "
literal|"Failed to parse "
literal|"eap_fast_a_id"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
name|bss
operator|->
name|eap_fast_a_id_len
operator|=
name|idlen
operator|/
literal|2
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_fast_a_id_info"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|eap_fast_a_id_info
argument_list|)
expr_stmt|;
name|bss
operator|->
name|eap_fast_a_id_info
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_fast_prov"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eap_fast_prov
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"pac_key_lifetime"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|pac_key_lifetime
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"pac_key_refresh_time"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|pac_key_refresh_time
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_FAST */
ifdef|#
directive|ifdef
name|EAP_SIM
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_sim_db"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|eap_sim_db
argument_list|)
expr_stmt|;
name|bss
operator|->
name|eap_sim_db
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_sim_aka_result_ind"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eap_sim_aka_result_ind
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_SIM */
ifdef|#
directive|ifdef
name|EAP_TNC
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"tnc"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|tnc
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_TNC */
endif|#
directive|endif
comment|/* EAP_SERVER */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_message"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|char
modifier|*
name|term
decl_stmt|;
name|bss
operator|->
name|eap_req_id_text
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|eap_req_id_text
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Failed to "
literal|"allocate memory for "
literal|"eap_req_id_text"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
name|bss
operator|->
name|eap_req_id_text_len
operator|=
name|os_strlen
argument_list|(
name|bss
operator|->
name|eap_req_id_text
argument_list|)
expr_stmt|;
name|term
operator|=
name|os_strstr
argument_list|(
name|bss
operator|->
name|eap_req_id_text
argument_list|,
literal|"\\0"
argument_list|)
expr_stmt|;
if|if
condition|(
name|term
condition|)
block|{
operator|*
name|term
operator|++
operator|=
literal|'\0'
expr_stmt|;
name|os_memmove
argument_list|(
name|term
argument_list|,
name|term
operator|+
literal|1
argument_list|,
name|bss
operator|->
name|eap_req_id_text_len
operator|-
operator|(
name|term
operator|-
name|bss
operator|->
name|eap_req_id_text
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|bss
operator|->
name|eap_req_id_text_len
operator|--
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key_len_broadcast"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|default_wep_key_len
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|default_wep_key_len
operator|>
literal|13
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid WEP "
literal|"key len %lu (= %lu bits)"
argument_list|,
name|line
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|bss
operator|->
name|default_wep_key_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|bss
operator|->
name|default_wep_key_len
operator|*
literal|8
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key_len_unicast"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|individual_wep_key_len
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|individual_wep_key_len
operator|<
literal|0
operator|||
name|bss
operator|->
name|individual_wep_key_len
operator|>
literal|13
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid WEP "
literal|"key len %d (= %d bits)"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|individual_wep_key_len
argument_list|,
name|bss
operator|->
name|individual_wep_key_len
operator|*
literal|8
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_rekey_period"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wep_rekeying_period
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wep_rekeying_period
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"period %d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|wep_rekeying_period
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_reauth_period"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eap_reauth_period
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|eap_reauth_period
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"period %d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|eap_reauth_period
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"eapol_key_index_workaround"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|eapol_key_index_workaround
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_IAPP
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"iapp_interface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ieee802_11f
operator|=
literal|1
expr_stmt|;
name|os_strlcpy
argument_list|(
name|bss
operator|->
name|iapp_iface
argument_list|,
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|bss
operator|->
name|iapp_iface
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IAPP */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"own_ip_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_parse_ip_addr
argument_list|(
name|pos
argument_list|,
operator|&
name|bss
operator|->
name|own_ip_addr
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid IP "
literal|"address '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"nas_identifier"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|nas_identifier
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_server_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_radius_addr
argument_list|(
operator|&
name|bss
operator|->
name|radius
operator|->
name|auth_servers
argument_list|,
operator|&
name|bss
operator|->
name|radius
operator|->
name|num_auth_servers
argument_list|,
name|pos
argument_list|,
literal|1812
argument_list|,
operator|&
name|bss
operator|->
name|radius
operator|->
name|auth_server
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid IP "
literal|"address '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|&&
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_server_port"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|->
name|port
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|&&
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_server_shared_secret"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|len
init|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
block|{
comment|/* RFC 2865, Ch. 3 */
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: empty shared "
literal|"secret is not allowed."
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|->
name|shared_secret
operator|=
operator|(
name|u8
operator|*
operator|)
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|->
name|shared_secret_len
operator|=
name|len
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"acct_server_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_radius_addr
argument_list|(
operator|&
name|bss
operator|->
name|radius
operator|->
name|acct_servers
argument_list|,
operator|&
name|bss
operator|->
name|radius
operator|->
name|num_acct_servers
argument_list|,
name|pos
argument_list|,
literal|1813
argument_list|,
operator|&
name|bss
operator|->
name|radius
operator|->
name|acct_server
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid IP "
literal|"address '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|&&
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"acct_server_port"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|->
name|port
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|&&
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"acct_server_shared_secret"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|len
init|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
block|{
comment|/* RFC 2865, Ch. 3 */
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: empty shared "
literal|"secret is not allowed."
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|->
name|shared_secret
operator|=
operator|(
name|u8
operator|*
operator|)
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|->
name|shared_secret_len
operator|=
name|len
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_retry_primary_interval"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius
operator|->
name|retry_primary_interval
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_acct_interim_interval"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius
operator|->
name|acct_interim_interval
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_algs"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|auth_algs
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|auth_algs
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: no "
literal|"authentication algorithms allowed"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"max_num_sta"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|max_num_sta
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|max_num_sta
operator|<
literal|0
operator|||
name|bss
operator|->
name|max_num_sta
operator|>
name|MAX_STA_COUNT
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid "
literal|"max_num_sta=%d; allowed range "
literal|"0..%d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|max_num_sta
argument_list|,
name|MAX_STA_COUNT
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_group_rekey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_group_rekey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_strict_rekey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_strict_rekey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_gmk_rekey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_gmk_rekey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_ptk_rekey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_ptk_rekey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_passphrase"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|len
init|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|len
operator|<
literal|8
operator|||
name|len
operator|>
literal|63
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid WPA "
literal|"passphrase length %d (expected "
literal|"8..63)"
argument_list|,
name|line
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|wpa_passphrase
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|wpa_passphrase
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_psk"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_wpa_psk
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
operator|==
name|NULL
condition|)
name|errors
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
operator|->
name|psk
argument_list|,
name|PMK_LEN
argument_list|)
operator|||
name|pos
index|[
name|PMK_LEN
operator|*
literal|2
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid PSK "
literal|"'%s'."
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk
operator|->
name|group
operator|=
literal|1
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_psk_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk_file
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk_file
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bss
operator|->
name|ssid
operator|.
name|wpa_psk_file
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: allocation "
literal|"failed"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_key_mgmt"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_key_mgmt
operator|=
name|hostapd_config_parse_key_mgmt
argument_list|(
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wpa_key_mgmt
operator|==
operator|-
literal|1
condition|)
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_pairwise"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wpa_pairwise
operator|=
name|hostapd_config_parse_cipher
argument_list|(
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wpa_pairwise
operator|==
operator|-
literal|1
operator|||
name|bss
operator|->
name|wpa_pairwise
operator|==
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|bss
operator|->
name|wpa_pairwise
operator|&
operator|(
name|WPA_CIPHER_NONE
operator||
name|WPA_CIPHER_WEP40
operator||
name|WPA_CIPHER_WEP104
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unsupported "
literal|"pairwise cipher suite '%s'"
argument_list|,
name|bss
operator|->
name|wpa_pairwise
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"rsn_pairwise"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|rsn_pairwise
operator|=
name|hostapd_config_parse_cipher
argument_list|(
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|rsn_pairwise
operator|==
operator|-
literal|1
operator|||
name|bss
operator|->
name|rsn_pairwise
operator|==
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|bss
operator|->
name|rsn_pairwise
operator|&
operator|(
name|WPA_CIPHER_NONE
operator||
name|WPA_CIPHER_WEP40
operator||
name|WPA_CIPHER_WEP104
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unsupported "
literal|"pairwise cipher suite '%s'"
argument_list|,
name|bss
operator|->
name|rsn_pairwise
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|CONFIG_RSN_PREAUTH
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"rsn_preauth"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|rsn_preauth
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"rsn_preauth_interfaces"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|rsn_preauth_interfaces
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_RSN_PREAUTH */
ifdef|#
directive|ifdef
name|CONFIG_PEERKEY
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"peerkey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|peerkey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_PEERKEY */
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211R
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"mobility_domain"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|!=
literal|2
operator|*
name|MOBILITY_DOMAIN_ID_LEN
operator|||
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|mobility_domain
argument_list|,
name|MOBILITY_DOMAIN_ID_LEN
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: Invalid "
literal|"mobility_domain '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"r1_key_holder"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|!=
literal|2
operator|*
name|FT_R1KH_ID_LEN
operator|||
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|r1_key_holder
argument_list|,
name|FT_R1KH_ID_LEN
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: Invalid "
literal|"r1_key_holder '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"r0_key_lifetime"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|r0_key_lifetime
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"reassociation_deadline"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|reassociation_deadline
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"r0kh"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|add_r0kh
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: Invalid "
literal|"r0kh '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"r1kh"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|add_r1kh
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: Invalid "
literal|"r1kh '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"pmk_r1_push"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|pmk_r1_push
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IEEE80211R */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ctrl_interface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ctrl_interface
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ctrl_interface
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ctrl_interface_group"
argument_list|)
operator|==
literal|0
condition|)
block|{
ifndef|#
directive|ifndef
name|CONFIG_NATIVE_WINDOWS
name|struct
name|group
modifier|*
name|grp
decl_stmt|;
name|char
modifier|*
name|endp
decl_stmt|;
specifier|const
name|char
modifier|*
name|group
init|=
name|pos
decl_stmt|;
name|grp
operator|=
name|getgrnam
argument_list|(
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
name|grp
condition|)
block|{
name|bss
operator|->
name|ctrl_interface_gid
operator|=
name|grp
operator|->
name|gr_gid
expr_stmt|;
name|bss
operator|->
name|ctrl_interface_gid_set
operator|=
literal|1
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"ctrl_interface_group=%d"
literal|" (from group name '%s')"
argument_list|,
name|bss
operator|->
name|ctrl_interface_gid
argument_list|,
name|group
argument_list|)
expr_stmt|;
continue|continue;
block|}
comment|/* Group name not found - try to parse this as gid */
name|bss
operator|->
name|ctrl_interface_gid
operator|=
name|strtol
argument_list|(
name|group
argument_list|,
operator|&
name|endp
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|group
operator|==
literal|'\0'
operator|||
operator|*
name|endp
operator|!=
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: Invalid group "
literal|"'%s'"
argument_list|,
name|line
argument_list|,
name|group
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
name|bss
operator|->
name|ctrl_interface_gid_set
operator|=
literal|1
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"ctrl_interface_group=%d"
argument_list|,
name|bss
operator|->
name|ctrl_interface_gid
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_NATIVE_WINDOWS */
ifdef|#
directive|ifdef
name|RADIUS_SERVER
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_server_clients"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|radius_server_clients
argument_list|)
expr_stmt|;
name|bss
operator|->
name|radius_server_clients
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_server_auth_port"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius_server_auth_port
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_server_ipv6"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|radius_server_ipv6
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* RADIUS_SERVER */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"test_socket"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|test_socket
argument_list|)
expr_stmt|;
name|bss
operator|->
name|test_socket
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"use_pae_group_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|use_pae_group_addr
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"hw_mode"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"a"
argument_list|)
operator|==
literal|0
condition|)
name|conf
operator|->
name|hw_mode
operator|=
name|HOSTAPD_MODE_IEEE80211A
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"b"
argument_list|)
operator|==
literal|0
condition|)
name|conf
operator|->
name|hw_mode
operator|=
name|HOSTAPD_MODE_IEEE80211B
expr_stmt|;
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"g"
argument_list|)
operator|==
literal|0
condition|)
name|conf
operator|->
name|hw_mode
operator|=
name|HOSTAPD_MODE_IEEE80211G
expr_stmt|;
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unknown "
literal|"hw_mode '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"channel"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|channel
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"beacon_int"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|val
init|=
name|atoi
argument_list|(
name|pos
argument_list|)
decl_stmt|;
comment|/* MIB defines range as 1..65535, but very small values 			 * cause problems with the current implementation. 			 * Since it is unlikely that this small numbers are 			 * useful in real life scenarios, do not allow beacon 			 * period to be set below 15 TU. */
if|if
condition|(
name|val
operator|<
literal|15
operator|||
name|val
operator|>
literal|65535
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"beacon_int %d (expected "
literal|"15..65535)"
argument_list|,
name|line
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
name|conf
operator|->
name|beacon_int
operator|=
name|val
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"dtim_period"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|dtim_period
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|dtim_period
operator|<
literal|1
operator|||
name|bss
operator|->
name|dtim_period
operator|>
literal|255
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"dtim_period %d"
argument_list|,
name|line
argument_list|,
name|bss
operator|->
name|dtim_period
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"rts_threshold"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|rts_threshold
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|rts_threshold
operator|<
literal|0
operator|||
name|conf
operator|->
name|rts_threshold
operator|>
literal|2347
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"rts_threshold %d"
argument_list|,
name|line
argument_list|,
name|conf
operator|->
name|rts_threshold
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"fragm_threshold"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|fragm_threshold
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|fragm_threshold
operator|<
literal|256
operator|||
name|conf
operator|->
name|fragm_threshold
operator|>
literal|2346
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"fragm_threshold %d"
argument_list|,
name|line
argument_list|,
name|conf
operator|->
name|fragm_threshold
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"send_probe_response"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|val
init|=
name|atoi
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|val
operator|!=
literal|0
operator|&&
name|val
operator|!=
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"send_probe_response %d (expected "
literal|"0 or 1)"
argument_list|,
name|line
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
else|else
name|conf
operator|->
name|send_probe_response
operator|=
name|val
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"supported_rates"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_parse_rates
argument_list|(
operator|&
name|conf
operator|->
name|supported_rates
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid rate "
literal|"list"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"basic_rates"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_parse_rates
argument_list|(
operator|&
name|conf
operator|->
name|basic_rates
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid rate "
literal|"list"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"preamble"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|atoi
argument_list|(
name|pos
argument_list|)
condition|)
name|conf
operator|->
name|preamble
operator|=
name|SHORT_PREAMBLE
expr_stmt|;
else|else
name|conf
operator|->
name|preamble
operator|=
name|LONG_PREAMBLE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ignore_broadcast_ssid"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ignore_broadcast_ssid
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"bridge_packets"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|bridge_packets
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_default_key"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|idx
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|idx
operator|>
literal|3
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Invalid "
literal|"wep_default_key index %d"
argument_list|,
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|idx
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key0"
argument_list|)
operator|==
literal|0
operator|||
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key1"
argument_list|)
operator|==
literal|0
operator|||
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key2"
argument_list|)
operator|==
literal|0
operator|||
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key3"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_wep
argument_list|(
operator|&
name|bss
operator|->
name|ssid
operator|.
name|wep
argument_list|,
name|buf
index|[
literal|7
index|]
operator|-
literal|'0'
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid WEP "
literal|"key '%s'"
argument_list|,
name|line
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"dynamic_vlan"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|dynamic_vlan
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"vlan_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_vlan_file
argument_list|(
name|bss
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: failed to "
literal|"read VLAN file '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|CONFIG_FULL_DYNAMIC_VLAN
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"vlan_tagged_interface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|vlan_tagged_interface
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_FULL_DYNAMIC_VLAN */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"passive_scan_interval"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|passive_scan_interval
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"passive_scan_listen"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|passive_scan_listen
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"passive_scan_mode"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|passive_scan_mode
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_table_max_size"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ap_table_max_size
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_table_expiration_time"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ap_table_expiration_time
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|buf
argument_list|,
literal|"tx_queue_"
argument_list|,
literal|9
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_tx_queue
argument_list|(
name|conf
argument_list|,
name|buf
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid TX "
literal|"queue item"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wme_enabled"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wme_enabled
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|buf
argument_list|,
literal|"wme_ac_"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_wme_ac
argument_list|(
name|conf
argument_list|,
name|buf
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid wme "
literal|"ac item"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"bss"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_bss
argument_list|(
name|conf
argument_list|,
name|pos
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid bss "
literal|"item"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"bssid"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|bss
operator|==
name|conf
operator|->
name|bss
operator|&&
operator|(
operator|!
name|conf
operator|->
name|driver
operator|||
operator|!
name|conf
operator|->
name|driver
operator|->
name|init_bssid
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: bssid item "
literal|"not allowed for the default "
literal|"interface and this driver"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|hwaddr_aton
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|bssid
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid bssid "
literal|"item"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211W
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ieee80211w"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ieee80211w
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"assoc_sa_query_max_timeout"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|assoc_sa_query_max_timeout
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|assoc_sa_query_max_timeout
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"assoc_sa_query_max_timeout"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"assoc_sa_query_retry_timeout"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|assoc_sa_query_retry_timeout
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|assoc_sa_query_retry_timeout
operator|==
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"assoc_sa_query_retry_timeout"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* CONFIG_IEEE80211W */
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211N
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ieee80211n"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ieee80211n
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ht_capab"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_ht_capab
argument_list|(
name|conf
argument_list|,
name|pos
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"ht_capab"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* CONFIG_IEEE80211N */
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"max_listen_interval"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|max_listen_interval
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"okc"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|okc
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_WPS
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wps_state"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wps_state
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wps_state
operator|<
literal|0
operator|||
name|bss
operator|->
name|wps_state
operator|>
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"wps_state"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_setup_locked"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|ap_setup_locked
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"uuid"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|uuid_str2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|uuid
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid UUID"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wps_pin_requests"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|wps_pin_requests
argument_list|)
expr_stmt|;
name|bss
operator|->
name|wps_pin_requests
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"device_name"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
literal|32
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Too long "
literal|"device_name"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|device_name
argument_list|)
expr_stmt|;
name|bss
operator|->
name|device_name
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"manufacturer"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
literal|64
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Too long "
literal|"manufacturer"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|manufacturer
argument_list|)
expr_stmt|;
name|bss
operator|->
name|manufacturer
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"model_name"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
literal|32
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Too long "
literal|"model_name"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|model_name
argument_list|)
expr_stmt|;
name|bss
operator|->
name|model_name
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"model_number"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
literal|32
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Too long "
literal|"model_number"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|model_number
argument_list|)
expr_stmt|;
name|bss
operator|->
name|model_number
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"serial_number"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|>
literal|32
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Too long "
literal|"serial_number"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|os_free
argument_list|(
name|bss
operator|->
name|serial_number
argument_list|)
expr_stmt|;
name|bss
operator|->
name|serial_number
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"device_type"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|device_type
argument_list|)
expr_stmt|;
name|bss
operator|->
name|device_type
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"config_methods"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|config_methods
argument_list|)
expr_stmt|;
name|bss
operator|->
name|config_methods
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"os_version"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|bss
operator|->
name|os_version
argument_list|,
literal|4
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"os_version"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_pin"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ap_pin
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ap_pin
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"skip_cred_build"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|skip_cred_build
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"extra_cred"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|extra_cred
argument_list|)
expr_stmt|;
name|bss
operator|->
name|extra_cred
operator|=
operator|(
name|u8
operator|*
operator|)
name|os_readfile
argument_list|(
name|pos
argument_list|,
operator|&
name|bss
operator|->
name|extra_cred_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|extra_cred
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: could not "
literal|"read Credentials from '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"wps_cred_processing"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|wps_cred_processing
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"ap_settings"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|ap_settings
argument_list|)
expr_stmt|;
name|bss
operator|->
name|ap_settings
operator|=
operator|(
name|u8
operator|*
operator|)
name|os_readfile
argument_list|(
name|pos
argument_list|,
operator|&
name|bss
operator|->
name|ap_settings_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|ap_settings
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: could not "
literal|"read AP Settings from '%s'"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"upnp_iface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bss
operator|->
name|upnp_iface
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"friendly_name"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|friendly_name
argument_list|)
expr_stmt|;
name|bss
operator|->
name|friendly_name
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"manufacturer_url"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|manufacturer_url
argument_list|)
expr_stmt|;
name|bss
operator|->
name|manufacturer_url
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"model_description"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|model_description
argument_list|)
expr_stmt|;
name|bss
operator|->
name|model_description
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"model_url"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|model_url
argument_list|)
expr_stmt|;
name|bss
operator|->
name|model_url
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os_strcmp
argument_list|(
name|buf
argument_list|,
literal|"upc"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|os_free
argument_list|(
name|bss
operator|->
name|upc
argument_list|)
expr_stmt|;
name|bss
operator|->
name|upc
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_WPS */
block|}
else|else
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unknown configuration "
literal|"item '%s'"
argument_list|,
name|line
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|individual_wep_key_len
operator|==
literal|0
condition|)
block|{
comment|/* individual keys are not use; can use key idx0 for broadcast 		 * keys */
name|bss
operator|->
name|broadcast_key_idx_min
operator|=
literal|0
expr_stmt|;
block|}
comment|/* Select group cipher based on the enabled pairwise cipher suites */
name|pairwise
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wpa
operator|&
literal|1
condition|)
name|pairwise
operator||=
name|bss
operator|->
name|wpa_pairwise
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wpa
operator|&
literal|2
condition|)
block|{
if|if
condition|(
name|bss
operator|->
name|rsn_pairwise
operator|==
literal|0
condition|)
name|bss
operator|->
name|rsn_pairwise
operator|=
name|bss
operator|->
name|wpa_pairwise
expr_stmt|;
name|pairwise
operator||=
name|bss
operator|->
name|rsn_pairwise
expr_stmt|;
block|}
if|if
condition|(
name|pairwise
operator|&
name|WPA_CIPHER_TKIP
condition|)
name|bss
operator|->
name|wpa_group
operator|=
name|WPA_CIPHER_TKIP
expr_stmt|;
else|else
name|bss
operator|->
name|wpa_group
operator|=
name|WPA_CIPHER_CCMP
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|conf
operator|->
name|num_bss
condition|;
name|i
operator|++
control|)
block|{
name|bss
operator|=
operator|&
name|conf
operator|->
name|bss
index|[
name|i
index|]
expr_stmt|;
name|bss
operator|->
name|radius
operator|->
name|auth_server
operator|=
name|bss
operator|->
name|radius
operator|->
name|auth_servers
expr_stmt|;
name|bss
operator|->
name|radius
operator|->
name|acct_server
operator|=
name|bss
operator|->
name|radius
operator|->
name|acct_servers
expr_stmt|;
if|if
condition|(
name|bss
operator|->
name|wpa
operator|&&
name|bss
operator|->
name|ieee802_1x
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|security_policy
operator|=
name|SECURITY_WPA
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|wpa
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|security_policy
operator|=
name|SECURITY_WPA_PSK
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|ieee802_1x
condition|)
block|{
name|bss
operator|->
name|ssid
operator|.
name|security_policy
operator|=
name|SECURITY_IEEE_802_1X
expr_stmt|;
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|default_len
operator|=
name|bss
operator|->
name|default_wep_key_len
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bss
operator|->
name|ssid
operator|.
name|wep
operator|.
name|keys_set
condition|)
name|bss
operator|->
name|ssid
operator|.
name|security_policy
operator|=
name|SECURITY_STATIC_WEP
expr_stmt|;
else|else
name|bss
operator|->
name|ssid
operator|.
name|security_policy
operator|=
name|SECURITY_PLAINTEXT
expr_stmt|;
block|}
if|if
condition|(
name|hostapd_config_check
argument_list|(
name|conf
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|errors
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"%d errors found in configuration file "
literal|"'%s'"
argument_list|,
name|errors
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|hostapd_config_free
argument_list|(
name|conf
argument_list|)
expr_stmt|;
name|conf
operator|=
name|NULL
expr_stmt|;
block|}
return|return
name|conf
return|;
block|}
end_function

begin_function
name|int
name|hostapd_wep_key_cmp
parameter_list|(
name|struct
name|hostapd_wep_keys
modifier|*
name|a
parameter_list|,
name|struct
name|hostapd_wep_keys
modifier|*
name|b
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
name|a
operator|->
name|idx
operator|!=
name|b
operator|->
name|idx
operator|||
name|a
operator|->
name|default_len
operator|!=
name|b
operator|->
name|default_len
condition|)
return|return
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NUM_WEP_KEYS
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|a
operator|->
name|len
index|[
name|i
index|]
operator|!=
name|b
operator|->
name|len
index|[
name|i
index|]
operator|||
name|os_memcmp
argument_list|(
name|a
operator|->
name|key
index|[
name|i
index|]
argument_list|,
name|b
operator|->
name|key
index|[
name|i
index|]
argument_list|,
name|a
operator|->
name|len
index|[
name|i
index|]
argument_list|)
operator|!=
literal|0
condition|)
return|return
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|hostapd_config_free_radius
parameter_list|(
name|struct
name|hostapd_radius_server
modifier|*
name|servers
parameter_list|,
name|int
name|num_servers
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_servers
condition|;
name|i
operator|++
control|)
block|{
name|os_free
argument_list|(
name|servers
index|[
name|i
index|]
operator|.
name|shared_secret
argument_list|)
expr_stmt|;
block|}
name|os_free
argument_list|(
name|servers
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|hostapd_config_free_eap_user
parameter_list|(
name|struct
name|hostapd_eap_user
modifier|*
name|user
parameter_list|)
block|{
name|os_free
argument_list|(
name|user
operator|->
name|identity
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|user
operator|->
name|password
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|user
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|hostapd_config_free_wep
parameter_list|(
name|struct
name|hostapd_wep_keys
modifier|*
name|keys
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NUM_WEP_KEYS
condition|;
name|i
operator|++
control|)
block|{
name|os_free
argument_list|(
name|keys
operator|->
name|key
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|keys
operator|->
name|key
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|hostapd_config_free_bss
parameter_list|(
name|struct
name|hostapd_bss_config
modifier|*
name|conf
parameter_list|)
block|{
name|struct
name|hostapd_wpa_psk
modifier|*
name|psk
decl_stmt|,
modifier|*
name|prev
decl_stmt|;
name|struct
name|hostapd_eap_user
modifier|*
name|user
decl_stmt|,
modifier|*
name|prev_user
decl_stmt|;
if|if
condition|(
name|conf
operator|==
name|NULL
condition|)
return|return;
name|psk
operator|=
name|conf
operator|->
name|ssid
operator|.
name|wpa_psk
expr_stmt|;
while|while
condition|(
name|psk
condition|)
block|{
name|prev
operator|=
name|psk
expr_stmt|;
name|psk
operator|=
name|psk
operator|->
name|next
expr_stmt|;
name|os_free
argument_list|(
name|prev
argument_list|)
expr_stmt|;
block|}
name|os_free
argument_list|(
name|conf
operator|->
name|ssid
operator|.
name|wpa_passphrase
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|ssid
operator|.
name|wpa_psk_file
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_FULL_DYNAMIC_VLAN
name|os_free
argument_list|(
name|conf
operator|->
name|ssid
operator|.
name|vlan_tagged_interface
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_FULL_DYNAMIC_VLAN */
name|user
operator|=
name|conf
operator|->
name|eap_user
expr_stmt|;
while|while
condition|(
name|user
condition|)
block|{
name|prev_user
operator|=
name|user
expr_stmt|;
name|user
operator|=
name|user
operator|->
name|next
expr_stmt|;
name|hostapd_config_free_eap_user
argument_list|(
name|prev_user
argument_list|)
expr_stmt|;
block|}
name|os_free
argument_list|(
name|conf
operator|->
name|dump_log_name
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|eap_req_id_text
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|accept_mac
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|deny_mac
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|nas_identifier
argument_list|)
expr_stmt|;
name|hostapd_config_free_radius
argument_list|(
name|conf
operator|->
name|radius
operator|->
name|auth_servers
argument_list|,
name|conf
operator|->
name|radius
operator|->
name|num_auth_servers
argument_list|)
expr_stmt|;
name|hostapd_config_free_radius
argument_list|(
name|conf
operator|->
name|radius
operator|->
name|acct_servers
argument_list|,
name|conf
operator|->
name|radius
operator|->
name|num_acct_servers
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|rsn_preauth_interfaces
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|ctrl_interface
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|ca_cert
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|server_cert
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|private_key
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|private_key_passwd
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|dh_file
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|pac_opaque_encr_key
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|eap_fast_a_id
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|eap_fast_a_id_info
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|eap_sim_db
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|radius_server_clients
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|test_socket
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|radius
argument_list|)
expr_stmt|;
name|hostapd_config_free_vlan
argument_list|(
name|conf
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|ssid
operator|.
name|dyn_vlan_keys
condition|)
block|{
name|struct
name|hostapd_ssid
modifier|*
name|ssid
init|=
operator|&
name|conf
operator|->
name|ssid
decl_stmt|;
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|ssid
operator|->
name|max_dyn_vlan_keys
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ssid
operator|->
name|dyn_vlan_keys
index|[
name|i
index|]
operator|==
name|NULL
condition|)
continue|continue;
name|hostapd_config_free_wep
argument_list|(
name|ssid
operator|->
name|dyn_vlan_keys
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|ssid
operator|->
name|dyn_vlan_keys
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|os_free
argument_list|(
name|ssid
operator|->
name|dyn_vlan_keys
argument_list|)
expr_stmt|;
name|ssid
operator|->
name|dyn_vlan_keys
operator|=
name|NULL
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211R
block|{
name|struct
name|ft_remote_r0kh
modifier|*
name|r0kh
decl_stmt|,
modifier|*
name|r0kh_prev
decl_stmt|;
name|struct
name|ft_remote_r1kh
modifier|*
name|r1kh
decl_stmt|,
modifier|*
name|r1kh_prev
decl_stmt|;
name|r0kh
operator|=
name|conf
operator|->
name|r0kh_list
expr_stmt|;
name|conf
operator|->
name|r0kh_list
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
name|r0kh
condition|)
block|{
name|r0kh_prev
operator|=
name|r0kh
expr_stmt|;
name|r0kh
operator|=
name|r0kh
operator|->
name|next
expr_stmt|;
name|os_free
argument_list|(
name|r0kh_prev
argument_list|)
expr_stmt|;
block|}
name|r1kh
operator|=
name|conf
operator|->
name|r1kh_list
expr_stmt|;
name|conf
operator|->
name|r1kh_list
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
name|r1kh
condition|)
block|{
name|r1kh_prev
operator|=
name|r1kh
expr_stmt|;
name|r1kh
operator|=
name|r1kh
operator|->
name|next
expr_stmt|;
name|os_free
argument_list|(
name|r1kh_prev
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
comment|/* CONFIG_IEEE80211R */
ifdef|#
directive|ifdef
name|CONFIG_WPS
name|os_free
argument_list|(
name|conf
operator|->
name|wps_pin_requests
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|device_name
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|manufacturer
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|model_name
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|model_number
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|serial_number
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|device_type
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|config_methods
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|ap_pin
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|extra_cred
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|ap_settings
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|upnp_iface
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|friendly_name
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|manufacturer_url
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|model_description
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|model_url
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|upc
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_WPS */
block|}
end_function

begin_comment
comment|/**  * hostapd_config_free - Free hostapd configuration  * @conf: Configuration data from hostapd_config_read().  */
end_comment

begin_function
name|void
name|hostapd_config_free
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
if|if
condition|(
name|conf
operator|==
name|NULL
condition|)
return|return;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|conf
operator|->
name|num_bss
condition|;
name|i
operator|++
control|)
name|hostapd_config_free_bss
argument_list|(
operator|&
name|conf
operator|->
name|bss
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
operator|->
name|bss
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|conf
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * hostapd_maclist_found - Find a MAC address from a list  * @list: MAC address list  * @num_entries: Number of addresses in the list  * @addr: Address to search for  * @vlan_id: Buffer for returning VLAN ID or %NULL if not needed  * Returns: 1 if address is in the list or 0 if not.  *  * Perform a binary search for given MAC address from a pre-sorted list.  */
end_comment

begin_function
name|int
name|hostapd_maclist_found
parameter_list|(
name|struct
name|mac_acl_entry
modifier|*
name|list
parameter_list|,
name|int
name|num_entries
parameter_list|,
specifier|const
name|u8
modifier|*
name|addr
parameter_list|,
name|int
modifier|*
name|vlan_id
parameter_list|)
block|{
name|int
name|start
decl_stmt|,
name|end
decl_stmt|,
name|middle
decl_stmt|,
name|res
decl_stmt|;
name|start
operator|=
literal|0
expr_stmt|;
name|end
operator|=
name|num_entries
operator|-
literal|1
expr_stmt|;
while|while
condition|(
name|start
operator|<=
name|end
condition|)
block|{
name|middle
operator|=
operator|(
name|start
operator|+
name|end
operator|)
operator|/
literal|2
expr_stmt|;
name|res
operator|=
name|os_memcmp
argument_list|(
name|list
index|[
name|middle
index|]
operator|.
name|addr
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|res
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|vlan_id
condition|)
operator|*
name|vlan_id
operator|=
name|list
index|[
name|middle
index|]
operator|.
name|vlan_id
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
name|res
operator|<
literal|0
condition|)
name|start
operator|=
name|middle
operator|+
literal|1
expr_stmt|;
else|else
name|end
operator|=
name|middle
operator|-
literal|1
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|hostapd_rate_found
parameter_list|(
name|int
modifier|*
name|list
parameter_list|,
name|int
name|rate
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
name|list
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|list
index|[
name|i
index|]
operator|>=
literal|0
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|list
index|[
name|i
index|]
operator|==
name|rate
condition|)
return|return
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|hostapd_get_vlan_id_ifname
parameter_list|(
name|struct
name|hostapd_vlan
modifier|*
name|vlan
parameter_list|,
name|int
name|vlan_id
parameter_list|)
block|{
name|struct
name|hostapd_vlan
modifier|*
name|v
init|=
name|vlan
decl_stmt|;
while|while
condition|(
name|v
condition|)
block|{
if|if
condition|(
name|v
operator|->
name|vlan_id
operator|==
name|vlan_id
operator|||
name|v
operator|->
name|vlan_id
operator|==
name|VLAN_ID_WILDCARD
condition|)
return|return
name|v
operator|->
name|ifname
return|;
name|v
operator|=
name|v
operator|->
name|next
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|const
name|u8
modifier|*
name|hostapd_get_psk
parameter_list|(
specifier|const
name|struct
name|hostapd_bss_config
modifier|*
name|conf
parameter_list|,
specifier|const
name|u8
modifier|*
name|addr
parameter_list|,
specifier|const
name|u8
modifier|*
name|prev_psk
parameter_list|)
block|{
name|struct
name|hostapd_wpa_psk
modifier|*
name|psk
decl_stmt|;
name|int
name|next_ok
init|=
name|prev_psk
operator|==
name|NULL
decl_stmt|;
for|for
control|(
name|psk
operator|=
name|conf
operator|->
name|ssid
operator|.
name|wpa_psk
init|;
name|psk
operator|!=
name|NULL
condition|;
name|psk
operator|=
name|psk
operator|->
name|next
control|)
block|{
if|if
condition|(
name|next_ok
operator|&&
operator|(
name|psk
operator|->
name|group
operator|||
name|os_memcmp
argument_list|(
name|psk
operator|->
name|addr
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
operator|==
literal|0
operator|)
condition|)
return|return
name|psk
operator|->
name|psk
return|;
if|if
condition|(
name|psk
operator|->
name|psk
operator|==
name|prev_psk
condition|)
name|next_ok
operator|=
literal|1
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|const
name|struct
name|hostapd_eap_user
modifier|*
name|hostapd_get_eap_user
parameter_list|(
specifier|const
name|struct
name|hostapd_bss_config
modifier|*
name|conf
parameter_list|,
specifier|const
name|u8
modifier|*
name|identity
parameter_list|,
name|size_t
name|identity_len
parameter_list|,
name|int
name|phase2
parameter_list|)
block|{
name|struct
name|hostapd_eap_user
modifier|*
name|user
init|=
name|conf
operator|->
name|eap_user
decl_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_WPS
if|if
condition|(
name|conf
operator|->
name|wps_state
operator|&&
name|identity_len
operator|==
name|WSC_ID_ENROLLEE_LEN
operator|&&
name|os_memcmp
argument_list|(
name|identity
argument_list|,
name|WSC_ID_ENROLLEE
argument_list|,
name|WSC_ID_ENROLLEE_LEN
argument_list|)
operator|==
literal|0
condition|)
block|{
specifier|static
name|struct
name|hostapd_eap_user
name|wsc_enrollee
decl_stmt|;
name|os_memset
argument_list|(
operator|&
name|wsc_enrollee
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|wsc_enrollee
argument_list|)
argument_list|)
expr_stmt|;
name|wsc_enrollee
operator|.
name|methods
index|[
literal|0
index|]
operator|.
name|method
operator|=
name|eap_server_get_type
argument_list|(
literal|"WSC"
argument_list|,
operator|&
name|wsc_enrollee
operator|.
name|methods
index|[
literal|0
index|]
operator|.
name|vendor
argument_list|)
expr_stmt|;
return|return
operator|&
name|wsc_enrollee
return|;
block|}
if|if
condition|(
name|conf
operator|->
name|wps_state
operator|&&
name|conf
operator|->
name|ap_pin
operator|&&
name|identity_len
operator|==
name|WSC_ID_REGISTRAR_LEN
operator|&&
name|os_memcmp
argument_list|(
name|identity
argument_list|,
name|WSC_ID_REGISTRAR
argument_list|,
name|WSC_ID_REGISTRAR_LEN
argument_list|)
operator|==
literal|0
condition|)
block|{
specifier|static
name|struct
name|hostapd_eap_user
name|wsc_registrar
decl_stmt|;
name|os_memset
argument_list|(
operator|&
name|wsc_registrar
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|wsc_registrar
argument_list|)
argument_list|)
expr_stmt|;
name|wsc_registrar
operator|.
name|methods
index|[
literal|0
index|]
operator|.
name|method
operator|=
name|eap_server_get_type
argument_list|(
literal|"WSC"
argument_list|,
operator|&
name|wsc_registrar
operator|.
name|methods
index|[
literal|0
index|]
operator|.
name|vendor
argument_list|)
expr_stmt|;
name|wsc_registrar
operator|.
name|password
operator|=
operator|(
name|u8
operator|*
operator|)
name|conf
operator|->
name|ap_pin
expr_stmt|;
name|wsc_registrar
operator|.
name|password_len
operator|=
name|os_strlen
argument_list|(
name|conf
operator|->
name|ap_pin
argument_list|)
expr_stmt|;
return|return
operator|&
name|wsc_registrar
return|;
block|}
endif|#
directive|endif
comment|/* CONFIG_WPS */
while|while
condition|(
name|user
condition|)
block|{
if|if
condition|(
operator|!
name|phase2
operator|&&
name|user
operator|->
name|identity
operator|==
name|NULL
condition|)
block|{
comment|/* Wildcard match */
break|break;
block|}
if|if
condition|(
name|user
operator|->
name|phase2
operator|==
operator|!
operator|!
name|phase2
operator|&&
name|user
operator|->
name|wildcard_prefix
operator|&&
name|identity_len
operator|>=
name|user
operator|->
name|identity_len
operator|&&
name|os_memcmp
argument_list|(
name|user
operator|->
name|identity
argument_list|,
name|identity
argument_list|,
name|user
operator|->
name|identity_len
argument_list|)
operator|==
literal|0
condition|)
block|{
comment|/* Wildcard prefix match */
break|break;
block|}
if|if
condition|(
name|user
operator|->
name|phase2
operator|==
operator|!
operator|!
name|phase2
operator|&&
name|user
operator|->
name|identity_len
operator|==
name|identity_len
operator|&&
name|os_memcmp
argument_list|(
name|user
operator|->
name|identity
argument_list|,
name|identity
argument_list|,
name|identity_len
argument_list|)
operator|==
literal|0
condition|)
break|break;
name|user
operator|=
name|user
operator|->
name|next
expr_stmt|;
block|}
return|return
name|user
return|;
block|}
end_function

end_unit

