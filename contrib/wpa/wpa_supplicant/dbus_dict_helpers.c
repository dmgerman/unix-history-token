begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * WPA Supplicant / dbus-based control interface  * Copyright (c) 2006, Dan Williams<dcbw@redhat.com> and Red Hat, Inc.  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License version 2 as  * published by the Free Software Foundation.  *  * Alternatively, this software may be distributed under the terms of BSD  * license.  *  * See README and COPYING for more details.  */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_include
include|#
directive|include
file|<dbus/dbus.h>
end_include

begin_include
include|#
directive|include
file|"common.h"
end_include

begin_include
include|#
directive|include
file|"dbus_dict_helpers.h"
end_include

begin_comment
comment|/**  * Start a dict in a dbus message.  Should be paired with a call to  * wpa_dbus_dict_close_write().  *  * @param iter A valid dbus message iterator  * @param iter_dict (out) A dict iterator to pass to further dict functions  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_open_write
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|)
block|{
name|dbus_bool_t
name|result
decl_stmt|;
if|if
condition|(
operator|!
name|iter
operator|||
operator|!
name|iter_dict
condition|)
return|return
name|FALSE
return|;
name|result
operator|=
name|dbus_message_iter_open_container
argument_list|(
argument|iter
argument_list|,
argument|DBUS_TYPE_ARRAY
argument_list|,
argument|DBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING 		DBUS_TYPE_STRING_AS_STRING 		DBUS_TYPE_VARIANT_AS_STRING 		DBUS_DICT_ENTRY_END_CHAR_AS_STRING
argument_list|,
argument|iter_dict
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_comment
comment|/**  * End a dict element in a dbus message.  Should be paired with  * a call to wpa_dbus_dict_open_write().  *  * @param iter valid dbus message iterator, same as passed to  *    wpa_dbus_dict_open_write()  * @param iter_dict a dbus dict iterator returned from  *    wpa_dbus_dict_open_write()  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_close_write
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|)
block|{
if|if
condition|(
operator|!
name|iter
operator|||
operator|!
name|iter_dict
condition|)
return|return
name|FALSE
return|;
return|return
name|dbus_message_iter_close_container
argument_list|(
name|iter
argument_list|,
name|iter_dict
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|_wpa_get_type_as_string_from_type
parameter_list|(
specifier|const
name|int
name|type
parameter_list|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|DBUS_TYPE_BYTE
case|:
return|return
name|DBUS_TYPE_BYTE_AS_STRING
return|;
case|case
name|DBUS_TYPE_BOOLEAN
case|:
return|return
name|DBUS_TYPE_BOOLEAN_AS_STRING
return|;
case|case
name|DBUS_TYPE_INT16
case|:
return|return
name|DBUS_TYPE_INT16_AS_STRING
return|;
case|case
name|DBUS_TYPE_UINT16
case|:
return|return
name|DBUS_TYPE_UINT16_AS_STRING
return|;
case|case
name|DBUS_TYPE_INT32
case|:
return|return
name|DBUS_TYPE_INT32_AS_STRING
return|;
case|case
name|DBUS_TYPE_UINT32
case|:
return|return
name|DBUS_TYPE_UINT32_AS_STRING
return|;
case|case
name|DBUS_TYPE_INT64
case|:
return|return
name|DBUS_TYPE_INT64_AS_STRING
return|;
case|case
name|DBUS_TYPE_UINT64
case|:
return|return
name|DBUS_TYPE_UINT64_AS_STRING
return|;
case|case
name|DBUS_TYPE_DOUBLE
case|:
return|return
name|DBUS_TYPE_DOUBLE_AS_STRING
return|;
case|case
name|DBUS_TYPE_STRING
case|:
return|return
name|DBUS_TYPE_STRING_AS_STRING
return|;
case|case
name|DBUS_TYPE_OBJECT_PATH
case|:
return|return
name|DBUS_TYPE_OBJECT_PATH_AS_STRING
return|;
case|case
name|DBUS_TYPE_ARRAY
case|:
return|return
name|DBUS_TYPE_ARRAY_AS_STRING
return|;
default|default:
return|return
name|NULL
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|dbus_bool_t
name|_wpa_dbus_add_dict_entry_start
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_dict_entry
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|int
name|value_type
parameter_list|)
block|{
if|if
condition|(
operator|!
name|dbus_message_iter_open_container
argument_list|(
name|iter_dict
argument_list|,
name|DBUS_TYPE_DICT_ENTRY
argument_list|,
name|NULL
argument_list|,
name|iter_dict_entry
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|dbus_message_iter_append_basic
argument_list|(
name|iter_dict_entry
argument_list|,
name|DBUS_TYPE_STRING
argument_list|,
operator|&
name|key
argument_list|)
condition|)
return|return
name|FALSE
return|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|dbus_bool_t
name|_wpa_dbus_add_dict_entry_end
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_dict_entry
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_dict_val
parameter_list|)
block|{
if|if
condition|(
operator|!
name|dbus_message_iter_close_container
argument_list|(
name|iter_dict_entry
argument_list|,
name|iter_dict_val
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|dbus_message_iter_close_container
argument_list|(
name|iter_dict
argument_list|,
name|iter_dict_entry
argument_list|)
condition|)
return|return
name|FALSE
return|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|dbus_bool_t
name|_wpa_dbus_add_dict_entry_basic
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|int
name|value_type
parameter_list|,
specifier|const
name|void
modifier|*
name|value
parameter_list|)
block|{
name|DBusMessageIter
name|iter_dict_entry
decl_stmt|,
name|iter_dict_val
decl_stmt|;
specifier|const
name|char
modifier|*
name|type_as_string
init|=
name|NULL
decl_stmt|;
name|type_as_string
operator|=
name|_wpa_get_type_as_string_from_type
argument_list|(
name|value_type
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|type_as_string
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|_wpa_dbus_add_dict_entry_start
argument_list|(
name|iter_dict
argument_list|,
operator|&
name|iter_dict_entry
argument_list|,
name|key
argument_list|,
name|value_type
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|dbus_message_iter_open_container
argument_list|(
operator|&
name|iter_dict_entry
argument_list|,
name|DBUS_TYPE_VARIANT
argument_list|,
name|type_as_string
argument_list|,
operator|&
name|iter_dict_val
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|dbus_message_iter_append_basic
argument_list|(
operator|&
name|iter_dict_val
argument_list|,
name|value_type
argument_list|,
name|value
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|_wpa_dbus_add_dict_entry_end
argument_list|(
name|iter_dict
argument_list|,
operator|&
name|iter_dict_entry
argument_list|,
operator|&
name|iter_dict_val
argument_list|)
condition|)
return|return
name|FALSE
return|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|dbus_bool_t
name|_wpa_dbus_add_dict_entry_byte_array
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|,
specifier|const
name|dbus_uint32_t
name|value_len
parameter_list|)
block|{
name|DBusMessageIter
name|iter_dict_entry
decl_stmt|,
name|iter_dict_val
decl_stmt|,
name|iter_array
decl_stmt|;
name|dbus_uint32_t
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|_wpa_dbus_add_dict_entry_start
argument_list|(
name|iter_dict
argument_list|,
operator|&
name|iter_dict_entry
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_ARRAY
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|dbus_message_iter_open_container
argument_list|(
argument|&iter_dict_entry
argument_list|,
argument|DBUS_TYPE_VARIANT
argument_list|,
argument|DBUS_TYPE_ARRAY_AS_STRING 					      DBUS_TYPE_BYTE_AS_STRING
argument_list|,
argument|&iter_dict_val
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|dbus_message_iter_open_container
argument_list|(
operator|&
name|iter_dict_val
argument_list|,
name|DBUS_TYPE_ARRAY
argument_list|,
name|DBUS_TYPE_BYTE_AS_STRING
argument_list|,
operator|&
name|iter_array
argument_list|)
condition|)
return|return
name|FALSE
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|value_len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|dbus_message_iter_append_basic
argument_list|(
operator|&
name|iter_array
argument_list|,
name|DBUS_TYPE_BYTE
argument_list|,
operator|&
operator|(
name|value
index|[
name|i
index|]
operator|)
argument_list|)
condition|)
return|return
name|FALSE
return|;
block|}
if|if
condition|(
operator|!
name|dbus_message_iter_close_container
argument_list|(
operator|&
name|iter_dict_val
argument_list|,
operator|&
name|iter_array
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|_wpa_dbus_add_dict_entry_end
argument_list|(
name|iter_dict
argument_list|,
operator|&
name|iter_dict_entry
argument_list|,
operator|&
name|iter_dict_val
argument_list|)
condition|)
return|return
name|FALSE
return|;
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/**  * Add a string entry to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The string value  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_string
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
operator|||
operator|!
name|value
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_basic
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_STRING
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Add a byte entry to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The byte value  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_byte
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|char
name|value
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_basic
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_BYTE
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Add a boolean entry to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The boolean value  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_bool
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|dbus_bool_t
name|value
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_basic
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_BOOLEAN
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Add a 16-bit signed integer entry to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The 16-bit signed integer value  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_int16
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|dbus_int16_t
name|value
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_basic
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_INT16
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Add a 16-bit unsigned integer entry to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The 16-bit unsigned integer value  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_uint16
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|dbus_uint16_t
name|value
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_basic
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_UINT16
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Add a 32-bit signed integer to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The 32-bit signed integer value  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_int32
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|dbus_int32_t
name|value
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_basic
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_INT32
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Add a 32-bit unsigned integer entry to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The 32-bit unsigned integer value  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_uint32
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|dbus_uint32_t
name|value
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_basic
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_UINT32
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Add a 64-bit integer entry to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The 64-bit integer value  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_int64
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|dbus_int64_t
name|value
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_basic
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_INT64
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Add a 64-bit unsigned integer entry to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The 64-bit unsigned integer value  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_uint64
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|dbus_uint64_t
name|value
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_basic
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_UINT64
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Add a double-precision floating point entry to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The double-precision floating point value  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_double
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|double
name|value
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_basic
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_DOUBLE
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Add a DBus object path entry to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The DBus object path value  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_object_path
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
operator|||
operator|!
name|value
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_basic
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_OBJECT_PATH
argument_list|,
operator|&
name|value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Add a byte array entry to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param value The byte array  * @param value_len The length of the byte array, in bytes  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_byte_array
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|,
specifier|const
name|dbus_uint32_t
name|value_len
parameter_list|)
block|{
if|if
condition|(
operator|!
name|key
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|value
operator|&&
operator|(
name|value_len
operator|!=
literal|0
operator|)
condition|)
return|return
name|FALSE
return|;
return|return
name|_wpa_dbus_add_dict_entry_byte_array
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
name|value
argument_list|,
name|value_len
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * Begin a string array entry in the dict  *  * @param iter_dict A valid DBusMessageIter returned from  *                  wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param iter_dict_entry A private DBusMessageIter provided by the caller to  *                        be passed to wpa_dbus_dict_end_string_array()  * @param iter_dict_val A private DBusMessageIter provided by the caller to  *                      be passed to wpa_dbus_dict_end_string_array()  * @param iter_array On return, the DBusMessageIter to be passed to  *                   wpa_dbus_dict_string_array_add_element()  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_begin_string_array
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_dict_entry
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_dict_val
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_array
parameter_list|)
block|{
if|if
condition|(
operator|!
name|iter_dict
operator|||
operator|!
name|iter_dict_entry
operator|||
operator|!
name|iter_dict_val
operator|||
operator|!
name|iter_array
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|_wpa_dbus_add_dict_entry_start
argument_list|(
name|iter_dict
argument_list|,
name|iter_dict_entry
argument_list|,
name|key
argument_list|,
name|DBUS_TYPE_ARRAY
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|dbus_message_iter_open_container
argument_list|(
argument|iter_dict_entry
argument_list|,
argument|DBUS_TYPE_VARIANT
argument_list|,
argument|DBUS_TYPE_ARRAY_AS_STRING 					      DBUS_TYPE_STRING_AS_STRING
argument_list|,
argument|iter_dict_val
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|dbus_message_iter_open_container
argument_list|(
name|iter_dict_val
argument_list|,
name|DBUS_TYPE_ARRAY
argument_list|,
name|DBUS_TYPE_BYTE_AS_STRING
argument_list|,
name|iter_array
argument_list|)
condition|)
return|return
name|FALSE
return|;
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/**  * Add a single string element to a string array dict entry  *  * @param iter_array A valid DBusMessageIter returned from  *                   wpa_dbus_dict_begin_string_array()'s  *                   iter_array parameter  * @param elem The string element to be added to the dict entry's string array  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_string_array_add_element
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_array
parameter_list|,
specifier|const
name|char
modifier|*
name|elem
parameter_list|)
block|{
if|if
condition|(
operator|!
name|iter_array
operator|||
operator|!
name|elem
condition|)
return|return
name|FALSE
return|;
return|return
name|dbus_message_iter_append_basic
argument_list|(
name|iter_array
argument_list|,
name|DBUS_TYPE_STRING
argument_list|,
operator|&
name|elem
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * End a string array dict entry  *  * @param iter_dict A valid DBusMessageIter returned from  *                  wpa_dbus_dict_open_write()  * @param iter_dict_entry A private DBusMessageIter returned from  *                        wpa_dbus_dict_end_string_array()  * @param iter_dict_val A private DBusMessageIter returned from  *                      wpa_dbus_dict_end_string_array()  * @param iter_array A DBusMessageIter returned from  *                   wpa_dbus_dict_end_string_array()  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_end_string_array
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_dict_entry
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_dict_val
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_array
parameter_list|)
block|{
if|if
condition|(
operator|!
name|iter_dict
operator|||
operator|!
name|iter_dict_entry
operator|||
operator|!
name|iter_dict_val
operator|||
operator|!
name|iter_array
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|dbus_message_iter_close_container
argument_list|(
name|iter_dict_val
argument_list|,
name|iter_array
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|_wpa_dbus_add_dict_entry_end
argument_list|(
name|iter_dict
argument_list|,
name|iter_dict_entry
argument_list|,
name|iter_dict_val
argument_list|)
condition|)
return|return
name|FALSE
return|;
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/**  * Convenience function to add an entire string array to the dict.  *  * @param iter_dict A valid DBusMessageIter returned from  *                  wpa_dbus_dict_open_write()  * @param key The key of the dict item  * @param items The array of strings  * @param num_items The number of strings in the array  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_append_string_array
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
specifier|const
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|items
parameter_list|,
specifier|const
name|dbus_uint32_t
name|num_items
parameter_list|)
block|{
name|DBusMessageIter
name|iter_dict_entry
decl_stmt|,
name|iter_dict_val
decl_stmt|,
name|iter_array
decl_stmt|;
name|dbus_uint32_t
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|key
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|items
operator|&&
operator|(
name|num_items
operator|!=
literal|0
operator|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|wpa_dbus_dict_begin_string_array
argument_list|(
name|iter_dict
argument_list|,
name|key
argument_list|,
operator|&
name|iter_dict_entry
argument_list|,
operator|&
name|iter_dict_val
argument_list|,
operator|&
name|iter_array
argument_list|)
condition|)
return|return
name|FALSE
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|wpa_dbus_dict_string_array_add_element
argument_list|(
operator|&
name|iter_array
argument_list|,
name|items
index|[
name|i
index|]
argument_list|)
condition|)
return|return
name|FALSE
return|;
block|}
if|if
condition|(
operator|!
name|wpa_dbus_dict_end_string_array
argument_list|(
name|iter_dict
argument_list|,
operator|&
name|iter_dict_entry
argument_list|,
operator|&
name|iter_dict_val
argument_list|,
operator|&
name|iter_array
argument_list|)
condition|)
return|return
name|FALSE
return|;
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/*****************************************************/
end_comment

begin_comment
comment|/* Stuff for reading dicts                           */
end_comment

begin_comment
comment|/*****************************************************/
end_comment

begin_comment
comment|/**  * Start reading from a dbus dict.  *  * @param iter A valid DBusMessageIter pointing to the start of the dict  * @param iter_dict (out) A DBusMessageIter to be passed to  *    wpa_dbus_dict_read_next_entry()  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_open_read
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|)
block|{
if|if
condition|(
operator|!
name|iter
operator|||
operator|!
name|iter_dict
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
name|dbus_message_iter_get_arg_type
argument_list|(
name|iter
argument_list|)
operator|!=
name|DBUS_TYPE_ARRAY
operator|||
name|dbus_message_iter_get_element_type
argument_list|(
name|iter
argument_list|)
operator|!=
name|DBUS_TYPE_DICT_ENTRY
condition|)
return|return
name|FALSE
return|;
name|dbus_message_iter_recurse
argument_list|(
name|iter
argument_list|,
name|iter_dict
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_define
define|#
directive|define
name|BYTE_ARRAY_CHUNK_SIZE
value|34
end_define

begin_define
define|#
directive|define
name|BYTE_ARRAY_ITEM_SIZE
value|(sizeof(char))
end_define

begin_function
specifier|static
name|dbus_bool_t
name|_wpa_dbus_dict_entry_get_byte_array
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter
parameter_list|,
name|int
name|array_type
parameter_list|,
name|struct
name|wpa_dbus_dict_entry
modifier|*
name|entry
parameter_list|)
block|{
name|dbus_uint32_t
name|count
init|=
literal|0
decl_stmt|;
name|dbus_bool_t
name|success
init|=
name|FALSE
decl_stmt|;
name|char
modifier|*
name|buffer
decl_stmt|;
name|entry
operator|->
name|bytearray_value
operator|=
name|NULL
expr_stmt|;
name|entry
operator|->
name|array_type
operator|=
name|DBUS_TYPE_BYTE
expr_stmt|;
name|buffer
operator|=
name|os_zalloc
argument_list|(
name|BYTE_ARRAY_ITEM_SIZE
operator|*
name|BYTE_ARRAY_CHUNK_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|buffer
condition|)
block|{
name|perror
argument_list|(
literal|"_wpa_dbus_dict_entry_get_byte_array[dbus]: out of "
literal|"memory"
argument_list|)
expr_stmt|;
goto|goto
name|done
goto|;
block|}
name|entry
operator|->
name|bytearray_value
operator|=
name|buffer
expr_stmt|;
name|entry
operator|->
name|array_len
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|dbus_message_iter_get_arg_type
argument_list|(
name|iter
argument_list|)
operator|==
name|DBUS_TYPE_BYTE
condition|)
block|{
name|char
name|byte
decl_stmt|;
if|if
condition|(
operator|(
name|count
operator|%
name|BYTE_ARRAY_CHUNK_SIZE
operator|)
operator|==
literal|0
operator|&&
name|count
operator|!=
literal|0
condition|)
block|{
name|buffer
operator|=
name|realloc
argument_list|(
name|buffer
argument_list|,
name|BYTE_ARRAY_ITEM_SIZE
operator|*
operator|(
name|count
operator|+
name|BYTE_ARRAY_CHUNK_SIZE
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buffer
operator|==
name|NULL
condition|)
block|{
name|perror
argument_list|(
literal|"_wpa_dbus_dict_entry_get_byte_array["
literal|"dbus] out of memory trying to "
literal|"retrieve the string array"
argument_list|)
expr_stmt|;
goto|goto
name|done
goto|;
block|}
block|}
name|entry
operator|->
name|bytearray_value
operator|=
name|buffer
expr_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter
argument_list|,
operator|&
name|byte
argument_list|)
expr_stmt|;
name|entry
operator|->
name|bytearray_value
index|[
name|count
index|]
operator|=
name|byte
expr_stmt|;
name|entry
operator|->
name|array_len
operator|=
operator|++
name|count
expr_stmt|;
name|dbus_message_iter_next
argument_list|(
name|iter
argument_list|)
expr_stmt|;
block|}
comment|/* Zero-length arrays are valid. */
if|if
condition|(
name|entry
operator|->
name|array_len
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|entry
operator|->
name|bytearray_value
argument_list|)
expr_stmt|;
name|entry
operator|->
name|bytearray_value
operator|=
name|NULL
expr_stmt|;
block|}
name|success
operator|=
name|TRUE
expr_stmt|;
name|done
label|:
return|return
name|success
return|;
block|}
end_function

begin_define
define|#
directive|define
name|STR_ARRAY_CHUNK_SIZE
value|8
end_define

begin_define
define|#
directive|define
name|STR_ARRAY_ITEM_SIZE
value|(sizeof(char *))
end_define

begin_function
specifier|static
name|dbus_bool_t
name|_wpa_dbus_dict_entry_get_string_array
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter
parameter_list|,
name|int
name|array_type
parameter_list|,
name|struct
name|wpa_dbus_dict_entry
modifier|*
name|entry
parameter_list|)
block|{
name|dbus_uint32_t
name|count
init|=
literal|0
decl_stmt|;
name|dbus_bool_t
name|success
init|=
name|FALSE
decl_stmt|;
name|char
modifier|*
modifier|*
name|buffer
decl_stmt|;
name|entry
operator|->
name|strarray_value
operator|=
name|NULL
expr_stmt|;
name|entry
operator|->
name|array_type
operator|=
name|DBUS_TYPE_STRING
expr_stmt|;
name|buffer
operator|=
name|os_zalloc
argument_list|(
name|STR_ARRAY_ITEM_SIZE
operator|*
name|STR_ARRAY_CHUNK_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|buffer
operator|==
name|NULL
condition|)
block|{
name|perror
argument_list|(
literal|"_wpa_dbus_dict_entry_get_string_array[dbus] out of "
literal|"memory trying to retrieve a string array"
argument_list|)
expr_stmt|;
goto|goto
name|done
goto|;
block|}
name|entry
operator|->
name|strarray_value
operator|=
name|buffer
expr_stmt|;
name|entry
operator|->
name|array_len
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|dbus_message_iter_get_arg_type
argument_list|(
name|iter
argument_list|)
operator|==
name|DBUS_TYPE_STRING
condition|)
block|{
specifier|const
name|char
modifier|*
name|value
decl_stmt|;
name|char
modifier|*
name|str
decl_stmt|;
if|if
condition|(
operator|(
name|count
operator|%
name|STR_ARRAY_CHUNK_SIZE
operator|)
operator|==
literal|0
operator|&&
name|count
operator|!=
literal|0
condition|)
block|{
name|buffer
operator|=
name|realloc
argument_list|(
name|buffer
argument_list|,
name|STR_ARRAY_ITEM_SIZE
operator|*
operator|(
name|count
operator|+
name|STR_ARRAY_CHUNK_SIZE
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buffer
operator|==
name|NULL
condition|)
block|{
name|perror
argument_list|(
literal|"_wpa_dbus_dict_entry_get_string_array["
literal|"dbus] out of memory trying to "
literal|"retrieve the string array"
argument_list|)
expr_stmt|;
goto|goto
name|done
goto|;
block|}
block|}
name|entry
operator|->
name|strarray_value
operator|=
name|buffer
expr_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter
argument_list|,
operator|&
name|value
argument_list|)
expr_stmt|;
name|str
operator|=
name|strdup
argument_list|(
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|str
operator|==
name|NULL
condition|)
block|{
name|perror
argument_list|(
literal|"_wpa_dbus_dict_entry_get_string_array[dbus] "
literal|"out of memory trying to duplicate the string "
literal|"array"
argument_list|)
expr_stmt|;
goto|goto
name|done
goto|;
block|}
name|entry
operator|->
name|strarray_value
index|[
name|count
index|]
operator|=
name|str
expr_stmt|;
name|entry
operator|->
name|array_len
operator|=
operator|++
name|count
expr_stmt|;
name|dbus_message_iter_next
argument_list|(
name|iter
argument_list|)
expr_stmt|;
block|}
comment|/* Zero-length arrays are valid. */
if|if
condition|(
name|entry
operator|->
name|array_len
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|entry
operator|->
name|strarray_value
argument_list|)
expr_stmt|;
name|entry
operator|->
name|strarray_value
operator|=
name|NULL
expr_stmt|;
block|}
name|success
operator|=
name|TRUE
expr_stmt|;
name|done
label|:
return|return
name|success
return|;
block|}
end_function

begin_function
specifier|static
name|dbus_bool_t
name|_wpa_dbus_dict_entry_get_array
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict_val
parameter_list|,
name|struct
name|wpa_dbus_dict_entry
modifier|*
name|entry
parameter_list|)
block|{
name|int
name|array_type
init|=
name|dbus_message_iter_get_element_type
argument_list|(
name|iter_dict_val
argument_list|)
decl_stmt|;
name|dbus_bool_t
name|success
init|=
name|FALSE
decl_stmt|;
name|DBusMessageIter
name|iter_array
decl_stmt|;
if|if
condition|(
operator|!
name|entry
condition|)
return|return
name|FALSE
return|;
name|dbus_message_iter_recurse
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|iter_array
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|array_type
condition|)
block|{
case|case
name|DBUS_TYPE_BYTE
case|:
name|success
operator|=
name|_wpa_dbus_dict_entry_get_byte_array
argument_list|(
operator|&
name|iter_array
argument_list|,
name|array_type
argument_list|,
name|entry
argument_list|)
expr_stmt|;
break|break;
case|case
name|DBUS_TYPE_STRING
case|:
name|success
operator|=
name|_wpa_dbus_dict_entry_get_string_array
argument_list|(
operator|&
name|iter_array
argument_list|,
name|array_type
argument_list|,
name|entry
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
name|success
return|;
block|}
end_function

begin_function
specifier|static
name|dbus_bool_t
name|_wpa_dbus_dict_fill_value_from_variant
parameter_list|(
name|struct
name|wpa_dbus_dict_entry
modifier|*
name|entry
parameter_list|,
name|DBusMessageIter
modifier|*
name|iter_dict_val
parameter_list|)
block|{
name|dbus_bool_t
name|success
init|=
name|TRUE
decl_stmt|;
switch|switch
condition|(
name|entry
operator|->
name|type
condition|)
block|{
case|case
name|DBUS_TYPE_STRING
case|:
block|{
specifier|const
name|char
modifier|*
name|v
decl_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|entry
operator|->
name|str_value
operator|=
name|strdup
argument_list|(
name|v
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|DBUS_TYPE_BOOLEAN
case|:
block|{
name|dbus_bool_t
name|v
decl_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|entry
operator|->
name|bool_value
operator|=
name|v
expr_stmt|;
break|break;
block|}
case|case
name|DBUS_TYPE_BYTE
case|:
block|{
name|char
name|v
decl_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|entry
operator|->
name|byte_value
operator|=
name|v
expr_stmt|;
break|break;
block|}
case|case
name|DBUS_TYPE_INT16
case|:
block|{
name|dbus_int16_t
name|v
decl_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|entry
operator|->
name|int16_value
operator|=
name|v
expr_stmt|;
break|break;
block|}
case|case
name|DBUS_TYPE_UINT16
case|:
block|{
name|dbus_uint16_t
name|v
decl_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|entry
operator|->
name|uint16_value
operator|=
name|v
expr_stmt|;
break|break;
block|}
case|case
name|DBUS_TYPE_INT32
case|:
block|{
name|dbus_int32_t
name|v
decl_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|entry
operator|->
name|int32_value
operator|=
name|v
expr_stmt|;
break|break;
block|}
case|case
name|DBUS_TYPE_UINT32
case|:
block|{
name|dbus_uint32_t
name|v
decl_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|entry
operator|->
name|uint32_value
operator|=
name|v
expr_stmt|;
break|break;
block|}
case|case
name|DBUS_TYPE_INT64
case|:
block|{
name|dbus_int64_t
name|v
decl_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|entry
operator|->
name|int64_value
operator|=
name|v
expr_stmt|;
break|break;
block|}
case|case
name|DBUS_TYPE_UINT64
case|:
block|{
name|dbus_uint64_t
name|v
decl_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|entry
operator|->
name|uint64_value
operator|=
name|v
expr_stmt|;
break|break;
block|}
case|case
name|DBUS_TYPE_DOUBLE
case|:
block|{
name|double
name|v
decl_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|entry
operator|->
name|double_value
operator|=
name|v
expr_stmt|;
break|break;
block|}
case|case
name|DBUS_TYPE_OBJECT_PATH
case|:
block|{
name|char
modifier|*
name|v
decl_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
name|iter_dict_val
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|entry
operator|->
name|str_value
operator|=
name|strdup
argument_list|(
name|v
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|DBUS_TYPE_ARRAY
case|:
block|{
name|success
operator|=
name|_wpa_dbus_dict_entry_get_array
argument_list|(
name|iter_dict_val
argument_list|,
name|entry
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
name|success
operator|=
name|FALSE
expr_stmt|;
break|break;
block|}
return|return
name|success
return|;
block|}
end_function

begin_comment
comment|/**  * Read the current key/value entry from the dict.  Entries are dynamically  * allocated when needed and must be freed after use with the  * wpa_dbus_dict_entry_clear() function.  *  * The returned entry object will be filled with the type and value of the next  * entry in the dict, or the type will be DBUS_TYPE_INVALID if an error  * occurred.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_read()  * @param entry A valid dict entry object into which the dict key and value  *    will be placed  * @return TRUE on success, FALSE on failure  *  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_get_entry
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|,
name|struct
name|wpa_dbus_dict_entry
modifier|*
name|entry
parameter_list|)
block|{
name|DBusMessageIter
name|iter_dict_entry
decl_stmt|,
name|iter_dict_val
decl_stmt|;
name|int
name|type
decl_stmt|;
specifier|const
name|char
modifier|*
name|key
decl_stmt|;
if|if
condition|(
operator|!
name|iter_dict
operator|||
operator|!
name|entry
condition|)
goto|goto
name|error
goto|;
if|if
condition|(
name|dbus_message_iter_get_arg_type
argument_list|(
name|iter_dict
argument_list|)
operator|!=
name|DBUS_TYPE_DICT_ENTRY
condition|)
goto|goto
name|error
goto|;
name|dbus_message_iter_recurse
argument_list|(
name|iter_dict
argument_list|,
operator|&
name|iter_dict_entry
argument_list|)
expr_stmt|;
name|dbus_message_iter_get_basic
argument_list|(
operator|&
name|iter_dict_entry
argument_list|,
operator|&
name|key
argument_list|)
expr_stmt|;
name|entry
operator|->
name|key
operator|=
name|key
expr_stmt|;
if|if
condition|(
operator|!
name|dbus_message_iter_next
argument_list|(
operator|&
name|iter_dict_entry
argument_list|)
condition|)
goto|goto
name|error
goto|;
name|type
operator|=
name|dbus_message_iter_get_arg_type
argument_list|(
operator|&
name|iter_dict_entry
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|!=
name|DBUS_TYPE_VARIANT
condition|)
goto|goto
name|error
goto|;
name|dbus_message_iter_recurse
argument_list|(
operator|&
name|iter_dict_entry
argument_list|,
operator|&
name|iter_dict_val
argument_list|)
expr_stmt|;
name|entry
operator|->
name|type
operator|=
name|dbus_message_iter_get_arg_type
argument_list|(
operator|&
name|iter_dict_val
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|_wpa_dbus_dict_fill_value_from_variant
argument_list|(
name|entry
argument_list|,
operator|&
name|iter_dict_val
argument_list|)
condition|)
goto|goto
name|error
goto|;
name|dbus_message_iter_next
argument_list|(
name|iter_dict
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
name|error
label|:
if|if
condition|(
name|entry
condition|)
block|{
name|wpa_dbus_dict_entry_clear
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|entry
operator|->
name|type
operator|=
name|DBUS_TYPE_INVALID
expr_stmt|;
name|entry
operator|->
name|array_type
operator|=
name|DBUS_TYPE_INVALID
expr_stmt|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/**  * Return whether or not there are additional dictionary entries.  *  * @param iter_dict A valid DBusMessageIter returned from  *    wpa_dbus_dict_open_read()  * @return TRUE if more dict entries exists, FALSE if no more dict entries  * exist  */
end_comment

begin_function
name|dbus_bool_t
name|wpa_dbus_dict_has_dict_entry
parameter_list|(
name|DBusMessageIter
modifier|*
name|iter_dict
parameter_list|)
block|{
if|if
condition|(
operator|!
name|iter_dict
condition|)
block|{
name|perror
argument_list|(
literal|"wpa_dbus_dict_has_dict_entry[dbus]: out of memory"
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
return|return
name|dbus_message_iter_get_arg_type
argument_list|(
name|iter_dict
argument_list|)
operator|==
name|DBUS_TYPE_DICT_ENTRY
return|;
block|}
end_function

begin_comment
comment|/**  * Free any memory used by the entry object.  *  * @param entry The entry object  */
end_comment

begin_function
name|void
name|wpa_dbus_dict_entry_clear
parameter_list|(
name|struct
name|wpa_dbus_dict_entry
modifier|*
name|entry
parameter_list|)
block|{
name|unsigned
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|entry
condition|)
return|return;
switch|switch
condition|(
name|entry
operator|->
name|type
condition|)
block|{
case|case
name|DBUS_TYPE_OBJECT_PATH
case|:
case|case
name|DBUS_TYPE_STRING
case|:
name|free
argument_list|(
name|entry
operator|->
name|str_value
argument_list|)
expr_stmt|;
break|break;
case|case
name|DBUS_TYPE_ARRAY
case|:
switch|switch
condition|(
name|entry
operator|->
name|array_type
condition|)
block|{
case|case
name|DBUS_TYPE_BYTE
case|:
name|free
argument_list|(
name|entry
operator|->
name|bytearray_value
argument_list|)
expr_stmt|;
break|break;
case|case
name|DBUS_TYPE_STRING
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|entry
operator|->
name|array_len
condition|;
name|i
operator|++
control|)
name|free
argument_list|(
name|entry
operator|->
name|strarray_value
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|entry
operator|->
name|strarray_value
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
block|}
name|memset
argument_list|(
name|entry
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|wpa_dbus_dict_entry
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

