begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * WPA Supplicant - Scanning  * Copyright (c) 2003-2010, Jouni Malinen<j@w1.fi>  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License version 2 as  * published by the Free Software Foundation.  *  * Alternatively, this software may be distributed under the terms of BSD  * license.  *  * See README and COPYING for more details.  */
end_comment

begin_include
include|#
directive|include
file|"utils/includes.h"
end_include

begin_include
include|#
directive|include
file|"utils/common.h"
end_include

begin_include
include|#
directive|include
file|"utils/eloop.h"
end_include

begin_include
include|#
directive|include
file|"common/ieee802_11_defs.h"
end_include

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"wpa_supplicant_i.h"
end_include

begin_include
include|#
directive|include
file|"driver_i.h"
end_include

begin_include
include|#
directive|include
file|"mlme.h"
end_include

begin_include
include|#
directive|include
file|"wps_supplicant.h"
end_include

begin_include
include|#
directive|include
file|"notify.h"
end_include

begin_include
include|#
directive|include
file|"bss.h"
end_include

begin_include
include|#
directive|include
file|"scan.h"
end_include

begin_function
specifier|static
name|void
name|wpa_supplicant_gen_assoc_event
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|)
block|{
name|struct
name|wpa_ssid
modifier|*
name|ssid
decl_stmt|;
name|union
name|wpa_event_data
name|data
decl_stmt|;
name|ssid
operator|=
name|wpa_supplicant_get_ssid
argument_list|(
name|wpa_s
argument_list|)
expr_stmt|;
if|if
condition|(
name|ssid
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|wpa_s
operator|->
name|current_ssid
operator|==
name|NULL
condition|)
block|{
name|wpa_s
operator|->
name|current_ssid
operator|=
name|ssid
expr_stmt|;
if|if
condition|(
name|wpa_s
operator|->
name|current_ssid
operator|!=
name|NULL
condition|)
name|wpas_notify_network_changed
argument_list|(
name|wpa_s
argument_list|)
expr_stmt|;
block|}
name|wpa_supplicant_initiate_eapol
argument_list|(
name|wpa_s
argument_list|)
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Already associated with a configured network - "
literal|"generating associated event"
argument_list|)
expr_stmt|;
name|os_memset
argument_list|(
operator|&
name|data
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|wpa_supplicant_event
argument_list|(
name|wpa_s
argument_list|,
name|EVENT_ASSOC
argument_list|,
operator|&
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_WPS
end_ifdef

begin_function
specifier|static
name|int
name|wpas_wps_in_use
parameter_list|(
name|struct
name|wpa_config
modifier|*
name|conf
parameter_list|,
name|enum
name|wps_request_type
modifier|*
name|req_type
parameter_list|)
block|{
name|struct
name|wpa_ssid
modifier|*
name|ssid
decl_stmt|;
name|int
name|wps
init|=
literal|0
decl_stmt|;
for|for
control|(
name|ssid
operator|=
name|conf
operator|->
name|ssid
init|;
name|ssid
condition|;
name|ssid
operator|=
name|ssid
operator|->
name|next
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|ssid
operator|->
name|key_mgmt
operator|&
name|WPA_KEY_MGMT_WPS
operator|)
condition|)
continue|continue;
name|wps
operator|=
literal|1
expr_stmt|;
operator|*
name|req_type
operator|=
name|wpas_wps_get_req_type
argument_list|(
name|ssid
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ssid
operator|->
name|eap
operator|.
name|phase1
condition|)
continue|continue;
if|if
condition|(
name|os_strstr
argument_list|(
name|ssid
operator|->
name|eap
operator|.
name|phase1
argument_list|,
literal|"pbc=1"
argument_list|)
condition|)
return|return
literal|2
return|;
block|}
return|return
name|wps
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_WPS */
end_comment

begin_function
name|int
name|wpa_supplicant_enabled_networks
parameter_list|(
name|struct
name|wpa_config
modifier|*
name|conf
parameter_list|)
block|{
name|struct
name|wpa_ssid
modifier|*
name|ssid
init|=
name|conf
operator|->
name|ssid
decl_stmt|;
while|while
condition|(
name|ssid
condition|)
block|{
if|if
condition|(
operator|!
name|ssid
operator|->
name|disabled
condition|)
return|return
literal|1
return|;
name|ssid
operator|=
name|ssid
operator|->
name|next
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wpa_supplicant_assoc_try
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
while|while
condition|(
name|ssid
condition|)
block|{
if|if
condition|(
operator|!
name|ssid
operator|->
name|disabled
condition|)
break|break;
name|ssid
operator|=
name|ssid
operator|->
name|next
expr_stmt|;
block|}
comment|/* ap_scan=2 mode - try to associate with each SSID. */
if|if
condition|(
name|ssid
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"wpa_supplicant_scan: Reached "
literal|"end of scan list - go back to beginning"
argument_list|)
expr_stmt|;
name|wpa_s
operator|->
name|prev_scan_ssid
operator|=
name|WILDCARD_SSID_SCAN
expr_stmt|;
name|wpa_supplicant_req_scan
argument_list|(
name|wpa_s
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|ssid
operator|->
name|next
condition|)
block|{
comment|/* Continue from the next SSID on the next attempt. */
name|wpa_s
operator|->
name|prev_scan_ssid
operator|=
name|ssid
expr_stmt|;
block|}
else|else
block|{
comment|/* Start from the beginning of the SSID list. */
name|wpa_s
operator|->
name|prev_scan_ssid
operator|=
name|WILDCARD_SSID_SCAN
expr_stmt|;
block|}
name|wpa_supplicant_associate
argument_list|(
name|wpa_s
argument_list|,
name|NULL
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|int_array_len
parameter_list|(
specifier|const
name|int
modifier|*
name|a
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|a
operator|&&
name|a
index|[
name|i
index|]
condition|;
name|i
operator|++
control|)
empty_stmt|;
return|return
name|i
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|int_array_concat
parameter_list|(
name|int
modifier|*
modifier|*
name|res
parameter_list|,
specifier|const
name|int
modifier|*
name|a
parameter_list|)
block|{
name|int
name|reslen
decl_stmt|,
name|alen
decl_stmt|,
name|i
decl_stmt|;
name|int
modifier|*
name|n
decl_stmt|;
name|reslen
operator|=
name|int_array_len
argument_list|(
operator|*
name|res
argument_list|)
expr_stmt|;
name|alen
operator|=
name|int_array_len
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|n
operator|=
name|os_realloc
argument_list|(
operator|*
name|res
argument_list|,
operator|(
name|reslen
operator|+
name|alen
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|==
name|NULL
condition|)
block|{
name|os_free
argument_list|(
operator|*
name|res
argument_list|)
expr_stmt|;
operator|*
name|res
operator|=
name|NULL
expr_stmt|;
return|return;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|alen
condition|;
name|i
operator|++
control|)
name|n
index|[
name|reslen
operator|+
name|i
index|]
operator|=
name|a
index|[
name|i
index|]
expr_stmt|;
operator|*
name|res
operator|=
name|n
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|freq_cmp
parameter_list|(
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|b
parameter_list|)
block|{
name|int
name|_a
init|=
operator|*
operator|(
name|int
operator|*
operator|)
name|a
decl_stmt|;
name|int
name|_b
init|=
operator|*
operator|(
name|int
operator|*
operator|)
name|b
decl_stmt|;
if|if
condition|(
name|_a
operator|==
literal|0
condition|)
return|return
literal|1
return|;
if|if
condition|(
name|_b
operator|==
literal|0
condition|)
return|return
operator|-
literal|1
return|;
return|return
name|_a
operator|-
name|_b
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|int_array_sort_unique
parameter_list|(
name|int
modifier|*
name|a
parameter_list|)
block|{
name|int
name|alen
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
if|if
condition|(
name|a
operator|==
name|NULL
condition|)
return|return;
name|alen
operator|=
name|int_array_len
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|qsort
argument_list|(
name|a
argument_list|,
name|alen
argument_list|,
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|,
name|freq_cmp
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|a
index|[
name|i
index|]
operator|&&
name|a
index|[
name|j
index|]
condition|)
block|{
if|if
condition|(
name|a
index|[
name|i
index|]
operator|==
name|a
index|[
name|j
index|]
condition|)
block|{
name|j
operator|++
expr_stmt|;
continue|continue;
block|}
name|a
index|[
operator|++
name|i
index|]
operator|=
name|a
index|[
name|j
operator|++
index|]
expr_stmt|;
block|}
if|if
condition|(
name|a
index|[
name|i
index|]
condition|)
name|i
operator|++
expr_stmt|;
name|a
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
name|int
name|wpa_supplicant_trigger_scan
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|,
name|struct
name|wpa_driver_scan_params
modifier|*
name|params
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|wpa_supplicant_notify_scanning
argument_list|(
name|wpa_s
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|wpa_s
operator|->
name|drv_flags
operator|&
name|WPA_DRIVER_FLAGS_USER_SPACE_MLME
condition|)
name|ret
operator|=
name|ieee80211_sta_req_scan
argument_list|(
name|wpa_s
argument_list|,
name|params
argument_list|)
expr_stmt|;
else|else
name|ret
operator|=
name|wpa_drv_scan
argument_list|(
name|wpa_s
argument_list|,
name|params
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
block|{
name|wpa_supplicant_notify_scanning
argument_list|(
name|wpa_s
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wpas_notify_scan_done
argument_list|(
name|wpa_s
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
name|wpa_s
operator|->
name|scan_runs
operator|++
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wpa_driver_scan_filter
modifier|*
name|wpa_supplicant_build_filter_ssids
parameter_list|(
name|struct
name|wpa_config
modifier|*
name|conf
parameter_list|,
name|size_t
modifier|*
name|num_ssids
parameter_list|)
block|{
name|struct
name|wpa_driver_scan_filter
modifier|*
name|ssids
decl_stmt|;
name|struct
name|wpa_ssid
modifier|*
name|ssid
decl_stmt|;
name|size_t
name|count
decl_stmt|;
operator|*
name|num_ssids
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|conf
operator|->
name|filter_ssids
condition|)
return|return
name|NULL
return|;
for|for
control|(
name|count
operator|=
literal|0
operator|,
name|ssid
operator|=
name|conf
operator|->
name|ssid
init|;
name|ssid
condition|;
name|ssid
operator|=
name|ssid
operator|->
name|next
control|)
block|{
if|if
condition|(
name|ssid
operator|->
name|ssid
operator|&&
name|ssid
operator|->
name|ssid_len
condition|)
name|count
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|count
operator|==
literal|0
condition|)
return|return
name|NULL
return|;
name|ssids
operator|=
name|os_zalloc
argument_list|(
name|count
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|wpa_driver_scan_filter
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ssids
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
for|for
control|(
name|ssid
operator|=
name|conf
operator|->
name|ssid
init|;
name|ssid
condition|;
name|ssid
operator|=
name|ssid
operator|->
name|next
control|)
block|{
if|if
condition|(
operator|!
name|ssid
operator|->
name|ssid
operator|||
operator|!
name|ssid
operator|->
name|ssid_len
condition|)
continue|continue;
name|os_memcpy
argument_list|(
name|ssids
index|[
operator|*
name|num_ssids
index|]
operator|.
name|ssid
argument_list|,
name|ssid
operator|->
name|ssid
argument_list|,
name|ssid
operator|->
name|ssid_len
argument_list|)
expr_stmt|;
name|ssids
index|[
operator|*
name|num_ssids
index|]
operator|.
name|ssid_len
operator|=
name|ssid
operator|->
name|ssid_len
expr_stmt|;
operator|(
operator|*
name|num_ssids
operator|)
operator|++
expr_stmt|;
block|}
return|return
name|ssids
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wpa_supplicant_scan
parameter_list|(
name|void
modifier|*
name|eloop_ctx
parameter_list|,
name|void
modifier|*
name|timeout_ctx
parameter_list|)
block|{
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
init|=
name|eloop_ctx
decl_stmt|;
name|struct
name|wpa_ssid
modifier|*
name|ssid
decl_stmt|;
name|int
name|scan_req
init|=
literal|0
decl_stmt|,
name|ret
decl_stmt|;
name|struct
name|wpabuf
modifier|*
name|wps_ie
init|=
name|NULL
decl_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_WPS
name|int
name|wps
init|=
literal|0
decl_stmt|;
name|enum
name|wps_request_type
name|req_type
init|=
name|WPS_REQ_ENROLLEE_INFO
decl_stmt|;
endif|#
directive|endif
comment|/* CONFIG_WPS */
name|struct
name|wpa_driver_scan_params
name|params
decl_stmt|;
name|size_t
name|max_ssids
decl_stmt|;
name|enum
name|wpa_states
name|prev_state
decl_stmt|;
if|if
condition|(
name|wpa_s
operator|->
name|disconnected
operator|&&
operator|!
name|wpa_s
operator|->
name|scan_req
condition|)
block|{
name|wpa_supplicant_set_state
argument_list|(
name|wpa_s
argument_list|,
name|WPA_DISCONNECTED
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|wpa_supplicant_enabled_networks
argument_list|(
name|wpa_s
operator|->
name|conf
argument_list|)
operator|&&
operator|!
name|wpa_s
operator|->
name|scan_req
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"No enabled networks - do not scan"
argument_list|)
expr_stmt|;
name|wpa_supplicant_set_state
argument_list|(
name|wpa_s
argument_list|,
name|WPA_INACTIVE
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|wpa_s
operator|->
name|conf
operator|->
name|ap_scan
operator|!=
literal|0
operator|&&
operator|(
name|wpa_s
operator|->
name|drv_flags
operator|&
name|WPA_DRIVER_FLAGS_WIRED
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Using wired authentication - "
literal|"overriding ap_scan configuration"
argument_list|)
expr_stmt|;
name|wpa_s
operator|->
name|conf
operator|->
name|ap_scan
operator|=
literal|0
expr_stmt|;
name|wpas_notify_ap_scan_changed
argument_list|(
name|wpa_s
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|wpa_s
operator|->
name|conf
operator|->
name|ap_scan
operator|==
literal|0
condition|)
block|{
name|wpa_supplicant_gen_assoc_event
argument_list|(
name|wpa_s
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|(
name|wpa_s
operator|->
name|drv_flags
operator|&
name|WPA_DRIVER_FLAGS_USER_SPACE_MLME
operator|)
operator|||
name|wpa_s
operator|->
name|conf
operator|->
name|ap_scan
operator|==
literal|2
condition|)
name|max_ssids
operator|=
literal|1
expr_stmt|;
else|else
block|{
name|max_ssids
operator|=
name|wpa_s
operator|->
name|max_scan_ssids
expr_stmt|;
if|if
condition|(
name|max_ssids
operator|>
name|WPAS_MAX_SCAN_SSIDS
condition|)
name|max_ssids
operator|=
name|WPAS_MAX_SCAN_SSIDS
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|CONFIG_WPS
name|wps
operator|=
name|wpas_wps_in_use
argument_list|(
name|wpa_s
operator|->
name|conf
argument_list|,
operator|&
name|req_type
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_WPS */
name|scan_req
operator|=
name|wpa_s
operator|->
name|scan_req
expr_stmt|;
name|wpa_s
operator|->
name|scan_req
operator|=
literal|0
expr_stmt|;
name|os_memset
argument_list|(
operator|&
name|params
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|params
argument_list|)
argument_list|)
expr_stmt|;
name|prev_state
operator|=
name|wpa_s
operator|->
name|wpa_state
expr_stmt|;
if|if
condition|(
name|wpa_s
operator|->
name|wpa_state
operator|==
name|WPA_DISCONNECTED
operator|||
name|wpa_s
operator|->
name|wpa_state
operator|==
name|WPA_INACTIVE
condition|)
name|wpa_supplicant_set_state
argument_list|(
name|wpa_s
argument_list|,
name|WPA_SCANNING
argument_list|)
expr_stmt|;
comment|/* Find the starting point from which to continue scanning */
name|ssid
operator|=
name|wpa_s
operator|->
name|conf
operator|->
name|ssid
expr_stmt|;
if|if
condition|(
name|wpa_s
operator|->
name|prev_scan_ssid
operator|!=
name|WILDCARD_SSID_SCAN
condition|)
block|{
while|while
condition|(
name|ssid
condition|)
block|{
if|if
condition|(
name|ssid
operator|==
name|wpa_s
operator|->
name|prev_scan_ssid
condition|)
block|{
name|ssid
operator|=
name|ssid
operator|->
name|next
expr_stmt|;
break|break;
block|}
name|ssid
operator|=
name|ssid
operator|->
name|next
expr_stmt|;
block|}
block|}
if|if
condition|(
name|scan_req
operator|!=
literal|2
operator|&&
operator|(
name|wpa_s
operator|->
name|conf
operator|->
name|ap_scan
operator|==
literal|2
operator|||
name|wpa_s
operator|->
name|connect_without_scan
operator|)
condition|)
block|{
name|wpa_s
operator|->
name|connect_without_scan
operator|=
literal|0
expr_stmt|;
name|wpa_supplicant_assoc_try
argument_list|(
name|wpa_s
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
return|return;
block|}
elseif|else
if|if
condition|(
name|wpa_s
operator|->
name|conf
operator|->
name|ap_scan
operator|==
literal|2
condition|)
block|{
comment|/* 		 * User-initiated scan request in ap_scan == 2; scan with 		 * wildcard SSID. 		 */
name|ssid
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
name|struct
name|wpa_ssid
modifier|*
name|start
init|=
name|ssid
decl_stmt|,
modifier|*
name|tssid
decl_stmt|;
name|int
name|freqs_set
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|ssid
operator|==
name|NULL
operator|&&
name|max_ssids
operator|>
literal|1
condition|)
name|ssid
operator|=
name|wpa_s
operator|->
name|conf
operator|->
name|ssid
expr_stmt|;
while|while
condition|(
name|ssid
condition|)
block|{
if|if
condition|(
operator|!
name|ssid
operator|->
name|disabled
operator|&&
name|ssid
operator|->
name|scan_ssid
condition|)
block|{
name|wpa_hexdump_ascii
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Scan SSID"
argument_list|,
name|ssid
operator|->
name|ssid
argument_list|,
name|ssid
operator|->
name|ssid_len
argument_list|)
expr_stmt|;
name|params
operator|.
name|ssids
index|[
name|params
operator|.
name|num_ssids
index|]
operator|.
name|ssid
operator|=
name|ssid
operator|->
name|ssid
expr_stmt|;
name|params
operator|.
name|ssids
index|[
name|params
operator|.
name|num_ssids
index|]
operator|.
name|ssid_len
operator|=
name|ssid
operator|->
name|ssid_len
expr_stmt|;
name|params
operator|.
name|num_ssids
operator|++
expr_stmt|;
if|if
condition|(
name|params
operator|.
name|num_ssids
operator|+
literal|1
operator|>=
name|max_ssids
condition|)
break|break;
block|}
name|ssid
operator|=
name|ssid
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|ssid
operator|==
name|start
condition|)
break|break;
if|if
condition|(
name|ssid
operator|==
name|NULL
operator|&&
name|max_ssids
operator|>
literal|1
operator|&&
name|start
operator|!=
name|wpa_s
operator|->
name|conf
operator|->
name|ssid
condition|)
name|ssid
operator|=
name|wpa_s
operator|->
name|conf
operator|->
name|ssid
expr_stmt|;
block|}
for|for
control|(
name|tssid
operator|=
name|wpa_s
operator|->
name|conf
operator|->
name|ssid
init|;
name|tssid
condition|;
name|tssid
operator|=
name|tssid
operator|->
name|next
control|)
block|{
if|if
condition|(
name|tssid
operator|->
name|disabled
condition|)
continue|continue;
if|if
condition|(
operator|(
name|params
operator|.
name|freqs
operator|||
operator|!
name|freqs_set
operator|)
operator|&&
name|tssid
operator|->
name|scan_freq
condition|)
block|{
name|int_array_concat
argument_list|(
operator|&
name|params
operator|.
name|freqs
argument_list|,
name|tssid
operator|->
name|scan_freq
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|os_free
argument_list|(
name|params
operator|.
name|freqs
argument_list|)
expr_stmt|;
name|params
operator|.
name|freqs
operator|=
name|NULL
expr_stmt|;
block|}
name|freqs_set
operator|=
literal|1
expr_stmt|;
block|}
name|int_array_sort_unique
argument_list|(
name|params
operator|.
name|freqs
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ssid
condition|)
block|{
name|wpa_s
operator|->
name|prev_scan_ssid
operator|=
name|ssid
expr_stmt|;
if|if
condition|(
name|max_ssids
operator|>
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Include wildcard SSID in the "
literal|"scan request"
argument_list|)
expr_stmt|;
name|params
operator|.
name|num_ssids
operator|++
expr_stmt|;
block|}
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Starting AP scan for specific SSID(s)"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|wpa_s
operator|->
name|prev_scan_ssid
operator|=
name|WILDCARD_SSID_SCAN
expr_stmt|;
name|params
operator|.
name|num_ssids
operator|++
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Starting AP scan for wildcard SSID"
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|CONFIG_WPS
if|if
condition|(
name|params
operator|.
name|freqs
operator|==
name|NULL
operator|&&
name|wpa_s
operator|->
name|after_wps
operator|&&
name|wpa_s
operator|->
name|wps_freq
condition|)
block|{
comment|/* 		 * Optimize post-provisioning scan based on channel used 		 * during provisioning. 		 */
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"WPS: Scan only frequency %u MHz that "
literal|"was used during provisioning"
argument_list|,
name|wpa_s
operator|->
name|wps_freq
argument_list|)
expr_stmt|;
name|params
operator|.
name|freqs
operator|=
name|os_zalloc
argument_list|(
literal|2
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|params
operator|.
name|freqs
condition|)
name|params
operator|.
name|freqs
index|[
literal|0
index|]
operator|=
name|wpa_s
operator|->
name|wps_freq
expr_stmt|;
name|wpa_s
operator|->
name|after_wps
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|wps
condition|)
block|{
name|wps_ie
operator|=
name|wps_build_probe_req_ie
argument_list|(
name|wps
operator|==
literal|2
argument_list|,
operator|&
name|wpa_s
operator|->
name|wps
operator|->
name|dev
argument_list|,
name|wpa_s
operator|->
name|wps
operator|->
name|uuid
argument_list|,
name|req_type
argument_list|)
expr_stmt|;
if|if
condition|(
name|wps_ie
condition|)
block|{
name|params
operator|.
name|extra_ies
operator|=
name|wpabuf_head
argument_list|(
name|wps_ie
argument_list|)
expr_stmt|;
name|params
operator|.
name|extra_ies_len
operator|=
name|wpabuf_len
argument_list|(
name|wps_ie
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
comment|/* CONFIG_WPS */
name|params
operator|.
name|filter_ssids
operator|=
name|wpa_supplicant_build_filter_ssids
argument_list|(
name|wpa_s
operator|->
name|conf
argument_list|,
operator|&
name|params
operator|.
name|num_filter_ssids
argument_list|)
expr_stmt|;
name|ret
operator|=
name|wpa_supplicant_trigger_scan
argument_list|(
name|wpa_s
argument_list|,
operator|&
name|params
argument_list|)
expr_stmt|;
name|wpabuf_free
argument_list|(
name|wps_ie
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|params
operator|.
name|freqs
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|params
operator|.
name|filter_ssids
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_WARNING
argument_list|,
literal|"Failed to initiate AP scan."
argument_list|)
expr_stmt|;
if|if
condition|(
name|prev_state
operator|!=
name|wpa_s
operator|->
name|wpa_state
condition|)
name|wpa_supplicant_set_state
argument_list|(
name|wpa_s
argument_list|,
name|prev_state
argument_list|)
expr_stmt|;
name|wpa_supplicant_req_scan
argument_list|(
name|wpa_s
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * wpa_supplicant_req_scan - Schedule a scan for neighboring access points  * @wpa_s: Pointer to wpa_supplicant data  * @sec: Number of seconds after which to scan  * @usec: Number of microseconds after which to scan  *  * This function is used to schedule a scan for neighboring access points after  * the specified time.  */
end_comment

begin_function
name|void
name|wpa_supplicant_req_scan
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|,
name|int
name|sec
parameter_list|,
name|int
name|usec
parameter_list|)
block|{
comment|/* If there's at least one network that should be specifically scanned 	 * then don't cancel the scan and reschedule.  Some drivers do 	 * background scanning which generates frequent scan results, and that 	 * causes the specific SSID scan to get continually pushed back and 	 * never happen, which causes hidden APs to never get probe-scanned. 	 */
if|if
condition|(
name|eloop_is_timeout_registered
argument_list|(
name|wpa_supplicant_scan
argument_list|,
name|wpa_s
argument_list|,
name|NULL
argument_list|)
operator|&&
name|wpa_s
operator|->
name|conf
operator|->
name|ap_scan
operator|==
literal|1
condition|)
block|{
name|struct
name|wpa_ssid
modifier|*
name|ssid
init|=
name|wpa_s
operator|->
name|conf
operator|->
name|ssid
decl_stmt|;
while|while
condition|(
name|ssid
condition|)
block|{
if|if
condition|(
operator|!
name|ssid
operator|->
name|disabled
operator|&&
name|ssid
operator|->
name|scan_ssid
condition|)
break|break;
name|ssid
operator|=
name|ssid
operator|->
name|next
expr_stmt|;
block|}
if|if
condition|(
name|ssid
condition|)
block|{
name|wpa_msg
argument_list|(
name|wpa_s
argument_list|,
name|MSG_DEBUG
argument_list|,
literal|"Not rescheduling scan to "
literal|"ensure that specific SSID scans occur"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|wpa_msg
argument_list|(
name|wpa_s
argument_list|,
name|MSG_DEBUG
argument_list|,
literal|"Setting scan request: %d sec %d usec"
argument_list|,
name|sec
argument_list|,
name|usec
argument_list|)
expr_stmt|;
name|eloop_cancel_timeout
argument_list|(
name|wpa_supplicant_scan
argument_list|,
name|wpa_s
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|eloop_register_timeout
argument_list|(
name|sec
argument_list|,
name|usec
argument_list|,
name|wpa_supplicant_scan
argument_list|,
name|wpa_s
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * wpa_supplicant_cancel_scan - Cancel a scheduled scan request  * @wpa_s: Pointer to wpa_supplicant data  *  * This function is used to cancel a scan request scheduled with  * wpa_supplicant_req_scan().  */
end_comment

begin_function
name|void
name|wpa_supplicant_cancel_scan
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|)
block|{
name|wpa_msg
argument_list|(
name|wpa_s
argument_list|,
name|MSG_DEBUG
argument_list|,
literal|"Cancelling scan request"
argument_list|)
expr_stmt|;
name|eloop_cancel_timeout
argument_list|(
name|wpa_supplicant_scan
argument_list|,
name|wpa_s
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|wpa_supplicant_notify_scanning
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|,
name|int
name|scanning
parameter_list|)
block|{
if|if
condition|(
name|wpa_s
operator|->
name|scanning
operator|!=
name|scanning
condition|)
block|{
name|wpa_s
operator|->
name|scanning
operator|=
name|scanning
expr_stmt|;
name|wpas_notify_scanning
argument_list|(
name|wpa_s
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|wpa_scan_get_max_rate
parameter_list|(
specifier|const
name|struct
name|wpa_scan_res
modifier|*
name|res
parameter_list|)
block|{
name|int
name|rate
init|=
literal|0
decl_stmt|;
specifier|const
name|u8
modifier|*
name|ie
decl_stmt|;
name|int
name|i
decl_stmt|;
name|ie
operator|=
name|wpa_scan_get_ie
argument_list|(
name|res
argument_list|,
name|WLAN_EID_SUPP_RATES
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|ie
operator|&&
name|i
operator|<
name|ie
index|[
literal|1
index|]
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|ie
index|[
name|i
operator|+
literal|2
index|]
operator|&
literal|0x7f
operator|)
operator|>
name|rate
condition|)
name|rate
operator|=
name|ie
index|[
name|i
operator|+
literal|2
index|]
operator|&
literal|0x7f
expr_stmt|;
block|}
name|ie
operator|=
name|wpa_scan_get_ie
argument_list|(
name|res
argument_list|,
name|WLAN_EID_EXT_SUPP_RATES
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|ie
operator|&&
name|i
operator|<
name|ie
index|[
literal|1
index|]
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|ie
index|[
name|i
operator|+
literal|2
index|]
operator|&
literal|0x7f
operator|)
operator|>
name|rate
condition|)
name|rate
operator|=
name|ie
index|[
name|i
operator|+
literal|2
index|]
operator|&
literal|0x7f
expr_stmt|;
block|}
return|return
name|rate
return|;
block|}
end_function

begin_function
specifier|const
name|u8
modifier|*
name|wpa_scan_get_ie
parameter_list|(
specifier|const
name|struct
name|wpa_scan_res
modifier|*
name|res
parameter_list|,
name|u8
name|ie
parameter_list|)
block|{
specifier|const
name|u8
modifier|*
name|end
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|pos
operator|=
operator|(
specifier|const
name|u8
operator|*
operator|)
operator|(
name|res
operator|+
literal|1
operator|)
expr_stmt|;
name|end
operator|=
name|pos
operator|+
name|res
operator|->
name|ie_len
expr_stmt|;
while|while
condition|(
name|pos
operator|+
literal|1
operator|<
name|end
condition|)
block|{
if|if
condition|(
name|pos
operator|+
literal|2
operator|+
name|pos
index|[
literal|1
index|]
operator|>
name|end
condition|)
break|break;
if|if
condition|(
name|pos
index|[
literal|0
index|]
operator|==
name|ie
condition|)
return|return
name|pos
return|;
name|pos
operator|+=
literal|2
operator|+
name|pos
index|[
literal|1
index|]
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|const
name|u8
modifier|*
name|wpa_scan_get_vendor_ie
parameter_list|(
specifier|const
name|struct
name|wpa_scan_res
modifier|*
name|res
parameter_list|,
name|u32
name|vendor_type
parameter_list|)
block|{
specifier|const
name|u8
modifier|*
name|end
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|pos
operator|=
operator|(
specifier|const
name|u8
operator|*
operator|)
operator|(
name|res
operator|+
literal|1
operator|)
expr_stmt|;
name|end
operator|=
name|pos
operator|+
name|res
operator|->
name|ie_len
expr_stmt|;
while|while
condition|(
name|pos
operator|+
literal|1
operator|<
name|end
condition|)
block|{
if|if
condition|(
name|pos
operator|+
literal|2
operator|+
name|pos
index|[
literal|1
index|]
operator|>
name|end
condition|)
break|break;
if|if
condition|(
name|pos
index|[
literal|0
index|]
operator|==
name|WLAN_EID_VENDOR_SPECIFIC
operator|&&
name|pos
index|[
literal|1
index|]
operator|>=
literal|4
operator|&&
name|vendor_type
operator|==
name|WPA_GET_BE32
argument_list|(
operator|&
name|pos
index|[
literal|2
index|]
argument_list|)
condition|)
return|return
name|pos
return|;
name|pos
operator|+=
literal|2
operator|+
name|pos
index|[
literal|1
index|]
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|struct
name|wpabuf
modifier|*
name|wpa_scan_get_vendor_ie_multi
parameter_list|(
specifier|const
name|struct
name|wpa_scan_res
modifier|*
name|res
parameter_list|,
name|u32
name|vendor_type
parameter_list|)
block|{
name|struct
name|wpabuf
modifier|*
name|buf
decl_stmt|;
specifier|const
name|u8
modifier|*
name|end
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|buf
operator|=
name|wpabuf_alloc
argument_list|(
name|res
operator|->
name|ie_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|pos
operator|=
operator|(
specifier|const
name|u8
operator|*
operator|)
operator|(
name|res
operator|+
literal|1
operator|)
expr_stmt|;
name|end
operator|=
name|pos
operator|+
name|res
operator|->
name|ie_len
expr_stmt|;
while|while
condition|(
name|pos
operator|+
literal|1
operator|<
name|end
condition|)
block|{
if|if
condition|(
name|pos
operator|+
literal|2
operator|+
name|pos
index|[
literal|1
index|]
operator|>
name|end
condition|)
break|break;
if|if
condition|(
name|pos
index|[
literal|0
index|]
operator|==
name|WLAN_EID_VENDOR_SPECIFIC
operator|&&
name|pos
index|[
literal|1
index|]
operator|>=
literal|4
operator|&&
name|vendor_type
operator|==
name|WPA_GET_BE32
argument_list|(
operator|&
name|pos
index|[
literal|2
index|]
argument_list|)
condition|)
name|wpabuf_put_data
argument_list|(
name|buf
argument_list|,
name|pos
operator|+
literal|2
operator|+
literal|4
argument_list|,
name|pos
index|[
literal|1
index|]
operator|-
literal|4
argument_list|)
expr_stmt|;
name|pos
operator|+=
literal|2
operator|+
name|pos
index|[
literal|1
index|]
expr_stmt|;
block|}
if|if
condition|(
name|wpabuf_len
argument_list|(
name|buf
argument_list|)
operator|==
literal|0
condition|)
block|{
name|wpabuf_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|buf
operator|=
name|NULL
expr_stmt|;
block|}
return|return
name|buf
return|;
block|}
end_function

begin_comment
comment|/* Compare function for sorting scan results. Return>0 if @b is considered  * better. */
end_comment

begin_function
specifier|static
name|int
name|wpa_scan_result_compar
parameter_list|(
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|b
parameter_list|)
block|{
name|struct
name|wpa_scan_res
modifier|*
modifier|*
name|_wa
init|=
operator|(
name|void
operator|*
operator|)
name|a
decl_stmt|;
name|struct
name|wpa_scan_res
modifier|*
modifier|*
name|_wb
init|=
operator|(
name|void
operator|*
operator|)
name|b
decl_stmt|;
name|struct
name|wpa_scan_res
modifier|*
name|wa
init|=
operator|*
name|_wa
decl_stmt|;
name|struct
name|wpa_scan_res
modifier|*
name|wb
init|=
operator|*
name|_wb
decl_stmt|;
name|int
name|wpa_a
decl_stmt|,
name|wpa_b
decl_stmt|,
name|maxrate_a
decl_stmt|,
name|maxrate_b
decl_stmt|;
comment|/* WPA/WPA2 support preferred */
name|wpa_a
operator|=
name|wpa_scan_get_vendor_ie
argument_list|(
name|wa
argument_list|,
name|WPA_IE_VENDOR_TYPE
argument_list|)
operator|!=
name|NULL
operator|||
name|wpa_scan_get_ie
argument_list|(
name|wa
argument_list|,
name|WLAN_EID_RSN
argument_list|)
operator|!=
name|NULL
expr_stmt|;
name|wpa_b
operator|=
name|wpa_scan_get_vendor_ie
argument_list|(
name|wb
argument_list|,
name|WPA_IE_VENDOR_TYPE
argument_list|)
operator|!=
name|NULL
operator|||
name|wpa_scan_get_ie
argument_list|(
name|wb
argument_list|,
name|WLAN_EID_RSN
argument_list|)
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wpa_b
operator|&&
operator|!
name|wpa_a
condition|)
return|return
literal|1
return|;
if|if
condition|(
operator|!
name|wpa_b
operator|&&
name|wpa_a
condition|)
return|return
operator|-
literal|1
return|;
comment|/* privacy support preferred */
if|if
condition|(
operator|(
name|wa
operator|->
name|caps
operator|&
name|IEEE80211_CAP_PRIVACY
operator|)
operator|==
literal|0
operator|&&
operator|(
name|wb
operator|->
name|caps
operator|&
name|IEEE80211_CAP_PRIVACY
operator|)
condition|)
return|return
literal|1
return|;
if|if
condition|(
operator|(
name|wa
operator|->
name|caps
operator|&
name|IEEE80211_CAP_PRIVACY
operator|)
operator|&&
operator|(
name|wb
operator|->
name|caps
operator|&
name|IEEE80211_CAP_PRIVACY
operator|)
operator|==
literal|0
condition|)
return|return
operator|-
literal|1
return|;
comment|/* best/max rate preferred if signal level close enough XXX */
if|if
condition|(
operator|(
name|wa
operator|->
name|level
operator|&&
name|wb
operator|->
name|level
operator|&&
name|abs
argument_list|(
name|wb
operator|->
name|level
operator|-
name|wa
operator|->
name|level
argument_list|)
operator|<
literal|5
operator|)
operator|||
operator|(
name|wa
operator|->
name|qual
operator|&&
name|wb
operator|->
name|qual
operator|&&
name|abs
argument_list|(
name|wb
operator|->
name|qual
operator|-
name|wa
operator|->
name|qual
argument_list|)
operator|<
literal|10
operator|)
condition|)
block|{
name|maxrate_a
operator|=
name|wpa_scan_get_max_rate
argument_list|(
name|wa
argument_list|)
expr_stmt|;
name|maxrate_b
operator|=
name|wpa_scan_get_max_rate
argument_list|(
name|wb
argument_list|)
expr_stmt|;
if|if
condition|(
name|maxrate_a
operator|!=
name|maxrate_b
condition|)
return|return
name|maxrate_b
operator|-
name|maxrate_a
return|;
block|}
comment|/* use freq for channel preference */
comment|/* all things being equal, use signal level; if signal levels are 	 * identical, use quality values since some drivers may only report 	 * that value and leave the signal level zero */
if|if
condition|(
name|wb
operator|->
name|level
operator|==
name|wa
operator|->
name|level
condition|)
return|return
name|wb
operator|->
name|qual
operator|-
name|wa
operator|->
name|qual
return|;
return|return
name|wb
operator|->
name|level
operator|-
name|wa
operator|->
name|level
return|;
block|}
end_function

begin_comment
comment|/**  * wpa_supplicant_get_scan_results - Get scan results  * @wpa_s: Pointer to wpa_supplicant data  * @info: Information about what was scanned or %NULL if not available  * @new_scan: Whether a new scan was performed  * Returns: Scan results, %NULL on failure  *  * This function request the current scan results from the driver and updates  * the local BSS list wpa_s->bss. The caller is responsible for freeing the  * results with wpa_scan_results_free().  */
end_comment

begin_function
name|struct
name|wpa_scan_results
modifier|*
name|wpa_supplicant_get_scan_results
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|,
name|struct
name|scan_info
modifier|*
name|info
parameter_list|,
name|int
name|new_scan
parameter_list|)
block|{
name|struct
name|wpa_scan_results
modifier|*
name|scan_res
decl_stmt|;
name|size_t
name|i
decl_stmt|;
if|if
condition|(
name|wpa_s
operator|->
name|drv_flags
operator|&
name|WPA_DRIVER_FLAGS_USER_SPACE_MLME
condition|)
name|scan_res
operator|=
name|ieee80211_sta_get_scan_results
argument_list|(
name|wpa_s
argument_list|)
expr_stmt|;
else|else
name|scan_res
operator|=
name|wpa_drv_get_scan_results2
argument_list|(
name|wpa_s
argument_list|)
expr_stmt|;
if|if
condition|(
name|scan_res
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Failed to get scan results"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|qsort
argument_list|(
name|scan_res
operator|->
name|res
argument_list|,
name|scan_res
operator|->
name|num
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|wpa_scan_res
operator|*
argument_list|)
argument_list|,
name|wpa_scan_result_compar
argument_list|)
expr_stmt|;
name|wpa_bss_update_start
argument_list|(
name|wpa_s
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|scan_res
operator|->
name|num
condition|;
name|i
operator|++
control|)
name|wpa_bss_update_scan_res
argument_list|(
name|wpa_s
argument_list|,
name|scan_res
operator|->
name|res
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|wpa_bss_update_end
argument_list|(
name|wpa_s
argument_list|,
name|info
argument_list|,
name|new_scan
argument_list|)
expr_stmt|;
return|return
name|scan_res
return|;
block|}
end_function

begin_function
name|int
name|wpa_supplicant_update_scan_results
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|)
block|{
name|struct
name|wpa_scan_results
modifier|*
name|scan_res
decl_stmt|;
name|scan_res
operator|=
name|wpa_supplicant_get_scan_results
argument_list|(
name|wpa_s
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|scan_res
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|wpa_scan_results_free
argument_list|(
name|scan_res
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|wpa_scan_results_free
parameter_list|(
name|struct
name|wpa_scan_results
modifier|*
name|res
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
if|if
condition|(
name|res
operator|==
name|NULL
condition|)
return|return;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|res
operator|->
name|num
condition|;
name|i
operator|++
control|)
name|os_free
argument_list|(
name|res
operator|->
name|res
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|res
operator|->
name|res
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|res
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

