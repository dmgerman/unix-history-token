begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * WPA Supplicant - background scan and roaming interface  * Copyright (c) 2009-2010, Jouni Malinen<j@w1.fi>  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_include
include|#
directive|include
file|"common.h"
end_include

begin_include
include|#
directive|include
file|"wpa_supplicant_i.h"
end_include

begin_include
include|#
directive|include
file|"config_ssid.h"
end_include

begin_include
include|#
directive|include
file|"bgscan.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_BGSCAN_SIMPLE
end_ifdef

begin_decl_stmt
specifier|extern
specifier|const
name|struct
name|bgscan_ops
name|bgscan_simple_ops
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_BGSCAN_SIMPLE */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_BGSCAN_LEARN
end_ifdef

begin_decl_stmt
specifier|extern
specifier|const
name|struct
name|bgscan_ops
name|bgscan_learn_ops
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_BGSCAN_LEARN */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|bgscan_ops
modifier|*
name|bgscan_modules
index|[]
init|=
block|{
ifdef|#
directive|ifdef
name|CONFIG_BGSCAN_SIMPLE
operator|&
name|bgscan_simple_ops
block|,
endif|#
directive|endif
comment|/* CONFIG_BGSCAN_SIMPLE */
ifdef|#
directive|ifdef
name|CONFIG_BGSCAN_LEARN
operator|&
name|bgscan_learn_ops
block|,
endif|#
directive|endif
comment|/* CONFIG_BGSCAN_LEARN */
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|bgscan_init
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|name
init|=
name|ssid
operator|->
name|bgscan
decl_stmt|;
specifier|const
name|char
modifier|*
name|params
decl_stmt|;
name|size_t
name|nlen
decl_stmt|;
name|int
name|i
decl_stmt|;
specifier|const
name|struct
name|bgscan_ops
modifier|*
name|ops
init|=
name|NULL
decl_stmt|;
name|bgscan_deinit
argument_list|(
name|wpa_s
argument_list|)
expr_stmt|;
if|if
condition|(
name|name
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
name|params
operator|=
name|os_strchr
argument_list|(
name|name
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|params
operator|==
name|NULL
condition|)
block|{
name|params
operator|=
literal|""
expr_stmt|;
name|nlen
operator|=
name|os_strlen
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|nlen
operator|=
name|params
operator|-
name|name
expr_stmt|;
name|params
operator|++
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|bgscan_modules
index|[
name|i
index|]
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|os_strncmp
argument_list|(
name|name
argument_list|,
name|bgscan_modules
index|[
name|i
index|]
operator|->
name|name
argument_list|,
name|nlen
argument_list|)
operator|==
literal|0
condition|)
block|{
name|ops
operator|=
name|bgscan_modules
index|[
name|i
index|]
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|ops
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"bgscan: Could not find module "
literal|"matching the parameter '%s'"
argument_list|,
name|name
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wpa_s
operator|->
name|bgscan_priv
operator|=
name|ops
operator|->
name|init
argument_list|(
name|wpa_s
argument_list|,
name|params
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
if|if
condition|(
name|wpa_s
operator|->
name|bgscan_priv
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|wpa_s
operator|->
name|bgscan
operator|=
name|ops
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"bgscan: Initialized module '%s' with "
literal|"parameters '%s'"
argument_list|,
name|ops
operator|->
name|name
argument_list|,
name|params
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|bgscan_deinit
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|)
block|{
if|if
condition|(
name|wpa_s
operator|->
name|bgscan
operator|&&
name|wpa_s
operator|->
name|bgscan_priv
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"bgscan: Deinitializing module '%s'"
argument_list|,
name|wpa_s
operator|->
name|bgscan
operator|->
name|name
argument_list|)
expr_stmt|;
name|wpa_s
operator|->
name|bgscan
operator|->
name|deinit
argument_list|(
name|wpa_s
operator|->
name|bgscan_priv
argument_list|)
expr_stmt|;
name|wpa_s
operator|->
name|bgscan
operator|=
name|NULL
expr_stmt|;
name|wpa_s
operator|->
name|bgscan_priv
operator|=
name|NULL
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|bgscan_notify_scan
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|,
name|struct
name|wpa_scan_results
modifier|*
name|scan_res
parameter_list|)
block|{
if|if
condition|(
name|wpa_s
operator|->
name|bgscan
operator|&&
name|wpa_s
operator|->
name|bgscan_priv
condition|)
return|return
name|wpa_s
operator|->
name|bgscan
operator|->
name|notify_scan
argument_list|(
name|wpa_s
operator|->
name|bgscan_priv
argument_list|,
name|scan_res
argument_list|)
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|bgscan_notify_beacon_loss
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|)
block|{
if|if
condition|(
name|wpa_s
operator|->
name|bgscan
operator|&&
name|wpa_s
operator|->
name|bgscan_priv
condition|)
name|wpa_s
operator|->
name|bgscan
operator|->
name|notify_beacon_loss
argument_list|(
name|wpa_s
operator|->
name|bgscan_priv
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|bgscan_notify_signal_change
parameter_list|(
name|struct
name|wpa_supplicant
modifier|*
name|wpa_s
parameter_list|,
name|int
name|above
parameter_list|,
name|int
name|current_signal
parameter_list|,
name|int
name|current_noise
parameter_list|,
name|int
name|current_txrate
parameter_list|)
block|{
if|if
condition|(
name|wpa_s
operator|->
name|bgscan
operator|&&
name|wpa_s
operator|->
name|bgscan_priv
condition|)
name|wpa_s
operator|->
name|bgscan
operator|->
name|notify_signal_change
argument_list|(
name|wpa_s
operator|->
name|bgscan_priv
argument_list|,
name|above
argument_list|,
name|current_signal
argument_list|,
name|current_noise
argument_list|,
name|current_txrate
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

