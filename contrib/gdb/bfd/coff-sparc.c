begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* BFD back-end for Sparc COFF files.    Copyright 1990, 1991, 1992, 1993, 1994 Free Software Foundation, Inc.    Written by Cygnus Support.  This file is part of BFD, the Binary File Descriptor library.  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|"libbfd.h"
end_include

begin_include
include|#
directive|include
file|"obstack.h"
end_include

begin_include
include|#
directive|include
file|"coff/sparc.h"
end_include

begin_include
include|#
directive|include
file|"coff/internal.h"
end_include

begin_include
include|#
directive|include
file|"libcoff.h"
end_include

begin_define
define|#
directive|define
name|COFF_DEFAULT_SECTION_ALIGNMENT_POWER
value|(3)
end_define

begin_define
define|#
directive|define
name|BADMAG
parameter_list|(
name|x
parameter_list|)
value|((x).f_magic != SPARCMAGIC&& (x).f_magic != LYNXCOFFMAGIC)
end_define

begin_comment
comment|/* The page size is a guess based on ELF.  */
end_comment

begin_define
define|#
directive|define
name|COFF_PAGE_SIZE
value|0x10000
end_define

begin_enum
enum|enum
name|reloc_type
block|{
name|R_SPARC_NONE
init|=
literal|0
block|,
name|R_SPARC_8
block|,
name|R_SPARC_16
block|,
name|R_SPARC_32
block|,
name|R_SPARC_DISP8
block|,
name|R_SPARC_DISP16
block|,
name|R_SPARC_DISP32
block|,
name|R_SPARC_WDISP30
block|,
name|R_SPARC_WDISP22
block|,
name|R_SPARC_HI22
block|,
name|R_SPARC_22
block|,
name|R_SPARC_13
block|,
name|R_SPARC_LO10
block|,
name|R_SPARC_GOT10
block|,
name|R_SPARC_GOT13
block|,
name|R_SPARC_GOT22
block|,
name|R_SPARC_PC10
block|,
name|R_SPARC_PC22
block|,
name|R_SPARC_WPLT30
block|,
name|R_SPARC_COPY
block|,
name|R_SPARC_GLOB_DAT
block|,
name|R_SPARC_JMP_SLOT
block|,
name|R_SPARC_RELATIVE
block|,
name|R_SPARC_UA32
block|,
name|R_SPARC_max
block|}
enum|;
end_enum

begin_if
if|#
directive|if
literal|0
end_if

begin_endif
unit|static CONST char *CONST reloc_type_names[] = {   "R_SPARC_NONE",   "R_SPARC_8",		"R_SPARC_16",		"R_SPARC_32",   "R_SPARC_DISP8",	"R_SPARC_DISP16",	"R_SPARC_DISP32",   "R_SPARC_WDISP30",	"R_SPARC_WDISP22",   "R_SPARC_HI22",	"R_SPARC_22",   "R_SPARC_13",		"R_SPARC_LO10",   "R_SPARC_GOT10",	"R_SPARC_GOT13",	"R_SPARC_GOT22",   "R_SPARC_PC10",	"R_SPARC_PC22",   "R_SPARC_WPLT30",   "R_SPARC_COPY",   "R_SPARC_GLOB_DAT",	"R_SPARC_JMP_SLOT",   "R_SPARC_RELATIVE",   "R_SPARC_UA32", };
endif|#
directive|endif
end_endif

begin_comment
comment|/* This is stolen pretty directly from elf.c.  */
end_comment

begin_decl_stmt
specifier|static
name|bfd_reloc_status_type
name|bfd_coff_generic_reloc
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|arelent
operator|*
operator|,
name|asymbol
operator|*
operator|,
name|PTR
operator|,
name|asection
operator|*
operator|,
name|bfd
operator|*
operator|,
name|char
operator|*
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|bfd_reloc_status_type
name|bfd_coff_generic_reloc
parameter_list|(
name|abfd
parameter_list|,
name|reloc_entry
parameter_list|,
name|symbol
parameter_list|,
name|data
parameter_list|,
name|input_section
parameter_list|,
name|output_bfd
parameter_list|,
name|error_message
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|arelent
modifier|*
name|reloc_entry
decl_stmt|;
name|asymbol
modifier|*
name|symbol
decl_stmt|;
name|PTR
name|data
decl_stmt|;
name|asection
modifier|*
name|input_section
decl_stmt|;
name|bfd
modifier|*
name|output_bfd
decl_stmt|;
name|char
modifier|*
modifier|*
name|error_message
decl_stmt|;
block|{
if|if
condition|(
name|output_bfd
operator|!=
operator|(
name|bfd
operator|*
operator|)
name|NULL
operator|&&
operator|(
name|symbol
operator|->
name|flags
operator|&
name|BSF_SECTION_SYM
operator|)
operator|==
literal|0
operator|&&
name|reloc_entry
operator|->
name|addend
operator|==
literal|0
condition|)
block|{
name|reloc_entry
operator|->
name|address
operator|+=
name|input_section
operator|->
name|output_offset
expr_stmt|;
return|return
name|bfd_reloc_ok
return|;
block|}
return|return
name|bfd_reloc_continue
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|reloc_howto_type
name|coff_sparc_howto_table
index|[]
init|=
block|{
name|HOWTO
argument_list|(
name|R_SPARC_NONE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_NONE"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x00000000
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_8
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_8"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x000000ff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_16
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|16
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_16"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x0000ffff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_32
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|32
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_32"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0xffffffff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_DISP8
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|,
name|true
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_DISP8"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x000000ff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_DISP16
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|16
argument_list|,
name|true
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_DISP16"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x0000ffff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_DISP32
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|32
argument_list|,
name|true
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_DISP32"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x00ffffff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_WDISP30
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|30
argument_list|,
name|true
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_WDISP30"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x3fffffff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_WDISP22
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|22
argument_list|,
name|true
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_WDISP22"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x003fffff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_HI22
argument_list|,
literal|10
argument_list|,
literal|2
argument_list|,
literal|22
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_HI22"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x003fffff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_22
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|22
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_22"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x003fffff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_13
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|13
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_13"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x00001fff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_LO10
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|10
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_LO10"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x000003ff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_GOT10
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|10
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_GOT10"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x000003ff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_GOT13
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|13
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_GOT13"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x00001fff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_GOT22
argument_list|,
literal|10
argument_list|,
literal|2
argument_list|,
literal|22
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_GOT22"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x003fffff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_PC10
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|10
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_PC10"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x000003ff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_PC22
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|22
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_PC22"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x003fffff
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_WPLT30
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|00
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_WPLT30"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x00000000
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_COPY
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|00
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_COPY"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x00000000
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_GLOB_DAT
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|00
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_GLOB_DAT"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x00000000
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_JMP_SLOT
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|00
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_JMP_SLOT"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x00000000
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_RELATIVE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|00
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_RELATIVE"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x00000000
argument_list|,
name|true
argument_list|)
block|,
name|HOWTO
argument_list|(
name|R_SPARC_UA32
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|00
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|bfd_coff_generic_reloc
argument_list|,
literal|"R_SPARC_UA32"
argument_list|,
name|false
argument_list|,
literal|0
argument_list|,
literal|0x00000000
argument_list|,
name|true
argument_list|)
block|, }
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|coff_reloc_map
block|{
name|unsigned
name|char
name|bfd_reloc_val
decl_stmt|;
name|unsigned
name|char
name|coff_reloc_val
decl_stmt|;
block|}
struct|;
end_struct

begin_expr_stmt
specifier|static
name|CONST
expr|struct
name|coff_reloc_map
name|sparc_reloc_map
index|[]
operator|=
block|{
block|{
name|BFD_RELOC_NONE
block|,
name|R_SPARC_NONE
block|, }
block|,
block|{
name|BFD_RELOC_16
block|,
name|R_SPARC_16
block|, }
block|,
block|{
name|BFD_RELOC_8
block|,
name|R_SPARC_8
block|}
block|,
block|{
name|BFD_RELOC_8_PCREL
block|,
name|R_SPARC_DISP8
block|}
block|,
block|{
name|BFD_RELOC_CTOR
block|,
name|R_SPARC_32
block|}
block|,
comment|/* @@ Assumes 32 bits.  */
block|{
name|BFD_RELOC_32
block|,
name|R_SPARC_32
block|}
block|,
block|{
name|BFD_RELOC_32_PCREL
block|,
name|R_SPARC_DISP32
block|}
block|,
block|{
name|BFD_RELOC_HI22
block|,
name|R_SPARC_HI22
block|}
block|,
block|{
name|BFD_RELOC_LO10
block|,
name|R_SPARC_LO10
block|, }
block|,
block|{
name|BFD_RELOC_32_PCREL_S2
block|,
name|R_SPARC_WDISP30
block|}
block|,
block|{
name|BFD_RELOC_SPARC22
block|,
name|R_SPARC_22
block|}
block|,
block|{
name|BFD_RELOC_SPARC13
block|,
name|R_SPARC_13
block|}
block|,
block|{
name|BFD_RELOC_SPARC_GOT10
block|,
name|R_SPARC_GOT10
block|}
block|,
block|{
name|BFD_RELOC_SPARC_GOT13
block|,
name|R_SPARC_GOT13
block|}
block|,
block|{
name|BFD_RELOC_SPARC_GOT22
block|,
name|R_SPARC_GOT22
block|}
block|,
block|{
name|BFD_RELOC_SPARC_PC10
block|,
name|R_SPARC_PC10
block|}
block|,
block|{
name|BFD_RELOC_SPARC_PC22
block|,
name|R_SPARC_PC22
block|}
block|,
block|{
name|BFD_RELOC_SPARC_WPLT30
block|,
name|R_SPARC_WPLT30
block|}
block|,
block|{
name|BFD_RELOC_SPARC_COPY
block|,
name|R_SPARC_COPY
block|}
block|,
block|{
name|BFD_RELOC_SPARC_GLOB_DAT
block|,
name|R_SPARC_GLOB_DAT
block|}
block|,
block|{
name|BFD_RELOC_SPARC_JMP_SLOT
block|,
name|R_SPARC_JMP_SLOT
block|}
block|,
block|{
name|BFD_RELOC_SPARC_RELATIVE
block|,
name|R_SPARC_RELATIVE
block|}
block|,
block|{
name|BFD_RELOC_SPARC_WDISP22
block|,
name|R_SPARC_WDISP22
block|}
block|,
comment|/*  { BFD_RELOC_SPARC_UA32, R_SPARC_UA32 }, not used?? */
block|}
expr_stmt|;
end_expr_stmt

begin_function
specifier|static
name|reloc_howto_type
modifier|*
name|coff_sparc_reloc_type_lookup
parameter_list|(
name|abfd
parameter_list|,
name|code
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|bfd_reloc_code_real_type
name|code
decl_stmt|;
block|{
name|unsigned
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|sparc_reloc_map
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
expr|struct
name|coff_reloc_map
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|sparc_reloc_map
index|[
name|i
index|]
operator|.
name|bfd_reloc_val
operator|==
name|code
condition|)
return|return
operator|&
name|coff_sparc_howto_table
index|[
operator|(
name|int
operator|)
name|sparc_reloc_map
index|[
name|i
index|]
operator|.
name|coff_reloc_val
index|]
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_define
define|#
directive|define
name|coff_bfd_reloc_type_lookup
value|coff_sparc_reloc_type_lookup
end_define

begin_function
specifier|static
name|void
name|rtype2howto
parameter_list|(
name|cache_ptr
parameter_list|,
name|dst
parameter_list|)
name|arelent
modifier|*
name|cache_ptr
decl_stmt|;
name|struct
name|internal_reloc
modifier|*
name|dst
decl_stmt|;
block|{
name|BFD_ASSERT
argument_list|(
name|dst
operator|->
name|r_type
operator|<
operator|(
name|unsigned
name|int
operator|)
name|R_SPARC_max
argument_list|)
expr_stmt|;
name|cache_ptr
operator|->
name|howto
operator|=
operator|&
name|coff_sparc_howto_table
index|[
name|dst
operator|->
name|r_type
index|]
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|RTYPE2HOWTO
parameter_list|(
name|internal
parameter_list|,
name|relocentry
parameter_list|)
value|rtype2howto(internal,relocentry)
end_define

begin_define
define|#
directive|define
name|SWAP_IN_RELOC_OFFSET
value|bfd_h_get_32
end_define

begin_define
define|#
directive|define
name|SWAP_OUT_RELOC_OFFSET
value|bfd_h_put_32
end_define

begin_comment
comment|/* This is just like the standard one, except that we don't set up an    addend for relocs against global symbols (otherwise linking objects    created by -r fails), and we add in the reloc offset at the end.  */
end_comment

begin_define
define|#
directive|define
name|CALC_ADDEND
parameter_list|(
name|abfd
parameter_list|,
name|ptr
parameter_list|,
name|reloc
parameter_list|,
name|cache_ptr
parameter_list|)
define|\
value|{                                                             \     coff_symbol_type *coffsym = (coff_symbol_type *) NULL;      \     if (ptr&& bfd_asymbol_bfd (ptr) != abfd)                   \       coffsym = (obj_symbols (abfd)                             \                  + (cache_ptr->sym_ptr_ptr - symbols));         \     else if (ptr)                                               \       coffsym = coff_symbol_from (abfd, ptr);                   \     if (coffsym != (coff_symbol_type *) NULL                    \&& coffsym->native->u.syment.n_scnum == 0)              \       cache_ptr->addend = 0;                                    \     else if (ptr&& bfd_asymbol_bfd (ptr) == abfd               \&& ptr->section != (asection *) NULL               \&& (ptr->flags& BSF_GLOBAL) == 0)			\       cache_ptr->addend = - (ptr->section->vma + ptr->value);   \     else                                                        \       cache_ptr->addend = 0;                                    \     cache_ptr->addend += reloc.r_offset;			\   }
end_define

begin_comment
comment|/* Clear the r_spare field in relocs.  */
end_comment

begin_define
define|#
directive|define
name|SWAP_OUT_RELOC_EXTRA
parameter_list|(
name|abfd
parameter_list|,
name|src
parameter_list|,
name|dst
parameter_list|)
define|\
value|do { \        dst->r_spare[0] = 0; \        dst->r_spare[1] = 0; \      } while (0)
end_define

begin_define
define|#
directive|define
name|__A_MAGIC_SET__
end_define

begin_comment
comment|/* Enable Sparc-specific hacks in coffcode.h. */
end_comment

begin_define
define|#
directive|define
name|COFF_SPARC
end_define

begin_include
include|#
directive|include
file|"coffcode.h"
end_include

begin_decl_stmt
specifier|const
name|bfd_target
ifdef|#
directive|ifdef
name|TARGET_SYM
name|TARGET_SYM
init|=
else|#
directive|else
name|sparccoff_vec
operator|=
endif|#
directive|endif
block|{
ifdef|#
directive|ifdef
name|TARGET_NAME
name|TARGET_NAME
block|,
else|#
directive|else
literal|"coff-sparc"
block|,
comment|/* name */
endif|#
directive|endif
name|bfd_target_coff_flavour
block|,
name|BFD_ENDIAN_BIG
block|,
comment|/* data byte order is big */
name|BFD_ENDIAN_BIG
block|,
comment|/* header byte order is big */
operator|(
name|HAS_RELOC
operator||
name|EXEC_P
operator||
comment|/* object flags */
name|HAS_LINENO
operator||
name|HAS_DEBUG
operator||
name|HAS_SYMS
operator||
name|HAS_LOCALS
operator||
name|WP_TEXT
operator||
name|D_PAGED
operator|)
block|,
operator|(
name|SEC_HAS_CONTENTS
operator||
name|SEC_ALLOC
operator||
name|SEC_LOAD
operator||
name|SEC_RELOC
operator|)
block|,
comment|/* section flags */
literal|'_'
block|,
comment|/* leading underscore */
literal|'/'
block|,
comment|/* ar_pad_char */
literal|15
block|,
comment|/* ar_max_namelen */
name|bfd_getb64
block|,
name|bfd_getb_signed_64
block|,
name|bfd_putb64
block|,
name|bfd_getb32
block|,
name|bfd_getb_signed_32
block|,
name|bfd_putb32
block|,
name|bfd_getb16
block|,
name|bfd_getb_signed_16
block|,
name|bfd_putb16
block|,
comment|/* data */
name|bfd_getb64
block|,
name|bfd_getb_signed_64
block|,
name|bfd_putb64
block|,
name|bfd_getb32
block|,
name|bfd_getb_signed_32
block|,
name|bfd_putb32
block|,
name|bfd_getb16
block|,
name|bfd_getb_signed_16
block|,
name|bfd_putb16
block|,
comment|/* hdrs */
comment|/* Note that we allow an object file to be treated as a core file as well. */
block|{
name|_bfd_dummy_target
block|,
name|coff_object_p
block|,
comment|/* bfd_check_format */
name|bfd_generic_archive_p
block|,
name|coff_object_p
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_mkobject
block|,
name|_bfd_generic_mkarchive
block|,
comment|/* bfd_set_format */
name|bfd_false
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_write_object_contents
block|,
comment|/* bfd_write_contents */
name|_bfd_write_archive_contents
block|,
name|bfd_false
block|}
block|,
name|BFD_JUMP_TABLE_GENERIC
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_COPY
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_CORE
argument_list|(
name|_bfd_nocore
argument_list|)
block|,
name|BFD_JUMP_TABLE_ARCHIVE
argument_list|(
name|_bfd_archive_coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_SYMBOLS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_RELOCS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_WRITE
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_LINK
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_DYNAMIC
argument_list|(
name|_bfd_nodynamic
argument_list|)
block|,
name|COFF_SWAP_TABLE
block|, }
decl_stmt|;
end_decl_stmt

end_unit

