begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Target-dependent code for the IA-64 for GDB, the GNU debugger.    Copyright 2000    Free Software Foundation, Inc.     This file is part of GDB.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330,    Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"arch-utils.h"
end_include

begin_comment
comment|/* The sigtramp code is in a non-readable (executable-only) region    of memory called the ``gate page''.  The addresses in question    were determined by examining the system headers.  They are    overly generous to allow for different pages sizes. */
end_comment

begin_define
define|#
directive|define
name|GATE_AREA_START
value|0xa000000000000100LL
end_define

begin_define
define|#
directive|define
name|GATE_AREA_END
value|0xa000000000010000LL
end_define

begin_comment
comment|/* Offset to sigcontext structure from frame of handler */
end_comment

begin_define
define|#
directive|define
name|IA64_LINUX_SIGCONTEXT_OFFSET
value|192
end_define

begin_function
name|int
name|ia64_linux_in_sigtramp
parameter_list|(
name|CORE_ADDR
name|pc
parameter_list|,
name|char
modifier|*
name|func_name
parameter_list|)
block|{
return|return
operator|(
name|pc
operator|>=
operator|(
name|CORE_ADDR
operator|)
name|GATE_AREA_START
operator|&&
name|pc
operator|<
operator|(
name|CORE_ADDR
operator|)
name|GATE_AREA_END
operator|)
return|;
block|}
end_function

begin_comment
comment|/* IA-64 GNU/Linux specific function which, given a frame address and    a register number, returns the address at which that register may be    found.  0 is returned for registers which aren't stored in the the    sigcontext structure. */
end_comment

begin_function
name|CORE_ADDR
name|ia64_linux_sigcontext_register_address
parameter_list|(
name|CORE_ADDR
name|sp
parameter_list|,
name|int
name|regno
parameter_list|)
block|{
if|if
condition|(
name|IA64_GR0_REGNUM
operator|<=
name|regno
operator|&&
name|regno
operator|<=
name|IA64_GR31_REGNUM
condition|)
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|200
operator|+
literal|8
operator|*
operator|(
name|regno
operator|-
name|IA64_GR0_REGNUM
operator|)
return|;
elseif|else
if|if
condition|(
name|IA64_BR0_REGNUM
operator|<=
name|regno
operator|&&
name|regno
operator|<=
name|IA64_BR7_REGNUM
condition|)
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|136
operator|+
literal|8
operator|*
operator|(
name|regno
operator|-
name|IA64_BR0_REGNUM
operator|)
return|;
elseif|else
if|if
condition|(
name|IA64_FR0_REGNUM
operator|<=
name|regno
operator|&&
name|regno
operator|<=
name|IA64_FR127_REGNUM
condition|)
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|464
operator|+
literal|16
operator|*
operator|(
name|regno
operator|-
name|IA64_FR0_REGNUM
operator|)
return|;
else|else
switch|switch
condition|(
name|regno
condition|)
block|{
case|case
name|IA64_IP_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|40
return|;
case|case
name|IA64_CFM_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|48
return|;
case|case
name|IA64_PSR_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|56
return|;
comment|/* user mask only */
comment|/* sc_ar_rsc is provided, from which we could compute bspstore, but 	 I don't think it's worth it.  Anyway, if we want it, it's at offset 	 64 */
case|case
name|IA64_BSP_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|72
return|;
case|case
name|IA64_RNAT_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|80
return|;
case|case
name|IA64_CCV_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|88
return|;
case|case
name|IA64_UNAT_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|96
return|;
case|case
name|IA64_FPSR_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|104
return|;
case|case
name|IA64_PFS_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|112
return|;
case|case
name|IA64_LC_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|120
return|;
case|case
name|IA64_PR_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_LINUX_SIGCONTEXT_OFFSET
operator|+
literal|128
return|;
default|default :
return|return
literal|0
return|;
block|}
block|}
end_function

end_unit

