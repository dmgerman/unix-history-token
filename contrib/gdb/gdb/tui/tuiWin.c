begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* ** tuiWin.c **    This module contains procedures for handling tui window functions **    like resize, scrolling, scrolling, changing focus, etc. ** ** Author: Susan B. Macchia */
end_comment

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"command.h"
end_include

begin_include
include|#
directive|include
file|"symtab.h"
end_include

begin_include
include|#
directive|include
file|"breakpoint.h"
end_include

begin_include
include|#
directive|include
file|"frame.h"
end_include

begin_include
include|#
directive|include
file|"tui.h"
end_include

begin_include
include|#
directive|include
file|"tuiData.h"
end_include

begin_include
include|#
directive|include
file|"tuiGeneralWin.h"
end_include

begin_include
include|#
directive|include
file|"tuiStack.h"
end_include

begin_include
include|#
directive|include
file|"tuiSourceWin.h"
end_include

begin_include
include|#
directive|include
file|"tuiDataWin.h"
end_include

begin_comment
comment|/******************************* ** External Declarations ********************************/
end_comment

begin_function_decl
specifier|extern
name|void
name|init_page_info
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/******************************* ** Static Local Decls ********************************/
end_comment

begin_decl_stmt
specifier|static
name|void
name|_makeVisibleWithNewHeight
name|PARAMS
argument_list|(
operator|(
name|TuiWinInfoPtr
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_makeInvisibleAndSetNewHeight
name|PARAMS
argument_list|(
operator|(
name|TuiWinInfoPtr
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|TuiStatus
name|_tuiAdjustWinHeights
name|PARAMS
argument_list|(
operator|(
name|TuiWinInfoPtr
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|_newHeightOk
name|PARAMS
argument_list|(
operator|(
name|TuiWinInfoPtr
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiSetTabWidth_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiRefreshAll_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiSetWinHeight_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiXDBsetWinHeight_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiAllWindowsInfo
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiSetFocus_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiScrollForward_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiScrollBackward_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiScrollLeft_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiScrollRight_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_parseScrollingArgs
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|TuiWinInfoPtr
operator|*
operator|,
name|int
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*************************************** ** DEFINITIONS ***************************************/
end_comment

begin_define
define|#
directive|define
name|WIN_HEIGHT_USAGE
value|"Usage: winheight<win_name> [+ | -]<#lines>\n"
end_define

begin_define
define|#
directive|define
name|XDBWIN_HEIGHT_USAGE
value|"Usage: w<#lines>\n"
end_define

begin_define
define|#
directive|define
name|FOCUS_USAGE
value|"Usage: focus {<win> | next | prev}\n"
end_define

begin_comment
comment|/*************************************** ** PUBLIC FUNCTIONS ***************************************/
end_comment

begin_comment
comment|/* ** _initialize_tuiWin(). **        Function to initialize gdb commands, for tui window manipulation. */
end_comment

begin_function
name|void
name|_initialize_tuiWin
parameter_list|()
block|{
if|if
condition|(
name|tui_version
condition|)
block|{
name|add_com
argument_list|(
literal|"refresh"
argument_list|,
name|class_tui
argument_list|,
name|_tuiRefreshAll_command
argument_list|,
literal|"Refresh the terminal display.\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|xdb_commands
condition|)
name|add_com_alias
argument_list|(
literal|"U"
argument_list|,
literal|"refresh"
argument_list|,
name|class_tui
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"tabset"
argument_list|,
name|class_tui
argument_list|,
name|_tuiSetTabWidth_command
argument_list|,
literal|"Set the width (in characters) of tab stops.\n\ Usage: tabset<n>\n"
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"winheight"
argument_list|,
name|class_tui
argument_list|,
name|_tuiSetWinHeight_command
argument_list|,
literal|"Set the height of a specified window.\n\ Usage: winheight<win_name> [+ | -]<#lines>\n\ Window names are:\n\ src  : the source window\n\ cmd  : the command window\n\ asm  : the disassembly window\n\ regs : the register display\n"
argument_list|)
expr_stmt|;
name|add_com_alias
argument_list|(
literal|"wh"
argument_list|,
literal|"winheight"
argument_list|,
name|class_tui
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|add_info
argument_list|(
literal|"win"
argument_list|,
name|_tuiAllWindowsInfo
argument_list|,
literal|"List of all displayed windows.\n"
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"focus"
argument_list|,
name|class_tui
argument_list|,
name|_tuiSetFocus_command
argument_list|,
literal|"Set focus to named window or next/prev window.\n\ Usage: focus {<win> | next | prev}\n\ Valid Window names are:\n\ src  : the source window\n\ asm  : the disassembly window\n\ regs : the register display\n\ cmd  : the command window\n"
argument_list|)
expr_stmt|;
name|add_com_alias
argument_list|(
literal|"fs"
argument_list|,
literal|"focus"
argument_list|,
name|class_tui
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"+"
argument_list|,
name|class_tui
argument_list|,
name|_tuiScrollForward_command
argument_list|,
literal|"Scroll window forward.\nUsage: + [win] [n]\n"
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"-"
argument_list|,
name|class_tui
argument_list|,
name|_tuiScrollBackward_command
argument_list|,
literal|"Scroll window backward.\nUsage: - [win] [n]\n"
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"<"
argument_list|,
name|class_tui
argument_list|,
name|_tuiScrollLeft_command
argument_list|,
literal|"Scroll window forward.\nUsage:< [win] [n]\n"
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|">"
argument_list|,
name|class_tui
argument_list|,
name|_tuiScrollRight_command
argument_list|,
literal|"Scroll window backward.\nUsage:> [win] [n]\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|xdb_commands
condition|)
name|add_com
argument_list|(
literal|"w"
argument_list|,
name|class_xdb
argument_list|,
name|_tuiXDBsetWinHeight_command
argument_list|,
literal|"XDB compatibility command for setting the height of a command window.\n\ Usage: w<#lines>\n"
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* _intialize_tuiWin */
end_comment

begin_comment
comment|/* ** tuiClearWinFocusFrom **        Clear the logical focus from winInfo */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiClearWinFocusFrom
parameter_list|(
name|TuiWinInfoPtr
name|winInfo
parameter_list|)
else|#
directive|else
function|tuiClearWinFocusFrom
parameter_list|(
name|winInfo
parameter_list|)
name|TuiWinInfoPtr
name|winInfo
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|m_winPtrNotNull
argument_list|(
name|winInfo
argument_list|)
condition|)
block|{
if|if
condition|(
name|winInfo
operator|->
name|generic
operator|.
name|type
operator|!=
name|CMD_WIN
condition|)
name|unhighlightWin
argument_list|(
name|winInfo
argument_list|)
expr_stmt|;
name|tuiSetWinWithFocus
argument_list|(
operator|(
name|TuiWinInfoPtr
operator|)
name|NULL
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiClearWinFocusFrom */
end_comment

begin_comment
comment|/* ** tuiClearWinFocus(). **        Clear the window that has focus. */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiClearWinFocus
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|tuiClearWinFocus
parameter_list|()
endif|#
directive|endif
block|{
name|tuiClearWinFocusFrom
argument_list|(
name|tuiWinWithFocus
argument_list|()
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tuiClearWinFocus */
end_comment

begin_comment
comment|/* ** tuiSetWinFocusTo **        Set the logical focus to winInfo */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiSetWinFocusTo
parameter_list|(
name|TuiWinInfoPtr
name|winInfo
parameter_list|)
else|#
directive|else
function|tuiSetWinFocusTo
parameter_list|(
name|winInfo
parameter_list|)
name|TuiWinInfoPtr
name|winInfo
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|m_winPtrNotNull
argument_list|(
name|winInfo
argument_list|)
condition|)
block|{
name|TuiWinInfoPtr
name|winWithFocus
init|=
name|tuiWinWithFocus
argument_list|()
decl_stmt|;
if|if
condition|(
name|m_winPtrNotNull
argument_list|(
name|winWithFocus
argument_list|)
operator|&&
name|winWithFocus
operator|->
name|generic
operator|.
name|type
operator|!=
name|CMD_WIN
condition|)
name|unhighlightWin
argument_list|(
name|winWithFocus
argument_list|)
expr_stmt|;
name|tuiSetWinWithFocus
argument_list|(
name|winInfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|winInfo
operator|->
name|generic
operator|.
name|type
operator|!=
name|CMD_WIN
condition|)
name|highlightWin
argument_list|(
name|winInfo
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiSetWinFocusTo */
end_comment

begin_function
name|char
modifier|*
ifdef|#
directive|ifdef
name|__STDC__
name|tuiStrDup
parameter_list|(
name|char
modifier|*
name|str
parameter_list|)
else|#
directive|else
function|tuiStrDup
parameter_list|(
name|str
parameter_list|)
name|char
modifier|*
name|str
decl_stmt|;
endif|#
directive|endif
block|{
name|char
modifier|*
name|newStr
init|=
operator|(
name|char
operator|*
operator|)
name|NULL
decl_stmt|;
if|if
condition|(
name|str
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|newStr
operator|=
operator|(
name|char
operator|*
operator|)
name|xmalloc
argument_list|(
name|strlen
argument_list|(
name|str
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|newStr
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
return|return
name|newStr
return|;
block|}
end_function

begin_comment
comment|/* tuiStrDup */
end_comment

begin_comment
comment|/* ** tuiScrollForward(). */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiScrollForward
parameter_list|(
name|TuiWinInfoPtr
name|winToScroll
parameter_list|,
name|int
name|numToScroll
parameter_list|)
else|#
directive|else
function|tuiScrollForward
parameter_list|(
name|winToScroll
parameter_list|,
name|numToScroll
parameter_list|)
name|TuiWinInfoPtr
name|winToScroll
decl_stmt|;
name|int
name|numToScroll
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|winToScroll
operator|!=
name|cmdWin
condition|)
block|{
name|int
name|_numToScroll
init|=
name|numToScroll
decl_stmt|;
if|if
condition|(
name|numToScroll
operator|==
literal|0
condition|)
name|_numToScroll
operator|=
name|winToScroll
operator|->
name|generic
operator|.
name|height
operator|-
literal|3
expr_stmt|;
comment|/*         ** If we are scrolling the source or disassembly window, do a         ** "psuedo" scroll since not all of the source is in memory,         ** only what is in the viewport.  If winToScroll is the         ** command window do nothing since the term should handle it.         */
if|if
condition|(
name|winToScroll
operator|==
name|srcWin
condition|)
name|tuiVerticalSourceScroll
argument_list|(
name|FORWARD_SCROLL
argument_list|,
name|_numToScroll
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|winToScroll
operator|==
name|disassemWin
condition|)
name|tuiVerticalDisassemScroll
argument_list|(
name|FORWARD_SCROLL
argument_list|,
name|_numToScroll
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|winToScroll
operator|==
name|dataWin
condition|)
name|tuiVerticalDataScroll
argument_list|(
name|FORWARD_SCROLL
argument_list|,
name|_numToScroll
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiScrollForward */
end_comment

begin_comment
comment|/* ** tuiScrollBackward(). */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiScrollBackward
parameter_list|(
name|TuiWinInfoPtr
name|winToScroll
parameter_list|,
name|int
name|numToScroll
parameter_list|)
else|#
directive|else
function|tuiScrollBackward
parameter_list|(
name|winToScroll
parameter_list|,
name|numToScroll
parameter_list|)
name|TuiWinInfoPtr
name|winToScroll
decl_stmt|;
name|int
name|numToScroll
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|winToScroll
operator|!=
name|cmdWin
condition|)
block|{
name|int
name|_numToScroll
init|=
name|numToScroll
decl_stmt|;
if|if
condition|(
name|numToScroll
operator|==
literal|0
condition|)
name|_numToScroll
operator|=
name|winToScroll
operator|->
name|generic
operator|.
name|height
operator|-
literal|3
expr_stmt|;
comment|/*         ** If we are scrolling the source or disassembly window, do a         ** "psuedo" scroll since not all of the source is in memory,         ** only what is in the viewport.  If winToScroll is the         ** command window do nothing since the term should handle it.         */
if|if
condition|(
name|winToScroll
operator|==
name|srcWin
condition|)
name|tuiVerticalSourceScroll
argument_list|(
name|BACKWARD_SCROLL
argument_list|,
name|_numToScroll
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|winToScroll
operator|==
name|disassemWin
condition|)
name|tuiVerticalDisassemScroll
argument_list|(
name|BACKWARD_SCROLL
argument_list|,
name|_numToScroll
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|winToScroll
operator|==
name|dataWin
condition|)
name|tuiVerticalDataScroll
argument_list|(
name|BACKWARD_SCROLL
argument_list|,
name|_numToScroll
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiScrollBackward */
end_comment

begin_comment
comment|/* ** tuiScrollLeft(). */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiScrollLeft
parameter_list|(
name|TuiWinInfoPtr
name|winToScroll
parameter_list|,
name|int
name|numToScroll
parameter_list|)
else|#
directive|else
function|tuiScrollLeft
parameter_list|(
name|winToScroll
parameter_list|,
name|numToScroll
parameter_list|)
name|TuiWinInfoPtr
name|winToScroll
decl_stmt|;
name|int
name|numToScroll
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|winToScroll
operator|!=
name|cmdWin
condition|)
block|{
name|int
name|_numToScroll
init|=
name|numToScroll
decl_stmt|;
if|if
condition|(
name|_numToScroll
operator|==
literal|0
condition|)
name|_numToScroll
operator|=
literal|1
expr_stmt|;
comment|/*         ** If we are scrolling the source or disassembly window, do a         ** "psuedo" scroll since not all of the source is in memory,         ** only what is in the viewport. If winToScroll is the         ** command window do nothing since the term should handle it.         */
if|if
condition|(
name|winToScroll
operator|==
name|srcWin
operator|||
name|winToScroll
operator|==
name|disassemWin
condition|)
name|tuiHorizontalSourceScroll
argument_list|(
name|winToScroll
argument_list|,
name|LEFT_SCROLL
argument_list|,
name|_numToScroll
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiScrollLeft */
end_comment

begin_comment
comment|/* ** tuiScrollRight(). */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiScrollRight
parameter_list|(
name|TuiWinInfoPtr
name|winToScroll
parameter_list|,
name|int
name|numToScroll
parameter_list|)
else|#
directive|else
function|tuiScrollRight
parameter_list|(
name|winToScroll
parameter_list|,
name|numToScroll
parameter_list|)
name|TuiWinInfoPtr
name|winToScroll
decl_stmt|;
name|int
name|numToScroll
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|winToScroll
operator|!=
name|cmdWin
condition|)
block|{
name|int
name|_numToScroll
init|=
name|numToScroll
decl_stmt|;
if|if
condition|(
name|_numToScroll
operator|==
literal|0
condition|)
name|_numToScroll
operator|=
literal|1
expr_stmt|;
comment|/*         ** If we are scrolling the source or disassembly window, do a         ** "psuedo" scroll since not all of the source is in memory,         ** only what is in the viewport. If winToScroll is the         ** command window do nothing since the term should handle it.         */
if|if
condition|(
name|winToScroll
operator|==
name|srcWin
operator|||
name|winToScroll
operator|==
name|disassemWin
condition|)
name|tuiHorizontalSourceScroll
argument_list|(
name|winToScroll
argument_list|,
name|RIGHT_SCROLL
argument_list|,
name|_numToScroll
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiScrollRight */
end_comment

begin_comment
comment|/* ** tui_vScroll(). **    Scroll a window.  Arguments are passed through a va_list. */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tui_vScroll
parameter_list|(
name|va_list
name|args
parameter_list|)
else|#
directive|else
function|tui_vScroll
parameter_list|(
name|args
parameter_list|)
name|va_list
name|args
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiScrollDirection
name|direction
init|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|TuiScrollDirection
argument_list|)
decl_stmt|;
name|TuiWinInfoPtr
name|winToScroll
init|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|TuiWinInfoPtr
argument_list|)
decl_stmt|;
name|int
name|numToScroll
init|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|int
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|direction
condition|)
block|{
case|case
name|FORWARD_SCROLL
case|:
name|tuiScrollForward
argument_list|(
name|winToScroll
argument_list|,
name|numToScroll
argument_list|)
expr_stmt|;
break|break;
case|case
name|BACKWARD_SCROLL
case|:
name|tuiScrollBackward
argument_list|(
name|winToScroll
argument_list|,
name|numToScroll
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEFT_SCROLL
case|:
name|tuiScrollLeft
argument_list|(
name|winToScroll
argument_list|,
name|numToScroll
argument_list|)
expr_stmt|;
break|break;
case|case
name|RIGHT_SCROLL
case|:
name|tuiScrollRight
argument_list|(
name|winToScroll
argument_list|,
name|numToScroll
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tui_vScroll */
end_comment

begin_comment
comment|/* ** tuiRefreshAll(). */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiRefreshAll
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|tuiRefreshAll
parameter_list|()
endif|#
directive|endif
block|{
name|TuiWinType
name|type
decl_stmt|;
name|refreshAll
argument_list|(
name|winList
argument_list|)
expr_stmt|;
for|for
control|(
name|type
operator|=
name|SRC_WIN
init|;
name|type
operator|<
name|MAX_MAJOR_WINDOWS
condition|;
name|type
operator|++
control|)
block|{
if|if
condition|(
name|winList
index|[
name|type
index|]
operator|->
name|generic
operator|.
name|isVisible
condition|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|SRC_WIN
case|:
case|case
name|DISASSEM_WIN
case|:
name|tuiClearWin
argument_list|(
operator|&
name|winList
index|[
name|type
index|]
operator|->
name|generic
argument_list|)
expr_stmt|;
if|if
condition|(
name|winList
index|[
name|type
index|]
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|hasLocator
condition|)
name|tuiClearLocatorDisplay
argument_list|()
expr_stmt|;
name|tuiShowSourceContent
argument_list|(
name|winList
index|[
name|type
index|]
argument_list|)
expr_stmt|;
name|checkAndDisplayHighlightIfNeeded
argument_list|(
name|winList
index|[
name|type
index|]
argument_list|)
expr_stmt|;
name|tuiEraseExecInfoContent
argument_list|(
name|winList
index|[
name|type
index|]
argument_list|)
expr_stmt|;
name|tuiUpdateExecInfo
argument_list|(
name|winList
index|[
name|type
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|DATA_WIN
case|:
name|tuiRefreshDataWin
argument_list|()
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
block|}
name|tuiClearLocatorDisplay
argument_list|()
expr_stmt|;
name|tuiShowLocatorContent
argument_list|()
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tuiRefreshAll */
end_comment

begin_comment
comment|/* ** tuiResizeAll(). **      Resize all the windows based on the the terminal size.  This **      function gets called from within the readline sinwinch handler. */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiResizeAll
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|tuiResizeAll
parameter_list|()
endif|#
directive|endif
block|{
name|int
name|heightDiff
decl_stmt|,
name|widthDiff
decl_stmt|;
specifier|extern
name|int
name|screenheight
decl_stmt|,
name|screenwidth
decl_stmt|;
comment|/* in readline */
name|widthDiff
operator|=
name|screenwidth
operator|-
name|termWidth
argument_list|()
expr_stmt|;
name|heightDiff
operator|=
name|screenheight
operator|-
name|termHeight
argument_list|()
expr_stmt|;
if|if
condition|(
name|heightDiff
operator|||
name|widthDiff
condition|)
block|{
name|TuiLayoutType
name|curLayout
init|=
name|currentLayout
argument_list|()
decl_stmt|;
name|TuiWinInfoPtr
name|winWithFocus
init|=
name|tuiWinWithFocus
argument_list|()
decl_stmt|;
name|TuiWinInfoPtr
name|firstWin
decl_stmt|,
name|secondWin
decl_stmt|;
name|TuiGenWinInfoPtr
name|locator
init|=
name|locatorWinInfoPtr
argument_list|()
decl_stmt|;
name|TuiWinType
name|winType
decl_stmt|;
name|int
name|i
decl_stmt|,
name|newHeight
decl_stmt|,
name|splitDiff
decl_stmt|,
name|cmdSplitDiff
decl_stmt|,
name|numWinsDisplayed
init|=
literal|2
decl_stmt|;
comment|/* turn keypad off while we resize */
if|if
condition|(
name|winWithFocus
operator|!=
name|cmdWin
condition|)
name|keypad
argument_list|(
name|cmdWin
operator|->
name|generic
operator|.
name|handle
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|init_page_info
argument_list|()
expr_stmt|;
name|setTermHeightTo
argument_list|(
name|screenheight
argument_list|)
expr_stmt|;
name|setTermWidthTo
argument_list|(
name|screenwidth
argument_list|)
expr_stmt|;
if|if
condition|(
name|curLayout
operator|==
name|SRC_DISASSEM_COMMAND
operator|||
name|curLayout
operator|==
name|SRC_DATA_COMMAND
operator|||
name|curLayout
operator|==
name|DISASSEM_DATA_COMMAND
condition|)
name|numWinsDisplayed
operator|++
expr_stmt|;
name|splitDiff
operator|=
name|heightDiff
operator|/
name|numWinsDisplayed
expr_stmt|;
name|cmdSplitDiff
operator|=
name|splitDiff
expr_stmt|;
if|if
condition|(
name|heightDiff
operator|%
name|numWinsDisplayed
condition|)
block|{
if|if
condition|(
name|heightDiff
operator|<
literal|0
condition|)
name|cmdSplitDiff
operator|--
expr_stmt|;
else|else
name|cmdSplitDiff
operator|++
expr_stmt|;
block|}
comment|/* now adjust each window */
name|clear
argument_list|()
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|curLayout
condition|)
block|{
case|case
name|SRC_COMMAND
case|:
case|case
name|DISASSEM_COMMAND
case|:
name|firstWin
operator|=
call|(
name|TuiWinInfoPtr
call|)
argument_list|(
name|sourceWindows
argument_list|()
argument_list|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
name|firstWin
operator|->
name|generic
operator|.
name|width
operator|+=
name|widthDiff
expr_stmt|;
name|locator
operator|->
name|width
operator|+=
name|widthDiff
expr_stmt|;
comment|/* check for invalid heights */
if|if
condition|(
name|heightDiff
operator|==
literal|0
condition|)
name|newHeight
operator|=
name|firstWin
operator|->
name|generic
operator|.
name|height
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|splitDiff
operator|)
operator|>=
operator|(
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
operator|)
condition|)
name|newHeight
operator|=
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|splitDiff
operator|)
operator|<=
literal|0
condition|)
name|newHeight
operator|=
name|MIN_WIN_HEIGHT
expr_stmt|;
else|else
name|newHeight
operator|=
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|splitDiff
expr_stmt|;
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|firstWin
argument_list|,
name|newHeight
argument_list|)
expr_stmt|;
name|cmdWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|locator
operator|->
name|origin
operator|.
name|y
operator|+
literal|1
expr_stmt|;
name|cmdWin
operator|->
name|generic
operator|.
name|width
operator|+=
name|widthDiff
expr_stmt|;
name|newHeight
operator|=
name|screenheight
operator|-
name|cmdWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
expr_stmt|;
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|cmdWin
argument_list|,
name|newHeight
argument_list|)
expr_stmt|;
name|_makeVisibleWithNewHeight
argument_list|(
name|firstWin
argument_list|)
expr_stmt|;
name|_makeVisibleWithNewHeight
argument_list|(
name|cmdWin
argument_list|)
expr_stmt|;
if|if
condition|(
name|firstWin
operator|->
name|generic
operator|.
name|contentSize
operator|<=
literal|0
condition|)
name|tuiEraseSourceContent
argument_list|(
name|firstWin
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|curLayout
operator|==
name|SRC_DISASSEM_COMMAND
condition|)
block|{
name|firstWin
operator|=
name|srcWin
expr_stmt|;
name|firstWin
operator|->
name|generic
operator|.
name|width
operator|+=
name|widthDiff
expr_stmt|;
name|secondWin
operator|=
name|disassemWin
expr_stmt|;
name|secondWin
operator|->
name|generic
operator|.
name|width
operator|+=
name|widthDiff
expr_stmt|;
block|}
else|else
block|{
name|firstWin
operator|=
name|dataWin
expr_stmt|;
name|firstWin
operator|->
name|generic
operator|.
name|width
operator|+=
name|widthDiff
expr_stmt|;
name|secondWin
operator|=
call|(
name|TuiWinInfoPtr
call|)
argument_list|(
name|sourceWindows
argument_list|()
argument_list|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
name|secondWin
operator|->
name|generic
operator|.
name|width
operator|+=
name|widthDiff
expr_stmt|;
block|}
comment|/* Change the first window's height/width */
comment|/* check for invalid heights */
if|if
condition|(
name|heightDiff
operator|==
literal|0
condition|)
name|newHeight
operator|=
name|firstWin
operator|->
name|generic
operator|.
name|height
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|+
operator|(
name|splitDiff
operator|*
literal|2
operator|)
operator|)
operator|>=
operator|(
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
operator|)
condition|)
name|newHeight
operator|=
operator|(
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|splitDiff
operator|)
operator|<=
literal|0
condition|)
name|newHeight
operator|=
name|MIN_WIN_HEIGHT
expr_stmt|;
else|else
name|newHeight
operator|=
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|splitDiff
expr_stmt|;
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|firstWin
argument_list|,
name|newHeight
argument_list|)
expr_stmt|;
if|if
condition|(
name|firstWin
operator|==
name|dataWin
operator|&&
name|widthDiff
operator|!=
literal|0
condition|)
name|firstWin
operator|->
name|detail
operator|.
name|dataDisplayInfo
operator|.
name|regsColumnCount
operator|=
name|tuiCalculateRegsColumnCount
argument_list|(
name|firstWin
operator|->
name|detail
operator|.
name|dataDisplayInfo
operator|.
name|regsDisplayType
argument_list|)
expr_stmt|;
name|locator
operator|->
name|width
operator|+=
name|widthDiff
expr_stmt|;
comment|/* Change the second window's height/width */
comment|/* check for invalid heights */
if|if
condition|(
name|heightDiff
operator|==
literal|0
condition|)
name|newHeight
operator|=
name|secondWin
operator|->
name|generic
operator|.
name|height
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|+
operator|(
name|splitDiff
operator|*
literal|2
operator|)
operator|)
operator|>=
operator|(
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
operator|)
condition|)
block|{
name|newHeight
operator|=
name|screenheight
operator|-
name|MIN_CMD_WIN_HEIGHT
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|newHeight
operator|%
literal|2
condition|)
name|newHeight
operator|=
operator|(
name|newHeight
operator|/
literal|2
operator|)
operator|+
literal|1
expr_stmt|;
else|else
name|newHeight
operator|/=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|+
name|splitDiff
operator|)
operator|<=
literal|0
condition|)
name|newHeight
operator|=
name|MIN_WIN_HEIGHT
expr_stmt|;
else|else
name|newHeight
operator|=
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|+
name|splitDiff
expr_stmt|;
name|secondWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|-
literal|1
expr_stmt|;
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|secondWin
argument_list|,
name|newHeight
argument_list|)
expr_stmt|;
comment|/* Change the command window's height/width */
name|cmdWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|locator
operator|->
name|origin
operator|.
name|y
operator|+
literal|1
expr_stmt|;
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|cmdWin
argument_list|,
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|+
name|cmdSplitDiff
argument_list|)
expr_stmt|;
name|_makeVisibleWithNewHeight
argument_list|(
name|firstWin
argument_list|)
expr_stmt|;
name|_makeVisibleWithNewHeight
argument_list|(
name|secondWin
argument_list|)
expr_stmt|;
name|_makeVisibleWithNewHeight
argument_list|(
name|cmdWin
argument_list|)
expr_stmt|;
if|if
condition|(
name|firstWin
operator|->
name|generic
operator|.
name|contentSize
operator|<=
literal|0
condition|)
name|tuiEraseSourceContent
argument_list|(
name|firstWin
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
if|if
condition|(
name|secondWin
operator|->
name|generic
operator|.
name|contentSize
operator|<=
literal|0
condition|)
name|tuiEraseSourceContent
argument_list|(
name|secondWin
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/*         ** Now remove all invisible windows, and their content so that they get         ** created again when called for with the new size         */
for|for
control|(
name|winType
operator|=
name|SRC_WIN
init|;
operator|(
name|winType
operator|<
name|MAX_MAJOR_WINDOWS
operator|)
condition|;
name|winType
operator|++
control|)
block|{
if|if
condition|(
name|winType
operator|!=
name|CMD_WIN
operator|&&
name|m_winPtrNotNull
argument_list|(
name|winList
index|[
name|winType
index|]
argument_list|)
operator|&&
operator|!
name|winList
index|[
name|winType
index|]
operator|->
name|generic
operator|.
name|isVisible
condition|)
block|{
name|freeWindow
argument_list|(
name|winList
index|[
name|winType
index|]
argument_list|)
expr_stmt|;
name|winList
index|[
name|winType
index|]
operator|=
operator|(
name|TuiWinInfoPtr
operator|)
name|NULL
expr_stmt|;
block|}
block|}
name|tuiSetWinResizedTo
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
comment|/* turn keypad back on, unless focus is in the command window */
if|if
condition|(
name|winWithFocus
operator|!=
name|cmdWin
condition|)
name|keypad
argument_list|(
name|cmdWin
operator|->
name|generic
operator|.
name|handle
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiResizeAll */
end_comment

begin_comment
comment|/* ** tuiSigwinchHandler() **    SIGWINCH signal handler for the tui.  This signal handler is **    always called, even when the readline package clears signals **    because it is set as the old_sigwinch() (TUI only) */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiSigwinchHandler
parameter_list|(
name|int
name|signal
parameter_list|)
else|#
directive|else
function|tuiSigwinchHandler
parameter_list|(
name|signal
parameter_list|)
name|int
name|signal
decl_stmt|;
endif|#
directive|endif
block|{
comment|/*     ** Say that a resize was done so that the readline can do it     ** later when appropriate.     */
name|tuiSetWinResizedTo
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tuiSigwinchHandler */
end_comment

begin_comment
comment|/************************* ** STATIC LOCAL FUNCTIONS **************************/
end_comment

begin_comment
comment|/* ** _tuiScrollForward_command(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiScrollForward_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiScrollForward_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
name|int
name|numToScroll
init|=
literal|1
decl_stmt|;
name|TuiWinInfoPtr
name|winToScroll
decl_stmt|;
if|if
condition|(
name|arg
operator|==
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
name|_parseScrollingArgs
argument_list|(
name|arg
argument_list|,
operator|&
name|winToScroll
argument_list|,
operator|(
name|int
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
else|else
name|_parseScrollingArgs
argument_list|(
name|arg
argument_list|,
operator|&
name|winToScroll
argument_list|,
operator|&
name|numToScroll
argument_list|)
expr_stmt|;
name|tuiDo
argument_list|(
operator|(
name|TuiOpaqueFuncPtr
operator|)
name|tui_vScroll
argument_list|,
name|FORWARD_SCROLL
argument_list|,
name|winToScroll
argument_list|,
name|numToScroll
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tuiScrollForward_command */
end_comment

begin_comment
comment|/* ** _tuiScrollBackward_command(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiScrollBackward_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiScrollBackward_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
name|int
name|numToScroll
init|=
literal|1
decl_stmt|;
name|TuiWinInfoPtr
name|winToScroll
decl_stmt|;
if|if
condition|(
name|arg
operator|==
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
name|_parseScrollingArgs
argument_list|(
name|arg
argument_list|,
operator|&
name|winToScroll
argument_list|,
operator|(
name|int
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
else|else
name|_parseScrollingArgs
argument_list|(
name|arg
argument_list|,
operator|&
name|winToScroll
argument_list|,
operator|&
name|numToScroll
argument_list|)
expr_stmt|;
name|tuiDo
argument_list|(
operator|(
name|TuiOpaqueFuncPtr
operator|)
name|tui_vScroll
argument_list|,
name|BACKWARD_SCROLL
argument_list|,
name|winToScroll
argument_list|,
name|numToScroll
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tuiScrollBackward_command */
end_comment

begin_comment
comment|/* ** _tuiScrollLeft_command(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiScrollLeft_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiScrollLeft_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
name|int
name|numToScroll
decl_stmt|;
name|TuiWinInfoPtr
name|winToScroll
decl_stmt|;
name|_parseScrollingArgs
argument_list|(
name|arg
argument_list|,
operator|&
name|winToScroll
argument_list|,
operator|&
name|numToScroll
argument_list|)
expr_stmt|;
name|tuiDo
argument_list|(
operator|(
name|TuiOpaqueFuncPtr
operator|)
name|tui_vScroll
argument_list|,
name|LEFT_SCROLL
argument_list|,
name|winToScroll
argument_list|,
name|numToScroll
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tuiScrollLeft_command */
end_comment

begin_comment
comment|/* ** _tuiScrollRight_command(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiScrollRight_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiScrollRight_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
name|int
name|numToScroll
decl_stmt|;
name|TuiWinInfoPtr
name|winToScroll
decl_stmt|;
name|_parseScrollingArgs
argument_list|(
name|arg
argument_list|,
operator|&
name|winToScroll
argument_list|,
operator|&
name|numToScroll
argument_list|)
expr_stmt|;
name|tuiDo
argument_list|(
operator|(
name|TuiOpaqueFuncPtr
operator|)
name|tui_vScroll
argument_list|,
name|RIGHT_SCROLL
argument_list|,
name|winToScroll
argument_list|,
name|numToScroll
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tuiScrollRight_command */
end_comment

begin_comment
comment|/* ** _tuiSetFocus(). **     Set focus to the window named by 'arg' */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiSetFocus
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiSetFocus
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|arg
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|char
modifier|*
name|bufPtr
init|=
operator|(
name|char
operator|*
operator|)
name|tuiStrDup
argument_list|(
name|arg
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|;
name|TuiWinInfoPtr
name|winInfo
init|=
operator|(
name|TuiWinInfoPtr
operator|)
name|NULL
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|i
operator|<
name|strlen
argument_list|(
name|bufPtr
argument_list|)
operator|)
condition|;
name|i
operator|++
control|)
name|bufPtr
index|[
name|i
index|]
operator|=
name|toupper
argument_list|(
name|arg
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
literal|"NEXT"
argument_list|)
condition|)
name|winInfo
operator|=
name|tuiNextWin
argument_list|(
name|tuiWinWithFocus
argument_list|()
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
literal|"PREV"
argument_list|)
condition|)
name|winInfo
operator|=
name|tuiPrevWin
argument_list|(
name|tuiWinWithFocus
argument_list|()
argument_list|)
expr_stmt|;
else|else
name|winInfo
operator|=
name|partialWinByName
argument_list|(
name|bufPtr
argument_list|)
expr_stmt|;
if|if
condition|(
name|winInfo
operator|==
operator|(
name|TuiWinInfoPtr
operator|)
name|NULL
operator|||
operator|!
name|winInfo
operator|->
name|generic
operator|.
name|isVisible
condition|)
name|warning
argument_list|(
literal|"Invalid window specified. \n\ The window name specified must be valid and visible.\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|tuiSetWinFocusTo
argument_list|(
name|winInfo
argument_list|)
expr_stmt|;
name|keypad
argument_list|(
name|cmdWin
operator|->
name|generic
operator|.
name|handle
argument_list|,
operator|(
name|winInfo
operator|!=
name|cmdWin
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dataWin
operator|->
name|generic
operator|.
name|isVisible
condition|)
name|tuiRefreshDataWin
argument_list|()
expr_stmt|;
name|tuiFree
argument_list|(
name|bufPtr
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|"Focus set to %s window.\n"
argument_list|,
name|winName
argument_list|(
operator|(
name|TuiGenWinInfoPtr
operator|)
name|tuiWinWithFocus
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
name|warning
argument_list|(
literal|"Incorrect Number of Arguments.\n%s"
argument_list|,
name|FOCUS_USAGE
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tuiSetFocus */
end_comment

begin_comment
comment|/* ** _tui_vSetFocus() */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tui_vSetFocus
parameter_list|(
name|va_list
name|args
parameter_list|)
else|#
directive|else
function|_tui_vSetFocus
parameter_list|(
name|args
parameter_list|)
name|va_list
name|args
decl_stmt|;
endif|#
directive|endif
block|{
name|char
modifier|*
name|arg
init|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|char
operator|*
argument_list|)
decl_stmt|;
name|int
name|fromTTY
init|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|int
argument_list|)
decl_stmt|;
name|_tuiSetFocus
argument_list|(
name|arg
argument_list|,
name|fromTTY
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tui_vSetFocus */
end_comment

begin_comment
comment|/* ** _tuiSetFocus_command() */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiSetFocus_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiSetFocus_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
name|tuiDo
argument_list|(
operator|(
name|TuiOpaqueFuncPtr
operator|)
name|_tui_vSetFocus
argument_list|,
name|arg
argument_list|,
name|fromTTY
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tui_SetFocus */
end_comment

begin_comment
comment|/* ** _tuiAllWindowsInfo(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiAllWindowsInfo
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiAllWindowsInfo
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiWinType
name|type
decl_stmt|;
name|TuiWinInfoPtr
name|winWithFocus
init|=
name|tuiWinWithFocus
argument_list|()
decl_stmt|;
for|for
control|(
name|type
operator|=
name|SRC_WIN
init|;
operator|(
name|type
operator|<
name|MAX_MAJOR_WINDOWS
operator|)
condition|;
name|type
operator|++
control|)
if|if
condition|(
name|winList
index|[
name|type
index|]
operator|->
name|generic
operator|.
name|isVisible
condition|)
block|{
if|if
condition|(
name|winWithFocus
operator|==
name|winList
index|[
name|type
index|]
condition|)
name|printf_filtered
argument_list|(
literal|"        %s\t(%d lines)<has focus>\n"
argument_list|,
name|winName
argument_list|(
operator|&
name|winList
index|[
name|type
index|]
operator|->
name|generic
argument_list|)
argument_list|,
name|winList
index|[
name|type
index|]
operator|->
name|generic
operator|.
name|height
argument_list|)
expr_stmt|;
else|else
name|printf_filtered
argument_list|(
literal|"        %s\t(%d lines)\n"
argument_list|,
name|winName
argument_list|(
operator|&
name|winList
index|[
name|type
index|]
operator|->
name|generic
argument_list|)
argument_list|,
name|winList
index|[
name|type
index|]
operator|->
name|generic
operator|.
name|height
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* _tuiAllWindowsInfo */
end_comment

begin_comment
comment|/* ** _tuiRefreshAll_command(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiRefreshAll_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiRefreshAll_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
name|tuiDo
argument_list|(
operator|(
name|TuiOpaqueFuncPtr
operator|)
name|tuiRefreshAll
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ** _tuiSetWinTabWidth_command(). **        Set the height of the specified window. */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiSetTabWidth_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiSetTabWidth_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|arg
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|int
name|ts
decl_stmt|;
name|ts
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|ts
operator|>
literal|0
condition|)
name|tuiSetDefaultTabLen
argument_list|(
name|ts
argument_list|)
expr_stmt|;
else|else
name|warning
argument_list|(
literal|"Tab widths greater than 0 must be specified.\n"
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* _tuiSetTabWidth_command */
end_comment

begin_comment
comment|/* ** _tuiSetWinHeight(). **        Set the height of the specified window. */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiSetWinHeight
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiSetWinHeight
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|arg
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|char
modifier|*
name|buf
init|=
name|tuiStrDup
argument_list|(
name|arg
argument_list|)
decl_stmt|;
name|char
modifier|*
name|bufPtr
init|=
name|buf
decl_stmt|;
name|char
modifier|*
name|wname
init|=
operator|(
name|char
operator|*
operator|)
name|NULL
decl_stmt|;
name|int
name|newHeight
decl_stmt|,
name|i
decl_stmt|;
name|TuiWinInfoPtr
name|winInfo
decl_stmt|;
name|wname
operator|=
name|bufPtr
expr_stmt|;
name|bufPtr
operator|=
name|strchr
argument_list|(
name|bufPtr
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|bufPtr
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
operator|*
name|bufPtr
operator|=
operator|(
name|char
operator|)
literal|0
expr_stmt|;
comment|/*             ** Validate the window name             */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|strlen
argument_list|(
name|wname
argument_list|)
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|toupper
argument_list|(
name|wname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|winInfo
operator|=
name|partialWinByName
argument_list|(
name|wname
argument_list|)
expr_stmt|;
if|if
condition|(
name|winInfo
operator|==
operator|(
name|TuiWinInfoPtr
operator|)
name|NULL
operator|||
operator|!
name|winInfo
operator|->
name|generic
operator|.
name|isVisible
condition|)
name|warning
argument_list|(
literal|"Invalid window specified. \n\ The window name specified must be valid and visible.\n"
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* Process the size */
while|while
condition|(
operator|*
operator|(
operator|++
name|bufPtr
operator|)
operator|==
literal|' '
condition|)
empty_stmt|;
if|if
condition|(
operator|*
name|bufPtr
operator|!=
operator|(
name|char
operator|)
literal|0
condition|)
block|{
name|int
name|negate
init|=
name|FALSE
decl_stmt|;
name|int
name|fixedSize
init|=
name|TRUE
decl_stmt|;
name|int
name|inputNo
decl_stmt|;
empty_stmt|;
if|if
condition|(
operator|*
name|bufPtr
operator|==
literal|'+'
operator|||
operator|*
name|bufPtr
operator|==
literal|'-'
condition|)
block|{
if|if
condition|(
operator|*
name|bufPtr
operator|==
literal|'-'
condition|)
name|negate
operator|=
name|TRUE
expr_stmt|;
name|fixedSize
operator|=
name|FALSE
expr_stmt|;
name|bufPtr
operator|++
expr_stmt|;
block|}
name|inputNo
operator|=
name|atoi
argument_list|(
name|bufPtr
argument_list|)
expr_stmt|;
if|if
condition|(
name|inputNo
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|negate
condition|)
name|inputNo
operator|*=
operator|(
operator|-
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|fixedSize
condition|)
name|newHeight
operator|=
name|inputNo
expr_stmt|;
else|else
name|newHeight
operator|=
name|winInfo
operator|->
name|generic
operator|.
name|height
operator|+
name|inputNo
expr_stmt|;
comment|/*                         ** Now change the window's height, and adjust all                         ** other windows around it                         */
if|if
condition|(
name|_tuiAdjustWinHeights
argument_list|(
name|winInfo
argument_list|,
name|newHeight
argument_list|)
operator|==
name|TUI_FAILURE
condition|)
name|warning
argument_list|(
literal|"Invalid window height specified.\n%s"
argument_list|,
name|WIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
else|else
name|init_page_info
argument_list|()
expr_stmt|;
block|}
else|else
name|warning
argument_list|(
literal|"Invalid window height specified.\n%s"
argument_list|,
name|WIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
name|printf_filtered
argument_list|(
name|WIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
name|tuiFree
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
else|else
name|printf_filtered
argument_list|(
name|WIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tuiSetWinHeight */
end_comment

begin_comment
comment|/* ** _tui_vSetWinHeight(). **        Set the height of the specified window, with va_list. */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tui_vSetWinHeight
parameter_list|(
name|va_list
name|args
parameter_list|)
else|#
directive|else
function|_tui_vSetWinHeight
parameter_list|(
name|args
parameter_list|)
name|va_list
name|args
decl_stmt|;
endif|#
directive|endif
block|{
name|char
modifier|*
name|arg
init|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|char
operator|*
argument_list|)
decl_stmt|;
name|int
name|fromTTY
init|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|int
argument_list|)
decl_stmt|;
name|_tuiSetWinHeight
argument_list|(
name|arg
argument_list|,
name|fromTTY
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tui_vSetWinHeight */
end_comment

begin_comment
comment|/* ** _tuiSetWinHeight_command(). **        Set the height of the specified window, with va_list. */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiSetWinHeight_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiSetWinHeight_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
name|tuiDo
argument_list|(
operator|(
name|TuiOpaqueFuncPtr
operator|)
name|_tui_vSetWinHeight
argument_list|,
name|arg
argument_list|,
name|fromTTY
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tuiSetWinHeight_command */
end_comment

begin_comment
comment|/* ** _tuiXDBsetWinHeight(). **        XDB Compatibility command for setting the window height.  This will **        increase or decrease the command window by the specified amount. */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiXDBsetWinHeight
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiXDBsetWinHeight
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|arg
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|int
name|inputNo
init|=
name|atoi
argument_list|(
name|arg
argument_list|)
decl_stmt|;
if|if
condition|(
name|inputNo
operator|>
literal|0
condition|)
block|{
comment|/* Add 1 for the locator */
name|int
name|newHeight
init|=
name|termHeight
argument_list|()
operator|-
operator|(
name|inputNo
operator|+
literal|1
operator|)
decl_stmt|;
if|if
condition|(
operator|!
name|_newHeightOk
argument_list|(
name|winList
index|[
name|CMD_WIN
index|]
argument_list|,
name|newHeight
argument_list|)
operator|||
name|_tuiAdjustWinHeights
argument_list|(
name|winList
index|[
name|CMD_WIN
index|]
argument_list|,
name|newHeight
argument_list|)
operator|==
name|TUI_FAILURE
condition|)
name|warning
argument_list|(
literal|"Invalid window height specified.\n%s"
argument_list|,
name|XDBWIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
block|}
else|else
name|warning
argument_list|(
literal|"Invalid window height specified.\n%s"
argument_list|,
name|XDBWIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
block|}
else|else
name|warning
argument_list|(
literal|"Invalid window height specified.\n%s"
argument_list|,
name|XDBWIN_HEIGHT_USAGE
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tuiXDBsetWinHeight */
end_comment

begin_comment
comment|/* ** _tui_vXDBsetWinHeight(). **        Set the height of the specified window, with va_list. */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tui_vXDBsetWinHeight
parameter_list|(
name|va_list
name|args
parameter_list|)
else|#
directive|else
function|_tui_vXDBsetWinHeight
parameter_list|(
name|args
parameter_list|)
name|va_list
name|args
decl_stmt|;
endif|#
directive|endif
block|{
name|char
modifier|*
name|arg
init|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|char
operator|*
argument_list|)
decl_stmt|;
name|int
name|fromTTY
init|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|int
argument_list|)
decl_stmt|;
name|_tuiXDBsetWinHeight
argument_list|(
name|arg
argument_list|,
name|fromTTY
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tui_vXDBsetWinHeight */
end_comment

begin_comment
comment|/* ** _tuiSetWinHeight_command(). **        Set the height of the specified window, with va_list. */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiXDBsetWinHeight_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiXDBsetWinHeight_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
name|tuiDo
argument_list|(
operator|(
name|TuiOpaqueFuncPtr
operator|)
name|_tui_vXDBsetWinHeight
argument_list|,
name|arg
argument_list|,
name|fromTTY
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tuiXDBsetWinHeight_command */
end_comment

begin_comment
comment|/* ** _tuiAdjustWinHeights(). **        Function to adjust all window heights around the primary */
end_comment

begin_function
specifier|static
name|TuiStatus
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiAdjustWinHeights
parameter_list|(
name|TuiWinInfoPtr
name|primaryWinInfo
parameter_list|,
name|int
name|newHeight
parameter_list|)
else|#
directive|else
function|_tuiAdjustWinHeights
parameter_list|(
name|primaryWinInfo
parameter_list|,
name|newHeight
parameter_list|)
name|TuiWinInfoPtr
name|primaryWinInfo
decl_stmt|;
name|int
name|newHeight
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiStatus
name|status
init|=
name|TUI_FAILURE
decl_stmt|;
if|if
condition|(
name|_newHeightOk
argument_list|(
name|primaryWinInfo
argument_list|,
name|newHeight
argument_list|)
condition|)
block|{
name|status
operator|=
name|TUI_SUCCESS
expr_stmt|;
if|if
condition|(
name|newHeight
operator|!=
name|primaryWinInfo
operator|->
name|generic
operator|.
name|height
condition|)
block|{
name|int
name|i
decl_stmt|,
name|diff
decl_stmt|;
name|TuiWinInfoPtr
name|winInfo
decl_stmt|;
name|TuiGenWinInfoPtr
name|locator
init|=
name|locatorWinInfoPtr
argument_list|()
decl_stmt|;
name|TuiLayoutType
name|curLayout
init|=
name|currentLayout
argument_list|()
decl_stmt|;
name|diff
operator|=
operator|(
name|newHeight
operator|-
name|primaryWinInfo
operator|->
name|generic
operator|.
name|height
operator|)
operator|*
operator|(
operator|-
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|curLayout
operator|==
name|SRC_COMMAND
operator|||
name|curLayout
operator|==
name|DISASSEM_COMMAND
condition|)
block|{
name|TuiWinInfoPtr
name|srcWinInfo
decl_stmt|;
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|primaryWinInfo
argument_list|,
name|newHeight
argument_list|)
expr_stmt|;
if|if
condition|(
name|primaryWinInfo
operator|->
name|generic
operator|.
name|type
operator|==
name|CMD_WIN
condition|)
block|{
name|winInfo
operator|=
call|(
name|TuiWinInfoPtr
call|)
argument_list|(
name|sourceWindows
argument_list|()
argument_list|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
name|srcWinInfo
operator|=
name|winInfo
expr_stmt|;
block|}
else|else
block|{
name|winInfo
operator|=
name|winList
index|[
name|CMD_WIN
index|]
expr_stmt|;
name|srcWinInfo
operator|=
name|primaryWinInfo
expr_stmt|;
block|}
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|winInfo
argument_list|,
name|winInfo
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
argument_list|)
expr_stmt|;
name|cmdWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|locator
operator|->
name|origin
operator|.
name|y
operator|+
literal|1
expr_stmt|;
name|_makeVisibleWithNewHeight
argument_list|(
name|winInfo
argument_list|)
expr_stmt|;
name|_makeVisibleWithNewHeight
argument_list|(
name|primaryWinInfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|srcWinInfo
operator|->
name|generic
operator|.
name|contentSize
operator|<=
literal|0
condition|)
name|tuiEraseSourceContent
argument_list|(
name|srcWinInfo
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|TuiWinInfoPtr
name|firstWin
decl_stmt|,
name|secondWin
decl_stmt|;
if|if
condition|(
name|curLayout
operator|==
name|SRC_DISASSEM_COMMAND
condition|)
block|{
name|firstWin
operator|=
name|srcWin
expr_stmt|;
name|secondWin
operator|=
name|disassemWin
expr_stmt|;
block|}
else|else
block|{
name|firstWin
operator|=
name|dataWin
expr_stmt|;
name|secondWin
operator|=
call|(
name|TuiWinInfoPtr
call|)
argument_list|(
name|sourceWindows
argument_list|()
argument_list|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
block|}
if|if
condition|(
name|primaryWinInfo
operator|==
name|cmdWin
condition|)
block|{
comment|/*                     ** Split the change in height accross the 1st& 2nd windows                     ** adjusting them as well.                     */
name|int
name|firstSplitDiff
init|=
name|diff
operator|/
literal|2
decl_stmt|;
comment|/* subtract the locator */
name|int
name|secondSplitDiff
init|=
name|firstSplitDiff
decl_stmt|;
if|if
condition|(
name|diff
operator|%
literal|2
condition|)
block|{
if|if
condition|(
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|>
name|secondWin
operator|->
name|generic
operator|.
name|height
condition|)
if|if
condition|(
name|diff
operator|<
literal|0
condition|)
name|firstSplitDiff
operator|--
expr_stmt|;
else|else
name|firstSplitDiff
operator|++
expr_stmt|;
else|else
block|{
if|if
condition|(
name|diff
operator|<
literal|0
condition|)
name|secondSplitDiff
operator|--
expr_stmt|;
else|else
name|secondSplitDiff
operator|++
expr_stmt|;
block|}
block|}
comment|/* make sure that the minimum hieghts are honored */
while|while
condition|(
operator|(
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|firstSplitDiff
operator|)
operator|<
literal|3
condition|)
block|{
name|firstSplitDiff
operator|++
expr_stmt|;
name|secondSplitDiff
operator|--
expr_stmt|;
block|}
while|while
condition|(
operator|(
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|+
name|secondSplitDiff
operator|)
operator|<
literal|3
condition|)
block|{
name|secondSplitDiff
operator|++
expr_stmt|;
name|firstSplitDiff
operator|--
expr_stmt|;
block|}
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|firstWin
argument_list|,
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|firstSplitDiff
argument_list|)
expr_stmt|;
name|secondWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|-
literal|1
expr_stmt|;
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|secondWin
argument_list|,
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|+
name|secondSplitDiff
argument_list|)
expr_stmt|;
name|cmdWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|locator
operator|->
name|origin
operator|.
name|y
operator|+
literal|1
expr_stmt|;
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|cmdWin
argument_list|,
name|newHeight
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|<
literal|1
condition|)
block|{
comment|/*                         ** If there is no way to increase the command window                         ** take real estate from the 1st or 2nd window.                         */
if|if
condition|(
operator|(
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|<
literal|1
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
init|;
operator|(
name|i
operator|<
literal|1
operator|)
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|primaryWinInfo
operator|==
name|firstWin
condition|)
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|--
expr_stmt|;
else|else
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|--
expr_stmt|;
block|}
block|}
if|if
condition|(
name|primaryWinInfo
operator|==
name|firstWin
condition|)
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|firstWin
argument_list|,
name|newHeight
argument_list|)
expr_stmt|;
else|else
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|firstWin
argument_list|,
name|firstWin
operator|->
name|generic
operator|.
name|height
argument_list|)
expr_stmt|;
name|secondWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|primaryWinInfo
operator|==
name|secondWin
condition|)
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|secondWin
argument_list|,
name|newHeight
argument_list|)
expr_stmt|;
else|else
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|secondWin
argument_list|,
name|secondWin
operator|->
name|generic
operator|.
name|height
argument_list|)
expr_stmt|;
name|cmdWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|=
name|locator
operator|->
name|origin
operator|.
name|y
operator|+
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|<
literal|1
condition|)
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|cmdWin
argument_list|,
literal|1
argument_list|)
expr_stmt|;
else|else
name|_makeInvisibleAndSetNewHeight
argument_list|(
name|cmdWin
argument_list|,
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
argument_list|)
expr_stmt|;
block|}
name|_makeVisibleWithNewHeight
argument_list|(
name|cmdWin
argument_list|)
expr_stmt|;
name|_makeVisibleWithNewHeight
argument_list|(
name|secondWin
argument_list|)
expr_stmt|;
name|_makeVisibleWithNewHeight
argument_list|(
name|firstWin
argument_list|)
expr_stmt|;
if|if
condition|(
name|firstWin
operator|->
name|generic
operator|.
name|contentSize
operator|<=
literal|0
condition|)
name|tuiEraseSourceContent
argument_list|(
name|firstWin
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
if|if
condition|(
name|secondWin
operator|->
name|generic
operator|.
name|contentSize
operator|<=
literal|0
condition|)
name|tuiEraseSourceContent
argument_list|(
name|secondWin
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
block|}
block|}
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/* _tuiAdjustWinHeights */
end_comment

begin_comment
comment|/* ** _makeInvisibleAndSetNewHeight(). **        Function make the target window (and auxillary windows associated **        with the targer) invisible, and set the new height and location. */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_makeInvisibleAndSetNewHeight
parameter_list|(
name|TuiWinInfoPtr
name|winInfo
parameter_list|,
name|int
name|height
parameter_list|)
else|#
directive|else
function|_makeInvisibleAndSetNewHeight
parameter_list|(
name|winInfo
parameter_list|,
name|height
parameter_list|)
name|TuiWinInfoPtr
name|winInfo
decl_stmt|;
name|int
name|height
decl_stmt|;
endif|#
directive|endif
block|{
name|int
name|i
decl_stmt|;
name|struct
name|symtab
modifier|*
name|s
decl_stmt|;
name|TuiGenWinInfoPtr
name|genWinInfo
decl_stmt|;
name|m_beInvisible
argument_list|(
operator|&
name|winInfo
operator|->
name|generic
argument_list|)
expr_stmt|;
name|winInfo
operator|->
name|generic
operator|.
name|height
operator|=
name|height
expr_stmt|;
if|if
condition|(
name|height
operator|>
literal|1
condition|)
name|winInfo
operator|->
name|generic
operator|.
name|viewportHeight
operator|=
name|height
operator|-
literal|1
expr_stmt|;
else|else
name|winInfo
operator|->
name|generic
operator|.
name|viewportHeight
operator|=
name|height
expr_stmt|;
if|if
condition|(
name|winInfo
operator|!=
name|cmdWin
condition|)
name|winInfo
operator|->
name|generic
operator|.
name|viewportHeight
operator|--
expr_stmt|;
comment|/* Now deal with the auxillary windows associated with winInfo */
switch|switch
condition|(
name|winInfo
operator|->
name|generic
operator|.
name|type
condition|)
block|{
case|case
name|SRC_WIN
case|:
case|case
name|DISASSEM_WIN
case|:
name|genWinInfo
operator|=
name|winInfo
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
expr_stmt|;
name|m_beInvisible
argument_list|(
name|genWinInfo
argument_list|)
expr_stmt|;
name|genWinInfo
operator|->
name|height
operator|=
name|height
expr_stmt|;
name|genWinInfo
operator|->
name|origin
operator|.
name|y
operator|=
name|winInfo
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
expr_stmt|;
if|if
condition|(
name|height
operator|>
literal|1
condition|)
name|genWinInfo
operator|->
name|viewportHeight
operator|=
name|height
operator|-
literal|1
expr_stmt|;
else|else
name|genWinInfo
operator|->
name|viewportHeight
operator|=
name|height
expr_stmt|;
if|if
condition|(
name|winInfo
operator|!=
name|cmdWin
condition|)
name|genWinInfo
operator|->
name|viewportHeight
operator|--
expr_stmt|;
if|if
condition|(
name|m_hasLocator
argument_list|(
name|winInfo
argument_list|)
condition|)
block|{
name|genWinInfo
operator|=
name|locatorWinInfoPtr
argument_list|()
expr_stmt|;
name|m_beInvisible
argument_list|(
name|genWinInfo
argument_list|)
expr_stmt|;
name|genWinInfo
operator|->
name|origin
operator|.
name|y
operator|=
name|winInfo
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
operator|+
name|height
expr_stmt|;
block|}
break|break;
case|case
name|DATA_WIN
case|:
comment|/* delete all data item windows */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|winInfo
operator|->
name|generic
operator|.
name|contentSize
condition|;
name|i
operator|++
control|)
block|{
name|genWinInfo
operator|=
operator|(
name|TuiGenWinInfoPtr
operator|)
operator|&
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|winInfo
operator|->
name|generic
operator|.
name|content
index|[
name|i
index|]
operator|)
operator|->
name|whichElement
operator|.
name|dataWindow
expr_stmt|;
name|tuiDelwin
argument_list|(
name|genWinInfo
operator|->
name|handle
argument_list|)
expr_stmt|;
name|genWinInfo
operator|->
name|handle
operator|=
operator|(
name|WINDOW
operator|*
operator|)
name|NULL
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* _makeInvisibleAndSetNewHeight */
end_comment

begin_comment
comment|/* ** _makeVisibleWithNewHeight(). **        Function to make the windows with new heights visible. **        This means re-creating the windows' content since the window **        had to be destroyed to be made invisible. */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_makeVisibleWithNewHeight
parameter_list|(
name|TuiWinInfoPtr
name|winInfo
parameter_list|)
else|#
directive|else
function|_makeVisibleWithNewHeight
parameter_list|(
name|winInfo
parameter_list|)
name|TuiWinInfoPtr
name|winInfo
decl_stmt|;
endif|#
directive|endif
block|{
name|int
name|i
decl_stmt|;
name|struct
name|symtab
modifier|*
name|s
decl_stmt|;
name|m_beVisible
argument_list|(
operator|&
name|winInfo
operator|->
name|generic
argument_list|)
expr_stmt|;
name|checkAndDisplayHighlightIfNeeded
argument_list|(
name|winInfo
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|winInfo
operator|->
name|generic
operator|.
name|type
condition|)
block|{
case|case
name|SRC_WIN
case|:
case|case
name|DISASSEM_WIN
case|:
name|freeWinContent
argument_list|(
name|winInfo
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
argument_list|)
expr_stmt|;
name|m_beVisible
argument_list|(
name|winInfo
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|winInfo
operator|->
name|generic
operator|.
name|content
operator|!=
operator|(
name|OpaquePtr
operator|)
name|NULL
condition|)
block|{
name|TuiLineOrAddress
name|lineOrAddr
decl_stmt|;
if|if
condition|(
name|winInfo
operator|->
name|generic
operator|.
name|type
operator|==
name|SRC_WIN
condition|)
name|lineOrAddr
operator|.
name|lineNo
operator|=
name|winInfo
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|startLineOrAddr
operator|.
name|lineNo
expr_stmt|;
else|else
name|lineOrAddr
operator|.
name|addr
operator|=
name|winInfo
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|startLineOrAddr
operator|.
name|addr
expr_stmt|;
name|freeWinContent
argument_list|(
operator|&
name|winInfo
operator|->
name|generic
argument_list|)
expr_stmt|;
name|tuiUpdateSourceWindow
argument_list|(
name|winInfo
argument_list|,
name|current_source_symtab
argument_list|,
operator|(
operator|(
name|winInfo
operator|->
name|generic
operator|.
name|type
operator|==
name|SRC_WIN
operator|)
condition|?
operator|(
name|Opaque
operator|)
name|lineOrAddr
operator|.
name|lineNo
else|:
name|lineOrAddr
operator|.
name|addr
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|selected_frame
operator|!=
operator|(
expr|struct
name|frame_info
operator|*
operator|)
name|NULL
condition|)
block|{
name|Opaque
name|line
init|=
literal|0
decl_stmt|;
specifier|extern
name|int
name|current_source_line
decl_stmt|;
name|s
operator|=
name|find_pc_symtab
argument_list|(
name|selected_frame
operator|->
name|pc
argument_list|)
expr_stmt|;
if|if
condition|(
name|winInfo
operator|->
name|generic
operator|.
name|type
operator|==
name|SRC_WIN
condition|)
name|line
operator|=
operator|(
name|Opaque
operator|)
name|current_source_line
expr_stmt|;
else|else
name|line
operator|=
operator|(
name|Opaque
operator|)
name|find_line_pc
argument_list|(
name|s
argument_list|,
name|current_source_line
argument_list|)
expr_stmt|;
name|tuiUpdateSourceWindow
argument_list|(
name|winInfo
argument_list|,
name|s
argument_list|,
name|line
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|m_hasLocator
argument_list|(
name|winInfo
argument_list|)
condition|)
block|{
name|m_beVisible
argument_list|(
name|locatorWinInfoPtr
argument_list|()
argument_list|)
expr_stmt|;
name|tuiClearLocatorDisplay
argument_list|()
expr_stmt|;
name|tuiShowLocatorContent
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
name|DATA_WIN
case|:
name|tuiDisplayAllData
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_WIN
case|:
name|winInfo
operator|->
name|detail
operator|.
name|commandInfo
operator|.
name|curLine
operator|=
literal|0
expr_stmt|;
name|winInfo
operator|->
name|detail
operator|.
name|commandInfo
operator|.
name|curch
operator|=
literal|0
expr_stmt|;
name|wmove
argument_list|(
name|winInfo
operator|->
name|generic
operator|.
name|handle
argument_list|,
name|winInfo
operator|->
name|detail
operator|.
name|commandInfo
operator|.
name|curLine
argument_list|,
name|winInfo
operator|->
name|detail
operator|.
name|commandInfo
operator|.
name|curch
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* _makeVisibleWithNewHeight */
end_comment

begin_function
specifier|static
name|int
ifdef|#
directive|ifdef
name|__STDC__
name|_newHeightOk
parameter_list|(
name|TuiWinInfoPtr
name|primaryWinInfo
parameter_list|,
name|int
name|newHeight
parameter_list|)
else|#
directive|else
function|_newHeightOk
parameter_list|(
name|primaryWinInfo
parameter_list|,
name|newHeight
parameter_list|)
name|TuiWinInfoPtr
name|primaryWinInfo
decl_stmt|;
name|int
name|newHeight
decl_stmt|;
endif|#
directive|endif
block|{
name|int
name|ok
init|=
operator|(
name|newHeight
operator|<
name|termHeight
argument_list|()
operator|)
decl_stmt|;
if|if
condition|(
name|ok
condition|)
block|{
name|int
name|diff
decl_stmt|,
name|curHeight
decl_stmt|;
name|TuiLayoutType
name|curLayout
init|=
name|currentLayout
argument_list|()
decl_stmt|;
name|diff
operator|=
operator|(
name|newHeight
operator|-
name|primaryWinInfo
operator|->
name|generic
operator|.
name|height
operator|)
operator|*
operator|(
operator|-
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|curLayout
operator|==
name|SRC_COMMAND
operator|||
name|curLayout
operator|==
name|DISASSEM_COMMAND
condition|)
block|{
name|ok
operator|=
operator|(
operator|(
name|primaryWinInfo
operator|->
name|generic
operator|.
name|type
operator|==
name|CMD_WIN
operator|&&
name|newHeight
operator|<=
operator|(
name|termHeight
argument_list|()
operator|-
literal|4
operator|)
operator|&&
name|newHeight
operator|>=
name|MIN_CMD_WIN_HEIGHT
operator|)
operator|||
operator|(
name|primaryWinInfo
operator|->
name|generic
operator|.
name|type
operator|!=
name|CMD_WIN
operator|&&
name|newHeight
operator|<=
operator|(
name|termHeight
argument_list|()
operator|-
literal|2
operator|)
operator|&&
name|newHeight
operator|>=
name|MIN_WIN_HEIGHT
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|ok
condition|)
block|{
comment|/* check the total height */
name|TuiWinInfoPtr
name|winInfo
decl_stmt|;
if|if
condition|(
name|primaryWinInfo
operator|==
name|cmdWin
condition|)
name|winInfo
operator|=
call|(
name|TuiWinInfoPtr
call|)
argument_list|(
name|sourceWindows
argument_list|()
argument_list|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
else|else
name|winInfo
operator|=
name|cmdWin
expr_stmt|;
name|ok
operator|=
operator|(
operator|(
name|newHeight
operator|+
operator|(
name|winInfo
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|)
operator|<=
name|termHeight
argument_list|()
operator|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|int
name|curTotalHeight
decl_stmt|,
name|totalHeight
decl_stmt|,
name|minHeight
decl_stmt|;
name|TuiWinInfoPtr
name|firstWin
decl_stmt|,
name|secondWin
decl_stmt|;
if|if
condition|(
name|curLayout
operator|==
name|SRC_DISASSEM_COMMAND
condition|)
block|{
name|firstWin
operator|=
name|srcWin
expr_stmt|;
name|secondWin
operator|=
name|disassemWin
expr_stmt|;
block|}
else|else
block|{
name|firstWin
operator|=
name|dataWin
expr_stmt|;
name|secondWin
operator|=
call|(
name|TuiWinInfoPtr
call|)
argument_list|(
name|sourceWindows
argument_list|()
argument_list|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
block|}
comment|/*             ** We could simply add all the heights to obtain the same result             ** but below is more explicit since we subtract 1 for the             ** line that the first and second windows share, and add one             ** for the locator.             */
name|curTotalHeight
operator|=
operator|(
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|-
literal|1
operator|)
operator|+
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|+
literal|1
comment|/*locator*/
expr_stmt|;
if|if
condition|(
name|primaryWinInfo
operator|==
name|cmdWin
condition|)
block|{
comment|/* locator included since first& second win share a line */
name|ok
operator|=
operator|(
operator|(
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|>=
operator|(
name|MIN_WIN_HEIGHT
operator|*
literal|2
operator|)
operator|&&
name|newHeight
operator|>=
name|MIN_CMD_WIN_HEIGHT
operator|)
expr_stmt|;
if|if
condition|(
name|ok
condition|)
block|{
name|totalHeight
operator|=
name|newHeight
operator|+
operator|(
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
expr_stmt|;
name|minHeight
operator|=
name|MIN_CMD_WIN_HEIGHT
expr_stmt|;
block|}
block|}
else|else
block|{
name|minHeight
operator|=
name|MIN_WIN_HEIGHT
expr_stmt|;
comment|/*                 ** First see if we can increase/decrease the command                 ** window.  And make sure that the command window is                 ** at least 1 line                 */
name|ok
operator|=
operator|(
operator|(
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|>
literal|0
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|ok
condition|)
block|{
comment|/*                      ** Looks like we have to increase/decrease one of                      ** the other windows                      */
if|if
condition|(
name|primaryWinInfo
operator|==
name|firstWin
condition|)
name|ok
operator|=
operator|(
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|>=
name|minHeight
expr_stmt|;
else|else
name|ok
operator|=
operator|(
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
operator|)
operator|>=
name|minHeight
expr_stmt|;
block|}
if|if
condition|(
name|ok
condition|)
block|{
if|if
condition|(
name|primaryWinInfo
operator|==
name|firstWin
condition|)
name|totalHeight
operator|=
name|newHeight
operator|+
name|secondWin
operator|->
name|generic
operator|.
name|height
operator|+
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
expr_stmt|;
else|else
name|totalHeight
operator|=
name|newHeight
operator|+
name|firstWin
operator|->
name|generic
operator|.
name|height
operator|+
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|+
name|diff
expr_stmt|;
block|}
block|}
comment|/*             ** Now make sure that the proposed total height doesn't exceed             ** the old total height.             */
if|if
condition|(
name|ok
condition|)
name|ok
operator|=
operator|(
name|newHeight
operator|>=
name|minHeight
operator|&&
name|totalHeight
operator|<=
name|curTotalHeight
operator|)
expr_stmt|;
block|}
block|}
return|return
name|ok
return|;
block|}
end_function

begin_comment
comment|/* _newHeightOk */
end_comment

begin_comment
comment|/* ** _parseScrollingArgs(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_parseScrollingArgs
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|TuiWinInfoPtr
modifier|*
name|winToScroll
parameter_list|,
name|int
modifier|*
name|numToScroll
parameter_list|)
else|#
directive|else
function|_parseScrollingArgs
parameter_list|(
name|arg
parameter_list|,
name|winToScroll
parameter_list|,
name|numToScroll
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|TuiWinInfoPtr
modifier|*
name|winToScroll
decl_stmt|;
name|int
modifier|*
name|numToScroll
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|numToScroll
condition|)
operator|*
name|numToScroll
operator|=
literal|0
expr_stmt|;
operator|*
name|winToScroll
operator|=
name|tuiWinWithFocus
argument_list|()
expr_stmt|;
comment|/*     ** First set up the default window to scroll, in case there is no     ** window name arg     */
if|if
condition|(
name|arg
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|char
modifier|*
name|buf
decl_stmt|,
modifier|*
name|bufPtr
decl_stmt|;
comment|/* process the number of lines to scroll */
name|buf
operator|=
name|bufPtr
operator|=
name|tuiStrDup
argument_list|(
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|isdigit
argument_list|(
operator|*
name|bufPtr
argument_list|)
condition|)
block|{
name|char
modifier|*
name|numStr
decl_stmt|;
name|numStr
operator|=
name|bufPtr
expr_stmt|;
name|bufPtr
operator|=
name|strchr
argument_list|(
name|bufPtr
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|bufPtr
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
operator|*
name|bufPtr
operator|=
operator|(
name|char
operator|)
literal|0
expr_stmt|;
if|if
condition|(
name|numToScroll
condition|)
operator|*
name|numToScroll
operator|=
name|atoi
argument_list|(
name|numStr
argument_list|)
expr_stmt|;
name|bufPtr
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|numToScroll
condition|)
operator|*
name|numToScroll
operator|=
name|atoi
argument_list|(
name|numStr
argument_list|)
expr_stmt|;
block|}
comment|/* process the window name if one is specified */
if|if
condition|(
name|bufPtr
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|char
modifier|*
name|wname
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|*
name|bufPtr
operator|==
literal|' '
condition|)
while|while
condition|(
operator|*
operator|(
operator|++
name|bufPtr
operator|)
operator|==
literal|' '
condition|)
empty_stmt|;
if|if
condition|(
operator|*
name|bufPtr
operator|!=
operator|(
name|char
operator|)
literal|0
condition|)
name|wname
operator|=
name|bufPtr
expr_stmt|;
comment|/* Validate the window name */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|strlen
argument_list|(
name|wname
argument_list|)
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|toupper
argument_list|(
name|wname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
operator|*
name|winToScroll
operator|=
name|partialWinByName
argument_list|(
name|wname
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|winToScroll
operator|==
operator|(
name|TuiWinInfoPtr
operator|)
name|NULL
operator|||
operator|!
operator|(
operator|*
name|winToScroll
operator|)
operator|->
name|generic
operator|.
name|isVisible
condition|)
name|warning
argument_list|(
literal|"Invalid window specified. \n\ The window name specified must be valid and visible.\n"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|winToScroll
operator|==
name|cmdWin
condition|)
operator|*
name|winToScroll
operator|=
call|(
name|TuiWinInfoPtr
call|)
argument_list|(
name|sourceWindows
argument_list|()
argument_list|)
operator|->
name|list
index|[
literal|0
index|]
expr_stmt|;
block|}
name|tuiFree
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* _parseScrollingArgs */
end_comment

end_unit

