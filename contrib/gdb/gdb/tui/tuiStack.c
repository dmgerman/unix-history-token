begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* ** This module contains functions for displaying the locator information in the locator window. */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"symtab.h"
end_include

begin_include
include|#
directive|include
file|"breakpoint.h"
end_include

begin_include
include|#
directive|include
file|"frame.h"
end_include

begin_include
include|#
directive|include
file|"tui.h"
end_include

begin_include
include|#
directive|include
file|"tuiData.h"
end_include

begin_include
include|#
directive|include
file|"tuiStack.h"
end_include

begin_include
include|#
directive|include
file|"tuiSourceWin.h"
end_include

begin_comment
comment|/***************************************** ** STATIC LOCAL FUNCTIONS FORWARD DECLS    ** ******************************************/
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|_getFuncNameFromFrame
name|PARAMS
argument_list|(
operator|(
expr|struct
name|frame_info
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiUpdateLocation_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/***************************************** ** PUBLIC FUNCTION                        ** ******************************************/
end_comment

begin_comment
comment|/* ** tuiClearLocatorDisplay() */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiClearLocatorDisplay
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|tuiClearLocatorDisplay
parameter_list|()
endif|#
directive|endif
block|{
name|TuiGenWinInfoPtr
name|locator
init|=
name|locatorWinInfoPtr
argument_list|()
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|locator
operator|->
name|handle
operator|!=
operator|(
name|WINDOW
operator|*
operator|)
name|NULL
condition|)
block|{
comment|/* No need to werase, since writing a line of          * blanks which we do below, is equivalent.          */
comment|/* werase(locator->handle); */
name|wmove
argument_list|(
name|locator
operator|->
name|handle
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wstandout
argument_list|(
name|locator
operator|->
name|handle
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|locator
operator|->
name|width
condition|;
name|i
operator|++
control|)
name|waddch
argument_list|(
name|locator
operator|->
name|handle
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
name|wstandend
argument_list|(
name|locator
operator|->
name|handle
argument_list|)
expr_stmt|;
name|tuiRefreshWin
argument_list|(
name|locator
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|locator
operator|->
name|handle
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|locator
operator|->
name|contentInUse
operator|=
name|FALSE
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiClearLocatorDisplay */
end_comment

begin_comment
comment|/* ** tuiShowLocatorContent() */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiShowLocatorContent
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|tuiShowLocatorContent
parameter_list|()
endif|#
directive|endif
block|{
name|char
modifier|*
name|string
decl_stmt|;
name|TuiGenWinInfoPtr
name|locator
decl_stmt|;
name|locator
operator|=
name|locatorWinInfoPtr
argument_list|()
expr_stmt|;
if|if
condition|(
name|m_genWinPtrNotNull
argument_list|(
name|locator
argument_list|)
operator|&&
name|locator
operator|->
name|handle
operator|!=
operator|(
name|WINDOW
operator|*
operator|)
name|NULL
condition|)
block|{
name|string
operator|=
name|displayableWinContentAt
argument_list|(
name|locator
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|string
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
name|wmove
argument_list|(
name|locator
operator|->
name|handle
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wstandout
argument_list|(
name|locator
operator|->
name|handle
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|locator
operator|->
name|handle
argument_list|,
name|string
argument_list|)
expr_stmt|;
name|wstandend
argument_list|(
name|locator
operator|->
name|handle
argument_list|)
expr_stmt|;
name|tuiRefreshWin
argument_list|(
name|locator
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|locator
operator|->
name|handle
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|string
operator|!=
name|nullStr
argument_list|()
condition|)
name|tuiFree
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|locator
operator|->
name|contentInUse
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiShowLocatorContent */
end_comment

begin_comment
comment|/* ** tuiSetLocatorInfo(). **        Function to update the locator, with the provided arguments. */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiSetLocatorInfo
parameter_list|(
name|char
modifier|*
name|fname
parameter_list|,
name|char
modifier|*
name|procname
parameter_list|,
name|int
name|lineNo
parameter_list|,
name|Opaque
name|addr
parameter_list|,
name|TuiLocatorElementPtr
name|element
parameter_list|)
else|#
directive|else
function|tuiSetLocatorInfo
parameter_list|(
name|fname
parameter_list|,
name|procname
parameter_list|,
name|lineNo
parameter_list|,
name|addr
parameter_list|,
name|element
parameter_list|)
name|char
modifier|*
name|fname
decl_stmt|;
name|char
modifier|*
name|procname
decl_stmt|;
name|int
name|lineNo
decl_stmt|;
name|Opaque
name|addr
decl_stmt|;
name|TuiLocatorElementPtr
name|element
decl_stmt|;
endif|#
directive|endif
block|{
ifdef|#
directive|ifdef
name|COMMENT
comment|/* first free the old info */
if|if
condition|(
name|element
operator|->
name|fileName
condition|)
name|tuiFree
argument_list|(
name|element
operator|->
name|fileName
argument_list|)
expr_stmt|;
if|if
condition|(
name|element
operator|->
name|procName
condition|)
name|tuiFree
argument_list|(
name|element
operator|->
name|procName
argument_list|)
expr_stmt|;
if|if
condition|(
name|fname
operator|==
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
name|element
operator|->
name|fileName
operator|=
name|fname
expr_stmt|;
else|else
name|element
operator|->
name|fileName
operator|=
name|tuiStrDup
argument_list|(
name|fname
argument_list|)
expr_stmt|;
if|if
condition|(
name|procname
operator|==
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
name|element
operator|->
name|procName
operator|=
name|procname
expr_stmt|;
else|else
name|element
operator|->
name|procName
operator|=
name|tuiStrDup
argument_list|(
name|procname
argument_list|)
expr_stmt|;
else|#
directive|else
name|element
operator|->
name|fileName
index|[
literal|0
index|]
operator|=
operator|(
name|char
operator|)
literal|0
expr_stmt|;
name|element
operator|->
name|procName
index|[
literal|0
index|]
operator|=
operator|(
name|char
operator|)
literal|0
expr_stmt|;
name|strcat_to_buf
argument_list|(
name|element
operator|->
name|fileName
argument_list|,
name|MAX_LOCATOR_ELEMENT_LEN
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|strcat_to_buf
argument_list|(
name|element
operator|->
name|procName
argument_list|,
name|MAX_LOCATOR_ELEMENT_LEN
argument_list|,
name|procname
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|element
operator|->
name|lineNo
operator|=
name|lineNo
expr_stmt|;
name|element
operator|->
name|addr
operator|=
operator|(
name|Opaque
operator|)
name|addr
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tuiSetLocatorInfo */
end_comment

begin_comment
comment|/* ** tuiUpdateLocatorFilename(). **        Update only the filename portion of the locator. */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiUpdateLocatorFilename
parameter_list|(
name|char
modifier|*
name|fileName
parameter_list|)
else|#
directive|else
function|tuiUpdateLocatorFilename
parameter_list|(
name|fileName
parameter_list|)
name|char
modifier|*
name|fileName
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiGenWinInfoPtr
name|locator
init|=
name|locatorWinInfoPtr
argument_list|()
decl_stmt|;
if|if
condition|(
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|==
operator|(
name|Opaque
operator|)
name|NULL
condition|)
name|tuiSetLocatorContent
argument_list|(
operator|(
expr|struct
name|frame_info
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
operator|.
name|fileName
index|[
literal|0
index|]
operator|=
operator|(
name|char
operator|)
literal|0
expr_stmt|;
name|strcat_to_buf
argument_list|(
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
operator|.
name|fileName
argument_list|,
name|MAX_LOCATOR_ELEMENT_LEN
argument_list|,
name|fileName
argument_list|)
expr_stmt|;
name|tuiShowLocatorContent
argument_list|()
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tuiUpdateLocatorFilename */
end_comment

begin_comment
comment|/* ** tui_vUpdateLocatorFilename(). **        Update only the filename portion of the locator with args in a va_list. */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tui_vUpdateLocatorFilename
parameter_list|(
name|va_list
name|args
parameter_list|)
else|#
directive|else
function|tui_vUpdateLocatorFilename
parameter_list|(
name|args
parameter_list|)
name|va_list
name|args
decl_stmt|;
endif|#
directive|endif
block|{
name|char
modifier|*
name|fileName
decl_stmt|;
name|fileName
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
name|tuiUpdateLocatorFilename
argument_list|(
name|fileName
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tui_vUpdateLocatorFilename */
end_comment

begin_comment
comment|/* ** tuiSwitchFilename(). **   Update the filename portion of the locator. Clear the other info in locator. ** (elz) */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiSwitchFilename
parameter_list|(
name|char
modifier|*
name|fileName
parameter_list|)
else|#
directive|else
function|tuiSwitchFilename
parameter_list|(
name|fileName
parameter_list|)
name|char
modifier|*
name|fileName
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiGenWinInfoPtr
name|locator
init|=
name|locatorWinInfoPtr
argument_list|()
decl_stmt|;
if|if
condition|(
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|==
operator|(
name|Opaque
operator|)
name|NULL
condition|)
name|tuiSetLocatorContent
argument_list|(
operator|(
expr|struct
name|frame_info
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
operator|.
name|fileName
index|[
literal|0
index|]
operator|=
operator|(
name|char
operator|)
literal|0
expr_stmt|;
name|tuiSetLocatorInfo
argument_list|(
name|fileName
argument_list|,
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|,
literal|0
argument_list|,
operator|(
name|Opaque
operator|)
name|NULL
argument_list|,
operator|&
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
argument_list|)
expr_stmt|;
name|tuiShowLocatorContent
argument_list|()
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tuiSwitchFilename */
end_comment

begin_comment
comment|/* ** tuiGetLocatorFilename(). **   Get the filename portion of the locator. ** (elz) */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiGetLocatorFilename
parameter_list|(
name|TuiGenWinInfoPtr
name|locator
parameter_list|,
name|char
modifier|*
modifier|*
name|filename
parameter_list|)
else|#
directive|else
function|tuiGetLocatorFilename
parameter_list|(
name|locator
parameter_list|,
name|filename
parameter_list|)
name|TuiGenWinInfoPtr
name|locator
decl_stmt|;
name|char
modifier|*
modifier|*
name|filename
decl_stmt|;
endif|#
directive|endif
block|{
comment|/* the current filename could be non known, in which case the xmalloc would      allocate no memory, because the length would be 0 */
if|if
condition|(
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
operator|.
name|fileName
condition|)
block|{
name|int
name|name_length
init|=
name|strlen
argument_list|(
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
operator|.
name|fileName
argument_list|)
decl_stmt|;
operator|(
operator|*
name|filename
operator|)
operator|=
operator|(
name|char
operator|*
operator|)
name|xmalloc
argument_list|(
name|name_length
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
operator|(
operator|*
name|filename
operator|)
argument_list|,
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
operator|.
name|fileName
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiGetLocatorFilename */
end_comment

begin_comment
comment|/* ** tuiUpdateLocatorInfoFromFrame(). **        Function to update the locator, with the information extracted from frameInfo */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiUpdateLocatorInfoFromFrame
parameter_list|(
name|struct
name|frame_info
modifier|*
name|frameInfo
parameter_list|,
name|TuiLocatorElementPtr
name|element
parameter_list|)
else|#
directive|else
function|tuiUpdateLocatorInfoFromFrame
parameter_list|(
name|frameInfo
parameter_list|,
name|element
parameter_list|)
name|struct
name|frame_info
modifier|*
name|frameInfo
decl_stmt|;
name|TuiLocatorElementPtr
name|element
decl_stmt|;
endif|#
directive|endif
block|{
name|struct
name|symtab_and_line
name|symtabAndLine
decl_stmt|;
comment|/* now get the new info */
name|symtabAndLine
operator|=
name|find_pc_line
argument_list|(
name|frameInfo
operator|->
name|pc
argument_list|,
operator|(
name|frameInfo
operator|->
name|next
operator|!=
operator|(
expr|struct
name|frame_info
operator|*
operator|)
name|NULL
operator|&&
operator|!
name|frameInfo
operator|->
name|next
operator|->
name|signal_handler_caller
operator|&&
operator|!
name|frame_in_dummy
argument_list|(
name|frameInfo
operator|->
name|next
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|symtabAndLine
operator|.
name|symtab
operator|&&
name|symtabAndLine
operator|.
name|symtab
operator|->
name|filename
condition|)
name|tuiSetLocatorInfo
argument_list|(
name|symtabAndLine
operator|.
name|symtab
operator|->
name|filename
argument_list|,
name|_getFuncNameFromFrame
argument_list|(
name|frameInfo
argument_list|)
argument_list|,
name|symtabAndLine
operator|.
name|line
argument_list|,
operator|(
name|Opaque
operator|)
name|frameInfo
operator|->
name|pc
argument_list|,
name|element
argument_list|)
expr_stmt|;
else|else
name|tuiSetLocatorInfo
argument_list|(
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|,
name|_getFuncNameFromFrame
argument_list|(
name|frameInfo
argument_list|)
argument_list|,
literal|0
argument_list|,
operator|(
name|Opaque
operator|)
name|frameInfo
operator|->
name|pc
argument_list|,
name|element
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tuiUpdateLocatorInfoFromFrame */
end_comment

begin_comment
comment|/* ** tuiSetLocatorContent(). **        Function to set the content of the locator */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiSetLocatorContent
parameter_list|(
name|struct
name|frame_info
modifier|*
name|frameInfo
parameter_list|)
else|#
directive|else
function|tuiSetLocatorContent
parameter_list|(
name|frameInfo
parameter_list|)
name|struct
name|frame_info
modifier|*
name|frameInfo
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiGenWinInfoPtr
name|locator
init|=
name|locatorWinInfoPtr
argument_list|()
decl_stmt|;
name|TuiWinElementPtr
name|element
decl_stmt|;
name|struct
name|symtab_and_line
name|symtabAndLine
decl_stmt|;
comment|/* Allocate the element if necessary */
if|if
condition|(
name|locator
operator|->
name|contentSize
operator|<=
literal|0
condition|)
block|{
name|TuiWinContent
name|contentPtr
decl_stmt|;
if|if
condition|(
operator|(
name|locator
operator|->
name|content
operator|=
operator|(
name|OpaquePtr
operator|)
name|allocContent
argument_list|(
literal|1
argument_list|,
name|locator
operator|->
name|type
argument_list|)
operator|)
operator|==
operator|(
name|OpaquePtr
operator|)
name|NULL
condition|)
name|error
argument_list|(
literal|"Unable to Allocate Memory to Display Location."
argument_list|)
expr_stmt|;
name|locator
operator|->
name|contentSize
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|frameInfo
operator|!=
operator|(
expr|struct
name|frame_info
operator|*
operator|)
name|NULL
condition|)
name|tuiUpdateLocatorInfoFromFrame
argument_list|(
name|frameInfo
argument_list|,
operator|&
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
argument_list|)
expr_stmt|;
else|else
name|tuiSetLocatorInfo
argument_list|(
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|,
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|,
literal|0
argument_list|,
operator|(
name|Opaque
operator|)
name|NULL
argument_list|,
operator|&
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tuiSetLocatorContent */
end_comment

begin_comment
comment|/* ** tuiUpdateLocatorDisplay(). **        Function to update the locator display */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiUpdateLocatorDisplay
parameter_list|(
name|struct
name|frame_info
modifier|*
name|frameInfo
parameter_list|)
else|#
directive|else
function|tuiUpdateLocatorDisplay
parameter_list|(
name|frameInfo
parameter_list|)
name|struct
name|frame_info
modifier|*
name|frameInfo
decl_stmt|;
endif|#
directive|endif
block|{
name|tuiClearLocatorDisplay
argument_list|()
expr_stmt|;
name|tuiSetLocatorContent
argument_list|(
name|frameInfo
argument_list|)
expr_stmt|;
name|tuiShowLocatorContent
argument_list|()
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tuiUpdateLocatorDisplay */
end_comment

begin_comment
comment|/* ** tuiShowFrameInfo(). **        Function to print the frame inforrmation for the TUI. */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiShowFrameInfo
parameter_list|(
name|struct
name|frame_info
modifier|*
name|fi
parameter_list|)
else|#
directive|else
function|tuiShowFrameInfo
parameter_list|(
name|fi
parameter_list|)
name|struct
name|frame_info
modifier|*
name|fi
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiWinInfoPtr
name|winInfo
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
name|fi
condition|)
block|{
specifier|register
name|int
name|startLine
decl_stmt|,
name|i
decl_stmt|;
specifier|register
name|struct
name|symtab
modifier|*
name|s
decl_stmt|;
name|CORE_ADDR
name|low
decl_stmt|;
name|TuiGenWinInfoPtr
name|locator
init|=
name|locatorWinInfoPtr
argument_list|()
decl_stmt|;
name|int
name|sourceAlreadyDisplayed
decl_stmt|;
name|s
operator|=
name|find_pc_symtab
argument_list|(
name|fi
operator|->
name|pc
argument_list|)
expr_stmt|;
name|sourceAlreadyDisplayed
operator|=
name|tuiSourceIsDisplayed
argument_list|(
name|s
operator|->
name|filename
argument_list|)
expr_stmt|;
name|tuiUpdateLocatorDisplay
argument_list|(
name|fi
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|sourceWindows
argument_list|()
operator|)
operator|->
name|count
condition|;
name|i
operator|++
control|)
block|{
name|winInfo
operator|=
call|(
name|TuiWinInfoPtr
call|)
argument_list|(
name|sourceWindows
argument_list|()
argument_list|)
operator|->
name|list
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|winInfo
operator|==
name|srcWin
condition|)
block|{
name|startLine
operator|=
operator|(
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
operator|.
name|lineNo
operator|-
operator|(
name|winInfo
operator|->
name|generic
operator|.
name|viewportHeight
operator|/
literal|2
operator|)
operator|)
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|startLine
operator|<=
literal|0
condition|)
name|startLine
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|find_pc_partial_function
argument_list|(
name|fi
operator|->
name|pc
argument_list|,
operator|(
name|char
operator|*
operator|*
operator|)
name|NULL
argument_list|,
operator|&
name|low
argument_list|,
operator|(
name|CORE_ADDR
operator|)
name|NULL
argument_list|)
operator|==
literal|0
condition|)
name|error
argument_list|(
literal|"No function contains program counter for selected frame.\n"
argument_list|)
expr_stmt|;
else|else
name|low
operator|=
operator|(
name|CORE_ADDR
operator|)
name|tuiGetLowDisassemblyAddress
argument_list|(
operator|(
name|Opaque
operator|)
name|low
argument_list|,
operator|(
name|Opaque
operator|)
name|fi
operator|->
name|pc
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|winInfo
operator|==
name|srcWin
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|sourceAlreadyDisplayed
operator|&&
name|m_tuiLineDisplayedWithinThreshold
argument_list|(
name|winInfo
argument_list|,
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
operator|.
name|lineNo
argument_list|)
operator|)
condition|)
name|tuiUpdateSourceWindow
argument_list|(
name|winInfo
argument_list|,
name|s
argument_list|,
operator|(
name|Opaque
operator|)
name|startLine
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
else|else
name|tuiSetIsExecPointAt
argument_list|(
call|(
name|Opaque
call|)
argument_list|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
argument_list|)
operator|->
name|whichElement
operator|.
name|locator
operator|.
name|lineNo
argument_list|,
name|winInfo
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|winInfo
operator|==
name|disassemWin
condition|)
block|{
if|if
condition|(
operator|!
name|m_tuiLineDisplayedWithinThreshold
argument_list|(
name|winInfo
argument_list|,
operator|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
operator|)
operator|->
name|whichElement
operator|.
name|locator
operator|.
name|addr
argument_list|)
condition|)
name|tuiUpdateSourceWindow
argument_list|(
name|winInfo
argument_list|,
name|s
argument_list|,
operator|(
name|Opaque
operator|)
name|low
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
else|else
name|tuiSetIsExecPointAt
argument_list|(
call|(
name|Opaque
call|)
argument_list|(
operator|(
name|TuiWinElementPtr
operator|)
name|locator
operator|->
name|content
index|[
literal|0
index|]
argument_list|)
operator|->
name|whichElement
operator|.
name|locator
operator|.
name|addr
argument_list|,
name|winInfo
argument_list|)
expr_stmt|;
block|}
block|}
name|tuiUpdateExecInfo
argument_list|(
name|winInfo
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|tuiUpdateLocatorDisplay
argument_list|(
name|fi
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|sourceWindows
argument_list|()
operator|)
operator|->
name|count
condition|;
name|i
operator|++
control|)
block|{
name|winInfo
operator|=
call|(
name|TuiWinInfoPtr
call|)
argument_list|(
name|sourceWindows
argument_list|()
argument_list|)
operator|->
name|list
index|[
name|i
index|]
expr_stmt|;
name|tuiClearSourceContent
argument_list|(
name|winInfo
argument_list|,
name|EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
name|tuiUpdateExecInfo
argument_list|(
name|winInfo
argument_list|)
expr_stmt|;
block|}
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiShowFrameInfo */
end_comment

begin_comment
comment|/* ** tui_vShowFrameInfo(). **        Function to print the frame inforrmation for the TUI with args in a va_list. */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tui_vShowFrameInfo
parameter_list|(
name|va_list
name|args
parameter_list|)
else|#
directive|else
function|tui_vShowFrameInfo
parameter_list|(
name|args
parameter_list|)
name|va_list
name|args
decl_stmt|;
endif|#
directive|endif
block|{
name|struct
name|frame_info
modifier|*
name|fi
decl_stmt|;
name|fi
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
expr|struct
name|frame_info
operator|*
argument_list|)
expr_stmt|;
name|tuiShowFrameInfo
argument_list|(
name|fi
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tui_vShowFrameInfo */
end_comment

begin_comment
comment|/* ** _initialize_tuiStack(). **      Function to initialize gdb commands, for tui window stack manipulation. */
end_comment

begin_function
name|void
name|_initialize_tuiStack
parameter_list|()
block|{
if|if
condition|(
name|tui_version
condition|)
block|{
name|add_com
argument_list|(
literal|"update"
argument_list|,
name|class_tui
argument_list|,
name|_tuiUpdateLocation_command
argument_list|,
literal|"Update the source window and locator to display the current execution point.\n"
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* _initialize_tuiStack */
end_comment

begin_comment
comment|/***************************************** ** STATIC LOCAL FUNCTIONS                 ** ******************************************/
end_comment

begin_comment
comment|/* **    _getFuncNameFromFrame(). */
end_comment

begin_function
specifier|static
name|char
modifier|*
ifdef|#
directive|ifdef
name|__STDC__
name|_getFuncNameFromFrame
parameter_list|(
name|struct
name|frame_info
modifier|*
name|frameInfo
parameter_list|)
else|#
directive|else
function|_getFuncNameFromFrame
parameter_list|(
name|frameInfo
parameter_list|)
name|struct
name|frame_info
modifier|*
name|frameInfo
decl_stmt|;
endif|#
directive|endif
block|{
name|char
modifier|*
name|funcName
init|=
operator|(
name|char
operator|*
operator|)
name|NULL
decl_stmt|;
name|find_pc_partial_function
argument_list|(
name|frameInfo
operator|->
name|pc
argument_list|,
operator|&
name|funcName
argument_list|,
operator|(
name|CORE_ADDR
operator|*
operator|)
name|NULL
argument_list|,
operator|(
name|CORE_ADDR
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
return|return
name|funcName
return|;
block|}
end_function

begin_comment
comment|/* _getFuncNameFromFrame */
end_comment

begin_comment
comment|/* ** _tuiUpdateLocation_command(). **        Command to update the display with the current execution point */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiUpdateLocation_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiUpdateLocation_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
ifndef|#
directive|ifndef
name|TRY
specifier|extern
name|void
name|frame_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
name|frame_command
argument_list|(
literal|"0"
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
else|#
directive|else
name|struct
name|frame_info
modifier|*
name|curFrame
decl_stmt|;
comment|/* Obtain the current execution point */
if|if
condition|(
operator|(
name|curFrame
operator|=
name|get_current_frame
argument_list|()
operator|)
operator|!=
operator|(
expr|struct
name|frame_info
operator|*
operator|)
name|NULL
condition|)
block|{
name|struct
name|frame_info
modifier|*
name|frame
decl_stmt|;
name|int
name|curLevel
init|=
literal|0
decl_stmt|;
for|for
control|(
name|frame
operator|=
name|get_prev_frame
argument_list|(
name|curLevel
argument_list|)
init|;
operator|(
name|frame
operator|!=
operator|(
expr|struct
name|frame_info
operator|*
operator|)
name|NULL
operator|&&
operator|(
name|frame
operator|!=
name|curFrame
operator|)
operator|)
condition|;
name|frame
operator|=
name|get_prev_frame
argument_list|(
name|frame
argument_list|)
control|)
name|curLevel
operator|++
expr_stmt|;
if|if
condition|(
name|curFrame
operator|!=
operator|(
expr|struct
name|frame_info
operator|*
operator|)
name|NULL
condition|)
name|print_frame_info
argument_list|(
name|frame
argument_list|,
name|curLevel
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
return|return;
block|}
end_function

begin_comment
comment|/* _tuiUpdateLocation_command */
end_comment

end_unit

