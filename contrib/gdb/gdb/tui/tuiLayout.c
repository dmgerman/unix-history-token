begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* ** tuiLayout.c ** This module contains procedures for handling the layout of the windows. */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"command.h"
end_include

begin_include
include|#
directive|include
file|"symtab.h"
end_include

begin_include
include|#
directive|include
file|"frame.h"
end_include

begin_include
include|#
directive|include
file|"tui.h"
end_include

begin_include
include|#
directive|include
file|"tuiData.h"
end_include

begin_include
include|#
directive|include
file|"tuiGeneralWin.h"
end_include

begin_include
include|#
directive|include
file|"tuiStack.h"
end_include

begin_include
include|#
directive|include
file|"tuiRegs.h"
end_include

begin_include
include|#
directive|include
file|"tuiDisassem.h"
end_include

begin_comment
comment|/******************************* ** Static Local Decls ********************************/
end_comment

begin_decl_stmt
specifier|static
name|void
name|_initGenWinInfo
name|PARAMS
argument_list|(
operator|(
name|TuiGenWinInfoPtr
operator|,
name|TuiWinType
operator|,
name|int
operator|,
name|int
operator|,
name|int
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_initAndMakeWin
name|PARAMS
argument_list|(
operator|(
name|Opaque
operator|*
operator|,
name|TuiWinType
operator|,
name|int
operator|,
name|int
operator|,
name|int
operator|,
name|int
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_showSourceOrDisassemAndCommand
name|PARAMS
argument_list|(
operator|(
name|TuiLayoutType
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_makeSourceOrDisassemWindow
name|PARAMS
argument_list|(
operator|(
name|TuiWinInfoPtr
operator|*
operator|,
name|TuiWinType
operator|,
name|int
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_makeCommandWindow
name|PARAMS
argument_list|(
operator|(
name|TuiWinInfoPtr
operator|*
operator|,
name|int
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_makeSourceWindow
name|PARAMS
argument_list|(
operator|(
name|TuiWinInfoPtr
operator|*
operator|,
name|int
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_makeDisassemWindow
name|PARAMS
argument_list|(
operator|(
name|TuiWinInfoPtr
operator|*
operator|,
name|int
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_makeDataWindow
name|PARAMS
argument_list|(
operator|(
name|TuiWinInfoPtr
operator|*
operator|,
name|int
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_showSourceCommand
name|PARAMS
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_showDisassemCommand
name|PARAMS
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_showSourceDisassemCommand
name|PARAMS
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_showData
name|PARAMS
argument_list|(
operator|(
name|TuiLayoutType
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|TuiLayoutType
name|_nextLayout
name|PARAMS
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|TuiLayoutType
name|_prevLayout
name|PARAMS
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiLayout_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiToggleLayout_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tui_vToggleLayout_command
name|PARAMS
argument_list|(
operator|(
name|va_list
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiToggleSplitLayout_command
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tui_vToggleSplitLayout_command
name|PARAMS
argument_list|(
operator|(
name|va_list
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Opaque
name|_extractDisplayStartAddr
name|PARAMS
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|_tuiHandleXDBLayout
name|PARAMS
argument_list|(
operator|(
name|TuiLayoutDefPtr
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|TuiStatus
name|_tuiSetLayoutTo
name|PARAMS
argument_list|(
operator|(
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*************************************** ** DEFINITIONS ***************************************/
end_comment

begin_define
define|#
directive|define
name|LAYOUT_USAGE
value|"Usage: layout prev | next |<layout_name> \n"
end_define

begin_comment
comment|/*************************************** ** Static Local Data ***************************************/
end_comment

begin_decl_stmt
specifier|static
name|TuiLayoutType
name|lastLayout
init|=
name|UNDEFINED_LAYOUT
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*************************************** ** PUBLIC FUNCTIONS ***************************************/
end_comment

begin_comment
comment|/* ** showLayout(). **        Show the screen layout defined */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|showLayout
parameter_list|(
name|TuiLayoutType
name|layout
parameter_list|)
else|#
directive|else
function|showLayout
parameter_list|(
name|layout
parameter_list|)
name|TuiLayoutType
name|layout
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiLayoutType
name|curLayout
init|=
name|currentLayout
argument_list|()
decl_stmt|;
if|if
condition|(
name|layout
operator|!=
name|curLayout
condition|)
block|{
comment|/*         ** Since the new layout may cause changes in window size, we         ** should free the content and reallocate on next display of         ** source/asm         */
name|tuiClearAllSourceWinsContent
argument_list|(
name|NO_EMPTY_SOURCE_PROMPT
argument_list|)
expr_stmt|;
name|freeAllSourceWinsContent
argument_list|()
expr_stmt|;
name|clearSourceWindows
argument_list|()
expr_stmt|;
if|if
condition|(
name|layout
operator|==
name|SRC_DATA_COMMAND
operator|||
name|layout
operator|==
name|DISASSEM_DATA_COMMAND
condition|)
block|{
name|_showData
argument_list|(
name|layout
argument_list|)
expr_stmt|;
name|refreshAll
argument_list|(
name|winList
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* First make the current layout be invisible */
name|m_allBeInvisible
argument_list|()
expr_stmt|;
name|m_beInvisible
argument_list|(
name|locatorWinInfoPtr
argument_list|()
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|layout
condition|)
block|{
comment|/* Now show the new layout */
case|case
name|SRC_COMMAND
case|:
name|_showSourceCommand
argument_list|()
expr_stmt|;
name|addToSourceWindows
argument_list|(
name|srcWin
argument_list|)
expr_stmt|;
break|break;
case|case
name|DISASSEM_COMMAND
case|:
name|_showDisassemCommand
argument_list|()
expr_stmt|;
name|addToSourceWindows
argument_list|(
name|disassemWin
argument_list|)
expr_stmt|;
break|break;
case|case
name|SRC_DISASSEM_COMMAND
case|:
name|_showSourceDisassemCommand
argument_list|()
expr_stmt|;
name|addToSourceWindows
argument_list|(
name|srcWin
argument_list|)
expr_stmt|;
name|addToSourceWindows
argument_list|(
name|disassemWin
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
block|}
return|return;
block|}
end_function

begin_comment
comment|/* showLayout */
end_comment

begin_comment
comment|/* ** tuiSetLayout() **    Function to set the layout to SRC_COMMAND, DISASSEM_COMMAND, **    SRC_DISASSEM_COMMAND, SRC_DATA_COMMAND, or DISASSEM_DATA_COMMAND. **    If the layout is SRC_DATA_COMMAND, DISASSEM_DATA_COMMAND, or **    UNDEFINED_LAYOUT, then the data window is populated according **    to regsDisplayType. */
end_comment

begin_function
name|TuiStatus
ifdef|#
directive|ifdef
name|__STDC__
name|tuiSetLayout
parameter_list|(
name|TuiLayoutType
name|layoutType
parameter_list|,
name|TuiRegisterDisplayType
name|regsDisplayType
parameter_list|)
else|#
directive|else
function|tuiSetLayout
parameter_list|(
name|layoutType
parameter_list|,
name|regsDisplayType
parameter_list|)
name|TuiLayoutType
name|layoutType
decl_stmt|;
name|TuiRegisterDisplayType
name|regsDisplayType
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiStatus
name|status
init|=
name|TUI_SUCCESS
decl_stmt|;
if|if
condition|(
name|layoutType
operator|!=
name|UNDEFINED_LAYOUT
operator|||
name|regsDisplayType
operator|!=
name|TUI_UNDEFINED_REGS
condition|)
block|{
name|TuiLayoutType
name|curLayout
init|=
name|currentLayout
argument_list|()
decl_stmt|,
name|newLayout
init|=
name|UNDEFINED_LAYOUT
decl_stmt|;
name|int
name|regsPopulate
init|=
name|FALSE
decl_stmt|;
name|Opaque
name|addr
init|=
name|_extractDisplayStartAddr
argument_list|()
decl_stmt|;
name|TuiWinInfoPtr
name|newWinWithFocus
init|=
operator|(
name|TuiWinInfoPtr
operator|)
name|NULL
decl_stmt|,
name|winWithFocus
init|=
name|tuiWinWithFocus
argument_list|()
decl_stmt|;
name|TuiLayoutDefPtr
name|layoutDef
init|=
name|tuiLayoutDef
argument_list|()
decl_stmt|;
if|if
condition|(
name|layoutType
operator|==
name|UNDEFINED_LAYOUT
operator|&&
name|regsDisplayType
operator|!=
name|TUI_UNDEFINED_REGS
condition|)
block|{
if|if
condition|(
name|curLayout
operator|==
name|SRC_DISASSEM_COMMAND
condition|)
name|newLayout
operator|=
name|DISASSEM_DATA_COMMAND
expr_stmt|;
elseif|else
if|if
condition|(
name|curLayout
operator|==
name|SRC_COMMAND
operator|||
name|curLayout
operator|==
name|SRC_DATA_COMMAND
condition|)
name|newLayout
operator|=
name|SRC_DATA_COMMAND
expr_stmt|;
elseif|else
if|if
condition|(
name|curLayout
operator|==
name|DISASSEM_COMMAND
operator|||
name|curLayout
operator|==
name|DISASSEM_DATA_COMMAND
condition|)
name|newLayout
operator|=
name|DISASSEM_DATA_COMMAND
expr_stmt|;
block|}
else|else
name|newLayout
operator|=
name|layoutType
expr_stmt|;
name|regsPopulate
operator|=
operator|(
name|newLayout
operator|==
name|SRC_DATA_COMMAND
operator|||
name|newLayout
operator|==
name|DISASSEM_DATA_COMMAND
operator|||
name|regsDisplayType
operator|!=
name|TUI_UNDEFINED_REGS
operator|)
expr_stmt|;
if|if
condition|(
name|newLayout
operator|!=
name|curLayout
operator|||
name|regsDisplayType
operator|!=
name|TUI_UNDEFINED_REGS
condition|)
block|{
if|if
condition|(
name|newLayout
operator|!=
name|curLayout
condition|)
block|{
if|if
condition|(
name|winWithFocus
operator|!=
name|cmdWin
condition|)
name|tuiClearWinFocus
argument_list|()
expr_stmt|;
name|showLayout
argument_list|(
name|newLayout
argument_list|)
expr_stmt|;
comment|/*                 ** Now determine where focus should be                 */
if|if
condition|(
name|winWithFocus
operator|!=
name|cmdWin
condition|)
block|{
switch|switch
condition|(
name|newLayout
condition|)
block|{
case|case
name|SRC_COMMAND
case|:
name|tuiSetWinFocusTo
argument_list|(
name|srcWin
argument_list|)
expr_stmt|;
name|layoutDef
operator|->
name|displayMode
operator|=
name|SRC_WIN
expr_stmt|;
name|layoutDef
operator|->
name|split
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
name|DISASSEM_COMMAND
case|:
comment|/* the previous layout was not showing                             ** code. this can happen if there is no                             ** source available:                             ** 1. if the source file is in another dir OR                             ** 2. if target was compiled without -g                             ** We still want to show the assembly though!                             */
name|addr
operator|=
name|vcatch_errors
argument_list|(
operator|(
name|OpaqueFuncPtr
operator|)
name|tuiGetBeginAsmAddress
argument_list|)
expr_stmt|;
name|tuiSetWinFocusTo
argument_list|(
name|disassemWin
argument_list|)
expr_stmt|;
name|layoutDef
operator|->
name|displayMode
operator|=
name|DISASSEM_WIN
expr_stmt|;
name|layoutDef
operator|->
name|split
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
name|SRC_DISASSEM_COMMAND
case|:
comment|/* the previous layout was not showing                             ** code. this can happen if there is no                             ** source available:                             ** 1. if the source file is in another dir OR                             ** 2. if target was compiled without -g                             ** We still want to show the assembly though!                             */
name|addr
operator|=
name|vcatch_errors
argument_list|(
operator|(
name|OpaqueFuncPtr
operator|)
name|tuiGetBeginAsmAddress
argument_list|)
expr_stmt|;
if|if
condition|(
name|winWithFocus
operator|==
name|srcWin
condition|)
name|tuiSetWinFocusTo
argument_list|(
name|srcWin
argument_list|)
expr_stmt|;
else|else
name|tuiSetWinFocusTo
argument_list|(
name|disassemWin
argument_list|)
expr_stmt|;
name|layoutDef
operator|->
name|split
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|SRC_DATA_COMMAND
case|:
if|if
condition|(
name|winWithFocus
operator|!=
name|dataWin
condition|)
name|tuiSetWinFocusTo
argument_list|(
name|srcWin
argument_list|)
expr_stmt|;
else|else
name|tuiSetWinFocusTo
argument_list|(
name|dataWin
argument_list|)
expr_stmt|;
name|layoutDef
operator|->
name|displayMode
operator|=
name|SRC_WIN
expr_stmt|;
name|layoutDef
operator|->
name|split
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
name|DISASSEM_DATA_COMMAND
case|:
comment|/* the previous layout was not showing                             ** code. this can happen if there is no                             ** source available:                             ** 1. if the source file is in another dir OR                             ** 2. if target was compiled without -g                             ** We still want to show the assembly though!                             */
name|addr
operator|=
name|vcatch_errors
argument_list|(
operator|(
name|OpaqueFuncPtr
operator|)
name|tuiGetBeginAsmAddress
argument_list|)
expr_stmt|;
if|if
condition|(
name|winWithFocus
operator|!=
name|dataWin
condition|)
name|tuiSetWinFocusTo
argument_list|(
name|disassemWin
argument_list|)
expr_stmt|;
else|else
name|tuiSetWinFocusTo
argument_list|(
name|dataWin
argument_list|)
expr_stmt|;
name|layoutDef
operator|->
name|displayMode
operator|=
name|DISASSEM_WIN
expr_stmt|;
name|layoutDef
operator|->
name|split
operator|=
name|FALSE
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
if|if
condition|(
name|newWinWithFocus
operator|!=
operator|(
name|TuiWinInfoPtr
operator|)
name|NULL
condition|)
name|tuiSetWinFocusTo
argument_list|(
name|newWinWithFocus
argument_list|)
expr_stmt|;
comment|/*                 ** Now update the window content                 */
if|if
condition|(
operator|!
name|regsPopulate
operator|&&
operator|(
name|newLayout
operator|==
name|SRC_DATA_COMMAND
operator|||
name|newLayout
operator|==
name|DISASSEM_DATA_COMMAND
operator|)
condition|)
name|tuiDisplayAllData
argument_list|()
expr_stmt|;
name|tuiUpdateSourceWindowsWithAddr
argument_list|(
name|addr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|regsPopulate
condition|)
block|{
name|layoutDef
operator|->
name|regsDisplayType
operator|=
operator|(
name|regsDisplayType
operator|==
name|TUI_UNDEFINED_REGS
condition|?
name|TUI_GENERAL_REGS
else|:
name|regsDisplayType
operator|)
expr_stmt|;
name|tuiShowRegisters
argument_list|(
name|layoutDef
operator|->
name|regsDisplayType
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
name|status
operator|=
name|TUI_FAILURE
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/* tuiSetLayout */
end_comment

begin_comment
comment|/* ** tui_vSetLayoutTo() **        Function to set the layout to SRC, ASM, SPLIT, NEXT, PREV, DATA, **        REGS, $REGS, $GREGS, $FREGS, $SREGS with arguments in a va_list */
end_comment

begin_function
name|TuiStatus
ifdef|#
directive|ifdef
name|__STDC__
name|tui_vSetLayoutTo
parameter_list|(
name|va_list
name|args
parameter_list|)
else|#
directive|else
function|tui_vSetLayoutTo
parameter_list|(
name|args
parameter_list|)
name|va_list
name|args
decl_stmt|;
endif|#
directive|endif
block|{
name|char
modifier|*
name|layoutName
decl_stmt|;
name|layoutName
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
return|return
operator|(
name|_tuiSetLayoutTo
argument_list|(
name|layoutName
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/* tui_vSetLayoutTo */
end_comment

begin_comment
comment|/* ** tuiAddWinToLayout(). **        Add the specified window to the layout in a logical way. **        This means setting up the most logical layout given the **        window to be added. */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tuiAddWinToLayout
parameter_list|(
name|TuiWinType
name|type
parameter_list|)
else|#
directive|else
function|tuiAddWinToLayout
parameter_list|(
name|type
parameter_list|)
name|TuiWinType
name|type
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiLayoutType
name|curLayout
init|=
name|currentLayout
argument_list|()
decl_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|SRC_WIN
case|:
if|if
condition|(
name|curLayout
operator|!=
name|SRC_COMMAND
operator|&&
name|curLayout
operator|!=
name|SRC_DISASSEM_COMMAND
operator|&&
name|curLayout
operator|!=
name|SRC_DATA_COMMAND
condition|)
block|{
name|clearSourceWindowsDetail
argument_list|()
expr_stmt|;
if|if
condition|(
name|curLayout
operator|==
name|DISASSEM_DATA_COMMAND
condition|)
name|showLayout
argument_list|(
name|SRC_DATA_COMMAND
argument_list|)
expr_stmt|;
else|else
name|showLayout
argument_list|(
name|SRC_COMMAND
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DISASSEM_WIN
case|:
if|if
condition|(
name|curLayout
operator|!=
name|DISASSEM_COMMAND
operator|&&
name|curLayout
operator|!=
name|SRC_DISASSEM_COMMAND
operator|&&
name|curLayout
operator|!=
name|DISASSEM_DATA_COMMAND
condition|)
block|{
name|clearSourceWindowsDetail
argument_list|()
expr_stmt|;
if|if
condition|(
name|curLayout
operator|==
name|SRC_DATA_COMMAND
condition|)
name|showLayout
argument_list|(
name|DISASSEM_DATA_COMMAND
argument_list|)
expr_stmt|;
else|else
name|showLayout
argument_list|(
name|DISASSEM_COMMAND
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DATA_WIN
case|:
if|if
condition|(
name|curLayout
operator|!=
name|SRC_DATA_COMMAND
operator|&&
name|curLayout
operator|!=
name|DISASSEM_DATA_COMMAND
condition|)
block|{
if|if
condition|(
name|curLayout
operator|==
name|DISASSEM_COMMAND
condition|)
name|showLayout
argument_list|(
name|DISASSEM_DATA_COMMAND
argument_list|)
expr_stmt|;
else|else
name|showLayout
argument_list|(
name|SRC_DATA_COMMAND
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* tuiAddWinToLayout */
end_comment

begin_comment
comment|/* ** tui_vAddWinToLayout(). **        Add the specified window to the layout in a logical way, **        with arguments in a va_list. */
end_comment

begin_function
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|tui_vAddWinToLayout
parameter_list|(
name|va_list
name|args
parameter_list|)
else|#
directive|else
function|tui_vAddWinToLayout
parameter_list|(
name|args
parameter_list|)
name|va_list
name|args
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiWinType
name|type
init|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|TuiWinType
argument_list|)
decl_stmt|;
name|tuiAddWinToLayout
argument_list|(
name|type
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* tui_vAddWinToLayout */
end_comment

begin_comment
comment|/* ** tuiDefaultWinHeight(). **        Answer the height of a window.  If it hasn't been created yet, **        answer what the height of a window would be based upon its **        type and the layout. */
end_comment

begin_function
name|int
ifdef|#
directive|ifdef
name|__STDC__
name|tuiDefaultWinHeight
parameter_list|(
name|TuiWinType
name|type
parameter_list|,
name|TuiLayoutType
name|layout
parameter_list|)
else|#
directive|else
function|tuiDefaultWinHeight
parameter_list|(
name|type
parameter_list|,
name|layout
parameter_list|)
name|TuiWinType
name|type
decl_stmt|;
name|TuiLayoutType
name|layout
decl_stmt|;
endif|#
directive|endif
block|{
name|int
name|h
decl_stmt|;
if|if
condition|(
name|winList
index|[
name|type
index|]
operator|!=
operator|(
name|TuiWinInfoPtr
operator|)
name|NULL
condition|)
name|h
operator|=
name|winList
index|[
name|type
index|]
operator|->
name|generic
operator|.
name|height
expr_stmt|;
else|else
block|{
switch|switch
condition|(
name|layout
condition|)
block|{
case|case
name|SRC_COMMAND
case|:
case|case
name|DISASSEM_COMMAND
case|:
if|if
condition|(
name|m_winPtrIsNull
argument_list|(
name|cmdWin
argument_list|)
condition|)
name|h
operator|=
name|termHeight
argument_list|()
operator|/
literal|2
expr_stmt|;
else|else
name|h
operator|=
name|termHeight
argument_list|()
operator|-
name|cmdWin
operator|->
name|generic
operator|.
name|height
expr_stmt|;
break|break;
case|case
name|SRC_DISASSEM_COMMAND
case|:
case|case
name|SRC_DATA_COMMAND
case|:
case|case
name|DISASSEM_DATA_COMMAND
case|:
if|if
condition|(
name|m_winPtrIsNull
argument_list|(
name|cmdWin
argument_list|)
condition|)
name|h
operator|=
name|termHeight
argument_list|()
operator|/
literal|3
expr_stmt|;
else|else
name|h
operator|=
operator|(
name|termHeight
argument_list|()
operator|-
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|)
operator|/
literal|2
expr_stmt|;
break|break;
default|default:
name|h
operator|=
literal|0
expr_stmt|;
break|break;
block|}
block|}
return|return
name|h
return|;
block|}
end_function

begin_comment
comment|/* tuiDefaultWinHeight */
end_comment

begin_comment
comment|/* ** tuiDefaultWinViewportHeight(). **        Answer the height of a window.  If it hasn't been created yet, **        answer what the height of a window would be based upon its **        type and the layout. */
end_comment

begin_function
name|int
ifdef|#
directive|ifdef
name|__STDC__
name|tuiDefaultWinViewportHeight
parameter_list|(
name|TuiWinType
name|type
parameter_list|,
name|TuiLayoutType
name|layout
parameter_list|)
else|#
directive|else
function|tuiDefaultWinViewportHeight
parameter_list|(
name|type
parameter_list|,
name|layout
parameter_list|)
name|TuiWinType
name|type
decl_stmt|;
name|TuiLayoutType
name|layout
decl_stmt|;
endif|#
directive|endif
block|{
name|int
name|h
decl_stmt|;
name|h
operator|=
name|tuiDefaultWinHeight
argument_list|(
name|type
argument_list|,
name|layout
argument_list|)
expr_stmt|;
if|if
condition|(
name|winList
index|[
name|type
index|]
operator|==
name|cmdWin
condition|)
name|h
operator|-=
literal|1
expr_stmt|;
else|else
name|h
operator|-=
literal|2
expr_stmt|;
return|return
name|h
return|;
block|}
end_function

begin_comment
comment|/* tuiDefaultWinViewportHeight */
end_comment

begin_comment
comment|/* ** _initialize_tuiLayout(). **        Function to initialize gdb commands, for tui window layout **        manipulation. */
end_comment

begin_function
name|void
name|_initialize_tuiLayout
parameter_list|()
block|{
if|if
condition|(
name|tui_version
condition|)
block|{
name|add_com
argument_list|(
literal|"layout"
argument_list|,
name|class_tui
argument_list|,
name|_tuiLayout_command
argument_list|,
literal|"Change the layout of windows.\n\ Usage: layout prev | next |<layout_name> \n\ Layout names are:\n\    src   : Displays source and command windows.\n\    asm   : Displays disassembly and command windows.\n\    split : Displays source, disassembly and command windows.\n\    regs  : Displays register window. If existing layout\n\            is source/command or assembly/command, the \n\            register window is displayed. If the\n\            source/assembly/command (split) is displayed, \n\            the register window is displayed with \n\            the window that has current logical focus.\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|xdb_commands
condition|)
block|{
name|add_com
argument_list|(
literal|"td"
argument_list|,
name|class_tui
argument_list|,
name|_tuiToggleLayout_command
argument_list|,
literal|"Toggle between Source/Command and Disassembly/Command layouts.\n"
argument_list|)
expr_stmt|;
name|add_com
argument_list|(
literal|"ts"
argument_list|,
name|class_tui
argument_list|,
name|_tuiToggleSplitLayout_command
argument_list|,
literal|"Toggle between Source/Command or Disassembly/Command and \n\ Source/Disassembly/Command layouts.\n"
argument_list|)
expr_stmt|;
block|}
block|}
return|return;
block|}
end_function

begin_comment
comment|/* _intialize_tuiLayout */
end_comment

begin_comment
comment|/************************* ** STATIC LOCAL FUNCTIONS **************************/
end_comment

begin_comment
comment|/* ** _tuiSetLayoutTo() **    Function to set the layout to SRC, ASM, SPLIT, NEXT, PREV, DATA, REGS, **        $REGS, $GREGS, $FREGS, $SREGS. */
end_comment

begin_function
specifier|static
name|TuiStatus
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiSetLayoutTo
parameter_list|(
name|char
modifier|*
name|layoutName
parameter_list|)
else|#
directive|else
function|_tuiSetLayoutTo
parameter_list|(
name|layoutName
parameter_list|)
name|char
modifier|*
name|layoutName
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiStatus
name|status
init|=
name|TUI_SUCCESS
decl_stmt|;
if|if
condition|(
name|layoutName
operator|!=
operator|(
name|char
operator|*
operator|)
name|NULL
condition|)
block|{
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|char
modifier|*
name|bufPtr
decl_stmt|;
name|TuiLayoutType
name|newLayout
init|=
name|UNDEFINED_LAYOUT
decl_stmt|;
name|TuiRegisterDisplayType
name|dpyType
init|=
name|TUI_UNDEFINED_REGS
decl_stmt|;
name|TuiLayoutType
name|curLayout
init|=
name|currentLayout
argument_list|()
decl_stmt|;
name|bufPtr
operator|=
operator|(
name|char
operator|*
operator|)
name|tuiStrDup
argument_list|(
name|layoutName
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|i
operator|<
name|strlen
argument_list|(
name|layoutName
argument_list|)
operator|)
condition|;
name|i
operator|++
control|)
name|bufPtr
index|[
name|i
index|]
operator|=
name|toupper
argument_list|(
name|bufPtr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
comment|/* First check for ambiguous input */
if|if
condition|(
name|strlen
argument_list|(
name|bufPtr
argument_list|)
operator|<=
literal|1
operator|&&
operator|(
operator|*
name|bufPtr
operator|==
literal|'S'
operator|||
operator|*
name|bufPtr
operator|==
literal|'$'
operator|)
condition|)
block|{
name|warning
argument_list|(
literal|"Ambiguous command input.\n"
argument_list|)
expr_stmt|;
name|status
operator|=
name|TUI_FAILURE
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
literal|"SRC"
argument_list|)
condition|)
name|newLayout
operator|=
name|SRC_COMMAND
expr_stmt|;
elseif|else
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
literal|"ASM"
argument_list|)
condition|)
name|newLayout
operator|=
name|DISASSEM_COMMAND
expr_stmt|;
elseif|else
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
literal|"SPLIT"
argument_list|)
condition|)
name|newLayout
operator|=
name|SRC_DISASSEM_COMMAND
expr_stmt|;
elseif|else
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
literal|"REGS"
argument_list|)
operator|||
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
name|TUI_GENERAL_SPECIAL_REGS_NAME
argument_list|)
operator|||
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
name|TUI_GENERAL_REGS_NAME
argument_list|)
operator|||
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
name|TUI_FLOAT_REGS_NAME
argument_list|)
operator|||
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
name|TUI_SPECIAL_REGS_NAME
argument_list|)
condition|)
block|{
if|if
condition|(
name|curLayout
operator|==
name|SRC_COMMAND
operator|||
name|curLayout
operator|==
name|SRC_DATA_COMMAND
condition|)
name|newLayout
operator|=
name|SRC_DATA_COMMAND
expr_stmt|;
else|else
name|newLayout
operator|=
name|DISASSEM_DATA_COMMAND
expr_stmt|;
comment|/* could ifdef out the following code. when compile with -z, there are null     pointer references that cause a core dump if 'layout regs' is the first     layout command issued by the user. HP has asked us to hook up this code     - edie epstein  */
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
name|TUI_FLOAT_REGS_NAME
argument_list|)
condition|)
block|{
if|if
condition|(
name|dataWin
operator|->
name|detail
operator|.
name|dataDisplayInfo
operator|.
name|regsDisplayType
operator|!=
name|TUI_SFLOAT_REGS
operator|&&
name|dataWin
operator|->
name|detail
operator|.
name|dataDisplayInfo
operator|.
name|regsDisplayType
operator|!=
name|TUI_DFLOAT_REGS
condition|)
name|dpyType
operator|=
name|TUI_SFLOAT_REGS
expr_stmt|;
else|else
name|dpyType
operator|=
name|dataWin
operator|->
name|detail
operator|.
name|dataDisplayInfo
operator|.
name|regsDisplayType
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
name|TUI_GENERAL_SPECIAL_REGS_NAME
argument_list|)
condition|)
name|dpyType
operator|=
name|TUI_GENERAL_AND_SPECIAL_REGS
expr_stmt|;
elseif|else
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
name|TUI_GENERAL_REGS_NAME
argument_list|)
condition|)
name|dpyType
operator|=
name|TUI_GENERAL_REGS
expr_stmt|;
elseif|else
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
name|TUI_SPECIAL_REGS_NAME
argument_list|)
condition|)
name|dpyType
operator|=
name|TUI_SPECIAL_REGS
expr_stmt|;
else|else
block|{
if|if
condition|(
name|dataWin
operator|->
name|detail
operator|.
name|dataDisplayInfo
operator|.
name|regsDisplayType
operator|!=
name|TUI_UNDEFINED_REGS
condition|)
name|dpyType
operator|=
name|dataWin
operator|->
name|detail
operator|.
name|dataDisplayInfo
operator|.
name|regsDisplayType
expr_stmt|;
else|else
name|dpyType
operator|=
name|TUI_GENERAL_REGS
expr_stmt|;
block|}
comment|/* end of potential ifdef   */
comment|/* if ifdefed out code above, then assume that the user wishes to display the     general purpose registers   */
comment|/*              dpyType = TUI_GENERAL_REGS;   */
block|}
elseif|else
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
literal|"NEXT"
argument_list|)
condition|)
name|newLayout
operator|=
name|_nextLayout
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|subsetCompare
argument_list|(
name|bufPtr
argument_list|,
literal|"PREV"
argument_list|)
condition|)
name|newLayout
operator|=
name|_prevLayout
argument_list|()
expr_stmt|;
else|else
name|status
operator|=
name|TUI_FAILURE
expr_stmt|;
name|free
argument_list|(
name|bufPtr
argument_list|)
expr_stmt|;
name|tuiSetLayout
argument_list|(
name|newLayout
argument_list|,
name|dpyType
argument_list|)
expr_stmt|;
block|}
block|}
else|else
name|status
operator|=
name|TUI_FAILURE
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/* _tuiSetLayoutTo */
end_comment

begin_function
specifier|static
name|Opaque
ifdef|#
directive|ifdef
name|__STDC__
name|_extractDisplayStartAddr
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|_extractDisplayStartAddr
parameter_list|()
endif|#
directive|endif
block|{
name|TuiLayoutType
name|curLayout
init|=
name|currentLayout
argument_list|()
decl_stmt|;
name|Opaque
name|addr
decl_stmt|;
switch|switch
condition|(
name|curLayout
condition|)
block|{
case|case
name|SRC_COMMAND
case|:
case|case
name|SRC_DATA_COMMAND
case|:
name|addr
operator|=
operator|(
name|Opaque
operator|)
name|find_line_pc
argument_list|(
name|current_source_symtab
argument_list|,
name|srcWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|startLineOrAddr
operator|.
name|lineNo
argument_list|)
expr_stmt|;
break|break;
case|case
name|DISASSEM_COMMAND
case|:
case|case
name|SRC_DISASSEM_COMMAND
case|:
case|case
name|DISASSEM_DATA_COMMAND
case|:
name|addr
operator|=
name|disassemWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|startLineOrAddr
operator|.
name|addr
expr_stmt|;
break|break;
default|default:
name|addr
operator|=
operator|(
name|Opaque
operator|)
name|NULL
expr_stmt|;
break|break;
block|}
return|return
name|addr
return|;
block|}
end_function

begin_comment
comment|/* _extractDisplayStartAddr */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiHandleXDBLayout
parameter_list|(
name|TuiLayoutDefPtr
name|layoutDef
parameter_list|)
else|#
directive|else
function|_tuiHandleXDBLayout
parameter_list|(
name|layoutDef
parameter_list|)
name|TuiLayoutDefPtr
name|layoutDef
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|layoutDef
operator|->
name|split
condition|)
block|{
name|tuiSetLayout
argument_list|(
name|SRC_DISASSEM_COMMAND
argument_list|,
name|TUI_UNDEFINED_REGS
argument_list|)
expr_stmt|;
name|tuiSetWinFocusTo
argument_list|(
name|winList
index|[
name|layoutDef
operator|->
name|displayMode
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|layoutDef
operator|->
name|displayMode
operator|==
name|SRC_WIN
condition|)
name|tuiSetLayout
argument_list|(
name|SRC_COMMAND
argument_list|,
name|TUI_UNDEFINED_REGS
argument_list|)
expr_stmt|;
else|else
name|tuiSetLayout
argument_list|(
name|DISASSEM_DATA_COMMAND
argument_list|,
name|layoutDef
operator|->
name|regsDisplayType
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* _tuiHandleXDBLayout */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiToggleLayout_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiToggleLayout_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
name|tuiDo
argument_list|(
operator|(
name|TuiOpaqueFuncPtr
operator|)
name|_tui_vToggleLayout_command
argument_list|,
name|arg
argument_list|,
name|fromTTY
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tui_vToggleLayout_command
parameter_list|(
name|va_list
name|args
parameter_list|)
else|#
directive|else
function|_tui_vToggleLayout_command
parameter_list|(
name|args
parameter_list|)
name|va_list
name|args
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiLayoutDefPtr
name|layoutDef
init|=
name|tuiLayoutDef
argument_list|()
decl_stmt|;
if|if
condition|(
name|layoutDef
operator|->
name|displayMode
operator|==
name|SRC_WIN
condition|)
name|layoutDef
operator|->
name|displayMode
operator|=
name|DISASSEM_WIN
expr_stmt|;
else|else
name|layoutDef
operator|->
name|displayMode
operator|=
name|SRC_WIN
expr_stmt|;
if|if
condition|(
operator|!
name|layoutDef
operator|->
name|split
condition|)
name|_tuiHandleXDBLayout
argument_list|(
name|layoutDef
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tuiToggleLayout_command */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiToggleSplitLayout_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiToggleSplitLayout_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
name|tuiDo
argument_list|(
operator|(
name|TuiOpaqueFuncPtr
operator|)
name|_tui_vToggleSplitLayout_command
argument_list|,
name|arg
argument_list|,
name|fromTTY
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tui_vToggleSplitLayout_command
parameter_list|(
name|va_list
name|args
parameter_list|)
else|#
directive|else
function|_tui_vToggleSplitLayout_command
parameter_list|(
name|args
parameter_list|)
name|va_list
name|args
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiLayoutDefPtr
name|layoutDef
init|=
name|tuiLayoutDef
argument_list|()
decl_stmt|;
name|layoutDef
operator|->
name|split
operator|=
operator|(
operator|!
name|layoutDef
operator|->
name|split
operator|)
expr_stmt|;
name|_tuiHandleXDBLayout
argument_list|(
name|layoutDef
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tui_vToggleSplitLayout_command */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_tuiLayout_command
parameter_list|(
name|char
modifier|*
name|arg
parameter_list|,
name|int
name|fromTTY
parameter_list|)
else|#
directive|else
function|_tuiLayout_command
parameter_list|(
name|arg
parameter_list|,
name|fromTTY
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
name|int
name|fromTTY
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
operator|(
name|TuiStatus
operator|)
name|tuiDo
argument_list|(
operator|(
name|TuiOpaqueFuncPtr
operator|)
name|tui_vSetLayoutTo
argument_list|,
name|arg
argument_list|)
operator|!=
name|TUI_SUCCESS
condition|)
name|warning
argument_list|(
literal|"Invalid layout specified.\n%s"
name|LAYOUT_USAGE
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _tuiLayout_command */
end_comment

begin_comment
comment|/* ** _nextLayout(). **        Answer the previous layout to cycle to. */
end_comment

begin_function
specifier|static
name|TuiLayoutType
ifdef|#
directive|ifdef
name|__STDC__
name|_nextLayout
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|_nextLayout
parameter_list|()
endif|#
directive|endif
block|{
name|TuiLayoutType
name|newLayout
decl_stmt|;
name|newLayout
operator|=
name|currentLayout
argument_list|()
expr_stmt|;
if|if
condition|(
name|newLayout
operator|==
name|UNDEFINED_LAYOUT
condition|)
name|newLayout
operator|=
name|SRC_COMMAND
expr_stmt|;
else|else
block|{
name|newLayout
operator|++
expr_stmt|;
if|if
condition|(
name|newLayout
operator|==
name|UNDEFINED_LAYOUT
condition|)
name|newLayout
operator|=
name|SRC_COMMAND
expr_stmt|;
block|}
return|return
name|newLayout
return|;
block|}
end_function

begin_comment
comment|/* _nextLayout */
end_comment

begin_comment
comment|/* ** _prevLayout(). **        Answer the next layout to cycle to. */
end_comment

begin_function
specifier|static
name|TuiLayoutType
ifdef|#
directive|ifdef
name|__STDC__
name|_prevLayout
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|_prevLayout
parameter_list|()
endif|#
directive|endif
block|{
name|TuiLayoutType
name|newLayout
decl_stmt|;
name|newLayout
operator|=
name|currentLayout
argument_list|()
expr_stmt|;
if|if
condition|(
name|newLayout
operator|==
name|SRC_COMMAND
condition|)
name|newLayout
operator|=
name|DISASSEM_DATA_COMMAND
expr_stmt|;
else|else
block|{
name|newLayout
operator|--
expr_stmt|;
if|if
condition|(
name|newLayout
operator|==
name|UNDEFINED_LAYOUT
condition|)
name|newLayout
operator|=
name|DISASSEM_DATA_COMMAND
expr_stmt|;
block|}
return|return
name|newLayout
return|;
block|}
end_function

begin_comment
comment|/* _prevLayout */
end_comment

begin_comment
comment|/* ** _makeCommandWindow(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_makeCommandWindow
parameter_list|(
name|TuiWinInfoPtr
modifier|*
name|winInfoPtr
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|originY
parameter_list|)
else|#
directive|else
function|_makeCommandWindow
parameter_list|(
name|winInfoPtr
parameter_list|,
name|height
parameter_list|,
name|originY
parameter_list|)
name|TuiWinInfoPtr
modifier|*
name|winInfoPtr
decl_stmt|;
name|int
name|height
decl_stmt|;
name|int
name|originY
decl_stmt|;
endif|#
directive|endif
block|{
name|_initAndMakeWin
argument_list|(
operator|(
name|Opaque
operator|*
operator|)
name|winInfoPtr
argument_list|,
name|CMD_WIN
argument_list|,
name|height
argument_list|,
name|termWidth
argument_list|()
argument_list|,
literal|0
argument_list|,
name|originY
argument_list|,
name|DONT_BOX_WINDOW
argument_list|)
expr_stmt|;
operator|(
operator|*
name|winInfoPtr
operator|)
operator|->
name|canHighlight
operator|=
name|FALSE
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _makeCommandWindow */
end_comment

begin_comment
comment|/* ** _makeSourceWindow(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_makeSourceWindow
parameter_list|(
name|TuiWinInfoPtr
modifier|*
name|winInfoPtr
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|originY
parameter_list|)
else|#
directive|else
function|_makeSourceWindow
parameter_list|(
name|winInfoPtr
parameter_list|,
name|height
parameter_list|,
name|originY
parameter_list|)
name|TuiWinInfoPtr
modifier|*
name|winInfoPtr
decl_stmt|;
name|int
name|height
decl_stmt|;
name|int
name|originY
decl_stmt|;
endif|#
directive|endif
block|{
name|_makeSourceOrDisassemWindow
argument_list|(
name|winInfoPtr
argument_list|,
name|SRC_WIN
argument_list|,
name|height
argument_list|,
name|originY
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _makeSourceWindow */
end_comment

begin_comment
comment|/* ** _makeDisassemWindow(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_makeDisassemWindow
parameter_list|(
name|TuiWinInfoPtr
modifier|*
name|winInfoPtr
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|originY
parameter_list|)
else|#
directive|else
function|_makeDisassemWindow
parameter_list|(
name|winInfoPtr
parameter_list|,
name|height
parameter_list|,
name|originY
parameter_list|)
name|TuiWinInfoPtr
modifier|*
name|winInfoPtr
decl_stmt|;
name|int
name|height
decl_stmt|;
name|int
name|originY
decl_stmt|;
endif|#
directive|endif
block|{
name|_makeSourceOrDisassemWindow
argument_list|(
name|winInfoPtr
argument_list|,
name|DISASSEM_WIN
argument_list|,
name|height
argument_list|,
name|originY
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _makeDisassemWindow */
end_comment

begin_comment
comment|/* ** _makeDataWindow(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_makeDataWindow
parameter_list|(
name|TuiWinInfoPtr
modifier|*
name|winInfoPtr
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|originY
parameter_list|)
else|#
directive|else
function|_makeDataWindow
parameter_list|(
name|winInfoPtr
parameter_list|,
name|height
parameter_list|,
name|originY
parameter_list|)
name|TuiWinInfoPtr
modifier|*
name|winInfoPtr
decl_stmt|;
name|int
name|height
decl_stmt|;
name|int
name|originY
decl_stmt|;
endif|#
directive|endif
block|{
name|_initAndMakeWin
argument_list|(
operator|(
name|Opaque
operator|*
operator|)
name|winInfoPtr
argument_list|,
name|DATA_WIN
argument_list|,
name|height
argument_list|,
name|termWidth
argument_list|()
argument_list|,
literal|0
argument_list|,
name|originY
argument_list|,
name|BOX_WINDOW
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _makeDataWindow */
end_comment

begin_comment
comment|/* **    _showSourceCommand(). **        Show the Source/Command layout */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_showSourceCommand
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|_showSourceCommand
parameter_list|()
endif|#
directive|endif
block|{
name|_showSourceOrDisassemAndCommand
argument_list|(
name|SRC_COMMAND
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _showSourceCommand */
end_comment

begin_comment
comment|/* **    _showDisassemCommand(). **        Show the Dissassem/Command layout */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_showDisassemCommand
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|_showDisassemCommand
parameter_list|()
endif|#
directive|endif
block|{
name|_showSourceOrDisassemAndCommand
argument_list|(
name|DISASSEM_COMMAND
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _showDisassemCommand */
end_comment

begin_comment
comment|/* **    _showSourceDisassemCommand(). **        Show the Source/Disassem/Command layout */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_showSourceDisassemCommand
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|_showSourceDisassemCommand
parameter_list|()
endif|#
directive|endif
block|{
name|TuiGenWinInfoPtr
name|locator
init|=
name|locatorWinInfoPtr
argument_list|()
decl_stmt|;
if|if
condition|(
name|currentLayout
argument_list|()
operator|!=
name|SRC_DISASSEM_COMMAND
condition|)
block|{
name|int
name|cmdHeight
decl_stmt|,
name|srcHeight
decl_stmt|,
name|asmHeight
decl_stmt|;
if|if
condition|(
name|m_winPtrNotNull
argument_list|(
name|cmdWin
argument_list|)
condition|)
name|cmdHeight
operator|=
name|cmdWin
operator|->
name|generic
operator|.
name|height
expr_stmt|;
else|else
name|cmdHeight
operator|=
name|termHeight
argument_list|()
operator|/
literal|3
expr_stmt|;
name|srcHeight
operator|=
operator|(
name|termHeight
argument_list|()
operator|-
name|cmdHeight
operator|)
operator|/
literal|2
expr_stmt|;
name|asmHeight
operator|=
name|termHeight
argument_list|()
operator|-
operator|(
name|srcHeight
operator|+
name|cmdHeight
operator|)
expr_stmt|;
if|if
condition|(
name|m_winPtrIsNull
argument_list|(
name|srcWin
argument_list|)
condition|)
name|_makeSourceWindow
argument_list|(
operator|&
name|srcWin
argument_list|,
name|srcHeight
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
block|{
name|_initGenWinInfo
argument_list|(
operator|&
name|srcWin
operator|->
name|generic
argument_list|,
name|srcWin
operator|->
name|generic
operator|.
name|type
argument_list|,
name|srcHeight
argument_list|,
name|srcWin
operator|->
name|generic
operator|.
name|width
argument_list|,
name|srcWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
operator|->
name|width
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|srcWin
operator|->
name|canHighlight
operator|=
name|TRUE
expr_stmt|;
name|_initGenWinInfo
argument_list|(
name|srcWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
argument_list|,
name|EXEC_INFO_WIN
argument_list|,
name|srcHeight
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|m_beVisible
argument_list|(
name|srcWin
argument_list|)
expr_stmt|;
name|m_beVisible
argument_list|(
name|srcWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
argument_list|)
expr_stmt|;
name|srcWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|hasLocator
operator|=
name|FALSE
expr_stmt|;
empty_stmt|;
block|}
if|if
condition|(
name|m_winPtrNotNull
argument_list|(
name|srcWin
argument_list|)
condition|)
block|{
name|TuiGenWinInfoPtr
name|locator
init|=
name|locatorWinInfoPtr
argument_list|()
decl_stmt|;
name|tuiShowSourceContent
argument_list|(
name|srcWin
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_winPtrIsNull
argument_list|(
name|disassemWin
argument_list|)
condition|)
block|{
name|_makeDisassemWindow
argument_list|(
operator|&
name|disassemWin
argument_list|,
name|asmHeight
argument_list|,
name|srcHeight
operator|-
literal|1
argument_list|)
expr_stmt|;
name|_initAndMakeWin
argument_list|(
operator|(
name|Opaque
operator|*
operator|)
operator|&
name|locator
argument_list|,
name|LOCATOR_WIN
argument_list|,
literal|2
comment|/* 1 */
argument_list|,
name|termWidth
argument_list|()
argument_list|,
literal|0
argument_list|,
operator|(
name|srcHeight
operator|+
name|asmHeight
operator|)
operator|-
literal|1
argument_list|,
name|DONT_BOX_WINDOW
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|_initGenWinInfo
argument_list|(
name|locator
argument_list|,
name|LOCATOR_WIN
argument_list|,
literal|2
comment|/* 1 */
argument_list|,
name|termWidth
argument_list|()
argument_list|,
literal|0
argument_list|,
operator|(
name|srcHeight
operator|+
name|asmHeight
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|disassemWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|hasLocator
operator|=
name|TRUE
expr_stmt|;
name|_initGenWinInfo
argument_list|(
operator|&
name|disassemWin
operator|->
name|generic
argument_list|,
name|disassemWin
operator|->
name|generic
operator|.
name|type
argument_list|,
name|asmHeight
argument_list|,
name|disassemWin
operator|->
name|generic
operator|.
name|width
argument_list|,
name|disassemWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
operator|->
name|width
argument_list|,
name|srcHeight
operator|-
literal|1
argument_list|)
expr_stmt|;
name|_initGenWinInfo
argument_list|(
name|disassemWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
argument_list|,
name|EXEC_INFO_WIN
argument_list|,
name|asmHeight
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
name|srcHeight
operator|-
literal|1
argument_list|)
expr_stmt|;
name|disassemWin
operator|->
name|canHighlight
operator|=
name|TRUE
expr_stmt|;
name|m_beVisible
argument_list|(
name|disassemWin
argument_list|)
expr_stmt|;
name|m_beVisible
argument_list|(
name|disassemWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|m_winPtrNotNull
argument_list|(
name|disassemWin
argument_list|)
condition|)
block|{
name|srcWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|hasLocator
operator|=
name|FALSE
expr_stmt|;
name|disassemWin
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|hasLocator
operator|=
name|TRUE
expr_stmt|;
name|m_beVisible
argument_list|(
name|locator
argument_list|)
expr_stmt|;
name|tuiShowLocatorContent
argument_list|()
expr_stmt|;
name|tuiShowSourceContent
argument_list|(
name|disassemWin
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_winPtrIsNull
argument_list|(
name|cmdWin
argument_list|)
condition|)
name|_makeCommandWindow
argument_list|(
operator|&
name|cmdWin
argument_list|,
name|cmdHeight
argument_list|,
name|termHeight
argument_list|()
operator|-
name|cmdHeight
argument_list|)
expr_stmt|;
else|else
block|{
name|_initGenWinInfo
argument_list|(
operator|&
name|cmdWin
operator|->
name|generic
argument_list|,
name|cmdWin
operator|->
name|generic
operator|.
name|type
argument_list|,
name|cmdWin
operator|->
name|generic
operator|.
name|height
argument_list|,
name|cmdWin
operator|->
name|generic
operator|.
name|width
argument_list|,
literal|0
argument_list|,
name|cmdWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
argument_list|)
expr_stmt|;
name|cmdWin
operator|->
name|canHighlight
operator|=
name|FALSE
expr_stmt|;
name|m_beVisible
argument_list|(
name|cmdWin
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|m_winPtrNotNull
argument_list|(
name|cmdWin
argument_list|)
condition|)
name|tuiRefreshWin
argument_list|(
operator|&
name|cmdWin
operator|->
name|generic
argument_list|)
expr_stmt|;
block|}
block|}
name|setCurrentLayoutTo
argument_list|(
name|SRC_DISASSEM_COMMAND
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* _showSourceDisassemCommand */
end_comment

begin_comment
comment|/* **    _showData(). **        Show the Source/Data/Command or the Dissassembly/Data/Command layout */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_showData
parameter_list|(
name|TuiLayoutType
name|newLayout
parameter_list|)
else|#
directive|else
function|_showData
parameter_list|(
name|newLayout
parameter_list|)
name|TuiLayoutType
name|newLayout
decl_stmt|;
endif|#
directive|endif
block|{
name|int
name|totalHeight
init|=
operator|(
name|termHeight
argument_list|()
operator|-
name|cmdWin
operator|->
name|generic
operator|.
name|height
operator|)
decl_stmt|;
name|int
name|srcHeight
decl_stmt|,
name|dataHeight
decl_stmt|;
name|TuiWinType
name|winType
decl_stmt|;
name|TuiGenWinInfoPtr
name|locator
init|=
name|locatorWinInfoPtr
argument_list|()
decl_stmt|;
name|dataHeight
operator|=
name|totalHeight
operator|/
literal|2
expr_stmt|;
name|srcHeight
operator|=
name|totalHeight
operator|-
name|dataHeight
expr_stmt|;
name|m_allBeInvisible
argument_list|()
expr_stmt|;
name|m_beInvisible
argument_list|(
name|locator
argument_list|)
expr_stmt|;
name|_makeDataWindow
argument_list|(
operator|&
name|dataWin
argument_list|,
name|dataHeight
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|dataWin
operator|->
name|canHighlight
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|newLayout
operator|==
name|SRC_DATA_COMMAND
condition|)
name|winType
operator|=
name|SRC_WIN
expr_stmt|;
else|else
name|winType
operator|=
name|DISASSEM_WIN
expr_stmt|;
if|if
condition|(
name|m_winPtrIsNull
argument_list|(
name|winList
index|[
name|winType
index|]
argument_list|)
condition|)
block|{
if|if
condition|(
name|winType
operator|==
name|SRC_WIN
condition|)
name|_makeSourceWindow
argument_list|(
operator|&
name|winList
index|[
name|winType
index|]
argument_list|,
name|srcHeight
argument_list|,
name|dataHeight
operator|-
literal|1
argument_list|)
expr_stmt|;
else|else
name|_makeDisassemWindow
argument_list|(
operator|&
name|winList
index|[
name|winType
index|]
argument_list|,
name|srcHeight
argument_list|,
name|dataHeight
operator|-
literal|1
argument_list|)
expr_stmt|;
name|_initAndMakeWin
argument_list|(
operator|(
name|Opaque
operator|*
operator|)
operator|&
name|locator
argument_list|,
name|LOCATOR_WIN
argument_list|,
literal|2
comment|/* 1 */
argument_list|,
name|termWidth
argument_list|()
argument_list|,
literal|0
argument_list|,
name|totalHeight
operator|-
literal|1
argument_list|,
name|DONT_BOX_WINDOW
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|_initGenWinInfo
argument_list|(
operator|&
name|winList
index|[
name|winType
index|]
operator|->
name|generic
argument_list|,
name|winList
index|[
name|winType
index|]
operator|->
name|generic
operator|.
name|type
argument_list|,
name|srcHeight
argument_list|,
name|winList
index|[
name|winType
index|]
operator|->
name|generic
operator|.
name|width
argument_list|,
name|winList
index|[
name|winType
index|]
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
operator|->
name|width
argument_list|,
name|dataHeight
operator|-
literal|1
argument_list|)
expr_stmt|;
name|_initGenWinInfo
argument_list|(
name|winList
index|[
name|winType
index|]
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
argument_list|,
name|EXEC_INFO_WIN
argument_list|,
name|srcHeight
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
name|dataHeight
operator|-
literal|1
argument_list|)
expr_stmt|;
name|m_beVisible
argument_list|(
name|winList
index|[
name|winType
index|]
argument_list|)
expr_stmt|;
name|m_beVisible
argument_list|(
name|winList
index|[
name|winType
index|]
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
argument_list|)
expr_stmt|;
name|_initGenWinInfo
argument_list|(
name|locator
argument_list|,
name|LOCATOR_WIN
argument_list|,
literal|2
comment|/* 1 */
argument_list|,
name|termWidth
argument_list|()
argument_list|,
literal|0
argument_list|,
name|totalHeight
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|winList
index|[
name|winType
index|]
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|hasLocator
operator|=
name|TRUE
expr_stmt|;
name|m_beVisible
argument_list|(
name|locator
argument_list|)
expr_stmt|;
name|tuiShowLocatorContent
argument_list|()
expr_stmt|;
name|addToSourceWindows
argument_list|(
name|winList
index|[
name|winType
index|]
argument_list|)
expr_stmt|;
name|setCurrentLayoutTo
argument_list|(
name|newLayout
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _showData */
end_comment

begin_comment
comment|/* ** _initGenWinInfo(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_initGenWinInfo
parameter_list|(
name|TuiGenWinInfoPtr
name|winInfo
parameter_list|,
name|TuiWinType
name|type
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|originX
parameter_list|,
name|int
name|originY
parameter_list|)
else|#
directive|else
function|_initGenWinInfo
parameter_list|(
name|winInfo
parameter_list|,
name|type
parameter_list|,
name|height
parameter_list|,
name|width
parameter_list|,
name|originX
parameter_list|,
name|originY
parameter_list|)
name|TuiGenWinInfoPtr
name|winInfo
decl_stmt|;
name|TuiWinType
name|type
decl_stmt|;
name|int
name|height
decl_stmt|;
name|int
name|width
decl_stmt|;
name|int
name|originX
decl_stmt|;
name|int
name|originY
decl_stmt|;
endif|#
directive|endif
block|{
name|int
name|h
init|=
name|height
decl_stmt|;
name|winInfo
operator|->
name|type
operator|=
name|type
expr_stmt|;
name|winInfo
operator|->
name|width
operator|=
name|width
expr_stmt|;
name|winInfo
operator|->
name|height
operator|=
name|h
expr_stmt|;
if|if
condition|(
name|h
operator|>
literal|1
condition|)
block|{
name|winInfo
operator|->
name|viewportHeight
operator|=
name|h
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|winInfo
operator|->
name|type
operator|!=
name|CMD_WIN
condition|)
name|winInfo
operator|->
name|viewportHeight
operator|--
expr_stmt|;
block|}
else|else
name|winInfo
operator|->
name|viewportHeight
operator|=
literal|1
expr_stmt|;
name|winInfo
operator|->
name|origin
operator|.
name|x
operator|=
name|originX
expr_stmt|;
name|winInfo
operator|->
name|origin
operator|.
name|y
operator|=
name|originY
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _initGenWinInfo */
end_comment

begin_comment
comment|/* ** _initAndMakeWin(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_initAndMakeWin
parameter_list|(
name|Opaque
modifier|*
name|winInfoPtr
parameter_list|,
name|TuiWinType
name|winType
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|originX
parameter_list|,
name|int
name|originY
parameter_list|,
name|int
name|boxIt
parameter_list|)
else|#
directive|else
function|_initAndMakeWin
parameter_list|(
name|winInfoPtr
parameter_list|,
name|winType
parameter_list|,
name|height
parameter_list|,
name|width
parameter_list|,
name|originX
parameter_list|,
name|originY
parameter_list|,
name|boxIt
parameter_list|)
name|Opaque
modifier|*
name|winInfoPtr
decl_stmt|;
name|TuiWinType
name|winType
decl_stmt|;
name|int
name|height
decl_stmt|;
name|int
name|width
decl_stmt|;
name|int
name|originX
decl_stmt|;
name|int
name|originY
decl_stmt|;
name|int
name|boxIt
decl_stmt|;
endif|#
directive|endif
block|{
name|Opaque
name|opaqueWinInfo
init|=
operator|*
name|winInfoPtr
decl_stmt|;
name|TuiGenWinInfoPtr
name|generic
decl_stmt|;
if|if
condition|(
name|opaqueWinInfo
operator|==
operator|(
name|Opaque
operator|)
name|NULL
condition|)
block|{
if|if
condition|(
name|m_winIsAuxillary
argument_list|(
name|winType
argument_list|)
condition|)
name|opaqueWinInfo
operator|=
operator|(
name|Opaque
operator|)
name|allocGenericWinInfo
argument_list|()
expr_stmt|;
else|else
name|opaqueWinInfo
operator|=
operator|(
name|Opaque
operator|)
name|allocWinInfo
argument_list|(
name|winType
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|m_winIsAuxillary
argument_list|(
name|winType
argument_list|)
condition|)
name|generic
operator|=
operator|(
name|TuiGenWinInfoPtr
operator|)
name|opaqueWinInfo
expr_stmt|;
else|else
name|generic
operator|=
operator|&
operator|(
operator|(
name|TuiWinInfoPtr
operator|)
name|opaqueWinInfo
operator|)
operator|->
name|generic
expr_stmt|;
if|if
condition|(
name|opaqueWinInfo
operator|!=
operator|(
name|Opaque
operator|)
name|NULL
condition|)
block|{
name|_initGenWinInfo
argument_list|(
name|generic
argument_list|,
name|winType
argument_list|,
name|height
argument_list|,
name|width
argument_list|,
name|originX
argument_list|,
name|originY
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|m_winIsAuxillary
argument_list|(
name|winType
argument_list|)
condition|)
block|{
if|if
condition|(
name|generic
operator|->
name|type
operator|==
name|CMD_WIN
condition|)
operator|(
operator|(
name|TuiWinInfoPtr
operator|)
name|opaqueWinInfo
operator|)
operator|->
name|canHighlight
operator|=
name|FALSE
expr_stmt|;
else|else
operator|(
operator|(
name|TuiWinInfoPtr
operator|)
name|opaqueWinInfo
operator|)
operator|->
name|canHighlight
operator|=
name|TRUE
expr_stmt|;
block|}
name|makeWindow
argument_list|(
name|generic
argument_list|,
name|boxIt
argument_list|)
expr_stmt|;
if|if
condition|(
name|winType
operator|==
name|LOCATOR_WIN
condition|)
name|tuiClearLocatorDisplay
argument_list|()
expr_stmt|;
name|echo
argument_list|()
expr_stmt|;
block|}
operator|*
name|winInfoPtr
operator|=
name|opaqueWinInfo
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _initAndMakeWin */
end_comment

begin_comment
comment|/* ** _makeSourceOrDisassemWindow(). */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_makeSourceOrDisassemWindow
parameter_list|(
name|TuiWinInfoPtr
modifier|*
name|winInfoPtr
parameter_list|,
name|TuiWinType
name|type
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|originY
parameter_list|)
else|#
directive|else
function|_makeSourceOrDisassemWindow
parameter_list|(
name|winInfoPtr
parameter_list|,
name|type
parameter_list|,
name|height
parameter_list|,
name|originY
parameter_list|)
name|TuiWinInfoPtr
modifier|*
name|winInfoPtr
decl_stmt|;
name|TuiWinType
name|type
decl_stmt|;
name|int
name|height
decl_stmt|;
name|int
name|originY
decl_stmt|;
endif|#
directive|endif
block|{
name|TuiGenWinInfoPtr
name|executionInfo
init|=
operator|(
name|TuiGenWinInfoPtr
operator|)
name|NULL
decl_stmt|;
comment|/*     ** Create the exeuction info window.     */
if|if
condition|(
name|type
operator|==
name|SRC_WIN
condition|)
name|executionInfo
operator|=
name|sourceExecInfoWinPtr
argument_list|()
expr_stmt|;
else|else
name|executionInfo
operator|=
name|disassemExecInfoWinPtr
argument_list|()
expr_stmt|;
name|_initAndMakeWin
argument_list|(
operator|(
name|Opaque
operator|*
operator|)
operator|&
name|executionInfo
argument_list|,
name|EXEC_INFO_WIN
argument_list|,
name|height
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
name|originY
argument_list|,
name|DONT_BOX_WINDOW
argument_list|)
expr_stmt|;
comment|/*     ** Now create the source window.     */
name|_initAndMakeWin
argument_list|(
operator|(
name|Opaque
operator|*
operator|)
name|winInfoPtr
argument_list|,
name|type
argument_list|,
name|height
argument_list|,
name|termWidth
argument_list|()
operator|-
name|executionInfo
operator|->
name|width
argument_list|,
name|executionInfo
operator|->
name|width
argument_list|,
name|originY
argument_list|,
name|BOX_WINDOW
argument_list|)
expr_stmt|;
operator|(
operator|*
name|winInfoPtr
operator|)
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
operator|=
name|executionInfo
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* _makeSourceOrDisassemWindow */
end_comment

begin_comment
comment|/* **    _showSourceOrDisassemAndCommand(). **        Show the Source/Command or the Disassem layout */
end_comment

begin_function
specifier|static
name|void
ifdef|#
directive|ifdef
name|__STDC__
name|_showSourceOrDisassemAndCommand
parameter_list|(
name|TuiLayoutType
name|layoutType
parameter_list|)
else|#
directive|else
function|_showSourceOrDisassemAndCommand
parameter_list|(
name|layoutType
parameter_list|)
name|TuiLayoutType
name|layoutType
decl_stmt|;
endif|#
directive|endif
block|{
if|if
condition|(
name|currentLayout
argument_list|()
operator|!=
name|layoutType
condition|)
block|{
name|TuiWinInfoPtr
modifier|*
name|winInfoPtr
decl_stmt|;
name|int
name|areaLeft
decl_stmt|;
name|int
name|srcHeight
decl_stmt|,
name|cmdHeight
decl_stmt|;
name|TuiGenWinInfoPtr
name|locator
init|=
name|locatorWinInfoPtr
argument_list|()
decl_stmt|;
if|if
condition|(
name|m_winPtrNotNull
argument_list|(
name|cmdWin
argument_list|)
condition|)
name|cmdHeight
operator|=
name|cmdWin
operator|->
name|generic
operator|.
name|height
expr_stmt|;
else|else
name|cmdHeight
operator|=
name|termHeight
argument_list|()
operator|/
literal|3
expr_stmt|;
name|srcHeight
operator|=
name|termHeight
argument_list|()
operator|-
name|cmdHeight
expr_stmt|;
if|if
condition|(
name|layoutType
operator|==
name|SRC_COMMAND
condition|)
name|winInfoPtr
operator|=
operator|&
name|srcWin
expr_stmt|;
else|else
name|winInfoPtr
operator|=
operator|&
name|disassemWin
expr_stmt|;
if|if
condition|(
name|m_winPtrIsNull
argument_list|(
operator|*
name|winInfoPtr
argument_list|)
condition|)
block|{
if|if
condition|(
name|layoutType
operator|==
name|SRC_COMMAND
condition|)
name|_makeSourceWindow
argument_list|(
name|winInfoPtr
argument_list|,
name|srcHeight
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
name|_makeDisassemWindow
argument_list|(
name|winInfoPtr
argument_list|,
name|srcHeight
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|_initAndMakeWin
argument_list|(
operator|(
name|Opaque
operator|*
operator|)
operator|&
name|locator
argument_list|,
name|LOCATOR_WIN
argument_list|,
literal|2
comment|/* 1 */
argument_list|,
name|termWidth
argument_list|()
argument_list|,
literal|0
argument_list|,
name|srcHeight
operator|-
literal|1
argument_list|,
name|DONT_BOX_WINDOW
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|_initGenWinInfo
argument_list|(
name|locator
argument_list|,
name|LOCATOR_WIN
argument_list|,
literal|2
comment|/* 1 */
argument_list|,
name|termWidth
argument_list|()
argument_list|,
literal|0
argument_list|,
name|srcHeight
operator|-
literal|1
argument_list|)
expr_stmt|;
operator|(
operator|*
name|winInfoPtr
operator|)
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|hasLocator
operator|=
name|TRUE
expr_stmt|;
name|_initGenWinInfo
argument_list|(
operator|&
operator|(
operator|*
name|winInfoPtr
operator|)
operator|->
name|generic
argument_list|,
operator|(
operator|*
name|winInfoPtr
operator|)
operator|->
name|generic
operator|.
name|type
argument_list|,
name|srcHeight
operator|-
literal|1
argument_list|,
operator|(
operator|*
name|winInfoPtr
operator|)
operator|->
name|generic
operator|.
name|width
argument_list|,
operator|(
operator|*
name|winInfoPtr
operator|)
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
operator|->
name|width
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|_initGenWinInfo
argument_list|(
operator|(
operator|*
name|winInfoPtr
operator|)
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
argument_list|,
name|EXEC_INFO_WIN
argument_list|,
name|srcHeight
operator|-
literal|1
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
operator|*
name|winInfoPtr
operator|)
operator|->
name|canHighlight
operator|=
name|TRUE
expr_stmt|;
name|m_beVisible
argument_list|(
operator|*
name|winInfoPtr
argument_list|)
expr_stmt|;
name|m_beVisible
argument_list|(
operator|(
operator|*
name|winInfoPtr
operator|)
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|executionInfo
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|m_winPtrNotNull
argument_list|(
operator|*
name|winInfoPtr
argument_list|)
condition|)
block|{
operator|(
operator|*
name|winInfoPtr
operator|)
operator|->
name|detail
operator|.
name|sourceInfo
operator|.
name|hasLocator
operator|=
name|TRUE
expr_stmt|;
name|m_beVisible
argument_list|(
name|locator
argument_list|)
expr_stmt|;
name|tuiShowLocatorContent
argument_list|()
expr_stmt|;
name|tuiShowSourceContent
argument_list|(
operator|*
name|winInfoPtr
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_winPtrIsNull
argument_list|(
name|cmdWin
argument_list|)
condition|)
block|{
name|_makeCommandWindow
argument_list|(
operator|&
name|cmdWin
argument_list|,
name|cmdHeight
argument_list|,
name|srcHeight
argument_list|)
expr_stmt|;
name|tuiRefreshWin
argument_list|(
operator|&
name|cmdWin
operator|->
name|generic
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|_initGenWinInfo
argument_list|(
operator|&
name|cmdWin
operator|->
name|generic
argument_list|,
name|cmdWin
operator|->
name|generic
operator|.
name|type
argument_list|,
name|cmdWin
operator|->
name|generic
operator|.
name|height
argument_list|,
name|cmdWin
operator|->
name|generic
operator|.
name|width
argument_list|,
name|cmdWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|x
argument_list|,
name|cmdWin
operator|->
name|generic
operator|.
name|origin
operator|.
name|y
argument_list|)
expr_stmt|;
name|cmdWin
operator|->
name|canHighlight
operator|=
name|FALSE
expr_stmt|;
name|m_beVisible
argument_list|(
name|cmdWin
argument_list|)
expr_stmt|;
block|}
block|}
name|setCurrentLayoutTo
argument_list|(
name|layoutType
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* _showSourceOrDisassemAndCommand */
end_comment

end_unit

