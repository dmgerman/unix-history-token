begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Native-dependent code for PowerPC's running FreeBSD, for GDB.    Copyright 2002, 2004 Free Software Foundation, Inc.    Contributed by Wasabi Systems, Inc.     This file is part of GDB.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330,    Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/ptrace.h>
end_include

begin_include
include|#
directive|include
file|<machine/reg.h>
end_include

begin_include
include|#
directive|include
file|<machine/frame.h>
end_include

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"inferior.h"
end_include

begin_include
include|#
directive|include
file|"gdb_assert.h"
end_include

begin_include
include|#
directive|include
file|"gdbcore.h"
end_include

begin_include
include|#
directive|include
file|"regcache.h"
end_include

begin_include
include|#
directive|include
file|"ppc-tdep.h"
end_include

begin_include
include|#
directive|include
file|"ppcfbsd-tdep.h"
end_include

begin_comment
comment|/* Returns true if PT_GETREGS fetches this register.  */
end_comment

begin_function
specifier|static
name|int
name|getregs_supplies
parameter_list|(
name|int
name|regno
parameter_list|)
block|{
name|struct
name|gdbarch_tdep
modifier|*
name|tdep
init|=
name|gdbarch_tdep
argument_list|(
name|current_gdbarch
argument_list|)
decl_stmt|;
return|return
operator|(
operator|(
name|regno
operator|>=
name|tdep
operator|->
name|ppc_gp0_regnum
operator|&&
name|regno
operator|<=
name|tdep
operator|->
name|ppc_gplast_regnum
operator|)
operator|||
name|regno
operator|==
name|tdep
operator|->
name|ppc_lr_regnum
operator|||
name|regno
operator|==
name|tdep
operator|->
name|ppc_cr_regnum
operator|||
name|regno
operator|==
name|tdep
operator|->
name|ppc_xer_regnum
operator|||
name|regno
operator|==
name|tdep
operator|->
name|ppc_ctr_regnum
operator|||
name|regno
operator|==
name|PC_REGNUM
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Like above, but for PT_GETFPREGS.  */
end_comment

begin_function
specifier|static
name|int
name|getfpregs_supplies
parameter_list|(
name|int
name|regno
parameter_list|)
block|{
name|struct
name|gdbarch_tdep
modifier|*
name|tdep
init|=
name|gdbarch_tdep
argument_list|(
name|current_gdbarch
argument_list|)
decl_stmt|;
comment|/* FIXME: jimb/2004-05-05: Some PPC variants don't have floating      point registers.  Traditionally, GDB's register set has still      listed the floating point registers for such machines, so this      code is harmless.  However, the new E500 port actually omits the      floating point registers entirely from the register set --- they      don't even have register numbers assigned to them.       It's not clear to me how best to update this code, so this assert      will alert the first person to encounter the NetBSD/E500      combination to the problem.  */
name|gdb_assert
argument_list|(
name|ppc_floating_point_unit_p
argument_list|(
name|current_gdbarch
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
name|regno
operator|>=
name|FP0_REGNUM
operator|&&
name|regno
operator|<=
name|FPLAST_REGNUM
operator|)
operator|||
name|regno
operator|==
name|tdep
operator|->
name|ppc_fpscr_regnum
operator|)
return|;
block|}
end_function

begin_function
name|void
name|fetch_inferior_registers
parameter_list|(
name|int
name|regno
parameter_list|)
block|{
if|if
condition|(
name|regno
operator|==
operator|-
literal|1
operator|||
name|getregs_supplies
argument_list|(
name|regno
argument_list|)
condition|)
block|{
name|struct
name|reg
name|regs
decl_stmt|;
if|if
condition|(
name|ptrace
argument_list|(
name|PT_GETREGS
argument_list|,
name|PIDGET
argument_list|(
name|inferior_ptid
argument_list|)
argument_list|,
operator|(
name|PTRACE_ARG3_TYPE
operator|)
operator|&
name|regs
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|perror_with_name
argument_list|(
name|_
argument_list|(
literal|"Couldn't get registers"
argument_list|)
argument_list|)
expr_stmt|;
name|ppcfbsd_supply_reg
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|regs
argument_list|,
name|regno
argument_list|)
expr_stmt|;
if|if
condition|(
name|regno
operator|!=
operator|-
literal|1
condition|)
return|return;
block|}
if|if
condition|(
name|regno
operator|==
operator|-
literal|1
operator|||
name|getfpregs_supplies
argument_list|(
name|regno
argument_list|)
condition|)
block|{
name|struct
name|fpreg
name|fpregs
decl_stmt|;
if|if
condition|(
name|ptrace
argument_list|(
name|PT_GETFPREGS
argument_list|,
name|PIDGET
argument_list|(
name|inferior_ptid
argument_list|)
argument_list|,
operator|(
name|PTRACE_ARG3_TYPE
operator|)
operator|&
name|fpregs
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|perror_with_name
argument_list|(
name|_
argument_list|(
literal|"Couldn't get FP registers"
argument_list|)
argument_list|)
expr_stmt|;
name|ppcfbsd_supply_fpreg
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|fpregs
argument_list|,
name|regno
argument_list|)
expr_stmt|;
if|if
condition|(
name|regno
operator|!=
operator|-
literal|1
condition|)
return|return;
block|}
block|}
end_function

begin_function
name|void
name|store_inferior_registers
parameter_list|(
name|int
name|regno
parameter_list|)
block|{
if|if
condition|(
name|regno
operator|==
operator|-
literal|1
operator|||
name|getregs_supplies
argument_list|(
name|regno
argument_list|)
condition|)
block|{
name|struct
name|reg
name|regs
decl_stmt|;
if|if
condition|(
name|ptrace
argument_list|(
name|PT_GETREGS
argument_list|,
name|PIDGET
argument_list|(
name|inferior_ptid
argument_list|)
argument_list|,
operator|(
name|PTRACE_ARG3_TYPE
operator|)
operator|&
name|regs
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|perror_with_name
argument_list|(
name|_
argument_list|(
literal|"Couldn't get registers"
argument_list|)
argument_list|)
expr_stmt|;
name|ppcfbsd_fill_reg
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|regs
argument_list|,
name|regno
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptrace
argument_list|(
name|PT_SETREGS
argument_list|,
name|PIDGET
argument_list|(
name|inferior_ptid
argument_list|)
argument_list|,
operator|(
name|PTRACE_ARG3_TYPE
operator|)
operator|&
name|regs
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|perror_with_name
argument_list|(
name|_
argument_list|(
literal|"Couldn't write registers"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|regno
operator|!=
operator|-
literal|1
condition|)
return|return;
block|}
if|if
condition|(
name|regno
operator|==
operator|-
literal|1
operator|||
name|getfpregs_supplies
argument_list|(
name|regno
argument_list|)
condition|)
block|{
name|struct
name|fpreg
name|fpregs
decl_stmt|;
if|if
condition|(
name|ptrace
argument_list|(
name|PT_GETFPREGS
argument_list|,
name|PIDGET
argument_list|(
name|inferior_ptid
argument_list|)
argument_list|,
operator|(
name|PTRACE_ARG3_TYPE
operator|)
operator|&
name|fpregs
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|perror_with_name
argument_list|(
name|_
argument_list|(
literal|"Couldn't get FP registers"
argument_list|)
argument_list|)
expr_stmt|;
name|ppcfbsd_fill_fpreg
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|fpregs
argument_list|,
name|regno
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptrace
argument_list|(
name|PT_SETFPREGS
argument_list|,
name|PIDGET
argument_list|(
name|inferior_ptid
argument_list|)
argument_list|,
operator|(
name|PTRACE_ARG3_TYPE
operator|)
operator|&
name|fpregs
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|perror_with_name
argument_list|(
name|_
argument_list|(
literal|"Couldn't set FP registers"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|fill_gregset
parameter_list|(
name|char
modifier|*
name|regs
parameter_list|,
name|int
name|regnum
parameter_list|)
block|{
name|ppcfbsd_fill_reg
argument_list|(
name|regs
argument_list|,
name|regnum
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|supply_gregset
parameter_list|(
name|char
modifier|*
name|regs
parameter_list|)
block|{
name|ppcfbsd_supply_reg
argument_list|(
name|regs
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fill_fpregset
parameter_list|(
name|char
modifier|*
name|fpregs
parameter_list|,
name|int
name|regnum
parameter_list|)
block|{
name|ppcfbsd_fill_fpreg
argument_list|(
name|fpregs
argument_list|,
name|regnum
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|supply_fpregset
parameter_list|(
name|char
modifier|*
name|fpregs
parameter_list|)
block|{
name|ppcfbsd_supply_fpreg
argument_list|(
name|fpregs
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Provide a prototype to silence -Wmissing-prototypes.  */
end_comment

begin_function_decl
name|void
name|_initialize_ppcfbsd_nat
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|_initialize_ppcfbsd_nat
parameter_list|(
name|void
parameter_list|)
block|{ }
end_function

end_unit

