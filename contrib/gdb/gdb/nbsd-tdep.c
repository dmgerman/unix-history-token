begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Common target-dependent code for NetBSD systems.    Copyright 2002 Free Software Foundation, Inc.    Contributed by Wasabi Systems, Inc.       This file is part of GDB.       This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.       This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.          You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330,    Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"gdb_string.h"
end_include

begin_include
include|#
directive|include
file|"solib-svr4.h"
end_include

begin_comment
comment|/* Fetch (and possibly build) an appropriate link_map_offsets    structure for NetBSD targets using the struct offsets defined    in<link.h> (but without actual reference to that file).       This makes it possible to access NetBSD shared libraries from a    GDB that was not built on the same platform (for cross debugging).     We provide versions for ILP32 and LP64 NetBSD targets here.  */
end_comment

begin_function
name|struct
name|link_map_offsets
modifier|*
name|nbsd_ilp32_solib_svr4_fetch_link_map_offsets
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|struct
name|link_map_offsets
name|lmo
decl_stmt|;
specifier|static
name|struct
name|link_map_offsets
modifier|*
name|lmp
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|lmp
operator|==
name|NULL
condition|)
block|{
name|lmp
operator|=
operator|&
name|lmo
expr_stmt|;
name|lmo
operator|.
name|r_debug_size
operator|=
literal|16
expr_stmt|;
name|lmo
operator|.
name|r_map_offset
operator|=
literal|4
expr_stmt|;
name|lmo
operator|.
name|r_map_size
operator|=
literal|4
expr_stmt|;
name|lmo
operator|.
name|link_map_size
operator|=
literal|20
expr_stmt|;
name|lmo
operator|.
name|l_addr_offset
operator|=
literal|0
expr_stmt|;
name|lmo
operator|.
name|l_addr_size
operator|=
literal|4
expr_stmt|;
name|lmo
operator|.
name|l_name_offset
operator|=
literal|4
expr_stmt|;
name|lmo
operator|.
name|l_name_size
operator|=
literal|4
expr_stmt|;
name|lmo
operator|.
name|l_next_offset
operator|=
literal|12
expr_stmt|;
name|lmo
operator|.
name|l_next_size
operator|=
literal|4
expr_stmt|;
name|lmo
operator|.
name|l_prev_offset
operator|=
literal|16
expr_stmt|;
name|lmo
operator|.
name|l_prev_size
operator|=
literal|4
expr_stmt|;
block|}
return|return
name|lmp
return|;
block|}
end_function

begin_function
name|struct
name|link_map_offsets
modifier|*
name|nbsd_lp64_solib_svr4_fetch_link_map_offsets
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|struct
name|link_map_offsets
name|lmo
decl_stmt|;
specifier|static
name|struct
name|link_map_offsets
modifier|*
name|lmp
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|lmp
operator|==
name|NULL
condition|)
block|{
name|lmp
operator|=
operator|&
name|lmo
expr_stmt|;
name|lmo
operator|.
name|r_debug_size
operator|=
literal|32
expr_stmt|;
name|lmo
operator|.
name|r_map_offset
operator|=
literal|8
expr_stmt|;
name|lmo
operator|.
name|r_map_size
operator|=
literal|8
expr_stmt|;
name|lmo
operator|.
name|link_map_size
operator|=
literal|40
expr_stmt|;
name|lmo
operator|.
name|l_addr_offset
operator|=
literal|0
expr_stmt|;
name|lmo
operator|.
name|l_addr_size
operator|=
literal|8
expr_stmt|;
name|lmo
operator|.
name|l_name_offset
operator|=
literal|8
expr_stmt|;
name|lmo
operator|.
name|l_name_size
operator|=
literal|8
expr_stmt|;
name|lmo
operator|.
name|l_next_offset
operator|=
literal|24
expr_stmt|;
name|lmo
operator|.
name|l_next_size
operator|=
literal|8
expr_stmt|;
name|lmo
operator|.
name|l_prev_offset
operator|=
literal|32
expr_stmt|;
name|lmo
operator|.
name|l_prev_size
operator|=
literal|8
expr_stmt|;
block|}
return|return
name|lmp
return|;
block|}
end_function

begin_function
name|int
name|nbsd_pc_in_sigtramp
parameter_list|(
name|CORE_ADDR
name|pc
parameter_list|,
name|char
modifier|*
name|func_name
parameter_list|)
block|{
comment|/* Check for libc-provided signal trampoline.  All such trampolines      have function names which begin with "__sigtramp".  */
return|return
operator|(
name|func_name
operator|!=
name|NULL
operator|&&
name|strncmp
argument_list|(
name|func_name
argument_list|,
literal|"__sigtramp"
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
operator|)
return|;
block|}
end_function

end_unit

