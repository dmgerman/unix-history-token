begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Native-dependent code for OpenBSD/i386.     Copyright 2002, 2003, 2004 Free Software Foundation, Inc.     This file is part of GDB.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330,    Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/sysctl.h>
end_include

begin_include
include|#
directive|include
file|"i386-tdep.h"
end_include

begin_comment
comment|/* Prevent warning from -Wmissing-prototypes.  */
end_comment

begin_function_decl
name|void
name|_initialize_i386obsd_nat
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|_initialize_i386obsd_nat
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* OpenBSD provides a vm.psstrings sysctl that we can use to locate      the sigtramp.  That way we can still recognize a sigtramp if its      location is changed in a new kernel.  This is especially      important for OpenBSD, since it uses a different memory layout      than NetBSD, yet we cannot distinguish between the two.       Of course this is still based on the assumption that the sigtramp      is placed directly under the location where the program arguments      and environment can be found.  */
ifdef|#
directive|ifdef
name|VM_PSSTRINGS
block|{
name|struct
name|_ps_strings
name|_ps
decl_stmt|;
name|int
name|mib
index|[
literal|2
index|]
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|mib
index|[
literal|0
index|]
operator|=
name|CTL_VM
expr_stmt|;
name|mib
index|[
literal|1
index|]
operator|=
name|VM_PSSTRINGS
expr_stmt|;
name|len
operator|=
sizeof|sizeof
argument_list|(
name|_ps
argument_list|)
expr_stmt|;
if|if
condition|(
name|sysctl
argument_list|(
name|mib
argument_list|,
literal|2
argument_list|,
operator|&
name|_ps
argument_list|,
operator|&
name|len
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
condition|)
block|{
name|i386obsd_sigtramp_start_addr
operator|=
operator|(
name|CORE_ADDR
operator|)
name|_ps
operator|.
name|val
operator|-
literal|128
expr_stmt|;
name|i386obsd_sigtramp_end_addr
operator|=
operator|(
name|CORE_ADDR
operator|)
name|_ps
operator|.
name|val
expr_stmt|;
block|}
block|}
endif|#
directive|endif
block|}
end_function

end_unit

