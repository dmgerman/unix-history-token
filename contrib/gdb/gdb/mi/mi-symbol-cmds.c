begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* MI Command Set - symbol commands.    Copyright 2003 Free Software Foundation, Inc.     This file is part of GDB.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330,    Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"mi-cmds.h"
end_include

begin_include
include|#
directive|include
file|"symtab.h"
end_include

begin_include
include|#
directive|include
file|"ui-out.h"
end_include

begin_comment
comment|/* SYMBOL-LIST-LINES:     Print the list of all pc addresses and lines of code for    the provided (full or base) source file name.  The entries    are sorted in ascending PC order. */
end_comment

begin_function
name|enum
name|mi_cmd_result
name|mi_cmd_symbol_list_lines
parameter_list|(
name|char
modifier|*
name|command
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
name|int
name|argc
parameter_list|)
block|{
name|char
modifier|*
name|filename
decl_stmt|;
name|struct
name|symtab
modifier|*
name|s
decl_stmt|;
name|int
name|i
decl_stmt|;
name|struct
name|cleanup
modifier|*
name|cleanup_stack
decl_stmt|,
modifier|*
name|cleanup_tuple
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
name|error
argument_list|(
literal|"mi_cmd_symbol_list_lines: Usage: SOURCE_FILENAME"
argument_list|)
expr_stmt|;
name|filename
operator|=
name|argv
index|[
literal|0
index|]
expr_stmt|;
name|s
operator|=
name|lookup_symtab
argument_list|(
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|==
name|NULL
condition|)
name|error
argument_list|(
literal|"mi_cmd_symbol_list_lines: Unknown source file name."
argument_list|)
expr_stmt|;
comment|/* Now, dump the associated line table.  The pc addresses are already      sorted by increasing values in the symbol table, so no need to      perform any other sorting. */
name|cleanup_stack
operator|=
name|make_cleanup_ui_out_list_begin_end
argument_list|(
name|uiout
argument_list|,
literal|"lines"
argument_list|)
expr_stmt|;
if|if
condition|(
name|LINETABLE
argument_list|(
name|s
argument_list|)
operator|!=
name|NULL
operator|&&
name|LINETABLE
argument_list|(
name|s
argument_list|)
operator|->
name|nitems
operator|>
literal|0
condition|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|LINETABLE
argument_list|(
name|s
argument_list|)
operator|->
name|nitems
condition|;
name|i
operator|++
control|)
block|{
name|cleanup_tuple
operator|=
name|make_cleanup_ui_out_tuple_begin_end
argument_list|(
name|uiout
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|ui_out_field_core_addr
argument_list|(
name|uiout
argument_list|,
literal|"pc"
argument_list|,
name|LINETABLE
argument_list|(
name|s
argument_list|)
operator|->
name|item
index|[
name|i
index|]
operator|.
name|pc
argument_list|)
expr_stmt|;
name|ui_out_field_int
argument_list|(
name|uiout
argument_list|,
literal|"line"
argument_list|,
name|LINETABLE
argument_list|(
name|s
argument_list|)
operator|->
name|item
index|[
name|i
index|]
operator|.
name|line
argument_list|)
expr_stmt|;
name|do_cleanups
argument_list|(
name|cleanup_tuple
argument_list|)
expr_stmt|;
block|}
name|do_cleanups
argument_list|(
name|cleanup_stack
argument_list|)
expr_stmt|;
return|return
name|MI_CMD_DONE
return|;
block|}
end_function

end_unit

