begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Simulate breakpoints by patching locations in the target system, for GDB.     Copyright 1990, 1991, 1992, 1993, 1995, 1997, 1998, 1999, 2000,    2002 Free Software Foundation, Inc.     Contributed by Cygnus Support.  Written by John Gilmore.     This file is part of GDB.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330,    Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_comment
comment|/* This file is only useful if BREAKPOINT_FROM_PC is set.  If not, we    punt.  */
end_comment

begin_include
include|#
directive|include
file|"symtab.h"
end_include

begin_include
include|#
directive|include
file|"breakpoint.h"
end_include

begin_include
include|#
directive|include
file|"inferior.h"
end_include

begin_include
include|#
directive|include
file|"target.h"
end_include

begin_comment
comment|/* Insert a breakpoint on targets that don't have any better breakpoint    support.  We read the contents of the target location and stash it,    then overwrite it with a breakpoint instruction.  ADDR is the target    location in the target machine.  CONTENTS_CACHE is a pointer to     memory allocated for saving the target contents.  It is guaranteed    by the caller to be long enough to save BREAKPOINT_LEN bytes (this    is accomplished via BREAKPOINT_MAX).  */
end_comment

begin_function
name|int
name|default_memory_insert_breakpoint
parameter_list|(
name|CORE_ADDR
name|addr
parameter_list|,
name|char
modifier|*
name|contents_cache
parameter_list|)
block|{
name|int
name|val
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|bp
decl_stmt|;
name|int
name|bplen
decl_stmt|;
comment|/* Determine appropriate breakpoint contents and size for this address.  */
name|bp
operator|=
name|BREAKPOINT_FROM_PC
argument_list|(
operator|&
name|addr
argument_list|,
operator|&
name|bplen
argument_list|)
expr_stmt|;
if|if
condition|(
name|bp
operator|==
name|NULL
condition|)
name|error
argument_list|(
literal|"Software breakpoints not implemented for this target."
argument_list|)
expr_stmt|;
comment|/* Save the memory contents.  */
name|val
operator|=
name|target_read_memory
argument_list|(
name|addr
argument_list|,
name|contents_cache
argument_list|,
name|bplen
argument_list|)
expr_stmt|;
comment|/* Write the breakpoint.  */
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|val
operator|=
name|target_write_memory
argument_list|(
name|addr
argument_list|,
operator|(
name|char
operator|*
operator|)
name|bp
argument_list|,
name|bplen
argument_list|)
expr_stmt|;
return|return
name|val
return|;
block|}
end_function

begin_function
name|int
name|default_memory_remove_breakpoint
parameter_list|(
name|CORE_ADDR
name|addr
parameter_list|,
name|char
modifier|*
name|contents_cache
parameter_list|)
block|{
specifier|const
name|unsigned
name|char
modifier|*
name|bp
decl_stmt|;
name|int
name|bplen
decl_stmt|;
comment|/* Determine appropriate breakpoint contents and size for this address.  */
name|bp
operator|=
name|BREAKPOINT_FROM_PC
argument_list|(
operator|&
name|addr
argument_list|,
operator|&
name|bplen
argument_list|)
expr_stmt|;
if|if
condition|(
name|bp
operator|==
name|NULL
condition|)
name|error
argument_list|(
literal|"Software breakpoints not implemented for this target."
argument_list|)
expr_stmt|;
return|return
name|target_write_memory
argument_list|(
name|addr
argument_list|,
name|contents_cache
argument_list|,
name|bplen
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|memory_insert_breakpoint
parameter_list|(
name|CORE_ADDR
name|addr
parameter_list|,
name|char
modifier|*
name|contents_cache
parameter_list|)
block|{
return|return
name|MEMORY_INSERT_BREAKPOINT
argument_list|(
name|addr
argument_list|,
name|contents_cache
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|memory_remove_breakpoint
parameter_list|(
name|CORE_ADDR
name|addr
parameter_list|,
name|char
modifier|*
name|contents_cache
parameter_list|)
block|{
return|return
name|MEMORY_REMOVE_BREAKPOINT
argument_list|(
name|addr
argument_list|,
name|contents_cache
argument_list|)
return|;
block|}
end_function

end_unit

