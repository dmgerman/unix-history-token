begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Target-dependent code for the IA-64 for GDB, the GNU debugger.    Copyright 2000, 2001    Free Software Foundation, Inc.     This file is part of GDB.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330,    Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_comment
comment|/* External hook for finding gate addresses on AIX.  */
end_comment

begin_function_decl
name|void
function_decl|(
modifier|*
name|aix5_find_gate_addresses_hook
function_decl|)
parameter_list|(
name|CORE_ADDR
modifier|*
parameter_list|,
name|CORE_ADDR
modifier|*
parameter_list|)
init|=
literal|0
function_decl|;
end_function_decl

begin_comment
comment|/* Offset to sc_context member of sigcontext structure from frame of handler */
end_comment

begin_define
define|#
directive|define
name|IA64_AIX_SIGCONTEXT_OFFSET
value|64
end_define

begin_comment
comment|/* Return a non-zero value iff PC is in a signal trampoline.  On    AIX, we determine this by seeing if the pc is in a special    execute only page called the ``gate page''.  The addresses in    question are determined by letting the AIX native portion of    the code determine these addresses via its own nefarious    means.  */
end_comment

begin_function
name|int
name|ia64_aix_in_sigtramp
parameter_list|(
name|CORE_ADDR
name|pc
parameter_list|,
name|char
modifier|*
name|func_name
parameter_list|)
block|{
name|CORE_ADDR
name|gate_area_start
decl_stmt|,
name|gate_area_end
decl_stmt|;
if|if
condition|(
name|aix5_find_gate_addresses_hook
operator|==
literal|0
condition|)
return|return
literal|0
return|;
call|(
modifier|*
name|aix5_find_gate_addresses_hook
call|)
argument_list|(
operator|&
name|gate_area_start
argument_list|,
operator|&
name|gate_area_end
argument_list|)
expr_stmt|;
return|return
operator|(
name|pc
operator|>=
name|gate_area_start
operator|&&
name|pc
operator|<
name|gate_area_end
operator|)
return|;
block|}
end_function

begin_comment
comment|/* IA-64 AIX specific function which, given a frame address and    a register number, returns the address at which that register may be    found.  0 is returned for registers which aren't stored in the    sigcontext structure.  */
end_comment

begin_function
name|CORE_ADDR
name|ia64_aix_sigcontext_register_address
parameter_list|(
name|CORE_ADDR
name|sp
parameter_list|,
name|int
name|regno
parameter_list|)
block|{
comment|/* The hardcoded offsets that follow are actually offsets to the      corresponding members in struct __context in      /usr/include/sys/context.h (on an IA-64 AIX5 box).  */
if|if
condition|(
name|IA64_GR0_REGNUM
operator|<=
name|regno
operator|&&
name|regno
operator|<=
name|IA64_GR31_REGNUM
condition|)
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|152
operator|+
literal|8
operator|*
operator|(
name|regno
operator|-
name|IA64_GR0_REGNUM
operator|)
return|;
elseif|else
if|if
condition|(
name|IA64_BR0_REGNUM
operator|<=
name|regno
operator|&&
name|regno
operator|<=
name|IA64_BR7_REGNUM
condition|)
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|408
operator|+
literal|8
operator|*
operator|(
name|regno
operator|-
name|IA64_BR0_REGNUM
operator|)
return|;
elseif|else
if|if
condition|(
name|IA64_FR0_REGNUM
operator|<=
name|regno
operator|&&
name|regno
operator|<=
name|IA64_FR127_REGNUM
condition|)
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|480
operator|+
literal|16
operator|*
operator|(
name|regno
operator|-
name|IA64_FR0_REGNUM
operator|)
return|;
else|else
switch|switch
condition|(
name|regno
condition|)
block|{
case|case
name|IA64_PSR_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|0
return|;
case|case
name|IA64_IP_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|8
return|;
comment|/* iipa is at 16.          isr is at 24. 	 ifa is at 32. 	 iim is at 40. */
case|case
name|IA64_CFM_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|48
return|;
comment|/* ifs, actually */
case|case
name|IA64_RSC_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|56
return|;
case|case
name|IA64_BSP_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|64
return|;
case|case
name|IA64_BSPSTORE_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|72
return|;
case|case
name|IA64_RNAT_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|80
return|;
case|case
name|IA64_PFS_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|88
return|;
case|case
name|IA64_UNAT_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|96
return|;
case|case
name|IA64_PR_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|104
return|;
case|case
name|IA64_CCV_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|112
return|;
case|case
name|IA64_LC_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|120
return|;
case|case
name|IA64_EC_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|128
return|;
comment|/* nats is at 136; this is an address independent NaT bitmask */
case|case
name|IA64_FPSR_REGNUM
case|:
return|return
name|sp
operator|+
name|IA64_AIX_SIGCONTEXT_OFFSET
operator|+
literal|144
return|;
default|default :
return|return
literal|0
return|;
block|}
block|}
end_function

end_unit

