begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Intel 387 floating point stuff.    Copyright 1988, 1989, 1991, 1992, 1993, 1994, 1998, 1999, 2000, 2001    Free Software Foundation, Inc.     This file is part of GDB.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330,    Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"frame.h"
end_include

begin_include
include|#
directive|include
file|"inferior.h"
end_include

begin_include
include|#
directive|include
file|"language.h"
end_include

begin_include
include|#
directive|include
file|"value.h"
end_include

begin_include
include|#
directive|include
file|"gdbcore.h"
end_include

begin_include
include|#
directive|include
file|"floatformat.h"
end_include

begin_include
include|#
directive|include
file|"regcache.h"
end_include

begin_include
include|#
directive|include
file|"gdb_assert.h"
end_include

begin_include
include|#
directive|include
file|"doublest.h"
end_include

begin_include
include|#
directive|include
file|"i386-tdep.h"
end_include

begin_comment
comment|/* FIXME: Eliminate the next two functions when we have the time to    change all the callers.  */
end_comment

begin_function_decl
name|void
name|i387_to_double
parameter_list|(
name|char
modifier|*
name|from
parameter_list|,
name|char
modifier|*
name|to
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|double_to_i387
parameter_list|(
name|char
modifier|*
name|from
parameter_list|,
name|char
modifier|*
name|to
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|i387_to_double
parameter_list|(
name|char
modifier|*
name|from
parameter_list|,
name|char
modifier|*
name|to
parameter_list|)
block|{
name|floatformat_to_double
argument_list|(
operator|&
name|floatformat_i387_ext
argument_list|,
name|from
argument_list|,
operator|(
name|double
operator|*
operator|)
name|to
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|double_to_i387
parameter_list|(
name|char
modifier|*
name|from
parameter_list|,
name|char
modifier|*
name|to
parameter_list|)
block|{
name|floatformat_from_double
argument_list|(
operator|&
name|floatformat_i387_ext
argument_list|,
operator|(
name|double
operator|*
operator|)
name|from
argument_list|,
name|to
argument_list|)
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* FIXME: The functions on this page are used by the old `info float'    implementations that a few of the i386 targets provide.  These    functions should be removed if all of these have been converted to    use the generic implementation based on the new register file    layout.  */
end_comment

begin_function_decl
specifier|static
name|void
name|print_387_control_bits
parameter_list|(
name|unsigned
name|int
name|control
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_387_status_bits
parameter_list|(
name|unsigned
name|int
name|status
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
name|void
name|print_387_control_bits
parameter_list|(
name|unsigned
name|int
name|control
parameter_list|)
block|{
switch|switch
condition|(
operator|(
name|control
operator|>>
literal|8
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
name|puts_unfiltered
argument_list|(
literal|" 24 bit; "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|puts_unfiltered
argument_list|(
literal|" (bad); "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|puts_unfiltered
argument_list|(
literal|" 53 bit; "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|puts_unfiltered
argument_list|(
literal|" 64 bit; "
argument_list|)
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
operator|(
name|control
operator|>>
literal|10
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
name|puts_unfiltered
argument_list|(
literal|"NEAR; "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|puts_unfiltered
argument_list|(
literal|"DOWN; "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|puts_unfiltered
argument_list|(
literal|"UP; "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|puts_unfiltered
argument_list|(
literal|"CHOP; "
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|control
operator|&
literal|0x3f
condition|)
block|{
name|puts_unfiltered
argument_list|(
literal|"mask"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0001
condition|)
name|puts_unfiltered
argument_list|(
literal|" INVAL"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0002
condition|)
name|puts_unfiltered
argument_list|(
literal|" DENOR"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0004
condition|)
name|puts_unfiltered
argument_list|(
literal|" DIVZ"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0008
condition|)
name|puts_unfiltered
argument_list|(
literal|" OVERF"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0010
condition|)
name|puts_unfiltered
argument_list|(
literal|" UNDER"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0020
condition|)
name|puts_unfiltered
argument_list|(
literal|" LOS"
argument_list|)
expr_stmt|;
name|puts_unfiltered
argument_list|(
literal|";"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|control
operator|&
literal|0xe080
condition|)
name|warning
argument_list|(
literal|"\nreserved bits on: %s"
argument_list|,
name|local_hex_string
argument_list|(
name|control
operator|&
literal|0xe080
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|print_387_control_word
parameter_list|(
name|unsigned
name|int
name|control
parameter_list|)
block|{
name|printf_filtered
argument_list|(
literal|"control %s:"
argument_list|,
name|local_hex_string
argument_list|(
name|control
operator|&
literal|0xffff
argument_list|)
argument_list|)
expr_stmt|;
name|print_387_control_bits
argument_list|(
name|control
argument_list|)
expr_stmt|;
name|puts_unfiltered
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_387_status_bits
parameter_list|(
name|unsigned
name|int
name|status
parameter_list|)
block|{
name|printf_unfiltered
argument_list|(
literal|" flags %d%d%d%d; "
argument_list|,
operator|(
name|status
operator|&
literal|0x4000
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|status
operator|&
literal|0x0400
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|status
operator|&
literal|0x0200
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|status
operator|&
literal|0x0100
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|printf_unfiltered
argument_list|(
literal|"top %d; "
argument_list|,
operator|(
name|status
operator|>>
literal|11
operator|)
operator|&
literal|7
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0xff
condition|)
block|{
name|puts_unfiltered
argument_list|(
literal|"excep"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0001
condition|)
name|puts_unfiltered
argument_list|(
literal|" INVAL"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0002
condition|)
name|puts_unfiltered
argument_list|(
literal|" DENOR"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0004
condition|)
name|puts_unfiltered
argument_list|(
literal|" DIVZ"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0008
condition|)
name|puts_unfiltered
argument_list|(
literal|" OVERF"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0010
condition|)
name|puts_unfiltered
argument_list|(
literal|" UNDER"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0020
condition|)
name|puts_unfiltered
argument_list|(
literal|" LOS"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0040
condition|)
name|puts_unfiltered
argument_list|(
literal|" STACK"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|print_387_status_word
parameter_list|(
name|unsigned
name|int
name|status
parameter_list|)
block|{
name|printf_filtered
argument_list|(
literal|"status %s:"
argument_list|,
name|local_hex_string
argument_list|(
name|status
operator|&
literal|0xffff
argument_list|)
argument_list|)
expr_stmt|;
name|print_387_status_bits
argument_list|(
name|status
argument_list|)
expr_stmt|;
name|puts_unfiltered
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Implement the `info float' layout based on the register definitions    in `tm-i386.h'.  */
end_comment

begin_comment
comment|/* Print the floating point number specified by RAW.  */
end_comment

begin_function
specifier|static
name|void
name|print_i387_value
parameter_list|(
name|char
modifier|*
name|raw
parameter_list|)
block|{
name|DOUBLEST
name|value
decl_stmt|;
comment|/* Using extract_typed_floating here might affect the representation      of certain numbers such as NaNs, even if GDB is running natively.      This is fine since our caller already detects such special      numbers and we print the hexadecimal representation anyway.  */
name|value
operator|=
name|extract_typed_floating
argument_list|(
name|raw
argument_list|,
name|builtin_type_i387_ext
argument_list|)
expr_stmt|;
comment|/* We try to print 19 digits.  The last digit may or may not contain      garbage, but we'd better print one too many.  We need enough room      to print the value, 1 position for the sign, 1 for the decimal      point, 19 for the digits and 6 for the exponent adds up to 27.  */
ifdef|#
directive|ifdef
name|PRINTF_HAS_LONG_DOUBLE
name|printf_filtered
argument_list|(
literal|" %-+27.19Lg"
argument_list|,
operator|(
name|long
name|double
operator|)
name|value
argument_list|)
expr_stmt|;
else|#
directive|else
name|printf_filtered
argument_list|(
literal|" %-+27.19g"
argument_list|,
operator|(
name|double
operator|)
name|value
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Print the classification for the register contents RAW.  */
end_comment

begin_function
specifier|static
name|void
name|print_i387_ext
parameter_list|(
name|unsigned
name|char
modifier|*
name|raw
parameter_list|)
block|{
name|int
name|sign
decl_stmt|;
name|int
name|integer
decl_stmt|;
name|unsigned
name|int
name|exponent
decl_stmt|;
name|unsigned
name|long
name|fraction
index|[
literal|2
index|]
decl_stmt|;
name|sign
operator|=
name|raw
index|[
literal|9
index|]
operator|&
literal|0x80
expr_stmt|;
name|integer
operator|=
name|raw
index|[
literal|7
index|]
operator|&
literal|0x80
expr_stmt|;
name|exponent
operator|=
operator|(
operator|(
operator|(
name|raw
index|[
literal|9
index|]
operator|&
literal|0x7f
operator|)
operator|<<
literal|8
operator|)
operator||
name|raw
index|[
literal|8
index|]
operator|)
expr_stmt|;
name|fraction
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|raw
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
name|raw
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|raw
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|raw
index|[
literal|0
index|]
operator|)
expr_stmt|;
name|fraction
index|[
literal|1
index|]
operator|=
operator|(
operator|(
operator|(
name|raw
index|[
literal|7
index|]
operator|&
literal|0x7f
operator|)
operator|<<
literal|24
operator|)
operator||
operator|(
name|raw
index|[
literal|6
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|raw
index|[
literal|5
index|]
operator|<<
literal|8
operator|)
operator||
name|raw
index|[
literal|4
index|]
operator|)
expr_stmt|;
if|if
condition|(
name|exponent
operator|==
literal|0x7fff
operator|&&
name|integer
condition|)
block|{
if|if
condition|(
name|fraction
index|[
literal|0
index|]
operator|==
literal|0x00000000
operator|&&
name|fraction
index|[
literal|1
index|]
operator|==
literal|0x00000000
condition|)
comment|/* Infinity.  */
name|printf_filtered
argument_list|(
literal|" %cInf"
argument_list|,
operator|(
name|sign
condition|?
literal|'-'
else|:
literal|'+'
operator|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|sign
operator|&&
name|fraction
index|[
literal|0
index|]
operator|==
literal|0x00000000
operator|&&
name|fraction
index|[
literal|1
index|]
operator|==
literal|0x40000000
condition|)
comment|/* Real Indefinite (QNaN).  */
name|puts_unfiltered
argument_list|(
literal|" Real Indefinite (QNaN)"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fraction
index|[
literal|1
index|]
operator|&
literal|0x40000000
condition|)
comment|/* QNaN.  */
name|puts_filtered
argument_list|(
literal|" QNaN"
argument_list|)
expr_stmt|;
else|else
comment|/* SNaN.  */
name|puts_filtered
argument_list|(
literal|" SNaN"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|exponent
operator|<
literal|0x7fff
operator|&&
name|exponent
operator|>
literal|0x0000
operator|&&
name|integer
condition|)
comment|/* Normal.  */
name|print_i387_value
argument_list|(
name|raw
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|exponent
operator|==
literal|0x0000
condition|)
block|{
comment|/* Denormal or zero.  */
name|print_i387_value
argument_list|(
name|raw
argument_list|)
expr_stmt|;
if|if
condition|(
name|integer
condition|)
comment|/* Pseudo-denormal.  */
name|puts_filtered
argument_list|(
literal|" Pseudo-denormal"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fraction
index|[
literal|0
index|]
operator|||
name|fraction
index|[
literal|1
index|]
condition|)
comment|/* Denormal.  */
name|puts_filtered
argument_list|(
literal|" Denormal"
argument_list|)
expr_stmt|;
block|}
else|else
comment|/* Unsupported.  */
name|puts_filtered
argument_list|(
literal|" Unsupported"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Print the status word STATUS.  */
end_comment

begin_function
specifier|static
name|void
name|print_i387_status_word
parameter_list|(
name|unsigned
name|int
name|status
parameter_list|)
block|{
name|printf_filtered
argument_list|(
literal|"Status Word:         %s"
argument_list|,
name|local_hex_string_custom
argument_list|(
name|status
argument_list|,
literal|"04"
argument_list|)
argument_list|)
expr_stmt|;
name|puts_filtered
argument_list|(
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x0001
operator|)
condition|?
literal|"IE"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x0002
operator|)
condition|?
literal|"DE"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x0004
operator|)
condition|?
literal|"ZE"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x0008
operator|)
condition|?
literal|"OE"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x0010
operator|)
condition|?
literal|"UE"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x0020
operator|)
condition|?
literal|"PE"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|puts_filtered
argument_list|(
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x0080
operator|)
condition|?
literal|"ES"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|puts_filtered
argument_list|(
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x0040
operator|)
condition|?
literal|"SF"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|puts_filtered
argument_list|(
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x0100
operator|)
condition|?
literal|"C0"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x0200
operator|)
condition|?
literal|"C1"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x0400
operator|)
condition|?
literal|"C2"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|status
operator|&
literal|0x4000
operator|)
condition|?
literal|"C3"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|puts_filtered
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|"                       TOP: %d\n"
argument_list|,
operator|(
operator|(
name|status
operator|>>
literal|11
operator|)
operator|&
literal|7
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Print the control word CONTROL.  */
end_comment

begin_function
specifier|static
name|void
name|print_i387_control_word
parameter_list|(
name|unsigned
name|int
name|control
parameter_list|)
block|{
name|printf_filtered
argument_list|(
literal|"Control Word:        %s"
argument_list|,
name|local_hex_string_custom
argument_list|(
name|control
argument_list|,
literal|"04"
argument_list|)
argument_list|)
expr_stmt|;
name|puts_filtered
argument_list|(
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|control
operator|&
literal|0x0001
operator|)
condition|?
literal|"IM"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|control
operator|&
literal|0x0002
operator|)
condition|?
literal|"DM"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|control
operator|&
literal|0x0004
operator|)
condition|?
literal|"ZM"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|control
operator|&
literal|0x0008
operator|)
condition|?
literal|"OM"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|control
operator|&
literal|0x0010
operator|)
condition|?
literal|"UM"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|" %s"
argument_list|,
operator|(
name|control
operator|&
literal|0x0020
operator|)
condition|?
literal|"PM"
else|:
literal|"  "
argument_list|)
expr_stmt|;
name|puts_filtered
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|puts_filtered
argument_list|(
literal|"                       PC: "
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|control
operator|>>
literal|8
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
name|puts_filtered
argument_list|(
literal|"Single Precision (24-bits)\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|puts_filtered
argument_list|(
literal|"Reserved\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|puts_filtered
argument_list|(
literal|"Double Precision (53-bits)\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|puts_filtered
argument_list|(
literal|"Extended Precision (64-bits)\n"
argument_list|)
expr_stmt|;
break|break;
block|}
name|puts_filtered
argument_list|(
literal|"                       RC: "
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|control
operator|>>
literal|10
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
name|puts_filtered
argument_list|(
literal|"Round to nearest\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|puts_filtered
argument_list|(
literal|"Round down\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|puts_filtered
argument_list|(
literal|"Round up\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|puts_filtered
argument_list|(
literal|"Round toward zero\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/* Print out the i387 floating poin state.  */
end_comment

begin_function
name|void
name|i387_float_info
parameter_list|(
name|void
parameter_list|)
block|{
name|unsigned
name|int
name|fctrl
decl_stmt|;
name|unsigned
name|int
name|fstat
decl_stmt|;
name|unsigned
name|int
name|ftag
decl_stmt|;
name|unsigned
name|int
name|fiseg
decl_stmt|;
name|unsigned
name|int
name|fioff
decl_stmt|;
name|unsigned
name|int
name|foseg
decl_stmt|;
name|unsigned
name|int
name|fooff
decl_stmt|;
name|unsigned
name|int
name|fop
decl_stmt|;
name|int
name|fpreg
decl_stmt|;
name|int
name|top
decl_stmt|;
name|fctrl
operator|=
name|read_register
argument_list|(
name|FCTRL_REGNUM
argument_list|)
expr_stmt|;
name|fstat
operator|=
name|read_register
argument_list|(
name|FSTAT_REGNUM
argument_list|)
expr_stmt|;
name|ftag
operator|=
name|read_register
argument_list|(
name|FTAG_REGNUM
argument_list|)
expr_stmt|;
name|fiseg
operator|=
name|read_register
argument_list|(
name|FCS_REGNUM
argument_list|)
expr_stmt|;
name|fioff
operator|=
name|read_register
argument_list|(
name|FCOFF_REGNUM
argument_list|)
expr_stmt|;
name|foseg
operator|=
name|read_register
argument_list|(
name|FDS_REGNUM
argument_list|)
expr_stmt|;
name|fooff
operator|=
name|read_register
argument_list|(
name|FDOFF_REGNUM
argument_list|)
expr_stmt|;
name|fop
operator|=
name|read_register
argument_list|(
name|FOP_REGNUM
argument_list|)
expr_stmt|;
name|top
operator|=
operator|(
operator|(
name|fstat
operator|>>
literal|11
operator|)
operator|&
literal|7
operator|)
expr_stmt|;
for|for
control|(
name|fpreg
operator|=
literal|7
init|;
name|fpreg
operator|>=
literal|0
condition|;
name|fpreg
operator|--
control|)
block|{
name|unsigned
name|char
name|raw
index|[
name|FPU_REG_RAW_SIZE
index|]
decl_stmt|;
name|int
name|tag
init|=
operator|(
name|ftag
operator|>>
operator|(
name|fpreg
operator|*
literal|2
operator|)
operator|)
operator|&
literal|3
decl_stmt|;
name|int
name|i
decl_stmt|;
name|printf_filtered
argument_list|(
literal|"%sR%d: "
argument_list|,
name|fpreg
operator|==
name|top
condition|?
literal|"=>"
else|:
literal|"  "
argument_list|,
name|fpreg
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|tag
condition|)
block|{
case|case
literal|0
case|:
name|puts_filtered
argument_list|(
literal|"Valid   "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|puts_filtered
argument_list|(
literal|"Zero    "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|puts_filtered
argument_list|(
literal|"Special "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|puts_filtered
argument_list|(
literal|"Empty   "
argument_list|)
expr_stmt|;
break|break;
block|}
name|read_register_gen
argument_list|(
operator|(
name|fpreg
operator|+
literal|8
operator|-
name|top
operator|)
operator|%
literal|8
operator|+
name|FP0_REGNUM
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|puts_filtered
argument_list|(
literal|"0x"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|9
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
name|printf_filtered
argument_list|(
literal|"%02x"
argument_list|,
name|raw
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|tag
operator|!=
literal|3
condition|)
name|print_i387_ext
argument_list|(
name|raw
argument_list|)
expr_stmt|;
name|puts_filtered
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|puts_filtered
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|print_i387_status_word
argument_list|(
name|fstat
argument_list|)
expr_stmt|;
name|print_i387_control_word
argument_list|(
name|fctrl
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|"Tag Word:            %s\n"
argument_list|,
name|local_hex_string_custom
argument_list|(
name|ftag
argument_list|,
literal|"04"
argument_list|)
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|"Instruction Pointer: %s:"
argument_list|,
name|local_hex_string_custom
argument_list|(
name|fiseg
argument_list|,
literal|"02"
argument_list|)
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|"%s\n"
argument_list|,
name|local_hex_string_custom
argument_list|(
name|fioff
argument_list|,
literal|"08"
argument_list|)
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|"Operand Pointer:     %s:"
argument_list|,
name|local_hex_string_custom
argument_list|(
name|foseg
argument_list|,
literal|"02"
argument_list|)
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|"%s\n"
argument_list|,
name|local_hex_string_custom
argument_list|(
name|fooff
argument_list|,
literal|"08"
argument_list|)
argument_list|)
expr_stmt|;
name|printf_filtered
argument_list|(
literal|"Opcode:              %s\n"
argument_list|,
name|local_hex_string_custom
argument_list|(
name|fop
condition|?
operator|(
name|fop
operator||
literal|0xd800
operator|)
else|:
literal|0
argument_list|,
literal|"04"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

