begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GNU/Linux/i386 specific low level interface, for the remote server for GDB.    Copyright 1995, 1996, 1998, 1999, 2000, 2001, 2002    Free Software Foundation, Inc.     This file is part of GDB.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330,    Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"server.h"
end_include

begin_include
include|#
directive|include
file|"linux-low.h"
end_include

begin_include
include|#
directive|include
file|"i387-fp.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SYS_REG_H
end_ifdef

begin_include
include|#
directive|include
file|<sys/reg.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* This module only supports access to the general purpose registers.  */
end_comment

begin_decl_stmt
name|int
name|num_regs
init|=
literal|16
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* This stuff comes from i386-linux-nat.c.  */
end_comment

begin_comment
comment|/* Mapping between the general-purpose registers in `struct user'    format and GDB's register array layout.  */
end_comment

begin_decl_stmt
name|int
name|regmap
index|[]
init|=
block|{
name|EAX
operator|*
literal|4
block|,
name|ECX
operator|*
literal|4
block|,
name|EDX
operator|*
literal|4
block|,
name|EBX
operator|*
literal|4
block|,
name|UESP
operator|*
literal|4
block|,
name|EBP
operator|*
literal|4
block|,
name|ESI
operator|*
literal|4
block|,
name|EDI
operator|*
literal|4
block|,
name|EIP
operator|*
literal|4
block|,
name|EFL
operator|*
literal|4
block|,
name|CS
operator|*
literal|4
block|,
name|SS
operator|*
literal|4
block|,
name|DS
operator|*
literal|4
block|,
name|ES
operator|*
literal|4
block|,
name|FS
operator|*
literal|4
block|,
name|GS
operator|*
literal|4
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|cannot_store_register
parameter_list|(
name|int
name|regno
parameter_list|)
block|{
return|return
operator|(
name|regno
operator|>=
name|num_regs
operator|)
return|;
block|}
end_function

begin_function
name|int
name|cannot_fetch_register
parameter_list|(
name|int
name|regno
parameter_list|)
block|{
return|return
operator|(
name|regno
operator|>=
name|num_regs
operator|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_LINUX_REGSETS
end_ifdef

begin_include
include|#
directive|include
file|<sys/procfs.h>
end_include

begin_include
include|#
directive|include
file|<sys/ptrace.h>
end_include

begin_function
specifier|static
name|void
name|i386_fill_gregset
parameter_list|(
name|void
modifier|*
name|buf
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_regs
condition|;
name|i
operator|++
control|)
name|collect_register
argument_list|(
name|i
argument_list|,
operator|(
operator|(
name|char
operator|*
operator|)
name|buf
operator|)
operator|+
name|regmap
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|collect_register_by_name
argument_list|(
literal|"orig_eax"
argument_list|,
operator|(
operator|(
name|char
operator|*
operator|)
name|buf
operator|)
operator|+
name|ORIG_EAX
operator|*
literal|4
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|i386_store_gregset
parameter_list|(
name|void
modifier|*
name|buf
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_regs
condition|;
name|i
operator|++
control|)
name|supply_register
argument_list|(
name|i
argument_list|,
operator|(
operator|(
name|char
operator|*
operator|)
name|buf
operator|)
operator|+
name|regmap
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|supply_register_by_name
argument_list|(
literal|"orig_eax"
argument_list|,
operator|(
operator|(
name|char
operator|*
operator|)
name|buf
operator|)
operator|+
name|ORIG_EAX
operator|*
literal|4
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|i386_fill_fpregset
parameter_list|(
name|void
modifier|*
name|buf
parameter_list|)
block|{
name|i387_cache_to_fsave
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|i386_store_fpregset
parameter_list|(
name|void
modifier|*
name|buf
parameter_list|)
block|{
name|i387_fsave_to_cache
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|i386_fill_fpxregset
parameter_list|(
name|void
modifier|*
name|buf
parameter_list|)
block|{
name|i387_cache_to_fxsave
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|i386_store_fpxregset
parameter_list|(
name|void
modifier|*
name|buf
parameter_list|)
block|{
name|i387_fxsave_to_cache
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
name|struct
name|regset_info
name|target_regsets
index|[]
init|=
block|{
block|{
name|PTRACE_GETREGS
block|,
name|PTRACE_SETREGS
block|,
sizeof|sizeof
argument_list|(
name|elf_gregset_t
argument_list|)
block|,
name|i386_fill_gregset
block|,
name|i386_store_gregset
block|}
block|,
ifdef|#
directive|ifdef
name|HAVE_PTRACE_GETFPXREGS
block|{
name|PTRACE_GETFPXREGS
block|,
name|PTRACE_SETFPXREGS
block|,
sizeof|sizeof
argument_list|(
name|elf_fpxregset_t
argument_list|)
block|,
name|i386_fill_fpxregset
block|,
name|i386_store_fpxregset
block|}
block|,
endif|#
directive|endif
block|{
name|PTRACE_GETFPREGS
block|,
name|PTRACE_SETFPREGS
block|,
sizeof|sizeof
argument_list|(
name|elf_fpregset_t
argument_list|)
block|,
name|i386_fill_fpregset
block|,
name|i386_store_fpregset
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
operator|-
literal|1
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_LINUX_REGSETS */
end_comment

end_unit

