begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * SHA1 hash implementation and interface functions  * Copyright (c) 2003-2005, Jouni Malinen<jkmaline@cc.hut.fi>  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License version 2 as  * published by the Free Software Foundation.  *  * Alternatively, this software may be distributed under the terms of BSD  * license.  *  * See README and COPYING for more details.  */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"common.h"
end_include

begin_include
include|#
directive|include
file|"sha1.h"
end_include

begin_include
include|#
directive|include
file|"md5.h"
end_include

begin_function
name|void
name|sha1_mac
parameter_list|(
specifier|const
name|u8
modifier|*
name|key
parameter_list|,
name|size_t
name|key_len
parameter_list|,
specifier|const
name|u8
modifier|*
name|data
parameter_list|,
name|size_t
name|data_len
parameter_list|,
name|u8
modifier|*
name|mac
parameter_list|)
block|{
name|SHA1_CTX
name|context
decl_stmt|;
name|SHA1Init
argument_list|(
operator|&
name|context
argument_list|)
expr_stmt|;
name|SHA1Update
argument_list|(
operator|&
name|context
argument_list|,
name|key
argument_list|,
name|key_len
argument_list|)
expr_stmt|;
name|SHA1Update
argument_list|(
operator|&
name|context
argument_list|,
name|data
argument_list|,
name|data_len
argument_list|)
expr_stmt|;
name|SHA1Update
argument_list|(
operator|&
name|context
argument_list|,
name|key
argument_list|,
name|key_len
argument_list|)
expr_stmt|;
name|SHA1Final
argument_list|(
name|mac
argument_list|,
operator|&
name|context
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* HMAC code is based on RFC 2104 */
end_comment

begin_function
name|void
name|hmac_sha1_vector
parameter_list|(
specifier|const
name|u8
modifier|*
name|key
parameter_list|,
name|size_t
name|key_len
parameter_list|,
name|size_t
name|num_elem
parameter_list|,
specifier|const
name|u8
modifier|*
name|addr
index|[]
parameter_list|,
specifier|const
name|size_t
modifier|*
name|len
parameter_list|,
name|u8
modifier|*
name|mac
parameter_list|)
block|{
name|SHA1_CTX
name|context
decl_stmt|;
name|unsigned
name|char
name|k_ipad
index|[
literal|65
index|]
decl_stmt|;
comment|/* inner padding - key XORd with ipad */
name|unsigned
name|char
name|k_opad
index|[
literal|65
index|]
decl_stmt|;
comment|/* outer padding - key XORd with opad */
name|unsigned
name|char
name|tk
index|[
literal|20
index|]
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/* if key is longer than 64 bytes reset it to key = SHA1(key) */
if|if
condition|(
name|key_len
operator|>
literal|64
condition|)
block|{
name|SHA1Init
argument_list|(
operator|&
name|context
argument_list|)
expr_stmt|;
name|SHA1Update
argument_list|(
operator|&
name|context
argument_list|,
name|key
argument_list|,
name|key_len
argument_list|)
expr_stmt|;
name|SHA1Final
argument_list|(
name|tk
argument_list|,
operator|&
name|context
argument_list|)
expr_stmt|;
name|key
operator|=
name|tk
expr_stmt|;
name|key_len
operator|=
literal|20
expr_stmt|;
block|}
comment|/* the HMAC_SHA1 transform looks like: 	 * 	 * SHA1(K XOR opad, SHA1(K XOR ipad, text)) 	 * 	 * where K is an n byte key 	 * ipad is the byte 0x36 repeated 64 times 	 * opad is the byte 0x5c repeated 64 times 	 * and text is the data being protected */
comment|/* start out by storing key in pads */
name|memset
argument_list|(
name|k_ipad
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|k_ipad
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|k_opad
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|k_opad
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|k_ipad
argument_list|,
name|key
argument_list|,
name|key_len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|k_opad
argument_list|,
name|key
argument_list|,
name|key_len
argument_list|)
expr_stmt|;
comment|/* XOR key with ipad and opad values */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|++
control|)
block|{
name|k_ipad
index|[
name|i
index|]
operator|^=
literal|0x36
expr_stmt|;
name|k_opad
index|[
name|i
index|]
operator|^=
literal|0x5c
expr_stmt|;
block|}
comment|/* perform inner SHA1 */
name|SHA1Init
argument_list|(
operator|&
name|context
argument_list|)
expr_stmt|;
comment|/* init context for 1st pass */
name|SHA1Update
argument_list|(
operator|&
name|context
argument_list|,
name|k_ipad
argument_list|,
literal|64
argument_list|)
expr_stmt|;
comment|/* start with inner pad */
comment|/* then text of datagram; all fragments */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_elem
condition|;
name|i
operator|++
control|)
block|{
name|SHA1Update
argument_list|(
operator|&
name|context
argument_list|,
name|addr
index|[
name|i
index|]
argument_list|,
name|len
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|SHA1Final
argument_list|(
name|mac
argument_list|,
operator|&
name|context
argument_list|)
expr_stmt|;
comment|/* finish up 1st pass */
comment|/* perform outer SHA1 */
name|SHA1Init
argument_list|(
operator|&
name|context
argument_list|)
expr_stmt|;
comment|/* init context for 2nd pass */
name|SHA1Update
argument_list|(
operator|&
name|context
argument_list|,
name|k_opad
argument_list|,
literal|64
argument_list|)
expr_stmt|;
comment|/* start with outer pad */
name|SHA1Update
argument_list|(
operator|&
name|context
argument_list|,
name|mac
argument_list|,
literal|20
argument_list|)
expr_stmt|;
comment|/* then results of 1st hash */
name|SHA1Final
argument_list|(
name|mac
argument_list|,
operator|&
name|context
argument_list|)
expr_stmt|;
comment|/* finish up 2nd pass */
block|}
end_function

begin_function
name|void
name|hmac_sha1
parameter_list|(
specifier|const
name|u8
modifier|*
name|key
parameter_list|,
name|size_t
name|key_len
parameter_list|,
specifier|const
name|u8
modifier|*
name|data
parameter_list|,
name|size_t
name|data_len
parameter_list|,
name|u8
modifier|*
name|mac
parameter_list|)
block|{
name|hmac_sha1_vector
argument_list|(
name|key
argument_list|,
name|key_len
argument_list|,
literal|1
argument_list|,
operator|&
name|data
argument_list|,
operator|&
name|data_len
argument_list|,
name|mac
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|sha1_prf
parameter_list|(
specifier|const
name|u8
modifier|*
name|key
parameter_list|,
name|size_t
name|key_len
parameter_list|,
specifier|const
name|char
modifier|*
name|label
parameter_list|,
specifier|const
name|u8
modifier|*
name|data
parameter_list|,
name|size_t
name|data_len
parameter_list|,
name|u8
modifier|*
name|buf
parameter_list|,
name|size_t
name|buf_len
parameter_list|)
block|{
name|u8
name|zero
init|=
literal|0
decl_stmt|,
name|counter
init|=
literal|0
decl_stmt|;
name|size_t
name|pos
decl_stmt|,
name|plen
decl_stmt|;
name|u8
name|hash
index|[
name|SHA1_MAC_LEN
index|]
decl_stmt|;
name|size_t
name|label_len
init|=
name|strlen
argument_list|(
name|label
argument_list|)
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|addr
index|[
literal|4
index|]
decl_stmt|;
name|size_t
name|len
index|[
literal|4
index|]
decl_stmt|;
name|addr
index|[
literal|0
index|]
operator|=
operator|(
name|u8
operator|*
operator|)
name|label
expr_stmt|;
name|len
index|[
literal|0
index|]
operator|=
name|label_len
expr_stmt|;
name|addr
index|[
literal|1
index|]
operator|=
operator|&
name|zero
expr_stmt|;
name|len
index|[
literal|1
index|]
operator|=
literal|1
expr_stmt|;
name|addr
index|[
literal|2
index|]
operator|=
name|data
expr_stmt|;
name|len
index|[
literal|2
index|]
operator|=
name|data_len
expr_stmt|;
name|addr
index|[
literal|3
index|]
operator|=
operator|&
name|counter
expr_stmt|;
name|len
index|[
literal|3
index|]
operator|=
literal|1
expr_stmt|;
name|pos
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|pos
operator|<
name|buf_len
condition|)
block|{
name|plen
operator|=
name|buf_len
operator|-
name|pos
expr_stmt|;
if|if
condition|(
name|plen
operator|>=
name|SHA1_MAC_LEN
condition|)
block|{
name|hmac_sha1_vector
argument_list|(
name|key
argument_list|,
name|key_len
argument_list|,
literal|4
argument_list|,
name|addr
argument_list|,
name|len
argument_list|,
operator|&
name|buf
index|[
name|pos
index|]
argument_list|)
expr_stmt|;
name|pos
operator|+=
name|SHA1_MAC_LEN
expr_stmt|;
block|}
else|else
block|{
name|hmac_sha1_vector
argument_list|(
name|key
argument_list|,
name|key_len
argument_list|,
literal|4
argument_list|,
name|addr
argument_list|,
name|len
argument_list|,
name|hash
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|buf
index|[
name|pos
index|]
argument_list|,
name|hash
argument_list|,
name|plen
argument_list|)
expr_stmt|;
break|break;
block|}
name|counter
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* draft-cam-winget-eap-fast-00.txt */
end_comment

begin_function
name|void
name|sha1_t_prf
parameter_list|(
specifier|const
name|u8
modifier|*
name|key
parameter_list|,
name|size_t
name|key_len
parameter_list|,
specifier|const
name|char
modifier|*
name|label
parameter_list|,
specifier|const
name|u8
modifier|*
name|seed
parameter_list|,
name|size_t
name|seed_len
parameter_list|,
name|u8
modifier|*
name|buf
parameter_list|,
name|size_t
name|buf_len
parameter_list|)
block|{
name|unsigned
name|char
name|counter
init|=
literal|0
decl_stmt|;
name|size_t
name|pos
decl_stmt|,
name|plen
decl_stmt|;
name|u8
name|hash
index|[
name|SHA1_MAC_LEN
index|]
decl_stmt|;
name|size_t
name|label_len
init|=
name|strlen
argument_list|(
name|label
argument_list|)
decl_stmt|;
name|u8
name|output_len
index|[
literal|2
index|]
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|addr
index|[
literal|5
index|]
decl_stmt|;
name|size_t
name|len
index|[
literal|5
index|]
decl_stmt|;
name|addr
index|[
literal|0
index|]
operator|=
name|hash
expr_stmt|;
name|len
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|addr
index|[
literal|1
index|]
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|label
expr_stmt|;
name|len
index|[
literal|1
index|]
operator|=
name|label_len
operator|+
literal|1
expr_stmt|;
name|addr
index|[
literal|2
index|]
operator|=
name|seed
expr_stmt|;
name|len
index|[
literal|2
index|]
operator|=
name|seed_len
expr_stmt|;
name|addr
index|[
literal|3
index|]
operator|=
name|output_len
expr_stmt|;
name|len
index|[
literal|3
index|]
operator|=
literal|2
expr_stmt|;
name|addr
index|[
literal|4
index|]
operator|=
operator|&
name|counter
expr_stmt|;
name|len
index|[
literal|4
index|]
operator|=
literal|1
expr_stmt|;
name|output_len
index|[
literal|0
index|]
operator|=
operator|(
name|buf_len
operator|>>
literal|8
operator|)
operator|&
literal|0xff
expr_stmt|;
name|output_len
index|[
literal|1
index|]
operator|=
name|buf_len
operator|&
literal|0xff
expr_stmt|;
name|pos
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|pos
operator|<
name|buf_len
condition|)
block|{
name|counter
operator|++
expr_stmt|;
name|plen
operator|=
name|buf_len
operator|-
name|pos
expr_stmt|;
name|hmac_sha1_vector
argument_list|(
name|key
argument_list|,
name|key_len
argument_list|,
literal|5
argument_list|,
name|addr
argument_list|,
name|len
argument_list|,
name|hash
argument_list|)
expr_stmt|;
if|if
condition|(
name|plen
operator|>=
name|SHA1_MAC_LEN
condition|)
block|{
name|memcpy
argument_list|(
operator|&
name|buf
index|[
name|pos
index|]
argument_list|,
name|hash
argument_list|,
name|SHA1_MAC_LEN
argument_list|)
expr_stmt|;
name|pos
operator|+=
name|SHA1_MAC_LEN
expr_stmt|;
block|}
else|else
block|{
name|memcpy
argument_list|(
operator|&
name|buf
index|[
name|pos
index|]
argument_list|,
name|hash
argument_list|,
name|plen
argument_list|)
expr_stmt|;
break|break;
block|}
name|len
index|[
literal|0
index|]
operator|=
name|SHA1_MAC_LEN
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* RFC 2246 */
end_comment

begin_function
name|int
name|tls_prf
parameter_list|(
specifier|const
name|u8
modifier|*
name|secret
parameter_list|,
name|size_t
name|secret_len
parameter_list|,
specifier|const
name|char
modifier|*
name|label
parameter_list|,
specifier|const
name|u8
modifier|*
name|seed
parameter_list|,
name|size_t
name|seed_len
parameter_list|,
name|u8
modifier|*
name|out
parameter_list|,
name|size_t
name|outlen
parameter_list|)
block|{
name|size_t
name|L_S1
decl_stmt|,
name|L_S2
decl_stmt|;
specifier|const
name|u8
modifier|*
name|S1
decl_stmt|,
modifier|*
name|S2
decl_stmt|;
name|u8
name|A_MD5
index|[
name|MD5_MAC_LEN
index|]
decl_stmt|,
name|A_SHA1
index|[
name|SHA1_MAC_LEN
index|]
decl_stmt|;
name|u8
name|P_MD5
index|[
name|MD5_MAC_LEN
index|]
decl_stmt|,
name|P_SHA1
index|[
name|SHA1_MAC_LEN
index|]
decl_stmt|;
name|int
name|i
decl_stmt|,
name|MD5_pos
decl_stmt|,
name|SHA1_pos
decl_stmt|;
specifier|const
name|u8
modifier|*
name|MD5_addr
index|[
literal|3
index|]
decl_stmt|;
name|size_t
name|MD5_len
index|[
literal|3
index|]
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|SHA1_addr
index|[
literal|3
index|]
decl_stmt|;
name|size_t
name|SHA1_len
index|[
literal|3
index|]
decl_stmt|;
if|if
condition|(
name|secret_len
operator|&
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|MD5_addr
index|[
literal|0
index|]
operator|=
name|A_MD5
expr_stmt|;
name|MD5_len
index|[
literal|0
index|]
operator|=
name|MD5_MAC_LEN
expr_stmt|;
name|MD5_addr
index|[
literal|1
index|]
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|label
expr_stmt|;
name|MD5_len
index|[
literal|1
index|]
operator|=
name|strlen
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|MD5_addr
index|[
literal|2
index|]
operator|=
name|seed
expr_stmt|;
name|MD5_len
index|[
literal|2
index|]
operator|=
name|seed_len
expr_stmt|;
name|SHA1_addr
index|[
literal|0
index|]
operator|=
name|A_SHA1
expr_stmt|;
name|SHA1_len
index|[
literal|0
index|]
operator|=
name|SHA1_MAC_LEN
expr_stmt|;
name|SHA1_addr
index|[
literal|1
index|]
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|label
expr_stmt|;
name|SHA1_len
index|[
literal|1
index|]
operator|=
name|strlen
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|SHA1_addr
index|[
literal|2
index|]
operator|=
name|seed
expr_stmt|;
name|SHA1_len
index|[
literal|2
index|]
operator|=
name|seed_len
expr_stmt|;
comment|/* RFC 2246, Chapter 5 	 * A(0) = seed, A(i) = HMAC(secret, A(i-1)) 	 * P_hash = HMAC(secret, A(1) + seed) + HMAC(secret, A(2) + seed) + .. 	 * PRF = P_MD5(S1, label + seed) XOR P_SHA-1(S2, label + seed) 	 */
name|L_S1
operator|=
name|L_S2
operator|=
operator|(
name|secret_len
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
name|S1
operator|=
name|secret
expr_stmt|;
name|S2
operator|=
name|secret
operator|+
name|L_S1
expr_stmt|;
name|hmac_md5_vector
argument_list|(
name|S1
argument_list|,
name|L_S1
argument_list|,
literal|2
argument_list|,
operator|&
name|MD5_addr
index|[
literal|1
index|]
argument_list|,
operator|&
name|MD5_len
index|[
literal|1
index|]
argument_list|,
name|A_MD5
argument_list|)
expr_stmt|;
name|hmac_sha1_vector
argument_list|(
name|S2
argument_list|,
name|L_S2
argument_list|,
literal|2
argument_list|,
operator|&
name|SHA1_addr
index|[
literal|1
index|]
argument_list|,
operator|&
name|SHA1_len
index|[
literal|1
index|]
argument_list|,
name|A_SHA1
argument_list|)
expr_stmt|;
name|MD5_pos
operator|=
name|MD5_MAC_LEN
expr_stmt|;
name|SHA1_pos
operator|=
name|SHA1_MAC_LEN
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|outlen
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|MD5_pos
operator|==
name|MD5_MAC_LEN
condition|)
block|{
name|hmac_md5_vector
argument_list|(
name|S1
argument_list|,
name|L_S1
argument_list|,
literal|3
argument_list|,
name|MD5_addr
argument_list|,
name|MD5_len
argument_list|,
name|P_MD5
argument_list|)
expr_stmt|;
name|MD5_pos
operator|=
literal|0
expr_stmt|;
name|hmac_md5
argument_list|(
name|S1
argument_list|,
name|L_S1
argument_list|,
name|A_MD5
argument_list|,
name|MD5_MAC_LEN
argument_list|,
name|A_MD5
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|SHA1_pos
operator|==
name|SHA1_MAC_LEN
condition|)
block|{
name|hmac_sha1_vector
argument_list|(
name|S2
argument_list|,
name|L_S2
argument_list|,
literal|3
argument_list|,
name|SHA1_addr
argument_list|,
name|SHA1_len
argument_list|,
name|P_SHA1
argument_list|)
expr_stmt|;
name|SHA1_pos
operator|=
literal|0
expr_stmt|;
name|hmac_sha1
argument_list|(
name|S2
argument_list|,
name|L_S2
argument_list|,
name|A_SHA1
argument_list|,
name|SHA1_MAC_LEN
argument_list|,
name|A_SHA1
argument_list|)
expr_stmt|;
block|}
name|out
index|[
name|i
index|]
operator|=
name|P_MD5
index|[
name|MD5_pos
index|]
operator|^
name|P_SHA1
index|[
name|SHA1_pos
index|]
expr_stmt|;
name|MD5_pos
operator|++
expr_stmt|;
name|SHA1_pos
operator|++
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|pbkdf2_sha1_f
parameter_list|(
specifier|const
name|char
modifier|*
name|passphrase
parameter_list|,
specifier|const
name|char
modifier|*
name|ssid
parameter_list|,
name|size_t
name|ssid_len
parameter_list|,
name|int
name|iterations
parameter_list|,
name|int
name|count
parameter_list|,
name|u8
modifier|*
name|digest
parameter_list|)
block|{
name|unsigned
name|char
name|tmp
index|[
name|SHA1_MAC_LEN
index|]
decl_stmt|,
name|tmp2
index|[
name|SHA1_MAC_LEN
index|]
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|unsigned
name|char
name|count_buf
index|[
literal|4
index|]
decl_stmt|;
specifier|const
name|u8
modifier|*
name|addr
index|[
literal|2
index|]
decl_stmt|;
name|size_t
name|len
index|[
literal|2
index|]
decl_stmt|;
name|size_t
name|passphrase_len
init|=
name|strlen
argument_list|(
name|passphrase
argument_list|)
decl_stmt|;
name|addr
index|[
literal|0
index|]
operator|=
operator|(
name|u8
operator|*
operator|)
name|ssid
expr_stmt|;
name|len
index|[
literal|0
index|]
operator|=
name|ssid_len
expr_stmt|;
name|addr
index|[
literal|1
index|]
operator|=
name|count_buf
expr_stmt|;
name|len
index|[
literal|1
index|]
operator|=
literal|4
expr_stmt|;
comment|/* F(P, S, c, i) = U1 xor U2 xor ... Uc 	 * U1 = PRF(P, S || i) 	 * U2 = PRF(P, U1) 	 * Uc = PRF(P, Uc-1) 	 */
name|count_buf
index|[
literal|0
index|]
operator|=
operator|(
name|count
operator|>>
literal|24
operator|)
operator|&
literal|0xff
expr_stmt|;
name|count_buf
index|[
literal|1
index|]
operator|=
operator|(
name|count
operator|>>
literal|16
operator|)
operator|&
literal|0xff
expr_stmt|;
name|count_buf
index|[
literal|2
index|]
operator|=
operator|(
name|count
operator|>>
literal|8
operator|)
operator|&
literal|0xff
expr_stmt|;
name|count_buf
index|[
literal|3
index|]
operator|=
name|count
operator|&
literal|0xff
expr_stmt|;
name|hmac_sha1_vector
argument_list|(
operator|(
name|u8
operator|*
operator|)
name|passphrase
argument_list|,
name|passphrase_len
argument_list|,
literal|2
argument_list|,
name|addr
argument_list|,
name|len
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|digest
argument_list|,
name|tmp
argument_list|,
name|SHA1_MAC_LEN
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|iterations
condition|;
name|i
operator|++
control|)
block|{
name|hmac_sha1
argument_list|(
operator|(
name|u8
operator|*
operator|)
name|passphrase
argument_list|,
name|passphrase_len
argument_list|,
name|tmp
argument_list|,
name|SHA1_MAC_LEN
argument_list|,
name|tmp2
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|tmp
argument_list|,
name|tmp2
argument_list|,
name|SHA1_MAC_LEN
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|SHA1_MAC_LEN
condition|;
name|j
operator|++
control|)
name|digest
index|[
name|j
index|]
operator|^=
name|tmp2
index|[
name|j
index|]
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|pbkdf2_sha1
parameter_list|(
specifier|const
name|char
modifier|*
name|passphrase
parameter_list|,
specifier|const
name|char
modifier|*
name|ssid
parameter_list|,
name|size_t
name|ssid_len
parameter_list|,
name|int
name|iterations
parameter_list|,
name|u8
modifier|*
name|buf
parameter_list|,
name|size_t
name|buflen
parameter_list|)
block|{
name|int
name|count
init|=
literal|0
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pos
init|=
name|buf
decl_stmt|;
name|size_t
name|left
init|=
name|buflen
decl_stmt|,
name|plen
decl_stmt|;
name|unsigned
name|char
name|digest
index|[
name|SHA1_MAC_LEN
index|]
decl_stmt|;
while|while
condition|(
name|left
operator|>
literal|0
condition|)
block|{
name|count
operator|++
expr_stmt|;
name|pbkdf2_sha1_f
argument_list|(
name|passphrase
argument_list|,
name|ssid
argument_list|,
name|ssid_len
argument_list|,
name|iterations
argument_list|,
name|count
argument_list|,
name|digest
argument_list|)
expr_stmt|;
name|plen
operator|=
name|left
operator|>
name|SHA1_MAC_LEN
condition|?
name|SHA1_MAC_LEN
else|:
name|left
expr_stmt|;
name|memcpy
argument_list|(
name|pos
argument_list|,
name|digest
argument_list|,
name|plen
argument_list|)
expr_stmt|;
name|pos
operator|+=
name|plen
expr_stmt|;
name|left
operator|-=
name|plen
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|sha1_transform
parameter_list|(
name|u8
modifier|*
name|state
parameter_list|,
name|u8
name|data
index|[
literal|64
index|]
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|EAP_TLS_FUNCS
name|SHA_CTX
name|context
decl_stmt|;
name|memset
argument_list|(
operator|&
name|context
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|context
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|context
operator|.
name|h0
argument_list|,
name|state
argument_list|,
literal|5
operator|*
literal|4
argument_list|)
expr_stmt|;
name|SHA1_Transform
argument_list|(
operator|&
name|context
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|state
argument_list|,
operator|&
name|context
operator|.
name|h0
argument_list|,
literal|5
operator|*
literal|4
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* EAP_TLS_FUNCS */
name|SHA1Transform
argument_list|(
operator|(
name|u32
operator|*
operator|)
name|state
argument_list|,
name|data
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_TLS_FUNCS */
block|}
end_function

begin_function
name|void
name|sha1_vector
parameter_list|(
name|size_t
name|num_elem
parameter_list|,
specifier|const
name|u8
modifier|*
name|addr
index|[]
parameter_list|,
specifier|const
name|size_t
modifier|*
name|len
parameter_list|,
name|u8
modifier|*
name|mac
parameter_list|)
block|{
name|SHA1_CTX
name|ctx
decl_stmt|;
name|int
name|i
decl_stmt|;
name|SHA1Init
argument_list|(
operator|&
name|ctx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_elem
condition|;
name|i
operator|++
control|)
name|SHA1Update
argument_list|(
operator|&
name|ctx
argument_list|,
name|addr
index|[
name|i
index|]
argument_list|,
name|len
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|SHA1Final
argument_list|(
name|mac
argument_list|,
operator|&
name|ctx
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|EAP_TLS_FUNCS
end_ifndef

begin_comment
comment|/* ===== start - public domain SHA1 implementation ===== */
end_comment

begin_comment
comment|/* SHA-1 in C By Steve Reid<sreid@sea-to-sky.net> 100% Public Domain  ----------------- Modified 7/98  By James H. Brown<jbrown@burgoyne.com> Still 100% Public Domain  Corrected a problem which generated improper hash values on 16 bit machines Routine SHA1Update changed from 	void SHA1Update(SHA1_CTX* context, unsigned char* data, unsigned int len) to 	void SHA1Update(SHA1_CTX* context, unsigned char* data, unsigned long len)  The 'len' parameter was declared an int which works fine on 32 bit machines. However, on 16 bit machines an int is too small for the shifts being done against it.  This caused the hash function to generate incorrect values if len was greater than 8191 (8K - 1) due to the 'len<< 3' on line 3 of SHA1Update().  Since the file IO in main() reads 16K at a time, any file 8K or larger would be guaranteed to generate the wrong hash (e.g. Test Vector #3, a million "a"s).  I also changed the declaration of variables i& j in SHA1Update to  unsigned long from unsigned int for the same reason.  These changes should make no difference to any 32 bit implementations since an int and a long are the same size in those environments.  -- I also corrected a few compiler warnings generated by Borland C. 1. Added #include<process.h> for exit() prototype 2. Removed unused variable 'j' in SHA1Final 3. Changed exit(0) to return(0) at end of main.  ALL changes I made can be located by searching for comments containing 'JHB' ----------------- Modified 8/98 By Steve Reid<sreid@sea-to-sky.net> Still 100% public domain  1- Removed #include<process.h> and used return() instead of exit() 2- Fixed overwriting of finalcount in SHA1Final() (discovered by Chris Hall) 3- Changed email address from steve@edmweb.com to sreid@sea-to-sky.net  ----------------- Modified 4/01 By Saul Kravitz<Saul.Kravitz@celera.com> Still 100% PD Modified to run on Compaq Alpha hardware.    ----------------- Modified 4/01 By Jouni Malinen<jkmaline@cc.hut.fi> Minor changes to match the coding style used in Dynamics.  Modified September 24, 2004 By Jouni Malinen<jkmaline@cc.hut.fi> Fixed alignment issue in SHA1Transform when SHA1HANDSOFF is defined.  */
end_comment

begin_comment
comment|/* Test Vectors (from FIPS PUB 180-1) "abc"   A9993E36 4706816A BA3E2571 7850C26C 9CD0D89D "abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq"   84983E44 1C3BD26E BAAE4AA1 F95129E5 E54670F1 A million repetitions of "a"   34AA973C D4C4DAA4 F61EEB2B DBAD2731 6534016F */
end_comment

begin_define
define|#
directive|define
name|SHA1HANDSOFF
end_define

begin_define
define|#
directive|define
name|rol
parameter_list|(
name|value
parameter_list|,
name|bits
parameter_list|)
value|(((value)<< (bits)) | ((value)>> (32 - (bits))))
end_define

begin_comment
comment|/* blk0() and blk() perform the initial expand. */
end_comment

begin_comment
comment|/* I got the idea of expanding during the round function from SSLeay */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|WORDS_BIGENDIAN
end_ifndef

begin_define
define|#
directive|define
name|blk0
parameter_list|(
name|i
parameter_list|)
value|(block->l[i] = (rol(block->l[i], 24)& 0xFF00FF00) | \ 	(rol(block->l[i], 8)& 0x00FF00FF))
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|blk0
parameter_list|(
name|i
parameter_list|)
value|block->l[i]
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|blk
parameter_list|(
name|i
parameter_list|)
value|(block->l[i& 15] = rol(block->l[(i + 13)& 15] ^ \ 	block->l[(i + 8)& 15] ^ block->l[(i + 2)& 15] ^ block->l[i& 15], 1))
end_define

begin_comment
comment|/* (R0+R1), R2, R3, R4 are the different operations used in SHA1 */
end_comment

begin_define
define|#
directive|define
name|R0
parameter_list|(
name|v
parameter_list|,
name|w
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|,
name|i
parameter_list|)
define|\
value|z += ((w& (x ^ y)) ^ y) + blk0(i) + 0x5A827999 + rol(v, 5); \ 	w = rol(w, 30);
end_define

begin_define
define|#
directive|define
name|R1
parameter_list|(
name|v
parameter_list|,
name|w
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|,
name|i
parameter_list|)
define|\
value|z += ((w& (x ^ y)) ^ y) + blk(i) + 0x5A827999 + rol(v, 5); \ 	w = rol(w, 30);
end_define

begin_define
define|#
directive|define
name|R2
parameter_list|(
name|v
parameter_list|,
name|w
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|,
name|i
parameter_list|)
define|\
value|z += (w ^ x ^ y) + blk(i) + 0x6ED9EBA1 + rol(v, 5); w = rol(w, 30);
end_define

begin_define
define|#
directive|define
name|R3
parameter_list|(
name|v
parameter_list|,
name|w
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|,
name|i
parameter_list|)
define|\
value|z += (((w | x)& y) | (w& x)) + blk(i) + 0x8F1BBCDC + rol(v, 5); \ 	w = rol(w, 30);
end_define

begin_define
define|#
directive|define
name|R4
parameter_list|(
name|v
parameter_list|,
name|w
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|,
name|i
parameter_list|)
define|\
value|z += (w ^ x ^ y) + blk(i) + 0xCA62C1D6 + rol(v, 5); \ 	w=rol(w, 30);
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|VERBOSE
end_ifdef

begin_comment
comment|/* SAK */
end_comment

begin_function
name|void
name|SHAPrintContext
parameter_list|(
name|SHA1_CTX
modifier|*
name|context
parameter_list|,
name|char
modifier|*
name|msg
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s (%d,%d) %x %x %x %x %x\n"
argument_list|,
name|msg
argument_list|,
name|context
operator|->
name|count
index|[
literal|0
index|]
argument_list|,
name|context
operator|->
name|count
index|[
literal|1
index|]
argument_list|,
name|context
operator|->
name|state
index|[
literal|0
index|]
argument_list|,
name|context
operator|->
name|state
index|[
literal|1
index|]
argument_list|,
name|context
operator|->
name|state
index|[
literal|2
index|]
argument_list|,
name|context
operator|->
name|state
index|[
literal|3
index|]
argument_list|,
name|context
operator|->
name|state
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* Hash a single 512-bit block. This is the core of the algorithm. */
end_comment

begin_function
name|void
name|SHA1Transform
parameter_list|(
name|u32
name|state
index|[
literal|5
index|]
parameter_list|,
specifier|const
name|unsigned
name|char
name|buffer
index|[
literal|64
index|]
parameter_list|)
block|{
name|u32
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|,
name|e
decl_stmt|;
typedef|typedef
union|union
block|{
name|unsigned
name|char
name|c
index|[
literal|64
index|]
decl_stmt|;
name|u32
name|l
index|[
literal|16
index|]
decl_stmt|;
block|}
name|CHAR64LONG16
typedef|;
name|CHAR64LONG16
modifier|*
name|block
decl_stmt|;
ifdef|#
directive|ifdef
name|SHA1HANDSOFF
name|u32
name|workspace
index|[
literal|16
index|]
decl_stmt|;
name|block
operator|=
operator|(
name|CHAR64LONG16
operator|*
operator|)
name|workspace
expr_stmt|;
name|memcpy
argument_list|(
name|block
argument_list|,
name|buffer
argument_list|,
literal|64
argument_list|)
expr_stmt|;
else|#
directive|else
name|block
operator|=
operator|(
name|CHAR64LONG16
operator|*
operator|)
name|buffer
expr_stmt|;
endif|#
directive|endif
comment|/* Copy context->state[] to working vars */
name|a
operator|=
name|state
index|[
literal|0
index|]
expr_stmt|;
name|b
operator|=
name|state
index|[
literal|1
index|]
expr_stmt|;
name|c
operator|=
name|state
index|[
literal|2
index|]
expr_stmt|;
name|d
operator|=
name|state
index|[
literal|3
index|]
expr_stmt|;
name|e
operator|=
name|state
index|[
literal|4
index|]
expr_stmt|;
comment|/* 4 rounds of 20 operations each. Loop unrolled. */
name|R0
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|13
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|14
argument_list|)
expr_stmt|;
name|R0
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|15
argument_list|)
expr_stmt|;
name|R1
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|R1
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|17
argument_list|)
expr_stmt|;
name|R1
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|18
argument_list|)
expr_stmt|;
name|R1
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|19
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|22
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|23
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|26
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|27
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|28
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|29
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|31
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|32
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|33
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|34
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|35
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|36
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|37
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|38
argument_list|)
expr_stmt|;
name|R2
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|39
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|41
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|42
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|43
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|44
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|45
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|46
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|47
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|48
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|49
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|51
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|52
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|53
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|54
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|55
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|56
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|57
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|58
argument_list|)
expr_stmt|;
name|R3
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|59
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|60
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|61
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|62
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|63
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|64
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|65
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|66
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|67
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|68
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|69
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|70
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|71
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|72
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|73
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|74
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
literal|75
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
literal|76
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
literal|77
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|78
argument_list|)
expr_stmt|;
name|R4
argument_list|(
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|a
argument_list|,
literal|79
argument_list|)
expr_stmt|;
comment|/* Add the working vars back into context.state[] */
name|state
index|[
literal|0
index|]
operator|+=
name|a
expr_stmt|;
name|state
index|[
literal|1
index|]
operator|+=
name|b
expr_stmt|;
name|state
index|[
literal|2
index|]
operator|+=
name|c
expr_stmt|;
name|state
index|[
literal|3
index|]
operator|+=
name|d
expr_stmt|;
name|state
index|[
literal|4
index|]
operator|+=
name|e
expr_stmt|;
comment|/* Wipe variables */
name|a
operator|=
name|b
operator|=
name|c
operator|=
name|d
operator|=
name|e
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|SHA1HANDSOFF
name|memset
argument_list|(
name|block
argument_list|,
literal|0
argument_list|,
literal|64
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* SHA1Init - Initialize new context */
end_comment

begin_function
name|void
name|SHA1Init
parameter_list|(
name|SHA1_CTX
modifier|*
name|context
parameter_list|)
block|{
comment|/* SHA1 initialization constants */
name|context
operator|->
name|state
index|[
literal|0
index|]
operator|=
literal|0x67452301
expr_stmt|;
name|context
operator|->
name|state
index|[
literal|1
index|]
operator|=
literal|0xEFCDAB89
expr_stmt|;
name|context
operator|->
name|state
index|[
literal|2
index|]
operator|=
literal|0x98BADCFE
expr_stmt|;
name|context
operator|->
name|state
index|[
literal|3
index|]
operator|=
literal|0x10325476
expr_stmt|;
name|context
operator|->
name|state
index|[
literal|4
index|]
operator|=
literal|0xC3D2E1F0
expr_stmt|;
name|context
operator|->
name|count
index|[
literal|0
index|]
operator|=
name|context
operator|->
name|count
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Run your data through this. */
end_comment

begin_function
name|void
name|SHA1Update
parameter_list|(
name|SHA1_CTX
modifier|*
name|context
parameter_list|,
specifier|const
name|void
modifier|*
name|_data
parameter_list|,
name|u32
name|len
parameter_list|)
block|{
name|u32
name|i
decl_stmt|,
name|j
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|data
init|=
name|_data
decl_stmt|;
ifdef|#
directive|ifdef
name|VERBOSE
name|SHAPrintContext
argument_list|(
name|context
argument_list|,
literal|"before"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|j
operator|=
operator|(
name|context
operator|->
name|count
index|[
literal|0
index|]
operator|>>
literal|3
operator|)
operator|&
literal|63
expr_stmt|;
if|if
condition|(
operator|(
name|context
operator|->
name|count
index|[
literal|0
index|]
operator|+=
name|len
operator|<<
literal|3
operator|)
operator|<
operator|(
name|len
operator|<<
literal|3
operator|)
condition|)
name|context
operator|->
name|count
index|[
literal|1
index|]
operator|++
expr_stmt|;
name|context
operator|->
name|count
index|[
literal|1
index|]
operator|+=
operator|(
name|len
operator|>>
literal|29
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|j
operator|+
name|len
operator|)
operator|>
literal|63
condition|)
block|{
name|memcpy
argument_list|(
operator|&
name|context
operator|->
name|buffer
index|[
name|j
index|]
argument_list|,
name|data
argument_list|,
operator|(
name|i
operator|=
literal|64
operator|-
name|j
operator|)
argument_list|)
expr_stmt|;
name|SHA1Transform
argument_list|(
name|context
operator|->
name|state
argument_list|,
name|context
operator|->
name|buffer
argument_list|)
expr_stmt|;
for|for
control|(
init|;
name|i
operator|+
literal|63
operator|<
name|len
condition|;
name|i
operator|+=
literal|64
control|)
block|{
name|SHA1Transform
argument_list|(
name|context
operator|->
name|state
argument_list|,
operator|&
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|j
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|i
operator|=
literal|0
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|context
operator|->
name|buffer
index|[
name|j
index|]
argument_list|,
operator|&
name|data
index|[
name|i
index|]
argument_list|,
name|len
operator|-
name|i
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|VERBOSE
name|SHAPrintContext
argument_list|(
name|context
argument_list|,
literal|"after "
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Add padding and return the message digest. */
end_comment

begin_function
name|void
name|SHA1Final
parameter_list|(
name|unsigned
name|char
name|digest
index|[
literal|20
index|]
parameter_list|,
name|SHA1_CTX
modifier|*
name|context
parameter_list|)
block|{
name|u32
name|i
decl_stmt|;
name|unsigned
name|char
name|finalcount
index|[
literal|8
index|]
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|finalcount
index|[
name|i
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
operator|(
name|context
operator|->
name|count
index|[
operator|(
name|i
operator|>=
literal|4
condition|?
literal|0
else|:
literal|1
operator|)
index|]
operator|>>
operator|(
operator|(
literal|3
operator|-
operator|(
name|i
operator|&
literal|3
operator|)
operator|)
operator|*
literal|8
operator|)
operator|)
operator|&
literal|255
argument_list|)
expr_stmt|;
comment|/* Endian independent */
block|}
name|SHA1Update
argument_list|(
name|context
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
literal|"\200"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|context
operator|->
name|count
index|[
literal|0
index|]
operator|&
literal|504
operator|)
operator|!=
literal|448
condition|)
block|{
name|SHA1Update
argument_list|(
name|context
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
literal|"\0"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
name|SHA1Update
argument_list|(
name|context
argument_list|,
name|finalcount
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* Should cause a SHA1Transform() 					      */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|20
condition|;
name|i
operator|++
control|)
block|{
name|digest
index|[
name|i
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
operator|(
name|context
operator|->
name|state
index|[
name|i
operator|>>
literal|2
index|]
operator|>>
operator|(
operator|(
literal|3
operator|-
operator|(
name|i
operator|&
literal|3
operator|)
operator|)
operator|*
literal|8
operator|)
operator|)
operator|&
literal|255
argument_list|)
expr_stmt|;
block|}
comment|/* Wipe variables */
name|i
operator|=
literal|0
expr_stmt|;
name|memset
argument_list|(
name|context
operator|->
name|buffer
argument_list|,
literal|0
argument_list|,
literal|64
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|context
operator|->
name|state
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|context
operator|->
name|count
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|finalcount
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ===== end - public domain SHA1 implementation ===== */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* EAP_TLS_FUNCS */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|TEST_MAIN
end_ifdef

begin_include
include|#
directive|include
file|"md5.c"
end_include

begin_function
specifier|static
name|int
name|test_eap_fast
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* draft-cam-winget-eap-fast-01.txt */
specifier|const
name|u8
name|pac_key
index|[]
init|=
block|{
literal|0x0B
block|,
literal|0x97
block|,
literal|0x39
block|,
literal|0x0F
block|,
literal|0x37
block|,
literal|0x51
block|,
literal|0x78
block|,
literal|0x09
block|,
literal|0x81
block|,
literal|0x1E
block|,
literal|0xFD
block|,
literal|0x9C
block|,
literal|0x6E
block|,
literal|0x65
block|,
literal|0x94
block|,
literal|0x2B
block|,
literal|0x63
block|,
literal|0x2C
block|,
literal|0xE9
block|,
literal|0x53
block|,
literal|0x89
block|,
literal|0x38
block|,
literal|0x08
block|,
literal|0xBA
block|,
literal|0x36
block|,
literal|0x0B
block|,
literal|0x03
block|,
literal|0x7C
block|,
literal|0xD1
block|,
literal|0x85
block|,
literal|0xE4
block|,
literal|0x14
block|}
decl_stmt|;
specifier|const
name|u8
name|seed
index|[]
init|=
block|{
literal|0x3F
block|,
literal|0xFB
block|,
literal|0x11
block|,
literal|0xC4
block|,
literal|0x6C
block|,
literal|0xBF
block|,
literal|0xA5
block|,
literal|0x7A
block|,
literal|0x54
block|,
literal|0x40
block|,
literal|0xDA
block|,
literal|0xE8
block|,
literal|0x22
block|,
literal|0xD3
block|,
literal|0x11
block|,
literal|0xD3
block|,
literal|0xF7
block|,
literal|0x6D
block|,
literal|0xE4
block|,
literal|0x1D
block|,
literal|0xD9
block|,
literal|0x33
block|,
literal|0xE5
block|,
literal|0x93
block|,
literal|0x70
block|,
literal|0x97
block|,
literal|0xEB
block|,
literal|0xA9
block|,
literal|0xB3
block|,
literal|0x66
block|,
literal|0xF4
block|,
literal|0x2A
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x02
block|,
literal|0x6A
block|,
literal|0x66
block|,
literal|0x43
block|,
literal|0x2A
block|,
literal|0x8D
block|,
literal|0x14
block|,
literal|0x43
block|,
literal|0x2C
block|,
literal|0xEC
block|,
literal|0x58
block|,
literal|0x2D
block|,
literal|0x2F
block|,
literal|0xC7
block|,
literal|0x9C
block|,
literal|0x33
block|,
literal|0x64
block|,
literal|0xBA
block|,
literal|0x04
block|,
literal|0xAD
block|,
literal|0x3A
block|,
literal|0x52
block|,
literal|0x54
block|,
literal|0xD6
block|,
literal|0xA5
block|,
literal|0x79
block|,
literal|0xAD
block|,
literal|0x1E
block|,
literal|0x00
block|}
decl_stmt|;
specifier|const
name|u8
name|master_secret
index|[]
init|=
block|{
literal|0x4A
block|,
literal|0x1A
block|,
literal|0x51
block|,
literal|0x2C
block|,
literal|0x01
block|,
literal|0x60
block|,
literal|0xBC
block|,
literal|0x02
block|,
literal|0x3C
block|,
literal|0xCF
block|,
literal|0xBC
block|,
literal|0x83
block|,
literal|0x3F
block|,
literal|0x03
block|,
literal|0xBC
block|,
literal|0x64
block|,
literal|0x88
block|,
literal|0xC1
block|,
literal|0x31
block|,
literal|0x2F
block|,
literal|0x0B
block|,
literal|0xA9
block|,
literal|0xA2
block|,
literal|0x77
block|,
literal|0x16
block|,
literal|0xA8
block|,
literal|0xD8
block|,
literal|0xE8
block|,
literal|0xBD
block|,
literal|0xC9
block|,
literal|0xD2
block|,
literal|0x29
block|,
literal|0x38
block|,
literal|0x4B
block|,
literal|0x7A
block|,
literal|0x85
block|,
literal|0xBE
block|,
literal|0x16
block|,
literal|0x4D
block|,
literal|0x27
block|,
literal|0x33
block|,
literal|0xD5
block|,
literal|0x24
block|,
literal|0x79
block|,
literal|0x87
block|,
literal|0xB1
block|,
literal|0xC5
block|,
literal|0xA2
block|}
decl_stmt|;
specifier|const
name|u8
name|key_block
index|[]
init|=
block|{
literal|0x59
block|,
literal|0x59
block|,
literal|0xBE
block|,
literal|0x8E
block|,
literal|0x41
block|,
literal|0x3A
block|,
literal|0x77
block|,
literal|0x74
block|,
literal|0x8B
block|,
literal|0xB2
block|,
literal|0xE5
block|,
literal|0xD3
block|,
literal|0x60
block|,
literal|0xAC
block|,
literal|0x4D
block|,
literal|0x35
block|,
literal|0xDF
block|,
literal|0xFB
block|,
literal|0xC8
block|,
literal|0x1E
block|,
literal|0x9C
block|,
literal|0x24
block|,
literal|0x9C
block|,
literal|0x8B
block|,
literal|0x0E
block|,
literal|0xC3
block|,
literal|0x1D
block|,
literal|0x72
block|,
literal|0xC8
block|,
literal|0x84
block|,
literal|0x9D
block|,
literal|0x57
block|,
literal|0x48
block|,
literal|0x51
block|,
literal|0x2E
block|,
literal|0x45
block|,
literal|0x97
block|,
literal|0x6C
block|,
literal|0x88
block|,
literal|0x70
block|,
literal|0xBE
block|,
literal|0x5F
block|,
literal|0x01
block|,
literal|0xD3
block|,
literal|0x64
block|,
literal|0xE7
block|,
literal|0x4C
block|,
literal|0xBB
block|,
literal|0x11
block|,
literal|0x24
block|,
literal|0xE3
block|,
literal|0x49
block|,
literal|0xE2
block|,
literal|0x3B
block|,
literal|0xCD
block|,
literal|0xEF
block|,
literal|0x7A
block|,
literal|0xB3
block|,
literal|0x05
block|,
literal|0x39
block|,
literal|0x5D
block|,
literal|0x64
block|,
literal|0x8A
block|,
literal|0x44
block|,
literal|0x11
block|,
literal|0xB6
block|,
literal|0x69
block|,
literal|0x88
block|,
literal|0x34
block|,
literal|0x2E
block|,
literal|0x8E
block|,
literal|0x29
block|,
literal|0xD6
block|,
literal|0x4B
block|,
literal|0x7D
block|,
literal|0x72
block|,
literal|0x17
block|,
literal|0x59
block|,
literal|0x28
block|,
literal|0x05
block|,
literal|0xAF
block|,
literal|0xF9
block|,
literal|0xB7
block|,
literal|0xFF
block|,
literal|0x66
block|,
literal|0x6D
block|,
literal|0xA1
block|,
literal|0x96
block|,
literal|0x8F
block|,
literal|0x0B
block|,
literal|0x5E
block|,
literal|0x06
block|,
literal|0x46
block|,
literal|0x7A
block|,
literal|0x44
block|,
literal|0x84
block|,
literal|0x64
block|,
literal|0xC1
block|,
literal|0xC8
block|,
literal|0x0C
block|,
literal|0x96
block|,
literal|0x44
block|,
literal|0x09
block|,
literal|0x98
block|,
literal|0xFF
block|,
literal|0x92
block|,
literal|0xA8
block|,
literal|0xB4
block|,
literal|0xC6
block|,
literal|0x42
block|,
literal|0x28
block|,
literal|0x71
block|}
decl_stmt|;
specifier|const
name|u8
name|sks
index|[]
init|=
block|{
literal|0xD6
block|,
literal|0x4B
block|,
literal|0x7D
block|,
literal|0x72
block|,
literal|0x17
block|,
literal|0x59
block|,
literal|0x28
block|,
literal|0x05
block|,
literal|0xAF
block|,
literal|0xF9
block|,
literal|0xB7
block|,
literal|0xFF
block|,
literal|0x66
block|,
literal|0x6D
block|,
literal|0xA1
block|,
literal|0x96
block|,
literal|0x8F
block|,
literal|0x0B
block|,
literal|0x5E
block|,
literal|0x06
block|,
literal|0x46
block|,
literal|0x7A
block|,
literal|0x44
block|,
literal|0x84
block|,
literal|0x64
block|,
literal|0xC1
block|,
literal|0xC8
block|,
literal|0x0C
block|,
literal|0x96
block|,
literal|0x44
block|,
literal|0x09
block|,
literal|0x98
block|,
literal|0xFF
block|,
literal|0x92
block|,
literal|0xA8
block|,
literal|0xB4
block|,
literal|0xC6
block|,
literal|0x42
block|,
literal|0x28
block|,
literal|0x71
block|}
decl_stmt|;
specifier|const
name|u8
name|isk
index|[]
init|=
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|}
decl_stmt|;
specifier|const
name|u8
name|imck
index|[]
init|=
block|{
literal|0x16
block|,
literal|0x15
block|,
literal|0x3C
block|,
literal|0x3F
block|,
literal|0x21
block|,
literal|0x55
block|,
literal|0xEF
block|,
literal|0xD9
block|,
literal|0x7F
block|,
literal|0x34
block|,
literal|0xAE
block|,
literal|0xC8
block|,
literal|0x1A
block|,
literal|0x4E
block|,
literal|0x66
block|,
literal|0x80
block|,
literal|0x4C
block|,
literal|0xC3
block|,
literal|0x76
block|,
literal|0xF2
block|,
literal|0x8A
block|,
literal|0xA9
block|,
literal|0x6F
block|,
literal|0x96
block|,
literal|0xC2
block|,
literal|0x54
block|,
literal|0x5F
block|,
literal|0x8C
block|,
literal|0xAB
block|,
literal|0x65
block|,
literal|0x02
block|,
literal|0xE1
block|,
literal|0x18
block|,
literal|0x40
block|,
literal|0x7B
block|,
literal|0x56
block|,
literal|0xBE
block|,
literal|0xEA
block|,
literal|0xA7
block|,
literal|0xC5
block|,
literal|0x76
block|,
literal|0x5D
block|,
literal|0x8F
block|,
literal|0x0B
block|,
literal|0xC5
block|,
literal|0x07
block|,
literal|0xC6
block|,
literal|0xB9
block|,
literal|0x04
block|,
literal|0xD0
block|,
literal|0x69
block|,
literal|0x56
block|,
literal|0x72
block|,
literal|0x8B
block|,
literal|0x6B
block|,
literal|0xB8
block|,
literal|0x15
block|,
literal|0xEC
block|,
literal|0x57
block|,
literal|0x7B
block|}
decl_stmt|;
specifier|const
name|u8
name|msk
index|[]
init|=
block|{
literal|0x4D
block|,
literal|0x83
block|,
literal|0xA9
block|,
literal|0xBE
block|,
literal|0x6F
block|,
literal|0x8A
block|,
literal|0x74
block|,
literal|0xED
block|,
literal|0x6A
block|,
literal|0x02
block|,
literal|0x66
block|,
literal|0x0A
block|,
literal|0x63
block|,
literal|0x4D
block|,
literal|0x2C
block|,
literal|0x33
block|,
literal|0xC2
block|,
literal|0xDA
block|,
literal|0x60
block|,
literal|0x15
block|,
literal|0xC6
block|,
literal|0x37
block|,
literal|0x04
block|,
literal|0x51
block|,
literal|0x90
block|,
literal|0x38
block|,
literal|0x63
block|,
literal|0xDA
block|,
literal|0x54
block|,
literal|0x3E
block|,
literal|0x14
block|,
literal|0xB9
block|,
literal|0x27
block|,
literal|0x99
block|,
literal|0x18
block|,
literal|0x1E
block|,
literal|0x07
block|,
literal|0xBF
block|,
literal|0x0F
block|,
literal|0x5A
block|,
literal|0x5E
block|,
literal|0x3C
block|,
literal|0x32
block|,
literal|0x93
block|,
literal|0x80
block|,
literal|0x8C
block|,
literal|0x6C
block|,
literal|0x49
block|,
literal|0x67
block|,
literal|0xED
block|,
literal|0x24
block|,
literal|0xFE
block|,
literal|0x45
block|,
literal|0x40
block|,
literal|0xA0
block|,
literal|0x59
block|,
literal|0x5E
block|,
literal|0x37
block|,
literal|0xC2
block|,
literal|0xE9
block|,
literal|0xD0
block|,
literal|0x5D
block|,
literal|0x0A
block|,
literal|0xE3
block|}
decl_stmt|;
name|u8
name|tlv
index|[]
init|=
block|{
literal|0x80
block|,
literal|0x0C
block|,
literal|0x00
block|,
literal|0x38
block|,
literal|0x00
block|,
literal|0x01
block|,
literal|0x01
block|,
literal|0x00
block|,
literal|0xD8
block|,
literal|0x6A
block|,
literal|0x8C
block|,
literal|0x68
block|,
literal|0x3C
block|,
literal|0x32
block|,
literal|0x31
block|,
literal|0xA8
block|,
literal|0x56
block|,
literal|0x63
block|,
literal|0xB6
block|,
literal|0x40
block|,
literal|0x21
block|,
literal|0xFE
block|,
literal|0x21
block|,
literal|0x14
block|,
literal|0x4E
block|,
literal|0xE7
block|,
literal|0x54
block|,
literal|0x20
block|,
literal|0x79
block|,
literal|0x2D
block|,
literal|0x42
block|,
literal|0x62
block|,
literal|0xC9
block|,
literal|0xBF
block|,
literal|0x53
block|,
literal|0x7F
block|,
literal|0x54
block|,
literal|0xFD
block|,
literal|0xAC
block|,
literal|0x58
block|,
literal|0x43
block|,
literal|0x24
block|,
literal|0x6E
block|,
literal|0x30
block|,
literal|0x92
block|,
literal|0x17
block|,
literal|0x6D
block|,
literal|0xCF
block|,
literal|0xE6
block|,
literal|0xE0
block|,
literal|0x69
block|,
literal|0xEB
block|,
literal|0x33
block|,
literal|0x61
block|,
literal|0x6A
block|,
literal|0xCC
block|,
literal|0x05
block|,
literal|0xC5
block|,
literal|0x5B
block|,
literal|0xB7
block|}
decl_stmt|;
specifier|const
name|u8
name|compound_mac
index|[]
init|=
block|{
literal|0x43
block|,
literal|0x24
block|,
literal|0x6E
block|,
literal|0x30
block|,
literal|0x92
block|,
literal|0x17
block|,
literal|0x6D
block|,
literal|0xCF
block|,
literal|0xE6
block|,
literal|0xE0
block|,
literal|0x69
block|,
literal|0xEB
block|,
literal|0x33
block|,
literal|0x61
block|,
literal|0x6A
block|,
literal|0xCC
block|,
literal|0x05
block|,
literal|0xC5
block|,
literal|0x5B
block|,
literal|0xB7
block|}
decl_stmt|;
name|u8
name|buf
index|[
literal|512
index|]
decl_stmt|;
specifier|const
name|u8
modifier|*
name|simck
decl_stmt|,
modifier|*
name|cmk
decl_stmt|;
name|int
name|errors
init|=
literal|0
decl_stmt|;
name|printf
argument_list|(
literal|"EAP-FAST test cases\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"- T-PRF (SHA1) test case / master_secret\n"
argument_list|)
expr_stmt|;
name|sha1_t_prf
argument_list|(
name|pac_key
argument_list|,
sizeof|sizeof
argument_list|(
name|pac_key
argument_list|)
argument_list|,
literal|"PAC to master secret label hash"
argument_list|,
name|seed
argument_list|,
sizeof|sizeof
argument_list|(
name|seed
argument_list|)
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|master_secret
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|master_secret
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|master_secret
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"T-PRF test - FAILED!\n"
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"- PRF (TLS, SHA1/MD5) test case / key_block\n"
argument_list|)
expr_stmt|;
name|tls_prf
argument_list|(
name|master_secret
argument_list|,
sizeof|sizeof
argument_list|(
name|master_secret
argument_list|)
argument_list|,
literal|"key expansion"
argument_list|,
name|seed
argument_list|,
sizeof|sizeof
argument_list|(
name|seed
argument_list|)
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|key_block
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|key_block
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|key_block
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"PRF test - FAILED!\n"
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"- T-PRF (SHA1) test case / IMCK\n"
argument_list|)
expr_stmt|;
name|sha1_t_prf
argument_list|(
name|sks
argument_list|,
sizeof|sizeof
argument_list|(
name|sks
argument_list|)
argument_list|,
literal|"Inner Methods Compound Keys"
argument_list|,
name|isk
argument_list|,
sizeof|sizeof
argument_list|(
name|isk
argument_list|)
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|imck
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|imck
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|imck
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"T-PRF test - FAILED!\n"
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|simck
operator|=
name|imck
expr_stmt|;
name|cmk
operator|=
name|imck
operator|+
literal|40
expr_stmt|;
name|printf
argument_list|(
literal|"- T-PRF (SHA1) test case / MSK\n"
argument_list|)
expr_stmt|;
name|sha1_t_prf
argument_list|(
name|simck
argument_list|,
literal|40
argument_list|,
literal|"Session Key Generating Function"
argument_list|,
literal|""
argument_list|,
literal|0
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|msk
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|msk
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|msk
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"T-PRF test - FAILED!\n"
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"- Compound MAC test case\n"
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|tlv
operator|+
sizeof|sizeof
argument_list|(
name|tlv
argument_list|)
operator|-
literal|20
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|hmac_sha1
argument_list|(
name|cmk
argument_list|,
literal|20
argument_list|,
name|tlv
argument_list|,
sizeof|sizeof
argument_list|(
name|tlv
argument_list|)
argument_list|,
name|tlv
operator|+
sizeof|sizeof
argument_list|(
name|tlv
argument_list|)
operator|-
literal|20
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|tlv
operator|+
sizeof|sizeof
argument_list|(
name|tlv
argument_list|)
operator|-
literal|20
argument_list|,
name|compound_mac
argument_list|,
sizeof|sizeof
argument_list|(
name|compound_mac
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Compound MAC test - FAILED!\n"
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
return|return
name|errors
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|u8
name|key0
index|[]
init|=
block|{
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|,
literal|0x0b
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u8
name|data0
index|[]
init|=
literal|"Hi There"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u8
name|prf0
index|[]
init|=
block|{
literal|0xbc
block|,
literal|0xd4
block|,
literal|0xc6
block|,
literal|0x50
block|,
literal|0xb3
block|,
literal|0x0b
block|,
literal|0x96
block|,
literal|0x84
block|,
literal|0x95
block|,
literal|0x18
block|,
literal|0x29
block|,
literal|0xe0
block|,
literal|0xd7
block|,
literal|0x5f
block|,
literal|0x9d
block|,
literal|0x54
block|,
literal|0xb8
block|,
literal|0x62
block|,
literal|0x17
block|,
literal|0x5e
block|,
literal|0xd9
block|,
literal|0xf0
block|,
literal|0x06
block|,
literal|0x06
block|,
literal|0xe1
block|,
literal|0x7d
block|,
literal|0x8d
block|,
literal|0xa3
block|,
literal|0x54
block|,
literal|0x02
block|,
literal|0xff
block|,
literal|0xee
block|,
literal|0x75
block|,
literal|0xdf
block|,
literal|0x78
block|,
literal|0xc3
block|,
literal|0xd3
block|,
literal|0x1e
block|,
literal|0x0f
block|,
literal|0x88
block|,
literal|0x9f
block|,
literal|0x01
block|,
literal|0x21
block|,
literal|0x20
block|,
literal|0xc0
block|,
literal|0x86
block|,
literal|0x2b
block|,
literal|0xeb
block|,
literal|0x67
block|,
literal|0x75
block|,
literal|0x3e
block|,
literal|0x74
block|,
literal|0x39
block|,
literal|0xae
block|,
literal|0x24
block|,
literal|0x2e
block|,
literal|0xdb
block|,
literal|0x83
block|,
literal|0x73
block|,
literal|0x69
block|,
literal|0x83
block|,
literal|0x56
block|,
literal|0xcf
block|,
literal|0x5a
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u8
name|key1
index|[]
init|=
literal|"Jefe"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u8
name|data1
index|[]
init|=
literal|"what do ya want for nothing?"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u8
name|prf1
index|[]
init|=
block|{
literal|0x51
block|,
literal|0xf4
block|,
literal|0xde
block|,
literal|0x5b
block|,
literal|0x33
block|,
literal|0xf2
block|,
literal|0x49
block|,
literal|0xad
block|,
literal|0xf8
block|,
literal|0x1a
block|,
literal|0xeb
block|,
literal|0x71
block|,
literal|0x3a
block|,
literal|0x3c
block|,
literal|0x20
block|,
literal|0xf4
block|,
literal|0xfe
block|,
literal|0x63
block|,
literal|0x14
block|,
literal|0x46
block|,
literal|0xfa
block|,
literal|0xbd
block|,
literal|0xfa
block|,
literal|0x58
block|,
literal|0x24
block|,
literal|0x47
block|,
literal|0x59
block|,
literal|0xae
block|,
literal|0x58
block|,
literal|0xef
block|,
literal|0x90
block|,
literal|0x09
block|,
literal|0xa9
block|,
literal|0x9a
block|,
literal|0xbf
block|,
literal|0x4e
block|,
literal|0xac
block|,
literal|0x2c
block|,
literal|0xa5
block|,
literal|0xfa
block|,
literal|0x87
block|,
literal|0xe6
block|,
literal|0x92
block|,
literal|0xc4
block|,
literal|0x40
block|,
literal|0xeb
block|,
literal|0x40
block|,
literal|0x02
block|,
literal|0x3e
block|,
literal|0x7b
block|,
literal|0xab
block|,
literal|0xb2
block|,
literal|0x06
block|,
literal|0xd6
block|,
literal|0x1d
block|,
literal|0xe7
block|,
literal|0xb9
block|,
literal|0x2f
block|,
literal|0x41
block|,
literal|0x52
block|,
literal|0x90
block|,
literal|0x92
block|,
literal|0xb8
block|,
literal|0xfc
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u8
name|key2
index|[]
init|=
block|{
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|,
literal|0xaa
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u8
name|data2
index|[]
init|=
block|{
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|,
literal|0xdd
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u8
name|prf2
index|[]
init|=
block|{
literal|0xe1
block|,
literal|0xac
block|,
literal|0x54
block|,
literal|0x6e
block|,
literal|0xc4
block|,
literal|0xcb
block|,
literal|0x63
block|,
literal|0x6f
block|,
literal|0x99
block|,
literal|0x76
block|,
literal|0x48
block|,
literal|0x7b
block|,
literal|0xe5
block|,
literal|0xc8
block|,
literal|0x6b
block|,
literal|0xe1
block|,
literal|0x7a
block|,
literal|0x02
block|,
literal|0x52
block|,
literal|0xca
block|,
literal|0x5d
block|,
literal|0x8d
block|,
literal|0x8d
block|,
literal|0xf1
block|,
literal|0x2c
block|,
literal|0xfb
block|,
literal|0x04
block|,
literal|0x73
block|,
literal|0x52
block|,
literal|0x52
block|,
literal|0x49
block|,
literal|0xce
block|,
literal|0x9d
block|,
literal|0xd8
block|,
literal|0xd1
block|,
literal|0x77
block|,
literal|0xea
block|,
literal|0xd7
block|,
literal|0x10
block|,
literal|0xbc
block|,
literal|0x9b
block|,
literal|0x59
block|,
literal|0x05
block|,
literal|0x47
block|,
literal|0x23
block|,
literal|0x91
block|,
literal|0x07
block|,
literal|0xae
block|,
literal|0xf7
block|,
literal|0xb4
block|,
literal|0xab
block|,
literal|0xd4
block|,
literal|0x3d
block|,
literal|0x87
block|,
literal|0xf0
block|,
literal|0xa6
block|,
literal|0x8f
block|,
literal|0x1c
block|,
literal|0xbd
block|,
literal|0x9e
block|,
literal|0x2b
block|,
literal|0x6f
block|,
literal|0x76
block|,
literal|0x07
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|passphrase_test
block|{
name|char
modifier|*
name|passphrase
decl_stmt|;
name|char
modifier|*
name|ssid
decl_stmt|;
name|char
name|psk
index|[
literal|32
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|struct
name|passphrase_test
name|passphrase_tests
index|[]
init|=
block|{
block|{
literal|"password"
block|,
literal|"IEEE"
block|,
block|{
literal|0xf4
block|,
literal|0x2c
block|,
literal|0x6f
block|,
literal|0xc5
block|,
literal|0x2d
block|,
literal|0xf0
block|,
literal|0xeb
block|,
literal|0xef
block|,
literal|0x9e
block|,
literal|0xbb
block|,
literal|0x4b
block|,
literal|0x90
block|,
literal|0xb3
block|,
literal|0x8a
block|,
literal|0x5f
block|,
literal|0x90
block|,
literal|0x2e
block|,
literal|0x83
block|,
literal|0xfe
block|,
literal|0x1b
block|,
literal|0x13
block|,
literal|0x5a
block|,
literal|0x70
block|,
literal|0xe2
block|,
literal|0x3a
block|,
literal|0xed
block|,
literal|0x76
block|,
literal|0x2e
block|,
literal|0x97
block|,
literal|0x10
block|,
literal|0xa1
block|,
literal|0x2e
block|}
block|}
block|,
block|{
literal|"ThisIsAPassword"
block|,
literal|"ThisIsASSID"
block|,
block|{
literal|0x0d
block|,
literal|0xc0
block|,
literal|0xd6
block|,
literal|0xeb
block|,
literal|0x90
block|,
literal|0x55
block|,
literal|0x5e
block|,
literal|0xd6
block|,
literal|0x41
block|,
literal|0x97
block|,
literal|0x56
block|,
literal|0xb9
block|,
literal|0xa1
block|,
literal|0x5e
block|,
literal|0xc3
block|,
literal|0xe3
block|,
literal|0x20
block|,
literal|0x9b
block|,
literal|0x63
block|,
literal|0xdf
block|,
literal|0x70
block|,
literal|0x7d
block|,
literal|0xd5
block|,
literal|0x08
block|,
literal|0xd1
block|,
literal|0x45
block|,
literal|0x81
block|,
literal|0xf8
block|,
literal|0x98
block|,
literal|0x27
block|,
literal|0x21
block|,
literal|0xaf
block|}
block|}
block|,
block|{
literal|"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
block|,
literal|"ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ"
block|,
block|{
literal|0xbe
block|,
literal|0xcb
block|,
literal|0x93
block|,
literal|0x86
block|,
literal|0x6b
block|,
literal|0xb8
block|,
literal|0xc3
block|,
literal|0x83
block|,
literal|0x2c
block|,
literal|0xb7
block|,
literal|0x77
block|,
literal|0xc2
block|,
literal|0xf5
block|,
literal|0x59
block|,
literal|0x80
block|,
literal|0x7c
block|,
literal|0x8c
block|,
literal|0x59
block|,
literal|0xaf
block|,
literal|0xcb
block|,
literal|0x6e
block|,
literal|0xae
block|,
literal|0x73
block|,
literal|0x48
block|,
literal|0x85
block|,
literal|0x00
block|,
literal|0x13
block|,
literal|0x00
block|,
literal|0xa9
block|,
literal|0x81
block|,
literal|0xcc
block|,
literal|0x62
block|}
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|NUM_PASSPHRASE_TESTS
define|\
value|(sizeof(passphrase_tests) / sizeof(passphrase_tests[0]))
end_define

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|u8
name|res
index|[
literal|512
index|]
decl_stmt|;
name|int
name|ret
init|=
literal|0
decl_stmt|,
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"PRF-SHA1 test cases:\n"
argument_list|)
expr_stmt|;
name|sha1_prf
argument_list|(
name|key0
argument_list|,
sizeof|sizeof
argument_list|(
name|key0
argument_list|)
argument_list|,
literal|"prefix"
argument_list|,
name|data0
argument_list|,
sizeof|sizeof
argument_list|(
name|data0
argument_list|)
operator|-
literal|1
argument_list|,
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|prf0
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|res
argument_list|,
name|prf0
argument_list|,
sizeof|sizeof
argument_list|(
name|prf0
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"Test case 0 - OK\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"Test case 0 - FAILED!\n"
argument_list|)
expr_stmt|;
name|ret
operator|++
expr_stmt|;
block|}
name|sha1_prf
argument_list|(
name|key1
argument_list|,
sizeof|sizeof
argument_list|(
name|key1
argument_list|)
operator|-
literal|1
argument_list|,
literal|"prefix"
argument_list|,
name|data1
argument_list|,
sizeof|sizeof
argument_list|(
name|data1
argument_list|)
operator|-
literal|1
argument_list|,
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|prf1
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|res
argument_list|,
name|prf1
argument_list|,
sizeof|sizeof
argument_list|(
name|prf1
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"Test case 1 - OK\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"Test case 1 - FAILED!\n"
argument_list|)
expr_stmt|;
name|ret
operator|++
expr_stmt|;
block|}
name|sha1_prf
argument_list|(
name|key2
argument_list|,
sizeof|sizeof
argument_list|(
name|key2
argument_list|)
argument_list|,
literal|"prefix"
argument_list|,
name|data2
argument_list|,
sizeof|sizeof
argument_list|(
name|data2
argument_list|)
argument_list|,
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|prf2
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|res
argument_list|,
name|prf2
argument_list|,
sizeof|sizeof
argument_list|(
name|prf2
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"Test case 2 - OK\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"Test case 2 - FAILED!\n"
argument_list|)
expr_stmt|;
name|ret
operator|++
expr_stmt|;
block|}
name|ret
operator|+=
name|test_eap_fast
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"PBKDF2-SHA1 Passphrase test cases:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NUM_PASSPHRASE_TESTS
condition|;
name|i
operator|++
control|)
block|{
name|u8
name|psk
index|[
literal|32
index|]
decl_stmt|;
name|struct
name|passphrase_test
modifier|*
name|test
init|=
operator|&
name|passphrase_tests
index|[
name|i
index|]
decl_stmt|;
name|pbkdf2_sha1
argument_list|(
name|test
operator|->
name|passphrase
argument_list|,
name|test
operator|->
name|ssid
argument_list|,
name|strlen
argument_list|(
name|test
operator|->
name|ssid
argument_list|)
argument_list|,
literal|4096
argument_list|,
name|psk
argument_list|,
literal|32
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|psk
argument_list|,
name|test
operator|->
name|psk
argument_list|,
literal|32
argument_list|)
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"Test case %d - OK\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"Test case %d - FAILED!\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|ret
operator|++
expr_stmt|;
block|}
block|}
return|return
name|ret
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* TEST_MAIN */
end_comment

end_unit

