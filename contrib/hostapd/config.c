begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Host AP (software wireless LAN access point) user space daemon for  * Host AP kernel driver / Configuration file  * Copyright (c) 2003-2005, Jouni Malinen<jkmaline@cc.hut.fi>  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License version 2 as  * published by the Free Software Foundation.  *  * Alternatively, this software may be distributed under the terms of BSD  * license.  *  * See README and COPYING for more details.  */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_include
include|#
directive|include
file|<grp.h>
end_include

begin_include
include|#
directive|include
file|"hostapd.h"
end_include

begin_include
include|#
directive|include
file|"driver.h"
end_include

begin_include
include|#
directive|include
file|"sha1.h"
end_include

begin_include
include|#
directive|include
file|"eap.h"
end_include

begin_include
include|#
directive|include
file|"radius_client.h"
end_include

begin_function
specifier|static
name|struct
name|hostapd_config
modifier|*
name|hostapd_config_defaults
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|hostapd_config
modifier|*
name|conf
decl_stmt|;
name|conf
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|conf
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_radius_servers
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Failed to allocate memory for configuration data.\n"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|memset
argument_list|(
name|conf
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|conf
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_radius_servers
argument_list|)
argument_list|)
expr_stmt|;
name|conf
operator|->
name|radius
operator|=
operator|(
expr|struct
name|hostapd_radius_servers
operator|*
operator|)
operator|(
name|conf
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* set default driver based on configuration */
name|conf
operator|->
name|driver
operator|=
name|driver_lookup
argument_list|(
literal|"default"
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|driver
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"No default driver registered!\n"
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|conf
operator|->
name|wep_rekeying_period
operator|=
literal|300
expr_stmt|;
name|conf
operator|->
name|eap_reauth_period
operator|=
literal|3600
expr_stmt|;
name|conf
operator|->
name|logger_syslog_level
operator|=
name|HOSTAPD_LEVEL_INFO
expr_stmt|;
name|conf
operator|->
name|logger_stdout_level
operator|=
name|HOSTAPD_LEVEL_INFO
expr_stmt|;
name|conf
operator|->
name|logger_syslog
operator|=
operator|(
name|unsigned
name|int
operator|)
operator|-
literal|1
expr_stmt|;
name|conf
operator|->
name|logger_stdout
operator|=
operator|(
name|unsigned
name|int
operator|)
operator|-
literal|1
expr_stmt|;
name|conf
operator|->
name|auth_algs
operator|=
name|HOSTAPD_AUTH_OPEN
operator||
name|HOSTAPD_AUTH_SHARED_KEY
expr_stmt|;
name|conf
operator|->
name|wpa_group_rekey
operator|=
literal|600
expr_stmt|;
name|conf
operator|->
name|wpa_gmk_rekey
operator|=
literal|86400
expr_stmt|;
name|conf
operator|->
name|wpa_key_mgmt
operator|=
name|WPA_KEY_MGMT_PSK
expr_stmt|;
name|conf
operator|->
name|wpa_pairwise
operator|=
name|WPA_CIPHER_TKIP
expr_stmt|;
name|conf
operator|->
name|wpa_group
operator|=
name|WPA_CIPHER_TKIP
expr_stmt|;
name|conf
operator|->
name|radius_server_auth_port
operator|=
literal|1812
expr_stmt|;
return|return
name|conf
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_parse_ip_addr
parameter_list|(
specifier|const
name|char
modifier|*
name|txt
parameter_list|,
name|struct
name|hostapd_ip_addr
modifier|*
name|addr
parameter_list|)
block|{
if|if
condition|(
name|inet_aton
argument_list|(
name|txt
argument_list|,
operator|&
name|addr
operator|->
name|u
operator|.
name|v4
argument_list|)
condition|)
block|{
name|addr
operator|->
name|af
operator|=
name|AF_INET
expr_stmt|;
return|return
literal|0
return|;
block|}
ifdef|#
directive|ifdef
name|CONFIG_IPV6
if|if
condition|(
name|inet_pton
argument_list|(
name|AF_INET6
argument_list|,
name|txt
argument_list|,
operator|&
name|addr
operator|->
name|u
operator|.
name|v6
argument_list|)
operator|>
literal|0
condition|)
block|{
name|addr
operator|->
name|af
operator|=
name|AF_INET6
expr_stmt|;
return|return
literal|0
return|;
block|}
endif|#
directive|endif
comment|/* CONFIG_IPV6 */
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|mac_comp
parameter_list|(
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|b
parameter_list|)
block|{
return|return
name|memcmp
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
sizeof|sizeof
argument_list|(
name|macaddr
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_read_maclist
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|,
name|macaddr
modifier|*
modifier|*
name|acl
parameter_list|,
name|int
modifier|*
name|num
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|128
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|;
name|u8
name|addr
index|[
name|ETH_ALEN
index|]
decl_stmt|;
name|macaddr
modifier|*
name|newacl
decl_stmt|;
if|if
condition|(
operator|!
name|fname
condition|)
return|return
literal|0
return|;
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|f
condition|)
block|{
name|printf
argument_list|(
literal|"MAC list file '%s' not found.\n"
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
if|if
condition|(
name|hwaddr_aton
argument_list|(
name|buf
argument_list|,
name|addr
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"Invalid MAC address '%s' at line %d in '%s'\n"
argument_list|,
name|buf
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|newacl
operator|=
operator|(
name|macaddr
operator|*
operator|)
name|realloc
argument_list|(
operator|*
name|acl
argument_list|,
operator|(
operator|*
name|num
operator|+
literal|1
operator|)
operator|*
name|ETH_ALEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|newacl
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"MAC list reallocation failed\n"
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
operator|*
name|acl
operator|=
name|newacl
expr_stmt|;
name|memcpy
argument_list|(
operator|(
operator|*
name|acl
operator|)
index|[
operator|*
name|num
index|]
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
expr_stmt|;
operator|(
operator|*
name|num
operator|)
operator|++
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|qsort
argument_list|(
operator|*
name|acl
argument_list|,
operator|*
name|num
argument_list|,
sizeof|sizeof
argument_list|(
name|macaddr
argument_list|)
argument_list|,
name|mac_comp
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_read_wpa_psk
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|,
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|128
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|,
name|ret
init|=
literal|0
decl_stmt|,
name|len
decl_stmt|,
name|ok
decl_stmt|;
name|u8
name|addr
index|[
name|ETH_ALEN
index|]
decl_stmt|;
name|struct
name|hostapd_wpa_psk
modifier|*
name|psk
decl_stmt|;
if|if
condition|(
operator|!
name|fname
condition|)
return|return
literal|0
return|;
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|f
condition|)
block|{
name|printf
argument_list|(
literal|"WPA PSK file '%s' not found.\n"
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
if|if
condition|(
name|hwaddr_aton
argument_list|(
name|buf
argument_list|,
name|addr
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"Invalid MAC address '%s' on line %d in '%s'\n"
argument_list|,
name|buf
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|psk
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|psk
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|psk
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"WPA PSK allocation failed\n"
argument_list|)
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|memset
argument_list|(
name|psk
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|psk
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|addr
argument_list|,
literal|"\x00\x00\x00\x00\x00\x00"
argument_list|,
name|ETH_ALEN
argument_list|)
operator|==
literal|0
condition|)
name|psk
operator|->
name|group
operator|=
literal|1
expr_stmt|;
else|else
name|memcpy
argument_list|(
name|psk
operator|->
name|addr
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
expr_stmt|;
name|pos
operator|=
name|buf
operator|+
literal|17
expr_stmt|;
if|if
condition|(
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|printf
argument_list|(
literal|"No PSK on line %d in '%s'\n"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|psk
argument_list|)
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
name|ok
operator|=
literal|0
expr_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|64
operator|&&
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|psk
operator|->
name|psk
argument_list|,
name|PMK_LEN
argument_list|)
operator|==
literal|0
condition|)
name|ok
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|len
operator|>=
literal|8
operator|&&
name|len
operator|<
literal|64
condition|)
block|{
name|pbkdf2_sha1
argument_list|(
name|pos
argument_list|,
name|conf
operator|->
name|ssid
argument_list|,
name|conf
operator|->
name|ssid_len
argument_list|,
literal|4096
argument_list|,
name|psk
operator|->
name|psk
argument_list|,
name|PMK_LEN
argument_list|)
expr_stmt|;
name|ok
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|ok
condition|)
block|{
name|printf
argument_list|(
literal|"Invalid PSK '%s' on line %d in '%s'\n"
argument_list|,
name|pos
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|psk
argument_list|)
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|psk
operator|->
name|next
operator|=
name|conf
operator|->
name|wpa_psk
expr_stmt|;
name|conf
operator|->
name|wpa_psk
operator|=
name|psk
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
name|int
name|hostapd_setup_wpa_psk
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|)
block|{
if|if
condition|(
name|conf
operator|->
name|wpa_passphrase
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|conf
operator|->
name|wpa_psk
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Warning: both WPA PSK and passphrase set. "
literal|"Using passphrase.\n"
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|wpa_psk
argument_list|)
expr_stmt|;
block|}
name|conf
operator|->
name|wpa_psk
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_wpa_psk
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|wpa_psk
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Unable to alloc space for PSK\n"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wpa_hexdump_ascii
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"SSID"
argument_list|,
operator|(
name|u8
operator|*
operator|)
name|conf
operator|->
name|ssid
argument_list|,
name|conf
operator|->
name|ssid_len
argument_list|)
expr_stmt|;
name|wpa_hexdump_ascii
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"PSK (ASCII passphrase)"
argument_list|,
operator|(
name|u8
operator|*
operator|)
name|conf
operator|->
name|wpa_passphrase
argument_list|,
name|strlen
argument_list|(
name|conf
operator|->
name|wpa_passphrase
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|conf
operator|->
name|wpa_psk
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_wpa_psk
argument_list|)
argument_list|)
expr_stmt|;
name|pbkdf2_sha1
argument_list|(
name|conf
operator|->
name|wpa_passphrase
argument_list|,
name|conf
operator|->
name|ssid
argument_list|,
name|conf
operator|->
name|ssid_len
argument_list|,
literal|4096
argument_list|,
name|conf
operator|->
name|wpa_psk
operator|->
name|psk
argument_list|,
name|PMK_LEN
argument_list|)
expr_stmt|;
name|wpa_hexdump
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"PSK (from passphrase)"
argument_list|,
name|conf
operator|->
name|wpa_psk
operator|->
name|psk
argument_list|,
name|PMK_LEN
argument_list|)
expr_stmt|;
name|conf
operator|->
name|wpa_psk
operator|->
name|group
operator|=
literal|1
expr_stmt|;
name|memset
argument_list|(
name|conf
operator|->
name|wpa_passphrase
argument_list|,
literal|0
argument_list|,
name|strlen
argument_list|(
name|conf
operator|->
name|wpa_passphrase
argument_list|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|wpa_passphrase
argument_list|)
expr_stmt|;
name|conf
operator|->
name|wpa_passphrase
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|conf
operator|->
name|wpa_psk_file
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_wpa_psk
argument_list|(
name|conf
operator|->
name|wpa_psk_file
argument_list|,
name|conf
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|free
argument_list|(
name|conf
operator|->
name|wpa_psk_file
argument_list|)
expr_stmt|;
name|conf
operator|->
name|wpa_psk_file
operator|=
name|NULL
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|EAP_SERVER
end_ifdef

begin_function
specifier|static
name|int
name|hostapd_config_read_eap_user
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|,
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|512
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|,
modifier|*
name|start
decl_stmt|,
modifier|*
name|pos2
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|,
name|ret
init|=
literal|0
decl_stmt|,
name|num_methods
decl_stmt|;
name|struct
name|hostapd_eap_user
modifier|*
name|user
decl_stmt|,
modifier|*
name|tail
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|fname
condition|)
return|return
literal|0
return|;
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|f
condition|)
block|{
name|printf
argument_list|(
literal|"EAP user file '%s' not found.\n"
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
comment|/* Lines: "user" METHOD,METHOD2 "password" (password optional) */
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
name|user
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|!=
literal|'"'
operator|&&
name|buf
index|[
literal|0
index|]
operator|!=
literal|'*'
condition|)
block|{
name|printf
argument_list|(
literal|"Invalid EAP identity (no \" in start) on "
literal|"line %d in '%s'\n"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|user
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"EAP user allocation failed\n"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|memset
argument_list|(
name|user
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|user
argument_list|)
argument_list|)
expr_stmt|;
name|user
operator|->
name|force_version
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'*'
condition|)
block|{
name|pos
operator|=
name|buf
expr_stmt|;
block|}
else|else
block|{
name|pos
operator|=
name|buf
operator|+
literal|1
expr_stmt|;
name|start
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'"'
operator|&&
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|printf
argument_list|(
literal|"Invalid EAP identity (no \" in end) on"
literal|" line %d in '%s'\n"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|identity
operator|=
name|malloc
argument_list|(
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|identity
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Failed to allocate memory for EAP "
literal|"identity\n"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|memcpy
argument_list|(
name|user
operator|->
name|identity
argument_list|,
name|start
argument_list|,
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
name|user
operator|->
name|identity_len
operator|=
name|pos
operator|-
name|start
expr_stmt|;
block|}
name|pos
operator|++
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|printf
argument_list|(
literal|"No EAP method on line %d in '%s'\n"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|start
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|' '
operator|&&
operator|*
name|pos
operator|!=
literal|'\t'
operator|&&
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|pos
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
name|num_methods
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|start
condition|)
block|{
name|char
modifier|*
name|pos2
init|=
name|strchr
argument_list|(
name|start
argument_list|,
literal|','
argument_list|)
decl_stmt|;
if|if
condition|(
name|pos2
condition|)
block|{
operator|*
name|pos2
operator|++
operator|=
literal|'\0'
expr_stmt|;
block|}
name|user
operator|->
name|methods
index|[
name|num_methods
index|]
operator|=
name|eap_get_type
argument_list|(
name|start
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|methods
index|[
name|num_methods
index|]
operator|==
name|EAP_TYPE_NONE
condition|)
block|{
name|printf
argument_list|(
literal|"Unsupported EAP type '%s' on line %d "
literal|"in '%s'\n"
argument_list|,
name|start
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|num_methods
operator|++
expr_stmt|;
if|if
condition|(
name|num_methods
operator|>=
name|EAP_USER_MAX_METHODS
condition|)
break|break;
if|if
condition|(
name|pos2
operator|==
name|NULL
condition|)
break|break;
name|start
operator|=
name|pos2
expr_stmt|;
block|}
if|if
condition|(
name|num_methods
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"No EAP types configured on line %d in '%s'\n"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
goto|goto
name|done
goto|;
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
goto|goto
name|done
goto|;
if|if
condition|(
name|strncmp
argument_list|(
name|pos
argument_list|,
literal|"[ver=0]"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|force_version
operator|=
literal|0
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
name|strncmp
argument_list|(
name|pos
argument_list|,
literal|"[ver=1]"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|force_version
operator|=
literal|1
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
name|strncmp
argument_list|(
name|pos
argument_list|,
literal|"[2]"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|phase2
operator|=
literal|1
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
operator|*
name|pos
operator|==
literal|'"'
condition|)
block|{
name|pos
operator|++
expr_stmt|;
name|start
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'"'
operator|&&
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
block|{
name|printf
argument_list|(
literal|"Invalid EAP password (no \" in end) "
literal|"on line %d in '%s'\n"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password
operator|=
name|malloc
argument_list|(
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|password
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Failed to allocate memory for EAP "
literal|"password\n"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|memcpy
argument_list|(
name|user
operator|->
name|password
argument_list|,
name|start
argument_list|,
name|pos
operator|-
name|start
argument_list|)
expr_stmt|;
name|user
operator|->
name|password_len
operator|=
name|pos
operator|-
name|start
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
else|else
block|{
name|pos2
operator|=
name|pos
expr_stmt|;
while|while
condition|(
operator|*
name|pos2
operator|!=
literal|'\0'
operator|&&
operator|*
name|pos2
operator|!=
literal|' '
operator|&&
operator|*
name|pos2
operator|!=
literal|'\t'
operator|&&
operator|*
name|pos2
operator|!=
literal|'#'
condition|)
name|pos2
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|&
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"Invalid hex password on line %d in "
literal|"'%s'\n"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password
operator|=
name|malloc
argument_list|(
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|/
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|user
operator|->
name|password
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Failed to allocate memory for EAP "
literal|"password\n"
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|user
operator|->
name|password
argument_list|,
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|/
literal|2
argument_list|)
operator|<
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Invalid hex password on line %d in "
literal|"'%s'\n"
argument_list|,
name|line
argument_list|,
name|fname
argument_list|)
expr_stmt|;
goto|goto
name|failed
goto|;
block|}
name|user
operator|->
name|password_len
operator|=
operator|(
name|pos2
operator|-
name|pos
operator|)
operator|/
literal|2
expr_stmt|;
name|pos
operator|=
name|pos2
expr_stmt|;
block|}
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
condition|)
name|pos
operator|++
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pos
argument_list|,
literal|"[2]"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|user
operator|->
name|phase2
operator|=
literal|1
expr_stmt|;
block|}
name|done
label|:
if|if
condition|(
name|tail
operator|==
name|NULL
condition|)
block|{
name|tail
operator|=
name|conf
operator|->
name|eap_user
operator|=
name|user
expr_stmt|;
block|}
else|else
block|{
name|tail
operator|->
name|next
operator|=
name|user
expr_stmt|;
name|tail
operator|=
name|user
expr_stmt|;
block|}
continue|continue;
name|failed
label|:
if|if
condition|(
name|user
condition|)
block|{
name|free
argument_list|(
name|user
operator|->
name|identity
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|user
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* EAP_SERVER */
end_comment

begin_function
specifier|static
name|int
name|hostapd_config_read_radius_addr
parameter_list|(
name|struct
name|hostapd_radius_server
modifier|*
modifier|*
name|server
parameter_list|,
name|int
modifier|*
name|num_server
parameter_list|,
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|def_port
parameter_list|,
name|struct
name|hostapd_radius_server
modifier|*
modifier|*
name|curr_serv
parameter_list|)
block|{
name|struct
name|hostapd_radius_server
modifier|*
name|nserv
decl_stmt|;
name|int
name|ret
decl_stmt|;
specifier|static
name|int
name|server_index
init|=
literal|1
decl_stmt|;
name|nserv
operator|=
name|realloc
argument_list|(
operator|*
name|server
argument_list|,
operator|(
operator|*
name|num_server
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|nserv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|nserv
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
operator|*
name|server
operator|=
name|nserv
expr_stmt|;
name|nserv
operator|=
operator|&
name|nserv
index|[
operator|*
name|num_server
index|]
expr_stmt|;
operator|(
operator|*
name|num_server
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|curr_serv
operator|)
operator|=
name|nserv
expr_stmt|;
name|memset
argument_list|(
name|nserv
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|nserv
argument_list|)
argument_list|)
expr_stmt|;
name|nserv
operator|->
name|port
operator|=
name|def_port
expr_stmt|;
name|ret
operator|=
name|hostapd_parse_ip_addr
argument_list|(
name|val
argument_list|,
operator|&
name|nserv
operator|->
name|addr
argument_list|)
expr_stmt|;
name|nserv
operator|->
name|index
operator|=
name|server_index
operator|++
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_parse_key_mgmt
parameter_list|(
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|,
name|last
decl_stmt|;
name|char
modifier|*
name|start
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|strdup
argument_list|(
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|start
operator|=
name|buf
expr_stmt|;
while|while
condition|(
name|start
operator|!=
literal|'\0'
condition|)
block|{
while|while
condition|(
operator|*
name|start
operator|==
literal|' '
operator|||
operator|*
name|start
operator|==
literal|'\t'
condition|)
name|start
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|start
operator|==
literal|'\0'
condition|)
break|break;
name|end
operator|=
name|start
expr_stmt|;
while|while
condition|(
operator|*
name|end
operator|!=
literal|' '
operator|&&
operator|*
name|end
operator|!=
literal|'\t'
operator|&&
operator|*
name|end
operator|!=
literal|'\0'
condition|)
name|end
operator|++
expr_stmt|;
name|last
operator|=
operator|*
name|end
operator|==
literal|'\0'
expr_stmt|;
operator|*
name|end
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|start
argument_list|,
literal|"WPA-PSK"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_PSK
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|start
argument_list|,
literal|"WPA-EAP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_KEY_MGMT_IEEE8021X
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"Line %d: invalid key_mgmt '%s'"
argument_list|,
name|line
argument_list|,
name|start
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|last
condition|)
break|break;
name|start
operator|=
name|end
operator|+
literal|1
expr_stmt|;
block|}
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: no key_mgmt values configured."
argument_list|,
name|line
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|val
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_parse_cipher
parameter_list|(
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|,
name|last
decl_stmt|;
name|char
modifier|*
name|start
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|strdup
argument_list|(
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|start
operator|=
name|buf
expr_stmt|;
while|while
condition|(
name|start
operator|!=
literal|'\0'
condition|)
block|{
while|while
condition|(
operator|*
name|start
operator|==
literal|' '
operator|||
operator|*
name|start
operator|==
literal|'\t'
condition|)
name|start
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|start
operator|==
literal|'\0'
condition|)
break|break;
name|end
operator|=
name|start
expr_stmt|;
while|while
condition|(
operator|*
name|end
operator|!=
literal|' '
operator|&&
operator|*
name|end
operator|!=
literal|'\t'
operator|&&
operator|*
name|end
operator|!=
literal|'\0'
condition|)
name|end
operator|++
expr_stmt|;
name|last
operator|=
operator|*
name|end
operator|==
literal|'\0'
expr_stmt|;
operator|*
name|end
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|start
argument_list|,
literal|"CCMP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_CCMP
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|start
argument_list|,
literal|"TKIP"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_TKIP
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|start
argument_list|,
literal|"WEP104"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_WEP104
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|start
argument_list|,
literal|"WEP40"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_WEP40
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|start
argument_list|,
literal|"NONE"
argument_list|)
operator|==
literal|0
condition|)
name|val
operator||=
name|WPA_CIPHER_NONE
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"Line %d: invalid cipher '%s'."
argument_list|,
name|line
argument_list|,
name|start
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|last
condition|)
break|break;
name|start
operator|=
name|end
operator|+
literal|1
expr_stmt|;
block|}
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: no cipher values configured."
argument_list|,
name|line
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|val
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|hostapd_config_check
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|)
block|{
if|if
condition|(
name|conf
operator|->
name|ieee802_1x
operator|&&
operator|!
name|conf
operator|->
name|eap_server
operator|&&
operator|!
name|conf
operator|->
name|radius
operator|->
name|auth_servers
condition|)
block|{
name|printf
argument_list|(
literal|"Invalid IEEE 802.1X configuration (no EAP "
literal|"authenticator configured).\n"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|conf
operator|->
name|wpa
operator|&&
operator|(
name|conf
operator|->
name|wpa_key_mgmt
operator|&
name|WPA_KEY_MGMT_PSK
operator|)
operator|&&
name|conf
operator|->
name|wpa_psk
operator|==
name|NULL
operator|&&
name|conf
operator|->
name|wpa_passphrase
operator|==
name|NULL
operator|&&
name|conf
operator|->
name|wpa_psk_file
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"WPA-PSK enabled, but PSK or passphrase is not "
literal|"configured.\n"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|struct
name|hostapd_config
modifier|*
name|hostapd_config_read
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|)
block|{
name|struct
name|hostapd_config
modifier|*
name|conf
decl_stmt|;
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|int
name|line
init|=
literal|0
decl_stmt|;
name|int
name|errors
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|accept_mac_file
init|=
name|NULL
decl_stmt|,
modifier|*
name|deny_mac_file
init|=
name|NULL
decl_stmt|;
ifdef|#
directive|ifdef
name|EAP_SERVER
name|char
modifier|*
name|eap_user_file
init|=
name|NULL
decl_stmt|;
endif|#
directive|endif
comment|/* EAP_SERVER */
name|f
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|f
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Could not open configuration file '%s' for reading.\n"
argument_list|,
name|fname
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|conf
operator|=
name|hostapd_config_defaults
argument_list|()
expr_stmt|;
if|if
condition|(
name|conf
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
continue|continue;
name|pos
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|*
name|pos
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
name|pos
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
continue|continue;
name|pos
operator|=
name|strchr
argument_list|(
name|buf
argument_list|,
literal|'='
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid line '%s'\n"
argument_list|,
name|line
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
operator|*
name|pos
operator|=
literal|'\0'
expr_stmt|;
name|pos
operator|++
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"interface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|snprintf
argument_list|(
name|conf
operator|->
name|iface
argument_list|,
sizeof|sizeof
argument_list|(
name|conf
operator|->
name|iface
argument_list|)
argument_list|,
literal|"%s"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"bridge"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|snprintf
argument_list|(
name|conf
operator|->
name|bridge
argument_list|,
sizeof|sizeof
argument_list|(
name|conf
operator|->
name|bridge
argument_list|)
argument_list|,
literal|"%s"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"driver"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|driver
operator|=
name|driver_lookup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|driver
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid/unknown driver "
literal|"'%s'\n"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"debug"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|debug
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_syslog_level"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|logger_syslog_level
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_stdout_level"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|logger_stdout_level
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_syslog"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|logger_syslog
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"logger_stdout"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|logger_stdout
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"dump_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|dump_log_name
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"ssid"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ssid_len
operator|=
name|strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|ssid_len
operator|>=
name|HOSTAPD_SSID_LEN
operator|||
name|conf
operator|->
name|ssid_len
operator|<
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid SSID '%s'\n"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|memcpy
argument_list|(
name|conf
operator|->
name|ssid
argument_list|,
name|pos
argument_list|,
name|conf
operator|->
name|ssid_len
argument_list|)
expr_stmt|;
name|conf
operator|->
name|ssid
index|[
name|conf
operator|->
name|ssid_len
index|]
operator|=
literal|'\0'
expr_stmt|;
name|conf
operator|->
name|ssid_set
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"macaddr_acl"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|macaddr_acl
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|macaddr_acl
operator|!=
name|ACCEPT_UNLESS_DENIED
operator|&&
name|conf
operator|->
name|macaddr_acl
operator|!=
name|DENY_UNLESS_ACCEPTED
operator|&&
name|conf
operator|->
name|macaddr_acl
operator|!=
name|USE_EXTERNAL_RADIUS_AUTH
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: unknown macaddr_acl %d\n"
argument_list|,
name|line
argument_list|,
name|conf
operator|->
name|macaddr_acl
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"accept_mac_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|accept_mac_file
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|accept_mac_file
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: allocation failed\n"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"deny_mac_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|deny_mac_file
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|deny_mac_file
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: allocation failed\n"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"assoc_ap_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hwaddr_aton
argument_list|(
name|pos
argument_list|,
name|conf
operator|->
name|assoc_ap_addr
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid MAC address '%s'\n"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|conf
operator|->
name|assoc_ap
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"ieee8021x"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ieee802_1x
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|EAP_SERVER
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_authenticator"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|eap_server
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Line %d: obsolete eap_authenticator used; "
literal|"this has been renamed to eap_server\n"
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_server"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|eap_server
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_user_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|eap_user_file
argument_list|)
expr_stmt|;
name|eap_user_file
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|eap_user_file
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: allocation failed\n"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"ca_cert"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|conf
operator|->
name|ca_cert
argument_list|)
expr_stmt|;
name|conf
operator|->
name|ca_cert
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"server_cert"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|conf
operator|->
name|server_cert
argument_list|)
expr_stmt|;
name|conf
operator|->
name|server_cert
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"private_key"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|conf
operator|->
name|private_key
argument_list|)
expr_stmt|;
name|conf
operator|->
name|private_key
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"private_key_passwd"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|conf
operator|->
name|private_key_passwd
argument_list|)
expr_stmt|;
name|conf
operator|->
name|private_key_passwd
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"check_crl"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|check_crl
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|EAP_SIM
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_sim_db"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|conf
operator|->
name|eap_sim_db
argument_list|)
expr_stmt|;
name|conf
operator|->
name|eap_sim_db
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_SIM */
endif|#
directive|endif
comment|/* EAP_SERVER */
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_message"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|char
modifier|*
name|term
decl_stmt|;
name|conf
operator|->
name|eap_req_id_text
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|eap_req_id_text
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: Failed to allocate memory "
literal|"for eap_req_id_text\n"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
name|conf
operator|->
name|eap_req_id_text_len
operator|=
name|strlen
argument_list|(
name|conf
operator|->
name|eap_req_id_text
argument_list|)
expr_stmt|;
name|term
operator|=
name|strstr
argument_list|(
name|conf
operator|->
name|eap_req_id_text
argument_list|,
literal|"\\0"
argument_list|)
expr_stmt|;
if|if
condition|(
name|term
condition|)
block|{
operator|*
name|term
operator|++
operator|=
literal|'\0'
expr_stmt|;
name|memmove
argument_list|(
name|term
argument_list|,
name|term
operator|+
literal|1
argument_list|,
name|conf
operator|->
name|eap_req_id_text_len
operator|-
operator|(
name|term
operator|-
name|conf
operator|->
name|eap_req_id_text
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|conf
operator|->
name|eap_req_id_text_len
operator|--
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key_len_broadcast"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|default_wep_key_len
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|default_wep_key_len
operator|>
literal|13
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid WEP key len %lu "
literal|"(= %lu bits)\n"
argument_list|,
name|line
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|conf
operator|->
name|default_wep_key_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|conf
operator|->
name|default_wep_key_len
operator|*
literal|8
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_key_len_unicast"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|individual_wep_key_len
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|individual_wep_key_len
operator|<
literal|0
operator|||
name|conf
operator|->
name|individual_wep_key_len
operator|>
literal|13
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid WEP key len %d "
literal|"(= %d bits)\n"
argument_list|,
name|line
argument_list|,
name|conf
operator|->
name|individual_wep_key_len
argument_list|,
name|conf
operator|->
name|individual_wep_key_len
operator|*
literal|8
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wep_rekey_period"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|wep_rekeying_period
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|wep_rekeying_period
operator|<
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid period %d\n"
argument_list|,
name|line
argument_list|,
name|conf
operator|->
name|wep_rekeying_period
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"eap_reauth_period"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|eap_reauth_period
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|eap_reauth_period
operator|<
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid period %d\n"
argument_list|,
name|line
argument_list|,
name|conf
operator|->
name|eap_reauth_period
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"eapol_key_index_workaround"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|eapol_key_index_workaround
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_IAPP
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"iapp_interface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|ieee802_11f
operator|=
literal|1
expr_stmt|;
name|snprintf
argument_list|(
name|conf
operator|->
name|iapp_iface
argument_list|,
sizeof|sizeof
argument_list|(
name|conf
operator|->
name|iapp_iface
argument_list|)
argument_list|,
literal|"%s"
argument_list|,
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IAPP */
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"own_ip_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_parse_ip_addr
argument_list|(
name|pos
argument_list|,
operator|&
name|conf
operator|->
name|own_ip_addr
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid IP address '%s'\n"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"nas_identifier"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|nas_identifier
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_server_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_radius_addr
argument_list|(
operator|&
name|conf
operator|->
name|radius
operator|->
name|auth_servers
argument_list|,
operator|&
name|conf
operator|->
name|radius
operator|->
name|num_auth_servers
argument_list|,
name|pos
argument_list|,
literal|1812
argument_list|,
operator|&
name|conf
operator|->
name|radius
operator|->
name|auth_server
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid IP address '%s'\n"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|conf
operator|->
name|radius
operator|->
name|auth_server
operator|&&
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_server_port"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|radius
operator|->
name|auth_server
operator|->
name|port
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|conf
operator|->
name|radius
operator|->
name|auth_server
operator|&&
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_server_shared_secret"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|len
init|=
name|strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
block|{
comment|/* RFC 2865, Ch. 3 */
name|printf
argument_list|(
literal|"Line %d: empty shared secret is not "
literal|"allowed.\n"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|conf
operator|->
name|radius
operator|->
name|auth_server
operator|->
name|shared_secret
operator|=
operator|(
name|u8
operator|*
operator|)
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|conf
operator|->
name|radius
operator|->
name|auth_server
operator|->
name|shared_secret_len
operator|=
name|len
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"acct_server_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hostapd_config_read_radius_addr
argument_list|(
operator|&
name|conf
operator|->
name|radius
operator|->
name|acct_servers
argument_list|,
operator|&
name|conf
operator|->
name|radius
operator|->
name|num_acct_servers
argument_list|,
name|pos
argument_list|,
literal|1813
argument_list|,
operator|&
name|conf
operator|->
name|radius
operator|->
name|acct_server
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid IP address '%s'\n"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|conf
operator|->
name|radius
operator|->
name|acct_server
operator|&&
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"acct_server_port"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|radius
operator|->
name|acct_server
operator|->
name|port
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|conf
operator|->
name|radius
operator|->
name|acct_server
operator|&&
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"acct_server_shared_secret"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|len
init|=
name|strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
block|{
comment|/* RFC 2865, Ch. 3 */
name|printf
argument_list|(
literal|"Line %d: empty shared secret is not "
literal|"allowed.\n"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|conf
operator|->
name|radius
operator|->
name|acct_server
operator|->
name|shared_secret
operator|=
operator|(
name|u8
operator|*
operator|)
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|conf
operator|->
name|radius
operator|->
name|acct_server
operator|->
name|shared_secret_len
operator|=
name|len
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_retry_primary_interval"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|radius
operator|->
name|retry_primary_interval
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_acct_interim_interval"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|radius
operator|->
name|acct_interim_interval
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"auth_algs"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|auth_algs
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|auth_algs
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: no authentication algorithms "
literal|"allowed\n"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|wpa
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_group_rekey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|wpa_group_rekey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_strict_rekey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|wpa_strict_rekey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_gmk_rekey"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|wpa_gmk_rekey
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_passphrase"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|len
init|=
name|strlen
argument_list|(
name|pos
argument_list|)
decl_stmt|;
if|if
condition|(
name|len
operator|<
literal|8
operator|||
name|len
operator|>
literal|63
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: invalid WPA passphrase length"
literal|" %d (expected 8..63)\n"
argument_list|,
name|line
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
name|free
argument_list|(
name|conf
operator|->
name|wpa_passphrase
argument_list|)
expr_stmt|;
name|conf
operator|->
name|wpa_passphrase
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_psk"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|conf
operator|->
name|wpa_psk
argument_list|)
expr_stmt|;
name|conf
operator|->
name|wpa_psk
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_wpa_psk
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|wpa_psk
condition|)
block|{
name|memset
argument_list|(
name|conf
operator|->
name|wpa_psk
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|hostapd_wpa_psk
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|conf
operator|->
name|wpa_psk
operator|==
name|NULL
condition|)
name|errors
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|conf
operator|->
name|wpa_psk
operator|->
name|psk
argument_list|,
name|PMK_LEN
argument_list|)
operator|||
name|pos
index|[
name|PMK_LEN
operator|*
literal|2
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: Invalid PSK '%s'.\n"
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
name|conf
operator|->
name|wpa_psk
operator|->
name|group
operator|=
literal|1
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_psk_file"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|conf
operator|->
name|wpa_psk_file
argument_list|)
expr_stmt|;
name|conf
operator|->
name|wpa_psk_file
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|conf
operator|->
name|wpa_psk_file
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: allocation failed\n"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_key_mgmt"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|wpa_key_mgmt
operator|=
name|hostapd_config_parse_key_mgmt
argument_list|(
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|wpa_key_mgmt
operator|==
operator|-
literal|1
condition|)
name|errors
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"wpa_pairwise"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|wpa_pairwise
operator|=
name|hostapd_config_parse_cipher
argument_list|(
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|conf
operator|->
name|wpa_pairwise
operator|==
operator|-
literal|1
operator|||
name|conf
operator|->
name|wpa_pairwise
operator|==
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|conf
operator|->
name|wpa_pairwise
operator|&
operator|(
name|WPA_CIPHER_NONE
operator||
name|WPA_CIPHER_WEP40
operator||
name|WPA_CIPHER_WEP104
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"Line %d: unsupported pairwise "
literal|"cipher suite '%s'\n"
argument_list|,
name|conf
operator|->
name|wpa_pairwise
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|conf
operator|->
name|wpa_pairwise
operator|&
name|WPA_CIPHER_TKIP
condition|)
name|conf
operator|->
name|wpa_group
operator|=
name|WPA_CIPHER_TKIP
expr_stmt|;
else|else
name|conf
operator|->
name|wpa_group
operator|=
name|WPA_CIPHER_CCMP
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|CONFIG_RSN_PREAUTH
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"rsn_preauth"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|rsn_preauth
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"rsn_preauth_interfaces"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|rsn_preauth_interfaces
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_RSN_PREAUTH */
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"ctrl_interface"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|conf
operator|->
name|ctrl_interface
argument_list|)
expr_stmt|;
name|conf
operator|->
name|ctrl_interface
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"ctrl_interface_group"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|struct
name|group
modifier|*
name|grp
decl_stmt|;
name|char
modifier|*
name|endp
decl_stmt|;
specifier|const
name|char
modifier|*
name|group
init|=
name|pos
decl_stmt|;
name|grp
operator|=
name|getgrnam
argument_list|(
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
name|grp
condition|)
block|{
name|conf
operator|->
name|ctrl_interface_gid
operator|=
name|grp
operator|->
name|gr_gid
expr_stmt|;
name|conf
operator|->
name|ctrl_interface_gid_set
operator|=
literal|1
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"ctrl_interface_group=%d"
literal|" (from group name '%s')"
argument_list|,
name|conf
operator|->
name|ctrl_interface_gid
argument_list|,
name|group
argument_list|)
expr_stmt|;
continue|continue;
block|}
comment|/* Group name not found - try to parse this as gid */
name|conf
operator|->
name|ctrl_interface_gid
operator|=
name|strtol
argument_list|(
name|group
argument_list|,
operator|&
name|endp
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|group
operator|==
literal|'\0'
operator|||
operator|*
name|endp
operator|!=
literal|'\0'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: Invalid group "
literal|"'%s'"
argument_list|,
name|line
argument_list|,
name|group
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
name|conf
operator|->
name|ctrl_interface_gid_set
operator|=
literal|1
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"ctrl_interface_group=%d"
argument_list|,
name|conf
operator|->
name|ctrl_interface_gid
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|RADIUS_SERVER
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_server_clients"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|conf
operator|->
name|radius_server_clients
argument_list|)
expr_stmt|;
name|conf
operator|->
name|radius_server_clients
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_server_auth_port"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|radius_server_auth_port
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"radius_server_ipv6"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|radius_server_ipv6
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* RADIUS_SERVER */
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"test_socket"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
name|conf
operator|->
name|test_socket
argument_list|)
expr_stmt|;
name|conf
operator|->
name|test_socket
operator|=
name|strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"use_pae_group_addr"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|conf
operator|->
name|use_pae_group_addr
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"Line %d: unknown configuration item '%s'\n"
argument_list|,
name|line
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
if|if
condition|(
name|hostapd_config_read_maclist
argument_list|(
name|accept_mac_file
argument_list|,
operator|&
name|conf
operator|->
name|accept_mac
argument_list|,
operator|&
name|conf
operator|->
name|num_accept_mac
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
name|free
argument_list|(
name|accept_mac_file
argument_list|)
expr_stmt|;
if|if
condition|(
name|hostapd_config_read_maclist
argument_list|(
name|deny_mac_file
argument_list|,
operator|&
name|conf
operator|->
name|deny_mac
argument_list|,
operator|&
name|conf
operator|->
name|num_deny_mac
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
name|free
argument_list|(
name|deny_mac_file
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|EAP_SERVER
if|if
condition|(
name|hostapd_config_read_eap_user
argument_list|(
name|eap_user_file
argument_list|,
name|conf
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
name|free
argument_list|(
name|eap_user_file
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_SERVER */
name|conf
operator|->
name|radius
operator|->
name|auth_server
operator|=
name|conf
operator|->
name|radius
operator|->
name|auth_servers
expr_stmt|;
name|conf
operator|->
name|radius
operator|->
name|acct_server
operator|=
name|conf
operator|->
name|radius
operator|->
name|acct_servers
expr_stmt|;
if|if
condition|(
name|hostapd_config_check
argument_list|(
name|conf
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|errors
condition|)
block|{
name|printf
argument_list|(
literal|"%d errors found in configuration file '%s'\n"
argument_list|,
name|errors
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|hostapd_config_free
argument_list|(
name|conf
argument_list|)
expr_stmt|;
name|conf
operator|=
name|NULL
expr_stmt|;
block|}
return|return
name|conf
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|hostapd_config_free_radius
parameter_list|(
name|struct
name|hostapd_radius_server
modifier|*
name|servers
parameter_list|,
name|int
name|num_servers
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_servers
condition|;
name|i
operator|++
control|)
block|{
name|free
argument_list|(
name|servers
index|[
name|i
index|]
operator|.
name|shared_secret
argument_list|)
expr_stmt|;
block|}
name|free
argument_list|(
name|servers
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|hostapd_config_free_eap_user
parameter_list|(
name|struct
name|hostapd_eap_user
modifier|*
name|user
parameter_list|)
block|{
name|free
argument_list|(
name|user
operator|->
name|identity
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|user
operator|->
name|password
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|user
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|hostapd_config_free
parameter_list|(
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|)
block|{
name|struct
name|hostapd_wpa_psk
modifier|*
name|psk
decl_stmt|,
modifier|*
name|prev
decl_stmt|;
name|struct
name|hostapd_eap_user
modifier|*
name|user
decl_stmt|,
modifier|*
name|prev_user
decl_stmt|;
if|if
condition|(
name|conf
operator|==
name|NULL
condition|)
return|return;
name|psk
operator|=
name|conf
operator|->
name|wpa_psk
expr_stmt|;
while|while
condition|(
name|psk
condition|)
block|{
name|prev
operator|=
name|psk
expr_stmt|;
name|psk
operator|=
name|psk
operator|->
name|next
expr_stmt|;
name|free
argument_list|(
name|prev
argument_list|)
expr_stmt|;
block|}
name|free
argument_list|(
name|conf
operator|->
name|wpa_passphrase
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|wpa_psk_file
argument_list|)
expr_stmt|;
name|user
operator|=
name|conf
operator|->
name|eap_user
expr_stmt|;
while|while
condition|(
name|user
condition|)
block|{
name|prev_user
operator|=
name|user
expr_stmt|;
name|user
operator|=
name|user
operator|->
name|next
expr_stmt|;
name|hostapd_config_free_eap_user
argument_list|(
name|prev_user
argument_list|)
expr_stmt|;
block|}
name|free
argument_list|(
name|conf
operator|->
name|dump_log_name
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|eap_req_id_text
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|accept_mac
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|deny_mac
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|nas_identifier
argument_list|)
expr_stmt|;
name|hostapd_config_free_radius
argument_list|(
name|conf
operator|->
name|radius
operator|->
name|auth_servers
argument_list|,
name|conf
operator|->
name|radius
operator|->
name|num_auth_servers
argument_list|)
expr_stmt|;
name|hostapd_config_free_radius
argument_list|(
name|conf
operator|->
name|radius
operator|->
name|acct_servers
argument_list|,
name|conf
operator|->
name|radius
operator|->
name|num_acct_servers
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|rsn_preauth_interfaces
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|ctrl_interface
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|ca_cert
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|server_cert
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|private_key
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|private_key_passwd
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|eap_sim_db
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|radius_server_clients
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
operator|->
name|test_socket
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|conf
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Perform a binary search for given MAC address from a pre-sorted list.  * Returns 1 if address is in the list or 0 if not. */
end_comment

begin_function
name|int
name|hostapd_maclist_found
parameter_list|(
name|macaddr
modifier|*
name|list
parameter_list|,
name|int
name|num_entries
parameter_list|,
name|u8
modifier|*
name|addr
parameter_list|)
block|{
name|int
name|start
decl_stmt|,
name|end
decl_stmt|,
name|middle
decl_stmt|,
name|res
decl_stmt|;
name|start
operator|=
literal|0
expr_stmt|;
name|end
operator|=
name|num_entries
operator|-
literal|1
expr_stmt|;
while|while
condition|(
name|start
operator|<=
name|end
condition|)
block|{
name|middle
operator|=
operator|(
name|start
operator|+
name|end
operator|)
operator|/
literal|2
expr_stmt|;
name|res
operator|=
name|memcmp
argument_list|(
name|list
index|[
name|middle
index|]
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|res
operator|==
literal|0
condition|)
return|return
literal|1
return|;
if|if
condition|(
name|res
operator|<
literal|0
condition|)
name|start
operator|=
name|middle
operator|+
literal|1
expr_stmt|;
else|else
name|end
operator|=
name|middle
operator|-
literal|1
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|const
name|u8
modifier|*
name|hostapd_get_psk
parameter_list|(
specifier|const
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
specifier|const
name|u8
modifier|*
name|addr
parameter_list|,
specifier|const
name|u8
modifier|*
name|prev_psk
parameter_list|)
block|{
name|struct
name|hostapd_wpa_psk
modifier|*
name|psk
decl_stmt|;
name|int
name|next_ok
init|=
name|prev_psk
operator|==
name|NULL
decl_stmt|;
for|for
control|(
name|psk
operator|=
name|conf
operator|->
name|wpa_psk
init|;
name|psk
operator|!=
name|NULL
condition|;
name|psk
operator|=
name|psk
operator|->
name|next
control|)
block|{
if|if
condition|(
name|next_ok
operator|&&
operator|(
name|psk
operator|->
name|group
operator|||
name|memcmp
argument_list|(
name|psk
operator|->
name|addr
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
operator|==
literal|0
operator|)
condition|)
return|return
name|psk
operator|->
name|psk
return|;
if|if
condition|(
name|psk
operator|->
name|psk
operator|==
name|prev_psk
condition|)
name|next_ok
operator|=
literal|1
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|const
name|struct
name|hostapd_eap_user
modifier|*
name|hostapd_get_eap_user
parameter_list|(
specifier|const
name|struct
name|hostapd_config
modifier|*
name|conf
parameter_list|,
specifier|const
name|u8
modifier|*
name|identity
parameter_list|,
name|size_t
name|identity_len
parameter_list|,
name|int
name|phase2
parameter_list|)
block|{
name|struct
name|hostapd_eap_user
modifier|*
name|user
init|=
name|conf
operator|->
name|eap_user
decl_stmt|;
while|while
condition|(
name|user
condition|)
block|{
if|if
condition|(
operator|!
name|phase2
operator|&&
name|user
operator|->
name|identity
operator|==
name|NULL
condition|)
block|{
comment|/* Wildcard match */
break|break;
block|}
if|if
condition|(
name|user
operator|->
name|phase2
operator|==
operator|!
operator|!
name|phase2
operator|&&
name|user
operator|->
name|identity_len
operator|==
name|identity_len
operator|&&
name|memcmp
argument_list|(
name|user
operator|->
name|identity
argument_list|,
name|identity
argument_list|,
name|identity_len
argument_list|)
operator|==
literal|0
condition|)
break|break;
name|user
operator|=
name|user
operator|->
name|next
expr_stmt|;
block|}
return|return
name|user
return|;
block|}
end_function

end_unit

