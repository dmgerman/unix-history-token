begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * /src/NTP/REPOSITORY/ntp4-dev/libparse/data_mbg.c,v 4.8 2006/06/22 18:40:01 kardel RELEASE_20060622_A  *  * data_mbg.c,v 4.8 2006/06/22 18:40:01 kardel RELEASE_20060622_A  *  * $Created: Sun Jul 20 12:08:14 1997 $  *  * Copyright (c) 1997-2005 by Frank Kardel<kardel<AT> ntp.org>  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. Neither the name of the author nor the names of its contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|PARSESTREAM
end_ifdef

begin_define
define|#
directive|define
name|NEED_BOPS
end_define

begin_include
include|#
directive|include
file|"ntp_string.h"
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"ntp_types.h"
end_include

begin_include
include|#
directive|include
file|"ntp_stdlib.h"
end_include

begin_include
include|#
directive|include
file|"ntp_fp.h"
end_include

begin_include
include|#
directive|include
file|"mbg_gps166.h"
end_include

begin_include
include|#
directive|include
file|"binio.h"
end_include

begin_include
include|#
directive|include
file|"ieee754io.h"
end_include

begin_decl_stmt
specifier|static
name|void
name|get_mbg_tzname
name|P
argument_list|(
operator|(
name|unsigned
name|char
operator|*
operator|*
operator|,
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|mbg_time_status_str
name|P
argument_list|(
operator|(
name|char
operator|*
operator|*
operator|,
name|unsigned
name|int
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_if
if|#
directive|if
literal|0
end_if

begin_comment
comment|/* no actual floats on Meinberg binary interface */
end_comment

begin_comment
unit|static offsets_t mbg_float  = { 1, 0, 3, 2, 0, 0, 0, 0 };
comment|/* byte order for meinberg floats */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|offsets_t
name|mbg_double
init|=
block|{
literal|1
block|,
literal|0
block|,
literal|3
block|,
literal|2
block|,
literal|5
block|,
literal|4
block|,
literal|7
block|,
literal|6
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* byte order for meinberg doubles */
end_comment

begin_decl_stmt
specifier|static
name|int32
name|rad2deg_i
init|=
literal|57
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_int32
name|rad2deg_f
init|=
literal|0x4BB834C7
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 57.2957795131 == 180/PI */
end_comment

begin_function
name|void
name|put_mbg_header
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|bufpp
parameter_list|,
name|GPS_MSG_HDR
modifier|*
name|headerp
parameter_list|)
block|{
name|put_lsb_short
argument_list|(
name|bufpp
argument_list|,
name|headerp
operator|->
name|gps_cmd
argument_list|)
expr_stmt|;
name|put_lsb_short
argument_list|(
name|bufpp
argument_list|,
name|headerp
operator|->
name|gps_len
argument_list|)
expr_stmt|;
name|put_lsb_short
argument_list|(
name|bufpp
argument_list|,
name|headerp
operator|->
name|gps_data_csum
argument_list|)
expr_stmt|;
name|put_lsb_short
argument_list|(
name|bufpp
argument_list|,
name|headerp
operator|->
name|gps_hdr_csum
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_sw_rev
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|bufpp
parameter_list|,
name|SW_REV
modifier|*
name|sw_revp
parameter_list|)
block|{
name|sw_revp
operator|->
name|code
operator|=
name|get_lsb_short
argument_list|(
name|bufpp
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|sw_revp
operator|->
name|name
argument_list|,
operator|*
name|bufpp
argument_list|,
sizeof|sizeof
argument_list|(
name|sw_revp
operator|->
name|name
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|bufpp
operator|+=
sizeof|sizeof
argument_list|(
name|sw_revp
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_ascii_msg
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|bufpp
parameter_list|,
name|ASCII_MSG
modifier|*
name|ascii_msgp
parameter_list|)
block|{
name|ascii_msgp
operator|->
name|csum
operator|=
name|get_lsb_short
argument_list|(
name|bufpp
argument_list|)
expr_stmt|;
name|ascii_msgp
operator|->
name|valid
operator|=
name|get_lsb_short
argument_list|(
name|bufpp
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|ascii_msgp
operator|->
name|s
argument_list|,
operator|*
name|bufpp
argument_list|,
sizeof|sizeof
argument_list|(
name|ascii_msgp
operator|->
name|s
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|bufpp
operator|+=
sizeof|sizeof
argument_list|(
name|ascii_msgp
operator|->
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_svno
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|bufpp
parameter_list|,
name|SVNO
modifier|*
name|svnop
parameter_list|)
block|{
operator|*
name|svnop
operator|=
name|get_lsb_short
argument_list|(
name|bufpp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_health
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|bufpp
parameter_list|,
name|HEALTH
modifier|*
name|healthp
parameter_list|)
block|{
operator|*
name|healthp
operator|=
name|get_lsb_short
argument_list|(
name|bufpp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_cfg
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|bufpp
parameter_list|,
name|CFG
modifier|*
name|cfgp
parameter_list|)
block|{
operator|*
name|cfgp
operator|=
name|get_lsb_short
argument_list|(
name|bufpp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_tgps
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|bufpp
parameter_list|,
name|T_GPS
modifier|*
name|tgpsp
parameter_list|)
block|{
name|tgpsp
operator|->
name|wn
operator|=
name|get_lsb_short
argument_list|(
name|bufpp
argument_list|)
expr_stmt|;
name|tgpsp
operator|->
name|sec
operator|=
name|get_lsb_long
argument_list|(
name|bufpp
argument_list|)
expr_stmt|;
name|tgpsp
operator|->
name|tick
operator|=
name|get_lsb_long
argument_list|(
name|bufpp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_tm
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|TM
modifier|*
name|tmp
parameter_list|)
block|{
name|tmp
operator|->
name|year
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|tmp
operator|->
name|month
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
name|tmp
operator|->
name|mday
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
name|tmp
operator|->
name|yday
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|tmp
operator|->
name|wday
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
name|tmp
operator|->
name|hour
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
name|tmp
operator|->
name|minute
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
name|tmp
operator|->
name|second
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
name|tmp
operator|->
name|frac
operator|=
name|get_lsb_long
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|tmp
operator|->
name|offs_from_utc
operator|=
name|get_lsb_long
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|tmp
operator|->
name|status
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_ttm
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|TTM
modifier|*
name|ttmp
parameter_list|)
block|{
name|ttmp
operator|->
name|channel
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|get_mbg_tgps
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ttmp
operator|->
name|t
argument_list|)
expr_stmt|;
name|get_mbg_tm
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ttmp
operator|->
name|tm
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_synth
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|SYNTH
modifier|*
name|synthp
parameter_list|)
block|{
name|synthp
operator|->
name|freq
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|synthp
operator|->
name|range
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|synthp
operator|->
name|phase
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|get_mbg_tzname
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|char
modifier|*
name|tznamep
parameter_list|)
block|{
name|strncpy
argument_list|(
name|tznamep
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|*
name|buffpp
argument_list|,
sizeof|sizeof
argument_list|(
name|TZ_NAME
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|buffpp
operator|+=
sizeof|sizeof
argument_list|(
name|TZ_NAME
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_tzdl
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|TZDL
modifier|*
name|tzdlp
parameter_list|)
block|{
name|tzdlp
operator|->
name|offs
operator|=
name|get_lsb_long
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|tzdlp
operator|->
name|offs_dl
operator|=
name|get_lsb_long
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|get_mbg_tm
argument_list|(
name|buffpp
argument_list|,
operator|&
name|tzdlp
operator|->
name|tm_on
argument_list|)
expr_stmt|;
name|get_mbg_tm
argument_list|(
name|buffpp
argument_list|,
operator|&
name|tzdlp
operator|->
name|tm_off
argument_list|)
expr_stmt|;
name|get_mbg_tzname
argument_list|(
name|buffpp
argument_list|,
operator|(
name|char
operator|*
operator|)
name|tzdlp
operator|->
name|name
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|get_mbg_tzname
argument_list|(
name|buffpp
argument_list|,
operator|(
name|char
operator|*
operator|)
name|tzdlp
operator|->
name|name
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_antinfo
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|ANT_INFO
modifier|*
name|antinfop
parameter_list|)
block|{
name|antinfop
operator|->
name|status
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|get_mbg_tm
argument_list|(
name|buffpp
argument_list|,
operator|&
name|antinfop
operator|->
name|tm_disconn
argument_list|)
expr_stmt|;
name|get_mbg_tm
argument_list|(
name|buffpp
argument_list|,
operator|&
name|antinfop
operator|->
name|tm_reconn
argument_list|)
expr_stmt|;
name|antinfop
operator|->
name|delta_t
operator|=
name|get_lsb_long
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|mbg_time_status_str
parameter_list|(
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|unsigned
name|int
name|status
parameter_list|,
name|int
name|size
parameter_list|)
block|{
specifier|static
struct|struct
name|state
block|{
name|int
name|flag
decl_stmt|;
comment|/* bit flag */
specifier|const
name|char
modifier|*
name|string
decl_stmt|;
comment|/* bit name */
block|}
name|states
index|[]
init|=
block|{
block|{
name|TM_UTC
block|,
literal|"UTC CORR"
block|}
block|,
block|{
name|TM_LOCAL
block|,
literal|"LOCAL TIME"
block|}
block|,
block|{
name|TM_DL_ANN
block|,
literal|"DST WARN"
block|}
block|,
block|{
name|TM_DL_ENB
block|,
literal|"DST"
block|}
block|,
block|{
name|TM_LS_ANN
block|,
literal|"LEAP WARN"
block|}
block|,
block|{
name|TM_LS_ENB
block|,
literal|"LEAP SEC"
block|}
block|,
block|{
literal|0
block|,
literal|""
block|}
block|}
struct|;
if|if
condition|(
name|status
condition|)
block|{
name|char
modifier|*
name|start
decl_stmt|,
modifier|*
name|p
decl_stmt|;
name|struct
name|state
modifier|*
name|s
decl_stmt|;
name|start
operator|=
name|p
operator|=
operator|*
name|buffpp
expr_stmt|;
for|for
control|(
name|s
operator|=
name|states
init|;
name|s
operator|->
name|flag
condition|;
name|s
operator|++
control|)
block|{
if|if
condition|(
name|s
operator|->
name|flag
operator|&
name|status
condition|)
block|{
if|if
condition|(
name|p
operator|!=
operator|*
name|buffpp
condition|)
block|{
name|strncpy
argument_list|(
name|p
argument_list|,
literal|", "
argument_list|,
name|size
operator|-
operator|(
name|p
operator|-
name|start
operator|)
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
block|}
name|strncpy
argument_list|(
name|p
argument_list|,
name|s
operator|->
name|string
argument_list|,
name|size
operator|-
operator|(
name|p
operator|-
name|start
operator|)
argument_list|)
expr_stmt|;
name|p
operator|+=
name|strlen
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
block|}
operator|*
name|buffpp
operator|=
name|p
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|mbg_tm_str
parameter_list|(
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|TM
modifier|*
name|tmp
parameter_list|,
name|int
name|size
parameter_list|)
block|{
name|char
modifier|*
name|s
init|=
operator|*
name|buffpp
decl_stmt|;
name|snprintf
argument_list|(
operator|*
name|buffpp
argument_list|,
name|size
argument_list|,
literal|"%04d-%02d-%02d %02d:%02d:%02d.%07ld (%c%02d%02d) "
argument_list|,
name|tmp
operator|->
name|year
argument_list|,
name|tmp
operator|->
name|month
argument_list|,
name|tmp
operator|->
name|mday
argument_list|,
name|tmp
operator|->
name|hour
argument_list|,
name|tmp
operator|->
name|minute
argument_list|,
name|tmp
operator|->
name|second
argument_list|,
name|tmp
operator|->
name|frac
argument_list|,
operator|(
name|tmp
operator|->
name|offs_from_utc
operator|<
literal|0
operator|)
condition|?
literal|'-'
else|:
literal|'+'
argument_list|,
name|abs
argument_list|(
name|tmp
operator|->
name|offs_from_utc
argument_list|)
operator|/
literal|3600
argument_list|,
operator|(
name|abs
argument_list|(
name|tmp
operator|->
name|offs_from_utc
argument_list|)
operator|/
literal|60
operator|)
operator|%
literal|60
argument_list|)
expr_stmt|;
operator|*
name|buffpp
operator|+=
name|strlen
argument_list|(
operator|*
name|buffpp
argument_list|)
expr_stmt|;
name|mbg_time_status_str
argument_list|(
name|buffpp
argument_list|,
name|tmp
operator|->
name|status
argument_list|,
name|size
operator|-
operator|(
operator|*
name|buffpp
operator|-
name|s
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|mbg_tgps_str
parameter_list|(
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|T_GPS
modifier|*
name|tgpsp
parameter_list|,
name|int
name|size
parameter_list|)
block|{
name|snprintf
argument_list|(
operator|*
name|buffpp
argument_list|,
name|size
argument_list|,
literal|"week %d + %ld days + %ld.%07ld sec"
argument_list|,
name|tgpsp
operator|->
name|wn
argument_list|,
name|tgpsp
operator|->
name|sec
operator|/
literal|86400
argument_list|,
name|tgpsp
operator|->
name|sec
operator|%
literal|86400
argument_list|,
name|tgpsp
operator|->
name|tick
argument_list|)
expr_stmt|;
operator|*
name|buffpp
operator|+=
name|strlen
argument_list|(
operator|*
name|buffpp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_cfgh
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|CFGH
modifier|*
name|cfghp
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|cfghp
operator|->
name|csum
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|cfghp
operator|->
name|valid
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|get_mbg_tgps
argument_list|(
name|buffpp
argument_list|,
operator|&
name|cfghp
operator|->
name|tot_51
argument_list|)
expr_stmt|;
name|get_mbg_tgps
argument_list|(
name|buffpp
argument_list|,
operator|&
name|cfghp
operator|->
name|tot_63
argument_list|)
expr_stmt|;
name|get_mbg_tgps
argument_list|(
name|buffpp
argument_list|,
operator|&
name|cfghp
operator|->
name|t0a
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|MIN_SVNO
init|;
name|i
operator|<=
name|MAX_SVNO
condition|;
name|i
operator|++
control|)
block|{
name|get_mbg_cfg
argument_list|(
name|buffpp
argument_list|,
operator|&
name|cfghp
operator|->
name|cfg
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
name|MIN_SVNO
init|;
name|i
operator|<=
name|MAX_SVNO
condition|;
name|i
operator|++
control|)
block|{
name|get_mbg_health
argument_list|(
name|buffpp
argument_list|,
operator|&
name|cfghp
operator|->
name|health
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|get_mbg_utc
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|UTC
modifier|*
name|utcp
parameter_list|)
block|{
name|utcp
operator|->
name|csum
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|utcp
operator|->
name|valid
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|get_mbg_tgps
argument_list|(
name|buffpp
argument_list|,
operator|&
name|utcp
operator|->
name|t0t
argument_list|)
expr_stmt|;
if|if
condition|(
name|fetch_ieee754
argument_list|(
name|buffpp
argument_list|,
name|IEEE_DOUBLE
argument_list|,
operator|&
name|utcp
operator|->
name|A0
argument_list|,
name|mbg_double
argument_list|)
operator|!=
name|IEEE_OK
condition|)
block|{
name|L_CLR
argument_list|(
operator|&
name|utcp
operator|->
name|A0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fetch_ieee754
argument_list|(
name|buffpp
argument_list|,
name|IEEE_DOUBLE
argument_list|,
operator|&
name|utcp
operator|->
name|A1
argument_list|,
name|mbg_double
argument_list|)
operator|!=
name|IEEE_OK
condition|)
block|{
name|L_CLR
argument_list|(
operator|&
name|utcp
operator|->
name|A1
argument_list|)
expr_stmt|;
block|}
name|utcp
operator|->
name|WNlsf
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|utcp
operator|->
name|DNt
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|utcp
operator|->
name|delta_tls
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
name|utcp
operator|->
name|delta_tlsf
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_lla
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|LLA
name|lla
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
name|LAT
init|;
name|i
operator|<=
name|ALT
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|fetch_ieee754
argument_list|(
name|buffpp
argument_list|,
name|IEEE_DOUBLE
argument_list|,
operator|&
name|lla
index|[
name|i
index|]
argument_list|,
name|mbg_double
argument_list|)
operator|!=
name|IEEE_OK
condition|)
block|{
name|L_CLR
argument_list|(
operator|&
name|lla
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|i
operator|!=
name|ALT
condition|)
block|{
comment|/* convert to degrees (* 180/PI) */
name|mfp_mul
argument_list|(
operator|&
name|lla
index|[
name|i
index|]
operator|.
name|l_i
argument_list|,
operator|&
name|lla
index|[
name|i
index|]
operator|.
name|l_uf
argument_list|,
name|lla
index|[
name|i
index|]
operator|.
name|l_i
argument_list|,
name|lla
index|[
name|i
index|]
operator|.
name|l_uf
argument_list|,
name|rad2deg_i
argument_list|,
name|rad2deg_f
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
name|get_mbg_xyz
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|XYZ
name|xyz
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
name|XP
init|;
name|i
operator|<=
name|ZP
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|fetch_ieee754
argument_list|(
name|buffpp
argument_list|,
name|IEEE_DOUBLE
argument_list|,
operator|&
name|xyz
index|[
name|i
index|]
argument_list|,
name|mbg_double
argument_list|)
operator|!=
name|IEEE_OK
condition|)
block|{
name|L_CLR
argument_list|(
operator|&
name|xyz
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|get_mbg_comparam
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|COM_PARM
modifier|*
name|comparamp
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|comparamp
operator|->
name|baud_rate
operator|=
name|get_lsb_long
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|comparamp
operator|->
name|framing
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|comparamp
operator|->
name|framing
index|[
name|i
index|]
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
block|}
name|comparamp
operator|->
name|handshake
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_portparam
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|PORT_PARM
modifier|*
name|portparamp
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|N_COM
condition|;
name|i
operator|++
control|)
block|{
name|get_mbg_comparam
argument_list|(
name|buffpp
argument_list|,
operator|&
name|portparamp
operator|->
name|com
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|N_COM
condition|;
name|i
operator|++
control|)
block|{
name|portparamp
operator|->
name|mode
index|[
name|i
index|]
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|FETCH_DOUBLE
parameter_list|(
name|src
parameter_list|,
name|addr
parameter_list|)
define|\
value|if  (fetch_ieee754(src, IEEE_DOUBLE, addr, mbg_double) != IEEE_OK)	\ 	{									\ 	  L_CLR(addr);								\ 	}
end_define

begin_function
name|void
name|get_mbg_eph
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|EPH
modifier|*
name|ephp
parameter_list|)
block|{
name|ephp
operator|->
name|csum
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|ephp
operator|->
name|valid
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|ephp
operator|->
name|health
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|ephp
operator|->
name|IODC
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|ephp
operator|->
name|IODE2
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|ephp
operator|->
name|IODE3
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|get_mbg_tgps
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|tt
argument_list|)
expr_stmt|;
name|get_mbg_tgps
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|t0c
argument_list|)
expr_stmt|;
name|get_mbg_tgps
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|t0e
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|sqrt_A
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|e
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|M0
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|omega
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|OMEGA0
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|OMEGADOT
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|deltan
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|i0
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|idot
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|crc
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|crs
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|cuc
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|cus
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|cic
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|cis
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|af0
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|af1
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|af2
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ephp
operator|->
name|tgd
argument_list|)
expr_stmt|;
name|ephp
operator|->
name|URA
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|ephp
operator|->
name|L2code
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
name|ephp
operator|->
name|L2flag
operator|=
operator|*
operator|(
operator|*
name|buffpp
operator|)
operator|++
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_alm
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|ALM
modifier|*
name|almp
parameter_list|)
block|{
name|almp
operator|->
name|csum
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|almp
operator|->
name|valid
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|almp
operator|->
name|health
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|get_mbg_tgps
argument_list|(
name|buffpp
argument_list|,
operator|&
name|almp
operator|->
name|t0a
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|almp
operator|->
name|sqrt_A
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|almp
operator|->
name|e
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|almp
operator|->
name|M0
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|almp
operator|->
name|omega
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|almp
operator|->
name|OMEGA0
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|almp
operator|->
name|OMEGADOT
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|almp
operator|->
name|deltai
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|almp
operator|->
name|af0
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|almp
operator|->
name|af1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_mbg_iono
parameter_list|(
name|unsigned
name|char
modifier|*
modifier|*
name|buffpp
parameter_list|,
name|IONO
modifier|*
name|ionop
parameter_list|)
block|{
name|ionop
operator|->
name|csum
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|ionop
operator|->
name|valid
operator|=
name|get_lsb_short
argument_list|(
name|buffpp
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ionop
operator|->
name|alpha_0
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ionop
operator|->
name|alpha_1
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ionop
operator|->
name|alpha_2
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ionop
operator|->
name|alpha_3
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ionop
operator|->
name|beta_0
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ionop
operator|->
name|beta_1
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ionop
operator|->
name|beta_2
argument_list|)
expr_stmt|;
name|FETCH_DOUBLE
argument_list|(
name|buffpp
argument_list|,
operator|&
name|ionop
operator|->
name|beta_3
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * data_mbg.c,v  * Revision 4.8  2006/06/22 18:40:01  kardel  * clean up signedness (gcc 4)  *  * Revision 4.7  2005/10/07 22:11:10  kardel  * bounded buffer implementation  *  * Revision 4.6.2.1  2005/09/25 10:23:06  kardel  * support bounded buffers  *  * Revision 4.6  2005/04/16 17:32:10  kardel  * update copyright  *  * Revision 4.5  2004/11/14 15:29:41  kardel  * support PPSAPI, upgrade Copyright to Berkeley style  *  * Revision 4.3  1999/02/21 12:17:42  kardel  * 4.91f reconcilation  *  * Revision 4.2  1998/06/14 21:09:39  kardel  * Sun acc cleanup  *  * Revision 4.1  1998/05/24 08:02:06  kardel  * trimmed version log  *  * Revision 4.0  1998/04/10 19:45:33  kardel  * Start 4.0 release version numbering  */
end_comment

end_unit

