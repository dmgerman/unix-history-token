begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (C) 2004, 2006-2009  Internet Systems Consortium, Inc. ("ISC")  * Copyright (C) 1998-2001, 2003  Internet Software Consortium.  *  * Permission to use, copy, modify, and/or distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND ISC DISCLAIMS ALL WARRANTIES WITH  * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY  * AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR ANY SPECIAL, DIRECT,  * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM  * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE  * OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR  * PERFORMANCE OF THIS SOFTWARE.  */
end_comment

begin_comment
comment|/* $Id: time.c,v 1.52 2009/08/14 07:51:08 marka Exp $ */
end_comment

begin_include
include|#
directive|include
file|<config.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<limits.h>
end_include

begin_include
include|#
directive|include
file|<stddef.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_include
include|#
directive|include
file|<windows.h>
end_include

begin_include
include|#
directive|include
file|<isc/assertions.h>
end_include

begin_include
include|#
directive|include
file|<isc/time.h>
end_include

begin_include
include|#
directive|include
file|<isc/util.h>
end_include

begin_comment
comment|/*  * struct FILETIME uses "100-nanoseconds intervals".  * NS / S = 1000000000 (10^9).  * While it is reasonably obvious that this makes the needed  * conversion factor 10^7, it is coded this way for additional clarity.  */
end_comment

begin_define
define|#
directive|define
name|NS_PER_S
value|1000000000
end_define

begin_define
define|#
directive|define
name|NS_INTERVAL
value|100
end_define

begin_define
define|#
directive|define
name|INTERVALS_PER_S
value|(NS_PER_S / NS_INTERVAL)
end_define

begin_define
define|#
directive|define
name|UINT64_MAX
value|_UI64_MAX
end_define

begin_comment
comment|/***  *** Absolute Times  ***/
end_comment

begin_decl_stmt
specifier|static
name|isc_time_t
name|epoch
init|=
block|{
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LIBISC_EXTERNAL_DATA
name|isc_time_t
modifier|*
name|isc_time_epoch
init|=
operator|&
name|epoch
decl_stmt|;
end_decl_stmt

begin_comment
comment|/***  *** Intervals  ***/
end_comment

begin_decl_stmt
specifier|static
name|isc_interval_t
name|zero_interval
init|=
block|{
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LIBISC_EXTERNAL_DATA
name|isc_interval_t
modifier|*
name|isc_interval_zero
init|=
operator|&
name|zero_interval
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|isc_interval_set
parameter_list|(
name|isc_interval_t
modifier|*
name|i
parameter_list|,
name|unsigned
name|int
name|seconds
parameter_list|,
name|unsigned
name|int
name|nanoseconds
parameter_list|)
block|{
name|REQUIRE
argument_list|(
name|i
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|REQUIRE
argument_list|(
name|nanoseconds
operator|<
name|NS_PER_S
argument_list|)
expr_stmt|;
comment|/* 	 * This rounds nanoseconds up not down. 	 */
name|i
operator|->
name|interval
operator|=
operator|(
name|LONGLONG
operator|)
name|seconds
operator|*
name|INTERVALS_PER_S
operator|+
operator|(
name|nanoseconds
operator|+
name|NS_INTERVAL
operator|-
literal|1
operator|)
operator|/
name|NS_INTERVAL
expr_stmt|;
block|}
end_function

begin_function
name|isc_boolean_t
name|isc_interval_iszero
parameter_list|(
specifier|const
name|isc_interval_t
modifier|*
name|i
parameter_list|)
block|{
name|REQUIRE
argument_list|(
name|i
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|->
name|interval
operator|==
literal|0
condition|)
return|return
operator|(
name|ISC_TRUE
operator|)
return|;
return|return
operator|(
name|ISC_FALSE
operator|)
return|;
block|}
end_function

begin_function
name|void
name|isc_time_set
parameter_list|(
name|isc_time_t
modifier|*
name|t
parameter_list|,
name|unsigned
name|int
name|seconds
parameter_list|,
name|unsigned
name|int
name|nanoseconds
parameter_list|)
block|{
name|SYSTEMTIME
name|epoch
init|=
block|{
literal|1970
block|,
literal|1
block|,
literal|4
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|FILETIME
name|temp
decl_stmt|;
name|ULARGE_INTEGER
name|i1
decl_stmt|;
name|REQUIRE
argument_list|(
name|t
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|REQUIRE
argument_list|(
name|nanoseconds
operator|<
name|NS_PER_S
argument_list|)
expr_stmt|;
name|SystemTimeToFileTime
argument_list|(
operator|&
name|epoch
argument_list|,
operator|&
name|temp
argument_list|)
expr_stmt|;
name|i1
operator|.
name|LowPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwLowDateTime
expr_stmt|;
name|i1
operator|.
name|HighPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwHighDateTime
expr_stmt|;
name|i1
operator|.
name|QuadPart
operator|+=
operator|(
name|unsigned
name|__int64
operator|)
name|nanoseconds
operator|/
literal|100
expr_stmt|;
name|i1
operator|.
name|QuadPart
operator|+=
operator|(
name|unsigned
name|__int64
operator|)
name|seconds
operator|*
literal|10000000
expr_stmt|;
name|t
operator|->
name|absolute
operator|.
name|dwLowDateTime
operator|=
name|i1
operator|.
name|LowPart
expr_stmt|;
name|t
operator|->
name|absolute
operator|.
name|dwHighDateTime
operator|=
name|i1
operator|.
name|HighPart
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_time_settoepoch
parameter_list|(
name|isc_time_t
modifier|*
name|t
parameter_list|)
block|{
name|REQUIRE
argument_list|(
name|t
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|t
operator|->
name|absolute
operator|.
name|dwLowDateTime
operator|=
literal|0
expr_stmt|;
name|t
operator|->
name|absolute
operator|.
name|dwHighDateTime
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
name|isc_boolean_t
name|isc_time_isepoch
parameter_list|(
specifier|const
name|isc_time_t
modifier|*
name|t
parameter_list|)
block|{
name|REQUIRE
argument_list|(
name|t
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|->
name|absolute
operator|.
name|dwLowDateTime
operator|==
literal|0
operator|&&
name|t
operator|->
name|absolute
operator|.
name|dwHighDateTime
operator|==
literal|0
condition|)
return|return
operator|(
name|ISC_TRUE
operator|)
return|;
return|return
operator|(
name|ISC_FALSE
operator|)
return|;
block|}
end_function

begin_function
name|isc_result_t
name|isc_time_now
parameter_list|(
name|isc_time_t
modifier|*
name|t
parameter_list|)
block|{
name|REQUIRE
argument_list|(
name|t
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|GetSystemTimeAsFileTime
argument_list|(
operator|&
name|t
operator|->
name|absolute
argument_list|)
expr_stmt|;
return|return
operator|(
name|ISC_R_SUCCESS
operator|)
return|;
block|}
end_function

begin_function
name|isc_result_t
name|isc_time_nowplusinterval
parameter_list|(
name|isc_time_t
modifier|*
name|t
parameter_list|,
specifier|const
name|isc_interval_t
modifier|*
name|i
parameter_list|)
block|{
name|ULARGE_INTEGER
name|i1
decl_stmt|;
name|REQUIRE
argument_list|(
name|t
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|REQUIRE
argument_list|(
name|i
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|GetSystemTimeAsFileTime
argument_list|(
operator|&
name|t
operator|->
name|absolute
argument_list|)
expr_stmt|;
name|i1
operator|.
name|LowPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwLowDateTime
expr_stmt|;
name|i1
operator|.
name|HighPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwHighDateTime
expr_stmt|;
if|if
condition|(
name|UINT64_MAX
operator|-
name|i1
operator|.
name|QuadPart
operator|<
operator|(
name|unsigned
name|__int64
operator|)
name|i
operator|->
name|interval
condition|)
return|return
operator|(
name|ISC_R_RANGE
operator|)
return|;
name|i1
operator|.
name|QuadPart
operator|+=
name|i
operator|->
name|interval
expr_stmt|;
name|t
operator|->
name|absolute
operator|.
name|dwLowDateTime
operator|=
name|i1
operator|.
name|LowPart
expr_stmt|;
name|t
operator|->
name|absolute
operator|.
name|dwHighDateTime
operator|=
name|i1
operator|.
name|HighPart
expr_stmt|;
return|return
operator|(
name|ISC_R_SUCCESS
operator|)
return|;
block|}
end_function

begin_function
name|int
name|isc_time_compare
parameter_list|(
specifier|const
name|isc_time_t
modifier|*
name|t1
parameter_list|,
specifier|const
name|isc_time_t
modifier|*
name|t2
parameter_list|)
block|{
name|REQUIRE
argument_list|(
name|t1
operator|!=
name|NULL
operator|&&
name|t2
operator|!=
name|NULL
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
name|int
operator|)
name|CompareFileTime
argument_list|(
operator|&
name|t1
operator|->
name|absolute
argument_list|,
operator|&
name|t2
operator|->
name|absolute
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|isc_result_t
name|isc_time_add
parameter_list|(
specifier|const
name|isc_time_t
modifier|*
name|t
parameter_list|,
specifier|const
name|isc_interval_t
modifier|*
name|i
parameter_list|,
name|isc_time_t
modifier|*
name|result
parameter_list|)
block|{
name|ULARGE_INTEGER
name|i1
decl_stmt|;
name|REQUIRE
argument_list|(
name|t
operator|!=
name|NULL
operator|&&
name|i
operator|!=
name|NULL
operator|&&
name|result
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|i1
operator|.
name|LowPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwLowDateTime
expr_stmt|;
name|i1
operator|.
name|HighPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwHighDateTime
expr_stmt|;
if|if
condition|(
name|UINT64_MAX
operator|-
name|i1
operator|.
name|QuadPart
operator|<
operator|(
name|unsigned
name|__int64
operator|)
name|i
operator|->
name|interval
condition|)
return|return
operator|(
name|ISC_R_RANGE
operator|)
return|;
name|i1
operator|.
name|QuadPart
operator|+=
name|i
operator|->
name|interval
expr_stmt|;
name|result
operator|->
name|absolute
operator|.
name|dwLowDateTime
operator|=
name|i1
operator|.
name|LowPart
expr_stmt|;
name|result
operator|->
name|absolute
operator|.
name|dwHighDateTime
operator|=
name|i1
operator|.
name|HighPart
expr_stmt|;
return|return
operator|(
name|ISC_R_SUCCESS
operator|)
return|;
block|}
end_function

begin_function
name|isc_result_t
name|isc_time_subtract
parameter_list|(
specifier|const
name|isc_time_t
modifier|*
name|t
parameter_list|,
specifier|const
name|isc_interval_t
modifier|*
name|i
parameter_list|,
name|isc_time_t
modifier|*
name|result
parameter_list|)
block|{
name|ULARGE_INTEGER
name|i1
decl_stmt|;
name|REQUIRE
argument_list|(
name|t
operator|!=
name|NULL
operator|&&
name|i
operator|!=
name|NULL
operator|&&
name|result
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|i1
operator|.
name|LowPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwLowDateTime
expr_stmt|;
name|i1
operator|.
name|HighPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwHighDateTime
expr_stmt|;
if|if
condition|(
name|i1
operator|.
name|QuadPart
operator|<
operator|(
name|unsigned
name|__int64
operator|)
name|i
operator|->
name|interval
condition|)
return|return
operator|(
name|ISC_R_RANGE
operator|)
return|;
name|i1
operator|.
name|QuadPart
operator|-=
name|i
operator|->
name|interval
expr_stmt|;
name|result
operator|->
name|absolute
operator|.
name|dwLowDateTime
operator|=
name|i1
operator|.
name|LowPart
expr_stmt|;
name|result
operator|->
name|absolute
operator|.
name|dwHighDateTime
operator|=
name|i1
operator|.
name|HighPart
expr_stmt|;
return|return
operator|(
name|ISC_R_SUCCESS
operator|)
return|;
block|}
end_function

begin_function
name|isc_uint64_t
name|isc_time_microdiff
parameter_list|(
specifier|const
name|isc_time_t
modifier|*
name|t1
parameter_list|,
specifier|const
name|isc_time_t
modifier|*
name|t2
parameter_list|)
block|{
name|ULARGE_INTEGER
name|i1
decl_stmt|,
name|i2
decl_stmt|;
name|LONGLONG
name|i3
decl_stmt|;
name|REQUIRE
argument_list|(
name|t1
operator|!=
name|NULL
operator|&&
name|t2
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|i1
operator|.
name|LowPart
operator|=
name|t1
operator|->
name|absolute
operator|.
name|dwLowDateTime
expr_stmt|;
name|i1
operator|.
name|HighPart
operator|=
name|t1
operator|->
name|absolute
operator|.
name|dwHighDateTime
expr_stmt|;
name|i2
operator|.
name|LowPart
operator|=
name|t2
operator|->
name|absolute
operator|.
name|dwLowDateTime
expr_stmt|;
name|i2
operator|.
name|HighPart
operator|=
name|t2
operator|->
name|absolute
operator|.
name|dwHighDateTime
expr_stmt|;
if|if
condition|(
name|i1
operator|.
name|QuadPart
operator|<=
name|i2
operator|.
name|QuadPart
condition|)
return|return
operator|(
literal|0
operator|)
return|;
comment|/* 	 * Convert to microseconds. 	 */
name|i3
operator|=
operator|(
name|i1
operator|.
name|QuadPart
operator|-
name|i2
operator|.
name|QuadPart
operator|)
operator|/
literal|10
expr_stmt|;
return|return
operator|(
name|i3
operator|)
return|;
block|}
end_function

begin_function
name|isc_uint32_t
name|isc_time_seconds
parameter_list|(
specifier|const
name|isc_time_t
modifier|*
name|t
parameter_list|)
block|{
name|SYSTEMTIME
name|epoch
init|=
block|{
literal|1970
block|,
literal|1
block|,
literal|4
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|FILETIME
name|temp
decl_stmt|;
name|ULARGE_INTEGER
name|i1
decl_stmt|,
name|i2
decl_stmt|;
name|LONGLONG
name|i3
decl_stmt|;
name|SystemTimeToFileTime
argument_list|(
operator|&
name|epoch
argument_list|,
operator|&
name|temp
argument_list|)
expr_stmt|;
name|i1
operator|.
name|LowPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwLowDateTime
expr_stmt|;
name|i1
operator|.
name|HighPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwHighDateTime
expr_stmt|;
name|i2
operator|.
name|LowPart
operator|=
name|temp
operator|.
name|dwLowDateTime
expr_stmt|;
name|i2
operator|.
name|HighPart
operator|=
name|temp
operator|.
name|dwHighDateTime
expr_stmt|;
name|i3
operator|=
operator|(
name|i1
operator|.
name|QuadPart
operator|-
name|i2
operator|.
name|QuadPart
operator|)
operator|/
literal|10000000
expr_stmt|;
return|return
operator|(
operator|(
name|isc_uint32_t
operator|)
name|i3
operator|)
return|;
block|}
end_function

begin_function
name|isc_uint32_t
name|isc_time_nanoseconds
parameter_list|(
specifier|const
name|isc_time_t
modifier|*
name|t
parameter_list|)
block|{
name|ULARGE_INTEGER
name|i
decl_stmt|;
name|i
operator|.
name|LowPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwLowDateTime
expr_stmt|;
name|i
operator|.
name|HighPart
operator|=
name|t
operator|->
name|absolute
operator|.
name|dwHighDateTime
expr_stmt|;
return|return
operator|(
call|(
name|isc_uint32_t
call|)
argument_list|(
name|i
operator|.
name|QuadPart
operator|%
literal|10000000
argument_list|)
operator|*
literal|100
operator|)
return|;
block|}
end_function

begin_function
name|void
name|isc_time_formattimestamp
parameter_list|(
specifier|const
name|isc_time_t
modifier|*
name|t
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|FILETIME
name|localft
decl_stmt|;
name|SYSTEMTIME
name|st
decl_stmt|;
name|char
name|DateBuf
index|[
literal|50
index|]
decl_stmt|;
name|char
name|TimeBuf
index|[
literal|50
index|]
decl_stmt|;
specifier|static
specifier|const
name|char
name|badtime
index|[]
init|=
literal|"99-Bad-9999 99:99:99.999"
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|>
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|FileTimeToLocalFileTime
argument_list|(
operator|&
name|t
operator|->
name|absolute
argument_list|,
operator|&
name|localft
argument_list|)
operator|&&
name|FileTimeToSystemTime
argument_list|(
operator|&
name|localft
argument_list|,
operator|&
name|st
argument_list|)
condition|)
block|{
name|GetDateFormat
argument_list|(
name|LOCALE_USER_DEFAULT
argument_list|,
literal|0
argument_list|,
operator|&
name|st
argument_list|,
literal|"dd-MMM-yyyy"
argument_list|,
name|DateBuf
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|GetTimeFormat
argument_list|(
name|LOCALE_USER_DEFAULT
argument_list|,
name|TIME_NOTIMEMARKER
operator||
name|TIME_FORCE24HOURFORMAT
argument_list|,
operator|&
name|st
argument_list|,
name|NULL
argument_list|,
name|TimeBuf
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
literal|"%s %s.%03u"
argument_list|,
name|DateBuf
argument_list|,
name|TimeBuf
argument_list|,
name|st
operator|.
name|wMilliseconds
argument_list|)
expr_stmt|;
block|}
else|else
name|snprintf
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|badtime
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_time_formathttptimestamp
parameter_list|(
specifier|const
name|isc_time_t
modifier|*
name|t
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|SYSTEMTIME
name|st
decl_stmt|;
name|char
name|DateBuf
index|[
literal|50
index|]
decl_stmt|;
name|char
name|TimeBuf
index|[
literal|50
index|]
decl_stmt|;
comment|/* strftime() format: "%a, %d %b %Y %H:%M:%S GMT" */
name|REQUIRE
argument_list|(
name|len
operator|>
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|FileTimeToSystemTime
argument_list|(
operator|&
name|t
operator|->
name|absolute
argument_list|,
operator|&
name|st
argument_list|)
condition|)
block|{
name|GetDateFormat
argument_list|(
name|LOCALE_USER_DEFAULT
argument_list|,
literal|0
argument_list|,
operator|&
name|st
argument_list|,
literal|"ddd',', dd-MMM-yyyy"
argument_list|,
name|DateBuf
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|GetTimeFormat
argument_list|(
name|LOCALE_USER_DEFAULT
argument_list|,
name|TIME_NOTIMEMARKER
operator||
name|TIME_FORCE24HOURFORMAT
argument_list|,
operator|&
name|st
argument_list|,
literal|"hh':'mm':'ss"
argument_list|,
name|TimeBuf
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
literal|"%s %s GMT"
argument_list|,
name|DateBuf
argument_list|,
name|TimeBuf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|isc_time_formatISO8601
parameter_list|(
specifier|const
name|isc_time_t
modifier|*
name|t
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|SYSTEMTIME
name|st
decl_stmt|;
name|char
name|DateBuf
index|[
literal|50
index|]
decl_stmt|;
name|char
name|TimeBuf
index|[
literal|50
index|]
decl_stmt|;
comment|/* strtime() format: "%Y-%m-%dT%H:%M:%SZ" */
name|REQUIRE
argument_list|(
name|len
operator|>
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|FileTimeToSystemTime
argument_list|(
operator|&
name|t
operator|->
name|absolute
argument_list|,
operator|&
name|st
argument_list|)
condition|)
block|{
name|GetDateFormat
argument_list|(
name|LOCALE_NEUTRAL
argument_list|,
literal|0
argument_list|,
operator|&
name|st
argument_list|,
literal|"yyyy-MM-dd"
argument_list|,
name|DateBuf
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|GetTimeFormat
argument_list|(
name|LOCALE_NEUTRAL
argument_list|,
name|TIME_NOTIMEMARKER
operator||
name|TIME_FORCE24HOURFORMAT
argument_list|,
operator|&
name|st
argument_list|,
literal|"hh':'mm':'ss"
argument_list|,
name|TimeBuf
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
literal|"%s%sZ"
argument_list|,
name|DateBuf
argument_list|,
name|TimeBuf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

end_unit

