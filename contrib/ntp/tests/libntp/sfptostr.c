begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*   * This file contains test for both fptoa and fptoms (which uses dofptoa),  * since all these functions are very similar.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"ntp_fp.h"
end_include

begin_include
include|#
directive|include
file|"ntp_stdlib.h"
end_include

begin_include
include|#
directive|include
file|"unity.h"
end_include

begin_define
define|#
directive|define
name|SFP_MAX_PRECISION
value|6
end_define

begin_function_decl
name|void
name|setUp
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_PositiveInteger
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_NegativeInteger
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_PositiveIntegerPositiveFraction
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_NegativeIntegerNegativeFraction
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_PositiveIntegerNegativeFraction
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_NegativeIntegerPositiveFraction
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_SingleDecimalInteger
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_SingleDecimalRounding
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|setUp
parameter_list|(
name|void
parameter_list|)
block|{
name|init_lib
argument_list|()
expr_stmt|;
return|return;
block|}
end_function

begin_function
name|void
name|test_PositiveInteger
parameter_list|(
name|void
parameter_list|)
block|{
name|s_fp
name|test
init|=
literal|300
operator|<<
literal|16
decl_stmt|;
comment|// exact 300.000000
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"300.000000"
argument_list|,
name|fptoa
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"300000.000"
argument_list|,
name|fptoms
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_NegativeInteger
parameter_list|(
name|void
parameter_list|)
block|{
name|s_fp
name|test
init|=
operator|-
operator|(
literal|200
operator|<<
literal|16
operator|)
decl_stmt|;
comment|// exact -200.000000
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"-200.000000"
argument_list|,
name|fptoa
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"-200000.000"
argument_list|,
name|fptoms
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_PositiveIntegerPositiveFraction
parameter_list|(
name|void
parameter_list|)
block|{
name|s_fp
name|test
init|=
operator|(
literal|300
operator|<<
literal|16
operator|)
operator|+
operator|(
literal|1
operator|<<
literal|15
operator|)
decl_stmt|;
comment|// 300 + 0.5
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"300.500000"
argument_list|,
name|fptoa
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"300500.000"
argument_list|,
name|fptoms
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_NegativeIntegerNegativeFraction
parameter_list|(
name|void
parameter_list|)
block|{
name|s_fp
name|test
init|=
operator|-
operator|(
literal|200
operator|<<
literal|16
operator|)
operator|-
operator|(
literal|1
operator|<<
literal|15
operator|)
decl_stmt|;
comment|// -200 - 0.5
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"-200.500000"
argument_list|,
name|fptoa
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"-200500.000"
argument_list|,
name|fptoms
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_PositiveIntegerNegativeFraction
parameter_list|(
name|void
parameter_list|)
block|{
name|s_fp
name|test
init|=
operator|(
literal|300
operator|<<
literal|16
operator|)
operator|-
operator|(
literal|1
operator|<<
literal|14
operator|)
decl_stmt|;
comment|// 300 - 0.25
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"299.750000"
argument_list|,
name|fptoa
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"299750.000"
argument_list|,
name|fptoms
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_NegativeIntegerPositiveFraction
parameter_list|(
name|void
parameter_list|)
block|{
name|s_fp
name|test
init|=
operator|-
operator|(
literal|200
operator|<<
literal|16
operator|)
operator|+
operator|(
literal|1
operator|<<
literal|14
operator|)
operator|*
literal|3
decl_stmt|;
comment|// -200 + 0.75
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"-199.250000"
argument_list|,
name|fptoa
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"-199250.000"
argument_list|,
name|fptoms
argument_list|(
name|test
argument_list|,
name|SFP_MAX_PRECISION
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_SingleDecimalInteger
parameter_list|(
name|void
parameter_list|)
block|{
name|s_fp
name|test
init|=
literal|300
operator|<<
literal|16
decl_stmt|;
comment|// 300
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"300.0"
argument_list|,
name|fptoa
argument_list|(
name|test
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"300000.0"
argument_list|,
name|fptoms
argument_list|(
name|test
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_SingleDecimalRounding
parameter_list|(
name|void
parameter_list|)
block|{
name|s_fp
name|test
init|=
operator|(
literal|2
operator|<<
literal|16
operator|)
operator|+
operator|(
literal|1
operator|<<
literal|14
operator|)
operator|*
literal|3
decl_stmt|;
comment|// 2 + 0.25*3 = 2.75
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"2.8"
argument_list|,
name|fptoa
argument_list|(
name|test
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL_STRING
argument_list|(
literal|"2750.0"
argument_list|,
name|fptoms
argument_list|(
name|test
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

