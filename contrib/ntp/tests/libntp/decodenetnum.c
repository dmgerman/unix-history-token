begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"ntp_stdlib.h"
end_include

begin_include
include|#
directive|include
file|"sockaddrtest.h"
end_include

begin_include
include|#
directive|include
file|"unity.h"
end_include

begin_function_decl
name|void
name|setUp
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|test_IPv4AddressOnly
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|test_IPv4AddressWithPort
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|//#ifdef ISC_PLATFORM_HAVEIPV6
end_comment

begin_function_decl
specifier|extern
name|void
name|test_IPv6AddressOnly
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|test_IPv6AddressWithPort
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|//#endif /* ISC_PLATFORM_HAVEIPV6 */
end_comment

begin_function_decl
specifier|extern
name|void
name|test_IllegalAddress
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|test_IllegalCharInPort
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|setUp
parameter_list|(
name|void
parameter_list|)
block|{
name|init_lib
argument_list|()
expr_stmt|;
return|return;
block|}
end_function

begin_function
name|void
name|test_IPv4AddressOnly
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|str
init|=
literal|"192.0.2.1"
decl_stmt|;
name|sockaddr_u
name|actual
decl_stmt|;
name|sockaddr_u
name|expected
decl_stmt|;
name|expected
operator|.
name|sa4
operator|.
name|sin_family
operator|=
name|AF_INET
expr_stmt|;
name|expected
operator|.
name|sa4
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
name|inet_addr
argument_list|(
literal|"192.0.2.1"
argument_list|)
expr_stmt|;
name|SET_PORT
argument_list|(
operator|&
name|expected
argument_list|,
name|NTP_PORT
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|decodenetnum
argument_list|(
name|str
argument_list|,
operator|&
name|actual
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
name|actual
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_IPv4AddressWithPort
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|str
init|=
literal|"192.0.2.2:2000"
decl_stmt|;
name|sockaddr_u
name|actual
decl_stmt|;
name|sockaddr_u
name|expected
decl_stmt|;
name|expected
operator|.
name|sa4
operator|.
name|sin_family
operator|=
name|AF_INET
expr_stmt|;
name|expected
operator|.
name|sa4
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
name|inet_addr
argument_list|(
literal|"192.0.2.2"
argument_list|)
expr_stmt|;
name|SET_PORT
argument_list|(
operator|&
name|expected
argument_list|,
literal|2000
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|decodenetnum
argument_list|(
name|str
argument_list|,
operator|&
name|actual
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
name|actual
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_IPv6AddressOnly
parameter_list|(
name|void
parameter_list|)
block|{
comment|//#ifdef ISC_PLATFORM_HAVEIPV6 //looks like HAVEIPV6 checks if system has IPV6 capabilies. WANTIPV6 can be changed with build --disable-ipv6
ifdef|#
directive|ifdef
name|ISC_PLATFORM_WANTIPV6
specifier|const
name|struct
name|in6_addr
name|address
init|=
block|{
literal|0x20
block|,
literal|0x01
block|,
literal|0x0d
block|,
literal|0xb8
block|,
literal|0x85
block|,
literal|0xa3
block|,
literal|0x08
block|,
literal|0xd3
block|,
literal|0x13
block|,
literal|0x19
block|,
literal|0x8a
block|,
literal|0x2e
block|,
literal|0x03
block|,
literal|0x70
block|,
literal|0x73
block|,
literal|0x34
block|}
decl_stmt|;
specifier|const
name|char
modifier|*
name|str
init|=
literal|"2001:0db8:85a3:08d3:1319:8a2e:0370:7334"
decl_stmt|;
name|sockaddr_u
name|actual
decl_stmt|;
name|sockaddr_u
name|expected
decl_stmt|;
name|expected
operator|.
name|sa6
operator|.
name|sin6_family
operator|=
name|AF_INET6
expr_stmt|;
name|expected
operator|.
name|sa6
operator|.
name|sin6_addr
operator|=
name|address
expr_stmt|;
name|SET_PORT
argument_list|(
operator|&
name|expected
argument_list|,
name|NTP_PORT
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|decodenetnum
argument_list|(
name|str
argument_list|,
operator|&
name|actual
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
name|actual
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|TEST_IGNORE_MESSAGE
argument_list|(
literal|"IPV6 disabled in build, skipping."
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* ISC_PLATFORM_HAVEIPV6 */
block|}
end_function

begin_function
name|void
name|test_IPv6AddressWithPort
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|ISC_PLATFORM_WANTIPV6
specifier|const
name|struct
name|in6_addr
name|address
init|=
block|{
literal|0x20
block|,
literal|0x01
block|,
literal|0x0d
block|,
literal|0xb8
block|,
literal|0x85
block|,
literal|0xa3
block|,
literal|0x08
block|,
literal|0xd3
block|,
literal|0x13
block|,
literal|0x19
block|,
literal|0x8a
block|,
literal|0x2e
block|,
literal|0x03
block|,
literal|0x70
block|,
literal|0x73
block|,
literal|0x34
block|}
decl_stmt|;
specifier|const
name|char
modifier|*
name|str
init|=
literal|"[2001:0db8:85a3:08d3:1319:8a2e:0370:7334]:3000"
decl_stmt|;
name|sockaddr_u
name|actual
decl_stmt|;
name|sockaddr_u
name|expected
decl_stmt|;
name|expected
operator|.
name|sa6
operator|.
name|sin6_family
operator|=
name|AF_INET6
expr_stmt|;
name|expected
operator|.
name|sa6
operator|.
name|sin6_addr
operator|=
name|address
expr_stmt|;
name|SET_PORT
argument_list|(
operator|&
name|expected
argument_list|,
literal|3000
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|decodenetnum
argument_list|(
name|str
argument_list|,
operator|&
name|actual
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
name|actual
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|TEST_IGNORE_MESSAGE
argument_list|(
literal|"IPV6 disabled in build, skipping."
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* ISC_PLATFORM_HAVEIPV6 */
block|}
end_function

begin_function
name|void
name|test_IllegalAddress
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|str
init|=
literal|"192.0.2.270:2000"
decl_stmt|;
name|sockaddr_u
name|actual
decl_stmt|;
name|TEST_ASSERT_FALSE
argument_list|(
name|decodenetnum
argument_list|(
name|str
argument_list|,
operator|&
name|actual
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_IllegalCharInPort
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* An illegal port does not make the decodenetnum fail, but instead 	 * makes it use the standard port. 	 */
specifier|const
name|char
modifier|*
name|str
init|=
literal|"192.0.2.1:a700"
decl_stmt|;
name|sockaddr_u
name|actual
decl_stmt|;
name|sockaddr_u
name|expected
decl_stmt|;
name|expected
operator|.
name|sa4
operator|.
name|sin_family
operator|=
name|AF_INET
expr_stmt|;
name|expected
operator|.
name|sa4
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
name|inet_addr
argument_list|(
literal|"192.0.2.1"
argument_list|)
expr_stmt|;
name|SET_PORT
argument_list|(
operator|&
name|expected
argument_list|,
name|NTP_PORT
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|decodenetnum
argument_list|(
name|str
argument_list|,
operator|&
name|actual
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
name|actual
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

