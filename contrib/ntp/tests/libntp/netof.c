begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"ntp_stdlib.h"
end_include

begin_include
include|#
directive|include
file|"ntp_calendar.h"
end_include

begin_include
include|#
directive|include
file|"unity.h"
end_include

begin_include
include|#
directive|include
file|"sockaddrtest.h"
end_include

begin_function_decl
name|void
name|setUp
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_ClassBAddress
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_ClassCAddress
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_ClassAAddress
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_IPv6Address
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|setUp
parameter_list|(
name|void
parameter_list|)
block|{
name|init_lib
argument_list|()
expr_stmt|;
return|return;
block|}
end_function

begin_function
name|void
name|test_ClassBAddress
parameter_list|(
name|void
parameter_list|)
block|{
name|sockaddr_u
name|input
init|=
name|CreateSockaddr4
argument_list|(
literal|"172.16.2.1"
argument_list|,
name|NTP_PORT
argument_list|)
decl_stmt|;
name|sockaddr_u
name|expected
init|=
name|CreateSockaddr4
argument_list|(
literal|"172.16.0.0"
argument_list|,
name|NTP_PORT
argument_list|)
decl_stmt|;
name|sockaddr_u
modifier|*
name|actual
init|=
name|netof
argument_list|(
operator|&
name|input
argument_list|)
decl_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|actual
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
operator|*
name|actual
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
name|void
name|test_ClassCAddress
parameter_list|(
name|void
parameter_list|)
block|{
name|sockaddr_u
name|input
init|=
name|CreateSockaddr4
argument_list|(
literal|"192.0.2.255"
argument_list|,
name|NTP_PORT
argument_list|)
decl_stmt|;
name|sockaddr_u
name|expected
init|=
name|CreateSockaddr4
argument_list|(
literal|"192.0.2.0"
argument_list|,
name|NTP_PORT
argument_list|)
decl_stmt|;
name|sockaddr_u
modifier|*
name|actual
init|=
name|netof
argument_list|(
operator|&
name|input
argument_list|)
decl_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|actual
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
operator|*
name|actual
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
name|void
name|test_ClassAAddress
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* Class A addresses are assumed to be classless, 	 * thus the same address should be returned. 	 */
name|sockaddr_u
name|input
init|=
name|CreateSockaddr4
argument_list|(
literal|"10.20.30.40"
argument_list|,
name|NTP_PORT
argument_list|)
decl_stmt|;
name|sockaddr_u
name|expected
init|=
name|CreateSockaddr4
argument_list|(
literal|"10.20.30.40"
argument_list|,
name|NTP_PORT
argument_list|)
decl_stmt|;
name|sockaddr_u
modifier|*
name|actual
init|=
name|netof
argument_list|(
operator|&
name|input
argument_list|)
decl_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|actual
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
operator|*
name|actual
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
name|void
name|test_IPv6Address
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* IPv6 addresses are assumed to have 64-bit host- and 64-bit network parts. */
specifier|const
name|struct
name|in6_addr
name|input_address
init|=
block|{
block|{
block|{
literal|0x20
block|,
literal|0x01
block|,
literal|0x0d
block|,
literal|0xb8
block|,
literal|0x85
block|,
literal|0xa3
block|,
literal|0x08
block|,
literal|0xd3
block|,
literal|0x13
block|,
literal|0x19
block|,
literal|0x8a
block|,
literal|0x2e
block|,
literal|0x03
block|,
literal|0x70
block|,
literal|0x73
block|,
literal|0x34
block|}
block|}
block|}
decl_stmt|;
comment|// 2001:0db8:85a3:08d3:1319:8a2e:0370:7334
specifier|const
name|struct
name|in6_addr
name|expected_address
init|=
block|{
block|{
block|{
literal|0x20
block|,
literal|0x01
block|,
literal|0x0d
block|,
literal|0xb8
block|,
literal|0x85
block|,
literal|0xa3
block|,
literal|0x08
block|,
literal|0xd3
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|}
block|}
block|}
decl_stmt|;
comment|// 2001:0db8:85a3:08d3:0000:0000:0000:0000
name|sockaddr_u
name|input
decl_stmt|;
name|input
operator|.
name|sa6
operator|.
name|sin6_family
operator|=
name|AF_INET6
expr_stmt|;
name|input
operator|.
name|sa6
operator|.
name|sin6_addr
operator|=
name|input_address
expr_stmt|;
name|SET_PORT
argument_list|(
operator|&
name|input
argument_list|,
literal|3000
argument_list|)
expr_stmt|;
name|sockaddr_u
name|expected
decl_stmt|;
name|expected
operator|.
name|sa6
operator|.
name|sin6_family
operator|=
name|AF_INET6
expr_stmt|;
name|expected
operator|.
name|sa6
operator|.
name|sin6_addr
operator|=
name|expected_address
expr_stmt|;
name|SET_PORT
argument_list|(
operator|&
name|expected
argument_list|,
literal|3000
argument_list|)
expr_stmt|;
name|sockaddr_u
modifier|*
name|actual
init|=
name|netof
argument_list|(
operator|&
name|input
argument_list|)
decl_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|actual
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
operator|*
name|actual
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

end_unit

