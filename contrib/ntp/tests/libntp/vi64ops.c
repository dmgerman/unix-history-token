begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"ntp_stdlib.h"
end_include

begin_include
include|#
directive|include
file|"vint64ops.h"
end_include

begin_include
include|#
directive|include
file|"unity.h"
end_include

begin_function_decl
name|int
name|IsEqual
parameter_list|(
specifier|const
name|vint64
name|expected
parameter_list|,
specifier|const
name|vint64
name|actual
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_ParseVUI64_pos
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_ParseVUI64_neg
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_ParseVUI64_case
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|// technically bool
end_comment

begin_function
name|int
name|IsEqual
parameter_list|(
specifier|const
name|vint64
name|expected
parameter_list|,
specifier|const
name|vint64
name|actual
parameter_list|)
block|{
if|if
condition|(
literal|0
operator|==
name|memcmp
argument_list|(
operator|&
name|expected
argument_list|,
operator|&
name|actual
argument_list|,
sizeof|sizeof
argument_list|(
name|vint64
argument_list|)
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"%x."
argument_list|,
name|expected
operator|.
name|D_s
operator|.
name|hi
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%x"
argument_list|,
name|expected
operator|.
name|D_s
operator|.
name|lo
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" but was "
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%x."
argument_list|,
name|actual
operator|.
name|D_s
operator|.
name|hi
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%x\n"
argument_list|,
name|actual
operator|.
name|D_s
operator|.
name|lo
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"expected: "
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%d."
argument_list|,
name|expected
operator|.
name|D_s
operator|.
name|hi
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%d"
argument_list|,
name|expected
operator|.
name|D_s
operator|.
name|lo
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" but was "
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%d"
argument_list|,
name|actual
operator|.
name|D_s
operator|.
name|lo
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%d"
argument_list|,
name|actual
operator|.
name|D_s
operator|.
name|lo
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
block|}
end_function

begin_comment
comment|// ----------------------------------------------------------------------
end_comment

begin_comment
comment|// test number parser
end_comment

begin_function
name|void
name|test_ParseVUI64_pos
parameter_list|(
name|void
parameter_list|)
block|{
name|vint64
name|act
decl_stmt|,
name|exp
decl_stmt|;
specifier|const
name|char
modifier|*
name|sp
decl_stmt|;
name|char
modifier|*
name|ep
decl_stmt|;
name|sp
operator|=
literal|"1234x"
expr_stmt|;
name|exp
operator|.
name|D_s
operator|.
name|hi
operator|=
literal|0
expr_stmt|;
name|exp
operator|.
name|D_s
operator|.
name|lo
operator|=
literal|1234
expr_stmt|;
name|act
operator|=
name|strtouv64
argument_list|(
name|sp
argument_list|,
operator|&
name|ep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|exp
argument_list|,
name|act
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL
argument_list|(
operator|*
name|ep
argument_list|,
literal|'x'
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_ParseVUI64_neg
parameter_list|(
name|void
parameter_list|)
block|{
name|vint64
name|act
decl_stmt|,
name|exp
decl_stmt|;
specifier|const
name|char
modifier|*
name|sp
decl_stmt|;
name|char
modifier|*
name|ep
decl_stmt|;
name|sp
operator|=
literal|"-1234x"
expr_stmt|;
name|exp
operator|.
name|D_s
operator|.
name|hi
operator|=
operator|~
literal|0
expr_stmt|;
name|exp
operator|.
name|D_s
operator|.
name|lo
operator|=
operator|-
literal|1234
expr_stmt|;
name|act
operator|=
name|strtouv64
argument_list|(
name|sp
argument_list|,
operator|&
name|ep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|exp
argument_list|,
name|act
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL
argument_list|(
operator|*
name|ep
argument_list|,
literal|'x'
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_ParseVUI64_case
parameter_list|(
name|void
parameter_list|)
block|{
name|vint64
name|act
decl_stmt|,
name|exp
decl_stmt|;
specifier|const
name|char
modifier|*
name|sp
decl_stmt|;
name|char
modifier|*
name|ep
decl_stmt|;
name|sp
operator|=
literal|"0123456789AbCdEf"
expr_stmt|;
name|exp
operator|.
name|D_s
operator|.
name|hi
operator|=
literal|0x01234567
expr_stmt|;
name|exp
operator|.
name|D_s
operator|.
name|lo
operator|=
literal|0x89ABCDEF
expr_stmt|;
name|act
operator|=
name|strtouv64
argument_list|(
name|sp
argument_list|,
operator|&
name|ep
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|exp
argument_list|,
name|act
argument_list|)
argument_list|)
expr_stmt|;
name|TEST_ASSERT_EQUAL
argument_list|(
operator|*
name|ep
argument_list|,
literal|'\0'
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

