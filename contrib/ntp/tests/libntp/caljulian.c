begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"ntp_calendar.h"
end_include

begin_include
include|#
directive|include
file|"ntp_stdlib.h"
end_include

begin_include
include|#
directive|include
file|"unity.h"
end_include

begin_include
include|#
directive|include
file|"test-libntp.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_function_decl
name|char
modifier|*
name|CalendarToString
parameter_list|(
specifier|const
name|struct
name|calendar
name|cal
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|IsEqual
parameter_list|(
specifier|const
name|struct
name|calendar
name|expected
parameter_list|,
specifier|const
name|struct
name|calendar
name|actual
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|setUp
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|tearDown
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_RegularTime
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_LeapYear
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_uLongBoundary
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|test_uLongWrapped
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|char
modifier|*
name|CalendarToString
parameter_list|(
specifier|const
name|struct
name|calendar
name|cal
parameter_list|)
block|{
name|char
modifier|*
name|str
init|=
name|emalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|char
argument_list|)
operator|*
literal|100
argument_list|)
decl_stmt|;
name|char
name|buffer
index|[
literal|100
index|]
init|=
literal|""
decl_stmt|;
name|snprintf
argument_list|(
name|buffer
argument_list|,
literal|100
argument_list|,
literal|"%u"
argument_list|,
name|cal
operator|.
name|year
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
literal|"-"
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|buffer
argument_list|,
literal|100
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|u_int
operator|)
name|cal
operator|.
name|month
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
literal|"-"
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|buffer
argument_list|,
literal|100
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|u_int
operator|)
name|cal
operator|.
name|monthday
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
literal|" ("
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|buffer
argument_list|,
literal|100
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|u_int
operator|)
name|cal
operator|.
name|yearday
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
literal|") "
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|buffer
argument_list|,
literal|100
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|u_int
operator|)
name|cal
operator|.
name|hour
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|buffer
argument_list|,
literal|100
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|u_int
operator|)
name|cal
operator|.
name|minute
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|buffer
argument_list|,
literal|100
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|u_int
operator|)
name|cal
operator|.
name|second
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|str
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
name|int
comment|// technically boolean
name|IsEqual
parameter_list|(
specifier|const
name|struct
name|calendar
name|expected
parameter_list|,
specifier|const
name|struct
name|calendar
name|actual
parameter_list|)
block|{
if|if
condition|(
name|expected
operator|.
name|year
operator|==
name|actual
operator|.
name|year
operator|&&
operator|(
name|expected
operator|.
name|yearday
operator|==
name|actual
operator|.
name|yearday
operator|||
operator|(
name|expected
operator|.
name|month
operator|==
name|actual
operator|.
name|month
operator|&&
name|expected
operator|.
name|monthday
operator|==
name|actual
operator|.
name|monthday
operator|)
operator|)
operator|&&
name|expected
operator|.
name|hour
operator|==
name|actual
operator|.
name|hour
operator|&&
name|expected
operator|.
name|minute
operator|==
name|actual
operator|.
name|minute
operator|&&
name|expected
operator|.
name|second
operator|==
name|actual
operator|.
name|second
condition|)
block|{
return|return
name|TRUE
return|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"expected: %s but was %s"
argument_list|,
name|CalendarToString
argument_list|(
name|expected
argument_list|)
argument_list|,
name|CalendarToString
argument_list|(
name|actual
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
block|}
end_function

begin_function
name|void
name|setUp
parameter_list|()
block|{
name|ntpcal_set_timefunc
argument_list|(
name|timefunc
argument_list|)
expr_stmt|;
name|settime
argument_list|(
literal|1970
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|tearDown
parameter_list|()
block|{
name|ntpcal_set_timefunc
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_RegularTime
parameter_list|(
name|void
parameter_list|)
block|{
name|u_long
name|testDate
init|=
literal|3485080800UL
decl_stmt|;
comment|// 2010-06-09 14:00:00
name|struct
name|calendar
name|expected
init|=
block|{
literal|2010
block|,
literal|160
block|,
literal|6
block|,
literal|9
block|,
literal|14
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|struct
name|calendar
name|actual
decl_stmt|;
name|caljulian
argument_list|(
name|testDate
argument_list|,
operator|&
name|actual
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
name|actual
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_LeapYear
parameter_list|(
name|void
parameter_list|)
block|{
name|u_long
name|input
init|=
literal|3549902400UL
decl_stmt|;
comment|// 2012-06-28 20:00:00Z
name|struct
name|calendar
name|expected
init|=
block|{
literal|2012
block|,
literal|179
block|,
literal|6
block|,
literal|28
block|,
literal|20
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|struct
name|calendar
name|actual
decl_stmt|;
name|caljulian
argument_list|(
name|input
argument_list|,
operator|&
name|actual
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
name|actual
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_uLongBoundary
parameter_list|(
name|void
parameter_list|)
block|{
name|u_long
name|time
init|=
literal|4294967295UL
decl_stmt|;
comment|// 2036-02-07 6:28:15
name|struct
name|calendar
name|expected
init|=
block|{
literal|2036
block|,
literal|0
block|,
literal|2
block|,
literal|7
block|,
literal|6
block|,
literal|28
block|,
literal|15
block|}
decl_stmt|;
name|struct
name|calendar
name|actual
decl_stmt|;
name|caljulian
argument_list|(
name|time
argument_list|,
operator|&
name|actual
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
name|actual
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_uLongWrapped
parameter_list|(
name|void
parameter_list|)
block|{
name|u_long
name|time
init|=
literal|0
decl_stmt|;
name|struct
name|calendar
name|expected
init|=
block|{
literal|2036
block|,
literal|0
block|,
literal|2
block|,
literal|7
block|,
literal|6
block|,
literal|28
block|,
literal|16
block|}
decl_stmt|;
name|struct
name|calendar
name|actual
decl_stmt|;
name|caljulian
argument_list|(
name|time
argument_list|,
operator|&
name|actual
argument_list|)
expr_stmt|;
name|TEST_ASSERT_TRUE
argument_list|(
name|IsEqual
argument_list|(
name|expected
argument_list|,
name|actual
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

