begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $Id: refclock_ripencc.c,v 1.13 2002/06/18 14:20:55 marks Exp marks $  *  * Copyright (c) 2002  RIPE NCC  *  * All Rights Reserved  *  * Permission to use, copy, modify, and distribute this software and its  * documentation for any purpose and without fee is hereby granted,  * provided that the above copyright notice appear in all copies and that  * both that copyright notice and this permission notice appear in  * supporting documentation, and that the name of the author not be  * used in advertising or publicity pertaining to distribution of the  * software without specific, written prior permission.  *  * THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING  * ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS; IN NO EVENT SHALL  * AUTHOR BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY  * DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN  * AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  *  *  *  * This driver was developed for use with the RIPE NCC TTM project.  *  *  * The initial driver was developed by Daniel Karrenberg<dfk@ripe.net>   * using the code made available by Trimble. This was for xntpd-3.x.x  *  * Rewrite of the driver for ntpd-4.x.x by Mark Santcroos<marks@ripe.net>  *  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|<config.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_CONFIG_H */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|REFCLOCK
argument_list|)
operator|&&
name|defined
argument_list|(
name|CLOCK_RIPENCC
argument_list|)
end_if

begin_include
include|#
directive|include
file|"ntp_stdlib.h"
end_include

begin_include
include|#
directive|include
file|"ntpd.h"
end_include

begin_include
include|#
directive|include
file|"ntp_refclock.h"
end_include

begin_include
include|#
directive|include
file|"ntp_unixtime.h"
end_include

begin_include
include|#
directive|include
file|"ntp_io.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_TIMEPPS_H
end_ifdef

begin_include
include|#
directive|include
file|<timepps.h>
end_include

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* HAVE_TIMEPPS_H */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SYS_TIMEPPS_H
end_ifdef

begin_include
include|#
directive|include
file|<sys/timepps.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_SYS_TIMEPPS_H */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_TIMEPPS_H */
end_comment

begin_comment
comment|/*  * Definitions  */
end_comment

begin_comment
comment|/* we are on little endian */
end_comment

begin_define
define|#
directive|define
name|BYTESWAP
end_define

begin_comment
comment|/*   * DEBUG statements: uncomment if necessary  */
end_comment

begin_comment
comment|/* #define DEBUG_NCC */
end_comment

begin_comment
comment|/* general debug statements */
end_comment

begin_comment
comment|/* #define DEBUG_PPS */
end_comment

begin_comment
comment|/* debug pps */
end_comment

begin_comment
comment|/* #define DEBUG_RAW */
end_comment

begin_comment
comment|/* print raw packets */
end_comment

begin_define
define|#
directive|define
name|TRIMBLE_OUTPUT_FUNC
end_define

begin_define
define|#
directive|define
name|TSIP_VERNUM
value|"7.12a"
end_define

begin_ifndef
ifndef|#
directive|ifndef
name|FALSE
end_ifndef

begin_define
define|#
directive|define
name|FALSE
value|(0)
end_define

begin_define
define|#
directive|define
name|TRUE
value|(!FALSE)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* FALSE */
end_comment

begin_define
define|#
directive|define
name|GPS_PI
value|(3.1415926535898)
end_define

begin_define
define|#
directive|define
name|GPS_C
value|(299792458.)
end_define

begin_define
define|#
directive|define
name|D2R
value|(GPS_PI/180.0)
end_define

begin_define
define|#
directive|define
name|R2D
value|(180.0/GPS_PI)
end_define

begin_define
define|#
directive|define
name|WEEK
value|(604800.)
end_define

begin_define
define|#
directive|define
name|MAXCHAN
value|(8)
end_define

begin_comment
comment|/* control characters for TSIP packets */
end_comment

begin_define
define|#
directive|define
name|DLE
value|(0x10)
end_define

begin_define
define|#
directive|define
name|ETX
value|(0x03)
end_define

begin_define
define|#
directive|define
name|MAX_RPTBUF
value|(256)
end_define

begin_comment
comment|/* values of TSIPPKT.status */
end_comment

begin_define
define|#
directive|define
name|TSIP_PARSED_EMPTY
value|0
end_define

begin_define
define|#
directive|define
name|TSIP_PARSED_FULL
value|1
end_define

begin_define
define|#
directive|define
name|TSIP_PARSED_DLE_1
value|2
end_define

begin_define
define|#
directive|define
name|TSIP_PARSED_DATA
value|3
end_define

begin_define
define|#
directive|define
name|TSIP_PARSED_DLE_2
value|4
end_define

begin_define
define|#
directive|define
name|UTCF_UTC_AVAIL
value|(unsigned char) (1)
end_define

begin_comment
comment|/* UTC available */
end_comment

begin_define
define|#
directive|define
name|UTCF_LEAP_SCHD
value|(unsigned char) (1<<4)
end_define

begin_comment
comment|/* Leap scheduled */
end_comment

begin_define
define|#
directive|define
name|UTCF_LEAP_PNDG
value|(unsigned char) (1<<5)
end_define

begin_comment
comment|/* Leap pending, will occur at end of day */
end_comment

begin_define
define|#
directive|define
name|DEVICE
value|"/dev/gps%d"
end_define

begin_comment
comment|/* name of radio device */
end_comment

begin_define
define|#
directive|define
name|PRECISION
value|(-9)
end_define

begin_comment
comment|/* precision assumed (about 2 ms) */
end_comment

begin_define
define|#
directive|define
name|PPS_PRECISION
value|(-20)
end_define

begin_comment
comment|/* precision assumed (about 1 us) */
end_comment

begin_define
define|#
directive|define
name|REFID
value|"GPS\0"
end_define

begin_comment
comment|/* reference id */
end_comment

begin_define
define|#
directive|define
name|REFID_LEN
value|4
end_define

begin_define
define|#
directive|define
name|DESCRIPTION
value|"RIPE NCC GPS (Palisade)"
end_define

begin_comment
comment|/* Description */
end_comment

begin_define
define|#
directive|define
name|SPEED232
value|B9600
end_define

begin_comment
comment|/* 9600 baud */
end_comment

begin_define
define|#
directive|define
name|NSAMPLES
value|3
end_define

begin_comment
comment|/* stages of median filter */
end_comment

begin_comment
comment|/* Structures */
end_comment

begin_comment
comment|/* TSIP packets have the following structure, whether report or command. */
end_comment

begin_typedef
typedef|typedef
struct|struct
block|{
name|short
name|counter
decl_stmt|,
comment|/* counter */
name|len
decl_stmt|;
comment|/* size of buf;< MAX_RPTBUF unsigned chars */
name|unsigned
name|char
name|status
decl_stmt|,
comment|/* TSIP packet format/parse status */
name|code
decl_stmt|,
comment|/* TSIP code */
name|buf
index|[
name|MAX_RPTBUF
index|]
decl_stmt|;
comment|/* report or command string */
block|}
name|TSIPPKT
typedef|;
end_typedef

begin_comment
comment|/* TSIP binary data structures */
end_comment

begin_typedef
typedef|typedef
struct|struct
block|{
name|unsigned
name|char
name|t_oa_raw
decl_stmt|,
name|SV_health
decl_stmt|;
name|float
name|e
decl_stmt|,
name|t_oa
decl_stmt|,
name|i_0
decl_stmt|,
name|OMEGADOT
decl_stmt|,
name|sqrt_A
decl_stmt|,
name|OMEGA_0
decl_stmt|,
name|omega
decl_stmt|,
name|M_0
decl_stmt|,
name|a_f0
decl_stmt|,
name|a_f1
decl_stmt|,
name|Axis
decl_stmt|,
name|n
decl_stmt|,
name|OMEGA_n
decl_stmt|,
name|ODOT_n
decl_stmt|,
name|t_zc
decl_stmt|;
name|short
name|weeknum
decl_stmt|,
name|wn_oa
decl_stmt|;
block|}
name|ALM_INFO
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
block|{
comment|/*  Almanac health page (25) parameters  */
name|unsigned
name|char
name|WN_a
decl_stmt|,
name|SV_health
index|[
literal|32
index|]
decl_stmt|,
name|t_oa
decl_stmt|;
block|}
name|ALH_PARMS
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
block|{
comment|/*  Universal Coordinated Time (UTC) parms */
name|double
name|A_0
decl_stmt|;
name|float
name|A_1
decl_stmt|;
name|short
name|delta_t_LS
decl_stmt|;
name|float
name|t_ot
decl_stmt|;
name|short
name|WN_t
decl_stmt|,
name|WN_LSF
decl_stmt|,
name|DN
decl_stmt|,
name|delta_t_LSF
decl_stmt|;
block|}
name|UTC_INFO
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
block|{
comment|/*  Ionospheric info (float)  */
name|float
name|alpha_0
decl_stmt|,
name|alpha_1
decl_stmt|,
name|alpha_2
decl_stmt|,
name|alpha_3
decl_stmt|,
name|beta_0
decl_stmt|,
name|beta_1
decl_stmt|,
name|beta_2
decl_stmt|,
name|beta_3
decl_stmt|;
block|}
name|ION_INFO
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
block|{
comment|/*  Subframe 1 info (float)  */
name|short
name|weeknum
decl_stmt|;
name|unsigned
name|char
name|codeL2
decl_stmt|,
name|L2Pdata
decl_stmt|,
name|SVacc_raw
decl_stmt|,
name|SV_health
decl_stmt|;
name|short
name|IODC
decl_stmt|;
name|float
name|T_GD
decl_stmt|,
name|t_oc
decl_stmt|,
name|a_f2
decl_stmt|,
name|a_f1
decl_stmt|,
name|a_f0
decl_stmt|,
name|SVacc
decl_stmt|;
block|}
name|EPHEM_CLOCK
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
block|{
comment|/*  Ephemeris info (float)  */
name|unsigned
name|char
name|IODE
decl_stmt|,
name|fit_interval
decl_stmt|;
name|float
name|C_rs
decl_stmt|,
name|delta_n
decl_stmt|;
name|double
name|M_0
decl_stmt|;
name|float
name|C_uc
decl_stmt|;
name|double
name|e
decl_stmt|;
name|float
name|C_us
decl_stmt|;
name|double
name|sqrt_A
decl_stmt|;
name|float
name|t_oe
decl_stmt|,
name|C_ic
decl_stmt|;
name|double
name|OMEGA_0
decl_stmt|;
name|float
name|C_is
decl_stmt|;
name|double
name|i_0
decl_stmt|;
name|float
name|C_rc
decl_stmt|;
name|double
name|omega
decl_stmt|;
name|float
name|OMEGADOT
decl_stmt|,
name|IDOT
decl_stmt|;
name|double
name|Axis
decl_stmt|,
name|n
decl_stmt|,
name|r1me2
decl_stmt|,
name|OMEGA_n
decl_stmt|,
name|ODOT_n
decl_stmt|;
block|}
name|EPHEM_ORBIT
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
block|{
comment|/* Navigation data structure */
name|short
name|sv_number
decl_stmt|;
comment|/* SV number (0 = no entry) */
name|float
name|t_ephem
decl_stmt|;
comment|/* time of ephemeris collection */
name|EPHEM_CLOCK
name|ephclk
decl_stmt|;
comment|/* subframe 1 data */
name|EPHEM_ORBIT
name|ephorb
decl_stmt|;
comment|/* ephemeris data */
block|}
name|NAV_INFO
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
block|{
name|unsigned
name|char
name|bSubcode
decl_stmt|,
name|operating_mode
decl_stmt|,
name|dgps_mode
decl_stmt|,
name|dyn_code
decl_stmt|,
name|trackmode
decl_stmt|;
name|float
name|elev_mask
decl_stmt|,
name|cno_mask
decl_stmt|,
name|dop_mask
decl_stmt|,
name|dop_switch
decl_stmt|;
name|unsigned
name|char
name|dgps_age_limit
decl_stmt|;
block|}
name|TSIP_RCVR_CFG
typedef|;
end_typedef

begin_ifdef
ifdef|#
directive|ifdef
name|TRIMBLE_OUTPUT_FUNC
end_ifdef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|dayname
index|[
literal|7
index|]
init|=
block|{
literal|"Sun"
block|,
literal|"Mon"
block|,
literal|"Tue"
block|,
literal|"Wed"
block|,
literal|"Thu"
block|,
literal|"Fri"
block|,
literal|"Sat"
block|}
decl_stmt|,
name|old_baudnum
index|[]
init|=
block|{
literal|0
block|,
literal|1
block|,
literal|4
block|,
literal|5
block|,
literal|6
block|,
literal|8
block|,
literal|9
block|,
literal|11
block|,
literal|28
block|,
literal|12
block|}
decl_stmt|,
modifier|*
name|st_baud_text_app
index|[]
init|=
block|{
literal|""
block|,
literal|""
block|,
literal|"  300"
block|,
literal|"  600"
block|,
literal|" 1200"
block|,
literal|" 2400"
block|,
literal|" 4800"
block|,
literal|" 9600"
block|,
literal|"19200"
block|,
literal|"38400"
block|}
decl_stmt|,
modifier|*
name|old_parity_text
index|[]
init|=
block|{
literal|"EVEN"
block|,
literal|"ODD"
block|,
literal|""
block|,
literal|""
block|,
literal|"NONE"
block|}
decl_stmt|,
modifier|*
name|parity_text
index|[]
init|=
block|{
literal|"NONE"
block|,
literal|"ODD"
block|,
literal|"EVEN"
block|}
decl_stmt|,
modifier|*
name|old_input_ch
index|[]
init|=
block|{
literal|"TSIP"
block|,
literal|"RTCM (6 of 8 bits)"
block|}
decl_stmt|,
modifier|*
name|old_output_ch
index|[]
init|=
block|{
literal|"TSIP"
block|,
literal|"No output"
block|,
literal|""
block|,
literal|""
block|,
literal|""
block|,
literal|"NMEA 0183"
block|}
decl_stmt|,
modifier|*
name|protocols_in_text
index|[]
init|=
block|{
literal|""
block|,
literal|"TSIP"
block|,
literal|""
block|,
literal|""
block|}
decl_stmt|,
modifier|*
name|protocols_out_text
index|[]
init|=
block|{
literal|""
block|,
literal|"TSIP"
block|,
literal|"NMEA"
block|}
decl_stmt|,
modifier|*
name|rcvr_port_text
index|[]
init|=
block|{
literal|"Port A      "
block|,
literal|"Port B      "
block|,
literal|"Current Port"
block|}
decl_stmt|,
modifier|*
name|dyn_text
index|[]
init|=
block|{
literal|"Unchanged"
block|,
literal|"Land"
block|,
literal|"Sea"
block|,
literal|"Air"
block|,
literal|"Static"
block|}
decl_stmt|,
modifier|*
name|NavModeText0xBB
index|[]
init|=
block|{
literal|"automatic"
block|,
literal|"time only (0-D)"
block|,
literal|""
block|,
literal|"2-D"
block|,
literal|"3-D"
block|,
literal|""
block|,
literal|""
block|,
literal|"OverDetermined Time"
block|}
decl_stmt|,
modifier|*
name|PPSTimeBaseText
index|[]
init|=
block|{
literal|"GPS"
block|,
literal|"UTC"
block|,
literal|"USER"
block|}
decl_stmt|,
modifier|*
name|PPSPolarityText
index|[]
init|=
block|{
literal|"Positive"
block|,
literal|"Negative"
block|}
decl_stmt|,
modifier|*
name|MaskText
index|[]
init|=
block|{
literal|"Almanac  "
block|,
literal|"Ephemeris"
block|,
literal|"UTC      "
block|,
literal|"Iono     "
block|,
literal|"GPS Msg  "
block|,
literal|"Alm Hlth "
block|,
literal|"Time Fix "
block|,
literal|"SV Select"
block|,
literal|"Ext Event"
block|,
literal|"Pos Fix  "
block|,
literal|"Raw Meas "
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* TRIMBLE_OUTPUT_FUNC */
end_comment

begin_comment
comment|/*  * Unit control structure  */
end_comment

begin_struct
struct|struct
name|ripencc_unit
block|{
name|int
name|unit
decl_stmt|;
comment|/* unit number */
name|int
name|pollcnt
decl_stmt|;
comment|/* poll message counter */
name|int
name|polled
decl_stmt|;
comment|/* Hand in a sample? */
name|char
name|leapdelta
decl_stmt|;
comment|/* delta of next leap event */
name|unsigned
name|char
name|utcflags
decl_stmt|;
comment|/* delta of next leap event */
name|l_fp
name|tstamp
decl_stmt|;
comment|/* timestamp of last poll */
name|struct
name|timespec
name|ts
decl_stmt|;
comment|/* last timestamp */
name|pps_params_t
name|pps_params
decl_stmt|;
comment|/* pps parameters */
name|pps_info_t
name|pps_info
decl_stmt|;
comment|/* last pps data */
name|pps_handle_t
name|handle
decl_stmt|;
comment|/* pps handlebars */
block|}
struct|;
end_struct

begin_comment
comment|/*******************        PROTOYPES            *****************/
end_comment

begin_comment
comment|/*  prototypes for report parsing primitives */
end_comment

begin_function_decl
name|short
name|rpt_0x3D
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|tx_baud_index
parameter_list|,
name|unsigned
name|char
modifier|*
name|rx_baud_index
parameter_list|,
name|unsigned
name|char
modifier|*
name|char_format_index
parameter_list|,
name|unsigned
name|char
modifier|*
name|stop_bits
parameter_list|,
name|unsigned
name|char
modifier|*
name|tx_mode_index
parameter_list|,
name|unsigned
name|char
modifier|*
name|rx_mode_index
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x40
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|short
modifier|*
name|week_num
parameter_list|,
name|float
modifier|*
name|t_zc
parameter_list|,
name|float
modifier|*
name|eccentricity
parameter_list|,
name|float
modifier|*
name|t_oa
parameter_list|,
name|float
modifier|*
name|i_0
parameter_list|,
name|float
modifier|*
name|OMEGA_dot
parameter_list|,
name|float
modifier|*
name|sqrt_A
parameter_list|,
name|float
modifier|*
name|OMEGA_0
parameter_list|,
name|float
modifier|*
name|omega
parameter_list|,
name|float
modifier|*
name|M_0
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x41
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
modifier|*
name|time_of_week
parameter_list|,
name|float
modifier|*
name|UTC_offset
parameter_list|,
name|short
modifier|*
name|week_num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x42
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
name|ECEF_pos
index|[
literal|3
index|]
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x43
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
name|ECEF_vel
index|[
literal|3
index|]
parameter_list|,
name|float
modifier|*
name|freq_offset
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x45
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|major_nav_version
parameter_list|,
name|unsigned
name|char
modifier|*
name|minor_nav_version
parameter_list|,
name|unsigned
name|char
modifier|*
name|nav_day
parameter_list|,
name|unsigned
name|char
modifier|*
name|nav_month
parameter_list|,
name|unsigned
name|char
modifier|*
name|nav_year
parameter_list|,
name|unsigned
name|char
modifier|*
name|major_dsp_version
parameter_list|,
name|unsigned
name|char
modifier|*
name|minor_dsp_version
parameter_list|,
name|unsigned
name|char
modifier|*
name|dsp_day
parameter_list|,
name|unsigned
name|char
modifier|*
name|dsp_month
parameter_list|,
name|unsigned
name|char
modifier|*
name|dsp_year
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x46
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|status1
parameter_list|,
name|unsigned
name|char
modifier|*
name|status2
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x47
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|nsvs
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|float
modifier|*
name|snr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x48
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|message
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x49
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_health
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x4A
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
modifier|*
name|lat
parameter_list|,
name|float
modifier|*
name|lon
parameter_list|,
name|float
modifier|*
name|alt
parameter_list|,
name|float
modifier|*
name|clock_bias
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x4A_2
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
modifier|*
name|alt
parameter_list|,
name|float
modifier|*
name|dummy
parameter_list|,
name|unsigned
name|char
modifier|*
name|alt_flag
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x4B
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|machine_id
parameter_list|,
name|unsigned
name|char
modifier|*
name|status3
parameter_list|,
name|unsigned
name|char
modifier|*
name|status4
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x4C
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|dyn_code
parameter_list|,
name|float
modifier|*
name|el_mask
parameter_list|,
name|float
modifier|*
name|snr_mask
parameter_list|,
name|float
modifier|*
name|dop_mask
parameter_list|,
name|float
modifier|*
name|dop_switch
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x4D
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
modifier|*
name|osc_offset
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x4E
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|response
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x4F
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|double
modifier|*
name|a0
parameter_list|,
name|float
modifier|*
name|a1
parameter_list|,
name|float
modifier|*
name|time_of_data
parameter_list|,
name|short
modifier|*
name|dt_ls
parameter_list|,
name|short
modifier|*
name|wn_t
parameter_list|,
name|short
modifier|*
name|wn_lsf
parameter_list|,
name|short
modifier|*
name|dn
parameter_list|,
name|short
modifier|*
name|dt_lsf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x54
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
modifier|*
name|clock_bias
parameter_list|,
name|float
modifier|*
name|freq_offset
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x55
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|pos_code
parameter_list|,
name|unsigned
name|char
modifier|*
name|vel_code
parameter_list|,
name|unsigned
name|char
modifier|*
name|time_code
parameter_list|,
name|unsigned
name|char
modifier|*
name|aux_code
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x56
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
name|vel_ENU
index|[
literal|3
index|]
parameter_list|,
name|float
modifier|*
name|freq_offset
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x57
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|source_code
parameter_list|,
name|unsigned
name|char
modifier|*
name|diag_code
parameter_list|,
name|short
modifier|*
name|week_num
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x58
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|op_code
parameter_list|,
name|unsigned
name|char
modifier|*
name|data_type
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|unsigned
name|char
modifier|*
name|data_length
parameter_list|,
name|unsigned
name|char
modifier|*
name|data_packet
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x59
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|code_type
parameter_list|,
name|unsigned
name|char
name|status_code
index|[
literal|32
index|]
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x5A
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|float
modifier|*
name|sample_length
parameter_list|,
name|float
modifier|*
name|signal_level
parameter_list|,
name|float
modifier|*
name|code_phase
parameter_list|,
name|float
modifier|*
name|Doppler
parameter_list|,
name|double
modifier|*
name|time_of_fix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x5B
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_health
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_iode
parameter_list|,
name|unsigned
name|char
modifier|*
name|fit_interval_flag
parameter_list|,
name|float
modifier|*
name|time_of_collection
parameter_list|,
name|float
modifier|*
name|time_of_eph
parameter_list|,
name|float
modifier|*
name|sv_accy
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x5C
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|unsigned
name|char
modifier|*
name|slot
parameter_list|,
name|unsigned
name|char
modifier|*
name|chan
parameter_list|,
name|unsigned
name|char
modifier|*
name|acq_flag
parameter_list|,
name|unsigned
name|char
modifier|*
name|eph_flag
parameter_list|,
name|float
modifier|*
name|signal_level
parameter_list|,
name|float
modifier|*
name|time_of_last_msmt
parameter_list|,
name|float
modifier|*
name|elev
parameter_list|,
name|float
modifier|*
name|azim
parameter_list|,
name|unsigned
name|char
modifier|*
name|old_msmt_flag
parameter_list|,
name|unsigned
name|char
modifier|*
name|integer_msec_flag
parameter_list|,
name|unsigned
name|char
modifier|*
name|bad_data_flag
parameter_list|,
name|unsigned
name|char
modifier|*
name|data_collect_flag
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x6D
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|manual_mode
parameter_list|,
name|unsigned
name|char
modifier|*
name|nsvs
parameter_list|,
name|unsigned
name|char
modifier|*
name|ndim
parameter_list|,
name|unsigned
name|char
name|sv_prn
index|[]
parameter_list|,
name|float
modifier|*
name|pdop
parameter_list|,
name|float
modifier|*
name|hdop
parameter_list|,
name|float
modifier|*
name|vdop
parameter_list|,
name|float
modifier|*
name|tdop
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x82
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|diff_mode
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x83
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|double
name|ECEF_pos
index|[
literal|3
index|]
parameter_list|,
name|double
modifier|*
name|clock_bias
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x84
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|double
modifier|*
name|lat
parameter_list|,
name|double
modifier|*
name|lon
parameter_list|,
name|double
modifier|*
name|alt
parameter_list|,
name|double
modifier|*
name|clock_bias
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_Paly0xBB
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|TSIP_RCVR_CFG
modifier|*
name|TsipxBB
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0xBC
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|port_num
parameter_list|,
name|unsigned
name|char
modifier|*
name|in_baud
parameter_list|,
name|unsigned
name|char
modifier|*
name|out_baud
parameter_list|,
name|unsigned
name|char
modifier|*
name|data_bits
parameter_list|,
name|unsigned
name|char
modifier|*
name|parity
parameter_list|,
name|unsigned
name|char
modifier|*
name|stop_bits
parameter_list|,
name|unsigned
name|char
modifier|*
name|flow_control
parameter_list|,
name|unsigned
name|char
modifier|*
name|protocols_in
parameter_list|,
name|unsigned
name|char
modifier|*
name|protocols_out
parameter_list|,
name|unsigned
name|char
modifier|*
name|reserved
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* prototypes for superpacket parsers */
end_comment

begin_function_decl
name|short
name|rpt_0x8F0B
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|short
modifier|*
name|event
parameter_list|,
name|double
modifier|*
name|tow
parameter_list|,
name|unsigned
name|char
modifier|*
name|date
parameter_list|,
name|unsigned
name|char
modifier|*
name|month
parameter_list|,
name|short
modifier|*
name|year
parameter_list|,
name|unsigned
name|char
modifier|*
name|dim_mode
parameter_list|,
name|short
modifier|*
name|utc_offset
parameter_list|,
name|double
modifier|*
name|bias
parameter_list|,
name|double
modifier|*
name|drift
parameter_list|,
name|float
modifier|*
name|bias_unc
parameter_list|,
name|float
modifier|*
name|dr_unc
parameter_list|,
name|double
modifier|*
name|lat
parameter_list|,
name|double
modifier|*
name|lon
parameter_list|,
name|double
modifier|*
name|alt
parameter_list|,
name|char
name|sv_id
index|[
literal|8
index|]
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x8F14
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|short
modifier|*
name|datum_idx
parameter_list|,
name|double
name|datum_coeffs
index|[
literal|5
index|]
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x8F15
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|short
modifier|*
name|datum_idx
parameter_list|,
name|double
name|datum_coeffs
index|[
literal|5
index|]
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x8F20
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|info
parameter_list|,
name|double
modifier|*
name|lat
parameter_list|,
name|double
modifier|*
name|lon
parameter_list|,
name|double
modifier|*
name|alt
parameter_list|,
name|double
name|vel_enu
index|[]
parameter_list|,
name|double
modifier|*
name|time_of_fix
parameter_list|,
name|short
modifier|*
name|week_num
parameter_list|,
name|unsigned
name|char
modifier|*
name|nsvs
parameter_list|,
name|unsigned
name|char
name|sv_prn
index|[]
parameter_list|,
name|short
name|sv_IODC
index|[]
parameter_list|,
name|short
modifier|*
name|datum_index
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x8F41
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|bSearchRange
parameter_list|,
name|unsigned
name|char
modifier|*
name|bBoardOptions
parameter_list|,
name|unsigned
name|long
modifier|*
name|iiSerialNumber
parameter_list|,
name|unsigned
name|char
modifier|*
name|bBuildYear
parameter_list|,
name|unsigned
name|char
modifier|*
name|bBuildMonth
parameter_list|,
name|unsigned
name|char
modifier|*
name|bBuildDay
parameter_list|,
name|unsigned
name|char
modifier|*
name|bBuildHour
parameter_list|,
name|float
modifier|*
name|fOscOffset
parameter_list|,
name|unsigned
name|short
modifier|*
name|iTestCodeId
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x8F42
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|bProdOptionsPre
parameter_list|,
name|unsigned
name|char
modifier|*
name|bProdNumberExt
parameter_list|,
name|unsigned
name|short
modifier|*
name|iCaseSerialNumberPre
parameter_list|,
name|unsigned
name|long
modifier|*
name|iiCaseSerialNumber
parameter_list|,
name|unsigned
name|long
modifier|*
name|iiProdNumber
parameter_list|,
name|unsigned
name|short
modifier|*
name|iPremiumOptions
parameter_list|,
name|unsigned
name|short
modifier|*
name|iMachineID
parameter_list|,
name|unsigned
name|short
modifier|*
name|iKey
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x8F45
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|bSegMask
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x8F4A_16
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|pps_enabled
parameter_list|,
name|unsigned
name|char
modifier|*
name|pps_timebase
parameter_list|,
name|unsigned
name|char
modifier|*
name|pos_polarity
parameter_list|,
name|double
modifier|*
name|pps_offset
parameter_list|,
name|float
modifier|*
name|bias_unc_threshold
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x8F4B
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|long
modifier|*
name|decorr_max
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x8F4D
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|long
modifier|*
name|event_mask
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x8FA5
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|spktmask
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|short
name|rpt_0x8FAD
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|short
modifier|*
name|COUNT
parameter_list|,
name|double
modifier|*
name|FracSec
parameter_list|,
name|unsigned
name|char
modifier|*
name|Hour
parameter_list|,
name|unsigned
name|char
modifier|*
name|Minute
parameter_list|,
name|unsigned
name|char
modifier|*
name|Second
parameter_list|,
name|unsigned
name|char
modifier|*
name|Day
parameter_list|,
name|unsigned
name|char
modifier|*
name|Month
parameter_list|,
name|unsigned
name|short
modifier|*
name|Year
parameter_list|,
name|unsigned
name|char
modifier|*
name|Status
parameter_list|,
name|unsigned
name|char
modifier|*
name|Flags
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**/
end_comment

begin_comment
comment|/* prototypes for command-encode primitives with suffix convention:  */
end_comment

begin_comment
comment|/* c = clear, s = set, q = query, e = enable, d = disable            */
end_comment

begin_function_decl
name|void
name|cmd_0x1F
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x26
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x2F
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x35s
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|char
name|pos_code
parameter_list|,
name|unsigned
name|char
name|vel_code
parameter_list|,
name|unsigned
name|char
name|time_code
parameter_list|,
name|unsigned
name|char
name|opts_code
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x3C
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|char
name|sv_prn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x3Ds
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|char
name|baud_out
parameter_list|,
name|unsigned
name|char
name|baud_inp
parameter_list|,
name|unsigned
name|char
name|char_code
parameter_list|,
name|unsigned
name|char
name|stopbitcode
parameter_list|,
name|unsigned
name|char
name|output_mode
parameter_list|,
name|unsigned
name|char
name|input_mode
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0xBBq
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|char
name|subcode
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* prototypes 8E commands */
end_comment

begin_function_decl
name|void
name|cmd_0x8E0Bq
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x8E41q
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x8E42q
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x8E4Aq
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x8E4As
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|char
name|PPSOnOff
parameter_list|,
name|unsigned
name|char
name|TimeBase
parameter_list|,
name|unsigned
name|char
name|Polarity
parameter_list|,
name|double
name|PPSOffset
parameter_list|,
name|float
name|Uncertainty
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x8E4Bq
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x8E4Ds
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|long
name|AutoOutputMask
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cmd_0x8EADq
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* header/source border XXXXXXXXXXXXXXXXXXXXXXXXXX */
end_comment

begin_comment
comment|/* Trimble parse functions */
end_comment

begin_decl_stmt
specifier|static
name|int
name|parse0x8FAD
name|P
argument_list|(
operator|(
name|TSIPPKT
operator|*
operator|,
expr|struct
name|peer
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|parse0x8F0B
name|P
argument_list|(
operator|(
name|TSIPPKT
operator|*
operator|,
expr|struct
name|peer
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|TRIMBLE_OUTPUT_FUNC
end_ifdef

begin_decl_stmt
specifier|static
name|int
name|parseany
name|P
argument_list|(
operator|(
name|TSIPPKT
operator|*
operator|,
expr|struct
name|peer
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|TranslateTSIPReportToText
name|P
argument_list|(
operator|(
name|TSIPPKT
operator|*
operator|,
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* TRIMBLE_OUTPUT_FUNC */
end_comment

begin_decl_stmt
specifier|static
name|int
name|parse0x5C
name|P
argument_list|(
operator|(
name|TSIPPKT
operator|*
operator|,
expr|struct
name|peer
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|parse0x4F
name|P
argument_list|(
operator|(
name|TSIPPKT
operator|*
operator|,
expr|struct
name|peer
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|tsip_input_proc
name|P
argument_list|(
operator|(
name|TSIPPKT
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Trimble helper functions */
end_comment

begin_decl_stmt
specifier|static
name|void
name|bPutFloat
name|P
argument_list|(
operator|(
name|float
operator|*
operator|,
name|unsigned
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|bPutDouble
name|P
argument_list|(
operator|(
name|double
operator|*
operator|,
name|unsigned
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|bPutULong
name|P
argument_list|(
operator|(
name|unsigned
name|long
operator|*
operator|,
name|unsigned
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|print_msg_table_header
name|P
argument_list|(
operator|(
name|int
name|rptcode
operator|,
name|char
operator|*
name|HdrStr
operator|,
name|int
name|force
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|show_time
name|P
argument_list|(
operator|(
name|float
name|time_of_week
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* RIPE NCC functions */
end_comment

begin_decl_stmt
specifier|static
name|void
name|ripencc_control
name|P
argument_list|(
operator|(
name|int
operator|,
expr|struct
name|refclockstat
operator|*
operator|,
expr|struct
name|refclockstat
operator|*
operator|,
expr|struct
name|peer
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|ripencc_ppsapi
name|P
argument_list|(
operator|(
expr|struct
name|peer
operator|*
operator|,
name|int
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|ripencc_get_pps_ts
name|P
argument_list|(
operator|(
expr|struct
name|ripencc_unit
operator|*
operator|,
name|l_fp
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|ripencc_start
name|P
argument_list|(
operator|(
name|int
operator|,
expr|struct
name|peer
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|ripencc_shutdown
name|P
argument_list|(
operator|(
name|int
operator|,
expr|struct
name|peer
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|ripencc_poll
name|P
argument_list|(
operator|(
name|int
operator|,
expr|struct
name|peer
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|ripencc_send
name|P
argument_list|(
operator|(
expr|struct
name|peer
operator|*
operator|,
name|TSIPPKT
name|spt
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|ripencc_receive
name|P
argument_list|(
operator|(
expr|struct
name|recvbuf
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* fill in reflock structure for our clock */
end_comment

begin_decl_stmt
name|struct
name|refclock
name|refclock_ripencc
init|=
block|{
name|ripencc_start
block|,
comment|/* start up driver */
name|ripencc_shutdown
block|,
comment|/* shut down driver */
name|ripencc_poll
block|,
comment|/* transmit poll message */
name|ripencc_control
block|,
comment|/* control function */
name|noentry
block|,
comment|/* initialize driver */
name|noentry
block|,
comment|/* debug info */
name|NOFLAGS
comment|/* clock flags */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  *  Tables to compute the ddd of year form icky dd/mm timecode. Viva la  *  leap.  */
end_comment

begin_decl_stmt
specifier|static
name|int
name|day1tab
index|[]
init|=
block|{
literal|31
block|,
literal|28
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|day2tab
index|[]
init|=
block|{
literal|31
block|,
literal|29
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * ripencc_start - open the GPS devices and initialize data for processing  */
end_comment

begin_function
specifier|static
name|int
name|ripencc_start
parameter_list|(
name|int
name|unit
parameter_list|,
name|struct
name|peer
modifier|*
name|peer
parameter_list|)
block|{
specifier|register
name|struct
name|ripencc_unit
modifier|*
name|up
decl_stmt|;
name|struct
name|refclockproc
modifier|*
name|pp
decl_stmt|;
name|char
name|device
index|[
literal|40
index|]
decl_stmt|;
name|int
name|fd
decl_stmt|;
name|struct
name|termios
name|tio
decl_stmt|;
name|TSIPPKT
name|spt
decl_stmt|;
comment|/* 	 * Open serial port 	 */
operator|(
name|void
operator|)
name|snprintf
argument_list|(
name|device
argument_list|,
sizeof|sizeof
argument_list|(
name|device
argument_list|)
argument_list|,
name|DEVICE
argument_list|,
name|unit
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|fd
operator|=
name|refclock_open
argument_list|(
name|device
argument_list|,
name|SPEED232
argument_list|,
name|LDISC_RAW
argument_list|)
operator|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
comment|/* from refclock_palisade.c */
if|if
condition|(
name|tcgetattr
argument_list|(
name|fd
argument_list|,
operator|&
name|tio
argument_list|)
operator|<
literal|0
condition|)
block|{
name|msyslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"Palisade(%d) tcgetattr(fd,&tio): %m"
argument_list|,
name|unit
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* 	 * set flags 	 */
name|tio
operator|.
name|c_cflag
operator||=
operator|(
name|PARENB
operator||
name|PARODD
operator|)
expr_stmt|;
name|tio
operator|.
name|c_iflag
operator|&=
operator|~
name|ICRNL
expr_stmt|;
if|if
condition|(
name|tcsetattr
argument_list|(
name|fd
argument_list|,
name|TCSANOW
argument_list|,
operator|&
name|tio
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|msyslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"Palisade(%d) tcsetattr(fd,&tio): %m"
argument_list|,
name|unit
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* 	 * Allocate and initialize unit structure 	 */
if|if
condition|(
operator|!
operator|(
name|up
operator|=
operator|(
expr|struct
name|ripencc_unit
operator|*
operator|)
name|emalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|ripencc_unit
argument_list|)
argument_list|)
operator|)
condition|)
block|{
operator|(
name|void
operator|)
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|memset
argument_list|(
operator|(
name|char
operator|*
operator|)
name|up
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ripencc_unit
argument_list|)
argument_list|)
expr_stmt|;
name|pp
operator|=
name|peer
operator|->
name|procptr
expr_stmt|;
name|pp
operator|->
name|io
operator|.
name|clock_recv
operator|=
name|ripencc_receive
expr_stmt|;
name|pp
operator|->
name|io
operator|.
name|srcclock
operator|=
operator|(
name|caddr_t
operator|)
name|peer
expr_stmt|;
name|pp
operator|->
name|io
operator|.
name|datalen
operator|=
literal|0
expr_stmt|;
name|pp
operator|->
name|io
operator|.
name|fd
operator|=
name|fd
expr_stmt|;
if|if
condition|(
operator|!
name|io_addclock
argument_list|(
operator|&
name|pp
operator|->
name|io
argument_list|)
condition|)
block|{
operator|(
name|void
operator|)
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|up
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pp
operator|->
name|unitptr
operator|=
operator|(
name|caddr_t
operator|)
name|up
expr_stmt|;
comment|/* 	 * Initialize miscellaneous variables 	 */
name|peer
operator|->
name|precision
operator|=
name|PRECISION
expr_stmt|;
name|pp
operator|->
name|clockdesc
operator|=
name|DESCRIPTION
expr_stmt|;
name|memcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|pp
operator|->
name|refid
argument_list|,
name|REFID
argument_list|,
name|REFID_LEN
argument_list|)
expr_stmt|;
name|up
operator|->
name|pollcnt
operator|=
literal|2
expr_stmt|;
name|up
operator|->
name|unit
operator|=
name|unit
expr_stmt|;
name|up
operator|->
name|leapdelta
operator|=
literal|0
expr_stmt|;
name|up
operator|->
name|utcflags
operator|=
literal|0
expr_stmt|;
comment|/* 	 * Initialize the Clock 	 */
comment|/* query software versions */
name|cmd_0x1F
argument_list|(
operator|&
name|spt
argument_list|)
expr_stmt|;
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
comment|/* query receiver health */
name|cmd_0x26
argument_list|(
operator|&
name|spt
argument_list|)
expr_stmt|;
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
comment|/* query serial numbers */
name|cmd_0x8E42q
argument_list|(
operator|&
name|spt
argument_list|)
expr_stmt|;
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
comment|/* query manuf params */
name|cmd_0x8E41q
argument_list|(
operator|&
name|spt
argument_list|)
expr_stmt|;
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
comment|/* i/o opts */
comment|/* trimble manual page A30 */
name|cmd_0x35s
argument_list|(
operator|&
name|spt
argument_list|,
literal|0x1C
argument_list|,
comment|/* position */
literal|0x00
argument_list|,
comment|/* velocity */
literal|0x05
argument_list|,
comment|/* timing */
literal|0x0a
argument_list|)
expr_stmt|;
comment|/* auxilary */
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
comment|/* turn off port A */
name|cmd_0x3Ds
argument_list|(
operator|&
name|spt
argument_list|,
literal|0x0B
argument_list|,
comment|/* baud_out */
literal|0x0B
argument_list|,
comment|/* baud_inp */
literal|0x07
argument_list|,
comment|/* char_code */
literal|0x07
argument_list|,
comment|/* stopbitcode */
literal|0x01
argument_list|,
comment|/* output_mode */
literal|0x00
argument_list|)
expr_stmt|;
comment|/* input_mode */
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
comment|/* set i/o options */
name|cmd_0x8E4As
argument_list|(
operator|&
name|spt
argument_list|,
literal|0x01
argument_list|,
comment|/* PPS on */
literal|0x01
argument_list|,
comment|/* Timebase UTC */
literal|0x00
argument_list|,
comment|/* polarity positive */
literal|0.
argument_list|,
comment|/* 100 ft. cable XXX make flag */
literal|1e-6
operator|*
name|GPS_C
argument_list|)
expr_stmt|;
comment|/* turn of biasuncert.> (1us) */
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
comment|/* all outomatic packet output off */
name|cmd_0x8E4Ds
argument_list|(
operator|&
name|spt
argument_list|,
literal|0x00000000
argument_list|)
expr_stmt|;
comment|/* AutoOutputMask */
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
name|cmd_0xBBq
argument_list|(
operator|&
name|spt
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
comment|/* query primary configuration */
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
comment|/* query PPS parameters */
name|cmd_0x8E4Aq
argument_list|(
operator|&
name|spt
argument_list|)
expr_stmt|;
comment|/* query PPS params */
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
comment|/* query survey limit */
name|cmd_0x8E4Bq
argument_list|(
operator|&
name|spt
argument_list|)
expr_stmt|;
comment|/* query survey limit */
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_NCC
if|if
condition|(
name|debug
condition|)
name|printf
argument_list|(
literal|"ripencc_start: success\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_NCC */
comment|/* 	 * Start the PPSAPI interface if it is there. Default to use 	 * the assert edge and do not enable the kernel hardpps. 	 */
if|if
condition|(
name|time_pps_create
argument_list|(
name|fd
argument_list|,
operator|&
name|up
operator|->
name|handle
argument_list|)
operator|<
literal|0
condition|)
block|{
name|up
operator|->
name|handle
operator|=
literal|0
expr_stmt|;
name|msyslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"refclock_ripencc: time_pps_create failed: %m"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
return|return
operator|(
name|ripencc_ppsapi
argument_list|(
name|peer
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * ripencc_control - fudge control  */
end_comment

begin_function
specifier|static
name|void
name|ripencc_control
parameter_list|(
name|int
name|unit
parameter_list|,
comment|/* unit (not used) */
name|struct
name|refclockstat
modifier|*
name|in
parameter_list|,
comment|/* input parameters (not used) */
name|struct
name|refclockstat
modifier|*
name|out
parameter_list|,
comment|/* output parameters (not used) */
name|struct
name|peer
modifier|*
name|peer
comment|/* peer structure pointer */
parameter_list|)
block|{
name|struct
name|refclockproc
modifier|*
name|pp
decl_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_NCC
name|msyslog
argument_list|(
name|LOG_INFO
argument_list|,
literal|"%s()"
argument_list|,
name|__FUNCTION__
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_NCC */
name|pp
operator|=
name|peer
operator|->
name|procptr
expr_stmt|;
name|ripencc_ppsapi
argument_list|(
name|peer
argument_list|,
name|pp
operator|->
name|sloppyclockflag
operator|&
name|CLK_FLAG2
argument_list|,
name|pp
operator|->
name|sloppyclockflag
operator|&
name|CLK_FLAG3
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Initialize PPSAPI  */
end_comment

begin_function
name|int
name|ripencc_ppsapi
parameter_list|(
name|struct
name|peer
modifier|*
name|peer
parameter_list|,
comment|/* peer structure pointer */
name|int
name|enb_clear
parameter_list|,
comment|/* clear enable */
name|int
name|enb_hardpps
comment|/* hardpps enable */
parameter_list|)
block|{
name|struct
name|refclockproc
modifier|*
name|pp
decl_stmt|;
name|struct
name|ripencc_unit
modifier|*
name|up
decl_stmt|;
name|int
name|capability
decl_stmt|;
name|pp
operator|=
name|peer
operator|->
name|procptr
expr_stmt|;
name|up
operator|=
operator|(
expr|struct
name|ripencc_unit
operator|*
operator|)
name|pp
operator|->
name|unitptr
expr_stmt|;
if|if
condition|(
name|time_pps_getcap
argument_list|(
name|up
operator|->
name|handle
argument_list|,
operator|&
name|capability
argument_list|)
operator|<
literal|0
condition|)
block|{
name|msyslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"refclock_ripencc: time_pps_getcap failed: %m"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|memset
argument_list|(
operator|&
name|up
operator|->
name|pps_params
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|pps_params_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|enb_clear
condition|)
name|up
operator|->
name|pps_params
operator|.
name|mode
operator|=
name|capability
operator|&
name|PPS_CAPTURECLEAR
expr_stmt|;
else|else
name|up
operator|->
name|pps_params
operator|.
name|mode
operator|=
name|capability
operator|&
name|PPS_CAPTUREASSERT
expr_stmt|;
if|if
condition|(
operator|!
name|up
operator|->
name|pps_params
operator|.
name|mode
condition|)
block|{
name|msyslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"refclock_ripencc: invalid capture edge %d"
argument_list|,
operator|!
name|enb_clear
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|up
operator|->
name|pps_params
operator|.
name|mode
operator||=
name|PPS_TSFMT_TSPEC
expr_stmt|;
if|if
condition|(
name|time_pps_setparams
argument_list|(
name|up
operator|->
name|handle
argument_list|,
operator|&
name|up
operator|->
name|pps_params
argument_list|)
operator|<
literal|0
condition|)
block|{
name|msyslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"refclock_ripencc: time_pps_setparams failed: %m"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|enb_hardpps
condition|)
block|{
if|if
condition|(
name|time_pps_kcbind
argument_list|(
name|up
operator|->
name|handle
argument_list|,
name|PPS_KC_HARDPPS
argument_list|,
name|up
operator|->
name|pps_params
operator|.
name|mode
operator|&
operator|~
name|PPS_TSFMT_TSPEC
argument_list|,
name|PPS_TSFMT_TSPEC
argument_list|)
operator|<
literal|0
condition|)
block|{
name|msyslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"refclock_ripencc: time_pps_kcbind failed: %m"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pps_enable
operator|=
literal|1
expr_stmt|;
block|}
name|peer
operator|->
name|precision
operator|=
name|PPS_PRECISION
expr_stmt|;
if|#
directive|if
name|DEBUG_NCC
if|if
condition|(
name|debug
condition|)
block|{
name|time_pps_getparams
argument_list|(
name|up
operator|->
name|handle
argument_list|,
operator|&
name|up
operator|->
name|pps_params
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"refclock_ripencc: capability 0x%x version %d mode 0x%x kern %d\n"
argument_list|,
name|capability
argument_list|,
name|up
operator|->
name|pps_params
operator|.
name|api_version
argument_list|,
name|up
operator|->
name|pps_params
operator|.
name|mode
argument_list|,
name|enb_hardpps
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* DEBUG_NCC */
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * This function is called every 64 seconds from ripencc_receive  * It will fetch the pps time   *  * Return 0 on failure and 1 on success.  */
end_comment

begin_function
specifier|static
name|int
name|ripencc_get_pps_ts
parameter_list|(
name|struct
name|ripencc_unit
modifier|*
name|up
parameter_list|,
name|l_fp
modifier|*
name|tsptr
parameter_list|)
block|{
name|pps_info_t
name|pps_info
decl_stmt|;
name|struct
name|timespec
name|timeout
decl_stmt|,
name|ts
decl_stmt|;
name|double
name|dtemp
decl_stmt|;
name|l_fp
name|tstmp
decl_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_PPS
name|msyslog
argument_list|(
name|LOG_INFO
argument_list|,
literal|"ripencc_get_pps_ts\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_PPS */
comment|/* 	 * Convert the timespec nanoseconds field to ntp l_fp units. 	 */
if|if
condition|(
name|up
operator|->
name|handle
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|timeout
operator|.
name|tv_sec
operator|=
literal|0
expr_stmt|;
name|timeout
operator|.
name|tv_nsec
operator|=
literal|0
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|pps_info
argument_list|,
operator|&
name|up
operator|->
name|pps_info
argument_list|,
sizeof|sizeof
argument_list|(
name|pps_info_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|time_pps_fetch
argument_list|(
name|up
operator|->
name|handle
argument_list|,
name|PPS_TSFMT_TSPEC
argument_list|,
operator|&
name|up
operator|->
name|pps_info
argument_list|,
operator|&
name|timeout
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|up
operator|->
name|pps_params
operator|.
name|mode
operator|&
name|PPS_CAPTUREASSERT
condition|)
block|{
if|if
condition|(
name|pps_info
operator|.
name|assert_sequence
operator|==
name|up
operator|->
name|pps_info
operator|.
name|assert_sequence
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|ts
operator|=
name|up
operator|->
name|pps_info
operator|.
name|assert_timestamp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|up
operator|->
name|pps_params
operator|.
name|mode
operator|&
name|PPS_CAPTURECLEAR
condition|)
block|{
if|if
condition|(
name|pps_info
operator|.
name|clear_sequence
operator|==
name|up
operator|->
name|pps_info
operator|.
name|clear_sequence
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|ts
operator|=
name|up
operator|->
name|pps_info
operator|.
name|clear_timestamp
expr_stmt|;
block|}
else|else
block|{
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|up
operator|->
name|ts
operator|.
name|tv_sec
operator|==
name|ts
operator|.
name|tv_sec
operator|)
operator|&&
operator|(
name|up
operator|->
name|ts
operator|.
name|tv_nsec
operator|==
name|ts
operator|.
name|tv_nsec
operator|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|up
operator|->
name|ts
operator|=
name|ts
expr_stmt|;
name|tstmp
operator|.
name|l_ui
operator|=
name|ts
operator|.
name|tv_sec
operator|+
name|JAN_1970
expr_stmt|;
name|dtemp
operator|=
name|ts
operator|.
name|tv_nsec
operator|*
name|FRAC
operator|/
literal|1e9
expr_stmt|;
name|tstmp
operator|.
name|l_uf
operator|=
operator|(
name|u_int32
operator|)
name|dtemp
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_PPS
name|msyslog
argument_list|(
name|LOG_INFO
argument_list|,
literal|"ts.tv_sec: %d\n"
argument_list|,
operator|(
name|int
operator|)
name|ts
operator|.
name|tv_sec
argument_list|)
expr_stmt|;
name|msyslog
argument_list|(
name|LOG_INFO
argument_list|,
literal|"ts.tv_nsec: %ld\n"
argument_list|,
name|ts
operator|.
name|tv_nsec
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_PPS */
operator|*
name|tsptr
operator|=
name|tstmp
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * ripencc_shutdown - shut down a GPS clock  */
end_comment

begin_function
specifier|static
name|void
name|ripencc_shutdown
parameter_list|(
name|int
name|unit
parameter_list|,
name|struct
name|peer
modifier|*
name|peer
parameter_list|)
block|{
specifier|register
name|struct
name|ripencc_unit
modifier|*
name|up
decl_stmt|;
name|struct
name|refclockproc
modifier|*
name|pp
decl_stmt|;
name|pp
operator|=
name|peer
operator|->
name|procptr
expr_stmt|;
name|up
operator|=
operator|(
expr|struct
name|ripencc_unit
operator|*
operator|)
name|pp
operator|->
name|unitptr
expr_stmt|;
if|if
condition|(
name|up
operator|->
name|handle
operator|!=
literal|0
condition|)
name|time_pps_destroy
argument_list|(
name|up
operator|->
name|handle
argument_list|)
expr_stmt|;
name|io_closeclock
argument_list|(
operator|&
name|pp
operator|->
name|io
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|up
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * ripencc_poll - called by the transmit procedure  */
end_comment

begin_function
specifier|static
name|void
name|ripencc_poll
parameter_list|(
name|int
name|unit
parameter_list|,
name|struct
name|peer
modifier|*
name|peer
parameter_list|)
block|{
specifier|register
name|struct
name|ripencc_unit
modifier|*
name|up
decl_stmt|;
name|struct
name|refclockproc
modifier|*
name|pp
decl_stmt|;
name|TSIPPKT
name|spt
decl_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_NCC
if|if
condition|(
name|debug
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ripencc_poll(%d)\n"
argument_list|,
name|unit
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_NCC */
name|pp
operator|=
name|peer
operator|->
name|procptr
expr_stmt|;
name|up
operator|=
operator|(
expr|struct
name|ripencc_unit
operator|*
operator|)
name|pp
operator|->
name|unitptr
expr_stmt|;
if|if
condition|(
name|up
operator|->
name|pollcnt
operator|==
literal|0
condition|)
name|refclock_report
argument_list|(
name|peer
argument_list|,
name|CEVNT_TIMEOUT
argument_list|)
expr_stmt|;
else|else
name|up
operator|->
name|pollcnt
operator|--
expr_stmt|;
name|pp
operator|->
name|polls
operator|++
expr_stmt|;
name|up
operator|->
name|polled
operator|=
literal|1
expr_stmt|;
comment|/* poll for UTC superpacket */
name|cmd_0x8EADq
argument_list|(
operator|&
name|spt
argument_list|)
expr_stmt|;
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * ripencc_send - send message to clock  * use the structures being created by the trimble functions!  * makes the code more readable/clean  */
end_comment

begin_function
specifier|static
name|void
name|ripencc_send
parameter_list|(
name|struct
name|peer
modifier|*
name|peer
parameter_list|,
name|TSIPPKT
name|spt
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|ip
decl_stmt|,
modifier|*
name|op
decl_stmt|;
name|unsigned
name|char
name|obuf
index|[
literal|512
index|]
decl_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_RAW
block|{
specifier|register
name|struct
name|ripencc_unit
modifier|*
name|up
decl_stmt|;
specifier|register
name|struct
name|refclockproc
modifier|*
name|pp
decl_stmt|;
name|pp
operator|=
name|peer
operator|->
name|procptr
expr_stmt|;
name|up
operator|=
operator|(
expr|struct
name|ripencc_unit
operator|*
operator|)
name|pp
operator|->
name|unitptr
expr_stmt|;
if|if
condition|(
name|debug
condition|)
name|printf
argument_list|(
literal|"ripencc_send(%d, %02X)\n"
argument_list|,
name|up
operator|->
name|unit
argument_list|,
name|cmd
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* DEBUG_RAW */
name|ip
operator|=
name|spt
operator|.
name|buf
expr_stmt|;
name|op
operator|=
name|obuf
expr_stmt|;
operator|*
name|op
operator|++
operator|=
literal|0x10
expr_stmt|;
operator|*
name|op
operator|++
operator|=
name|spt
operator|.
name|code
expr_stmt|;
while|while
condition|(
name|spt
operator|.
name|len
operator|--
condition|)
block|{
if|if
condition|(
name|op
operator|-
name|obuf
operator|>
sizeof|sizeof
argument_list|(
name|obuf
argument_list|)
operator|-
literal|5
condition|)
block|{
name|msyslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"ripencc_send obuf overflow!"
argument_list|)
expr_stmt|;
name|refclock_report
argument_list|(
name|peer
argument_list|,
name|CEVNT_FAULT
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|*
name|ip
operator|==
literal|0x10
condition|)
comment|/* byte stuffing */
operator|*
name|op
operator|++
operator|=
literal|0x10
expr_stmt|;
operator|*
name|op
operator|++
operator|=
operator|*
name|ip
operator|++
expr_stmt|;
block|}
operator|*
name|op
operator|++
operator|=
literal|0x10
expr_stmt|;
operator|*
name|op
operator|++
operator|=
literal|0x03
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_RAW
if|if
condition|(
name|debug
condition|)
block|{
comment|/* print raw packet */
name|unsigned
name|char
modifier|*
name|cp
decl_stmt|;
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"ripencc_send: len %d\n"
argument_list|,
name|op
operator|-
name|obuf
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
operator|,
name|cp
operator|=
name|obuf
init|;
name|cp
operator|<
name|op
condition|;
name|i
operator|++
operator|,
name|cp
operator|++
control|)
block|{
name|printf
argument_list|(
literal|" %02X"
argument_list|,
operator|*
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|%
literal|10
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* DEBUG_RAW */
if|if
condition|(
name|write
argument_list|(
name|peer
operator|->
name|procptr
operator|->
name|io
operator|.
name|fd
argument_list|,
name|obuf
argument_list|,
name|op
operator|-
name|obuf
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|refclock_report
argument_list|(
name|peer
argument_list|,
name|CEVNT_FAULT
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * ripencc_receive()  *  * called when a packet is received on the serial port  * takes care of further processing  *  */
end_comment

begin_function
specifier|static
name|void
name|ripencc_receive
parameter_list|(
name|struct
name|recvbuf
modifier|*
name|rbufp
parameter_list|)
block|{
specifier|register
name|struct
name|ripencc_unit
modifier|*
name|up
decl_stmt|;
specifier|register
name|struct
name|refclockproc
modifier|*
name|pp
decl_stmt|;
name|struct
name|peer
modifier|*
name|peer
decl_stmt|;
specifier|static
name|TSIPPKT
name|rpt
decl_stmt|;
comment|/* structure for current incoming TSIP report  */
name|TSIPPKT
name|spt
decl_stmt|;
comment|/* send packet */
name|int
name|ns_since_pps
decl_stmt|;
name|int
name|i
decl_stmt|;
name|char
modifier|*
name|cp
decl_stmt|;
comment|/* Use these variables to hold data until we decide its worth keeping */
name|char
name|rd_lastcode
index|[
name|BMAX
index|]
decl_stmt|;
name|l_fp
name|rd_tmp
decl_stmt|;
name|u_short
name|rd_lencode
decl_stmt|;
comment|/* msyslog(LOG_INFO, "%s",__FUNCTION__); */
comment|/* 	 * Initialize pointers and read the timecode and timestamp 	 */
name|peer
operator|=
operator|(
expr|struct
name|peer
operator|*
operator|)
name|rbufp
operator|->
name|recv_srcclock
expr_stmt|;
name|pp
operator|=
name|peer
operator|->
name|procptr
expr_stmt|;
name|up
operator|=
operator|(
expr|struct
name|ripencc_unit
operator|*
operator|)
name|pp
operator|->
name|unitptr
expr_stmt|;
name|rd_lencode
operator|=
name|refclock_gtlin
argument_list|(
name|rbufp
argument_list|,
name|rd_lastcode
argument_list|,
name|BMAX
argument_list|,
operator|&
name|rd_tmp
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_RAW
if|if
condition|(
name|debug
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ripencc_receive(%d)\n"
argument_list|,
name|up
operator|->
name|unit
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_RAW */
ifdef|#
directive|ifdef
name|DEBUG_RAW
if|if
condition|(
name|debug
condition|)
block|{
comment|/* print raw packet */
name|int
name|i
decl_stmt|;
name|unsigned
name|char
modifier|*
name|cp
decl_stmt|;
name|printf
argument_list|(
literal|"ripencc_receive: len %d\n"
argument_list|,
name|rbufp
operator|->
name|recv_length
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
operator|,
name|cp
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|rbufp
operator|->
name|recv_space
init|;
name|i
operator|<=
name|rbufp
operator|->
name|recv_length
condition|;
name|i
operator|++
operator|,
name|cp
operator|++
control|)
block|{
name|printf
argument_list|(
literal|" %02X"
argument_list|,
operator|*
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|%
literal|10
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* DEBUG_RAW */
name|cp
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|rbufp
operator|->
name|recv_space
expr_stmt|;
name|i
operator|=
name|rbufp
operator|->
name|recv_length
expr_stmt|;
while|while
condition|(
name|i
operator|--
condition|)
block|{
comment|/* loop over received chars */
name|tsip_input_proc
argument_list|(
operator|&
name|rpt
argument_list|,
operator|(
name|unsigned
name|char
operator|)
operator|*
name|cp
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|rpt
operator|.
name|status
operator|!=
name|TSIP_PARSED_FULL
condition|)
continue|continue;
switch|switch
condition|(
name|rpt
operator|.
name|code
condition|)
block|{
case|case
literal|0x8F
case|:
comment|/* superpacket */
switch|switch
condition|(
name|rpt
operator|.
name|buf
index|[
literal|0
index|]
condition|)
block|{
case|case
literal|0xAD
case|:
comment|/* UTC Time */
comment|/* 				 * When polling on port B the timecode  				 * is the time of the previous PPS. 				 * If we completed receiving the packet  				 * less than 150ms after the turn of the second,  				 * it may have the code of the previous second. 				 * We do not trust that and simply poll again 				 * without even parsing it. 				 * 				 * More elegant would be to re-schedule the poll, 				 * but I do not know (yet) how to do that cleanly. 				 * 				 */
comment|/* BLA ns_since_pps = ncc_tstmp(rbufp,&trtmp); */
comment|/*   if (up->polled&& ns_since_pps> -1&& ns_since_pps< 150) { */
name|ns_since_pps
operator|=
literal|200
expr_stmt|;
if|if
condition|(
name|up
operator|->
name|polled
operator|&&
name|ns_since_pps
operator|<
literal|150
condition|)
block|{
name|msyslog
argument_list|(
name|LOG_INFO
argument_list|,
literal|"%s(): up->polled"
argument_list|,
name|__FUNCTION__
argument_list|)
expr_stmt|;
name|ripencc_poll
argument_list|(
name|up
operator|->
name|unit
argument_list|,
name|peer
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/*  				 * Parse primary utc time packet 				 * and fill refclock structure  				 * from results.  				 */
if|if
condition|(
name|parse0x8FAD
argument_list|(
operator|&
name|rpt
argument_list|,
name|peer
argument_list|)
operator|<
literal|0
condition|)
block|{
name|msyslog
argument_list|(
name|LOG_INFO
argument_list|,
literal|"%s(): parse0x8FAD< 0"
argument_list|,
name|__FUNCTION__
argument_list|)
expr_stmt|;
name|refclock_report
argument_list|(
name|peer
argument_list|,
name|CEVNT_BADREPLY
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* 				 * If the PPSAPI is working, rather use its  				 * timestamps. 				 * assume that the PPS occurs on the second  				 * so blow any msec 				 */
if|if
condition|(
name|ripencc_get_pps_ts
argument_list|(
name|up
argument_list|,
operator|&
name|rd_tmp
argument_list|)
operator|==
literal|1
condition|)
block|{
name|pp
operator|->
name|lastrec
operator|=
name|up
operator|->
name|tstamp
operator|=
name|rd_tmp
expr_stmt|;
name|pp
operator|->
name|nsec
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|msyslog
argument_list|(
name|LOG_INFO
argument_list|,
literal|"%s(): ripencc_get_pps_ts returns failure\n"
argument_list|,
name|__FUNCTION__
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|up
operator|->
name|polled
condition|)
block|{
name|msyslog
argument_list|(
name|LOG_INFO
argument_list|,
literal|"%s(): unrequested packet\n"
argument_list|,
name|__FUNCTION__
argument_list|)
expr_stmt|;
comment|/* unrequested packet */
break|break;
block|}
comment|/* we have been polled ! */
name|up
operator|->
name|polled
operator|=
literal|0
expr_stmt|;
name|up
operator|->
name|pollcnt
operator|=
literal|2
expr_stmt|;
comment|/* poll for next packet */
name|cmd_0x8E0Bq
argument_list|(
operator|&
name|spt
argument_list|)
expr_stmt|;
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
if|if
condition|(
name|ns_since_pps
operator|<
literal|0
condition|)
block|{
comment|/* no PPS */
name|msyslog
argument_list|(
name|LOG_INFO
argument_list|,
literal|"%s(): ns_since_pps< 0"
argument_list|,
name|__FUNCTION__
argument_list|)
expr_stmt|;
name|refclock_report
argument_list|(
name|peer
argument_list|,
name|CEVNT_BADTIME
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* 				 * Process the new sample in the median filter and determine the 				 * reference clock offset and dispersion.   				 */
if|if
condition|(
operator|!
name|refclock_process
argument_list|(
name|pp
argument_list|)
condition|)
block|{
name|msyslog
argument_list|(
name|LOG_INFO
argument_list|,
literal|"%s(): !refclock_process"
argument_list|,
name|__FUNCTION__
argument_list|)
expr_stmt|;
name|refclock_report
argument_list|(
name|peer
argument_list|,
name|CEVNT_BADTIME
argument_list|)
expr_stmt|;
break|break;
block|}
name|refclock_receive
argument_list|(
name|peer
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x0B
case|:
comment|/* comprehensive time packet */
name|parse0x8F0B
argument_list|(
operator|&
name|rpt
argument_list|,
name|peer
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* other superpackets */
ifdef|#
directive|ifdef
name|DEBUG_NCC
name|msyslog
argument_list|(
name|LOG_INFO
argument_list|,
literal|"%s(): calling parseany"
argument_list|,
name|__FUNCTION__
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_NCC */
ifdef|#
directive|ifdef
name|TRIMBLE_OUTPUT_FUNC
name|parseany
argument_list|(
operator|&
name|rpt
argument_list|,
name|peer
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* TRIMBLE_OUTPUT_FUNC */
break|break;
block|}
break|break;
case|case
literal|0x4F
case|:
comment|/* UTC parameters, for leap info */
name|parse0x4F
argument_list|(
operator|&
name|rpt
argument_list|,
name|peer
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x5C
case|:
comment|/* sat tracking data */
name|parse0x5C
argument_list|(
operator|&
name|rpt
argument_list|,
name|peer
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* other packets */
ifdef|#
directive|ifdef
name|TRIMBLE_OUTPUT_FUNC
name|parseany
argument_list|(
operator|&
name|rpt
argument_list|,
name|peer
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* TRIMBLE_OUTPUT_FUNC */
break|break;
block|}
name|rpt
operator|.
name|status
operator|=
name|TSIP_PARSED_EMPTY
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*   * All trimble functions that are directly referenced from driver code  * (so not from parseany)  */
end_comment

begin_function
name|void
name|cmd_0x1F
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
comment|/* request software versions */
block|{
name|cmd
operator|->
name|len
operator|=
literal|0
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x1F
expr_stmt|;
block|}
end_function

begin_function
name|void
name|cmd_0x26
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
comment|/* request receiver health */
block|{
name|cmd
operator|->
name|len
operator|=
literal|0
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x26
expr_stmt|;
block|}
end_function

begin_function
name|void
name|cmd_0x2F
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
comment|/* request UTC params */
block|{
name|cmd
operator|->
name|len
operator|=
literal|0
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x2F
expr_stmt|;
block|}
end_function

begin_function
name|void
name|cmd_0x35s
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|char
name|pos_code
parameter_list|,
name|unsigned
name|char
name|vel_code
parameter_list|,
name|unsigned
name|char
name|time_code
parameter_list|,
name|unsigned
name|char
name|opts_code
parameter_list|)
comment|/* set serial I/O options */
block|{
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
name|pos_code
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|1
index|]
operator|=
name|vel_code
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|2
index|]
operator|=
name|time_code
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|3
index|]
operator|=
name|opts_code
expr_stmt|;
name|cmd
operator|->
name|len
operator|=
literal|4
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x35
expr_stmt|;
block|}
end_function

begin_function
name|void
name|cmd_0x3C
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|char
name|sv_prn
parameter_list|)
comment|/* request tracking status */
block|{
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
name|sv_prn
expr_stmt|;
name|cmd
operator|->
name|len
operator|=
literal|1
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x3C
expr_stmt|;
block|}
end_function

begin_function
name|void
name|cmd_0x3Ds
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|char
name|baud_out
parameter_list|,
name|unsigned
name|char
name|baud_inp
parameter_list|,
name|unsigned
name|char
name|char_code
parameter_list|,
name|unsigned
name|char
name|stopbitcode
parameter_list|,
name|unsigned
name|char
name|output_mode
parameter_list|,
name|unsigned
name|char
name|input_mode
parameter_list|)
comment|/* set Channel A configuration for dual-port operation */
block|{
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
name|baud_out
expr_stmt|;
comment|/* XMT baud rate */
name|cmd
operator|->
name|buf
index|[
literal|1
index|]
operator|=
name|baud_inp
expr_stmt|;
comment|/* RCV baud rate */
name|cmd
operator|->
name|buf
index|[
literal|2
index|]
operator|=
name|char_code
expr_stmt|;
comment|/* parity and #bits per byte */
name|cmd
operator|->
name|buf
index|[
literal|3
index|]
operator|=
name|stopbitcode
expr_stmt|;
comment|/* number of stop bits code */
name|cmd
operator|->
name|buf
index|[
literal|4
index|]
operator|=
name|output_mode
expr_stmt|;
comment|/* Ch. A transmission mode */
name|cmd
operator|->
name|buf
index|[
literal|5
index|]
operator|=
name|input_mode
expr_stmt|;
comment|/* Ch. A reception mode */
name|cmd
operator|->
name|len
operator|=
literal|6
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x3D
expr_stmt|;
block|}
end_function

begin_comment
comment|/* query primary configuration */
end_comment

begin_function
name|void
name|cmd_0xBBq
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|char
name|subcode
parameter_list|)
block|{
name|cmd
operator|->
name|len
operator|=
literal|1
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0xBB
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
name|subcode
expr_stmt|;
block|}
end_function

begin_comment
comment|/**** Superpackets ****/
end_comment

begin_function
name|void
name|cmd_0x8E0Bq
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
comment|/* 8E-0B to query 8F-0B controls */
block|{
name|cmd
operator|->
name|len
operator|=
literal|1
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x8E
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
literal|0x0B
expr_stmt|;
block|}
end_function

begin_function
name|void
name|cmd_0x8E41q
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
comment|/* 8F-41 to query board serial number */
block|{
name|cmd
operator|->
name|len
operator|=
literal|1
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x8E
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
literal|0x41
expr_stmt|;
block|}
end_function

begin_function
name|void
name|cmd_0x8E42q
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
comment|/* 8F-42 to query product serial number */
block|{
name|cmd
operator|->
name|len
operator|=
literal|1
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x8E
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
literal|0x42
expr_stmt|;
block|}
end_function

begin_function
name|void
name|cmd_0x8E4Aq
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
comment|/* 8F-4A to query PPS parameters */
block|{
name|cmd
operator|->
name|len
operator|=
literal|1
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x8E
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
literal|0x4A
expr_stmt|;
block|}
end_function

begin_comment
comment|/* set i/o options */
end_comment

begin_function
name|void
name|cmd_0x8E4As
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|char
name|PPSOnOff
parameter_list|,
name|unsigned
name|char
name|TimeBase
parameter_list|,
name|unsigned
name|char
name|Polarity
parameter_list|,
name|double
name|PPSOffset
parameter_list|,
name|float
name|Uncertainty
parameter_list|)
block|{
name|cmd
operator|->
name|len
operator|=
literal|16
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x8E
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
literal|0x4A
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|1
index|]
operator|=
name|PPSOnOff
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|2
index|]
operator|=
name|TimeBase
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|3
index|]
operator|=
name|Polarity
expr_stmt|;
name|bPutDouble
argument_list|(
operator|&
name|PPSOffset
argument_list|,
operator|&
name|cmd
operator|->
name|buf
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|bPutFloat
argument_list|(
operator|&
name|Uncertainty
argument_list|,
operator|&
name|cmd
operator|->
name|buf
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|cmd_0x8E4Bq
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
comment|/* 8F-4B query survey limit */
block|{
name|cmd
operator|->
name|len
operator|=
literal|1
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x8E
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
literal|0x4B
expr_stmt|;
block|}
end_function

begin_comment
comment|/* poll for UTC superpacket */
end_comment

begin_function
name|void
name|cmd_0x8EADq
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|)
comment|/* 8E-AD to query 8F-AD controls */
block|{
name|cmd
operator|->
name|len
operator|=
literal|1
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x8E
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
literal|0xAD
expr_stmt|;
block|}
end_function

begin_comment
comment|/* all outomatic packet output off */
end_comment

begin_function
name|void
name|cmd_0x8E4Ds
parameter_list|(
name|TSIPPKT
modifier|*
name|cmd
parameter_list|,
name|unsigned
name|long
name|AutoOutputMask
parameter_list|)
block|{
name|cmd
operator|->
name|len
operator|=
literal|5
expr_stmt|;
name|cmd
operator|->
name|code
operator|=
literal|0x8E
expr_stmt|;
name|cmd
operator|->
name|buf
index|[
literal|0
index|]
operator|=
literal|0x4D
expr_stmt|;
name|bPutULong
argument_list|(
operator|&
name|AutoOutputMask
argument_list|,
operator|&
name|cmd
operator|->
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* for DOS machines, reverse order of bytes as they come through the  * serial port. */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|BYTESWAP
end_ifdef

begin_function
specifier|static
name|short
name|bGetShort
parameter_list|(
name|unsigned
name|char
modifier|*
name|bp
parameter_list|)
block|{
name|short
name|outval
decl_stmt|;
name|unsigned
name|char
modifier|*
name|optr
decl_stmt|;
name|optr
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|outval
operator|+
literal|1
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|=
operator|*
name|bp
expr_stmt|;
return|return
name|outval
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|TRIMBLE_OUTPUT_FUNC
end_ifdef

begin_function
specifier|static
name|unsigned
name|short
name|bGetUShort
parameter_list|(
name|unsigned
name|char
modifier|*
name|bp
parameter_list|)
block|{
name|unsigned
name|short
name|outval
decl_stmt|;
name|unsigned
name|char
modifier|*
name|optr
decl_stmt|;
name|optr
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|outval
operator|+
literal|1
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|=
operator|*
name|bp
expr_stmt|;
return|return
name|outval
return|;
block|}
end_function

begin_function
specifier|static
name|long
name|bGetLong
parameter_list|(
name|unsigned
name|char
modifier|*
name|bp
parameter_list|)
block|{
name|long
name|outval
decl_stmt|;
name|unsigned
name|char
modifier|*
name|optr
decl_stmt|;
name|optr
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|outval
operator|+
literal|3
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|=
operator|*
name|bp
expr_stmt|;
return|return
name|outval
return|;
block|}
end_function

begin_function
specifier|static
name|unsigned
name|long
name|bGetULong
parameter_list|(
name|unsigned
name|char
modifier|*
name|bp
parameter_list|)
block|{
name|unsigned
name|long
name|outval
decl_stmt|;
name|unsigned
name|char
modifier|*
name|optr
decl_stmt|;
name|optr
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|outval
operator|+
literal|3
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|=
operator|*
name|bp
expr_stmt|;
return|return
name|outval
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* TRIMBLE_OUTPUT_FUNC */
end_comment

begin_function
specifier|static
name|float
name|bGetSingle
parameter_list|(
name|unsigned
name|char
modifier|*
name|bp
parameter_list|)
block|{
name|float
name|outval
decl_stmt|;
name|unsigned
name|char
modifier|*
name|optr
decl_stmt|;
name|optr
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|outval
operator|+
literal|3
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|=
operator|*
name|bp
expr_stmt|;
return|return
name|outval
return|;
block|}
end_function

begin_function
specifier|static
name|double
name|bGetDouble
parameter_list|(
name|unsigned
name|char
modifier|*
name|bp
parameter_list|)
block|{
name|double
name|outval
decl_stmt|;
name|unsigned
name|char
modifier|*
name|optr
decl_stmt|;
name|optr
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|outval
operator|+
literal|7
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|--
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
operator|*
name|optr
operator|=
operator|*
name|bp
expr_stmt|;
return|return
name|outval
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* not BYTESWAP */
end_comment

begin_define
define|#
directive|define
name|bGetShort
parameter_list|(
name|bp
parameter_list|)
value|(*(short*)(bp))
end_define

begin_define
define|#
directive|define
name|bGetLong
parameter_list|(
name|bp
parameter_list|)
value|(*(long*)(bp))
end_define

begin_define
define|#
directive|define
name|bGetULong
parameter_list|(
name|bp
parameter_list|)
value|(*(unsigned long*)(bp))
end_define

begin_define
define|#
directive|define
name|bGetSingle
parameter_list|(
name|bp
parameter_list|)
value|(*(float*)(bp))
end_define

begin_define
define|#
directive|define
name|bGetDouble
parameter_list|(
name|bp
parameter_list|)
value|(*(double*)(bp))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* BYTESWAP */
end_comment

begin_comment
comment|/*  * Byte-reversal is necessary for little-endian (Intel-based) machines.  * TSIP streams are Big-endian (Motorola-based).  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|BYTESWAP
end_ifdef

begin_function
name|void
name|bPutFloat
parameter_list|(
name|float
modifier|*
name|in
parameter_list|,
name|unsigned
name|char
modifier|*
name|out
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|inptr
decl_stmt|;
name|inptr
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|in
operator|+
literal|3
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|=
operator|*
name|inptr
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|bPutULong
parameter_list|(
name|unsigned
name|long
modifier|*
name|in
parameter_list|,
name|unsigned
name|char
modifier|*
name|out
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|inptr
decl_stmt|;
name|inptr
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|in
operator|+
literal|3
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|=
operator|*
name|inptr
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|bPutDouble
parameter_list|(
name|double
modifier|*
name|in
parameter_list|,
name|unsigned
name|char
modifier|*
name|out
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|inptr
decl_stmt|;
name|inptr
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|in
operator|+
literal|7
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|++
operator|=
operator|*
name|inptr
operator|--
expr_stmt|;
operator|*
name|out
operator|=
operator|*
name|inptr
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* not BYTESWAP */
end_comment

begin_function
name|void
name|bPutShort
parameter_list|(
name|short
name|a
parameter_list|,
name|unsigned
name|char
modifier|*
name|cmdbuf
parameter_list|)
block|{
operator|*
operator|(
name|short
operator|*
operator|)
name|cmdbuf
operator|=
name|a
expr_stmt|;
block|}
end_function

begin_function
name|void
name|bPutULong
parameter_list|(
name|long
name|a
parameter_list|,
name|unsigned
name|char
modifier|*
name|cmdbuf
parameter_list|)
block|{
operator|*
operator|(
name|long
operator|*
operator|)
name|cmdbuf
operator|=
name|a
expr_stmt|;
block|}
end_function

begin_function
name|void
name|bPutFloat
parameter_list|(
name|float
name|a
parameter_list|,
name|unsigned
name|char
modifier|*
name|cmdbuf
parameter_list|)
block|{
operator|*
operator|(
name|float
operator|*
operator|)
name|cmdbuf
operator|=
name|a
expr_stmt|;
block|}
end_function

begin_function
name|void
name|bPutDouble
parameter_list|(
name|double
name|a
parameter_list|,
name|unsigned
name|char
modifier|*
name|cmdbuf
parameter_list|)
block|{
operator|*
operator|(
name|double
operator|*
operator|)
name|cmdbuf
operator|=
name|a
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* BYTESWAP */
end_comment

begin_comment
comment|/*  * Parse primary utc time packet  * and fill refclock structure   * from results.   *  * 0 = success  * -1 = errors  */
end_comment

begin_function
specifier|static
name|int
name|parse0x8FAD
parameter_list|(
name|rpt
parameter_list|,
name|peer
parameter_list|)
name|TSIPPKT
modifier|*
name|rpt
decl_stmt|;
name|struct
name|peer
modifier|*
name|peer
decl_stmt|;
block|{
specifier|register
name|struct
name|refclockproc
modifier|*
name|pp
decl_stmt|;
specifier|register
name|struct
name|ripencc_unit
modifier|*
name|up
decl_stmt|;
name|unsigned
name|day
decl_stmt|,
name|month
decl_stmt|,
name|year
decl_stmt|;
comment|/* data derived from received timecode */
name|unsigned
name|hour
decl_stmt|,
name|minute
decl_stmt|,
name|second
decl_stmt|;
name|unsigned
name|char
name|trackstat
decl_stmt|,
name|utcflags
decl_stmt|;
specifier|static
name|char
name|logbuf
index|[
literal|1024
index|]
decl_stmt|;
comment|/* logging string buffer */
name|int
name|i
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
name|pp
operator|=
name|peer
operator|->
name|procptr
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|22
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
operator|!=
literal|0
condition|)
block|{
ifdef|#
directive|ifdef
name|DEBUG_NCC
if|if
condition|(
name|debug
condition|)
name|printf
argument_list|(
literal|"parse0x8FAD: event count != 0\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_NCC */
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|3
index|]
argument_list|)
operator|!=
literal|0.0
condition|)
block|{
ifdef|#
directive|ifdef
name|DEBUG_NCC
if|if
condition|(
name|debug
condition|)
name|printf
argument_list|(
literal|"parse0x8FAD: fracsecs != 0\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_NCC */
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|hour
operator|=
operator|(
name|unsigned
name|int
operator|)
name|buf
index|[
literal|11
index|]
expr_stmt|;
name|minute
operator|=
operator|(
name|unsigned
name|int
operator|)
name|buf
index|[
literal|12
index|]
expr_stmt|;
name|second
operator|=
operator|(
name|unsigned
name|int
operator|)
name|buf
index|[
literal|13
index|]
expr_stmt|;
name|day
operator|=
operator|(
name|unsigned
name|int
operator|)
name|buf
index|[
literal|14
index|]
expr_stmt|;
name|month
operator|=
operator|(
name|unsigned
name|int
operator|)
name|buf
index|[
literal|15
index|]
expr_stmt|;
name|year
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
name|trackstat
operator|=
name|buf
index|[
literal|18
index|]
expr_stmt|;
name|utcflags
operator|=
name|buf
index|[
literal|19
index|]
expr_stmt|;
name|sprintf
argument_list|(
name|logbuf
argument_list|,
literal|"U1 %d.%d.%d %02d:%02d:%02d %d %02x"
argument_list|,
name|day
argument_list|,
name|month
argument_list|,
name|year
argument_list|,
name|hour
argument_list|,
name|minute
argument_list|,
name|second
argument_list|,
name|trackstat
argument_list|,
name|utcflags
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_NCC
if|if
condition|(
name|debug
condition|)
name|puts
argument_list|(
name|logbuf
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_NCC */
name|record_clock_stats
argument_list|(
operator|&
name|peer
operator|->
name|srcadr
argument_list|,
name|logbuf
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|utcflags
operator|&
name|UTCF_UTC_AVAIL
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
comment|/* poll for UTC parameters once and then if UTC flag changed */
name|up
operator|=
operator|(
expr|struct
name|ripencc_unit
operator|*
operator|)
name|pp
operator|->
name|unitptr
expr_stmt|;
if|if
condition|(
name|utcflags
operator|!=
name|up
operator|->
name|utcflags
condition|)
block|{
name|TSIPPKT
name|spt
decl_stmt|;
comment|/* local structure for send packet */
name|cmd_0x2F
argument_list|(
operator|&
name|spt
argument_list|)
expr_stmt|;
comment|/* request UTC params */
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
name|up
operator|->
name|utcflags
operator|=
name|utcflags
expr_stmt|;
block|}
comment|/* 	 * If we hit the leap second, we choose to skip this sample 	 * rather than rely on other code to be perfectly correct. 	 * No offense, just defense ;-). 	 */
if|if
condition|(
name|second
operator|==
literal|60
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
comment|/* now check and convert the time we received */
name|pp
operator|->
name|year
operator|=
name|year
expr_stmt|;
if|if
condition|(
name|month
operator|<
literal|1
operator|||
name|month
operator|>
literal|12
operator|||
name|day
operator|<
literal|1
operator|||
name|day
operator|>
literal|31
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|pp
operator|->
name|year
operator|%
literal|4
condition|)
block|{
if|if
condition|(
name|day
operator|>
name|day1tab
index|[
name|month
operator|-
literal|1
index|]
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|month
operator|-
literal|1
condition|;
name|i
operator|++
control|)
name|day
operator|+=
name|day1tab
index|[
name|i
index|]
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|day
operator|>
name|day2tab
index|[
name|month
operator|-
literal|1
index|]
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|month
operator|-
literal|1
condition|;
name|i
operator|++
control|)
name|day
operator|+=
name|day2tab
index|[
name|i
index|]
expr_stmt|;
block|}
name|pp
operator|->
name|day
operator|=
name|day
expr_stmt|;
name|pp
operator|->
name|hour
operator|=
name|hour
expr_stmt|;
name|pp
operator|->
name|minute
operator|=
name|minute
expr_stmt|;
name|pp
operator|->
name|second
operator|=
name|second
expr_stmt|;
name|pp
operator|->
name|nsec
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|utcflags
operator|&
name|UTCF_LEAP_PNDG
operator|)
operator|&&
name|up
operator|->
name|leapdelta
operator|!=
literal|0
condition|)
name|pp
operator|->
name|leap
operator|=
operator|(
name|up
operator|->
name|leapdelta
operator|>
literal|0
condition|?
name|LEAP_ADDSECOND
else|:
name|LEAP_DELSECOND
operator|)
expr_stmt|;
else|else
name|pp
operator|->
name|leap
operator|=
name|LEAP_NOWARNING
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Parse comprehensive time packet   *  * 0 = success  * -1 = errors  */
end_comment

begin_function
name|int
name|parse0x8F0B
parameter_list|(
name|rpt
parameter_list|,
name|peer
parameter_list|)
name|TSIPPKT
modifier|*
name|rpt
decl_stmt|;
name|struct
name|peer
modifier|*
name|peer
decl_stmt|;
block|{
specifier|register
name|struct
name|refclockproc
modifier|*
name|pp
decl_stmt|;
name|unsigned
name|day
decl_stmt|,
name|month
decl_stmt|,
name|year
decl_stmt|;
comment|/* data derived from received timecode */
name|unsigned
name|hour
decl_stmt|,
name|minute
decl_stmt|,
name|second
decl_stmt|;
name|unsigned
name|utcoff
decl_stmt|;
name|unsigned
name|char
name|mode
decl_stmt|;
name|double
name|bias
decl_stmt|,
name|rate
decl_stmt|;
name|float
name|biasunc
decl_stmt|,
name|rateunc
decl_stmt|;
name|double
name|lat
decl_stmt|,
name|lon
decl_stmt|,
name|alt
decl_stmt|;
name|short
name|lat_deg
decl_stmt|,
name|lon_deg
decl_stmt|;
name|float
name|lat_min
decl_stmt|,
name|lon_min
decl_stmt|;
name|unsigned
name|char
name|north_south
decl_stmt|,
name|east_west
decl_stmt|;
name|char
name|sv
index|[
literal|9
index|]
decl_stmt|;
specifier|static
name|char
name|logbuf
index|[
literal|1024
index|]
decl_stmt|;
comment|/* logging string buffer */
name|unsigned
name|char
name|b
decl_stmt|;
name|int
name|i
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|double
name|tow
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
name|pp
operator|=
name|peer
operator|->
name|procptr
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|74
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
operator|!=
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
empty_stmt|;
name|tow
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|tow
operator|==
operator|-
literal|1.0
condition|)
block|{
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
elseif|else
if|if
condition|(
operator|(
name|tow
operator|>=
literal|604800.0
operator|)
operator|||
operator|(
name|tow
operator|<
literal|0.0
operator|)
condition|)
block|{
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
else|else
block|{
if|if
condition|(
name|tow
operator|<
literal|604799.9
condition|)
name|tow
operator|=
name|tow
operator|+
literal|.00000001
expr_stmt|;
name|second
operator|=
operator|(
name|unsigned
name|int
operator|)
name|fmod
argument_list|(
name|tow
argument_list|,
literal|60.
argument_list|)
expr_stmt|;
name|minute
operator|=
operator|(
name|unsigned
name|int
operator|)
name|fmod
argument_list|(
name|tow
operator|/
literal|60.
argument_list|,
literal|60.
argument_list|)
expr_stmt|;
name|hour
operator|=
operator|(
name|unsigned
name|int
operator|)
name|fmod
argument_list|(
name|tow
operator|/
literal|3600.
argument_list|,
literal|24.
argument_list|)
expr_stmt|;
block|}
name|day
operator|=
operator|(
name|unsigned
name|int
operator|)
name|buf
index|[
literal|11
index|]
expr_stmt|;
name|month
operator|=
operator|(
name|unsigned
name|int
operator|)
name|buf
index|[
literal|12
index|]
expr_stmt|;
name|year
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
name|mode
operator|=
name|buf
index|[
literal|15
index|]
expr_stmt|;
name|utcoff
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
name|bias
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|18
index|]
argument_list|)
operator|/
name|GPS_C
operator|*
literal|1e9
expr_stmt|;
comment|/* ns */
name|rate
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|26
index|]
argument_list|)
operator|/
name|GPS_C
operator|*
literal|1e9
expr_stmt|;
comment|/* ppb */
name|biasunc
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|34
index|]
argument_list|)
operator|/
name|GPS_C
operator|*
literal|1e9
expr_stmt|;
comment|/* ns */
name|rateunc
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|38
index|]
argument_list|)
operator|/
name|GPS_C
operator|*
literal|1e9
expr_stmt|;
comment|/* ppb */
name|lat
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|42
index|]
argument_list|)
operator|*
name|R2D
expr_stmt|;
name|lon
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|50
index|]
argument_list|)
operator|*
name|R2D
expr_stmt|;
name|alt
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|58
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|lat
operator|<
literal|0.0
condition|)
block|{
name|north_south
operator|=
literal|'S'
expr_stmt|;
name|lat
operator|=
operator|-
name|lat
expr_stmt|;
block|}
else|else
block|{
name|north_south
operator|=
literal|'N'
expr_stmt|;
block|}
name|lat_deg
operator|=
operator|(
name|short
operator|)
name|lat
expr_stmt|;
name|lat_min
operator|=
operator|(
name|lat
operator|-
name|lat_deg
operator|)
operator|*
literal|60.0
expr_stmt|;
if|if
condition|(
name|lon
operator|<
literal|0.0
condition|)
block|{
name|east_west
operator|=
literal|'W'
expr_stmt|;
name|lon
operator|=
operator|-
name|lon
expr_stmt|;
block|}
else|else
block|{
name|east_west
operator|=
literal|'E'
expr_stmt|;
block|}
name|lon_deg
operator|=
operator|(
name|short
operator|)
name|lon
expr_stmt|;
name|lon_min
operator|=
operator|(
name|lon
operator|-
name|lon_deg
operator|)
operator|*
literal|60.0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|sv
index|[
name|i
index|]
operator|=
name|buf
index|[
name|i
operator|+
literal|66
index|]
expr_stmt|;
if|if
condition|(
name|sv
index|[
name|i
index|]
condition|)
block|{
name|TSIPPKT
name|spt
decl_stmt|;
comment|/* local structure for sendpacket */
name|b
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|sv
index|[
name|i
index|]
operator|<
literal|0
condition|?
operator|-
name|sv
index|[
name|i
index|]
else|:
name|sv
index|[
name|i
index|]
argument_list|)
expr_stmt|;
comment|/* request tracking status */
name|cmd_0x3C
argument_list|(
operator|&
name|spt
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|ripencc_send
argument_list|(
name|peer
argument_list|,
name|spt
argument_list|)
expr_stmt|;
block|}
block|}
name|sprintf
argument_list|(
name|logbuf
argument_list|,
literal|"C1 %02d%02d%04d %02d%02d%02d %d %7.0f %.1f %.0f %.1f %d %02d%09.6f %c %02d%09.6f %c %.0f  %d %d %d %d %d %d %d %d"
argument_list|,
name|day
argument_list|,
name|month
argument_list|,
name|year
argument_list|,
name|hour
argument_list|,
name|minute
argument_list|,
name|second
argument_list|,
name|mode
argument_list|,
name|bias
argument_list|,
name|biasunc
argument_list|,
name|rate
argument_list|,
name|rateunc
argument_list|,
name|utcoff
argument_list|,
name|lat_deg
argument_list|,
name|lat_min
argument_list|,
name|north_south
argument_list|,
name|lon_deg
argument_list|,
name|lon_min
argument_list|,
name|east_west
argument_list|,
name|alt
argument_list|,
name|sv
index|[
literal|0
index|]
argument_list|,
name|sv
index|[
literal|1
index|]
argument_list|,
name|sv
index|[
literal|2
index|]
argument_list|,
name|sv
index|[
literal|3
index|]
argument_list|,
name|sv
index|[
literal|4
index|]
argument_list|,
name|sv
index|[
literal|5
index|]
argument_list|,
name|sv
index|[
literal|6
index|]
argument_list|,
name|sv
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_NCC
if|if
condition|(
name|debug
condition|)
name|puts
argument_list|(
name|logbuf
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_NCC */
name|record_clock_stats
argument_list|(
operator|&
name|peer
operator|->
name|srcadr
argument_list|,
name|logbuf
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|TRIMBLE_OUTPUT_FUNC
end_ifdef

begin_comment
comment|/*   * Parse any packet using Trimble machinery  */
end_comment

begin_function
name|int
name|parseany
parameter_list|(
name|rpt
parameter_list|,
name|peer
parameter_list|)
name|TSIPPKT
modifier|*
name|rpt
decl_stmt|;
name|struct
name|peer
modifier|*
name|peer
decl_stmt|;
block|{
specifier|static
name|char
name|logbuf
index|[
literal|1024
index|]
decl_stmt|;
comment|/* logging string buffer */
name|TranslateTSIPReportToText
argument_list|(
name|rpt
argument_list|,
name|logbuf
argument_list|)
expr_stmt|;
comment|/* anything else */
ifdef|#
directive|ifdef
name|DEBUG_NCC
if|if
condition|(
name|debug
condition|)
name|puts
argument_list|(
operator|&
name|logbuf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_NCC */
name|record_clock_stats
argument_list|(
operator|&
name|peer
operator|->
name|srcadr
argument_list|,
operator|&
name|logbuf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* TRIMBLE_OUTPUT_FUNC */
end_comment

begin_comment
comment|/*  * Parse UTC Parameter Packet  *   * See the IDE for documentation!  *  * 0 = success  * -1 = errors  */
end_comment

begin_function
name|int
name|parse0x4F
parameter_list|(
name|rpt
parameter_list|,
name|peer
parameter_list|)
name|TSIPPKT
modifier|*
name|rpt
decl_stmt|;
name|struct
name|peer
modifier|*
name|peer
decl_stmt|;
block|{
specifier|register
name|struct
name|ripencc_unit
modifier|*
name|up
decl_stmt|;
name|double
name|a0
decl_stmt|;
name|float
name|a1
decl_stmt|,
name|tot
decl_stmt|;
name|int
name|dt_ls
decl_stmt|,
name|wn_t
decl_stmt|,
name|wn_lsf
decl_stmt|,
name|dn
decl_stmt|,
name|dt_lsf
decl_stmt|;
specifier|static
name|char
name|logbuf
index|[
literal|1024
index|]
decl_stmt|;
comment|/* logging string buffer */
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|26
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|a0
operator|=
name|bGetDouble
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|a1
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
name|dt_ls
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
name|tot
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|14
index|]
argument_list|)
expr_stmt|;
name|wn_t
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|18
index|]
argument_list|)
expr_stmt|;
name|wn_lsf
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|20
index|]
argument_list|)
expr_stmt|;
name|dn
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|22
index|]
argument_list|)
expr_stmt|;
name|dt_lsf
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|24
index|]
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|logbuf
argument_list|,
literal|"L1 %d %d %d %g %g %g %d %d %d"
argument_list|,
name|dt_lsf
operator|-
name|dt_ls
argument_list|,
name|dt_ls
argument_list|,
name|dt_lsf
argument_list|,
name|a0
argument_list|,
name|a1
argument_list|,
name|tot
argument_list|,
name|wn_t
argument_list|,
name|wn_lsf
argument_list|,
name|dn
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_NCC
if|if
condition|(
name|debug
condition|)
name|puts
argument_list|(
name|logbuf
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_NCC */
name|record_clock_stats
argument_list|(
operator|&
name|peer
operator|->
name|srcadr
argument_list|,
name|logbuf
argument_list|)
expr_stmt|;
name|up
operator|=
operator|(
expr|struct
name|ripencc_unit
operator|*
operator|)
name|peer
operator|->
name|procptr
operator|->
name|unitptr
expr_stmt|;
name|up
operator|->
name|leapdelta
operator|=
name|dt_lsf
operator|-
name|dt_ls
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Parse Tracking Status packet  *  * 0 = success  * -1 = errors  */
end_comment

begin_function
name|int
name|parse0x5C
parameter_list|(
name|rpt
parameter_list|,
name|peer
parameter_list|)
name|TSIPPKT
modifier|*
name|rpt
decl_stmt|;
name|struct
name|peer
modifier|*
name|peer
decl_stmt|;
block|{
name|unsigned
name|char
name|prn
decl_stmt|,
name|channel
decl_stmt|,
name|aqflag
decl_stmt|,
name|ephstat
decl_stmt|;
name|float
name|snr
decl_stmt|,
name|azinuth
decl_stmt|,
name|elevation
decl_stmt|;
specifier|static
name|char
name|logbuf
index|[
literal|1024
index|]
decl_stmt|;
comment|/* logging string buffer */
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|24
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|prn
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
name|channel
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|buf
index|[
literal|1
index|]
operator|>>
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
operator|==
literal|0x10
condition|)
name|channel
operator|=
literal|2
expr_stmt|;
else|else
name|channel
operator|++
expr_stmt|;
name|aqflag
operator|=
name|buf
index|[
literal|2
index|]
expr_stmt|;
name|ephstat
operator|=
name|buf
index|[
literal|3
index|]
expr_stmt|;
name|snr
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|elevation
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|12
index|]
argument_list|)
operator|*
name|R2D
expr_stmt|;
name|azinuth
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|16
index|]
argument_list|)
operator|*
name|R2D
expr_stmt|;
name|sprintf
argument_list|(
name|logbuf
argument_list|,
literal|"S1 %02d %d %d %02x %4.1f %5.1f %4.1f"
argument_list|,
name|prn
argument_list|,
name|channel
argument_list|,
name|aqflag
argument_list|,
name|ephstat
argument_list|,
name|snr
argument_list|,
name|azinuth
argument_list|,
name|elevation
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_NCC
if|if
condition|(
name|debug
condition|)
name|puts
argument_list|(
name|logbuf
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG_NCC */
name|record_clock_stats
argument_list|(
operator|&
name|peer
operator|->
name|srcadr
argument_list|,
name|logbuf
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/******* Code below is from Trimble Tsipchat *************/
end_comment

begin_comment
comment|/*  * *************************************************************************  *  * Trimble Navigation, Ltd.  * OEM Products Development Group  * P.O. Box 3642  * 645 North Mary Avenue  * Sunnyvale, California 94088-3642  *  * Corporate Headquarter:  *    Telephone:  (408) 481-8000  *    Fax:        (408) 481-6005  *  * Technical Support Center:  *    Telephone:  (800) 767-4822	(U.S. and Canada)  *                (408) 481-6940    (outside U.S. and Canada)  *    Fax:        (408) 481-6020  *    BBS:        (408) 481-7800  *    e-mail:     trimble_support@trimble.com  *		ftp://ftp.trimble.com/pub/sct/embedded/bin  *  * *************************************************************************  *  * -------  BYTE-SWAPPING  -------  * TSIP is big-endian (Motorola) protocol.  To use on little-endian (Intel)  * systems, the bytes of all multi-byte types (shorts, floats, doubles, etc.)  * must be reversed.  This is controlled by the MACRO BYTESWAP; if defined, it  * assumes little-endian protocol.  * --------------------------------  *  * T_PARSER.C and T_PARSER.H contains primitive functions that interpret  * reports received from the receiver.  A second source file pair,  * T_FORMAT.C and T_FORMAT.H, contin the matching TSIP command formatters.  *  * The module is in very portable, basic C language.  It can be used as is, or  * with minimal changes if a TSIP communications application is needed separate  * from TSIPCHAT. The construction of most argument lists avoid the use of  * structures, but the developer is encouraged to reconstruct them using such  * definitions to meet project requirements.  Declarations of T_PARSER.C  * functions are included in T_PARSER.H to provide prototyping definitions.  *  * There are two types of functions: a serial input processing routine,  *                            tsip_input_proc()  * which assembles incoming bytes into a TSIPPKT structure, and the  * report parsers, rpt_0x??().  *  * 1) The function tsip_input_proc() accumulates bytes from the receiver,  * strips control bytes (DLE), and checks if the report end sequence (DLE ETX)  * has been received.  rpt.status is defined as TSIP_PARSED_FULL (== 1)  * if a complete packet is available.  *  * 2) The functions rpt_0x??() are report string interpreters patterned after  * the document called "Trimble Standard Interface Protocol".  It should be  * noted that if the report buffer is sent into the receiver with the wrong  * length (byte count), the rpt_0x??() returns the Boolean equivalence for  * TRUE.  *  * *************************************************************************  *  */
end_comment

begin_comment
comment|/**/
end_comment

begin_function
specifier|static
name|void
name|tsip_input_proc
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|int
name|inbyte
parameter_list|)
comment|/* reads bytes until serial buffer is empty or a complete report  * has been received; end of report is signified by DLE ETX.  */
block|{
name|unsigned
name|char
name|newbyte
decl_stmt|;
if|if
condition|(
name|inbyte
operator|<
literal|0
operator|||
name|inbyte
operator|>
literal|0xFF
condition|)
return|return;
name|newbyte
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|inbyte
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|rpt
operator|->
name|status
condition|)
block|{
case|case
name|TSIP_PARSED_DLE_1
case|:
switch|switch
condition|(
name|newbyte
condition|)
block|{
case|case
literal|0
case|:
case|case
name|ETX
case|:
comment|/* illegal TSIP IDs */
name|rpt
operator|->
name|len
operator|=
literal|0
expr_stmt|;
name|rpt
operator|->
name|status
operator|=
name|TSIP_PARSED_EMPTY
expr_stmt|;
break|break;
case|case
name|DLE
case|:
comment|/* try normal message start again */
name|rpt
operator|->
name|len
operator|=
literal|0
expr_stmt|;
name|rpt
operator|->
name|status
operator|=
name|TSIP_PARSED_DLE_1
expr_stmt|;
break|break;
default|default:
comment|/* legal TSIP ID; start message */
name|rpt
operator|->
name|code
operator|=
name|newbyte
expr_stmt|;
name|rpt
operator|->
name|len
operator|=
literal|0
expr_stmt|;
name|rpt
operator|->
name|status
operator|=
name|TSIP_PARSED_DATA
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|TSIP_PARSED_DATA
case|:
switch|switch
condition|(
name|newbyte
condition|)
block|{
case|case
name|DLE
case|:
comment|/* expect DLE or ETX next */
name|rpt
operator|->
name|status
operator|=
name|TSIP_PARSED_DLE_2
expr_stmt|;
break|break;
default|default:
comment|/* normal data byte  */
name|rpt
operator|->
name|buf
index|[
name|rpt
operator|->
name|len
index|]
operator|=
name|newbyte
expr_stmt|;
name|rpt
operator|->
name|len
operator|++
expr_stmt|;
comment|/* no change in rpt->status */
break|break;
block|}
break|break;
case|case
name|TSIP_PARSED_DLE_2
case|:
switch|switch
condition|(
name|newbyte
condition|)
block|{
case|case
name|DLE
case|:
comment|/* normal data byte */
name|rpt
operator|->
name|buf
index|[
name|rpt
operator|->
name|len
index|]
operator|=
name|newbyte
expr_stmt|;
name|rpt
operator|->
name|len
operator|++
expr_stmt|;
name|rpt
operator|->
name|status
operator|=
name|TSIP_PARSED_DATA
expr_stmt|;
break|break;
case|case
name|ETX
case|:
comment|/* end of message; return TRUE here. */
name|rpt
operator|->
name|status
operator|=
name|TSIP_PARSED_FULL
expr_stmt|;
break|break;
default|default:
comment|/* error: treat as TSIP_PARSED_DLE_1; start new report packet */
name|rpt
operator|->
name|code
operator|=
name|newbyte
expr_stmt|;
name|rpt
operator|->
name|len
operator|=
literal|0
expr_stmt|;
name|rpt
operator|->
name|status
operator|=
name|TSIP_PARSED_DATA
expr_stmt|;
block|}
break|break;
case|case
name|TSIP_PARSED_FULL
case|:
case|case
name|TSIP_PARSED_EMPTY
case|:
default|default:
switch|switch
condition|(
name|newbyte
condition|)
block|{
case|case
name|DLE
case|:
comment|/* normal message start */
name|rpt
operator|->
name|len
operator|=
literal|0
expr_stmt|;
name|rpt
operator|->
name|status
operator|=
name|TSIP_PARSED_DLE_1
expr_stmt|;
break|break;
default|default:
comment|/* error: ignore newbyte */
name|rpt
operator|->
name|len
operator|=
literal|0
expr_stmt|;
name|rpt
operator|->
name|status
operator|=
name|TSIP_PARSED_EMPTY
expr_stmt|;
block|}
break|break;
block|}
if|if
condition|(
name|rpt
operator|->
name|len
operator|>
name|MAX_RPTBUF
condition|)
block|{
comment|/* error: start new report packet */
name|rpt
operator|->
name|status
operator|=
name|TSIP_PARSED_EMPTY
expr_stmt|;
name|rpt
operator|->
name|len
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|TRIMBLE_OUTPUT_FUNC
end_ifdef

begin_comment
comment|/**/
end_comment

begin_function
name|short
name|rpt_0x3D
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|tx_baud_index
parameter_list|,
name|unsigned
name|char
modifier|*
name|rx_baud_index
parameter_list|,
name|unsigned
name|char
modifier|*
name|char_format_index
parameter_list|,
name|unsigned
name|char
modifier|*
name|stop_bits
parameter_list|,
name|unsigned
name|char
modifier|*
name|tx_mode_index
parameter_list|,
name|unsigned
name|char
modifier|*
name|rx_mode_index
parameter_list|)
comment|/* Channel A configuration for dual port operation */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|6
condition|)
return|return
name|TRUE
return|;
operator|*
name|tx_baud_index
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|rx_baud_index
operator|=
name|buf
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|char_format_index
operator|=
name|buf
index|[
literal|2
index|]
expr_stmt|;
operator|*
name|stop_bits
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
operator|(
name|buf
index|[
literal|3
index|]
operator|==
literal|0x07
operator|)
condition|?
literal|1
else|:
literal|2
argument_list|)
expr_stmt|;
operator|*
name|tx_mode_index
operator|=
name|buf
index|[
literal|4
index|]
expr_stmt|;
operator|*
name|rx_mode_index
operator|=
name|buf
index|[
literal|5
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/**/
end_comment

begin_function
name|short
name|rpt_0x40
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|short
modifier|*
name|week_num
parameter_list|,
name|float
modifier|*
name|t_zc
parameter_list|,
name|float
modifier|*
name|eccentricity
parameter_list|,
name|float
modifier|*
name|t_oa
parameter_list|,
name|float
modifier|*
name|i_0
parameter_list|,
name|float
modifier|*
name|OMEGA_dot
parameter_list|,
name|float
modifier|*
name|sqrt_A
parameter_list|,
name|float
modifier|*
name|OMEGA_0
parameter_list|,
name|float
modifier|*
name|omega
parameter_list|,
name|float
modifier|*
name|M_0
parameter_list|)
comment|/* almanac data for specified satellite */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|39
condition|)
return|return
name|TRUE
return|;
operator|*
name|sv_prn
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|t_zc
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
operator|*
name|week_num
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
operator|*
name|eccentricity
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
operator|*
name|t_oa
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
operator|*
name|i_0
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
operator|*
name|OMEGA_dot
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|19
index|]
argument_list|)
expr_stmt|;
operator|*
name|sqrt_A
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|23
index|]
argument_list|)
expr_stmt|;
operator|*
name|OMEGA_0
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|27
index|]
argument_list|)
expr_stmt|;
operator|*
name|omega
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|31
index|]
argument_list|)
expr_stmt|;
operator|*
name|M_0
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|35
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x41
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
modifier|*
name|time_of_week
parameter_list|,
name|float
modifier|*
name|UTC_offset
parameter_list|,
name|short
modifier|*
name|week_num
parameter_list|)
comment|/* GPS time */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|10
condition|)
return|return
name|TRUE
return|;
operator|*
name|time_of_week
operator|=
name|bGetSingle
argument_list|(
name|buf
argument_list|)
expr_stmt|;
operator|*
name|week_num
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
operator|*
name|UTC_offset
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x42
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
name|pos_ECEF
index|[
literal|3
index|]
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
comment|/* position in ECEF, single precision */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|16
condition|)
return|return
name|TRUE
return|;
name|pos_ECEF
index|[
literal|0
index|]
operator|=
name|bGetSingle
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|pos_ECEF
index|[
literal|1
index|]
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|pos_ECEF
index|[
literal|2
index|]
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
operator|*
name|time_of_fix
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x43
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
name|ECEF_vel
index|[
literal|3
index|]
parameter_list|,
name|float
modifier|*
name|freq_offset
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
comment|/* velocity in ECEF, single precision */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|20
condition|)
return|return
name|TRUE
return|;
name|ECEF_vel
index|[
literal|0
index|]
operator|=
name|bGetSingle
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|ECEF_vel
index|[
literal|1
index|]
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|ECEF_vel
index|[
literal|2
index|]
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
operator|*
name|freq_offset
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
operator|*
name|time_of_fix
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x45
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|major_nav_version
parameter_list|,
name|unsigned
name|char
modifier|*
name|minor_nav_version
parameter_list|,
name|unsigned
name|char
modifier|*
name|nav_day
parameter_list|,
name|unsigned
name|char
modifier|*
name|nav_month
parameter_list|,
name|unsigned
name|char
modifier|*
name|nav_year
parameter_list|,
name|unsigned
name|char
modifier|*
name|major_dsp_version
parameter_list|,
name|unsigned
name|char
modifier|*
name|minor_dsp_version
parameter_list|,
name|unsigned
name|char
modifier|*
name|dsp_day
parameter_list|,
name|unsigned
name|char
modifier|*
name|dsp_month
parameter_list|,
name|unsigned
name|char
modifier|*
name|dsp_year
parameter_list|)
comment|/* software versions */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|10
condition|)
return|return
name|TRUE
return|;
operator|*
name|major_nav_version
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|minor_nav_version
operator|=
name|buf
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|nav_day
operator|=
name|buf
index|[
literal|2
index|]
expr_stmt|;
operator|*
name|nav_month
operator|=
name|buf
index|[
literal|3
index|]
expr_stmt|;
operator|*
name|nav_year
operator|=
name|buf
index|[
literal|4
index|]
expr_stmt|;
operator|*
name|major_dsp_version
operator|=
name|buf
index|[
literal|5
index|]
expr_stmt|;
operator|*
name|minor_dsp_version
operator|=
name|buf
index|[
literal|6
index|]
expr_stmt|;
operator|*
name|dsp_day
operator|=
name|buf
index|[
literal|7
index|]
expr_stmt|;
operator|*
name|dsp_month
operator|=
name|buf
index|[
literal|8
index|]
expr_stmt|;
operator|*
name|dsp_year
operator|=
name|buf
index|[
literal|9
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x46
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|status1
parameter_list|,
name|unsigned
name|char
modifier|*
name|status2
parameter_list|)
comment|/* receiver health and status */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|2
condition|)
return|return
name|TRUE
return|;
operator|*
name|status1
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|status2
operator|=
name|buf
index|[
literal|1
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x47
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|nsvs
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|float
modifier|*
name|snr
parameter_list|)
comment|/* signal levels for all satellites tracked */
block|{
name|short
name|isv
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|1
operator|+
literal|5
operator|*
name|buf
index|[
literal|0
index|]
condition|)
return|return
name|TRUE
return|;
operator|*
name|nsvs
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
for|for
control|(
name|isv
operator|=
literal|0
init|;
name|isv
operator|<
operator|(
operator|*
name|nsvs
operator|)
condition|;
name|isv
operator|++
control|)
block|{
name|sv_prn
index|[
name|isv
index|]
operator|=
name|buf
index|[
literal|5
operator|*
name|isv
operator|+
literal|1
index|]
expr_stmt|;
name|snr
index|[
name|isv
index|]
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|5
operator|*
name|isv
operator|+
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x48
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|message
parameter_list|)
comment|/* GPS system message */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|22
condition|)
return|return
name|TRUE
return|;
name|memcpy
argument_list|(
name|message
argument_list|,
name|buf
argument_list|,
literal|22
argument_list|)
expr_stmt|;
name|message
index|[
literal|22
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x49
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_health
parameter_list|)
comment|/* health for all satellites from almanac health page */
block|{
name|short
name|i
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|32
condition|)
return|return
name|TRUE
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
name|sv_health
index|[
name|i
index|]
operator|=
name|buf
index|[
name|i
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x4A
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
modifier|*
name|lat
parameter_list|,
name|float
modifier|*
name|lon
parameter_list|,
name|float
modifier|*
name|alt
parameter_list|,
name|float
modifier|*
name|clock_bias
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
comment|/* position in lat-lon-alt, single precision */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|20
condition|)
return|return
name|TRUE
return|;
operator|*
name|lat
operator|=
name|bGetSingle
argument_list|(
name|buf
argument_list|)
expr_stmt|;
operator|*
name|lon
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
operator|*
name|alt
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
operator|*
name|clock_bias
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
operator|*
name|time_of_fix
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x4A_2
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
modifier|*
name|alt
parameter_list|,
name|float
modifier|*
name|dummy
parameter_list|,
name|unsigned
name|char
modifier|*
name|alt_flag
parameter_list|)
comment|/* reference altitude parameters */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|9
condition|)
return|return
name|TRUE
return|;
operator|*
name|alt
operator|=
name|bGetSingle
argument_list|(
name|buf
argument_list|)
expr_stmt|;
operator|*
name|dummy
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
operator|*
name|alt_flag
operator|=
name|buf
index|[
literal|8
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x4B
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|machine_id
parameter_list|,
name|unsigned
name|char
modifier|*
name|status3
parameter_list|,
name|unsigned
name|char
modifier|*
name|status4
parameter_list|)
comment|/* machine ID code, status */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|3
condition|)
return|return
name|TRUE
return|;
operator|*
name|machine_id
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|status3
operator|=
name|buf
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|status4
operator|=
name|buf
index|[
literal|2
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x4C
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|dyn_code
parameter_list|,
name|float
modifier|*
name|el_mask
parameter_list|,
name|float
modifier|*
name|snr_mask
parameter_list|,
name|float
modifier|*
name|dop_mask
parameter_list|,
name|float
modifier|*
name|dop_switch
parameter_list|)
comment|/* operating parameters and masks */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|17
condition|)
return|return
name|TRUE
return|;
operator|*
name|dyn_code
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|el_mask
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
operator|*
name|snr_mask
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
operator|*
name|dop_mask
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
operator|*
name|dop_switch
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x4D
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
modifier|*
name|osc_offset
parameter_list|)
comment|/* oscillator offset */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|4
condition|)
return|return
name|TRUE
return|;
operator|*
name|osc_offset
operator|=
name|bGetSingle
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x4E
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|response
parameter_list|)
comment|/* yes/no response to command to set GPS time */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|1
condition|)
return|return
name|TRUE
return|;
operator|*
name|response
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x4F
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|double
modifier|*
name|a0
parameter_list|,
name|float
modifier|*
name|a1
parameter_list|,
name|float
modifier|*
name|time_of_data
parameter_list|,
name|short
modifier|*
name|dt_ls
parameter_list|,
name|short
modifier|*
name|wn_t
parameter_list|,
name|short
modifier|*
name|wn_lsf
parameter_list|,
name|short
modifier|*
name|dn
parameter_list|,
name|short
modifier|*
name|dt_lsf
parameter_list|)
comment|/* UTC data */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|26
condition|)
return|return
name|TRUE
return|;
operator|*
name|a0
operator|=
name|bGetDouble
argument_list|(
name|buf
argument_list|)
expr_stmt|;
operator|*
name|a1
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
operator|*
name|dt_ls
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
operator|*
name|time_of_data
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|14
index|]
argument_list|)
expr_stmt|;
operator|*
name|wn_t
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|18
index|]
argument_list|)
expr_stmt|;
operator|*
name|wn_lsf
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|20
index|]
argument_list|)
expr_stmt|;
operator|*
name|dn
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|22
index|]
argument_list|)
expr_stmt|;
operator|*
name|dt_lsf
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|24
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/**/
end_comment

begin_function
name|short
name|rpt_0x54
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
modifier|*
name|clock_bias
parameter_list|,
name|float
modifier|*
name|freq_offset
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
comment|/* clock offset and frequency offset in 1-SV (0-D) mode */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|12
condition|)
return|return
name|TRUE
return|;
operator|*
name|clock_bias
operator|=
name|bGetSingle
argument_list|(
name|buf
argument_list|)
expr_stmt|;
operator|*
name|freq_offset
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
operator|*
name|time_of_fix
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x55
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|pos_code
parameter_list|,
name|unsigned
name|char
modifier|*
name|vel_code
parameter_list|,
name|unsigned
name|char
modifier|*
name|time_code
parameter_list|,
name|unsigned
name|char
modifier|*
name|aux_code
parameter_list|)
comment|/* I/O serial options */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|4
condition|)
return|return
name|TRUE
return|;
operator|*
name|pos_code
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|vel_code
operator|=
name|buf
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|time_code
operator|=
name|buf
index|[
literal|2
index|]
expr_stmt|;
operator|*
name|aux_code
operator|=
name|buf
index|[
literal|3
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x56
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|float
name|vel_ENU
index|[
literal|3
index|]
parameter_list|,
name|float
modifier|*
name|freq_offset
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
comment|/* velocity in east-north-up coordinates */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|20
condition|)
return|return
name|TRUE
return|;
comment|/* east */
name|vel_ENU
index|[
literal|0
index|]
operator|=
name|bGetSingle
argument_list|(
name|buf
argument_list|)
expr_stmt|;
comment|/* north */
name|vel_ENU
index|[
literal|1
index|]
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
comment|/* up */
name|vel_ENU
index|[
literal|2
index|]
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
operator|*
name|freq_offset
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
operator|*
name|time_of_fix
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x57
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|source_code
parameter_list|,
name|unsigned
name|char
modifier|*
name|diag_code
parameter_list|,
name|short
modifier|*
name|week_num
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
comment|/* info about last computed fix */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|8
condition|)
return|return
name|TRUE
return|;
operator|*
name|source_code
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|diag_code
operator|=
name|buf
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|time_of_fix
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
operator|*
name|week_num
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x58
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|op_code
parameter_list|,
name|unsigned
name|char
modifier|*
name|data_type
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|unsigned
name|char
modifier|*
name|data_length
parameter_list|,
name|unsigned
name|char
modifier|*
name|data_packet
parameter_list|)
comment|/* GPS system data or acknowledgment of GPS system data load */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|,
modifier|*
name|buf4
decl_stmt|;
name|short
name|dl
decl_stmt|;
name|ALM_INFO
modifier|*
name|alminfo
decl_stmt|;
name|ION_INFO
modifier|*
name|ioninfo
decl_stmt|;
name|UTC_INFO
modifier|*
name|utcinfo
decl_stmt|;
name|NAV_INFO
modifier|*
name|navinfo
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|2
condition|)
block|{
if|if
condition|(
name|rpt
operator|->
name|len
operator|<
literal|4
condition|)
return|return
name|TRUE
return|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|4
operator|+
name|buf
index|[
literal|3
index|]
condition|)
return|return
name|TRUE
return|;
block|}
elseif|else
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|3
condition|)
block|{
return|return
name|TRUE
return|;
block|}
operator|*
name|op_code
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|data_type
operator|=
name|buf
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|sv_prn
operator|=
name|buf
index|[
literal|2
index|]
expr_stmt|;
if|if
condition|(
operator|*
name|op_code
operator|==
literal|2
condition|)
block|{
name|dl
operator|=
name|buf
index|[
literal|3
index|]
expr_stmt|;
operator|*
name|data_length
operator|=
operator|(
name|unsigned
name|char
operator|)
name|dl
expr_stmt|;
name|buf4
operator|=
operator|&
name|buf
index|[
literal|4
index|]
expr_stmt|;
switch|switch
condition|(
operator|*
name|data_type
condition|)
block|{
case|case
literal|2
case|:
comment|/* Almanac */
if|if
condition|(
operator|*
name|data_length
operator|!=
sizeof|sizeof
argument_list|(
name|ALM_INFO
argument_list|)
condition|)
return|return
name|TRUE
return|;
name|alminfo
operator|=
operator|(
name|ALM_INFO
operator|*
operator|)
name|data_packet
expr_stmt|;
name|alminfo
operator|->
name|t_oa_raw
operator|=
name|buf4
index|[
literal|0
index|]
expr_stmt|;
name|alminfo
operator|->
name|SV_health
operator|=
name|buf4
index|[
literal|1
index|]
expr_stmt|;
name|alminfo
operator|->
name|e
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|t_oa
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|i_0
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|10
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|OMEGADOT
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|14
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|sqrt_A
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|18
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|OMEGA_0
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|22
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|omega
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|26
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|M_0
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|30
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|a_f0
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|34
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|a_f1
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|38
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|Axis
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|42
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|n
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|46
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|OMEGA_n
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|50
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|ODOT_n
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|54
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|t_zc
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|58
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|weeknum
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf4
index|[
literal|62
index|]
argument_list|)
expr_stmt|;
name|alminfo
operator|->
name|wn_oa
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf4
index|[
literal|64
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
comment|/* Almanac health page */
if|if
condition|(
operator|*
name|data_length
operator|!=
sizeof|sizeof
argument_list|(
name|ALH_PARMS
argument_list|)
operator|+
literal|3
condition|)
return|return
name|TRUE
return|;
comment|/* this record is returned raw */
name|memcpy
argument_list|(
name|data_packet
argument_list|,
name|buf4
argument_list|,
name|dl
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
comment|/* Ionosphere */
if|if
condition|(
operator|*
name|data_length
operator|!=
sizeof|sizeof
argument_list|(
name|ION_INFO
argument_list|)
operator|+
literal|8
condition|)
return|return
name|TRUE
return|;
name|ioninfo
operator|=
operator|(
name|ION_INFO
operator|*
operator|)
name|data_packet
expr_stmt|;
name|ioninfo
operator|->
name|alpha_0
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
name|ioninfo
operator|->
name|alpha_1
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
name|ioninfo
operator|->
name|alpha_2
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
name|ioninfo
operator|->
name|alpha_3
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|20
index|]
argument_list|)
expr_stmt|;
name|ioninfo
operator|->
name|beta_0
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|24
index|]
argument_list|)
expr_stmt|;
name|ioninfo
operator|->
name|beta_1
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|28
index|]
argument_list|)
expr_stmt|;
name|ioninfo
operator|->
name|beta_2
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|32
index|]
argument_list|)
expr_stmt|;
name|ioninfo
operator|->
name|beta_3
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|36
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
comment|/* UTC */
if|if
condition|(
operator|*
name|data_length
operator|!=
sizeof|sizeof
argument_list|(
name|UTC_INFO
argument_list|)
operator|+
literal|13
condition|)
return|return
name|TRUE
return|;
name|utcinfo
operator|=
operator|(
name|UTC_INFO
operator|*
operator|)
name|data_packet
expr_stmt|;
name|utcinfo
operator|->
name|A_0
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
name|utcinfo
operator|->
name|A_1
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|21
index|]
argument_list|)
expr_stmt|;
name|utcinfo
operator|->
name|delta_t_LS
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf4
index|[
literal|25
index|]
argument_list|)
expr_stmt|;
name|utcinfo
operator|->
name|t_ot
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|27
index|]
argument_list|)
expr_stmt|;
name|utcinfo
operator|->
name|WN_t
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf4
index|[
literal|31
index|]
argument_list|)
expr_stmt|;
name|utcinfo
operator|->
name|WN_LSF
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf4
index|[
literal|33
index|]
argument_list|)
expr_stmt|;
name|utcinfo
operator|->
name|DN
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf4
index|[
literal|35
index|]
argument_list|)
expr_stmt|;
name|utcinfo
operator|->
name|delta_t_LSF
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf4
index|[
literal|37
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
comment|/* Ephemeris */
if|if
condition|(
operator|*
name|data_length
operator|!=
sizeof|sizeof
argument_list|(
name|NAV_INFO
argument_list|)
operator|-
literal|1
condition|)
return|return
name|TRUE
return|;
name|navinfo
operator|=
operator|(
name|NAV_INFO
operator|*
operator|)
name|data_packet
expr_stmt|;
name|navinfo
operator|->
name|sv_number
operator|=
name|buf4
index|[
literal|0
index|]
expr_stmt|;
name|navinfo
operator|->
name|t_ephem
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|weeknum
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf4
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|codeL2
operator|=
name|buf4
index|[
literal|7
index|]
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|L2Pdata
operator|=
name|buf4
index|[
literal|8
index|]
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|SVacc_raw
operator|=
name|buf4
index|[
literal|9
index|]
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|SV_health
operator|=
name|buf4
index|[
literal|10
index|]
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|IODC
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf4
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|T_GD
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|t_oc
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|17
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|a_f2
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|21
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|a_f1
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|25
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|a_f0
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|29
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephclk
operator|.
name|SVacc
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|33
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|IODE
operator|=
name|buf4
index|[
literal|37
index|]
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|fit_interval
operator|=
name|buf4
index|[
literal|38
index|]
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|C_rs
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|39
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|delta_n
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|43
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|M_0
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|47
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|C_uc
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|55
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|e
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|59
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|C_us
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|67
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|sqrt_A
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|71
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|t_oe
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|79
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|C_ic
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|83
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|OMEGA_0
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|87
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|C_is
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|95
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|i_0
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|99
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|C_rc
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|107
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|omega
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|111
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|OMEGADOT
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|119
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|IDOT
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf4
index|[
literal|123
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|Axis
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|127
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|n
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|135
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|r1me2
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|143
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|OMEGA_n
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|151
index|]
argument_list|)
expr_stmt|;
name|navinfo
operator|->
name|ephorb
operator|.
name|ODOT_n
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf4
index|[
literal|159
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x59
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|code_type
parameter_list|,
name|unsigned
name|char
name|status_code
index|[
literal|32
index|]
parameter_list|)
comment|/* satellite enable/disable or health heed/ignore list */
block|{
name|short
name|iprn
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|33
condition|)
return|return
name|TRUE
return|;
operator|*
name|code_type
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
for|for
control|(
name|iprn
operator|=
literal|0
init|;
name|iprn
operator|<
literal|32
condition|;
name|iprn
operator|++
control|)
name|status_code
index|[
name|iprn
index|]
operator|=
name|buf
index|[
name|iprn
operator|+
literal|1
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x5A
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|float
modifier|*
name|sample_length
parameter_list|,
name|float
modifier|*
name|signal_level
parameter_list|,
name|float
modifier|*
name|code_phase
parameter_list|,
name|float
modifier|*
name|Doppler
parameter_list|,
name|double
modifier|*
name|time_of_fix
parameter_list|)
comment|/* raw measurement data - code phase/Doppler */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|25
condition|)
return|return
name|TRUE
return|;
operator|*
name|sv_prn
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|sample_length
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
operator|*
name|signal_level
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
operator|*
name|code_phase
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
operator|*
name|Doppler
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
operator|*
name|time_of_fix
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|17
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x5B
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_health
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_iode
parameter_list|,
name|unsigned
name|char
modifier|*
name|fit_interval_flag
parameter_list|,
name|float
modifier|*
name|time_of_collection
parameter_list|,
name|float
modifier|*
name|time_of_eph
parameter_list|,
name|float
modifier|*
name|sv_accy
parameter_list|)
comment|/* satellite ephorb status */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|16
condition|)
return|return
name|TRUE
return|;
operator|*
name|sv_prn
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|time_of_collection
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
operator|*
name|sv_health
operator|=
name|buf
index|[
literal|5
index|]
expr_stmt|;
operator|*
name|sv_iode
operator|=
name|buf
index|[
literal|6
index|]
expr_stmt|;
operator|*
name|time_of_eph
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
operator|*
name|fit_interval_flag
operator|=
name|buf
index|[
literal|11
index|]
expr_stmt|;
operator|*
name|sv_accy
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x5C
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|sv_prn
parameter_list|,
name|unsigned
name|char
modifier|*
name|slot
parameter_list|,
name|unsigned
name|char
modifier|*
name|chan
parameter_list|,
name|unsigned
name|char
modifier|*
name|acq_flag
parameter_list|,
name|unsigned
name|char
modifier|*
name|eph_flag
parameter_list|,
name|float
modifier|*
name|signal_level
parameter_list|,
name|float
modifier|*
name|time_of_last_msmt
parameter_list|,
name|float
modifier|*
name|elev
parameter_list|,
name|float
modifier|*
name|azim
parameter_list|,
name|unsigned
name|char
modifier|*
name|old_msmt_flag
parameter_list|,
name|unsigned
name|char
modifier|*
name|integer_msec_flag
parameter_list|,
name|unsigned
name|char
modifier|*
name|bad_data_flag
parameter_list|,
name|unsigned
name|char
modifier|*
name|data_collect_flag
parameter_list|)
comment|/* satellite tracking status */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|24
condition|)
return|return
name|TRUE
return|;
operator|*
name|sv_prn
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|slot
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
operator|(
name|buf
index|[
literal|1
index|]
operator|&
literal|0x07
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
operator|*
name|chan
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|buf
index|[
literal|1
index|]
operator|>>
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|chan
operator|==
literal|0x10
condition|)
operator|*
name|chan
operator|=
literal|2
expr_stmt|;
else|else
operator|(
operator|*
name|chan
operator|)
operator|++
expr_stmt|;
operator|*
name|acq_flag
operator|=
name|buf
index|[
literal|2
index|]
expr_stmt|;
operator|*
name|eph_flag
operator|=
name|buf
index|[
literal|3
index|]
expr_stmt|;
operator|*
name|signal_level
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
operator|*
name|time_of_last_msmt
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
operator|*
name|elev
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
operator|*
name|azim
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
operator|*
name|old_msmt_flag
operator|=
name|buf
index|[
literal|20
index|]
expr_stmt|;
operator|*
name|integer_msec_flag
operator|=
name|buf
index|[
literal|21
index|]
expr_stmt|;
operator|*
name|bad_data_flag
operator|=
name|buf
index|[
literal|22
index|]
expr_stmt|;
operator|*
name|data_collect_flag
operator|=
name|buf
index|[
literal|23
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/**/
end_comment

begin_function
name|short
name|rpt_0x6D
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|manual_mode
parameter_list|,
name|unsigned
name|char
modifier|*
name|nsvs
parameter_list|,
name|unsigned
name|char
modifier|*
name|ndim
parameter_list|,
name|unsigned
name|char
name|sv_prn
index|[]
parameter_list|,
name|float
modifier|*
name|pdop
parameter_list|,
name|float
modifier|*
name|hdop
parameter_list|,
name|float
modifier|*
name|vdop
parameter_list|,
name|float
modifier|*
name|tdop
parameter_list|)
comment|/* over-determined satellite selection for position fixes, PDOP, fix mode */
block|{
name|short
name|islot
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
operator|*
name|nsvs
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
operator|(
name|buf
index|[
literal|0
index|]
operator|&
literal|0xF0
operator|)
operator|>>
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|nsvs
operator|)
operator|>
literal|8
condition|)
return|return
name|TRUE
return|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|17
operator|+
operator|(
operator|*
name|nsvs
operator|)
condition|)
return|return
name|TRUE
return|;
operator|*
name|manual_mode
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|buf
index|[
literal|0
index|]
operator|&
literal|0x08
argument_list|)
expr_stmt|;
operator|*
name|ndim
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
operator|(
name|buf
index|[
literal|0
index|]
operator|&
literal|0x07
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pdop
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
operator|*
name|hdop
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
operator|*
name|vdop
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
operator|*
name|tdop
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|islot
operator|=
literal|0
init|;
name|islot
operator|<
operator|(
operator|*
name|nsvs
operator|)
condition|;
name|islot
operator|++
control|)
name|sv_prn
index|[
name|islot
index|]
operator|=
name|buf
index|[
name|islot
operator|+
literal|17
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/**/
end_comment

begin_function
name|short
name|rpt_0x82
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|diff_mode
parameter_list|)
comment|/* differential fix mode */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|1
condition|)
return|return
name|TRUE
return|;
operator|*
name|diff_mode
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x83
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|double
name|ECEF_pos
index|[
literal|3
index|]
parameter_list|,
name|double
modifier|*
name|clock_bias
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
comment|/* position, ECEF double precision */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|36
condition|)
return|return
name|TRUE
return|;
name|ECEF_pos
index|[
literal|0
index|]
operator|=
name|bGetDouble
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|ECEF_pos
index|[
literal|1
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
name|ECEF_pos
index|[
literal|2
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
operator|*
name|clock_bias
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|24
index|]
argument_list|)
expr_stmt|;
operator|*
name|time_of_fix
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|32
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x84
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|double
modifier|*
name|lat
parameter_list|,
name|double
modifier|*
name|lon
parameter_list|,
name|double
modifier|*
name|alt
parameter_list|,
name|double
modifier|*
name|clock_bias
parameter_list|,
name|float
modifier|*
name|time_of_fix
parameter_list|)
comment|/* position, lat-lon-alt double precision */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|36
condition|)
return|return
name|TRUE
return|;
operator|*
name|lat
operator|=
name|bGetDouble
argument_list|(
name|buf
argument_list|)
expr_stmt|;
operator|*
name|lon
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
operator|*
name|alt
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
operator|*
name|clock_bias
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|24
index|]
argument_list|)
expr_stmt|;
operator|*
name|time_of_fix
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|32
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_Paly0xBB
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|TSIP_RCVR_CFG
modifier|*
name|TsipxBB
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
comment|/* Palisade is inconsistent with other TSIP, which has a kength of 40 */
comment|/* if (rpt->len != 40) return TRUE; */
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|43
condition|)
return|return
name|TRUE
return|;
name|TsipxBB
operator|->
name|bSubcode
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
name|TsipxBB
operator|->
name|operating_mode
operator|=
name|buf
index|[
literal|1
index|]
expr_stmt|;
name|TsipxBB
operator|->
name|dyn_code
operator|=
name|buf
index|[
literal|3
index|]
expr_stmt|;
name|TsipxBB
operator|->
name|elev_mask
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|TsipxBB
operator|->
name|cno_mask
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
name|TsipxBB
operator|->
name|dop_mask
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
name|TsipxBB
operator|->
name|dop_switch
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|17
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0xBC
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|port_num
parameter_list|,
name|unsigned
name|char
modifier|*
name|in_baud
parameter_list|,
name|unsigned
name|char
modifier|*
name|out_baud
parameter_list|,
name|unsigned
name|char
modifier|*
name|data_bits
parameter_list|,
name|unsigned
name|char
modifier|*
name|parity
parameter_list|,
name|unsigned
name|char
modifier|*
name|stop_bits
parameter_list|,
name|unsigned
name|char
modifier|*
name|flow_control
parameter_list|,
name|unsigned
name|char
modifier|*
name|protocols_in
parameter_list|,
name|unsigned
name|char
modifier|*
name|protocols_out
parameter_list|,
name|unsigned
name|char
modifier|*
name|reserved
parameter_list|)
comment|/* Receiver serial port configuration */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|10
condition|)
return|return
name|TRUE
return|;
operator|*
name|port_num
operator|=
name|buf
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|in_baud
operator|=
name|buf
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|out_baud
operator|=
name|buf
index|[
literal|2
index|]
expr_stmt|;
operator|*
name|data_bits
operator|=
name|buf
index|[
literal|3
index|]
expr_stmt|;
operator|*
name|parity
operator|=
name|buf
index|[
literal|4
index|]
expr_stmt|;
operator|*
name|stop_bits
operator|=
name|buf
index|[
literal|5
index|]
expr_stmt|;
operator|*
name|flow_control
operator|=
name|buf
index|[
literal|6
index|]
expr_stmt|;
operator|*
name|protocols_in
operator|=
name|buf
index|[
literal|7
index|]
expr_stmt|;
operator|*
name|protocols_out
operator|=
name|buf
index|[
literal|8
index|]
expr_stmt|;
operator|*
name|reserved
operator|=
name|buf
index|[
literal|9
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/**** Superpackets ****/
end_comment

begin_function
name|short
name|rpt_0x8F0B
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|short
modifier|*
name|event
parameter_list|,
name|double
modifier|*
name|tow
parameter_list|,
name|unsigned
name|char
modifier|*
name|date
parameter_list|,
name|unsigned
name|char
modifier|*
name|month
parameter_list|,
name|short
modifier|*
name|year
parameter_list|,
name|unsigned
name|char
modifier|*
name|dim_mode
parameter_list|,
name|short
modifier|*
name|utc_offset
parameter_list|,
name|double
modifier|*
name|bias
parameter_list|,
name|double
modifier|*
name|drift
parameter_list|,
name|float
modifier|*
name|bias_unc
parameter_list|,
name|float
modifier|*
name|dr_unc
parameter_list|,
name|double
modifier|*
name|lat
parameter_list|,
name|double
modifier|*
name|lon
parameter_list|,
name|double
modifier|*
name|alt
parameter_list|,
name|char
name|sv_id
index|[
literal|8
index|]
parameter_list|)
block|{
name|short
name|local_index
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|74
condition|)
return|return
name|TRUE
return|;
operator|*
name|event
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
operator|*
name|tow
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
operator|*
name|date
operator|=
name|buf
index|[
literal|11
index|]
expr_stmt|;
operator|*
name|month
operator|=
name|buf
index|[
literal|12
index|]
expr_stmt|;
operator|*
name|year
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
operator|*
name|dim_mode
operator|=
name|buf
index|[
literal|15
index|]
expr_stmt|;
operator|*
name|utc_offset
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
operator|*
name|bias
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|18
index|]
argument_list|)
expr_stmt|;
operator|*
name|drift
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|26
index|]
argument_list|)
expr_stmt|;
operator|*
name|bias_unc
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|34
index|]
argument_list|)
expr_stmt|;
operator|*
name|dr_unc
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|38
index|]
argument_list|)
expr_stmt|;
operator|*
name|lat
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|42
index|]
argument_list|)
expr_stmt|;
operator|*
name|lon
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|50
index|]
argument_list|)
expr_stmt|;
operator|*
name|alt
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|58
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|local_index
operator|=
literal|0
init|;
name|local_index
operator|<
literal|8
condition|;
name|local_index
operator|++
control|)
name|sv_id
index|[
name|local_index
index|]
operator|=
name|buf
index|[
name|local_index
operator|+
literal|66
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x8F14
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|short
modifier|*
name|datum_idx
parameter_list|,
name|double
name|datum_coeffs
index|[
literal|5
index|]
parameter_list|)
comment|/*  datum index and coefficients  */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|43
condition|)
return|return
name|TRUE
return|;
operator|*
name|datum_idx
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|datum_coeffs
index|[
literal|0
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|datum_coeffs
index|[
literal|1
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
name|datum_coeffs
index|[
literal|2
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|19
index|]
argument_list|)
expr_stmt|;
name|datum_coeffs
index|[
literal|3
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|27
index|]
argument_list|)
expr_stmt|;
name|datum_coeffs
index|[
literal|4
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|35
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x8F15
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|short
modifier|*
name|datum_idx
parameter_list|,
name|double
name|datum_coeffs
index|[
literal|5
index|]
parameter_list|)
comment|/*  datum index and coefficients  */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|43
condition|)
return|return
name|TRUE
return|;
operator|*
name|datum_idx
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|datum_coeffs
index|[
literal|0
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|datum_coeffs
index|[
literal|1
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
name|datum_coeffs
index|[
literal|2
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|19
index|]
argument_list|)
expr_stmt|;
name|datum_coeffs
index|[
literal|3
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|27
index|]
argument_list|)
expr_stmt|;
name|datum_coeffs
index|[
literal|4
index|]
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|35
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_define
define|#
directive|define
name|MAX_LONG
value|(2147483648.)
end_define

begin_comment
comment|/* 2**31 */
end_comment

begin_function
name|short
name|rpt_0x8F20
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|info
parameter_list|,
name|double
modifier|*
name|lat
parameter_list|,
name|double
modifier|*
name|lon
parameter_list|,
name|double
modifier|*
name|alt
parameter_list|,
name|double
name|vel_enu
index|[]
parameter_list|,
name|double
modifier|*
name|time_of_fix
parameter_list|,
name|short
modifier|*
name|week_num
parameter_list|,
name|unsigned
name|char
modifier|*
name|nsvs
parameter_list|,
name|unsigned
name|char
name|sv_prn
index|[]
parameter_list|,
name|short
name|sv_IODC
index|[]
parameter_list|,
name|short
modifier|*
name|datum_index
parameter_list|)
block|{
name|short
name|isv
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|,
name|prnx
decl_stmt|,
name|iode
decl_stmt|;
name|unsigned
name|long
name|ulongtemp
decl_stmt|;
name|long
name|longtemp
decl_stmt|;
name|double
name|vel_scale
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|56
condition|)
return|return
name|TRUE
return|;
name|vel_scale
operator|=
operator|(
name|buf
index|[
literal|24
index|]
operator|&
literal|1
operator|)
condition|?
literal|0.020
else|:
literal|0.005
expr_stmt|;
name|vel_enu
index|[
literal|0
index|]
operator|=
name|bGetShort
argument_list|(
name|buf
operator|+
literal|2
argument_list|)
operator|*
name|vel_scale
expr_stmt|;
name|vel_enu
index|[
literal|1
index|]
operator|=
name|bGetShort
argument_list|(
name|buf
operator|+
literal|4
argument_list|)
operator|*
name|vel_scale
expr_stmt|;
name|vel_enu
index|[
literal|2
index|]
operator|=
name|bGetShort
argument_list|(
name|buf
operator|+
literal|6
argument_list|)
operator|*
name|vel_scale
expr_stmt|;
operator|*
name|time_of_fix
operator|=
name|bGetULong
argument_list|(
name|buf
operator|+
literal|8
argument_list|)
operator|*
literal|.001
expr_stmt|;
name|longtemp
operator|=
name|bGetLong
argument_list|(
name|buf
operator|+
literal|12
argument_list|)
expr_stmt|;
operator|*
name|lat
operator|=
name|longtemp
operator|*
operator|(
name|GPS_PI
operator|/
name|MAX_LONG
operator|)
expr_stmt|;
name|ulongtemp
operator|=
name|bGetULong
argument_list|(
name|buf
operator|+
literal|16
argument_list|)
expr_stmt|;
operator|*
name|lon
operator|=
name|ulongtemp
operator|*
operator|(
name|GPS_PI
operator|/
name|MAX_LONG
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|lon
operator|>
name|GPS_PI
condition|)
operator|*
name|lon
operator|-=
literal|2.0
operator|*
name|GPS_PI
expr_stmt|;
operator|*
name|alt
operator|=
name|bGetLong
argument_list|(
name|buf
operator|+
literal|20
argument_list|)
operator|*
literal|.001
expr_stmt|;
comment|/* 25 blank; 29 = UTC */
operator|(
operator|*
name|datum_index
operator|)
operator|=
call|(
name|short
call|)
argument_list|(
operator|(
name|short
operator|)
name|buf
index|[
literal|26
index|]
operator|-
literal|1
argument_list|)
expr_stmt|;
operator|*
name|info
operator|=
name|buf
index|[
literal|27
index|]
expr_stmt|;
operator|*
name|nsvs
operator|=
name|buf
index|[
literal|28
index|]
expr_stmt|;
operator|*
name|week_num
operator|=
name|bGetShort
argument_list|(
operator|&
name|buf
index|[
literal|30
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|isv
operator|=
literal|0
init|;
name|isv
operator|<
literal|8
condition|;
name|isv
operator|++
control|)
block|{
name|prnx
operator|=
name|buf
index|[
literal|32
operator|+
literal|2
operator|*
name|isv
index|]
expr_stmt|;
name|sv_prn
index|[
name|isv
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|prnx
operator|&
literal|0x3F
argument_list|)
expr_stmt|;
name|iode
operator|=
name|buf
index|[
literal|33
operator|+
literal|2
operator|*
name|isv
index|]
expr_stmt|;
name|sv_IODC
index|[
name|isv
index|]
operator|=
call|(
name|short
call|)
argument_list|(
name|iode
operator||
operator|(
operator|(
name|prnx
operator|>>
literal|6
operator|)
operator|<<
literal|8
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x8F41
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|bSearchRange
parameter_list|,
name|unsigned
name|char
modifier|*
name|bBoardOptions
parameter_list|,
name|unsigned
name|long
modifier|*
name|iiSerialNumber
parameter_list|,
name|unsigned
name|char
modifier|*
name|bBuildYear
parameter_list|,
name|unsigned
name|char
modifier|*
name|bBuildMonth
parameter_list|,
name|unsigned
name|char
modifier|*
name|bBuildDay
parameter_list|,
name|unsigned
name|char
modifier|*
name|bBuildHour
parameter_list|,
name|float
modifier|*
name|fOscOffset
parameter_list|,
name|unsigned
name|short
modifier|*
name|iTestCodeId
parameter_list|)
block|{
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|17
condition|)
return|return
name|FALSE
return|;
operator|*
name|bSearchRange
operator|=
name|rpt
operator|->
name|buf
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|bBoardOptions
operator|=
name|rpt
operator|->
name|buf
index|[
literal|2
index|]
expr_stmt|;
operator|*
name|iiSerialNumber
operator|=
name|bGetLong
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
operator|*
name|bBuildYear
operator|=
name|rpt
operator|->
name|buf
index|[
literal|7
index|]
expr_stmt|;
operator|*
name|bBuildMonth
operator|=
name|rpt
operator|->
name|buf
index|[
literal|8
index|]
expr_stmt|;
operator|*
name|bBuildDay
operator|=
name|rpt
operator|->
name|buf
index|[
literal|9
index|]
expr_stmt|;
operator|*
name|bBuildHour
operator|=
name|rpt
operator|->
name|buf
index|[
literal|10
index|]
expr_stmt|;
operator|*
name|fOscOffset
operator|=
name|bGetSingle
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
operator|*
name|iTestCodeId
operator|=
name|bGetShort
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
comment|/*	Tsipx8E41Data = *Tsipx8E41; */
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x8F42
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|bProdOptionsPre
parameter_list|,
name|unsigned
name|char
modifier|*
name|bProdNumberExt
parameter_list|,
name|unsigned
name|short
modifier|*
name|iCaseSerialNumberPre
parameter_list|,
name|unsigned
name|long
modifier|*
name|iiCaseSerialNumber
parameter_list|,
name|unsigned
name|long
modifier|*
name|iiProdNumber
parameter_list|,
name|unsigned
name|short
modifier|*
name|iPremiumOptions
parameter_list|,
name|unsigned
name|short
modifier|*
name|iMachineID
parameter_list|,
name|unsigned
name|short
modifier|*
name|iKey
parameter_list|)
block|{
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|19
condition|)
return|return
name|FALSE
return|;
operator|*
name|bProdOptionsPre
operator|=
name|rpt
operator|->
name|buf
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|bProdNumberExt
operator|=
name|rpt
operator|->
name|buf
index|[
literal|2
index|]
expr_stmt|;
operator|*
name|iCaseSerialNumberPre
operator|=
name|bGetShort
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
operator|*
name|iiCaseSerialNumber
operator|=
name|bGetLong
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
operator|*
name|iiProdNumber
operator|=
name|bGetLong
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
operator|*
name|iPremiumOptions
operator|=
name|bGetShort
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
operator|*
name|iMachineID
operator|=
name|bGetShort
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
operator|*
name|iKey
operator|=
name|bGetShort
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|17
index|]
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x8F45
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|bSegMask
parameter_list|)
block|{
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|2
condition|)
return|return
name|FALSE
return|;
operator|*
name|bSegMask
operator|=
name|rpt
operator|->
name|buf
index|[
literal|1
index|]
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x8F4A_16
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|pps_enabled
parameter_list|,
name|unsigned
name|char
modifier|*
name|pps_timebase
parameter_list|,
name|unsigned
name|char
modifier|*
name|pos_polarity
parameter_list|,
name|double
modifier|*
name|pps_offset
parameter_list|,
name|float
modifier|*
name|bias_unc_threshold
parameter_list|)
comment|/* Stinger PPS definition */
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|16
condition|)
return|return
name|TRUE
return|;
operator|*
name|pps_enabled
operator|=
name|buf
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|pps_timebase
operator|=
name|buf
index|[
literal|2
index|]
expr_stmt|;
operator|*
name|pos_polarity
operator|=
name|buf
index|[
literal|3
index|]
expr_stmt|;
operator|*
name|pps_offset
operator|=
name|bGetDouble
argument_list|(
operator|&
name|buf
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
operator|*
name|bias_unc_threshold
operator|=
name|bGetSingle
argument_list|(
operator|&
name|buf
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x8F4B
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|long
modifier|*
name|decorr_max
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|5
condition|)
return|return
name|TRUE
return|;
operator|*
name|decorr_max
operator|=
name|bGetLong
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x8F4D
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|long
modifier|*
name|event_mask
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|5
condition|)
return|return
name|TRUE
return|;
operator|*
name|event_mask
operator|=
name|bGetULong
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x8FA5
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|char
modifier|*
name|spktmask
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|rpt
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|5
condition|)
return|return
name|TRUE
return|;
name|spktmask
index|[
literal|0
index|]
operator|=
name|buf
index|[
literal|1
index|]
expr_stmt|;
name|spktmask
index|[
literal|1
index|]
operator|=
name|buf
index|[
literal|2
index|]
expr_stmt|;
name|spktmask
index|[
literal|2
index|]
operator|=
name|buf
index|[
literal|3
index|]
expr_stmt|;
name|spktmask
index|[
literal|3
index|]
operator|=
name|buf
index|[
literal|4
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|short
name|rpt_0x8FAD
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|unsigned
name|short
modifier|*
name|COUNT
parameter_list|,
name|double
modifier|*
name|FracSec
parameter_list|,
name|unsigned
name|char
modifier|*
name|Hour
parameter_list|,
name|unsigned
name|char
modifier|*
name|Minute
parameter_list|,
name|unsigned
name|char
modifier|*
name|Second
parameter_list|,
name|unsigned
name|char
modifier|*
name|Day
parameter_list|,
name|unsigned
name|char
modifier|*
name|Month
parameter_list|,
name|unsigned
name|short
modifier|*
name|Year
parameter_list|,
name|unsigned
name|char
modifier|*
name|Status
parameter_list|,
name|unsigned
name|char
modifier|*
name|Flags
parameter_list|)
block|{
if|if
condition|(
name|rpt
operator|->
name|len
operator|!=
literal|22
condition|)
return|return
name|TRUE
return|;
operator|*
name|COUNT
operator|=
name|bGetUShort
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
operator|*
name|FracSec
operator|=
name|bGetDouble
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
operator|*
name|Hour
operator|=
name|rpt
operator|->
name|buf
index|[
literal|11
index|]
expr_stmt|;
operator|*
name|Minute
operator|=
name|rpt
operator|->
name|buf
index|[
literal|12
index|]
expr_stmt|;
operator|*
name|Second
operator|=
name|rpt
operator|->
name|buf
index|[
literal|13
index|]
expr_stmt|;
operator|*
name|Day
operator|=
name|rpt
operator|->
name|buf
index|[
literal|14
index|]
expr_stmt|;
operator|*
name|Month
operator|=
name|rpt
operator|->
name|buf
index|[
literal|15
index|]
expr_stmt|;
operator|*
name|Year
operator|=
name|bGetUShort
argument_list|(
operator|&
name|rpt
operator|->
name|buf
index|[
literal|16
index|]
argument_list|)
expr_stmt|;
operator|*
name|Status
operator|=
name|rpt
operator|->
name|buf
index|[
literal|18
index|]
expr_stmt|;
operator|*
name|Flags
operator|=
name|rpt
operator|->
name|buf
index|[
literal|19
index|]
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/*  * *************************************************************************  *  * Trimble Navigation, Ltd.  * OEM Products Development Group  * P.O. Box 3642  * 645 North Mary Avenue  * Sunnyvale, California 94088-3642  *  * Corporate Headquarter:  *    Telephone:  (408) 481-8000  *    Fax:        (408) 481-6005  *  * Technical Support Center:  *    Telephone:  (800) 767-4822	(U.S. and Canada)  *                (408) 481-6940    (outside U.S. and Canada)  *    Fax:        (408) 481-6020  *    BBS:        (408) 481-7800  *    e-mail:     trimble_support@trimble.com  *		ftp://ftp.trimble.com/pub/sct/embedded/bin  *  * *************************************************************************  *  * T_REPORT.C consists of a primary function TranslateTSIPReportToText()  * called by main().  *  * This function takes a character buffer that has been received as a report  * from a TSIP device and interprets it.  The character buffer has been  * assembled using tsip_input_proc() in T_PARSER.C.  *  * A large case statement directs processing to one of many mid-level  * functions.  The mid-level functions specific to the current report  * code passes the report buffer to the appropriate report decoder  * rpt_0x?? () in T_PARSER.C, which converts the byte stream in rpt.buf  * to data values approporaite for use.  *  * *************************************************************************  *  */
end_comment

begin_define
define|#
directive|define
name|GOOD_PARSE
value|0
end_define

begin_define
define|#
directive|define
name|BADID_PARSE
value|1
end_define

begin_define
define|#
directive|define
name|BADLEN_PARSE
value|2
end_define

begin_define
define|#
directive|define
name|BADDATA_PARSE
value|3
end_define

begin_define
define|#
directive|define
name|B_TSIP
value|0x02
end_define

begin_define
define|#
directive|define
name|B_NMEA
value|0x04
end_define

begin_comment
comment|/* pbuf is the pointer to the current location of the text output */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|pbuf
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* keep track of whether the message has been successfully parsed */
end_comment

begin_decl_stmt
specifier|static
name|short
name|parsed
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* convert time of week into day-hour-minute-second and print */
end_comment

begin_function
name|char
modifier|*
name|show_time
parameter_list|(
name|float
name|time_of_week
parameter_list|)
block|{
name|short
name|days
decl_stmt|,
name|hours
decl_stmt|,
name|minutes
decl_stmt|;
name|float
name|seconds
decl_stmt|;
name|double
name|tow
init|=
literal|0
decl_stmt|;
specifier|static
name|char
name|timestring
index|[
literal|80
index|]
decl_stmt|;
if|if
condition|(
name|time_of_week
operator|==
operator|-
literal|1.0
condition|)
block|{
name|sprintf
argument_list|(
name|timestring
argument_list|,
literal|"<No time yet>   "
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|time_of_week
operator|>=
literal|604800.0
operator|)
operator|||
operator|(
name|time_of_week
operator|<
literal|0.0
operator|)
condition|)
block|{
name|sprintf
argument_list|(
name|timestring
argument_list|,
literal|"<Bad time>     "
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|time_of_week
operator|<
literal|604799.9
condition|)
name|tow
operator|=
name|time_of_week
operator|+
literal|.00000001
expr_stmt|;
name|seconds
operator|=
operator|(
name|float
operator|)
name|fmod
argument_list|(
name|tow
argument_list|,
literal|60.
argument_list|)
expr_stmt|;
name|minutes
operator|=
operator|(
name|short
operator|)
name|fmod
argument_list|(
name|tow
operator|/
literal|60.
argument_list|,
literal|60.
argument_list|)
expr_stmt|;
name|hours
operator|=
operator|(
name|short
operator|)
name|fmod
argument_list|(
name|tow
operator|/
literal|3600.
argument_list|,
literal|24.
argument_list|)
expr_stmt|;
name|days
operator|=
call|(
name|short
call|)
argument_list|(
name|tow
operator|/
literal|86400.0
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|timestring
argument_list|,
literal|" %s %02d:%02d:%05.2f   "
argument_list|,
name|dayname
index|[
name|days
index|]
argument_list|,
name|hours
argument_list|,
name|minutes
argument_list|,
name|seconds
argument_list|)
expr_stmt|;
block|}
return|return
name|timestring
return|;
block|}
end_function

begin_comment
comment|/**/
end_comment

begin_comment
comment|/* 0x3D */
end_comment

begin_function
specifier|static
name|void
name|rpt_chan_A_config
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|tx_baud_index
decl_stmt|,
name|rx_baud_index
decl_stmt|,
name|char_format_index
decl_stmt|,
name|stop_bits
decl_stmt|,
name|tx_mode_index
decl_stmt|,
name|rx_mode_index
decl_stmt|,
name|databits
decl_stmt|,
name|parity
decl_stmt|;
name|int
name|i
decl_stmt|,
name|nbaud
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x3D
argument_list|(
name|rpt
argument_list|,
operator|&
name|tx_baud_index
argument_list|,
operator|&
name|rx_baud_index
argument_list|,
operator|&
name|char_format_index
argument_list|,
operator|&
name|stop_bits
argument_list|,
operator|&
name|tx_mode_index
argument_list|,
operator|&
name|rx_mode_index
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nChannel A Configuration"
argument_list|)
expr_stmt|;
name|nbaud
operator|=
sizeof|sizeof
argument_list|(
name|old_baudnum
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nbaud
condition|;
operator|++
name|i
control|)
if|if
condition|(
name|tx_baud_index
operator|==
name|old_baudnum
index|[
name|i
index|]
condition|)
break|break;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   Transmit speed: %s at %s"
argument_list|,
name|old_output_ch
index|[
name|tx_mode_index
index|]
argument_list|,
name|st_baud_text_app
index|[
name|i
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nbaud
condition|;
operator|++
name|i
control|)
if|if
condition|(
name|rx_baud_index
operator|==
name|old_baudnum
index|[
name|i
index|]
condition|)
break|break;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   Receive speed: %s at %s"
argument_list|,
name|old_input_ch
index|[
name|rx_mode_index
index|]
argument_list|,
name|st_baud_text_app
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|databits
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
operator|(
name|char_format_index
operator|&
literal|0x03
operator|)
operator|+
literal|5
argument_list|)
expr_stmt|;
name|parity
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|char_format_index
operator|>>
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|parity
operator|>
literal|4
condition|)
name|parity
operator|=
literal|2
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   Character format (bits/char, parity, stop bits): %d-%s-%d"
argument_list|,
name|databits
argument_list|,
name|old_parity_text
index|[
name|parity
index|]
argument_list|,
name|stop_bits
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**/
end_comment

begin_comment
comment|/* 0x40 */
end_comment

begin_function
specifier|static
name|void
name|rpt_almanac_data_page
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|sv_prn
decl_stmt|;
name|short
name|week_num
decl_stmt|;
name|float
name|t_zc
decl_stmt|,
name|eccentricity
decl_stmt|,
name|t_oa
decl_stmt|,
name|i_0
decl_stmt|,
name|OMEGA_dot
decl_stmt|,
name|sqrt_A
decl_stmt|,
name|OMEGA_0
decl_stmt|,
name|omega
decl_stmt|,
name|M_0
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x40
argument_list|(
name|rpt
argument_list|,
operator|&
name|sv_prn
argument_list|,
operator|&
name|week_num
argument_list|,
operator|&
name|t_zc
argument_list|,
operator|&
name|eccentricity
argument_list|,
operator|&
name|t_oa
argument_list|,
operator|&
name|i_0
argument_list|,
operator|&
name|OMEGA_dot
argument_list|,
operator|&
name|sqrt_A
argument_list|,
operator|&
name|OMEGA_0
argument_list|,
operator|&
name|omega
argument_list|,
operator|&
name|M_0
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nAlmanac for SV %02d"
argument_list|,
name|sv_prn
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n       Captured:%15.0f %s"
argument_list|,
name|t_zc
argument_list|,
name|show_time
argument_list|(
name|t_zc
argument_list|)
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n           week:%15d"
argument_list|,
name|week_num
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   Eccentricity:%15g"
argument_list|,
name|eccentricity
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n           T_oa:%15.0f %s"
argument_list|,
name|t_oa
argument_list|,
name|show_time
argument_list|(
name|t_oa
argument_list|)
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n            i 0:%15g"
argument_list|,
name|i_0
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n      OMEGA dot:%15g"
argument_list|,
name|OMEGA_dot
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n         sqrt A:%15g"
argument_list|,
name|sqrt_A
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n        OMEGA 0:%15g"
argument_list|,
name|OMEGA_0
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n          omega:%15g"
argument_list|,
name|omega
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n            M 0:%15g"
argument_list|,
name|M_0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x41 */
end_comment

begin_function
specifier|static
name|void
name|rpt_GPS_time
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|float
name|time_of_week
decl_stmt|,
name|UTC_offset
decl_stmt|;
name|short
name|week_num
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x41
argument_list|(
name|rpt
argument_list|,
operator|&
name|time_of_week
argument_list|,
operator|&
name|UTC_offset
argument_list|,
operator|&
name|week_num
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nGPS time:%s GPS week: %d   UTC offset %.1f"
argument_list|,
name|show_time
argument_list|(
name|time_of_week
argument_list|)
argument_list|,
name|week_num
argument_list|,
name|UTC_offset
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x42 */
end_comment

begin_function
specifier|static
name|void
name|rpt_single_ECEF_position
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|float
name|ECEF_pos
index|[
literal|3
index|]
decl_stmt|,
name|time_of_fix
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x42
argument_list|(
name|rpt
argument_list|,
name|ECEF_pos
argument_list|,
operator|&
name|time_of_fix
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nSXYZ:  %15.0f  %15.0f  %15.0f    %s"
argument_list|,
name|ECEF_pos
index|[
literal|0
index|]
argument_list|,
name|ECEF_pos
index|[
literal|1
index|]
argument_list|,
name|ECEF_pos
index|[
literal|2
index|]
argument_list|,
name|show_time
argument_list|(
name|time_of_fix
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x43 */
end_comment

begin_function
specifier|static
name|void
name|rpt_single_ECEF_velocity
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|float
name|ECEF_vel
index|[
literal|3
index|]
decl_stmt|,
name|freq_offset
decl_stmt|,
name|time_of_fix
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x43
argument_list|(
name|rpt
argument_list|,
name|ECEF_vel
argument_list|,
operator|&
name|freq_offset
argument_list|,
operator|&
name|time_of_fix
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nVelECEF: %11.3f  %11.3f  %11.3f  %12.3f%s"
argument_list|,
name|ECEF_vel
index|[
literal|0
index|]
argument_list|,
name|ECEF_vel
index|[
literal|1
index|]
argument_list|,
name|ECEF_vel
index|[
literal|2
index|]
argument_list|,
name|freq_offset
argument_list|,
name|show_time
argument_list|(
name|time_of_fix
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  0x45  */
end_comment

begin_function
specifier|static
name|void
name|rpt_SW_version
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|major_nav_version
decl_stmt|,
name|minor_nav_version
decl_stmt|,
name|nav_day
decl_stmt|,
name|nav_month
decl_stmt|,
name|nav_year
decl_stmt|,
name|major_dsp_version
decl_stmt|,
name|minor_dsp_version
decl_stmt|,
name|dsp_day
decl_stmt|,
name|dsp_month
decl_stmt|,
name|dsp_year
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x45
argument_list|(
name|rpt
argument_list|,
operator|&
name|major_nav_version
argument_list|,
operator|&
name|minor_nav_version
argument_list|,
operator|&
name|nav_day
argument_list|,
operator|&
name|nav_month
argument_list|,
operator|&
name|nav_year
argument_list|,
operator|&
name|major_dsp_version
argument_list|,
operator|&
name|minor_dsp_version
argument_list|,
operator|&
name|dsp_day
argument_list|,
operator|&
name|dsp_month
argument_list|,
operator|&
name|dsp_year
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nFW Versions:  Nav Proc %2d.%02d  %2d/%2d/%2d  Sig Proc %2d.%02d  %2d/%2d/%2d"
argument_list|,
name|major_nav_version
argument_list|,
name|minor_nav_version
argument_list|,
name|nav_day
argument_list|,
name|nav_month
argument_list|,
name|nav_year
argument_list|,
name|major_dsp_version
argument_list|,
name|minor_dsp_version
argument_list|,
name|dsp_day
argument_list|,
name|dsp_month
argument_list|,
name|dsp_year
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x46 */
end_comment

begin_function
specifier|static
name|void
name|rpt_rcvr_health
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|status1
decl_stmt|,
name|status2
decl_stmt|;
specifier|static
name|char
modifier|*
name|sc_text
index|[]
init|=
block|{
literal|"Doing position fixes"
block|,
literal|"Don't have GPS time yet"
block|,
literal|"Waiting for almanac collection"
block|,
literal|"DOP too high          "
block|,
literal|"No satellites available"
block|,
literal|"Only 1 satellite available"
block|,
literal|"Only 2 satellites available"
block|,
literal|"Only 3 satellites available"
block|,
literal|"No satellites usable   "
block|,
literal|"Only 1 satellite usable"
block|,
literal|"Only 2 satellites usable"
block|,
literal|"Only 3 satellites usable"
block|,
literal|"Chosen satellite unusable"
block|}
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x46
argument_list|(
name|rpt
argument_list|,
operator|&
name|status1
argument_list|,
operator|&
name|status2
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nRcvr status1: %s (%02Xh); "
argument_list|,
name|sc_text
index|[
name|rpt
operator|->
name|buf
index|[
literal|0
index|]
index|]
argument_list|,
name|status1
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"status2: %s, %s (%02Xh)"
argument_list|,
operator|(
name|status2
operator|&
literal|0x01
operator|)
condition|?
literal|"No BBRAM"
else|:
literal|"BBRAM OK"
argument_list|,
operator|(
name|status2
operator|&
literal|0x10
operator|)
condition|?
literal|"No Ant"
else|:
literal|"Ant OK"
argument_list|,
name|status2
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x47 */
end_comment

begin_function
specifier|static
name|void
name|rpt_SNR_all_SVs
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|nsvs
decl_stmt|,
name|sv_prn
index|[
literal|12
index|]
decl_stmt|;
name|short
name|isv
decl_stmt|;
name|float
name|snr
index|[
literal|12
index|]
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x47
argument_list|(
name|rpt
argument_list|,
operator|&
name|nsvs
argument_list|,
name|sv_prn
argument_list|,
name|snr
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nSNR for satellites: %d"
argument_list|,
name|nsvs
argument_list|)
expr_stmt|;
for|for
control|(
name|isv
operator|=
literal|0
init|;
name|isv
operator|<
name|nsvs
condition|;
name|isv
operator|++
control|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    SV %02d   %6.2f"
argument_list|,
name|sv_prn
index|[
name|isv
index|]
argument_list|,
name|snr
index|[
name|isv
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* 0x48 */
end_comment

begin_function
specifier|static
name|void
name|rpt_GPS_system_message
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|message
index|[
literal|23
index|]
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x48
argument_list|(
name|rpt
argument_list|,
name|message
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nGPS message: %s"
argument_list|,
name|message
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x49 */
end_comment

begin_function
specifier|static
name|void
name|rpt_almanac_health_page
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|short
name|iprn
decl_stmt|;
name|unsigned
name|char
name|sv_health
index|[
literal|32
index|]
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x49
argument_list|(
name|rpt
argument_list|,
name|sv_health
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nAlmanac health page:"
argument_list|)
expr_stmt|;
for|for
control|(
name|iprn
operator|=
literal|0
init|;
name|iprn
operator|<
literal|32
condition|;
name|iprn
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|iprn
operator|%
literal|5
operator|)
condition|)
operator|*
name|pbuf
operator|++
operator|=
literal|'\n'
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"    SV%02d  %2X"
argument_list|,
operator|(
name|iprn
operator|+
literal|1
operator|)
argument_list|,
name|sv_health
index|[
name|iprn
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* 0x4A */
end_comment

begin_function
specifier|static
name|void
name|rpt_single_lla_position
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|short
name|lat_deg
decl_stmt|,
name|lon_deg
decl_stmt|;
name|float
name|lat
decl_stmt|,
name|lon
decl_stmt|,
name|alt
decl_stmt|,
name|clock_bias
decl_stmt|,
name|time_of_fix
decl_stmt|;
name|double
name|lat_min
decl_stmt|,
name|lon_min
decl_stmt|;
name|unsigned
name|char
name|north_south
decl_stmt|,
name|east_west
decl_stmt|;
if|if
condition|(
name|rpt_0x4A
argument_list|(
name|rpt
argument_list|,
operator|&
name|lat
argument_list|,
operator|&
name|lon
argument_list|,
operator|&
name|alt
argument_list|,
operator|&
name|clock_bias
argument_list|,
operator|&
name|time_of_fix
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
comment|/* convert from radians to degrees */
name|lat
operator|*=
operator|(
name|float
operator|)
name|R2D
expr_stmt|;
name|north_south
operator|=
literal|'N'
expr_stmt|;
if|if
condition|(
name|lat
operator|<
literal|0.0
condition|)
block|{
name|north_south
operator|=
literal|'S'
expr_stmt|;
name|lat
operator|=
operator|-
name|lat
expr_stmt|;
block|}
name|lat_deg
operator|=
operator|(
name|short
operator|)
name|lat
expr_stmt|;
name|lat_min
operator|=
operator|(
name|lat
operator|-
name|lat_deg
operator|)
operator|*
literal|60.0
expr_stmt|;
name|lon
operator|*=
operator|(
name|float
operator|)
name|R2D
expr_stmt|;
name|east_west
operator|=
literal|'E'
expr_stmt|;
if|if
condition|(
name|lon
operator|<
literal|0.0
condition|)
block|{
name|east_west
operator|=
literal|'W'
expr_stmt|;
name|lon
operator|=
operator|-
name|lon
expr_stmt|;
block|}
name|lon_deg
operator|=
operator|(
name|short
operator|)
name|lon
expr_stmt|;
name|lon_min
operator|=
operator|(
name|lon
operator|-
name|lon_deg
operator|)
operator|*
literal|60.0
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nSLLA: %4d: %06.3f  %c%5d:%06.3f  %c%10.2f  %12.2f%s"
argument_list|,
name|lat_deg
argument_list|,
name|lat_min
argument_list|,
name|north_south
argument_list|,
name|lon_deg
argument_list|,
name|lon_min
argument_list|,
name|east_west
argument_list|,
name|alt
argument_list|,
name|clock_bias
argument_list|,
name|show_time
argument_list|(
name|time_of_fix
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x4A */
end_comment

begin_function
specifier|static
name|void
name|rpt_ref_alt
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|float
name|alt
decl_stmt|,
name|dummy
decl_stmt|;
name|unsigned
name|char
name|alt_flag
decl_stmt|;
if|if
condition|(
name|rpt_0x4A_2
argument_list|(
name|rpt
argument_list|,
operator|&
name|alt
argument_list|,
operator|&
name|dummy
argument_list|,
operator|&
name|alt_flag
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nReference Alt:   %.1f m;    %s"
argument_list|,
name|alt
argument_list|,
name|alt_flag
condition|?
literal|"ON"
else|:
literal|"OFF"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x4B */
end_comment

begin_function
specifier|static
name|void
name|rpt_rcvr_id_and_status
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|machine_id
decl_stmt|,
name|status3
decl_stmt|,
name|status4
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x4B
argument_list|(
name|rpt
argument_list|,
operator|&
name|machine_id
argument_list|,
operator|&
name|status3
argument_list|,
operator|&
name|status4
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nRcvr Machine ID: %d; Status3 = %s, %s (%02Xh)"
argument_list|,
name|machine_id
argument_list|,
operator|(
name|status3
operator|&
literal|0x02
operator|)
condition|?
literal|"No RTC"
else|:
literal|"RTC OK"
argument_list|,
operator|(
name|status3
operator|&
literal|0x08
operator|)
condition|?
literal|"No Alm"
else|:
literal|"Alm OK"
argument_list|,
name|status3
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x4C */
end_comment

begin_function
specifier|static
name|void
name|rpt_operating_parameters
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|dyn_code
decl_stmt|;
name|float
name|el_mask
decl_stmt|,
name|snr_mask
decl_stmt|,
name|dop_mask
decl_stmt|,
name|dop_switch
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x4C
argument_list|(
name|rpt
argument_list|,
operator|&
name|dyn_code
argument_list|,
operator|&
name|el_mask
argument_list|,
operator|&
name|snr_mask
argument_list|,
operator|&
name|dop_mask
argument_list|,
operator|&
name|dop_switch
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nOperating Parameters:"
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n     Dynamics code = %d %s"
argument_list|,
name|dyn_code
argument_list|,
name|dyn_text
index|[
name|dyn_code
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n     Elevation mask = %.2f"
argument_list|,
name|el_mask
operator|*
name|R2D
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n     SNR mask = %.2f"
argument_list|,
name|snr_mask
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n     DOP mask = %.2f"
argument_list|,
name|dop_mask
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n     DOP switch = %.2f"
argument_list|,
name|dop_switch
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x4D */
end_comment

begin_function
specifier|static
name|void
name|rpt_oscillator_offset
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|float
name|osc_offset
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x4D
argument_list|(
name|rpt
argument_list|,
operator|&
name|osc_offset
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nOscillator offset: %.2f Hz = %.3f PPM"
argument_list|,
name|osc_offset
argument_list|,
name|osc_offset
operator|/
literal|1575.42
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x4E */
end_comment

begin_function
specifier|static
name|void
name|rpt_GPS_time_set_response
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|response
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x4E
argument_list|(
name|rpt
argument_list|,
operator|&
name|response
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|response
condition|)
block|{
case|case
literal|'Y'
case|:
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nTime set accepted"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'N'
case|:
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nTime set rejected or not required"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|parsed
operator|=
name|BADDATA_PARSE
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* 0x4F */
end_comment

begin_function
specifier|static
name|void
name|rpt_UTC_offset
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|double
name|a0
decl_stmt|;
name|float
name|a1
decl_stmt|,
name|time_of_data
decl_stmt|;
name|short
name|dt_ls
decl_stmt|,
name|wn_t
decl_stmt|,
name|wn_lsf
decl_stmt|,
name|dn
decl_stmt|,
name|dt_lsf
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x4F
argument_list|(
name|rpt
argument_list|,
operator|&
name|a0
argument_list|,
operator|&
name|a1
argument_list|,
operator|&
name|time_of_data
argument_list|,
operator|&
name|dt_ls
argument_list|,
operator|&
name|wn_t
argument_list|,
operator|&
name|wn_lsf
argument_list|,
operator|&
name|dn
argument_list|,
operator|&
name|dt_lsf
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nUTC Correction Data"
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   A_0         = %g  "
argument_list|,
name|a0
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   A_1         = %g  "
argument_list|,
name|a1
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   delta_t_LS  = %d  "
argument_list|,
name|dt_ls
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   t_ot        = %.0f  "
argument_list|,
name|time_of_data
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   WN_t        = %d  "
argument_list|,
name|wn_t
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   WN_LSF      = %d  "
argument_list|,
name|wn_lsf
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   DN          = %d  "
argument_list|,
name|dn
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   delta_t_LSF = %d  "
argument_list|,
name|dt_lsf
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**/
end_comment

begin_comment
comment|/* 0x54 */
end_comment

begin_function
specifier|static
name|void
name|rpt_1SV_bias
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|float
name|clock_bias
decl_stmt|,
name|freq_offset
decl_stmt|,
name|time_of_fix
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x54
argument_list|(
name|rpt
argument_list|,
operator|&
name|clock_bias
argument_list|,
operator|&
name|freq_offset
argument_list|,
operator|&
name|time_of_fix
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nTime Fix   Clock Bias: %6.2f m  Freq Bias: %6.2f m/s%s"
argument_list|,
name|clock_bias
argument_list|,
name|freq_offset
argument_list|,
name|show_time
argument_list|(
name|time_of_fix
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x55 */
end_comment

begin_function
specifier|static
name|void
name|rpt_io_opt
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|pos_code
decl_stmt|,
name|vel_code
decl_stmt|,
name|time_code
decl_stmt|,
name|aux_code
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x55
argument_list|(
name|rpt
argument_list|,
operator|&
name|pos_code
argument_list|,
operator|&
name|vel_code
argument_list|,
operator|&
name|time_code
argument_list|,
operator|&
name|aux_code
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
comment|/* rptbuf unloaded */
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nI/O Options: %2X %2X %2X %2X"
argument_list|,
name|pos_code
argument_list|,
name|vel_code
argument_list|,
name|time_code
argument_list|,
name|aux_code
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos_code
operator|&
literal|0x01
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    ECEF XYZ position output"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pos_code
operator|&
literal|0x02
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    LLA position output"
argument_list|)
expr_stmt|;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
operator|(
name|pos_code
operator|&
literal|0x04
operator|)
condition|?
literal|"\n    MSL altitude output (Geoid height) "
else|:
literal|"\n    WGS-84 altitude output"
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
operator|(
name|pos_code
operator|&
literal|0x08
operator|)
condition|?
literal|"\n    MSL altitude input"
else|:
literal|"\n    WGS-84 altitude input"
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
operator|(
name|pos_code
operator|&
literal|0x10
operator|)
condition|?
literal|"\n    Double precision"
else|:
literal|"\n    Single precision"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos_code
operator|&
literal|0x20
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    All Enabled Superpackets"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vel_code
operator|&
literal|0x01
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    ECEF XYZ velocity output"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vel_code
operator|&
literal|0x02
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    ENU velocity output"
argument_list|)
expr_stmt|;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
operator|(
name|time_code
operator|&
literal|0x01
operator|)
condition|?
literal|"\n    Time tags in UTC"
else|:
literal|"\n    Time tags in GPS time"
argument_list|)
expr_stmt|;
if|if
condition|(
name|time_code
operator|&
literal|0x02
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    Fixes delayed to integer seconds"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|time_code
operator|&
literal|0x04
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    Fixes sent only on request"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|time_code
operator|&
literal|0x08
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    Synchronized measurements"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|time_code
operator|&
literal|0x10
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    Minimize measurement propagation"
argument_list|)
expr_stmt|;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
operator|(
name|time_code
operator|&
literal|0x20
operator|)
condition|?
literal|"\n    PPS output at all times"
else|:
literal|"\n    PPS output during fixes"
argument_list|)
expr_stmt|;
if|if
condition|(
name|aux_code
operator|&
literal|0x01
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    Raw measurement output"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|aux_code
operator|&
literal|0x02
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    Code-phase smoothed before output"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|aux_code
operator|&
literal|0x04
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    Additional fix status"
argument_list|)
expr_stmt|;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
operator|(
name|aux_code
operator|&
literal|0x08
operator|)
condition|?
literal|"\n    Signal Strength Output as dBHz"
else|:
literal|"\n    Signal Strength Output as AMU"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x56 */
end_comment

begin_function
specifier|static
name|void
name|rpt_ENU_velocity
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|float
name|vel_ENU
index|[
literal|3
index|]
decl_stmt|,
name|freq_offset
decl_stmt|,
name|time_of_fix
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x56
argument_list|(
name|rpt
argument_list|,
name|vel_ENU
argument_list|,
operator|&
name|freq_offset
argument_list|,
operator|&
name|time_of_fix
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nVel ENU: %11.3f  %11.3f  %11.3f  %12.3f%s"
argument_list|,
name|vel_ENU
index|[
literal|0
index|]
argument_list|,
name|vel_ENU
index|[
literal|1
index|]
argument_list|,
name|vel_ENU
index|[
literal|2
index|]
argument_list|,
name|freq_offset
argument_list|,
name|show_time
argument_list|(
name|time_of_fix
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x57 */
end_comment

begin_function
specifier|static
name|void
name|rpt_last_fix_info
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|source_code
decl_stmt|,
name|diag_code
decl_stmt|;
name|short
name|week_num
decl_stmt|;
name|float
name|time_of_fix
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x57
argument_list|(
name|rpt
argument_list|,
operator|&
name|source_code
argument_list|,
operator|&
name|diag_code
argument_list|,
operator|&
name|week_num
argument_list|,
operator|&
name|time_of_fix
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n source code %d;   diag code: %2Xh"
argument_list|,
name|source_code
argument_list|,
name|diag_code
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    Time of last fix:%s"
argument_list|,
name|show_time
argument_list|(
name|time_of_fix
argument_list|)
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    Week of last fix: %d"
argument_list|,
name|week_num
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x58 */
end_comment

begin_function
specifier|static
name|void
name|rpt_GPS_system_data
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|iprn
decl_stmt|,
name|op_code
decl_stmt|,
name|data_type
decl_stmt|,
name|sv_prn
decl_stmt|,
name|data_length
decl_stmt|,
name|data_packet
index|[
literal|250
index|]
decl_stmt|;
name|ALM_INFO
modifier|*
name|almanac
decl_stmt|;
name|ALH_PARMS
modifier|*
name|almh
decl_stmt|;
name|UTC_INFO
modifier|*
name|utc
decl_stmt|;
name|ION_INFO
modifier|*
name|ionosphere
decl_stmt|;
name|EPHEM_CLOCK
modifier|*
name|cdata
decl_stmt|;
name|EPHEM_ORBIT
modifier|*
name|edata
decl_stmt|;
name|NAV_INFO
modifier|*
name|nav_data
decl_stmt|;
name|unsigned
name|char
name|curr_t_oa
decl_stmt|;
name|unsigned
name|short
name|curr_wn_oa
decl_stmt|;
specifier|static
name|char
modifier|*
name|datname
index|[]
init|=
block|{
literal|""
block|,
literal|""
block|,
literal|"Almanac Orbit"
block|,
literal|"Health Page& Ref Time"
block|,
literal|"Ionosphere"
block|,
literal|"UTC "
block|,
literal|"Ephemeris"
block|}
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x58
argument_list|(
name|rpt
argument_list|,
operator|&
name|op_code
argument_list|,
operator|&
name|data_type
argument_list|,
operator|&
name|sv_prn
argument_list|,
operator|&
name|data_length
argument_list|,
name|data_packet
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nSystem data [%d]:  %s  SV%02d"
argument_list|,
name|data_type
argument_list|,
name|datname
index|[
name|data_type
index|]
argument_list|,
name|sv_prn
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|op_code
condition|)
block|{
case|case
literal|1
case|:
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"  Acknowledgment"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"  length = %d bytes"
argument_list|,
name|data_length
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|data_type
condition|)
block|{
case|case
literal|2
case|:
comment|/* Almanac */
if|if
condition|(
name|sv_prn
operator|==
literal|0
operator|||
name|sv_prn
operator|>
literal|32
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"  Binary PRN invalid"
argument_list|)
expr_stmt|;
return|return;
block|}
name|almanac
operator|=
operator|(
name|ALM_INFO
operator|*
operator|)
name|data_packet
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   t_oa_raw = % -12d    SV_hlth  = % -12d  "
argument_list|,
name|almanac
operator|->
name|t_oa_raw
argument_list|,
name|almanac
operator|->
name|SV_health
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   e        = % -12g    t_oa     = % -12g  "
argument_list|,
name|almanac
operator|->
name|e
argument_list|,
name|almanac
operator|->
name|t_oa
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   i_0      = % -12g    OMEGADOT = % -12g  "
argument_list|,
name|almanac
operator|->
name|i_0
argument_list|,
name|almanac
operator|->
name|OMEGADOT
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   sqrt_A   = % -12g    OMEGA_0  = % -12g  "
argument_list|,
name|almanac
operator|->
name|sqrt_A
argument_list|,
name|almanac
operator|->
name|OMEGA_0
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   omega    = % -12g    M_0      = % -12g  "
argument_list|,
name|almanac
operator|->
name|omega
argument_list|,
name|almanac
operator|->
name|M_0
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   a_f0     = % -12g    a_f1     = % -12g  "
argument_list|,
name|almanac
operator|->
name|a_f0
argument_list|,
name|almanac
operator|->
name|a_f1
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   Axis     = % -12g    n        = % -12g  "
argument_list|,
name|almanac
operator|->
name|Axis
argument_list|,
name|almanac
operator|->
name|n
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   OMEGA_n  = % -12g    ODOT_n   = % -12g  "
argument_list|,
name|almanac
operator|->
name|OMEGA_n
argument_list|,
name|almanac
operator|->
name|ODOT_n
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   t_zc     = % -12g    weeknum  = % -12d  "
argument_list|,
name|almanac
operator|->
name|t_zc
argument_list|,
name|almanac
operator|->
name|weeknum
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   wn_oa    = % -12d"
argument_list|,
name|almanac
operator|->
name|wn_oa
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
comment|/* Almanac health page */
name|almh
operator|=
operator|(
name|ALH_PARMS
operator|*
operator|)
name|data_packet
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   t_oa = %d, wn_oa&0xFF = %d  "
argument_list|,
name|almh
operator|->
name|t_oa
argument_list|,
name|almh
operator|->
name|WN_a
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nAlmanac health page:"
argument_list|)
expr_stmt|;
for|for
control|(
name|iprn
operator|=
literal|0
init|;
name|iprn
operator|<
literal|32
condition|;
name|iprn
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|iprn
operator|%
literal|5
operator|)
condition|)
operator|*
name|pbuf
operator|++
operator|=
literal|'\n'
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"    SV%02d  %2X"
argument_list|,
operator|(
name|iprn
operator|+
literal|1
operator|)
argument_list|,
name|almh
operator|->
name|SV_health
index|[
name|iprn
index|]
argument_list|)
expr_stmt|;
block|}
name|curr_t_oa
operator|=
name|data_packet
index|[
literal|34
index|]
expr_stmt|;
name|curr_wn_oa
operator|=
call|(
name|unsigned
name|short
call|)
argument_list|(
operator|(
name|data_packet
index|[
literal|35
index|]
operator|<<
literal|8
operator|)
operator|+
name|data_packet
index|[
literal|36
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   current t_oa = %d, wn_oa = %d  "
argument_list|,
name|curr_t_oa
argument_list|,
name|curr_wn_oa
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
comment|/* Ionosphere */
name|ionosphere
operator|=
operator|(
name|ION_INFO
operator|*
operator|)
name|data_packet
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   alpha_0 = % -12g  alpha_1 = % -12g "
argument_list|,
name|ionosphere
operator|->
name|alpha_0
argument_list|,
name|ionosphere
operator|->
name|alpha_1
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   alpha_2 = % -12g  alpha_3 = % -12g "
argument_list|,
name|ionosphere
operator|->
name|alpha_2
argument_list|,
name|ionosphere
operator|->
name|alpha_3
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   beta_0  = % -12g  beta_1  = % -12g  "
argument_list|,
name|ionosphere
operator|->
name|beta_0
argument_list|,
name|ionosphere
operator|->
name|beta_1
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   beta_2  = % -12g  beta_3  = % -12g  "
argument_list|,
name|ionosphere
operator|->
name|beta_2
argument_list|,
name|ionosphere
operator|->
name|beta_3
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
comment|/* UTC */
name|utc
operator|=
operator|(
name|UTC_INFO
operator|*
operator|)
name|data_packet
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   A_0         = %g  "
argument_list|,
name|utc
operator|->
name|A_0
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   A_1         = %g  "
argument_list|,
name|utc
operator|->
name|A_1
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   delta_t_LS  = %d  "
argument_list|,
name|utc
operator|->
name|delta_t_LS
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   t_ot        = %.0f  "
argument_list|,
name|utc
operator|->
name|t_ot
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   WN_t        = %d  "
argument_list|,
name|utc
operator|->
name|WN_t
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   WN_LSF      = %d  "
argument_list|,
name|utc
operator|->
name|WN_LSF
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   DN          = %d  "
argument_list|,
name|utc
operator|->
name|DN
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   delta_t_LSF = %d  "
argument_list|,
name|utc
operator|->
name|delta_t_LSF
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
comment|/* Ephemeris */
if|if
condition|(
name|sv_prn
operator|==
literal|0
operator|||
name|sv_prn
operator|>
literal|32
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"  Binary PRN invalid"
argument_list|)
expr_stmt|;
return|return;
block|}
name|nav_data
operator|=
operator|(
name|NAV_INFO
operator|*
operator|)
name|data_packet
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n     SV_PRN = % -12d .  t_ephem = % -12g . "
argument_list|,
name|nav_data
operator|->
name|sv_number
argument_list|,
name|nav_data
operator|->
name|t_ephem
argument_list|)
expr_stmt|;
name|cdata
operator|=
operator|&
operator|(
name|nav_data
operator|->
name|ephclk
operator|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    weeknum = % -12d .   codeL2 = % -12d .  L2Pdata = % -12d"
argument_list|,
name|cdata
operator|->
name|weeknum
argument_list|,
name|cdata
operator|->
name|codeL2
argument_list|,
name|cdata
operator|->
name|L2Pdata
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n  SVacc_raw = % -12d .SV_health = % -12d .     IODC = % -12d"
argument_list|,
name|cdata
operator|->
name|SVacc_raw
argument_list|,
name|cdata
operator|->
name|SV_health
argument_list|,
name|cdata
operator|->
name|IODC
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n       T_GD = % -12g .     t_oc = % -12g .     a_f2 = % -12g"
argument_list|,
name|cdata
operator|->
name|T_GD
argument_list|,
name|cdata
operator|->
name|t_oc
argument_list|,
name|cdata
operator|->
name|a_f2
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n       a_f1 = % -12g .     a_f0 = % -12g .    SVacc = % -12g"
argument_list|,
name|cdata
operator|->
name|a_f1
argument_list|,
name|cdata
operator|->
name|a_f0
argument_list|,
name|cdata
operator|->
name|SVacc
argument_list|)
expr_stmt|;
name|edata
operator|=
operator|&
operator|(
name|nav_data
operator|->
name|ephorb
operator|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n       IODE = % -12d .fit_intvl = % -12d .     C_rs = % -12g"
argument_list|,
name|edata
operator|->
name|IODE
argument_list|,
name|edata
operator|->
name|fit_interval
argument_list|,
name|edata
operator|->
name|C_rs
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    delta_n = % -12g .      M_0 = % -12g .     C_uc = % -12g"
argument_list|,
name|edata
operator|->
name|delta_n
argument_list|,
name|edata
operator|->
name|M_0
argument_list|,
name|edata
operator|->
name|C_uc
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n        ecc = % -12g .     C_us = % -12g .   sqrt_A = % -12g"
argument_list|,
name|edata
operator|->
name|e
argument_list|,
name|edata
operator|->
name|C_us
argument_list|,
name|edata
operator|->
name|sqrt_A
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n       t_oe = % -12g .     C_ic = % -12g .  OMEGA_0 = % -12g"
argument_list|,
name|edata
operator|->
name|t_oe
argument_list|,
name|edata
operator|->
name|C_ic
argument_list|,
name|edata
operator|->
name|OMEGA_0
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n       C_is = % -12g .      i_0 = % -12g .     C_rc = % -12g"
argument_list|,
name|edata
operator|->
name|C_is
argument_list|,
name|edata
operator|->
name|i_0
argument_list|,
name|edata
operator|->
name|C_rc
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n      omega = % -12g . OMEGADOT = % -12g .     IDOT = % -12g"
argument_list|,
name|edata
operator|->
name|omega
argument_list|,
name|edata
operator|->
name|OMEGADOT
argument_list|,
name|edata
operator|->
name|IDOT
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n       Axis = % -12g .        n = % -12g .    r1me2 = % -12g"
argument_list|,
name|edata
operator|->
name|Axis
argument_list|,
name|edata
operator|->
name|n
argument_list|,
name|edata
operator|->
name|r1me2
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    OMEGA_n = % -12g .   ODOT_n = % -12g"
argument_list|,
name|edata
operator|->
name|OMEGA_n
argument_list|,
name|edata
operator|->
name|ODOT_n
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_comment
comment|/* 0x59: */
end_comment

begin_function
specifier|static
name|void
name|rpt_SVs_enabled
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|numsvs
decl_stmt|,
name|code_type
decl_stmt|,
name|status_code
index|[
literal|32
index|]
decl_stmt|;
name|short
name|iprn
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x59
argument_list|(
name|rpt
argument_list|,
operator|&
name|code_type
argument_list|,
name|status_code
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|code_type
condition|)
block|{
case|case
literal|3
case|:
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nSVs Disabled:\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nSVs with Health Ignored:\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return;
block|}
name|numsvs
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|iprn
operator|=
literal|0
init|;
name|iprn
operator|<
literal|32
condition|;
name|iprn
operator|++
control|)
block|{
if|if
condition|(
name|status_code
index|[
name|iprn
index|]
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|" %02d"
argument_list|,
name|iprn
operator|+
literal|1
argument_list|)
expr_stmt|;
name|numsvs
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
name|numsvs
operator|==
literal|0
condition|)
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"None"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x5A */
end_comment

begin_function
specifier|static
name|void
name|rpt_raw_msmt
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|sv_prn
decl_stmt|;
name|float
name|sample_length
decl_stmt|,
name|signal_level
decl_stmt|,
name|code_phase
decl_stmt|,
name|Doppler
decl_stmt|;
name|double
name|time_of_fix
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x5A
argument_list|(
name|rpt
argument_list|,
operator|&
name|sv_prn
argument_list|,
operator|&
name|sample_length
argument_list|,
operator|&
name|signal_level
argument_list|,
operator|&
name|code_phase
argument_list|,
operator|&
name|Doppler
argument_list|,
operator|&
name|time_of_fix
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   %02d %5.0f %7.1f %10.2f %10.2f %12.3f %s"
argument_list|,
name|sv_prn
argument_list|,
name|sample_length
argument_list|,
name|signal_level
argument_list|,
name|code_phase
argument_list|,
name|Doppler
argument_list|,
name|time_of_fix
argument_list|,
name|show_time
argument_list|(
operator|(
name|float
operator|)
name|time_of_fix
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x5B */
end_comment

begin_function
specifier|static
name|void
name|rpt_SV_ephemeris_status
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|sv_prn
decl_stmt|,
name|sv_health
decl_stmt|,
name|sv_iode
decl_stmt|,
name|fit_interval_flag
decl_stmt|;
name|float
name|time_of_collection
decl_stmt|,
name|time_of_eph
decl_stmt|,
name|sv_accy
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x5B
argument_list|(
name|rpt
argument_list|,
operator|&
name|sv_prn
argument_list|,
operator|&
name|sv_health
argument_list|,
operator|&
name|sv_iode
argument_list|,
operator|&
name|fit_interval_flag
argument_list|,
operator|&
name|time_of_collection
argument_list|,
operator|&
name|time_of_eph
argument_list|,
operator|&
name|sv_accy
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n  SV%02d  %s   %2Xh     %2Xh "
argument_list|,
name|sv_prn
argument_list|,
name|show_time
argument_list|(
name|time_of_collection
argument_list|)
argument_list|,
name|sv_health
argument_list|,
name|sv_iode
argument_list|)
expr_stmt|;
comment|/* note: cannot use show_time twice in same call */
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"%s   %1d   %4.1f"
argument_list|,
name|show_time
argument_list|(
name|time_of_eph
argument_list|)
argument_list|,
name|fit_interval_flag
argument_list|,
name|sv_accy
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x5C */
end_comment

begin_function
specifier|static
name|void
name|rpt_SV_tracking_status
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|sv_prn
decl_stmt|,
name|chan
decl_stmt|,
name|slot
decl_stmt|,
name|acq_flag
decl_stmt|,
name|eph_flag
decl_stmt|,
name|old_msmt_flag
decl_stmt|,
name|integer_msec_flag
decl_stmt|,
name|bad_data_flag
decl_stmt|,
name|data_collect_flag
decl_stmt|;
name|float
name|signal_level
decl_stmt|,
name|time_of_last_msmt
decl_stmt|,
name|elev
decl_stmt|,
name|azim
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x5C
argument_list|(
name|rpt
argument_list|,
operator|&
name|sv_prn
argument_list|,
operator|&
name|slot
argument_list|,
operator|&
name|chan
argument_list|,
operator|&
name|acq_flag
argument_list|,
operator|&
name|eph_flag
argument_list|,
operator|&
name|signal_level
argument_list|,
operator|&
name|time_of_last_msmt
argument_list|,
operator|&
name|elev
argument_list|,
operator|&
name|azim
argument_list|,
operator|&
name|old_msmt_flag
argument_list|,
operator|&
name|integer_msec_flag
argument_list|,
operator|&
name|bad_data_flag
argument_list|,
operator|&
name|data_collect_flag
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n SV%2d  %1d   %1d   %1d   %4.1f  %s  %5.1f  %5.1f"
argument_list|,
name|sv_prn
argument_list|,
name|chan
argument_list|,
name|acq_flag
argument_list|,
name|eph_flag
argument_list|,
name|signal_level
argument_list|,
name|show_time
argument_list|(
name|time_of_last_msmt
argument_list|)
argument_list|,
name|elev
operator|*
name|R2D
argument_list|,
name|azim
operator|*
name|R2D
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**/
end_comment

begin_comment
comment|/* 0x6D */
end_comment

begin_function
specifier|static
name|void
name|rpt_allSV_selection
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|manual_mode
decl_stmt|,
name|nsvs
decl_stmt|,
name|sv_prn
index|[
literal|8
index|]
decl_stmt|,
name|ndim
decl_stmt|;
name|short
name|islot
decl_stmt|;
name|float
name|pdop
decl_stmt|,
name|hdop
decl_stmt|,
name|vdop
decl_stmt|,
name|tdop
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x6D
argument_list|(
name|rpt
argument_list|,
operator|&
name|manual_mode
argument_list|,
operator|&
name|nsvs
argument_list|,
operator|&
name|ndim
argument_list|,
name|sv_prn
argument_list|,
operator|&
name|pdop
argument_list|,
operator|&
name|hdop
argument_list|,
operator|&
name|vdop
argument_list|,
operator|&
name|tdop
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|ndim
condition|)
block|{
case|case
literal|0
case|:
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nMode: Searching, %d-SV:"
argument_list|,
name|nsvs
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nMode: One-SV Timing:"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
case|case
literal|4
case|:
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nMode: %c-%dD, %d-SV:"
argument_list|,
name|manual_mode
condition|?
literal|'M'
else|:
literal|'A'
argument_list|,
name|ndim
operator|-
literal|1
argument_list|,
name|nsvs
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nMode: Timing, %d-SV:"
argument_list|,
name|nsvs
argument_list|)
expr_stmt|;
break|break;
default|default:
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nMode: Unknown = %d:"
argument_list|,
name|ndim
argument_list|)
expr_stmt|;
break|break;
block|}
for|for
control|(
name|islot
operator|=
literal|0
init|;
name|islot
operator|<
name|nsvs
condition|;
name|islot
operator|++
control|)
block|{
if|if
condition|(
name|sv_prn
index|[
name|islot
index|]
condition|)
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|" %02d"
argument_list|,
name|sv_prn
index|[
name|islot
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ndim
operator|==
literal|3
operator|||
name|ndim
operator|==
literal|4
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|";  DOPs: P %.1f H %.1f V %.1f T %.1f"
argument_list|,
name|pdop
argument_list|,
name|hdop
argument_list|,
name|vdop
argument_list|,
name|tdop
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**/
end_comment

begin_comment
comment|/* 0x82 */
end_comment

begin_function
specifier|static
name|void
name|rpt_DGPS_position_mode
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|diff_mode
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x82
argument_list|(
name|rpt
argument_list|,
operator|&
name|diff_mode
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nFix is%s DGPS-corrected (%s mode)  (%d)"
argument_list|,
operator|(
name|diff_mode
operator|&
literal|1
operator|)
condition|?
literal|""
else|:
literal|" not"
argument_list|,
operator|(
name|diff_mode
operator|&
literal|2
operator|)
condition|?
literal|"auto"
else|:
literal|"manual"
argument_list|,
name|diff_mode
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x83 */
end_comment

begin_function
specifier|static
name|void
name|rpt_double_ECEF_position
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|double
name|ECEF_pos
index|[
literal|3
index|]
decl_stmt|,
name|clock_bias
decl_stmt|;
name|float
name|time_of_fix
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x83
argument_list|(
name|rpt
argument_list|,
name|ECEF_pos
argument_list|,
operator|&
name|clock_bias
argument_list|,
operator|&
name|time_of_fix
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nDXYZ:%12.2f  %13.2f  %13.2f %12.2f%s"
argument_list|,
name|ECEF_pos
index|[
literal|0
index|]
argument_list|,
name|ECEF_pos
index|[
literal|1
index|]
argument_list|,
name|ECEF_pos
index|[
literal|2
index|]
argument_list|,
name|clock_bias
argument_list|,
name|show_time
argument_list|(
name|time_of_fix
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x84 */
end_comment

begin_function
specifier|static
name|void
name|rpt_double_lla_position
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|short
name|lat_deg
decl_stmt|,
name|lon_deg
decl_stmt|;
name|double
name|lat
decl_stmt|,
name|lon
decl_stmt|,
name|lat_min
decl_stmt|,
name|lon_min
decl_stmt|,
name|alt
decl_stmt|,
name|clock_bias
decl_stmt|;
name|float
name|time_of_fix
decl_stmt|;
name|unsigned
name|char
name|north_south
decl_stmt|,
name|east_west
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x84
argument_list|(
name|rpt
argument_list|,
operator|&
name|lat
argument_list|,
operator|&
name|lon
argument_list|,
operator|&
name|alt
argument_list|,
operator|&
name|clock_bias
argument_list|,
operator|&
name|time_of_fix
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|lat
operator|*=
name|R2D
expr_stmt|;
name|lon
operator|*=
name|R2D
expr_stmt|;
if|if
condition|(
name|lat
operator|<
literal|0.0
condition|)
block|{
name|north_south
operator|=
literal|'S'
expr_stmt|;
name|lat
operator|=
operator|-
name|lat
expr_stmt|;
block|}
else|else
block|{
name|north_south
operator|=
literal|'N'
expr_stmt|;
block|}
name|lat_deg
operator|=
operator|(
name|short
operator|)
name|lat
expr_stmt|;
name|lat_min
operator|=
operator|(
name|lat
operator|-
name|lat_deg
operator|)
operator|*
literal|60.0
expr_stmt|;
if|if
condition|(
name|lon
operator|<
literal|0.0
condition|)
block|{
name|east_west
operator|=
literal|'W'
expr_stmt|;
name|lon
operator|=
operator|-
name|lon
expr_stmt|;
block|}
else|else
block|{
name|east_west
operator|=
literal|'E'
expr_stmt|;
block|}
name|lon_deg
operator|=
operator|(
name|short
operator|)
name|lon
expr_stmt|;
name|lon_min
operator|=
operator|(
name|lon
operator|-
name|lon_deg
operator|)
operator|*
literal|60.0
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nDLLA: %2d:%08.5f %c; %3d:%08.5f %c; %10.2f %12.2f%s"
argument_list|,
name|lat_deg
argument_list|,
name|lat_min
argument_list|,
name|north_south
argument_list|,
name|lon_deg
argument_list|,
name|lon_min
argument_list|,
name|east_west
argument_list|,
name|alt
argument_list|,
name|clock_bias
argument_list|,
name|show_time
argument_list|(
name|time_of_fix
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0xBB */
end_comment

begin_function
specifier|static
name|void
name|rpt_complete_rcvr_config
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|TSIP_RCVR_CFG
name|TsipxBB
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_Paly0xBB
argument_list|(
name|rpt
argument_list|,
operator|&
name|TsipxBB
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   operating mode:      %s"
argument_list|,
name|NavModeText0xBB
index|[
name|TsipxBB
operator|.
name|operating_mode
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   dynamics:            %s"
argument_list|,
name|dyn_text
index|[
name|TsipxBB
operator|.
name|dyn_code
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   elev angle mask:     %g deg"
argument_list|,
name|TsipxBB
operator|.
name|elev_mask
operator|*
name|R2D
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   SNR mask:            %g AMU"
argument_list|,
name|TsipxBB
operator|.
name|cno_mask
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   DOP mask:            %g"
argument_list|,
name|TsipxBB
operator|.
name|dop_mask
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   DOP switch:          %g"
argument_list|,
name|TsipxBB
operator|.
name|dop_switch
argument_list|)
expr_stmt|;
return|return ;
block|}
end_function

begin_comment
comment|/* 0xBC */
end_comment

begin_function
specifier|static
name|void
name|rpt_rcvr_serial_port_config
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|port_num
decl_stmt|,
name|in_baud
decl_stmt|,
name|out_baud
decl_stmt|,
name|data_bits
decl_stmt|,
name|parity
decl_stmt|,
name|stop_bits
decl_stmt|,
name|flow_control
decl_stmt|,
name|protocols_in
decl_stmt|,
name|protocols_out
decl_stmt|,
name|reserved
decl_stmt|;
name|unsigned
name|char
name|known
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0xBC
argument_list|(
name|rpt
argument_list|,
operator|&
name|port_num
argument_list|,
operator|&
name|in_baud
argument_list|,
operator|&
name|out_baud
argument_list|,
operator|&
name|data_bits
argument_list|,
operator|&
name|parity
argument_list|,
operator|&
name|stop_bits
argument_list|,
operator|&
name|flow_control
argument_list|,
operator|&
name|protocols_in
argument_list|,
operator|&
name|protocols_out
argument_list|,
operator|&
name|reserved
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
comment|/* rptbuf unloaded */
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   RECEIVER serial port %s config:"
argument_list|,
name|rcvr_port_text
index|[
name|port_num
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n             I/O Baud %s/%s, %d - %s - %d"
argument_list|,
name|st_baud_text_app
index|[
name|in_baud
index|]
argument_list|,
name|st_baud_text_app
index|[
name|out_baud
index|]
argument_list|,
name|data_bits
operator|+
literal|5
argument_list|,
name|parity_text
index|[
name|parity
index|]
argument_list|,
name|stop_bits
operator|=
literal|1
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n             Input protocols: "
argument_list|)
expr_stmt|;
name|known
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|protocols_in
operator|&
name|B_TSIP
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"%s "
argument_list|,
name|protocols_in_text
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|known
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|known
operator|==
name|FALSE
condition|)
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"No known"
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n             Output protocols: "
argument_list|)
expr_stmt|;
name|known
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|protocols_out
operator|&
name|B_TSIP
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"%s "
argument_list|,
name|protocols_out_text
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|known
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|protocols_out
operator|&
name|B_NMEA
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"%s "
argument_list|,
name|protocols_out_text
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|known
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|known
operator|==
name|FALSE
condition|)
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"No known"
argument_list|)
expr_stmt|;
name|reserved
operator|=
name|reserved
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x8F */
end_comment

begin_comment
comment|/* 8F0B */
end_comment

begin_function
specifier|static
name|void
name|rpt_8F0B
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|oprtng_dim
index|[
literal|7
index|]
init|=
block|{
literal|"horizontal (2-D)"
block|,
literal|"full position (3-D)"
block|,
literal|"single satellite (0-D)"
block|,
literal|"automatic"
block|,
literal|"N/A"
block|,
literal|"N/A"
block|,
literal|"overdetermined clock"
block|}
decl_stmt|;
name|char
name|sv_id
index|[
literal|8
index|]
decl_stmt|;
name|unsigned
name|char
name|month
decl_stmt|,
name|date
decl_stmt|,
name|dim_mode
decl_stmt|,
name|north_south
decl_stmt|,
name|east_west
decl_stmt|;
name|unsigned
name|short
name|event
decl_stmt|;
name|short
name|utc_offset
decl_stmt|,
name|year
decl_stmt|,
name|local_index
decl_stmt|;
name|short
name|lat_deg
decl_stmt|,
name|lon_deg
decl_stmt|;
name|float
name|bias_unc
decl_stmt|,
name|dr_unc
decl_stmt|;
name|double
name|tow
decl_stmt|,
name|bias
decl_stmt|,
name|drift
decl_stmt|,
name|lat
decl_stmt|,
name|lon
decl_stmt|,
name|alt
decl_stmt|,
name|lat_min
decl_stmt|,
name|lon_min
decl_stmt|;
name|int
name|numfix
decl_stmt|,
name|numnotfix
decl_stmt|;
if|if
condition|(
name|rpt_0x8F0B
argument_list|(
name|rpt
argument_list|,
operator|&
name|event
argument_list|,
operator|&
name|tow
argument_list|,
operator|&
name|date
argument_list|,
operator|&
name|month
argument_list|,
operator|&
name|year
argument_list|,
operator|&
name|dim_mode
argument_list|,
operator|&
name|utc_offset
argument_list|,
operator|&
name|bias
argument_list|,
operator|&
name|drift
argument_list|,
operator|&
name|bias_unc
argument_list|,
operator|&
name|dr_unc
argument_list|,
operator|&
name|lat
argument_list|,
operator|&
name|lon
argument_list|,
operator|&
name|alt
argument_list|,
name|sv_id
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|event
operator|==
literal|0
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nNew partial+full meas"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nEvent count: %5d"
argument_list|,
name|event
argument_list|)
expr_stmt|;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nGPS time  : %s %2d/%2d/%2d (DMY)"
argument_list|,
name|show_time
argument_list|(
name|tow
argument_list|)
argument_list|,
name|date
argument_list|,
name|month
argument_list|,
name|year
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nMode      : %s"
argument_list|,
name|oprtng_dim
index|[
name|dim_mode
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nUTC offset: %2d"
argument_list|,
name|utc_offset
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nClock Bias: %6.2f m"
argument_list|,
name|bias
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nFreq bias : %6.2f m/s"
argument_list|,
name|drift
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nBias unc  : %6.2f m"
argument_list|,
name|bias_unc
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nFreq unc  : %6.2f m/s"
argument_list|,
name|dr_unc
argument_list|)
expr_stmt|;
name|lat
operator|*=
name|R2D
expr_stmt|;
comment|/* convert from radians to degrees */
name|lon
operator|*=
name|R2D
expr_stmt|;
if|if
condition|(
name|lat
operator|<
literal|0.0
condition|)
block|{
name|north_south
operator|=
literal|'S'
expr_stmt|;
name|lat
operator|=
operator|-
name|lat
expr_stmt|;
block|}
else|else
block|{
name|north_south
operator|=
literal|'N'
expr_stmt|;
block|}
name|lat_deg
operator|=
operator|(
name|short
operator|)
name|lat
expr_stmt|;
name|lat_min
operator|=
operator|(
name|lat
operator|-
name|lat_deg
operator|)
operator|*
literal|60.0
expr_stmt|;
if|if
condition|(
name|lon
operator|<
literal|0.0
condition|)
block|{
name|east_west
operator|=
literal|'W'
expr_stmt|;
name|lon
operator|=
operator|-
name|lon
expr_stmt|;
block|}
else|else
block|{
name|east_west
operator|=
literal|'E'
expr_stmt|;
block|}
name|lon_deg
operator|=
operator|(
name|short
operator|)
name|lon
expr_stmt|;
name|lon_min
operator|=
operator|(
name|lon
operator|-
name|lon_deg
operator|)
operator|*
literal|60.0
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nPosition  :"
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|" %4d %6.3f %c"
argument_list|,
name|lat_deg
argument_list|,
name|lat_min
argument_list|,
name|north_south
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|" %5d %6.3f %c"
argument_list|,
name|lon_deg
argument_list|,
name|lon_min
argument_list|,
name|east_west
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|" %10.2f"
argument_list|,
name|alt
argument_list|)
expr_stmt|;
name|numfix
operator|=
name|numnotfix
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|local_index
operator|=
literal|0
init|;
name|local_index
operator|<
literal|8
condition|;
name|local_index
operator|++
control|)
block|{
if|if
condition|(
name|sv_id
index|[
name|local_index
index|]
operator|<
literal|0
condition|)
name|numnotfix
operator|++
expr_stmt|;
if|if
condition|(
name|sv_id
index|[
name|local_index
index|]
operator|>
literal|0
condition|)
name|numfix
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|numfix
operator|>
literal|0
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nSVs used in fix  : "
argument_list|)
expr_stmt|;
for|for
control|(
name|local_index
operator|=
literal|0
init|;
name|local_index
operator|<
literal|8
condition|;
name|local_index
operator|++
control|)
block|{
if|if
condition|(
name|sv_id
index|[
name|local_index
index|]
operator|>
literal|0
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"%2d "
argument_list|,
name|sv_id
index|[
name|local_index
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|numnotfix
operator|>
literal|0
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nOther SVs tracked: "
argument_list|)
expr_stmt|;
for|for
control|(
name|local_index
operator|=
literal|0
init|;
name|local_index
operator|<
literal|8
condition|;
name|local_index
operator|++
control|)
block|{
if|if
condition|(
name|sv_id
index|[
name|local_index
index|]
operator|<
literal|0
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"%2d "
argument_list|,
name|sv_id
index|[
name|local_index
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

begin_comment
comment|/* 0x8F14 */
end_comment

begin_function
specifier|static
name|void
name|rpt_8F14
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
comment|/* Datum parameters */
block|{
name|double
name|datum_coeffs
index|[
literal|5
index|]
decl_stmt|;
name|short
name|datum_idx
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x8F14
argument_list|(
name|rpt
argument_list|,
operator|&
name|datum_idx
argument_list|,
name|datum_coeffs
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|datum_idx
operator|==
operator|-
literal|1
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nUser-Entered Datum:"
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   dx        = %6.1f"
argument_list|,
name|datum_coeffs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   dy        = %6.1f"
argument_list|,
name|datum_coeffs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   dz        = %6.1f"
argument_list|,
name|datum_coeffs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   a-axis    = %10.3f"
argument_list|,
name|datum_coeffs
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   e-squared = %16.14f"
argument_list|,
name|datum_coeffs
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|datum_idx
operator|==
literal|0
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nWGS-84 datum, Index 0 "
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nStandard Datum, Index %3d "
argument_list|,
name|datum_idx
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* 0x8F15 */
end_comment

begin_function
specifier|static
name|void
name|rpt_8F15
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
comment|/* Datum parameters */
block|{
name|double
name|datum_coeffs
index|[
literal|5
index|]
decl_stmt|;
name|short
name|datum_idx
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x8F15
argument_list|(
name|rpt
argument_list|,
operator|&
name|datum_idx
argument_list|,
name|datum_coeffs
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|datum_idx
operator|==
operator|-
literal|1
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nUser-Entered Datum:"
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   dx        = %6.1f"
argument_list|,
name|datum_coeffs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   dy        = %6.1f"
argument_list|,
name|datum_coeffs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   dz        = %6.1f"
argument_list|,
name|datum_coeffs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   a-axis    = %10.3f"
argument_list|,
name|datum_coeffs
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   e-squared = %16.14f"
argument_list|,
name|datum_coeffs
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|datum_idx
operator|==
literal|0
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nWGS-84 datum, Index 0 "
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nStandard Datum, Index %3d "
argument_list|,
name|datum_idx
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* 0x8F20 */
end_comment

begin_define
define|#
directive|define
name|INFO_DGPS
value|0x02
end_define

begin_define
define|#
directive|define
name|INFO_2D
value|0x04
end_define

begin_define
define|#
directive|define
name|INFO_ALTSET
value|0x08
end_define

begin_define
define|#
directive|define
name|INFO_FILTERED
value|0x10
end_define

begin_function
specifier|static
name|void
name|rpt_8F20
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|info
decl_stmt|,
name|nsvs
decl_stmt|,
name|sv_prn
index|[
literal|32
index|]
decl_stmt|;
name|short
name|week_num
decl_stmt|,
name|datum_index
decl_stmt|,
name|sv_IODC
index|[
literal|32
index|]
decl_stmt|;
name|double
name|lat
decl_stmt|,
name|lon
decl_stmt|,
name|alt
decl_stmt|,
name|time_of_fix
decl_stmt|;
name|double
name|londeg
decl_stmt|,
name|latdeg
decl_stmt|,
name|vel
index|[
literal|3
index|]
decl_stmt|;
name|short
name|isv
decl_stmt|;
name|char
name|datum_string
index|[
literal|20
index|]
decl_stmt|;
comment|/* unload rptbuf */
if|if
condition|(
name|rpt_0x8F20
argument_list|(
name|rpt
argument_list|,
operator|&
name|info
argument_list|,
operator|&
name|lat
argument_list|,
operator|&
name|lon
argument_list|,
operator|&
name|alt
argument_list|,
name|vel
argument_list|,
operator|&
name|time_of_fix
argument_list|,
operator|&
name|week_num
argument_list|,
operator|&
name|nsvs
argument_list|,
name|sv_prn
argument_list|,
name|sv_IODC
argument_list|,
operator|&
name|datum_index
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nFix at: %04d:%3s:%02d:%02d:%06.3f GPS (=UTC+%2ds)  FixType: %s%s%s"
argument_list|,
name|week_num
argument_list|,
name|dayname
index|[
call|(
name|short
call|)
argument_list|(
name|time_of_fix
operator|/
literal|86400.0
argument_list|)
index|]
argument_list|,
operator|(
name|short
operator|)
name|fmod
argument_list|(
name|time_of_fix
operator|/
literal|3600.
argument_list|,
literal|24.
argument_list|)
argument_list|,
operator|(
name|short
operator|)
name|fmod
argument_list|(
name|time_of_fix
operator|/
literal|60.
argument_list|,
literal|60.
argument_list|)
argument_list|,
name|fmod
argument_list|(
name|time_of_fix
argument_list|,
literal|60.
argument_list|)
argument_list|,
operator|(
name|char
operator|)
name|rpt
operator|->
name|buf
index|[
literal|29
index|]
argument_list|,
comment|/* UTC offset */
operator|(
name|info
operator|&
name|INFO_DGPS
operator|)
condition|?
literal|"Diff"
else|:
literal|""
argument_list|,
operator|(
name|info
operator|&
name|INFO_2D
operator|)
condition|?
literal|"2D"
else|:
literal|"3D"
argument_list|,
operator|(
name|info
operator|&
name|INFO_FILTERED
operator|)
condition|?
literal|"-Filtrd"
else|:
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|datum_index
operator|>
literal|0
condition|)
block|{
name|sprintf
argument_list|(
name|datum_string
argument_list|,
literal|"Datum%3d"
argument_list|,
name|datum_index
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|datum_index
condition|)
block|{
name|sprintf
argument_list|(
name|datum_string
argument_list|,
literal|"Unknown "
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sprintf
argument_list|(
name|datum_string
argument_list|,
literal|"WGS-84"
argument_list|)
expr_stmt|;
block|}
comment|/* convert from radians to degrees */
name|latdeg
operator|=
name|R2D
operator|*
name|fabs
argument_list|(
name|lat
argument_list|)
expr_stmt|;
name|londeg
operator|=
name|R2D
operator|*
name|fabs
argument_list|(
name|lon
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   Pos: %4d:%09.6f %c %5d:%09.6f %c %10.2f m HAE (%s)"
argument_list|,
operator|(
name|short
operator|)
name|latdeg
argument_list|,
name|fmod
argument_list|(
name|latdeg
argument_list|,
literal|1.
argument_list|)
operator|*
literal|60.0
argument_list|,
operator|(
name|lat
operator|<
literal|0.0
operator|)
condition|?
literal|'S'
else|:
literal|'N'
argument_list|,
operator|(
name|short
operator|)
name|londeg
argument_list|,
name|fmod
argument_list|(
name|londeg
argument_list|,
literal|1.
argument_list|)
operator|*
literal|60.0
argument_list|,
operator|(
name|lon
operator|<
literal|0.0
operator|)
condition|?
literal|'W'
else|:
literal|'E'
argument_list|,
name|alt
argument_list|,
name|datum_string
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   Vel:    %9.3f E       %9.3f N      %9.3f U   (m/sec)"
argument_list|,
name|vel
index|[
literal|0
index|]
argument_list|,
name|vel
index|[
literal|1
index|]
argument_list|,
name|vel
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   SVs: "
argument_list|)
expr_stmt|;
for|for
control|(
name|isv
operator|=
literal|0
init|;
name|isv
operator|<
name|nsvs
condition|;
name|isv
operator|++
control|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|" %02d"
argument_list|,
name|sv_prn
index|[
name|isv
index|]
argument_list|)
expr_stmt|;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"     (IODEs:"
argument_list|)
expr_stmt|;
for|for
control|(
name|isv
operator|=
literal|0
init|;
name|isv
operator|<
name|nsvs
condition|;
name|isv
operator|++
control|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|" %02X"
argument_list|,
name|sv_IODC
index|[
name|isv
index|]
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x8F41 */
end_comment

begin_function
specifier|static
name|void
name|rpt_8F41
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|bSearchRange
decl_stmt|,
name|bBoardOptions
decl_stmt|,
name|bBuildYear
decl_stmt|,
name|bBuildMonth
decl_stmt|,
name|bBuildDay
decl_stmt|,
name|bBuildHour
decl_stmt|;
name|float
name|fOscOffset
decl_stmt|;
name|unsigned
name|short
name|iTestCodeId
decl_stmt|;
name|unsigned
name|long
name|iiSerialNumber
decl_stmt|;
if|if
condition|(
operator|!
name|rpt_0x8F41
argument_list|(
name|rpt
argument_list|,
operator|&
name|bSearchRange
argument_list|,
operator|&
name|bBoardOptions
argument_list|,
operator|&
name|iiSerialNumber
argument_list|,
operator|&
name|bBuildYear
argument_list|,
operator|&
name|bBuildMonth
argument_list|,
operator|&
name|bBuildDay
argument_list|,
operator|&
name|bBuildHour
argument_list|,
operator|&
name|fOscOffset
argument_list|,
operator|&
name|iTestCodeId
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n  search range:          %d"
argument_list|,
name|bSearchRange
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n  board options:         %d"
argument_list|,
name|bBoardOptions
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n  board serial #:        %ld"
argument_list|,
name|iiSerialNumber
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n  build date/hour:       %02d/%02d/%02d %02d:00"
argument_list|,
name|bBuildDay
argument_list|,
name|bBuildMonth
argument_list|,
name|bBuildYear
argument_list|,
name|bBuildHour
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n  osc offset:            %.3f PPM (%.0f Hz)"
argument_list|,
name|fOscOffset
operator|/
literal|1575.42
argument_list|,
name|fOscOffset
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n  test code:             %d"
argument_list|,
name|iTestCodeId
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x8F42 */
end_comment

begin_function
specifier|static
name|void
name|rpt_8F42
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|bProdOptionsPre
decl_stmt|,
name|bProdNumberExt
decl_stmt|;
name|unsigned
name|short
name|iCaseSerialNumberPre
decl_stmt|,
name|iPremiumOptions
decl_stmt|,
name|iMachineID
decl_stmt|,
name|iKey
decl_stmt|;
name|unsigned
name|long
name|iiCaseSerialNumber
decl_stmt|,
name|iiProdNumber
decl_stmt|;
if|if
condition|(
operator|!
name|rpt_0x8F42
argument_list|(
name|rpt
argument_list|,
operator|&
name|bProdOptionsPre
argument_list|,
operator|&
name|bProdNumberExt
argument_list|,
operator|&
name|iCaseSerialNumberPre
argument_list|,
operator|&
name|iiCaseSerialNumber
argument_list|,
operator|&
name|iiProdNumber
argument_list|,
operator|&
name|iPremiumOptions
argument_list|,
operator|&
name|iMachineID
argument_list|,
operator|&
name|iKey
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nProduct ID 8F42"
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   extension:            %d"
argument_list|,
name|bProdNumberExt
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   case serial # prefix: %d"
argument_list|,
name|iCaseSerialNumberPre
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   case serial #:        %ld"
argument_list|,
name|iiCaseSerialNumber
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   prod. #:              %ld"
argument_list|,
name|iiProdNumber
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   premium options:      %Xh"
argument_list|,
name|iPremiumOptions
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   machine ID:           %d"
argument_list|,
name|iMachineID
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   key:                  %Xh"
argument_list|,
name|iKey
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 0x8F45 */
end_comment

begin_function
specifier|static
name|void
name|rpt_8F45
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|bSegMask
decl_stmt|;
if|if
condition|(
operator|!
name|rpt_0x8F45
argument_list|(
name|rpt
argument_list|,
operator|&
name|bSegMask
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nCleared Segment Mask: %Xh"
argument_list|,
name|bSegMask
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|rpt_8F4A
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
comment|/* Stinger PPS def */
block|{
name|unsigned
name|char
name|pps_enabled
decl_stmt|,
name|pps_timebase
decl_stmt|,
name|pps_polarity
decl_stmt|;
name|float
name|bias_unc_threshold
decl_stmt|;
name|double
name|pps_offset
decl_stmt|;
if|if
condition|(
name|rpt_0x8F4A_16
argument_list|(
name|rpt
argument_list|,
operator|&
name|pps_enabled
argument_list|,
operator|&
name|pps_timebase
argument_list|,
operator|&
name|pps_polarity
argument_list|,
operator|&
name|pps_offset
argument_list|,
operator|&
name|bias_unc_threshold
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nPPS is         %s"
argument_list|,
name|pps_enabled
condition|?
literal|"enabled"
else|:
literal|"disabled"
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   timebase:   %s"
argument_list|,
name|PPSTimeBaseText
index|[
name|pps_timebase
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   polarity:   %s"
argument_list|,
name|PPSPolarityText
index|[
name|pps_polarity
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   offset:     %.1f ns, "
argument_list|,
name|pps_offset
operator|*
literal|1.e9
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   biasunc:    %.1f ns"
argument_list|,
name|bias_unc_threshold
operator|/
name|GPS_C
operator|*
literal|1.e9
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|rpt_8F4B
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
comment|/* fast-SA decorrolation time for self-survey */
block|{
name|unsigned
name|long
name|decorr_max
decl_stmt|;
if|if
condition|(
name|rpt_0x8F4B
argument_list|(
name|rpt
argument_list|,
operator|&
name|decorr_max
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nMax # of position fixes for self-survey : %ld"
argument_list|,
name|decorr_max
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|rpt_8F4D
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|linestart
decl_stmt|;
name|unsigned
name|long
name|OutputMask
decl_stmt|;
specifier|static
name|unsigned
name|long
name|MaskBit
index|[]
init|=
block|{
literal|0x00000001
block|,
literal|0x00000002
block|,
literal|0x00000004
block|,
literal|0x00000008
block|,
literal|0x00000010
block|,
literal|0x00000020
block|,
literal|0x00000100L
block|,
literal|0x00000800L
block|,
literal|0x00001000L
block|,
literal|0x40000000L
block|,
literal|0x80000000L
block|}
decl_stmt|;
name|int
name|ichoice
decl_stmt|,
name|numchoices
decl_stmt|;
if|if
condition|(
name|rpt_0x8F4D
argument_list|(
name|rpt
argument_list|,
operator|&
name|OutputMask
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nAuto-Report Mask: %02X %02X %02X %02X"
argument_list|,
call|(
name|unsigned
name|char
call|)
argument_list|(
name|OutputMask
operator|>>
literal|24
argument_list|)
argument_list|,
call|(
name|unsigned
name|char
call|)
argument_list|(
name|OutputMask
operator|>>
literal|16
argument_list|)
argument_list|,
call|(
name|unsigned
name|char
call|)
argument_list|(
name|OutputMask
operator|>>
literal|8
argument_list|)
argument_list|,
operator|(
name|unsigned
name|char
operator|)
name|OutputMask
argument_list|)
expr_stmt|;
name|numchoices
operator|=
sizeof|sizeof
argument_list|(
name|MaskText
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nAuto-Reports scheduled for Output:"
argument_list|)
expr_stmt|;
name|linestart
operator|=
name|pbuf
expr_stmt|;
for|for
control|(
name|ichoice
operator|=
literal|0
init|;
name|ichoice
operator|<
name|numchoices
condition|;
name|ichoice
operator|++
control|)
block|{
if|if
condition|(
name|OutputMask
operator|&
name|MaskBit
index|[
name|ichoice
index|]
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"%s %s"
argument_list|,
operator|(
name|pbuf
operator|==
name|linestart
operator|)
condition|?
literal|"\n     "
else|:
literal|","
argument_list|,
name|MaskText
index|[
name|ichoice
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|pbuf
operator|-
name|linestart
operator|>
literal|60
condition|)
name|linestart
operator|=
name|pbuf
expr_stmt|;
block|}
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nAuto-Reports NOT scheduled for Output:"
argument_list|)
expr_stmt|;
name|linestart
operator|=
name|pbuf
expr_stmt|;
for|for
control|(
name|ichoice
operator|=
literal|0
init|;
name|ichoice
operator|<
name|numchoices
condition|;
name|ichoice
operator|++
control|)
block|{
if|if
condition|(
name|OutputMask
operator|&
name|MaskBit
index|[
name|ichoice
index|]
condition|)
continue|continue;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"%s %s"
argument_list|,
operator|(
name|pbuf
operator|==
name|linestart
operator|)
condition|?
literal|"\n     "
else|:
literal|","
argument_list|,
name|MaskText
index|[
name|ichoice
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|pbuf
operator|-
name|linestart
operator|>
literal|60
condition|)
name|linestart
operator|=
name|pbuf
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|rpt_8FA5
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|char
name|spktmask
index|[
literal|4
index|]
decl_stmt|;
if|if
condition|(
name|rpt_0x8FA5
argument_list|(
name|rpt
argument_list|,
name|spktmask
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nSuperpacket auto-output mask: %02X %02X %02X %02X"
argument_list|,
name|spktmask
index|[
literal|0
index|]
argument_list|,
name|spktmask
index|[
literal|1
index|]
argument_list|,
name|spktmask
index|[
literal|2
index|]
argument_list|,
name|spktmask
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|spktmask
index|[
literal|0
index|]
operator|&
literal|0x01
condition|)
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    PPS   8F-0B"
argument_list|)
expr_stmt|;
if|if
condition|(
name|spktmask
index|[
literal|0
index|]
operator|&
literal|0x02
condition|)
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    Event 8F-0B"
argument_list|)
expr_stmt|;
if|if
condition|(
name|spktmask
index|[
literal|0
index|]
operator|&
literal|0x10
condition|)
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    PPS   8F-AD"
argument_list|)
expr_stmt|;
if|if
condition|(
name|spktmask
index|[
literal|0
index|]
operator|&
literal|0x20
condition|)
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    Event 8F-AD"
argument_list|)
expr_stmt|;
if|if
condition|(
name|spktmask
index|[
literal|2
index|]
operator|&
literal|0x01
condition|)
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n    ppos Fix 8F-20"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|rpt_8FAD
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|unsigned
name|short
name|Count
decl_stmt|,
name|Year
decl_stmt|;
name|double
name|FracSec
decl_stmt|;
name|unsigned
name|char
name|Hour
decl_stmt|,
name|Minute
decl_stmt|,
name|Second
decl_stmt|,
name|Day
decl_stmt|,
name|Month
decl_stmt|,
name|Status
decl_stmt|,
name|Flags
decl_stmt|;
specifier|static
name|char
modifier|*
name|Status8FADText
index|[]
init|=
block|{
literal|"CODE_DOING_FIXES"
block|,
literal|"CODE_GOOD_1_SV"
block|,
literal|"CODE_APPX_1SV"
block|,
literal|"CODE_NEED_TIME"
block|,
literal|"CODE_NEED_INITIALIZATION"
block|,
literal|"CODE_PDOP_HIGH"
block|,
literal|"CODE_BAD_1SV"
block|,
literal|"CODE_0SVS"
block|,
literal|"CODE_1SV"
block|,
literal|"CODE_2SVS"
block|,
literal|"CODE_3SVS"
block|,
literal|"CODE_NO_INTEGRITY"
block|,
literal|"CODE_DCORR_GEN"
block|,
literal|"CODE_OVERDET_CLK"
block|,
literal|"Invalid Status"
block|}
decl_stmt|,
modifier|*
name|LeapStatusText
index|[]
init|=
block|{
literal|" UTC Avail"
block|,
literal|" "
block|,
literal|" "
block|,
literal|" "
block|,
literal|" Scheduled"
block|,
literal|" Pending"
block|,
literal|" Warning"
block|,
literal|" In Progress"
block|}
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|rpt_0x8FAD
argument_list|(
name|rpt
argument_list|,
operator|&
name|Count
argument_list|,
operator|&
name|FracSec
argument_list|,
operator|&
name|Hour
argument_list|,
operator|&
name|Minute
argument_list|,
operator|&
name|Second
argument_list|,
operator|&
name|Day
argument_list|,
operator|&
name|Month
argument_list|,
operator|&
name|Year
argument_list|,
operator|&
name|Status
argument_list|,
operator|&
name|Flags
argument_list|)
condition|)
block|{
name|parsed
operator|=
name|BADLEN_PARSE
expr_stmt|;
return|return;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n8FAD   Count: %d   Status: %s"
argument_list|,
name|Count
argument_list|,
name|Status8FADText
index|[
name|Status
index|]
argument_list|)
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n   Leap Flags:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|Flags
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|Flags
operator|&
operator|(
literal|1
operator|<<
name|i
operator|)
condition|)
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
name|LeapStatusText
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"  UTC info not available"
argument_list|)
expr_stmt|;
block|}
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\n      %02d/%02d/%04d (DMY)  %02d:%02d:%02d.%09ld UTC"
argument_list|,
name|Day
argument_list|,
name|Month
argument_list|,
name|Year
argument_list|,
name|Hour
argument_list|,
name|Minute
argument_list|,
name|Second
argument_list|,
call|(
name|long
call|)
argument_list|(
name|FracSec
operator|*
literal|1.e9
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|print_msg_table_header
parameter_list|(
name|int
name|rptcode
parameter_list|,
name|char
modifier|*
name|HdrStr
parameter_list|,
name|int
name|force
parameter_list|)
block|{
comment|/* force header is to help auto-output function */
comment|/* last_rptcode is to determine whether to print a header */
comment|/* for the first occurrence of a series of reports */
specifier|static
name|int
name|last_rptcode
init|=
literal|0
decl_stmt|;
name|int
name|numchars
decl_stmt|;
name|numchars
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|force
operator|||
name|rptcode
operator|!=
name|last_rptcode
condition|)
block|{
comment|/* supply a header in console output */
switch|switch
condition|(
name|rptcode
condition|)
block|{
case|case
literal|0x5A
case|:
name|numchars
operator|=
name|sprintf
argument_list|(
name|HdrStr
argument_list|,
literal|"\nRaw Measurement Data"
argument_list|)
expr_stmt|;
name|numchars
operator|+=
name|sprintf
argument_list|(
name|HdrStr
operator|+
name|numchars
argument_list|,
literal|"\n   SV  Sample   SNR  Code Phase   Doppler    Seconds     Time of Meas"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x5B
case|:
name|numchars
operator|=
name|sprintf
argument_list|(
name|HdrStr
argument_list|,
literal|"\nEphemeris Status"
argument_list|)
expr_stmt|;
name|numchars
operator|+=
name|sprintf
argument_list|(
name|HdrStr
operator|+
name|numchars
argument_list|,
literal|"\n    SV     Time collected     Health  IODE        t oe         Fit   URA"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x5C
case|:
name|numchars
operator|=
name|sprintf
argument_list|(
name|HdrStr
argument_list|,
literal|"\nTracking Info"
argument_list|)
expr_stmt|;
name|numchars
operator|+=
name|sprintf
argument_list|(
name|HdrStr
operator|+
name|numchars
argument_list|,
literal|"\n   SV  C Acq Eph   SNR     Time of Meas       Elev  Azim   "
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|last_rptcode
operator|=
name|rptcode
expr_stmt|;
return|return
operator|(
name|short
operator|)
name|numchars
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|unknown_rpt
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
comment|/* app-specific rpt packets */
if|if
condition|(
name|parsed
operator|==
name|BADLEN_PARSE
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nTSIP report packet ID %2Xh, length %d: Bad length"
argument_list|,
name|rpt
operator|->
name|code
argument_list|,
name|rpt
operator|->
name|len
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|parsed
operator|==
name|BADID_PARSE
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nTSIP report packet ID %2Xh, length %d: translation not supported"
argument_list|,
name|rpt
operator|->
name|code
argument_list|,
name|rpt
operator|->
name|len
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|parsed
operator|==
name|BADDATA_PARSE
condition|)
block|{
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|"\nTSIP report packet ID %2Xh, length %d: data content incorrect"
argument_list|,
name|rpt
operator|->
name|code
argument_list|,
name|rpt
operator|->
name|len
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|rpt
operator|->
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|i
operator|%
literal|20
operator|)
operator|==
literal|0
condition|)
operator|*
name|pbuf
operator|++
operator|=
literal|'\n'
expr_stmt|;
name|pbuf
operator|+=
name|sprintf
argument_list|(
name|pbuf
argument_list|,
literal|" %02X"
argument_list|,
name|rpt
operator|->
name|buf
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**/
end_comment

begin_comment
comment|/* ** main subroutine, called from ProcessInputBytesWhileWaitingForKBHit() */
end_comment

begin_function
name|void
name|TranslateTSIPReportToText
parameter_list|(
name|TSIPPKT
modifier|*
name|rpt
parameter_list|,
name|char
modifier|*
name|TextOutputBuffer
parameter_list|)
block|{
comment|/* pbuf is the pointer to the current location of the text output */
name|pbuf
operator|=
name|TextOutputBuffer
expr_stmt|;
comment|/* keep track of whether the message has been successfully parsed */
name|parsed
operator|=
name|GOOD_PARSE
expr_stmt|;
comment|/* print a header if this is the first of a series of messages */
name|pbuf
operator|+=
name|print_msg_table_header
argument_list|(
name|rpt
operator|->
name|code
argument_list|,
name|pbuf
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/* process incoming TSIP report according to code */
switch|switch
condition|(
name|rpt
operator|->
name|code
condition|)
block|{
case|case
literal|0x3D
case|:
name|rpt_chan_A_config
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x40
case|:
name|rpt_almanac_data_page
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x41
case|:
name|rpt_GPS_time
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x42
case|:
name|rpt_single_ECEF_position
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x43
case|:
name|rpt_single_ECEF_velocity
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x45
case|:
name|rpt_SW_version
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x46
case|:
name|rpt_rcvr_health
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x47
case|:
name|rpt_SNR_all_SVs
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x48
case|:
name|rpt_GPS_system_message
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x49
case|:
name|rpt_almanac_health_page
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x4A
case|:
switch|switch
condition|(
name|rpt
operator|->
name|len
condition|)
block|{
comment|/*       ** special case (=slip-up) in the TSIP protocol;       ** parsing method depends on length       */
case|case
literal|20
case|:
name|rpt_single_lla_position
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|9
case|:
name|rpt_ref_alt
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x4B
case|:
name|rpt_rcvr_id_and_status
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x4C
case|:
name|rpt_operating_parameters
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x4D
case|:
name|rpt_oscillator_offset
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x4E
case|:
name|rpt_GPS_time_set_response
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x4F
case|:
name|rpt_UTC_offset
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x54
case|:
name|rpt_1SV_bias
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x55
case|:
name|rpt_io_opt
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x56
case|:
name|rpt_ENU_velocity
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x57
case|:
name|rpt_last_fix_info
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x58
case|:
name|rpt_GPS_system_data
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x59
case|:
name|rpt_SVs_enabled
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x5A
case|:
name|rpt_raw_msmt
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x5B
case|:
name|rpt_SV_ephemeris_status
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x5C
case|:
name|rpt_SV_tracking_status
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x6D
case|:
name|rpt_allSV_selection
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x82
case|:
name|rpt_DGPS_position_mode
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x83
case|:
name|rpt_double_ECEF_position
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x84
case|:
name|rpt_double_lla_position
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0xBB
case|:
name|rpt_complete_rcvr_config
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0xBC
case|:
name|rpt_rcvr_serial_port_config
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x8F
case|:
switch|switch
condition|(
name|rpt
operator|->
name|buf
index|[
literal|0
index|]
condition|)
block|{
comment|/* superpackets; parsed according to subcodes */
case|case
literal|0x0B
case|:
name|rpt_8F0B
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x14
case|:
name|rpt_8F14
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x15
case|:
name|rpt_8F15
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x20
case|:
name|rpt_8F20
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x41
case|:
name|rpt_8F41
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x42
case|:
name|rpt_8F42
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x45
case|:
name|rpt_8F45
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x4A
case|:
name|rpt_8F4A
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x4B
case|:
name|rpt_8F4B
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x4D
case|:
name|rpt_8F4D
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0xA5
case|:
name|rpt_8FA5
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0xAD
case|:
name|rpt_8FAD
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
break|break;
default|default:
name|parsed
operator|=
name|BADID_PARSE
expr_stmt|;
break|break;
block|}
break|break;
default|default:
name|parsed
operator|=
name|BADID_PARSE
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|parsed
operator|!=
name|GOOD_PARSE
condition|)
block|{
comment|/*    	**The message has TSIP structure (DLEs, etc.) 	   ** but could not be parsed by above routines    	*/
name|unknown_rpt
argument_list|(
name|rpt
argument_list|)
expr_stmt|;
block|}
comment|/* close TextOutputBuffer */
name|pbuf
operator|=
literal|'\0'
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* TRIMBLE_OUTPUT_FUNC */
end_comment

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* defined(REFCLOCK)&& defined(CLOCK_RIPENCC) */
end_comment

begin_decl_stmt
name|int
name|refclock_ripencc_bs
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* defined(REFCLOCK)&& defined(CLOCK_RIPENCC) */
end_comment

end_unit

