begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * wire2str.c  *  * conversion routines from the wire format  * to the presentation format (strings)  *  * (c) NLnet Labs, 2004-2006  *  * See the file LICENSE for the license  */
end_comment

begin_comment
comment|/**  * \file  *  * Contains functions to translate the wireformat to text  * representation, as well as functions to print them.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"ldns/wire2str.h"
end_include

begin_include
include|#
directive|include
file|"ldns/str2wire.h"
end_include

begin_include
include|#
directive|include
file|"ldns/rrdef.h"
end_include

begin_include
include|#
directive|include
file|"ldns/pkthdr.h"
end_include

begin_include
include|#
directive|include
file|"ldns/parseutil.h"
end_include

begin_include
include|#
directive|include
file|"ldns/sbuffer.h"
end_include

begin_include
include|#
directive|include
file|"ldns/keyraw.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_TIME_H
end_ifdef

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_NETDB_H
end_ifdef

begin_include
include|#
directive|include
file|<netdb.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* lookup tables for standard DNS stuff  */
end_comment

begin_comment
comment|/* Taken from RFC 2535, section 7.  */
end_comment

begin_decl_stmt
specifier|static
name|sldns_lookup_table
name|sldns_algorithms_data
index|[]
init|=
block|{
block|{
name|LDNS_RSAMD5
block|,
literal|"RSAMD5"
block|}
block|,
block|{
name|LDNS_DH
block|,
literal|"DH"
block|}
block|,
block|{
name|LDNS_DSA
block|,
literal|"DSA"
block|}
block|,
block|{
name|LDNS_ECC
block|,
literal|"ECC"
block|}
block|,
block|{
name|LDNS_RSASHA1
block|,
literal|"RSASHA1"
block|}
block|,
block|{
name|LDNS_DSA_NSEC3
block|,
literal|"DSA-NSEC3-SHA1"
block|}
block|,
block|{
name|LDNS_RSASHA1_NSEC3
block|,
literal|"RSASHA1-NSEC3-SHA1"
block|}
block|,
block|{
name|LDNS_RSASHA256
block|,
literal|"RSASHA256"
block|}
block|,
block|{
name|LDNS_RSASHA512
block|,
literal|"RSASHA512"
block|}
block|,
block|{
name|LDNS_ECC_GOST
block|,
literal|"ECC-GOST"
block|}
block|,
block|{
name|LDNS_ECDSAP256SHA256
block|,
literal|"ECDSAP256SHA256"
block|}
block|,
block|{
name|LDNS_ECDSAP384SHA384
block|,
literal|"ECDSAP384SHA384"
block|}
block|,
block|{
name|LDNS_INDIRECT
block|,
literal|"INDIRECT"
block|}
block|,
block|{
name|LDNS_PRIVATEDNS
block|,
literal|"PRIVATEDNS"
block|}
block|,
block|{
name|LDNS_PRIVATEOID
block|,
literal|"PRIVATEOID"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|sldns_lookup_table
modifier|*
name|sldns_algorithms
init|=
name|sldns_algorithms_data
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* hash algorithms in DS record */
end_comment

begin_decl_stmt
specifier|static
name|sldns_lookup_table
name|sldns_hashes_data
index|[]
init|=
block|{
block|{
name|LDNS_SHA1
block|,
literal|"SHA1"
block|}
block|,
block|{
name|LDNS_SHA256
block|,
literal|"SHA256"
block|}
block|,
block|{
name|LDNS_HASH_GOST
block|,
literal|"HASH-GOST"
block|}
block|,
block|{
name|LDNS_SHA384
block|,
literal|"SHA384"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|sldns_lookup_table
modifier|*
name|sldns_hashes
init|=
name|sldns_hashes_data
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Taken from RFC 4398  */
end_comment

begin_decl_stmt
specifier|static
name|sldns_lookup_table
name|sldns_cert_algorithms_data
index|[]
init|=
block|{
block|{
name|LDNS_CERT_PKIX
block|,
literal|"PKIX"
block|}
block|,
block|{
name|LDNS_CERT_SPKI
block|,
literal|"SPKI"
block|}
block|,
block|{
name|LDNS_CERT_PGP
block|,
literal|"PGP"
block|}
block|,
block|{
name|LDNS_CERT_IPKIX
block|,
literal|"IPKIX"
block|}
block|,
block|{
name|LDNS_CERT_ISPKI
block|,
literal|"ISPKI"
block|}
block|,
block|{
name|LDNS_CERT_IPGP
block|,
literal|"IPGP"
block|}
block|,
block|{
name|LDNS_CERT_ACPKIX
block|,
literal|"ACPKIX"
block|}
block|,
block|{
name|LDNS_CERT_IACPKIX
block|,
literal|"IACPKIX"
block|}
block|,
block|{
name|LDNS_CERT_URI
block|,
literal|"URI"
block|}
block|,
block|{
name|LDNS_CERT_OID
block|,
literal|"OID"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|sldns_lookup_table
modifier|*
name|sldns_cert_algorithms
init|=
name|sldns_cert_algorithms_data
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* if these are used elsewhere */
end_comment

begin_decl_stmt
specifier|static
name|sldns_lookup_table
name|sldns_rcodes_data
index|[]
init|=
block|{
block|{
name|LDNS_RCODE_NOERROR
block|,
literal|"NOERROR"
block|}
block|,
block|{
name|LDNS_RCODE_FORMERR
block|,
literal|"FORMERR"
block|}
block|,
block|{
name|LDNS_RCODE_SERVFAIL
block|,
literal|"SERVFAIL"
block|}
block|,
block|{
name|LDNS_RCODE_NXDOMAIN
block|,
literal|"NXDOMAIN"
block|}
block|,
block|{
name|LDNS_RCODE_NOTIMPL
block|,
literal|"NOTIMPL"
block|}
block|,
block|{
name|LDNS_RCODE_REFUSED
block|,
literal|"REFUSED"
block|}
block|,
block|{
name|LDNS_RCODE_YXDOMAIN
block|,
literal|"YXDOMAIN"
block|}
block|,
block|{
name|LDNS_RCODE_YXRRSET
block|,
literal|"YXRRSET"
block|}
block|,
block|{
name|LDNS_RCODE_NXRRSET
block|,
literal|"NXRRSET"
block|}
block|,
block|{
name|LDNS_RCODE_NOTAUTH
block|,
literal|"NOTAUTH"
block|}
block|,
block|{
name|LDNS_RCODE_NOTZONE
block|,
literal|"NOTZONE"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|sldns_lookup_table
modifier|*
name|sldns_rcodes
init|=
name|sldns_rcodes_data
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|sldns_lookup_table
name|sldns_opcodes_data
index|[]
init|=
block|{
block|{
name|LDNS_PACKET_QUERY
block|,
literal|"QUERY"
block|}
block|,
block|{
name|LDNS_PACKET_IQUERY
block|,
literal|"IQUERY"
block|}
block|,
block|{
name|LDNS_PACKET_STATUS
block|,
literal|"STATUS"
block|}
block|,
block|{
name|LDNS_PACKET_NOTIFY
block|,
literal|"NOTIFY"
block|}
block|,
block|{
name|LDNS_PACKET_UPDATE
block|,
literal|"UPDATE"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|sldns_lookup_table
modifier|*
name|sldns_opcodes
init|=
name|sldns_opcodes_data
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|sldns_lookup_table
name|sldns_wireparse_errors_data
index|[]
init|=
block|{
block|{
name|LDNS_WIREPARSE_ERR_OK
block|,
literal|"no parse error"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_GENERAL
block|,
literal|"parse error"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_DOMAINNAME_OVERFLOW
block|,
literal|"Domainname length overflow"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_DOMAINNAME_UNDERFLOW
block|,
literal|"Domainname length underflow (zero length)"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_BUFFER_TOO_SMALL
block|,
literal|"buffer too small"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_LABEL_OVERFLOW
block|,
literal|"Label length overflow"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_EMPTY_LABEL
block|,
literal|"Empty label"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_BAD_ESCAPE
block|,
literal|"Syntax error, bad escape sequence"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX
block|,
literal|"Syntax error, could not parse the RR"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_TTL
block|,
literal|"Syntax error, could not parse the RR's TTL"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_TYPE
block|,
literal|"Syntax error, could not parse the RR's type"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_CLASS
block|,
literal|"Syntax error, could not parse the RR's class"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_RDATA
block|,
literal|"Syntax error, could not parse the RR's rdata"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_MISSING_VALUE
block|,
literal|"Syntax error, value expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_INVALID_STR
block|,
literal|"Conversion error, string expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_B64
block|,
literal|"Conversion error, b64 encoding expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_B32_EXT
block|,
literal|"Conversion error, b32 ext encoding expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_HEX
block|,
literal|"Conversion error, hex encoding expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_CERT_BAD_ALGORITHM
block|,
literal|"Bad algorithm type for CERT record"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_TIME
block|,
literal|"Conversion error, time encoding expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_PERIOD
block|,
literal|"Conversion error, time period encoding expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_ILNP64
block|,
literal|"Conversion error, 4 colon separated hex numbers expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_EUI48
block|,
literal|"Conversion error, 6 two character hex numbers "
literal|"separated by dashes expected (i.e. xx-xx-xx-xx-xx-xx"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_EUI64
block|,
literal|"Conversion error, 8 two character hex numbers "
literal|"separated by dashes expected (i.e. xx-xx-xx-xx-xx-xx-xx-xx"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_TAG
block|,
literal|"Conversion error, a non-zero sequence of US-ASCII letters "
literal|"and numbers in lower case expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_NOT_IMPL
block|,
literal|"not implemented"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_INT
block|,
literal|"Conversion error, integer expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_IP4
block|,
literal|"Conversion error, ip4 addr expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_IP6
block|,
literal|"Conversion error, ip6 addr expected"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_SYNTAX_INTEGER_OVERFLOW
block|,
literal|"Syntax error, integer overflow"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_INCLUDE
block|,
literal|"$INCLUDE directive was seen in the zone"
block|}
block|,
block|{
name|LDNS_WIREPARSE_ERR_PARENTHESIS
block|,
literal|"Parse error, parenthesis mismatch"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|sldns_lookup_table
modifier|*
name|sldns_wireparse_errors
init|=
name|sldns_wireparse_errors_data
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|sldns_lookup_table
name|sldns_edns_flags_data
index|[]
init|=
block|{
block|{
literal|3600
block|,
literal|"do"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|sldns_lookup_table
modifier|*
name|sldns_edns_flags
init|=
name|sldns_edns_flags_data
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|sldns_lookup_table
name|sldns_edns_options_data
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"LLQ"
block|}
block|,
block|{
literal|2
block|,
literal|"UL"
block|}
block|,
block|{
literal|3
block|,
literal|"NSID"
block|}
block|,
comment|/* 4 draft-cheshire-edns0-owner-option */
block|{
literal|5
block|,
literal|"DAU"
block|}
block|,
block|{
literal|6
block|,
literal|"DHU"
block|}
block|,
block|{
literal|7
block|,
literal|"N3U"
block|}
block|,
block|{
literal|8
block|,
literal|"edns-client-subnet"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|sldns_lookup_table
modifier|*
name|sldns_edns_options
init|=
name|sldns_edns_options_data
decl_stmt|;
end_decl_stmt

begin_function
name|char
modifier|*
name|sldns_wire2str_pkt
parameter_list|(
name|uint8_t
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|size_t
name|slen
init|=
operator|(
name|size_t
operator|)
name|sldns_wire2str_pkt_buf
argument_list|(
name|data
argument_list|,
name|len
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|char
modifier|*
name|result
init|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|slen
operator|+
literal|1
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|result
condition|)
return|return
name|NULL
return|;
name|sldns_wire2str_pkt_buf
argument_list|(
name|data
argument_list|,
name|len
argument_list|,
name|result
argument_list|,
name|slen
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|sldns_wire2str_rr
parameter_list|(
name|uint8_t
modifier|*
name|rr
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|size_t
name|slen
init|=
operator|(
name|size_t
operator|)
name|sldns_wire2str_rr_buf
argument_list|(
name|rr
argument_list|,
name|len
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|char
modifier|*
name|result
init|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|slen
operator|+
literal|1
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|result
condition|)
return|return
name|NULL
return|;
name|sldns_wire2str_rr_buf
argument_list|(
name|rr
argument_list|,
name|len
argument_list|,
name|result
argument_list|,
name|slen
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|sldns_wire2str_type
parameter_list|(
name|uint16_t
name|rrtype
parameter_list|)
block|{
name|char
name|buf
index|[
literal|16
index|]
decl_stmt|;
name|sldns_wire2str_type_buf
argument_list|(
name|rrtype
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|strdup
argument_list|(
name|buf
argument_list|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|sldns_wire2str_class
parameter_list|(
name|uint16_t
name|rrclass
parameter_list|)
block|{
name|char
name|buf
index|[
literal|16
index|]
decl_stmt|;
name|sldns_wire2str_class_buf
argument_list|(
name|rrclass
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|strdup
argument_list|(
name|buf
argument_list|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|sldns_wire2str_dname
parameter_list|(
name|uint8_t
modifier|*
name|dname
parameter_list|,
name|size_t
name|dname_len
parameter_list|)
block|{
name|size_t
name|slen
init|=
operator|(
name|size_t
operator|)
name|sldns_wire2str_dname_buf
argument_list|(
name|dname
argument_list|,
name|dname_len
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|char
modifier|*
name|result
init|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|slen
operator|+
literal|1
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|result
condition|)
return|return
name|NULL
return|;
name|sldns_wire2str_dname_buf
argument_list|(
name|dname
argument_list|,
name|dname_len
argument_list|,
name|result
argument_list|,
name|slen
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|sldns_wire2str_rcode
parameter_list|(
name|int
name|rcode
parameter_list|)
block|{
name|char
name|buf
index|[
literal|16
index|]
decl_stmt|;
name|sldns_wire2str_rcode_buf
argument_list|(
name|rcode
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|strdup
argument_list|(
name|buf
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_pkt_buf
parameter_list|(
name|uint8_t
modifier|*
name|d
parameter_list|,
name|size_t
name|dlen
parameter_list|,
name|char
modifier|*
name|s
parameter_list|,
name|size_t
name|slen
parameter_list|)
block|{
comment|/* use arguments as temporary variables */
return|return
name|sldns_wire2str_pkt_scan
argument_list|(
operator|&
name|d
argument_list|,
operator|&
name|dlen
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|slen
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rr_buf
parameter_list|(
name|uint8_t
modifier|*
name|d
parameter_list|,
name|size_t
name|dlen
parameter_list|,
name|char
modifier|*
name|s
parameter_list|,
name|size_t
name|slen
parameter_list|)
block|{
comment|/* use arguments as temporary variables */
return|return
name|sldns_wire2str_rr_scan
argument_list|(
operator|&
name|d
argument_list|,
operator|&
name|dlen
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|slen
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rdata_buf
parameter_list|(
name|uint8_t
modifier|*
name|rdata
parameter_list|,
name|size_t
name|rdata_len
parameter_list|,
name|char
modifier|*
name|str
parameter_list|,
name|size_t
name|str_len
parameter_list|,
name|uint16_t
name|rrtype
parameter_list|)
block|{
comment|/* use arguments as temporary variables */
return|return
name|sldns_wire2str_rdata_scan
argument_list|(
operator|&
name|rdata
argument_list|,
operator|&
name|rdata_len
argument_list|,
operator|&
name|str
argument_list|,
operator|&
name|str_len
argument_list|,
name|rrtype
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rr_unknown_buf
parameter_list|(
name|uint8_t
modifier|*
name|d
parameter_list|,
name|size_t
name|dlen
parameter_list|,
name|char
modifier|*
name|s
parameter_list|,
name|size_t
name|slen
parameter_list|)
block|{
comment|/* use arguments as temporary variables */
return|return
name|sldns_wire2str_rr_unknown_scan
argument_list|(
operator|&
name|d
argument_list|,
operator|&
name|dlen
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|slen
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rr_comment_buf
parameter_list|(
name|uint8_t
modifier|*
name|rr
parameter_list|,
name|size_t
name|rrlen
parameter_list|,
name|size_t
name|dname_len
parameter_list|,
name|char
modifier|*
name|s
parameter_list|,
name|size_t
name|slen
parameter_list|)
block|{
name|uint16_t
name|rrtype
init|=
name|sldns_wirerr_get_type
argument_list|(
name|rr
argument_list|,
name|rrlen
argument_list|,
name|dname_len
argument_list|)
decl_stmt|;
return|return
name|sldns_wire2str_rr_comment_print
argument_list|(
operator|&
name|s
argument_list|,
operator|&
name|slen
argument_list|,
name|rr
argument_list|,
name|rrlen
argument_list|,
name|dname_len
argument_list|,
name|rrtype
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_type_buf
parameter_list|(
name|uint16_t
name|rrtype
parameter_list|,
name|char
modifier|*
name|s
parameter_list|,
name|size_t
name|slen
parameter_list|)
block|{
comment|/* use arguments as temporary variables */
return|return
name|sldns_wire2str_type_print
argument_list|(
operator|&
name|s
argument_list|,
operator|&
name|slen
argument_list|,
name|rrtype
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_class_buf
parameter_list|(
name|uint16_t
name|rrclass
parameter_list|,
name|char
modifier|*
name|s
parameter_list|,
name|size_t
name|slen
parameter_list|)
block|{
comment|/* use arguments as temporary variables */
return|return
name|sldns_wire2str_class_print
argument_list|(
operator|&
name|s
argument_list|,
operator|&
name|slen
argument_list|,
name|rrclass
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rcode_buf
parameter_list|(
name|int
name|rcode
parameter_list|,
name|char
modifier|*
name|s
parameter_list|,
name|size_t
name|slen
parameter_list|)
block|{
comment|/* use arguments as temporary variables */
return|return
name|sldns_wire2str_rcode_print
argument_list|(
operator|&
name|s
argument_list|,
operator|&
name|slen
argument_list|,
name|rcode
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_dname_buf
parameter_list|(
name|uint8_t
modifier|*
name|d
parameter_list|,
name|size_t
name|dlen
parameter_list|,
name|char
modifier|*
name|s
parameter_list|,
name|size_t
name|slen
parameter_list|)
block|{
comment|/* use arguments as temporary variables */
return|return
name|sldns_wire2str_dname_scan
argument_list|(
operator|&
name|d
argument_list|,
operator|&
name|dlen
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|slen
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_str_vprint
parameter_list|(
name|char
modifier|*
modifier|*
name|str
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
name|va_list
name|args
parameter_list|)
block|{
name|int
name|w
init|=
name|vsnprintf
argument_list|(
operator|*
name|str
argument_list|,
operator|*
name|slen
argument_list|,
name|format
argument_list|,
name|args
argument_list|)
decl_stmt|;
if|if
condition|(
name|w
operator|<
literal|0
condition|)
block|{
comment|/* error in printout */
return|return
literal|0
return|;
block|}
elseif|else
if|if
condition|(
operator|(
name|size_t
operator|)
name|w
operator|>=
operator|*
name|slen
condition|)
block|{
operator|*
name|str
operator|=
name|NULL
expr_stmt|;
comment|/* we do not want str to point outside of buffer*/
operator|*
name|slen
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
operator|*
name|str
operator|+=
name|w
expr_stmt|;
operator|*
name|slen
operator|-=
name|w
expr_stmt|;
block|}
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_str_print
parameter_list|(
name|char
modifier|*
modifier|*
name|str
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
modifier|...
parameter_list|)
block|{
name|int
name|w
decl_stmt|;
name|va_list
name|args
decl_stmt|;
name|va_start
argument_list|(
name|args
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|w
operator|=
name|sldns_str_vprint
argument_list|(
name|str
argument_list|,
name|slen
argument_list|,
name|format
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_comment
comment|/** print hex format into text buffer for specified length */
end_comment

begin_function
specifier|static
name|int
name|print_hex_buf
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint8_t
modifier|*
name|buf
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|hex
init|=
literal|"0123456789ABCDEF"
decl_stmt|;
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
operator|(
name|void
operator|)
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"%c%c"
argument_list|,
name|hex
index|[
operator|(
name|buf
index|[
name|i
index|]
operator|&
literal|0xf0
operator|)
operator|>>
literal|4
index|]
argument_list|,
name|hex
index|[
name|buf
index|[
name|i
index|]
operator|&
literal|0x0f
index|]
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|int
operator|)
name|len
operator|*
literal|2
return|;
block|}
end_function

begin_comment
comment|/** print remainder of buffer in hex format with prefixed text */
end_comment

begin_function
specifier|static
name|int
name|print_remainder_hex
parameter_list|(
specifier|const
name|char
modifier|*
name|pref
parameter_list|,
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"%s"
argument_list|,
name|pref
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
operator|*
name|d
argument_list|,
operator|*
name|dlen
argument_list|)
expr_stmt|;
operator|*
name|d
operator|+=
operator|*
name|dlen
expr_stmt|;
operator|*
name|dlen
operator|=
literal|0
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_pkt_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|unsigned
name|qdcount
decl_stmt|,
name|ancount
decl_stmt|,
name|nscount
decl_stmt|,
name|arcount
decl_stmt|,
name|i
decl_stmt|;
name|uint8_t
modifier|*
name|pkt
init|=
operator|*
name|d
decl_stmt|;
name|size_t
name|pktlen
init|=
operator|*
name|dlen
decl_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|>=
name|LDNS_HEADER_SIZE
condition|)
block|{
name|qdcount
operator|=
operator|(
name|unsigned
operator|)
name|LDNS_QDCOUNT
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|ancount
operator|=
operator|(
name|unsigned
operator|)
name|LDNS_ANCOUNT
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|nscount
operator|=
operator|(
name|unsigned
operator|)
name|LDNS_NSCOUNT
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|arcount
operator|=
operator|(
name|unsigned
operator|)
name|LDNS_ARCOUNT
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|qdcount
operator|=
name|ancount
operator|=
name|nscount
operator|=
name|arcount
operator|=
literal|0
expr_stmt|;
block|}
name|w
operator|+=
name|sldns_wire2str_header_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";; QUESTION SECTION:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|qdcount
condition|;
name|i
operator|++
control|)
block|{
name|w
operator|+=
name|sldns_wire2str_rrquestion_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|dlen
condition|)
break|break;
block|}
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";; ANSWER SECTION:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ancount
condition|;
name|i
operator|++
control|)
block|{
name|w
operator|+=
name|sldns_wire2str_rr_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|dlen
condition|)
break|break;
block|}
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";; AUTHORITY SECTION:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nscount
condition|;
name|i
operator|++
control|)
block|{
name|w
operator|+=
name|sldns_wire2str_rr_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|dlen
condition|)
break|break;
block|}
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";; ADDITIONAL SECTION:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|arcount
condition|;
name|i
operator|++
control|)
block|{
name|w
operator|+=
name|sldns_wire2str_rr_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|dlen
condition|)
break|break;
block|}
comment|/* other fields: WHEN(time), SERVER(IP) not available here. */
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";; MSG SIZE  rcvd: %d\n"
argument_list|,
operator|(
name|int
operator|)
name|pktlen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|>
literal|0
condition|)
block|{
name|w
operator|+=
name|print_remainder_hex
argument_list|(
literal|";; trailing garbage 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
return|return
name|w
return|;
block|}
end_function

begin_comment
comment|/** scan type, class and ttl and printout, for rr */
end_comment

begin_function
specifier|static
name|int
name|sldns_rr_tcttl_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|uint16_t
name|t
decl_stmt|,
name|c
decl_stmt|;
name|uint32_t
name|ttl
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|8
condition|)
block|{
if|if
condition|(
operator|*
name|dl
operator|<
literal|4
condition|)
return|return
name|w
operator|+
name|print_remainder_hex
argument_list|(
literal|"; Error malformed 0x"
argument_list|,
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|)
return|;
comment|/* these print values or 0x.. if none left */
name|t
operator|=
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|c
operator|=
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|2
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|4
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|4
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_class_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_type_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dl
operator|==
literal|0
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"; Error no ttl"
argument_list|)
return|;
return|return
name|w
operator|+
name|print_remainder_hex
argument_list|(
literal|"; Error malformed ttl 0x"
argument_list|,
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|)
return|;
block|}
name|t
operator|=
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|c
operator|=
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|2
argument_list|)
expr_stmt|;
name|ttl
operator|=
name|sldns_read_uint32
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|4
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|8
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|8
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%lu\t"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ttl
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_class_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_type_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|t
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rr_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint8_t
modifier|*
name|pkt
parameter_list|,
name|size_t
name|pktlen
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|uint8_t
modifier|*
name|rr
init|=
operator|*
name|d
decl_stmt|;
name|size_t
name|rrlen
init|=
operator|*
name|dlen
decl_stmt|,
name|dname_off
decl_stmt|,
name|rdlen
decl_stmt|,
name|ordlen
decl_stmt|;
name|uint16_t
name|rrtype
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|>=
literal|3
operator|&&
operator|(
operator|*
name|d
operator|)
index|[
literal|0
index|]
operator|==
literal|0
operator|&&
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|1
argument_list|)
operator|==
name|LDNS_RR_TYPE_OPT
condition|)
block|{
comment|/* perform EDNS OPT processing */
return|return
name|sldns_wire2str_edns_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
return|;
block|}
comment|/* try to scan the rdata with pretty-printing, but if that fails, then 	 * scan the rdata as an unknown RR type */
name|w
operator|+=
name|sldns_wire2str_dname_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
name|dname_off
operator|=
name|rrlen
operator|-
operator|(
operator|*
name|dlen
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|==
literal|4
condition|)
block|{
comment|/* like a question-RR */
name|uint16_t
name|t
init|=
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
decl_stmt|;
name|uint16_t
name|c
init|=
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|2
argument_list|)
decl_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|4
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|-=
literal|4
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_class_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_type_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" ; Error no ttl,rdata\n"
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
if|if
condition|(
operator|*
name|dlen
operator|<
literal|8
condition|)
block|{
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";Error missing RR\n"
argument_list|)
return|;
name|w
operator|+=
name|print_remainder_hex
argument_list|(
literal|";Error partial RR 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
expr_stmt|;
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
return|;
block|}
name|rrtype
operator|=
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_rr_tcttl_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
comment|/* rdata */
if|if
condition|(
operator|*
name|dlen
operator|<
literal|2
condition|)
block|{
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";Error missing rdatalen\n"
argument_list|)
return|;
name|w
operator|+=
name|print_remainder_hex
argument_list|(
literal|";Error missing rdatalen 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
expr_stmt|;
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
return|;
block|}
name|rdlen
operator|=
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|ordlen
operator|=
name|rdlen
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|2
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|<
name|rdlen
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\\# %u "
argument_list|,
operator|(
name|unsigned
operator|)
name|rdlen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";Error missing rdata\n"
argument_list|)
return|;
name|w
operator|+=
name|print_remainder_hex
argument_list|(
literal|";Error partial rdata 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
expr_stmt|;
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
return|;
block|}
name|w
operator|+=
name|sldns_wire2str_rdata_scan
argument_list|(
name|d
argument_list|,
operator|&
name|rdlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|rrtype
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|-=
operator|(
name|ordlen
operator|-
name|rdlen
operator|)
expr_stmt|;
comment|/* default comment */
name|w
operator|+=
name|sldns_wire2str_rr_comment_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|rr
argument_list|,
name|rrlen
argument_list|,
name|dname_off
argument_list|,
name|rrtype
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rrquestion_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint8_t
modifier|*
name|pkt
parameter_list|,
name|size_t
name|pktlen
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|uint16_t
name|t
decl_stmt|,
name|c
decl_stmt|;
name|w
operator|+=
name|sldns_wire2str_dname_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|<
literal|4
condition|)
block|{
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"Error malformed\n"
argument_list|)
return|;
name|w
operator|+=
name|print_remainder_hex
argument_list|(
literal|"Error malformed 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
expr_stmt|;
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
return|;
block|}
name|t
operator|=
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|c
operator|=
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|2
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|4
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|-=
literal|4
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_class_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_type_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rr_unknown_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint8_t
modifier|*
name|pkt
parameter_list|,
name|size_t
name|pktlen
parameter_list|)
block|{
name|size_t
name|rdlen
decl_stmt|,
name|ordlen
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|;
name|w
operator|+=
name|sldns_wire2str_dname_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_rr_tcttl_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|<
literal|2
condition|)
block|{
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";Error missing rdatalen\n"
argument_list|)
return|;
name|w
operator|+=
name|print_remainder_hex
argument_list|(
literal|";Error missing rdatalen 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
expr_stmt|;
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
return|;
block|}
name|rdlen
operator|=
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|ordlen
operator|=
name|rdlen
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|2
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|<
name|rdlen
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\\# %u "
argument_list|,
operator|(
name|unsigned
operator|)
name|rdlen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";Error missing rdata\n"
argument_list|)
return|;
name|w
operator|+=
name|print_remainder_hex
argument_list|(
literal|";Error partial rdata 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
expr_stmt|;
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
return|;
block|}
name|w
operator|+=
name|sldns_wire2str_rdata_unknown_scan
argument_list|(
name|d
argument_list|,
operator|&
name|rdlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|-=
operator|(
name|ordlen
operator|-
name|rdlen
operator|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_comment
comment|/** print rr comment for type DNSKEY */
end_comment

begin_function
specifier|static
name|int
name|rr_comment_dnskey
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint8_t
modifier|*
name|rr
parameter_list|,
name|size_t
name|rrlen
parameter_list|,
name|size_t
name|dname_off
parameter_list|)
block|{
name|size_t
name|rdlen
decl_stmt|;
name|uint8_t
modifier|*
name|rdata
decl_stmt|;
name|int
name|flags
decl_stmt|,
name|w
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|rrlen
operator|<
name|dname_off
operator|+
literal|10
condition|)
return|return
literal|0
return|;
name|rdlen
operator|=
name|sldns_read_uint16
argument_list|(
name|rr
operator|+
name|dname_off
operator|+
literal|8
argument_list|)
expr_stmt|;
if|if
condition|(
name|rrlen
operator|<
name|dname_off
operator|+
literal|10
operator|+
name|rdlen
condition|)
return|return
literal|0
return|;
name|rdata
operator|=
name|rr
operator|+
name|dname_off
operator|+
literal|10
expr_stmt|;
name|flags
operator|=
operator|(
name|int
operator|)
name|sldns_read_uint16
argument_list|(
name|rdata
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" ;{"
argument_list|)
expr_stmt|;
comment|/* id */
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"id = %u"
argument_list|,
name|sldns_calc_keytag_raw
argument_list|(
name|rdata
argument_list|,
name|rdlen
argument_list|)
argument_list|)
expr_stmt|;
comment|/* flags */
if|if
condition|(
operator|(
name|flags
operator|&
name|LDNS_KEY_ZONE_KEY
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|flags
operator|&
name|LDNS_KEY_SEP_KEY
operator|)
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" (ksk)"
argument_list|)
expr_stmt|;
else|else
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" (zsk)"
argument_list|)
expr_stmt|;
block|}
comment|/* keysize */
if|if
condition|(
name|rdlen
operator|>
literal|4
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"size = %db"
argument_list|,
operator|(
name|int
operator|)
name|sldns_rr_dnskey_key_size_raw
argument_list|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|rdata
operator|+
literal|4
argument_list|,
name|rdlen
operator|-
literal|4
argument_list|,
call|(
name|int
call|)
argument_list|(
name|rdata
index|[
literal|3
index|]
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"}"
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_comment
comment|/** print rr comment for type RRSIG */
end_comment

begin_function
specifier|static
name|int
name|rr_comment_rrsig
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint8_t
modifier|*
name|rr
parameter_list|,
name|size_t
name|rrlen
parameter_list|,
name|size_t
name|dname_off
parameter_list|)
block|{
name|size_t
name|rdlen
decl_stmt|;
name|uint8_t
modifier|*
name|rdata
decl_stmt|;
if|if
condition|(
name|rrlen
operator|<
name|dname_off
operator|+
literal|10
condition|)
return|return
literal|0
return|;
name|rdlen
operator|=
name|sldns_read_uint16
argument_list|(
name|rr
operator|+
name|dname_off
operator|+
literal|8
argument_list|)
expr_stmt|;
if|if
condition|(
name|rrlen
operator|<
name|dname_off
operator|+
literal|10
operator|+
name|rdlen
condition|)
return|return
literal|0
return|;
name|rdata
operator|=
name|rr
operator|+
name|dname_off
operator|+
literal|10
expr_stmt|;
if|if
condition|(
name|rdlen
operator|<
literal|18
condition|)
return|return
literal|0
return|;
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" ;{id = %d}"
argument_list|,
operator|(
name|int
operator|)
name|sldns_read_uint16
argument_list|(
name|rdata
operator|+
literal|16
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/** print rr comment for type NSEC3 */
end_comment

begin_function
specifier|static
name|int
name|rr_comment_nsec3
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint8_t
modifier|*
name|rr
parameter_list|,
name|size_t
name|rrlen
parameter_list|,
name|size_t
name|dname_off
parameter_list|)
block|{
name|size_t
name|rdlen
decl_stmt|;
name|uint8_t
modifier|*
name|rdata
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|rrlen
operator|<
name|dname_off
operator|+
literal|10
condition|)
return|return
literal|0
return|;
name|rdlen
operator|=
name|sldns_read_uint16
argument_list|(
name|rr
operator|+
name|dname_off
operator|+
literal|8
argument_list|)
expr_stmt|;
if|if
condition|(
name|rrlen
operator|<
name|dname_off
operator|+
literal|10
operator|+
name|rdlen
condition|)
return|return
literal|0
return|;
name|rdata
operator|=
name|rr
operator|+
name|dname_off
operator|+
literal|10
expr_stmt|;
if|if
condition|(
name|rdlen
operator|<
literal|2
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|(
name|rdata
index|[
literal|1
index|]
operator|&
name|LDNS_NSEC3_VARS_OPTOUT_MASK
operator|)
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" ;{flags: optout}"
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rr_comment_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint8_t
modifier|*
name|rr
parameter_list|,
name|size_t
name|rrlen
parameter_list|,
name|size_t
name|dname_off
parameter_list|,
name|uint16_t
name|rrtype
parameter_list|)
block|{
if|if
condition|(
name|rrtype
operator|==
name|LDNS_RR_TYPE_DNSKEY
condition|)
block|{
return|return
name|rr_comment_dnskey
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|rr
argument_list|,
name|rrlen
argument_list|,
name|dname_off
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|rrtype
operator|==
name|LDNS_RR_TYPE_RRSIG
condition|)
block|{
return|return
name|rr_comment_rrsig
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|rr
argument_list|,
name|rrlen
argument_list|,
name|dname_off
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|rrtype
operator|==
name|LDNS_RR_TYPE_NSEC3
condition|)
block|{
return|return
name|rr_comment_nsec3
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|rr
argument_list|,
name|rrlen
argument_list|,
name|dname_off
argument_list|)
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_header_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|int
name|opcode
decl_stmt|,
name|rcode
decl_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";; ->>HEADER<<- "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"Error empty packet"
argument_list|)
return|;
if|if
condition|(
operator|*
name|dlen
operator|<
literal|4
condition|)
return|return
name|w
operator|+
name|print_remainder_hex
argument_list|(
literal|"Error header too short 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
name|opcode
operator|=
operator|(
name|int
operator|)
name|LDNS_OPCODE_WIRE
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|rcode
operator|=
operator|(
name|int
operator|)
name|LDNS_RCODE_WIRE
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"opcode: "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_opcode_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|opcode
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"rcode: "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_rcode_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|rcode
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"id: %d\n"
argument_list|,
operator|(
name|int
operator|)
name|LDNS_ID_WIRE
argument_list|(
operator|*
name|d
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|";; flags:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|LDNS_QR_WIRE
argument_list|(
operator|*
name|d
argument_list|)
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" qr"
argument_list|)
expr_stmt|;
if|if
condition|(
name|LDNS_AA_WIRE
argument_list|(
operator|*
name|d
argument_list|)
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" aa"
argument_list|)
expr_stmt|;
if|if
condition|(
name|LDNS_TC_WIRE
argument_list|(
operator|*
name|d
argument_list|)
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" tc"
argument_list|)
expr_stmt|;
if|if
condition|(
name|LDNS_RD_WIRE
argument_list|(
operator|*
name|d
argument_list|)
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" rd"
argument_list|)
expr_stmt|;
if|if
condition|(
name|LDNS_CD_WIRE
argument_list|(
operator|*
name|d
argument_list|)
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" cd"
argument_list|)
expr_stmt|;
if|if
condition|(
name|LDNS_RA_WIRE
argument_list|(
operator|*
name|d
argument_list|)
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" ra"
argument_list|)
expr_stmt|;
if|if
condition|(
name|LDNS_AD_WIRE
argument_list|(
operator|*
name|d
argument_list|)
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" ad"
argument_list|)
expr_stmt|;
if|if
condition|(
name|LDNS_Z_WIRE
argument_list|(
operator|*
name|d
argument_list|)
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" z"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" ; "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|<
name|LDNS_HEADER_SIZE
condition|)
return|return
name|w
operator|+
name|print_remainder_hex
argument_list|(
literal|"Error header too short 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"QUERY: %d, "
argument_list|,
operator|(
name|int
operator|)
name|LDNS_QDCOUNT
argument_list|(
operator|*
name|d
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"ANSWER: %d, "
argument_list|,
operator|(
name|int
operator|)
name|LDNS_ANCOUNT
argument_list|(
operator|*
name|d
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"AUTHORITY: %d, "
argument_list|,
operator|(
name|int
operator|)
name|LDNS_NSCOUNT
argument_list|(
operator|*
name|d
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"ADDITIONAL: %d "
argument_list|,
operator|(
name|int
operator|)
name|LDNS_ARCOUNT
argument_list|(
operator|*
name|d
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|d
operator|+=
name|LDNS_HEADER_SIZE
expr_stmt|;
operator|*
name|dlen
operator|-=
name|LDNS_HEADER_SIZE
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rdata_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint16_t
name|rrtype
parameter_list|,
name|uint8_t
modifier|*
name|pkt
parameter_list|,
name|size_t
name|pktlen
parameter_list|)
block|{
comment|/* try to prettyprint, but if that fails, use unknown format */
name|uint8_t
modifier|*
name|origd
init|=
operator|*
name|d
decl_stmt|;
name|char
modifier|*
name|origs
init|=
operator|*
name|s
decl_stmt|;
name|size_t
name|origdlen
init|=
operator|*
name|dlen
decl_stmt|,
name|origslen
init|=
operator|*
name|slen
decl_stmt|;
name|uint16_t
name|r_cnt
decl_stmt|,
name|r_max
decl_stmt|;
name|sldns_rdf_type
name|rdftype
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|,
name|n
decl_stmt|;
specifier|const
name|sldns_rr_descriptor
modifier|*
name|desc
init|=
name|sldns_rr_descript
argument_list|(
name|rrtype
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|desc
condition|)
comment|/* unknown format */
return|return
name|sldns_wire2str_rdata_unknown_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
comment|/* dlen equals the rdatalen for the rdata */
name|r_max
operator|=
name|sldns_rr_descriptor_maximum
argument_list|(
name|desc
argument_list|)
expr_stmt|;
for|for
control|(
name|r_cnt
operator|=
literal|0
init|;
name|r_cnt
operator|<
name|r_max
condition|;
name|r_cnt
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|r_cnt
operator|<
name|sldns_rr_descriptor_minimum
argument_list|(
name|desc
argument_list|)
condition|)
goto|goto
name|failed
goto|;
break|break;
comment|/* nothing more to print */
block|}
name|rdftype
operator|=
name|sldns_rr_descriptor_field_type
argument_list|(
name|desc
argument_list|,
name|r_cnt
argument_list|)
expr_stmt|;
if|if
condition|(
name|r_cnt
operator|!=
literal|0
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|n
operator|=
name|sldns_wire2str_rdf_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|rdftype
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|==
operator|-
literal|1
condition|)
block|{
name|failed
label|:
comment|/* failed, use unknown format */
operator|*
name|d
operator|=
name|origd
expr_stmt|;
operator|*
name|s
operator|=
name|origs
expr_stmt|;
operator|*
name|dlen
operator|=
name|origdlen
expr_stmt|;
operator|*
name|slen
operator|=
name|origslen
expr_stmt|;
return|return
name|sldns_wire2str_rdata_unknown_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
block|}
name|w
operator|+=
name|n
expr_stmt|;
block|}
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rdata_unknown_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
comment|/* print length */
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\\# %u"
argument_list|,
operator|(
name|unsigned
operator|)
operator|*
name|dlen
argument_list|)
expr_stmt|;
comment|/* print rdlen in hex */
if|if
condition|(
operator|*
name|dlen
operator|!=
literal|0
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
operator|*
name|d
argument_list|,
operator|*
name|dlen
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
operator|*
name|dlen
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|=
literal|0
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_comment
comment|/** print and escape one character for a domain dname */
end_comment

begin_function
specifier|static
name|int
name|dname_char_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint8_t
name|c
parameter_list|)
block|{
if|if
condition|(
name|c
operator|==
literal|'.'
operator|||
name|c
operator|==
literal|';'
operator|||
name|c
operator|==
literal|'('
operator|||
name|c
operator|==
literal|')'
operator|||
name|c
operator|==
literal|'\\'
condition|)
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\\%c"
argument_list|,
name|c
argument_list|)
return|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|isascii
argument_list|(
operator|(
name|int
operator|)
name|c
argument_list|)
operator|&&
name|isgraph
argument_list|(
operator|(
name|int
operator|)
name|c
argument_list|)
operator|)
condition|)
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"\\%03u"
argument_list|,
operator|(
name|unsigned
operator|)
name|c
argument_list|)
return|;
comment|/* plain printout */
if|if
condition|(
operator|*
name|slen
condition|)
block|{
operator|*
operator|*
name|s
operator|=
operator|(
name|char
operator|)
name|c
expr_stmt|;
operator|(
operator|*
name|s
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|slen
operator|)
operator|--
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_dname_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint8_t
modifier|*
name|pkt
parameter_list|,
name|size_t
name|pktlen
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
comment|/* spool labels onto the string, use compression if its there */
name|uint8_t
modifier|*
name|pos
init|=
operator|*
name|d
decl_stmt|;
name|unsigned
name|i
decl_stmt|,
name|counter
init|=
literal|0
decl_stmt|;
specifier|const
name|unsigned
name|maxcompr
init|=
literal|1000
decl_stmt|;
comment|/* loop detection, max compr ptrs */
name|int
name|in_buf
init|=
literal|1
decl_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"ErrorMissingDname"
argument_list|)
return|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|0
condition|)
block|{
operator|(
operator|*
name|d
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|--
expr_stmt|;
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"."
argument_list|)
return|;
block|}
while|while
condition|(
operator|*
name|pos
condition|)
block|{
comment|/* read label length */
name|uint8_t
name|labellen
init|=
operator|*
name|pos
operator|++
decl_stmt|;
if|if
condition|(
name|in_buf
condition|)
block|{
operator|(
operator|*
name|d
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|--
expr_stmt|;
block|}
comment|/* find out what sort of label we have */
if|if
condition|(
operator|(
name|labellen
operator|&
literal|0xc0
operator|)
operator|==
literal|0xc0
condition|)
block|{
comment|/* compressed */
name|uint16_t
name|target
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|in_buf
operator|&&
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"ErrorPartialDname"
argument_list|)
return|;
elseif|else
if|if
condition|(
operator|!
name|in_buf
operator|&&
name|pos
operator|+
literal|1
operator|>
name|pkt
operator|+
name|pktlen
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"ErrorPartialDname"
argument_list|)
return|;
name|target
operator|=
operator|(
operator|(
name|labellen
operator|&
literal|0x3f
operator|)
operator|<<
literal|8
operator|)
operator||
operator|*
name|pos
expr_stmt|;
if|if
condition|(
name|in_buf
condition|)
block|{
operator|(
operator|*
name|d
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|--
expr_stmt|;
block|}
comment|/* move to target, if possible */
if|if
condition|(
operator|!
name|pkt
operator|||
name|target
operator|>=
name|pktlen
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"ErrorComprPtrOutOfBounds"
argument_list|)
return|;
if|if
condition|(
name|counter
operator|++
operator|>
name|maxcompr
condition|)
return|return
name|w
operator|+
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"ErrorComprPtrLooped"
argument_list|)
return|;
name|in_buf
operator|=
literal|0
expr_stmt|;
name|pos
operator|=
name|pkt
operator|+
name|target
expr_stmt|;
continue|continue;
block|}
elseif|else
if|if
condition|(
operator|(
name|labellen
operator|&
literal|0xc0
operator|)
condition|)
block|{
comment|/* notimpl label type */
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"ErrorLABELTYPE%xIsUnknown"
argument_list|,
call|(
name|int
call|)
argument_list|(
name|labellen
operator|&
literal|0xc0
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
comment|/* spool label characters, end with '.' */
if|if
condition|(
name|in_buf
operator|&&
operator|*
name|dlen
operator|<
name|labellen
condition|)
name|labellen
operator|=
operator|*
name|dlen
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|in_buf
operator|&&
name|pos
operator|+
name|labellen
operator|>
name|pkt
operator|+
name|pktlen
condition|)
name|labellen
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|pkt
operator|+
name|pktlen
operator|-
name|pos
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|unsigned
operator|)
name|labellen
condition|;
name|i
operator|++
control|)
block|{
name|w
operator|+=
name|dname_char_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
operator|*
name|pos
operator|++
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|in_buf
condition|)
block|{
operator|(
operator|*
name|d
operator|)
operator|+=
name|labellen
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|-=
name|labellen
expr_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
break|break;
block|}
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
block|}
comment|/* skip over final root label */
if|if
condition|(
name|in_buf
operator|&&
operator|*
name|dlen
operator|>
literal|0
condition|)
block|{
operator|(
operator|*
name|d
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|--
expr_stmt|;
block|}
comment|/* in case we printed no labels, terminate dname */
if|if
condition|(
name|w
operator|==
literal|0
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_opcode_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|int
name|opcode
parameter_list|)
block|{
name|sldns_lookup_table
modifier|*
name|lt
init|=
name|sldns_lookup_by_id
argument_list|(
name|sldns_opcodes
argument_list|,
name|opcode
argument_list|)
decl_stmt|;
if|if
condition|(
name|lt
operator|&&
name|lt
operator|->
name|name
condition|)
block|{
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
return|;
block|}
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"OPCODE%u"
argument_list|,
operator|(
name|unsigned
operator|)
name|opcode
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rcode_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|int
name|rcode
parameter_list|)
block|{
name|sldns_lookup_table
modifier|*
name|lt
init|=
name|sldns_lookup_by_id
argument_list|(
name|sldns_rcodes
argument_list|,
name|rcode
argument_list|)
decl_stmt|;
if|if
condition|(
name|lt
operator|&&
name|lt
operator|->
name|name
condition|)
block|{
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
return|;
block|}
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"RCODE%u"
argument_list|,
operator|(
name|unsigned
operator|)
name|rcode
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_class_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint16_t
name|rrclass
parameter_list|)
block|{
name|sldns_lookup_table
modifier|*
name|lt
init|=
name|sldns_lookup_by_id
argument_list|(
name|sldns_rr_classes
argument_list|,
operator|(
name|int
operator|)
name|rrclass
argument_list|)
decl_stmt|;
if|if
condition|(
name|lt
operator|&&
name|lt
operator|->
name|name
condition|)
block|{
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
return|;
block|}
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"CLASS%u"
argument_list|,
operator|(
name|unsigned
operator|)
name|rrclass
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_type_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint16_t
name|rrtype
parameter_list|)
block|{
specifier|const
name|sldns_rr_descriptor
modifier|*
name|descriptor
init|=
name|sldns_rr_descript
argument_list|(
name|rrtype
argument_list|)
decl_stmt|;
if|if
condition|(
name|descriptor
operator|&&
name|descriptor
operator|->
name|_name
condition|)
block|{
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"%s"
argument_list|,
name|descriptor
operator|->
name|_name
argument_list|)
return|;
block|}
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"TYPE%u"
argument_list|,
operator|(
name|unsigned
operator|)
name|rrtype
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_edns_option_code_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|uint16_t
name|opcode
parameter_list|)
block|{
name|sldns_lookup_table
modifier|*
name|lt
init|=
name|sldns_lookup_by_id
argument_list|(
name|sldns_edns_options
argument_list|,
operator|(
name|int
operator|)
name|opcode
argument_list|)
decl_stmt|;
if|if
condition|(
name|lt
operator|&&
name|lt
operator|->
name|name
condition|)
block|{
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
return|;
block|}
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"OPT%u"
argument_list|,
operator|(
name|unsigned
operator|)
name|opcode
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_class_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|)
block|{
name|uint16_t
name|c
decl_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|*
name|dlen
operator|<
literal|2
condition|)
return|return
name|print_remainder_hex
argument_list|(
literal|"Error malformed 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
name|c
operator|=
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|2
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|-=
literal|2
expr_stmt|;
return|return
name|sldns_wire2str_class_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|c
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_type_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|)
block|{
name|uint16_t
name|t
decl_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|*
name|dlen
operator|<
literal|2
condition|)
return|return
name|print_remainder_hex
argument_list|(
literal|"Error malformed 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
name|t
operator|=
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|2
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|-=
literal|2
expr_stmt|;
return|return
name|sldns_wire2str_type_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
name|t
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_ttl_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|)
block|{
name|uint32_t
name|ttl
decl_stmt|;
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|*
name|dlen
operator|<
literal|4
condition|)
return|return
name|print_remainder_hex
argument_list|(
literal|"Error malformed 0x"
argument_list|,
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
name|ttl
operator|=
name|sldns_read_uint32
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|4
expr_stmt|;
operator|(
operator|*
name|dlen
operator|)
operator|-=
literal|4
expr_stmt|;
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|slen
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|unsigned
operator|)
name|ttl
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_rdf_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dlen
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|slen
parameter_list|,
name|int
name|rdftype
parameter_list|,
name|uint8_t
modifier|*
name|pkt
parameter_list|,
name|size_t
name|pktlen
parameter_list|)
block|{
if|if
condition|(
operator|*
name|dlen
operator|==
literal|0
condition|)
return|return
literal|0
return|;
switch|switch
condition|(
name|rdftype
condition|)
block|{
case|case
name|LDNS_RDF_TYPE_NONE
case|:
return|return
literal|0
return|;
case|case
name|LDNS_RDF_TYPE_DNAME
case|:
return|return
name|sldns_wire2str_dname_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_INT8
case|:
return|return
name|sldns_wire2str_int8_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_INT16
case|:
return|return
name|sldns_wire2str_int16_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_INT32
case|:
return|return
name|sldns_wire2str_int32_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_PERIOD
case|:
return|return
name|sldns_wire2str_period_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_TSIGTIME
case|:
return|return
name|sldns_wire2str_tsigtime_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_A
case|:
return|return
name|sldns_wire2str_a_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_AAAA
case|:
return|return
name|sldns_wire2str_aaaa_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_STR
case|:
return|return
name|sldns_wire2str_str_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_APL
case|:
return|return
name|sldns_wire2str_apl_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_B32_EXT
case|:
return|return
name|sldns_wire2str_b32_ext_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_B64
case|:
return|return
name|sldns_wire2str_b64_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_HEX
case|:
return|return
name|sldns_wire2str_hex_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_NSEC
case|:
return|return
name|sldns_wire2str_nsec_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_NSEC3_SALT
case|:
return|return
name|sldns_wire2str_nsec3_salt_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_TYPE
case|:
return|return
name|sldns_wire2str_type_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_CLASS
case|:
return|return
name|sldns_wire2str_class_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_CERT_ALG
case|:
return|return
name|sldns_wire2str_cert_alg_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_ALG
case|:
return|return
name|sldns_wire2str_alg_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_UNKNOWN
case|:
return|return
name|sldns_wire2str_unknown_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_TIME
case|:
return|return
name|sldns_wire2str_time_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_LOC
case|:
return|return
name|sldns_wire2str_loc_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_WKS
case|:
case|case
name|LDNS_RDF_TYPE_SERVICE
case|:
return|return
name|sldns_wire2str_wks_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_NSAP
case|:
return|return
name|sldns_wire2str_nsap_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_ATMA
case|:
return|return
name|sldns_wire2str_atma_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_IPSECKEY
case|:
return|return
name|sldns_wire2str_ipseckey_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_HIP
case|:
return|return
name|sldns_wire2str_hip_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_INT16_DATA
case|:
return|return
name|sldns_wire2str_int16_data_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_NSEC3_NEXT_OWNER
case|:
return|return
name|sldns_wire2str_b32_ext_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_ILNP64
case|:
return|return
name|sldns_wire2str_ilnp64_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_EUI48
case|:
return|return
name|sldns_wire2str_eui48_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_EUI64
case|:
return|return
name|sldns_wire2str_eui64_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_TAG
case|:
return|return
name|sldns_wire2str_tag_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
case|case
name|LDNS_RDF_TYPE_LONG_STR
case|:
return|return
name|sldns_wire2str_long_str_scan
argument_list|(
name|d
argument_list|,
name|dlen
argument_list|,
name|s
argument_list|,
name|slen
argument_list|)
return|;
block|}
comment|/* unknown rdf type */
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_int8_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|int
name|w
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|unsigned
operator|)
operator|*
operator|*
name|d
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|--
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_int16_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|int
name|w
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|2
condition|)
return|return
operator|-
literal|1
return|;
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|2
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|2
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_int32_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|int
name|w
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|sldns_read_uint32
argument_list|(
operator|*
name|d
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|4
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|4
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_period_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|int
name|w
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|unsigned
operator|)
name|sldns_read_uint32
argument_list|(
operator|*
name|d
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|4
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|4
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_tsigtime_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
comment|/* tsigtime is 48 bits network order unsigned integer */
name|int
name|w
decl_stmt|;
name|uint64_t
name|tsigtime
init|=
literal|0
decl_stmt|;
name|uint64_t
name|d0
decl_stmt|,
name|d1
decl_stmt|,
name|d2
decl_stmt|,
name|d3
decl_stmt|,
name|d4
decl_stmt|,
name|d5
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|6
condition|)
return|return
operator|-
literal|1
return|;
name|d0
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|0
index|]
expr_stmt|;
comment|/* cast to uint64 for shift operations */
name|d1
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|1
index|]
expr_stmt|;
name|d2
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|2
index|]
expr_stmt|;
name|d3
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|3
index|]
expr_stmt|;
name|d4
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|4
index|]
expr_stmt|;
name|d5
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|5
index|]
expr_stmt|;
name|tsigtime
operator|=
operator|(
name|d0
operator|<<
literal|40
operator|)
operator||
operator|(
name|d1
operator|<<
literal|32
operator|)
operator||
operator|(
name|d2
operator|<<
literal|24
operator|)
operator||
operator|(
name|d3
operator|<<
literal|16
operator|)
operator||
operator|(
name|d4
operator|<<
literal|8
operator|)
operator||
name|d5
expr_stmt|;
ifndef|#
directive|ifndef
name|USE_WINSOCK
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%llu"
argument_list|,
operator|(
name|long
name|long
operator|)
name|tsigtime
argument_list|)
expr_stmt|;
else|#
directive|else
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%I64u"
argument_list|,
operator|(
name|long
name|long
operator|)
name|tsigtime
argument_list|)
expr_stmt|;
endif|#
directive|endif
operator|(
operator|*
name|d
operator|)
operator|+=
literal|6
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|6
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_a_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|char
name|buf
index|[
literal|32
index|]
decl_stmt|;
name|int
name|w
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
name|inet_ntop
argument_list|(
name|AF_INET
argument_list|,
operator|*
name|d
argument_list|,
name|buf
argument_list|,
operator|(
name|socklen_t
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%s"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|4
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|4
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_aaaa_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|AF_INET6
name|char
name|buf
index|[
literal|64
index|]
decl_stmt|;
name|int
name|w
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|16
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
name|inet_ntop
argument_list|(
name|AF_INET6
argument_list|,
operator|*
name|d
argument_list|,
name|buf
argument_list|,
operator|(
name|socklen_t
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%s"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|16
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|16
expr_stmt|;
return|return
name|w
return|;
else|#
directive|else
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/** printout escaped TYPE_STR character */
end_comment

begin_function
specifier|static
name|int
name|str_char_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
name|c
parameter_list|)
block|{
if|if
condition|(
name|isprint
argument_list|(
operator|(
name|int
operator|)
name|c
argument_list|)
operator|||
name|c
operator|==
literal|'\t'
condition|)
block|{
if|if
condition|(
name|c
operator|==
literal|'\"'
operator|||
name|c
operator|==
literal|'\\'
condition|)
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"\\%c"
argument_list|,
name|c
argument_list|)
return|;
if|if
condition|(
operator|*
name|sl
condition|)
block|{
operator|*
operator|*
name|s
operator|=
operator|(
name|char
operator|)
name|c
expr_stmt|;
operator|(
operator|*
name|s
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|sl
operator|)
operator|--
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"\\%03u"
argument_list|,
operator|(
name|unsigned
operator|)
name|c
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_str_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|size_t
name|i
decl_stmt|,
name|len
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|len
operator|=
operator|*
operator|*
name|d
expr_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|1
operator|+
name|len
condition|)
return|return
operator|-
literal|1
return|;
operator|(
operator|*
name|d
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|--
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|w
operator|+=
name|str_char_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
name|len
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
name|len
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_apl_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|w
init|=
literal|0
decl_stmt|;
name|uint16_t
name|family
decl_stmt|;
name|uint8_t
name|negation
decl_stmt|,
name|prefix
decl_stmt|,
name|adflength
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|family
operator|=
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|prefix
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|2
index|]
expr_stmt|;
name|negation
operator|=
operator|(
operator|(
operator|*
name|d
operator|)
index|[
literal|3
index|]
operator|&
name|LDNS_APL_NEGATION
operator|)
expr_stmt|;
name|adflength
operator|=
operator|(
operator|(
operator|*
name|d
operator|)
index|[
literal|3
index|]
operator|&
name|LDNS_APL_MASK
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|4
operator|+
operator|(
name|size_t
operator|)
name|adflength
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|family
operator|!=
name|LDNS_APL_IP4
operator|&&
name|family
operator|!=
name|LDNS_APL_IP6
condition|)
return|return
operator|-
literal|1
return|;
comment|/* unknown address family */
if|if
condition|(
name|negation
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"!"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%u:"
argument_list|,
operator|(
name|unsigned
operator|)
name|family
argument_list|)
expr_stmt|;
if|if
condition|(
name|family
operator|==
name|LDNS_APL_IP4
condition|)
block|{
comment|/* check if prefix<32 ? */
comment|/* address is variable length 0 - 4 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|>
literal|0
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
operator|(
name|int
operator|)
name|adflength
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%d"
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|4
operator|+
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|family
operator|==
name|LDNS_APL_IP6
condition|)
block|{
comment|/* check if prefix<128 ? */
comment|/* address is variable length 0 - 16 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|%
literal|2
operator|==
literal|0
operator|&&
name|i
operator|>
literal|0
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
operator|(
name|int
operator|)
name|adflength
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%02x"
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|4
operator|+
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"00"
argument_list|)
expr_stmt|;
block|}
block|}
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"/%u"
argument_list|,
operator|(
name|unsigned
operator|)
name|prefix
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|4
operator|+
name|adflength
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|4
operator|+
name|adflength
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_b32_ext_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|size_t
name|datalen
decl_stmt|;
name|size_t
name|sz
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|datalen
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|1
operator|+
name|datalen
condition|)
return|return
operator|-
literal|1
return|;
name|sz
operator|=
name|sldns_b32_ntop_calculate_size
argument_list|(
name|datalen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|sl
operator|<
name|sz
operator|+
literal|1
condition|)
block|{
operator|(
operator|*
name|d
operator|)
operator|+=
name|datalen
operator|+
literal|1
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
operator|(
name|datalen
operator|+
literal|1
operator|)
expr_stmt|;
return|return
operator|(
name|int
operator|)
name|sz
return|;
comment|/* out of space really, but would need buffer 			in order to truncate the output */
block|}
name|sldns_b32_ntop_extended_hex
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|1
argument_list|,
name|datalen
argument_list|,
operator|*
name|s
argument_list|,
operator|*
name|sl
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
name|datalen
operator|+
literal|1
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
operator|(
name|datalen
operator|+
literal|1
operator|)
expr_stmt|;
operator|(
operator|*
name|s
operator|)
operator|+=
name|sz
expr_stmt|;
operator|(
operator|*
name|sl
operator|)
operator|-=
name|sz
expr_stmt|;
return|return
operator|(
name|int
operator|)
name|sz
return|;
block|}
end_function

begin_comment
comment|/** scan number of bytes from wire into b64 presentation format */
end_comment

begin_function
specifier|static
name|int
name|sldns_wire2str_b64_scan_num
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|size_t
name|num
parameter_list|)
block|{
comment|/* b64_ntop_calculate size includes null at the end */
name|size_t
name|sz
init|=
name|sldns_b64_ntop_calculate_size
argument_list|(
name|num
argument_list|)
operator|-
literal|1
decl_stmt|;
if|if
condition|(
operator|*
name|sl
operator|<
name|sz
operator|+
literal|1
condition|)
block|{
operator|(
operator|*
name|d
operator|)
operator|+=
name|num
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
name|num
expr_stmt|;
return|return
operator|(
name|int
operator|)
name|sz
return|;
comment|/* out of space really, but would need buffer 			in order to truncate the output */
block|}
name|sldns_b64_ntop
argument_list|(
operator|*
name|d
argument_list|,
name|num
argument_list|,
operator|*
name|s
argument_list|,
operator|*
name|sl
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
name|num
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
name|num
expr_stmt|;
operator|(
operator|*
name|s
operator|)
operator|+=
name|sz
expr_stmt|;
operator|(
operator|*
name|sl
operator|)
operator|-=
name|sz
expr_stmt|;
return|return
operator|(
name|int
operator|)
name|sz
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_b64_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
return|return
name|sldns_wire2str_b64_scan_num
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|,
operator|*
name|dl
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_hex_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
return|return
name|print_remainder_hex
argument_list|(
literal|""
argument_list|,
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_nsec_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|uint8_t
modifier|*
name|p
init|=
operator|*
name|d
decl_stmt|;
name|size_t
name|pl
init|=
operator|*
name|dl
decl_stmt|;
name|unsigned
name|i
decl_stmt|,
name|bit
decl_stmt|,
name|window
decl_stmt|,
name|block_len
decl_stmt|;
name|uint16_t
name|t
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|;
comment|/* check for errors */
while|while
condition|(
name|pl
condition|)
block|{
if|if
condition|(
name|pl
operator|<
literal|2
condition|)
return|return
operator|-
literal|1
return|;
name|block_len
operator|=
operator|(
name|unsigned
operator|)
name|p
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|pl
operator|<
literal|2
operator|+
name|block_len
condition|)
return|return
operator|-
literal|1
return|;
name|p
operator|+=
name|block_len
operator|+
literal|2
expr_stmt|;
name|pl
operator|-=
name|block_len
operator|+
literal|2
expr_stmt|;
block|}
comment|/* do it */
name|p
operator|=
operator|*
name|d
expr_stmt|;
name|pl
operator|=
operator|*
name|dl
expr_stmt|;
while|while
condition|(
name|pl
condition|)
block|{
if|if
condition|(
name|pl
operator|<
literal|2
condition|)
return|return
operator|-
literal|1
return|;
comment|/* cannot happen */
name|window
operator|=
operator|(
name|unsigned
operator|)
name|p
index|[
literal|0
index|]
expr_stmt|;
name|block_len
operator|=
operator|(
name|unsigned
operator|)
name|p
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|pl
operator|<
literal|2
operator|+
name|block_len
condition|)
return|return
operator|-
literal|1
return|;
comment|/* cannot happen */
name|p
operator|+=
literal|2
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|block_len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p
index|[
name|i
index|]
operator|==
literal|0
condition|)
continue|continue;
comment|/* base type number for this octet */
name|t
operator|=
operator|(
operator|(
name|window
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
name|i
operator|<<
literal|3
operator|)
expr_stmt|;
for|for
control|(
name|bit
operator|=
literal|0
init|;
name|bit
operator|<
literal|8
condition|;
name|bit
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|p
index|[
name|i
index|]
operator|&
operator|(
literal|0x80
operator|>>
name|bit
operator|)
operator|)
condition|)
block|{
if|if
condition|(
name|w
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_type_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|t
operator|+
name|bit
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|p
operator|+=
name|block_len
expr_stmt|;
name|pl
operator|-=
name|block_len
operator|+
literal|2
expr_stmt|;
block|}
operator|(
operator|*
name|d
operator|)
operator|+=
operator|*
name|dl
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|=
literal|0
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_nsec3_salt_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|size_t
name|salt_len
decl_stmt|;
name|int
name|w
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|salt_len
operator|=
call|(
name|size_t
call|)
argument_list|(
operator|*
name|d
argument_list|)
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|1
operator|+
name|salt_len
condition|)
return|return
operator|-
literal|1
return|;
operator|(
operator|*
name|d
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|--
expr_stmt|;
if|if
condition|(
name|salt_len
operator|==
literal|0
condition|)
block|{
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"-"
argument_list|)
return|;
block|}
name|w
operator|=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
operator|*
name|d
argument_list|,
name|salt_len
argument_list|)
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
name|salt_len
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
name|salt_len
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_cert_alg_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|sldns_lookup_table
modifier|*
name|lt
decl_stmt|;
name|int
name|data
decl_stmt|,
name|w
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|2
condition|)
return|return
operator|-
literal|1
return|;
name|data
operator|=
operator|(
name|int
operator|)
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|lt
operator|=
name|sldns_lookup_by_id
argument_list|(
name|sldns_cert_algorithms
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|lt
operator|&&
name|lt
operator|->
name|name
condition|)
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
expr_stmt|;
else|else
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%d"
argument_list|,
name|data
argument_list|)
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|2
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|2
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_alg_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
comment|/* don't use algorithm mnemonics in the presentation format 	 * this kind of got sneaked into the rfc's */
return|return
name|sldns_wire2str_int8_scan
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_unknown_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
return|return
name|sldns_wire2str_rdata_unknown_scan
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_time_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
comment|/* create a YYYYMMDDHHMMSS string if possible */
name|struct
name|tm
name|tm
decl_stmt|;
name|char
name|date_buf
index|[
literal|16
index|]
decl_stmt|;
name|uint32_t
name|t
decl_stmt|;
name|memset
argument_list|(
operator|&
name|tm
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|tm
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|t
operator|=
name|sldns_read_uint32
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
name|date_buf
index|[
literal|15
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|sldns_serial_arithmitics_gmtime_r
argument_list|(
name|t
argument_list|,
name|time
argument_list|(
name|NULL
argument_list|)
argument_list|,
operator|&
name|tm
argument_list|)
operator|&&
name|strftime
argument_list|(
name|date_buf
argument_list|,
literal|15
argument_list|,
literal|"%Y%m%d%H%M%S"
argument_list|,
operator|&
name|tm
argument_list|)
condition|)
block|{
operator|(
operator|*
name|d
operator|)
operator|+=
literal|4
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|4
expr_stmt|;
return|return
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%s"
argument_list|,
name|date_buf
argument_list|)
return|;
block|}
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|loc_cm_print
parameter_list|(
name|char
modifier|*
modifier|*
name|str
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
name|mantissa
parameter_list|,
name|uint8_t
name|exponent
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|uint8_t
name|i
decl_stmt|;
comment|/* is it 0.<two digits> ? */
if|if
condition|(
name|exponent
operator|<
literal|2
condition|)
block|{
if|if
condition|(
name|exponent
operator|==
literal|1
condition|)
name|mantissa
operator|*=
literal|10
expr_stmt|;
return|return
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
literal|"0.%02ld"
argument_list|,
operator|(
name|long
operator|)
name|mantissa
argument_list|)
return|;
block|}
comment|/* always<digit><string of zeros> */
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
literal|"%d"
argument_list|,
operator|(
name|int
operator|)
name|mantissa
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|exponent
operator|-
literal|2
condition|;
name|i
operator|++
control|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_loc_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|str
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
comment|/* we could do checking (ie degrees< 90 etc)? */
name|uint8_t
name|version
decl_stmt|;
name|uint8_t
name|size
decl_stmt|;
name|uint8_t
name|horizontal_precision
decl_stmt|;
name|uint8_t
name|vertical_precision
decl_stmt|;
name|uint32_t
name|longitude
decl_stmt|;
name|uint32_t
name|latitude
decl_stmt|;
name|uint32_t
name|altitude
decl_stmt|;
name|char
name|northerness
decl_stmt|;
name|char
name|easterness
decl_stmt|;
name|uint32_t
name|h
decl_stmt|;
name|uint32_t
name|m
decl_stmt|;
name|double
name|s
decl_stmt|;
name|uint32_t
name|equator
init|=
operator|(
name|uint32_t
operator|)
literal|1
operator|<<
literal|31
decl_stmt|;
comment|/* 2**31 */
name|int
name|w
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|16
condition|)
return|return
operator|-
literal|1
return|;
name|version
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|version
operator|!=
literal|0
condition|)
return|return
name|sldns_wire2str_hex_scan
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|str
argument_list|,
name|sl
argument_list|)
return|;
name|size
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|1
index|]
expr_stmt|;
name|horizontal_precision
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|2
index|]
expr_stmt|;
name|vertical_precision
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|3
index|]
expr_stmt|;
name|latitude
operator|=
name|sldns_read_uint32
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|4
argument_list|)
expr_stmt|;
name|longitude
operator|=
name|sldns_read_uint32
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|8
argument_list|)
expr_stmt|;
name|altitude
operator|=
name|sldns_read_uint32
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|12
argument_list|)
expr_stmt|;
if|if
condition|(
name|latitude
operator|>
name|equator
condition|)
block|{
name|northerness
operator|=
literal|'N'
expr_stmt|;
name|latitude
operator|=
name|latitude
operator|-
name|equator
expr_stmt|;
block|}
else|else
block|{
name|northerness
operator|=
literal|'S'
expr_stmt|;
name|latitude
operator|=
name|equator
operator|-
name|latitude
expr_stmt|;
block|}
name|h
operator|=
name|latitude
operator|/
operator|(
literal|1000
operator|*
literal|60
operator|*
literal|60
operator|)
expr_stmt|;
name|latitude
operator|=
name|latitude
operator|%
operator|(
literal|1000
operator|*
literal|60
operator|*
literal|60
operator|)
expr_stmt|;
name|m
operator|=
name|latitude
operator|/
operator|(
literal|1000
operator|*
literal|60
operator|)
expr_stmt|;
name|latitude
operator|=
name|latitude
operator|%
operator|(
literal|1000
operator|*
literal|60
operator|)
expr_stmt|;
name|s
operator|=
operator|(
name|double
operator|)
name|latitude
operator|/
literal|1000.0
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
literal|"%02u %02u %06.3f %c "
argument_list|,
name|h
argument_list|,
name|m
argument_list|,
name|s
argument_list|,
name|northerness
argument_list|)
expr_stmt|;
if|if
condition|(
name|longitude
operator|>
name|equator
condition|)
block|{
name|easterness
operator|=
literal|'E'
expr_stmt|;
name|longitude
operator|=
name|longitude
operator|-
name|equator
expr_stmt|;
block|}
else|else
block|{
name|easterness
operator|=
literal|'W'
expr_stmt|;
name|longitude
operator|=
name|equator
operator|-
name|longitude
expr_stmt|;
block|}
name|h
operator|=
name|longitude
operator|/
operator|(
literal|1000
operator|*
literal|60
operator|*
literal|60
operator|)
expr_stmt|;
name|longitude
operator|=
name|longitude
operator|%
operator|(
literal|1000
operator|*
literal|60
operator|*
literal|60
operator|)
expr_stmt|;
name|m
operator|=
name|longitude
operator|/
operator|(
literal|1000
operator|*
literal|60
operator|)
expr_stmt|;
name|longitude
operator|=
name|longitude
operator|%
operator|(
literal|1000
operator|*
literal|60
operator|)
expr_stmt|;
name|s
operator|=
operator|(
name|double
operator|)
name|longitude
operator|/
operator|(
literal|1000.0
operator|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
literal|"%02u %02u %06.3f %c "
argument_list|,
name|h
argument_list|,
name|m
argument_list|,
name|s
argument_list|,
name|easterness
argument_list|)
expr_stmt|;
name|s
operator|=
operator|(
operator|(
name|double
operator|)
name|altitude
operator|)
operator|/
literal|100
expr_stmt|;
name|s
operator|-=
literal|100000
expr_stmt|;
if|if
condition|(
name|altitude
operator|%
literal|100
operator|!=
literal|0
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
literal|"%.2f"
argument_list|,
name|s
argument_list|)
expr_stmt|;
else|else
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
literal|"%.0f"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
literal|"m "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|loc_cm_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
operator|(
name|size
operator|&
literal|0xf0
operator|)
operator|>>
literal|4
argument_list|,
name|size
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
literal|"m "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|loc_cm_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
operator|(
name|horizontal_precision
operator|&
literal|0xf0
operator|)
operator|>>
literal|4
argument_list|,
name|horizontal_precision
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
literal|"m "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|loc_cm_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
operator|(
name|vertical_precision
operator|&
literal|0xf0
operator|)
operator|>>
literal|4
argument_list|,
name|vertical_precision
operator|&
literal|0x0f
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|sl
argument_list|,
literal|"m"
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|16
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|16
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_wks_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
comment|/* protocol, followed by bitmap of services */
specifier|const
name|char
modifier|*
name|proto_name
init|=
name|NULL
decl_stmt|;
name|struct
name|protoent
modifier|*
name|protocol
decl_stmt|;
name|struct
name|servent
modifier|*
name|service
decl_stmt|;
name|uint8_t
name|protocol_nr
decl_stmt|;
name|int
name|bit
decl_stmt|,
name|port
decl_stmt|,
name|w
init|=
literal|0
decl_stmt|;
name|size_t
name|i
decl_stmt|;
comment|/* we cannot print with strings because they 	 * are not portable, the presentation format may 	 * not be able to be read in on another computer.  */
name|int
name|print_symbols
init|=
literal|0
decl_stmt|;
comment|/* protocol */
if|if
condition|(
operator|*
name|dl
operator|<
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|protocol_nr
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|0
index|]
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|--
expr_stmt|;
name|protocol
operator|=
name|getprotobynumber
argument_list|(
operator|(
name|int
operator|)
name|protocol_nr
argument_list|)
expr_stmt|;
if|if
condition|(
name|protocol
operator|&&
operator|(
name|protocol
operator|->
name|p_name
operator|!=
name|NULL
operator|)
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%s"
argument_list|,
name|protocol
operator|->
name|p_name
argument_list|)
expr_stmt|;
name|proto_name
operator|=
name|protocol
operator|->
name|p_name
expr_stmt|;
block|}
else|else
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|unsigned
operator|)
name|protocol_nr
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|*
name|dl
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
operator|*
name|d
operator|)
index|[
name|i
index|]
operator|==
literal|0
condition|)
continue|continue;
for|for
control|(
name|bit
operator|=
literal|0
init|;
name|bit
operator|<
literal|8
condition|;
name|bit
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
operator|(
operator|(
operator|*
name|d
operator|)
index|[
name|i
index|]
operator|)
operator|&
operator|(
literal|0x80
operator|>>
name|bit
operator|)
operator|)
condition|)
continue|continue;
name|port
operator|=
operator|(
name|int
operator|)
name|i
operator|*
literal|8
operator|+
name|bit
expr_stmt|;
if|if
condition|(
operator|!
name|print_symbols
condition|)
name|service
operator|=
name|NULL
expr_stmt|;
else|else
name|service
operator|=
name|getservbyport
argument_list|(
operator|(
name|int
operator|)
name|htons
argument_list|(
operator|(
name|uint16_t
operator|)
name|port
argument_list|)
argument_list|,
name|proto_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|service
operator|&&
name|service
operator|->
name|s_name
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" %s"
argument_list|,
name|service
operator|->
name|s_name
argument_list|)
expr_stmt|;
else|else
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" %u"
argument_list|,
operator|(
name|unsigned
operator|)
name|port
argument_list|)
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|HAVE_ENDSERVENT
name|endservent
argument_list|()
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|HAVE_ENDPROTOENT
name|endprotoent
argument_list|()
expr_stmt|;
endif|#
directive|endif
operator|(
operator|*
name|d
operator|)
operator|+=
operator|*
name|dl
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|=
literal|0
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_nsap_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
return|return
name|print_remainder_hex
argument_list|(
literal|"0x"
argument_list|,
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_atma_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
return|return
name|print_remainder_hex
argument_list|(
literal|""
argument_list|,
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* internal scan routine that can modify arguments on failure */
end_comment

begin_function
specifier|static
name|int
name|sldns_wire2str_ipseckey_scan_internal
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
modifier|*
name|pkt
parameter_list|,
name|size_t
name|pktlen
parameter_list|)
block|{
comment|/* http://www.ietf.org/internet-drafts/draft-ietf-ipseckey-rr-12.txt*/
name|uint8_t
name|precedence
decl_stmt|,
name|gateway_type
decl_stmt|,
name|algorithm
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|3
condition|)
return|return
operator|-
literal|1
return|;
name|precedence
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|0
index|]
expr_stmt|;
name|gateway_type
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|1
index|]
expr_stmt|;
name|algorithm
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|2
index|]
expr_stmt|;
if|if
condition|(
name|gateway_type
operator|>
literal|3
condition|)
return|return
operator|-
literal|1
return|;
comment|/* unknown */
operator|(
operator|*
name|d
operator|)
operator|+=
literal|3
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|3
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%d %d %d "
argument_list|,
operator|(
name|int
operator|)
name|precedence
argument_list|,
operator|(
name|int
operator|)
name|gateway_type
argument_list|,
operator|(
name|int
operator|)
name|algorithm
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|gateway_type
condition|)
block|{
case|case
literal|0
case|:
comment|/* no gateway */
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
comment|/* ip4 */
name|w
operator|+=
name|sldns_wire2str_a_scan
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
comment|/* ip6 */
name|w
operator|+=
name|sldns_wire2str_aaaa_scan
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
comment|/* dname */
name|w
operator|+=
name|sldns_wire2str_dname_scan
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* unknown */
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|*
name|dl
operator|<
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_b64_scan_num
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|,
operator|*
name|dl
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_ipseckey_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
modifier|*
name|pkt
parameter_list|,
name|size_t
name|pktlen
parameter_list|)
block|{
name|uint8_t
modifier|*
name|od
init|=
operator|*
name|d
decl_stmt|;
name|char
modifier|*
name|os
init|=
operator|*
name|s
decl_stmt|;
name|size_t
name|odl
init|=
operator|*
name|dl
decl_stmt|,
name|osl
init|=
operator|*
name|sl
decl_stmt|;
name|int
name|w
init|=
name|sldns_wire2str_ipseckey_scan_internal
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|,
name|pkt
argument_list|,
name|pktlen
argument_list|)
decl_stmt|;
if|if
condition|(
name|w
operator|==
operator|-
literal|1
condition|)
block|{
operator|*
name|d
operator|=
name|od
expr_stmt|;
operator|*
name|s
operator|=
name|os
expr_stmt|;
operator|*
name|dl
operator|=
name|odl
expr_stmt|;
operator|*
name|sl
operator|=
name|osl
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_hip_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|int
name|w
decl_stmt|;
name|uint8_t
name|algo
decl_stmt|,
name|hitlen
decl_stmt|;
name|uint16_t
name|pklen
decl_stmt|;
comment|/* read lengths */
if|if
condition|(
operator|*
name|dl
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|hitlen
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|0
index|]
expr_stmt|;
name|algo
operator|=
operator|(
operator|*
name|d
operator|)
index|[
literal|1
index|]
expr_stmt|;
name|pklen
operator|=
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
operator|(
name|size_t
operator|)
literal|4
operator|+
operator|(
name|size_t
operator|)
name|hitlen
operator|+
operator|(
name|size_t
operator|)
name|pklen
condition|)
return|return
operator|-
literal|1
return|;
comment|/* write: algo hit pubkey */
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%u "
argument_list|,
operator|(
name|unsigned
operator|)
name|algo
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
operator|(
operator|*
name|d
operator|)
operator|+
literal|4
argument_list|,
name|hitlen
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|4
operator|+
name|hitlen
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
operator|(
literal|4
operator|+
name|hitlen
operator|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_b64_scan_num
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|,
name|pklen
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_int16_data_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|uint16_t
name|n
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|2
condition|)
return|return
operator|-
literal|1
return|;
name|n
operator|=
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|2
operator|+
operator|(
name|size_t
operator|)
name|n
condition|)
return|return
operator|-
literal|1
return|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|2
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|2
expr_stmt|;
return|return
name|sldns_wire2str_b64_scan_num
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|,
name|n
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_nsec3_next_owner_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
return|return
name|sldns_wire2str_b32_ext_scan
argument_list|(
name|d
argument_list|,
name|dl
argument_list|,
name|s
argument_list|,
name|sl
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_ilnp64_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|int
name|w
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%.4x:%.4x:%.4x:%.4x"
argument_list|,
name|sldns_read_uint16
argument_list|(
operator|*
name|d
argument_list|)
argument_list|,
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|2
argument_list|)
argument_list|,
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|4
argument_list|)
argument_list|,
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|d
operator|)
operator|+
literal|6
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|8
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|8
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_eui48_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|int
name|w
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|6
condition|)
return|return
operator|-
literal|1
return|;
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%.2x-%.2x-%.2x-%.2x-%.2x-%.2x"
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|0
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|1
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|2
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|3
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|4
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|6
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|6
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_eui64_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|int
name|w
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|w
operator|=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%.2x-%.2x-%.2x-%.2x-%.2x-%.2x-%.2x-%.2x"
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|0
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|1
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|2
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|3
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|4
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|5
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|6
index|]
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
literal|8
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
literal|8
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_tag_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|,
name|n
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|n
operator|=
call|(
name|size_t
call|)
argument_list|(
operator|(
operator|*
name|d
operator|)
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|dl
operator|<
literal|1
operator|+
name|n
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|isalnum
argument_list|(
call|(
name|int
call|)
argument_list|(
operator|*
name|d
argument_list|)
index|[
name|i
index|]
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n
condition|;
name|i
operator|++
control|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%c"
argument_list|,
call|(
name|char
call|)
argument_list|(
operator|*
name|d
argument_list|)
index|[
name|i
index|]
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
name|n
operator|+
literal|1
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|-=
operator|(
name|n
operator|+
literal|1
operator|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_long_str_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|d
parameter_list|,
name|size_t
modifier|*
name|dl
parameter_list|,
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|*
name|dl
condition|;
name|i
operator|++
control|)
name|w
operator|+=
name|str_char_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
operator|(
operator|*
name|d
operator|)
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
operator|(
operator|*
name|d
operator|)
operator|+=
operator|*
name|dl
expr_stmt|;
operator|(
operator|*
name|dl
operator|)
operator|=
literal|0
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_edns_llq_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
comment|/* LLQ constants */
specifier|const
name|char
modifier|*
name|llq_errors
index|[]
init|=
block|{
literal|"NO-ERROR"
block|,
literal|"SERV-FULL"
block|,
literal|"STATIC"
block|,
literal|"FORMAT-ERR"
block|,
literal|"NO-SUCH-LLQ"
block|,
literal|"BAD-VERS"
block|,
literal|"UNKNOWN_ERR"
block|}
decl_stmt|;
specifier|const
name|unsigned
name|int
name|llq_errors_num
init|=
literal|7
decl_stmt|;
specifier|const
name|char
modifier|*
name|llq_opcodes
index|[]
init|=
block|{
literal|"LLQ-SETUP"
block|,
literal|"LLQ-REFRESH"
block|,
literal|"LLQ-EVENT"
block|}
decl_stmt|;
specifier|const
name|unsigned
name|int
name|llq_opcodes_num
init|=
literal|3
decl_stmt|;
name|uint16_t
name|version
decl_stmt|,
name|llq_opcode
decl_stmt|,
name|error_code
decl_stmt|;
name|uint64_t
name|llq_id
decl_stmt|;
name|uint32_t
name|lease_life
decl_stmt|;
comment|/* Requested or granted life of LLQ, in seconds */
name|int
name|w
init|=
literal|0
decl_stmt|;
comment|/* read the record */
if|if
condition|(
name|len
operator|!=
literal|18
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"malformed LLQ "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|data
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
name|version
operator|=
name|sldns_read_uint16
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|llq_opcode
operator|=
name|sldns_read_uint16
argument_list|(
name|data
operator|+
literal|2
argument_list|)
expr_stmt|;
name|error_code
operator|=
name|sldns_read_uint16
argument_list|(
name|data
operator|+
literal|4
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
operator|&
name|llq_id
argument_list|,
name|data
operator|+
literal|6
argument_list|,
sizeof|sizeof
argument_list|(
name|llq_id
argument_list|)
argument_list|)
expr_stmt|;
name|lease_life
operator|=
name|sldns_read_uint32
argument_list|(
name|data
operator|+
literal|14
argument_list|)
expr_stmt|;
comment|/* print it */
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"v%d "
argument_list|,
operator|(
name|int
operator|)
name|version
argument_list|)
expr_stmt|;
if|if
condition|(
name|llq_opcode
operator|<
name|llq_opcodes_num
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%s"
argument_list|,
name|llq_opcodes
index|[
name|llq_opcode
index|]
argument_list|)
expr_stmt|;
else|else
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"opcode %d"
argument_list|,
operator|(
name|int
operator|)
name|llq_opcode
argument_list|)
expr_stmt|;
if|if
condition|(
name|error_code
operator|<
name|llq_errors_num
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" %s"
argument_list|,
name|llq_errors
index|[
name|error_code
index|]
argument_list|)
expr_stmt|;
else|else
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" error %d"
argument_list|,
operator|(
name|int
operator|)
name|error_code
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|USE_WINSOCK
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" id %llx lease-life %lu"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|llq_id
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|lease_life
argument_list|)
expr_stmt|;
else|#
directive|else
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" id %I64x lease-life %lu"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|llq_id
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|lease_life
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_edns_ul_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|uint32_t
name|lease
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|len
operator|!=
literal|4
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"malformed UL "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|data
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
name|lease
operator|=
name|sldns_read_uint32
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"lease %lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|lease
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_edns_nsid_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|size_t
name|i
decl_stmt|,
name|printed
init|=
literal|0
decl_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|data
argument_list|,
name|len
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|isprint
argument_list|(
operator|(
name|int
operator|)
name|data
index|[
name|i
index|]
argument_list|)
operator|||
name|data
index|[
name|i
index|]
operator|==
literal|'\t'
condition|)
block|{
if|if
condition|(
operator|!
name|printed
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" ("
argument_list|)
expr_stmt|;
name|printed
operator|=
literal|1
expr_stmt|;
block|}
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%c"
argument_list|,
operator|(
name|char
operator|)
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|printed
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_edns_dau_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|sldns_lookup_table
modifier|*
name|lt
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
name|lt
operator|=
name|sldns_lookup_by_id
argument_list|(
name|sldns_algorithms
argument_list|,
operator|(
name|int
operator|)
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|lt
operator|&&
name|lt
operator|->
name|name
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" %s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
expr_stmt|;
else|else
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" %d"
argument_list|,
operator|(
name|int
operator|)
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_edns_dhu_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|sldns_lookup_table
modifier|*
name|lt
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
name|lt
operator|=
name|sldns_lookup_by_id
argument_list|(
name|sldns_hashes
argument_list|,
operator|(
name|int
operator|)
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|lt
operator|&&
name|lt
operator|->
name|name
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" %s"
argument_list|,
name|lt
operator|->
name|name
argument_list|)
expr_stmt|;
else|else
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" %d"
argument_list|,
operator|(
name|int
operator|)
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_edns_n3u_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|data
index|[
name|i
index|]
operator|==
literal|1
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" SHA1"
argument_list|)
expr_stmt|;
else|else
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" %d"
argument_list|,
operator|(
name|int
operator|)
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_edns_subnet_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|uint16_t
name|family
decl_stmt|;
name|uint8_t
name|source
decl_stmt|,
name|scope
decl_stmt|;
if|if
condition|(
name|len
operator|<
literal|4
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"malformed subnet "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|data
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
name|family
operator|=
name|sldns_read_uint16
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|source
operator|=
name|data
index|[
literal|2
index|]
expr_stmt|;
name|scope
operator|=
name|data
index|[
literal|3
index|]
expr_stmt|;
if|if
condition|(
name|family
operator|==
literal|1
condition|)
block|{
comment|/* IP4 */
name|char
name|buf
index|[
literal|64
index|]
decl_stmt|;
name|uint8_t
name|ip4
index|[
literal|4
index|]
decl_stmt|;
name|memset
argument_list|(
name|ip4
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ip4
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|-
literal|4
operator|>
literal|4
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"trailingdata:"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|data
operator|+
literal|4
operator|+
literal|4
argument_list|,
name|len
operator|-
literal|4
operator|-
literal|4
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|len
operator|=
literal|4
operator|+
literal|4
expr_stmt|;
block|}
name|memmove
argument_list|(
name|ip4
argument_list|,
name|data
operator|+
literal|4
argument_list|,
name|len
operator|-
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|inet_ntop
argument_list|(
name|AF_INET
argument_list|,
name|ip4
argument_list|,
name|buf
argument_list|,
operator|(
name|socklen_t
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"ip4ntoperror "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|data
operator|+
literal|4
operator|+
literal|4
argument_list|,
name|len
operator|-
literal|4
operator|-
literal|4
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%s"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|family
operator|==
literal|2
condition|)
block|{
comment|/* IP6 */
name|char
name|buf
index|[
literal|64
index|]
decl_stmt|;
name|uint8_t
name|ip6
index|[
literal|16
index|]
decl_stmt|;
name|memset
argument_list|(
name|ip6
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ip6
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|-
literal|4
operator|>
literal|16
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"trailingdata:"
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|data
operator|+
literal|4
operator|+
literal|16
argument_list|,
name|len
operator|-
literal|4
operator|-
literal|16
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|len
operator|=
literal|4
operator|+
literal|16
expr_stmt|;
block|}
name|memmove
argument_list|(
name|ip6
argument_list|,
name|data
operator|+
literal|4
argument_list|,
name|len
operator|-
literal|4
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|AF_INET6
if|if
condition|(
operator|!
name|inet_ntop
argument_list|(
name|AF_INET6
argument_list|,
name|ip6
argument_list|,
name|buf
argument_list|,
operator|(
name|socklen_t
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"ip6ntoperror "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|data
operator|+
literal|4
operator|+
literal|4
argument_list|,
name|len
operator|-
literal|4
operator|-
literal|4
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"%s"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|data
operator|+
literal|4
operator|+
literal|4
argument_list|,
name|len
operator|-
literal|4
operator|-
literal|4
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
comment|/* unknown */
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"family %d "
argument_list|,
operator|(
name|int
operator|)
name|family
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|data
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|"/%d scope /%d"
argument_list|,
operator|(
name|int
operator|)
name|source
argument_list|,
operator|(
name|int
operator|)
name|scope
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_edns_option_print
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint16_t
name|option_code
parameter_list|,
name|uint8_t
modifier|*
name|optdata
parameter_list|,
name|size_t
name|optlen
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|w
operator|+=
name|sldns_wire2str_edns_option_code_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|option_code
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|": "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|option_code
condition|)
block|{
case|case
name|LDNS_EDNS_LLQ
case|:
name|w
operator|+=
name|sldns_wire2str_edns_llq_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|optdata
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_EDNS_UL
case|:
name|w
operator|+=
name|sldns_wire2str_edns_ul_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|optdata
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_EDNS_NSID
case|:
name|w
operator|+=
name|sldns_wire2str_edns_nsid_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|optdata
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_EDNS_DAU
case|:
name|w
operator|+=
name|sldns_wire2str_edns_dau_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|optdata
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_EDNS_DHU
case|:
name|w
operator|+=
name|sldns_wire2str_edns_dhu_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|optdata
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_EDNS_N3U
case|:
name|w
operator|+=
name|sldns_wire2str_edns_n3u_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|optdata
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_EDNS_CLIENT_SUBNET
case|:
name|w
operator|+=
name|sldns_wire2str_edns_subnet_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|optdata
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* unknown option code */
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|optdata
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
name|w
return|;
block|}
end_function

begin_comment
comment|/** print the edns options to string */
end_comment

begin_function
specifier|static
name|int
name|print_edns_opts
parameter_list|(
name|char
modifier|*
modifier|*
name|s
parameter_list|,
name|size_t
modifier|*
name|sl
parameter_list|,
name|uint8_t
modifier|*
name|rdata
parameter_list|,
name|size_t
name|rdatalen
parameter_list|)
block|{
name|uint16_t
name|option_code
decl_stmt|,
name|option_len
decl_stmt|;
name|int
name|w
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|rdatalen
operator|>
literal|0
condition|)
block|{
comment|/* option name */
if|if
condition|(
name|rdatalen
operator|<
literal|4
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" ; malformed: "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|rdata
argument_list|,
name|rdatalen
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
name|option_code
operator|=
name|sldns_read_uint16
argument_list|(
name|rdata
argument_list|)
expr_stmt|;
name|option_len
operator|=
name|sldns_read_uint16
argument_list|(
name|rdata
operator|+
literal|2
argument_list|)
expr_stmt|;
name|rdata
operator|+=
literal|4
expr_stmt|;
name|rdatalen
operator|-=
literal|4
expr_stmt|;
comment|/* option value */
if|if
condition|(
name|rdatalen
operator|<
operator|(
name|size_t
operator|)
name|option_len
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" ; malformed "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_edns_option_code_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|option_code
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|": "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|print_hex_buf
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|rdata
argument_list|,
name|rdatalen
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
literal|" ; "
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_wire2str_edns_option_print
argument_list|(
name|s
argument_list|,
name|sl
argument_list|,
name|option_code
argument_list|,
name|rdata
argument_list|,
name|option_len
argument_list|)
expr_stmt|;
name|rdata
operator|+=
name|option_len
expr_stmt|;
name|rdatalen
operator|-=
name|option_len
expr_stmt|;
block|}
return|return
name|w
return|;
block|}
end_function

begin_function
name|int
name|sldns_wire2str_edns_scan
parameter_list|(
name|uint8_t
modifier|*
modifier|*
name|data
parameter_list|,
name|size_t
modifier|*
name|data_len
parameter_list|,
name|char
modifier|*
modifier|*
name|str
parameter_list|,
name|size_t
modifier|*
name|str_len
parameter_list|,
name|uint8_t
modifier|*
name|pkt
parameter_list|,
name|size_t
name|pktlen
parameter_list|)
block|{
name|int
name|w
init|=
literal|0
decl_stmt|;
name|uint8_t
name|ext_rcode
decl_stmt|,
name|edns_version
decl_stmt|;
name|uint16_t
name|udpsize
decl_stmt|,
name|edns_bits
decl_stmt|,
name|rdatalen
decl_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|str_len
argument_list|,
literal|"; EDNS:"
argument_list|)
expr_stmt|;
comment|/* some input checks, domain name */
if|if
condition|(
operator|*
name|data_len
operator|<
literal|1
operator|+
literal|10
condition|)
return|return
name|w
operator|+
name|print_remainder_hex
argument_list|(
literal|"Error malformed 0x"
argument_list|,
name|data
argument_list|,
name|data_len
argument_list|,
name|str
argument_list|,
name|str_len
argument_list|)
return|;
if|if
condition|(
operator|*
name|data
index|[
literal|0
index|]
operator|!=
literal|0
condition|)
block|{
return|return
name|w
operator|+
name|print_remainder_hex
argument_list|(
literal|"Error nonrootdname 0x"
argument_list|,
name|data
argument_list|,
name|data_len
argument_list|,
name|str
argument_list|,
name|str_len
argument_list|)
return|;
block|}
operator|(
operator|*
name|data
operator|)
operator|++
expr_stmt|;
operator|(
operator|*
name|data_len
operator|)
operator|--
expr_stmt|;
comment|/* check type and read fixed contents */
if|if
condition|(
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|data
operator|)
argument_list|)
operator|!=
name|LDNS_RR_TYPE_OPT
condition|)
block|{
return|return
name|w
operator|+
name|print_remainder_hex
argument_list|(
literal|"Error nottypeOPT 0x"
argument_list|,
name|data
argument_list|,
name|data_len
argument_list|,
name|str
argument_list|,
name|str_len
argument_list|)
return|;
block|}
name|udpsize
operator|=
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|data
operator|)
operator|+
literal|2
argument_list|)
expr_stmt|;
name|ext_rcode
operator|=
operator|(
operator|*
name|data
operator|)
index|[
literal|4
index|]
expr_stmt|;
name|edns_version
operator|=
operator|(
operator|*
name|data
operator|)
index|[
literal|5
index|]
expr_stmt|;
name|edns_bits
operator|=
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|data
operator|)
operator|+
literal|6
argument_list|)
expr_stmt|;
name|rdatalen
operator|=
name|sldns_read_uint16
argument_list|(
operator|(
operator|*
name|data
operator|)
operator|+
literal|8
argument_list|)
expr_stmt|;
operator|(
operator|*
name|data
operator|)
operator|+=
literal|10
expr_stmt|;
operator|(
operator|*
name|data_len
operator|)
operator|-=
literal|10
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|str_len
argument_list|,
literal|" version: %u;"
argument_list|,
operator|(
name|unsigned
operator|)
name|edns_version
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|str_len
argument_list|,
literal|" flags:"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|edns_bits
operator|&
name|LDNS_EDNS_MASK_DO_BIT
operator|)
condition|)
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|str_len
argument_list|,
literal|" do"
argument_list|)
expr_stmt|;
comment|/* the extended rcode is the value set, shifted four bits, 	 * and or'd with the original rcode */
if|if
condition|(
name|ext_rcode
condition|)
block|{
name|int
name|rc
init|=
operator|(
operator|(
name|int
operator|)
name|ext_rcode
operator|)
operator|<<
literal|4
decl_stmt|;
if|if
condition|(
name|pkt
operator|&&
name|pktlen
operator|>=
name|LDNS_HEADER_SIZE
condition|)
name|rc
operator||=
name|LDNS_RCODE_WIRE
argument_list|(
name|pkt
argument_list|)
expr_stmt|;
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|str_len
argument_list|,
literal|" ; ext-rcode: %d"
argument_list|,
name|rc
argument_list|)
expr_stmt|;
block|}
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|str_len
argument_list|,
literal|" ; udp: %u"
argument_list|,
operator|(
name|unsigned
operator|)
name|udpsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|rdatalen
condition|)
block|{
if|if
condition|(
operator|*
name|data_len
operator|<
name|rdatalen
condition|)
block|{
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|str_len
argument_list|,
literal|" ; Error EDNS rdata too short; "
argument_list|)
expr_stmt|;
name|rdatalen
operator|=
operator|*
name|data_len
expr_stmt|;
block|}
name|w
operator|+=
name|print_edns_opts
argument_list|(
name|str
argument_list|,
name|str_len
argument_list|,
operator|*
name|data
argument_list|,
name|rdatalen
argument_list|)
expr_stmt|;
operator|(
operator|*
name|data
operator|)
operator|+=
name|rdatalen
expr_stmt|;
operator|(
operator|*
name|data_len
operator|)
operator|-=
name|rdatalen
expr_stmt|;
block|}
name|w
operator|+=
name|sldns_str_print
argument_list|(
name|str
argument_list|,
name|str_len
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

end_unit

