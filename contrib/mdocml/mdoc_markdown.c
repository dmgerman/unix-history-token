begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	$Id: mdoc_markdown.c,v 1.23 2017/06/14 01:31:26 schwarze Exp $ */
end_comment

begin_comment
comment|/*  * Copyright (c) 2017 Ingo Schwarze<schwarze@openbsd.org>  *  * Permission to use, copy, modify, and distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHORS DISCLAIM ALL WARRANTIES  * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR  * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES  * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<assert.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"mandoc_aux.h"
end_include

begin_include
include|#
directive|include
file|"mandoc.h"
end_include

begin_include
include|#
directive|include
file|"roff.h"
end_include

begin_include
include|#
directive|include
file|"mdoc.h"
end_include

begin_include
include|#
directive|include
file|"main.h"
end_include

begin_struct
struct|struct
name|md_act
block|{
name|int
function_decl|(
modifier|*
name|cond
function_decl|)
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
function_decl|;
name|int
function_decl|(
modifier|*
name|pre
function_decl|)
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
function_decl|;
name|void
function_decl|(
modifier|*
name|post
function_decl|)
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
function_decl|;
specifier|const
name|char
modifier|*
name|prefix
decl_stmt|;
comment|/* pre-node string constant */
specifier|const
name|char
modifier|*
name|suffix
decl_stmt|;
comment|/* post-node string constant */
block|}
struct|;
end_struct

begin_function_decl
specifier|static
name|void
name|md_nodelist
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_node
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|const
name|char
modifier|*
name|md_stack
parameter_list|(
name|char
name|c
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_preword
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_rawword
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_word
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_named
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_char
parameter_list|(
name|unsigned
name|char
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_uri
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_cond_head
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_cond_body
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_raw
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_word
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_skip
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_pre_syn
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_An
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Ap
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Bd
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Bk
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Bl
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_D1
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Dl
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_En
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Eo
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Fa
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Fd
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Fn
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Fo
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_In
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_It
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Lk
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Mt
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Nd
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Nm
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_No
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Ns
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Pp
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Rs
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Sh
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Sm
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Vt
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_Xr
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre__T
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|md_pre_br
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_raw
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_word
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_pc
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Bk
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Bl
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_D1
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_En
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Eo
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Fa
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Fd
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Fl
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Fn
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Fo
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_In
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_It
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Lb
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Nm
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Pf
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post_Vt
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|md_post__T
parameter_list|(
name|struct
name|roff_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|md_act
name|__md_acts
index|[
name|MDOC_MAX
operator|-
name|MDOC_Dd
index|]
init|=
block|{
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Dd */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Dt */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Os */
block|{
name|NULL
block|,
name|md_pre_Sh
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Sh */
block|{
name|NULL
block|,
name|md_pre_Sh
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ss */
block|{
name|NULL
block|,
name|md_pre_Pp
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Pp */
block|{
name|md_cond_body
block|,
name|md_pre_D1
block|,
name|md_post_D1
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* D1 */
block|{
name|md_cond_body
block|,
name|md_pre_Dl
block|,
name|md_post_D1
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Dl */
block|{
name|md_cond_body
block|,
name|md_pre_Bd
block|,
name|md_post_D1
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bd */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ed */
block|{
name|md_cond_body
block|,
name|md_pre_Bl
block|,
name|md_post_Bl
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bl */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* El */
block|{
name|NULL
block|,
name|md_pre_It
block|,
name|md_post_It
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* It */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* Ad */
block|{
name|NULL
block|,
name|md_pre_An
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* An */
block|{
name|NULL
block|,
name|md_pre_Ap
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ap */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* Ar */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"**"
block|,
literal|"**"
block|}
block|,
comment|/* Cd */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"**"
block|,
literal|"**"
block|}
block|,
comment|/* Cm */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"`"
block|,
literal|"`"
block|}
block|,
comment|/* Dv */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"`"
block|,
literal|"`"
block|}
block|,
comment|/* Er */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"`"
block|,
literal|"`"
block|}
block|,
comment|/* Ev */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ex */
block|{
name|NULL
block|,
name|md_pre_Fa
block|,
name|md_post_Fa
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Fa */
block|{
name|NULL
block|,
name|md_pre_Fd
block|,
name|md_post_Fd
block|,
literal|"**"
block|,
literal|"**"
block|}
block|,
comment|/* Fd */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_Fl
block|,
literal|"**-"
block|,
literal|"**"
block|}
block|,
comment|/* Fl */
block|{
name|NULL
block|,
name|md_pre_Fn
block|,
name|md_post_Fn
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Fn */
block|{
name|NULL
block|,
name|md_pre_Fd
block|,
name|md_post_raw
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* Ft */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"**"
block|,
literal|"**"
block|}
block|,
comment|/* Ic */
block|{
name|NULL
block|,
name|md_pre_In
block|,
name|md_post_In
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* In */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"`"
block|,
literal|"`"
block|}
block|,
comment|/* Li */
block|{
name|md_cond_head
block|,
name|md_pre_Nd
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Nd */
block|{
name|NULL
block|,
name|md_pre_Nm
block|,
name|md_post_Nm
block|,
literal|"**"
block|,
literal|"**"
block|}
block|,
comment|/* Nm */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"["
block|,
literal|"]"
block|}
block|,
comment|/* Op */
block|{
name|NULL
block|,
name|md_pre_Fd
block|,
name|md_post_raw
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* Ot */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* Pa */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Rv */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* St */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* Va */
block|{
name|NULL
block|,
name|md_pre_Vt
block|,
name|md_post_Vt
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* Vt */
block|{
name|NULL
block|,
name|md_pre_Xr
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Xr */
block|{
name|NULL
block|,
name|NULL
block|,
name|md_post_pc
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* %A */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_pc
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* %B */
block|{
name|NULL
block|,
name|NULL
block|,
name|md_post_pc
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* %D */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_pc
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* %I */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_pc
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* %J */
block|{
name|NULL
block|,
name|NULL
block|,
name|md_post_pc
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* %N */
block|{
name|NULL
block|,
name|NULL
block|,
name|md_post_pc
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* %O */
block|{
name|NULL
block|,
name|NULL
block|,
name|md_post_pc
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* %P */
block|{
name|NULL
block|,
name|NULL
block|,
name|md_post_pc
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* %R */
block|{
name|NULL
block|,
name|md_pre__T
block|,
name|md_post__T
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* %T */
block|{
name|NULL
block|,
name|NULL
block|,
name|md_post_pc
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* %V */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ac */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"<"
block|,
literal|">"
block|}
block|,
comment|/* Ao */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"<"
block|,
literal|">"
block|}
block|,
comment|/* Aq */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* At */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bc */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bf XXX not implemented */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"["
block|,
literal|"]"
block|}
block|,
comment|/* Bo */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"["
block|,
literal|"]"
block|}
block|,
comment|/* Bq */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bsx */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bx */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Db */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Dc */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"\""
block|,
literal|"\""
block|}
block|,
comment|/* Do */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"\""
block|,
literal|"\""
block|}
block|,
comment|/* Dq */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ec */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ef */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* Em */
block|{
name|md_cond_body
block|,
name|md_pre_Eo
block|,
name|md_post_Eo
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Eo */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Fx */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"**"
block|,
literal|"**"
block|}
block|,
comment|/* Ms */
block|{
name|NULL
block|,
name|md_pre_No
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* No */
block|{
name|NULL
block|,
name|md_pre_Ns
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ns */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Nx */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ox */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Pc */
block|{
name|NULL
block|,
name|NULL
block|,
name|md_post_Pf
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Pf */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"("
block|,
literal|")"
block|}
block|,
comment|/* Po */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"("
block|,
literal|")"
block|}
block|,
comment|/* Pq */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Qc */
block|{
name|md_cond_body
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"'`"
block|,
literal|"`'"
block|}
block|,
comment|/* Ql */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"\""
block|,
literal|"\""
block|}
block|,
comment|/* Qo */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"\""
block|,
literal|"\""
block|}
block|,
comment|/* Qq */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Re */
block|{
name|md_cond_body
block|,
name|md_pre_Rs
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Rs */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Sc */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"'"
block|,
literal|"'"
block|}
block|,
comment|/* So */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"'"
block|,
literal|"'"
block|}
block|,
comment|/* Sq */
block|{
name|NULL
block|,
name|md_pre_Sm
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Sm */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* Sx */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"**"
block|,
literal|"**"
block|}
block|,
comment|/* Sy */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"`"
block|,
literal|"`"
block|}
block|,
comment|/* Tn */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ux */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Xc */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Xo */
block|{
name|NULL
block|,
name|md_pre_Fo
block|,
name|md_post_Fo
block|,
literal|"**"
block|,
literal|"**"
block|}
block|,
comment|/* Fo */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Fc */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"["
block|,
literal|"]"
block|}
block|,
comment|/* Oo */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Oc */
block|{
name|NULL
block|,
name|md_pre_Bk
block|,
name|md_post_Bk
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bk */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ek */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Bt */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Hf */
block|{
name|NULL
block|,
name|md_pre_raw
block|,
name|md_post_raw
block|,
literal|"*"
block|,
literal|"*"
block|}
block|,
comment|/* Fr */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ud */
block|{
name|NULL
block|,
name|NULL
block|,
name|md_post_Lb
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Lb */
block|{
name|NULL
block|,
name|md_pre_Pp
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Lp */
block|{
name|NULL
block|,
name|md_pre_Lk
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Lk */
block|{
name|NULL
block|,
name|md_pre_Mt
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Mt */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"{"
block|,
literal|"}"
block|}
block|,
comment|/* Brq */
block|{
name|md_cond_body
block|,
name|md_pre_word
block|,
name|md_post_word
block|,
literal|"{"
block|,
literal|"}"
block|}
block|,
comment|/* Bro */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Brc */
block|{
name|NULL
block|,
name|NULL
block|,
name|md_post_pc
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* %C */
block|{
name|NULL
block|,
name|md_pre_skip
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Es */
block|{
name|md_cond_body
block|,
name|md_pre_En
block|,
name|md_post_En
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* En */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Dx */
block|{
name|NULL
block|,
name|NULL
block|,
name|md_post_pc
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* %Q */
block|{
name|NULL
block|,
name|md_pre_Lk
block|,
name|md_post_pc
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* %U */
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* Ta */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|md_act
modifier|*
specifier|const
name|md_acts
init|=
name|__md_acts
operator|-
name|MDOC_Dd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|outflags
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|MD_spc
value|(1<< 0)
end_define

begin_comment
comment|/* Blank character before next word. */
end_comment

begin_define
define|#
directive|define
name|MD_spc_force
value|(1<< 1)
end_define

begin_comment
comment|/* Even before trailing punctuation. */
end_comment

begin_define
define|#
directive|define
name|MD_nonl
value|(1<< 2)
end_define

begin_comment
comment|/* Prevent linebreak in markdown code. */
end_comment

begin_define
define|#
directive|define
name|MD_nl
value|(1<< 3)
end_define

begin_comment
comment|/* Break markdown code line. */
end_comment

begin_define
define|#
directive|define
name|MD_br
value|(1<< 4)
end_define

begin_comment
comment|/* Insert an output line break. */
end_comment

begin_define
define|#
directive|define
name|MD_sp
value|(1<< 5)
end_define

begin_comment
comment|/* Insert a paragraph break. */
end_comment

begin_define
define|#
directive|define
name|MD_Sm
value|(1<< 6)
end_define

begin_comment
comment|/* Horizontal spacing mode. */
end_comment

begin_define
define|#
directive|define
name|MD_Bk
value|(1<< 7)
end_define

begin_comment
comment|/* Word keep mode. */
end_comment

begin_define
define|#
directive|define
name|MD_An_split
value|(1<< 8)
end_define

begin_comment
comment|/* Author mode is "split". */
end_comment

begin_define
define|#
directive|define
name|MD_An_nosplit
value|(1<< 9)
end_define

begin_comment
comment|/* Author mode is "nosplit". */
end_comment

begin_decl_stmt
specifier|static
name|int
name|escflags
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Escape in generated markdown code: */
end_comment

begin_define
define|#
directive|define
name|ESC_BOL
value|(1<< 0)
end_define

begin_comment
comment|/* "#*+-" near the beginning of a line. */
end_comment

begin_define
define|#
directive|define
name|ESC_NUM
value|(1<< 1)
end_define

begin_comment
comment|/* "." after a leading number. */
end_comment

begin_define
define|#
directive|define
name|ESC_HYP
value|(1<< 2)
end_define

begin_comment
comment|/* "(" immediately after "]". */
end_comment

begin_define
define|#
directive|define
name|ESC_SQU
value|(1<< 4)
end_define

begin_comment
comment|/* "]" when "[" is open. */
end_comment

begin_define
define|#
directive|define
name|ESC_FON
value|(1<< 5)
end_define

begin_comment
comment|/* "*" immediately after unrelated "*". */
end_comment

begin_define
define|#
directive|define
name|ESC_EOL
value|(1<< 6)
end_define

begin_comment
comment|/* " " at the and of a line. */
end_comment

begin_decl_stmt
specifier|static
name|int
name|code_blocks
decl_stmt|,
name|quote_blocks
decl_stmt|,
name|list_blocks
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|outcount
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|markdown_mdoc
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|,
specifier|const
name|struct
name|roff_man
modifier|*
name|mdoc
parameter_list|)
block|{
name|outflags
operator|=
name|MD_Sm
expr_stmt|;
name|md_word
argument_list|(
name|mdoc
operator|->
name|meta
operator|.
name|title
argument_list|)
expr_stmt|;
if|if
condition|(
name|mdoc
operator|->
name|meta
operator|.
name|msec
operator|!=
name|NULL
condition|)
block|{
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_word
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
name|md_word
argument_list|(
name|mdoc
operator|->
name|meta
operator|.
name|msec
argument_list|)
expr_stmt|;
name|md_word
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
block|}
name|md_word
argument_list|(
literal|"-"
argument_list|)
expr_stmt|;
name|md_word
argument_list|(
name|mdoc
operator|->
name|meta
operator|.
name|vol
argument_list|)
expr_stmt|;
if|if
condition|(
name|mdoc
operator|->
name|meta
operator|.
name|arch
operator|!=
name|NULL
condition|)
block|{
name|md_word
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
name|md_word
argument_list|(
name|mdoc
operator|->
name|meta
operator|.
name|arch
argument_list|)
expr_stmt|;
name|md_word
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
block|}
name|outflags
operator||=
name|MD_sp
expr_stmt|;
name|md_nodelist
argument_list|(
name|mdoc
operator|->
name|first
operator|->
name|child
argument_list|)
expr_stmt|;
name|outflags
operator||=
name|MD_sp
expr_stmt|;
name|md_word
argument_list|(
name|mdoc
operator|->
name|meta
operator|.
name|os
argument_list|)
expr_stmt|;
name|md_word
argument_list|(
literal|"-"
argument_list|)
expr_stmt|;
name|md_word
argument_list|(
name|mdoc
operator|->
name|meta
operator|.
name|date
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_nodelist
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
while|while
condition|(
name|n
operator|!=
name|NULL
condition|)
block|{
name|md_node
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|n
operator|=
name|n
operator|->
name|next
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|md_node
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
specifier|const
name|struct
name|md_act
modifier|*
name|act
decl_stmt|;
name|int
name|cond
decl_stmt|,
name|process_children
decl_stmt|;
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|NODE_NOPRT
condition|)
return|return;
if|if
condition|(
name|outflags
operator|&
name|MD_nonl
condition|)
name|outflags
operator|&=
operator|~
operator|(
name|MD_nl
operator||
name|MD_sp
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|outflags
operator|&
name|MD_spc
operator|&&
name|n
operator|->
name|flags
operator|&
name|NODE_LINE
condition|)
name|outflags
operator||=
name|MD_nl
expr_stmt|;
name|act
operator|=
name|NULL
expr_stmt|;
name|cond
operator|=
literal|0
expr_stmt|;
name|process_children
operator|=
literal|1
expr_stmt|;
name|n
operator|->
name|flags
operator|&=
operator|~
name|NODE_ENDED
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|type
operator|==
name|ROFFT_TEXT
condition|)
block|{
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|NODE_DELIMC
condition|)
name|outflags
operator|&=
operator|~
operator|(
name|MD_spc
operator||
name|MD_spc_force
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|outflags
operator|&
name|MD_Sm
condition|)
name|outflags
operator||=
name|MD_spc_force
expr_stmt|;
name|md_word
argument_list|(
name|n
operator|->
name|string
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|NODE_DELIMO
condition|)
name|outflags
operator|&=
operator|~
operator|(
name|MD_spc
operator||
name|MD_spc_force
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|outflags
operator|&
name|MD_Sm
condition|)
name|outflags
operator||=
name|MD_spc
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|n
operator|->
name|tok
operator|<
name|ROFF_MAX
condition|)
block|{
switch|switch
condition|(
name|n
operator|->
name|tok
condition|)
block|{
case|case
name|ROFF_br
case|:
name|process_children
operator|=
name|md_pre_br
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
case|case
name|ROFF_sp
case|:
name|process_children
operator|=
name|md_pre_Pp
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
default|default:
name|process_children
operator|=
literal|0
expr_stmt|;
break|break;
block|}
block|}
else|else
block|{
name|assert
argument_list|(
name|n
operator|->
name|tok
operator|>=
name|MDOC_Dd
operator|&&
name|n
operator|->
name|tok
operator|<
name|MDOC_MAX
argument_list|)
expr_stmt|;
name|act
operator|=
name|md_acts
operator|+
name|n
operator|->
name|tok
expr_stmt|;
name|cond
operator|=
name|act
operator|->
name|cond
operator|==
name|NULL
operator|||
call|(
modifier|*
name|act
operator|->
name|cond
call|)
argument_list|(
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|cond
operator|&&
name|act
operator|->
name|pre
operator|!=
name|NULL
operator|&&
operator|(
name|n
operator|->
name|end
operator|==
name|ENDBODY_NOT
operator|||
name|n
operator|->
name|child
operator|!=
name|NULL
operator|)
condition|)
name|process_children
operator|=
call|(
modifier|*
name|act
operator|->
name|pre
call|)
argument_list|(
name|n
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|process_children
operator|&&
name|n
operator|->
name|child
operator|!=
name|NULL
condition|)
name|md_nodelist
argument_list|(
name|n
operator|->
name|child
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|NODE_ENDED
condition|)
return|return;
if|if
condition|(
name|cond
operator|&&
name|act
operator|->
name|post
operator|!=
name|NULL
condition|)
call|(
modifier|*
name|act
operator|->
name|post
call|)
argument_list|(
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|end
operator|!=
name|ENDBODY_NOT
condition|)
name|n
operator|->
name|body
operator|->
name|flags
operator||=
name|NODE_ENDED
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|md_stack
parameter_list|(
name|char
name|c
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|stack
decl_stmt|;
specifier|static
name|size_t
name|sz
decl_stmt|;
specifier|static
name|size_t
name|cur
decl_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'\0'
case|:
break|break;
case|case
operator|(
name|char
operator|)
operator|-
literal|1
case|:
name|assert
argument_list|(
name|cur
argument_list|)
expr_stmt|;
name|stack
index|[
operator|--
name|cur
index|]
operator|=
literal|'\0'
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|cur
operator|+
literal|1
operator|>=
name|sz
condition|)
block|{
name|sz
operator|+=
literal|8
expr_stmt|;
name|stack
operator|=
name|mandoc_realloc
argument_list|(
name|stack
argument_list|,
name|sz
argument_list|)
expr_stmt|;
block|}
name|stack
index|[
name|cur
index|]
operator|=
name|c
expr_stmt|;
name|stack
index|[
operator|++
name|cur
index|]
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
return|return
name|stack
operator|==
name|NULL
condition|?
literal|""
else|:
name|stack
return|;
block|}
end_function

begin_comment
comment|/*  * Handle vertical and horizontal spacing.  */
end_comment

begin_function
specifier|static
name|void
name|md_preword
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|cp
decl_stmt|;
comment|/* 	 * If a list block is nested inside a code block or a blockquote, 	 * blank lines for paragraph breaks no longer work; instead, 	 * they terminate the list.  Work around this markdown issue 	 * by using mere line breaks instead. 	 */
if|if
condition|(
name|list_blocks
operator|&&
name|outflags
operator|&
name|MD_sp
condition|)
block|{
name|outflags
operator|&=
operator|~
name|MD_sp
expr_stmt|;
name|outflags
operator||=
name|MD_br
expr_stmt|;
block|}
comment|/* 	 * End the old line if requested. 	 * Escape whitespace at the end of the markdown line 	 * such that it won't look like an output line break. 	 */
if|if
condition|(
name|outflags
operator|&
name|MD_sp
condition|)
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|outflags
operator|&
name|MD_br
condition|)
block|{
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|outflags
operator|&
name|MD_nl
operator|&&
name|escflags
operator|&
name|ESC_EOL
condition|)
name|md_named
argument_list|(
literal|"zwnj"
argument_list|)
expr_stmt|;
comment|/* Start a new line if necessary. */
if|if
condition|(
name|outflags
operator|&
operator|(
name|MD_nl
operator||
name|MD_br
operator||
name|MD_sp
operator|)
condition|)
block|{
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
for|for
control|(
name|cp
operator|=
name|md_stack
argument_list|(
literal|'\0'
argument_list|)
init|;
operator|*
name|cp
operator|!=
literal|'\0'
condition|;
name|cp
operator|++
control|)
block|{
name|putchar
argument_list|(
operator|*
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|cp
operator|==
literal|'>'
condition|)
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
block|}
name|outflags
operator|&=
operator|~
operator|(
name|MD_nl
operator||
name|MD_br
operator||
name|MD_sp
operator|)
expr_stmt|;
name|escflags
operator|=
name|ESC_BOL
expr_stmt|;
name|outcount
operator|=
literal|0
expr_stmt|;
comment|/* Handle horizontal spacing. */
block|}
elseif|else
if|if
condition|(
name|outflags
operator|&
name|MD_spc
condition|)
block|{
if|if
condition|(
name|outflags
operator|&
name|MD_Bk
condition|)
name|fputs
argument_list|(
literal|"&nbsp;"
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
else|else
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|escflags
operator|&=
operator|~
name|ESC_FON
expr_stmt|;
name|outcount
operator|++
expr_stmt|;
block|}
name|outflags
operator|&=
operator|~
operator|(
name|MD_spc_force
operator||
name|MD_nonl
operator|)
expr_stmt|;
if|if
condition|(
name|outflags
operator|&
name|MD_Sm
condition|)
name|outflags
operator||=
name|MD_spc
expr_stmt|;
else|else
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print markdown syntax elements.  * Can also be used for constant strings when neither escaping  * nor delimiter handling is required.  */
end_comment

begin_function
specifier|static
name|void
name|md_rawword
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|)
block|{
name|md_preword
argument_list|()
expr_stmt|;
if|if
condition|(
operator|*
name|s
operator|==
literal|'\0'
condition|)
return|return;
if|if
condition|(
name|escflags
operator|&
name|ESC_FON
condition|)
block|{
name|escflags
operator|&=
operator|~
name|ESC_FON
expr_stmt|;
if|if
condition|(
operator|*
name|s
operator|==
literal|'*'
operator|&&
operator|!
name|code_blocks
condition|)
name|fputs
argument_list|(
literal|"&zwnj;"
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
operator|*
name|s
operator|!=
literal|'\0'
condition|)
block|{
switch|switch
condition|(
operator|*
name|s
condition|)
block|{
case|case
literal|'*'
case|:
if|if
condition|(
name|s
index|[
literal|1
index|]
operator|==
literal|'\0'
condition|)
name|escflags
operator||=
name|ESC_FON
expr_stmt|;
break|break;
case|case
literal|'['
case|:
name|escflags
operator||=
name|ESC_SQU
expr_stmt|;
break|break;
case|case
literal|']'
case|:
name|escflags
operator||=
name|ESC_HYP
expr_stmt|;
name|escflags
operator|&=
operator|~
name|ESC_SQU
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|md_char
argument_list|(
operator|*
name|s
operator|++
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|s
index|[
operator|-
literal|1
index|]
operator|==
literal|' '
condition|)
name|escflags
operator||=
name|ESC_EOL
expr_stmt|;
else|else
name|escflags
operator|&=
operator|~
name|ESC_EOL
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print text and mdoc(7) syntax elements.  */
end_comment

begin_function
specifier|static
name|void
name|md_word
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|seq
decl_stmt|,
modifier|*
name|prevfont
decl_stmt|,
modifier|*
name|currfont
decl_stmt|,
modifier|*
name|nextfont
decl_stmt|;
name|char
name|c
decl_stmt|;
name|int
name|bs
decl_stmt|,
name|sz
decl_stmt|,
name|uc
decl_stmt|,
name|breakline
decl_stmt|;
comment|/* No spacing before closing delimiters. */
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|!=
literal|'\0'
operator|&&
name|s
index|[
literal|1
index|]
operator|==
literal|'\0'
operator|&&
name|strchr
argument_list|(
literal|"!),.:;?]"
argument_list|,
name|s
index|[
literal|0
index|]
argument_list|)
operator|!=
name|NULL
operator|&&
operator|(
name|outflags
operator|&
name|MD_spc_force
operator|)
operator|==
literal|0
condition|)
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_preword
argument_list|()
expr_stmt|;
if|if
condition|(
operator|*
name|s
operator|==
literal|'\0'
condition|)
return|return;
comment|/* No spacing after opening delimiters. */
if|if
condition|(
operator|(
name|s
index|[
literal|0
index|]
operator|==
literal|'('
operator|||
name|s
index|[
literal|0
index|]
operator|==
literal|'['
operator|)
operator|&&
name|s
index|[
literal|1
index|]
operator|==
literal|'\0'
condition|)
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|breakline
operator|=
literal|0
expr_stmt|;
name|prevfont
operator|=
name|currfont
operator|=
literal|""
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
operator|*
name|s
operator|++
operator|)
operator|!=
literal|'\0'
condition|)
block|{
name|bs
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
name|ASCII_NBRSP
case|:
if|if
condition|(
name|code_blocks
condition|)
name|c
operator|=
literal|' '
expr_stmt|;
else|else
block|{
name|md_named
argument_list|(
literal|"nbsp"
argument_list|)
expr_stmt|;
name|c
operator|=
literal|'\0'
expr_stmt|;
block|}
break|break;
case|case
name|ASCII_HYPH
case|:
name|bs
operator|=
name|escflags
operator|&
name|ESC_BOL
operator|&&
operator|!
name|code_blocks
expr_stmt|;
name|c
operator|=
literal|'-'
expr_stmt|;
break|break;
case|case
name|ASCII_BREAK
case|:
continue|continue;
case|case
literal|'#'
case|:
case|case
literal|'+'
case|:
case|case
literal|'-'
case|:
name|bs
operator|=
name|escflags
operator|&
name|ESC_BOL
operator|&&
operator|!
name|code_blocks
expr_stmt|;
break|break;
case|case
literal|'('
case|:
name|bs
operator|=
name|escflags
operator|&
name|ESC_HYP
operator|&&
operator|!
name|code_blocks
expr_stmt|;
break|break;
case|case
literal|')'
case|:
name|bs
operator|=
name|escflags
operator|&
name|ESC_NUM
operator|&&
operator|!
name|code_blocks
expr_stmt|;
break|break;
case|case
literal|'*'
case|:
case|case
literal|'['
case|:
case|case
literal|'_'
case|:
case|case
literal|'`'
case|:
name|bs
operator|=
operator|!
name|code_blocks
expr_stmt|;
break|break;
case|case
literal|'.'
case|:
name|bs
operator|=
name|escflags
operator|&
name|ESC_NUM
operator|&&
operator|!
name|code_blocks
expr_stmt|;
break|break;
case|case
literal|'<'
case|:
if|if
condition|(
name|code_blocks
operator|==
literal|0
condition|)
block|{
name|md_named
argument_list|(
literal|"lt"
argument_list|)
expr_stmt|;
name|c
operator|=
literal|'\0'
expr_stmt|;
block|}
break|break;
case|case
literal|'='
case|:
if|if
condition|(
name|escflags
operator|&
name|ESC_BOL
operator|&&
operator|!
name|code_blocks
condition|)
block|{
name|md_named
argument_list|(
literal|"equals"
argument_list|)
expr_stmt|;
name|c
operator|=
literal|'\0'
expr_stmt|;
block|}
break|break;
case|case
literal|'>'
case|:
if|if
condition|(
name|code_blocks
operator|==
literal|0
condition|)
block|{
name|md_named
argument_list|(
literal|"gt"
argument_list|)
expr_stmt|;
name|c
operator|=
literal|'\0'
expr_stmt|;
block|}
break|break;
case|case
literal|'\\'
case|:
name|uc
operator|=
literal|0
expr_stmt|;
name|nextfont
operator|=
name|NULL
expr_stmt|;
switch|switch
condition|(
name|mandoc_escape
argument_list|(
operator|&
name|s
argument_list|,
operator|&
name|seq
argument_list|,
operator|&
name|sz
argument_list|)
condition|)
block|{
case|case
name|ESCAPE_UNICODE
case|:
name|uc
operator|=
name|mchars_num2uc
argument_list|(
name|seq
operator|+
literal|1
argument_list|,
name|sz
operator|-
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|ESCAPE_NUMBERED
case|:
name|uc
operator|=
name|mchars_num2char
argument_list|(
name|seq
argument_list|,
name|sz
argument_list|)
expr_stmt|;
break|break;
case|case
name|ESCAPE_SPECIAL
case|:
name|uc
operator|=
name|mchars_spec2cp
argument_list|(
name|seq
argument_list|,
name|sz
argument_list|)
expr_stmt|;
break|break;
case|case
name|ESCAPE_FONTBOLD
case|:
name|nextfont
operator|=
literal|"**"
expr_stmt|;
break|break;
case|case
name|ESCAPE_FONTITALIC
case|:
name|nextfont
operator|=
literal|"*"
expr_stmt|;
break|break;
case|case
name|ESCAPE_FONTBI
case|:
name|nextfont
operator|=
literal|"***"
expr_stmt|;
break|break;
case|case
name|ESCAPE_FONT
case|:
case|case
name|ESCAPE_FONTROMAN
case|:
name|nextfont
operator|=
literal|""
expr_stmt|;
break|break;
case|case
name|ESCAPE_FONTPREV
case|:
name|nextfont
operator|=
name|prevfont
expr_stmt|;
break|break;
case|case
name|ESCAPE_BREAK
case|:
name|breakline
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|ESCAPE_NOSPACE
case|:
case|case
name|ESCAPE_SKIPCHAR
case|:
case|case
name|ESCAPE_OVERSTRIKE
case|:
comment|/* XXX not implemented */
comment|/* FALLTHROUGH */
case|case
name|ESCAPE_ERROR
case|:
default|default:
break|break;
block|}
if|if
condition|(
name|nextfont
operator|!=
name|NULL
operator|&&
operator|!
name|code_blocks
condition|)
block|{
if|if
condition|(
operator|*
name|currfont
operator|!=
literal|'\0'
condition|)
block|{
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_rawword
argument_list|(
name|currfont
argument_list|)
expr_stmt|;
block|}
name|prevfont
operator|=
name|currfont
expr_stmt|;
name|currfont
operator|=
name|nextfont
expr_stmt|;
if|if
condition|(
operator|*
name|currfont
operator|!=
literal|'\0'
condition|)
block|{
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_rawword
argument_list|(
name|currfont
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|uc
condition|)
block|{
if|if
condition|(
operator|(
name|uc
operator|<
literal|0x20
operator|&&
name|uc
operator|!=
literal|0x09
operator|)
operator|||
operator|(
name|uc
operator|>
literal|0x7E
operator|&&
name|uc
operator|<
literal|0xA0
operator|)
condition|)
name|uc
operator|=
literal|0xFFFD
expr_stmt|;
if|if
condition|(
name|code_blocks
condition|)
block|{
name|seq
operator|=
name|mchars_uc2str
argument_list|(
name|uc
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
name|seq
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|outcount
operator|+=
name|strlen
argument_list|(
name|seq
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"&#%d;"
argument_list|,
name|uc
argument_list|)
expr_stmt|;
name|outcount
operator|++
expr_stmt|;
block|}
name|escflags
operator|&=
operator|~
name|ESC_FON
expr_stmt|;
block|}
name|c
operator|=
literal|'\0'
expr_stmt|;
break|break;
case|case
literal|']'
case|:
name|bs
operator|=
name|escflags
operator|&
name|ESC_SQU
operator|&&
operator|!
name|code_blocks
expr_stmt|;
name|escflags
operator||=
name|ESC_HYP
expr_stmt|;
break|break;
default|default:
break|break;
block|}
if|if
condition|(
name|bs
condition|)
name|putchar
argument_list|(
literal|'\\'
argument_list|)
expr_stmt|;
name|md_char
argument_list|(
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|breakline
operator|&&
operator|(
operator|*
name|s
operator|==
literal|'\0'
operator|||
operator|*
name|s
operator|==
literal|' '
operator|||
operator|*
name|s
operator|==
name|ASCII_NBRSP
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"  \n"
argument_list|)
expr_stmt|;
name|breakline
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|s
operator|==
literal|' '
operator|||
operator|*
name|s
operator|==
name|ASCII_NBRSP
condition|)
name|s
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|*
name|currfont
operator|!=
literal|'\0'
condition|)
block|{
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_rawword
argument_list|(
name|currfont
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|s
index|[
operator|-
literal|2
index|]
operator|==
literal|' '
condition|)
name|escflags
operator||=
name|ESC_EOL
expr_stmt|;
else|else
name|escflags
operator|&=
operator|~
name|ESC_EOL
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a single HTML named character reference.  */
end_comment

begin_function
specifier|static
name|void
name|md_named
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|)
block|{
name|printf
argument_list|(
literal|"&%s;"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|escflags
operator|&=
operator|~
operator|(
name|ESC_FON
operator||
name|ESC_EOL
operator|)
expr_stmt|;
name|outcount
operator|++
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a single raw character and maintain certain escape flags.  */
end_comment

begin_function
specifier|static
name|void
name|md_char
parameter_list|(
name|unsigned
name|char
name|c
parameter_list|)
block|{
if|if
condition|(
name|c
operator|!=
literal|'\0'
condition|)
block|{
name|putchar
argument_list|(
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'*'
condition|)
name|escflags
operator||=
name|ESC_FON
expr_stmt|;
else|else
name|escflags
operator|&=
operator|~
name|ESC_FON
expr_stmt|;
name|outcount
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|c
operator|!=
literal|']'
condition|)
name|escflags
operator|&=
operator|~
name|ESC_HYP
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|' '
operator|||
name|c
operator|==
literal|'\t'
operator|||
name|c
operator|==
literal|'>'
condition|)
return|return;
if|if
condition|(
name|isdigit
argument_list|(
name|c
argument_list|)
operator|==
literal|0
condition|)
name|escflags
operator|&=
operator|~
name|ESC_NUM
expr_stmt|;
elseif|else
if|if
condition|(
name|escflags
operator|&
name|ESC_BOL
condition|)
name|escflags
operator||=
name|ESC_NUM
expr_stmt|;
name|escflags
operator|&=
operator|~
name|ESC_BOL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_cond_head
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
return|return
name|n
operator|->
name|type
operator|==
name|ROFFT_HEAD
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_cond_body
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
return|return
name|n
operator|->
name|type
operator|==
name|ROFFT_BODY
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_raw
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|prefix
decl_stmt|;
if|if
condition|(
operator|(
name|prefix
operator|=
name|md_acts
index|[
name|n
operator|->
name|tok
index|]
operator|.
name|prefix
operator|)
operator|!=
name|NULL
condition|)
block|{
name|md_rawword
argument_list|(
name|prefix
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
if|if
condition|(
operator|*
name|prefix
operator|==
literal|'`'
condition|)
name|code_blocks
operator|++
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_raw
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|suffix
decl_stmt|;
if|if
condition|(
operator|(
name|suffix
operator|=
name|md_acts
index|[
name|n
operator|->
name|tok
index|]
operator|.
name|suffix
operator|)
operator|!=
name|NULL
condition|)
block|{
name|outflags
operator|&=
operator|~
operator|(
name|MD_spc
operator||
name|MD_nl
operator|)
expr_stmt|;
name|md_rawword
argument_list|(
name|suffix
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|suffix
operator|==
literal|'`'
condition|)
name|code_blocks
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_word
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|prefix
decl_stmt|;
if|if
condition|(
operator|(
name|prefix
operator|=
name|md_acts
index|[
name|n
operator|->
name|tok
index|]
operator|.
name|prefix
operator|)
operator|!=
name|NULL
condition|)
block|{
name|md_word
argument_list|(
name|prefix
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_word
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|suffix
decl_stmt|;
if|if
condition|(
operator|(
name|suffix
operator|=
name|md_acts
index|[
name|n
operator|->
name|tok
index|]
operator|.
name|suffix
operator|)
operator|!=
name|NULL
condition|)
block|{
name|outflags
operator|&=
operator|~
operator|(
name|MD_spc
operator||
name|MD_nl
operator|)
expr_stmt|;
name|md_word
argument_list|(
name|suffix
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_pc
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|md_post_raw
argument_list|(
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|parent
operator|->
name|tok
operator|!=
name|MDOC_Rs
condition|)
return|return;
if|if
condition|(
name|n
operator|->
name|next
operator|!=
name|NULL
condition|)
block|{
name|md_word
argument_list|(
literal|","
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|prev
operator|!=
name|NULL
operator|&&
name|n
operator|->
name|prev
operator|->
name|tok
operator|==
name|n
operator|->
name|tok
operator|&&
name|n
operator|->
name|next
operator|->
name|tok
operator|==
name|n
operator|->
name|tok
condition|)
name|md_word
argument_list|(
literal|"and"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|md_word
argument_list|(
literal|"."
argument_list|)
expr_stmt|;
name|outflags
operator||=
name|MD_nl
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_skip
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_pre_syn
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|prev
operator|==
name|NULL
operator|||
operator|!
operator|(
name|n
operator|->
name|flags
operator|&
name|NODE_SYNPRETTY
operator|)
condition|)
return|return;
if|if
condition|(
name|n
operator|->
name|prev
operator|->
name|tok
operator|==
name|n
operator|->
name|tok
operator|&&
name|n
operator|->
name|tok
operator|!=
name|MDOC_Ft
operator|&&
name|n
operator|->
name|tok
operator|!=
name|MDOC_Fo
operator|&&
name|n
operator|->
name|tok
operator|!=
name|MDOC_Fn
condition|)
block|{
name|outflags
operator||=
name|MD_br
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|n
operator|->
name|prev
operator|->
name|tok
condition|)
block|{
case|case
name|MDOC_Fd
case|:
case|case
name|MDOC_Fn
case|:
case|case
name|MDOC_Fo
case|:
case|case
name|MDOC_In
case|:
case|case
name|MDOC_Vt
case|:
name|outflags
operator||=
name|MD_sp
expr_stmt|;
break|break;
case|case
name|MDOC_Ft
case|:
if|if
condition|(
name|n
operator|->
name|tok
operator|!=
name|MDOC_Fn
operator|&&
name|n
operator|->
name|tok
operator|!=
name|MDOC_Fo
condition|)
block|{
name|outflags
operator||=
name|MD_sp
expr_stmt|;
break|break;
block|}
comment|/* FALLTHROUGH */
default|default:
name|outflags
operator||=
name|MD_br
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_An
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
switch|switch
condition|(
name|n
operator|->
name|norm
operator|->
name|An
operator|.
name|auth
condition|)
block|{
case|case
name|AUTH_split
case|:
name|outflags
operator|&=
operator|~
name|MD_An_nosplit
expr_stmt|;
name|outflags
operator||=
name|MD_An_split
expr_stmt|;
return|return
literal|0
return|;
case|case
name|AUTH_nosplit
case|:
name|outflags
operator|&=
operator|~
name|MD_An_split
expr_stmt|;
name|outflags
operator||=
name|MD_An_nosplit
expr_stmt|;
return|return
literal|0
return|;
default|default:
if|if
condition|(
name|outflags
operator|&
name|MD_An_split
condition|)
name|outflags
operator||=
name|MD_br
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|sec
operator|==
name|SEC_AUTHORS
operator|&&
operator|!
operator|(
name|outflags
operator|&
name|MD_An_nosplit
operator|)
condition|)
name|outflags
operator||=
name|MD_An_split
expr_stmt|;
return|return
literal|1
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Ap
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_word
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Bd
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
switch|switch
condition|(
name|n
operator|->
name|norm
operator|->
name|Bd
operator|.
name|type
condition|)
block|{
case|case
name|DISP_unfilled
case|:
case|case
name|DISP_literal
case|:
return|return
name|md_pre_Dl
argument_list|(
name|n
argument_list|)
return|;
default|default:
return|return
name|md_pre_D1
argument_list|(
name|n
argument_list|)
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Bk
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
switch|switch
condition|(
name|n
operator|->
name|type
condition|)
block|{
case|case
name|ROFFT_BLOCK
case|:
return|return
literal|1
return|;
case|case
name|ROFFT_BODY
case|:
name|outflags
operator||=
name|MD_Bk
expr_stmt|;
return|return
literal|1
return|;
default|default:
return|return
literal|0
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Bk
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|type
operator|==
name|ROFFT_BODY
condition|)
name|outflags
operator|&=
operator|~
name|MD_Bk
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Bl
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|n
operator|->
name|norm
operator|->
name|Bl
operator|.
name|count
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|norm
operator|->
name|Bl
operator|.
name|type
operator|==
name|LIST_column
condition|)
name|md_pre_Dl
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|outflags
operator||=
name|MD_sp
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Bl
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|n
operator|->
name|norm
operator|->
name|Bl
operator|.
name|count
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|norm
operator|->
name|Bl
operator|.
name|type
operator|==
name|LIST_column
condition|)
name|md_post_D1
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|outflags
operator||=
name|MD_sp
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_D1
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
comment|/* 	 * Markdown blockquote syntax does not work inside code blocks. 	 * The best we can do is fall back to another nested code block. 	 */
if|if
condition|(
name|code_blocks
condition|)
block|{
name|md_stack
argument_list|(
literal|'\t'
argument_list|)
expr_stmt|;
name|code_blocks
operator|++
expr_stmt|;
block|}
else|else
block|{
name|md_stack
argument_list|(
literal|'>'
argument_list|)
expr_stmt|;
name|quote_blocks
operator|++
expr_stmt|;
block|}
name|outflags
operator||=
name|MD_sp
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_D1
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|md_stack
argument_list|(
operator|(
name|char
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|code_blocks
condition|)
name|code_blocks
operator|--
expr_stmt|;
else|else
name|quote_blocks
operator|--
expr_stmt|;
name|outflags
operator||=
name|MD_sp
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Dl
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
comment|/* 	 * Markdown code block syntax does not work inside blockquotes. 	 * The best we can do is fall back to another nested blockquote. 	 */
if|if
condition|(
name|quote_blocks
condition|)
block|{
name|md_stack
argument_list|(
literal|'>'
argument_list|)
expr_stmt|;
name|quote_blocks
operator|++
expr_stmt|;
block|}
else|else
block|{
name|md_stack
argument_list|(
literal|'\t'
argument_list|)
expr_stmt|;
name|code_blocks
operator|++
expr_stmt|;
block|}
name|outflags
operator||=
name|MD_sp
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_En
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|norm
operator|->
name|Es
operator|==
name|NULL
operator|||
name|n
operator|->
name|norm
operator|->
name|Es
operator|->
name|child
operator|==
name|NULL
condition|)
return|return
literal|1
return|;
name|md_word
argument_list|(
name|n
operator|->
name|norm
operator|->
name|Es
operator|->
name|child
operator|->
name|string
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_En
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|norm
operator|->
name|Es
operator|==
name|NULL
operator|||
name|n
operator|->
name|norm
operator|->
name|Es
operator|->
name|child
operator|==
name|NULL
operator|||
name|n
operator|->
name|norm
operator|->
name|Es
operator|->
name|child
operator|->
name|next
operator|==
name|NULL
condition|)
return|return;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_word
argument_list|(
name|n
operator|->
name|norm
operator|->
name|Es
operator|->
name|child
operator|->
name|next
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Eo
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|end
operator|==
name|ENDBODY_NOT
operator|&&
name|n
operator|->
name|parent
operator|->
name|head
operator|->
name|child
operator|==
name|NULL
operator|&&
name|n
operator|->
name|child
operator|!=
name|NULL
operator|&&
name|n
operator|->
name|child
operator|->
name|end
operator|!=
name|ENDBODY_NOT
condition|)
name|md_preword
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|end
operator|!=
name|ENDBODY_NOT
condition|?
name|n
operator|->
name|child
operator|!=
name|NULL
else|:
name|n
operator|->
name|parent
operator|->
name|head
operator|->
name|child
operator|!=
name|NULL
operator|&&
operator|(
name|n
operator|->
name|child
operator|!=
name|NULL
operator|||
operator|(
name|n
operator|->
name|parent
operator|->
name|tail
operator|!=
name|NULL
operator|&&
name|n
operator|->
name|parent
operator|->
name|tail
operator|->
name|child
operator|!=
name|NULL
operator|)
operator|)
condition|)
name|outflags
operator|&=
operator|~
operator|(
name|MD_spc
operator||
name|MD_nl
operator|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Eo
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|end
operator|!=
name|ENDBODY_NOT
condition|)
block|{
name|outflags
operator||=
name|MD_spc
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|n
operator|->
name|child
operator|==
name|NULL
operator|&&
name|n
operator|->
name|parent
operator|->
name|head
operator|->
name|child
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|n
operator|->
name|parent
operator|->
name|tail
operator|!=
name|NULL
operator|&&
name|n
operator|->
name|parent
operator|->
name|tail
operator|->
name|child
operator|!=
name|NULL
condition|)
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
else|else
name|outflags
operator||=
name|MD_spc
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Fa
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|int
name|am_Fa
decl_stmt|;
name|am_Fa
operator|=
name|n
operator|->
name|tok
operator|==
name|MDOC_Fa
expr_stmt|;
if|if
condition|(
name|am_Fa
condition|)
name|n
operator|=
name|n
operator|->
name|child
expr_stmt|;
while|while
condition|(
name|n
operator|!=
name|NULL
condition|)
block|{
name|md_rawword
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_node
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_rawword
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|n
operator|=
name|n
operator|->
name|next
operator|)
operator|!=
name|NULL
condition|)
name|md_word
argument_list|(
literal|","
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Fa
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|next
operator|!=
name|NULL
operator|&&
name|n
operator|->
name|next
operator|->
name|tok
operator|==
name|MDOC_Fa
condition|)
name|md_word
argument_list|(
literal|","
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Fd
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|md_pre_syn
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|md_pre_raw
argument_list|(
name|n
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Fd
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|md_post_raw
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|outflags
operator||=
name|MD_br
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Fl
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|md_post_raw
argument_list|(
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|child
operator|==
name|NULL
operator|&&
name|n
operator|->
name|next
operator|!=
name|NULL
operator|&&
name|n
operator|->
name|next
operator|->
name|type
operator|!=
name|ROFFT_TEXT
operator|&&
operator|!
operator|(
name|n
operator|->
name|next
operator|->
name|flags
operator|&
name|NODE_LINE
operator|)
condition|)
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Fn
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|md_pre_syn
argument_list|(
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|n
operator|=
name|n
operator|->
name|child
operator|)
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
name|md_rawword
argument_list|(
literal|"**"
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_node
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_rawword
argument_list|(
literal|"**"
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_word
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|n
operator|=
name|n
operator|->
name|next
operator|)
operator|!=
name|NULL
condition|)
name|md_pre_Fa
argument_list|(
name|n
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Fn
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|md_word
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|NODE_SYNPRETTY
condition|)
block|{
name|md_word
argument_list|(
literal|";"
argument_list|)
expr_stmt|;
name|outflags
operator||=
name|MD_sp
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Fo
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
switch|switch
condition|(
name|n
operator|->
name|type
condition|)
block|{
case|case
name|ROFFT_BLOCK
case|:
name|md_pre_syn
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
case|case
name|ROFFT_HEAD
case|:
if|if
condition|(
name|n
operator|->
name|child
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
name|md_pre_raw
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
case|case
name|ROFFT_BODY
case|:
name|outflags
operator|&=
operator|~
operator|(
name|MD_spc
operator||
name|MD_nl
operator|)
expr_stmt|;
name|md_word
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Fo
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
switch|switch
condition|(
name|n
operator|->
name|type
condition|)
block|{
case|case
name|ROFFT_HEAD
case|:
if|if
condition|(
name|n
operator|->
name|child
operator|!=
name|NULL
condition|)
name|md_post_raw
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
case|case
name|ROFFT_BODY
case|:
name|md_post_Fn
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_In
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|NODE_SYNPRETTY
condition|)
block|{
name|md_pre_syn
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|md_rawword
argument_list|(
literal|"**"
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_word
argument_list|(
literal|"#include<"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|md_word
argument_list|(
literal|"<"
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_rawword
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
block|}
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_In
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|flags
operator|&
name|NODE_SYNPRETTY
condition|)
block|{
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_rawword
argument_list|(
literal|">**"
argument_list|)
expr_stmt|;
name|outflags
operator||=
name|MD_nl
expr_stmt|;
block|}
else|else
block|{
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_rawword
argument_list|(
literal|"*>"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_It
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|struct
name|roff_node
modifier|*
name|bln
decl_stmt|;
switch|switch
condition|(
name|n
operator|->
name|type
condition|)
block|{
case|case
name|ROFFT_BLOCK
case|:
return|return
literal|1
return|;
case|case
name|ROFFT_HEAD
case|:
name|bln
operator|=
name|n
operator|->
name|parent
operator|->
name|parent
expr_stmt|;
if|if
condition|(
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|comp
operator|==
literal|0
operator|&&
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|type
operator|!=
name|LIST_column
condition|)
name|outflags
operator||=
name|MD_sp
expr_stmt|;
name|outflags
operator||=
name|MD_nl
expr_stmt|;
switch|switch
condition|(
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|type
condition|)
block|{
case|case
name|LIST_item
case|:
name|outflags
operator||=
name|MD_br
expr_stmt|;
return|return
literal|0
return|;
case|case
name|LIST_inset
case|:
case|case
name|LIST_diag
case|:
case|case
name|LIST_ohang
case|:
name|outflags
operator||=
name|MD_br
expr_stmt|;
return|return
literal|1
return|;
case|case
name|LIST_tag
case|:
case|case
name|LIST_hang
case|:
name|outflags
operator||=
name|MD_sp
expr_stmt|;
return|return
literal|1
return|;
case|case
name|LIST_bullet
case|:
name|md_rawword
argument_list|(
literal|"*\t"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LIST_dash
case|:
case|case
name|LIST_hyphen
case|:
name|md_rawword
argument_list|(
literal|"-\t"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LIST_enum
case|:
name|md_preword
argument_list|()
expr_stmt|;
if|if
condition|(
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|count
operator|<
literal|99
condition|)
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|count
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"%d.\t"
argument_list|,
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|count
argument_list|)
expr_stmt|;
name|escflags
operator|&=
operator|~
name|ESC_FON
expr_stmt|;
break|break;
case|case
name|LIST_column
case|:
name|outflags
operator||=
name|MD_br
expr_stmt|;
return|return
literal|0
return|;
default|default:
return|return
literal|0
return|;
block|}
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|outflags
operator||=
name|MD_nonl
expr_stmt|;
name|outcount
operator|=
literal|0
expr_stmt|;
name|md_stack
argument_list|(
literal|'\t'
argument_list|)
expr_stmt|;
if|if
condition|(
name|code_blocks
operator|||
name|quote_blocks
condition|)
name|list_blocks
operator|++
expr_stmt|;
return|return
literal|0
return|;
case|case
name|ROFFT_BODY
case|:
name|bln
operator|=
name|n
operator|->
name|parent
operator|->
name|parent
expr_stmt|;
switch|switch
condition|(
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|type
condition|)
block|{
case|case
name|LIST_ohang
case|:
name|outflags
operator||=
name|MD_br
expr_stmt|;
break|break;
case|case
name|LIST_tag
case|:
case|case
name|LIST_hang
case|:
name|md_pre_D1
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
literal|1
return|;
default|default:
return|return
literal|0
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_It
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|struct
name|roff_node
modifier|*
name|bln
decl_stmt|;
name|int
name|i
decl_stmt|,
name|nc
decl_stmt|;
if|if
condition|(
name|n
operator|->
name|type
operator|!=
name|ROFFT_BODY
condition|)
return|return;
name|bln
operator|=
name|n
operator|->
name|parent
operator|->
name|parent
expr_stmt|;
switch|switch
condition|(
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|type
condition|)
block|{
case|case
name|LIST_bullet
case|:
case|case
name|LIST_dash
case|:
case|case
name|LIST_hyphen
case|:
case|case
name|LIST_enum
case|:
name|md_stack
argument_list|(
operator|(
name|char
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|code_blocks
operator|||
name|quote_blocks
condition|)
name|list_blocks
operator|--
expr_stmt|;
break|break;
case|case
name|LIST_tag
case|:
case|case
name|LIST_hang
case|:
name|md_post_D1
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
case|case
name|LIST_column
case|:
if|if
condition|(
name|n
operator|->
name|next
operator|==
name|NULL
condition|)
break|break;
comment|/* Calculate the array index of the current column. */
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|n
operator|=
name|n
operator|->
name|prev
operator|)
operator|!=
name|NULL
operator|&&
name|n
operator|->
name|type
operator|!=
name|ROFFT_HEAD
condition|)
name|i
operator|++
expr_stmt|;
comment|/*  		 * If a width was specified for this column, 		 * subtract what printed, and 		 * add the same spacing as in mdoc_term.c. 		 */
name|nc
operator|=
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|ncols
expr_stmt|;
name|i
operator|=
name|i
operator|<
name|nc
condition|?
name|strlen
argument_list|(
name|bln
operator|->
name|norm
operator|->
name|Bl
operator|.
name|cols
index|[
name|i
index|]
argument_list|)
operator|-
name|outcount
operator|+
operator|(
name|nc
operator|<
literal|5
condition|?
literal|4
else|:
name|nc
operator|==
literal|5
condition|?
literal|3
else|:
literal|1
operator|)
else|:
literal|1
expr_stmt|;
if|if
condition|(
name|i
operator|<
literal|1
condition|)
name|i
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|i
operator|--
operator|>
literal|0
condition|)
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|escflags
operator|&=
operator|~
name|ESC_FON
expr_stmt|;
name|outcount
operator|=
literal|0
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Lb
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|sec
operator|==
name|SEC_LIBRARY
condition|)
name|outflags
operator||=
name|MD_br
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_uri
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|)
block|{
while|while
condition|(
operator|*
name|s
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
name|strchr
argument_list|(
literal|"%()<>"
argument_list|,
operator|*
name|s
argument_list|)
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"%%%2.2hhX"
argument_list|,
operator|*
name|s
argument_list|)
expr_stmt|;
name|outcount
operator|+=
literal|3
expr_stmt|;
block|}
else|else
block|{
name|putchar
argument_list|(
operator|*
name|s
argument_list|)
expr_stmt|;
name|outcount
operator|++
expr_stmt|;
block|}
name|s
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Lk
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
specifier|const
name|struct
name|roff_node
modifier|*
name|link
decl_stmt|,
modifier|*
name|descr
decl_stmt|,
modifier|*
name|punct
decl_stmt|;
if|if
condition|(
operator|(
name|link
operator|=
name|n
operator|->
name|child
operator|)
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
comment|/* Find beginning of trailing punctuation. */
name|punct
operator|=
name|n
operator|->
name|last
expr_stmt|;
while|while
condition|(
name|punct
operator|!=
name|link
operator|&&
name|punct
operator|->
name|flags
operator|&
name|NODE_DELIMC
condition|)
name|punct
operator|=
name|punct
operator|->
name|prev
expr_stmt|;
name|punct
operator|=
name|punct
operator|->
name|next
expr_stmt|;
comment|/* Link text. */
name|descr
operator|=
name|link
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|descr
operator|==
name|punct
condition|)
name|descr
operator|=
name|link
expr_stmt|;
comment|/* no text */
name|md_rawword
argument_list|(
literal|"["
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
do|do
block|{
name|md_word
argument_list|(
name|descr
operator|->
name|string
argument_list|)
expr_stmt|;
name|descr
operator|=
name|descr
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|descr
operator|!=
name|punct
condition|)
do|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
comment|/* Link target. */
name|md_rawword
argument_list|(
literal|"]("
argument_list|)
expr_stmt|;
name|md_uri
argument_list|(
name|link
operator|->
name|string
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_rawword
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
comment|/* Trailing punctuation. */
while|while
condition|(
name|punct
operator|!=
name|NULL
condition|)
block|{
name|md_word
argument_list|(
name|punct
operator|->
name|string
argument_list|)
expr_stmt|;
name|punct
operator|=
name|punct
operator|->
name|next
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Mt
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
specifier|const
name|struct
name|roff_node
modifier|*
name|nch
decl_stmt|;
name|md_rawword
argument_list|(
literal|"["
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
for|for
control|(
name|nch
operator|=
name|n
operator|->
name|child
init|;
name|nch
operator|!=
name|NULL
condition|;
name|nch
operator|=
name|nch
operator|->
name|next
control|)
name|md_word
argument_list|(
name|nch
operator|->
name|string
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_rawword
argument_list|(
literal|"](mailto:"
argument_list|)
expr_stmt|;
for|for
control|(
name|nch
operator|=
name|n
operator|->
name|child
init|;
name|nch
operator|!=
name|NULL
condition|;
name|nch
operator|=
name|nch
operator|->
name|next
control|)
block|{
name|md_uri
argument_list|(
name|nch
operator|->
name|string
argument_list|)
expr_stmt|;
if|if
condition|(
name|nch
operator|->
name|next
operator|!=
name|NULL
condition|)
block|{
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|outcount
operator|++
expr_stmt|;
block|}
block|}
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_rawword
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Nd
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|outflags
operator|&=
operator|~
name|MD_nl
expr_stmt|;
name|outflags
operator||=
name|MD_spc
expr_stmt|;
name|md_word
argument_list|(
literal|"-"
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Nm
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
switch|switch
condition|(
name|n
operator|->
name|type
condition|)
block|{
case|case
name|ROFFT_BLOCK
case|:
name|outflags
operator||=
name|MD_Bk
expr_stmt|;
name|md_pre_syn
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
case|case
name|ROFFT_HEAD
case|:
case|case
name|ROFFT_ELEM
case|:
name|md_pre_raw
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Nm
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
switch|switch
condition|(
name|n
operator|->
name|type
condition|)
block|{
case|case
name|ROFFT_BLOCK
case|:
name|outflags
operator|&=
operator|~
name|MD_Bk
expr_stmt|;
break|break;
case|case
name|ROFFT_HEAD
case|:
case|case
name|ROFFT_ELEM
case|:
name|md_post_raw
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_No
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|outflags
operator||=
name|MD_spc_force
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Ns
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Pf
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|next
operator|!=
name|NULL
operator|&&
operator|(
name|n
operator|->
name|next
operator|->
name|flags
operator|&
name|NODE_LINE
operator|)
operator|==
literal|0
condition|)
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Pp
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|outflags
operator||=
name|MD_sp
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Rs
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|sec
operator|==
name|SEC_SEE_ALSO
condition|)
name|outflags
operator||=
name|MD_sp
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Sh
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
switch|switch
condition|(
name|n
operator|->
name|type
condition|)
block|{
case|case
name|ROFFT_BLOCK
case|:
if|if
condition|(
name|n
operator|->
name|sec
operator|==
name|SEC_AUTHORS
condition|)
name|outflags
operator|&=
operator|~
operator|(
name|MD_An_split
operator||
name|MD_An_nosplit
operator|)
expr_stmt|;
break|break;
case|case
name|ROFFT_HEAD
case|:
name|outflags
operator||=
name|MD_sp
expr_stmt|;
name|md_rawword
argument_list|(
name|n
operator|->
name|tok
operator|==
name|MDOC_Sh
condition|?
literal|"#"
else|:
literal|"##"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ROFFT_BODY
case|:
name|outflags
operator||=
name|MD_sp
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Sm
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|child
operator|==
name|NULL
condition|)
name|outflags
operator|^=
name|MD_Sm
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
literal|"on"
argument_list|,
name|n
operator|->
name|child
operator|->
name|string
argument_list|)
operator|==
literal|0
condition|)
name|outflags
operator||=
name|MD_Sm
expr_stmt|;
else|else
name|outflags
operator|&=
operator|~
name|MD_Sm
expr_stmt|;
if|if
condition|(
name|outflags
operator|&
name|MD_Sm
condition|)
name|outflags
operator||=
name|MD_spc
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Vt
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
switch|switch
condition|(
name|n
operator|->
name|type
condition|)
block|{
case|case
name|ROFFT_BLOCK
case|:
name|md_pre_syn
argument_list|(
name|n
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|ROFFT_BODY
case|:
case|case
name|ROFFT_ELEM
case|:
name|md_pre_raw
argument_list|(
name|n
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
default|default:
return|return
literal|0
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|md_post_Vt
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
switch|switch
condition|(
name|n
operator|->
name|type
condition|)
block|{
case|case
name|ROFFT_BODY
case|:
case|case
name|ROFFT_ELEM
case|:
name|md_post_raw
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_Xr
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|n
operator|=
name|n
operator|->
name|child
expr_stmt|;
if|if
condition|(
name|n
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
name|md_node
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|n
operator|=
name|n
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|n
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
name|md_word
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
name|md_node
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|md_word
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre__T
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
if|if
condition|(
name|n
operator|->
name|parent
operator|->
name|tok
operator|==
name|MDOC_Rs
operator|&&
name|n
operator|->
name|parent
operator|->
name|norm
operator|->
name|Rs
operator|.
name|quote_T
condition|)
name|md_word
argument_list|(
literal|"\""
argument_list|)
expr_stmt|;
else|else
name|md_rawword
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|md_post__T
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|outflags
operator|&=
operator|~
name|MD_spc
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|parent
operator|->
name|tok
operator|==
name|MDOC_Rs
operator|&&
name|n
operator|->
name|parent
operator|->
name|norm
operator|->
name|Rs
operator|.
name|quote_T
condition|)
name|md_word
argument_list|(
literal|"\""
argument_list|)
expr_stmt|;
else|else
name|md_rawword
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
name|md_post_pc
argument_list|(
name|n
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|md_pre_br
parameter_list|(
name|struct
name|roff_node
modifier|*
name|n
parameter_list|)
block|{
name|outflags
operator||=
name|MD_br
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

