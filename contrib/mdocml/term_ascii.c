begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	$Id: term_ascii.c,v 1.40 2014/11/20 13:56:20 schwarze Exp $ */
end_comment

begin_comment
comment|/*  * Copyright (c) 2010, 2011 Kristaps Dzonsons<kristaps@bsd.lv>  * Copyright (c) 2014 Ingo Schwarze<schwarze@openbsd.org>  *  * Permission to use, copy, modify, and distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES  * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR  * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES  * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<assert.h>
end_include

begin_if
if|#
directive|if
name|HAVE_WCHAR
end_if

begin_include
include|#
directive|include
file|<locale.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<stdint.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_if
if|#
directive|if
name|HAVE_WCHAR
end_if

begin_include
include|#
directive|include
file|<wchar.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"mandoc.h"
end_include

begin_include
include|#
directive|include
file|"mandoc_aux.h"
end_include

begin_include
include|#
directive|include
file|"out.h"
end_include

begin_include
include|#
directive|include
file|"term.h"
end_include

begin_include
include|#
directive|include
file|"main.h"
end_include

begin_function_decl
specifier|static
name|struct
name|termp
modifier|*
name|ascii_init
parameter_list|(
name|enum
name|termenc
parameter_list|,
specifier|const
name|struct
name|mchars
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|ascii_hspan
parameter_list|(
specifier|const
name|struct
name|termp
modifier|*
parameter_list|,
specifier|const
name|struct
name|roffsu
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|size_t
name|ascii_width
parameter_list|(
specifier|const
name|struct
name|termp
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ascii_advance
parameter_list|(
name|struct
name|termp
modifier|*
parameter_list|,
name|size_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ascii_begin
parameter_list|(
name|struct
name|termp
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ascii_end
parameter_list|(
name|struct
name|termp
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ascii_endline
parameter_list|(
name|struct
name|termp
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ascii_letter
parameter_list|(
name|struct
name|termp
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ascii_setwidth
parameter_list|(
name|struct
name|termp
modifier|*
parameter_list|,
name|int
parameter_list|,
name|size_t
parameter_list|)
function_decl|;
end_function_decl

begin_if
if|#
directive|if
name|HAVE_WCHAR
end_if

begin_function_decl
specifier|static
name|void
name|locale_advance
parameter_list|(
name|struct
name|termp
modifier|*
parameter_list|,
name|size_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|locale_endline
parameter_list|(
name|struct
name|termp
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|locale_letter
parameter_list|(
name|struct
name|termp
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|size_t
name|locale_width
parameter_list|(
specifier|const
name|struct
name|termp
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|struct
name|termp
modifier|*
name|ascii_init
parameter_list|(
name|enum
name|termenc
name|enc
parameter_list|,
specifier|const
name|struct
name|mchars
modifier|*
name|mchars
parameter_list|,
name|char
modifier|*
name|outopts
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|toks
index|[
literal|5
index|]
decl_stmt|;
name|char
modifier|*
name|v
decl_stmt|;
name|struct
name|termp
modifier|*
name|p
decl_stmt|;
name|p
operator|=
name|mandoc_calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|termp
argument_list|)
argument_list|)
expr_stmt|;
name|p
operator|->
name|symtab
operator|=
name|mchars
expr_stmt|;
name|p
operator|->
name|tabwidth
operator|=
literal|5
expr_stmt|;
name|p
operator|->
name|defrmargin
operator|=
name|p
operator|->
name|lastrmargin
operator|=
literal|78
expr_stmt|;
name|p
operator|->
name|begin
operator|=
name|ascii_begin
expr_stmt|;
name|p
operator|->
name|end
operator|=
name|ascii_end
expr_stmt|;
name|p
operator|->
name|hspan
operator|=
name|ascii_hspan
expr_stmt|;
name|p
operator|->
name|type
operator|=
name|TERMTYPE_CHAR
expr_stmt|;
name|p
operator|->
name|enc
operator|=
name|TERMENC_ASCII
expr_stmt|;
name|p
operator|->
name|advance
operator|=
name|ascii_advance
expr_stmt|;
name|p
operator|->
name|endline
operator|=
name|ascii_endline
expr_stmt|;
name|p
operator|->
name|letter
operator|=
name|ascii_letter
expr_stmt|;
name|p
operator|->
name|setwidth
operator|=
name|ascii_setwidth
expr_stmt|;
name|p
operator|->
name|width
operator|=
name|ascii_width
expr_stmt|;
if|#
directive|if
name|HAVE_WCHAR
if|if
condition|(
name|TERMENC_ASCII
operator|!=
name|enc
condition|)
block|{
name|v
operator|=
name|TERMENC_LOCALE
operator|==
name|enc
condition|?
name|setlocale
argument_list|(
name|LC_ALL
argument_list|,
literal|""
argument_list|)
else|:
name|setlocale
argument_list|(
name|LC_CTYPE
argument_list|,
literal|"en_US.UTF-8"
argument_list|)
expr_stmt|;
if|if
condition|(
name|NULL
operator|!=
name|v
operator|&&
name|MB_CUR_MAX
operator|>
literal|1
condition|)
block|{
name|p
operator|->
name|enc
operator|=
name|enc
expr_stmt|;
name|p
operator|->
name|advance
operator|=
name|locale_advance
expr_stmt|;
name|p
operator|->
name|endline
operator|=
name|locale_endline
expr_stmt|;
name|p
operator|->
name|letter
operator|=
name|locale_letter
expr_stmt|;
name|p
operator|->
name|width
operator|=
name|locale_width
expr_stmt|;
block|}
block|}
endif|#
directive|endif
name|toks
index|[
literal|0
index|]
operator|=
literal|"indent"
expr_stmt|;
name|toks
index|[
literal|1
index|]
operator|=
literal|"width"
expr_stmt|;
name|toks
index|[
literal|2
index|]
operator|=
literal|"mdoc"
expr_stmt|;
name|toks
index|[
literal|3
index|]
operator|=
literal|"synopsis"
expr_stmt|;
name|toks
index|[
literal|4
index|]
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
name|outopts
operator|&&
operator|*
name|outopts
condition|)
switch|switch
condition|(
name|getsubopt
argument_list|(
operator|&
name|outopts
argument_list|,
name|UNCONST
argument_list|(
name|toks
argument_list|)
argument_list|,
operator|&
name|v
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
name|p
operator|->
name|defindent
operator|=
operator|(
name|size_t
operator|)
name|atoi
argument_list|(
name|v
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|p
operator|->
name|defrmargin
operator|=
operator|(
name|size_t
operator|)
name|atoi
argument_list|(
name|v
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
comment|/* 			 * Temporary, undocumented mode 			 * to imitate mdoc(7) output style. 			 */
name|p
operator|->
name|mdocstyle
operator|=
literal|1
expr_stmt|;
name|p
operator|->
name|defindent
operator|=
literal|5
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|p
operator|->
name|synopsisonly
operator|=
literal|1
expr_stmt|;
break|break;
default|default:
break|break;
block|}
comment|/* Enforce a lower boundary. */
if|if
condition|(
name|p
operator|->
name|defrmargin
operator|<
literal|58
condition|)
name|p
operator|->
name|defrmargin
operator|=
literal|58
expr_stmt|;
return|return
operator|(
name|p
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|ascii_alloc
parameter_list|(
specifier|const
name|struct
name|mchars
modifier|*
name|mchars
parameter_list|,
name|char
modifier|*
name|outopts
parameter_list|)
block|{
return|return
operator|(
name|ascii_init
argument_list|(
name|TERMENC_ASCII
argument_list|,
name|mchars
argument_list|,
name|outopts
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|utf8_alloc
parameter_list|(
specifier|const
name|struct
name|mchars
modifier|*
name|mchars
parameter_list|,
name|char
modifier|*
name|outopts
parameter_list|)
block|{
return|return
operator|(
name|ascii_init
argument_list|(
name|TERMENC_UTF8
argument_list|,
name|mchars
argument_list|,
name|outopts
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|locale_alloc
parameter_list|(
specifier|const
name|struct
name|mchars
modifier|*
name|mchars
parameter_list|,
name|char
modifier|*
name|outopts
parameter_list|)
block|{
return|return
operator|(
name|ascii_init
argument_list|(
name|TERMENC_LOCALE
argument_list|,
name|mchars
argument_list|,
name|outopts
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|ascii_setwidth
parameter_list|(
name|struct
name|termp
modifier|*
name|p
parameter_list|,
name|int
name|iop
parameter_list|,
name|size_t
name|width
parameter_list|)
block|{
name|p
operator|->
name|rmargin
operator|=
name|p
operator|->
name|defrmargin
expr_stmt|;
if|if
condition|(
name|iop
operator|>
literal|0
condition|)
name|p
operator|->
name|defrmargin
operator|+=
name|width
expr_stmt|;
elseif|else
if|if
condition|(
name|iop
operator|==
literal|0
condition|)
name|p
operator|->
name|defrmargin
operator|=
name|width
condition|?
name|width
else|:
name|p
operator|->
name|lastrmargin
expr_stmt|;
elseif|else
if|if
condition|(
name|p
operator|->
name|defrmargin
operator|>
name|width
condition|)
name|p
operator|->
name|defrmargin
operator|-=
name|width
expr_stmt|;
else|else
name|p
operator|->
name|defrmargin
operator|=
literal|0
expr_stmt|;
name|p
operator|->
name|lastrmargin
operator|=
name|p
operator|->
name|rmargin
expr_stmt|;
name|p
operator|->
name|rmargin
operator|=
name|p
operator|->
name|maxrmargin
operator|=
name|p
operator|->
name|defrmargin
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|size_t
name|ascii_width
parameter_list|(
specifier|const
name|struct
name|termp
modifier|*
name|p
parameter_list|,
name|int
name|c
parameter_list|)
block|{
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
name|void
name|ascii_free
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|term_free
argument_list|(
operator|(
expr|struct
name|termp
operator|*
operator|)
name|arg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ascii_letter
parameter_list|(
name|struct
name|termp
modifier|*
name|p
parameter_list|,
name|int
name|c
parameter_list|)
block|{
name|putchar
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ascii_begin
parameter_list|(
name|struct
name|termp
modifier|*
name|p
parameter_list|)
block|{
call|(
modifier|*
name|p
operator|->
name|headf
call|)
argument_list|(
name|p
argument_list|,
name|p
operator|->
name|argf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ascii_end
parameter_list|(
name|struct
name|termp
modifier|*
name|p
parameter_list|)
block|{
call|(
modifier|*
name|p
operator|->
name|footf
call|)
argument_list|(
name|p
argument_list|,
name|p
operator|->
name|argf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ascii_endline
parameter_list|(
name|struct
name|termp
modifier|*
name|p
parameter_list|)
block|{
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ascii_advance
parameter_list|(
name|struct
name|termp
modifier|*
name|p
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|double
name|ascii_hspan
parameter_list|(
specifier|const
name|struct
name|termp
modifier|*
name|p
parameter_list|,
specifier|const
name|struct
name|roffsu
modifier|*
name|su
parameter_list|)
block|{
name|double
name|r
decl_stmt|;
comment|/* 	 * Approximate based on character width. 	 * None of these will be actually correct given that an inch on 	 * the screen depends on character size, terminal, etc., etc. 	 */
switch|switch
condition|(
name|su
operator|->
name|unit
condition|)
block|{
case|case
name|SCALE_BU
case|:
name|r
operator|=
name|su
operator|->
name|scale
operator|*
literal|10.0
operator|/
literal|240.0
expr_stmt|;
break|break;
case|case
name|SCALE_CM
case|:
name|r
operator|=
name|su
operator|->
name|scale
operator|*
literal|10.0
operator|/
literal|2.54
expr_stmt|;
break|break;
case|case
name|SCALE_FS
case|:
name|r
operator|=
name|su
operator|->
name|scale
operator|*
literal|2730.666
expr_stmt|;
break|break;
case|case
name|SCALE_IN
case|:
name|r
operator|=
name|su
operator|->
name|scale
operator|*
literal|10.0
expr_stmt|;
break|break;
case|case
name|SCALE_MM
case|:
name|r
operator|=
name|su
operator|->
name|scale
operator|/
literal|100.0
expr_stmt|;
break|break;
case|case
name|SCALE_PC
case|:
name|r
operator|=
name|su
operator|->
name|scale
operator|*
literal|10.0
operator|/
literal|6.0
expr_stmt|;
break|break;
case|case
name|SCALE_PT
case|:
name|r
operator|=
name|su
operator|->
name|scale
operator|*
literal|10.0
operator|/
literal|72.0
expr_stmt|;
break|break;
case|case
name|SCALE_VS
case|:
name|r
operator|=
name|su
operator|->
name|scale
operator|*
literal|2.0
operator|-
literal|1.0
expr_stmt|;
break|break;
case|case
name|SCALE_EN
case|:
comment|/* FALLTHROUGH */
case|case
name|SCALE_EM
case|:
name|r
operator|=
name|su
operator|->
name|scale
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
comment|/* NOTREACHED */
block|}
return|return
operator|(
name|r
operator|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|ascii_uc2str
parameter_list|(
name|int
name|uc
parameter_list|)
block|{
specifier|static
specifier|const
name|char
name|nbrsp
index|[
literal|2
index|]
init|=
block|{
name|ASCII_NBRSP
block|,
literal|'\0'
block|}
decl_stmt|;
specifier|static
specifier|const
name|char
modifier|*
name|tab
index|[]
init|=
block|{
literal|"<NUL>"
block|,
literal|"<SOH>"
block|,
literal|"<STX>"
block|,
literal|"<ETX>"
block|,
literal|"<EOT>"
block|,
literal|"<ENQ>"
block|,
literal|"<ACK>"
block|,
literal|"<BEL>"
block|,
literal|"<BS>"
block|,
literal|"\t"
block|,
literal|"<LF>"
block|,
literal|"<VT>"
block|,
literal|"<FF>"
block|,
literal|"<CR>"
block|,
literal|"<SO>"
block|,
literal|"<SI>"
block|,
literal|"<DLE>"
block|,
literal|"<DC1>"
block|,
literal|"<DC2>"
block|,
literal|"<DC3>"
block|,
literal|"<DC4>"
block|,
literal|"<NAK>"
block|,
literal|"<SYN>"
block|,
literal|"<ETB>"
block|,
literal|"<CAN>"
block|,
literal|"<EM>"
block|,
literal|"<SUB>"
block|,
literal|"<ESC>"
block|,
literal|"<FS>"
block|,
literal|"<GS>"
block|,
literal|"<RS>"
block|,
literal|"<US>"
block|,
literal|" "
block|,
literal|"!"
block|,
literal|"\""
block|,
literal|"#"
block|,
literal|"$"
block|,
literal|"%"
block|,
literal|"&"
block|,
literal|"'"
block|,
literal|"("
block|,
literal|")"
block|,
literal|"*"
block|,
literal|"+"
block|,
literal|","
block|,
literal|"-"
block|,
literal|"."
block|,
literal|"/"
block|,
literal|"0"
block|,
literal|"1"
block|,
literal|"2"
block|,
literal|"3"
block|,
literal|"4"
block|,
literal|"5"
block|,
literal|"6"
block|,
literal|"7"
block|,
literal|"8"
block|,
literal|"9"
block|,
literal|":"
block|,
literal|";"
block|,
literal|"<"
block|,
literal|"="
block|,
literal|">"
block|,
literal|"?"
block|,
literal|"@"
block|,
literal|"A"
block|,
literal|"B"
block|,
literal|"C"
block|,
literal|"D"
block|,
literal|"E"
block|,
literal|"F"
block|,
literal|"G"
block|,
literal|"H"
block|,
literal|"I"
block|,
literal|"J"
block|,
literal|"K"
block|,
literal|"L"
block|,
literal|"M"
block|,
literal|"N"
block|,
literal|"O"
block|,
literal|"P"
block|,
literal|"Q"
block|,
literal|"R"
block|,
literal|"S"
block|,
literal|"T"
block|,
literal|"U"
block|,
literal|"V"
block|,
literal|"W"
block|,
literal|"X"
block|,
literal|"Y"
block|,
literal|"Z"
block|,
literal|"["
block|,
literal|"\\"
block|,
literal|"]"
block|,
literal|"^"
block|,
literal|"_"
block|,
literal|"`"
block|,
literal|"a"
block|,
literal|"b"
block|,
literal|"c"
block|,
literal|"d"
block|,
literal|"e"
block|,
literal|"f"
block|,
literal|"g"
block|,
literal|"h"
block|,
literal|"i"
block|,
literal|"j"
block|,
literal|"k"
block|,
literal|"l"
block|,
literal|"m"
block|,
literal|"n"
block|,
literal|"o"
block|,
literal|"p"
block|,
literal|"q"
block|,
literal|"r"
block|,
literal|"s"
block|,
literal|"t"
block|,
literal|"u"
block|,
literal|"v"
block|,
literal|"w"
block|,
literal|"x"
block|,
literal|"y"
block|,
literal|"z"
block|,
literal|"{"
block|,
literal|"|"
block|,
literal|"}"
block|,
literal|"~"
block|,
literal|"<DEL>"
block|,
literal|"<80>"
block|,
literal|"<81>"
block|,
literal|"<82>"
block|,
literal|"<83>"
block|,
literal|"<84>"
block|,
literal|"<85>"
block|,
literal|"<86>"
block|,
literal|"<87>"
block|,
literal|"<88>"
block|,
literal|"<89>"
block|,
literal|"<8A>"
block|,
literal|"<8B>"
block|,
literal|"<8C>"
block|,
literal|"<8D>"
block|,
literal|"<8E>"
block|,
literal|"<8F>"
block|,
literal|"<90>"
block|,
literal|"<91>"
block|,
literal|"<92>"
block|,
literal|"<93>"
block|,
literal|"<94>"
block|,
literal|"<95>"
block|,
literal|"<96>"
block|,
literal|"<97>"
block|,
literal|"<99>"
block|,
literal|"<99>"
block|,
literal|"<9A>"
block|,
literal|"<9B>"
block|,
literal|"<9C>"
block|,
literal|"<9D>"
block|,
literal|"<9E>"
block|,
literal|"<9F>"
block|,
name|nbrsp
block|,
literal|"!"
block|,
literal|"/\bc"
block|,
literal|"GBP"
block|,
literal|"o\bx"
block|,
literal|"=\bY"
block|,
literal|"|"
block|,
literal|"<sec>"
block|,
literal|"\""
block|,
literal|"(C)"
block|,
literal|"_\ba"
block|,
literal|"<<"
block|,
literal|"~"
block|,
literal|""
block|,
literal|"(R)"
block|,
literal|"-"
block|,
literal|"<deg>"
block|,
literal|"+-"
block|,
literal|"2"
block|,
literal|"3"
block|,
literal|"'"
block|,
literal|",\bu"
block|,
literal|"<par>"
block|,
literal|"."
block|,
literal|","
block|,
literal|"1"
block|,
literal|"_\bo"
block|,
literal|">>"
block|,
literal|"1/4"
block|,
literal|"1/2"
block|,
literal|"3/4"
block|,
literal|"?"
block|,
literal|"`\bA"
block|,
literal|"'\bA"
block|,
literal|"^\bA"
block|,
literal|"~\bA"
block|,
literal|"\"\bA"
block|,
literal|"o\bA"
block|,
literal|"AE"
block|,
literal|",\bC"
block|,
literal|"`\bE"
block|,
literal|"'\bE"
block|,
literal|"^\bE"
block|,
literal|"\"\bE"
block|,
literal|"`\bI"
block|,
literal|"'\bI"
block|,
literal|"^\bI"
block|,
literal|"\"\bI"
block|,
literal|"-\bD"
block|,
literal|"~\bN"
block|,
literal|"`\bO"
block|,
literal|"'\bO"
block|,
literal|"^\bO"
block|,
literal|"~\bO"
block|,
literal|"\"\bO"
block|,
literal|"x"
block|,
literal|"/\bO"
block|,
literal|"`\bU"
block|,
literal|"'\bU"
block|,
literal|"^\bU"
block|,
literal|"\"\bU"
block|,
literal|"'\bY"
block|,
literal|"Th"
block|,
literal|"ss"
block|,
literal|"`\ba"
block|,
literal|"'\ba"
block|,
literal|"^\ba"
block|,
literal|"~\ba"
block|,
literal|"\"\ba"
block|,
literal|"o\ba"
block|,
literal|"ae"
block|,
literal|",\bc"
block|,
literal|"`\be"
block|,
literal|"'\be"
block|,
literal|"^\be"
block|,
literal|"\"\be"
block|,
literal|"`\bi"
block|,
literal|"'\bi"
block|,
literal|"^\bi"
block|,
literal|"\"\bi"
block|,
literal|"d"
block|,
literal|"~\bn"
block|,
literal|"`\bo"
block|,
literal|"'\bo"
block|,
literal|"^\bo"
block|,
literal|"~\bo"
block|,
literal|"\"\bo"
block|,
literal|"-:-"
block|,
literal|"/\bo"
block|,
literal|"`\bu"
block|,
literal|"'\bu"
block|,
literal|"^\bu"
block|,
literal|"\"\bu"
block|,
literal|"'\by"
block|,
literal|"th"
block|,
literal|"\"\by"
block|,
literal|"A"
block|,
literal|"a"
block|,
literal|"A"
block|,
literal|"a"
block|,
literal|"A"
block|,
literal|"a"
block|,
literal|"'\bC"
block|,
literal|"'\bc"
block|,
literal|"^\bC"
block|,
literal|"^\bc"
block|,
literal|"C"
block|,
literal|"c"
block|,
literal|"C"
block|,
literal|"c"
block|,
literal|"D"
block|,
literal|"d"
block|,
literal|"/\bD"
block|,
literal|"/\bd"
block|,
literal|"E"
block|,
literal|"e"
block|,
literal|"E"
block|,
literal|"e"
block|,
literal|"E"
block|,
literal|"e"
block|,
literal|"E"
block|,
literal|"e"
block|,
literal|"E"
block|,
literal|"e"
block|,
literal|"^\bG"
block|,
literal|"^\bg"
block|,
literal|"G"
block|,
literal|"g"
block|,
literal|"G"
block|,
literal|"g"
block|,
literal|",\bG"
block|,
literal|",\bg"
block|,
literal|"^\bH"
block|,
literal|"^\bh"
block|,
literal|"/\bH"
block|,
literal|"/\bh"
block|,
literal|"~\bI"
block|,
literal|"~\bi"
block|,
literal|"I"
block|,
literal|"i"
block|,
literal|"I"
block|,
literal|"i"
block|,
literal|"I"
block|,
literal|"i"
block|,
literal|"I"
block|,
literal|"i"
block|,
literal|"IJ"
block|,
literal|"ij"
block|,
literal|"^\bJ"
block|,
literal|"^\bj"
block|,
literal|",\bK"
block|,
literal|",\bk"
block|,
literal|"q"
block|,
literal|"'\bL"
block|,
literal|"'\bl"
block|,
literal|",\bL"
block|,
literal|",\bl"
block|,
literal|"L"
block|,
literal|"l"
block|,
literal|"L"
block|,
literal|"l"
block|,
literal|"/\bL"
block|,
literal|"/\bl"
block|,
literal|"'\bN"
block|,
literal|"'\bn"
block|,
literal|",\bN"
block|,
literal|",\bn"
block|,
literal|"N"
block|,
literal|"n"
block|,
literal|"'n"
block|,
literal|"Ng"
block|,
literal|"ng"
block|,
literal|"O"
block|,
literal|"o"
block|,
literal|"O"
block|,
literal|"o"
block|,
literal|"O"
block|,
literal|"o"
block|,
literal|"OE"
block|,
literal|"oe"
block|,
literal|"'\bR"
block|,
literal|"'\br"
block|,
literal|",\bR"
block|,
literal|",\br"
block|,
literal|"R"
block|,
literal|"r"
block|,
literal|"'\bS"
block|,
literal|"'\bs"
block|,
literal|"^\bS"
block|,
literal|"^\bs"
block|,
literal|",\bS"
block|,
literal|",\bs"
block|,
literal|"S"
block|,
literal|"s"
block|,
literal|",\bT"
block|,
literal|",\bt"
block|,
literal|"T"
block|,
literal|"t"
block|,
literal|"/\bT"
block|,
literal|"/\bt"
block|,
literal|"~\bU"
block|,
literal|"~\bu"
block|,
literal|"U"
block|,
literal|"u"
block|,
literal|"U"
block|,
literal|"u"
block|,
literal|"U"
block|,
literal|"u"
block|,
literal|"U"
block|,
literal|"u"
block|,
literal|"U"
block|,
literal|"u"
block|,
literal|"^\bW"
block|,
literal|"^\bw"
block|,
literal|"^\bY"
block|,
literal|"^\by"
block|,
literal|"\"\bY"
block|,
literal|"'\bZ"
block|,
literal|"'\bz"
block|,
literal|"Z"
block|,
literal|"z"
block|,
literal|"Z"
block|,
literal|"z"
block|,
literal|"s"
block|,
literal|"b"
block|,
literal|"B"
block|,
literal|"B"
block|,
literal|"b"
block|,
literal|"6"
block|,
literal|"6"
block|,
literal|"O"
block|,
literal|"C"
block|,
literal|"c"
block|,
literal|"D"
block|,
literal|"D"
block|,
literal|"D"
block|,
literal|"d"
block|,
literal|"d"
block|,
literal|"3"
block|,
literal|"@"
block|,
literal|"E"
block|,
literal|"F"
block|,
literal|",\bf"
block|,
literal|"G"
block|,
literal|"G"
block|,
literal|"hv"
block|,
literal|"I"
block|,
literal|"/\bI"
block|,
literal|"K"
block|,
literal|"k"
block|,
literal|"/\bl"
block|,
literal|"l"
block|,
literal|"W"
block|,
literal|"N"
block|,
literal|"n"
block|,
literal|"~\bO"
block|,
literal|"O"
block|,
literal|"o"
block|,
literal|"OI"
block|,
literal|"oi"
block|,
literal|"P"
block|,
literal|"p"
block|,
literal|"YR"
block|,
literal|"2"
block|,
literal|"2"
block|,
literal|"SH"
block|,
literal|"sh"
block|,
literal|"t"
block|,
literal|"T"
block|,
literal|"t"
block|,
literal|"T"
block|,
literal|"U"
block|,
literal|"u"
block|,
literal|"Y"
block|,
literal|"V"
block|,
literal|"Y"
block|,
literal|"y"
block|,
literal|"/\bZ"
block|,
literal|"/\bz"
block|,
literal|"ZH"
block|,
literal|"ZH"
block|,
literal|"zh"
block|,
literal|"zh"
block|,
literal|"/\b2"
block|,
literal|"5"
block|,
literal|"5"
block|,
literal|"ts"
block|,
literal|"w"
block|,
literal|"|"
block|,
literal|"||"
block|,
literal|"|="
block|,
literal|"!"
block|,
literal|"DZ"
block|,
literal|"Dz"
block|,
literal|"dz"
block|,
literal|"LJ"
block|,
literal|"Lj"
block|,
literal|"lj"
block|,
literal|"NJ"
block|,
literal|"Nj"
block|,
literal|"nj"
block|,
literal|"A"
block|,
literal|"a"
block|,
literal|"I"
block|,
literal|"i"
block|,
literal|"O"
block|,
literal|"o"
block|,
literal|"U"
block|,
literal|"u"
block|,
literal|"U"
block|,
literal|"u"
block|,
literal|"U"
block|,
literal|"u"
block|,
literal|"U"
block|,
literal|"u"
block|,
literal|"U"
block|,
literal|"u"
block|,
literal|"@"
block|,
literal|"A"
block|,
literal|"a"
block|,
literal|"A"
block|,
literal|"a"
block|,
literal|"AE"
block|,
literal|"ae"
block|,
literal|"/\bG"
block|,
literal|"/\bg"
block|,
literal|"G"
block|,
literal|"g"
block|,
literal|"K"
block|,
literal|"k"
block|,
literal|"O"
block|,
literal|"o"
block|,
literal|"O"
block|,
literal|"o"
block|,
literal|"ZH"
block|,
literal|"zh"
block|,
literal|"j"
block|,
literal|"DZ"
block|,
literal|"Dz"
block|,
literal|"dz"
block|,
literal|"'\bG"
block|,
literal|"'\bg"
block|,
literal|"HV"
block|,
literal|"W"
block|,
literal|"`\bN"
block|,
literal|"`\bn"
block|,
literal|"A"
block|,
literal|"a"
block|,
literal|"'\bAE"
block|,
literal|"'\bae"
block|,
literal|"O"
block|,
literal|"o"
block|}
decl_stmt|;
name|assert
argument_list|(
name|uc
operator|>=
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|size_t
operator|)
name|uc
operator|<
sizeof|sizeof
argument_list|(
name|tab
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|tab
index|[
literal|0
index|]
argument_list|)
condition|)
return|return
operator|(
name|tab
index|[
name|uc
index|]
operator|)
return|;
return|return
operator|(
name|mchars_uc2str
argument_list|(
name|uc
argument_list|)
operator|)
return|;
block|}
end_function

begin_if
if|#
directive|if
name|HAVE_WCHAR
end_if

begin_function
specifier|static
name|size_t
name|locale_width
parameter_list|(
specifier|const
name|struct
name|termp
modifier|*
name|p
parameter_list|,
name|int
name|c
parameter_list|)
block|{
name|int
name|rc
decl_stmt|;
if|if
condition|(
name|c
operator|==
name|ASCII_NBRSP
condition|)
name|c
operator|=
literal|' '
expr_stmt|;
name|rc
operator|=
name|wcwidth
argument_list|(
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|<
literal|0
condition|)
name|rc
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|locale_advance
parameter_list|(
name|struct
name|termp
modifier|*
name|p
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|putwchar
argument_list|(
literal|L'
expr|'
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|locale_endline
parameter_list|(
name|struct
name|termp
modifier|*
name|p
parameter_list|)
block|{
name|putwchar
argument_list|(
literal|L'
expr|\n'
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|locale_letter
parameter_list|(
name|struct
name|termp
modifier|*
name|p
parameter_list|,
name|int
name|c
parameter_list|)
block|{
name|putwchar
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

