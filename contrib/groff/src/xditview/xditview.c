begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright 1991 Massachusetts Institute of Technology  *  * Permission to use, copy, modify, distribute, and sell this software and its  * documentation for any purpose is hereby granted without fee, provided that  * the above copyright notice appear in all copies and that both that  * copyright notice and this permission notice appear in supporting  * documentation, and that the name of M.I.T. not be used in advertising or  * publicity pertaining to distribution of the software without specific,  * written prior permission.  M.I.T. makes no representations about the  * suitability of this software for any purpose.  It is provided "as is"  * without express or implied warranty.  *  * M.I.T. DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL M.I.T.  * BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES  * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION  * OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN  * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  *  */
end_comment

begin_comment
comment|/*  * xditview --   *  *   Display ditroff output in an X window  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|SABER
end_ifndef

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|rcsid
index|[]
init|=
literal|"$XConsortium: xditview.c,v 1.17 89/12/10 17:05:08 rws Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* lint */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* SABER */
end_comment

begin_include
include|#
directive|include
file|<X11/Xatom.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xlib.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xos.h>
end_include

begin_include
include|#
directive|include
file|<X11/Intrinsic.h>
end_include

begin_include
include|#
directive|include
file|<X11/StringDefs.h>
end_include

begin_include
include|#
directive|include
file|<X11/Shell.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xaw/Paned.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xaw/Viewport.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xaw/Box.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xaw/Command.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xaw/Dialog.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xaw/Label.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xaw/SimpleMenu.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xaw/SmeBSB.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|"Dvi.h"
end_include

begin_include
include|#
directive|include
file|"xdit.bm"
end_include

begin_include
include|#
directive|include
file|"xdit_mask.bm"
end_include

begin_include
include|#
directive|include
file|"stdio.h"
end_include

begin_function_decl
specifier|extern
name|FILE
modifier|*
name|popen
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|exit
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|String
name|fallback_resources
index|[]
init|=
block|{
include|#
directive|include
file|"GXditview-ad.h"
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_struct
specifier|static
struct|struct
name|app_resources
block|{
name|char
modifier|*
name|print_command
decl_stmt|;
name|char
modifier|*
name|filename
decl_stmt|;
block|}
name|app_resources
struct|;
end_struct

begin_define
define|#
directive|define
name|offset
parameter_list|(
name|field
parameter_list|)
value|XtOffset(struct app_resources *, field)
end_define

begin_comment
comment|/* Application resources. */
end_comment

begin_decl_stmt
specifier|static
name|XtResource
name|resources
index|[]
init|=
block|{
block|{
literal|"printCommand"
block|,
literal|"PrintCommand"
block|,
name|XtRString
block|,
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
block|,
name|offset
argument_list|(
name|print_command
argument_list|)
block|,
name|XtRString
block|,
name|NULL
block|}
block|,
block|{
literal|"filename"
block|,
literal|"Filename"
block|,
name|XtRString
block|,
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
block|,
name|offset
argument_list|(
name|filename
argument_list|)
block|,
name|XtRString
block|,
name|NULL
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|offset
end_undef

begin_comment
comment|/* Command line options table.  Only resources are entered here...there is a    pass over the remaining options after XtParseCommand is let loose. */
end_comment

begin_decl_stmt
specifier|static
name|XrmOptionDescRec
name|options
index|[]
init|=
block|{
block|{
literal|"-page"
block|,
literal|"*dvi.pageNumber"
block|,
name|XrmoptionSepArg
block|,
name|NULL
block|}
block|,
block|{
literal|"-backingStore"
block|,
literal|"*dvi.backingStore"
block|,
name|XrmoptionSepArg
block|,
name|NULL
block|}
block|,
block|{
literal|"-resolution"
block|,
literal|"*dvi.resolution"
block|,
name|XrmoptionSepArg
block|,
name|NULL
block|}
block|,
block|{
literal|"-printCommand"
block|,
literal|".printCommand"
block|,
name|XrmoptionSepArg
block|,
name|NULL
block|}
block|,
block|{
literal|"-filename"
block|,
literal|".filename"
block|,
name|XrmoptionSepArg
block|,
name|NULL
block|}
block|,
block|{
literal|"-noPolyText"
block|,
literal|"*dvi.noPolyText"
block|,
name|XrmoptionNoArg
block|,
literal|"TRUE"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|current_print_command
index|[
literal|1024
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|current_file_name
index|[
literal|1024
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|FILE
modifier|*
name|current_file
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Report the syntax for calling xditview.  */
end_comment

begin_expr_stmt
specifier|static
name|Syntax
argument_list|(
argument|call
argument_list|)
name|char
operator|*
name|call
expr_stmt|;
end_expr_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"Usage: %s [-fg<color>] [-bg<color>]\n"
argument_list|,
name|call
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"       [-bd<color>] [-bw<pixels>] [-help]\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"       [-display displayname] [-geometry geom]\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"       [-page<page-number>] [-backing<backing-store>]\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"       [-resolution<res>] [-print<command>]\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"       [-filename<file>] [filename]\n\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
specifier|static
name|void
name|NewFile
argument_list|()
decl_stmt|,
name|SetPageNumber
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Widget
name|toplevel
decl_stmt|,
name|paned
decl_stmt|,
name|viewport
decl_stmt|,
name|dvi
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Widget
name|page
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Widget
name|simpleMenu
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|NextPage
argument_list|()
decl_stmt|,
name|PreviousPage
argument_list|()
decl_stmt|,
name|SelectPage
argument_list|()
decl_stmt|,
name|OpenFile
argument_list|()
decl_stmt|,
name|Quit
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|Print
parameter_list|()
function_decl|;
end_function_decl

begin_struct
specifier|static
struct|struct
name|menuEntry
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|void
function_decl|(
modifier|*
name|function
function_decl|)
parameter_list|()
function_decl|;
block|}
name|menuEntries
index|[]
init|=
block|{
literal|"nextPage"
block|,
name|NextPage
block|,
literal|"previousPage"
block|,
name|PreviousPage
block|,
literal|"selectPage"
block|,
name|SelectPage
block|,
literal|"print"
block|,
name|Print
block|,
literal|"openFile"
block|,
name|OpenFile
block|,
literal|"quit"
block|,
name|Quit
block|, }
struct|;
end_struct

begin_decl_stmt
specifier|static
name|void
name|NextPageAction
argument_list|()
decl_stmt|,
name|PreviousPageAction
argument_list|()
decl_stmt|,
name|SelectPageAction
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|OpenFileAction
argument_list|()
decl_stmt|,
name|QuitAction
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|AcceptAction
argument_list|()
decl_stmt|,
name|CancelAction
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|PrintAction
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|RerasterizeAction
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|XtActionsRec
name|xditview_actions
index|[]
init|=
block|{
literal|"NextPage"
block|,
name|NextPageAction
block|,
literal|"PreviousPage"
block|,
name|PreviousPageAction
block|,
literal|"SelectPage"
block|,
name|SelectPageAction
block|,
literal|"Print"
block|,
name|PrintAction
block|,
literal|"OpenFile"
block|,
name|OpenFileAction
block|,
literal|"Rerasterize"
block|,
name|RerasterizeAction
block|,
literal|"Quit"
block|,
name|QuitAction
block|,
literal|"Accept"
block|,
name|AcceptAction
block|,
literal|"Cancel"
block|,
name|CancelAction
block|, }
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|MenuNextPage
value|0
end_define

begin_define
define|#
directive|define
name|MenuPreviousPage
value|1
end_define

begin_define
define|#
directive|define
name|MenuSelectPage
value|2
end_define

begin_define
define|#
directive|define
name|MenuPrint
value|3
end_define

begin_define
define|#
directive|define
name|MenuOpenFile
value|4
end_define

begin_define
define|#
directive|define
name|MenuQuit
value|5
end_define

begin_decl_stmt
specifier|static
name|char
name|pageLabel
index|[
literal|256
index|]
init|=
literal|"Page<none>"
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|char
modifier|*
name|file_name
init|=
literal|0
decl_stmt|;
name|int
name|i
decl_stmt|;
specifier|static
name|Arg
name|labelArgs
index|[]
init|=
block|{
block|{
name|XtNlabel
block|,
operator|(
name|XtArgVal
operator|)
name|pageLabel
block|}
block|,     }
decl_stmt|;
name|XtAppContext
name|xtcontext
decl_stmt|;
name|Arg
name|topLevelArgs
index|[
literal|2
index|]
decl_stmt|;
name|Widget
name|entry
decl_stmt|;
name|Arg
name|pageNumberArgs
index|[
literal|1
index|]
decl_stmt|;
name|int
name|page_number
decl_stmt|;
name|toplevel
operator|=
name|XtAppInitialize
argument_list|(
operator|&
name|xtcontext
argument_list|,
literal|"GXditview"
argument_list|,
name|options
argument_list|,
name|XtNumber
argument_list|(
name|options
argument_list|)
argument_list|,
operator|&
name|argc
argument_list|,
name|argv
argument_list|,
name|fallback_resources
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|2
condition|)
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|XtGetApplicationResources
argument_list|(
name|toplevel
argument_list|,
operator|(
name|XtPointer
operator|)
operator|&
name|app_resources
argument_list|,
name|resources
argument_list|,
name|XtNumber
argument_list|(
name|resources
argument_list|)
argument_list|,
name|NULL
argument_list|,
operator|(
name|Cardinal
operator|)
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|app_resources
operator|.
name|print_command
condition|)
name|strcpy
argument_list|(
name|current_print_command
argument_list|,
name|app_resources
operator|.
name|print_command
argument_list|)
expr_stmt|;
name|XtAppAddActions
argument_list|(
name|xtcontext
argument_list|,
name|xditview_actions
argument_list|,
name|XtNumber
argument_list|(
name|xditview_actions
argument_list|)
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|topLevelArgs
index|[
literal|0
index|]
argument_list|,
name|XtNiconPixmap
argument_list|,
name|XCreateBitmapFromData
argument_list|(
name|XtDisplay
argument_list|(
name|toplevel
argument_list|)
argument_list|,
name|XtScreen
argument_list|(
name|toplevel
argument_list|)
operator|->
name|root
argument_list|,
name|xdit_bits
argument_list|,
name|xdit_width
argument_list|,
name|xdit_height
argument_list|)
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|topLevelArgs
index|[
literal|1
index|]
argument_list|,
name|XtNiconMask
argument_list|,
name|XCreateBitmapFromData
argument_list|(
name|XtDisplay
argument_list|(
name|toplevel
argument_list|)
argument_list|,
name|XtScreen
argument_list|(
name|toplevel
argument_list|)
operator|->
name|root
argument_list|,
name|xdit_mask_bits
argument_list|,
name|xdit_mask_width
argument_list|,
name|xdit_mask_height
argument_list|)
argument_list|)
expr_stmt|;
name|XtSetValues
argument_list|(
name|toplevel
argument_list|,
name|topLevelArgs
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|1
condition|)
name|file_name
operator|=
name|argv
index|[
literal|1
index|]
expr_stmt|;
comment|/*      * create the menu and insert the entries      */
name|simpleMenu
operator|=
name|XtCreatePopupShell
argument_list|(
literal|"menu"
argument_list|,
name|simpleMenuWidgetClass
argument_list|,
name|toplevel
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XtNumber
argument_list|(
name|menuEntries
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|entry
operator|=
name|XtCreateManagedWidget
argument_list|(
name|menuEntries
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|smeBSBObjectClass
argument_list|,
name|simpleMenu
argument_list|,
name|NULL
argument_list|,
operator|(
name|Cardinal
operator|)
literal|0
argument_list|)
expr_stmt|;
name|XtAddCallback
argument_list|(
name|entry
argument_list|,
name|XtNcallback
argument_list|,
name|menuEntries
index|[
name|i
index|]
operator|.
name|function
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|paned
operator|=
name|XtCreateManagedWidget
argument_list|(
literal|"paned"
argument_list|,
name|panedWidgetClass
argument_list|,
name|toplevel
argument_list|,
name|NULL
argument_list|,
operator|(
name|Cardinal
operator|)
literal|0
argument_list|)
expr_stmt|;
name|viewport
operator|=
name|XtCreateManagedWidget
argument_list|(
literal|"viewport"
argument_list|,
name|viewportWidgetClass
argument_list|,
name|paned
argument_list|,
name|NULL
argument_list|,
operator|(
name|Cardinal
operator|)
literal|0
argument_list|)
expr_stmt|;
name|dvi
operator|=
name|XtCreateManagedWidget
argument_list|(
literal|"dvi"
argument_list|,
name|dviWidgetClass
argument_list|,
name|viewport
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|page
operator|=
name|XtCreateManagedWidget
argument_list|(
literal|"label"
argument_list|,
name|labelWidgetClass
argument_list|,
name|paned
argument_list|,
name|labelArgs
argument_list|,
name|XtNumber
argument_list|(
name|labelArgs
argument_list|)
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|pageNumberArgs
index|[
literal|0
index|]
argument_list|,
name|XtNpageNumber
argument_list|,
operator|&
name|page_number
argument_list|)
expr_stmt|;
name|XtGetValues
argument_list|(
name|dvi
argument_list|,
name|pageNumberArgs
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|file_name
condition|)
name|NewFile
argument_list|(
name|file_name
argument_list|)
expr_stmt|;
comment|/* NewFile modifies current_file_name, so do this here. */
if|if
condition|(
name|app_resources
operator|.
name|filename
condition|)
name|strcpy
argument_list|(
name|current_file_name
argument_list|,
name|app_resources
operator|.
name|filename
argument_list|)
expr_stmt|;
name|XtRealizeWidget
argument_list|(
name|toplevel
argument_list|)
expr_stmt|;
if|if
condition|(
name|file_name
condition|)
name|SetPageNumber
argument_list|(
name|page_number
argument_list|)
expr_stmt|;
name|XtAppMainLoop
argument_list|(
name|xtcontext
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|SetPageNumber
parameter_list|(
name|number
parameter_list|)
block|{
name|Arg
name|arg
index|[
literal|2
index|]
decl_stmt|;
name|int
name|actual_number
decl_stmt|,
name|last_page
decl_stmt|;
name|XtSetArg
argument_list|(
name|arg
index|[
literal|0
index|]
argument_list|,
name|XtNpageNumber
argument_list|,
name|number
argument_list|)
expr_stmt|;
name|XtSetValues
argument_list|(
name|dvi
argument_list|,
name|arg
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|arg
index|[
literal|0
index|]
argument_list|,
name|XtNpageNumber
argument_list|,
operator|&
name|actual_number
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|arg
index|[
literal|1
index|]
argument_list|,
name|XtNlastPageNumber
argument_list|,
operator|&
name|last_page
argument_list|)
expr_stmt|;
name|XtGetValues
argument_list|(
name|dvi
argument_list|,
name|arg
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|actual_number
operator|==
literal|0
condition|)
name|sprintf
argument_list|(
name|pageLabel
argument_list|,
literal|"Page<none>"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|last_page
operator|>
literal|0
condition|)
name|sprintf
argument_list|(
name|pageLabel
argument_list|,
literal|"Page %d of %d"
argument_list|,
name|actual_number
argument_list|,
name|last_page
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|pageLabel
argument_list|,
literal|"Page %d"
argument_list|,
name|actual_number
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|arg
index|[
literal|0
index|]
argument_list|,
name|XtNlabel
argument_list|,
name|pageLabel
argument_list|)
expr_stmt|;
name|XtSetValues
argument_list|(
name|page
argument_list|,
name|arg
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|SelectPageNumber
parameter_list|(
name|number_string
parameter_list|)
name|char
modifier|*
name|number_string
decl_stmt|;
block|{
name|SetPageNumber
argument_list|(
name|atoi
argument_list|(
name|number_string
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|int
name|hadFile
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|NewFile
parameter_list|(
name|name
parameter_list|)
name|char
modifier|*
name|name
decl_stmt|;
block|{
name|Arg
name|arg
index|[
literal|2
index|]
decl_stmt|;
name|char
modifier|*
name|n
decl_stmt|;
name|FILE
modifier|*
name|new_file
decl_stmt|;
name|Boolean
name|seek
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|current_file
condition|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|current_file_name
argument_list|,
literal|"-"
argument_list|)
condition|)
empty_stmt|;
elseif|else
if|if
condition|(
name|current_file_name
index|[
literal|0
index|]
operator|==
literal|'|'
condition|)
name|pclose
argument_list|(
name|current_file
argument_list|)
expr_stmt|;
else|else
name|fclose
argument_list|(
name|current_file
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"-"
argument_list|)
condition|)
name|new_file
operator|=
name|stdin
expr_stmt|;
elseif|else
if|if
condition|(
name|name
index|[
literal|0
index|]
operator|==
literal|'|'
condition|)
name|new_file
operator|=
name|popen
argument_list|(
name|name
operator|+
literal|1
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
else|else
block|{
name|new_file
operator|=
name|fopen
argument_list|(
name|name
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
name|seek
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|new_file
condition|)
block|{
comment|/* XXX display error message */
return|return;
block|}
name|XtSetArg
argument_list|(
name|arg
index|[
literal|0
index|]
argument_list|,
name|XtNfile
argument_list|,
name|new_file
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|arg
index|[
literal|1
index|]
argument_list|,
name|XtNseek
argument_list|,
name|seek
argument_list|)
expr_stmt|;
name|XtSetValues
argument_list|(
name|dvi
argument_list|,
name|arg
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|hadFile
operator|||
name|name
index|[
literal|0
index|]
operator|!=
literal|'-'
operator|||
name|name
index|[
literal|1
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|XtSetArg
argument_list|(
name|arg
index|[
literal|0
index|]
argument_list|,
name|XtNtitle
argument_list|,
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|name
index|[
literal|0
index|]
operator|!=
literal|'/'
operator|&&
operator|(
name|n
operator|=
name|strrchr
argument_list|(
name|name
argument_list|,
literal|'/'
argument_list|)
operator|)
condition|)
name|n
operator|=
name|n
operator|+
literal|1
expr_stmt|;
else|else
name|n
operator|=
name|name
expr_stmt|;
name|XtSetArg
argument_list|(
name|arg
index|[
literal|1
index|]
argument_list|,
name|XtNiconName
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|XtSetValues
argument_list|(
name|toplevel
argument_list|,
name|arg
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
name|hadFile
operator|=
literal|1
expr_stmt|;
name|SelectPageNumber
argument_list|(
literal|"1"
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|current_file_name
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|current_file
operator|=
name|new_file
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|char
name|fileBuf
index|[
literal|1024
index|]
decl_stmt|;
end_decl_stmt

begin_macro
name|ResetMenuEntry
argument_list|(
argument|entry
argument_list|)
end_macro

begin_decl_stmt
name|Widget
name|entry
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|Arg
name|arg
index|[
literal|1
index|]
decl_stmt|;
name|XtSetArg
argument_list|(
name|arg
index|[
literal|0
index|]
argument_list|,
name|XtNpopupOnEntry
argument_list|,
name|entry
argument_list|)
expr_stmt|;
name|XtSetValues
argument_list|(
name|XtParent
argument_list|(
name|entry
argument_list|)
argument_list|,
name|arg
argument_list|,
operator|(
name|Cardinal
operator|)
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|NextPage
parameter_list|(
name|entry
parameter_list|,
name|name
parameter_list|,
name|data
parameter_list|)
name|Widget
name|entry
decl_stmt|;
name|caddr_t
name|name
decl_stmt|,
name|data
decl_stmt|;
block|{
name|NextPageAction
argument_list|()
expr_stmt|;
name|ResetMenuEntry
argument_list|(
name|entry
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|NextPageAction
parameter_list|()
block|{
name|Arg
name|args
index|[
literal|1
index|]
decl_stmt|;
name|int
name|number
decl_stmt|;
name|XtSetArg
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|,
name|XtNpageNumber
argument_list|,
operator|&
name|number
argument_list|)
expr_stmt|;
name|XtGetValues
argument_list|(
name|dvi
argument_list|,
name|args
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|SetPageNumber
argument_list|(
name|number
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|PreviousPage
parameter_list|(
name|entry
parameter_list|,
name|name
parameter_list|,
name|data
parameter_list|)
name|Widget
name|entry
decl_stmt|;
name|caddr_t
name|name
decl_stmt|,
name|data
decl_stmt|;
block|{
name|PreviousPageAction
argument_list|()
expr_stmt|;
name|ResetMenuEntry
argument_list|(
name|entry
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|PreviousPageAction
parameter_list|()
block|{
name|Arg
name|args
index|[
literal|1
index|]
decl_stmt|;
name|int
name|number
decl_stmt|;
name|XtSetArg
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|,
name|XtNpageNumber
argument_list|,
operator|&
name|number
argument_list|)
expr_stmt|;
name|XtGetValues
argument_list|(
name|dvi
argument_list|,
name|args
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|SetPageNumber
argument_list|(
name|number
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ARGSUSED */
end_comment

begin_function
specifier|static
name|void
name|SelectPage
parameter_list|(
name|entry
parameter_list|,
name|name
parameter_list|,
name|data
parameter_list|)
name|Widget
name|entry
decl_stmt|;
name|caddr_t
name|name
decl_stmt|,
name|data
decl_stmt|;
block|{
name|SelectPageAction
argument_list|()
expr_stmt|;
name|ResetMenuEntry
argument_list|(
name|entry
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|SelectPageAction
parameter_list|()
block|{
name|MakePrompt
argument_list|(
name|toplevel
argument_list|,
literal|"Page number"
argument_list|,
name|SelectPageNumber
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|DoPrint
parameter_list|(
name|name
parameter_list|)
name|char
modifier|*
name|name
decl_stmt|;
block|{
name|FILE
modifier|*
name|print_file
decl_stmt|;
ifdef|#
directive|ifdef
name|SIGNALRETURNSINT
name|int
function_decl|(
modifier|*
name|handler
function_decl|)
parameter_list|()
function_decl|;
else|#
directive|else
name|void
function_decl|(
modifier|*
name|handler
function_decl|)
parameter_list|()
function_decl|;
endif|#
directive|endif
comment|/* Avoid dieing because of an invalid command. */
name|handler
operator|=
name|signal
argument_list|(
name|SIGPIPE
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|print_file
operator|=
name|popen
argument_list|(
name|name
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|print_file
condition|)
comment|/* XXX print error message */
return|return;
name|DviSaveToFile
argument_list|(
name|dvi
argument_list|,
name|print_file
argument_list|)
expr_stmt|;
name|pclose
argument_list|(
name|print_file
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGPIPE
argument_list|,
name|handler
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|current_print_command
argument_list|,
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|RerasterizeAction
parameter_list|()
block|{
name|Arg
name|args
index|[
literal|1
index|]
decl_stmt|;
name|int
name|number
decl_stmt|;
if|if
condition|(
name|current_file_name
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
comment|/* XXX display an error message */
return|return;
block|}
name|XtSetArg
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|,
name|XtNpageNumber
argument_list|,
operator|&
name|number
argument_list|)
expr_stmt|;
name|XtGetValues
argument_list|(
name|dvi
argument_list|,
name|args
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|NewFile
argument_list|(
name|current_file_name
argument_list|)
expr_stmt|;
name|SetPageNumber
argument_list|(
name|number
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ARGSUSED */
end_comment

begin_function
specifier|static
name|void
name|Print
parameter_list|(
name|entry
parameter_list|,
name|name
parameter_list|,
name|data
parameter_list|)
name|Widget
name|entry
decl_stmt|;
name|caddr_t
name|name
decl_stmt|,
name|data
decl_stmt|;
block|{
name|PrintAction
argument_list|()
expr_stmt|;
name|ResetMenuEntry
argument_list|(
name|entry
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|PrintAction
parameter_list|()
block|{
if|if
condition|(
name|current_print_command
index|[
literal|0
index|]
condition|)
name|strcpy
argument_list|(
name|fileBuf
argument_list|,
name|current_print_command
argument_list|)
expr_stmt|;
else|else
name|fileBuf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|MakePrompt
argument_list|(
name|toplevel
argument_list|,
literal|"Print command:"
argument_list|,
name|DoPrint
argument_list|,
name|fileBuf
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ARGSUSED */
end_comment

begin_function
specifier|static
name|void
name|OpenFile
parameter_list|(
name|entry
parameter_list|,
name|name
parameter_list|,
name|data
parameter_list|)
name|Widget
name|entry
decl_stmt|;
name|caddr_t
name|name
decl_stmt|,
name|data
decl_stmt|;
block|{
name|OpenFileAction
argument_list|()
expr_stmt|;
name|ResetMenuEntry
argument_list|(
name|entry
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|OpenFileAction
parameter_list|()
block|{
if|if
condition|(
name|current_file_name
index|[
literal|0
index|]
condition|)
name|strcpy
argument_list|(
name|fileBuf
argument_list|,
name|current_file_name
argument_list|)
expr_stmt|;
else|else
name|fileBuf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|MakePrompt
argument_list|(
name|toplevel
argument_list|,
literal|"File to open:"
argument_list|,
name|NewFile
argument_list|,
name|fileBuf
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ARGSUSED */
end_comment

begin_function
specifier|static
name|void
name|Quit
parameter_list|(
name|entry
parameter_list|,
name|closure
parameter_list|,
name|data
parameter_list|)
name|Widget
name|entry
decl_stmt|;
name|caddr_t
name|closure
decl_stmt|,
name|data
decl_stmt|;
block|{
name|QuitAction
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|QuitAction
parameter_list|()
block|{
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
name|Widget
name|promptShell
decl_stmt|,
name|promptDialog
decl_stmt|;
end_decl_stmt

begin_function_decl
name|void
function_decl|(
modifier|*
name|promptfunction
function_decl|)
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/* ARGSUSED */
end_comment

begin_function
specifier|static
name|void
name|CancelAction
parameter_list|(
name|widget
parameter_list|,
name|event
parameter_list|,
name|params
parameter_list|,
name|num_params
parameter_list|)
name|Widget
name|widget
decl_stmt|;
name|XEvent
modifier|*
name|event
decl_stmt|;
name|String
modifier|*
name|params
decl_stmt|;
name|Cardinal
modifier|*
name|num_params
decl_stmt|;
block|{
if|if
condition|(
name|promptShell
condition|)
block|{
name|XtSetKeyboardFocus
argument_list|(
name|toplevel
argument_list|,
operator|(
name|Widget
operator|)
name|None
argument_list|)
expr_stmt|;
name|XtDestroyWidget
argument_list|(
name|promptShell
argument_list|)
expr_stmt|;
name|promptShell
operator|=
operator|(
name|Widget
operator|)
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|AcceptAction
parameter_list|(
name|widget
parameter_list|,
name|event
parameter_list|,
name|params
parameter_list|,
name|num_params
parameter_list|)
name|Widget
name|widget
decl_stmt|;
name|XEvent
modifier|*
name|event
decl_stmt|;
name|String
modifier|*
name|params
decl_stmt|;
name|Cardinal
modifier|*
name|num_params
decl_stmt|;
block|{
call|(
modifier|*
name|promptfunction
call|)
argument_list|(
name|XawDialogGetValueString
argument_list|(
name|promptDialog
argument_list|)
argument_list|)
expr_stmt|;
name|CancelAction
argument_list|(
name|widget
argument_list|,
name|event
argument_list|,
name|params
argument_list|,
name|num_params
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|MakePrompt
argument_list|(
argument|centerw
argument_list|,
argument|prompt
argument_list|,
argument|func
argument_list|,
argument|def
argument_list|)
end_macro

begin_decl_stmt
name|Widget
name|centerw
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|prompt
decl_stmt|;
end_decl_stmt

begin_function_decl
name|void
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|char
modifier|*
name|def
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|static
name|Arg
name|dialogArgs
index|[]
init|=
block|{
block|{
name|XtNlabel
block|,
literal|0
block|}
block|,
block|{
name|XtNvalue
block|,
literal|0
block|}
block|,     }
decl_stmt|;
name|Arg
name|valueArgs
index|[
literal|1
index|]
decl_stmt|;
name|Arg
name|centerArgs
index|[
literal|2
index|]
decl_stmt|;
name|Position
name|source_x
decl_stmt|,
name|source_y
decl_stmt|;
name|Position
name|dest_x
decl_stmt|,
name|dest_y
decl_stmt|;
name|Dimension
name|center_width
decl_stmt|,
name|center_height
decl_stmt|;
name|Dimension
name|prompt_width
decl_stmt|,
name|prompt_height
decl_stmt|;
name|Widget
name|valueWidget
decl_stmt|;
name|CancelAction
argument_list|(
operator|(
name|Widget
operator|)
name|NULL
argument_list|,
operator|(
name|XEvent
operator|*
operator|)
literal|0
argument_list|,
operator|(
name|String
operator|*
operator|)
literal|0
argument_list|,
operator|(
name|Cardinal
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|promptShell
operator|=
name|XtCreatePopupShell
argument_list|(
literal|"promptShell"
argument_list|,
name|transientShellWidgetClass
argument_list|,
name|toplevel
argument_list|,
name|NULL
argument_list|,
operator|(
name|Cardinal
operator|)
literal|0
argument_list|)
expr_stmt|;
name|dialogArgs
index|[
literal|0
index|]
operator|.
name|value
operator|=
operator|(
name|XtArgVal
operator|)
name|prompt
expr_stmt|;
name|dialogArgs
index|[
literal|1
index|]
operator|.
name|value
operator|=
operator|(
name|XtArgVal
operator|)
name|def
expr_stmt|;
name|promptDialog
operator|=
name|XtCreateManagedWidget
argument_list|(
literal|"promptDialog"
argument_list|,
name|dialogWidgetClass
argument_list|,
name|promptShell
argument_list|,
name|dialogArgs
argument_list|,
name|XtNumber
argument_list|(
name|dialogArgs
argument_list|)
argument_list|)
expr_stmt|;
name|XawDialogAddButton
argument_list|(
name|promptDialog
argument_list|,
literal|"accept"
argument_list|,
name|NULL
argument_list|,
operator|(
name|caddr_t
operator|)
literal|0
argument_list|)
expr_stmt|;
name|XawDialogAddButton
argument_list|(
name|promptDialog
argument_list|,
literal|"cancel"
argument_list|,
name|NULL
argument_list|,
operator|(
name|caddr_t
operator|)
literal|0
argument_list|)
expr_stmt|;
name|valueWidget
operator|=
name|XtNameToWidget
argument_list|(
name|promptDialog
argument_list|,
literal|"value"
argument_list|)
expr_stmt|;
if|if
condition|(
name|valueWidget
condition|)
block|{
name|XtSetArg
argument_list|(
name|valueArgs
index|[
literal|0
index|]
argument_list|,
name|XtNresizable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|XtSetValues
argument_list|(
name|valueWidget
argument_list|,
name|valueArgs
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* 	 * as resizable isn't set until just above, the 	 * default value will be displayed incorrectly. 	 * rectify the situation by resetting the values 	 */
name|XtSetValues
argument_list|(
name|promptDialog
argument_list|,
name|dialogArgs
argument_list|,
name|XtNumber
argument_list|(
name|dialogArgs
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|XtSetKeyboardFocus
argument_list|(
name|promptDialog
argument_list|,
name|valueWidget
argument_list|)
expr_stmt|;
name|XtSetKeyboardFocus
argument_list|(
name|toplevel
argument_list|,
name|valueWidget
argument_list|)
expr_stmt|;
name|XtRealizeWidget
argument_list|(
name|promptShell
argument_list|)
expr_stmt|;
comment|/*      * place the widget in the center of the "parent"      */
name|XtSetArg
argument_list|(
name|centerArgs
index|[
literal|0
index|]
argument_list|,
name|XtNwidth
argument_list|,
operator|&
name|center_width
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|centerArgs
index|[
literal|1
index|]
argument_list|,
name|XtNheight
argument_list|,
operator|&
name|center_height
argument_list|)
expr_stmt|;
name|XtGetValues
argument_list|(
name|centerw
argument_list|,
name|centerArgs
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|centerArgs
index|[
literal|0
index|]
argument_list|,
name|XtNwidth
argument_list|,
operator|&
name|prompt_width
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|centerArgs
index|[
literal|1
index|]
argument_list|,
name|XtNheight
argument_list|,
operator|&
name|prompt_height
argument_list|)
expr_stmt|;
name|XtGetValues
argument_list|(
name|promptShell
argument_list|,
name|centerArgs
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|source_x
operator|=
operator|(
name|center_width
operator|-
name|prompt_width
operator|)
operator|/
literal|2
expr_stmt|;
name|source_y
operator|=
operator|(
name|center_height
operator|-
name|prompt_height
operator|)
operator|/
literal|3
expr_stmt|;
name|XtTranslateCoords
argument_list|(
name|centerw
argument_list|,
name|source_x
argument_list|,
name|source_y
argument_list|,
operator|&
name|dest_x
argument_list|,
operator|&
name|dest_y
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|centerArgs
index|[
literal|0
index|]
argument_list|,
name|XtNx
argument_list|,
name|dest_x
argument_list|)
expr_stmt|;
name|XtSetArg
argument_list|(
name|centerArgs
index|[
literal|1
index|]
argument_list|,
name|XtNy
argument_list|,
name|dest_y
argument_list|)
expr_stmt|;
name|XtSetValues
argument_list|(
name|promptShell
argument_list|,
name|centerArgs
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|XtMapWidget
argument_list|(
name|promptShell
argument_list|)
expr_stmt|;
name|promptfunction
operator|=
name|func
expr_stmt|;
block|}
end_block

begin_comment
comment|/* For DviChar.c */
end_comment

begin_function
name|char
modifier|*
name|xmalloc
parameter_list|(
name|n
parameter_list|)
name|int
name|n
decl_stmt|;
block|{
return|return
name|XtMalloc
argument_list|(
name|n
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Local Variables: c-indent-level: 4 c-continued-statement-offset: 4 c-brace-offset: -4 c-argdecl-indent: 4 c-label-offset: -4 c-tab-always-indent: nil End: */
end_comment

end_unit

