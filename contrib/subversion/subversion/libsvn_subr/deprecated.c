begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * deprecated.c:  holding file for all deprecated APIs.  *                "we can't lose 'em, but we can shun 'em!"  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_comment
comment|/* ==================================================================== */
end_comment

begin_escape
end_escape

begin_include
include|#
directive|include
file|<assert.h>
end_include

begin_comment
comment|/* We define this here to remove any further warnings about the usage of    deprecated functions in this file. */
end_comment

begin_define
define|#
directive|define
name|SVN_DEPRECATED
end_define

begin_include
include|#
directive|include
file|"svn_hash.h"
end_include

begin_include
include|#
directive|include
file|"svn_subst.h"
end_include

begin_include
include|#
directive|include
file|"svn_path.h"
end_include

begin_include
include|#
directive|include
file|"svn_opt.h"
end_include

begin_include
include|#
directive|include
file|"svn_cmdline.h"
end_include

begin_include
include|#
directive|include
file|"svn_version.h"
end_include

begin_include
include|#
directive|include
file|"svn_pools.h"
end_include

begin_include
include|#
directive|include
file|"svn_dso.h"
end_include

begin_include
include|#
directive|include
file|"svn_mergeinfo.h"
end_include

begin_include
include|#
directive|include
file|"svn_utf.h"
end_include

begin_include
include|#
directive|include
file|"svn_xml.h"
end_include

begin_include
include|#
directive|include
file|"opt.h"
end_include

begin_include
include|#
directive|include
file|"private/svn_opt_private.h"
end_include

begin_include
include|#
directive|include
file|"private/svn_mergeinfo_private.h"
end_include

begin_include
include|#
directive|include
file|"private/svn_subr_private.h"
end_include

begin_include
include|#
directive|include
file|"svn_private_config.h"
end_include

begin_escape
end_escape

begin_comment
comment|/*** Code. ***/
end_comment

begin_comment
comment|/*** From subst.c ***/
end_comment

begin_comment
comment|/* Convert an old-style svn_subst_keywords_t struct * into a new-style  * keywords hash.  Keyword values are shallow copies, so the produced  * hash must not be assumed to have lifetime longer than the struct it  * is based on.  A NULL input causes a NULL output. */
end_comment

begin_function
specifier|static
name|apr_hash_t
modifier|*
name|kwstruct_to_kwhash
parameter_list|(
specifier|const
name|svn_subst_keywords_t
modifier|*
name|kwstruct
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_hash_t
modifier|*
name|kwhash
decl_stmt|;
if|if
condition|(
name|kwstruct
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|kwhash
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|kwstruct
operator|->
name|revision
condition|)
block|{
name|svn_hash_sets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_REVISION_LONG
argument_list|,
name|kwstruct
operator|->
name|revision
argument_list|)
expr_stmt|;
name|svn_hash_sets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_REVISION_MEDIUM
argument_list|,
name|kwstruct
operator|->
name|revision
argument_list|)
expr_stmt|;
name|svn_hash_sets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_REVISION_SHORT
argument_list|,
name|kwstruct
operator|->
name|revision
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|kwstruct
operator|->
name|date
condition|)
block|{
name|svn_hash_sets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_DATE_LONG
argument_list|,
name|kwstruct
operator|->
name|date
argument_list|)
expr_stmt|;
name|svn_hash_sets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_DATE_SHORT
argument_list|,
name|kwstruct
operator|->
name|date
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|kwstruct
operator|->
name|author
condition|)
block|{
name|svn_hash_sets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_AUTHOR_LONG
argument_list|,
name|kwstruct
operator|->
name|author
argument_list|)
expr_stmt|;
name|svn_hash_sets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_AUTHOR_SHORT
argument_list|,
name|kwstruct
operator|->
name|author
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|kwstruct
operator|->
name|url
condition|)
block|{
name|svn_hash_sets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_URL_LONG
argument_list|,
name|kwstruct
operator|->
name|url
argument_list|)
expr_stmt|;
name|svn_hash_sets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_URL_SHORT
argument_list|,
name|kwstruct
operator|->
name|url
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|kwstruct
operator|->
name|id
condition|)
block|{
name|svn_hash_sets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_ID
argument_list|,
name|kwstruct
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
return|return
name|kwhash
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_translate_stream3
parameter_list|(
name|svn_stream_t
modifier|*
name|src_stream
parameter_list|,
name|svn_stream_t
modifier|*
name|dst_stream
parameter_list|,
specifier|const
name|char
modifier|*
name|eol_str
parameter_list|,
name|svn_boolean_t
name|repair
parameter_list|,
name|apr_hash_t
modifier|*
name|keywords
parameter_list|,
name|svn_boolean_t
name|expand
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
comment|/* The docstring requires that *some* translation be requested. */
name|SVN_ERR_ASSERT
argument_list|(
name|eol_str
operator|||
name|keywords
argument_list|)
expr_stmt|;
comment|/* We don't want the copy3 to close the provided streams. */
name|src_stream
operator|=
name|svn_stream_disown
argument_list|(
name|src_stream
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|dst_stream
operator|=
name|svn_stream_disown
argument_list|(
name|dst_stream
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* Wrap the destination stream with our translation stream. It is more      efficient than wrapping the source stream. */
name|dst_stream
operator|=
name|svn_subst_stream_translated
argument_list|(
name|dst_stream
argument_list|,
name|eol_str
argument_list|,
name|repair
argument_list|,
name|keywords
argument_list|,
name|expand
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_stream_copy3
argument_list|(
name|src_stream
argument_list|,
name|dst_stream
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_translate_stream2
parameter_list|(
name|svn_stream_t
modifier|*
name|s
parameter_list|,
comment|/* src stream */
name|svn_stream_t
modifier|*
name|d
parameter_list|,
comment|/* dst stream */
specifier|const
name|char
modifier|*
name|eol_str
parameter_list|,
name|svn_boolean_t
name|repair
parameter_list|,
specifier|const
name|svn_subst_keywords_t
modifier|*
name|keywords
parameter_list|,
name|svn_boolean_t
name|expand
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_hash_t
modifier|*
name|kh
init|=
name|kwstruct_to_kwhash
argument_list|(
name|keywords
argument_list|,
name|pool
argument_list|)
decl_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_subst_translate_stream3
argument_list|(
name|s
argument_list|,
name|d
argument_list|,
name|eol_str
argument_list|,
name|repair
argument_list|,
name|kh
argument_list|,
name|expand
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_translate_stream
parameter_list|(
name|svn_stream_t
modifier|*
name|s
parameter_list|,
comment|/* src stream */
name|svn_stream_t
modifier|*
name|d
parameter_list|,
comment|/* dst stream */
specifier|const
name|char
modifier|*
name|eol_str
parameter_list|,
name|svn_boolean_t
name|repair
parameter_list|,
specifier|const
name|svn_subst_keywords_t
modifier|*
name|keywords
parameter_list|,
name|svn_boolean_t
name|expand
parameter_list|)
block|{
name|apr_pool_t
modifier|*
name|pool
init|=
name|svn_pool_create
argument_list|(
name|NULL
argument_list|)
decl_stmt|;
name|svn_error_t
modifier|*
name|err
init|=
name|svn_subst_translate_stream2
argument_list|(
name|s
argument_list|,
name|d
argument_list|,
name|eol_str
argument_list|,
name|repair
argument_list|,
name|keywords
argument_list|,
name|expand
argument_list|,
name|pool
argument_list|)
decl_stmt|;
name|svn_pool_destroy
argument_list|(
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_translate_cstring
parameter_list|(
specifier|const
name|char
modifier|*
name|src
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|dst
parameter_list|,
specifier|const
name|char
modifier|*
name|eol_str
parameter_list|,
name|svn_boolean_t
name|repair
parameter_list|,
specifier|const
name|svn_subst_keywords_t
modifier|*
name|keywords
parameter_list|,
name|svn_boolean_t
name|expand
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_hash_t
modifier|*
name|kh
init|=
name|kwstruct_to_kwhash
argument_list|(
name|keywords
argument_list|,
name|pool
argument_list|)
decl_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_subst_translate_cstring2
argument_list|(
name|src
argument_list|,
name|dst
argument_list|,
name|eol_str
argument_list|,
name|repair
argument_list|,
name|kh
argument_list|,
name|expand
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_copy_and_translate
parameter_list|(
specifier|const
name|char
modifier|*
name|src
parameter_list|,
specifier|const
name|char
modifier|*
name|dst
parameter_list|,
specifier|const
name|char
modifier|*
name|eol_str
parameter_list|,
name|svn_boolean_t
name|repair
parameter_list|,
specifier|const
name|svn_subst_keywords_t
modifier|*
name|keywords
parameter_list|,
name|svn_boolean_t
name|expand
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_subst_copy_and_translate2
argument_list|(
name|src
argument_list|,
name|dst
argument_list|,
name|eol_str
argument_list|,
name|repair
argument_list|,
name|keywords
argument_list|,
name|expand
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_copy_and_translate2
parameter_list|(
specifier|const
name|char
modifier|*
name|src
parameter_list|,
specifier|const
name|char
modifier|*
name|dst
parameter_list|,
specifier|const
name|char
modifier|*
name|eol_str
parameter_list|,
name|svn_boolean_t
name|repair
parameter_list|,
specifier|const
name|svn_subst_keywords_t
modifier|*
name|keywords
parameter_list|,
name|svn_boolean_t
name|expand
parameter_list|,
name|svn_boolean_t
name|special
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_hash_t
modifier|*
name|kh
init|=
name|kwstruct_to_kwhash
argument_list|(
name|keywords
argument_list|,
name|pool
argument_list|)
decl_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_subst_copy_and_translate3
argument_list|(
name|src
argument_list|,
name|dst
argument_list|,
name|eol_str
argument_list|,
name|repair
argument_list|,
name|kh
argument_list|,
name|expand
argument_list|,
name|special
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_copy_and_translate3
parameter_list|(
specifier|const
name|char
modifier|*
name|src
parameter_list|,
specifier|const
name|char
modifier|*
name|dst
parameter_list|,
specifier|const
name|char
modifier|*
name|eol_str
parameter_list|,
name|svn_boolean_t
name|repair
parameter_list|,
name|apr_hash_t
modifier|*
name|keywords
parameter_list|,
name|svn_boolean_t
name|expand
parameter_list|,
name|svn_boolean_t
name|special
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_subst_copy_and_translate4
argument_list|(
name|src
argument_list|,
name|dst
argument_list|,
name|eol_str
argument_list|,
name|repair
argument_list|,
name|keywords
argument_list|,
name|expand
argument_list|,
name|special
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_stream_translated_to_normal_form
parameter_list|(
name|svn_stream_t
modifier|*
modifier|*
name|stream
parameter_list|,
name|svn_stream_t
modifier|*
name|source
parameter_list|,
name|svn_subst_eol_style_t
name|eol_style
parameter_list|,
specifier|const
name|char
modifier|*
name|eol_str
parameter_list|,
name|svn_boolean_t
name|always_repair_eols
parameter_list|,
name|apr_hash_t
modifier|*
name|keywords
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
if|if
condition|(
name|eol_style
operator|==
name|svn_subst_eol_style_native
condition|)
name|eol_str
operator|=
name|SVN_SUBST_NATIVE_EOL_STR
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|eol_style
operator|==
name|svn_subst_eol_style_fixed
operator|||
name|eol_style
operator|==
name|svn_subst_eol_style_none
operator|)
condition|)
return|return
name|svn_error_create
argument_list|(
name|SVN_ERR_IO_UNKNOWN_EOL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
return|;
operator|*
name|stream
operator|=
name|svn_subst_stream_translated
argument_list|(
name|source
argument_list|,
name|eol_str
argument_list|,
name|eol_style
operator|==
name|svn_subst_eol_style_fixed
operator|||
name|always_repair_eols
argument_list|,
name|keywords
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_translate_string
parameter_list|(
name|svn_string_t
modifier|*
modifier|*
name|new_value
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|value
parameter_list|,
specifier|const
name|char
modifier|*
name|encoding
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_subst_translate_string2
argument_list|(
name|new_value
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|value
argument_list|,
name|encoding
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_stream_detranslated
parameter_list|(
name|svn_stream_t
modifier|*
modifier|*
name|stream_p
parameter_list|,
specifier|const
name|char
modifier|*
name|src
parameter_list|,
name|svn_subst_eol_style_t
name|eol_style
parameter_list|,
specifier|const
name|char
modifier|*
name|eol_str
parameter_list|,
name|svn_boolean_t
name|always_repair_eols
parameter_list|,
name|apr_hash_t
modifier|*
name|keywords
parameter_list|,
name|svn_boolean_t
name|special
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_stream_t
modifier|*
name|src_stream
decl_stmt|;
if|if
condition|(
name|special
condition|)
return|return
name|svn_subst_read_specialfile
argument_list|(
name|stream_p
argument_list|,
name|src
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
return|;
comment|/* This will be closed by svn_subst_stream_translated_to_normal_form      when the returned stream is closed. */
name|SVN_ERR
argument_list|(
name|svn_stream_open_readonly
argument_list|(
operator|&
name|src_stream
argument_list|,
name|src
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_subst_stream_translated_to_normal_form
argument_list|(
name|stream_p
argument_list|,
name|src_stream
argument_list|,
name|eol_style
argument_list|,
name|eol_str
argument_list|,
name|always_repair_eols
argument_list|,
name|keywords
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_translate_to_normal_form
parameter_list|(
specifier|const
name|char
modifier|*
name|src
parameter_list|,
specifier|const
name|char
modifier|*
name|dst
parameter_list|,
name|svn_subst_eol_style_t
name|eol_style
parameter_list|,
specifier|const
name|char
modifier|*
name|eol_str
parameter_list|,
name|svn_boolean_t
name|always_repair_eols
parameter_list|,
name|apr_hash_t
modifier|*
name|keywords
parameter_list|,
name|svn_boolean_t
name|special
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
if|if
condition|(
name|eol_style
operator|==
name|svn_subst_eol_style_native
condition|)
name|eol_str
operator|=
name|SVN_SUBST_NATIVE_EOL_STR
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|eol_style
operator|==
name|svn_subst_eol_style_fixed
operator|||
name|eol_style
operator|==
name|svn_subst_eol_style_none
operator|)
condition|)
return|return
name|svn_error_create
argument_list|(
name|SVN_ERR_IO_UNKNOWN_EOL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
return|;
return|return
name|svn_error_trace
argument_list|(
name|svn_subst_copy_and_translate3
argument_list|(
name|src
argument_list|,
name|dst
argument_list|,
name|eol_str
argument_list|,
name|eol_style
operator|==
name|svn_subst_eol_style_fixed
operator|||
name|always_repair_eols
argument_list|,
name|keywords
argument_list|,
name|FALSE
comment|/* contract keywords */
argument_list|,
name|special
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From opt.c ***/
end_comment

begin_comment
comment|/* Same as print_command_info2(), but with deprecated struct revision. */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|print_command_info
parameter_list|(
specifier|const
name|svn_opt_subcommand_desc_t
modifier|*
name|cmd
parameter_list|,
specifier|const
name|apr_getopt_option_t
modifier|*
name|options_table
parameter_list|,
name|svn_boolean_t
name|help
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|svn_boolean_t
name|first_time
decl_stmt|;
name|apr_size_t
name|i
decl_stmt|;
comment|/* Print the canonical command name. */
name|SVN_ERR
argument_list|(
name|svn_cmdline_fputs
argument_list|(
name|cmd
operator|->
name|name
argument_list|,
name|stream
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Print the list of aliases. */
name|first_time
operator|=
name|TRUE
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SVN_OPT_MAX_ALIASES
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|cmd
operator|->
name|aliases
index|[
name|i
index|]
operator|==
name|NULL
condition|)
break|break;
if|if
condition|(
name|first_time
condition|)
block|{
name|SVN_ERR
argument_list|(
name|svn_cmdline_fputs
argument_list|(
literal|" ("
argument_list|,
name|stream
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|first_time
operator|=
name|FALSE
expr_stmt|;
block|}
else|else
name|SVN_ERR
argument_list|(
name|svn_cmdline_fputs
argument_list|(
literal|", "
argument_list|,
name|stream
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_cmdline_fputs
argument_list|(
name|cmd
operator|->
name|aliases
index|[
name|i
index|]
argument_list|,
name|stream
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|first_time
condition|)
name|SVN_ERR
argument_list|(
name|svn_cmdline_fputs
argument_list|(
literal|")"
argument_list|,
name|stream
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|help
condition|)
block|{
specifier|const
name|apr_getopt_option_t
modifier|*
name|option
decl_stmt|;
name|svn_boolean_t
name|have_options
init|=
name|FALSE
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_cmdline_fprintf
argument_list|(
name|stream
argument_list|,
name|pool
argument_list|,
literal|": %s"
argument_list|,
name|_
argument_list|(
name|cmd
operator|->
name|help
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Loop over all valid option codes attached to the subcommand */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SVN_OPT_MAX_OPTIONS
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|cmd
operator|->
name|valid_options
index|[
name|i
index|]
condition|)
block|{
if|if
condition|(
operator|!
name|have_options
condition|)
block|{
name|SVN_ERR
argument_list|(
name|svn_cmdline_fputs
argument_list|(
name|_
argument_list|(
literal|"\nValid options:\n"
argument_list|)
argument_list|,
name|stream
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|have_options
operator|=
name|TRUE
expr_stmt|;
block|}
comment|/* convert each option code into an option */
name|option
operator|=
name|svn_opt_get_option_from_code2
argument_list|(
name|cmd
operator|->
name|valid_options
index|[
name|i
index|]
argument_list|,
name|options_table
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
expr_stmt|;
comment|/* print the option's docstring */
if|if
condition|(
name|option
operator|&&
name|option
operator|->
name|description
condition|)
block|{
specifier|const
name|char
modifier|*
name|optstr
decl_stmt|;
name|svn_opt_format_option
argument_list|(
operator|&
name|optstr
argument_list|,
name|option
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_cmdline_fprintf
argument_list|(
name|stream
argument_list|,
name|pool
argument_list|,
literal|"  %s\n"
argument_list|,
name|optstr
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|have_options
condition|)
name|SVN_ERR
argument_list|(
name|svn_cmdline_fprintf
argument_list|(
name|stream
argument_list|,
name|pool
argument_list|,
literal|"\n"
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|const
name|svn_opt_subcommand_desc_t
modifier|*
name|svn_opt_get_canonical_subcommand
parameter_list|(
specifier|const
name|svn_opt_subcommand_desc_t
modifier|*
name|table
parameter_list|,
specifier|const
name|char
modifier|*
name|cmd_name
parameter_list|)
block|{
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|cmd_name
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
while|while
condition|(
name|table
index|[
name|i
index|]
operator|.
name|name
condition|)
block|{
name|int
name|j
decl_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|cmd_name
argument_list|,
name|table
index|[
name|i
index|]
operator|.
name|name
argument_list|)
operator|==
literal|0
condition|)
return|return
name|table
operator|+
name|i
return|;
for|for
control|(
name|j
operator|=
literal|0
init|;
operator|(
name|j
operator|<
name|SVN_OPT_MAX_ALIASES
operator|)
operator|&&
name|table
index|[
name|i
index|]
operator|.
name|aliases
index|[
name|j
index|]
condition|;
name|j
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|cmd_name
argument_list|,
name|table
index|[
name|i
index|]
operator|.
name|aliases
index|[
name|j
index|]
argument_list|)
operator|==
literal|0
condition|)
return|return
name|table
operator|+
name|i
return|;
name|i
operator|++
expr_stmt|;
block|}
comment|/* If we get here, there was no matching subcommand name or alias. */
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|void
name|svn_opt_subcommand_help2
parameter_list|(
specifier|const
name|char
modifier|*
name|subcommand
parameter_list|,
specifier|const
name|svn_opt_subcommand_desc2_t
modifier|*
name|table
parameter_list|,
specifier|const
name|apr_getopt_option_t
modifier|*
name|options_table
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_opt_subcommand_help3
argument_list|(
name|subcommand
argument_list|,
name|table
argument_list|,
name|options_table
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|svn_opt_subcommand_help
parameter_list|(
specifier|const
name|char
modifier|*
name|subcommand
parameter_list|,
specifier|const
name|svn_opt_subcommand_desc_t
modifier|*
name|table
parameter_list|,
specifier|const
name|apr_getopt_option_t
modifier|*
name|options_table
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|svn_opt_subcommand_desc_t
modifier|*
name|cmd
init|=
name|svn_opt_get_canonical_subcommand
argument_list|(
name|table
argument_list|,
name|subcommand
argument_list|)
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
if|if
condition|(
name|cmd
condition|)
name|err
operator|=
name|print_command_info
argument_list|(
name|cmd
argument_list|,
name|options_table
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
else|else
name|err
operator|=
name|svn_cmdline_fprintf
argument_list|(
name|stderr
argument_list|,
name|pool
argument_list|,
name|_
argument_list|(
literal|"\"%s\": unknown command.\n\n"
argument_list|)
argument_list|,
name|subcommand
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|svn_handle_error2
argument_list|(
name|err
argument_list|,
name|stderr
argument_list|,
name|FALSE
argument_list|,
literal|"svn: "
argument_list|)
expr_stmt|;
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_opt_args_to_target_array3
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|targets_p
parameter_list|,
name|apr_getopt_t
modifier|*
name|os
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|known_targets
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_opt__args_to_target_array
argument_list|(
name|targets_p
argument_list|,
name|os
argument_list|,
name|known_targets
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_opt_args_to_target_array2
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|targets_p
parameter_list|,
name|apr_getopt_t
modifier|*
name|os
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|known_targets
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_error_t
modifier|*
name|err
init|=
name|svn_opt_args_to_target_array3
argument_list|(
name|targets_p
argument_list|,
name|os
argument_list|,
name|known_targets
argument_list|,
name|pool
argument_list|)
decl_stmt|;
if|if
condition|(
name|err
operator|&&
name|err
operator|->
name|apr_err
operator|==
name|SVN_ERR_RESERVED_FILENAME_SPECIFIED
condition|)
block|{
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
return|return
name|err
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_opt_args_to_target_array
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|targets_p
parameter_list|,
name|apr_getopt_t
modifier|*
name|os
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|known_targets
parameter_list|,
name|svn_opt_revision_t
modifier|*
name|start_revision
parameter_list|,
name|svn_opt_revision_t
modifier|*
name|end_revision
parameter_list|,
name|svn_boolean_t
name|extract_revisions
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|output_targets
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_opt_args_to_target_array2
argument_list|(
operator|&
name|output_targets
argument_list|,
name|os
argument_list|,
name|known_targets
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|extract_revisions
condition|)
block|{
name|svn_opt_revision_t
name|temprev
decl_stmt|;
specifier|const
name|char
modifier|*
name|path
decl_stmt|;
if|if
condition|(
name|output_targets
operator|->
name|nelts
operator|>
literal|0
condition|)
block|{
name|path
operator|=
name|APR_ARRAY_IDX
argument_list|(
name|output_targets
argument_list|,
literal|0
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_opt_parse_path
argument_list|(
operator|&
name|temprev
argument_list|,
operator|&
name|path
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|temprev
operator|.
name|kind
operator|!=
name|svn_opt_revision_unspecified
condition|)
block|{
name|APR_ARRAY_IDX
argument_list|(
name|output_targets
argument_list|,
literal|0
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
operator|=
name|path
expr_stmt|;
name|start_revision
operator|->
name|kind
operator|=
name|temprev
operator|.
name|kind
expr_stmt|;
name|start_revision
operator|->
name|value
operator|=
name|temprev
operator|.
name|value
expr_stmt|;
block|}
block|}
if|if
condition|(
name|output_targets
operator|->
name|nelts
operator|>
literal|1
condition|)
block|{
name|path
operator|=
name|APR_ARRAY_IDX
argument_list|(
name|output_targets
argument_list|,
literal|1
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_opt_parse_path
argument_list|(
operator|&
name|temprev
argument_list|,
operator|&
name|path
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|temprev
operator|.
name|kind
operator|!=
name|svn_opt_revision_unspecified
condition|)
block|{
name|APR_ARRAY_IDX
argument_list|(
name|output_targets
argument_list|,
literal|1
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
operator|=
name|path
expr_stmt|;
name|end_revision
operator|->
name|kind
operator|=
name|temprev
operator|.
name|kind
expr_stmt|;
name|end_revision
operator|->
name|value
operator|=
name|temprev
operator|.
name|value
expr_stmt|;
block|}
block|}
block|}
operator|*
name|targets_p
operator|=
name|output_targets
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_opt_print_help3
parameter_list|(
name|apr_getopt_t
modifier|*
name|os
parameter_list|,
specifier|const
name|char
modifier|*
name|pgm_name
parameter_list|,
name|svn_boolean_t
name|print_version
parameter_list|,
name|svn_boolean_t
name|quiet
parameter_list|,
specifier|const
name|char
modifier|*
name|version_footer
parameter_list|,
specifier|const
name|char
modifier|*
name|header
parameter_list|,
specifier|const
name|svn_opt_subcommand_desc2_t
modifier|*
name|cmd_table
parameter_list|,
specifier|const
name|apr_getopt_option_t
modifier|*
name|option_table
parameter_list|,
specifier|const
name|int
modifier|*
name|global_options
parameter_list|,
specifier|const
name|char
modifier|*
name|footer
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_opt_print_help4
argument_list|(
name|os
argument_list|,
name|pgm_name
argument_list|,
name|print_version
argument_list|,
name|quiet
argument_list|,
name|FALSE
argument_list|,
name|version_footer
argument_list|,
name|header
argument_list|,
name|cmd_table
argument_list|,
name|option_table
argument_list|,
name|global_options
argument_list|,
name|footer
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_opt_print_help2
parameter_list|(
name|apr_getopt_t
modifier|*
name|os
parameter_list|,
specifier|const
name|char
modifier|*
name|pgm_name
parameter_list|,
name|svn_boolean_t
name|print_version
parameter_list|,
name|svn_boolean_t
name|quiet
parameter_list|,
specifier|const
name|char
modifier|*
name|version_footer
parameter_list|,
specifier|const
name|char
modifier|*
name|header
parameter_list|,
specifier|const
name|svn_opt_subcommand_desc2_t
modifier|*
name|cmd_table
parameter_list|,
specifier|const
name|apr_getopt_option_t
modifier|*
name|option_table
parameter_list|,
specifier|const
name|char
modifier|*
name|footer
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_opt_print_help4
argument_list|(
name|os
argument_list|,
name|pgm_name
argument_list|,
name|print_version
argument_list|,
name|quiet
argument_list|,
name|FALSE
argument_list|,
name|version_footer
argument_list|,
name|header
argument_list|,
name|cmd_table
argument_list|,
name|option_table
argument_list|,
name|NULL
argument_list|,
name|footer
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_opt_print_help
parameter_list|(
name|apr_getopt_t
modifier|*
name|os
parameter_list|,
specifier|const
name|char
modifier|*
name|pgm_name
parameter_list|,
name|svn_boolean_t
name|print_version
parameter_list|,
name|svn_boolean_t
name|quiet
parameter_list|,
specifier|const
name|char
modifier|*
name|version_footer
parameter_list|,
specifier|const
name|char
modifier|*
name|header
parameter_list|,
specifier|const
name|svn_opt_subcommand_desc_t
modifier|*
name|cmd_table
parameter_list|,
specifier|const
name|apr_getopt_option_t
modifier|*
name|option_table
parameter_list|,
specifier|const
name|char
modifier|*
name|footer
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|targets
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|os
condition|)
name|SVN_ERR
argument_list|(
name|svn_opt_parse_all_args
argument_list|(
operator|&
name|targets
argument_list|,
name|os
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|os
operator|&&
name|targets
operator|->
name|nelts
condition|)
comment|/* help on subcommand(s) requested */
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|targets
operator|->
name|nelts
condition|;
name|i
operator|++
control|)
block|{
name|svn_opt_subcommand_help
argument_list|(
name|APR_ARRAY_IDX
argument_list|(
name|targets
argument_list|,
name|i
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
argument_list|,
name|cmd_table
argument_list|,
name|option_table
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|print_version
condition|)
comment|/* just --version */
block|{
name|SVN_ERR
argument_list|(
name|svn_opt__print_version_info
argument_list|(
name|pgm_name
argument_list|,
name|version_footer
argument_list|,
name|svn_version_extended
argument_list|(
name|FALSE
argument_list|,
name|pool
argument_list|)
argument_list|,
name|quiet
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|os
operator|&&
operator|!
name|targets
operator|->
name|nelts
condition|)
comment|/* `-h', `--help', or `help' */
name|svn_opt_print_generic_help
argument_list|(
name|header
argument_list|,
name|cmd_table
argument_list|,
name|option_table
argument_list|,
name|footer
argument_list|,
name|pool
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
else|else
comment|/* unknown option or cmd */
name|SVN_ERR
argument_list|(
name|svn_cmdline_fprintf
argument_list|(
name|stderr
argument_list|,
name|pool
argument_list|,
name|_
argument_list|(
literal|"Type '%s help' for usage.\n"
argument_list|)
argument_list|,
name|pgm_name
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|void
name|svn_opt_print_generic_help
parameter_list|(
specifier|const
name|char
modifier|*
name|header
parameter_list|,
specifier|const
name|svn_opt_subcommand_desc_t
modifier|*
name|cmd_table
parameter_list|,
specifier|const
name|apr_getopt_option_t
modifier|*
name|opt_table
parameter_list|,
specifier|const
name|char
modifier|*
name|footer
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|int
name|i
init|=
literal|0
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
if|if
condition|(
name|header
condition|)
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_fputs
argument_list|(
name|header
argument_list|,
name|stream
argument_list|,
name|pool
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
while|while
condition|(
name|cmd_table
index|[
name|i
index|]
operator|.
name|name
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_fputs
argument_list|(
literal|"   "
argument_list|,
name|stream
argument_list|,
name|pool
argument_list|)
operator|)
operator|||
operator|(
name|err
operator|=
name|print_command_info
argument_list|(
name|cmd_table
operator|+
name|i
argument_list|,
name|opt_table
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|,
name|stream
argument_list|)
operator|)
operator|||
operator|(
name|err
operator|=
name|svn_cmdline_fputs
argument_list|(
literal|"\n"
argument_list|,
name|stream
argument_list|,
name|pool
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
name|i
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_fputs
argument_list|(
literal|"\n"
argument_list|,
name|stream
argument_list|,
name|pool
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
if|if
condition|(
name|footer
condition|)
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_fputs
argument_list|(
name|footer
argument_list|,
name|stream
argument_list|,
name|pool
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
return|return;
name|print_error
label|:
name|svn_handle_error2
argument_list|(
name|err
argument_list|,
name|stderr
argument_list|,
name|FALSE
argument_list|,
literal|"svn: "
argument_list|)
expr_stmt|;
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*** From io.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_io_open_unique_file2
parameter_list|(
name|apr_file_t
modifier|*
modifier|*
name|file
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|temp_path
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|suffix
parameter_list|,
name|svn_io_file_del_t
name|delete_when
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|dirpath
decl_stmt|;
specifier|const
name|char
modifier|*
name|filename
decl_stmt|;
name|svn_path_split
argument_list|(
name|path
argument_list|,
operator|&
name|dirpath
argument_list|,
operator|&
name|filename
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_io_open_uniquely_named
argument_list|(
name|file
argument_list|,
name|temp_path
argument_list|,
name|dirpath
argument_list|,
name|filename
argument_list|,
name|suffix
argument_list|,
name|delete_when
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_open_unique_file
parameter_list|(
name|apr_file_t
modifier|*
modifier|*
name|file
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|temp_path
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|suffix
parameter_list|,
name|svn_boolean_t
name|delete_on_close
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_io_open_unique_file2
argument_list|(
name|file
argument_list|,
name|temp_path
argument_list|,
name|path
argument_list|,
name|suffix
argument_list|,
name|delete_on_close
condition|?
name|svn_io_file_del_on_close
else|:
name|svn_io_file_del_none
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_run_diff
parameter_list|(
specifier|const
name|char
modifier|*
name|dir
parameter_list|,
specifier|const
name|char
modifier|*
specifier|const
modifier|*
name|user_args
parameter_list|,
name|int
name|num_user_args
parameter_list|,
specifier|const
name|char
modifier|*
name|label1
parameter_list|,
specifier|const
name|char
modifier|*
name|label2
parameter_list|,
specifier|const
name|char
modifier|*
name|from
parameter_list|,
specifier|const
name|char
modifier|*
name|to
parameter_list|,
name|int
modifier|*
name|pexitcode
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
specifier|const
name|char
modifier|*
name|diff_cmd
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|SVN_ERR
argument_list|(
name|svn_path_cstring_to_utf8
argument_list|(
operator|&
name|diff_cmd
argument_list|,
name|diff_cmd
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_io_run_diff2
argument_list|(
name|dir
argument_list|,
name|user_args
argument_list|,
name|num_user_args
argument_list|,
name|label1
argument_list|,
name|label2
argument_list|,
name|from
argument_list|,
name|to
argument_list|,
name|pexitcode
argument_list|,
name|outfile
argument_list|,
name|errfile
argument_list|,
name|diff_cmd
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_run_diff3_2
parameter_list|(
name|int
modifier|*
name|exitcode
parameter_list|,
specifier|const
name|char
modifier|*
name|dir
parameter_list|,
specifier|const
name|char
modifier|*
name|mine
parameter_list|,
specifier|const
name|char
modifier|*
name|older
parameter_list|,
specifier|const
name|char
modifier|*
name|yours
parameter_list|,
specifier|const
name|char
modifier|*
name|mine_label
parameter_list|,
specifier|const
name|char
modifier|*
name|older_label
parameter_list|,
specifier|const
name|char
modifier|*
name|yours_label
parameter_list|,
name|apr_file_t
modifier|*
name|merged
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|user_args
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|SVN_ERR
argument_list|(
name|svn_path_cstring_to_utf8
argument_list|(
operator|&
name|diff3_cmd
argument_list|,
name|diff3_cmd
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_io_run_diff3_3
argument_list|(
name|exitcode
argument_list|,
name|dir
argument_list|,
name|mine
argument_list|,
name|older
argument_list|,
name|yours
argument_list|,
name|mine_label
argument_list|,
name|older_label
argument_list|,
name|yours_label
argument_list|,
name|merged
argument_list|,
name|diff3_cmd
argument_list|,
name|user_args
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_run_diff3
parameter_list|(
specifier|const
name|char
modifier|*
name|dir
parameter_list|,
specifier|const
name|char
modifier|*
name|mine
parameter_list|,
specifier|const
name|char
modifier|*
name|older
parameter_list|,
specifier|const
name|char
modifier|*
name|yours
parameter_list|,
specifier|const
name|char
modifier|*
name|mine_label
parameter_list|,
specifier|const
name|char
modifier|*
name|older_label
parameter_list|,
specifier|const
name|char
modifier|*
name|yours_label
parameter_list|,
name|apr_file_t
modifier|*
name|merged
parameter_list|,
name|int
modifier|*
name|exitcode
parameter_list|,
specifier|const
name|char
modifier|*
name|diff3_cmd
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_io_run_diff3_2
argument_list|(
name|exitcode
argument_list|,
name|dir
argument_list|,
name|mine
argument_list|,
name|older
argument_list|,
name|yours
argument_list|,
name|mine_label
argument_list|,
name|older_label
argument_list|,
name|yours_label
argument_list|,
name|merged
argument_list|,
name|diff3_cmd
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_remove_file
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_io_remove_file2
argument_list|(
name|path
argument_list|,
name|FALSE
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_file_lock
parameter_list|(
specifier|const
name|char
modifier|*
name|lock_file
parameter_list|,
name|svn_boolean_t
name|exclusive
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_io_file_lock2
argument_list|(
name|lock_file
argument_list|,
name|exclusive
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_get_dirents2
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|dirents
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
comment|/* Note that the first part of svn_io_dirent2_t is identical      to svn_io_dirent_t to allow this construct */
return|return
name|svn_error_trace
argument_list|(
name|svn_io_get_dirents3
argument_list|(
name|dirents
argument_list|,
name|path
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_get_dirents
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|dirents
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
comment|/* Note that in C, padding is not allowed at the beginning of structs,      so this is actually portable, since the kind field of svn_io_dirent_t      is first in that struct. */
return|return
name|svn_io_get_dirents2
argument_list|(
name|dirents
argument_list|,
name|path
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_start_cmd2
parameter_list|(
name|apr_proc_t
modifier|*
name|cmd_proc
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|cmd
parameter_list|,
specifier|const
name|char
modifier|*
specifier|const
modifier|*
name|args
parameter_list|,
name|svn_boolean_t
name|inherit
parameter_list|,
name|svn_boolean_t
name|infile_pipe
parameter_list|,
name|apr_file_t
modifier|*
name|infile
parameter_list|,
name|svn_boolean_t
name|outfile_pipe
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|svn_boolean_t
name|errfile_pipe
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_io_start_cmd3
argument_list|(
name|cmd_proc
argument_list|,
name|path
argument_list|,
name|cmd
argument_list|,
name|args
argument_list|,
name|NULL
argument_list|,
name|inherit
argument_list|,
name|infile_pipe
argument_list|,
name|infile
argument_list|,
name|outfile_pipe
argument_list|,
name|outfile
argument_list|,
name|errfile_pipe
argument_list|,
name|errfile
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_start_cmd
parameter_list|(
name|apr_proc_t
modifier|*
name|cmd_proc
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|cmd
parameter_list|,
specifier|const
name|char
modifier|*
specifier|const
modifier|*
name|args
parameter_list|,
name|svn_boolean_t
name|inherit
parameter_list|,
name|apr_file_t
modifier|*
name|infile
parameter_list|,
name|apr_file_t
modifier|*
name|outfile
parameter_list|,
name|apr_file_t
modifier|*
name|errfile
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_io_start_cmd2
argument_list|(
name|cmd_proc
argument_list|,
name|path
argument_list|,
name|cmd
argument_list|,
name|args
argument_list|,
name|inherit
argument_list|,
name|FALSE
argument_list|,
name|infile
argument_list|,
name|FALSE
argument_list|,
name|outfile
argument_list|,
name|FALSE
argument_list|,
name|errfile
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_file_read_full
parameter_list|(
name|apr_file_t
modifier|*
name|file
parameter_list|,
name|void
modifier|*
name|buf
parameter_list|,
name|apr_size_t
name|nbytes
parameter_list|,
name|apr_size_t
modifier|*
name|bytes_read
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_io_file_read_full2
argument_list|(
name|file
argument_list|,
name|buf
argument_list|,
name|nbytes
argument_list|,
name|bytes_read
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_struct
struct|struct
name|walk_func_filter_baton_t
block|{
name|svn_io_walk_func_t
name|walk_func
decl_stmt|;
name|void
modifier|*
name|walk_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Implements svn_io_walk_func_t, but only allows APR_DIR and APR_REG    finfo types through to the wrapped function/baton.  */
end_comment

begin_function
specifier|static
name|svn_error_t
modifier|*
name|walk_func_filter_func
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|apr_finfo_t
modifier|*
name|finfo
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|walk_func_filter_baton_t
modifier|*
name|b
init|=
name|baton
decl_stmt|;
if|if
condition|(
name|finfo
operator|->
name|filetype
operator|==
name|APR_DIR
operator|||
name|finfo
operator|->
name|filetype
operator|==
name|APR_REG
condition|)
name|SVN_ERR
argument_list|(
name|b
operator|->
name|walk_func
argument_list|(
name|b
operator|->
name|walk_baton
argument_list|,
name|path
argument_list|,
name|finfo
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_dir_walk
parameter_list|(
specifier|const
name|char
modifier|*
name|dirname
parameter_list|,
name|apr_int32_t
name|wanted
parameter_list|,
name|svn_io_walk_func_t
name|walk_func
parameter_list|,
name|void
modifier|*
name|walk_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|walk_func_filter_baton_t
name|baton
decl_stmt|;
name|baton
operator|.
name|walk_func
operator|=
name|walk_func
expr_stmt|;
name|baton
operator|.
name|walk_baton
operator|=
name|walk_baton
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_io_dir_walk2
argument_list|(
name|dirname
argument_list|,
name|wanted
argument_list|,
name|walk_func_filter_func
argument_list|,
operator|&
name|baton
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_io_stat_dirent
parameter_list|(
specifier|const
name|svn_io_dirent2_t
modifier|*
modifier|*
name|dirent_p
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|ignore_enoent
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_io_stat_dirent2
argument_list|(
name|dirent_p
argument_list|,
name|path
argument_list|,
name|FALSE
argument_list|,
name|ignore_enoent
argument_list|,
name|result_pool
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From constructors.c ***/
end_comment

begin_function
name|svn_log_changed_path_t
modifier|*
name|svn_log_changed_path_dup
parameter_list|(
specifier|const
name|svn_log_changed_path_t
modifier|*
name|changed_path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_log_changed_path_t
modifier|*
name|new_changed_path
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|new_changed_path
argument_list|)
argument_list|)
decl_stmt|;
operator|*
name|new_changed_path
operator|=
operator|*
name|changed_path
expr_stmt|;
if|if
condition|(
name|new_changed_path
operator|->
name|copyfrom_path
condition|)
name|new_changed_path
operator|->
name|copyfrom_path
operator|=
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|new_changed_path
operator|->
name|copyfrom_path
argument_list|)
expr_stmt|;
return|return
name|new_changed_path
return|;
block|}
end_function

begin_comment
comment|/*** From cmdline.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_cmdline_prompt_user
parameter_list|(
specifier|const
name|char
modifier|*
modifier|*
name|result
parameter_list|,
specifier|const
name|char
modifier|*
name|prompt_str
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_cmdline_prompt_user2
argument_list|(
name|result
argument_list|,
name|prompt_str
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_cmdline_setup_auth_baton
parameter_list|(
name|svn_auth_baton_t
modifier|*
modifier|*
name|ab
parameter_list|,
name|svn_boolean_t
name|non_interactive
parameter_list|,
specifier|const
name|char
modifier|*
name|auth_username
parameter_list|,
specifier|const
name|char
modifier|*
name|auth_password
parameter_list|,
specifier|const
name|char
modifier|*
name|config_dir
parameter_list|,
name|svn_boolean_t
name|no_auth_cache
parameter_list|,
name|svn_config_t
modifier|*
name|cfg
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_cmdline_create_auth_baton
argument_list|(
name|ab
argument_list|,
name|non_interactive
argument_list|,
name|auth_username
argument_list|,
name|auth_password
argument_list|,
name|config_dir
argument_list|,
name|no_auth_cache
argument_list|,
name|FALSE
argument_list|,
name|cfg
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From dso.c ***/
end_comment

begin_function
name|void
name|svn_dso_initialize
parameter_list|(
name|void
parameter_list|)
block|{
name|svn_error_t
modifier|*
name|err
init|=
name|svn_dso_initialize2
argument_list|()
decl_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
name|abort
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*** From simple_providers.c ***/
end_comment

begin_function
name|void
name|svn_auth_get_simple_provider
parameter_list|(
name|svn_auth_provider_object_t
modifier|*
modifier|*
name|provider
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_auth_get_simple_provider2
argument_list|(
name|provider
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*** From ssl_client_cert_pw_providers.c ***/
end_comment

begin_function
name|void
name|svn_auth_get_ssl_client_cert_pw_file_provider
parameter_list|(
name|svn_auth_provider_object_t
modifier|*
modifier|*
name|provider
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_auth_get_ssl_client_cert_pw_file_provider2
argument_list|(
name|provider
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*** From path.c ***/
end_comment

begin_define
define|#
directive|define
name|SVN_EMPTY_PATH
value|""
end_define

begin_function
specifier|const
name|char
modifier|*
name|svn_path_url_add_component
parameter_list|(
specifier|const
name|char
modifier|*
name|url
parameter_list|,
specifier|const
name|char
modifier|*
name|component
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
comment|/* URL can have trailing '/' */
name|url
operator|=
name|svn_path_canonicalize
argument_list|(
name|url
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_path_url_add_component2
argument_list|(
name|url
argument_list|,
name|component
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|svn_path_split
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|dirpath
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|base_name
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|assert
argument_list|(
name|dirpath
operator|!=
name|base_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|dirpath
condition|)
operator|*
name|dirpath
operator|=
name|svn_path_dirname
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|base_name
condition|)
operator|*
name|base_name
operator|=
name|svn_path_basename
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_path_split_if_file
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|pdirectory
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|pfile
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_finfo_t
name|finfo
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|SVN_ERR_ASSERT
argument_list|(
name|svn_path_is_canonical
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_io_stat
argument_list|(
operator|&
name|finfo
argument_list|,
name|path
argument_list|,
name|APR_FINFO_TYPE
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|&&
operator|!
name|APR_STATUS_IS_ENOENT
argument_list|(
name|err
operator|->
name|apr_err
argument_list|)
condition|)
return|return
name|err
return|;
if|if
condition|(
name|err
operator|||
name|finfo
operator|.
name|filetype
operator|==
name|APR_REG
condition|)
block|{
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
name|svn_path_split
argument_list|(
name|path
argument_list|,
name|pdirectory
argument_list|,
name|pfile
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|finfo
operator|.
name|filetype
operator|==
name|APR_DIR
condition|)
block|{
operator|*
name|pdirectory
operator|=
name|path
expr_stmt|;
operator|*
name|pfile
operator|=
name|SVN_EMPTY_PATH
expr_stmt|;
block|}
else|else
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_BAD_FILENAME
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"'%s' is neither a file nor a directory name"
argument_list|)
argument_list|,
name|svn_path_local_style
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/*** From stream.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_stream_copy2
parameter_list|(
name|svn_stream_t
modifier|*
name|from
parameter_list|,
name|svn_stream_t
modifier|*
name|to
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_stream_copy3
argument_list|(
name|svn_stream_disown
argument_list|(
name|from
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|svn_stream_disown
argument_list|(
name|to
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_stream_copy
parameter_list|(
name|svn_stream_t
modifier|*
name|from
parameter_list|,
name|svn_stream_t
modifier|*
name|to
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_stream_copy3
argument_list|(
name|svn_stream_disown
argument_list|(
name|from
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|svn_stream_disown
argument_list|(
name|to
argument_list|,
name|scratch_pool
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_stream_t
modifier|*
name|svn_stream_from_aprfile
parameter_list|(
name|apr_file_t
modifier|*
name|file
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_stream_from_aprfile2
argument_list|(
name|file
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_stream_contents_same
parameter_list|(
name|svn_boolean_t
modifier|*
name|same
parameter_list|,
name|svn_stream_t
modifier|*
name|stream1
parameter_list|,
name|svn_stream_t
modifier|*
name|stream2
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_stream_contents_same2
argument_list|(
name|same
argument_list|,
name|svn_stream_disown
argument_list|(
name|stream1
argument_list|,
name|pool
argument_list|)
argument_list|,
name|svn_stream_disown
argument_list|(
name|stream2
argument_list|,
name|pool
argument_list|)
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From path.c ***/
end_comment

begin_function
specifier|const
name|char
modifier|*
name|svn_path_internal_style
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
if|if
condition|(
name|svn_path_is_url
argument_list|(
name|path
argument_list|)
condition|)
return|return
name|svn_uri_canonicalize
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
return|;
else|else
return|return
name|svn_dirent_internal_style
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_path_local_style
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
if|if
condition|(
name|svn_path_is_url
argument_list|(
name|path
argument_list|)
condition|)
return|return
name|apr_pstrdup
argument_list|(
name|pool
argument_list|,
name|path
argument_list|)
return|;
else|else
return|return
name|svn_dirent_local_style
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_path_canonicalize
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
if|if
condition|(
name|svn_path_is_url
argument_list|(
name|path
argument_list|)
condition|)
return|return
name|svn_uri_canonicalize
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
return|;
else|else
return|return
name|svn_dirent_canonicalize
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From mergeinfo.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_mergeinfo_inheritable
parameter_list|(
name|svn_mergeinfo_t
modifier|*
name|output
parameter_list|,
name|svn_mergeinfo_t
name|mergeinfo
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|start
parameter_list|,
name|svn_revnum_t
name|end
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_mergeinfo_inheritable2
argument_list|(
name|output
argument_list|,
name|mergeinfo
argument_list|,
name|path
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_rangelist_inheritable
parameter_list|(
name|svn_rangelist_t
modifier|*
modifier|*
name|inheritable_rangelist
parameter_list|,
specifier|const
name|svn_rangelist_t
modifier|*
name|rangelist
parameter_list|,
name|svn_revnum_t
name|start
parameter_list|,
name|svn_revnum_t
name|end
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_rangelist_inheritable2
argument_list|(
name|inheritable_rangelist
argument_list|,
name|rangelist
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_rangelist_merge
parameter_list|(
name|svn_rangelist_t
modifier|*
modifier|*
name|rangelist
parameter_list|,
specifier|const
name|svn_rangelist_t
modifier|*
name|changes
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|SVN_ERR
argument_list|(
name|svn_rangelist_merge2
argument_list|(
operator|*
name|rangelist
argument_list|,
name|changes
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|svn_rangelist__combine_adjacent_ranges
argument_list|(
operator|*
name|rangelist
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_mergeinfo_diff
parameter_list|(
name|svn_mergeinfo_t
modifier|*
name|deleted
parameter_list|,
name|svn_mergeinfo_t
modifier|*
name|added
parameter_list|,
name|svn_mergeinfo_t
name|from
parameter_list|,
name|svn_mergeinfo_t
name|to
parameter_list|,
name|svn_boolean_t
name|consider_inheritance
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_mergeinfo_diff2
argument_list|(
name|deleted
argument_list|,
name|added
argument_list|,
name|from
argument_list|,
name|to
argument_list|,
name|consider_inheritance
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_mergeinfo_merge
parameter_list|(
name|svn_mergeinfo_t
name|mergeinfo
parameter_list|,
name|svn_mergeinfo_t
name|changes
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_mergeinfo_merge2
argument_list|(
name|mergeinfo
argument_list|,
name|changes
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_mergeinfo_remove
parameter_list|(
name|svn_mergeinfo_t
modifier|*
name|mergeinfo
parameter_list|,
name|svn_mergeinfo_t
name|eraser
parameter_list|,
name|svn_mergeinfo_t
name|whiteboard
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_mergeinfo_remove2
argument_list|(
name|mergeinfo
argument_list|,
name|eraser
argument_list|,
name|whiteboard
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_mergeinfo_intersect
parameter_list|(
name|svn_mergeinfo_t
modifier|*
name|mergeinfo
parameter_list|,
name|svn_mergeinfo_t
name|mergeinfo1
parameter_list|,
name|svn_mergeinfo_t
name|mergeinfo2
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_mergeinfo_intersect2
argument_list|(
name|mergeinfo
argument_list|,
name|mergeinfo1
argument_list|,
name|mergeinfo2
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From config.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_config_create
parameter_list|(
name|svn_config_t
modifier|*
modifier|*
name|cfgp
parameter_list|,
name|svn_boolean_t
name|section_names_case_sensitive
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_config_create2
argument_list|(
name|cfgp
argument_list|,
name|section_names_case_sensitive
argument_list|,
name|FALSE
argument_list|,
name|result_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_config_read2
parameter_list|(
name|svn_config_t
modifier|*
modifier|*
name|cfgp
parameter_list|,
specifier|const
name|char
modifier|*
name|file
parameter_list|,
name|svn_boolean_t
name|must_exist
parameter_list|,
name|svn_boolean_t
name|section_names_case_sensitive
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_config_read3
argument_list|(
name|cfgp
argument_list|,
name|file
argument_list|,
name|must_exist
argument_list|,
name|section_names_case_sensitive
argument_list|,
name|FALSE
argument_list|,
name|result_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_config_read
parameter_list|(
name|svn_config_t
modifier|*
modifier|*
name|cfgp
parameter_list|,
specifier|const
name|char
modifier|*
name|file
parameter_list|,
name|svn_boolean_t
name|must_exist
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_config_read3
argument_list|(
name|cfgp
argument_list|,
name|file
argument_list|,
name|must_exist
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|result_pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|SVN_DISABLE_FULL_VERSION_MATCH
end_ifdef

begin_comment
comment|/* This double underscore name is used by the 1.6 command line client.    Keeping this name is sufficient for the 1.6 client to use the 1.7    libraries at runtime. */
end_comment

begin_function_decl
name|svn_error_t
modifier|*
name|svn_opt__eat_peg_revisions
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|true_targets_p
parameter_list|,
name|apr_array_header_t
modifier|*
name|targets
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|svn_error_t
modifier|*
name|svn_opt__eat_peg_revisions
parameter_list|(
name|apr_array_header_t
modifier|*
modifier|*
name|true_targets_p
parameter_list|,
name|apr_array_header_t
modifier|*
name|targets
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|unsigned
name|int
name|i
decl_stmt|;
name|apr_array_header_t
modifier|*
name|true_targets
decl_stmt|;
name|true_targets
operator|=
name|apr_array_make
argument_list|(
name|pool
argument_list|,
literal|5
argument_list|,
sizeof|sizeof
argument_list|(
specifier|const
name|char
operator|*
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|targets
operator|->
name|nelts
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|char
modifier|*
name|target
init|=
name|APR_ARRAY_IDX
argument_list|(
name|targets
argument_list|,
name|i
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|true_target
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_opt__split_arg_at_peg_revision
argument_list|(
operator|&
name|true_target
argument_list|,
name|NULL
argument_list|,
name|target
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|APR_ARRAY_PUSH
argument_list|(
name|true_targets
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
operator|=
name|true_target
expr_stmt|;
block|}
name|SVN_ERR_ASSERT
argument_list|(
name|true_targets_p
argument_list|)
expr_stmt|;
operator|*
name|true_targets_p
operator|=
name|true_targets
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|svn_xml_make_header
parameter_list|(
name|svn_stringbuf_t
modifier|*
modifier|*
name|str
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_xml_make_header2
argument_list|(
name|str
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|svn_utf_initialize
parameter_list|(
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_utf_initialize2
argument_list|(
name|FALSE
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_subst_build_keywords
parameter_list|(
name|svn_subst_keywords_t
modifier|*
name|kw
parameter_list|,
specifier|const
name|char
modifier|*
name|keywords_val
parameter_list|,
specifier|const
name|char
modifier|*
name|rev
parameter_list|,
specifier|const
name|char
modifier|*
name|url
parameter_list|,
name|apr_time_t
name|date
parameter_list|,
specifier|const
name|char
modifier|*
name|author
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_hash_t
modifier|*
name|kwhash
decl_stmt|;
specifier|const
name|svn_string_t
modifier|*
name|val
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_subst_build_keywords2
argument_list|(
operator|&
name|kwhash
argument_list|,
name|keywords_val
argument_list|,
name|rev
argument_list|,
name|url
argument_list|,
name|date
argument_list|,
name|author
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* The behaviour of pre-1.3 svn_subst_build_keywords, which we are    * replicating here, is to write to a slot in the svn_subst_keywords_t    * only if the relevant keyword was present in keywords_val, otherwise    * leaving that slot untouched. */
name|val
operator|=
name|svn_hash_gets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_REVISION_LONG
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
condition|)
name|kw
operator|->
name|revision
operator|=
name|val
expr_stmt|;
name|val
operator|=
name|svn_hash_gets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_DATE_LONG
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
condition|)
name|kw
operator|->
name|date
operator|=
name|val
expr_stmt|;
name|val
operator|=
name|svn_hash_gets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_AUTHOR_LONG
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
condition|)
name|kw
operator|->
name|author
operator|=
name|val
expr_stmt|;
name|val
operator|=
name|svn_hash_gets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_URL_LONG
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
condition|)
name|kw
operator|->
name|url
operator|=
name|val
expr_stmt|;
name|val
operator|=
name|svn_hash_gets
argument_list|(
name|kwhash
argument_list|,
name|SVN_KEYWORD_ID
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
condition|)
name|kw
operator|->
name|id
operator|=
name|val
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/*** From version.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_ver_check_list
parameter_list|(
specifier|const
name|svn_version_t
modifier|*
name|my_version
parameter_list|,
specifier|const
name|svn_version_checklist_t
modifier|*
name|checklist
parameter_list|)
block|{
return|return
name|svn_ver_check_list2
argument_list|(
name|my_version
argument_list|,
name|checklist
argument_list|,
name|svn_ver_compatible
argument_list|)
return|;
block|}
end_function

end_unit

