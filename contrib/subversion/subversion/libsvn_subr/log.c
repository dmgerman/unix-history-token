begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * log.c :  Functions for logging Subversion operations  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_escape
end_escape

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_define
define|#
directive|define
name|APR_WANT_STRFUNC
end_define

begin_include
include|#
directive|include
file|<apr_want.h>
end_include

begin_include
include|#
directive|include
file|<apr_strings.h>
end_include

begin_include
include|#
directive|include
file|"svn_types.h"
end_include

begin_include
include|#
directive|include
file|"svn_error.h"
end_include

begin_include
include|#
directive|include
file|"svn_mergeinfo.h"
end_include

begin_include
include|#
directive|include
file|"svn_path.h"
end_include

begin_include
include|#
directive|include
file|"svn_pools.h"
end_include

begin_include
include|#
directive|include
file|"svn_string.h"
end_include

begin_include
include|#
directive|include
file|"private/svn_log.h"
end_include

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|log_depth
parameter_list|(
name|svn_depth_t
name|depth
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
if|if
condition|(
name|depth
operator|==
name|svn_depth_unknown
condition|)
return|return
literal|""
return|;
return|return
name|apr_pstrcat
argument_list|(
name|pool
argument_list|,
literal|" depth="
argument_list|,
name|svn_depth_to_word
argument_list|(
name|depth
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|log_include_merged_revisions
parameter_list|(
name|svn_boolean_t
name|include_merged_revisions
parameter_list|)
block|{
if|if
condition|(
name|include_merged_revisions
condition|)
return|return
literal|" include-merged-revisions"
return|;
return|return
literal|""
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__reparent
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"reparent %s"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__change_rev_prop
parameter_list|(
name|svn_revnum_t
name|rev
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"change-rev-prop r%ld %s"
argument_list|,
name|rev
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|name
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__rev_proplist
parameter_list|(
name|svn_revnum_t
name|rev
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"rev-proplist r%ld"
argument_list|,
name|rev
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__rev_prop
parameter_list|(
name|svn_revnum_t
name|rev
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"rev-prop r%ld %s"
argument_list|,
name|rev
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|name
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__commit
parameter_list|(
name|svn_revnum_t
name|rev
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"commit r%ld"
argument_list|,
name|rev
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__get_file
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|svn_boolean_t
name|want_contents
parameter_list|,
name|svn_boolean_t
name|want_props
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"get-file %s r%ld%s%s"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|rev
argument_list|,
name|want_contents
condition|?
literal|" text"
else|:
literal|""
argument_list|,
name|want_props
condition|?
literal|" props"
else|:
literal|""
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__get_dir
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|svn_boolean_t
name|want_contents
parameter_list|,
name|svn_boolean_t
name|want_props
parameter_list|,
name|apr_uint64_t
name|dirent_fields
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"get-dir %s r%ld%s%s"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|rev
argument_list|,
name|want_contents
condition|?
literal|" text"
else|:
literal|""
argument_list|,
name|want_props
condition|?
literal|" props"
else|:
literal|""
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__get_mergeinfo
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_mergeinfo_inheritance_t
name|inherit
parameter_list|,
name|svn_boolean_t
name|include_descendants
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|apr_pool_t
modifier|*
name|iterpool
init|=
name|svn_pool_create
argument_list|(
name|pool
argument_list|)
decl_stmt|;
name|svn_stringbuf_t
modifier|*
name|space_separated_paths
init|=
name|svn_stringbuf_create_empty
argument_list|(
name|pool
argument_list|)
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|paths
operator|->
name|nelts
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|char
modifier|*
name|path
init|=
name|APR_ARRAY_IDX
argument_list|(
name|paths
argument_list|,
name|i
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
decl_stmt|;
name|svn_pool_clear
argument_list|(
name|iterpool
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|!=
literal|0
condition|)
name|svn_stringbuf_appendcstr
argument_list|(
name|space_separated_paths
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|svn_stringbuf_appendcstr
argument_list|(
name|space_separated_paths
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|iterpool
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|svn_pool_destroy
argument_list|(
name|iterpool
argument_list|)
expr_stmt|;
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"get-mergeinfo (%s) %s%s"
argument_list|,
name|space_separated_paths
operator|->
name|data
argument_list|,
name|svn_inheritance_to_word
argument_list|(
name|inherit
argument_list|)
argument_list|,
name|include_descendants
condition|?
literal|" include-descendants"
else|:
literal|""
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__checkout
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"checkout-or-export %s r%ld%s"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|rev
argument_list|,
name|log_depth
argument_list|(
name|depth
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__update
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|send_copyfrom_args
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"update %s r%ld%s%s"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|rev
argument_list|,
name|log_depth
argument_list|(
name|depth
argument_list|,
name|pool
argument_list|)
argument_list|,
operator|(
name|send_copyfrom_args
condition|?
literal|" send-copyfrom-args"
else|:
literal|""
operator|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__switch
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_revnum_t
name|revnum
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"switch %s %s@%ld%s"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|dst_path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|revnum
argument_list|,
name|log_depth
argument_list|(
name|depth
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__status
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"status %s r%ld%s"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|rev
argument_list|,
name|log_depth
argument_list|(
name|depth
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__diff
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|from_revnum
parameter_list|,
specifier|const
name|char
modifier|*
name|dst_path
parameter_list|,
name|svn_revnum_t
name|revnum
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|log_ignore_ancestry
init|=
operator|(
name|ignore_ancestry
condition|?
literal|" ignore-ancestry"
else|:
literal|""
operator|)
decl_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|path
argument_list|,
name|dst_path
argument_list|)
operator|==
literal|0
condition|)
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"diff %s r%ld:%ld%s%s"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|from_revnum
argument_list|,
name|revnum
argument_list|,
name|log_depth
argument_list|(
name|depth
argument_list|,
name|pool
argument_list|)
argument_list|,
name|log_ignore_ancestry
argument_list|)
return|;
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"diff %s@%ld %s@%ld%s%s"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|from_revnum
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|dst_path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|revnum
argument_list|,
name|log_depth
argument_list|(
name|depth
argument_list|,
name|pool
argument_list|)
argument_list|,
name|log_ignore_ancestry
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__log
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_revnum_t
name|start
parameter_list|,
name|svn_revnum_t
name|end
parameter_list|,
name|int
name|limit
parameter_list|,
name|svn_boolean_t
name|discover_changed_paths
parameter_list|,
name|svn_boolean_t
name|strict_node_history
parameter_list|,
name|svn_boolean_t
name|include_merged_revisions
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|revprops
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|apr_pool_t
modifier|*
name|iterpool
init|=
name|svn_pool_create
argument_list|(
name|pool
argument_list|)
decl_stmt|;
name|svn_stringbuf_t
modifier|*
name|space_separated_paths
init|=
name|svn_stringbuf_create_empty
argument_list|(
name|pool
argument_list|)
decl_stmt|;
name|svn_stringbuf_t
modifier|*
name|options
init|=
name|svn_stringbuf_create_empty
argument_list|(
name|pool
argument_list|)
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|paths
operator|->
name|nelts
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|char
modifier|*
name|path
init|=
name|APR_ARRAY_IDX
argument_list|(
name|paths
argument_list|,
name|i
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
decl_stmt|;
name|svn_pool_clear
argument_list|(
name|iterpool
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|!=
literal|0
condition|)
name|svn_stringbuf_appendcstr
argument_list|(
name|space_separated_paths
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|svn_stringbuf_appendcstr
argument_list|(
name|space_separated_paths
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|iterpool
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|limit
condition|)
block|{
specifier|const
name|char
modifier|*
name|tmp
init|=
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|" limit=%d"
argument_list|,
name|limit
argument_list|)
decl_stmt|;
name|svn_stringbuf_appendcstr
argument_list|(
name|options
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|discover_changed_paths
condition|)
name|svn_stringbuf_appendcstr
argument_list|(
name|options
argument_list|,
literal|" discover-changed-paths"
argument_list|)
expr_stmt|;
if|if
condition|(
name|strict_node_history
condition|)
name|svn_stringbuf_appendcstr
argument_list|(
name|options
argument_list|,
literal|" strict"
argument_list|)
expr_stmt|;
if|if
condition|(
name|include_merged_revisions
condition|)
name|svn_stringbuf_appendcstr
argument_list|(
name|options
argument_list|,
name|log_include_merged_revisions
argument_list|(
name|include_merged_revisions
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|revprops
operator|==
name|NULL
condition|)
name|svn_stringbuf_appendcstr
argument_list|(
name|options
argument_list|,
literal|" revprops=all"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|revprops
operator|->
name|nelts
operator|>
literal|0
condition|)
block|{
name|svn_stringbuf_appendcstr
argument_list|(
name|options
argument_list|,
literal|" revprops=("
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|revprops
operator|->
name|nelts
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|char
modifier|*
name|name
init|=
name|APR_ARRAY_IDX
argument_list|(
name|revprops
argument_list|,
name|i
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
decl_stmt|;
name|svn_pool_clear
argument_list|(
name|iterpool
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|!=
literal|0
condition|)
name|svn_stringbuf_appendcstr
argument_list|(
name|options
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|svn_stringbuf_appendcstr
argument_list|(
name|options
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|name
argument_list|,
name|iterpool
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|svn_stringbuf_appendcstr
argument_list|(
name|options
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
name|svn_pool_destroy
argument_list|(
name|iterpool
argument_list|)
expr_stmt|;
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"log (%s) r%ld:%ld%s"
argument_list|,
name|space_separated_paths
operator|->
name|data
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|options
operator|->
name|data
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__get_locations
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|peg_revision
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|location_revisions
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|svn_revnum_t
modifier|*
name|revision_ptr
decl_stmt|,
modifier|*
name|revision_ptr_start
decl_stmt|,
modifier|*
name|revision_ptr_end
decl_stmt|;
name|apr_pool_t
modifier|*
name|iterpool
init|=
name|svn_pool_create
argument_list|(
name|pool
argument_list|)
decl_stmt|;
name|svn_stringbuf_t
modifier|*
name|space_separated_revnums
init|=
name|svn_stringbuf_create_empty
argument_list|(
name|pool
argument_list|)
decl_stmt|;
name|revision_ptr_start
operator|=
operator|(
specifier|const
name|svn_revnum_t
operator|*
operator|)
name|location_revisions
operator|->
name|elts
expr_stmt|;
name|revision_ptr
operator|=
name|revision_ptr_start
expr_stmt|;
name|revision_ptr_end
operator|=
name|revision_ptr
operator|+
name|location_revisions
operator|->
name|nelts
expr_stmt|;
while|while
condition|(
name|revision_ptr
operator|<
name|revision_ptr_end
condition|)
block|{
name|svn_pool_clear
argument_list|(
name|iterpool
argument_list|)
expr_stmt|;
if|if
condition|(
name|revision_ptr
operator|!=
name|revision_ptr_start
condition|)
name|svn_stringbuf_appendcstr
argument_list|(
name|space_separated_revnums
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|svn_stringbuf_appendcstr
argument_list|(
name|space_separated_revnums
argument_list|,
name|apr_psprintf
argument_list|(
name|iterpool
argument_list|,
literal|"%ld"
argument_list|,
operator|*
name|revision_ptr
argument_list|)
argument_list|)
expr_stmt|;
operator|++
name|revision_ptr
expr_stmt|;
block|}
name|svn_pool_destroy
argument_list|(
name|iterpool
argument_list|)
expr_stmt|;
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"get-locations %s@%ld (%s)"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|peg_revision
argument_list|,
name|space_separated_revnums
operator|->
name|data
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__get_location_segments
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|peg_revision
parameter_list|,
name|svn_revnum_t
name|start
parameter_list|,
name|svn_revnum_t
name|end
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"get-location-segments %s@%ld r%ld:%ld"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|peg_revision
argument_list|,
name|start
argument_list|,
name|end
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__get_file_revs
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|start
parameter_list|,
name|svn_revnum_t
name|end
parameter_list|,
name|svn_boolean_t
name|include_merged_revisions
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"get-file-revs %s r%ld:%ld%s"
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|log_include_merged_revisions
argument_list|(
name|include_merged_revisions
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__lock
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_boolean_t
name|steal
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|apr_pool_t
modifier|*
name|iterpool
init|=
name|svn_pool_create
argument_list|(
name|pool
argument_list|)
decl_stmt|;
name|svn_stringbuf_t
modifier|*
name|space_separated_paths
init|=
name|svn_stringbuf_create_empty
argument_list|(
name|pool
argument_list|)
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|paths
operator|->
name|nelts
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|char
modifier|*
name|path
init|=
name|APR_ARRAY_IDX
argument_list|(
name|paths
argument_list|,
name|i
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
decl_stmt|;
name|svn_pool_clear
argument_list|(
name|iterpool
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|!=
literal|0
condition|)
name|svn_stringbuf_appendcstr
argument_list|(
name|space_separated_paths
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|svn_stringbuf_appendcstr
argument_list|(
name|space_separated_paths
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|iterpool
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|svn_pool_destroy
argument_list|(
name|iterpool
argument_list|)
expr_stmt|;
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"lock (%s)%s"
argument_list|,
name|space_separated_paths
operator|->
name|data
argument_list|,
name|steal
condition|?
literal|" steal"
else|:
literal|""
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__unlock
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_boolean_t
name|break_lock
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|apr_pool_t
modifier|*
name|iterpool
init|=
name|svn_pool_create
argument_list|(
name|pool
argument_list|)
decl_stmt|;
name|svn_stringbuf_t
modifier|*
name|space_separated_paths
init|=
name|svn_stringbuf_create_empty
argument_list|(
name|pool
argument_list|)
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|paths
operator|->
name|nelts
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|char
modifier|*
name|path
init|=
name|APR_ARRAY_IDX
argument_list|(
name|paths
argument_list|,
name|i
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
decl_stmt|;
name|svn_pool_clear
argument_list|(
name|iterpool
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|!=
literal|0
condition|)
name|svn_stringbuf_appendcstr
argument_list|(
name|space_separated_paths
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|svn_stringbuf_appendcstr
argument_list|(
name|space_separated_paths
argument_list|,
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|iterpool
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|svn_pool_destroy
argument_list|(
name|iterpool
argument_list|)
expr_stmt|;
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"unlock (%s)%s"
argument_list|,
name|space_separated_paths
operator|->
name|data
argument_list|,
name|break_lock
condition|?
literal|" break"
else|:
literal|""
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__lock_one_path
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|steal
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|paths
init|=
name|apr_array_make
argument_list|(
name|pool
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|path
argument_list|)
argument_list|)
decl_stmt|;
name|APR_ARRAY_PUSH
argument_list|(
name|paths
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
operator|=
name|path
expr_stmt|;
return|return
name|svn_log__lock
argument_list|(
name|paths
argument_list|,
name|steal
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__unlock_one_path
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|break_lock
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_array_header_t
modifier|*
name|paths
init|=
name|apr_array_make
argument_list|(
name|pool
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|path
argument_list|)
argument_list|)
decl_stmt|;
name|APR_ARRAY_PUSH
argument_list|(
name|paths
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
operator|=
name|path
expr_stmt|;
return|return
name|svn_log__unlock
argument_list|(
name|paths
argument_list|,
name|break_lock
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__replay
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|log_path
decl_stmt|;
if|if
condition|(
name|path
operator|&&
name|path
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|log_path
operator|=
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
expr_stmt|;
else|else
name|log_path
operator|=
literal|"/"
expr_stmt|;
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"replay %s r%ld"
argument_list|,
name|log_path
argument_list|,
name|rev
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|svn_log__get_inherited_props
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|log_path
decl_stmt|;
if|if
condition|(
name|path
operator|&&
name|path
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|log_path
operator|=
name|svn_path_uri_encode
argument_list|(
name|path
argument_list|,
name|pool
argument_list|)
expr_stmt|;
else|else
name|log_path
operator|=
literal|"/"
expr_stmt|;
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
literal|"get-inherited-props %s r%ld"
argument_list|,
name|log_path
argument_list|,
name|rev
argument_list|)
return|;
block|}
end_function

end_unit

