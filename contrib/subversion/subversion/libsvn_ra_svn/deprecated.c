begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * deprecated.c :  Public, deprecated wrappers to our private ra_svn API  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_comment
comment|/* We define this here to remove any further warnings about the usage of    deprecated functions in this file. */
end_comment

begin_define
define|#
directive|define
name|SVN_DEPRECATED
end_define

begin_include
include|#
directive|include
file|"svn_ra_svn.h"
end_include

begin_include
include|#
directive|include
file|"private/svn_ra_svn_private.h"
end_include

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_write_number
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|apr_uint64_t
name|number
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__write_number
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|number
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_write_string
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|str
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__write_string
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|str
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_write_cstring
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
specifier|const
name|char
modifier|*
name|s
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__write_cstring
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|s
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_write_word
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
specifier|const
name|char
modifier|*
name|word
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__write_word
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|word
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_write_proplist
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|apr_hash_t
modifier|*
name|props
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__write_proplist
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|props
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_start_list
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__start_list
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_end_list
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__end_list
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_flush
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__flush
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_write_tuple
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|va
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|va_start
argument_list|(
name|va
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_ra_svn__write_tuple
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|fmt
argument_list|,
name|va
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|va
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_read_item
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|svn_ra_svn_item_t
modifier|*
modifier|*
name|item
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__read_item
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|item
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_skip_leading_garbage
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__skip_leading_garbage
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_parse_tuple
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|list
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|va
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|va_start
argument_list|(
name|va
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_ra_svn__parse_tuple
argument_list|(
name|list
argument_list|,
name|pool
argument_list|,
name|fmt
argument_list|,
name|va
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|va
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_read_tuple
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|va
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|va_start
argument_list|(
name|va
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_ra_svn__read_tuple
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|fmt
argument_list|,
name|va
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|va
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_parse_proplist
parameter_list|(
specifier|const
name|apr_array_header_t
modifier|*
name|list
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|apr_hash_t
modifier|*
modifier|*
name|props
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__parse_proplist
argument_list|(
name|list
argument_list|,
name|pool
argument_list|,
name|props
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_read_cmd_response
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|va
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|va_start
argument_list|(
name|va
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_ra_svn__read_cmd_response
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|fmt
argument_list|,
name|va
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|va
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_handle_commands2
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
specifier|const
name|svn_ra_svn_cmd_entry_t
modifier|*
name|commands
parameter_list|,
name|void
modifier|*
name|baton
parameter_list|,
name|svn_boolean_t
name|error_on_disconnect
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__handle_commands2
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|commands
argument_list|,
name|baton
argument_list|,
name|error_on_disconnect
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_handle_commands
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
specifier|const
name|svn_ra_svn_cmd_entry_t
modifier|*
name|commands
parameter_list|,
name|void
modifier|*
name|baton
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__handle_commands2
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|commands
argument_list|,
name|baton
argument_list|,
name|FALSE
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_write_cmd
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
specifier|const
name|char
modifier|*
name|cmdname
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|va
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_ra_svn__start_list
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_ra_svn__write_word
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|cmdname
argument_list|)
argument_list|)
expr_stmt|;
name|va_start
argument_list|(
name|va
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_ra_svn__write_tuple
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|fmt
argument_list|,
name|va
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|va
argument_list|)
expr_stmt|;
return|return
name|err
condition|?
name|svn_error_trace
argument_list|(
name|err
argument_list|)
else|:
name|svn_ra_svn__end_list
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_write_cmd_response
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|va
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
name|va_start
argument_list|(
name|va
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_ra_svn__write_cmd_response
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|fmt
argument_list|,
name|va
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|va
argument_list|)
expr_stmt|;
return|return
name|svn_error_trace
argument_list|(
name|err
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_ra_svn_write_cmd_failure
parameter_list|(
name|svn_ra_svn_conn_t
modifier|*
name|conn
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|svn_error_t
modifier|*
name|err
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_ra_svn__write_cmd_failure
argument_list|(
name|conn
argument_list|,
name|pool
argument_list|,
name|err
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* From marshal.c */
end_comment

begin_function
name|svn_ra_svn_conn_t
modifier|*
name|svn_ra_svn_create_conn3
parameter_list|(
name|apr_socket_t
modifier|*
name|sock
parameter_list|,
name|apr_file_t
modifier|*
name|in_file
parameter_list|,
name|apr_file_t
modifier|*
name|out_file
parameter_list|,
name|int
name|compression_level
parameter_list|,
name|apr_size_t
name|zero_copy_limit
parameter_list|,
name|apr_size_t
name|error_check_interval
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_stream_t
modifier|*
name|in_stream
init|=
name|NULL
decl_stmt|;
name|svn_stream_t
modifier|*
name|out_stream
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|in_file
condition|)
name|in_stream
operator|=
name|svn_stream_from_aprfile2
argument_list|(
name|in_file
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
expr_stmt|;
if|if
condition|(
name|out_file
condition|)
name|out_stream
operator|=
name|svn_stream_from_aprfile2
argument_list|(
name|out_file
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_ra_svn_create_conn4
argument_list|(
name|sock
argument_list|,
name|in_stream
argument_list|,
name|out_stream
argument_list|,
name|compression_level
argument_list|,
name|zero_copy_limit
argument_list|,
name|error_check_interval
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_ra_svn_conn_t
modifier|*
name|svn_ra_svn_create_conn2
parameter_list|(
name|apr_socket_t
modifier|*
name|sock
parameter_list|,
name|apr_file_t
modifier|*
name|in_file
parameter_list|,
name|apr_file_t
modifier|*
name|out_file
parameter_list|,
name|int
name|compression_level
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_ra_svn_create_conn3
argument_list|(
name|sock
argument_list|,
name|in_file
argument_list|,
name|out_file
argument_list|,
name|compression_level
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* backward-compatible implementation using the default compression level */
end_comment

begin_function
name|svn_ra_svn_conn_t
modifier|*
name|svn_ra_svn_create_conn
parameter_list|(
name|apr_socket_t
modifier|*
name|sock
parameter_list|,
name|apr_file_t
modifier|*
name|in_file
parameter_list|,
name|apr_file_t
modifier|*
name|out_file
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_ra_svn_create_conn3
argument_list|(
name|sock
argument_list|,
name|in_file
argument_list|,
name|out_file
argument_list|,
name|SVN_DELTA_COMPRESSION_LEVEL_DEFAULT
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

end_unit

