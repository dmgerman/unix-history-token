begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * deprecated.c:  holding file for all deprecated APIs.  *                "we can't lose 'em, but we can shun 'em!"  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_comment
comment|/* ==================================================================== */
end_comment

begin_escape
end_escape

begin_comment
comment|/*** Includes. ***/
end_comment

begin_comment
comment|/* We define this here to remove any further warnings about the usage of    deprecated functions in this file. */
end_comment

begin_define
define|#
directive|define
name|SVN_DEPRECATED
end_define

begin_include
include|#
directive|include
file|"svn_diff.h"
end_include

begin_include
include|#
directive|include
file|"svn_utf.h"
end_include

begin_include
include|#
directive|include
file|"svn_private_config.h"
end_include

begin_escape
end_escape

begin_comment
comment|/*** Code. ***/
end_comment

begin_struct
struct|struct
name|fns_wrapper_baton
block|{
comment|/* We put the old baton in front of this one, so that we can still use      this baton in place of the old.  This prevents us from having to      implement simple wrappers around each member of diff_fns_t. */
name|void
modifier|*
name|old_baton
decl_stmt|;
specifier|const
name|svn_diff_fns_t
modifier|*
name|vtable
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|svn_error_t
modifier|*
name|datasources_open
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
name|apr_off_t
modifier|*
name|prefix_lines
parameter_list|,
name|apr_off_t
modifier|*
name|suffix_lines
parameter_list|,
specifier|const
name|svn_diff_datasource_e
modifier|*
name|datasources
parameter_list|,
name|apr_size_t
name|datasource_len
parameter_list|)
block|{
name|struct
name|fns_wrapper_baton
modifier|*
name|fwb
init|=
name|baton
decl_stmt|;
name|apr_size_t
name|i
decl_stmt|;
comment|/* Just iterate over the datasources, using the old singular version. */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|datasource_len
condition|;
name|i
operator|++
control|)
block|{
name|SVN_ERR
argument_list|(
name|fwb
operator|->
name|vtable
operator|->
name|datasource_open
argument_list|(
name|fwb
operator|->
name|old_baton
argument_list|,
name|datasources
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* Don't claim any prefix or suffix matches. */
operator|*
name|prefix_lines
operator|=
literal|0
expr_stmt|;
operator|*
name|suffix_lines
operator|=
literal|0
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|datasource_close
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
name|svn_diff_datasource_e
name|datasource
parameter_list|)
block|{
name|struct
name|fns_wrapper_baton
modifier|*
name|fwb
init|=
name|baton
decl_stmt|;
return|return
name|fwb
operator|->
name|vtable
operator|->
name|datasource_close
argument_list|(
name|fwb
operator|->
name|old_baton
argument_list|,
name|datasource
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|datasource_get_next_token
parameter_list|(
name|apr_uint32_t
modifier|*
name|hash
parameter_list|,
name|void
modifier|*
modifier|*
name|token
parameter_list|,
name|void
modifier|*
name|baton
parameter_list|,
name|svn_diff_datasource_e
name|datasource
parameter_list|)
block|{
name|struct
name|fns_wrapper_baton
modifier|*
name|fwb
init|=
name|baton
decl_stmt|;
return|return
name|fwb
operator|->
name|vtable
operator|->
name|datasource_get_next_token
argument_list|(
name|hash
argument_list|,
name|token
argument_list|,
name|fwb
operator|->
name|old_baton
argument_list|,
name|datasource
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|token_compare
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
name|void
modifier|*
name|ltoken
parameter_list|,
name|void
modifier|*
name|rtoken
parameter_list|,
name|int
modifier|*
name|compare
parameter_list|)
block|{
name|struct
name|fns_wrapper_baton
modifier|*
name|fwb
init|=
name|baton
decl_stmt|;
return|return
name|fwb
operator|->
name|vtable
operator|->
name|token_compare
argument_list|(
name|fwb
operator|->
name|old_baton
argument_list|,
name|ltoken
argument_list|,
name|rtoken
argument_list|,
name|compare
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|token_discard
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
name|void
modifier|*
name|token
parameter_list|)
block|{
name|struct
name|fns_wrapper_baton
modifier|*
name|fwb
init|=
name|baton
decl_stmt|;
name|fwb
operator|->
name|vtable
operator|->
name|token_discard
argument_list|(
name|fwb
operator|->
name|old_baton
argument_list|,
name|token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|token_discard_all
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|)
block|{
name|struct
name|fns_wrapper_baton
modifier|*
name|fwb
init|=
name|baton
decl_stmt|;
name|fwb
operator|->
name|vtable
operator|->
name|token_discard_all
argument_list|(
name|fwb
operator|->
name|old_baton
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|wrap_diff_fns
parameter_list|(
name|svn_diff_fns2_t
modifier|*
modifier|*
name|diff_fns2
parameter_list|,
name|struct
name|fns_wrapper_baton
modifier|*
modifier|*
name|baton2
parameter_list|,
specifier|const
name|svn_diff_fns_t
modifier|*
name|diff_fns
parameter_list|,
name|void
modifier|*
name|baton
parameter_list|,
name|apr_pool_t
modifier|*
name|result_pool
parameter_list|)
block|{
comment|/* Initialize the return vtable. */
operator|*
name|diff_fns2
operator|=
name|apr_palloc
argument_list|(
name|result_pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
operator|*
name|diff_fns2
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|*
name|diff_fns2
operator|)
operator|->
name|datasources_open
operator|=
name|datasources_open
expr_stmt|;
operator|(
operator|*
name|diff_fns2
operator|)
operator|->
name|datasource_close
operator|=
name|datasource_close
expr_stmt|;
operator|(
operator|*
name|diff_fns2
operator|)
operator|->
name|datasource_get_next_token
operator|=
name|datasource_get_next_token
expr_stmt|;
operator|(
operator|*
name|diff_fns2
operator|)
operator|->
name|token_compare
operator|=
name|token_compare
expr_stmt|;
operator|(
operator|*
name|diff_fns2
operator|)
operator|->
name|token_discard
operator|=
name|token_discard
expr_stmt|;
operator|(
operator|*
name|diff_fns2
operator|)
operator|->
name|token_discard_all
operator|=
name|token_discard_all
expr_stmt|;
comment|/* Initialize the wrapper baton. */
operator|*
name|baton2
operator|=
name|apr_palloc
argument_list|(
name|result_pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
operator|*
name|baton2
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|*
name|baton2
operator|)
operator|->
name|old_baton
operator|=
name|baton
expr_stmt|;
operator|(
operator|*
name|baton2
operator|)
operator|->
name|vtable
operator|=
name|diff_fns
expr_stmt|;
block|}
end_function

begin_comment
comment|/*** From diff_file.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_diff_file_output_unified2
parameter_list|(
name|svn_stream_t
modifier|*
name|output_stream
parameter_list|,
name|svn_diff_t
modifier|*
name|diff
parameter_list|,
specifier|const
name|char
modifier|*
name|original_path
parameter_list|,
specifier|const
name|char
modifier|*
name|modified_path
parameter_list|,
specifier|const
name|char
modifier|*
name|original_header
parameter_list|,
specifier|const
name|char
modifier|*
name|modified_header
parameter_list|,
specifier|const
name|char
modifier|*
name|header_encoding
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_diff_file_output_unified3
argument_list|(
name|output_stream
argument_list|,
name|diff
argument_list|,
name|original_path
argument_list|,
name|modified_path
argument_list|,
name|original_header
argument_list|,
name|modified_header
argument_list|,
name|header_encoding
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_diff_file_output_unified
parameter_list|(
name|svn_stream_t
modifier|*
name|output_stream
parameter_list|,
name|svn_diff_t
modifier|*
name|diff
parameter_list|,
specifier|const
name|char
modifier|*
name|original_path
parameter_list|,
specifier|const
name|char
modifier|*
name|modified_path
parameter_list|,
specifier|const
name|char
modifier|*
name|original_header
parameter_list|,
specifier|const
name|char
modifier|*
name|modified_header
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_diff_file_output_unified2
argument_list|(
name|output_stream
argument_list|,
name|diff
argument_list|,
name|original_path
argument_list|,
name|modified_path
argument_list|,
name|original_header
argument_list|,
name|modified_header
argument_list|,
name|SVN_APR_LOCALE_CHARSET
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_diff_file_diff
parameter_list|(
name|svn_diff_t
modifier|*
modifier|*
name|diff
parameter_list|,
specifier|const
name|char
modifier|*
name|original
parameter_list|,
specifier|const
name|char
modifier|*
name|modified
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_diff_file_diff_2
argument_list|(
name|diff
argument_list|,
name|original
argument_list|,
name|modified
argument_list|,
name|svn_diff_file_options_create
argument_list|(
name|pool
argument_list|)
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_diff_file_diff3
parameter_list|(
name|svn_diff_t
modifier|*
modifier|*
name|diff
parameter_list|,
specifier|const
name|char
modifier|*
name|original
parameter_list|,
specifier|const
name|char
modifier|*
name|modified
parameter_list|,
specifier|const
name|char
modifier|*
name|latest
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_diff_file_diff3_2
argument_list|(
name|diff
argument_list|,
name|original
argument_list|,
name|modified
argument_list|,
name|latest
argument_list|,
name|svn_diff_file_options_create
argument_list|(
name|pool
argument_list|)
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_diff_file_diff4
parameter_list|(
name|svn_diff_t
modifier|*
modifier|*
name|diff
parameter_list|,
specifier|const
name|char
modifier|*
name|original
parameter_list|,
specifier|const
name|char
modifier|*
name|modified
parameter_list|,
specifier|const
name|char
modifier|*
name|latest
parameter_list|,
specifier|const
name|char
modifier|*
name|ancestor
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_diff_file_diff4_2
argument_list|(
name|diff
argument_list|,
name|original
argument_list|,
name|modified
argument_list|,
name|latest
argument_list|,
name|ancestor
argument_list|,
name|svn_diff_file_options_create
argument_list|(
name|pool
argument_list|)
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_diff_file_output_merge
parameter_list|(
name|svn_stream_t
modifier|*
name|output_stream
parameter_list|,
name|svn_diff_t
modifier|*
name|diff
parameter_list|,
specifier|const
name|char
modifier|*
name|original_path
parameter_list|,
specifier|const
name|char
modifier|*
name|modified_path
parameter_list|,
specifier|const
name|char
modifier|*
name|latest_path
parameter_list|,
specifier|const
name|char
modifier|*
name|conflict_original
parameter_list|,
specifier|const
name|char
modifier|*
name|conflict_modified
parameter_list|,
specifier|const
name|char
modifier|*
name|conflict_latest
parameter_list|,
specifier|const
name|char
modifier|*
name|conflict_separator
parameter_list|,
name|svn_boolean_t
name|display_original_in_conflict
parameter_list|,
name|svn_boolean_t
name|display_resolved_conflicts
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_diff_conflict_display_style_t
name|style
init|=
name|svn_diff_conflict_display_modified_latest
decl_stmt|;
if|if
condition|(
name|display_resolved_conflicts
condition|)
name|style
operator|=
name|svn_diff_conflict_display_resolved_modified_latest
expr_stmt|;
if|if
condition|(
name|display_original_in_conflict
condition|)
name|style
operator|=
name|svn_diff_conflict_display_modified_original_latest
expr_stmt|;
return|return
name|svn_diff_file_output_merge2
argument_list|(
name|output_stream
argument_list|,
name|diff
argument_list|,
name|original_path
argument_list|,
name|modified_path
argument_list|,
name|latest_path
argument_list|,
name|conflict_original
argument_list|,
name|conflict_modified
argument_list|,
name|conflict_latest
argument_list|,
name|conflict_separator
argument_list|,
name|style
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From diff.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_diff_diff
parameter_list|(
name|svn_diff_t
modifier|*
modifier|*
name|diff
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
specifier|const
name|svn_diff_fns_t
modifier|*
name|vtable
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_diff_fns2_t
modifier|*
name|diff_fns2
decl_stmt|;
name|struct
name|fns_wrapper_baton
modifier|*
name|fwb
decl_stmt|;
name|wrap_diff_fns
argument_list|(
operator|&
name|diff_fns2
argument_list|,
operator|&
name|fwb
argument_list|,
name|vtable
argument_list|,
name|diff_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_diff_diff_2
argument_list|(
name|diff
argument_list|,
name|fwb
argument_list|,
name|diff_fns2
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From diff3.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_diff_diff3
parameter_list|(
name|svn_diff_t
modifier|*
modifier|*
name|diff
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
specifier|const
name|svn_diff_fns_t
modifier|*
name|vtable
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_diff_fns2_t
modifier|*
name|diff_fns2
decl_stmt|;
name|struct
name|fns_wrapper_baton
modifier|*
name|fwb
decl_stmt|;
name|wrap_diff_fns
argument_list|(
operator|&
name|diff_fns2
argument_list|,
operator|&
name|fwb
argument_list|,
name|vtable
argument_list|,
name|diff_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_diff_diff3_2
argument_list|(
name|diff
argument_list|,
name|fwb
argument_list|,
name|diff_fns2
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From diff4.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_diff_diff4
parameter_list|(
name|svn_diff_t
modifier|*
modifier|*
name|diff
parameter_list|,
name|void
modifier|*
name|diff_baton
parameter_list|,
specifier|const
name|svn_diff_fns_t
modifier|*
name|vtable
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_diff_fns2_t
modifier|*
name|diff_fns2
decl_stmt|;
name|struct
name|fns_wrapper_baton
modifier|*
name|fwb
decl_stmt|;
name|wrap_diff_fns
argument_list|(
operator|&
name|diff_fns2
argument_list|,
operator|&
name|fwb
argument_list|,
name|vtable
argument_list|,
name|diff_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_diff_diff4_2
argument_list|(
name|diff
argument_list|,
name|fwb
argument_list|,
name|diff_fns2
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

end_unit

