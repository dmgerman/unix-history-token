begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * debug_editor.c :  An editor that writes the operations it does to stderr.  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_include
include|#
directive|include
file|"svn_io.h"
end_include

begin_include
include|#
directive|include
file|"debug_editor.h"
end_include

begin_struct
struct|struct
name|edit_baton
block|{
specifier|const
name|svn_delta_editor_t
modifier|*
name|wrapped_editor
decl_stmt|;
name|void
modifier|*
name|wrapped_edit_baton
decl_stmt|;
name|int
name|indent_level
decl_stmt|;
name|svn_stream_t
modifier|*
name|out
decl_stmt|;
specifier|const
name|char
modifier|*
name|prefix
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|dir_baton
block|{
name|void
modifier|*
name|edit_baton
decl_stmt|;
name|void
modifier|*
name|wrapped_dir_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|file_baton
block|{
name|void
modifier|*
name|edit_baton
decl_stmt|;
name|void
modifier|*
name|wrapped_file_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|svn_error_t
modifier|*
name|write_indent
parameter_list|(
name|struct
name|edit_baton
modifier|*
name|eb
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_puts
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|eb
operator|->
name|prefix
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|eb
operator|->
name|indent_level
condition|;
operator|++
name|i
control|)
name|SVN_ERR
argument_list|(
name|svn_stream_puts
argument_list|(
name|eb
operator|->
name|out
argument_list|,
literal|" "
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|set_target_revision
parameter_list|(
name|void
modifier|*
name|edit_baton
parameter_list|,
name|svn_revnum_t
name|target_revision
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|edit_baton
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"set_target_revision : %ld\n"
argument_list|,
name|target_revision
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|eb
operator|->
name|wrapped_editor
operator|->
name|set_target_revision
argument_list|(
name|eb
operator|->
name|wrapped_edit_baton
argument_list|,
name|target_revision
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|open_root
parameter_list|(
name|void
modifier|*
name|edit_baton
parameter_list|,
name|svn_revnum_t
name|base_revision
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|void
modifier|*
modifier|*
name|root_baton
parameter_list|)
block|{
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|edit_baton
decl_stmt|;
name|struct
name|dir_baton
modifier|*
name|dir_baton
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|dir_baton
argument_list|)
argument_list|)
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"open_root : %ld\n"
argument_list|,
name|base_revision
argument_list|)
argument_list|)
expr_stmt|;
name|eb
operator|->
name|indent_level
operator|++
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|open_root
argument_list|(
name|eb
operator|->
name|wrapped_edit_baton
argument_list|,
name|base_revision
argument_list|,
name|pool
argument_list|,
operator|&
name|dir_baton
operator|->
name|wrapped_dir_baton
argument_list|)
argument_list|)
expr_stmt|;
name|dir_baton
operator|->
name|edit_baton
operator|=
name|edit_baton
expr_stmt|;
operator|*
name|root_baton
operator|=
name|dir_baton
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|delete_entry
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|base_revision
parameter_list|,
name|void
modifier|*
name|parent_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|dir_baton
modifier|*
name|pb
init|=
name|parent_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|pb
operator|->
name|edit_baton
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"delete_entry : %s:%ld\n"
argument_list|,
name|path
argument_list|,
name|base_revision
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|eb
operator|->
name|wrapped_editor
operator|->
name|delete_entry
argument_list|(
name|path
argument_list|,
name|base_revision
argument_list|,
name|pb
operator|->
name|wrapped_dir_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|add_directory
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|void
modifier|*
name|parent_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|copyfrom_path
parameter_list|,
name|svn_revnum_t
name|copyfrom_revision
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|void
modifier|*
modifier|*
name|child_baton
parameter_list|)
block|{
name|struct
name|dir_baton
modifier|*
name|pb
init|=
name|parent_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|pb
operator|->
name|edit_baton
decl_stmt|;
name|struct
name|dir_baton
modifier|*
name|b
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|b
argument_list|)
argument_list|)
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"add_directory : '%s' [from '%s':%ld]\n"
argument_list|,
name|path
argument_list|,
name|copyfrom_path
argument_list|,
name|copyfrom_revision
argument_list|)
argument_list|)
expr_stmt|;
name|eb
operator|->
name|indent_level
operator|++
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|add_directory
argument_list|(
name|path
argument_list|,
name|pb
operator|->
name|wrapped_dir_baton
argument_list|,
name|copyfrom_path
argument_list|,
name|copyfrom_revision
argument_list|,
name|pool
argument_list|,
operator|&
name|b
operator|->
name|wrapped_dir_baton
argument_list|)
argument_list|)
expr_stmt|;
name|b
operator|->
name|edit_baton
operator|=
name|eb
expr_stmt|;
operator|*
name|child_baton
operator|=
name|b
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|open_directory
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|void
modifier|*
name|parent_baton
parameter_list|,
name|svn_revnum_t
name|base_revision
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|void
modifier|*
modifier|*
name|child_baton
parameter_list|)
block|{
name|struct
name|dir_baton
modifier|*
name|pb
init|=
name|parent_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|pb
operator|->
name|edit_baton
decl_stmt|;
name|struct
name|dir_baton
modifier|*
name|db
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|db
argument_list|)
argument_list|)
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"open_directory : '%s':%ld\n"
argument_list|,
name|path
argument_list|,
name|base_revision
argument_list|)
argument_list|)
expr_stmt|;
name|eb
operator|->
name|indent_level
operator|++
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|open_directory
argument_list|(
name|path
argument_list|,
name|pb
operator|->
name|wrapped_dir_baton
argument_list|,
name|base_revision
argument_list|,
name|pool
argument_list|,
operator|&
name|db
operator|->
name|wrapped_dir_baton
argument_list|)
argument_list|)
expr_stmt|;
name|db
operator|->
name|edit_baton
operator|=
name|eb
expr_stmt|;
operator|*
name|child_baton
operator|=
name|db
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|add_file
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|void
modifier|*
name|parent_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|copyfrom_path
parameter_list|,
name|svn_revnum_t
name|copyfrom_revision
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|void
modifier|*
modifier|*
name|file_baton
parameter_list|)
block|{
name|struct
name|dir_baton
modifier|*
name|pb
init|=
name|parent_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|pb
operator|->
name|edit_baton
decl_stmt|;
name|struct
name|file_baton
modifier|*
name|fb
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|fb
argument_list|)
argument_list|)
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"add_file : '%s' [from '%s':%ld]\n"
argument_list|,
name|path
argument_list|,
name|copyfrom_path
argument_list|,
name|copyfrom_revision
argument_list|)
argument_list|)
expr_stmt|;
name|eb
operator|->
name|indent_level
operator|++
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|add_file
argument_list|(
name|path
argument_list|,
name|pb
operator|->
name|wrapped_dir_baton
argument_list|,
name|copyfrom_path
argument_list|,
name|copyfrom_revision
argument_list|,
name|pool
argument_list|,
operator|&
name|fb
operator|->
name|wrapped_file_baton
argument_list|)
argument_list|)
expr_stmt|;
name|fb
operator|->
name|edit_baton
operator|=
name|eb
expr_stmt|;
operator|*
name|file_baton
operator|=
name|fb
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|open_file
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|void
modifier|*
name|parent_baton
parameter_list|,
name|svn_revnum_t
name|base_revision
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|void
modifier|*
modifier|*
name|file_baton
parameter_list|)
block|{
name|struct
name|dir_baton
modifier|*
name|pb
init|=
name|parent_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|pb
operator|->
name|edit_baton
decl_stmt|;
name|struct
name|file_baton
modifier|*
name|fb
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|fb
argument_list|)
argument_list|)
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"open_file : '%s':%ld\n"
argument_list|,
name|path
argument_list|,
name|base_revision
argument_list|)
argument_list|)
expr_stmt|;
name|eb
operator|->
name|indent_level
operator|++
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|open_file
argument_list|(
name|path
argument_list|,
name|pb
operator|->
name|wrapped_dir_baton
argument_list|,
name|base_revision
argument_list|,
name|pool
argument_list|,
operator|&
name|fb
operator|->
name|wrapped_file_baton
argument_list|)
argument_list|)
expr_stmt|;
name|fb
operator|->
name|edit_baton
operator|=
name|eb
expr_stmt|;
operator|*
name|file_baton
operator|=
name|fb
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|apply_textdelta
parameter_list|(
name|void
modifier|*
name|file_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|base_checksum
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|svn_txdelta_window_handler_t
modifier|*
name|handler
parameter_list|,
name|void
modifier|*
modifier|*
name|handler_baton
parameter_list|)
block|{
name|struct
name|file_baton
modifier|*
name|fb
init|=
name|file_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|fb
operator|->
name|edit_baton
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"apply_textdelta : %s\n"
argument_list|,
name|base_checksum
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|apply_textdelta
argument_list|(
name|fb
operator|->
name|wrapped_file_baton
argument_list|,
name|base_checksum
argument_list|,
name|pool
argument_list|,
name|handler
argument_list|,
name|handler_baton
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|close_file
parameter_list|(
name|void
modifier|*
name|file_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|text_checksum
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|file_baton
modifier|*
name|fb
init|=
name|file_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|fb
operator|->
name|edit_baton
decl_stmt|;
name|eb
operator|->
name|indent_level
operator|--
expr_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"close_file : %s\n"
argument_list|,
name|text_checksum
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|close_file
argument_list|(
name|fb
operator|->
name|wrapped_file_baton
argument_list|,
name|text_checksum
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|absent_file
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|void
modifier|*
name|file_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|file_baton
modifier|*
name|fb
init|=
name|file_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|fb
operator|->
name|edit_baton
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"absent_file : %s\n"
argument_list|,
name|path
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|absent_file
argument_list|(
name|path
argument_list|,
name|fb
operator|->
name|wrapped_file_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|close_directory
parameter_list|(
name|void
modifier|*
name|dir_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|dir_baton
modifier|*
name|db
init|=
name|dir_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|db
operator|->
name|edit_baton
decl_stmt|;
name|eb
operator|->
name|indent_level
operator|--
expr_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"close_directory\n"
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|close_directory
argument_list|(
name|db
operator|->
name|wrapped_dir_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|absent_directory
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|void
modifier|*
name|dir_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|dir_baton
modifier|*
name|db
init|=
name|dir_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|db
operator|->
name|edit_baton
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"absent_directory : %s\n"
argument_list|,
name|path
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|absent_directory
argument_list|(
name|path
argument_list|,
name|db
operator|->
name|wrapped_dir_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|change_file_prop
parameter_list|(
name|void
modifier|*
name|file_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|value
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|file_baton
modifier|*
name|fb
init|=
name|file_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|fb
operator|->
name|edit_baton
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"change_file_prop : %s -> %s\n"
argument_list|,
name|name
argument_list|,
name|value
condition|?
name|value
operator|->
name|data
else|:
literal|"<deleted>"
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|change_file_prop
argument_list|(
name|fb
operator|->
name|wrapped_file_baton
argument_list|,
name|name
argument_list|,
name|value
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|change_dir_prop
parameter_list|(
name|void
modifier|*
name|dir_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|value
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|dir_baton
modifier|*
name|db
init|=
name|dir_baton
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|db
operator|->
name|edit_baton
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"change_dir_prop : %s -> %s\n"
argument_list|,
name|name
argument_list|,
name|value
condition|?
name|value
operator|->
name|data
else|:
literal|"<deleted>"
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|change_dir_prop
argument_list|(
name|db
operator|->
name|wrapped_dir_baton
argument_list|,
name|name
argument_list|,
name|value
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|close_edit
parameter_list|(
name|void
modifier|*
name|edit_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|edit_baton
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"close_edit\n"
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|close_edit
argument_list|(
name|eb
operator|->
name|wrapped_edit_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|svn_error_t
modifier|*
name|abort_edit
parameter_list|(
name|void
modifier|*
name|edit_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|edit_baton
decl_stmt|;
name|SVN_ERR
argument_list|(
name|write_indent
argument_list|(
name|eb
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_stream_printf
argument_list|(
name|eb
operator|->
name|out
argument_list|,
name|pool
argument_list|,
literal|"abort_edit\n"
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|eb
operator|->
name|wrapped_editor
operator|->
name|abort_edit
argument_list|(
name|eb
operator|->
name|wrapped_edit_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_delta__get_debug_editor
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
name|wrapped_editor
parameter_list|,
name|void
modifier|*
name|wrapped_edit_baton
parameter_list|,
specifier|const
name|char
modifier|*
name|prefix
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_delta_editor_t
modifier|*
name|tree_editor
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|tree_editor
argument_list|)
argument_list|)
decl_stmt|;
name|struct
name|edit_baton
modifier|*
name|eb
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|eb
argument_list|)
argument_list|)
decl_stmt|;
name|apr_file_t
modifier|*
name|errfp
decl_stmt|;
name|svn_stream_t
modifier|*
name|out
decl_stmt|;
name|apr_status_t
name|apr_err
init|=
name|apr_file_open_stdout
argument_list|(
operator|&
name|errfp
argument_list|,
name|pool
argument_list|)
decl_stmt|;
if|if
condition|(
name|apr_err
condition|)
return|return
name|svn_error_wrap_apr
argument_list|(
name|apr_err
argument_list|,
literal|"Problem opening stderr"
argument_list|)
return|;
name|out
operator|=
name|svn_stream_from_aprfile2
argument_list|(
name|errfp
argument_list|,
name|TRUE
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|tree_editor
operator|->
name|set_target_revision
operator|=
name|set_target_revision
expr_stmt|;
name|tree_editor
operator|->
name|open_root
operator|=
name|open_root
expr_stmt|;
name|tree_editor
operator|->
name|delete_entry
operator|=
name|delete_entry
expr_stmt|;
name|tree_editor
operator|->
name|add_directory
operator|=
name|add_directory
expr_stmt|;
name|tree_editor
operator|->
name|open_directory
operator|=
name|open_directory
expr_stmt|;
name|tree_editor
operator|->
name|change_dir_prop
operator|=
name|change_dir_prop
expr_stmt|;
name|tree_editor
operator|->
name|close_directory
operator|=
name|close_directory
expr_stmt|;
name|tree_editor
operator|->
name|absent_directory
operator|=
name|absent_directory
expr_stmt|;
name|tree_editor
operator|->
name|add_file
operator|=
name|add_file
expr_stmt|;
name|tree_editor
operator|->
name|open_file
operator|=
name|open_file
expr_stmt|;
name|tree_editor
operator|->
name|apply_textdelta
operator|=
name|apply_textdelta
expr_stmt|;
name|tree_editor
operator|->
name|change_file_prop
operator|=
name|change_file_prop
expr_stmt|;
name|tree_editor
operator|->
name|close_file
operator|=
name|close_file
expr_stmt|;
name|tree_editor
operator|->
name|absent_file
operator|=
name|absent_file
expr_stmt|;
name|tree_editor
operator|->
name|close_edit
operator|=
name|close_edit
expr_stmt|;
name|tree_editor
operator|->
name|abort_edit
operator|=
name|abort_edit
expr_stmt|;
name|eb
operator|->
name|wrapped_editor
operator|=
name|wrapped_editor
expr_stmt|;
name|eb
operator|->
name|wrapped_edit_baton
operator|=
name|wrapped_edit_baton
expr_stmt|;
name|eb
operator|->
name|out
operator|=
name|out
expr_stmt|;
name|eb
operator|->
name|indent_level
operator|=
literal|0
expr_stmt|;
comment|/* This is DBG_FLAG from ../libsvn_subr/debug.c */
name|eb
operator|->
name|prefix
operator|=
name|apr_pstrcat
argument_list|(
name|pool
argument_list|,
literal|"DBG: "
argument_list|,
name|prefix
argument_list|,
name|SVN_VA_NULL
argument_list|)
expr_stmt|;
operator|*
name|editor
operator|=
name|tree_editor
expr_stmt|;
operator|*
name|edit_baton
operator|=
name|eb
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

end_unit

