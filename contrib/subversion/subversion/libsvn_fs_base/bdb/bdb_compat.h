begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* svn_bdb_compat.h --- Compatibility wrapper for different BDB versions.  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|SVN_LIBSVN_FS_BDB_COMPAT_H
end_ifndef

begin_define
define|#
directive|define
name|SVN_LIBSVN_FS_BDB_COMPAT_H
end_define

begin_define
define|#
directive|define
name|SVN_WANT_BDB
end_define

begin_include
include|#
directive|include
file|"svn_private_config.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|__cplusplus
end_ifdef

begin_extern
extern|extern
literal|"C"
block|{
endif|#
directive|endif
comment|/* __cplusplus */
comment|/* Symbols and constants */
comment|/* BDB 4.1 introduced the DB_AUTO_COMMIT flag. Older versions can just    use 0 instead. */
ifdef|#
directive|ifdef
name|DB_AUTO_COMMIT
define|#
directive|define
name|SVN_BDB_AUTO_COMMIT
value|(DB_AUTO_COMMIT)
else|#
directive|else
define|#
directive|define
name|SVN_BDB_AUTO_COMMIT
value|(0)
endif|#
directive|endif
comment|/* DB_INCOMPLETE is obsolete in BDB 4.1. */
ifdef|#
directive|ifdef
name|DB_INCOMPLETE
define|#
directive|define
name|SVN_BDB_HAS_DB_INCOMPLETE
value|1
else|#
directive|else
define|#
directive|define
name|SVN_BDB_HAS_DB_INCOMPLETE
value|0
endif|#
directive|endif
comment|/* In BDB 4.3, "buffer too small" errors come back with    DB_BUFFER_SMALL (instead of ENOMEM, which is now fatal). */
ifdef|#
directive|ifdef
name|DB_BUFFER_SMALL
define|#
directive|define
name|SVN_BDB_DB_BUFFER_SMALL
value|DB_BUFFER_SMALL
else|#
directive|else
define|#
directive|define
name|SVN_BDB_DB_BUFFER_SMALL
value|ENOMEM
endif|#
directive|endif
comment|/* BDB 4.4 introdiced the DB_REGISTER flag for DBEnv::open that allows    for automatic recovery of the databases after a program crash. */
ifdef|#
directive|ifdef
name|DB_REGISTER
define|#
directive|define
name|SVN_BDB_AUTO_RECOVER
value|(DB_REGISTER | DB_RECOVER)
else|#
directive|else
define|#
directive|define
name|SVN_BDB_AUTO_RECOVER
value|(0)
endif|#
directive|endif
comment|/* Explicit BDB version check. */
define|#
directive|define
name|SVN_BDB_VERSION_AT_LEAST
parameter_list|(
name|major
parameter_list|,
name|minor
parameter_list|)
define|\
value|(DB_VERSION_MAJOR> (major) \      || (DB_VERSION_MAJOR == (major)&& DB_VERSION_MINOR>= (minor)))
comment|/* Parameter lists */
comment|/* In BDB 4.1, DB->open takes a transaction parameter. We'll ignore it    when building with 4.0. */
if|#
directive|if
name|SVN_BDB_VERSION_AT_LEAST
argument_list|(
literal|4
operator|,
literal|1
argument_list|)
define|#
directive|define
name|SVN_BDB_OPEN_PARAMS
parameter_list|(
name|env
parameter_list|,
name|txn
parameter_list|)
value|(env), (txn)
else|#
directive|else
define|#
directive|define
name|SVN_BDB_OPEN_PARAMS
parameter_list|(
name|env
parameter_list|,
name|txn
parameter_list|)
value|(env)
endif|#
directive|endif
comment|/* In BDB 4.3, the error gatherer function grew a new DBENV parameter,    and the MSG parameter's type changed. */
if|#
directive|if
name|SVN_BDB_VERSION_AT_LEAST
argument_list|(
literal|4
operator|,
literal|3
argument_list|)
comment|/* Prevents most compilers from whining about unused parameters. */
define|#
directive|define
name|SVN_BDB_ERROR_GATHERER_IGNORE
parameter_list|(
name|varname
parameter_list|)
value|((void)(varname))
else|#
directive|else
define|#
directive|define
name|bdb_error_gatherer
parameter_list|(
name|param1
parameter_list|,
name|param2
parameter_list|,
name|param3
parameter_list|)
define|\
value|bdb_error_gatherer(param2, char *msg)
define|#
directive|define
name|SVN_BDB_ERROR_GATHERER_IGNORE
parameter_list|(
name|varname
parameter_list|)
value|((void)0)
endif|#
directive|endif
comment|/* In BDB 4.3 and later, the file names in DB_ENV->open and DB->open    are assumed to be encoded in UTF-8 on Windows. */
if|#
directive|if
name|defined
argument_list|(
name|WIN32
argument_list|)
operator|&&
name|SVN_BDB_VERSION_AT_LEAST
argument_list|(
literal|4
operator|,
literal|3
argument_list|)
define|#
directive|define
name|SVN_BDB_PATH_UTF8
value|(1)
else|#
directive|else
define|#
directive|define
name|SVN_BDB_PATH_UTF8
value|(0)
endif|#
directive|endif
comment|/* In BDB 4.6, the cursor routines were renamed, and the old names    deprecated. */
if|#
directive|if
name|SVN_BDB_VERSION_AT_LEAST
argument_list|(
literal|4
operator|,
literal|6
argument_list|)
define|#
directive|define
name|svn_bdb_dbc_close
parameter_list|(
name|c
parameter_list|)
value|((c)->close(c))
define|#
directive|define
name|svn_bdb_dbc_count
parameter_list|(
name|c
parameter_list|,
name|r
parameter_list|,
name|f
parameter_list|)
value|((c)->count(c,r,f))
define|#
directive|define
name|svn_bdb_dbc_del
parameter_list|(
name|c
parameter_list|,
name|f
parameter_list|)
value|((c)->del(c,f))
define|#
directive|define
name|svn_bdb_dbc_dup
parameter_list|(
name|c
parameter_list|,
name|p
parameter_list|,
name|f
parameter_list|)
value|((c)->dup(c,p,f))
define|#
directive|define
name|svn_bdb_dbc_get
parameter_list|(
name|c
parameter_list|,
name|k
parameter_list|,
name|d
parameter_list|,
name|f
parameter_list|)
value|((c)->get(c,k,d,f))
define|#
directive|define
name|svn_bdb_dbc_pget
parameter_list|(
name|c
parameter_list|,
name|k
parameter_list|,
name|p
parameter_list|,
name|d
parameter_list|,
name|f
parameter_list|)
value|((c)->pget(c,k,p,d,f))
define|#
directive|define
name|svn_bdb_dbc_put
parameter_list|(
name|c
parameter_list|,
name|k
parameter_list|,
name|d
parameter_list|,
name|f
parameter_list|)
value|((c)->put(c,k,d,f))
else|#
directive|else
define|#
directive|define
name|svn_bdb_dbc_close
parameter_list|(
name|c
parameter_list|)
value|((c)->c_close(c))
define|#
directive|define
name|svn_bdb_dbc_count
parameter_list|(
name|c
parameter_list|,
name|r
parameter_list|,
name|f
parameter_list|)
value|((c)->c_count(c,r,f))
define|#
directive|define
name|svn_bdb_dbc_del
parameter_list|(
name|c
parameter_list|,
name|f
parameter_list|)
value|((c)->c_del(c,f))
define|#
directive|define
name|svn_bdb_dbc_dup
parameter_list|(
name|c
parameter_list|,
name|p
parameter_list|,
name|f
parameter_list|)
value|((c)->c_dup(c,p,f))
define|#
directive|define
name|svn_bdb_dbc_get
parameter_list|(
name|c
parameter_list|,
name|k
parameter_list|,
name|d
parameter_list|,
name|f
parameter_list|)
value|((c)->c_get(c,k,d,f))
define|#
directive|define
name|svn_bdb_dbc_pget
parameter_list|(
name|c
parameter_list|,
name|k
parameter_list|,
name|p
parameter_list|,
name|d
parameter_list|,
name|f
parameter_list|)
value|((c)->c_pget(c,k,p,d,f))
define|#
directive|define
name|svn_bdb_dbc_put
parameter_list|(
name|c
parameter_list|,
name|k
parameter_list|,
name|d
parameter_list|,
name|f
parameter_list|)
value|((c)->c_put(c,k,d,f))
endif|#
directive|endif
comment|/* Before calling db_create, we must check that the version of the BDB    libraries we're linking with is the same as the one we compiled    against, because the DB->open call is not binary compatible between    BDB 4.0 and 4.1. This function returns DB_OLD_VERSION if the    compile-time and run-time versions of BDB don't match. */
name|int
name|svn_fs_bdb__check_version
parameter_list|(
name|void
parameter_list|)
function_decl|;
ifdef|#
directive|ifdef
name|__cplusplus
block|}
end_extern

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* __cplusplus */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* SVN_LIBSVN_FS_BDB_COMPAT_H */
end_comment

end_unit

