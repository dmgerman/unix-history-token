begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * err.c : implementation of fs-private error functions  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_escape
end_escape

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|"svn_private_config.h"
end_include

begin_include
include|#
directive|include
file|"svn_fs.h"
end_include

begin_include
include|#
directive|include
file|"err.h"
end_include

begin_include
include|#
directive|include
file|"id.h"
end_include

begin_include
include|#
directive|include
file|"../libsvn_fs/fs-loader.h"
end_include

begin_escape
end_escape

begin_comment
comment|/* Building common error objects.  */
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_corrupt_fs_revision
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|)
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_CORRUPT
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Corrupt filesystem revision %ld in filesystem '%s'"
argument_list|)
argument_list|,
name|rev
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_dangling_id
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
specifier|const
name|svn_fs_id_t
modifier|*
name|id
parameter_list|)
block|{
name|svn_string_t
modifier|*
name|id_str
init|=
name|svn_fs_base__id_unparse
argument_list|(
name|id
argument_list|,
name|fs
operator|->
name|pool
argument_list|)
decl_stmt|;
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_ID_NOT_FOUND
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Reference to non-existent node '%s' in filesystem '%s'"
argument_list|)
argument_list|,
name|id_str
operator|->
name|data
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_dangling_rev
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|)
block|{
comment|/* Log the UUID as this error may be reported to the client. */
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_NO_SUCH_REVISION
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"No such revision %ld in filesystem '%s'"
argument_list|)
argument_list|,
name|rev
argument_list|,
name|fs
operator|->
name|uuid
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_corrupt_txn
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
specifier|const
name|char
modifier|*
name|txn
parameter_list|)
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_CORRUPT
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Corrupt entry in 'transactions' table for '%s'"
literal|" in filesystem '%s'"
argument_list|)
argument_list|,
name|txn
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_corrupt_copy
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
specifier|const
name|char
modifier|*
name|copy_id
parameter_list|)
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_CORRUPT
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Corrupt entry in 'copies' table for '%s' in filesystem '%s'"
argument_list|)
argument_list|,
name|copy_id
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_no_such_txn
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
specifier|const
name|char
modifier|*
name|txn
parameter_list|)
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_NO_SUCH_TRANSACTION
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"No transaction named '%s' in filesystem '%s'"
argument_list|)
argument_list|,
name|txn
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_txn_not_mutable
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
specifier|const
name|char
modifier|*
name|txn
parameter_list|)
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_TRANSACTION_NOT_MUTABLE
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Cannot modify transaction named '%s' in filesystem '%s'"
argument_list|)
argument_list|,
name|txn
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_no_such_copy
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
specifier|const
name|char
modifier|*
name|copy_id
parameter_list|)
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_NO_SUCH_COPY
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"No copy with id '%s' in filesystem '%s'"
argument_list|)
argument_list|,
name|copy_id
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_bad_lock_token
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
specifier|const
name|char
modifier|*
name|lock_token
parameter_list|)
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_BAD_LOCK_TOKEN
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Token '%s' does not point to any existing lock in filesystem '%s'"
argument_list|)
argument_list|,
name|lock_token
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_no_lock_token
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|)
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_NO_LOCK_TOKEN
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"No token given for path '%s' in filesystem '%s'"
argument_list|)
argument_list|,
name|path
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_corrupt_lock
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
specifier|const
name|char
modifier|*
name|lock_token
parameter_list|)
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_CORRUPT
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Corrupt lock in 'locks' table for '%s' in filesystem '%s'"
argument_list|)
argument_list|,
name|lock_token
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_no_such_node_origin
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
specifier|const
name|char
modifier|*
name|node_id
parameter_list|)
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_NO_SUCH_NODE_ORIGIN
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"No record in 'node-origins' table for node id '%s' in "
literal|"filesystem '%s'"
argument_list|)
argument_list|,
name|node_id
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_fs_base__err_no_such_checksum_rep
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
name|svn_checksum_t
modifier|*
name|checksum
parameter_list|)
block|{
return|return
name|svn_error_createf
argument_list|(
name|SVN_ERR_FS_NO_SUCH_CHECKSUM_REP
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"No record in 'checksum-reps' table for checksum '%s' in "
literal|"filesystem '%s'"
argument_list|)
argument_list|,
name|svn_checksum_to_cstring_display
argument_list|(
name|checksum
argument_list|,
name|fs
operator|->
name|pool
argument_list|)
argument_list|,
name|fs
operator|->
name|path
argument_list|)
return|;
block|}
end_function

end_unit

