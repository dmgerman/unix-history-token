begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * help-cmd.c -- Provide help  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_comment
comment|/* ==================================================================== */
end_comment

begin_escape
end_escape

begin_comment
comment|/*** Includes. ***/
end_comment

begin_include
include|#
directive|include
file|"svn_hash.h"
end_include

begin_include
include|#
directive|include
file|"svn_string.h"
end_include

begin_include
include|#
directive|include
file|"svn_config.h"
end_include

begin_include
include|#
directive|include
file|"svn_error.h"
end_include

begin_include
include|#
directive|include
file|"svn_version.h"
end_include

begin_include
include|#
directive|include
file|"cl.h"
end_include

begin_include
include|#
directive|include
file|"svn_private_config.h"
end_include

begin_escape
end_escape

begin_comment
comment|/*** Code. ***/
end_comment

begin_comment
comment|/* This implements the `svn_opt_subcommand_t' interface. */
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_cl__help
parameter_list|(
name|apr_getopt_t
modifier|*
name|os
parameter_list|,
name|void
modifier|*
name|baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_cl__opt_state_t
modifier|*
name|opt_state
init|=
name|NULL
decl_stmt|;
name|svn_stringbuf_t
modifier|*
name|version_footer
init|=
name|NULL
decl_stmt|;
comment|/* xgettext: the %s is for SVN_VER_NUMBER. */
name|char
name|help_header_template
index|[]
init|=
name|N_
argument_list|(
literal|"usage: svn<subcommand> [options] [args]\n"
literal|"Subversion command-line client, version %s.\n"
literal|"Type 'svn help<subcommand>' for help on a specific subcommand.\n"
literal|"Type 'svn --version' to see the program version and RA modules\n"
literal|"  or 'svn --version --quiet' to see just the version number.\n"
literal|"\n"
literal|"Most subcommands take file and/or directory arguments, recursing\n"
literal|"on the directories.  If no arguments are supplied to such a\n"
literal|"command, it recurses on the current directory (inclusive) by default.\n"
literal|"\n"
literal|"Available subcommands:\n"
argument_list|)
decl_stmt|;
name|char
name|help_footer
index|[]
init|=
name|N_
argument_list|(
literal|"Subversion is a tool for version control.\n"
literal|"For additional information, see http://subversion.apache.org/\n"
argument_list|)
decl_stmt|;
name|char
modifier|*
name|help_header
init|=
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
name|help_header_template
argument_list|)
argument_list|,
name|SVN_VER_NUMBER
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|ra_desc_start
init|=
name|_
argument_list|(
literal|"The following repository access (RA) modules are available:\n\n"
argument_list|)
decl_stmt|;
if|if
condition|(
name|baton
condition|)
block|{
name|svn_cl__cmd_baton_t
modifier|*
specifier|const
name|cmd_baton
init|=
name|baton
decl_stmt|;
ifndef|#
directive|ifndef
name|SVN_DISABLE_PLAINTEXT_PASSWORD_STORAGE
comment|/* Windows never actually stores plaintext passwords, it          encrypts the contents using CryptoAPI. ...           ... If CryptoAPI is available ... but it should be on all          versions of Windows that are even remotely interesting two          days before the scheduled end of the world, when this comment          is being written. */
ifndef|#
directive|ifndef
name|WIN32
name|svn_boolean_t
name|store_auth_creds
init|=
name|SVN_CONFIG_DEFAULT_OPTION_STORE_AUTH_CREDS
decl_stmt|;
name|svn_boolean_t
name|store_passwords
init|=
name|SVN_CONFIG_DEFAULT_OPTION_STORE_PASSWORDS
decl_stmt|;
name|svn_boolean_t
name|store_plaintext_passwords
init|=
name|FALSE
decl_stmt|;
name|svn_config_t
modifier|*
name|cfg
decl_stmt|;
if|if
condition|(
name|cmd_baton
operator|->
name|ctx
operator|->
name|config
condition|)
block|{
name|cfg
operator|=
name|svn_hash_gets
argument_list|(
name|cmd_baton
operator|->
name|ctx
operator|->
name|config
argument_list|,
name|SVN_CONFIG_CATEGORY_CONFIG
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
condition|)
block|{
name|SVN_ERR
argument_list|(
name|svn_config_get_bool
argument_list|(
name|cfg
argument_list|,
operator|&
name|store_auth_creds
argument_list|,
name|SVN_CONFIG_SECTION_AUTH
argument_list|,
name|SVN_CONFIG_OPTION_STORE_AUTH_CREDS
argument_list|,
name|store_auth_creds
argument_list|)
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_config_get_bool
argument_list|(
name|cfg
argument_list|,
operator|&
name|store_passwords
argument_list|,
name|SVN_CONFIG_SECTION_AUTH
argument_list|,
name|SVN_CONFIG_OPTION_STORE_PASSWORDS
argument_list|,
name|store_passwords
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|cfg
operator|=
name|svn_hash_gets
argument_list|(
name|cmd_baton
operator|->
name|ctx
operator|->
name|config
argument_list|,
name|SVN_CONFIG_CATEGORY_SERVERS
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
condition|)
block|{
specifier|const
name|char
modifier|*
name|value
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_config_get_yes_no_ask
argument_list|(
name|cfg
argument_list|,
operator|&
name|value
argument_list|,
name|SVN_CONFIG_SECTION_GLOBAL
argument_list|,
name|SVN_CONFIG_OPTION_STORE_PLAINTEXT_PASSWORDS
argument_list|,
name|SVN_CONFIG_DEFAULT_OPTION_STORE_PLAINTEXT_PASSWORDS
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|==
name|svn_cstring_casecmp
argument_list|(
name|value
argument_list|,
name|SVN_CONFIG_TRUE
argument_list|)
condition|)
name|store_plaintext_passwords
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|store_plaintext_passwords
operator|&&
name|store_auth_creds
operator|&&
name|store_passwords
condition|)
block|{
name|version_footer
operator|=
name|svn_stringbuf_create
argument_list|(
name|_
argument_list|(
literal|"WARNING: Plaintext password storage is enabled!\n\n"
argument_list|)
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|svn_stringbuf_appendcstr
argument_list|(
name|version_footer
argument_list|,
name|ra_desc_start
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* !WIN32 */
endif|#
directive|endif
comment|/* !SVN_DISABLE_PLAINTEXT_PASSWORD_STORAGE */
name|opt_state
operator|=
name|cmd_baton
operator|->
name|opt_state
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|version_footer
condition|)
name|version_footer
operator|=
name|svn_stringbuf_create
argument_list|(
name|ra_desc_start
argument_list|,
name|pool
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_ra_print_modules
argument_list|(
name|version_footer
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_opt_print_help4
argument_list|(
name|os
argument_list|,
literal|"svn"
argument_list|,
comment|/* ### erm, derive somehow? */
name|opt_state
condition|?
name|opt_state
operator|->
name|version
else|:
name|FALSE
argument_list|,
name|opt_state
condition|?
name|opt_state
operator|->
name|quiet
else|:
name|FALSE
argument_list|,
name|opt_state
condition|?
name|opt_state
operator|->
name|verbose
else|:
name|FALSE
argument_list|,
name|version_footer
operator|->
name|data
argument_list|,
name|help_header
argument_list|,
comment|/* already gettext()'d */
name|svn_cl__cmd_table
argument_list|,
name|svn_cl__options
argument_list|,
name|svn_cl__global_options
argument_list|,
name|_
argument_list|(
name|help_footer
argument_list|)
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

end_unit

