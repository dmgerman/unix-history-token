begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * notify.c:  feedback handlers for cmdline client.  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_comment
comment|/* ==================================================================== */
end_comment

begin_escape
end_escape

begin_comment
comment|/*** Includes. ***/
end_comment

begin_define
define|#
directive|define
name|APR_WANT_STDIO
end_define

begin_define
define|#
directive|define
name|APR_WANT_STRFUNC
end_define

begin_include
include|#
directive|include
file|<apr_want.h>
end_include

begin_include
include|#
directive|include
file|"svn_cmdline.h"
end_include

begin_include
include|#
directive|include
file|"svn_pools.h"
end_include

begin_include
include|#
directive|include
file|"svn_dirent_uri.h"
end_include

begin_include
include|#
directive|include
file|"svn_path.h"
end_include

begin_include
include|#
directive|include
file|"svn_sorts.h"
end_include

begin_include
include|#
directive|include
file|"svn_hash.h"
end_include

begin_include
include|#
directive|include
file|"cl.h"
end_include

begin_include
include|#
directive|include
file|"private/svn_subr_private.h"
end_include

begin_include
include|#
directive|include
file|"private/svn_dep_compat.h"
end_include

begin_include
include|#
directive|include
file|"svn_private_config.h"
end_include

begin_escape
end_escape

begin_comment
comment|/* Baton for notify and friends. */
end_comment

begin_struct
struct|struct
name|notify_baton
block|{
name|svn_boolean_t
name|received_some_change
decl_stmt|;
name|svn_boolean_t
name|is_checkout
decl_stmt|;
name|svn_boolean_t
name|is_export
decl_stmt|;
name|svn_boolean_t
name|is_wc_to_repos_copy
decl_stmt|;
name|svn_boolean_t
name|sent_first_txdelta
decl_stmt|;
name|svn_boolean_t
name|in_external
decl_stmt|;
name|svn_boolean_t
name|had_print_error
decl_stmt|;
comment|/* Used to not keep printing error messages                                     when we've already had one print error. */
name|svn_cl__conflict_stats_t
modifier|*
name|conflict_stats
decl_stmt|;
comment|/* The cwd, for use in decomposing absolute paths. */
specifier|const
name|char
modifier|*
name|path_prefix
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Conflict stats for operations such as update and merge. */
end_comment

begin_struct
struct|struct
name|svn_cl__conflict_stats_t
block|{
name|apr_pool_t
modifier|*
name|stats_pool
decl_stmt|;
name|apr_hash_t
modifier|*
name|text_conflicts
decl_stmt|,
modifier|*
name|prop_conflicts
decl_stmt|,
modifier|*
name|tree_conflicts
decl_stmt|;
name|int
name|text_conflicts_resolved
decl_stmt|,
name|prop_conflicts_resolved
decl_stmt|,
name|tree_conflicts_resolved
decl_stmt|;
name|int
name|skipped_paths
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|svn_cl__conflict_stats_t
modifier|*
name|svn_cl__conflict_stats_create
parameter_list|(
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_cl__conflict_stats_t
modifier|*
name|conflict_stats
init|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|conflict_stats
argument_list|)
argument_list|)
decl_stmt|;
name|conflict_stats
operator|->
name|stats_pool
operator|=
name|pool
expr_stmt|;
name|conflict_stats
operator|->
name|text_conflicts
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
name|conflict_stats
operator|->
name|prop_conflicts
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
name|conflict_stats
operator|->
name|tree_conflicts
operator|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
expr_stmt|;
name|conflict_stats
operator|->
name|text_conflicts_resolved
operator|=
literal|0
expr_stmt|;
name|conflict_stats
operator|->
name|prop_conflicts_resolved
operator|=
literal|0
expr_stmt|;
name|conflict_stats
operator|->
name|tree_conflicts_resolved
operator|=
literal|0
expr_stmt|;
name|conflict_stats
operator|->
name|skipped_paths
operator|=
literal|0
expr_stmt|;
return|return
name|conflict_stats
return|;
block|}
end_function

begin_comment
comment|/* Add the PATH (as a key, with a meaningless value) into the HASH in NB. */
end_comment

begin_function
specifier|static
name|void
name|store_path
parameter_list|(
name|struct
name|notify_baton
modifier|*
name|nb
parameter_list|,
name|apr_hash_t
modifier|*
name|hash
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|)
block|{
name|svn_hash_sets
argument_list|(
name|hash
argument_list|,
name|apr_pstrdup
argument_list|(
name|nb
operator|->
name|conflict_stats
operator|->
name|stats_pool
argument_list|,
name|path
argument_list|)
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|svn_cl__conflict_stats_resolved
parameter_list|(
name|svn_cl__conflict_stats_t
modifier|*
name|conflict_stats
parameter_list|,
specifier|const
name|char
modifier|*
name|path_local
parameter_list|,
name|svn_wc_conflict_kind_t
name|conflict_kind
parameter_list|)
block|{
switch|switch
condition|(
name|conflict_kind
condition|)
block|{
case|case
name|svn_wc_conflict_kind_text
case|:
if|if
condition|(
name|svn_hash_gets
argument_list|(
name|conflict_stats
operator|->
name|text_conflicts
argument_list|,
name|path_local
argument_list|)
condition|)
block|{
name|svn_hash_sets
argument_list|(
name|conflict_stats
operator|->
name|text_conflicts
argument_list|,
name|path_local
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|conflict_stats
operator|->
name|text_conflicts_resolved
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|svn_wc_conflict_kind_property
case|:
if|if
condition|(
name|svn_hash_gets
argument_list|(
name|conflict_stats
operator|->
name|prop_conflicts
argument_list|,
name|path_local
argument_list|)
condition|)
block|{
name|svn_hash_sets
argument_list|(
name|conflict_stats
operator|->
name|prop_conflicts
argument_list|,
name|path_local
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|conflict_stats
operator|->
name|prop_conflicts_resolved
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|svn_wc_conflict_kind_tree
case|:
if|if
condition|(
name|svn_hash_gets
argument_list|(
name|conflict_stats
operator|->
name|tree_conflicts
argument_list|,
name|path_local
argument_list|)
condition|)
block|{
name|svn_hash_sets
argument_list|(
name|conflict_stats
operator|->
name|tree_conflicts
argument_list|,
name|path_local
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|conflict_stats
operator|->
name|tree_conflicts_resolved
operator|++
expr_stmt|;
block|}
break|break;
block|}
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|remaining_str
parameter_list|(
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|int
name|n_remaining
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
name|Q_
argument_list|(
literal|"%d remaining"
argument_list|,
literal|"%d remaining"
argument_list|,
name|n_remaining
argument_list|)
argument_list|,
name|n_remaining
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|resolved_str
parameter_list|(
name|apr_pool_t
modifier|*
name|pool
parameter_list|,
name|int
name|n_resolved
parameter_list|)
block|{
return|return
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
name|Q_
argument_list|(
literal|"and %d already resolved"
argument_list|,
literal|"and %d already resolved"
argument_list|,
name|n_resolved
argument_list|)
argument_list|,
name|n_resolved
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_cl__notifier_print_conflict_stats
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|notify_baton
modifier|*
name|nb
init|=
name|baton
decl_stmt|;
name|int
name|n_text
init|=
name|apr_hash_count
argument_list|(
name|nb
operator|->
name|conflict_stats
operator|->
name|text_conflicts
argument_list|)
decl_stmt|;
name|int
name|n_prop
init|=
name|apr_hash_count
argument_list|(
name|nb
operator|->
name|conflict_stats
operator|->
name|prop_conflicts
argument_list|)
decl_stmt|;
name|int
name|n_tree
init|=
name|apr_hash_count
argument_list|(
name|nb
operator|->
name|conflict_stats
operator|->
name|tree_conflicts
argument_list|)
decl_stmt|;
name|int
name|n_text_r
init|=
name|nb
operator|->
name|conflict_stats
operator|->
name|text_conflicts_resolved
decl_stmt|;
name|int
name|n_prop_r
init|=
name|nb
operator|->
name|conflict_stats
operator|->
name|prop_conflicts_resolved
decl_stmt|;
name|int
name|n_tree_r
init|=
name|nb
operator|->
name|conflict_stats
operator|->
name|tree_conflicts_resolved
decl_stmt|;
if|if
condition|(
name|n_text
operator|>
literal|0
operator|||
name|n_text_r
operator|>
literal|0
operator|||
name|n_prop
operator|>
literal|0
operator|||
name|n_prop_r
operator|>
literal|0
operator|||
name|n_tree
operator|>
literal|0
operator|||
name|n_tree_r
operator|>
literal|0
operator|||
name|nb
operator|->
name|conflict_stats
operator|->
name|skipped_paths
operator|>
literal|0
condition|)
name|SVN_ERR
argument_list|(
name|svn_cmdline_printf
argument_list|(
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"Summary of conflicts:\n"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_text_r
operator|==
literal|0
operator|&&
name|n_prop_r
operator|==
literal|0
operator|&&
name|n_tree_r
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|n_text
operator|>
literal|0
condition|)
name|SVN_ERR
argument_list|(
name|svn_cmdline_printf
argument_list|(
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"  Text conflicts: %d\n"
argument_list|)
argument_list|,
name|n_text
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_prop
operator|>
literal|0
condition|)
name|SVN_ERR
argument_list|(
name|svn_cmdline_printf
argument_list|(
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"  Property conflicts: %d\n"
argument_list|)
argument_list|,
name|n_prop
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_tree
operator|>
literal|0
condition|)
name|SVN_ERR
argument_list|(
name|svn_cmdline_printf
argument_list|(
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"  Tree conflicts: %d\n"
argument_list|)
argument_list|,
name|n_tree
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|n_text
operator|>
literal|0
operator|||
name|n_text_r
operator|>
literal|0
condition|)
name|SVN_ERR
argument_list|(
name|svn_cmdline_printf
argument_list|(
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"  Text conflicts: %s (%s)\n"
argument_list|)
argument_list|,
name|remaining_str
argument_list|(
name|scratch_pool
argument_list|,
name|n_text
argument_list|)
argument_list|,
name|resolved_str
argument_list|(
name|scratch_pool
argument_list|,
name|n_text_r
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_prop
operator|>
literal|0
operator|||
name|n_prop_r
operator|>
literal|0
condition|)
name|SVN_ERR
argument_list|(
name|svn_cmdline_printf
argument_list|(
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"  Property conflicts: %s (%s)\n"
argument_list|)
argument_list|,
name|remaining_str
argument_list|(
name|scratch_pool
argument_list|,
name|n_prop
argument_list|)
argument_list|,
name|resolved_str
argument_list|(
name|scratch_pool
argument_list|,
name|n_prop_r
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_tree
operator|>
literal|0
operator|||
name|n_tree_r
operator|>
literal|0
condition|)
name|SVN_ERR
argument_list|(
name|svn_cmdline_printf
argument_list|(
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"  Tree conflicts: %s (%s)\n"
argument_list|)
argument_list|,
name|remaining_str
argument_list|(
name|scratch_pool
argument_list|,
name|n_tree
argument_list|)
argument_list|,
name|resolved_str
argument_list|(
name|scratch_pool
argument_list|,
name|n_tree_r
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|nb
operator|->
name|conflict_stats
operator|->
name|skipped_paths
operator|>
literal|0
condition|)
name|SVN_ERR
argument_list|(
name|svn_cmdline_printf
argument_list|(
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"  Skipped paths: %d\n"
argument_list|)
argument_list|,
name|nb
operator|->
name|conflict_stats
operator|->
name|skipped_paths
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/* This implements `svn_wc_notify_func2_t'.  * NOTE: This function can't fail, so we just ignore any print errors. */
end_comment

begin_function
specifier|static
name|void
name|notify
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|svn_wc_notify_t
modifier|*
name|n
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|notify_baton
modifier|*
name|nb
init|=
name|baton
decl_stmt|;
name|char
name|statchar_buf
index|[
literal|5
index|]
init|=
literal|"    "
decl_stmt|;
specifier|const
name|char
modifier|*
name|path_local
decl_stmt|;
name|svn_error_t
modifier|*
name|err
decl_stmt|;
if|if
condition|(
name|n
operator|->
name|url
condition|)
name|path_local
operator|=
name|n
operator|->
name|url
expr_stmt|;
else|else
block|{
if|if
condition|(
name|n
operator|->
name|path_prefix
condition|)
name|path_local
operator|=
name|svn_cl__local_style_skip_ancestor
argument_list|(
name|n
operator|->
name|path_prefix
argument_list|,
name|n
operator|->
name|path
argument_list|,
name|pool
argument_list|)
expr_stmt|;
else|else
comment|/* skip nb->path_prefix, if it's non-null */
name|path_local
operator|=
name|svn_cl__local_style_skip_ancestor
argument_list|(
name|nb
operator|->
name|path_prefix
argument_list|,
name|n
operator|->
name|path
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|n
operator|->
name|action
condition|)
block|{
case|case
name|svn_wc_notify_skip
case|:
name|nb
operator|->
name|conflict_stats
operator|->
name|skipped_paths
operator|++
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|content_state
operator|==
name|svn_wc_notify_state_missing
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Skipped missing target: '%s'\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
elseif|else
if|if
condition|(
name|n
operator|->
name|content_state
operator|==
name|svn_wc_notify_state_source_missing
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Skipped target: '%s' -- copy-source is missing\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Skipped '%s'\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
break|break;
case|case
name|svn_wc_notify_update_skip_obstruction
case|:
name|nb
operator|->
name|conflict_stats
operator|->
name|skipped_paths
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Skipped '%s' -- An obstructing working copy was found\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_update_skip_working_only
case|:
name|nb
operator|->
name|conflict_stats
operator|->
name|skipped_paths
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Skipped '%s' -- Has no versioned parent\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_update_skip_access_denied
case|:
name|nb
operator|->
name|conflict_stats
operator|->
name|skipped_paths
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Skipped '%s' -- Access denied\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_skip_conflicted
case|:
name|nb
operator|->
name|conflict_stats
operator|->
name|skipped_paths
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Skipped '%s' -- Node remains in conflict\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_update_delete
case|:
case|case
name|svn_wc_notify_exclude
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"D    %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_update_broken_lock
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"B    %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_update_external_removed
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|err
operator|&&
name|n
operator|->
name|err
operator|->
name|message
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"Removed external '%s': %s\n"
argument_list|,
name|path_local
argument_list|,
name|n
operator|->
name|err
operator|->
name|message
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"Removed external '%s'\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
break|break;
case|case
name|svn_wc_notify_left_local_modifications
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"Left local modifications as '%s'\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_update_replace
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"R    %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_update_add
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|content_state
operator|==
name|svn_wc_notify_state_conflicted
condition|)
block|{
name|store_path
argument_list|(
name|nb
argument_list|,
name|nb
operator|->
name|conflict_stats
operator|->
name|text_conflicts
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"C    %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"A    %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
break|break;
case|case
name|svn_wc_notify_exists
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|content_state
operator|==
name|svn_wc_notify_state_conflicted
condition|)
block|{
name|store_path
argument_list|(
name|nb
argument_list|,
name|nb
operator|->
name|conflict_stats
operator|->
name|text_conflicts
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
name|statchar_buf
index|[
literal|0
index|]
operator|=
literal|'C'
expr_stmt|;
block|}
else|else
name|statchar_buf
index|[
literal|0
index|]
operator|=
literal|'E'
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|prop_state
operator|==
name|svn_wc_notify_state_conflicted
condition|)
block|{
name|store_path
argument_list|(
name|nb
argument_list|,
name|nb
operator|->
name|conflict_stats
operator|->
name|prop_conflicts
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
name|statchar_buf
index|[
literal|1
index|]
operator|=
literal|'C'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|n
operator|->
name|prop_state
operator|==
name|svn_wc_notify_state_merged
condition|)
name|statchar_buf
index|[
literal|1
index|]
operator|=
literal|'G'
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"%s %s\n"
argument_list|,
name|statchar_buf
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_restore
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Restored '%s'\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_revert
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Reverted '%s'\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_failed_revert
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Failed to revert '%s' -- "
literal|"try updating instead.\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_resolved
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Resolved conflicted state of '%s'\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_add
case|:
comment|/* We *should* only get the MIME_TYPE if PATH is a file.  If we          do get it, and the mime-type is not textual, note that this          is a binary addition. */
if|if
condition|(
name|n
operator|->
name|mime_type
operator|&&
operator|(
name|svn_mime_type_is_binary
argument_list|(
name|n
operator|->
name|mime_type
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"A  (bin)  %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"A         %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
break|break;
case|case
name|svn_wc_notify_delete
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"D         %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_patch
case|:
block|{
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|content_state
operator|==
name|svn_wc_notify_state_conflicted
condition|)
block|{
name|store_path
argument_list|(
name|nb
argument_list|,
name|nb
operator|->
name|conflict_stats
operator|->
name|text_conflicts
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
name|statchar_buf
index|[
literal|0
index|]
operator|=
literal|'C'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|n
operator|->
name|kind
operator|==
name|svn_node_file
condition|)
block|{
if|if
condition|(
name|n
operator|->
name|content_state
operator|==
name|svn_wc_notify_state_merged
condition|)
name|statchar_buf
index|[
literal|0
index|]
operator|=
literal|'G'
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|content_state
operator|==
name|svn_wc_notify_state_changed
condition|)
name|statchar_buf
index|[
literal|0
index|]
operator|=
literal|'U'
expr_stmt|;
block|}
if|if
condition|(
name|n
operator|->
name|prop_state
operator|==
name|svn_wc_notify_state_conflicted
condition|)
block|{
name|store_path
argument_list|(
name|nb
argument_list|,
name|nb
operator|->
name|conflict_stats
operator|->
name|prop_conflicts
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
name|statchar_buf
index|[
literal|1
index|]
operator|=
literal|'C'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|n
operator|->
name|prop_state
operator|==
name|svn_wc_notify_state_changed
condition|)
name|statchar_buf
index|[
literal|1
index|]
operator|=
literal|'U'
expr_stmt|;
if|if
condition|(
name|statchar_buf
index|[
literal|0
index|]
operator|!=
literal|' '
operator|||
name|statchar_buf
index|[
literal|1
index|]
operator|!=
literal|' '
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"%s      %s\n"
argument_list|,
name|statchar_buf
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
block|}
break|break;
case|case
name|svn_wc_notify_patch_applied_hunk
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|hunk_original_start
operator|!=
name|n
operator|->
name|hunk_matched_line
condition|)
block|{
name|apr_uint64_t
name|off
decl_stmt|;
specifier|const
name|char
modifier|*
name|s
decl_stmt|;
specifier|const
name|char
modifier|*
name|minus
decl_stmt|;
if|if
condition|(
name|n
operator|->
name|hunk_matched_line
operator|>
name|n
operator|->
name|hunk_original_start
condition|)
block|{
comment|/* If we are patching from the start of an empty file,                  it is nicer to show offset 0 */
if|if
condition|(
name|n
operator|->
name|hunk_original_start
operator|==
literal|0
operator|&&
name|n
operator|->
name|hunk_matched_line
operator|==
literal|1
condition|)
name|off
operator|=
literal|0
expr_stmt|;
comment|/* No offset, just adding */
else|else
name|off
operator|=
name|n
operator|->
name|hunk_matched_line
operator|-
name|n
operator|->
name|hunk_original_start
expr_stmt|;
name|minus
operator|=
literal|""
expr_stmt|;
block|}
else|else
block|{
name|off
operator|=
name|n
operator|->
name|hunk_original_start
operator|-
name|n
operator|->
name|hunk_matched_line
expr_stmt|;
name|minus
operator|=
literal|"-"
expr_stmt|;
block|}
comment|/* ### We're creating the localized strings without            * ### APR_INT64_T_FMT since it isn't translator-friendly */
if|if
condition|(
name|n
operator|->
name|hunk_fuzz
condition|)
block|{
if|if
condition|(
name|n
operator|->
name|prop_name
condition|)
block|{
name|s
operator|=
name|_
argument_list|(
literal|">         applied hunk ## -%lu,%lu +%lu,%lu ## "
literal|"with offset %s"
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|apr_pstrcat
argument_list|(
name|pool
argument_list|,
name|s
argument_list|,
literal|"%"
name|APR_UINT64_T_FMT
literal|" and fuzz %lu (%s)\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|)
argument_list|,
name|n
operator|->
name|hunk_original_start
argument_list|,
name|n
operator|->
name|hunk_original_length
argument_list|,
name|n
operator|->
name|hunk_modified_start
argument_list|,
name|n
operator|->
name|hunk_modified_length
argument_list|,
name|minus
argument_list|,
name|off
argument_list|,
name|n
operator|->
name|hunk_fuzz
argument_list|,
name|n
operator|->
name|prop_name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|s
operator|=
name|_
argument_list|(
literal|">         applied hunk @@ -%lu,%lu +%lu,%lu @@ "
literal|"with offset %s"
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|apr_pstrcat
argument_list|(
name|pool
argument_list|,
name|s
argument_list|,
literal|"%"
name|APR_UINT64_T_FMT
literal|" and fuzz %lu\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|)
argument_list|,
name|n
operator|->
name|hunk_original_start
argument_list|,
name|n
operator|->
name|hunk_original_length
argument_list|,
name|n
operator|->
name|hunk_modified_start
argument_list|,
name|n
operator|->
name|hunk_modified_length
argument_list|,
name|minus
argument_list|,
name|off
argument_list|,
name|n
operator|->
name|hunk_fuzz
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
block|}
else|else
block|{
if|if
condition|(
name|n
operator|->
name|prop_name
condition|)
block|{
name|s
operator|=
name|_
argument_list|(
literal|">         applied hunk ## -%lu,%lu +%lu,%lu ## "
literal|"with offset %s"
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|apr_pstrcat
argument_list|(
name|pool
argument_list|,
name|s
argument_list|,
literal|"%"
name|APR_UINT64_T_FMT
literal|" (%s)\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|)
argument_list|,
name|n
operator|->
name|hunk_original_start
argument_list|,
name|n
operator|->
name|hunk_original_length
argument_list|,
name|n
operator|->
name|hunk_modified_start
argument_list|,
name|n
operator|->
name|hunk_modified_length
argument_list|,
name|minus
argument_list|,
name|off
argument_list|,
name|n
operator|->
name|prop_name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|s
operator|=
name|_
argument_list|(
literal|">         applied hunk @@ -%lu,%lu +%lu,%lu @@ "
literal|"with offset %s"
argument_list|)
expr_stmt|;
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|apr_pstrcat
argument_list|(
name|pool
argument_list|,
name|s
argument_list|,
literal|"%"
name|APR_UINT64_T_FMT
literal|"\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|)
argument_list|,
name|n
operator|->
name|hunk_original_start
argument_list|,
name|n
operator|->
name|hunk_original_length
argument_list|,
name|n
operator|->
name|hunk_modified_start
argument_list|,
name|n
operator|->
name|hunk_modified_length
argument_list|,
name|minus
argument_list|,
name|off
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
block|}
block|}
elseif|else
if|if
condition|(
name|n
operator|->
name|hunk_fuzz
condition|)
block|{
if|if
condition|(
name|n
operator|->
name|prop_name
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|">         applied hunk ## -%lu,%lu +%lu,%lu ## "
literal|"with fuzz %lu (%s)\n"
argument_list|)
argument_list|,
name|n
operator|->
name|hunk_original_start
argument_list|,
name|n
operator|->
name|hunk_original_length
argument_list|,
name|n
operator|->
name|hunk_modified_start
argument_list|,
name|n
operator|->
name|hunk_modified_length
argument_list|,
name|n
operator|->
name|hunk_fuzz
argument_list|,
name|n
operator|->
name|prop_name
argument_list|)
expr_stmt|;
else|else
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|">         applied hunk @@ -%lu,%lu +%lu,%lu @@ "
literal|"with fuzz %lu\n"
argument_list|)
argument_list|,
name|n
operator|->
name|hunk_original_start
argument_list|,
name|n
operator|->
name|hunk_original_length
argument_list|,
name|n
operator|->
name|hunk_modified_start
argument_list|,
name|n
operator|->
name|hunk_modified_length
argument_list|,
name|n
operator|->
name|hunk_fuzz
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
block|}
break|break;
case|case
name|svn_wc_notify_patch_rejected_hunk
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|prop_name
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|">         rejected hunk "
literal|"## -%lu,%lu +%lu,%lu ## (%s)\n"
argument_list|)
argument_list|,
name|n
operator|->
name|hunk_original_start
argument_list|,
name|n
operator|->
name|hunk_original_length
argument_list|,
name|n
operator|->
name|hunk_modified_start
argument_list|,
name|n
operator|->
name|hunk_modified_length
argument_list|,
name|n
operator|->
name|prop_name
argument_list|)
expr_stmt|;
else|else
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|">         rejected hunk "
literal|"@@ -%lu,%lu +%lu,%lu @@\n"
argument_list|)
argument_list|,
name|n
operator|->
name|hunk_original_start
argument_list|,
name|n
operator|->
name|hunk_original_length
argument_list|,
name|n
operator|->
name|hunk_modified_start
argument_list|,
name|n
operator|->
name|hunk_modified_length
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_patch_hunk_already_applied
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|prop_name
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|">         hunk "
literal|"## -%lu,%lu +%lu,%lu ## "
literal|"already applied (%s)\n"
argument_list|)
argument_list|,
name|n
operator|->
name|hunk_original_start
argument_list|,
name|n
operator|->
name|hunk_original_length
argument_list|,
name|n
operator|->
name|hunk_modified_start
argument_list|,
name|n
operator|->
name|hunk_modified_length
argument_list|,
name|n
operator|->
name|prop_name
argument_list|)
expr_stmt|;
else|else
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|">         hunk "
literal|"@@ -%lu,%lu +%lu,%lu @@ "
literal|"already applied\n"
argument_list|)
argument_list|,
name|n
operator|->
name|hunk_original_start
argument_list|,
name|n
operator|->
name|hunk_original_length
argument_list|,
name|n
operator|->
name|hunk_modified_start
argument_list|,
name|n
operator|->
name|hunk_modified_length
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_update_update
case|:
case|case
name|svn_wc_notify_merge_record_info
case|:
block|{
if|if
condition|(
name|n
operator|->
name|content_state
operator|==
name|svn_wc_notify_state_conflicted
condition|)
block|{
name|store_path
argument_list|(
name|nb
argument_list|,
name|nb
operator|->
name|conflict_stats
operator|->
name|text_conflicts
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
name|statchar_buf
index|[
literal|0
index|]
operator|=
literal|'C'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|n
operator|->
name|kind
operator|==
name|svn_node_file
condition|)
block|{
if|if
condition|(
name|n
operator|->
name|content_state
operator|==
name|svn_wc_notify_state_merged
condition|)
name|statchar_buf
index|[
literal|0
index|]
operator|=
literal|'G'
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|content_state
operator|==
name|svn_wc_notify_state_changed
condition|)
name|statchar_buf
index|[
literal|0
index|]
operator|=
literal|'U'
expr_stmt|;
block|}
if|if
condition|(
name|n
operator|->
name|prop_state
operator|==
name|svn_wc_notify_state_conflicted
condition|)
block|{
name|store_path
argument_list|(
name|nb
argument_list|,
name|nb
operator|->
name|conflict_stats
operator|->
name|prop_conflicts
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
name|statchar_buf
index|[
literal|1
index|]
operator|=
literal|'C'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|n
operator|->
name|prop_state
operator|==
name|svn_wc_notify_state_merged
condition|)
name|statchar_buf
index|[
literal|1
index|]
operator|=
literal|'G'
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|prop_state
operator|==
name|svn_wc_notify_state_changed
condition|)
name|statchar_buf
index|[
literal|1
index|]
operator|=
literal|'U'
expr_stmt|;
if|if
condition|(
name|n
operator|->
name|lock_state
operator|==
name|svn_wc_notify_lock_state_unlocked
condition|)
name|statchar_buf
index|[
literal|2
index|]
operator|=
literal|'B'
expr_stmt|;
if|if
condition|(
name|statchar_buf
index|[
literal|0
index|]
operator|!=
literal|' '
operator|||
name|statchar_buf
index|[
literal|1
index|]
operator|!=
literal|' '
condition|)
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|statchar_buf
index|[
literal|0
index|]
operator|!=
literal|' '
operator|||
name|statchar_buf
index|[
literal|1
index|]
operator|!=
literal|' '
operator|||
name|statchar_buf
index|[
literal|2
index|]
operator|!=
literal|' '
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"%s %s\n"
argument_list|,
name|statchar_buf
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
block|}
break|break;
case|case
name|svn_wc_notify_update_external
case|:
comment|/* Remember that we're now "inside" an externals definition. */
name|nb
operator|->
name|in_external
operator|=
name|TRUE
expr_stmt|;
comment|/* Currently this is used for checkouts and switches too.  If we          want different output, we'll have to add new actions. */
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"\nFetching external item into '%s':\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_failed_external
case|:
comment|/* If we are currently inside the handling of an externals          definition, then we can simply present n->err as a warning          and feel confident that after this, we aren't handling that          externals definition any longer. */
if|if
condition|(
name|nb
operator|->
name|in_external
condition|)
block|{
name|svn_handle_warning2
argument_list|(
name|stderr
argument_list|,
name|n
operator|->
name|err
argument_list|,
literal|"svn: "
argument_list|)
expr_stmt|;
name|nb
operator|->
name|in_external
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"\n"
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
comment|/* Otherwise, we'll just print two warnings.  Why?  Because          svn_handle_warning2() only shows the single "best message",          but we have two pretty important ones: that the external at          '/some/path' didn't pan out, and then the more specific          reason why (from n->err). */
else|else
block|{
name|svn_error_t
modifier|*
name|warn_err
init|=
name|svn_error_createf
argument_list|(
name|SVN_ERR_BASE
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Error handling externals definition for '%s':"
argument_list|)
argument_list|,
name|path_local
argument_list|)
decl_stmt|;
name|svn_handle_warning2
argument_list|(
name|stderr
argument_list|,
name|warn_err
argument_list|,
literal|"svn: "
argument_list|)
expr_stmt|;
name|svn_error_clear
argument_list|(
name|warn_err
argument_list|)
expr_stmt|;
name|svn_handle_warning2
argument_list|(
name|stderr
argument_list|,
name|n
operator|->
name|err
argument_list|,
literal|"svn: "
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|svn_wc_notify_update_started
case|:
if|if
condition|(
operator|!
operator|(
name|nb
operator|->
name|in_external
operator|||
name|nb
operator|->
name|is_checkout
operator|||
name|nb
operator|->
name|is_export
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Updating '%s':\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
break|break;
case|case
name|svn_wc_notify_update_completed
case|:
block|{
if|if
condition|(
name|SVN_IS_VALID_REVNUM
argument_list|(
name|n
operator|->
name|revision
argument_list|)
condition|)
block|{
if|if
condition|(
name|nb
operator|->
name|is_export
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|in_external
condition|?
name|_
argument_list|(
literal|"Exported external at revision %ld.\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"Exported revision %ld.\n"
argument_list|)
argument_list|,
name|n
operator|->
name|revision
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
elseif|else
if|if
condition|(
name|nb
operator|->
name|is_checkout
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|in_external
condition|?
name|_
argument_list|(
literal|"Checked out external at revision %ld.\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"Checked out revision %ld.\n"
argument_list|)
argument_list|,
name|n
operator|->
name|revision
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
else|else
block|{
if|if
condition|(
name|nb
operator|->
name|received_some_change
condition|)
block|{
name|nb
operator|->
name|received_some_change
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|in_external
condition|?
name|_
argument_list|(
literal|"Updated external to revision %ld.\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"Updated to revision %ld.\n"
argument_list|)
argument_list|,
name|n
operator|->
name|revision
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|in_external
condition|?
name|_
argument_list|(
literal|"External at revision %ld.\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"At revision %ld.\n"
argument_list|)
argument_list|,
name|n
operator|->
name|revision
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
block|}
block|}
else|else
comment|/* no revision */
block|{
if|if
condition|(
name|nb
operator|->
name|is_export
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|in_external
condition|?
name|_
argument_list|(
literal|"External export complete.\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"Export complete.\n"
argument_list|)
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
elseif|else
if|if
condition|(
name|nb
operator|->
name|is_checkout
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|in_external
condition|?
name|_
argument_list|(
literal|"External checkout complete.\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"Checkout complete.\n"
argument_list|)
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|in_external
condition|?
name|_
argument_list|(
literal|"External update complete.\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"Update complete.\n"
argument_list|)
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
block|}
block|}
if|if
condition|(
name|nb
operator|->
name|in_external
condition|)
block|{
name|nb
operator|->
name|in_external
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"\n"
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
break|break;
case|case
name|svn_wc_notify_status_external
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"\nPerforming status on external item at '%s':\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_status_completed
case|:
if|if
condition|(
name|SVN_IS_VALID_REVNUM
argument_list|(
name|n
operator|->
name|revision
argument_list|)
condition|)
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Status against revision: %6ld\n"
argument_list|)
argument_list|,
name|n
operator|->
name|revision
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_commit_modified
case|:
comment|/* xgettext: Align the %s's on this and the following 4 messages */
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|is_wc_to_repos_copy
condition|?
name|_
argument_list|(
literal|"Sending copy of       %s\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"Sending        %s\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_commit_added
case|:
case|case
name|svn_wc_notify_commit_copied
case|:
if|if
condition|(
name|n
operator|->
name|mime_type
operator|&&
name|svn_mime_type_is_binary
argument_list|(
name|n
operator|->
name|mime_type
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|is_wc_to_repos_copy
condition|?
name|_
argument_list|(
literal|"Adding copy of (bin)  %s\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"Adding  (bin)  %s\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|is_wc_to_repos_copy
condition|?
name|_
argument_list|(
literal|"Adding copy of        %s\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"Adding         %s\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
break|break;
case|case
name|svn_wc_notify_commit_deleted
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|is_wc_to_repos_copy
condition|?
name|_
argument_list|(
literal|"Deleting copy of      %s\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"Deleting       %s\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_commit_replaced
case|:
case|case
name|svn_wc_notify_commit_copied_replaced
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|nb
operator|->
name|is_wc_to_repos_copy
condition|?
name|_
argument_list|(
literal|"Replacing copy of     %s\n"
argument_list|)
else|:
name|_
argument_list|(
literal|"Replacing      %s\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_commit_postfix_txdelta
case|:
if|if
condition|(
operator|!
name|nb
operator|->
name|sent_first_txdelta
condition|)
block|{
name|nb
operator|->
name|sent_first_txdelta
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Transmitting file data "
argument_list|)
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
block|}
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"."
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_locked
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"'%s' locked by user '%s'.\n"
argument_list|)
argument_list|,
name|path_local
argument_list|,
name|n
operator|->
name|lock
operator|->
name|owner
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_unlocked
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"'%s' unlocked.\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_failed_lock
case|:
case|case
name|svn_wc_notify_failed_unlock
case|:
name|svn_handle_warning2
argument_list|(
name|stderr
argument_list|,
name|n
operator|->
name|err
argument_list|,
literal|"svn: "
argument_list|)
expr_stmt|;
break|break;
case|case
name|svn_wc_notify_changelist_set
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"A [%s] %s\n"
argument_list|,
name|n
operator|->
name|changelist_name
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_changelist_clear
case|:
case|case
name|svn_wc_notify_changelist_moved
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"D [%s] %s\n"
argument_list|,
name|n
operator|->
name|changelist_name
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_merge_begin
case|:
if|if
condition|(
name|n
operator|->
name|merge_range
operator|==
name|NULL
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Merging differences between "
literal|"repository URLs into '%s':\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|merge_range
operator|->
name|start
operator|==
name|n
operator|->
name|merge_range
operator|->
name|end
operator|-
literal|1
operator|||
name|n
operator|->
name|merge_range
operator|->
name|start
operator|==
name|n
operator|->
name|merge_range
operator|->
name|end
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Merging r%ld into '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|end
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|merge_range
operator|->
name|start
operator|-
literal|1
operator|==
name|n
operator|->
name|merge_range
operator|->
name|end
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Reverse-merging r%ld into '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|start
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|merge_range
operator|->
name|start
operator|<
name|n
operator|->
name|merge_range
operator|->
name|end
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Merging r%ld through r%ld into "
literal|"'%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|start
operator|+
literal|1
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|end
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
else|else
comment|/* n->merge_range->start> n->merge_range->end - 1 */
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Reverse-merging r%ld through r%ld "
literal|"into '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|start
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|end
operator|+
literal|1
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_merge_record_info_begin
case|:
if|if
condition|(
operator|!
name|n
operator|->
name|merge_range
condition|)
block|{
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Recording mergeinfo for merge "
literal|"between repository URLs into '%s':\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|n
operator|->
name|merge_range
operator|->
name|start
operator|==
name|n
operator|->
name|merge_range
operator|->
name|end
operator|-
literal|1
operator|||
name|n
operator|->
name|merge_range
operator|->
name|start
operator|==
name|n
operator|->
name|merge_range
operator|->
name|end
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Recording mergeinfo for merge of r%ld into '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|end
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|merge_range
operator|->
name|start
operator|-
literal|1
operator|==
name|n
operator|->
name|merge_range
operator|->
name|end
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Recording mergeinfo for reverse merge of r%ld into '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|start
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|merge_range
operator|->
name|start
operator|<
name|n
operator|->
name|merge_range
operator|->
name|end
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Recording mergeinfo for merge of r%ld through r%ld into '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|start
operator|+
literal|1
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|end
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
else|else
comment|/* n->merge_range->start> n->merge_range->end - 1 */
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Recording mergeinfo for reverse merge of r%ld through r%ld into '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|start
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|end
operator|+
literal|1
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_merge_elide_info
case|:
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Eliding mergeinfo from '%s':\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_foreign_merge_begin
case|:
if|if
condition|(
name|n
operator|->
name|merge_range
operator|==
name|NULL
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Merging differences between "
literal|"foreign repository URLs into '%s':\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|merge_range
operator|->
name|start
operator|==
name|n
operator|->
name|merge_range
operator|->
name|end
operator|-
literal|1
operator|||
name|n
operator|->
name|merge_range
operator|->
name|start
operator|==
name|n
operator|->
name|merge_range
operator|->
name|end
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Merging (from foreign repository) "
literal|"r%ld into '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|end
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|merge_range
operator|->
name|start
operator|-
literal|1
operator|==
name|n
operator|->
name|merge_range
operator|->
name|end
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Reverse-merging (from foreign "
literal|"repository) r%ld into '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|start
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|->
name|merge_range
operator|->
name|start
operator|<
name|n
operator|->
name|merge_range
operator|->
name|end
condition|)
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Merging (from foreign repository) "
literal|"r%ld through r%ld into '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|start
operator|+
literal|1
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|end
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
else|else
comment|/* n->merge_range->start> n->merge_range->end - 1 */
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Reverse-merging (from foreign "
literal|"repository) r%ld through r%ld into "
literal|"'%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|start
argument_list|,
name|n
operator|->
name|merge_range
operator|->
name|end
operator|+
literal|1
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_tree_conflict
case|:
name|store_path
argument_list|(
name|nb
argument_list|,
name|nb
operator|->
name|conflict_stats
operator|->
name|tree_conflicts
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"   C %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_update_shadowed_add
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"   A %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_update_shadowed_update
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"   U %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_update_shadowed_delete
case|:
name|nb
operator|->
name|received_some_change
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"   D %s\n"
argument_list|,
name|path_local
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_property_modified
case|:
case|case
name|svn_wc_notify_property_added
case|:
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"property '%s' set on '%s'\n"
argument_list|)
argument_list|,
name|n
operator|->
name|prop_name
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_property_deleted
case|:
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"property '%s' deleted from '%s'.\n"
argument_list|)
argument_list|,
name|n
operator|->
name|prop_name
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_property_deleted_nonexistent
case|:
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Attempting to delete nonexistent "
literal|"property '%s' on '%s'\n"
argument_list|)
argument_list|,
name|n
operator|->
name|prop_name
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_revprop_set
case|:
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"property '%s' set on repository revision %ld\n"
argument_list|)
argument_list|,
name|n
operator|->
name|prop_name
argument_list|,
name|n
operator|->
name|revision
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_revprop_deleted
case|:
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"property '%s' deleted from repository revision %ld\n"
argument_list|)
argument_list|,
name|n
operator|->
name|prop_name
argument_list|,
name|n
operator|->
name|revision
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_upgraded_path
case|:
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Upgraded '%s'\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_url_redirect
case|:
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Redirecting to URL '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|url
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_path_nonexistent
case|:
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
literal|"%s\n"
argument_list|,
name|apr_psprintf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"'%s' is not under version control"
argument_list|)
argument_list|,
name|path_local
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
case|case
name|svn_wc_notify_conflict_resolver_starting
case|:
comment|/* Once all operations invoke the interactive conflict resolution after        * they've completed, we can run svn_cl__notifier_print_conflict_stats()        * here. */
break|break;
case|case
name|svn_wc_notify_conflict_resolver_done
case|:
break|break;
case|case
name|svn_wc_notify_foreign_copy_begin
case|:
if|if
condition|(
name|n
operator|->
name|merge_range
operator|==
name|NULL
condition|)
block|{
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"--- Copying from foreign repository URL '%s':\n"
argument_list|)
argument_list|,
name|n
operator|->
name|url
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
block|}
break|break;
case|case
name|svn_wc_notify_move_broken
case|:
name|err
operator|=
name|svn_cmdline_printf
argument_list|(
name|pool
argument_list|,
name|_
argument_list|(
literal|"Breaking move with source path '%s'\n"
argument_list|)
argument_list|,
name|path_local
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
goto|goto
name|print_error
goto|;
break|break;
default|default:
break|break;
block|}
if|if
condition|(
operator|(
name|err
operator|=
name|svn_cmdline_fflush
argument_list|(
name|stdout
argument_list|)
operator|)
condition|)
goto|goto
name|print_error
goto|;
return|return;
name|print_error
label|:
comment|/* If we had no errors before, print this error to stderr. Else, don't print      anything.  The user already knows there were some output errors,      so there is no point in flooding her with an error per notification. */
if|if
condition|(
operator|!
name|nb
operator|->
name|had_print_error
condition|)
block|{
name|nb
operator|->
name|had_print_error
operator|=
name|TRUE
expr_stmt|;
comment|/* Issue #3014:        * Don't print anything on broken pipes. The pipe was likely        * closed by the process at the other end. We expect that        * process to perform error reporting as necessary.        *        * ### This assumes that there is only one error in a chain for        * ### SVN_ERR_IO_PIPE_WRITE_ERROR. See svn_cmdline_fputs(). */
if|if
condition|(
name|err
operator|->
name|apr_err
operator|!=
name|SVN_ERR_IO_PIPE_WRITE_ERROR
condition|)
name|svn_handle_error2
argument_list|(
name|err
argument_list|,
name|stderr
argument_list|,
name|FALSE
argument_list|,
literal|"svn: "
argument_list|)
expr_stmt|;
block|}
name|svn_error_clear
argument_list|(
name|err
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_cl__get_notifier
parameter_list|(
name|svn_wc_notify_func2_t
modifier|*
name|notify_func_p
parameter_list|,
name|void
modifier|*
modifier|*
name|notify_baton_p
parameter_list|,
name|svn_cl__conflict_stats_t
modifier|*
name|conflict_stats
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|notify_baton
modifier|*
name|nb
init|=
name|apr_pcalloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|nb
argument_list|)
argument_list|)
decl_stmt|;
name|nb
operator|->
name|received_some_change
operator|=
name|FALSE
expr_stmt|;
name|nb
operator|->
name|sent_first_txdelta
operator|=
name|FALSE
expr_stmt|;
name|nb
operator|->
name|is_checkout
operator|=
name|FALSE
expr_stmt|;
name|nb
operator|->
name|is_export
operator|=
name|FALSE
expr_stmt|;
name|nb
operator|->
name|is_wc_to_repos_copy
operator|=
name|FALSE
expr_stmt|;
name|nb
operator|->
name|in_external
operator|=
name|FALSE
expr_stmt|;
name|nb
operator|->
name|had_print_error
operator|=
name|FALSE
expr_stmt|;
name|nb
operator|->
name|conflict_stats
operator|=
name|conflict_stats
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_dirent_get_absolute
argument_list|(
operator|&
name|nb
operator|->
name|path_prefix
argument_list|,
literal|""
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|notify_func_p
operator|=
name|notify
expr_stmt|;
operator|*
name|notify_baton_p
operator|=
name|nb
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_cl__notifier_mark_checkout
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|)
block|{
name|struct
name|notify_baton
modifier|*
name|nb
init|=
name|baton
decl_stmt|;
name|nb
operator|->
name|is_checkout
operator|=
name|TRUE
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_cl__notifier_mark_export
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|)
block|{
name|struct
name|notify_baton
modifier|*
name|nb
init|=
name|baton
decl_stmt|;
name|nb
operator|->
name|is_export
operator|=
name|TRUE
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_cl__notifier_mark_wc_to_repos_copy
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|)
block|{
name|struct
name|notify_baton
modifier|*
name|nb
init|=
name|baton
decl_stmt|;
name|nb
operator|->
name|is_wc_to_repos_copy
operator|=
name|TRUE
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|void
name|svn_cl__check_externals_failed_notify_wrapper
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|svn_wc_notify_t
modifier|*
name|n
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|svn_cl__check_externals_failed_notify_baton
modifier|*
name|nwb
init|=
name|baton
decl_stmt|;
if|if
condition|(
name|n
operator|->
name|action
operator|==
name|svn_wc_notify_failed_external
condition|)
name|nwb
operator|->
name|had_externals_error
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|nwb
operator|->
name|wrapped_func
condition|)
name|nwb
operator|->
name|wrapped_func
argument_list|(
name|nwb
operator|->
name|wrapped_baton
argument_list|,
name|n
argument_list|,
name|pool
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

