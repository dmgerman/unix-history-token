begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * deprecated.c:  holding file for all deprecated APIs.  *                "we can't lose 'em, but we can shun 'em!"  *  * ====================================================================  *    Licensed to the Apache Software Foundation (ASF) under one  *    or more contributor license agreements.  See the NOTICE file  *    distributed with this work for additional information  *    regarding copyright ownership.  The ASF licenses this file  *    to you under the Apache License, Version 2.0 (the  *    "License"); you may not use this file except in compliance  *    with the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *    Unless required by applicable law or agreed to in writing,  *    software distributed under the License is distributed on an  *    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  *    KIND, either express or implied.  See the License for the  *    specific language governing permissions and limitations  *    under the License.  * ====================================================================  */
end_comment

begin_comment
comment|/* We define this here to remove any further warnings about the usage of    deprecated functions in this file. */
end_comment

begin_define
define|#
directive|define
name|SVN_DEPRECATED
end_define

begin_include
include|#
directive|include
file|"svn_repos.h"
end_include

begin_include
include|#
directive|include
file|"svn_compat.h"
end_include

begin_include
include|#
directive|include
file|"svn_hash.h"
end_include

begin_include
include|#
directive|include
file|"svn_props.h"
end_include

begin_include
include|#
directive|include
file|"svn_private_config.h"
end_include

begin_include
include|#
directive|include
file|"repos.h"
end_include

begin_escape
end_escape

begin_comment
comment|/*** From commit.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_repos_get_commit_editor4
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_fs_txn_t
modifier|*
name|txn
parameter_list|,
specifier|const
name|char
modifier|*
name|repos_url
parameter_list|,
specifier|const
name|char
modifier|*
name|base_path
parameter_list|,
specifier|const
name|char
modifier|*
name|user
parameter_list|,
specifier|const
name|char
modifier|*
name|log_msg
parameter_list|,
name|svn_commit_callback2_t
name|commit_callback
parameter_list|,
name|void
modifier|*
name|commit_baton
parameter_list|,
name|svn_repos_authz_callback_t
name|authz_callback
parameter_list|,
name|void
modifier|*
name|authz_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|apr_hash_t
modifier|*
name|revprop_table
init|=
name|apr_hash_make
argument_list|(
name|pool
argument_list|)
decl_stmt|;
if|if
condition|(
name|user
condition|)
name|svn_hash_sets
argument_list|(
name|revprop_table
argument_list|,
name|SVN_PROP_REVISION_AUTHOR
argument_list|,
name|svn_string_create
argument_list|(
name|user
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|log_msg
condition|)
name|svn_hash_sets
argument_list|(
name|revprop_table
argument_list|,
name|SVN_PROP_REVISION_LOG
argument_list|,
name|svn_string_create
argument_list|(
name|log_msg
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|svn_repos_get_commit_editor5
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|repos
argument_list|,
name|txn
argument_list|,
name|repos_url
argument_list|,
name|base_path
argument_list|,
name|revprop_table
argument_list|,
name|commit_callback
argument_list|,
name|commit_baton
argument_list|,
name|authz_callback
argument_list|,
name|authz_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_get_commit_editor3
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_fs_txn_t
modifier|*
name|txn
parameter_list|,
specifier|const
name|char
modifier|*
name|repos_url
parameter_list|,
specifier|const
name|char
modifier|*
name|base_path
parameter_list|,
specifier|const
name|char
modifier|*
name|user
parameter_list|,
specifier|const
name|char
modifier|*
name|log_msg
parameter_list|,
name|svn_commit_callback_t
name|callback
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|svn_repos_authz_callback_t
name|authz_callback
parameter_list|,
name|void
modifier|*
name|authz_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_commit_callback2_t
name|callback2
decl_stmt|;
name|void
modifier|*
name|callback2_baton
decl_stmt|;
name|svn_compat_wrap_commit_callback
argument_list|(
operator|&
name|callback2
argument_list|,
operator|&
name|callback2_baton
argument_list|,
name|callback
argument_list|,
name|callback_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_repos_get_commit_editor4
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|repos
argument_list|,
name|txn
argument_list|,
name|repos_url
argument_list|,
name|base_path
argument_list|,
name|user
argument_list|,
name|log_msg
argument_list|,
name|callback2
argument_list|,
name|callback2_baton
argument_list|,
name|authz_callback
argument_list|,
name|authz_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_get_commit_editor2
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_fs_txn_t
modifier|*
name|txn
parameter_list|,
specifier|const
name|char
modifier|*
name|repos_url
parameter_list|,
specifier|const
name|char
modifier|*
name|base_path
parameter_list|,
specifier|const
name|char
modifier|*
name|user
parameter_list|,
specifier|const
name|char
modifier|*
name|log_msg
parameter_list|,
name|svn_commit_callback_t
name|callback
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_get_commit_editor3
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|repos
argument_list|,
name|txn
argument_list|,
name|repos_url
argument_list|,
name|base_path
argument_list|,
name|user
argument_list|,
name|log_msg
argument_list|,
name|callback
argument_list|,
name|callback_baton
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_get_commit_editor
parameter_list|(
specifier|const
name|svn_delta_editor_t
modifier|*
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
modifier|*
name|edit_baton
parameter_list|,
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
specifier|const
name|char
modifier|*
name|repos_url
parameter_list|,
specifier|const
name|char
modifier|*
name|base_path
parameter_list|,
specifier|const
name|char
modifier|*
name|user
parameter_list|,
specifier|const
name|char
modifier|*
name|log_msg
parameter_list|,
name|svn_commit_callback_t
name|callback
parameter_list|,
name|void
modifier|*
name|callback_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_get_commit_editor2
argument_list|(
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|repos
argument_list|,
name|NULL
argument_list|,
name|repos_url
argument_list|,
name|base_path
argument_list|,
name|user
argument_list|,
name|log_msg
argument_list|,
name|callback
argument_list|,
name|callback_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_open
parameter_list|(
name|svn_repos_t
modifier|*
modifier|*
name|repos_p
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_open2
argument_list|(
name|repos_p
argument_list|,
name|path
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From repos.c ***/
end_comment

begin_struct
struct|struct
name|recover_baton
block|{
name|svn_error_t
modifier|*
function_decl|(
modifier|*
name|start_callback
function_decl|)
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|)
function_decl|;
name|void
modifier|*
name|start_callback_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|recovery_started
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|svn_repos_notify_t
modifier|*
name|notify
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|recover_baton
modifier|*
name|rb
init|=
name|baton
decl_stmt|;
if|if
condition|(
name|notify
operator|->
name|action
operator|==
name|svn_repos_notify_mutex_acquired
operator|&&
name|rb
operator|->
name|start_callback
operator|!=
name|NULL
condition|)
name|svn_error_clear
argument_list|(
name|rb
operator|->
name|start_callback
argument_list|(
name|rb
operator|->
name|start_callback_baton
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_recover3
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|nonblocking
parameter_list|,
name|svn_error_t
modifier|*
function_decl|(
modifier|*
name|start_callback
function_decl|)
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|)
parameter_list|,
name|void
modifier|*
name|start_callback_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|recover_baton
name|rb
decl_stmt|;
name|rb
operator|.
name|start_callback
operator|=
name|start_callback
expr_stmt|;
name|rb
operator|.
name|start_callback_baton
operator|=
name|start_callback_baton
expr_stmt|;
return|return
name|svn_repos_recover4
argument_list|(
name|path
argument_list|,
name|nonblocking
argument_list|,
name|recovery_started
argument_list|,
operator|&
name|rb
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_recover2
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|nonblocking
parameter_list|,
name|svn_error_t
modifier|*
function_decl|(
modifier|*
name|start_callback
function_decl|)
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|)
parameter_list|,
name|void
modifier|*
name|start_callback_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_recover3
argument_list|(
name|path
argument_list|,
name|nonblocking
argument_list|,
name|start_callback
argument_list|,
name|start_callback_baton
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_recover
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_recover2
argument_list|(
name|path
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_upgrade
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_boolean_t
name|nonblocking
parameter_list|,
name|svn_error_t
modifier|*
function_decl|(
modifier|*
name|start_callback
function_decl|)
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|)
parameter_list|,
name|void
modifier|*
name|start_callback_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|recover_baton
name|rb
decl_stmt|;
name|rb
operator|.
name|start_callback
operator|=
name|start_callback
expr_stmt|;
name|rb
operator|.
name|start_callback_baton
operator|=
name|start_callback_baton
expr_stmt|;
return|return
name|svn_repos_upgrade2
argument_list|(
name|path
argument_list|,
name|nonblocking
argument_list|,
name|recovery_started
argument_list|,
operator|&
name|rb
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From reporter.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_repos_begin_report
parameter_list|(
name|void
modifier|*
modifier|*
name|report_baton
parameter_list|,
name|svn_revnum_t
name|revnum
parameter_list|,
specifier|const
name|char
modifier|*
name|username
parameter_list|,
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
specifier|const
name|char
modifier|*
name|fs_base
parameter_list|,
specifier|const
name|char
modifier|*
name|s_operand
parameter_list|,
specifier|const
name|char
modifier|*
name|switch_path
parameter_list|,
name|svn_boolean_t
name|text_deltas
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
name|edit_baton
parameter_list|,
name|svn_repos_authz_func_t
name|authz_read_func
parameter_list|,
name|void
modifier|*
name|authz_read_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_begin_report2
argument_list|(
name|report_baton
argument_list|,
name|revnum
argument_list|,
name|repos
argument_list|,
name|fs_base
argument_list|,
name|s_operand
argument_list|,
name|switch_path
argument_list|,
name|text_deltas
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|ignore_ancestry
argument_list|,
name|FALSE
argument_list|,
comment|/* don't send copyfrom args */
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|authz_read_func
argument_list|,
name|authz_read_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_begin_report2
parameter_list|(
name|void
modifier|*
modifier|*
name|report_baton
parameter_list|,
name|svn_revnum_t
name|revnum
parameter_list|,
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
specifier|const
name|char
modifier|*
name|fs_base
parameter_list|,
specifier|const
name|char
modifier|*
name|target
parameter_list|,
specifier|const
name|char
modifier|*
name|tgt_path
parameter_list|,
name|svn_boolean_t
name|text_deltas
parameter_list|,
name|svn_depth_t
name|depth
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|svn_boolean_t
name|send_copyfrom_args
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
name|edit_baton
parameter_list|,
name|svn_repos_authz_func_t
name|authz_read_func
parameter_list|,
name|void
modifier|*
name|authz_read_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_begin_report3
argument_list|(
name|report_baton
argument_list|,
name|revnum
argument_list|,
name|repos
argument_list|,
name|fs_base
argument_list|,
name|target
argument_list|,
name|tgt_path
argument_list|,
name|text_deltas
argument_list|,
name|depth
argument_list|,
name|ignore_ancestry
argument_list|,
name|send_copyfrom_args
argument_list|,
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|authz_read_func
argument_list|,
name|authz_read_baton
argument_list|,
literal|0
argument_list|,
comment|/* disable zero-copy code path */
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_set_path2
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|svn_boolean_t
name|start_empty
parameter_list|,
specifier|const
name|char
modifier|*
name|lock_token
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_set_path3
argument_list|(
name|baton
argument_list|,
name|path
argument_list|,
name|rev
argument_list|,
name|svn_depth_infinity
argument_list|,
name|start_empty
argument_list|,
name|lock_token
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_set_path
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|svn_boolean_t
name|start_empty
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_set_path2
argument_list|(
name|baton
argument_list|,
name|path
argument_list|,
name|rev
argument_list|,
name|start_empty
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_link_path2
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|link_path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|svn_boolean_t
name|start_empty
parameter_list|,
specifier|const
name|char
modifier|*
name|lock_token
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_link_path3
argument_list|(
name|baton
argument_list|,
name|path
argument_list|,
name|link_path
argument_list|,
name|rev
argument_list|,
name|svn_depth_infinity
argument_list|,
name|start_empty
argument_list|,
name|lock_token
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_link_path
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|link_path
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
name|svn_boolean_t
name|start_empty
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_link_path2
argument_list|(
name|baton
argument_list|,
name|path
argument_list|,
name|link_path
argument_list|,
name|rev
argument_list|,
name|start_empty
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From dir-delta.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_repos_dir_delta
parameter_list|(
name|svn_fs_root_t
modifier|*
name|src_root
parameter_list|,
specifier|const
name|char
modifier|*
name|src_parent_dir
parameter_list|,
specifier|const
name|char
modifier|*
name|src_entry
parameter_list|,
name|svn_fs_root_t
modifier|*
name|tgt_root
parameter_list|,
specifier|const
name|char
modifier|*
name|tgt_fullpath
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
name|edit_baton
parameter_list|,
name|svn_repos_authz_func_t
name|authz_read_func
parameter_list|,
name|void
modifier|*
name|authz_read_baton
parameter_list|,
name|svn_boolean_t
name|text_deltas
parameter_list|,
name|svn_boolean_t
name|recurse
parameter_list|,
name|svn_boolean_t
name|entry_props
parameter_list|,
name|svn_boolean_t
name|ignore_ancestry
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_dir_delta2
argument_list|(
name|src_root
argument_list|,
name|src_parent_dir
argument_list|,
name|src_entry
argument_list|,
name|tgt_root
argument_list|,
name|tgt_fullpath
argument_list|,
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|authz_read_func
argument_list|,
name|authz_read_baton
argument_list|,
name|text_deltas
argument_list|,
name|SVN_DEPTH_INFINITY_OR_FILES
argument_list|(
name|recurse
argument_list|)
argument_list|,
name|entry_props
argument_list|,
name|ignore_ancestry
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From replay.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_repos_replay
parameter_list|(
name|svn_fs_root_t
modifier|*
name|root
parameter_list|,
specifier|const
name|svn_delta_editor_t
modifier|*
name|editor
parameter_list|,
name|void
modifier|*
name|edit_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_replay2
argument_list|(
name|root
argument_list|,
literal|""
comment|/* the whole tree */
argument_list|,
name|SVN_INVALID_REVNUM
argument_list|,
comment|/* no low water mark */
name|FALSE
comment|/* no text deltas */
argument_list|,
name|editor
argument_list|,
name|edit_baton
argument_list|,
name|NULL
comment|/* no authz func */
argument_list|,
name|NULL
comment|/* no authz baton */
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From fs-wrap.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_repos_fs_change_rev_prop3
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
specifier|const
name|char
modifier|*
name|author
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|new_value
parameter_list|,
name|svn_boolean_t
name|use_pre_revprop_change_hook
parameter_list|,
name|svn_boolean_t
name|use_post_revprop_change_hook
parameter_list|,
name|svn_repos_authz_func_t
name|authz_read_func
parameter_list|,
name|void
modifier|*
name|authz_read_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_fs_change_rev_prop4
argument_list|(
name|repos
argument_list|,
name|rev
argument_list|,
name|author
argument_list|,
name|name
argument_list|,
name|NULL
argument_list|,
name|new_value
argument_list|,
name|use_pre_revprop_change_hook
argument_list|,
name|use_post_revprop_change_hook
argument_list|,
name|authz_read_func
argument_list|,
name|authz_read_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_fs_change_rev_prop2
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
specifier|const
name|char
modifier|*
name|author
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|new_value
parameter_list|,
name|svn_repos_authz_func_t
name|authz_read_func
parameter_list|,
name|void
modifier|*
name|authz_read_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_fs_change_rev_prop3
argument_list|(
name|repos
argument_list|,
name|rev
argument_list|,
name|author
argument_list|,
name|name
argument_list|,
name|new_value
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
name|authz_read_func
argument_list|,
name|authz_read_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_fs_change_rev_prop
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
specifier|const
name|char
modifier|*
name|author
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|svn_string_t
modifier|*
name|new_value
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_fs_change_rev_prop2
argument_list|(
name|repos
argument_list|,
name|rev
argument_list|,
name|author
argument_list|,
name|name
argument_list|,
name|new_value
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_struct
struct|struct
name|pack_notify_wrapper_baton
block|{
name|svn_fs_pack_notify_t
name|notify_func
decl_stmt|;
name|void
modifier|*
name|notify_baton
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|pack_notify_wrapper_func
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|svn_repos_notify_t
modifier|*
name|notify
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|struct
name|pack_notify_wrapper_baton
modifier|*
name|pnwb
init|=
name|baton
decl_stmt|;
name|svn_error_clear
argument_list|(
name|pnwb
operator|->
name|notify_func
argument_list|(
name|pnwb
operator|->
name|notify_baton
argument_list|,
name|notify
operator|->
name|shard
argument_list|,
name|notify
operator|->
name|action
operator|-
literal|3
argument_list|,
name|scratch_pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_fs_pack
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_fs_pack_notify_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|struct
name|pack_notify_wrapper_baton
name|pnwb
decl_stmt|;
name|pnwb
operator|.
name|notify_func
operator|=
name|notify_func
expr_stmt|;
name|pnwb
operator|.
name|notify_baton
operator|=
name|notify_baton
expr_stmt|;
return|return
name|svn_repos_fs_pack2
argument_list|(
name|repos
argument_list|,
name|pack_notify_wrapper_func
argument_list|,
operator|&
name|pnwb
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_fs_get_locks
parameter_list|(
name|apr_hash_t
modifier|*
modifier|*
name|locks
parameter_list|,
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_repos_authz_func_t
name|authz_read_func
parameter_list|,
name|void
modifier|*
name|authz_read_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_repos_fs_get_locks2
argument_list|(
name|locks
argument_list|,
name|repos
argument_list|,
name|path
argument_list|,
name|svn_depth_infinity
argument_list|,
name|authz_read_func
argument_list|,
name|authz_read_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From logs.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_repos_get_logs3
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_revnum_t
name|start
parameter_list|,
name|svn_revnum_t
name|end
parameter_list|,
name|int
name|limit
parameter_list|,
name|svn_boolean_t
name|discover_changed_paths
parameter_list|,
name|svn_boolean_t
name|strict_node_history
parameter_list|,
name|svn_repos_authz_func_t
name|authz_read_func
parameter_list|,
name|void
modifier|*
name|authz_read_baton
parameter_list|,
name|svn_log_message_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_log_entry_receiver_t
name|receiver2
decl_stmt|;
name|void
modifier|*
name|receiver2_baton
decl_stmt|;
name|svn_compat_wrap_log_receiver
argument_list|(
operator|&
name|receiver2
argument_list|,
operator|&
name|receiver2_baton
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_repos_get_logs4
argument_list|(
name|repos
argument_list|,
name|paths
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|limit
argument_list|,
name|discover_changed_paths
argument_list|,
name|strict_node_history
argument_list|,
name|FALSE
argument_list|,
name|svn_compat_log_revprops_in
argument_list|(
name|pool
argument_list|)
argument_list|,
name|authz_read_func
argument_list|,
name|authz_read_baton
argument_list|,
name|receiver2
argument_list|,
name|receiver2_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_get_logs2
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_revnum_t
name|start
parameter_list|,
name|svn_revnum_t
name|end
parameter_list|,
name|svn_boolean_t
name|discover_changed_paths
parameter_list|,
name|svn_boolean_t
name|strict_node_history
parameter_list|,
name|svn_repos_authz_func_t
name|authz_read_func
parameter_list|,
name|void
modifier|*
name|authz_read_baton
parameter_list|,
name|svn_log_message_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_get_logs3
argument_list|(
name|repos
argument_list|,
name|paths
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
literal|0
argument_list|,
name|discover_changed_paths
argument_list|,
name|strict_node_history
argument_list|,
name|authz_read_func
argument_list|,
name|authz_read_baton
argument_list|,
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_get_logs
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
specifier|const
name|apr_array_header_t
modifier|*
name|paths
parameter_list|,
name|svn_revnum_t
name|start
parameter_list|,
name|svn_revnum_t
name|end
parameter_list|,
name|svn_boolean_t
name|discover_changed_paths
parameter_list|,
name|svn_boolean_t
name|strict_node_history
parameter_list|,
name|svn_log_message_receiver_t
name|receiver
parameter_list|,
name|void
modifier|*
name|receiver_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_get_logs3
argument_list|(
name|repos
argument_list|,
name|paths
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
literal|0
argument_list|,
name|discover_changed_paths
argument_list|,
name|strict_node_history
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
comment|/* no authz stuff */
name|receiver
argument_list|,
name|receiver_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From rev_hunt.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_repos_history
parameter_list|(
name|svn_fs_t
modifier|*
name|fs
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_repos_history_func_t
name|history_func
parameter_list|,
name|void
modifier|*
name|history_baton
parameter_list|,
name|svn_revnum_t
name|start
parameter_list|,
name|svn_revnum_t
name|end
parameter_list|,
name|svn_boolean_t
name|cross_copies
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_history2
argument_list|(
name|fs
argument_list|,
name|path
argument_list|,
name|history_func
argument_list|,
name|history_baton
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|cross_copies
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_get_file_revs
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
specifier|const
name|char
modifier|*
name|path
parameter_list|,
name|svn_revnum_t
name|start
parameter_list|,
name|svn_revnum_t
name|end
parameter_list|,
name|svn_repos_authz_func_t
name|authz_read_func
parameter_list|,
name|void
modifier|*
name|authz_read_baton
parameter_list|,
name|svn_repos_file_rev_handler_t
name|handler
parameter_list|,
name|void
modifier|*
name|handler_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_file_rev_handler_t
name|handler2
decl_stmt|;
name|void
modifier|*
name|handler2_baton
decl_stmt|;
name|svn_compat_wrap_file_rev_handler
argument_list|(
operator|&
name|handler2
argument_list|,
operator|&
name|handler2_baton
argument_list|,
name|handler
argument_list|,
name|handler_baton
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|svn_repos_get_file_revs2
argument_list|(
name|repos
argument_list|,
name|path
argument_list|,
name|start
argument_list|,
name|end
argument_list|,
name|FALSE
argument_list|,
name|authz_read_func
argument_list|,
name|authz_read_baton
argument_list|,
name|handler2
argument_list|,
name|handler2_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From dump.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_repos_dump_fs
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_stream_t
modifier|*
name|stream
parameter_list|,
name|svn_stream_t
modifier|*
name|feedback_stream
parameter_list|,
name|svn_revnum_t
name|start_rev
parameter_list|,
name|svn_revnum_t
name|end_rev
parameter_list|,
name|svn_boolean_t
name|incremental
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_dump_fs2
argument_list|(
name|repos
argument_list|,
name|stream
argument_list|,
name|feedback_stream
argument_list|,
name|start_rev
argument_list|,
name|end_rev
argument_list|,
name|incremental
argument_list|,
name|FALSE
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Implementation of svn_repos_notify_func_t to wrap the output to a    response stream for svn_repos_dump_fs2() and svn_repos_verify_fs() */
end_comment

begin_function
specifier|static
name|void
name|repos_notify_handler
parameter_list|(
name|void
modifier|*
name|baton
parameter_list|,
specifier|const
name|svn_repos_notify_t
modifier|*
name|notify
parameter_list|,
name|apr_pool_t
modifier|*
name|scratch_pool
parameter_list|)
block|{
name|svn_stream_t
modifier|*
name|feedback_stream
init|=
name|baton
decl_stmt|;
name|apr_size_t
name|len
decl_stmt|;
switch|switch
condition|(
name|notify
operator|->
name|action
condition|)
block|{
case|case
name|svn_repos_notify_warning
case|:
name|svn_error_clear
argument_list|(
name|svn_stream_puts
argument_list|(
name|feedback_stream
argument_list|,
name|notify
operator|->
name|warning_str
argument_list|)
argument_list|)
expr_stmt|;
return|return;
case|case
name|svn_repos_notify_dump_rev_end
case|:
name|svn_error_clear
argument_list|(
name|svn_stream_printf
argument_list|(
name|feedback_stream
argument_list|,
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"* Dumped revision %ld.\n"
argument_list|)
argument_list|,
name|notify
operator|->
name|revision
argument_list|)
argument_list|)
expr_stmt|;
return|return;
case|case
name|svn_repos_notify_verify_rev_end
case|:
name|svn_error_clear
argument_list|(
name|svn_stream_printf
argument_list|(
name|feedback_stream
argument_list|,
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"* Verified revision %ld.\n"
argument_list|)
argument_list|,
name|notify
operator|->
name|revision
argument_list|)
argument_list|)
expr_stmt|;
return|return;
case|case
name|svn_repos_notify_load_txn_committed
case|:
if|if
condition|(
name|notify
operator|->
name|old_revision
operator|==
name|SVN_INVALID_REVNUM
condition|)
block|{
name|svn_error_clear
argument_list|(
name|svn_stream_printf
argument_list|(
name|feedback_stream
argument_list|,
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"\n------- Committed revision %ld>>>\n\n"
argument_list|)
argument_list|,
name|notify
operator|->
name|new_revision
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|svn_error_clear
argument_list|(
name|svn_stream_printf
argument_list|(
name|feedback_stream
argument_list|,
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"\n------- Committed new rev %ld"
literal|" (loaded from original rev %ld"
literal|")>>>\n\n"
argument_list|)
argument_list|,
name|notify
operator|->
name|new_revision
argument_list|,
name|notify
operator|->
name|old_revision
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return;
case|case
name|svn_repos_notify_load_node_start
case|:
block|{
switch|switch
condition|(
name|notify
operator|->
name|node_action
condition|)
block|{
case|case
name|svn_node_action_change
case|:
name|svn_error_clear
argument_list|(
name|svn_stream_printf
argument_list|(
name|feedback_stream
argument_list|,
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"     * editing path : %s ..."
argument_list|)
argument_list|,
name|notify
operator|->
name|path
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|svn_node_action_delete
case|:
name|svn_error_clear
argument_list|(
name|svn_stream_printf
argument_list|(
name|feedback_stream
argument_list|,
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"     * deleting path : %s ..."
argument_list|)
argument_list|,
name|notify
operator|->
name|path
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|svn_node_action_add
case|:
name|svn_error_clear
argument_list|(
name|svn_stream_printf
argument_list|(
name|feedback_stream
argument_list|,
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"     * adding path : %s ..."
argument_list|)
argument_list|,
name|notify
operator|->
name|path
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|svn_node_action_replace
case|:
name|svn_error_clear
argument_list|(
name|svn_stream_printf
argument_list|(
name|feedback_stream
argument_list|,
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"     * replacing path : %s ..."
argument_list|)
argument_list|,
name|notify
operator|->
name|path
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
return|return;
case|case
name|svn_repos_notify_load_node_done
case|:
name|len
operator|=
literal|7
expr_stmt|;
name|svn_error_clear
argument_list|(
name|svn_stream_write
argument_list|(
name|feedback_stream
argument_list|,
name|_
argument_list|(
literal|" done.\n"
argument_list|)
argument_list|,
operator|&
name|len
argument_list|)
argument_list|)
expr_stmt|;
return|return;
case|case
name|svn_repos_notify_load_copied_node
case|:
name|len
operator|=
literal|9
expr_stmt|;
name|svn_error_clear
argument_list|(
name|svn_stream_write
argument_list|(
name|feedback_stream
argument_list|,
literal|"COPIED..."
argument_list|,
operator|&
name|len
argument_list|)
argument_list|)
expr_stmt|;
return|return;
case|case
name|svn_repos_notify_load_txn_start
case|:
name|svn_error_clear
argument_list|(
name|svn_stream_printf
argument_list|(
name|feedback_stream
argument_list|,
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|"<<< Started new transaction, based on "
literal|"original revision %ld\n"
argument_list|)
argument_list|,
name|notify
operator|->
name|old_revision
argument_list|)
argument_list|)
expr_stmt|;
return|return;
case|case
name|svn_repos_notify_load_normalized_mergeinfo
case|:
name|svn_error_clear
argument_list|(
name|svn_stream_printf
argument_list|(
name|feedback_stream
argument_list|,
name|scratch_pool
argument_list|,
name|_
argument_list|(
literal|" removing '\\r' from %s ..."
argument_list|)
argument_list|,
name|SVN_PROP_MERGEINFO
argument_list|)
argument_list|)
expr_stmt|;
return|return;
default|default:
return|return;
block|}
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_dump_fs2
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_stream_t
modifier|*
name|stream
parameter_list|,
name|svn_stream_t
modifier|*
name|feedback_stream
parameter_list|,
name|svn_revnum_t
name|start_rev
parameter_list|,
name|svn_revnum_t
name|end_rev
parameter_list|,
name|svn_boolean_t
name|incremental
parameter_list|,
name|svn_boolean_t
name|use_deltas
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_repos_dump_fs3
argument_list|(
name|repos
argument_list|,
name|stream
argument_list|,
name|start_rev
argument_list|,
name|end_rev
argument_list|,
name|incremental
argument_list|,
name|use_deltas
argument_list|,
name|feedback_stream
condition|?
name|repos_notify_handler
else|:
name|NULL
argument_list|,
name|feedback_stream
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_verify_fs
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_stream_t
modifier|*
name|feedback_stream
parameter_list|,
name|svn_revnum_t
name|start_rev
parameter_list|,
name|svn_revnum_t
name|end_rev
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_error_trace
argument_list|(
name|svn_repos_verify_fs2
argument_list|(
name|repos
argument_list|,
name|start_rev
argument_list|,
name|end_rev
argument_list|,
name|feedback_stream
condition|?
name|repos_notify_handler
else|:
name|NULL
argument_list|,
name|feedback_stream
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*** From load.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_repos_load_fs3
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_stream_t
modifier|*
name|dumpstream
parameter_list|,
name|enum
name|svn_repos_load_uuid
name|uuid_action
parameter_list|,
specifier|const
name|char
modifier|*
name|parent_dir
parameter_list|,
name|svn_boolean_t
name|use_pre_commit_hook
parameter_list|,
name|svn_boolean_t
name|use_post_commit_hook
parameter_list|,
name|svn_boolean_t
name|validate_props
parameter_list|,
name|svn_repos_notify_func_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_load_fs4
argument_list|(
name|repos
argument_list|,
name|dumpstream
argument_list|,
name|SVN_INVALID_REVNUM
argument_list|,
name|SVN_INVALID_REVNUM
argument_list|,
name|uuid_action
argument_list|,
name|parent_dir
argument_list|,
name|use_pre_commit_hook
argument_list|,
name|use_post_commit_hook
argument_list|,
name|validate_props
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_load_fs2
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_stream_t
modifier|*
name|dumpstream
parameter_list|,
name|svn_stream_t
modifier|*
name|feedback_stream
parameter_list|,
name|enum
name|svn_repos_load_uuid
name|uuid_action
parameter_list|,
specifier|const
name|char
modifier|*
name|parent_dir
parameter_list|,
name|svn_boolean_t
name|use_pre_commit_hook
parameter_list|,
name|svn_boolean_t
name|use_post_commit_hook
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_load_fs3
argument_list|(
name|repos
argument_list|,
name|dumpstream
argument_list|,
name|uuid_action
argument_list|,
name|parent_dir
argument_list|,
name|use_pre_commit_hook
argument_list|,
name|use_post_commit_hook
argument_list|,
name|FALSE
argument_list|,
name|feedback_stream
condition|?
name|repos_notify_handler
else|:
name|NULL
argument_list|,
name|feedback_stream
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|svn_repos_parser_fns_t
modifier|*
name|fns_from_fns2
parameter_list|(
specifier|const
name|svn_repos_parse_fns2_t
modifier|*
name|fns2
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_repos_parser_fns_t
modifier|*
name|fns
decl_stmt|;
name|fns
operator|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|fns
argument_list|)
argument_list|)
expr_stmt|;
name|fns
operator|->
name|new_revision_record
operator|=
name|fns2
operator|->
name|new_revision_record
expr_stmt|;
name|fns
operator|->
name|uuid_record
operator|=
name|fns2
operator|->
name|uuid_record
expr_stmt|;
name|fns
operator|->
name|new_node_record
operator|=
name|fns2
operator|->
name|new_node_record
expr_stmt|;
name|fns
operator|->
name|set_revision_property
operator|=
name|fns2
operator|->
name|set_revision_property
expr_stmt|;
name|fns
operator|->
name|set_node_property
operator|=
name|fns2
operator|->
name|set_node_property
expr_stmt|;
name|fns
operator|->
name|remove_node_props
operator|=
name|fns2
operator|->
name|remove_node_props
expr_stmt|;
name|fns
operator|->
name|set_fulltext
operator|=
name|fns2
operator|->
name|set_fulltext
expr_stmt|;
name|fns
operator|->
name|close_node
operator|=
name|fns2
operator|->
name|close_node
expr_stmt|;
name|fns
operator|->
name|close_revision
operator|=
name|fns2
operator|->
name|close_revision
expr_stmt|;
return|return
name|fns
return|;
block|}
end_function

begin_function
specifier|static
name|svn_repos_parser_fns2_t
modifier|*
name|fns2_from_fns3
parameter_list|(
specifier|const
name|svn_repos_parse_fns3_t
modifier|*
name|fns3
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_repos_parser_fns2_t
modifier|*
name|fns2
decl_stmt|;
name|fns2
operator|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|fns2
argument_list|)
argument_list|)
expr_stmt|;
name|fns2
operator|->
name|new_revision_record
operator|=
name|fns3
operator|->
name|new_revision_record
expr_stmt|;
name|fns2
operator|->
name|uuid_record
operator|=
name|fns3
operator|->
name|uuid_record
expr_stmt|;
name|fns2
operator|->
name|new_node_record
operator|=
name|fns3
operator|->
name|new_node_record
expr_stmt|;
name|fns2
operator|->
name|set_revision_property
operator|=
name|fns3
operator|->
name|set_revision_property
expr_stmt|;
name|fns2
operator|->
name|set_node_property
operator|=
name|fns3
operator|->
name|set_node_property
expr_stmt|;
name|fns2
operator|->
name|remove_node_props
operator|=
name|fns3
operator|->
name|remove_node_props
expr_stmt|;
name|fns2
operator|->
name|set_fulltext
operator|=
name|fns3
operator|->
name|set_fulltext
expr_stmt|;
name|fns2
operator|->
name|close_node
operator|=
name|fns3
operator|->
name|close_node
expr_stmt|;
name|fns2
operator|->
name|close_revision
operator|=
name|fns3
operator|->
name|close_revision
expr_stmt|;
name|fns2
operator|->
name|delete_node_property
operator|=
name|fns3
operator|->
name|delete_node_property
expr_stmt|;
name|fns2
operator|->
name|apply_textdelta
operator|=
name|fns3
operator|->
name|apply_textdelta
expr_stmt|;
return|return
name|fns2
return|;
block|}
end_function

begin_function
specifier|static
name|svn_repos_parse_fns2_t
modifier|*
name|fns2_from_fns
parameter_list|(
specifier|const
name|svn_repos_parser_fns_t
modifier|*
name|fns
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_repos_parse_fns2_t
modifier|*
name|fns2
decl_stmt|;
name|fns2
operator|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|fns2
argument_list|)
argument_list|)
expr_stmt|;
name|fns2
operator|->
name|new_revision_record
operator|=
name|fns
operator|->
name|new_revision_record
expr_stmt|;
name|fns2
operator|->
name|uuid_record
operator|=
name|fns
operator|->
name|uuid_record
expr_stmt|;
name|fns2
operator|->
name|new_node_record
operator|=
name|fns
operator|->
name|new_node_record
expr_stmt|;
name|fns2
operator|->
name|set_revision_property
operator|=
name|fns
operator|->
name|set_revision_property
expr_stmt|;
name|fns2
operator|->
name|set_node_property
operator|=
name|fns
operator|->
name|set_node_property
expr_stmt|;
name|fns2
operator|->
name|remove_node_props
operator|=
name|fns
operator|->
name|remove_node_props
expr_stmt|;
name|fns2
operator|->
name|set_fulltext
operator|=
name|fns
operator|->
name|set_fulltext
expr_stmt|;
name|fns2
operator|->
name|close_node
operator|=
name|fns
operator|->
name|close_node
expr_stmt|;
name|fns2
operator|->
name|close_revision
operator|=
name|fns
operator|->
name|close_revision
expr_stmt|;
name|fns2
operator|->
name|delete_node_property
operator|=
name|NULL
expr_stmt|;
name|fns2
operator|->
name|apply_textdelta
operator|=
name|NULL
expr_stmt|;
return|return
name|fns2
return|;
block|}
end_function

begin_function
specifier|static
name|svn_repos_parse_fns3_t
modifier|*
name|fns3_from_fns2
parameter_list|(
specifier|const
name|svn_repos_parser_fns2_t
modifier|*
name|fns2
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_repos_parse_fns3_t
modifier|*
name|fns3
decl_stmt|;
name|fns3
operator|=
name|apr_palloc
argument_list|(
name|pool
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|fns3
argument_list|)
argument_list|)
expr_stmt|;
name|fns3
operator|->
name|magic_header_record
operator|=
name|NULL
expr_stmt|;
name|fns3
operator|->
name|uuid_record
operator|=
name|fns2
operator|->
name|uuid_record
expr_stmt|;
name|fns3
operator|->
name|new_revision_record
operator|=
name|fns2
operator|->
name|new_revision_record
expr_stmt|;
name|fns3
operator|->
name|new_node_record
operator|=
name|fns2
operator|->
name|new_node_record
expr_stmt|;
name|fns3
operator|->
name|set_revision_property
operator|=
name|fns2
operator|->
name|set_revision_property
expr_stmt|;
name|fns3
operator|->
name|set_node_property
operator|=
name|fns2
operator|->
name|set_node_property
expr_stmt|;
name|fns3
operator|->
name|remove_node_props
operator|=
name|fns2
operator|->
name|remove_node_props
expr_stmt|;
name|fns3
operator|->
name|set_fulltext
operator|=
name|fns2
operator|->
name|set_fulltext
expr_stmt|;
name|fns3
operator|->
name|close_node
operator|=
name|fns2
operator|->
name|close_node
expr_stmt|;
name|fns3
operator|->
name|close_revision
operator|=
name|fns2
operator|->
name|close_revision
expr_stmt|;
name|fns3
operator|->
name|delete_node_property
operator|=
name|fns2
operator|->
name|delete_node_property
expr_stmt|;
name|fns3
operator|->
name|apply_textdelta
operator|=
name|fns2
operator|->
name|apply_textdelta
expr_stmt|;
return|return
name|fns3
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_parse_dumpstream2
parameter_list|(
name|svn_stream_t
modifier|*
name|stream
parameter_list|,
specifier|const
name|svn_repos_parser_fns2_t
modifier|*
name|parse_fns
parameter_list|,
name|void
modifier|*
name|parse_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_repos_parse_fns3_t
modifier|*
name|fns3
init|=
name|fns3_from_fns2
argument_list|(
name|parse_fns
argument_list|,
name|pool
argument_list|)
decl_stmt|;
return|return
name|svn_repos_parse_dumpstream3
argument_list|(
name|stream
argument_list|,
name|fns3
argument_list|,
name|parse_baton
argument_list|,
name|FALSE
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_parse_dumpstream
parameter_list|(
name|svn_stream_t
modifier|*
name|stream
parameter_list|,
specifier|const
name|svn_repos_parser_fns_t
modifier|*
name|parse_fns
parameter_list|,
name|void
modifier|*
name|parse_baton
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
name|svn_repos_parse_fns2_t
modifier|*
name|fns2
init|=
name|fns2_from_fns
argument_list|(
name|parse_fns
argument_list|,
name|pool
argument_list|)
decl_stmt|;
return|return
name|svn_repos_parse_dumpstream2
argument_list|(
name|stream
argument_list|,
name|fns2
argument_list|,
name|parse_baton
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_load_fs
parameter_list|(
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_stream_t
modifier|*
name|dumpstream
parameter_list|,
name|svn_stream_t
modifier|*
name|feedback_stream
parameter_list|,
name|enum
name|svn_repos_load_uuid
name|uuid_action
parameter_list|,
specifier|const
name|char
modifier|*
name|parent_dir
parameter_list|,
name|svn_cancel_func_t
name|cancel_func
parameter_list|,
name|void
modifier|*
name|cancel_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_load_fs2
argument_list|(
name|repos
argument_list|,
name|dumpstream
argument_list|,
name|feedback_stream
argument_list|,
name|uuid_action
argument_list|,
name|parent_dir
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|cancel_func
argument_list|,
name|cancel_baton
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_get_fs_build_parser3
parameter_list|(
specifier|const
name|svn_repos_parse_fns2_t
modifier|*
modifier|*
name|callbacks
parameter_list|,
name|void
modifier|*
modifier|*
name|parse_baton
parameter_list|,
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_boolean_t
name|use_history
parameter_list|,
name|svn_boolean_t
name|validate_props
parameter_list|,
name|enum
name|svn_repos_load_uuid
name|uuid_action
parameter_list|,
specifier|const
name|char
modifier|*
name|parent_dir
parameter_list|,
name|svn_repos_notify_func_t
name|notify_func
parameter_list|,
name|void
modifier|*
name|notify_baton
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|svn_repos_parse_fns3_t
modifier|*
name|fns3
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_repos_get_fs_build_parser4
argument_list|(
operator|&
name|fns3
argument_list|,
name|parse_baton
argument_list|,
name|repos
argument_list|,
name|SVN_INVALID_REVNUM
argument_list|,
name|SVN_INVALID_REVNUM
argument_list|,
name|use_history
argument_list|,
name|validate_props
argument_list|,
name|uuid_action
argument_list|,
name|parent_dir
argument_list|,
name|notify_func
argument_list|,
name|notify_baton
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|callbacks
operator|=
name|fns2_from_fns3
argument_list|(
name|fns3
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_get_fs_build_parser2
parameter_list|(
specifier|const
name|svn_repos_parse_fns2_t
modifier|*
modifier|*
name|parser
parameter_list|,
name|void
modifier|*
modifier|*
name|parse_baton
parameter_list|,
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_boolean_t
name|use_history
parameter_list|,
name|enum
name|svn_repos_load_uuid
name|uuid_action
parameter_list|,
name|svn_stream_t
modifier|*
name|outstream
parameter_list|,
specifier|const
name|char
modifier|*
name|parent_dir
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos_get_fs_build_parser3
argument_list|(
name|parser
argument_list|,
name|parse_baton
argument_list|,
name|repos
argument_list|,
name|use_history
argument_list|,
name|FALSE
argument_list|,
name|uuid_action
argument_list|,
name|parent_dir
argument_list|,
name|outstream
condition|?
name|repos_notify_handler
else|:
name|NULL
argument_list|,
name|outstream
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_get_fs_build_parser
parameter_list|(
specifier|const
name|svn_repos_parser_fns_t
modifier|*
modifier|*
name|parser_callbacks
parameter_list|,
name|void
modifier|*
modifier|*
name|parse_baton
parameter_list|,
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_boolean_t
name|use_history
parameter_list|,
name|enum
name|svn_repos_load_uuid
name|uuid_action
parameter_list|,
name|svn_stream_t
modifier|*
name|outstream
parameter_list|,
specifier|const
name|char
modifier|*
name|parent_dir
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
specifier|const
name|svn_repos_parse_fns2_t
modifier|*
name|fns2
decl_stmt|;
name|SVN_ERR
argument_list|(
name|svn_repos_get_fs_build_parser2
argument_list|(
operator|&
name|fns2
argument_list|,
name|parse_baton
argument_list|,
name|repos
argument_list|,
name|use_history
argument_list|,
name|uuid_action
argument_list|,
name|outstream
argument_list|,
name|parent_dir
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|parser_callbacks
operator|=
name|fns_from_fns2
argument_list|(
name|fns2
argument_list|,
name|pool
argument_list|)
expr_stmt|;
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_function
name|svn_error_t
modifier|*
name|svn_repos_fs_begin_txn_for_update
parameter_list|(
name|svn_fs_txn_t
modifier|*
modifier|*
name|txn_p
parameter_list|,
name|svn_repos_t
modifier|*
name|repos
parameter_list|,
name|svn_revnum_t
name|rev
parameter_list|,
specifier|const
name|char
modifier|*
name|author
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
comment|/* ### someday, we might run a read-hook here. */
comment|/* Begin the transaction. */
name|SVN_ERR
argument_list|(
name|svn_fs_begin_txn2
argument_list|(
name|txn_p
argument_list|,
name|repos
operator|->
name|fs
argument_list|,
name|rev
argument_list|,
literal|0
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* We pass the author to the filesystem by adding it as a property      on the txn. */
comment|/* User (author). */
if|if
condition|(
name|author
condition|)
block|{
name|svn_string_t
name|val
decl_stmt|;
name|val
operator|.
name|data
operator|=
name|author
expr_stmt|;
name|val
operator|.
name|len
operator|=
name|strlen
argument_list|(
name|author
argument_list|)
expr_stmt|;
name|SVN_ERR
argument_list|(
name|svn_fs_change_txn_prop
argument_list|(
operator|*
name|txn_p
argument_list|,
name|SVN_PROP_REVISION_AUTHOR
argument_list|,
operator|&
name|val
argument_list|,
name|pool
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|SVN_NO_ERROR
return|;
block|}
end_function

begin_comment
comment|/*** From authz.c ***/
end_comment

begin_function
name|svn_error_t
modifier|*
name|svn_repos_authz_read
parameter_list|(
name|svn_authz_t
modifier|*
modifier|*
name|authz_p
parameter_list|,
specifier|const
name|char
modifier|*
name|file
parameter_list|,
name|svn_boolean_t
name|must_exist
parameter_list|,
name|apr_pool_t
modifier|*
name|pool
parameter_list|)
block|{
return|return
name|svn_repos__authz_read
argument_list|(
name|authz_p
argument_list|,
name|file
argument_list|,
name|NULL
argument_list|,
name|must_exist
argument_list|,
name|FALSE
argument_list|,
name|pool
argument_list|)
return|;
block|}
end_function

end_unit

