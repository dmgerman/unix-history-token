begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*    version.c -- Perl 5 interface to Berkeley DB    written by Paul Marquess<Paul.Marquess@btinternet.com>  last modified 16th January 2000  version 1.73   All comments/suggestions/problems are welcome       Copyright (c) 1995-2000 Paul Marquess. All rights reserved.      This program is free software; you can redistribute it and/or      modify it under the same terms as Perl itself.   Changes:         1.71 -  Support for Berkeley DB version 3. 		Support for Berkeley DB 2/3's backward compatability mode.         1.72 -  No change.         1.73 -  Added support for threading         1.74 -  Added Perl core patch 7801.   */
end_comment

begin_include
include|#
directive|include
file|"EXTERN.h"
end_include

begin_include
include|#
directive|include
file|"perl.h"
end_include

begin_include
include|#
directive|include
file|"XSUB.h"
end_include

begin_include
include|#
directive|include
file|<db.h>
end_include

begin_function
name|void
ifdef|#
directive|ifdef
name|CAN_PROTOTYPE
name|__getBerkeleyDBInfo
parameter_list|(
name|void
parameter_list|)
else|#
directive|else
function|__getBerkeleyDBInfo
parameter_list|()
endif|#
directive|endif
block|{
ifdef|#
directive|ifdef
name|dTHX
name|dTHX
expr_stmt|;
endif|#
directive|endif
name|SV
modifier|*
name|version_sv
init|=
name|perl_get_sv
argument_list|(
literal|"DB_File::db_version"
argument_list|,
name|GV_ADD
operator||
name|GV_ADDMULTI
argument_list|)
decl_stmt|;
name|SV
modifier|*
name|ver_sv
init|=
name|perl_get_sv
argument_list|(
literal|"DB_File::db_ver"
argument_list|,
name|GV_ADD
operator||
name|GV_ADDMULTI
argument_list|)
decl_stmt|;
name|SV
modifier|*
name|compat_sv
init|=
name|perl_get_sv
argument_list|(
literal|"DB_File::db_185_compat"
argument_list|,
name|GV_ADD
operator||
name|GV_ADDMULTI
argument_list|)
decl_stmt|;
ifdef|#
directive|ifdef
name|DB_VERSION_MAJOR
name|int
name|Major
decl_stmt|,
name|Minor
decl_stmt|,
name|Patch
decl_stmt|;
operator|(
name|void
operator|)
name|db_version
argument_list|(
operator|&
name|Major
argument_list|,
operator|&
name|Minor
argument_list|,
operator|&
name|Patch
argument_list|)
expr_stmt|;
comment|/* Check that the versions of db.h and libdb.a are the same */
if|if
condition|(
name|Major
operator|!=
name|DB_VERSION_MAJOR
operator|||
name|Minor
operator|!=
name|DB_VERSION_MINOR
operator|||
name|Patch
operator|!=
name|DB_VERSION_PATCH
condition|)
name|croak
argument_list|(
literal|"\nDB_File needs compatible versions of libdb& db.h\n\tyou have db.h version %d.%d.%d and libdb version %d.%d.%d\n"
argument_list|,
name|DB_VERSION_MAJOR
argument_list|,
name|DB_VERSION_MINOR
argument_list|,
name|DB_VERSION_PATCH
argument_list|,
name|Major
argument_list|,
name|Minor
argument_list|,
name|Patch
argument_list|)
expr_stmt|;
comment|/* check that libdb is recent enough  -- we need 2.3.4 or greater */
if|if
condition|(
name|Major
operator|==
literal|2
operator|&&
operator|(
name|Minor
operator|<
literal|3
operator|||
operator|(
name|Minor
operator|==
literal|3
operator|&&
name|Patch
operator|<
literal|4
operator|)
operator|)
condition|)
name|croak
argument_list|(
literal|"DB_File needs Berkeley DB 2.3.4 or greater, you have %d.%d.%d\n"
argument_list|,
name|Major
argument_list|,
name|Minor
argument_list|,
name|Patch
argument_list|)
expr_stmt|;
block|{
name|char
name|buffer
index|[
literal|40
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%d.%d"
argument_list|,
name|Major
argument_list|,
name|Minor
argument_list|)
expr_stmt|;
name|sv_setpv
argument_list|(
name|version_sv
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%d.%03d%03d"
argument_list|,
name|Major
argument_list|,
name|Minor
argument_list|,
name|Patch
argument_list|)
expr_stmt|;
name|sv_setpv
argument_list|(
name|ver_sv
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
comment|/* ! DB_VERSION_MAJOR */
name|sv_setiv
argument_list|(
name|version_sv
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sv_setiv
argument_list|(
name|ver_sv
argument_list|,
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* ! DB_VERSION_MAJOR */
ifdef|#
directive|ifdef
name|COMPAT185
name|sv_setiv
argument_list|(
name|compat_sv
argument_list|,
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* ! COMPAT185 */
name|sv_setiv
argument_list|(
name|compat_sv
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* ! COMPAT185 */
block|}
end_function

end_unit

