begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*    scope.c  *  *    Copyright (c) 1991-2001, Larry Wall  *  *    You may distribute under the terms of either the GNU General Public  *    License or the Artistic License, as specified in the README file.  *  */
end_comment

begin_comment
comment|/*  * "For the fashion of Minas Tirith was such that it was built on seven  * levels..."  */
end_comment

begin_include
include|#
directive|include
file|"EXTERN.h"
end_include

begin_define
define|#
directive|define
name|PERL_IN_SCOPE_C
end_define

begin_include
include|#
directive|include
file|"perl.h"
end_include

begin_if
if|#
directive|if
name|defined
argument_list|(
name|PERL_FLEXIBLE_EXCEPTIONS
argument_list|)
end_if

begin_function
name|void
modifier|*
name|Perl_default_protect
parameter_list|(
name|pTHX_
specifier|volatile
name|JMPENV
modifier|*
name|pcur_env
parameter_list|,
name|int
modifier|*
name|excpt
parameter_list|,
name|protect_body_t
name|body
parameter_list|,
modifier|...
parameter_list|)
block|{
name|void
modifier|*
name|ret
decl_stmt|;
name|va_list
name|args
decl_stmt|;
name|va_start
argument_list|(
name|args
argument_list|,
name|body
argument_list|)
expr_stmt|;
name|ret
operator|=
name|vdefault_protect
argument_list|(
name|pcur_env
argument_list|,
name|excpt
argument_list|,
name|body
argument_list|,
operator|&
name|args
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|Perl_vdefault_protect
parameter_list|(
name|pTHX_
specifier|volatile
name|JMPENV
modifier|*
name|pcur_env
parameter_list|,
name|int
modifier|*
name|excpt
parameter_list|,
name|protect_body_t
name|body
parameter_list|,
name|va_list
modifier|*
name|args
parameter_list|)
block|{
name|int
name|ex
decl_stmt|;
name|void
modifier|*
name|ret
decl_stmt|;
name|JMPENV_PUSH
argument_list|(
name|ex
argument_list|)
expr_stmt|;
if|if
condition|(
name|ex
condition|)
name|ret
operator|=
name|NULL
expr_stmt|;
else|else
name|ret
operator|=
name|CALL_FPTR
argument_list|(
name|body
argument_list|)
argument_list|(
name|aTHX_
operator|*
name|args
argument_list|)
expr_stmt|;
operator|*
name|excpt
operator|=
name|ex
expr_stmt|;
name|JMPENV_POP
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|SV
modifier|*
modifier|*
name|Perl_stack_grow
parameter_list|(
name|pTHX_
name|SV
modifier|*
modifier|*
name|sp
parameter_list|,
name|SV
modifier|*
modifier|*
name|p
parameter_list|,
name|int
name|n
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|DEBUGGING
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|USE_THREADS
argument_list|)
specifier|static
name|int
name|growing
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|growing
operator|++
condition|)
name|abort
argument_list|()
expr_stmt|;
endif|#
directive|endif
name|PL_stack_sp
operator|=
name|sp
expr_stmt|;
ifndef|#
directive|ifndef
name|STRESS_REALLOC
name|av_extend
argument_list|(
name|PL_curstack
argument_list|,
operator|(
name|p
operator|-
name|PL_stack_base
operator|)
operator|+
operator|(
name|n
operator|)
operator|+
literal|128
argument_list|)
expr_stmt|;
else|#
directive|else
name|av_extend
argument_list|(
name|PL_curstack
argument_list|,
operator|(
name|p
operator|-
name|PL_stack_base
operator|)
operator|+
operator|(
name|n
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|DEBUGGING
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|USE_THREADS
argument_list|)
name|growing
operator|--
expr_stmt|;
endif|#
directive|endif
return|return
name|PL_stack_sp
return|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|STRESS_REALLOC
end_ifndef

begin_define
define|#
directive|define
name|GROW
parameter_list|(
name|old
parameter_list|)
value|((old) * 3 / 2)
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|GROW
parameter_list|(
name|old
parameter_list|)
value|((old) + 1)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|PERL_SI
modifier|*
name|Perl_new_stackinfo
parameter_list|(
name|pTHX_
name|I32
name|stitems
parameter_list|,
name|I32
name|cxitems
parameter_list|)
block|{
name|PERL_SI
modifier|*
name|si
decl_stmt|;
name|New
argument_list|(
literal|56
argument_list|,
name|si
argument_list|,
literal|1
argument_list|,
name|PERL_SI
argument_list|)
expr_stmt|;
name|si
operator|->
name|si_stack
operator|=
name|newAV
argument_list|()
expr_stmt|;
name|AvREAL_off
argument_list|(
name|si
operator|->
name|si_stack
argument_list|)
expr_stmt|;
name|av_extend
argument_list|(
name|si
operator|->
name|si_stack
argument_list|,
name|stitems
operator|>
literal|0
condition|?
name|stitems
operator|-
literal|1
else|:
literal|0
argument_list|)
expr_stmt|;
name|AvALLOC
argument_list|(
name|si
operator|->
name|si_stack
argument_list|)
index|[
literal|0
index|]
operator|=
operator|&
name|PL_sv_undef
expr_stmt|;
name|AvFILLp
argument_list|(
name|si
operator|->
name|si_stack
argument_list|)
operator|=
literal|0
expr_stmt|;
name|si
operator|->
name|si_prev
operator|=
literal|0
expr_stmt|;
name|si
operator|->
name|si_next
operator|=
literal|0
expr_stmt|;
name|si
operator|->
name|si_cxmax
operator|=
name|cxitems
operator|-
literal|1
expr_stmt|;
name|si
operator|->
name|si_cxix
operator|=
operator|-
literal|1
expr_stmt|;
name|si
operator|->
name|si_type
operator|=
name|PERLSI_UNDEF
expr_stmt|;
name|New
argument_list|(
literal|56
argument_list|,
name|si
operator|->
name|si_cxstack
argument_list|,
name|cxitems
argument_list|,
name|PERL_CONTEXT
argument_list|)
expr_stmt|;
return|return
name|si
return|;
block|}
end_function

begin_function
name|I32
name|Perl_cxinc
parameter_list|(
name|pTHX
parameter_list|)
block|{
name|cxstack_max
operator|=
name|GROW
argument_list|(
name|cxstack_max
argument_list|)
expr_stmt|;
name|Renew
argument_list|(
name|cxstack
argument_list|,
name|cxstack_max
operator|+
literal|1
argument_list|,
name|PERL_CONTEXT
argument_list|)
expr_stmt|;
comment|/* XXX should fix CXINC macro */
return|return
name|cxstack_ix
operator|+
literal|1
return|;
block|}
end_function

begin_function
name|void
name|Perl_push_return
parameter_list|(
name|pTHX_
name|OP
modifier|*
name|retop
parameter_list|)
block|{
if|if
condition|(
name|PL_retstack_ix
operator|==
name|PL_retstack_max
condition|)
block|{
name|PL_retstack_max
operator|=
name|GROW
argument_list|(
name|PL_retstack_max
argument_list|)
expr_stmt|;
name|Renew
argument_list|(
name|PL_retstack
argument_list|,
name|PL_retstack_max
argument_list|,
name|OP
operator|*
argument_list|)
expr_stmt|;
block|}
name|PL_retstack
index|[
name|PL_retstack_ix
operator|++
index|]
operator|=
name|retop
expr_stmt|;
block|}
end_function

begin_function
name|OP
modifier|*
name|Perl_pop_return
parameter_list|(
name|pTHX
parameter_list|)
block|{
if|if
condition|(
name|PL_retstack_ix
operator|>
literal|0
condition|)
return|return
name|PL_retstack
index|[
operator|--
name|PL_retstack_ix
index|]
return|;
else|else
return|return
name|Nullop
return|;
block|}
end_function

begin_function
name|void
name|Perl_push_scope
parameter_list|(
name|pTHX
parameter_list|)
block|{
if|if
condition|(
name|PL_scopestack_ix
operator|==
name|PL_scopestack_max
condition|)
block|{
name|PL_scopestack_max
operator|=
name|GROW
argument_list|(
name|PL_scopestack_max
argument_list|)
expr_stmt|;
name|Renew
argument_list|(
name|PL_scopestack
argument_list|,
name|PL_scopestack_max
argument_list|,
name|I32
argument_list|)
expr_stmt|;
block|}
name|PL_scopestack
index|[
name|PL_scopestack_ix
operator|++
index|]
operator|=
name|PL_savestack_ix
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_pop_scope
parameter_list|(
name|pTHX
parameter_list|)
block|{
name|I32
name|oldsave
init|=
name|PL_scopestack
index|[
operator|--
name|PL_scopestack_ix
index|]
decl_stmt|;
name|LEAVE_SCOPE
argument_list|(
name|oldsave
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_markstack_grow
parameter_list|(
name|pTHX
parameter_list|)
block|{
name|I32
name|oldmax
init|=
name|PL_markstack_max
operator|-
name|PL_markstack
decl_stmt|;
name|I32
name|newmax
init|=
name|GROW
argument_list|(
name|oldmax
argument_list|)
decl_stmt|;
name|Renew
argument_list|(
name|PL_markstack
argument_list|,
name|newmax
argument_list|,
name|I32
argument_list|)
expr_stmt|;
name|PL_markstack_ptr
operator|=
name|PL_markstack
operator|+
name|oldmax
expr_stmt|;
name|PL_markstack_max
operator|=
name|PL_markstack
operator|+
name|newmax
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_savestack_grow
parameter_list|(
name|pTHX
parameter_list|)
block|{
name|PL_savestack_max
operator|=
name|GROW
argument_list|(
name|PL_savestack_max
argument_list|)
operator|+
literal|4
expr_stmt|;
name|Renew
argument_list|(
name|PL_savestack
argument_list|,
name|PL_savestack_max
argument_list|,
name|ANY
argument_list|)
expr_stmt|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|GROW
end_undef

begin_function
name|void
name|Perl_tmps_grow
parameter_list|(
name|pTHX_
name|I32
name|n
parameter_list|)
block|{
ifndef|#
directive|ifndef
name|STRESS_REALLOC
if|if
condition|(
name|n
operator|<
literal|128
condition|)
name|n
operator|=
operator|(
name|PL_tmps_max
operator|<
literal|512
operator|)
condition|?
literal|128
else|:
literal|512
expr_stmt|;
endif|#
directive|endif
name|PL_tmps_max
operator|=
name|PL_tmps_ix
operator|+
name|n
operator|+
literal|1
expr_stmt|;
name|Renew
argument_list|(
name|PL_tmps_stack
argument_list|,
name|PL_tmps_max
argument_list|,
name|SV
operator|*
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_free_tmps
parameter_list|(
name|pTHX
parameter_list|)
block|{
comment|/* XXX should tmps_floor live in cxstack? */
name|I32
name|myfloor
init|=
name|PL_tmps_floor
decl_stmt|;
while|while
condition|(
name|PL_tmps_ix
operator|>
name|myfloor
condition|)
block|{
comment|/* clean up after last statement */
name|SV
modifier|*
name|sv
init|=
name|PL_tmps_stack
index|[
name|PL_tmps_ix
index|]
decl_stmt|;
name|PL_tmps_stack
index|[
name|PL_tmps_ix
operator|--
index|]
operator|=
name|Nullsv
expr_stmt|;
if|if
condition|(
name|sv
condition|)
block|{
name|SvTEMP_off
argument_list|(
name|sv
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|sv
argument_list|)
expr_stmt|;
comment|/* note, can modify tmps_ix!!! */
block|}
block|}
block|}
end_function

begin_function
name|STATIC
name|SV
modifier|*
name|S_save_scalar_at
parameter_list|(
name|pTHX_
name|SV
modifier|*
modifier|*
name|sptr
parameter_list|)
block|{
specifier|register
name|SV
modifier|*
name|sv
decl_stmt|;
name|SV
modifier|*
name|osv
init|=
operator|*
name|sptr
decl_stmt|;
name|sv
operator|=
operator|*
name|sptr
operator|=
name|NEWSV
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|SvTYPE
argument_list|(
name|osv
argument_list|)
operator|>=
name|SVt_PVMG
operator|&&
name|SvMAGIC
argument_list|(
name|osv
argument_list|)
operator|&&
name|SvTYPE
argument_list|(
name|osv
argument_list|)
operator|!=
name|SVt_PVGV
condition|)
block|{
name|sv_upgrade
argument_list|(
name|sv
argument_list|,
name|SvTYPE
argument_list|(
name|osv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|SvGMAGICAL
argument_list|(
name|osv
argument_list|)
condition|)
block|{
name|MAGIC
modifier|*
name|mg
decl_stmt|;
name|bool
name|oldtainted
init|=
name|PL_tainted
decl_stmt|;
name|mg_get
argument_list|(
name|osv
argument_list|)
expr_stmt|;
comment|/* note, can croak! */
if|if
condition|(
name|PL_tainting
operator|&&
name|PL_tainted
operator|&&
operator|(
name|mg
operator|=
name|mg_find
argument_list|(
name|osv
argument_list|,
literal|'t'
argument_list|)
operator|)
condition|)
block|{
name|SAVESPTR
argument_list|(
name|mg
operator|->
name|mg_obj
argument_list|)
expr_stmt|;
name|mg
operator|->
name|mg_obj
operator|=
name|osv
expr_stmt|;
block|}
name|SvFLAGS
argument_list|(
name|osv
argument_list|)
operator||=
operator|(
name|SvFLAGS
argument_list|(
name|osv
argument_list|)
operator|&
operator|(
name|SVp_IOK
operator||
name|SVp_NOK
operator||
name|SVp_POK
operator|)
operator|)
operator|>>
name|PRIVSHIFT
expr_stmt|;
name|PL_tainted
operator|=
name|oldtainted
expr_stmt|;
block|}
name|SvMAGIC
argument_list|(
name|sv
argument_list|)
operator|=
name|SvMAGIC
argument_list|(
name|osv
argument_list|)
expr_stmt|;
name|SvFLAGS
argument_list|(
name|sv
argument_list|)
operator||=
name|SvMAGICAL
argument_list|(
name|osv
argument_list|)
expr_stmt|;
comment|/* XXX SvMAGIC() is *shared* between osv and sv.  This can 	 * lead to coredumps when both SVs are destroyed without one 	 * of their SvMAGIC() slots being NULLed. */
name|PL_localizing
operator|=
literal|1
expr_stmt|;
name|SvSETMAGIC
argument_list|(
name|sv
argument_list|)
expr_stmt|;
name|PL_localizing
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|sv
return|;
block|}
end_function

begin_function
name|SV
modifier|*
name|Perl_save_scalar
parameter_list|(
name|pTHX_
name|GV
modifier|*
name|gv
parameter_list|)
block|{
name|SV
modifier|*
modifier|*
name|sptr
init|=
operator|&
name|GvSV
argument_list|(
name|gv
argument_list|)
decl_stmt|;
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvREFCNT_inc
argument_list|(
name|gv
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvREFCNT_inc
argument_list|(
operator|*
name|sptr
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_SV
argument_list|)
expr_stmt|;
return|return
name|save_scalar_at
argument_list|(
name|sptr
argument_list|)
return|;
block|}
end_function

begin_function
name|SV
modifier|*
name|Perl_save_svref
parameter_list|(
name|pTHX_
name|SV
modifier|*
modifier|*
name|sptr
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|sptr
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvREFCNT_inc
argument_list|(
operator|*
name|sptr
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_SVREF
argument_list|)
expr_stmt|;
return|return
name|save_scalar_at
argument_list|(
name|sptr
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Like save_sptr(), but also SvREFCNT_dec()s the new value.  Can be used to  * restore a global SV to its prior contents, freeing new value. */
end_comment

begin_function
name|void
name|Perl_save_generic_svref
parameter_list|(
name|pTHX_
name|SV
modifier|*
modifier|*
name|sptr
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|sptr
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvREFCNT_inc
argument_list|(
operator|*
name|sptr
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_GENERIC_SVREF
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Like save_pptr(), but also Safefree()s the new value if it is different  * from the old one.  Can be used to restore a global char* to its prior  * contents, freeing new value. */
end_comment

begin_function
name|void
name|Perl_save_generic_pvref
parameter_list|(
name|pTHX_
name|char
modifier|*
modifier|*
name|str
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
operator|*
name|str
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_GENERIC_PVREF
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_gp
parameter_list|(
name|pTHX_
name|GV
modifier|*
name|gv
parameter_list|,
name|I32
name|empty
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|SSPUSHIV
argument_list|(
operator|(
name|IV
operator|)
name|SvLEN
argument_list|(
name|gv
argument_list|)
argument_list|)
expr_stmt|;
name|SvLEN
argument_list|(
name|gv
argument_list|)
operator|=
literal|0
expr_stmt|;
comment|/* forget that anything was allocated here */
name|SSPUSHIV
argument_list|(
operator|(
name|IV
operator|)
name|SvCUR
argument_list|(
name|gv
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvPVX
argument_list|(
name|gv
argument_list|)
argument_list|)
expr_stmt|;
name|SvPOK_off
argument_list|(
name|gv
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvREFCNT_inc
argument_list|(
name|gv
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|GvGP
argument_list|(
name|gv
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_GP
argument_list|)
expr_stmt|;
if|if
condition|(
name|empty
condition|)
block|{
specifier|register
name|GP
modifier|*
name|gp
decl_stmt|;
name|Newz
argument_list|(
literal|602
argument_list|,
name|gp
argument_list|,
literal|1
argument_list|,
name|GP
argument_list|)
expr_stmt|;
if|if
condition|(
name|GvCVu
argument_list|(
name|gv
argument_list|)
condition|)
name|PL_sub_generation
operator|++
expr_stmt|;
comment|/* taking a method out of circulation */
if|if
condition|(
name|GvIOp
argument_list|(
name|gv
argument_list|)
operator|&&
operator|(
name|IoFLAGS
argument_list|(
name|GvIOp
argument_list|(
name|gv
argument_list|)
argument_list|)
operator|&
name|IOf_ARGV
operator|)
condition|)
block|{
name|gp
operator|->
name|gp_io
operator|=
name|newIO
argument_list|()
expr_stmt|;
name|IoFLAGS
argument_list|(
name|gp
operator|->
name|gp_io
argument_list|)
operator||=
name|IOf_ARGV
operator||
name|IOf_START
expr_stmt|;
block|}
name|GvGP
argument_list|(
name|gv
argument_list|)
operator|=
name|gp_ref
argument_list|(
name|gp
argument_list|)
expr_stmt|;
name|GvSV
argument_list|(
name|gv
argument_list|)
operator|=
name|NEWSV
argument_list|(
literal|72
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|GvLINE
argument_list|(
name|gv
argument_list|)
operator|=
name|CopLINE
argument_list|(
name|PL_curcop
argument_list|)
expr_stmt|;
name|GvFILE
argument_list|(
name|gv
argument_list|)
operator|=
name|CopFILE
argument_list|(
name|PL_curcop
argument_list|)
condition|?
name|CopFILE
argument_list|(
name|PL_curcop
argument_list|)
else|:
literal|""
expr_stmt|;
name|GvEGV
argument_list|(
name|gv
argument_list|)
operator|=
name|gv
expr_stmt|;
block|}
else|else
block|{
name|gp_ref
argument_list|(
name|GvGP
argument_list|(
name|gv
argument_list|)
argument_list|)
expr_stmt|;
name|GvINTRO_on
argument_list|(
name|gv
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|AV
modifier|*
name|Perl_save_ary
parameter_list|(
name|pTHX_
name|GV
modifier|*
name|gv
parameter_list|)
block|{
name|AV
modifier|*
name|oav
init|=
name|GvAVn
argument_list|(
name|gv
argument_list|)
decl_stmt|;
name|AV
modifier|*
name|av
decl_stmt|;
if|if
condition|(
operator|!
name|AvREAL
argument_list|(
name|oav
argument_list|)
operator|&&
name|AvREIFY
argument_list|(
name|oav
argument_list|)
condition|)
name|av_reify
argument_list|(
name|oav
argument_list|)
expr_stmt|;
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|gv
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|oav
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_AV
argument_list|)
expr_stmt|;
name|GvAV
argument_list|(
name|gv
argument_list|)
operator|=
name|Null
argument_list|(
name|AV
operator|*
argument_list|)
expr_stmt|;
name|av
operator|=
name|GvAVn
argument_list|(
name|gv
argument_list|)
expr_stmt|;
if|if
condition|(
name|SvMAGIC
argument_list|(
name|oav
argument_list|)
condition|)
block|{
name|SvMAGIC
argument_list|(
name|av
argument_list|)
operator|=
name|SvMAGIC
argument_list|(
name|oav
argument_list|)
expr_stmt|;
name|SvFLAGS
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|av
argument_list|)
operator||=
name|SvMAGICAL
argument_list|(
name|oav
argument_list|)
expr_stmt|;
name|SvMAGICAL_off
argument_list|(
name|oav
argument_list|)
expr_stmt|;
name|SvMAGIC
argument_list|(
name|oav
argument_list|)
operator|=
literal|0
expr_stmt|;
name|PL_localizing
operator|=
literal|1
expr_stmt|;
name|SvSETMAGIC
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|av
argument_list|)
expr_stmt|;
name|PL_localizing
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|av
return|;
block|}
end_function

begin_function
name|HV
modifier|*
name|Perl_save_hash
parameter_list|(
name|pTHX_
name|GV
modifier|*
name|gv
parameter_list|)
block|{
name|HV
modifier|*
name|ohv
decl_stmt|,
modifier|*
name|hv
decl_stmt|;
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|gv
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|ohv
operator|=
name|GvHVn
argument_list|(
name|gv
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_HV
argument_list|)
expr_stmt|;
name|GvHV
argument_list|(
name|gv
argument_list|)
operator|=
name|Null
argument_list|(
name|HV
operator|*
argument_list|)
expr_stmt|;
name|hv
operator|=
name|GvHVn
argument_list|(
name|gv
argument_list|)
expr_stmt|;
if|if
condition|(
name|SvMAGIC
argument_list|(
name|ohv
argument_list|)
condition|)
block|{
name|SvMAGIC
argument_list|(
name|hv
argument_list|)
operator|=
name|SvMAGIC
argument_list|(
name|ohv
argument_list|)
expr_stmt|;
name|SvFLAGS
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|hv
argument_list|)
operator||=
name|SvMAGICAL
argument_list|(
name|ohv
argument_list|)
expr_stmt|;
name|SvMAGICAL_off
argument_list|(
name|ohv
argument_list|)
expr_stmt|;
name|SvMAGIC
argument_list|(
name|ohv
argument_list|)
operator|=
literal|0
expr_stmt|;
name|PL_localizing
operator|=
literal|1
expr_stmt|;
name|SvSETMAGIC
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|hv
argument_list|)
expr_stmt|;
name|PL_localizing
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|hv
return|;
block|}
end_function

begin_function
name|void
name|Perl_save_item
parameter_list|(
name|pTHX_
specifier|register
name|SV
modifier|*
name|item
parameter_list|)
block|{
specifier|register
name|SV
modifier|*
name|sv
init|=
name|NEWSV
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|sv_setsv
argument_list|(
name|sv
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|item
argument_list|)
expr_stmt|;
comment|/* remember the pointer */
name|SSPUSHPTR
argument_list|(
name|sv
argument_list|)
expr_stmt|;
comment|/* remember the value */
name|SSPUSHINT
argument_list|(
name|SAVEt_ITEM
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_int
parameter_list|(
name|pTHX_
name|int
modifier|*
name|intp
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
operator|*
name|intp
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|intp
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_INT
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_long
parameter_list|(
name|pTHX_
name|long
name|int
modifier|*
name|longp
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHLONG
argument_list|(
operator|*
name|longp
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|longp
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_LONG
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_I32
parameter_list|(
name|pTHX_
name|I32
modifier|*
name|intp
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
operator|*
name|intp
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|intp
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_I32
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_I16
parameter_list|(
name|pTHX_
name|I16
modifier|*
name|intp
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
operator|*
name|intp
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|intp
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_I16
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_I8
parameter_list|(
name|pTHX_
name|I8
modifier|*
name|bytep
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
operator|*
name|bytep
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|bytep
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_I8
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_iv
parameter_list|(
name|pTHX_
name|IV
modifier|*
name|ivp
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHIV
argument_list|(
operator|*
name|ivp
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|ivp
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_IV
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Cannot use save_sptr() to store a char* since the SV** cast will  * force word-alignment and we'll miss the pointer.  */
end_comment

begin_function
name|void
name|Perl_save_pptr
parameter_list|(
name|pTHX_
name|char
modifier|*
modifier|*
name|pptr
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
operator|*
name|pptr
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|pptr
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_PPTR
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_vptr
parameter_list|(
name|pTHX_
name|void
modifier|*
name|ptr
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
operator|*
operator|(
name|char
operator|*
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_VPTR
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_sptr
parameter_list|(
name|pTHX_
name|SV
modifier|*
modifier|*
name|sptr
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
operator|*
name|sptr
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|sptr
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_SPTR
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_padsv
parameter_list|(
name|pTHX_
name|PADOFFSET
name|off
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|PL_curpad
index|[
name|off
index|]
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|PL_curpad
argument_list|)
expr_stmt|;
name|SSPUSHLONG
argument_list|(
operator|(
name|long
operator|)
name|off
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_PADSV
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|SV
modifier|*
modifier|*
name|Perl_save_threadsv
parameter_list|(
name|pTHX_
name|PADOFFSET
name|i
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|USE_THREADS
name|SV
modifier|*
modifier|*
name|svp
init|=
operator|&
name|THREADSV
argument_list|(
name|i
argument_list|)
decl_stmt|;
comment|/* XXX Change to save by offset */
name|DEBUG_S
argument_list|(
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"save_threadsv %"
name|UVuf
literal|": %p %p:%s\n"
argument_list|,
operator|(
name|UV
operator|)
name|i
argument_list|,
name|svp
argument_list|,
operator|*
name|svp
argument_list|,
name|SvPEEK
argument_list|(
operator|*
name|svp
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|save_svref
argument_list|(
name|svp
argument_list|)
expr_stmt|;
return|return
name|svp
return|;
else|#
directive|else
name|Perl_croak
argument_list|(
name|aTHX_
literal|"panic: save_threadsv called in non-threaded perl"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
endif|#
directive|endif
comment|/* USE_THREADS */
block|}
end_function

begin_function
name|void
name|Perl_save_nogv
parameter_list|(
name|pTHX_
name|GV
modifier|*
name|gv
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|gv
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_NSTAB
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_hptr
parameter_list|(
name|pTHX_
name|HV
modifier|*
modifier|*
name|hptr
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
operator|*
name|hptr
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|hptr
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_HPTR
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_aptr
parameter_list|(
name|pTHX_
name|AV
modifier|*
modifier|*
name|aptr
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
operator|*
name|aptr
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|aptr
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_APTR
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_freesv
parameter_list|(
name|pTHX_
name|SV
modifier|*
name|sv
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|sv
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_FREESV
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_mortalizesv
parameter_list|(
name|pTHX_
name|SV
modifier|*
name|sv
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|sv
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_MORTALIZESV
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_freeop
parameter_list|(
name|pTHX_
name|OP
modifier|*
name|o
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|o
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_FREEOP
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_freepv
parameter_list|(
name|pTHX_
name|char
modifier|*
name|pv
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|pv
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_FREEPV
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_clearsv
parameter_list|(
name|pTHX_
name|SV
modifier|*
modifier|*
name|svp
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|SSPUSHLONG
argument_list|(
call|(
name|long
call|)
argument_list|(
name|svp
operator|-
name|PL_curpad
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_CLEARSV
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_delete
parameter_list|(
name|pTHX_
name|HV
modifier|*
name|hv
parameter_list|,
name|char
modifier|*
name|key
parameter_list|,
name|I32
name|klen
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|klen
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|key
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvREFCNT_inc
argument_list|(
name|hv
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_DELETE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_list
parameter_list|(
name|pTHX_
specifier|register
name|SV
modifier|*
modifier|*
name|sarg
parameter_list|,
name|I32
name|maxsarg
parameter_list|)
block|{
specifier|register
name|SV
modifier|*
name|sv
decl_stmt|;
specifier|register
name|I32
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|maxsarg
condition|;
name|i
operator|++
control|)
block|{
name|sv
operator|=
name|NEWSV
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sv_setsv
argument_list|(
name|sv
argument_list|,
name|sarg
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|sarg
index|[
name|i
index|]
argument_list|)
expr_stmt|;
comment|/* remember the pointer */
name|SSPUSHPTR
argument_list|(
name|sv
argument_list|)
expr_stmt|;
comment|/* remember the value */
name|SSPUSHINT
argument_list|(
name|SAVEt_ITEM
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|Perl_save_destructor
parameter_list|(
name|pTHX_
name|DESTRUCTORFUNC_NOCONTEXT_t
name|f
parameter_list|,
name|void
modifier|*
name|p
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHDPTR
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_DESTRUCTOR
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_destructor_x
parameter_list|(
name|pTHX_
name|DESTRUCTORFUNC_t
name|f
parameter_list|,
name|void
modifier|*
name|p
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|SSPUSHDXPTR
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_DESTRUCTOR_X
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_aelem
parameter_list|(
name|pTHX_
name|AV
modifier|*
name|av
parameter_list|,
name|I32
name|idx
parameter_list|,
name|SV
modifier|*
modifier|*
name|sptr
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvREFCNT_inc
argument_list|(
name|av
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|idx
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvREFCNT_inc
argument_list|(
operator|*
name|sptr
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_AELEM
argument_list|)
expr_stmt|;
name|save_scalar_at
argument_list|(
name|sptr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_helem
parameter_list|(
name|pTHX_
name|HV
modifier|*
name|hv
parameter_list|,
name|SV
modifier|*
name|key
parameter_list|,
name|SV
modifier|*
modifier|*
name|sptr
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvREFCNT_inc
argument_list|(
name|hv
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvREFCNT_inc
argument_list|(
name|key
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|SvREFCNT_inc
argument_list|(
operator|*
name|sptr
argument_list|)
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_HELEM
argument_list|)
expr_stmt|;
name|save_scalar_at
argument_list|(
name|sptr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Perl_save_op
parameter_list|(
name|pTHX
parameter_list|)
block|{
name|SSCHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|SSPUSHPTR
argument_list|(
name|PL_op
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_OP
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|I32
name|Perl_save_alloc
parameter_list|(
name|pTHX_
name|I32
name|size
parameter_list|,
name|I32
name|pad
parameter_list|)
block|{
specifier|register
name|I32
name|start
init|=
name|pad
operator|+
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|PL_savestack
index|[
name|PL_savestack_ix
index|]
operator|-
operator|(
name|char
operator|*
operator|)
name|PL_savestack
operator|)
decl_stmt|;
specifier|register
name|I32
name|elems
init|=
literal|1
operator|+
operator|(
operator|(
name|size
operator|+
name|pad
operator|-
literal|1
operator|)
operator|/
sizeof|sizeof
argument_list|(
operator|*
name|PL_savestack
argument_list|)
operator|)
decl_stmt|;
comment|/* SSCHECK may not be good enough */
while|while
condition|(
name|PL_savestack_ix
operator|+
name|elems
operator|+
literal|2
operator|>
name|PL_savestack_max
condition|)
name|savestack_grow
argument_list|()
expr_stmt|;
name|PL_savestack_ix
operator|+=
name|elems
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|elems
argument_list|)
expr_stmt|;
name|SSPUSHINT
argument_list|(
name|SAVEt_ALLOC
argument_list|)
expr_stmt|;
return|return
name|start
return|;
block|}
end_function

begin_function
name|void
name|Perl_leave_scope
parameter_list|(
name|pTHX_
name|I32
name|base
parameter_list|)
block|{
specifier|register
name|SV
modifier|*
name|sv
decl_stmt|;
specifier|register
name|SV
modifier|*
name|value
decl_stmt|;
specifier|register
name|GV
modifier|*
name|gv
decl_stmt|;
specifier|register
name|AV
modifier|*
name|av
decl_stmt|;
specifier|register
name|HV
modifier|*
name|hv
decl_stmt|;
specifier|register
name|void
modifier|*
name|ptr
decl_stmt|;
specifier|register
name|char
modifier|*
name|str
decl_stmt|;
name|I32
name|i
decl_stmt|;
if|if
condition|(
name|base
operator|<
operator|-
literal|1
condition|)
name|Perl_croak
argument_list|(
name|aTHX_
literal|"panic: corrupt saved stack index"
argument_list|)
expr_stmt|;
while|while
condition|(
name|PL_savestack_ix
operator|>
name|base
condition|)
block|{
switch|switch
condition|(
name|SSPOPINT
condition|)
block|{
case|case
name|SAVEt_ITEM
case|:
comment|/* normal string */
name|value
operator|=
operator|(
name|SV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|sv
operator|=
operator|(
name|SV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|sv_replace
argument_list|(
name|sv
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|PL_localizing
operator|=
literal|2
expr_stmt|;
name|SvSETMAGIC
argument_list|(
name|sv
argument_list|)
expr_stmt|;
name|PL_localizing
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|SAVEt_SV
case|:
comment|/* scalar reference */
name|value
operator|=
operator|(
name|SV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|gv
operator|=
operator|(
name|GV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|ptr
operator|=
operator|&
name|GvSV
argument_list|(
name|gv
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|gv
argument_list|)
expr_stmt|;
goto|goto
name|restore_sv
goto|;
case|case
name|SAVEt_GENERIC_PVREF
case|:
comment|/* generic pv */
name|str
operator|=
operator|(
name|char
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|char
operator|*
operator|*
operator|)
name|ptr
operator|!=
name|str
condition|)
block|{
name|Safefree
argument_list|(
operator|*
operator|(
name|char
operator|*
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
operator|*
operator|(
name|char
operator|*
operator|*
operator|)
name|ptr
operator|=
name|str
expr_stmt|;
block|}
break|break;
case|case
name|SAVEt_GENERIC_SVREF
case|:
comment|/* generic sv */
name|value
operator|=
operator|(
name|SV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
name|sv
operator|=
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
expr_stmt|;
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
operator|=
name|value
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|sv
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_SVREF
case|:
comment|/* scalar reference */
name|value
operator|=
operator|(
name|SV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
name|restore_sv
label|:
name|sv
operator|=
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
expr_stmt|;
name|DEBUG_S
argument_list|(
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"restore svref: %p %p:%s -> %p:%s\n"
argument_list|,
name|ptr
argument_list|,
name|sv
argument_list|,
name|SvPEEK
argument_list|(
name|sv
argument_list|)
argument_list|,
name|value
argument_list|,
name|SvPEEK
argument_list|(
name|value
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|SvTYPE
argument_list|(
name|sv
argument_list|)
operator|>=
name|SVt_PVMG
operator|&&
name|SvMAGIC
argument_list|(
name|sv
argument_list|)
operator|&&
name|SvTYPE
argument_list|(
name|sv
argument_list|)
operator|!=
name|SVt_PVGV
condition|)
block|{
operator|(
name|void
operator|)
name|SvUPGRADE
argument_list|(
name|value
argument_list|,
name|SvTYPE
argument_list|(
name|sv
argument_list|)
argument_list|)
expr_stmt|;
name|SvMAGIC
argument_list|(
name|value
argument_list|)
operator|=
name|SvMAGIC
argument_list|(
name|sv
argument_list|)
expr_stmt|;
name|SvFLAGS
argument_list|(
name|value
argument_list|)
operator||=
name|SvMAGICAL
argument_list|(
name|sv
argument_list|)
expr_stmt|;
name|SvMAGICAL_off
argument_list|(
name|sv
argument_list|)
expr_stmt|;
name|SvMAGIC
argument_list|(
name|sv
argument_list|)
operator|=
literal|0
expr_stmt|;
block|}
comment|/* XXX This branch is pretty bogus.  This code irretrievably 	     * clears(!) the magic on the SV (either to avoid further 	     * croaking that might ensue when the SvSETMAGIC() below is 	     * called, or to avoid two different SVs pointing at the same 	     * SvMAGIC()).  This needs a total rethink.  --GSAR */
elseif|else
if|if
condition|(
name|SvTYPE
argument_list|(
name|value
argument_list|)
operator|>=
name|SVt_PVMG
operator|&&
name|SvMAGIC
argument_list|(
name|value
argument_list|)
operator|&&
name|SvTYPE
argument_list|(
name|value
argument_list|)
operator|!=
name|SVt_PVGV
condition|)
block|{
name|SvFLAGS
argument_list|(
name|value
argument_list|)
operator||=
operator|(
name|SvFLAGS
argument_list|(
name|value
argument_list|)
operator|&
operator|(
name|SVp_IOK
operator||
name|SVp_NOK
operator||
name|SVp_POK
operator|)
operator|)
operator|>>
name|PRIVSHIFT
expr_stmt|;
name|SvMAGICAL_off
argument_list|(
name|value
argument_list|)
expr_stmt|;
comment|/* XXX this is a leak when we get here because the 		 * mg_get() in save_scalar_at() croaked */
name|SvMAGIC
argument_list|(
name|value
argument_list|)
operator|=
literal|0
expr_stmt|;
block|}
name|SvREFCNT_dec
argument_list|(
name|sv
argument_list|)
expr_stmt|;
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
operator|=
name|value
expr_stmt|;
name|PL_localizing
operator|=
literal|2
expr_stmt|;
name|SvSETMAGIC
argument_list|(
name|value
argument_list|)
expr_stmt|;
name|PL_localizing
operator|=
literal|0
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_AV
case|:
comment|/* array reference */
name|av
operator|=
operator|(
name|AV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|gv
operator|=
operator|(
name|GV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
if|if
condition|(
name|GvAV
argument_list|(
name|gv
argument_list|)
condition|)
block|{
name|AV
modifier|*
name|goner
init|=
name|GvAV
argument_list|(
name|gv
argument_list|)
decl_stmt|;
name|SvMAGIC
argument_list|(
name|av
argument_list|)
operator|=
name|SvMAGIC
argument_list|(
name|goner
argument_list|)
expr_stmt|;
name|SvFLAGS
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|av
argument_list|)
operator||=
name|SvMAGICAL
argument_list|(
name|goner
argument_list|)
expr_stmt|;
name|SvMAGICAL_off
argument_list|(
name|goner
argument_list|)
expr_stmt|;
name|SvMAGIC
argument_list|(
name|goner
argument_list|)
operator|=
literal|0
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|goner
argument_list|)
expr_stmt|;
block|}
name|GvAV
argument_list|(
name|gv
argument_list|)
operator|=
name|av
expr_stmt|;
if|if
condition|(
name|SvMAGICAL
argument_list|(
name|av
argument_list|)
condition|)
block|{
name|PL_localizing
operator|=
literal|2
expr_stmt|;
name|SvSETMAGIC
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|av
argument_list|)
expr_stmt|;
name|PL_localizing
operator|=
literal|0
expr_stmt|;
block|}
break|break;
case|case
name|SAVEt_HV
case|:
comment|/* hash reference */
name|hv
operator|=
operator|(
name|HV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|gv
operator|=
operator|(
name|GV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
if|if
condition|(
name|GvHV
argument_list|(
name|gv
argument_list|)
condition|)
block|{
name|HV
modifier|*
name|goner
init|=
name|GvHV
argument_list|(
name|gv
argument_list|)
decl_stmt|;
name|SvMAGIC
argument_list|(
name|hv
argument_list|)
operator|=
name|SvMAGIC
argument_list|(
name|goner
argument_list|)
expr_stmt|;
name|SvFLAGS
argument_list|(
name|hv
argument_list|)
operator||=
name|SvMAGICAL
argument_list|(
name|goner
argument_list|)
expr_stmt|;
name|SvMAGICAL_off
argument_list|(
name|goner
argument_list|)
expr_stmt|;
name|SvMAGIC
argument_list|(
name|goner
argument_list|)
operator|=
literal|0
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|goner
argument_list|)
expr_stmt|;
block|}
name|GvHV
argument_list|(
name|gv
argument_list|)
operator|=
name|hv
expr_stmt|;
if|if
condition|(
name|SvMAGICAL
argument_list|(
name|hv
argument_list|)
condition|)
block|{
name|PL_localizing
operator|=
literal|2
expr_stmt|;
name|SvSETMAGIC
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|hv
argument_list|)
expr_stmt|;
name|PL_localizing
operator|=
literal|0
expr_stmt|;
block|}
break|break;
case|case
name|SAVEt_INT
case|:
comment|/* int reference */
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|*
operator|(
name|int
operator|*
operator|)
name|ptr
operator|=
operator|(
name|int
operator|)
name|SSPOPINT
expr_stmt|;
break|break;
case|case
name|SAVEt_LONG
case|:
comment|/* long reference */
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|*
operator|(
name|long
operator|*
operator|)
name|ptr
operator|=
operator|(
name|long
operator|)
name|SSPOPLONG
expr_stmt|;
break|break;
case|case
name|SAVEt_I32
case|:
comment|/* I32 reference */
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|*
operator|(
name|I32
operator|*
operator|)
name|ptr
operator|=
operator|(
name|I32
operator|)
name|SSPOPINT
expr_stmt|;
break|break;
case|case
name|SAVEt_I16
case|:
comment|/* I16 reference */
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|*
operator|(
name|I16
operator|*
operator|)
name|ptr
operator|=
operator|(
name|I16
operator|)
name|SSPOPINT
expr_stmt|;
break|break;
case|case
name|SAVEt_I8
case|:
comment|/* I8 reference */
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|*
operator|(
name|I8
operator|*
operator|)
name|ptr
operator|=
operator|(
name|I8
operator|)
name|SSPOPINT
expr_stmt|;
break|break;
case|case
name|SAVEt_IV
case|:
comment|/* IV reference */
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|*
operator|(
name|IV
operator|*
operator|)
name|ptr
operator|=
operator|(
name|IV
operator|)
name|SSPOPIV
expr_stmt|;
break|break;
case|case
name|SAVEt_SPTR
case|:
comment|/* SV* reference */
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
operator|=
operator|(
name|SV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
break|break;
case|case
name|SAVEt_VPTR
case|:
comment|/* random* reference */
case|case
name|SAVEt_PPTR
case|:
comment|/* char* reference */
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|*
operator|(
name|char
operator|*
operator|*
operator|)
name|ptr
operator|=
operator|(
name|char
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
break|break;
case|case
name|SAVEt_HPTR
case|:
comment|/* HV* reference */
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|*
operator|(
name|HV
operator|*
operator|*
operator|)
name|ptr
operator|=
operator|(
name|HV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
break|break;
case|case
name|SAVEt_APTR
case|:
comment|/* AV* reference */
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|*
operator|(
name|AV
operator|*
operator|*
operator|)
name|ptr
operator|=
operator|(
name|AV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
break|break;
case|case
name|SAVEt_NSTAB
case|:
name|gv
operator|=
operator|(
name|GV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
operator|(
name|void
operator|)
name|sv_clear
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|gv
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_GP
case|:
comment|/* scalar reference */
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
name|gv
operator|=
operator|(
name|GV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
if|if
condition|(
name|SvPVX
argument_list|(
name|gv
argument_list|)
operator|&&
name|SvLEN
argument_list|(
name|gv
argument_list|)
operator|>
literal|0
condition|)
block|{
name|Safefree
argument_list|(
name|SvPVX
argument_list|(
name|gv
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|SvPVX
argument_list|(
name|gv
argument_list|)
operator|=
operator|(
name|char
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|SvCUR
argument_list|(
name|gv
argument_list|)
operator|=
operator|(
name|STRLEN
operator|)
name|SSPOPIV
expr_stmt|;
name|SvLEN
argument_list|(
name|gv
argument_list|)
operator|=
operator|(
name|STRLEN
operator|)
name|SSPOPIV
expr_stmt|;
name|gp_free
argument_list|(
name|gv
argument_list|)
expr_stmt|;
name|GvGP
argument_list|(
name|gv
argument_list|)
operator|=
operator|(
name|GP
operator|*
operator|)
name|ptr
expr_stmt|;
if|if
condition|(
name|GvCVu
argument_list|(
name|gv
argument_list|)
condition|)
name|PL_sub_generation
operator|++
expr_stmt|;
comment|/* putting a method back into circulation */
name|SvREFCNT_dec
argument_list|(
name|gv
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_FREESV
case|:
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_MORTALIZESV
case|:
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
name|sv_2mortal
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_FREEOP
case|:
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
if|if
condition|(
name|PL_comppad
condition|)
name|PL_curpad
operator|=
name|AvARRAY
argument_list|(
name|PL_comppad
argument_list|)
expr_stmt|;
name|op_free
argument_list|(
operator|(
name|OP
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_FREEPV
case|:
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
name|Safefree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_CLEARSV
case|:
name|ptr
operator|=
operator|(
name|void
operator|*
operator|)
operator|&
name|PL_curpad
index|[
name|SSPOPLONG
index|]
expr_stmt|;
name|sv
operator|=
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
expr_stmt|;
comment|/* Can clear pad variable in place? */
if|if
condition|(
name|SvREFCNT
argument_list|(
name|sv
argument_list|)
operator|<=
literal|1
operator|&&
operator|!
name|SvOBJECT
argument_list|(
name|sv
argument_list|)
condition|)
block|{
if|if
condition|(
name|SvTHINKFIRST
argument_list|(
name|sv
argument_list|)
condition|)
name|sv_force_normal
argument_list|(
name|sv
argument_list|)
expr_stmt|;
if|if
condition|(
name|SvMAGICAL
argument_list|(
name|sv
argument_list|)
condition|)
name|mg_free
argument_list|(
name|sv
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|SvTYPE
argument_list|(
name|sv
argument_list|)
condition|)
block|{
case|case
name|SVt_NULL
case|:
break|break;
case|case
name|SVt_PVAV
case|:
name|av_clear
argument_list|(
operator|(
name|AV
operator|*
operator|)
name|sv
argument_list|)
expr_stmt|;
break|break;
case|case
name|SVt_PVHV
case|:
name|hv_clear
argument_list|(
operator|(
name|HV
operator|*
operator|)
name|sv
argument_list|)
expr_stmt|;
break|break;
case|case
name|SVt_PVCV
case|:
name|Perl_croak
argument_list|(
name|aTHX_
literal|"panic: leave_scope pad code"
argument_list|)
expr_stmt|;
case|case
name|SVt_RV
case|:
case|case
name|SVt_IV
case|:
case|case
name|SVt_NV
case|:
operator|(
name|void
operator|)
name|SvOK_off
argument_list|(
name|sv
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|SvOK_off
argument_list|(
name|sv
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|SvOOK_off
argument_list|(
name|sv
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
else|else
block|{
comment|/* Someone has a claim on this, so abandon it. */
name|U32
name|padflags
init|=
name|SvFLAGS
argument_list|(
name|sv
argument_list|)
operator|&
operator|(
name|SVs_PADBUSY
operator||
name|SVs_PADMY
operator||
name|SVs_PADTMP
operator|)
decl_stmt|;
switch|switch
condition|(
name|SvTYPE
argument_list|(
name|sv
argument_list|)
condition|)
block|{
comment|/* Console ourselves with a new value */
case|case
name|SVt_PVAV
case|:
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
operator|=
operator|(
name|SV
operator|*
operator|)
name|newAV
argument_list|()
expr_stmt|;
break|break;
case|case
name|SVt_PVHV
case|:
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
operator|=
operator|(
name|SV
operator|*
operator|)
name|newHV
argument_list|()
expr_stmt|;
break|break;
default|default:
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
operator|=
name|NEWSV
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
name|SvREFCNT_dec
argument_list|(
name|sv
argument_list|)
expr_stmt|;
comment|/* Cast current value to the winds. */
name|SvFLAGS
argument_list|(
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
argument_list|)
operator||=
name|padflags
expr_stmt|;
comment|/* preserve pad nature */
block|}
break|break;
case|case
name|SAVEt_DELETE
case|:
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
name|hv
operator|=
operator|(
name|HV
operator|*
operator|)
name|ptr
expr_stmt|;
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|(
name|void
operator|)
name|hv_delete
argument_list|(
name|hv
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ptr
argument_list|,
operator|(
name|U32
operator|)
name|SSPOPINT
argument_list|,
name|G_DISCARD
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|hv
argument_list|)
expr_stmt|;
name|Safefree
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_DESTRUCTOR
case|:
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
call|(
modifier|*
name|SSPOPDPTR
call|)
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_DESTRUCTOR_X
case|:
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
operator|(
operator|*
name|SSPOPDXPTR
operator|)
operator|(
name|aTHXo_
name|ptr
operator|)
expr_stmt|;
break|break;
case|case
name|SAVEt_REGCONTEXT
case|:
case|case
name|SAVEt_ALLOC
case|:
name|i
operator|=
name|SSPOPINT
expr_stmt|;
name|PL_savestack_ix
operator|-=
name|i
expr_stmt|;
comment|/* regexp must have croaked */
break|break;
case|case
name|SAVEt_STACK_POS
case|:
comment|/* Position on Perl stack */
name|i
operator|=
name|SSPOPINT
expr_stmt|;
name|PL_stack_sp
operator|=
name|PL_stack_base
operator|+
name|i
expr_stmt|;
break|break;
case|case
name|SAVEt_AELEM
case|:
comment|/* array element */
name|value
operator|=
operator|(
name|SV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|i
operator|=
name|SSPOPINT
expr_stmt|;
name|av
operator|=
operator|(
name|AV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|ptr
operator|=
name|av_fetch
argument_list|(
name|av
argument_list|,
name|i
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptr
condition|)
block|{
name|sv
operator|=
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
expr_stmt|;
if|if
condition|(
name|sv
operator|&&
name|sv
operator|!=
operator|&
name|PL_sv_undef
condition|)
block|{
if|if
condition|(
name|SvTIED_mg
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|av
argument_list|,
literal|'P'
argument_list|)
condition|)
operator|(
name|void
operator|)
name|SvREFCNT_inc
argument_list|(
name|sv
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|av
argument_list|)
expr_stmt|;
goto|goto
name|restore_sv
goto|;
block|}
block|}
name|SvREFCNT_dec
argument_list|(
name|av
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_HELEM
case|:
comment|/* hash element */
name|value
operator|=
operator|(
name|SV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|sv
operator|=
operator|(
name|SV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|hv
operator|=
operator|(
name|HV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
name|ptr
operator|=
name|hv_fetch_ent
argument_list|(
name|hv
argument_list|,
name|sv
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptr
condition|)
block|{
name|SV
modifier|*
name|oval
init|=
name|HeVAL
argument_list|(
operator|(
name|HE
operator|*
operator|)
name|ptr
argument_list|)
decl_stmt|;
if|if
condition|(
name|oval
operator|&&
name|oval
operator|!=
operator|&
name|PL_sv_undef
condition|)
block|{
name|ptr
operator|=
operator|&
name|HeVAL
argument_list|(
operator|(
name|HE
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|SvTIED_mg
argument_list|(
operator|(
name|SV
operator|*
operator|)
name|hv
argument_list|,
literal|'P'
argument_list|)
condition|)
operator|(
name|void
operator|)
name|SvREFCNT_inc
argument_list|(
operator|*
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|hv
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|sv
argument_list|)
expr_stmt|;
goto|goto
name|restore_sv
goto|;
block|}
block|}
name|SvREFCNT_dec
argument_list|(
name|hv
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|sv
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_OP
case|:
name|PL_op
operator|=
operator|(
name|OP
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
break|break;
case|case
name|SAVEt_HINTS
case|:
operator|*
operator|(
name|I32
operator|*
operator|)
operator|&
name|PL_hints
operator|=
operator|(
name|I32
operator|)
name|SSPOPINT
expr_stmt|;
break|break;
case|case
name|SAVEt_COMPPAD
case|:
name|PL_comppad
operator|=
operator|(
name|AV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
if|if
condition|(
name|PL_comppad
condition|)
name|PL_curpad
operator|=
name|AvARRAY
argument_list|(
name|PL_comppad
argument_list|)
expr_stmt|;
else|else
name|PL_curpad
operator|=
name|Null
argument_list|(
name|SV
operator|*
operator|*
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAVEt_PADSV
case|:
block|{
name|PADOFFSET
name|off
init|=
operator|(
name|PADOFFSET
operator|)
name|SSPOPLONG
decl_stmt|;
name|ptr
operator|=
name|SSPOPPTR
expr_stmt|;
if|if
condition|(
name|ptr
condition|)
operator|(
operator|(
name|SV
operator|*
operator|*
operator|)
name|ptr
operator|)
index|[
name|off
index|]
operator|=
operator|(
name|SV
operator|*
operator|)
name|SSPOPPTR
expr_stmt|;
block|}
break|break;
default|default:
name|Perl_croak
argument_list|(
name|aTHX_
literal|"panic: leave_scope inconsistency"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
name|Perl_cx_dump
parameter_list|(
name|pTHX_
name|PERL_CONTEXT
modifier|*
name|cx
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"CX %ld = %s\n"
argument_list|,
call|(
name|long
call|)
argument_list|(
name|cx
operator|-
name|cxstack
argument_list|)
argument_list|,
name|PL_block_type
index|[
name|CxTYPE
argument_list|(
name|cx
argument_list|)
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|CxTYPE
argument_list|(
name|cx
argument_list|)
operator|!=
name|CXt_SUBST
condition|)
block|{
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_OLDSP = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|blk_oldsp
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_OLDCOP = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_oldcop
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_OLDMARKSP = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|blk_oldmarksp
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_OLDSCOPESP = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|blk_oldscopesp
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_OLDRETSP = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|blk_oldretsp
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_OLDPM = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_oldpm
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_GIMME = %s\n"
argument_list|,
name|cx
operator|->
name|blk_gimme
condition|?
literal|"LIST"
else|:
literal|"SCALAR"
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|CxTYPE
argument_list|(
name|cx
argument_list|)
condition|)
block|{
case|case
name|CXt_NULL
case|:
case|case
name|CXt_BLOCK
case|:
break|break;
case|case
name|CXt_FORMAT
case|:
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_SUB.CV = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_sub
operator|.
name|cv
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_SUB.GV = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_sub
operator|.
name|gv
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_SUB.DFOUTGV = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_sub
operator|.
name|dfoutgv
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_SUB.HASARGS = %d\n"
argument_list|,
operator|(
name|int
operator|)
name|cx
operator|->
name|blk_sub
operator|.
name|hasargs
argument_list|)
expr_stmt|;
break|break;
case|case
name|CXt_SUB
case|:
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_SUB.CV = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_sub
operator|.
name|cv
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_SUB.OLDDEPTH = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|blk_sub
operator|.
name|olddepth
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_SUB.HASARGS = %d\n"
argument_list|,
operator|(
name|int
operator|)
name|cx
operator|->
name|blk_sub
operator|.
name|hasargs
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_SUB.LVAL = %d\n"
argument_list|,
operator|(
name|int
operator|)
name|cx
operator|->
name|blk_sub
operator|.
name|lval
argument_list|)
expr_stmt|;
break|break;
case|case
name|CXt_EVAL
case|:
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_EVAL.OLD_IN_EVAL = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|blk_eval
operator|.
name|old_in_eval
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_EVAL.OLD_OP_TYPE = %s (%s)\n"
argument_list|,
name|PL_op_name
index|[
name|cx
operator|->
name|blk_eval
operator|.
name|old_op_type
index|]
argument_list|,
name|PL_op_desc
index|[
name|cx
operator|->
name|blk_eval
operator|.
name|old_op_type
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|cx
operator|->
name|blk_eval
operator|.
name|old_namesv
condition|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_EVAL.OLD_NAME = %s\n"
argument_list|,
name|SvPVX
argument_list|(
name|cx
operator|->
name|blk_eval
operator|.
name|old_namesv
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_EVAL.OLD_EVAL_ROOT = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_eval
operator|.
name|old_eval_root
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|CXt_LOOP
case|:
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_LOOP.LABEL = %s\n"
argument_list|,
name|cx
operator|->
name|blk_loop
operator|.
name|label
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_LOOP.RESETSP = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|blk_loop
operator|.
name|resetsp
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_LOOP.REDO_OP = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_loop
operator|.
name|redo_op
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_LOOP.NEXT_OP = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_loop
operator|.
name|next_op
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_LOOP.LAST_OP = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_loop
operator|.
name|last_op
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_LOOP.ITERIX = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|blk_loop
operator|.
name|iterix
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_LOOP.ITERARY = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_loop
operator|.
name|iterary
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_LOOP.ITERVAR = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|CxITERVAR
argument_list|(
name|cx
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|CxITERVAR
argument_list|(
name|cx
argument_list|)
condition|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_LOOP.ITERSAVE = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_loop
operator|.
name|itersave
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"BLK_LOOP.ITERLVAL = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|blk_loop
operator|.
name|iterlval
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|CXt_SUBST
case|:
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"SB_ITERS = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|sb_iters
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"SB_MAXITERS = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|sb_maxiters
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"SB_RFLAGS = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|sb_rflags
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"SB_ONCE = %ld\n"
argument_list|,
operator|(
name|long
operator|)
name|cx
operator|->
name|sb_once
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"SB_ORIG = %s\n"
argument_list|,
name|cx
operator|->
name|sb_orig
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"SB_DSTR = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|sb_dstr
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"SB_TARG = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|sb_targ
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"SB_S = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|sb_s
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"SB_M = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|sb_m
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"SB_STREND = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|sb_strend
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"SB_RXRES = 0x%"
name|UVxf
literal|"\n"
argument_list|,
name|PTR2UV
argument_list|(
name|cx
operator|->
name|sb_rxres
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

end_unit

