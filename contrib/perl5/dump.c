begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*    dump.c  *  *    Copyright (c) 1991-1997, Larry Wall  *  *    You may distribute under the terms of either the GNU General Public  *    License or the Artistic License, as specified in the README file.  *  */
end_comment

begin_comment
comment|/*  * "'You have talked long in your sleep, Frodo,' said Gandalf gently, 'and  * it has not been hard for me to read your mind and memory.'"  */
end_comment

begin_include
include|#
directive|include
file|"EXTERN.h"
end_include

begin_include
include|#
directive|include
file|"perl.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|PERL_OBJECT
end_ifndef

begin_function_decl
specifier|static
name|void
name|dump
parameter_list|(
name|char
modifier|*
name|pat
parameter_list|,
modifier|...
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* PERL_OBJECT */
end_comment

begin_function
name|void
name|dump_all
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|dTHR
expr_stmt|;
name|PerlIO_setlinebuf
argument_list|(
name|Perl_debug_log
argument_list|)
expr_stmt|;
if|if
condition|(
name|PL_main_root
condition|)
name|dump_op
argument_list|(
name|PL_main_root
argument_list|)
expr_stmt|;
name|dump_packsubs
argument_list|(
name|PL_defstash
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

begin_function
name|void
name|dump_packsubs
parameter_list|(
name|HV
modifier|*
name|stash
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|dTHR
expr_stmt|;
name|I32
name|i
decl_stmt|;
name|HE
modifier|*
name|entry
decl_stmt|;
if|if
condition|(
operator|!
name|HvARRAY
argument_list|(
name|stash
argument_list|)
condition|)
return|return;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
operator|(
name|I32
operator|)
name|HvMAX
argument_list|(
name|stash
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|entry
operator|=
name|HvARRAY
argument_list|(
name|stash
argument_list|)
index|[
name|i
index|]
init|;
name|entry
condition|;
name|entry
operator|=
name|HeNEXT
argument_list|(
name|entry
argument_list|)
control|)
block|{
name|GV
modifier|*
name|gv
init|=
operator|(
name|GV
operator|*
operator|)
name|HeVAL
argument_list|(
name|entry
argument_list|)
decl_stmt|;
name|HV
modifier|*
name|hv
decl_stmt|;
if|if
condition|(
name|SvTYPE
argument_list|(
name|gv
argument_list|)
operator|!=
name|SVt_PVGV
operator|||
operator|!
name|GvGP
argument_list|(
name|gv
argument_list|)
condition|)
continue|continue;
if|if
condition|(
name|GvCVu
argument_list|(
name|gv
argument_list|)
condition|)
name|dump_sub
argument_list|(
name|gv
argument_list|)
expr_stmt|;
if|if
condition|(
name|GvFORM
argument_list|(
name|gv
argument_list|)
condition|)
name|dump_form
argument_list|(
name|gv
argument_list|)
expr_stmt|;
if|if
condition|(
name|HeKEY
argument_list|(
name|entry
argument_list|)
index|[
name|HeKLEN
argument_list|(
name|entry
argument_list|)
operator|-
literal|1
index|]
operator|==
literal|':'
operator|&&
operator|(
name|hv
operator|=
name|GvHV
argument_list|(
name|gv
argument_list|)
operator|)
operator|&&
name|HvNAME
argument_list|(
name|hv
argument_list|)
operator|&&
name|hv
operator|!=
name|PL_defstash
condition|)
name|dump_packsubs
argument_list|(
name|hv
argument_list|)
expr_stmt|;
comment|/* nested package */
block|}
block|}
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

begin_function
name|void
name|dump_sub
parameter_list|(
name|GV
modifier|*
name|gv
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|SV
modifier|*
name|sv
init|=
name|sv_newmortal
argument_list|()
decl_stmt|;
name|gv_fullname3
argument_list|(
name|sv
argument_list|,
name|gv
argument_list|,
name|Nullch
argument_list|)
expr_stmt|;
name|dump
argument_list|(
literal|"\nSUB %s = "
argument_list|,
name|SvPVX
argument_list|(
name|sv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|CvXSUB
argument_list|(
name|GvCV
argument_list|(
name|gv
argument_list|)
argument_list|)
condition|)
name|dump
argument_list|(
literal|"(xsub 0x%x %d)\n"
argument_list|,
operator|(
name|long
operator|)
name|CvXSUB
argument_list|(
name|GvCV
argument_list|(
name|gv
argument_list|)
argument_list|)
argument_list|,
name|CvXSUBANY
argument_list|(
name|GvCV
argument_list|(
name|gv
argument_list|)
argument_list|)
operator|.
name|any_i32
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|CvROOT
argument_list|(
name|GvCV
argument_list|(
name|gv
argument_list|)
argument_list|)
condition|)
name|dump_op
argument_list|(
name|CvROOT
argument_list|(
name|GvCV
argument_list|(
name|gv
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|dump
argument_list|(
literal|"<undef>\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

begin_function
name|void
name|dump_form
parameter_list|(
name|GV
modifier|*
name|gv
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|SV
modifier|*
name|sv
init|=
name|sv_newmortal
argument_list|()
decl_stmt|;
name|gv_fullname3
argument_list|(
name|sv
argument_list|,
name|gv
argument_list|,
name|Nullch
argument_list|)
expr_stmt|;
name|dump
argument_list|(
literal|"\nFORMAT %s = "
argument_list|,
name|SvPVX
argument_list|(
name|sv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|CvROOT
argument_list|(
name|GvFORM
argument_list|(
name|gv
argument_list|)
argument_list|)
condition|)
name|dump_op
argument_list|(
name|CvROOT
argument_list|(
name|GvFORM
argument_list|(
name|gv
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|dump
argument_list|(
literal|"<undef>\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

begin_function
name|void
name|dump_eval
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|dump_op
argument_list|(
name|PL_eval_root
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

begin_function
name|void
name|dump_op
parameter_list|(
name|OP
modifier|*
name|o
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|dump
argument_list|(
literal|"{\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|op_seq
condition|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%-4d"
argument_list|,
name|o
operator|->
name|op_seq
argument_list|)
expr_stmt|;
else|else
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"    "
argument_list|)
expr_stmt|;
name|dump
argument_list|(
literal|"TYPE = %s  ===> "
argument_list|,
name|op_name
index|[
name|o
operator|->
name|op_type
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|op_next
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_seq
condition|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%d\n"
argument_list|,
name|o
operator|->
name|op_next
operator|->
name|op_seq
argument_list|)
expr_stmt|;
else|else
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"(%d)\n"
argument_list|,
name|o
operator|->
name|op_next
operator|->
name|op_seq
argument_list|)
expr_stmt|;
block|}
else|else
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"DONE\n"
argument_list|)
expr_stmt|;
name|PL_dumplvl
operator|++
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|op_targ
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_type
operator|==
name|OP_NULL
condition|)
name|dump
argument_list|(
literal|"  (was %s)\n"
argument_list|,
name|op_name
index|[
name|o
operator|->
name|op_targ
index|]
argument_list|)
expr_stmt|;
else|else
name|dump
argument_list|(
literal|"TARG = %d\n"
argument_list|,
name|o
operator|->
name|op_targ
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|DUMPADDR
name|dump
argument_list|(
literal|"ADDR = 0x%lx => 0x%lx\n"
argument_list|,
name|o
argument_list|,
name|o
operator|->
name|op_next
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|o
operator|->
name|op_flags
condition|)
block|{
name|SV
modifier|*
name|tmpsv
init|=
name|newSVpv
argument_list|(
literal|""
argument_list|,
literal|0
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|o
operator|->
name|op_flags
operator|&
name|OPf_WANT
condition|)
block|{
case|case
name|OPf_WANT_VOID
case|:
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",VOID"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPf_WANT_SCALAR
case|:
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",SCALAR"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPf_WANT_LIST
case|:
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",LIST"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",UNKNOWN"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|o
operator|->
name|op_flags
operator|&
name|OPf_KIDS
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",KIDS"
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|op_flags
operator|&
name|OPf_PARENS
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",PARENS"
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|op_flags
operator|&
name|OPf_STACKED
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",STACKED"
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|op_flags
operator|&
name|OPf_REF
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",REF"
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|op_flags
operator|&
name|OPf_MOD
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",MOD"
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|op_flags
operator|&
name|OPf_SPECIAL
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",SPECIAL"
argument_list|)
expr_stmt|;
name|dump
argument_list|(
literal|"FLAGS = (%s)\n"
argument_list|,
name|SvCUR
argument_list|(
name|tmpsv
argument_list|)
condition|?
name|SvPVX
argument_list|(
name|tmpsv
argument_list|)
operator|+
literal|1
else|:
literal|""
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|tmpsv
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|o
operator|->
name|op_private
condition|)
block|{
name|SV
modifier|*
name|tmpsv
init|=
name|newSVpv
argument_list|(
literal|""
argument_list|,
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|o
operator|->
name|op_type
operator|==
name|OP_AASSIGN
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpASSIGN_COMMON
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",COMMON"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|o
operator|->
name|op_type
operator|==
name|OP_SASSIGN
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpASSIGN_BACKWARDS
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",BACKWARDS"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|o
operator|->
name|op_type
operator|==
name|OP_TRANS
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpTRANS_SQUASH
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",SQUASH"
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpTRANS_DELETE
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",DELETE"
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpTRANS_COMPLEMENT
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",COMPLEMENT"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|o
operator|->
name|op_type
operator|==
name|OP_REPEAT
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpREPEAT_DOLIST
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",DOLIST"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|o
operator|->
name|op_type
operator|==
name|OP_ENTERSUB
operator|||
name|o
operator|->
name|op_type
operator|==
name|OP_RV2SV
operator|||
name|o
operator|->
name|op_type
operator|==
name|OP_RV2AV
operator|||
name|o
operator|->
name|op_type
operator|==
name|OP_RV2HV
operator|||
name|o
operator|->
name|op_type
operator|==
name|OP_RV2GV
operator|||
name|o
operator|->
name|op_type
operator|==
name|OP_AELEM
operator|||
name|o
operator|->
name|op_type
operator|==
name|OP_HELEM
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_type
operator|==
name|OP_ENTERSUB
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpENTERSUB_AMPER
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",AMPER"
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpENTERSUB_DB
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",DB"
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpDEREF
condition|)
block|{
case|case
name|OPpDEREF_SV
case|:
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",SV"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPpDEREF_AV
case|:
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",AV"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPpDEREF_HV
case|:
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",HV"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|o
operator|->
name|op_type
operator|==
name|OP_AELEM
operator|||
name|o
operator|->
name|op_type
operator|==
name|OP_HELEM
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpLVAL_DEFER
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",LVAL_DEFER"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|HINT_STRICT_REFS
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",STRICT_REFS"
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|o
operator|->
name|op_type
operator|==
name|OP_CONST
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpCONST_BARE
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",BARE"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|o
operator|->
name|op_type
operator|==
name|OP_FLIP
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpFLIP_LINENUM
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",LINENUM"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|o
operator|->
name|op_type
operator|==
name|OP_FLOP
condition|)
block|{
if|if
condition|(
name|o
operator|->
name|op_private
operator|&
name|OPpFLIP_LINENUM
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",LINENUM"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|o
operator|->
name|op_flags
operator|&
name|OPf_MOD
operator|&&
name|o
operator|->
name|op_private
operator|&
name|OPpLVAL_INTRO
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",INTRO"
argument_list|)
expr_stmt|;
if|if
condition|(
name|SvCUR
argument_list|(
name|tmpsv
argument_list|)
condition|)
name|dump
argument_list|(
literal|"PRIVATE = (%s)\n"
argument_list|,
name|SvPVX
argument_list|(
name|tmpsv
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|tmpsv
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|o
operator|->
name|op_type
condition|)
block|{
case|case
name|OP_GVSV
case|:
case|case
name|OP_GV
case|:
if|if
condition|(
name|cGVOPo
operator|->
name|op_gv
condition|)
block|{
name|SV
modifier|*
name|tmpsv
init|=
name|NEWSV
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|ENTER
expr_stmt|;
name|SAVEFREESV
argument_list|(
name|tmpsv
argument_list|)
expr_stmt|;
name|gv_fullname3
argument_list|(
name|tmpsv
argument_list|,
name|cGVOPo
operator|->
name|op_gv
argument_list|,
name|Nullch
argument_list|)
expr_stmt|;
name|dump
argument_list|(
literal|"GV = %s\n"
argument_list|,
name|SvPV
argument_list|(
name|tmpsv
argument_list|,
name|PL_na
argument_list|)
argument_list|)
expr_stmt|;
name|LEAVE
expr_stmt|;
block|}
else|else
name|dump
argument_list|(
literal|"GV = NULL\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OP_CONST
case|:
name|dump
argument_list|(
literal|"SV = %s\n"
argument_list|,
name|SvPEEK
argument_list|(
name|cSVOPo
operator|->
name|op_sv
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|OP_NEXTSTATE
case|:
case|case
name|OP_DBSTATE
case|:
if|if
condition|(
name|cCOPo
operator|->
name|cop_line
condition|)
name|dump
argument_list|(
literal|"LINE = %d\n"
argument_list|,
name|cCOPo
operator|->
name|cop_line
argument_list|)
expr_stmt|;
if|if
condition|(
name|cCOPo
operator|->
name|cop_label
condition|)
name|dump
argument_list|(
literal|"LABEL = \"%s\"\n"
argument_list|,
name|cCOPo
operator|->
name|cop_label
argument_list|)
expr_stmt|;
break|break;
case|case
name|OP_ENTERLOOP
case|:
name|dump
argument_list|(
literal|"REDO ===> "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cLOOPo
operator|->
name|op_redoop
condition|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%d\n"
argument_list|,
name|cLOOPo
operator|->
name|op_redoop
operator|->
name|op_seq
argument_list|)
expr_stmt|;
else|else
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"DONE\n"
argument_list|)
expr_stmt|;
name|dump
argument_list|(
literal|"NEXT ===> "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cLOOPo
operator|->
name|op_nextop
condition|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%d\n"
argument_list|,
name|cLOOPo
operator|->
name|op_nextop
operator|->
name|op_seq
argument_list|)
expr_stmt|;
else|else
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"DONE\n"
argument_list|)
expr_stmt|;
name|dump
argument_list|(
literal|"LAST ===> "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cLOOPo
operator|->
name|op_lastop
condition|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%d\n"
argument_list|,
name|cLOOPo
operator|->
name|op_lastop
operator|->
name|op_seq
argument_list|)
expr_stmt|;
else|else
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"DONE\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OP_COND_EXPR
case|:
name|dump
argument_list|(
literal|"TRUE ===> "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cCONDOPo
operator|->
name|op_true
condition|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%d\n"
argument_list|,
name|cCONDOPo
operator|->
name|op_true
operator|->
name|op_seq
argument_list|)
expr_stmt|;
else|else
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"DONE\n"
argument_list|)
expr_stmt|;
name|dump
argument_list|(
literal|"FALSE ===> "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cCONDOPo
operator|->
name|op_false
condition|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%d\n"
argument_list|,
name|cCONDOPo
operator|->
name|op_false
operator|->
name|op_seq
argument_list|)
expr_stmt|;
else|else
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"DONE\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OP_MAPWHILE
case|:
case|case
name|OP_GREPWHILE
case|:
case|case
name|OP_OR
case|:
case|case
name|OP_AND
case|:
name|dump
argument_list|(
literal|"OTHER ===> "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cLOGOPo
operator|->
name|op_other
condition|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%d\n"
argument_list|,
name|cLOGOPo
operator|->
name|op_other
operator|->
name|op_seq
argument_list|)
expr_stmt|;
else|else
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"DONE\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OP_PUSHRE
case|:
case|case
name|OP_MATCH
case|:
case|case
name|OP_QR
case|:
case|case
name|OP_SUBST
case|:
name|dump_pm
argument_list|(
name|cPMOPo
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
if|if
condition|(
name|o
operator|->
name|op_flags
operator|&
name|OPf_KIDS
condition|)
block|{
name|OP
modifier|*
name|kid
decl_stmt|;
for|for
control|(
name|kid
operator|=
name|cUNOPo
operator|->
name|op_first
init|;
name|kid
condition|;
name|kid
operator|=
name|kid
operator|->
name|op_sibling
control|)
name|dump_op
argument_list|(
name|kid
argument_list|)
expr_stmt|;
block|}
name|PL_dumplvl
operator|--
expr_stmt|;
name|dump
argument_list|(
literal|"}\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

begin_function
name|void
name|dump_gv
parameter_list|(
name|GV
modifier|*
name|gv
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|SV
modifier|*
name|sv
decl_stmt|;
if|if
condition|(
operator|!
name|gv
condition|)
block|{
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"{}\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|sv
operator|=
name|sv_newmortal
argument_list|()
expr_stmt|;
name|PL_dumplvl
operator|++
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"{\n"
argument_list|)
expr_stmt|;
name|gv_fullname3
argument_list|(
name|sv
argument_list|,
name|gv
argument_list|,
name|Nullch
argument_list|)
expr_stmt|;
name|dump
argument_list|(
literal|"GV_NAME = %s"
argument_list|,
name|SvPVX
argument_list|(
name|sv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gv
operator|!=
name|GvEGV
argument_list|(
name|gv
argument_list|)
condition|)
block|{
name|gv_efullname3
argument_list|(
name|sv
argument_list|,
name|GvEGV
argument_list|(
name|gv
argument_list|)
argument_list|,
name|Nullch
argument_list|)
expr_stmt|;
name|dump
argument_list|(
literal|"-> %s"
argument_list|,
name|SvPVX
argument_list|(
name|sv
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|dump
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|PL_dumplvl
operator|--
expr_stmt|;
name|dump
argument_list|(
literal|"}\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

begin_function
name|void
name|dump_pm
parameter_list|(
name|PMOP
modifier|*
name|pm
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|char
name|ch
decl_stmt|;
if|if
condition|(
operator|!
name|pm
condition|)
block|{
name|dump
argument_list|(
literal|"{}\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|dump
argument_list|(
literal|"{\n"
argument_list|)
expr_stmt|;
name|PL_dumplvl
operator|++
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmflags
operator|&
name|PMf_ONCE
condition|)
name|ch
operator|=
literal|'?'
expr_stmt|;
else|else
name|ch
operator|=
literal|'/'
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmregexp
condition|)
name|dump
argument_list|(
literal|"PMf_PRE %c%s%c%s\n"
argument_list|,
name|ch
argument_list|,
name|pm
operator|->
name|op_pmregexp
operator|->
name|precomp
argument_list|,
name|ch
argument_list|,
operator|(
name|pm
operator|->
name|op_private
operator|&
name|OPpRUNTIME
operator|)
condition|?
literal|" (RUNTIME)"
else|:
literal|""
argument_list|)
expr_stmt|;
else|else
name|dump
argument_list|(
literal|"PMf_PRE (RUNTIME)\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_type
operator|!=
name|OP_PUSHRE
operator|&&
name|pm
operator|->
name|op_pmreplroot
condition|)
block|{
name|dump
argument_list|(
literal|"PMf_REPL = "
argument_list|)
expr_stmt|;
name|dump_op
argument_list|(
name|pm
operator|->
name|op_pmreplroot
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pm
operator|->
name|op_pmflags
operator|||
operator|(
name|pm
operator|->
name|op_pmregexp
operator|&&
name|pm
operator|->
name|op_pmregexp
operator|->
name|check_substr
operator|)
condition|)
block|{
name|SV
modifier|*
name|tmpsv
init|=
name|newSVpv
argument_list|(
literal|""
argument_list|,
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmdynflags
operator|&
name|PMdf_USED
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",USED"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmdynflags
operator|&
name|PMdf_TAINTED
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",TAINTED"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmflags
operator|&
name|PMf_ONCE
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",ONCE"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmregexp
operator|&&
name|pm
operator|->
name|op_pmregexp
operator|->
name|check_substr
operator|&&
operator|!
operator|(
name|pm
operator|->
name|op_pmregexp
operator|->
name|reganch
operator|&
name|ROPT_NOSCAN
operator|)
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",SCANFIRST"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmregexp
operator|&&
name|pm
operator|->
name|op_pmregexp
operator|->
name|check_substr
operator|&&
name|pm
operator|->
name|op_pmregexp
operator|->
name|reganch
operator|&
name|ROPT_CHECK_ALL
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",ALL"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmflags
operator|&
name|PMf_SKIPWHITE
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",SKIPWHITE"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmflags
operator|&
name|PMf_CONST
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",CONST"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmflags
operator|&
name|PMf_KEEP
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",KEEP"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmflags
operator|&
name|PMf_GLOBAL
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",GLOBAL"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmflags
operator|&
name|PMf_CONTINUE
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",CONTINUE"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmflags
operator|&
name|PMf_RETAINT
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",RETAINT"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|op_pmflags
operator|&
name|PMf_EVAL
condition|)
name|sv_catpv
argument_list|(
name|tmpsv
argument_list|,
literal|",EVAL"
argument_list|)
expr_stmt|;
name|dump
argument_list|(
literal|"PMFLAGS = (%s)\n"
argument_list|,
name|SvCUR
argument_list|(
name|tmpsv
argument_list|)
condition|?
name|SvPVX
argument_list|(
name|tmpsv
argument_list|)
operator|+
literal|1
else|:
literal|""
argument_list|)
expr_stmt|;
name|SvREFCNT_dec
argument_list|(
name|tmpsv
argument_list|)
expr_stmt|;
block|}
name|PL_dumplvl
operator|--
expr_stmt|;
name|dump
argument_list|(
literal|"}\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

begin_function
name|STATIC
name|void
name|dump
parameter_list|(
name|char
modifier|*
name|pat
parameter_list|,
modifier|...
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|I32
name|i
decl_stmt|;
name|va_list
name|args
decl_stmt|;
name|va_start
argument_list|(
name|args
argument_list|,
name|pat
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|PL_dumplvl
operator|*
literal|4
init|;
name|i
condition|;
name|i
operator|--
control|)
operator|(
name|void
operator|)
name|PerlIO_putc
argument_list|(
name|Perl_debug_log
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
name|PerlIO_vprintf
argument_list|(
name|Perl_debug_log
argument_list|,
name|pat
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

end_unit

