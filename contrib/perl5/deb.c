begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*    deb.c  *  *    Copyright (c) 1991-1999, Larry Wall  *  *    You may distribute under the terms of either the GNU General Public  *    License or the Artistic License, as specified in the README file.  *  */
end_comment

begin_comment
comment|/*  * "Didst thou think that the eyes of the White Tower were blind?  Nay, I  * have seen more than thou knowest, Gray Fool."  --Denethor  */
end_comment

begin_include
include|#
directive|include
file|"EXTERN.h"
end_include

begin_include
include|#
directive|include
file|"perl.h"
end_include

begin_function
name|void
name|deb
parameter_list|(
specifier|const
name|char
modifier|*
name|pat
parameter_list|,
modifier|...
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|dTHR
expr_stmt|;
name|va_list
name|args
decl_stmt|;
specifier|register
name|I32
name|i
decl_stmt|;
name|GV
modifier|*
name|gv
init|=
name|PL_curcop
operator|->
name|cop_filegv
decl_stmt|;
ifdef|#
directive|ifdef
name|USE_THREADS
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"0x%lx (%s:%ld)\t"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|thr
argument_list|,
name|SvTYPE
argument_list|(
name|gv
argument_list|)
operator|==
name|SVt_PVGV
condition|?
name|SvPVX
argument_list|(
name|GvSV
argument_list|(
name|gv
argument_list|)
argument_list|)
else|:
literal|"<free>"
argument_list|,
operator|(
name|long
operator|)
name|PL_curcop
operator|->
name|cop_line
argument_list|)
expr_stmt|;
else|#
directive|else
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"(%s:%ld)\t"
argument_list|,
name|SvTYPE
argument_list|(
name|gv
argument_list|)
operator|==
name|SVt_PVGV
condition|?
name|SvPVX
argument_list|(
name|GvSV
argument_list|(
name|gv
argument_list|)
argument_list|)
else|:
literal|"<free>"
argument_list|,
operator|(
name|long
operator|)
name|PL_curcop
operator|->
name|cop_line
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* USE_THREADS */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|PL_dlevel
condition|;
name|i
operator|++
control|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%c%c "
argument_list|,
name|PL_debname
index|[
name|i
index|]
argument_list|,
name|PL_debdelim
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|va_start
argument_list|(
name|args
argument_list|,
name|pat
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|PerlIO_vprintf
argument_list|(
name|Perl_debug_log
argument_list|,
name|pat
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

begin_function
name|void
name|deb_growlevel
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|PL_dlmax
operator|+=
literal|128
expr_stmt|;
name|Renew
argument_list|(
name|PL_debname
argument_list|,
name|PL_dlmax
argument_list|,
name|char
argument_list|)
expr_stmt|;
name|Renew
argument_list|(
name|PL_debdelim
argument_list|,
name|PL_dlmax
argument_list|,
name|char
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
block|}
end_function

begin_function
name|I32
name|debstackptrs
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|dTHR
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%8lx %8lx %8ld %8ld %8ld\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|PL_curstack
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|PL_stack_base
argument_list|,
operator|(
name|long
operator|)
operator|*
name|PL_markstack_ptr
argument_list|,
call|(
name|long
call|)
argument_list|(
name|PL_stack_sp
operator|-
name|PL_stack_base
argument_list|)
argument_list|,
call|(
name|long
call|)
argument_list|(
name|PL_stack_max
operator|-
name|PL_stack_base
argument_list|)
argument_list|)
expr_stmt|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%8lx %8lx %8ld %8ld %8ld\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|PL_mainstack
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|AvARRAY
argument_list|(
name|PL_curstack
argument_list|)
argument_list|,
operator|(
name|long
operator|)
name|PL_mainstack
argument_list|,
operator|(
name|long
operator|)
name|AvFILLp
argument_list|(
name|PL_curstack
argument_list|)
argument_list|,
operator|(
name|long
operator|)
name|AvMAX
argument_list|(
name|PL_curstack
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
return|return
literal|0
return|;
block|}
end_function

begin_function
name|I32
name|debstack
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|DEBUGGING
name|dTHR
expr_stmt|;
name|I32
name|top
init|=
name|PL_stack_sp
operator|-
name|PL_stack_base
decl_stmt|;
specifier|register
name|I32
name|i
init|=
name|top
operator|-
literal|30
decl_stmt|;
name|I32
modifier|*
name|markscan
init|=
name|PL_curstackinfo
operator|->
name|si_markbase
decl_stmt|;
if|if
condition|(
name|i
operator|<
literal|0
condition|)
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|++
name|markscan
operator|<=
name|PL_markstack_ptr
condition|)
if|if
condition|(
operator|*
name|markscan
operator|>=
name|i
condition|)
break|break;
ifdef|#
directive|ifdef
name|USE_THREADS
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
name|i
condition|?
literal|"0x%lx    =>  ...  "
else|:
literal|"0x%lx    =>  "
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|thr
argument_list|)
expr_stmt|;
else|#
directive|else
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
name|i
condition|?
literal|"    =>  ...  "
else|:
literal|"    =>  "
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* USE_THREADS */
if|if
condition|(
name|PL_stack_base
index|[
literal|0
index|]
operator|!=
operator|&
name|PL_sv_undef
operator|||
name|PL_stack_sp
operator|<
name|PL_stack_base
condition|)
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|" [STACK UNDERFLOW!!!]\n"
argument_list|)
expr_stmt|;
do|do
block|{
operator|++
name|i
expr_stmt|;
if|if
condition|(
name|markscan
operator|<=
name|PL_markstack_ptr
operator|&&
operator|*
name|markscan
operator|<
name|i
condition|)
block|{
do|do
block|{
operator|++
name|markscan
expr_stmt|;
name|PerlIO_putc
argument_list|(
name|Perl_debug_log
argument_list|,
literal|'*'
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|markscan
operator|<=
name|PL_markstack_ptr
operator|&&
operator|*
name|markscan
operator|<
name|i
condition|)
do|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"  "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|>
name|top
condition|)
break|break;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"%-4s  "
argument_list|,
name|SvPEEK
argument_list|(
name|PL_stack_base
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
literal|1
condition|)
do|;
name|PerlIO_printf
argument_list|(
name|Perl_debug_log
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUGGING */
return|return
literal|0
return|;
block|}
end_function

end_unit

