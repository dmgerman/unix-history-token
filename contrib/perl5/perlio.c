begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*    perlio.c  *  *    Copyright (c) 1996-2001, Nick Ing-Simmons  *  *    You may distribute under the terms of either the GNU General Public  *    License or the Artistic License, as specified in the README file.  *  */
end_comment

begin_define
define|#
directive|define
name|VOIDUSED
value|1
end_define

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_define
define|#
directive|define
name|PERLIO_NOT_STDIO
value|0
end_define

begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|PERLIO_IS_STDIO
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|USE_SFIO
argument_list|)
end_if

begin_define
define|#
directive|define
name|PerlIO
value|FILE
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * This file provides those parts of PerlIO abstraction   * which are not #defined in iperlsys.h.  * Which these are depends on various Configure #ifdef's   */
end_comment

begin_include
include|#
directive|include
file|"EXTERN.h"
end_include

begin_define
define|#
directive|define
name|PERL_IN_PERLIO_C
end_define

begin_include
include|#
directive|include
file|"perl.h"
end_include

begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|PERL_IMPLICIT_SYS
argument_list|)
end_if

begin_ifdef
ifdef|#
directive|ifdef
name|PERLIO_IS_STDIO
end_ifdef

begin_function
name|void
name|PerlIO_init
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* Does nothing (yet) except force this file to be included      in perl binary. That allows this file to force inclusion     of other functions that may be required by loadable      extensions e.g. for FileHandle::tmpfile    */
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_tmpfile
end_undef

begin_function
name|PerlIO
modifier|*
name|PerlIO_tmpfile
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|tmpfile
argument_list|()
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* PERLIO_IS_STDIO */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|USE_SFIO
end_ifdef

begin_undef
undef|#
directive|undef
name|HAS_FSETPOS
end_undef

begin_undef
undef|#
directive|undef
name|HAS_FGETPOS
end_undef

begin_comment
comment|/* This section is just to make sure these functions     get pulled in from libsfio.a */
end_comment

begin_undef
undef|#
directive|undef
name|PerlIO_tmpfile
end_undef

begin_function
name|PerlIO
modifier|*
name|PerlIO_tmpfile
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|sftmp
argument_list|(
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|PerlIO_init
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* Force this file to be included  in perl binary. Which allows    *  this file to force inclusion  of other functions that may be    *  required by loadable  extensions e.g. for FileHandle::tmpfile     */
comment|/* Hack   * sfio does its own 'autoflush' on stdout in common cases.   * Flush results in a lot of lseek()s to regular files and    * lot of small writes to pipes.   */
name|sfset
argument_list|(
name|sfstdout
argument_list|,
name|SF_SHARE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* USE_SFIO */
end_comment

begin_comment
comment|/* Implement all the PerlIO interface using stdio.     - this should be only file to include<stdio.h> */
end_comment

begin_undef
undef|#
directive|undef
name|PerlIO_stderr
end_undef

begin_function
name|PerlIO
modifier|*
name|PerlIO_stderr
parameter_list|(
name|void
parameter_list|)
block|{
return|return
operator|(
name|PerlIO
operator|*
operator|)
name|stderr
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_stdin
end_undef

begin_function
name|PerlIO
modifier|*
name|PerlIO_stdin
parameter_list|(
name|void
parameter_list|)
block|{
return|return
operator|(
name|PerlIO
operator|*
operator|)
name|stdin
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_stdout
end_undef

begin_function
name|PerlIO
modifier|*
name|PerlIO_stdout
parameter_list|(
name|void
parameter_list|)
block|{
return|return
operator|(
name|PerlIO
operator|*
operator|)
name|stdout
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_fast_gets
end_undef

begin_function
name|int
name|PerlIO_fast_gets
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|USE_STDIO_PTR
argument_list|)
operator|&&
name|defined
argument_list|(
name|STDIO_PTR_LVALUE
argument_list|)
operator|&&
name|defined
argument_list|(
name|STDIO_CNT_LVALUE
argument_list|)
return|return
literal|1
return|;
else|#
directive|else
return|return
literal|0
return|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_has_cntptr
end_undef

begin_function
name|int
name|PerlIO_has_cntptr
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|USE_STDIO_PTR
argument_list|)
return|return
literal|1
return|;
else|#
directive|else
return|return
literal|0
return|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_canset_cnt
end_undef

begin_function
name|int
name|PerlIO_canset_cnt
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|USE_STDIO_PTR
argument_list|)
operator|&&
name|defined
argument_list|(
name|STDIO_CNT_LVALUE
argument_list|)
return|return
literal|1
return|;
else|#
directive|else
return|return
literal|0
return|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_set_cnt
end_undef

begin_function
name|void
name|PerlIO_set_cnt
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
name|int
name|cnt
parameter_list|)
block|{
name|dTHX
expr_stmt|;
if|if
condition|(
name|cnt
operator|<
operator|-
literal|1
operator|&&
name|ckWARN_d
argument_list|(
name|WARN_INTERNAL
argument_list|)
condition|)
name|Perl_warner
argument_list|(
argument|aTHX_ WARN_INTERNAL
argument_list|,
literal|"Setting cnt to %d\n"
argument_list|,
argument|cnt
argument_list|)
empty_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|USE_STDIO_PTR
argument_list|)
operator|&&
name|defined
argument_list|(
name|STDIO_CNT_LVALUE
argument_list|)
name|FILE_cnt
argument_list|(
name|f
argument_list|)
operator|=
name|cnt
expr_stmt|;
else|#
directive|else
name|Perl_croak
argument_list|(
name|aTHX_
literal|"Cannot set 'cnt' of FILE * on this system"
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_set_ptrcnt
end_undef

begin_function
name|void
name|PerlIO_set_ptrcnt
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
name|STDCHAR
modifier|*
name|ptr
parameter_list|,
name|int
name|cnt
parameter_list|)
block|{
name|dTHX
expr_stmt|;
ifdef|#
directive|ifdef
name|FILE_bufsiz
name|STDCHAR
modifier|*
name|e
init|=
name|FILE_base
argument_list|(
name|f
argument_list|)
operator|+
name|FILE_bufsiz
argument_list|(
name|f
argument_list|)
decl_stmt|;
name|int
name|ec
init|=
name|e
operator|-
name|ptr
decl_stmt|;
if|if
condition|(
name|ptr
operator|>
name|e
operator|+
literal|1
operator|&&
name|ckWARN_d
argument_list|(
name|WARN_INTERNAL
argument_list|)
condition|)
name|Perl_warner
argument_list|(
argument|aTHX_ WARN_INTERNAL
argument_list|,
literal|"Setting ptr %p> end+1 %p\n"
argument_list|,
argument|ptr
argument_list|,
argument|e +
literal|1
argument_list|)
empty_stmt|;
if|if
condition|(
name|cnt
operator|!=
name|ec
operator|&&
name|ckWARN_d
argument_list|(
name|WARN_INTERNAL
argument_list|)
condition|)
name|Perl_warner
argument_list|(
argument|aTHX_ WARN_INTERNAL
argument_list|,
literal|"Setting cnt to %d, ptr implies %d\n"
argument_list|,
argument|cnt
argument_list|,
argument|ec
argument_list|)
empty_stmt|;
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|USE_STDIO_PTR
argument_list|)
operator|&&
name|defined
argument_list|(
name|STDIO_PTR_LVALUE
argument_list|)
name|FILE_ptr
argument_list|(
name|f
argument_list|)
operator|=
name|ptr
expr_stmt|;
else|#
directive|else
name|Perl_croak
argument_list|(
name|aTHX_
literal|"Cannot set 'ptr' of FILE * on this system"
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|USE_STDIO_PTR
argument_list|)
operator|&&
name|defined
argument_list|(
name|STDIO_CNT_LVALUE
argument_list|)
operator|&&
name|defined
argument_list|(
name|STDIO_PTR_LVAL_NOCHANGE_CNT
argument_list|)
name|FILE_cnt
argument_list|(
name|f
argument_list|)
operator|=
name|cnt
expr_stmt|;
else|#
directive|else
if|#
directive|if
name|defined
argument_list|(
name|STDIO_PTR_LVAL_SETS_CNT
argument_list|)
name|assert
argument_list|(
name|FILE_cnt
argument_list|(
name|f
argument_list|)
operator|==
name|cnt
argument_list|)
expr_stmt|;
else|#
directive|else
name|Perl_croak
argument_list|(
name|aTHX_
literal|"Cannot set 'cnt' of FILE * on this system when setting 'ptr'"
argument_list|)
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_get_cnt
end_undef

begin_function
name|int
name|PerlIO_get_cnt
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|FILE_cnt
return|return
name|FILE_cnt
argument_list|(
name|f
argument_list|)
return|;
else|#
directive|else
name|dTHX
expr_stmt|;
name|Perl_croak
argument_list|(
name|aTHX_
literal|"Cannot get 'cnt' of FILE * on this system"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_get_bufsiz
end_undef

begin_function
name|int
name|PerlIO_get_bufsiz
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|FILE_bufsiz
return|return
name|FILE_bufsiz
argument_list|(
name|f
argument_list|)
return|;
else|#
directive|else
name|dTHX
expr_stmt|;
name|Perl_croak
argument_list|(
name|aTHX_
literal|"Cannot get 'bufsiz' of FILE * on this system"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_get_ptr
end_undef

begin_function
name|STDCHAR
modifier|*
name|PerlIO_get_ptr
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|FILE_ptr
return|return
name|FILE_ptr
argument_list|(
name|f
argument_list|)
return|;
else|#
directive|else
name|dTHX
expr_stmt|;
name|Perl_croak
argument_list|(
name|aTHX_
literal|"Cannot get 'ptr' of FILE * on this system"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_get_base
end_undef

begin_function
name|STDCHAR
modifier|*
name|PerlIO_get_base
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|FILE_base
return|return
name|FILE_base
argument_list|(
name|f
argument_list|)
return|;
else|#
directive|else
name|dTHX
expr_stmt|;
name|Perl_croak
argument_list|(
name|aTHX_
literal|"Cannot get 'base' of FILE * on this system"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_has_base
end_undef

begin_function
name|int
name|PerlIO_has_base
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|FILE_base
return|return
literal|1
return|;
else|#
directive|else
return|return
literal|0
return|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_puts
end_undef

begin_function
name|int
name|PerlIO_puts
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
specifier|const
name|char
modifier|*
name|s
parameter_list|)
block|{
return|return
name|fputs
argument_list|(
name|s
argument_list|,
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_open
end_undef

begin_function
name|PerlIO
modifier|*
name|PerlIO_open
parameter_list|(
specifier|const
name|char
modifier|*
name|path
parameter_list|,
specifier|const
name|char
modifier|*
name|mode
parameter_list|)
block|{
return|return
name|fopen
argument_list|(
name|path
argument_list|,
name|mode
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_fdopen
end_undef

begin_function
name|PerlIO
modifier|*
name|PerlIO_fdopen
parameter_list|(
name|int
name|fd
parameter_list|,
specifier|const
name|char
modifier|*
name|mode
parameter_list|)
block|{
return|return
name|fdopen
argument_list|(
name|fd
argument_list|,
name|mode
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_reopen
end_undef

begin_function
name|PerlIO
modifier|*
name|PerlIO_reopen
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|char
modifier|*
name|mode
parameter_list|,
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
return|return
name|freopen
argument_list|(
name|name
argument_list|,
name|mode
argument_list|,
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_close
end_undef

begin_function
name|int
name|PerlIO_close
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
return|return
name|fclose
argument_list|(
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_eof
end_undef

begin_function
name|int
name|PerlIO_eof
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
return|return
name|feof
argument_list|(
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_getname
end_undef

begin_function
name|char
modifier|*
name|PerlIO_getname
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|VMS
return|return
name|fgetname
argument_list|(
name|f
argument_list|,
name|buf
argument_list|)
return|;
else|#
directive|else
name|dTHX
expr_stmt|;
name|Perl_croak
argument_list|(
name|aTHX_
literal|"Don't know how to get file name"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_getc
end_undef

begin_function
name|int
name|PerlIO_getc
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
return|return
name|fgetc
argument_list|(
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_error
end_undef

begin_function
name|int
name|PerlIO_error
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
return|return
name|ferror
argument_list|(
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_clearerr
end_undef

begin_function
name|void
name|PerlIO_clearerr
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
name|clearerr
argument_list|(
name|f
argument_list|)
expr_stmt|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_flush
end_undef

begin_function
name|int
name|PerlIO_flush
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
return|return
name|Fflush
argument_list|(
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_fileno
end_undef

begin_function
name|int
name|PerlIO_fileno
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
return|return
name|fileno
argument_list|(
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_setlinebuf
end_undef

begin_function
name|void
name|PerlIO_setlinebuf
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAS_SETLINEBUF
name|setlinebuf
argument_list|(
name|f
argument_list|)
expr_stmt|;
else|#
directive|else
ifdef|#
directive|ifdef
name|__BORLANDC__
comment|/* Borland doesn't like NULL size for _IOLBF */
name|setvbuf
argument_list|(
name|f
argument_list|,
name|Nullch
argument_list|,
name|_IOLBF
argument_list|,
name|BUFSIZ
argument_list|)
expr_stmt|;
else|#
directive|else
name|setvbuf
argument_list|(
name|f
argument_list|,
name|Nullch
argument_list|,
name|_IOLBF
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_putc
end_undef

begin_function
name|int
name|PerlIO_putc
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
name|int
name|ch
parameter_list|)
block|{
return|return
name|putc
argument_list|(
name|ch
argument_list|,
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_ungetc
end_undef

begin_function
name|int
name|PerlIO_ungetc
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
name|int
name|ch
parameter_list|)
block|{
return|return
name|ungetc
argument_list|(
name|ch
argument_list|,
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_read
end_undef

begin_function
name|SSize_t
name|PerlIO_read
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
name|void
modifier|*
name|buf
parameter_list|,
name|Size_t
name|count
parameter_list|)
block|{
return|return
name|fread
argument_list|(
name|buf
argument_list|,
literal|1
argument_list|,
name|count
argument_list|,
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_write
end_undef

begin_function
name|SSize_t
name|PerlIO_write
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
specifier|const
name|void
modifier|*
name|buf
parameter_list|,
name|Size_t
name|count
parameter_list|)
block|{
return|return
name|fwrite1
argument_list|(
name|buf
argument_list|,
literal|1
argument_list|,
name|count
argument_list|,
name|f
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_vprintf
end_undef

begin_function
name|int
name|PerlIO_vprintf
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
name|va_list
name|ap
parameter_list|)
block|{
return|return
name|vfprintf
argument_list|(
name|f
argument_list|,
name|fmt
argument_list|,
name|ap
argument_list|)
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_tell
end_undef

begin_function
name|Off_t
name|PerlIO_tell
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|USE_64_BIT_STDIO
argument_list|)
operator|&&
name|defined
argument_list|(
name|HAS_FTELLO
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|USE_FTELL64
argument_list|)
return|return
name|ftello
argument_list|(
name|f
argument_list|)
return|;
else|#
directive|else
return|return
name|ftell
argument_list|(
name|f
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_seek
end_undef

begin_function
name|int
name|PerlIO_seek
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
name|Off_t
name|offset
parameter_list|,
name|int
name|whence
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|USE_64_BIT_STDIO
argument_list|)
operator|&&
name|defined
argument_list|(
name|HAS_FSEEKO
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|USE_FSEEK64
argument_list|)
return|return
name|fseeko
argument_list|(
name|f
argument_list|,
name|offset
argument_list|,
name|whence
argument_list|)
return|;
else|#
directive|else
return|return
name|fseek
argument_list|(
name|f
argument_list|,
name|offset
argument_list|,
name|whence
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_rewind
end_undef

begin_function
name|void
name|PerlIO_rewind
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
name|rewind
argument_list|(
name|f
argument_list|)
expr_stmt|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_printf
end_undef

begin_function
name|int
name|PerlIO_printf
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|ap
decl_stmt|;
name|int
name|result
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|result
operator|=
name|vfprintf
argument_list|(
name|f
argument_list|,
name|fmt
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_stdoutf
end_undef

begin_function
name|int
name|PerlIO_stdoutf
parameter_list|(
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|ap
decl_stmt|;
name|int
name|result
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|result
operator|=
name|PerlIO_vprintf
argument_list|(
name|PerlIO_stdout
argument_list|()
argument_list|,
name|fmt
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_tmpfile
end_undef

begin_function
name|PerlIO
modifier|*
name|PerlIO_tmpfile
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|tmpfile
argument_list|()
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_importFILE
end_undef

begin_function
name|PerlIO
modifier|*
name|PerlIO_importFILE
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|int
name|fl
parameter_list|)
block|{
return|return
name|f
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_exportFILE
end_undef

begin_function
name|FILE
modifier|*
name|PerlIO_exportFILE
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
name|int
name|fl
parameter_list|)
block|{
return|return
name|f
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_findFILE
end_undef

begin_function
name|FILE
modifier|*
name|PerlIO_findFILE
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|)
block|{
return|return
name|f
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|PerlIO_releaseFILE
end_undef

begin_function
name|void
name|PerlIO_releaseFILE
parameter_list|(
name|PerlIO
modifier|*
name|p
parameter_list|,
name|FILE
modifier|*
name|f
parameter_list|)
block|{ }
end_function

begin_function
name|void
name|PerlIO_init
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* Does nothing (yet) except force this file to be included      in perl binary. That allows this file to force inclusion     of other functions that may be required by loadable      extensions e.g. for FileHandle::tmpfile    */
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* USE_SFIO */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* PERLIO_IS_STDIO */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|HAS_FSETPOS
end_ifndef

begin_undef
undef|#
directive|undef
name|PerlIO_setpos
end_undef

begin_function
name|int
ifdef|#
directive|ifdef
name|USE_SFIO
name|PerlIO_setpos
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
specifier|const
name|Off_t
modifier|*
name|pos
parameter_list|)
else|#
directive|else
function|PerlIO_setpos
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
specifier|const
name|Fpos_t
modifier|*
name|pos
parameter_list|)
endif|#
directive|endif
block|{
return|return
name|PerlIO_seek
argument_list|(
name|f
argument_list|,
operator|*
name|pos
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_ifndef
ifndef|#
directive|ifndef
name|PERLIO_IS_STDIO
end_ifndef

begin_undef
undef|#
directive|undef
name|PerlIO_setpos
end_undef

begin_function
name|int
name|PerlIO_setpos
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
specifier|const
name|Fpos_t
modifier|*
name|pos
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|USE_64_BIT_STDIO
argument_list|)
operator|&&
name|defined
argument_list|(
name|USE_FSETPOS64
argument_list|)
return|return
name|fsetpos64
argument_list|(
name|f
argument_list|,
name|pos
argument_list|)
return|;
else|#
directive|else
return|return
name|fsetpos
argument_list|(
name|f
argument_list|,
name|pos
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|HAS_FGETPOS
end_ifndef

begin_undef
undef|#
directive|undef
name|PerlIO_getpos
end_undef

begin_function
name|int
ifdef|#
directive|ifdef
name|USE_SFIO
name|PerlIO_getpos
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
name|Off_t
modifier|*
name|pos
parameter_list|)
block|{
operator|*
name|pos
operator|=
name|PerlIO_seek
argument_list|(
name|f
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_macro
name|PerlIO_getpos
argument_list|(
argument|PerlIO *f
argument_list|,
argument|Fpos_t *pos
argument_list|)
end_macro

begin_block
block|{
operator|*
name|pos
operator|=
name|PerlIO_tell
argument_list|(
name|f
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

begin_else
else|#
directive|else
end_else

begin_ifndef
ifndef|#
directive|ifndef
name|PERLIO_IS_STDIO
end_ifndef

begin_undef
undef|#
directive|undef
name|PerlIO_getpos
end_undef

begin_function
name|int
name|PerlIO_getpos
parameter_list|(
name|PerlIO
modifier|*
name|f
parameter_list|,
name|Fpos_t
modifier|*
name|pos
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|USE_64_BIT_STDIO
argument_list|)
operator|&&
name|defined
argument_list|(
name|USE_FSETPOS64
argument_list|)
return|return
name|fgetpos64
argument_list|(
name|f
argument_list|,
name|pos
argument_list|)
return|;
else|#
directive|else
return|return
name|fgetpos
argument_list|(
name|f
argument_list|,
name|pos
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|defined
argument_list|(
name|PERLIO_IS_STDIO
argument_list|)
operator|||
operator|!
name|defined
argument_list|(
name|USE_SFIO
argument_list|)
operator|)
operator|&&
operator|!
name|defined
argument_list|(
name|HAS_VPRINTF
argument_list|)
end_if

begin_function
name|int
name|vprintf
parameter_list|(
name|char
modifier|*
name|pat
parameter_list|,
name|char
modifier|*
name|args
parameter_list|)
block|{
name|_doprnt
argument_list|(
name|pat
argument_list|,
name|args
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
comment|/* wrong, but perl doesn't use the return value */
block|}
end_function

begin_function
name|int
name|vfprintf
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
name|char
modifier|*
name|pat
parameter_list|,
name|char
modifier|*
name|args
parameter_list|)
block|{
name|_doprnt
argument_list|(
name|pat
argument_list|,
name|args
argument_list|,
name|fd
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
comment|/* wrong, but perl doesn't use the return value */
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|PerlIO_vsprintf
end_ifndef

begin_function
name|int
name|PerlIO_vsprintf
parameter_list|(
name|char
modifier|*
name|s
parameter_list|,
name|int
name|n
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
name|va_list
name|ap
parameter_list|)
block|{
name|int
name|val
init|=
name|vsprintf
argument_list|(
name|s
argument_list|,
name|fmt
argument_list|,
name|ap
argument_list|)
decl_stmt|;
if|if
condition|(
name|n
operator|>=
literal|0
condition|)
block|{
if|if
condition|(
name|strlen
argument_list|(
name|s
argument_list|)
operator|>=
operator|(
name|STRLEN
operator|)
name|n
condition|)
block|{
name|dTHX
expr_stmt|;
name|PerlIO_puts
argument_list|(
name|Perl_error_log
argument_list|,
literal|"panic: sprintf overflow - memory corrupted!\n"
argument_list|)
expr_stmt|;
name|my_exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|val
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|PerlIO_sprintf
end_ifndef

begin_function
name|int
name|PerlIO_sprintf
parameter_list|(
name|char
modifier|*
name|s
parameter_list|,
name|int
name|n
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|ap
decl_stmt|;
name|int
name|result
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|result
operator|=
name|PerlIO_vsprintf
argument_list|(
name|s
argument_list|,
name|n
argument_list|,
name|fmt
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* !PERL_IMPLICIT_SYS */
end_comment

end_unit

