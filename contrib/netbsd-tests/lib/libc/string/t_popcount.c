begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	$NetBSD: t_popcount.c,v 1.4 2011/07/07 08:27:36 jruoho Exp $	*/
end_comment

begin_comment
comment|/*-  * Copyright (c) 2009 The NetBSD Foundation, Inc.  * All rights reserved.  *  * This code is derived from software contributed to The NetBSD Foundation  * by Joerg Sonnenberger.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in  *    the documentation and/or other materials provided with the  *    distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS  * FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE  * COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING,  * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED  * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT  * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__RCSID
argument_list|(
literal|"$NetBSD: t_popcount.c,v 1.4 2011/07/07 08:27:36 jruoho Exp $"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<atf-c.h>
end_include

begin_include
include|#
directive|include
file|<strings.h>
end_include

begin_decl_stmt
specifier|static
name|unsigned
name|int
name|byte_count
index|[
literal|256
index|]
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|popcount_init
parameter_list|(
specifier|const
name|char
modifier|*
name|cfg_var
parameter_list|)
block|{
name|unsigned
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|cfg_var
argument_list|,
literal|"YES"
argument_list|)
operator|==
literal|0
operator|||
name|strcasecmp
argument_list|(
name|cfg_var
argument_list|,
literal|"Y"
argument_list|)
operator|==
literal|0
operator|||
name|strcasecmp
argument_list|(
name|cfg_var
argument_list|,
literal|"1"
argument_list|)
operator|==
literal|0
operator|||
name|strcasecmp
argument_list|(
name|cfg_var
argument_list|,
literal|"T"
argument_list|)
operator|==
literal|0
operator|||
name|strcasecmp
argument_list|(
name|cfg_var
argument_list|,
literal|"TRUE"
argument_list|)
operator|==
literal|0
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
operator|++
name|i
control|)
block|{
name|byte_count
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|j
operator|=
name|i
init|;
name|j
operator|!=
literal|0
condition|;
name|j
operator|>>=
literal|1
control|)
block|{
if|if
condition|(
name|j
operator|&
literal|1
condition|)
operator|++
name|byte_count
index|[
name|i
index|]
expr_stmt|;
block|}
block|}
return|return;
block|}
name|atf_tc_skip
argument_list|(
literal|"config variable \"run_popcount\" not set to YES/TRUE"
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
name|unsigned
name|int
name|test_parts
index|[
literal|256
index|]
init|=
block|{
literal|0x318e53e6U
block|,
literal|0x11710316U
block|,
literal|0x62608ffaU
block|,
literal|0x67e0f562U
block|,
literal|0xe432e82cU
block|,
literal|0x9862e8b2U
block|,
literal|0x7d96a627U
block|,
literal|0x3f74ad31U
block|,
literal|0x3cecf906U
block|,
literal|0xcdc0dcb4U
block|,
literal|0x241dab64U
block|,
literal|0x31e6133eU
block|,
literal|0x23086ad4U
block|,
literal|0x721d5a91U
block|,
literal|0xc483da53U
block|,
literal|0x6a62af52U
block|,
literal|0xf3f5c386U
block|,
literal|0xe0de3f77U
block|,
literal|0x65afe528U
block|,
literal|0xf4816485U
block|,
literal|0x40ccbf08U
block|,
literal|0x25df49c1U
block|,
literal|0xae5a6ee0U
block|,
literal|0xab36ccadU
block|,
literal|0x87e1ec29U
block|,
literal|0x60ca2407U
block|,
literal|0x49d62e47U
block|,
literal|0xa09f2df5U
block|,
literal|0xaf4c1c68U
block|,
literal|0x8ef08d50U
block|,
literal|0x624cfd2fU
block|,
literal|0xa6a36f20U
block|,
literal|0x68aaf879U
block|,
literal|0x0fe9deabU
block|,
literal|0x5c9a4060U
block|,
literal|0x215d8f08U
block|,
literal|0x55e84712U
block|,
literal|0xea1f1681U
block|,
literal|0x3a10b8a1U
block|,
literal|0x08e06632U
block|,
literal|0xcbc875e2U
block|,
literal|0x31e53258U
block|,
literal|0xcd3807a4U
block|,
literal|0xb9d17516U
block|,
literal|0x8fbfd9abU
block|,
literal|0x6651b555U
block|,
literal|0x550fb381U
block|,
literal|0x05061b9dU
block|,
literal|0x35aef3f2U
block|,
literal|0x9175078cU
block|,
literal|0xae0f14daU
block|,
literal|0x92a2d5f8U
block|,
literal|0x70d968feU
block|,
literal|0xe86f41c5U
block|,
literal|0x5cfaf39fU
block|,
literal|0x8499b18dU
block|,
literal|0xb33f879aU
block|,
literal|0x0a68ad3dU
block|,
literal|0x9323ecc1U
block|,
literal|0x060037ddU
block|,
literal|0xb91a5051U
block|,
literal|0xa0dbebf6U
block|,
literal|0x3e6aa6f1U
block|,
literal|0x7b422b5bU
block|,
literal|0x599e811eU
block|,
literal|0x199f7594U
block|,
literal|0xca453365U
block|,
literal|0x1cda6f48U
block|,
literal|0xe9c75d2cU
block|,
literal|0x6a873217U
block|,
literal|0x79c45d72U
block|,
literal|0x143b8e37U
block|,
literal|0xa11df26eU
block|,
literal|0xaf31f80aU
block|,
literal|0x311bf759U
block|,
literal|0x2378563cU
block|,
literal|0x9ab95fa5U
block|,
literal|0xfcf4d47cU
block|,
literal|0x1f7db268U
block|,
literal|0xd64b09e1U
block|,
literal|0xad7936daU
block|,
literal|0x7a59005cU
block|,
literal|0x45b173d3U
block|,
literal|0xc1a71b32U
block|,
literal|0x7d9f0de2U
block|,
literal|0xa9ac3792U
block|,
literal|0x9e7f9966U
block|,
literal|0x7f0b8080U
block|,
literal|0xece6c06fU
block|,
literal|0x78d92a3cU
block|,
literal|0x6d5f8f6cU
block|,
literal|0xc50ca544U
block|,
literal|0x5d8ded27U
block|,
literal|0xd27a8462U
block|,
literal|0x4bcd13ccU
block|,
literal|0xd49075f2U
block|,
literal|0xa8d52acfU
block|,
literal|0x41915d97U
block|,
literal|0x564f7062U
block|,
literal|0xefb046e2U
block|,
literal|0xe296277aU
block|,
literal|0x605b0ea3U
block|,
literal|0x10b2c3a1U
block|,
literal|0x4e8e5c66U
block|,
literal|0x4bd8ec04U
block|,
literal|0x29935be9U
block|,
literal|0x381839f3U
block|,
literal|0x555d8824U
block|,
literal|0xd6befddbU
block|,
literal|0x5d8d6d6eU
block|,
literal|0xb2fdb7b4U
block|,
literal|0xb471c8fcU
block|,
literal|0xc2fd325bU
block|,
literal|0x932d2487U
block|,
literal|0xbdbbadefU
block|,
literal|0x66c8895dU
block|,
literal|0x5d77857aU
block|,
literal|0x259f1cc0U
block|,
literal|0x302037faU
block|,
literal|0xda9aa7a8U
block|,
literal|0xb112c6aaU
block|,
literal|0x78f74192U
block|,
literal|0xfd4da741U
block|,
literal|0xfa5765c1U
block|,
literal|0x6ea1bc5cU
block|,
literal|0xd283f39cU
block|,
literal|0x268ae67dU
block|,
literal|0xdedcd134U
block|,
literal|0xbbf92410U
block|,
literal|0x6b45fb55U
block|,
literal|0x2f75ac71U
block|,
literal|0x64bf2ca5U
block|,
literal|0x8b99675aU
block|,
literal|0x3f4923b6U
block|,
literal|0x7e610550U
block|,
literal|0x04b1c06dU
block|,
literal|0x8f92e7c6U
block|,
literal|0x45cb608bU
block|,
literal|0x2d06d1f2U
block|,
literal|0x79cf387aU
block|,
literal|0xfd3ed225U
block|,
literal|0x243eee20U
block|,
literal|0x2cbefc6fU
block|,
literal|0x8286cbaaU
block|,
literal|0x70d4c182U
block|,
literal|0x054e3cc6U
block|,
literal|0xb66c5362U
block|,
literal|0x0c73fa5dU
block|,
literal|0x539948feU
block|,
literal|0xec638563U
block|,
literal|0x0cf04ab6U
block|,
literal|0xec7b52f4U
block|,
literal|0x58eeffceU
block|,
literal|0x6fe8049aU
block|,
literal|0xb3b33332U
block|,
literal|0x2e33bfdbU
block|,
literal|0xcc817567U
block|,
literal|0x71ac57c8U
block|,
literal|0x4bab3ac7U
block|,
literal|0x327c558bU
block|,
literal|0x82a6d279U
block|,
literal|0x5adf71daU
block|,
literal|0x1074a656U
block|,
literal|0x3c533c1fU
block|,
literal|0x82fdbe69U
block|,
literal|0x21b4f6afU
block|,
literal|0xd59580e8U
block|,
literal|0x0de824ebU
block|,
literal|0xa510941bU
block|,
literal|0x7cd91144U
block|,
literal|0xa8c10631U
block|,
literal|0x4c839267U
block|,
literal|0x5d503c2fU
block|,
literal|0xe1567d55U
block|,
literal|0x23910cc7U
block|,
literal|0xdb1bdc34U
block|,
literal|0x2a866704U
block|,
literal|0x33e21f0cU
block|,
literal|0x5c7681b4U
block|,
literal|0x818651caU
block|,
literal|0xb1d18162U
block|,
literal|0x225ad014U
block|,
literal|0xadf7d6baU
block|,
literal|0xac548d9bU
block|,
literal|0xe94736e5U
block|,
literal|0x2279c5f1U
block|,
literal|0x33215d2cU
block|,
literal|0xdc8ab90eU
block|,
literal|0xf5e3d7f2U
block|,
literal|0xedcb15cfU
block|,
literal|0xc9a43c4cU
block|,
literal|0xfc678fc6U
block|,
literal|0x43796b95U
block|,
literal|0x3f8b700cU
block|,
literal|0x867bbc72U
block|,
literal|0x81f71fecU
block|,
literal|0xd00cad7dU
block|,
literal|0x302c458fU
block|,
literal|0x8ae21accU
block|,
literal|0x05850ce8U
block|,
literal|0x7764d8e8U
block|,
literal|0x8a36cd68U
block|,
literal|0x40b44bd7U
block|,
literal|0x1cffaeb7U
block|,
literal|0x2b248f34U
block|,
literal|0x1eefdbafU
block|,
literal|0x574d7437U
block|,
literal|0xe86cd935U
block|,
literal|0xf53dd1c8U
block|,
literal|0x1b022513U
block|,
literal|0xef2d249bU
block|,
literal|0x94fb2b08U
block|,
literal|0x15d3eff8U
block|,
literal|0x14245e1bU
block|,
literal|0x82aa8425U
block|,
literal|0x53959028U
block|,
literal|0x9c5f9b80U
block|,
literal|0x325e0c82U
block|,
literal|0x3e236c24U
block|,
literal|0x74e1dd36U
block|,
literal|0x9890df3fU
block|,
literal|0xaf9701a2U
block|,
literal|0x023b3413U
block|,
literal|0x7634c67eU
block|,
literal|0x55cf5e45U
block|,
literal|0x56d2a95bU
block|,
literal|0xb6db869bU
block|,
literal|0xac19e260U
block|,
literal|0xdd310740U
block|,
literal|0x26d68f84U
block|,
literal|0x45bebf17U
block|,
literal|0xe4a7728fU
block|,
literal|0xf082e66eU
block|,
literal|0xb2fe3c10U
block|,
literal|0x2db1fa2cU
block|,
literal|0x4b3dfcfaU
block|,
literal|0xc7b3a672U
block|,
literal|0xaeadc67bU
block|,
literal|0x6cce6f2bU
block|,
literal|0x8263dbbfU
block|,
literal|0xd9724d5bU
block|,
literal|0xbcc767b5U
block|,
literal|0x8d563798U
block|,
literal|0x2db764b4U
block|,
literal|0x76e0cee7U
block|,
literal|0xd34f9a67U
block|,
literal|0x035c810aU
block|,
literal|0x3f56bdc1U
block|,
literal|0x5b3f2c84U
block|,
literal|0x0baca8c0U
block|,
literal|0xfe979a77U
block|,
literal|0x484ca775U
block|,
literal|0xbdc7f104U
block|,
literal|0xc06c3efbU
block|,
literal|0xdbc5f32cU
block|,
literal|0x44b017e7U
block|, }
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|ATF_TC
argument_list|(
name|popcount_basic
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|ATF_TC_HEAD
argument_list|(
argument|popcount_basic
argument_list|,
argument|tc
argument_list|)
end_macro

begin_block
block|{
name|atf_tc_set_md_var
argument_list|(
name|tc
argument_list|,
literal|"descr"
argument_list|,
literal|"Test popcount results"
argument_list|)
expr_stmt|;
name|atf_tc_set_md_var
argument_list|(
name|tc
argument_list|,
literal|"timeout"
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ATF_TC_BODY
argument_list|(
argument|popcount_basic
argument_list|,
argument|tc
argument_list|)
end_macro

begin_block
block|{
name|unsigned
name|int
name|i
decl_stmt|,
name|r
decl_stmt|;
name|popcount_init
argument_list|(
name|atf_tc_get_config_var_wd
argument_list|(
name|tc
argument_list|,
literal|"run_popcount"
argument_list|,
literal|"NO"
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|0xffffffff
condition|;
operator|++
name|i
control|)
block|{
name|r
operator|=
name|byte_count
index|[
name|i
operator|&
literal|255
index|]
operator|+
name|byte_count
index|[
operator|(
name|i
operator|>>
literal|8
operator|)
operator|&
literal|255
index|]
operator|+
name|byte_count
index|[
operator|(
name|i
operator|>>
literal|16
operator|)
operator|&
literal|255
index|]
operator|+
name|byte_count
index|[
operator|(
name|i
operator|>>
literal|24
operator|)
operator|&
literal|255
index|]
expr_stmt|;
name|ATF_CHECK_EQ
argument_list|(
name|r
argument_list|,
name|popcount
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|ATF_CHECK_EQ
argument_list|(
name|popcount
argument_list|(
literal|0xffffffff
argument_list|)
argument_list|,
literal|32
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|ATF_TC
argument_list|(
name|popcountll_basic
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|ATF_TC_HEAD
argument_list|(
argument|popcountll_basic
argument_list|,
argument|tc
argument_list|)
end_macro

begin_block
block|{
name|atf_tc_set_md_var
argument_list|(
name|tc
argument_list|,
literal|"descr"
argument_list|,
literal|"Test popcountll results"
argument_list|)
expr_stmt|;
name|atf_tc_set_md_var
argument_list|(
name|tc
argument_list|,
literal|"timeout"
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ATF_TC_BODY
argument_list|(
argument|popcountll_basic
argument_list|,
argument|tc
argument_list|)
end_macro

begin_block
block|{
name|unsigned
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|r
decl_stmt|,
name|r2
decl_stmt|,
name|p
decl_stmt|;
name|unsigned
name|long
name|long
name|v
decl_stmt|;
name|popcount_init
argument_list|(
name|atf_tc_get_config_var_wd
argument_list|(
name|tc
argument_list|,
literal|"run_popcount"
argument_list|,
literal|"NO"
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|256
condition|;
operator|++
name|j
control|)
block|{
name|p
operator|=
name|test_parts
index|[
name|j
index|]
expr_stmt|;
name|r2
operator|=
name|byte_count
index|[
name|p
operator|&
literal|255
index|]
operator|+
name|byte_count
index|[
operator|(
name|p
operator|>>
literal|8
operator|)
operator|&
literal|255
index|]
operator|+
name|byte_count
index|[
operator|(
name|p
operator|>>
literal|16
operator|)
operator|&
literal|255
index|]
operator|+
name|byte_count
index|[
operator|(
name|p
operator|>>
literal|24
operator|)
operator|&
literal|255
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|0xffffffff
condition|;
operator|++
name|i
control|)
block|{
name|r
operator|=
name|byte_count
index|[
name|i
operator|&
literal|255
index|]
operator|+
name|byte_count
index|[
operator|(
name|i
operator|>>
literal|8
operator|)
operator|&
literal|255
index|]
operator|+
name|byte_count
index|[
operator|(
name|i
operator|>>
literal|16
operator|)
operator|&
literal|255
index|]
operator|+
name|byte_count
index|[
operator|(
name|i
operator|>>
literal|24
operator|)
operator|&
literal|255
index|]
operator|+
name|r2
expr_stmt|;
name|v
operator|=
operator|(
operator|(
operator|(
name|unsigned
name|long
name|long
operator|)
name|i
operator|)
operator|<<
literal|32
operator|)
operator|+
name|p
expr_stmt|;
name|ATF_CHECK_EQ
argument_list|(
name|r
argument_list|,
name|popcountll
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
name|v
operator|=
operator|(
operator|(
operator|(
name|unsigned
name|long
name|long
operator|)
name|p
operator|)
operator|<<
literal|32
operator|)
operator|+
name|i
expr_stmt|;
name|ATF_CHECK_EQ
argument_list|(
name|r
argument_list|,
name|popcountll
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|ATF_CHECK_EQ
argument_list|(
name|popcountll
argument_list|(
literal|0xffffffffffffffffULL
argument_list|)
argument_list|,
literal|64
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ATF_TP_ADD_TCS
argument_list|(
argument|tp
argument_list|)
end_macro

begin_block
block|{
name|ATF_TP_ADD_TC
argument_list|(
name|tp
argument_list|,
name|popcount_basic
argument_list|)
expr_stmt|;
name|ATF_TP_ADD_TC
argument_list|(
name|tp
argument_list|,
name|popcountll_basic
argument_list|)
expr_stmt|;
return|return
name|atf_no_error
argument_list|()
return|;
block|}
end_block

end_unit

