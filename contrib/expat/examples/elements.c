begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* This is simple demonstration of how to use expat. This program    reads an XML document from standard input and writes a line with    the name of each element to standard output indenting child    elements by one tab stop more than their parent element.    It must be used with Expat compiled for UTF-8 output. */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"expat.h"
end_include

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__amigaos__
argument_list|)
operator|&&
name|defined
argument_list|(
name|__USE_INLINE__
argument_list|)
end_if

begin_include
include|#
directive|include
file|<proto/expat.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|XML_LARGE_SIZE
end_ifdef

begin_if
if|#
directive|if
name|defined
argument_list|(
name|XML_USE_MSC_EXTENSIONS
argument_list|)
operator|&&
name|_MSC_VER
operator|<
literal|1400
end_if

begin_define
define|#
directive|define
name|XML_FMT_INT_MOD
value|"I64"
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|XML_FMT_INT_MOD
value|"ll"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|XML_FMT_INT_MOD
value|"l"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|XMLCALL
name|startElement
parameter_list|(
name|void
modifier|*
name|userData
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|atts
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|int
modifier|*
name|depthPtr
init|=
operator|(
name|int
operator|*
operator|)
name|userData
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|*
name|depthPtr
condition|;
name|i
operator|++
control|)
name|putchar
argument_list|(
literal|'\t'
argument_list|)
expr_stmt|;
name|puts
argument_list|(
name|name
argument_list|)
expr_stmt|;
operator|*
name|depthPtr
operator|+=
literal|1
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|XMLCALL
name|endElement
parameter_list|(
name|void
modifier|*
name|userData
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|int
modifier|*
name|depthPtr
init|=
operator|(
name|int
operator|*
operator|)
name|userData
decl_stmt|;
operator|*
name|depthPtr
operator|-=
literal|1
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|char
name|buf
index|[
name|BUFSIZ
index|]
decl_stmt|;
name|XML_Parser
name|parser
init|=
name|XML_ParserCreate
argument_list|(
name|NULL
argument_list|)
decl_stmt|;
name|int
name|done
decl_stmt|;
name|int
name|depth
init|=
literal|0
decl_stmt|;
name|XML_SetUserData
argument_list|(
name|parser
argument_list|,
operator|&
name|depth
argument_list|)
expr_stmt|;
name|XML_SetElementHandler
argument_list|(
name|parser
argument_list|,
name|startElement
argument_list|,
name|endElement
argument_list|)
expr_stmt|;
do|do
block|{
name|int
name|len
init|=
operator|(
name|int
operator|)
name|fread
argument_list|(
name|buf
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|stdin
argument_list|)
decl_stmt|;
name|done
operator|=
name|len
operator|<
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|XML_Parse
argument_list|(
name|parser
argument_list|,
name|buf
argument_list|,
name|len
argument_list|,
name|done
argument_list|)
operator|==
name|XML_STATUS_ERROR
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s at line %"
name|XML_FMT_INT_MOD
literal|"u\n"
argument_list|,
name|XML_ErrorString
argument_list|(
name|XML_GetErrorCode
argument_list|(
name|parser
argument_list|)
argument_list|)
argument_list|,
name|XML_GetCurrentLineNumber
argument_list|(
name|parser
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
block|}
do|while
condition|(
operator|!
name|done
condition|)
do|;
name|XML_ParserFree
argument_list|(
name|parser
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

