begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2004 Apple Inc.  * Copyright (c) 2005 SPARTA, Inc.  * Copyright (c) 2006 Robert N. M. Watson  * Copyright (c) 2006 Martin Voros  * All rights reserved.  *  * This code was developed in part by Robert N. M. Watson, Senior Principal  * Scientist, SPARTA, Inc.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1.  Redistributions of source code must retain the above copyright  *     notice, this list of conditions and the following disclaimer.  * 2.  Redistributions in binary form must reproduce the above copyright  *     notice, this list of conditions and the following disclaimer in the  *     documentation and/or other materials provided with the distribution.  * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of  *     its contributors may be used to endorse or promote products derived  *     from this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR  * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,  * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING  * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  * POSSIBILITY OF SUCH DAMAGE.  *  * $P4: //depot/projects/trustedbsd/openbsm/libbsm/bsm_io.c#55 $  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<config/config.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SYS_ENDIAN_H
end_ifdef

begin_include
include|#
directive|include
file|<sys/endian.h>
end_include

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* !HAVE_SYS_ENDIAN_H */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_MACHINE_ENDIAN_H
end_ifdef

begin_include
include|#
directive|include
file|<machine/endian.h>
end_include

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* !HAVE_MACHINE_ENDIAN_H */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_ENDIAN_H
end_ifdef

begin_include
include|#
directive|include
file|<endian.h>
end_include

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* !HAVE_ENDIAN_H */
end_comment

begin_error
error|#
directive|error
literal|"No supported endian.h"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* !HAVE_ENDIAN_H */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* !HAVE_MACHINE_ENDIAN_H */
end_comment

begin_include
include|#
directive|include
file|<compat/endian.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* !HAVE_SYS_ENDIAN_H */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_FULL_QUEUE_H
end_ifdef

begin_include
include|#
directive|include
file|<sys/queue.h>
end_include

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* !HAVE_FULL_QUEUE_H */
end_comment

begin_include
include|#
directive|include
file|<compat/queue.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* !HAVE_FULL_QUEUE_H */
end_comment

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<bsm/libbsm.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<pwd.h>
end_include

begin_include
include|#
directive|include
file|<grp.h>
end_include

begin_include
include|#
directive|include
file|<bsm/audit_internal.h>
end_include

begin_define
define|#
directive|define
name|READ_TOKEN_BYTES
parameter_list|(
name|buf
parameter_list|,
name|len
parameter_list|,
name|dest
parameter_list|,
name|size
parameter_list|,
name|bytesread
parameter_list|,
name|err
parameter_list|)
value|do {	\ 	if ((bytesread) + (size)> (u_int32_t)(len)) {			\ 		(err) = 1;						\ 	} else {							\ 		memcpy((dest), (buf) + (bytesread), (size));		\ 		bytesread += size;					\ 	}								\ } while (0)
end_define

begin_define
define|#
directive|define
name|READ_TOKEN_U_CHAR
parameter_list|(
name|buf
parameter_list|,
name|len
parameter_list|,
name|dest
parameter_list|,
name|bytesread
parameter_list|,
name|err
parameter_list|)
value|do {		\ 	if ((bytesread) + sizeof(u_char)<= (u_int32_t)(len)) {		\ 		(dest) = buf[(bytesread)];				\ 		(bytesread) += sizeof(u_char);				\ 	} else								\ 		(err) = 1;						\ } while (0)
end_define

begin_define
define|#
directive|define
name|READ_TOKEN_U_INT16
parameter_list|(
name|buf
parameter_list|,
name|len
parameter_list|,
name|dest
parameter_list|,
name|bytesread
parameter_list|,
name|err
parameter_list|)
value|do {		\ 	if ((bytesread) + sizeof(u_int16_t)<= (u_int32_t)(len)) {	\ 		(dest) = be16dec((buf) + (bytesread));			\ 		(bytesread) += sizeof(u_int16_t);			\ 	} else								\ 		(err) = 1;						\ } while (0)
end_define

begin_define
define|#
directive|define
name|READ_TOKEN_U_INT32
parameter_list|(
name|buf
parameter_list|,
name|len
parameter_list|,
name|dest
parameter_list|,
name|bytesread
parameter_list|,
name|err
parameter_list|)
value|do {		\ 	if ((bytesread) + sizeof(u_int32_t)<= (u_int32_t)(len)) {	\ 		(dest) = be32dec((buf) + (bytesread));			\ 		(bytesread) += sizeof(u_int32_t);			\ 	} else								\ 		(err) = 1; 						\ } while (0)
end_define

begin_define
define|#
directive|define
name|READ_TOKEN_U_INT64
parameter_list|(
name|buf
parameter_list|,
name|len
parameter_list|,
name|dest
parameter_list|,
name|bytesread
parameter_list|,
name|err
parameter_list|)
value|do {		\ 	if ((bytesread) + sizeof(u_int64_t)<= (u_int32_t)(len)) {	\ 		dest = be64dec((buf) + (bytesread));			\ 		(bytesread) += sizeof(u_int64_t);			\ 	} else								\ 		(err) = 1; 						\ } while (0)
end_define

begin_define
define|#
directive|define
name|SET_PTR
parameter_list|(
name|buf
parameter_list|,
name|len
parameter_list|,
name|ptr
parameter_list|,
name|size
parameter_list|,
name|bytesread
parameter_list|,
name|err
parameter_list|)
value|do {		\ 	if ((bytesread) + (size)> (u_int32_t)(len))			\ 		(err) = 1;						\ 	else {								\ 		(ptr) = (buf) + (bytesread);				\ 		(bytesread) += (size);					\ 	}								\ } while (0)
end_define

begin_comment
comment|/*  * XML option.  */
end_comment

begin_define
define|#
directive|define
name|AU_PLAIN
value|0
end_define

begin_define
define|#
directive|define
name|AU_XML
value|1
end_define

begin_comment
comment|/*  * Prints the delimiter string.  */
end_comment

begin_function
specifier|static
name|void
name|print_delim
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
specifier|const
name|char
modifier|*
name|del
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|del
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Prints a single byte in the given format.  */
end_comment

begin_function
specifier|static
name|void
name|print_1_byte
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_char
name|val
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print 2 bytes in the given format.  */
end_comment

begin_function
specifier|static
name|void
name|print_2_bytes
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int16_t
name|val
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Prints 4 bytes in the given format.  */
end_comment

begin_function
specifier|static
name|void
name|print_4_bytes
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int32_t
name|val
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Prints 8 bytes in the given format.  */
end_comment

begin_function
specifier|static
name|void
name|print_8_bytes
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int64_t
name|val
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Prints the given size of data bytes in hex.  */
end_comment

begin_function
specifier|static
name|void
name|print_mem
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_char
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|u_int32_t
name|i
decl_stmt|;
if|if
condition|(
name|len
operator|>
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"0x"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%x"
argument_list|,
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Prints the given data bytes as a string.  */
end_comment

begin_function
specifier|static
name|void
name|print_string
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|u_int32_t
name|i
decl_stmt|;
if|if
condition|(
name|len
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|str
index|[
name|i
index|]
operator|!=
literal|'\0'
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%c"
argument_list|,
name|str
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Prints the beggining of attribute.  */
end_comment

begin_function
specifier|static
name|void
name|open_attr
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s=\""
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Prints the end of attribute.  */
end_comment

begin_function
specifier|static
name|void
name|close_attr
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\" "
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Prints the end of tag.  */
end_comment

begin_function
specifier|static
name|void
name|close_tag
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_char
name|type
parameter_list|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|AUT_HEADER32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|">"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_HEADER32_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|">"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_HEADER64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|">"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_HEADER64_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|">"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_ARG32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_ARG64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_ATTR32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_ATTR64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_EXIT
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_EXEC_ARGS
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</exec_args>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_EXEC_ENV
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</exec_env>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_OTHER_FILE32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</file>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_NEWGROUPS
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</group>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IN_ADDR
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</ip_address>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IN_ADDR_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</ip_address>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IP
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IPC
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IPC_PERM
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IPORT
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</ip_port>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_OPAQUE
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</opaque>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_PATH
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</path>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_PROCESS32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_PROCESS32_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_PROCESS64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_PROCESS64_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_RETURN32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_RETURN64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SEQ
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SOCKET
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SOCKINET32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SOCKUNIX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SUBJECT32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SUBJECT64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SUBJECT32_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SUBJECT64_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_TEXT
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</text>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SOCKET_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_DATA
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</arbitrary>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_ZONENAME
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"/>"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/*  * Prints the token type in either the raw or the default form.  */
end_comment

begin_function
specifier|static
name|void
name|print_tok_type
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_char
name|type
parameter_list|,
specifier|const
name|char
modifier|*
name|tokname
parameter_list|,
name|char
name|raw
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
if|if
condition|(
name|xml
condition|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|AUT_HEADER32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<record "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_HEADER32_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<record "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_HEADER64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<record "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_HEADER64_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<record "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_TRAILER
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</record>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_ARG32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<argument "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_ARG64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<argument "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_ATTR32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<attribute "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_ATTR64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<attribute "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_EXIT
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<exit "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_EXEC_ARGS
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<exec_args>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_EXEC_ENV
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<exec_env>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_OTHER_FILE32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<file "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_NEWGROUPS
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<group>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IN_ADDR
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<ip_address>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IN_ADDR_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<ip_address>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IP
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<ip "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IPC
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<IPC"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IPC_PERM
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<IPC_perm "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_IPORT
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<ip_port>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_OPAQUE
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<opaque>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_PATH
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<path>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_PROCESS32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<process "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_PROCESS32_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<process "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_PROCESS64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<process "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_PROCESS64_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<process "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_RETURN32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<return "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_RETURN64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<return "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SEQ
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<sequence "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SOCKET
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<socket "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SOCKINET32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<old_socket"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SOCKUNIX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<old_socket"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SUBJECT32
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<subject "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SUBJECT64
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<subject "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SUBJECT32_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<subject "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SUBJECT64_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<subject "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_TEXT
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<text>"
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_SOCKET_EX
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<socket "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_DATA
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<arbitrary "
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUT_ZONENAME
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<zone "
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
else|else
block|{
if|if
condition|(
name|raw
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
name|type
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|tokname
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Prints a user value.  */
end_comment

begin_function
specifier|static
name|void
name|print_user
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int32_t
name|usr
parameter_list|,
name|char
name|raw
parameter_list|)
block|{
name|struct
name|passwd
modifier|*
name|pwent
decl_stmt|;
if|if
condition|(
name|raw
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%d"
argument_list|,
name|usr
argument_list|)
expr_stmt|;
else|else
block|{
name|pwent
operator|=
name|getpwuid
argument_list|(
name|usr
argument_list|)
expr_stmt|;
if|if
condition|(
name|pwent
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|pwent
operator|->
name|pw_name
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%d"
argument_list|,
name|usr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Prints a group value.  */
end_comment

begin_function
specifier|static
name|void
name|print_group
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int32_t
name|grp
parameter_list|,
name|char
name|raw
parameter_list|)
block|{
name|struct
name|group
modifier|*
name|grpent
decl_stmt|;
if|if
condition|(
name|raw
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%d"
argument_list|,
name|grp
argument_list|)
expr_stmt|;
else|else
block|{
name|grpent
operator|=
name|getgrgid
argument_list|(
name|grp
argument_list|)
expr_stmt|;
if|if
condition|(
name|grpent
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|grpent
operator|->
name|gr_name
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%d"
argument_list|,
name|grp
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Prints the event from the header token in either the short, default or raw  * form.  */
end_comment

begin_function
specifier|static
name|void
name|print_event
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int16_t
name|ev
parameter_list|,
name|char
name|raw
parameter_list|,
name|char
name|sfrm
parameter_list|)
block|{
name|char
name|event_ent_name
index|[
name|AU_EVENT_NAME_MAX
index|]
decl_stmt|;
name|char
name|event_ent_desc
index|[
name|AU_EVENT_DESC_MAX
index|]
decl_stmt|;
name|struct
name|au_event_ent
name|e
decl_stmt|,
modifier|*
name|ep
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|e
argument_list|,
sizeof|sizeof
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
name|bzero
argument_list|(
name|event_ent_name
argument_list|,
sizeof|sizeof
argument_list|(
name|event_ent_name
argument_list|)
argument_list|)
expr_stmt|;
name|bzero
argument_list|(
name|event_ent_desc
argument_list|,
sizeof|sizeof
argument_list|(
name|event_ent_desc
argument_list|)
argument_list|)
expr_stmt|;
name|e
operator|.
name|ae_name
operator|=
name|event_ent_name
expr_stmt|;
name|e
operator|.
name|ae_desc
operator|=
name|event_ent_desc
expr_stmt|;
name|ep
operator|=
name|getauevnum_r
argument_list|(
operator|&
name|e
argument_list|,
name|ev
argument_list|)
expr_stmt|;
if|if
condition|(
name|ep
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
name|ev
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|raw
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
name|ev
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|sfrm
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|e
operator|.
name|ae_name
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|e
operator|.
name|ae_desc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Prints the event modifier from the header token in either the default or  * raw form.  */
end_comment

begin_function
specifier|static
name|void
name|print_evmod
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int16_t
name|evmod
parameter_list|,
name|char
name|raw
parameter_list|)
block|{
if|if
condition|(
name|raw
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
name|evmod
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
name|evmod
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Prints seconds in the ctime format.  */
end_comment

begin_function
specifier|static
name|void
name|print_sec32
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int32_t
name|sec
parameter_list|,
name|char
name|raw
parameter_list|)
block|{
name|time_t
name|timestamp
decl_stmt|;
name|char
name|timestr
index|[
literal|26
index|]
decl_stmt|;
if|if
condition|(
name|raw
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
name|sec
argument_list|)
expr_stmt|;
else|else
block|{
name|timestamp
operator|=
operator|(
name|time_t
operator|)
name|sec
expr_stmt|;
name|ctime_r
argument_list|(
operator|&
name|timestamp
argument_list|,
name|timestr
argument_list|)
expr_stmt|;
name|timestr
index|[
literal|24
index|]
operator|=
literal|'\0'
expr_stmt|;
comment|/* No new line */
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|timestr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * XXXRW: 64-bit token streams make use of 64-bit time stamps; since we  * assume a 32-bit time_t, we simply truncate for now.  */
end_comment

begin_function
specifier|static
name|void
name|print_sec64
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int64_t
name|sec
parameter_list|,
name|char
name|raw
parameter_list|)
block|{
name|time_t
name|timestamp
decl_stmt|;
name|char
name|timestr
index|[
literal|26
index|]
decl_stmt|;
if|if
condition|(
name|raw
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|u_int32_t
operator|)
name|sec
argument_list|)
expr_stmt|;
else|else
block|{
name|timestamp
operator|=
operator|(
name|time_t
operator|)
name|sec
expr_stmt|;
name|ctime_r
argument_list|(
operator|&
name|timestamp
argument_list|,
name|timestr
argument_list|)
expr_stmt|;
name|timestr
index|[
literal|24
index|]
operator|=
literal|'\0'
expr_stmt|;
comment|/* No new line */
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|timestr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Prints the excess milliseconds.  */
end_comment

begin_function
specifier|static
name|void
name|print_msec32
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int32_t
name|msec
parameter_list|,
name|char
name|raw
parameter_list|)
block|{
if|if
condition|(
name|raw
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
name|msec
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" + %u msec"
argument_list|,
name|msec
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * XXXRW: 64-bit token streams make use of 64-bit time stamps; since we assume  * a 32-bit msec, we simply truncate for now.  */
end_comment

begin_function
specifier|static
name|void
name|print_msec64
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int64_t
name|msec
parameter_list|,
name|char
name|raw
parameter_list|)
block|{
name|msec
operator|&=
literal|0xffffffff
expr_stmt|;
if|if
condition|(
name|raw
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|u_int32_t
operator|)
name|msec
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" + %u msec"
argument_list|,
operator|(
name|u_int32_t
operator|)
name|msec
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Prints a dotted form for the IP address.  */
end_comment

begin_function
specifier|static
name|void
name|print_ip_address
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int32_t
name|ip
parameter_list|)
block|{
name|struct
name|in_addr
name|ipaddr
decl_stmt|;
name|ipaddr
operator|.
name|s_addr
operator|=
name|ip
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|inet_ntoa
argument_list|(
name|ipaddr
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Prints a string value for the given ip address.  */
end_comment

begin_function
specifier|static
name|void
name|print_ip_ex_address
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int32_t
name|type
parameter_list|,
name|u_int32_t
modifier|*
name|ipaddr
parameter_list|)
block|{
name|struct
name|in_addr
name|ipv4
decl_stmt|;
name|struct
name|in6_addr
name|ipv6
decl_stmt|;
name|char
name|dst
index|[
name|INET6_ADDRSTRLEN
index|]
decl_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|AU_IPv4
case|:
name|ipv4
operator|.
name|s_addr
operator|=
call|(
name|in_addr_t
call|)
argument_list|(
name|ipaddr
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|inet_ntop
argument_list|(
name|AF_INET
argument_list|,
operator|&
name|ipv4
argument_list|,
name|dst
argument_list|,
name|INET6_ADDRSTRLEN
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|AU_IPv6
case|:
name|bcopy
argument_list|(
name|ipaddr
argument_list|,
operator|&
name|ipv6
argument_list|,
sizeof|sizeof
argument_list|(
name|ipv6
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|inet_ntop
argument_list|(
name|AF_INET6
argument_list|,
operator|&
name|ipv6
argument_list|,
name|dst
argument_list|,
name|INET6_ADDRSTRLEN
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"invalid"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Prints return value as success or failure.  */
end_comment

begin_function
specifier|static
name|void
name|print_retval
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_char
name|status
parameter_list|,
name|char
name|raw
parameter_list|)
block|{
if|if
condition|(
name|raw
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
name|status
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"success"
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"failure : %s"
argument_list|,
name|strerror
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Prints the exit value.  */
end_comment

begin_function
specifier|static
name|void
name|print_errval
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_int32_t
name|val
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Error %u"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Prints IPC type.  */
end_comment

begin_function
specifier|static
name|void
name|print_ipctype
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_char
name|type
parameter_list|,
name|char
name|raw
parameter_list|)
block|{
if|if
condition|(
name|raw
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
name|type
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|type
operator|==
name|AT_IPC_MSG
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Message IPC"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|type
operator|==
name|AT_IPC_SEM
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Semaphore IPC"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|type
operator|==
name|AT_IPC_SHM
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Shared Memory IPC"
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%u"
argument_list|,
name|type
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print XML header.  */
end_comment

begin_function
name|void
name|au_print_xml_header
parameter_list|(
name|FILE
modifier|*
name|outfp
parameter_list|)
block|{
name|fprintf
argument_list|(
name|outfp
argument_list|,
literal|"<?xml version='1.0' ?>\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|outfp
argument_list|,
literal|"<audit>\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print XML footer.  */
end_comment

begin_function
name|void
name|au_print_xml_footer
parameter_list|(
name|FILE
modifier|*
name|outfp
parameter_list|)
block|{
name|fprintf
argument_list|(
name|outfp
argument_list|,
literal|"</audit>\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * record byte count       4 bytes  * version #               1 byte    [2]  * event type              2 bytes  * event modifier          2 bytes  * seconds of time         4 bytes/8 bytes (32-bit/64-bit value)  * milliseconds of time    4 bytes/8 bytes (32-bit/64-bit value)  */
end_comment

begin_function
specifier|static
name|int
name|fetch_header32_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|size
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|version
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|e_type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|e_mod
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|s
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|ms
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_header32_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"header"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"version"
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|version
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"event"
argument_list|)
expr_stmt|;
name|print_event
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|e_type
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"modifier"
argument_list|)
expr_stmt|;
name|print_evmod
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|e_mod
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"time"
argument_list|)
expr_stmt|;
name|print_sec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|s
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"msec"
argument_list|)
expr_stmt|;
name|print_msec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|ms
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|size
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|version
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_event
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|e_type
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_evmod
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|e_mod
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_sec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|s
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_msec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32
operator|.
name|ms
argument_list|,
name|raw
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * The Solaris specifications for AUE_HEADER32_EX seem to differ a bit  * depending on the bit of the specifications found.  The OpenSolaris source  * code uses a 4-byte address length, followed by some number of bytes of  * address data.  This contrasts with the Solaris audit.log.5 man page, which  * specifies a 1-byte length field.  We use the Solaris 10 definition so that  * we can parse audit trails from that system.  *  * record byte count       4 bytes  * version #               1 byte     [2]  * event type              2 bytes  * event modifier          2 bytes  * address type/length     4 bytes  *   [ Solaris man page: address type/length     1 byte]  * machine address         4 bytes/16 bytes (IPv4/IPv6 address)  * seconds of time         4 bytes/8 bytes  (32/64-bits)  * nanoseconds of time     4 bytes/8 bytes  (32/64-bits)  */
end_comment

begin_function
specifier|static
name|int
name|fetch_header32_ex_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|size
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|version
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|e_type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|e_mod
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|ad_type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|bzero
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|addr
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|ad_type
condition|)
block|{
case|case
name|AU_IPv4
case|:
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|addr
index|[
literal|0
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|addr
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
name|AU_IPv6
case|:
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
break|break;
block|}
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|s
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|ms
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_header32_ex_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"header_ex"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"version"
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|version
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"event"
argument_list|)
expr_stmt|;
name|print_event
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|e_type
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"modifier"
argument_list|)
expr_stmt|;
name|print_evmod
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|e_mod
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"host"
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|ad_type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"time"
argument_list|)
expr_stmt|;
name|print_sec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|s
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"msec"
argument_list|)
expr_stmt|;
name|print_msec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|ms
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|size
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|version
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_event
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|e_type
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_evmod
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|e_mod
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|ad_type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|addr
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_sec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|s
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_msec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr32_ex
operator|.
name|ms
argument_list|,
name|raw
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * record byte count       4 bytes  * event type              2 bytes  * event modifier          2 bytes  * seconds of time         4 bytes/8 bytes (32-bit/64-bit value)  * milliseconds of time    4 bytes/8 bytes (32-bit/64-bit value)  * version #  */
end_comment

begin_function
specifier|static
name|int
name|fetch_header64_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|size
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|version
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|e_type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|e_mod
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|s
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|ms
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_header64_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"header"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"version"
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|version
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"event"
argument_list|)
expr_stmt|;
name|print_event
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|e_type
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"modifier"
argument_list|)
expr_stmt|;
name|print_evmod
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|e_mod
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"time"
argument_list|)
expr_stmt|;
name|print_sec64
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|s
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"msec"
argument_list|)
expr_stmt|;
name|print_msec64
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|ms
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|size
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|version
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_event
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|e_type
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_evmod
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|e_mod
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_sec64
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|s
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_msec64
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64
operator|.
name|ms
argument_list|,
name|raw
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * record byte count       4 bytes  * version #               1 byte     [2]  * event type              2 bytes  * event modifier          2 bytes  * address type/length     4 bytes  *   [ Solaris man page: address type/length     1 byte]  * machine address         4 bytes/16 bytes (IPv4/IPv6 address)  * seconds of time         4 bytes/8 bytes  (32/64-bits)  * nanoseconds of time     4 bytes/8 bytes  (32/64-bits)  *  * XXXAUDIT: See comment by fetch_header32_ex_tok() for details on the  * accuracy of the BSM spec.  */
end_comment

begin_function
specifier|static
name|int
name|fetch_header64_ex_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|size
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|version
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|e_type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|e_mod
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|ad_type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|bzero
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|addr
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|ad_type
condition|)
block|{
case|case
name|AU_IPv4
case|:
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|addr
index|[
literal|0
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|addr
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
name|AU_IPv6
case|:
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
break|break;
block|}
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|s
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|ms
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_header64_ex_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"header_ex"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"version"
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|version
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"event"
argument_list|)
expr_stmt|;
name|print_event
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|e_type
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"modifier"
argument_list|)
expr_stmt|;
name|print_evmod
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|e_mod
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"host"
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|ad_type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"time"
argument_list|)
expr_stmt|;
name|print_sec64
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|s
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"msec"
argument_list|)
expr_stmt|;
name|print_msec64
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|ms
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|size
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|version
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_event
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|e_type
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_evmod
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|e_mod
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|ad_type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|addr
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_sec64
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|s
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_msec64
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|hdr64_ex
operator|.
name|ms
argument_list|,
name|raw
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * trailer magic                        2 bytes  * record size                          4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_trailer_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|trail
operator|.
name|magic
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|trail
operator|.
name|count
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_trailer_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"trailer"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|xml
condition|)
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|trail
operator|.
name|count
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * argument #              1 byte  * argument value          4 bytes/8 bytes (32-bit/64-bit value)  * text length             2 bytes  * text                    N bytes + 1 terminating NULL byte  */
end_comment

begin_function
specifier|static
name|int
name|fetch_arg32_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|no
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|val
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|SET_PTR
argument_list|(
operator|(
name|char
operator|*
operator|)
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|text
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_arg32_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"argument"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"arg-num"
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|no
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"value"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|val
argument_list|,
literal|"0x%x"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"desc"
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|text
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|len
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|no
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|val
argument_list|,
literal|"0x%x"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|text
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg32
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|fetch_arg64_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|no
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|val
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|SET_PTR
argument_list|(
operator|(
name|char
operator|*
operator|)
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|text
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_arg64_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"argument"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"arg-num"
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|no
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"value"
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|val
argument_list|,
literal|"0x%llx"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"desc"
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|text
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|len
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|no
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|val
argument_list|,
literal|"0x%llx"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|text
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arg64
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * how to print            1 byte  * basic unit              1 byte  * unit count              1 byte  * data items              (depends on basic unit)  */
end_comment

begin_function
specifier|static
name|int
name|fetch_arb_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|int
name|datasize
decl_stmt|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|howtopr
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|bu
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
comment|/* 	 * Determine the size of the basic unit. 	 */
switch|switch
condition|(
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|bu
condition|)
block|{
case|case
name|AUR_BYTE
case|:
comment|/* case AUR_CHAR: */
name|datasize
operator|=
name|AUR_BYTE_SIZE
expr_stmt|;
break|break;
case|case
name|AUR_SHORT
case|:
name|datasize
operator|=
name|AUR_SHORT_SIZE
expr_stmt|;
break|break;
case|case
name|AUR_INT32
case|:
comment|/* case AUR_INT: */
name|datasize
operator|=
name|AUR_INT32_SIZE
expr_stmt|;
break|break;
case|case
name|AUR_INT64
case|:
name|datasize
operator|=
name|AUR_INT64_SIZE
expr_stmt|;
break|break;
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|SET_PTR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|data
argument_list|,
name|datasize
operator|*
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_arb_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|char
modifier|*
name|format
decl_stmt|;
name|size_t
name|size
decl_stmt|;
name|int
name|i
decl_stmt|;
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"arbitrary"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|xml
condition|)
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|howtopr
condition|)
block|{
case|case
name|AUP_BINARY
case|:
name|str
operator|=
literal|"binary"
expr_stmt|;
name|format
operator|=
literal|" %c"
expr_stmt|;
break|break;
case|case
name|AUP_OCTAL
case|:
name|str
operator|=
literal|"octal"
expr_stmt|;
name|format
operator|=
literal|" %o"
expr_stmt|;
break|break;
case|case
name|AUP_DECIMAL
case|:
name|str
operator|=
literal|"decimal"
expr_stmt|;
name|format
operator|=
literal|" %d"
expr_stmt|;
break|break;
case|case
name|AUP_HEX
case|:
name|str
operator|=
literal|"hex"
expr_stmt|;
name|format
operator|=
literal|" %x"
expr_stmt|;
break|break;
case|case
name|AUP_STRING
case|:
name|str
operator|=
literal|"string"
expr_stmt|;
name|format
operator|=
literal|"%c"
expr_stmt|;
break|break;
default|default:
return|return;
block|}
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"print"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_string
argument_list|(
name|fp
argument_list|,
name|str
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|bu
condition|)
block|{
case|case
name|AUR_BYTE
case|:
comment|/* case AUR_CHAR: */
name|str
operator|=
literal|"byte"
expr_stmt|;
name|size
operator|=
name|AUR_BYTE_SIZE
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"type"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%zu"
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"count"
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|">"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
operator|*
operator|(
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|data
operator|+
operator|(
name|size
operator|*
name|i
operator|)
operator|)
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_string
argument_list|(
name|fp
argument_list|,
name|str
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
operator|*
operator|(
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|data
operator|+
operator|(
name|size
operator|*
name|i
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|AUR_SHORT
case|:
name|str
operator|=
literal|"short"
expr_stmt|;
name|size
operator|=
name|AUR_SHORT_SIZE
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"type"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%zu"
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"count"
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|">"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
operator|*
operator|(
operator|(
name|u_int16_t
operator|*
operator|)
operator|(
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|data
operator|+
operator|(
name|size
operator|*
name|i
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_string
argument_list|(
name|fp
argument_list|,
name|str
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
operator|*
operator|(
operator|(
name|u_int16_t
operator|*
operator|)
operator|(
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|data
operator|+
operator|(
name|size
operator|*
name|i
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|AUR_INT32
case|:
comment|/* case AUR_INT: */
name|str
operator|=
literal|"int"
expr_stmt|;
name|size
operator|=
name|AUR_INT32_SIZE
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"type"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%zu"
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"count"
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|">"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
operator|*
operator|(
operator|(
name|u_int32_t
operator|*
operator|)
operator|(
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|data
operator|+
operator|(
name|size
operator|*
name|i
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_string
argument_list|(
name|fp
argument_list|,
name|str
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
operator|*
operator|(
operator|(
name|u_int32_t
operator|*
operator|)
operator|(
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|data
operator|+
operator|(
name|size
operator|*
name|i
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|AUR_INT64
case|:
name|str
operator|=
literal|"int64"
expr_stmt|;
name|size
operator|=
name|AUR_INT64_SIZE
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"type"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%zu"
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"count"
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|">"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
operator|*
operator|(
operator|(
name|u_int64_t
operator|*
operator|)
operator|(
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|data
operator|+
operator|(
name|size
operator|*
name|i
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_string
argument_list|(
name|fp
argument_list|,
name|str
argument_list|,
name|strlen
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_1_byte
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|uc
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
name|format
argument_list|,
operator|*
operator|(
operator|(
name|u_int64_t
operator|*
operator|)
operator|(
name|tok
operator|->
name|tt
operator|.
name|arb
operator|.
name|data
operator|+
operator|(
name|size
operator|*
name|i
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
return|return;
block|}
block|}
end_function

begin_comment
comment|/*  * file access mode        4 bytes  * owner user ID           4 bytes  * owner group ID          4 bytes  * file system ID          4 bytes  * node ID                 8 bytes  * device                  4 bytes/8 bytes (32-bit/64-bit)  */
end_comment

begin_function
specifier|static
name|int
name|fetch_attr32_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|mode
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|uid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|gid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|fsid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|nid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|dev
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_attr32_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"attribute"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"mode"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|mode
argument_list|,
literal|"%o"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|uid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|gid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"fsid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|fsid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"nodeid"
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|nid
argument_list|,
literal|"%lld"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"device"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|dev
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|mode
argument_list|,
literal|"%o"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|uid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|gid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|fsid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|nid
argument_list|,
literal|"%lld"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr32
operator|.
name|dev
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * file access mode        4 bytes  * owner user ID           4 bytes  * owner group ID          4 bytes  * file system ID          4 bytes  * node ID                 8 bytes  * device                  4 bytes/8 bytes (32-bit/64-bit)  */
end_comment

begin_function
specifier|static
name|int
name|fetch_attr64_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|mode
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|uid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|gid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|fsid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|nid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|dev
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_attr64_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"attribute"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"mode"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|mode
argument_list|,
literal|"%o"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|uid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|gid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"fsid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|fsid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"nodeid"
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|nid
argument_list|,
literal|"%lld"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"device"
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|dev
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|mode
argument_list|,
literal|"%o"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|uid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|gid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|fsid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|nid
argument_list|,
literal|"%lld"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|attr64
operator|.
name|dev
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * status                  4 bytes  * return value            4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_exit_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|exit
operator|.
name|status
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|exit
operator|.
name|ret
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_exit_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"exit"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"errval"
argument_list|)
expr_stmt|;
name|print_errval
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|exit
operator|.
name|status
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"retval"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|exit
operator|.
name|ret
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_errval
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|exit
operator|.
name|status
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|exit
operator|.
name|ret
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * count                   4 bytes  * text                    count null-terminated string(s)  */
end_comment

begin_function
specifier|static
name|int
name|fetch_execarg_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|u_int32_t
name|i
decl_stmt|;
name|u_char
modifier|*
name|bptr
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|execarg
operator|.
name|count
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|execarg
operator|.
name|count
condition|;
name|i
operator|++
control|)
block|{
name|bptr
operator|=
name|buf
operator|+
name|tok
operator|->
name|len
expr_stmt|;
if|if
condition|(
name|i
operator|<
name|AUDIT_MAX_ARGS
condition|)
name|tok
operator|->
name|tt
operator|.
name|execarg
operator|.
name|text
index|[
name|i
index|]
operator|=
operator|(
name|char
operator|*
operator|)
name|bptr
expr_stmt|;
comment|/* Look for a null terminated string. */
while|while
condition|(
name|bptr
operator|&&
operator|(
operator|*
name|bptr
operator|!=
literal|'\0'
operator|)
condition|)
block|{
if|if
condition|(
operator|++
name|tok
operator|->
name|len
operator|>=
operator|(
name|u_int32_t
operator|)
name|len
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|bptr
operator|=
name|buf
operator|+
name|tok
operator|->
name|len
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|bptr
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|tok
operator|->
name|len
operator|++
expr_stmt|;
comment|/* \0 character */
block|}
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|execarg
operator|.
name|count
operator|>
name|AUDIT_MAX_ARGS
condition|)
name|tok
operator|->
name|tt
operator|.
name|execarg
operator|.
name|count
operator|=
name|AUDIT_MAX_ARGS
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_execarg_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|u_int32_t
name|i
decl_stmt|;
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"exec arg"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|execarg
operator|.
name|count
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|xml
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<arg>"
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|execarg
operator|.
name|text
index|[
name|i
index|]
argument_list|,
name|strlen
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|execarg
operator|.
name|text
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</arg>"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|execarg
operator|.
name|text
index|[
name|i
index|]
argument_list|,
name|strlen
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|execarg
operator|.
name|text
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|xml
condition|)
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * count                   4 bytes  * text                    count null-terminated string(s)  */
end_comment

begin_function
specifier|static
name|int
name|fetch_execenv_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|u_int32_t
name|i
decl_stmt|;
name|u_char
modifier|*
name|bptr
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|execenv
operator|.
name|count
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|execenv
operator|.
name|count
condition|;
name|i
operator|++
control|)
block|{
name|bptr
operator|=
name|buf
operator|+
name|tok
operator|->
name|len
expr_stmt|;
if|if
condition|(
name|i
operator|<
name|AUDIT_MAX_ENV
condition|)
name|tok
operator|->
name|tt
operator|.
name|execenv
operator|.
name|text
index|[
name|i
index|]
operator|=
operator|(
name|char
operator|*
operator|)
name|bptr
expr_stmt|;
comment|/* Look for a null terminated string. */
while|while
condition|(
name|bptr
operator|&&
operator|(
operator|*
name|bptr
operator|!=
literal|'\0'
operator|)
condition|)
block|{
if|if
condition|(
operator|++
name|tok
operator|->
name|len
operator|>=
operator|(
name|u_int32_t
operator|)
name|len
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|bptr
operator|=
name|buf
operator|+
name|tok
operator|->
name|len
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|bptr
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|tok
operator|->
name|len
operator|++
expr_stmt|;
comment|/* \0 character */
block|}
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|execenv
operator|.
name|count
operator|>
name|AUDIT_MAX_ENV
condition|)
name|tok
operator|->
name|tt
operator|.
name|execenv
operator|.
name|count
operator|=
name|AUDIT_MAX_ENV
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_execenv_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|u_int32_t
name|i
decl_stmt|;
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"exec env"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|execenv
operator|.
name|count
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|xml
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<env>"
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|execenv
operator|.
name|text
index|[
name|i
index|]
argument_list|,
name|strlen
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|execenv
operator|.
name|text
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</env>"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|execenv
operator|.
name|text
index|[
name|i
index|]
argument_list|,
name|strlen
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|execenv
operator|.
name|text
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|xml
condition|)
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * seconds of time          4 bytes  * milliseconds of time     4 bytes  * file name len            2 bytes  * file pathname            N bytes + 1 terminating NULL byte  */
end_comment

begin_function
specifier|static
name|int
name|fetch_file_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|s
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|ms
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|SET_PTR
argument_list|(
operator|(
name|char
operator|*
operator|)
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|name
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_file_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"file"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"time"
argument_list|)
expr_stmt|;
name|print_sec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|s
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"msec"
argument_list|)
expr_stmt|;
name|print_msec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|ms
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|">"
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|name
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|len
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_sec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|s
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_msec32
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|ms
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|name
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|file
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * number groups           2 bytes  * group list              count * 4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_newgroups_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|grps
operator|.
name|no
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|grps
operator|.
name|no
condition|;
name|i
operator|++
control|)
block|{
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|grps
operator|.
name|list
index|[
name|i
index|]
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_newgroups_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"group"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tok
operator|->
name|tt
operator|.
name|grps
operator|.
name|no
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|xml
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<gid>"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|grps
operator|.
name|list
index|[
name|i
index|]
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"</gid>"
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|grps
operator|.
name|list
index|[
name|i
index|]
argument_list|,
name|raw
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Internet addr 4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_inaddr_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|inaddr
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_inaddr_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"ip addr"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|inaddr
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|inaddr
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * type 	4 bytes  * address 16 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_inaddr_ex_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|inaddr_ex
operator|.
name|type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|inaddr_ex
operator|.
name|type
operator|==
name|AU_IPv4
condition|)
block|{
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|inaddr_ex
operator|.
name|addr
index|[
literal|0
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|inaddr_ex
operator|.
name|addr
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|inaddr_ex
operator|.
name|type
operator|==
name|AU_IPv6
condition|)
block|{
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|inaddr_ex
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|inaddr_ex
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_inaddr_ex_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"ip addr ex"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|inaddr_ex
operator|.
name|type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|inaddr_ex
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|inaddr_ex
operator|.
name|type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|inaddr_ex
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * ip header     20 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_ip_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|version
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|tos
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|len
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|id
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|offset
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|ttl
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|prot
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|chksm
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|src
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|src
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|dest
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|dest
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_ip_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"ip"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"version"
argument_list|)
expr_stmt|;
name|print_mem
argument_list|(
name|fp
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|version
operator|)
argument_list|,
sizeof|sizeof
argument_list|(
name|u_char
argument_list|)
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"service_type"
argument_list|)
expr_stmt|;
name|print_mem
argument_list|(
name|fp
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|tos
operator|)
argument_list|,
sizeof|sizeof
argument_list|(
name|u_char
argument_list|)
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"len"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|len
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"id"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|id
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"offset"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|offset
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"time_to_live"
argument_list|)
expr_stmt|;
name|print_mem
argument_list|(
name|fp
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|ttl
operator|)
argument_list|,
sizeof|sizeof
argument_list|(
name|u_char
argument_list|)
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"protocol"
argument_list|)
expr_stmt|;
name|print_mem
argument_list|(
name|fp
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|prot
operator|)
argument_list|,
sizeof|sizeof
argument_list|(
name|u_char
argument_list|)
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"cksum"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|chksm
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"src_addr"
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|src
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"dest_addr"
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|dest
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_mem
argument_list|(
name|fp
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|version
operator|)
argument_list|,
sizeof|sizeof
argument_list|(
name|u_char
argument_list|)
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_mem
argument_list|(
name|fp
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|tos
operator|)
argument_list|,
sizeof|sizeof
argument_list|(
name|u_char
argument_list|)
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|len
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|id
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|offset
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_mem
argument_list|(
name|fp
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|ttl
operator|)
argument_list|,
sizeof|sizeof
argument_list|(
name|u_char
argument_list|)
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_mem
argument_list|(
name|fp
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|&
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|prot
operator|)
argument_list|,
sizeof|sizeof
argument_list|(
name|u_char
argument_list|)
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|chksm
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|src
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ip
operator|.
name|dest
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * object ID type       1 byte  * Object ID            4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_ipc_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipc
operator|.
name|type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipc
operator|.
name|id
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_ipc_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"IPC"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"ipc-type"
argument_list|)
expr_stmt|;
name|print_ipctype
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipc
operator|.
name|type
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"ipc-id"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipc
operator|.
name|id
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ipctype
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipc
operator|.
name|type
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipc
operator|.
name|id
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * owner user id        4 bytes  * owner group id       4 bytes  * creator user id      4 bytes  * creator group id     4 bytes  * access mode          4 bytes  * slot seq                     4 bytes  * key                          4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_ipcperm_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|uid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|gid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|puid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|pgid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|mode
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|seq
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|key
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_ipcperm_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"IPC perm"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|uid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|gid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"creator-uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|puid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"creator-gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|pgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"mode"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|mode
argument_list|,
literal|"%o"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"seq"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|seq
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"key"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|key
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|uid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|gid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|puid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|pgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|mode
argument_list|,
literal|"%o"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|seq
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ipcperm
operator|.
name|key
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * port Ip address  2 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_iport_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|iport
operator|.
name|port
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_iport_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"ip port"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|iport
operator|.
name|port
argument_list|)
argument_list|,
literal|"%#x"
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|iport
operator|.
name|port
argument_list|)
argument_list|,
literal|"%#x"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * size                         2 bytes  * data                         size bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_opaque_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|opaque
operator|.
name|size
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|SET_PTR
argument_list|(
operator|(
name|char
operator|*
operator|)
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|opaque
operator|.
name|data
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|opaque
operator|.
name|size
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_opaque_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"opaque"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|print_mem
argument_list|(
name|fp
argument_list|,
operator|(
name|u_char
operator|*
operator|)
name|tok
operator|->
name|tt
operator|.
name|opaque
operator|.
name|data
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|opaque
operator|.
name|size
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|opaque
operator|.
name|size
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_mem
argument_list|(
name|fp
argument_list|,
operator|(
name|u_char
operator|*
operator|)
name|tok
operator|->
name|tt
operator|.
name|opaque
operator|.
name|data
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|opaque
operator|.
name|size
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * size                         2 bytes  * data                         size bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_path_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|path
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|SET_PTR
argument_list|(
operator|(
name|char
operator|*
operator|)
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|path
operator|.
name|path
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|path
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_path_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"path"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|path
operator|.
name|path
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|path
operator|.
name|len
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|path
operator|.
name|path
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|path
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * token ID                     1 byte  * audit ID                     4 bytes  * euid                         4 bytes  * egid                         4 bytes  * ruid                         4 bytes  * rgid                         4 bytes  * pid                          4 bytes  * sessid                       4 bytes  * terminal ID  *   portid             4 bytes  *   machine id         4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_process32_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|auid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|euid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|egid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|ruid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|rgid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|pid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|sid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|tid
operator|.
name|port
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|tid
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|tid
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_process32_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"process"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"audit-uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"ruid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"rgid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"pid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"sid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"tid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * token ID                     1 byte  * audit ID                     4 bytes  * euid                         4 bytes  * egid                         4 bytes  * ruid                         4 bytes  * rgid                         4 bytes  * pid                          4 bytes  * sessid                       4 bytes  * terminal ID  *   portid             8 bytes  *   machine id         4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_process64_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|auid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|euid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|egid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|ruid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|rgid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|pid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|sid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|tid
operator|.
name|port
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|tid
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|tid
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_process64_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"process"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"audit-uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"ruid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"rgid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"pid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"sid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"tid"
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * token ID                1 byte  * audit ID                4 bytes  * effective user ID       4 bytes  * effective group ID      4 bytes  * real user ID            4 bytes  * real group ID           4 bytes  * process ID              4 bytes  * session ID              4 bytes  * terminal ID  *   port ID               4 bytes  *   address type-len      4 bytes  *   machine address      16 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_process32ex_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|auid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|euid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|egid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|ruid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|rgid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|pid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|sid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|type
operator|==
name|AU_IPv4
condition|)
block|{
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|addr
index|[
literal|0
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|addr
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|type
operator|==
name|AU_IPv6
condition|)
block|{
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_process32ex_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"process_ex"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"audit-uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"ruid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"rgid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"pid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"sid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"tid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc32_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * token ID                1 byte  * audit ID                4 bytes  * effective user ID       4 bytes  * effective group ID      4 bytes  * real user ID            4 bytes  * real group ID           4 bytes  * process ID              4 bytes  * session ID              4 bytes  * terminal ID  *   port ID               8 bytes  *   address type-len      4 bytes  *   machine address      16 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_process64ex_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|auid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|euid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|egid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|ruid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|rgid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|pid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|sid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|type
operator|==
name|AU_IPv4
condition|)
block|{
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|addr
index|[
literal|0
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|addr
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|type
operator|==
name|AU_IPv6
condition|)
block|{
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_process64ex_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"process_ex"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"audit-uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"ruid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"rgid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"pid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"sid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"tid"
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|proc64_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * errno                        1 byte  * return value         4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_return32_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret32
operator|.
name|status
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret32
operator|.
name|ret
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_return32_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"return"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"errval"
argument_list|)
expr_stmt|;
name|print_retval
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret32
operator|.
name|status
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"retval"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret32
operator|.
name|ret
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_retval
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret32
operator|.
name|status
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret32
operator|.
name|ret
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|fetch_return64_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_CHAR
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret64
operator|.
name|err
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret64
operator|.
name|val
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_return64_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"return"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"errval"
argument_list|)
expr_stmt|;
name|print_retval
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret64
operator|.
name|err
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"retval"
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret64
operator|.
name|val
argument_list|,
literal|"%lld"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_retval
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret64
operator|.
name|err
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|ret64
operator|.
name|val
argument_list|,
literal|"%lld"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * seq                          4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_seq_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|seq
operator|.
name|seqno
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_seq_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"sequence"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"seq-num"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|seq
operator|.
name|seqno
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|seq
operator|.
name|seqno
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * socket family           2 bytes  * local port              2 bytes  * socket address          4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_sock_inet32_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|sockinet32
operator|.
name|family
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|sockinet32
operator|.
name|port
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|sockinet32
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|sockinet32
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_sock_inet32_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"socket-inet"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"type"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|sockinet32
operator|.
name|family
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"port"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|sockinet32
operator|.
name|port
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"addr"
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|sockinet32
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|sockinet32
operator|.
name|family
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|sockinet32
operator|.
name|port
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|sockinet32
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * socket family           2 bytes  * path                    104 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_sock_unix_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|sockunix
operator|.
name|family
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|sockunix
operator|.
name|path
argument_list|,
literal|104
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_sock_unix_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"socket-unix"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"type"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|sockunix
operator|.
name|family
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"port"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"addr"
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|sockunix
operator|.
name|path
argument_list|,
name|strlen
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|sockunix
operator|.
name|path
argument_list|)
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|sockunix
operator|.
name|family
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|sockunix
operator|.
name|path
argument_list|,
name|strlen
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|sockunix
operator|.
name|path
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * socket type             2 bytes  * local port              2 bytes  * local address           4 bytes  * remote port             2 bytes  * remote address          4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_socket_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|l_port
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|l_addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|l_addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|r_port
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|l_addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|r_addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_socket_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"socket"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"sock_type"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|type
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"lport"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|l_port
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"laddr"
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|l_addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"fport"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|r_port
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"faddr"
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|r_addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|type
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|l_port
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|l_addr
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|r_port
argument_list|)
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket
operator|.
name|r_addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * audit ID                     4 bytes  * euid                         4 bytes  * egid                         4 bytes  * ruid                         4 bytes  * rgid                         4 bytes  * pid                          4 bytes  * sessid                       4 bytes  * terminal ID  *   portid             4 bytes/8 bytes (32-bit/64-bit value)  *   machine id         4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_subject32_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|auid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|euid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|egid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|ruid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|rgid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|pid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|sid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|tid
operator|.
name|port
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|tid
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|tid
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_subject32_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"subject"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"audit-uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"ruid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"rgid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"pid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"sid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"tid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%u "
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * audit ID                     4 bytes  * euid                         4 bytes  * egid                         4 bytes  * ruid                         4 bytes  * rgid                         4 bytes  * pid                          4 bytes  * sessid                       4 bytes  * terminal ID  *   portid             4 bytes/8 bytes (32-bit/64-bit value)  *   machine id         4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_subject64_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|auid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|euid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|egid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|ruid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|rgid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|pid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|sid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|tid
operator|.
name|port
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|tid
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|tid
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_subject64_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"subject"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"audit-uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"ruid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"rgid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"pid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"sid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"tid"
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * audit ID                     4 bytes  * euid                         4 bytes  * egid                         4 bytes  * ruid                         4 bytes  * rgid                         4 bytes  * pid                          4 bytes  * sessid                       4 bytes  * terminal ID  *   portid             4 bytes  *	 type				4 bytes  *   machine id         16 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_subject32ex_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|auid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|euid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|egid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|ruid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|rgid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|pid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|sid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|type
operator|==
name|AU_IPv4
condition|)
block|{
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|addr
index|[
literal|0
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|addr
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|type
operator|==
name|AU_IPv6
condition|)
block|{
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_subject32ex_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"subject_ex"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"audit-uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"ruid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"rgid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"pid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"sid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"tid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj32_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * audit ID                     4 bytes  * euid                         4 bytes  * egid                         4 bytes  * ruid                         4 bytes  * rgid                         4 bytes  * pid                          4 bytes  * sessid                       4 bytes  * terminal ID  *   portid             8 bytes  *   type               4 bytes  *   machine id         16 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_subject64ex_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|auid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|euid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|egid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|ruid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|rgid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|pid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|sid
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT64
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|type
operator|==
name|AU_IPv4
condition|)
block|{
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|addr
index|[
literal|0
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|addr
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|type
operator|==
name|AU_IPv6
condition|)
block|{
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_subject64ex_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"subject_ex"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"audit-uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"uid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"gid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"ruid"
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"rgid"
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"pid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"sid"
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"tid"
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|auid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|euid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|egid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_user
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|ruid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_group
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|rgid
argument_list|,
name|raw
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|pid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|sid
argument_list|,
literal|"%u"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_8_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|port
argument_list|,
literal|"%llu"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_ex_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|type
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|subj64_ex
operator|.
name|tid
operator|.
name|addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * size                         2 bytes  * data                         size bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_text_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|text
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|SET_PTR
argument_list|(
operator|(
name|char
operator|*
operator|)
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|text
operator|.
name|text
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|text
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_text_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"text"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|text
operator|.
name|text
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|text
operator|.
name|len
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|text
operator|.
name|text
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|text
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * socket type             2 bytes  * local port              2 bytes  * address type/length     4 bytes  * local Internet address  4 bytes  * remote port             4 bytes  * address type/length     4 bytes  * remote Internet address 4 bytes  */
end_comment

begin_function
specifier|static
name|int
name|fetch_socketex32_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|l_port
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|l_ad_type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|l_addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|l_addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|r_port
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_U_INT32
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|r_ad_type
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|READ_TOKEN_BYTES
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
operator|&
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|r_addr
argument_list|,
sizeof|sizeof
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|r_addr
argument_list|)
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_socketex32_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"socket"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"sock_type"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|type
argument_list|,
literal|"%#x"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"lport"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|l_port
argument_list|)
argument_list|,
literal|"%#x"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"laddr"
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|l_addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"faddr"
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|r_addr
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"fport"
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|r_port
argument_list|)
argument_list|,
literal|"%#x"
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|type
argument_list|,
literal|"%#x"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_2_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|l_port
argument_list|)
argument_list|,
literal|"%#x"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|l_addr
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_4_bytes
argument_list|(
name|fp
argument_list|,
name|ntohs
argument_list|(
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|r_port
argument_list|)
argument_list|,
literal|"%#x"
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_ip_address
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|socket_ex32
operator|.
name|r_addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|fetch_invalid_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|int
name|recoversize
decl_stmt|;
name|recoversize
operator|=
name|len
operator|-
operator|(
name|tok
operator|->
name|len
operator|+
name|AUDIT_TRAILER_SIZE
operator|)
expr_stmt|;
if|if
condition|(
name|recoversize
operator|<=
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|tok
operator|->
name|tt
operator|.
name|invalid
operator|.
name|length
operator|=
name|recoversize
expr_stmt|;
name|SET_PTR
argument_list|(
operator|(
name|char
operator|*
operator|)
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|invalid
operator|.
name|data
argument_list|,
name|recoversize
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_invalid_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
if|if
condition|(
operator|!
name|xml
condition|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"unknown"
argument_list|,
name|raw
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_mem
argument_list|(
name|fp
argument_list|,
operator|(
name|u_char
operator|*
operator|)
name|tok
operator|->
name|tt
operator|.
name|invalid
operator|.
name|data
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|invalid
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * size                         2 bytes;  * zonename                     size bytes;  */
end_comment

begin_function
specifier|static
name|int
name|fetch_zonename_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|err
init|=
literal|0
decl_stmt|;
name|READ_TOKEN_U_INT16
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|zonename
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|SET_PTR
argument_list|(
operator|(
name|char
operator|*
operator|)
name|buf
argument_list|,
name|len
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|zonename
operator|.
name|zonename
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|zonename
operator|.
name|len
argument_list|,
name|tok
operator|->
name|len
argument_list|,
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_zonename_tok
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|__unused
name|char
name|sfrm
parameter_list|,
name|int
name|xml
parameter_list|)
block|{
name|print_tok_type
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|,
literal|"zone"
argument_list|,
name|raw
argument_list|,
name|xml
argument_list|)
expr_stmt|;
if|if
condition|(
name|xml
condition|)
block|{
name|open_attr
argument_list|(
name|fp
argument_list|,
literal|"name"
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|zonename
operator|.
name|zonename
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|zonename
operator|.
name|len
argument_list|)
expr_stmt|;
name|close_attr
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|close_tag
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|print_delim
argument_list|(
name|fp
argument_list|,
name|del
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|fp
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|zonename
operator|.
name|zonename
argument_list|,
name|tok
operator|->
name|tt
operator|.
name|zonename
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Reads the token beginning at buf into tok.  */
end_comment

begin_function
name|int
name|au_fetch_tok
parameter_list|(
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|u_char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
if|if
condition|(
name|len
operator|<=
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|tok
operator|->
name|len
operator|=
literal|1
expr_stmt|;
name|tok
operator|->
name|data
operator|=
name|buf
expr_stmt|;
name|tok
operator|->
name|id
operator|=
operator|*
name|buf
expr_stmt|;
switch|switch
condition|(
name|tok
operator|->
name|id
condition|)
block|{
case|case
name|AUT_HEADER32
case|:
return|return
operator|(
name|fetch_header32_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_HEADER32_EX
case|:
return|return
operator|(
name|fetch_header32_ex_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_HEADER64
case|:
return|return
operator|(
name|fetch_header64_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_HEADER64_EX
case|:
return|return
operator|(
name|fetch_header64_ex_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_TRAILER
case|:
return|return
operator|(
name|fetch_trailer_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_ARG32
case|:
return|return
operator|(
name|fetch_arg32_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_ARG64
case|:
return|return
operator|(
name|fetch_arg64_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_ATTR32
case|:
return|return
operator|(
name|fetch_attr32_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_ATTR64
case|:
return|return
operator|(
name|fetch_attr64_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_EXIT
case|:
return|return
operator|(
name|fetch_exit_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_EXEC_ARGS
case|:
return|return
operator|(
name|fetch_execarg_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_EXEC_ENV
case|:
return|return
operator|(
name|fetch_execenv_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_OTHER_FILE32
case|:
return|return
operator|(
name|fetch_file_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_NEWGROUPS
case|:
return|return
operator|(
name|fetch_newgroups_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_IN_ADDR
case|:
return|return
operator|(
name|fetch_inaddr_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_IN_ADDR_EX
case|:
return|return
operator|(
name|fetch_inaddr_ex_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_IP
case|:
return|return
operator|(
name|fetch_ip_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_IPC
case|:
return|return
operator|(
name|fetch_ipc_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_IPC_PERM
case|:
return|return
operator|(
name|fetch_ipcperm_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_IPORT
case|:
return|return
operator|(
name|fetch_iport_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_OPAQUE
case|:
return|return
operator|(
name|fetch_opaque_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_PATH
case|:
return|return
operator|(
name|fetch_path_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_PROCESS32
case|:
return|return
operator|(
name|fetch_process32_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_PROCESS32_EX
case|:
return|return
operator|(
name|fetch_process32ex_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_PROCESS64
case|:
return|return
operator|(
name|fetch_process64_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_PROCESS64_EX
case|:
return|return
operator|(
name|fetch_process64ex_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_RETURN32
case|:
return|return
operator|(
name|fetch_return32_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_RETURN64
case|:
return|return
operator|(
name|fetch_return64_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_SEQ
case|:
return|return
operator|(
name|fetch_seq_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_SOCKET
case|:
return|return
operator|(
name|fetch_socket_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_SOCKINET32
case|:
return|return
operator|(
name|fetch_sock_inet32_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_SOCKUNIX
case|:
return|return
operator|(
name|fetch_sock_unix_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_SUBJECT32
case|:
return|return
operator|(
name|fetch_subject32_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_SUBJECT32_EX
case|:
return|return
operator|(
name|fetch_subject32ex_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_SUBJECT64
case|:
return|return
operator|(
name|fetch_subject64_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_SUBJECT64_EX
case|:
return|return
operator|(
name|fetch_subject64ex_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_TEXT
case|:
return|return
operator|(
name|fetch_text_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_SOCKET_EX
case|:
return|return
operator|(
name|fetch_socketex32_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_DATA
case|:
return|return
operator|(
name|fetch_arb_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|AUT_ZONENAME
case|:
return|return
operator|(
name|fetch_zonename_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
default|default:
return|return
operator|(
name|fetch_invalid_tok
argument_list|(
name|tok
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
operator|)
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * 'prints' the token out to outfp.  */
end_comment

begin_function
name|void
name|au_print_tok
parameter_list|(
name|FILE
modifier|*
name|outfp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|char
name|sfrm
parameter_list|)
block|{
switch|switch
condition|(
name|tok
operator|->
name|id
condition|)
block|{
case|case
name|AUT_HEADER32
case|:
name|print_header32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_HEADER32_EX
case|:
name|print_header32_ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_HEADER64
case|:
name|print_header64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_HEADER64_EX
case|:
name|print_header64_ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_TRAILER
case|:
name|print_trailer_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_ARG32
case|:
name|print_arg32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_ARG64
case|:
name|print_arg64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_DATA
case|:
name|print_arb_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_ATTR32
case|:
name|print_attr32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_ATTR64
case|:
name|print_attr64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_EXIT
case|:
name|print_exit_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_EXEC_ARGS
case|:
name|print_execarg_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_EXEC_ENV
case|:
name|print_execenv_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_OTHER_FILE32
case|:
name|print_file_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_NEWGROUPS
case|:
name|print_newgroups_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IN_ADDR
case|:
name|print_inaddr_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IN_ADDR_EX
case|:
name|print_inaddr_ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IP
case|:
name|print_ip_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IPC
case|:
name|print_ipc_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IPC_PERM
case|:
name|print_ipcperm_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IPORT
case|:
name|print_iport_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_OPAQUE
case|:
name|print_opaque_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_PATH
case|:
name|print_path_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_PROCESS32
case|:
name|print_process32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_PROCESS32_EX
case|:
name|print_process32ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_PROCESS64
case|:
name|print_process64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_PROCESS64_EX
case|:
name|print_process64ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_RETURN32
case|:
name|print_return32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_RETURN64
case|:
name|print_return64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SEQ
case|:
name|print_seq_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SOCKET
case|:
name|print_socket_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SOCKINET32
case|:
name|print_sock_inet32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SOCKUNIX
case|:
name|print_sock_unix_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SUBJECT32
case|:
name|print_subject32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SUBJECT64
case|:
name|print_subject64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SUBJECT32_EX
case|:
name|print_subject32ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SUBJECT64_EX
case|:
name|print_subject64ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_TEXT
case|:
name|print_text_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SOCKET_EX
case|:
name|print_socketex32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_ZONENAME
case|:
name|print_zonename_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
return|return;
default|default:
name|print_invalid_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_PLAIN
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * 'prints' the token out to outfp in XML format.  */
end_comment

begin_function
name|void
name|au_print_tok_xml
parameter_list|(
name|FILE
modifier|*
name|outfp
parameter_list|,
name|tokenstr_t
modifier|*
name|tok
parameter_list|,
name|char
modifier|*
name|del
parameter_list|,
name|char
name|raw
parameter_list|,
name|char
name|sfrm
parameter_list|)
block|{
switch|switch
condition|(
name|tok
operator|->
name|id
condition|)
block|{
case|case
name|AUT_HEADER32
case|:
name|print_header32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_HEADER32_EX
case|:
name|print_header32_ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_HEADER64
case|:
name|print_header64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_HEADER64_EX
case|:
name|print_header64_ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_TRAILER
case|:
name|print_trailer_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_ARG32
case|:
name|print_arg32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_ARG64
case|:
name|print_arg64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_DATA
case|:
name|print_arb_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_ATTR32
case|:
name|print_attr32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_ATTR64
case|:
name|print_attr64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_EXIT
case|:
name|print_exit_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_EXEC_ARGS
case|:
name|print_execarg_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_EXEC_ENV
case|:
name|print_execenv_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_OTHER_FILE32
case|:
name|print_file_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_NEWGROUPS
case|:
name|print_newgroups_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IN_ADDR
case|:
name|print_inaddr_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IN_ADDR_EX
case|:
name|print_inaddr_ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IP
case|:
name|print_ip_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IPC
case|:
name|print_ipc_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IPC_PERM
case|:
name|print_ipcperm_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_IPORT
case|:
name|print_iport_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_OPAQUE
case|:
name|print_opaque_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_PATH
case|:
name|print_path_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_PROCESS32
case|:
name|print_process32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_PROCESS32_EX
case|:
name|print_process32ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_PROCESS64
case|:
name|print_process64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_PROCESS64_EX
case|:
name|print_process64ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_RETURN32
case|:
name|print_return32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_RETURN64
case|:
name|print_return64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SEQ
case|:
name|print_seq_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SOCKET
case|:
name|print_socket_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SOCKINET32
case|:
name|print_sock_inet32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SOCKUNIX
case|:
name|print_sock_unix_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SUBJECT32
case|:
name|print_subject32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SUBJECT64
case|:
name|print_subject64_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SUBJECT32_EX
case|:
name|print_subject32ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SUBJECT64_EX
case|:
name|print_subject64ex_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_TEXT
case|:
name|print_text_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_SOCKET_EX
case|:
name|print_socketex32_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
case|case
name|AUT_ZONENAME
case|:
name|print_zonename_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
return|return;
default|default:
name|print_invalid_tok
argument_list|(
name|outfp
argument_list|,
name|tok
argument_list|,
name|del
argument_list|,
name|raw
argument_list|,
name|sfrm
argument_list|,
name|AU_XML
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Read a record from the file pointer, store data in buf memory for buf is  * also allocated in this function and has to be free'd outside this call.  *  * au_read_rec() handles two possibilities: a stand-alone file token, or a  * complete audit record.  *  * XXXRW: Note that if we hit an error, we leave the stream in an unusable  * state, because it will be partly offset into a record.  We should rewind  * or do something more intelligent.  Particularly interesting is the case  * where we perform a partial read of a record from a non-blockable file  * descriptor.  We should return the partial read and continue...?  */
end_comment

begin_function
name|int
name|au_read_rec
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|,
name|u_char
modifier|*
modifier|*
name|buf
parameter_list|)
block|{
name|u_char
modifier|*
name|bptr
decl_stmt|;
name|u_int32_t
name|recsize
decl_stmt|;
name|u_int32_t
name|bytestoread
decl_stmt|;
name|u_char
name|type
decl_stmt|;
name|u_int32_t
name|sec
decl_stmt|,
name|msec
decl_stmt|;
name|u_int16_t
name|filenamelen
decl_stmt|;
name|type
operator|=
name|fgetc
argument_list|(
name|fp
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|AUT_HEADER32
case|:
case|case
name|AUT_HEADER32_EX
case|:
case|case
name|AUT_HEADER64
case|:
case|case
name|AUT_HEADER64_EX
case|:
comment|/* read the record size from the token */
if|if
condition|(
name|fread
argument_list|(
operator|&
name|recsize
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|u_int32_t
argument_list|)
argument_list|,
name|fp
argument_list|)
operator|<
sizeof|sizeof
argument_list|(
name|u_int32_t
argument_list|)
condition|)
block|{
name|errno
operator|=
name|EINVAL
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|recsize
operator|=
name|be32toh
argument_list|(
name|recsize
argument_list|)
expr_stmt|;
comment|/* Check for recsize sanity */
if|if
condition|(
name|recsize
operator|<
operator|(
sizeof|sizeof
argument_list|(
name|u_int32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|u_char
argument_list|)
operator|)
condition|)
block|{
name|errno
operator|=
name|EINVAL
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
operator|*
name|buf
operator|=
name|malloc
argument_list|(
name|recsize
operator|*
sizeof|sizeof
argument_list|(
name|u_char
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|buf
operator|==
name|NULL
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|bptr
operator|=
operator|*
name|buf
expr_stmt|;
name|memset
argument_list|(
name|bptr
argument_list|,
literal|0
argument_list|,
name|recsize
argument_list|)
expr_stmt|;
comment|/* store the token contents already read, back to the buffer*/
operator|*
name|bptr
operator|=
name|type
expr_stmt|;
name|bptr
operator|++
expr_stmt|;
name|be32enc
argument_list|(
name|bptr
argument_list|,
name|recsize
argument_list|)
expr_stmt|;
name|bptr
operator|+=
sizeof|sizeof
argument_list|(
name|u_int32_t
argument_list|)
expr_stmt|;
comment|/* now read remaining record bytes */
name|bytestoread
operator|=
name|recsize
operator|-
operator|(
sizeof|sizeof
argument_list|(
name|u_int32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|u_char
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|fread
argument_list|(
name|bptr
argument_list|,
literal|1
argument_list|,
name|bytestoread
argument_list|,
name|fp
argument_list|)
operator|<
name|bytestoread
condition|)
block|{
name|free
argument_list|(
operator|*
name|buf
argument_list|)
expr_stmt|;
name|errno
operator|=
name|EINVAL
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|AUT_OTHER_FILE32
case|:
comment|/* 		 * The file token is variable-length, as it includes a 		 * pathname.  As a result, we have to read incrementally 		 * until we know the total length, then allocate space and 		 * read the rest. 		 */
if|if
condition|(
name|fread
argument_list|(
operator|&
name|sec
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|sec
argument_list|)
argument_list|,
name|fp
argument_list|)
operator|<
sizeof|sizeof
argument_list|(
name|sec
argument_list|)
condition|)
block|{
name|errno
operator|=
name|EINVAL
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|fread
argument_list|(
operator|&
name|msec
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|msec
argument_list|)
argument_list|,
name|fp
argument_list|)
operator|<
sizeof|sizeof
argument_list|(
name|msec
argument_list|)
condition|)
block|{
name|errno
operator|=
name|EINVAL
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|fread
argument_list|(
operator|&
name|filenamelen
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|filenamelen
argument_list|)
argument_list|,
name|fp
argument_list|)
operator|<
sizeof|sizeof
argument_list|(
name|filenamelen
argument_list|)
condition|)
block|{
name|errno
operator|=
name|EINVAL
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|recsize
operator|=
sizeof|sizeof
argument_list|(
name|type
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|sec
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|msec
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|filenamelen
argument_list|)
operator|+
name|ntohs
argument_list|(
name|filenamelen
argument_list|)
expr_stmt|;
operator|*
name|buf
operator|=
name|malloc
argument_list|(
name|recsize
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|buf
operator|==
name|NULL
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|bptr
operator|=
operator|*
name|buf
expr_stmt|;
name|bcopy
argument_list|(
operator|&
name|type
argument_list|,
name|bptr
argument_list|,
sizeof|sizeof
argument_list|(
name|type
argument_list|)
argument_list|)
expr_stmt|;
name|bptr
operator|+=
sizeof|sizeof
argument_list|(
name|type
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
operator|&
name|sec
argument_list|,
name|bptr
argument_list|,
sizeof|sizeof
argument_list|(
name|sec
argument_list|)
argument_list|)
expr_stmt|;
name|bptr
operator|+=
sizeof|sizeof
argument_list|(
name|sec
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
operator|&
name|msec
argument_list|,
name|bptr
argument_list|,
sizeof|sizeof
argument_list|(
name|msec
argument_list|)
argument_list|)
expr_stmt|;
name|bptr
operator|+=
sizeof|sizeof
argument_list|(
name|msec
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
operator|&
name|filenamelen
argument_list|,
name|bptr
argument_list|,
sizeof|sizeof
argument_list|(
name|filenamelen
argument_list|)
argument_list|)
expr_stmt|;
name|bptr
operator|+=
sizeof|sizeof
argument_list|(
name|filenamelen
argument_list|)
expr_stmt|;
if|if
condition|(
name|fread
argument_list|(
name|bptr
argument_list|,
literal|1
argument_list|,
name|ntohs
argument_list|(
name|filenamelen
argument_list|)
argument_list|,
name|fp
argument_list|)
operator|<
name|ntohs
argument_list|(
name|filenamelen
argument_list|)
condition|)
block|{
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|errno
operator|=
name|EINVAL
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
default|default:
name|errno
operator|=
name|EINVAL
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
name|recsize
operator|)
return|;
block|}
end_function

end_unit

