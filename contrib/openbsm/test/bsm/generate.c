begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2006-2007 Robert N. M. Watson  * Copyright (c) 2008 Apple Inc.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $P4: //depot/projects/trustedbsd/openbsm/test/bsm/generate.c#14 $  */
end_comment

begin_comment
comment|/*  * Generate a series of BSM token samples in the requested directory.  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in_systm.h>
end_include

begin_include
include|#
directive|include
file|<netinet/ip.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_include
include|#
directive|include
file|<bsm/audit_kevents.h>
end_include

begin_include
include|#
directive|include
file|<bsm/libbsm.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<limits.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sysexits.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_decl_stmt
specifier|static
name|int
name|do_records
decl_stmt|,
name|do_tokens
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|usage
parameter_list|(
name|void
parameter_list|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"generate [-rt] path\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EX_USAGE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|open_file
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|char
name|pathname
index|[
name|PATH_MAX
index|]
decl_stmt|;
name|int
name|fd
decl_stmt|;
name|snprintf
argument_list|(
name|pathname
argument_list|,
name|PATH_MAX
argument_list|,
literal|"%s/%s"
argument_list|,
name|directory
argument_list|,
name|name
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|unlink
argument_list|(
name|pathname
argument_list|)
expr_stmt|;
name|fd
operator|=
name|open
argument_list|(
name|pathname
argument_list|,
name|O_WRONLY
operator||
name|O_CREAT
operator||
name|O_EXCL
argument_list|,
literal|0600
argument_list|)
expr_stmt|;
if|if
condition|(
name|fd
operator|<
literal|0
condition|)
name|err
argument_list|(
name|EX_CANTCREAT
argument_list|,
literal|"open: %s"
argument_list|,
name|name
argument_list|)
expr_stmt|;
return|return
operator|(
name|fd
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|write_file
parameter_list|(
name|int
name|fd
parameter_list|,
name|void
modifier|*
name|buffer
parameter_list|,
name|size_t
name|buflen
parameter_list|,
specifier|const
name|char
modifier|*
name|filename
parameter_list|)
block|{
name|ssize_t
name|len
decl_stmt|;
name|len
operator|=
name|write
argument_list|(
name|fd
argument_list|,
name|buffer
argument_list|,
name|buflen
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|<
literal|0
condition|)
name|err
argument_list|(
name|EX_OSERR
argument_list|,
literal|"write_file: %s"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|<
name|buflen
condition|)
name|err
argument_list|(
name|EX_OSERR
argument_list|,
literal|"write_file: short write: %s"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Write a single token to a file.  */
end_comment

begin_function
specifier|static
name|void
name|write_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|filename
parameter_list|,
name|token_t
modifier|*
name|tok
parameter_list|)
block|{
name|u_char
name|buffer
index|[
name|MAX_AUDIT_RECORD_SIZE
index|]
decl_stmt|;
name|size_t
name|buflen
decl_stmt|;
name|int
name|fd
decl_stmt|;
name|buflen
operator|=
name|MAX_AUDIT_RECORD_SIZE
expr_stmt|;
if|if
condition|(
name|au_close_token
argument_list|(
name|tok
argument_list|,
name|buffer
argument_list|,
operator|&
name|buflen
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_close_token"
argument_list|)
expr_stmt|;
name|fd
operator|=
name|open_file
argument_list|(
name|directory
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|write_file
argument_list|(
name|fd
argument_list|,
name|buffer
argument_list|,
name|buflen
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Write a token to a file, wrapped in audit record header and trailer.  */
end_comment

begin_function
specifier|static
name|void
name|write_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|filename
parameter_list|,
name|token_t
modifier|*
name|tok
parameter_list|,
name|short
name|event
parameter_list|)
block|{
name|u_char
name|buffer
index|[
name|MAX_AUDIT_RECORD_SIZE
index|]
decl_stmt|;
name|size_t
name|buflen
decl_stmt|;
name|int
name|au
decl_stmt|,
name|fd
decl_stmt|;
name|au
operator|=
name|au_open
argument_list|()
expr_stmt|;
if|if
condition|(
name|au
operator|<
literal|0
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_open"
argument_list|)
expr_stmt|;
if|if
condition|(
name|au_write
argument_list|(
name|au
argument_list|,
name|tok
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_write"
argument_list|)
expr_stmt|;
name|buflen
operator|=
name|MAX_AUDIT_RECORD_SIZE
expr_stmt|;
if|if
condition|(
name|au_close_buffer
argument_list|(
name|au
argument_list|,
name|event
argument_list|,
name|buffer
argument_list|,
operator|&
name|buflen
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_close_buffer"
argument_list|)
expr_stmt|;
name|fd
operator|=
name|open_file
argument_list|(
name|directory
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|write_file
argument_list|(
name|fd
argument_list|,
name|buffer
argument_list|,
name|buflen
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|struct
name|timeval
name|file_token_timeval
init|=
block|{
literal|0x12345
block|,
literal|0x67890
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_file_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|file_token
decl_stmt|;
name|file_token
operator|=
name|au_to_file
argument_list|(
literal|"test"
argument_list|,
name|file_token_timeval
argument_list|)
expr_stmt|;
if|if
condition|(
name|file_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_file"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|file_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_file_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|file_token
decl_stmt|;
name|file_token
operator|=
name|au_to_file
argument_list|(
literal|"test"
argument_list|,
name|file_token_timeval
argument_list|)
expr_stmt|;
if|if
condition|(
name|file_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_file"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|file_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * AUT_OHEADER  */
end_comment

begin_decl_stmt
specifier|static
name|int
name|trailer_token_len
init|=
literal|0x12345678
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_trailer_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|trailer_token
decl_stmt|;
name|trailer_token
operator|=
name|au_to_trailer
argument_list|(
name|trailer_token_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|trailer_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_trailer"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|trailer_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|int
name|header32_token_len
init|=
literal|0x12345678
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|au_event_t
name|header32_e_type
init|=
name|AUE_OPEN
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|au_emod_t
name|header32_e_mod
init|=
literal|0x4567
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|timeval
name|header32_tm
init|=
block|{
literal|0x12345
block|,
literal|0x67890
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_header32_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|header32_token
decl_stmt|;
name|header32_token
operator|=
name|au_to_header32_tm
argument_list|(
name|header32_token_len
argument_list|,
name|header32_e_type
argument_list|,
name|header32_e_mod
argument_list|,
name|header32_tm
argument_list|)
expr_stmt|;
if|if
condition|(
name|header32_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_header32"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|header32_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * AUT_HEADER32_EX  */
end_comment

begin_decl_stmt
specifier|static
name|char
name|data_token_unit_print
init|=
name|AUP_STRING
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|data_token_unit_type
init|=
name|AUR_CHAR
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|data_token_data
init|=
literal|"SomeData"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|data_token_unit_count
init|=
sizeof|sizeof
argument_list|(
literal|"SomeData"
argument_list|)
operator|+
literal|1
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_data_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|data_token
decl_stmt|;
name|data_token
operator|=
name|au_to_data
argument_list|(
name|data_token_unit_print
argument_list|,
name|data_token_unit_type
argument_list|,
name|data_token_unit_count
argument_list|,
name|data_token_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|data_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_data"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|data_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_data_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|data_token
decl_stmt|;
name|data_token
operator|=
name|au_to_data
argument_list|(
name|data_token_unit_print
argument_list|,
name|data_token_unit_type
argument_list|,
name|data_token_unit_count
argument_list|,
name|data_token_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|data_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_data"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|data_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|char
name|ipc_type
init|=
name|AT_IPC_MSG
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|ipc_id
init|=
literal|0x12345678
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_ipc_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|ipc_token
decl_stmt|;
name|ipc_token
operator|=
name|au_to_ipc
argument_list|(
name|ipc_type
argument_list|,
name|ipc_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|ipc_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_ipc"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|ipc_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_ipc_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|ipc_token
decl_stmt|;
name|ipc_token
operator|=
name|au_to_ipc
argument_list|(
name|ipc_type
argument_list|,
name|ipc_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|ipc_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_ipc"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|ipc_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|char
modifier|*
name|path_token_path
init|=
literal|"/test/this/is/a/test"
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_path_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|path_token
decl_stmt|;
name|path_token
operator|=
name|au_to_path
argument_list|(
name|path_token_path
argument_list|)
expr_stmt|;
if|if
condition|(
name|path_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_path"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|path_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_path_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|path_token
decl_stmt|;
name|path_token
operator|=
name|au_to_path
argument_list|(
name|path_token_path
argument_list|)
expr_stmt|;
if|if
condition|(
name|path_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_path"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|path_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|au_id_t
name|subject32_auid
init|=
literal|0x12345678
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|uid_t
name|subject32_euid
init|=
literal|0x01234567
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|gid_t
name|subject32_egid
init|=
literal|0x23456789
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|uid_t
name|subject32_ruid
init|=
literal|0x98765432
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|gid_t
name|subject32_rgid
init|=
literal|0x09876543
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|pid_t
name|subject32_pid
init|=
literal|0x13243546
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|au_asid_t
name|subject32_sid
init|=
literal|0x97867564
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|au_tid_t
name|subject32_tid
init|=
block|{
literal|0x16593746
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|au_tid_addr_t
name|subject32_tid_addr
init|=
block|{
literal|0x16593746
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_subject32_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|subject32_token
decl_stmt|;
name|subject32_tid
operator|.
name|machine
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|subject32_token
operator|=
name|au_to_subject32
argument_list|(
name|subject32_auid
argument_list|,
name|subject32_euid
argument_list|,
name|subject32_egid
argument_list|,
name|subject32_ruid
argument_list|,
name|subject32_rgid
argument_list|,
name|subject32_pid
argument_list|,
name|subject32_sid
argument_list|,
operator|&
name|subject32_tid
argument_list|)
expr_stmt|;
if|if
condition|(
name|subject32_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_subject32"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|subject32_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_subject32_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|subject32_token
decl_stmt|;
name|subject32_tid
operator|.
name|machine
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|subject32_token
operator|=
name|au_to_subject32
argument_list|(
name|subject32_auid
argument_list|,
name|subject32_euid
argument_list|,
name|subject32_egid
argument_list|,
name|subject32_ruid
argument_list|,
name|subject32_rgid
argument_list|,
name|subject32_pid
argument_list|,
name|subject32_sid
argument_list|,
operator|&
name|subject32_tid
argument_list|)
expr_stmt|;
if|if
condition|(
name|subject32_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_subject32"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|subject32_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_subject32ex_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|,
name|u_int32_t
name|type
parameter_list|)
block|{
name|token_t
modifier|*
name|subject32ex_token
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|strlen
argument_list|(
name|token_filename
argument_list|)
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|AU_IPv6
condition|)
block|{
name|inet_pton
argument_list|(
name|AF_INET6
argument_list|,
literal|"fe80::1"
argument_list|,
name|subject32_tid_addr
operator|.
name|at_addr
argument_list|)
expr_stmt|;
name|subject32_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv6
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|token_filename
argument_list|,
literal|"-IPv6"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|subject32_tid_addr
operator|.
name|at_addr
index|[
literal|0
index|]
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|subject32_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv4
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|token_filename
argument_list|,
literal|"-IPv4"
argument_list|)
expr_stmt|;
block|}
name|subject32ex_token
operator|=
name|au_to_subject32_ex
argument_list|(
name|subject32_auid
argument_list|,
name|subject32_euid
argument_list|,
name|subject32_egid
argument_list|,
name|subject32_ruid
argument_list|,
name|subject32_rgid
argument_list|,
name|subject32_pid
argument_list|,
name|subject32_sid
argument_list|,
operator|&
name|subject32_tid_addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|subject32ex_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_subject32_ex"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|buf
argument_list|,
name|subject32ex_token
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_subject32ex_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|,
name|u_int32_t
name|type
parameter_list|)
block|{
name|token_t
modifier|*
name|subject32ex_token
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|strlen
argument_list|(
name|record_filename
argument_list|)
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|AU_IPv6
condition|)
block|{
name|inet_pton
argument_list|(
name|AF_INET6
argument_list|,
literal|"fe80::1"
argument_list|,
name|subject32_tid_addr
operator|.
name|at_addr
argument_list|)
expr_stmt|;
name|subject32_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv6
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|record_filename
argument_list|,
literal|"-IPv6"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|subject32_tid_addr
operator|.
name|at_addr
index|[
literal|0
index|]
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|subject32_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv4
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|record_filename
argument_list|,
literal|"-IPv4"
argument_list|)
expr_stmt|;
block|}
name|subject32ex_token
operator|=
name|au_to_subject32_ex
argument_list|(
name|subject32_auid
argument_list|,
name|subject32_euid
argument_list|,
name|subject32_egid
argument_list|,
name|subject32_ruid
argument_list|,
name|subject32_rgid
argument_list|,
name|subject32_pid
argument_list|,
name|subject32_sid
argument_list|,
operator|&
name|subject32_tid_addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|subject32ex_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_subject32_ex"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|subject32ex_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|au_id_t
name|process32_auid
init|=
literal|0x12345678
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|uid_t
name|process32_euid
init|=
literal|0x01234567
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|gid_t
name|process32_egid
init|=
literal|0x23456789
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|uid_t
name|process32_ruid
init|=
literal|0x98765432
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|gid_t
name|process32_rgid
init|=
literal|0x09876543
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|pid_t
name|process32_pid
init|=
literal|0x13243546
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|au_asid_t
name|process32_sid
init|=
literal|0x97867564
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|au_tid_t
name|process32_tid
init|=
block|{
literal|0x16593746
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|au_tid_addr_t
name|process32_tid_addr
init|=
block|{
literal|0x16593746
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_process32_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|process32_token
decl_stmt|;
name|process32_tid
operator|.
name|machine
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|process32_token
operator|=
name|au_to_process32
argument_list|(
name|process32_auid
argument_list|,
name|process32_euid
argument_list|,
name|process32_egid
argument_list|,
name|process32_ruid
argument_list|,
name|process32_rgid
argument_list|,
name|process32_pid
argument_list|,
name|process32_sid
argument_list|,
operator|&
name|process32_tid
argument_list|)
expr_stmt|;
if|if
condition|(
name|process32_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_process32"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|process32_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_process32_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|process32_token
decl_stmt|;
name|process32_tid
operator|.
name|machine
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|process32_token
operator|=
name|au_to_process32
argument_list|(
name|process32_auid
argument_list|,
name|process32_euid
argument_list|,
name|process32_egid
argument_list|,
name|process32_ruid
argument_list|,
name|process32_rgid
argument_list|,
name|process32_pid
argument_list|,
name|process32_sid
argument_list|,
operator|&
name|process32_tid
argument_list|)
expr_stmt|;
if|if
condition|(
name|process32_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_ti_process32"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|process32_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_process32ex_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|,
name|u_int32_t
name|type
parameter_list|)
block|{
name|token_t
modifier|*
name|process32ex_token
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|strlen
argument_list|(
name|token_filename
argument_list|)
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|AU_IPv6
condition|)
block|{
name|inet_pton
argument_list|(
name|AF_INET6
argument_list|,
literal|"fe80::1"
argument_list|,
name|process32_tid_addr
operator|.
name|at_addr
argument_list|)
expr_stmt|;
name|process32_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv6
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|token_filename
argument_list|,
literal|"-IPv6"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|process32_tid_addr
operator|.
name|at_addr
index|[
literal|0
index|]
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|process32_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv4
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|token_filename
argument_list|,
literal|"-IPv4"
argument_list|)
expr_stmt|;
block|}
name|process32ex_token
operator|=
name|au_to_process32_ex
argument_list|(
name|process32_auid
argument_list|,
name|process32_euid
argument_list|,
name|process32_egid
argument_list|,
name|process32_ruid
argument_list|,
name|process32_rgid
argument_list|,
name|process32_pid
argument_list|,
name|process32_sid
argument_list|,
operator|&
name|process32_tid_addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|process32ex_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_process32_ex"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|buf
argument_list|,
name|process32ex_token
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_process32ex_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|,
name|u_int32_t
name|type
parameter_list|)
block|{
name|token_t
modifier|*
name|process32ex_token
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|strlen
argument_list|(
name|record_filename
argument_list|)
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|AU_IPv6
condition|)
block|{
name|inet_pton
argument_list|(
name|AF_INET6
argument_list|,
literal|"fe80::1"
argument_list|,
name|process32_tid_addr
operator|.
name|at_addr
argument_list|)
expr_stmt|;
name|process32_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv6
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|record_filename
argument_list|,
literal|"-IPv6"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|process32_tid_addr
operator|.
name|at_addr
index|[
literal|0
index|]
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|process32_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv4
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|record_filename
argument_list|,
literal|"-IPv4"
argument_list|)
expr_stmt|;
block|}
name|process32ex_token
operator|=
name|au_to_process32_ex
argument_list|(
name|process32_auid
argument_list|,
name|process32_euid
argument_list|,
name|process32_egid
argument_list|,
name|process32_ruid
argument_list|,
name|process32_rgid
argument_list|,
name|process32_pid
argument_list|,
name|process32_sid
argument_list|,
operator|&
name|process32_tid_addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|process32ex_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_process32_ex"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|buf
argument_list|,
name|process32ex_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|au_id_t
name|process64_auid
init|=
literal|0x12345678
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|uid_t
name|process64_euid
init|=
literal|0x01234567
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|gid_t
name|process64_egid
init|=
literal|0x23456789
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|uid_t
name|process64_ruid
init|=
literal|0x98765432
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|gid_t
name|process64_rgid
init|=
literal|0x09876543
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|pid_t
name|process64_pid
init|=
literal|0x13243546
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|au_asid_t
name|process64_sid
init|=
literal|0x97867564
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|au_tid_t
name|process64_tid
init|=
block|{
literal|0x16593746
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|au_tid_addr_t
name|process64_tid_addr
init|=
block|{
literal|0x16593746
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_process64_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|process64_token
decl_stmt|;
name|process64_tid
operator|.
name|machine
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|process64_token
operator|=
name|au_to_process64
argument_list|(
name|process64_auid
argument_list|,
name|process64_euid
argument_list|,
name|process64_egid
argument_list|,
name|process64_ruid
argument_list|,
name|process64_rgid
argument_list|,
name|process64_pid
argument_list|,
name|process64_sid
argument_list|,
operator|&
name|process64_tid
argument_list|)
expr_stmt|;
if|if
condition|(
name|process64_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_process64"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|process64_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_process64_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|process64_token
decl_stmt|;
name|process64_tid
operator|.
name|machine
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|process64_token
operator|=
name|au_to_process64
argument_list|(
name|process64_auid
argument_list|,
name|process64_euid
argument_list|,
name|process64_egid
argument_list|,
name|process64_ruid
argument_list|,
name|process64_rgid
argument_list|,
name|process64_pid
argument_list|,
name|process64_sid
argument_list|,
operator|&
name|process64_tid
argument_list|)
expr_stmt|;
if|if
condition|(
name|process64_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_ti_process64"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|process64_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_process64ex_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|,
name|u_int32_t
name|type
parameter_list|)
block|{
name|token_t
modifier|*
name|process64ex_token
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|strlen
argument_list|(
name|token_filename
argument_list|)
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|AU_IPv6
condition|)
block|{
name|inet_pton
argument_list|(
name|AF_INET6
argument_list|,
literal|"fe80::1"
argument_list|,
name|process64_tid_addr
operator|.
name|at_addr
argument_list|)
expr_stmt|;
name|process64_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv6
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|token_filename
argument_list|,
literal|"-IPv6"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|process64_tid_addr
operator|.
name|at_addr
index|[
literal|0
index|]
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|process64_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv4
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|token_filename
argument_list|,
literal|"-IPv4"
argument_list|)
expr_stmt|;
block|}
name|process64ex_token
operator|=
name|au_to_process64_ex
argument_list|(
name|process64_auid
argument_list|,
name|process64_euid
argument_list|,
name|process64_egid
argument_list|,
name|process64_ruid
argument_list|,
name|process64_rgid
argument_list|,
name|process64_pid
argument_list|,
name|process64_sid
argument_list|,
operator|&
name|process64_tid_addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|process64ex_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_process64_ex"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|buf
argument_list|,
name|process64ex_token
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_process64ex_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|,
name|u_int32_t
name|type
parameter_list|)
block|{
name|token_t
modifier|*
name|process64ex_token
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|strlen
argument_list|(
name|record_filename
argument_list|)
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|AU_IPv6
condition|)
block|{
name|inet_pton
argument_list|(
name|AF_INET6
argument_list|,
literal|"fe80::1"
argument_list|,
name|process64_tid_addr
operator|.
name|at_addr
argument_list|)
expr_stmt|;
name|process64_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv6
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|record_filename
argument_list|,
literal|"-IPv6"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|process64_tid_addr
operator|.
name|at_addr
index|[
literal|0
index|]
operator|=
name|inet_addr
argument_list|(
literal|"127.0.0.1"
argument_list|)
expr_stmt|;
name|process64_tid_addr
operator|.
name|at_type
operator|=
name|AU_IPv4
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s%s"
argument_list|,
name|record_filename
argument_list|,
literal|"-IPv4"
argument_list|)
expr_stmt|;
block|}
name|process64ex_token
operator|=
name|au_to_process64_ex
argument_list|(
name|process64_auid
argument_list|,
name|process64_euid
argument_list|,
name|process64_egid
argument_list|,
name|process64_ruid
argument_list|,
name|process64_rgid
argument_list|,
name|process64_pid
argument_list|,
name|process64_sid
argument_list|,
operator|&
name|process64_tid_addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|process64ex_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_process64_ex"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|buf
argument_list|,
name|process64ex_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|char
name|return32_status
init|=
name|EINVAL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|uint32_t
name|return32_ret
init|=
literal|0x12345678
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_return32_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|return32_token
decl_stmt|;
name|return32_token
operator|=
name|au_to_return32
argument_list|(
name|au_errno_to_bsm
argument_list|(
name|return32_status
argument_list|)
argument_list|,
name|return32_ret
argument_list|)
expr_stmt|;
if|if
condition|(
name|return32_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_return32"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|return32_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_return32_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|return32_token
decl_stmt|;
name|return32_token
operator|=
name|au_to_return32
argument_list|(
name|au_errno_to_bsm
argument_list|(
name|return32_status
argument_list|)
argument_list|,
name|return32_ret
argument_list|)
expr_stmt|;
if|if
condition|(
name|return32_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_return32"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|return32_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|char
modifier|*
name|text_token_text
init|=
literal|"This is a test."
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_text_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|text_token
decl_stmt|;
name|text_token
operator|=
name|au_to_text
argument_list|(
name|text_token_text
argument_list|)
expr_stmt|;
if|if
condition|(
name|text_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_text"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|text_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_text_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|text_token
decl_stmt|;
name|text_token
operator|=
name|au_to_text
argument_list|(
name|text_token_text
argument_list|)
expr_stmt|;
if|if
condition|(
name|text_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_text"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|text_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|char
name|opaque_token_data
index|[]
init|=
block|{
literal|0xaa
block|,
literal|0xbb
block|,
literal|0xcc
block|,
literal|0xdd
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|opaque_token_bytes
init|=
sizeof|sizeof
argument_list|(
name|opaque_token_data
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_opaque_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|opaque_token
decl_stmt|;
name|opaque_token
operator|=
name|au_to_opaque
argument_list|(
name|opaque_token_data
argument_list|,
name|opaque_token_bytes
argument_list|)
expr_stmt|;
if|if
condition|(
name|opaque_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_opaque"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|opaque_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_opaque_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|opaque_token
decl_stmt|;
name|opaque_token
operator|=
name|au_to_opaque
argument_list|(
name|opaque_token_data
argument_list|,
name|opaque_token_bytes
argument_list|)
expr_stmt|;
if|if
condition|(
name|opaque_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_opaque"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|opaque_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|struct
name|in_addr
name|in_addr_token_addr
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_in_addr_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|in_addr_token
decl_stmt|;
name|in_addr_token_addr
operator|.
name|s_addr
operator|=
name|inet_addr
argument_list|(
literal|"192.168.100.15"
argument_list|)
expr_stmt|;
name|in_addr_token
operator|=
name|au_to_in_addr
argument_list|(
operator|&
name|in_addr_token_addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|in_addr_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_in_addr"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|in_addr_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_in_addr_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|in_addr_token
decl_stmt|;
name|in_addr_token_addr
operator|.
name|s_addr
operator|=
name|inet_addr
argument_list|(
literal|"192.168.100.15"
argument_list|)
expr_stmt|;
name|in_addr_token
operator|=
name|au_to_in_addr
argument_list|(
operator|&
name|in_addr_token_addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|in_addr_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_in_addr"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|in_addr_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|struct
name|ip
name|ip_token_ip
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|ip_token_ip_v
init|=
literal|4
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|uint16_t
name|ip_token_ip_id
init|=
literal|0x5478
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|ip_token_ip_ttl
init|=
literal|64
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|ip_token_ip_p
init|=
name|IPPROTO_ICMP
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|in_addr
name|ip_token_ip_src
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|in_addr
name|ip_token_ip_dst
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_ip_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|ip_token
decl_stmt|;
name|ip_token_ip_src
operator|.
name|s_addr
operator|=
name|inet_addr
argument_list|(
literal|"192.168.100.155"
argument_list|)
expr_stmt|;
name|ip_token_ip_dst
operator|.
name|s_addr
operator|=
name|inet_addr
argument_list|(
literal|"192.168.110.48"
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ip_token_ip
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ip_token_ip
argument_list|)
argument_list|)
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_v
operator|=
name|ip_token_ip_v
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_len
operator|=
name|htons
argument_list|(
sizeof|sizeof
argument_list|(
name|ip_token_ip
argument_list|)
argument_list|)
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_id
operator|=
name|htons
argument_list|(
name|ip_token_ip_id
argument_list|)
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_ttl
operator|=
name|ip_token_ip_ttl
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_p
operator|=
name|ip_token_ip_p
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_src
operator|=
name|ip_token_ip_src
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_dst
operator|=
name|ip_token_ip_dst
expr_stmt|;
name|ip_token
operator|=
name|au_to_ip
argument_list|(
operator|&
name|ip_token_ip
argument_list|)
expr_stmt|;
if|if
condition|(
name|ip_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_ip"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|ip_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_ip_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|ip_token
decl_stmt|;
name|ip_token_ip_src
operator|.
name|s_addr
operator|=
name|inet_addr
argument_list|(
literal|"192.168.100.155"
argument_list|)
expr_stmt|;
name|ip_token_ip_dst
operator|.
name|s_addr
operator|=
name|inet_addr
argument_list|(
literal|"192.168.110.48"
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ip_token_ip
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ip_token_ip
argument_list|)
argument_list|)
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_v
operator|=
name|ip_token_ip_v
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_len
operator|=
name|htons
argument_list|(
sizeof|sizeof
argument_list|(
name|ip_token_ip
argument_list|)
argument_list|)
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_id
operator|=
name|htons
argument_list|(
name|ip_token_ip_id
argument_list|)
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_ttl
operator|=
name|ip_token_ip_ttl
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_p
operator|=
name|ip_token_ip_p
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_src
operator|=
name|ip_token_ip_src
expr_stmt|;
name|ip_token_ip
operator|.
name|ip_dst
operator|=
name|ip_token_ip_dst
expr_stmt|;
name|ip_token
operator|=
name|au_to_ip
argument_list|(
operator|&
name|ip_token_ip
argument_list|)
expr_stmt|;
if|if
condition|(
name|ip_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_ip"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|ip_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|u_int16_t
name|iport_token_iport
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_iport_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|iport_token
decl_stmt|;
name|iport_token_iport
operator|=
name|htons
argument_list|(
literal|80
argument_list|)
expr_stmt|;
name|iport_token
operator|=
name|au_to_iport
argument_list|(
name|iport_token_iport
argument_list|)
expr_stmt|;
if|if
condition|(
name|iport_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_iport"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|iport_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_iport_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|iport_token
decl_stmt|;
name|iport_token_iport
operator|=
name|htons
argument_list|(
literal|80
argument_list|)
expr_stmt|;
name|iport_token
operator|=
name|au_to_iport
argument_list|(
name|iport_token_iport
argument_list|)
expr_stmt|;
if|if
condition|(
name|iport_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_iport"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|iport_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|char
name|arg32_token_n
init|=
literal|3
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|arg32_token_text
init|=
literal|"test_arg32_token"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|uint32_t
name|arg32_token_v
init|=
literal|0xabcdef00
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_arg32_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|arg32_token
decl_stmt|;
name|arg32_token
operator|=
name|au_to_arg32
argument_list|(
name|arg32_token_n
argument_list|,
name|arg32_token_text
argument_list|,
name|arg32_token_v
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg32_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_arg32"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|arg32_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_arg32_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|arg32_token
decl_stmt|;
name|arg32_token
operator|=
name|au_to_arg32
argument_list|(
name|arg32_token_n
argument_list|,
name|arg32_token_text
argument_list|,
name|arg32_token_v
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg32_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_arg32"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|arg32_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|long
name|seq_audit_count
init|=
literal|0x12345678
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_seq_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|seq_token
decl_stmt|;
name|seq_token
operator|=
name|au_to_seq
argument_list|(
name|seq_audit_count
argument_list|)
expr_stmt|;
if|if
condition|(
name|seq_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_seq"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|seq_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_seq_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|seq_token
decl_stmt|;
name|seq_token
operator|=
name|au_to_seq
argument_list|(
name|seq_audit_count
argument_list|)
expr_stmt|;
if|if
condition|(
name|seq_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_seq"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|seq_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_if
if|#
directive|if
literal|0
end_if

begin_comment
comment|/*  * AUT_ACL  */
end_comment

begin_endif
unit|static void generate_attr_token(const char *directory, const char *token_filename) { 	token_t *attr_token;  }  static void generate_attr_record(const char *directory, const char *record_filename) { 	token_t *attr_token;  }  static void generate_ipc_perm_token(const char *directory, const char *token_filename) { 	token_t *ipc_perm_token;  }  static void generate_ipc_perm_record(const char *directory, const char *record_filename) { 	token_t *ipc_perm_token;  }
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
literal|0
end_if

begin_comment
comment|/*  * AUT_LABEL  */
end_comment

begin_endif
unit|static void generate_groups_token(const char *directory, const char *token_filename) { 	token_t *groups_token;  }  static void generate_groups_record(const char *directory, const char *record_filename) { 	token_t *groups_token;  }
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * AUT_ILABEL  */
end_comment

begin_comment
comment|/*  * AUT_SLABEL  */
end_comment

begin_comment
comment|/*  * AUT_CLEAR  */
end_comment

begin_comment
comment|/*  * AUT_PRIV  */
end_comment

begin_comment
comment|/*  * AUT_UPRIV  */
end_comment

begin_comment
comment|/*  * AUT_LIAISON  */
end_comment

begin_comment
comment|/*  * AUT_NEWGROUPS  */
end_comment

begin_comment
comment|/*  * AUT_EXEC_ARGS  */
end_comment

begin_comment
comment|/*  * AUT_EXEC_ENV  */
end_comment

begin_if
if|#
directive|if
literal|0
end_if

begin_endif
unit|static void generate_attr32_token(const char *directory, const char *token_filename) { 	token_t *attr32_token;  }  static void generate_attr32_record(const char *directory, const char *record_filename) { 	token_t *attr32_token;  }
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|char
modifier|*
name|zonename_sample
init|=
literal|"testzone"
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_zonename_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|zonename_token
decl_stmt|;
name|zonename_token
operator|=
name|au_to_zonename
argument_list|(
name|zonename_sample
argument_list|)
expr_stmt|;
if|if
condition|(
name|zonename_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_zonename"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|zonename_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_zonename_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|zonename_token
decl_stmt|;
name|zonename_token
operator|=
name|au_to_zonename
argument_list|(
name|zonename_sample
argument_list|)
expr_stmt|;
if|if
condition|(
name|zonename_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_zonename"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|zonename_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|u_short
name|socketex_domain
init|=
name|PF_INET
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_short
name|socketex_type
init|=
name|SOCK_STREAM
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|sockaddr_in
name|socketex_laddr
decl_stmt|,
name|socketex_raddr
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|generate_socketex_token
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|token_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|socketex_token
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|socketex_laddr
argument_list|,
sizeof|sizeof
argument_list|(
name|socketex_laddr
argument_list|)
argument_list|)
expr_stmt|;
name|socketex_laddr
operator|.
name|sin_family
operator|=
name|AF_INET
expr_stmt|;
name|socketex_laddr
operator|.
name|sin_len
operator|=
sizeof|sizeof
argument_list|(
name|socketex_laddr
argument_list|)
expr_stmt|;
name|socketex_laddr
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
name|htonl
argument_list|(
name|INADDR_LOOPBACK
argument_list|)
expr_stmt|;
name|bzero
argument_list|(
operator|&
name|socketex_raddr
argument_list|,
sizeof|sizeof
argument_list|(
name|socketex_raddr
argument_list|)
argument_list|)
expr_stmt|;
name|socketex_raddr
operator|.
name|sin_family
operator|=
name|AF_INET
expr_stmt|;
name|socketex_raddr
operator|.
name|sin_len
operator|=
sizeof|sizeof
argument_list|(
name|socketex_raddr
argument_list|)
expr_stmt|;
name|socketex_raddr
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
name|htonl
argument_list|(
name|INADDR_LOOPBACK
argument_list|)
expr_stmt|;
name|socketex_token
operator|=
name|au_to_socket_ex
argument_list|(
name|au_domain_to_bsm
argument_list|(
name|socketex_domain
argument_list|)
argument_list|,
name|au_socket_type_to_bsm
argument_list|(
name|socketex_type
argument_list|)
argument_list|,
operator|(
expr|struct
name|sockaddr
operator|*
operator|)
operator|&
name|socketex_laddr
argument_list|,
operator|(
expr|struct
name|sockaddr
operator|*
operator|)
operator|&
name|socketex_raddr
argument_list|)
expr_stmt|;
if|if
condition|(
name|socketex_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_socket_ex"
argument_list|)
expr_stmt|;
name|write_token
argument_list|(
name|directory
argument_list|,
name|token_filename
argument_list|,
name|socketex_token
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|generate_socketex_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|record_filename
parameter_list|)
block|{
name|token_t
modifier|*
name|socketex_token
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|socketex_laddr
argument_list|,
sizeof|sizeof
argument_list|(
name|socketex_laddr
argument_list|)
argument_list|)
expr_stmt|;
name|socketex_laddr
operator|.
name|sin_family
operator|=
name|AF_INET
expr_stmt|;
name|socketex_laddr
operator|.
name|sin_len
operator|=
sizeof|sizeof
argument_list|(
name|socketex_laddr
argument_list|)
expr_stmt|;
name|socketex_laddr
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
name|htonl
argument_list|(
name|INADDR_LOOPBACK
argument_list|)
expr_stmt|;
name|bzero
argument_list|(
operator|&
name|socketex_raddr
argument_list|,
sizeof|sizeof
argument_list|(
name|socketex_raddr
argument_list|)
argument_list|)
expr_stmt|;
name|socketex_raddr
operator|.
name|sin_family
operator|=
name|AF_INET
expr_stmt|;
name|socketex_raddr
operator|.
name|sin_len
operator|=
sizeof|sizeof
argument_list|(
name|socketex_raddr
argument_list|)
expr_stmt|;
name|socketex_raddr
operator|.
name|sin_addr
operator|.
name|s_addr
operator|=
name|htonl
argument_list|(
name|INADDR_LOOPBACK
argument_list|)
expr_stmt|;
name|socketex_token
operator|=
name|au_to_socket_ex
argument_list|(
name|au_domain_to_bsm
argument_list|(
name|socketex_domain
argument_list|)
argument_list|,
name|au_socket_type_to_bsm
argument_list|(
name|socketex_type
argument_list|)
argument_list|,
operator|(
expr|struct
name|sockaddr
operator|*
operator|)
operator|&
name|socketex_laddr
argument_list|,
operator|(
expr|struct
name|sockaddr
operator|*
operator|)
operator|&
name|socketex_raddr
argument_list|)
expr_stmt|;
if|if
condition|(
name|socketex_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_socket_ex"
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|record_filename
argument_list|,
name|socketex_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Generate a series of error-number specific return tokens in records.  */
end_comment

begin_function
specifier|static
name|void
name|generate_error_record
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|,
specifier|const
name|char
modifier|*
name|filename
parameter_list|,
name|int
name|error
parameter_list|)
block|{
name|char
name|pathname
index|[
name|PATH_MAX
index|]
decl_stmt|;
name|token_t
modifier|*
name|return32_token
decl_stmt|;
name|return32_token
operator|=
name|au_to_return32
argument_list|(
name|au_errno_to_bsm
argument_list|(
name|error
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|return32_token
operator|==
name|NULL
condition|)
name|err
argument_list|(
name|EX_UNAVAILABLE
argument_list|,
literal|"au_to_return32"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|snprintf
argument_list|(
name|pathname
argument_list|,
name|PATH_MAX
argument_list|,
literal|"%s_record"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|write_record
argument_list|(
name|directory
argument_list|,
name|pathname
argument_list|,
name|return32_token
argument_list|,
name|AUE_NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Not all the error numbers, just a few present on all platforms for now.  */
end_comment

begin_struct
specifier|const
struct|struct
block|{
name|int
name|error_number
decl_stmt|;
specifier|const
name|char
modifier|*
name|error_name
decl_stmt|;
block|}
name|error_list
index|[]
init|=
block|{
block|{
name|EPERM
block|,
literal|"EPERM"
block|}
block|,
block|{
name|ENOENT
block|,
literal|"ENOENT"
block|}
block|,
block|{
name|ESRCH
block|,
literal|"ESRCH"
block|}
block|,
block|{
name|EINTR
block|,
literal|"EINTR"
block|}
block|,
block|{
name|EIO
block|,
literal|"EIO"
block|}
block|,
block|{
name|ENXIO
block|,
literal|"ENXIO"
block|}
block|,
block|{
name|E2BIG
block|,
literal|"E2BIG"
block|}
block|,
block|{
name|ENOEXEC
block|,
literal|"ENOEXEC"
block|}
block|,
block|{
name|EBADF
block|,
literal|"EBADF"
block|}
block|,
block|{
name|ECHILD
block|,
literal|"ECHILD"
block|}
block|,
block|{
name|EDEADLK
block|,
literal|"EDEADLK"
block|}
block|,
block|{
name|ENOMEM
block|,
literal|"ENOMEM"
block|}
block|,
block|{
name|EACCES
block|,
literal|"EACCES"
block|}
block|,
block|{
name|EFAULT
block|,
literal|"EFAULT"
block|}
block|,
block|{
name|ENOTBLK
block|,
literal|"ENOTBLK"
block|}
block|,
block|{
name|EBUSY
block|,
literal|"EBUSY"
block|}
block|,
block|{
name|EEXIST
block|,
literal|"EEXIST"
block|}
block|,
block|{
name|EXDEV
block|,
literal|"EXDEV"
block|}
block|,
block|{
name|ENODEV
block|,
literal|"ENODEV"
block|}
block|,
block|{
name|ENOTDIR
block|,
literal|"ENOTDIR"
block|}
block|,
block|{
name|EISDIR
block|,
literal|"EISDIR"
block|}
block|,
block|{
name|EINVAL
block|,
literal|"EINVAL"
block|}
block|,
block|{
name|ENFILE
block|,
literal|"ENFILE"
block|}
block|,
block|{
name|EMFILE
block|,
literal|"EMFILE"
block|}
block|,
block|{
name|ENOTTY
block|,
literal|"ENOTTY"
block|}
block|,
block|{
name|ETXTBSY
block|,
literal|"ETXTBSY"
block|}
block|,
block|{
name|EFBIG
block|,
literal|"EFBIG"
block|}
block|,
block|{
name|ENOSPC
block|,
literal|"ENOSPC"
block|}
block|,
block|{
name|ESPIPE
block|,
literal|"ESPIPE"
block|}
block|,
block|{
name|EROFS
block|,
literal|"EROFS"
block|}
block|,
block|{
name|EMLINK
block|,
literal|"EMLINK"
block|}
block|,
block|{
name|EPIPE
block|,
literal|"EPIPE"
block|}
block|}
struct|;
end_struct

begin_decl_stmt
specifier|const
name|int
name|error_list_count
init|=
sizeof|sizeof
argument_list|(
name|error_list
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|error_list
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|do_error_records
parameter_list|(
specifier|const
name|char
modifier|*
name|directory
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|error_list_count
condition|;
name|i
operator|++
control|)
name|generate_error_record
argument_list|(
name|directory
argument_list|,
name|error_list
index|[
name|i
index|]
operator|.
name|error_name
argument_list|,
name|error_list
index|[
name|i
index|]
operator|.
name|error_number
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|directory
decl_stmt|;
name|int
name|ch
decl_stmt|;
while|while
condition|(
operator|(
name|ch
operator|=
name|getopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"rt"
argument_list|)
operator|)
operator|!=
operator|-
literal|1
condition|)
block|{
switch|switch
condition|(
name|ch
condition|)
block|{
case|case
literal|'r'
case|:
name|do_records
operator|++
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
name|do_tokens
operator|++
expr_stmt|;
break|break;
default|default:
name|usage
argument_list|()
expr_stmt|;
block|}
block|}
name|argc
operator|-=
name|optind
expr_stmt|;
name|argv
operator|+=
name|optind
expr_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
name|usage
argument_list|()
expr_stmt|;
name|directory
operator|=
name|argv
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|mkdir
argument_list|(
name|directory
argument_list|,
literal|0755
argument_list|)
operator|<
literal|0
operator|&&
name|errno
operator|!=
name|EEXIST
condition|)
name|err
argument_list|(
name|EX_OSERR
argument_list|,
literal|"mkdir: %s"
argument_list|,
name|directory
argument_list|)
expr_stmt|;
if|if
condition|(
name|do_tokens
condition|)
block|{
name|generate_file_token
argument_list|(
name|directory
argument_list|,
literal|"file_token"
argument_list|)
expr_stmt|;
name|generate_trailer_token
argument_list|(
name|directory
argument_list|,
literal|"trailer_token"
argument_list|)
expr_stmt|;
name|generate_header32_token
argument_list|(
name|directory
argument_list|,
literal|"header32_token"
argument_list|)
expr_stmt|;
name|generate_data_token
argument_list|(
name|directory
argument_list|,
literal|"data_token"
argument_list|)
expr_stmt|;
name|generate_ipc_token
argument_list|(
name|directory
argument_list|,
literal|"ipc_token"
argument_list|)
expr_stmt|;
name|generate_path_token
argument_list|(
name|directory
argument_list|,
literal|"path_token"
argument_list|)
expr_stmt|;
name|generate_subject32_token
argument_list|(
name|directory
argument_list|,
literal|"subject32_token"
argument_list|)
expr_stmt|;
name|generate_subject32ex_token
argument_list|(
name|directory
argument_list|,
literal|"subject32ex_token"
argument_list|,
name|AU_IPv4
argument_list|)
expr_stmt|;
name|generate_subject32ex_token
argument_list|(
name|directory
argument_list|,
literal|"subject32ex_token"
argument_list|,
name|AU_IPv6
argument_list|)
expr_stmt|;
name|generate_process32_token
argument_list|(
name|directory
argument_list|,
literal|"process32_token"
argument_list|)
expr_stmt|;
name|generate_process32ex_token
argument_list|(
name|directory
argument_list|,
literal|"process32ex_token"
argument_list|,
name|AU_IPv4
argument_list|)
expr_stmt|;
name|generate_process32ex_token
argument_list|(
name|directory
argument_list|,
literal|"process32ex_token"
argument_list|,
name|AU_IPv6
argument_list|)
expr_stmt|;
name|generate_process64_token
argument_list|(
name|directory
argument_list|,
literal|"process64_token"
argument_list|)
expr_stmt|;
name|generate_process64ex_token
argument_list|(
name|directory
argument_list|,
literal|"process64ex_token"
argument_list|,
name|AU_IPv4
argument_list|)
expr_stmt|;
name|generate_process64ex_token
argument_list|(
name|directory
argument_list|,
literal|"process64ex_token"
argument_list|,
name|AU_IPv6
argument_list|)
expr_stmt|;
name|generate_return32_token
argument_list|(
name|directory
argument_list|,
literal|"return32_token"
argument_list|)
expr_stmt|;
name|generate_text_token
argument_list|(
name|directory
argument_list|,
literal|"text_token"
argument_list|)
expr_stmt|;
name|generate_opaque_token
argument_list|(
name|directory
argument_list|,
literal|"opaque_token"
argument_list|)
expr_stmt|;
name|generate_in_addr_token
argument_list|(
name|directory
argument_list|,
literal|"in_addr_token"
argument_list|)
expr_stmt|;
name|generate_ip_token
argument_list|(
name|directory
argument_list|,
literal|"ip_token"
argument_list|)
expr_stmt|;
name|generate_iport_token
argument_list|(
name|directory
argument_list|,
literal|"iport_token"
argument_list|)
expr_stmt|;
name|generate_arg32_token
argument_list|(
name|directory
argument_list|,
literal|"arg32_token"
argument_list|)
expr_stmt|;
name|generate_seq_token
argument_list|(
name|directory
argument_list|,
literal|"seq_token"
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|generate_attr_token(directory,  "attr_token"); 		generate_ipc_perm_token(directory, "ipc_perm_token"); 		generate_groups_token(directory, "groups_token"); 		generate_attr32_token(directory, "attr32_token");
endif|#
directive|endif
name|generate_zonename_token
argument_list|(
name|directory
argument_list|,
literal|"zonename_token"
argument_list|)
expr_stmt|;
name|generate_socketex_token
argument_list|(
name|directory
argument_list|,
literal|"socketex_token"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|do_records
condition|)
block|{
name|generate_file_record
argument_list|(
name|directory
argument_list|,
literal|"file_record"
argument_list|)
expr_stmt|;
name|generate_data_record
argument_list|(
name|directory
argument_list|,
literal|"data_record"
argument_list|)
expr_stmt|;
name|generate_ipc_record
argument_list|(
name|directory
argument_list|,
literal|"ipc_record"
argument_list|)
expr_stmt|;
name|generate_path_record
argument_list|(
name|directory
argument_list|,
literal|"path_record"
argument_list|)
expr_stmt|;
name|generate_subject32_record
argument_list|(
name|directory
argument_list|,
literal|"subject32_record"
argument_list|)
expr_stmt|;
name|generate_subject32ex_record
argument_list|(
name|directory
argument_list|,
literal|"subject32ex_record"
argument_list|,
name|AU_IPv4
argument_list|)
expr_stmt|;
name|generate_subject32ex_record
argument_list|(
name|directory
argument_list|,
literal|"subject32ex_record"
argument_list|,
name|AU_IPv6
argument_list|)
expr_stmt|;
name|generate_process32_record
argument_list|(
name|directory
argument_list|,
literal|"process32_record"
argument_list|)
expr_stmt|;
name|generate_process32ex_record
argument_list|(
name|directory
argument_list|,
literal|"process32ex_record"
argument_list|,
name|AU_IPv4
argument_list|)
expr_stmt|;
name|generate_process32ex_record
argument_list|(
name|directory
argument_list|,
literal|"process32ex_record"
argument_list|,
name|AU_IPv6
argument_list|)
expr_stmt|;
name|generate_process64_record
argument_list|(
name|directory
argument_list|,
literal|"process64_record"
argument_list|)
expr_stmt|;
name|generate_process64ex_record
argument_list|(
name|directory
argument_list|,
literal|"process64ex_record"
argument_list|,
name|AU_IPv4
argument_list|)
expr_stmt|;
name|generate_process64ex_record
argument_list|(
name|directory
argument_list|,
literal|"process64ex_record"
argument_list|,
name|AU_IPv6
argument_list|)
expr_stmt|;
name|generate_return32_record
argument_list|(
name|directory
argument_list|,
literal|"return32_record"
argument_list|)
expr_stmt|;
name|generate_text_record
argument_list|(
name|directory
argument_list|,
literal|"text_record"
argument_list|)
expr_stmt|;
name|generate_opaque_record
argument_list|(
name|directory
argument_list|,
literal|"opaque_record"
argument_list|)
expr_stmt|;
name|generate_in_addr_record
argument_list|(
name|directory
argument_list|,
literal|"in_addr_record"
argument_list|)
expr_stmt|;
name|generate_ip_record
argument_list|(
name|directory
argument_list|,
literal|"ip_record"
argument_list|)
expr_stmt|;
name|generate_iport_record
argument_list|(
name|directory
argument_list|,
literal|"iport_record"
argument_list|)
expr_stmt|;
name|generate_arg32_record
argument_list|(
name|directory
argument_list|,
literal|"arg32_record"
argument_list|)
expr_stmt|;
name|generate_seq_record
argument_list|(
name|directory
argument_list|,
literal|"seq_record"
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|generate_attr_record(directory,  "attr_record"); 		generate_ipc_perm_record(directory, "ipc_perm_record"); 		generate_groups_record(directory, "groups_record"); 		generate_attr32_record(directory, "attr32_record");
endif|#
directive|endif
name|generate_zonename_record
argument_list|(
name|directory
argument_list|,
literal|"zonename_record"
argument_list|)
expr_stmt|;
name|generate_socketex_record
argument_list|(
name|directory
argument_list|,
literal|"socketex_record"
argument_list|)
expr_stmt|;
name|do_error_records
argument_list|(
name|directory
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

end_unit

