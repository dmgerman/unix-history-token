begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Coff file dumper.    Copyright (C) 1994 Free Software Foundation, Inc.  This file is part of GNU Binutils.  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/* Written by Steve Chamberlain<sac@cygnus.com>     This module reads a type tree generated by coffgrok and prints    it out so we can test the grokker. */
end_comment

begin_include
include|#
directive|include
file|<bfd.h>
end_include

begin_include
include|#
directive|include
file|<getopt.h>
end_include

begin_include
include|#
directive|include
file|<libiberty.h>
end_include

begin_include
include|#
directive|include
file|"coffgrok.h"
end_include

begin_include
include|#
directive|include
file|"bucomm.h"
end_include

begin_define
define|#
directive|define
name|PROGRAM_VERSION
value|"1.0"
end_define

begin_function
name|char
modifier|*
name|xcalloc
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
name|int
name|a
decl_stmt|;
name|int
name|b
decl_stmt|;
block|{
name|char
modifier|*
name|r
init|=
name|xmalloc
argument_list|(
name|a
operator|*
name|b
argument_list|)
decl_stmt|;
name|memset
argument_list|(
name|r
argument_list|,
literal|0
argument_list|,
name|a
operator|*
name|b
argument_list|)
expr_stmt|;
return|return
name|r
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|int
name|atnl
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|dump_coff_scope
parameter_list|()
function_decl|;
end_function_decl

begin_function
specifier|static
name|void
name|tab
parameter_list|(
name|x
parameter_list|)
name|int
name|x
decl_stmt|;
block|{
specifier|static
name|int
name|indent
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|atnl
condition|)
block|{
if|if
condition|(
name|x
operator|<
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|indent
operator|+=
name|x
expr_stmt|;
return|return;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|atnl
operator|=
literal|0
expr_stmt|;
block|}
block|}
if|if
condition|(
name|x
operator|==
operator|-
literal|1
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|indent
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"   "
argument_list|)
expr_stmt|;
name|indent
operator|+=
name|x
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
return|return;
block|}
name|indent
operator|+=
name|x
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|indent
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"   "
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
condition|)
block|{
name|printf
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|nl
parameter_list|()
block|{
name|atnl
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_coff_lines
parameter_list|(
name|p
parameter_list|)
name|struct
name|coff_line
modifier|*
name|p
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|int
name|online
init|=
literal|0
decl_stmt|;
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#lines %d "
argument_list|,
name|p
operator|->
name|nlines
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p
operator|->
name|nlines
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"(%d 0x%x)"
argument_list|,
name|p
operator|->
name|lines
index|[
name|i
index|]
argument_list|,
name|p
operator|->
name|addresses
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|online
operator|++
expr_stmt|;
if|if
condition|(
name|online
operator|>
literal|6
condition|)
block|{
name|nl
argument_list|()
expr_stmt|;
name|tab
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|online
operator|=
literal|0
expr_stmt|;
block|}
block|}
name|nl
argument_list|()
expr_stmt|;
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_coff_type
parameter_list|(
name|p
parameter_list|)
name|struct
name|coff_type
modifier|*
name|p
decl_stmt|;
block|{
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"size %d "
argument_list|,
name|p
operator|->
name|size
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|p
operator|->
name|type
condition|)
block|{
case|case
name|coff_secdef_type
case|:
name|printf
argument_list|(
literal|"section definition at %x size %x\n"
argument_list|,
name|p
operator|->
name|u
operator|.
name|asecdef
operator|.
name|address
argument_list|,
name|p
operator|->
name|u
operator|.
name|asecdef
operator|.
name|size
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
break|break;
case|case
name|coff_pointer_type
case|:
name|printf
argument_list|(
literal|"pointer to"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_type
argument_list|(
name|p
operator|->
name|u
operator|.
name|pointer
operator|.
name|points_to
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_array_type
case|:
name|printf
argument_list|(
literal|"array [%d] of"
argument_list|,
name|p
operator|->
name|u
operator|.
name|array
operator|.
name|dim
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_type
argument_list|(
name|p
operator|->
name|u
operator|.
name|array
operator|.
name|array_of
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_function_type
case|:
name|printf
argument_list|(
literal|"function returning"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_type
argument_list|(
name|p
operator|->
name|u
operator|.
name|function
operator|.
name|function_returns
argument_list|)
expr_stmt|;
name|dump_coff_lines
argument_list|(
name|p
operator|->
name|u
operator|.
name|function
operator|.
name|lines
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"arguments"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_scope
argument_list|(
name|p
operator|->
name|u
operator|.
name|function
operator|.
name|parameters
argument_list|)
expr_stmt|;
name|tab
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"code"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_scope
argument_list|(
name|p
operator|->
name|u
operator|.
name|function
operator|.
name|code
argument_list|)
expr_stmt|;
name|tab
argument_list|(
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_structdef_type
case|:
name|printf
argument_list|(
literal|"structure definition"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_scope
argument_list|(
name|p
operator|->
name|u
operator|.
name|astructdef
operator|.
name|elements
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_structref_type
case|:
if|if
condition|(
operator|!
name|p
operator|->
name|u
operator|.
name|aenumref
operator|.
name|ref
condition|)
name|printf
argument_list|(
literal|"structure ref to UNKNOWN struct"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"structure ref to %s"
argument_list|,
name|p
operator|->
name|u
operator|.
name|aenumref
operator|.
name|ref
operator|->
name|name
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_enumref_type
case|:
name|printf
argument_list|(
literal|"enum ref to %s"
argument_list|,
name|p
operator|->
name|u
operator|.
name|astructref
operator|.
name|ref
operator|->
name|name
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_enumdef_type
case|:
name|printf
argument_list|(
literal|"enum definition"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_scope
argument_list|(
name|p
operator|->
name|u
operator|.
name|aenumdef
operator|.
name|elements
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_basic_type
case|:
switch|switch
condition|(
name|p
operator|->
name|u
operator|.
name|basic
condition|)
block|{
case|case
name|T_NULL
case|:
name|printf
argument_list|(
literal|"NULL"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_VOID
case|:
name|printf
argument_list|(
literal|"VOID"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_CHAR
case|:
name|printf
argument_list|(
literal|"CHAR"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_SHORT
case|:
name|printf
argument_list|(
literal|"SHORT"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_INT
case|:
name|printf
argument_list|(
literal|"INT "
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_LONG
case|:
name|printf
argument_list|(
literal|"LONG"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_FLOAT
case|:
name|printf
argument_list|(
literal|"FLOAT"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_DOUBLE
case|:
name|printf
argument_list|(
literal|"DOUBLE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_STRUCT
case|:
name|printf
argument_list|(
literal|"STRUCT"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_UNION
case|:
name|printf
argument_list|(
literal|"UNION"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_ENUM
case|:
name|printf
argument_list|(
literal|"ENUM"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_MOE
case|:
name|printf
argument_list|(
literal|"MOE "
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_UCHAR
case|:
name|printf
argument_list|(
literal|"UCHAR"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_USHORT
case|:
name|printf
argument_list|(
literal|"USHORT"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_UINT
case|:
name|printf
argument_list|(
literal|"UINT"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_ULONG
case|:
name|printf
argument_list|(
literal|"ULONG"
argument_list|)
expr_stmt|;
break|break;
case|case
name|T_LNGDBL
case|:
name|printf
argument_list|(
literal|"LNGDBL"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
block|}
name|nl
argument_list|()
expr_stmt|;
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_coff_where
parameter_list|(
name|p
parameter_list|)
name|struct
name|coff_where
modifier|*
name|p
decl_stmt|;
block|{
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|p
operator|->
name|where
condition|)
block|{
case|case
name|coff_where_stack
case|:
name|printf
argument_list|(
literal|"Stack offset %x"
argument_list|,
name|p
operator|->
name|offset
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_where_memory
case|:
name|printf
argument_list|(
literal|"Memory section %s+%x"
argument_list|,
name|p
operator|->
name|section
operator|->
name|name
argument_list|,
name|p
operator|->
name|offset
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_where_register
case|:
name|printf
argument_list|(
literal|"Register %d"
argument_list|,
name|p
operator|->
name|offset
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_where_member_of_struct
case|:
name|printf
argument_list|(
literal|"Struct Member offset %x"
argument_list|,
name|p
operator|->
name|offset
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_where_member_of_enum
case|:
name|printf
argument_list|(
literal|"Enum Member offset %x"
argument_list|,
name|p
operator|->
name|offset
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_where_unknown
case|:
name|printf
argument_list|(
literal|"Undefined symbol"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_where_strtag
case|:
name|printf
argument_list|(
literal|"STRTAG"
argument_list|)
expr_stmt|;
case|case
name|coff_where_entag
case|:
name|printf
argument_list|(
literal|"ENTAG"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_where_typedef
case|:
name|printf
argument_list|(
literal|"TYPEDEF"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
name|nl
argument_list|()
expr_stmt|;
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_coff_visible
parameter_list|(
name|p
parameter_list|)
name|struct
name|coff_visible
modifier|*
name|p
decl_stmt|;
block|{
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|p
operator|->
name|type
condition|)
block|{
case|case
name|coff_vis_ext_def
case|:
name|printf
argument_list|(
literal|"coff_vis_ext_def"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_vis_ext_ref
case|:
name|printf
argument_list|(
literal|"coff_vis_ext_ref"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_vis_int_def
case|:
name|printf
argument_list|(
literal|"coff_vis_int_def"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_vis_common
case|:
name|printf
argument_list|(
literal|"coff_vis_common"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_vis_auto
case|:
name|printf
argument_list|(
literal|"coff_vis_auto"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_vis_autoparam
case|:
name|printf
argument_list|(
literal|"coff_vis_autoparam"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_vis_regparam
case|:
name|printf
argument_list|(
literal|"coff_vis_regparam"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_vis_register
case|:
name|printf
argument_list|(
literal|"coff_vis_register"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_vis_tag
case|:
name|printf
argument_list|(
literal|"coff_vis_tag"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_vis_member_of_struct
case|:
name|printf
argument_list|(
literal|"coff_vis_member_of_struct"
argument_list|)
expr_stmt|;
break|break;
case|case
name|coff_vis_member_of_enum
case|:
name|printf
argument_list|(
literal|"coff_vis_member_of_enum"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
name|nl
argument_list|()
expr_stmt|;
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|dump_coff_symbol
parameter_list|(
name|p
parameter_list|)
name|struct
name|coff_symbol
modifier|*
name|p
decl_stmt|;
block|{
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"List of symbols"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
while|while
condition|(
name|p
condition|)
block|{
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Symbol  %s, tag %d, number %d"
argument_list|,
name|p
operator|->
name|name
argument_list|,
name|p
operator|->
name|tag
argument_list|,
name|p
operator|->
name|number
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Type"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_type
argument_list|(
name|p
operator|->
name|type
argument_list|)
expr_stmt|;
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Where"
argument_list|)
expr_stmt|;
name|dump_coff_where
argument_list|(
name|p
operator|->
name|where
argument_list|)
expr_stmt|;
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Visible"
argument_list|)
expr_stmt|;
name|dump_coff_visible
argument_list|(
name|p
operator|->
name|visible
argument_list|)
expr_stmt|;
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|p
operator|=
name|p
operator|->
name|next
expr_stmt|;
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_coff_scope
parameter_list|(
name|p
parameter_list|)
name|struct
name|coff_scope
modifier|*
name|p
decl_stmt|;
block|{
if|if
condition|(
name|p
condition|)
block|{
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"List of blocks %lx "
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|->
name|sec
condition|)
block|{
name|printf
argument_list|(
literal|"  %s %x..%x"
argument_list|,
name|p
operator|->
name|sec
operator|->
name|name
argument_list|,
name|p
operator|->
name|offset
argument_list|,
name|p
operator|->
name|offset
operator|+
name|p
operator|->
name|size
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|nl
argument_list|()
expr_stmt|;
name|tab
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"*****************"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
while|while
condition|(
name|p
condition|)
block|{
name|tab
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"vars %d"
argument_list|,
name|p
operator|->
name|nvars
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_symbol
argument_list|(
name|p
operator|->
name|vars_head
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"blocks"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_scope
argument_list|(
name|p
operator|->
name|list_head
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|p
operator|=
name|p
operator|->
name|next
expr_stmt|;
block|}
name|tab
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"*****************"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|dump_coff_sfile
parameter_list|(
name|p
parameter_list|)
name|struct
name|coff_sfile
modifier|*
name|p
decl_stmt|;
block|{
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"List of source files"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
while|while
condition|(
name|p
condition|)
block|{
name|tab
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Source file %s"
argument_list|,
name|p
operator|->
name|name
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_scope
argument_list|(
name|p
operator|->
name|scope
argument_list|)
expr_stmt|;
name|p
operator|=
name|p
operator|->
name|next
expr_stmt|;
block|}
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_coff_section
parameter_list|(
name|ptr
parameter_list|)
name|struct
name|coff_section
modifier|*
name|ptr
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|tab
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"section %s %d %d address %x size %x number %d nrelocs %d"
argument_list|,
name|ptr
operator|->
name|name
argument_list|,
name|ptr
operator|->
name|code
argument_list|,
name|ptr
operator|->
name|data
argument_list|,
name|ptr
operator|->
name|address
argument_list|,
name|ptr
operator|->
name|size
argument_list|,
name|ptr
operator|->
name|number
argument_list|,
name|ptr
operator|->
name|nrelocs
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ptr
operator|->
name|nrelocs
condition|;
name|i
operator|++
control|)
block|{
name|tab
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"(%x %s %x)"
argument_list|,
name|ptr
operator|->
name|relocs
index|[
name|i
index|]
operator|.
name|offset
argument_list|,
name|ptr
operator|->
name|relocs
index|[
name|i
index|]
operator|.
name|symbol
operator|->
name|name
argument_list|,
name|ptr
operator|->
name|relocs
index|[
name|i
index|]
operator|.
name|addend
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
block|}
name|tab
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|coff_dump
parameter_list|(
name|ptr
parameter_list|)
name|struct
name|coff_ofile
modifier|*
name|ptr
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"Coff dump"
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"#souces %d"
argument_list|,
name|ptr
operator|->
name|nsources
argument_list|)
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|dump_coff_sfile
argument_list|(
name|ptr
operator|->
name|source_head
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ptr
operator|->
name|nsections
condition|;
name|i
operator|++
control|)
name|dump_coff_section
argument_list|(
name|ptr
operator|->
name|sections
operator|+
name|i
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
name|char
modifier|*
name|program_name
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|show_usage
parameter_list|(
name|file
parameter_list|,
name|status
parameter_list|)
name|FILE
modifier|*
name|file
decl_stmt|;
name|int
name|status
decl_stmt|;
block|{
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"Usage: %s [-hV] in-file\n"
argument_list|,
name|program_name
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|status
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|show_help
parameter_list|()
block|{
name|printf
argument_list|(
literal|"%s: Print a human readable interpretation of a SYSROFF object file\n"
argument_list|,
name|program_name
argument_list|)
expr_stmt|;
name|show_usage
argument_list|(
name|stdout
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|ac
parameter_list|,
name|av
parameter_list|)
name|int
name|ac
decl_stmt|;
name|char
modifier|*
name|av
index|[]
decl_stmt|;
block|{
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|struct
name|coff_ofile
modifier|*
name|tree
decl_stmt|;
name|char
modifier|*
modifier|*
name|matching
decl_stmt|;
name|char
modifier|*
name|input_file
init|=
name|NULL
decl_stmt|;
name|int
name|opt
decl_stmt|;
specifier|static
name|struct
name|option
name|long_options
index|[]
init|=
block|{
block|{
literal|"help"
block|,
name|no_argument
block|,
literal|0
block|,
literal|'h'
block|}
block|,
block|{
literal|"version"
block|,
name|no_argument
block|,
literal|0
block|,
literal|'V'
block|}
block|,
block|{
name|NULL
block|,
name|no_argument
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
name|program_name
operator|=
name|av
index|[
literal|0
index|]
expr_stmt|;
name|xmalloc_set_program_name
argument_list|(
name|program_name
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|opt
operator|=
name|getopt_long
argument_list|(
name|ac
argument_list|,
name|av
argument_list|,
literal|"hV"
argument_list|,
name|long_options
argument_list|,
operator|(
name|int
operator|*
operator|)
name|NULL
argument_list|)
operator|)
operator|!=
name|EOF
condition|)
block|{
switch|switch
condition|(
name|opt
condition|)
block|{
case|case
literal|'h'
case|:
name|show_help
argument_list|()
expr_stmt|;
comment|/*NOTREACHED*/
case|case
literal|'V'
case|:
name|printf
argument_list|(
literal|"GNU %s version %s\n"
argument_list|,
name|program_name
argument_list|,
name|PROGRAM_VERSION
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|/*NOTREACHED*/
case|case
literal|0
case|:
break|break;
default|default:
name|show_usage
argument_list|(
name|stderr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/*NOTREACHED*/
block|}
block|}
if|if
condition|(
name|optind
operator|<
name|ac
condition|)
block|{
name|input_file
operator|=
name|av
index|[
name|optind
index|]
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|input_file
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: no input file specified\n"
argument_list|,
name|program_name
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|abfd
operator|=
name|bfd_openr
argument_list|(
name|input_file
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|abfd
condition|)
name|bfd_fatal
argument_list|(
name|input_file
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bfd_check_format_matches
argument_list|(
name|abfd
argument_list|,
name|bfd_object
argument_list|,
operator|&
name|matching
argument_list|)
condition|)
block|{
name|bfd_nonfatal
argument_list|(
name|input_file
argument_list|)
expr_stmt|;
if|if
condition|(
name|bfd_get_error
argument_list|()
operator|==
name|bfd_error_file_ambiguously_recognized
condition|)
block|{
name|list_matching_formats
argument_list|(
name|matching
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|matching
argument_list|)
expr_stmt|;
block|}
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|tree
operator|=
name|coff_grok
argument_list|(
name|abfd
argument_list|)
expr_stmt|;
name|coff_dump
argument_list|(
name|tree
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

