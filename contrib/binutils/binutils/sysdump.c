begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Sysroff object format dumper.  Copyright (C) 1994 Free Software Foundation, Inc.  This file is part of GNU Binutils.  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/* Written by Steve Chamberlain<sac@cygnus.com>.   This program reads a SYSROFF object file and prints it in an  almost human readable form to stdout. */
end_comment

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"bucomm.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<libiberty.h>
end_include

begin_include
include|#
directive|include
file|<getopt.h>
end_include

begin_include
include|#
directive|include
file|"sysroff.h"
end_include

begin_define
define|#
directive|define
name|PROGRAM_VERSION
value|"1.0"
end_define

begin_decl_stmt
specifier|static
name|int
name|h8300
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|sh
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|dump
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|segmented_p
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|code
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|FILE
modifier|*
name|file
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|char
modifier|*
name|xcalloc
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
name|int
name|a
decl_stmt|;
name|int
name|b
decl_stmt|;
block|{
name|char
modifier|*
name|r
init|=
name|xmalloc
argument_list|(
name|a
operator|*
name|b
argument_list|)
decl_stmt|;
name|memset
argument_list|(
name|r
argument_list|,
literal|0
argument_list|,
name|a
operator|*
name|b
argument_list|)
expr_stmt|;
return|return
name|r
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|getCHARS
parameter_list|(
name|ptr
parameter_list|,
name|idx
parameter_list|,
name|size
parameter_list|,
name|max
parameter_list|)
name|unsigned
name|char
modifier|*
name|ptr
decl_stmt|;
name|int
modifier|*
name|idx
decl_stmt|;
name|int
name|size
decl_stmt|;
name|int
name|max
decl_stmt|;
block|{
name|int
name|oc
init|=
operator|*
name|idx
operator|/
literal|8
decl_stmt|;
name|char
modifier|*
name|r
decl_stmt|;
name|int
name|b
init|=
name|size
decl_stmt|;
if|if
condition|(
name|b
operator|>=
name|max
condition|)
block|{
return|return
literal|"*undefined*"
return|;
block|}
if|if
condition|(
name|b
operator|==
literal|0
condition|)
block|{
comment|/* Got to work out the length of the string from self */
name|b
operator|=
name|ptr
index|[
name|oc
operator|++
index|]
expr_stmt|;
operator|(
operator|*
name|idx
operator|)
operator|+=
literal|8
expr_stmt|;
block|}
operator|*
name|idx
operator|+=
name|b
operator|*
literal|8
expr_stmt|;
name|r
operator|=
name|xcalloc
argument_list|(
name|b
operator|+
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|r
argument_list|,
name|ptr
operator|+
name|oc
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|r
index|[
name|b
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|r
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|dh
parameter_list|(
name|ptr
parameter_list|,
name|size
parameter_list|)
name|unsigned
name|char
modifier|*
name|ptr
decl_stmt|;
name|int
name|size
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|int
name|j
decl_stmt|;
name|int
name|span
init|=
literal|16
decl_stmt|;
name|printf
argument_list|(
literal|"\n************************************************************\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|+=
name|span
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|span
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|j
operator|+
name|i
operator|<
name|size
condition|)
name|printf
argument_list|(
literal|"%02x "
argument_list|,
name|ptr
index|[
name|i
operator|+
name|j
index|]
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"   "
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|span
operator|&&
name|j
operator|+
name|i
operator|<
name|size
condition|;
name|j
operator|++
control|)
block|{
name|int
name|c
init|=
name|ptr
index|[
name|i
operator|+
name|j
index|]
decl_stmt|;
if|if
condition|(
name|c
operator|<
literal|32
operator|||
name|c
operator|>
literal|127
condition|)
name|c
operator|=
literal|'.'
expr_stmt|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|c
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|fillup
parameter_list|(
name|ptr
parameter_list|)
name|char
modifier|*
name|ptr
decl_stmt|;
block|{
name|int
name|size
decl_stmt|;
name|int
name|sum
decl_stmt|;
name|int
name|i
decl_stmt|;
name|size
operator|=
name|getc
argument_list|(
name|file
argument_list|)
operator|-
literal|2
expr_stmt|;
name|fread
argument_list|(
name|ptr
argument_list|,
literal|1
argument_list|,
name|size
argument_list|,
name|file
argument_list|)
expr_stmt|;
name|sum
operator|=
name|code
operator|+
name|size
operator|+
literal|2
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|++
control|)
block|{
name|sum
operator|+=
name|ptr
index|[
name|i
index|]
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|sum
operator|&
literal|0xff
operator|)
operator|!=
literal|0xff
condition|)
block|{
name|printf
argument_list|(
literal|"SUM IS %x\n"
argument_list|,
name|sum
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dump
condition|)
name|dh
argument_list|(
name|ptr
argument_list|,
name|size
argument_list|)
expr_stmt|;
return|return
name|size
operator|-
literal|1
return|;
block|}
end_function

begin_function
name|barray
name|getBARRAY
parameter_list|(
name|ptr
parameter_list|,
name|idx
parameter_list|,
name|dsize
parameter_list|,
name|max
parameter_list|)
name|unsigned
name|char
modifier|*
name|ptr
decl_stmt|;
name|int
modifier|*
name|idx
decl_stmt|;
name|int
name|dsize
decl_stmt|;
name|int
name|max
decl_stmt|;
block|{
name|barray
name|res
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|byte
init|=
operator|*
name|idx
operator|/
literal|8
decl_stmt|;
name|int
name|size
init|=
name|ptr
index|[
name|byte
operator|++
index|]
decl_stmt|;
name|res
operator|.
name|len
operator|=
name|size
expr_stmt|;
name|res
operator|.
name|data
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|xmalloc
argument_list|(
name|size
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|++
control|)
block|{
name|res
operator|.
name|data
index|[
name|i
index|]
operator|=
name|ptr
index|[
name|byte
operator|++
index|]
expr_stmt|;
block|}
return|return
name|res
return|;
block|}
end_function

begin_function
name|int
name|getINT
parameter_list|(
name|ptr
parameter_list|,
name|idx
parameter_list|,
name|size
parameter_list|,
name|max
parameter_list|)
name|unsigned
name|char
modifier|*
name|ptr
decl_stmt|;
name|int
modifier|*
name|idx
decl_stmt|;
name|int
name|size
decl_stmt|;
name|int
name|max
decl_stmt|;
block|{
name|int
name|n
init|=
literal|0
decl_stmt|;
name|int
name|byte
init|=
operator|*
name|idx
operator|/
literal|8
decl_stmt|;
if|if
condition|(
name|byte
operator|>=
name|max
condition|)
block|{
return|return
literal|0
return|;
block|}
if|if
condition|(
name|size
operator|==
operator|-
literal|2
condition|)
name|size
operator|=
literal|4
expr_stmt|;
if|if
condition|(
name|size
operator|==
operator|-
literal|1
condition|)
name|size
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|size
condition|)
block|{
case|case
literal|0
case|:
return|return
literal|0
return|;
case|case
literal|1
case|:
name|n
operator|=
operator|(
name|ptr
index|[
name|byte
index|]
operator|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|n
operator|=
operator|(
name|ptr
index|[
name|byte
operator|+
literal|0
index|]
operator|<<
literal|8
operator|)
operator|+
name|ptr
index|[
name|byte
operator|+
literal|1
index|]
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|n
operator|=
operator|(
name|ptr
index|[
name|byte
operator|+
literal|0
index|]
operator|<<
literal|24
operator|)
operator|+
operator|(
name|ptr
index|[
name|byte
operator|+
literal|1
index|]
operator|<<
literal|16
operator|)
operator|+
operator|(
name|ptr
index|[
name|byte
operator|+
literal|2
index|]
operator|<<
literal|8
operator|)
operator|+
operator|(
name|ptr
index|[
name|byte
operator|+
literal|3
index|]
operator|)
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
operator|*
name|idx
operator|+=
name|size
operator|*
literal|8
expr_stmt|;
return|return
name|n
return|;
block|}
end_function

begin_function
name|int
name|getBITS
parameter_list|(
name|ptr
parameter_list|,
name|idx
parameter_list|,
name|size
parameter_list|)
name|char
modifier|*
name|ptr
decl_stmt|;
name|int
modifier|*
name|idx
decl_stmt|;
name|int
name|size
decl_stmt|;
block|{
name|int
name|byte
init|=
operator|*
name|idx
operator|/
literal|8
decl_stmt|;
name|int
name|bit
init|=
operator|*
name|idx
operator|%
literal|8
decl_stmt|;
operator|*
name|idx
operator|+=
name|size
expr_stmt|;
return|return
operator|(
name|ptr
index|[
name|byte
index|]
operator|>>
operator|(
literal|8
operator|-
name|bit
operator|-
name|size
operator|)
operator|)
operator|&
operator|(
operator|(
literal|1
operator|<<
name|size
operator|)
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|itheader
parameter_list|(
name|name
parameter_list|,
name|code
parameter_list|)
name|char
modifier|*
name|name
decl_stmt|;
name|int
name|code
decl_stmt|;
block|{
name|printf
argument_list|(
literal|"\n%s 0x%02x\n"
argument_list|,
name|name
argument_list|,
name|code
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|int
name|indent
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|p
parameter_list|()
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|indent
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"| "
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"> "
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|tabout
parameter_list|()
block|{
name|p
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|pbarray
parameter_list|(
name|y
parameter_list|)
name|barray
modifier|*
name|y
decl_stmt|;
block|{
name|int
name|x
decl_stmt|;
name|printf
argument_list|(
literal|"%d ("
argument_list|,
name|y
operator|->
name|len
argument_list|)
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|y
operator|->
name|len
condition|;
name|x
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"(%02x %c)"
argument_list|,
name|y
operator|->
name|data
index|[
name|x
index|]
argument_list|,
name|isprint
argument_list|(
name|y
operator|->
name|data
index|[
name|x
index|]
argument_list|)
condition|?
name|y
operator|->
name|data
index|[
name|x
index|]
else|:
literal|'.'
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|")\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|SYSROFF_PRINT
end_define

begin_define
define|#
directive|define
name|SYSROFF_SWAP_IN
end_define

begin_include
include|#
directive|include
file|"sysroff.c"
end_include

begin_comment
comment|/*   * FIXME: sysinfo, which generates sysroff.[ch] from sysroff.info, can't  * hack the special case of the tr block, which has no contents.  So we  * implement our own functions for reading in and printing out the tr  * block.  */
end_comment

begin_define
define|#
directive|define
name|IT_tr_CODE
value|0x7f
end_define

begin_function
name|void
name|sysroff_swap_tr_in
parameter_list|()
block|{
name|char
name|raw
index|[
literal|255
index|]
decl_stmt|;
name|memset
argument_list|(
name|raw
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|fillup
argument_list|(
name|raw
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|sysroff_print_tr_out
parameter_list|()
block|{
name|itheader
argument_list|(
literal|"tr"
argument_list|,
name|IT_tr_CODE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|getone
parameter_list|(
name|type
parameter_list|)
name|int
name|type
decl_stmt|;
block|{
name|int
name|c
init|=
name|getc
argument_list|(
name|file
argument_list|)
decl_stmt|;
name|code
operator|=
name|c
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|&
literal|0x7f
operator|)
operator|!=
name|type
condition|)
block|{
name|ungetc
argument_list|(
name|c
argument_list|,
name|file
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
switch|switch
condition|(
name|c
operator|&
literal|0x7f
condition|)
block|{
case|case
name|IT_cs_CODE
case|:
block|{
name|struct
name|IT_cs
name|dummy
decl_stmt|;
name|sysroff_swap_cs_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_cs_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dln_CODE
case|:
block|{
name|struct
name|IT_dln
name|dummy
decl_stmt|;
name|sysroff_swap_dln_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dln_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_hd_CODE
case|:
block|{
name|struct
name|IT_hd
name|dummy
decl_stmt|;
name|sysroff_swap_hd_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_hd_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dar_CODE
case|:
block|{
name|struct
name|IT_dar
name|dummy
decl_stmt|;
name|sysroff_swap_dar_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dar_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dsy_CODE
case|:
block|{
name|struct
name|IT_dsy
name|dummy
decl_stmt|;
name|sysroff_swap_dsy_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dsy_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dfp_CODE
case|:
block|{
name|struct
name|IT_dfp
name|dummy
decl_stmt|;
name|sysroff_swap_dfp_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dfp_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dso_CODE
case|:
block|{
name|struct
name|IT_dso
name|dummy
decl_stmt|;
name|sysroff_swap_dso_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dso_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dpt_CODE
case|:
block|{
name|struct
name|IT_dpt
name|dummy
decl_stmt|;
name|sysroff_swap_dpt_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dpt_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_den_CODE
case|:
block|{
name|struct
name|IT_den
name|dummy
decl_stmt|;
name|sysroff_swap_den_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_den_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dbt_CODE
case|:
block|{
name|struct
name|IT_dbt
name|dummy
decl_stmt|;
name|sysroff_swap_dbt_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dbt_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dty_CODE
case|:
block|{
name|struct
name|IT_dty
name|dummy
decl_stmt|;
name|sysroff_swap_dty_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dty_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_un_CODE
case|:
block|{
name|struct
name|IT_un
name|dummy
decl_stmt|;
name|sysroff_swap_un_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_un_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_sc_CODE
case|:
block|{
name|struct
name|IT_sc
name|dummy
decl_stmt|;
name|sysroff_swap_sc_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_sc_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_er_CODE
case|:
block|{
name|struct
name|IT_er
name|dummy
decl_stmt|;
name|sysroff_swap_er_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_er_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_ed_CODE
case|:
block|{
name|struct
name|IT_ed
name|dummy
decl_stmt|;
name|sysroff_swap_ed_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_ed_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_sh_CODE
case|:
block|{
name|struct
name|IT_sh
name|dummy
decl_stmt|;
name|sysroff_swap_sh_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_sh_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_ob_CODE
case|:
block|{
name|struct
name|IT_ob
name|dummy
decl_stmt|;
name|sysroff_swap_ob_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_ob_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_rl_CODE
case|:
block|{
name|struct
name|IT_rl
name|dummy
decl_stmt|;
name|sysroff_swap_rl_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_rl_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_du_CODE
case|:
block|{
name|struct
name|IT_du
name|dummy
decl_stmt|;
name|sysroff_swap_du_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_du_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dus_CODE
case|:
block|{
name|struct
name|IT_dus
name|dummy
decl_stmt|;
name|sysroff_swap_dus_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dus_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dul_CODE
case|:
block|{
name|struct
name|IT_dul
name|dummy
decl_stmt|;
name|sysroff_swap_dul_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dul_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dss_CODE
case|:
block|{
name|struct
name|IT_dss
name|dummy
decl_stmt|;
name|sysroff_swap_dss_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dss_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_hs_CODE
case|:
block|{
name|struct
name|IT_hs
name|dummy
decl_stmt|;
name|sysroff_swap_hs_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_hs_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_dps_CODE
case|:
block|{
name|struct
name|IT_dps
name|dummy
decl_stmt|;
name|sysroff_swap_dps_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dps_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|IT_tr_CODE
case|:
block|{
name|sysroff_swap_tr_in
argument_list|()
expr_stmt|;
name|sysroff_print_tr_out
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
name|IT_dds_CODE
case|:
block|{
name|struct
name|IT_dds
name|dummy
decl_stmt|;
name|sysroff_swap_dds_in
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
name|sysroff_print_dds_out
argument_list|(
operator|&
name|dummy
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|printf
argument_list|(
literal|"GOT A %x\n"
argument_list|,
name|c
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
break|break;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|opt
parameter_list|(
name|x
parameter_list|)
name|int
name|x
decl_stmt|;
block|{
return|return
name|getone
argument_list|(
name|x
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|unit_info_list
parameter_list|()
block|{
while|while
condition|(
name|opt
argument_list|(
name|IT_un_CODE
argument_list|)
condition|)
block|{
name|getone
argument_list|(
name|IT_us_CODE
argument_list|)
expr_stmt|;
while|while
condition|(
name|getone
argument_list|(
name|IT_sc_CODE
argument_list|)
condition|)
name|getone
argument_list|(
name|IT_ss_CODE
argument_list|)
expr_stmt|;
while|while
condition|(
name|getone
argument_list|(
name|IT_er_CODE
argument_list|)
condition|)
empty_stmt|;
while|while
condition|(
name|getone
argument_list|(
name|IT_ed_CODE
argument_list|)
condition|)
empty_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|object_body_list
parameter_list|()
block|{
while|while
condition|(
name|getone
argument_list|(
name|IT_sh_CODE
argument_list|)
condition|)
block|{
while|while
condition|(
name|getone
argument_list|(
name|IT_ob_CODE
argument_list|)
condition|)
empty_stmt|;
while|while
condition|(
name|getone
argument_list|(
name|IT_rl_CODE
argument_list|)
condition|)
empty_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|must
parameter_list|(
name|x
parameter_list|)
name|int
name|x
decl_stmt|;
block|{
if|if
condition|(
operator|!
name|getone
argument_list|(
name|x
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"WANTED %x!!\n"
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|tab
parameter_list|(
name|i
parameter_list|,
name|s
parameter_list|)
name|int
name|i
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|;
block|{
name|indent
operator|+=
name|i
expr_stmt|;
if|if
condition|(
name|s
condition|)
block|{
name|p
argument_list|()
expr_stmt|;
name|printf
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function_decl
specifier|static
name|void
name|derived_type
parameter_list|()
function_decl|;
end_function_decl

begin_function
specifier|static
name|void
name|dump_symbol_info
parameter_list|()
block|{
name|tab
argument_list|(
literal|1
argument_list|,
literal|"SYMBOL INFO"
argument_list|)
expr_stmt|;
while|while
condition|(
name|opt
argument_list|(
name|IT_dsy_CODE
argument_list|)
condition|)
block|{
if|if
condition|(
name|opt
argument_list|(
name|IT_dty_CODE
argument_list|)
condition|)
block|{
name|must
argument_list|(
name|IT_dbt_CODE
argument_list|)
expr_stmt|;
name|derived_type
argument_list|()
expr_stmt|;
name|must
argument_list|(
name|IT_dty_CODE
argument_list|)
expr_stmt|;
block|}
block|}
name|tab
argument_list|(
operator|-
literal|1
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|derived_type
parameter_list|()
block|{
name|tab
argument_list|(
literal|1
argument_list|,
literal|"DERIVED TYPE"
argument_list|)
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
name|opt
argument_list|(
name|IT_dpp_CODE
argument_list|)
condition|)
block|{
name|dump_symbol_info
argument_list|()
expr_stmt|;
name|must
argument_list|(
name|IT_dpp_CODE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|opt
argument_list|(
name|IT_dfp_CODE
argument_list|)
condition|)
block|{
name|dump_symbol_info
argument_list|()
expr_stmt|;
name|must
argument_list|(
name|IT_dfp_CODE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|opt
argument_list|(
name|IT_den_CODE
argument_list|)
condition|)
block|{
name|dump_symbol_info
argument_list|()
expr_stmt|;
name|must
argument_list|(
name|IT_den_CODE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|opt
argument_list|(
name|IT_den_CODE
argument_list|)
condition|)
block|{
name|dump_symbol_info
argument_list|()
expr_stmt|;
name|must
argument_list|(
name|IT_den_CODE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|opt
argument_list|(
name|IT_dds_CODE
argument_list|)
condition|)
block|{
name|dump_symbol_info
argument_list|()
expr_stmt|;
name|must
argument_list|(
name|IT_dds_CODE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|opt
argument_list|(
name|IT_dar_CODE
argument_list|)
condition|)
block|{ 	}
elseif|else
if|if
condition|(
name|opt
argument_list|(
name|IT_dpt_CODE
argument_list|)
condition|)
block|{ 	}
elseif|else
if|if
condition|(
name|opt
argument_list|(
name|IT_dul_CODE
argument_list|)
condition|)
block|{ 	}
elseif|else
if|if
condition|(
name|opt
argument_list|(
name|IT_dse_CODE
argument_list|)
condition|)
block|{ 	}
elseif|else
if|if
condition|(
name|opt
argument_list|(
name|IT_dot_CODE
argument_list|)
condition|)
block|{ 	}
else|else
break|break;
block|}
name|tab
argument_list|(
operator|-
literal|1
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|program_structure
parameter_list|()
block|{
name|tab
argument_list|(
literal|1
argument_list|,
literal|"PROGRAM STRUCTURE"
argument_list|)
expr_stmt|;
while|while
condition|(
name|opt
argument_list|(
name|IT_dps_CODE
argument_list|)
condition|)
block|{
name|must
argument_list|(
name|IT_dso_CODE
argument_list|)
expr_stmt|;
name|opt
argument_list|(
name|IT_dss_CODE
argument_list|)
expr_stmt|;
name|dump_symbol_info
argument_list|()
expr_stmt|;
name|must
argument_list|(
name|IT_dps_CODE
argument_list|)
expr_stmt|;
block|}
name|tab
argument_list|(
operator|-
literal|1
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|debug_list
parameter_list|()
block|{
name|tab
argument_list|(
literal|1
argument_list|,
literal|"DEBUG LIST"
argument_list|)
expr_stmt|;
name|must
argument_list|(
name|IT_du_CODE
argument_list|)
expr_stmt|;
name|opt
argument_list|(
name|IT_dus_CODE
argument_list|)
expr_stmt|;
name|program_structure
argument_list|()
expr_stmt|;
name|must
argument_list|(
name|IT_dln_CODE
argument_list|)
expr_stmt|;
name|tab
argument_list|(
operator|-
literal|1
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|module
parameter_list|()
block|{
name|int
name|c
init|=
literal|0
decl_stmt|;
name|int
name|l
init|=
literal|0
decl_stmt|;
name|tab
argument_list|(
literal|1
argument_list|,
literal|"MODULE***\n"
argument_list|)
expr_stmt|;
do|do
block|{
name|c
operator|=
name|getc
argument_list|(
name|file
argument_list|)
expr_stmt|;
name|ungetc
argument_list|(
name|c
argument_list|,
name|file
argument_list|)
expr_stmt|;
name|c
operator|&=
literal|0x7f
expr_stmt|;
block|}
do|while
condition|(
name|getone
argument_list|(
name|c
argument_list|)
operator|&&
name|c
operator|!=
name|IT_tr_CODE
condition|)
do|;
if|#
directive|if
literal|0
block|must (IT_cs_CODE);   must (IT_hd_CODE);   opt (IT_hs_CODE);    unit_info_list ();   object_body_list ();   debug_list ();    must (IT_tr_CODE);
endif|#
directive|endif
name|tab
argument_list|(
operator|-
literal|1
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|c
operator|=
name|getc
argument_list|(
name|file
argument_list|)
expr_stmt|;
while|while
condition|(
name|c
operator|!=
name|EOF
condition|)
block|{
name|printf
argument_list|(
literal|"%02x "
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|l
operator|++
expr_stmt|;
if|if
condition|(
name|l
operator|==
literal|32
condition|)
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|l
operator|=
literal|0
expr_stmt|;
block|}
name|c
operator|=
name|getc
argument_list|(
name|file
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_decl_stmt
name|char
modifier|*
name|program_name
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|show_usage
parameter_list|(
name|file
parameter_list|,
name|status
parameter_list|)
name|FILE
modifier|*
name|file
decl_stmt|;
name|int
name|status
decl_stmt|;
block|{
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"Usage: %s [-hV] in-file\n"
argument_list|,
name|program_name
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|status
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|show_help
parameter_list|()
block|{
name|printf
argument_list|(
literal|"%s: Print a human readable interpretation of a SYSROFF object file\n"
argument_list|,
name|program_name
argument_list|)
expr_stmt|;
name|show_usage
argument_list|(
name|stdout
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|ac
parameter_list|,
name|av
parameter_list|)
name|int
name|ac
decl_stmt|;
name|char
modifier|*
modifier|*
name|av
decl_stmt|;
block|{
name|char
modifier|*
name|input_file
init|=
name|NULL
decl_stmt|;
name|int
name|opt
decl_stmt|;
specifier|static
name|struct
name|option
name|long_options
index|[]
init|=
block|{
block|{
literal|"help"
block|,
name|no_argument
block|,
literal|0
block|,
literal|'h'
block|}
block|,
block|{
literal|"version"
block|,
name|no_argument
block|,
literal|0
block|,
literal|'V'
block|}
block|,
block|{
name|NULL
block|,
name|no_argument
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
name|program_name
operator|=
name|av
index|[
literal|0
index|]
expr_stmt|;
name|xmalloc_set_program_name
argument_list|(
name|program_name
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|opt
operator|=
name|getopt_long
argument_list|(
name|ac
argument_list|,
name|av
argument_list|,
literal|"hV"
argument_list|,
name|long_options
argument_list|,
operator|(
name|int
operator|*
operator|)
name|NULL
argument_list|)
operator|)
operator|!=
name|EOF
condition|)
block|{
switch|switch
condition|(
name|opt
condition|)
block|{
case|case
literal|'h'
case|:
name|show_help
argument_list|()
expr_stmt|;
comment|/*NOTREACHED*/
case|case
literal|'V'
case|:
name|printf
argument_list|(
literal|"GNU %s version %s\n"
argument_list|,
name|program_name
argument_list|,
name|PROGRAM_VERSION
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|/*NOTREACHED*/
case|case
literal|0
case|:
break|break;
default|default:
name|show_usage
argument_list|(
name|stderr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/*NOTREACHED*/
block|}
block|}
comment|/* The input and output files may be named on the command line.  */
if|if
condition|(
name|optind
operator|<
name|ac
condition|)
block|{
name|input_file
operator|=
name|av
index|[
name|optind
index|]
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|input_file
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: no input file specified\n"
argument_list|,
name|program_name
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|file
operator|=
name|fopen
argument_list|(
name|input_file
argument_list|,
name|FOPEN_RB
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: cannot open input file %s\n"
argument_list|,
name|program_name
argument_list|,
name|input_file
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|module
argument_list|()
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

