begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* dwarf.c -- display DWARF contents of a BFD binary file    Copyright 2005, 2006, 2007    Free Software Foundation, Inc.     This file is part of GNU Binutils.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA    02110-1301, USA.  */
end_comment

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|"libiberty.h"
end_include

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"bucomm.h"
end_include

begin_include
include|#
directive|include
file|"elf/dwarf2.h"
end_include

begin_include
include|#
directive|include
file|"dwarf.h"
end_include

begin_decl_stmt
specifier|static
name|int
name|have_frame_base
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|need_base_address
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|unsigned
name|int
name|last_pointer_size
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|warned_about_missing_comp_units
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|unsigned
name|int
name|num_debug_info_entries
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|debug_info
modifier|*
name|debug_information
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|dwarf_vma
name|eh_addr_size
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|is_relocatable
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|do_debug_info
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|do_debug_abbrevs
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|do_debug_lines
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|do_debug_pubnames
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|do_debug_aranges
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|do_debug_ranges
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|do_debug_frames
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|do_debug_frames_interp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|do_debug_macinfo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|do_debug_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|do_debug_loc
decl_stmt|;
end_decl_stmt

begin_function_decl
name|dwarf_vma
function_decl|(
modifier|*
name|byte_get
function_decl|)
parameter_list|(
name|unsigned
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|dwarf_vma
name|byte_get_little_endian
parameter_list|(
name|unsigned
name|char
modifier|*
name|field
parameter_list|,
name|int
name|size
parameter_list|)
block|{
switch|switch
condition|(
name|size
condition|)
block|{
case|case
literal|1
case|:
return|return
operator|*
name|field
return|;
case|case
literal|2
case|:
return|return
operator|(
call|(
name|unsigned
name|int
call|)
argument_list|(
name|field
index|[
literal|0
index|]
argument_list|)
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|int
call|)
argument_list|(
name|field
index|[
literal|1
index|]
argument_list|)
operator|)
operator|<<
literal|8
operator|)
return|;
case|case
literal|4
case|:
return|return
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|0
index|]
argument_list|)
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|1
index|]
argument_list|)
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|2
index|]
argument_list|)
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|3
index|]
argument_list|)
operator|)
operator|<<
literal|24
operator|)
return|;
case|case
literal|8
case|:
if|if
condition|(
sizeof|sizeof
argument_list|(
name|dwarf_vma
argument_list|)
operator|==
literal|8
condition|)
return|return
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|0
index|]
argument_list|)
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|1
index|]
argument_list|)
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|2
index|]
argument_list|)
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|3
index|]
argument_list|)
operator|)
operator|<<
literal|24
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|4
index|]
argument_list|)
operator|)
operator|<<
literal|32
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|5
index|]
argument_list|)
operator|)
operator|<<
literal|40
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|6
index|]
argument_list|)
operator|)
operator|<<
literal|48
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|7
index|]
argument_list|)
operator|)
operator|<<
literal|56
operator|)
return|;
elseif|else
if|if
condition|(
sizeof|sizeof
argument_list|(
name|dwarf_vma
argument_list|)
operator|==
literal|4
condition|)
comment|/* We want to extract data from an 8 byte wide field and 	   place it into a 4 byte wide field.  Since this is a little 	   endian source we can just use the 4 byte extraction code.  */
return|return
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|0
index|]
argument_list|)
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|1
index|]
argument_list|)
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|2
index|]
argument_list|)
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|3
index|]
argument_list|)
operator|)
operator|<<
literal|24
operator|)
return|;
default|default:
name|error
argument_list|(
name|_
argument_list|(
literal|"Unhandled data length: %d\n"
argument_list|)
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|abort
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|dwarf_vma
name|byte_get_big_endian
parameter_list|(
name|unsigned
name|char
modifier|*
name|field
parameter_list|,
name|int
name|size
parameter_list|)
block|{
switch|switch
condition|(
name|size
condition|)
block|{
case|case
literal|1
case|:
return|return
operator|*
name|field
return|;
case|case
literal|2
case|:
return|return
operator|(
call|(
name|unsigned
name|int
call|)
argument_list|(
name|field
index|[
literal|1
index|]
argument_list|)
operator|)
operator||
operator|(
operator|(
call|(
name|int
call|)
argument_list|(
name|field
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<<
literal|8
operator|)
return|;
case|case
literal|4
case|:
return|return
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|3
index|]
argument_list|)
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|2
index|]
argument_list|)
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|1
index|]
argument_list|)
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<<
literal|24
operator|)
return|;
case|case
literal|8
case|:
if|if
condition|(
sizeof|sizeof
argument_list|(
name|dwarf_vma
argument_list|)
operator|==
literal|8
condition|)
return|return
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|7
index|]
argument_list|)
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|6
index|]
argument_list|)
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|5
index|]
argument_list|)
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|4
index|]
argument_list|)
operator|)
operator|<<
literal|24
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|3
index|]
argument_list|)
operator|)
operator|<<
literal|32
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|2
index|]
argument_list|)
operator|)
operator|<<
literal|40
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|1
index|]
argument_list|)
operator|)
operator|<<
literal|48
operator|)
operator||
operator|(
operator|(
call|(
name|dwarf_vma
call|)
argument_list|(
name|field
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<<
literal|56
operator|)
return|;
elseif|else
if|if
condition|(
sizeof|sizeof
argument_list|(
name|dwarf_vma
argument_list|)
operator|==
literal|4
condition|)
block|{
comment|/* Although we are extracing data from an 8 byte wide field, 	     we are returning only 4 bytes of data.  */
name|field
operator|+=
literal|4
expr_stmt|;
return|return
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|3
index|]
argument_list|)
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|2
index|]
argument_list|)
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|1
index|]
argument_list|)
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
name|field
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<<
literal|24
operator|)
return|;
block|}
default|default:
name|error
argument_list|(
name|_
argument_list|(
literal|"Unhandled data length: %d\n"
argument_list|)
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|abort
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|dwarf_vma
name|byte_get_signed
parameter_list|(
name|unsigned
name|char
modifier|*
name|field
parameter_list|,
name|int
name|size
parameter_list|)
block|{
name|dwarf_vma
name|x
init|=
name|byte_get
argument_list|(
name|field
argument_list|,
name|size
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|size
condition|)
block|{
case|case
literal|1
case|:
return|return
operator|(
name|x
operator|^
literal|0x80
operator|)
operator|-
literal|0x80
return|;
case|case
literal|2
case|:
return|return
operator|(
name|x
operator|^
literal|0x8000
operator|)
operator|-
literal|0x8000
return|;
case|case
literal|4
case|:
return|return
operator|(
name|x
operator|^
literal|0x80000000
operator|)
operator|-
literal|0x80000000
return|;
case|case
literal|8
case|:
return|return
name|x
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|unsigned
name|long
name|int
name|read_leb128
parameter_list|(
name|unsigned
name|char
modifier|*
name|data
parameter_list|,
name|unsigned
name|int
modifier|*
name|length_return
parameter_list|,
name|int
name|sign
parameter_list|)
block|{
name|unsigned
name|long
name|int
name|result
init|=
literal|0
decl_stmt|;
name|unsigned
name|int
name|num_read
init|=
literal|0
decl_stmt|;
name|unsigned
name|int
name|shift
init|=
literal|0
decl_stmt|;
name|unsigned
name|char
name|byte
decl_stmt|;
do|do
block|{
name|byte
operator|=
operator|*
name|data
operator|++
expr_stmt|;
name|num_read
operator|++
expr_stmt|;
name|result
operator||=
operator|(
call|(
name|unsigned
name|long
name|int
call|)
argument_list|(
name|byte
operator|&
literal|0x7f
argument_list|)
operator|)
operator|<<
name|shift
expr_stmt|;
name|shift
operator|+=
literal|7
expr_stmt|;
block|}
do|while
condition|(
name|byte
operator|&
literal|0x80
condition|)
do|;
if|if
condition|(
name|length_return
operator|!=
name|NULL
condition|)
operator|*
name|length_return
operator|=
name|num_read
expr_stmt|;
if|if
condition|(
name|sign
operator|&&
operator|(
name|shift
operator|<
literal|8
operator|*
sizeof|sizeof
argument_list|(
name|result
argument_list|)
operator|)
operator|&&
operator|(
name|byte
operator|&
literal|0x40
operator|)
condition|)
name|result
operator||=
operator|-
literal|1L
operator|<<
name|shift
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_typedef
typedef|typedef
struct|struct
name|State_Machine_Registers
block|{
name|unsigned
name|long
name|address
decl_stmt|;
name|unsigned
name|int
name|file
decl_stmt|;
name|unsigned
name|int
name|line
decl_stmt|;
name|unsigned
name|int
name|column
decl_stmt|;
name|int
name|is_stmt
decl_stmt|;
name|int
name|basic_block
decl_stmt|;
name|int
name|end_sequence
decl_stmt|;
comment|/* This variable hold the number of the last entry seen    in the File Table.  */
name|unsigned
name|int
name|last_file_entry
decl_stmt|;
block|}
name|SMR
typedef|;
end_typedef

begin_decl_stmt
specifier|static
name|SMR
name|state_machine_regs
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|reset_state_machine
parameter_list|(
name|int
name|is_stmt
parameter_list|)
block|{
name|state_machine_regs
operator|.
name|address
operator|=
literal|0
expr_stmt|;
name|state_machine_regs
operator|.
name|file
operator|=
literal|1
expr_stmt|;
name|state_machine_regs
operator|.
name|line
operator|=
literal|1
expr_stmt|;
name|state_machine_regs
operator|.
name|column
operator|=
literal|0
expr_stmt|;
name|state_machine_regs
operator|.
name|is_stmt
operator|=
name|is_stmt
expr_stmt|;
name|state_machine_regs
operator|.
name|basic_block
operator|=
literal|0
expr_stmt|;
name|state_machine_regs
operator|.
name|end_sequence
operator|=
literal|0
expr_stmt|;
name|state_machine_regs
operator|.
name|last_file_entry
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Handled an extend line op.    Returns the number of bytes read.  */
end_comment

begin_function
specifier|static
name|int
name|process_extended_line_op
parameter_list|(
name|unsigned
name|char
modifier|*
name|data
parameter_list|,
name|int
name|is_stmt
parameter_list|)
block|{
name|unsigned
name|char
name|op_code
decl_stmt|;
name|unsigned
name|int
name|bytes_read
decl_stmt|;
name|unsigned
name|int
name|len
decl_stmt|;
name|unsigned
name|char
modifier|*
name|name
decl_stmt|;
name|unsigned
name|long
name|adr
decl_stmt|;
name|len
operator|=
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"badly formed extended line op encountered!\n"
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|bytes_read
return|;
block|}
name|len
operator|+=
name|bytes_read
expr_stmt|;
name|op_code
operator|=
operator|*
name|data
operator|++
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Extended opcode %d: "
argument_list|)
argument_list|,
name|op_code
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|op_code
condition|)
block|{
case|case
name|DW_LNE_end_sequence
case|:
name|printf
argument_list|(
name|_
argument_list|(
literal|"End of Sequence\n\n"
argument_list|)
argument_list|)
expr_stmt|;
name|reset_state_machine
argument_list|(
name|is_stmt
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LNE_set_address
case|:
name|adr
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
name|len
operator|-
name|bytes_read
operator|-
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"set Address to 0x%lx\n"
argument_list|)
argument_list|,
name|adr
argument_list|)
expr_stmt|;
name|state_machine_regs
operator|.
name|address
operator|=
name|adr
expr_stmt|;
break|break;
case|case
name|DW_LNE_define_file
case|:
name|printf
argument_list|(
name|_
argument_list|(
literal|"  define new File Table entry\n"
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Entry\tDir\tTime\tSize\tName\n"
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"   %d\t"
argument_list|)
argument_list|,
operator|++
name|state_machine_regs
operator|.
name|last_file_entry
argument_list|)
expr_stmt|;
name|name
operator|=
name|data
expr_stmt|;
name|data
operator|+=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
operator|+
literal|1
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"%lu\t"
argument_list|)
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"%lu\t"
argument_list|)
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"%lu\t"
argument_list|)
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"%s\n\n"
argument_list|)
argument_list|,
name|name
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
name|_
argument_list|(
literal|"UNKNOWN: length %d\n"
argument_list|)
argument_list|,
name|len
operator|-
name|bytes_read
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
name|len
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|fetch_indirect_string
parameter_list|(
name|unsigned
name|long
name|offset
parameter_list|)
block|{
name|struct
name|dwarf_section
modifier|*
name|section
init|=
operator|&
name|debug_displays
index|[
name|str
index|]
operator|.
name|section
decl_stmt|;
if|if
condition|(
name|section
operator|->
name|start
operator|==
name|NULL
condition|)
return|return
name|_
argument_list|(
literal|"<no .debug_str section>"
argument_list|)
return|;
comment|/* DWARF sections under Mach-O have non-zero addresses.  */
name|offset
operator|-=
name|section
operator|->
name|address
expr_stmt|;
if|if
condition|(
name|offset
operator|>
name|section
operator|->
name|size
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"DW_FORM_strp offset too big: %lx\n"
argument_list|)
argument_list|,
name|offset
argument_list|)
expr_stmt|;
return|return
name|_
argument_list|(
literal|"<offset is too big>"
argument_list|)
return|;
block|}
return|return
operator|(
specifier|const
name|char
operator|*
operator|)
name|section
operator|->
name|start
operator|+
name|offset
return|;
block|}
end_function

begin_comment
comment|/* FIXME:  There are better and more efficient ways to handle    these structures.  For now though, I just want something that    is simple to implement.  */
end_comment

begin_typedef
typedef|typedef
struct|struct
name|abbrev_attr
block|{
name|unsigned
name|long
name|attribute
decl_stmt|;
name|unsigned
name|long
name|form
decl_stmt|;
name|struct
name|abbrev_attr
modifier|*
name|next
decl_stmt|;
block|}
name|abbrev_attr
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
name|abbrev_entry
block|{
name|unsigned
name|long
name|entry
decl_stmt|;
name|unsigned
name|long
name|tag
decl_stmt|;
name|int
name|children
decl_stmt|;
name|struct
name|abbrev_attr
modifier|*
name|first_attr
decl_stmt|;
name|struct
name|abbrev_attr
modifier|*
name|last_attr
decl_stmt|;
name|struct
name|abbrev_entry
modifier|*
name|next
decl_stmt|;
block|}
name|abbrev_entry
typedef|;
end_typedef

begin_decl_stmt
specifier|static
name|abbrev_entry
modifier|*
name|first_abbrev
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|abbrev_entry
modifier|*
name|last_abbrev
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|free_abbrevs
parameter_list|(
name|void
parameter_list|)
block|{
name|abbrev_entry
modifier|*
name|abbrev
decl_stmt|;
for|for
control|(
name|abbrev
operator|=
name|first_abbrev
init|;
name|abbrev
condition|;
control|)
block|{
name|abbrev_entry
modifier|*
name|next
init|=
name|abbrev
operator|->
name|next
decl_stmt|;
name|abbrev_attr
modifier|*
name|attr
decl_stmt|;
for|for
control|(
name|attr
operator|=
name|abbrev
operator|->
name|first_attr
init|;
name|attr
condition|;
control|)
block|{
name|abbrev_attr
modifier|*
name|next
init|=
name|attr
operator|->
name|next
decl_stmt|;
name|free
argument_list|(
name|attr
argument_list|)
expr_stmt|;
name|attr
operator|=
name|next
expr_stmt|;
block|}
name|free
argument_list|(
name|abbrev
argument_list|)
expr_stmt|;
name|abbrev
operator|=
name|next
expr_stmt|;
block|}
name|last_abbrev
operator|=
name|first_abbrev
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|add_abbrev
parameter_list|(
name|unsigned
name|long
name|number
parameter_list|,
name|unsigned
name|long
name|tag
parameter_list|,
name|int
name|children
parameter_list|)
block|{
name|abbrev_entry
modifier|*
name|entry
decl_stmt|;
name|entry
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|entry
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|entry
operator|==
name|NULL
condition|)
comment|/* ugg */
return|return;
name|entry
operator|->
name|entry
operator|=
name|number
expr_stmt|;
name|entry
operator|->
name|tag
operator|=
name|tag
expr_stmt|;
name|entry
operator|->
name|children
operator|=
name|children
expr_stmt|;
name|entry
operator|->
name|first_attr
operator|=
name|NULL
expr_stmt|;
name|entry
operator|->
name|last_attr
operator|=
name|NULL
expr_stmt|;
name|entry
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|first_abbrev
operator|==
name|NULL
condition|)
name|first_abbrev
operator|=
name|entry
expr_stmt|;
else|else
name|last_abbrev
operator|->
name|next
operator|=
name|entry
expr_stmt|;
name|last_abbrev
operator|=
name|entry
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|add_abbrev_attr
parameter_list|(
name|unsigned
name|long
name|attribute
parameter_list|,
name|unsigned
name|long
name|form
parameter_list|)
block|{
name|abbrev_attr
modifier|*
name|attr
decl_stmt|;
name|attr
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|attr
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr
operator|==
name|NULL
condition|)
comment|/* ugg */
return|return;
name|attr
operator|->
name|attribute
operator|=
name|attribute
expr_stmt|;
name|attr
operator|->
name|form
operator|=
name|form
expr_stmt|;
name|attr
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|last_abbrev
operator|->
name|first_attr
operator|==
name|NULL
condition|)
name|last_abbrev
operator|->
name|first_attr
operator|=
name|attr
expr_stmt|;
else|else
name|last_abbrev
operator|->
name|last_attr
operator|->
name|next
operator|=
name|attr
expr_stmt|;
name|last_abbrev
operator|->
name|last_attr
operator|=
name|attr
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Processes the (partial) contents of a .debug_abbrev section.    Returns NULL if the end of the section was encountered.    Returns the address after the last byte read if the end of    an abbreviation set was found.  */
end_comment

begin_function
specifier|static
name|unsigned
name|char
modifier|*
name|process_abbrev_section
parameter_list|(
name|unsigned
name|char
modifier|*
name|start
parameter_list|,
name|unsigned
name|char
modifier|*
name|end
parameter_list|)
block|{
if|if
condition|(
name|first_abbrev
operator|!=
name|NULL
condition|)
return|return
name|NULL
return|;
while|while
condition|(
name|start
operator|<
name|end
condition|)
block|{
name|unsigned
name|int
name|bytes_read
decl_stmt|;
name|unsigned
name|long
name|entry
decl_stmt|;
name|unsigned
name|long
name|tag
decl_stmt|;
name|unsigned
name|long
name|attribute
decl_stmt|;
name|int
name|children
decl_stmt|;
name|entry
operator|=
name|read_leb128
argument_list|(
name|start
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|start
operator|+=
name|bytes_read
expr_stmt|;
comment|/* A single zero is supposed to end the section according 	 to the standard.  If there's more, then signal that to 	 the caller.  */
if|if
condition|(
name|entry
operator|==
literal|0
condition|)
return|return
name|start
operator|==
name|end
condition|?
name|NULL
else|:
name|start
return|;
name|tag
operator|=
name|read_leb128
argument_list|(
name|start
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|start
operator|+=
name|bytes_read
expr_stmt|;
name|children
operator|=
operator|*
name|start
operator|++
expr_stmt|;
name|add_abbrev
argument_list|(
name|entry
argument_list|,
name|tag
argument_list|,
name|children
argument_list|)
expr_stmt|;
do|do
block|{
name|unsigned
name|long
name|form
decl_stmt|;
name|attribute
operator|=
name|read_leb128
argument_list|(
name|start
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|start
operator|+=
name|bytes_read
expr_stmt|;
name|form
operator|=
name|read_leb128
argument_list|(
name|start
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|start
operator|+=
name|bytes_read
expr_stmt|;
if|if
condition|(
name|attribute
operator|!=
literal|0
condition|)
name|add_abbrev_attr
argument_list|(
name|attribute
argument_list|,
name|form
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|attribute
operator|!=
literal|0
condition|)
do|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|get_TAG_name
parameter_list|(
name|unsigned
name|long
name|tag
parameter_list|)
block|{
switch|switch
condition|(
name|tag
condition|)
block|{
case|case
name|DW_TAG_padding
case|:
return|return
literal|"DW_TAG_padding"
return|;
case|case
name|DW_TAG_array_type
case|:
return|return
literal|"DW_TAG_array_type"
return|;
case|case
name|DW_TAG_class_type
case|:
return|return
literal|"DW_TAG_class_type"
return|;
case|case
name|DW_TAG_entry_point
case|:
return|return
literal|"DW_TAG_entry_point"
return|;
case|case
name|DW_TAG_enumeration_type
case|:
return|return
literal|"DW_TAG_enumeration_type"
return|;
case|case
name|DW_TAG_formal_parameter
case|:
return|return
literal|"DW_TAG_formal_parameter"
return|;
case|case
name|DW_TAG_imported_declaration
case|:
return|return
literal|"DW_TAG_imported_declaration"
return|;
case|case
name|DW_TAG_label
case|:
return|return
literal|"DW_TAG_label"
return|;
case|case
name|DW_TAG_lexical_block
case|:
return|return
literal|"DW_TAG_lexical_block"
return|;
case|case
name|DW_TAG_member
case|:
return|return
literal|"DW_TAG_member"
return|;
case|case
name|DW_TAG_pointer_type
case|:
return|return
literal|"DW_TAG_pointer_type"
return|;
case|case
name|DW_TAG_reference_type
case|:
return|return
literal|"DW_TAG_reference_type"
return|;
case|case
name|DW_TAG_compile_unit
case|:
return|return
literal|"DW_TAG_compile_unit"
return|;
case|case
name|DW_TAG_string_type
case|:
return|return
literal|"DW_TAG_string_type"
return|;
case|case
name|DW_TAG_structure_type
case|:
return|return
literal|"DW_TAG_structure_type"
return|;
case|case
name|DW_TAG_subroutine_type
case|:
return|return
literal|"DW_TAG_subroutine_type"
return|;
case|case
name|DW_TAG_typedef
case|:
return|return
literal|"DW_TAG_typedef"
return|;
case|case
name|DW_TAG_union_type
case|:
return|return
literal|"DW_TAG_union_type"
return|;
case|case
name|DW_TAG_unspecified_parameters
case|:
return|return
literal|"DW_TAG_unspecified_parameters"
return|;
case|case
name|DW_TAG_variant
case|:
return|return
literal|"DW_TAG_variant"
return|;
case|case
name|DW_TAG_common_block
case|:
return|return
literal|"DW_TAG_common_block"
return|;
case|case
name|DW_TAG_common_inclusion
case|:
return|return
literal|"DW_TAG_common_inclusion"
return|;
case|case
name|DW_TAG_inheritance
case|:
return|return
literal|"DW_TAG_inheritance"
return|;
case|case
name|DW_TAG_inlined_subroutine
case|:
return|return
literal|"DW_TAG_inlined_subroutine"
return|;
case|case
name|DW_TAG_module
case|:
return|return
literal|"DW_TAG_module"
return|;
case|case
name|DW_TAG_ptr_to_member_type
case|:
return|return
literal|"DW_TAG_ptr_to_member_type"
return|;
case|case
name|DW_TAG_set_type
case|:
return|return
literal|"DW_TAG_set_type"
return|;
case|case
name|DW_TAG_subrange_type
case|:
return|return
literal|"DW_TAG_subrange_type"
return|;
case|case
name|DW_TAG_with_stmt
case|:
return|return
literal|"DW_TAG_with_stmt"
return|;
case|case
name|DW_TAG_access_declaration
case|:
return|return
literal|"DW_TAG_access_declaration"
return|;
case|case
name|DW_TAG_base_type
case|:
return|return
literal|"DW_TAG_base_type"
return|;
case|case
name|DW_TAG_catch_block
case|:
return|return
literal|"DW_TAG_catch_block"
return|;
case|case
name|DW_TAG_const_type
case|:
return|return
literal|"DW_TAG_const_type"
return|;
case|case
name|DW_TAG_constant
case|:
return|return
literal|"DW_TAG_constant"
return|;
case|case
name|DW_TAG_enumerator
case|:
return|return
literal|"DW_TAG_enumerator"
return|;
case|case
name|DW_TAG_file_type
case|:
return|return
literal|"DW_TAG_file_type"
return|;
case|case
name|DW_TAG_friend
case|:
return|return
literal|"DW_TAG_friend"
return|;
case|case
name|DW_TAG_namelist
case|:
return|return
literal|"DW_TAG_namelist"
return|;
case|case
name|DW_TAG_namelist_item
case|:
return|return
literal|"DW_TAG_namelist_item"
return|;
case|case
name|DW_TAG_packed_type
case|:
return|return
literal|"DW_TAG_packed_type"
return|;
case|case
name|DW_TAG_subprogram
case|:
return|return
literal|"DW_TAG_subprogram"
return|;
case|case
name|DW_TAG_template_type_param
case|:
return|return
literal|"DW_TAG_template_type_param"
return|;
case|case
name|DW_TAG_template_value_param
case|:
return|return
literal|"DW_TAG_template_value_param"
return|;
case|case
name|DW_TAG_thrown_type
case|:
return|return
literal|"DW_TAG_thrown_type"
return|;
case|case
name|DW_TAG_try_block
case|:
return|return
literal|"DW_TAG_try_block"
return|;
case|case
name|DW_TAG_variant_part
case|:
return|return
literal|"DW_TAG_variant_part"
return|;
case|case
name|DW_TAG_variable
case|:
return|return
literal|"DW_TAG_variable"
return|;
case|case
name|DW_TAG_volatile_type
case|:
return|return
literal|"DW_TAG_volatile_type"
return|;
case|case
name|DW_TAG_MIPS_loop
case|:
return|return
literal|"DW_TAG_MIPS_loop"
return|;
case|case
name|DW_TAG_format_label
case|:
return|return
literal|"DW_TAG_format_label"
return|;
case|case
name|DW_TAG_function_template
case|:
return|return
literal|"DW_TAG_function_template"
return|;
case|case
name|DW_TAG_class_template
case|:
return|return
literal|"DW_TAG_class_template"
return|;
comment|/* DWARF 2.1 values.  */
case|case
name|DW_TAG_dwarf_procedure
case|:
return|return
literal|"DW_TAG_dwarf_procedure"
return|;
case|case
name|DW_TAG_restrict_type
case|:
return|return
literal|"DW_TAG_restrict_type"
return|;
case|case
name|DW_TAG_interface_type
case|:
return|return
literal|"DW_TAG_interface_type"
return|;
case|case
name|DW_TAG_namespace
case|:
return|return
literal|"DW_TAG_namespace"
return|;
case|case
name|DW_TAG_imported_module
case|:
return|return
literal|"DW_TAG_imported_module"
return|;
case|case
name|DW_TAG_unspecified_type
case|:
return|return
literal|"DW_TAG_unspecified_type"
return|;
case|case
name|DW_TAG_partial_unit
case|:
return|return
literal|"DW_TAG_partial_unit"
return|;
case|case
name|DW_TAG_imported_unit
case|:
return|return
literal|"DW_TAG_imported_unit"
return|;
comment|/* UPC values.  */
case|case
name|DW_TAG_upc_shared_type
case|:
return|return
literal|"DW_TAG_upc_shared_type"
return|;
case|case
name|DW_TAG_upc_strict_type
case|:
return|return
literal|"DW_TAG_upc_strict_type"
return|;
case|case
name|DW_TAG_upc_relaxed_type
case|:
return|return
literal|"DW_TAG_upc_relaxed_type"
return|;
default|default:
block|{
specifier|static
name|char
name|buffer
index|[
literal|100
index|]
decl_stmt|;
name|snprintf
argument_list|(
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Unknown TAG value: %lx"
argument_list|)
argument_list|,
name|tag
argument_list|)
expr_stmt|;
return|return
name|buffer
return|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|get_FORM_name
parameter_list|(
name|unsigned
name|long
name|form
parameter_list|)
block|{
switch|switch
condition|(
name|form
condition|)
block|{
case|case
name|DW_FORM_addr
case|:
return|return
literal|"DW_FORM_addr"
return|;
case|case
name|DW_FORM_block2
case|:
return|return
literal|"DW_FORM_block2"
return|;
case|case
name|DW_FORM_block4
case|:
return|return
literal|"DW_FORM_block4"
return|;
case|case
name|DW_FORM_data2
case|:
return|return
literal|"DW_FORM_data2"
return|;
case|case
name|DW_FORM_data4
case|:
return|return
literal|"DW_FORM_data4"
return|;
case|case
name|DW_FORM_data8
case|:
return|return
literal|"DW_FORM_data8"
return|;
case|case
name|DW_FORM_string
case|:
return|return
literal|"DW_FORM_string"
return|;
case|case
name|DW_FORM_block
case|:
return|return
literal|"DW_FORM_block"
return|;
case|case
name|DW_FORM_block1
case|:
return|return
literal|"DW_FORM_block1"
return|;
case|case
name|DW_FORM_data1
case|:
return|return
literal|"DW_FORM_data1"
return|;
case|case
name|DW_FORM_flag
case|:
return|return
literal|"DW_FORM_flag"
return|;
case|case
name|DW_FORM_sdata
case|:
return|return
literal|"DW_FORM_sdata"
return|;
case|case
name|DW_FORM_strp
case|:
return|return
literal|"DW_FORM_strp"
return|;
case|case
name|DW_FORM_udata
case|:
return|return
literal|"DW_FORM_udata"
return|;
case|case
name|DW_FORM_ref_addr
case|:
return|return
literal|"DW_FORM_ref_addr"
return|;
case|case
name|DW_FORM_ref1
case|:
return|return
literal|"DW_FORM_ref1"
return|;
case|case
name|DW_FORM_ref2
case|:
return|return
literal|"DW_FORM_ref2"
return|;
case|case
name|DW_FORM_ref4
case|:
return|return
literal|"DW_FORM_ref4"
return|;
case|case
name|DW_FORM_ref8
case|:
return|return
literal|"DW_FORM_ref8"
return|;
case|case
name|DW_FORM_ref_udata
case|:
return|return
literal|"DW_FORM_ref_udata"
return|;
case|case
name|DW_FORM_indirect
case|:
return|return
literal|"DW_FORM_indirect"
return|;
case|case
name|DW_FORM_flag_present
case|:
return|return
literal|"DW_FORM_flag_present"
return|;
default|default:
block|{
specifier|static
name|char
name|buffer
index|[
literal|100
index|]
decl_stmt|;
name|snprintf
argument_list|(
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Unknown FORM value: %lx"
argument_list|)
argument_list|,
name|form
argument_list|)
expr_stmt|;
return|return
name|buffer
return|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|unsigned
name|char
modifier|*
name|display_block
parameter_list|(
name|unsigned
name|char
modifier|*
name|data
parameter_list|,
name|unsigned
name|long
name|length
parameter_list|)
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|" %lu byte block: "
argument_list|)
argument_list|,
name|length
argument_list|)
expr_stmt|;
while|while
condition|(
name|length
operator|--
condition|)
name|printf
argument_list|(
literal|"%lx "
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|byte_get
argument_list|(
name|data
operator|++
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|data
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|decode_location_expression
parameter_list|(
name|unsigned
name|char
modifier|*
name|data
parameter_list|,
name|unsigned
name|int
name|pointer_size
parameter_list|,
name|unsigned
name|long
name|length
parameter_list|,
name|unsigned
name|long
name|cu_offset
parameter_list|)
block|{
name|unsigned
name|op
decl_stmt|;
name|unsigned
name|int
name|bytes_read
decl_stmt|;
name|unsigned
name|long
name|uvalue
decl_stmt|;
name|unsigned
name|char
modifier|*
name|end
init|=
name|data
operator|+
name|length
decl_stmt|;
name|int
name|need_frame_base
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|data
operator|<
name|end
condition|)
block|{
name|op
operator|=
operator|*
name|data
operator|++
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|DW_OP_addr
case|:
name|printf
argument_list|(
literal|"DW_OP_addr: %lx"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|byte_get
argument_list|(
name|data
argument_list|,
name|pointer_size
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|pointer_size
expr_stmt|;
break|break;
case|case
name|DW_OP_deref
case|:
name|printf
argument_list|(
literal|"DW_OP_deref"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_const1u
case|:
name|printf
argument_list|(
literal|"DW_OP_const1u: %lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|byte_get
argument_list|(
name|data
operator|++
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_const1s
case|:
name|printf
argument_list|(
literal|"DW_OP_const1s: %ld"
argument_list|,
operator|(
name|long
operator|)
name|byte_get_signed
argument_list|(
name|data
operator|++
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_const2u
case|:
name|printf
argument_list|(
literal|"DW_OP_const2u: %lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|byte_get
argument_list|(
name|data
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
name|DW_OP_const2s
case|:
name|printf
argument_list|(
literal|"DW_OP_const2s: %ld"
argument_list|,
operator|(
name|long
operator|)
name|byte_get_signed
argument_list|(
name|data
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
name|DW_OP_const4u
case|:
name|printf
argument_list|(
literal|"DW_OP_const4u: %lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|byte_get
argument_list|(
name|data
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|4
expr_stmt|;
break|break;
case|case
name|DW_OP_const4s
case|:
name|printf
argument_list|(
literal|"DW_OP_const4s: %ld"
argument_list|,
operator|(
name|long
operator|)
name|byte_get_signed
argument_list|(
name|data
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|4
expr_stmt|;
break|break;
case|case
name|DW_OP_const8u
case|:
name|printf
argument_list|(
literal|"DW_OP_const8u: %lu %lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|byte_get
argument_list|(
name|data
argument_list|,
literal|4
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|byte_get
argument_list|(
name|data
operator|+
literal|4
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|8
expr_stmt|;
break|break;
case|case
name|DW_OP_const8s
case|:
name|printf
argument_list|(
literal|"DW_OP_const8s: %ld %ld"
argument_list|,
operator|(
name|long
operator|)
name|byte_get
argument_list|(
name|data
argument_list|,
literal|4
argument_list|)
argument_list|,
operator|(
name|long
operator|)
name|byte_get
argument_list|(
name|data
operator|+
literal|4
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|8
expr_stmt|;
break|break;
case|case
name|DW_OP_constu
case|:
name|printf
argument_list|(
literal|"DW_OP_constu: %lu"
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
break|break;
case|case
name|DW_OP_consts
case|:
name|printf
argument_list|(
literal|"DW_OP_consts: %ld"
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
break|break;
case|case
name|DW_OP_dup
case|:
name|printf
argument_list|(
literal|"DW_OP_dup"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_drop
case|:
name|printf
argument_list|(
literal|"DW_OP_drop"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_over
case|:
name|printf
argument_list|(
literal|"DW_OP_over"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_pick
case|:
name|printf
argument_list|(
literal|"DW_OP_pick: %ld"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|byte_get
argument_list|(
name|data
operator|++
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_swap
case|:
name|printf
argument_list|(
literal|"DW_OP_swap"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_rot
case|:
name|printf
argument_list|(
literal|"DW_OP_rot"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_xderef
case|:
name|printf
argument_list|(
literal|"DW_OP_xderef"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_abs
case|:
name|printf
argument_list|(
literal|"DW_OP_abs"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_and
case|:
name|printf
argument_list|(
literal|"DW_OP_and"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_div
case|:
name|printf
argument_list|(
literal|"DW_OP_div"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_minus
case|:
name|printf
argument_list|(
literal|"DW_OP_minus"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_mod
case|:
name|printf
argument_list|(
literal|"DW_OP_mod"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_mul
case|:
name|printf
argument_list|(
literal|"DW_OP_mul"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_neg
case|:
name|printf
argument_list|(
literal|"DW_OP_neg"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_not
case|:
name|printf
argument_list|(
literal|"DW_OP_not"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_or
case|:
name|printf
argument_list|(
literal|"DW_OP_or"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_plus
case|:
name|printf
argument_list|(
literal|"DW_OP_plus"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_plus_uconst
case|:
name|printf
argument_list|(
literal|"DW_OP_plus_uconst: %lu"
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
break|break;
case|case
name|DW_OP_shl
case|:
name|printf
argument_list|(
literal|"DW_OP_shl"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_shr
case|:
name|printf
argument_list|(
literal|"DW_OP_shr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_shra
case|:
name|printf
argument_list|(
literal|"DW_OP_shra"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_xor
case|:
name|printf
argument_list|(
literal|"DW_OP_xor"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_bra
case|:
name|printf
argument_list|(
literal|"DW_OP_bra: %ld"
argument_list|,
operator|(
name|long
operator|)
name|byte_get_signed
argument_list|(
name|data
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
name|DW_OP_eq
case|:
name|printf
argument_list|(
literal|"DW_OP_eq"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_ge
case|:
name|printf
argument_list|(
literal|"DW_OP_ge"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_gt
case|:
name|printf
argument_list|(
literal|"DW_OP_gt"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_le
case|:
name|printf
argument_list|(
literal|"DW_OP_le"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_lt
case|:
name|printf
argument_list|(
literal|"DW_OP_lt"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_ne
case|:
name|printf
argument_list|(
literal|"DW_OP_ne"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_skip
case|:
name|printf
argument_list|(
literal|"DW_OP_skip: %ld"
argument_list|,
operator|(
name|long
operator|)
name|byte_get_signed
argument_list|(
name|data
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
name|DW_OP_lit0
case|:
case|case
name|DW_OP_lit1
case|:
case|case
name|DW_OP_lit2
case|:
case|case
name|DW_OP_lit3
case|:
case|case
name|DW_OP_lit4
case|:
case|case
name|DW_OP_lit5
case|:
case|case
name|DW_OP_lit6
case|:
case|case
name|DW_OP_lit7
case|:
case|case
name|DW_OP_lit8
case|:
case|case
name|DW_OP_lit9
case|:
case|case
name|DW_OP_lit10
case|:
case|case
name|DW_OP_lit11
case|:
case|case
name|DW_OP_lit12
case|:
case|case
name|DW_OP_lit13
case|:
case|case
name|DW_OP_lit14
case|:
case|case
name|DW_OP_lit15
case|:
case|case
name|DW_OP_lit16
case|:
case|case
name|DW_OP_lit17
case|:
case|case
name|DW_OP_lit18
case|:
case|case
name|DW_OP_lit19
case|:
case|case
name|DW_OP_lit20
case|:
case|case
name|DW_OP_lit21
case|:
case|case
name|DW_OP_lit22
case|:
case|case
name|DW_OP_lit23
case|:
case|case
name|DW_OP_lit24
case|:
case|case
name|DW_OP_lit25
case|:
case|case
name|DW_OP_lit26
case|:
case|case
name|DW_OP_lit27
case|:
case|case
name|DW_OP_lit28
case|:
case|case
name|DW_OP_lit29
case|:
case|case
name|DW_OP_lit30
case|:
case|case
name|DW_OP_lit31
case|:
name|printf
argument_list|(
literal|"DW_OP_lit%d"
argument_list|,
name|op
operator|-
name|DW_OP_lit0
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_reg0
case|:
case|case
name|DW_OP_reg1
case|:
case|case
name|DW_OP_reg2
case|:
case|case
name|DW_OP_reg3
case|:
case|case
name|DW_OP_reg4
case|:
case|case
name|DW_OP_reg5
case|:
case|case
name|DW_OP_reg6
case|:
case|case
name|DW_OP_reg7
case|:
case|case
name|DW_OP_reg8
case|:
case|case
name|DW_OP_reg9
case|:
case|case
name|DW_OP_reg10
case|:
case|case
name|DW_OP_reg11
case|:
case|case
name|DW_OP_reg12
case|:
case|case
name|DW_OP_reg13
case|:
case|case
name|DW_OP_reg14
case|:
case|case
name|DW_OP_reg15
case|:
case|case
name|DW_OP_reg16
case|:
case|case
name|DW_OP_reg17
case|:
case|case
name|DW_OP_reg18
case|:
case|case
name|DW_OP_reg19
case|:
case|case
name|DW_OP_reg20
case|:
case|case
name|DW_OP_reg21
case|:
case|case
name|DW_OP_reg22
case|:
case|case
name|DW_OP_reg23
case|:
case|case
name|DW_OP_reg24
case|:
case|case
name|DW_OP_reg25
case|:
case|case
name|DW_OP_reg26
case|:
case|case
name|DW_OP_reg27
case|:
case|case
name|DW_OP_reg28
case|:
case|case
name|DW_OP_reg29
case|:
case|case
name|DW_OP_reg30
case|:
case|case
name|DW_OP_reg31
case|:
name|printf
argument_list|(
literal|"DW_OP_reg%d"
argument_list|,
name|op
operator|-
name|DW_OP_reg0
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_breg0
case|:
case|case
name|DW_OP_breg1
case|:
case|case
name|DW_OP_breg2
case|:
case|case
name|DW_OP_breg3
case|:
case|case
name|DW_OP_breg4
case|:
case|case
name|DW_OP_breg5
case|:
case|case
name|DW_OP_breg6
case|:
case|case
name|DW_OP_breg7
case|:
case|case
name|DW_OP_breg8
case|:
case|case
name|DW_OP_breg9
case|:
case|case
name|DW_OP_breg10
case|:
case|case
name|DW_OP_breg11
case|:
case|case
name|DW_OP_breg12
case|:
case|case
name|DW_OP_breg13
case|:
case|case
name|DW_OP_breg14
case|:
case|case
name|DW_OP_breg15
case|:
case|case
name|DW_OP_breg16
case|:
case|case
name|DW_OP_breg17
case|:
case|case
name|DW_OP_breg18
case|:
case|case
name|DW_OP_breg19
case|:
case|case
name|DW_OP_breg20
case|:
case|case
name|DW_OP_breg21
case|:
case|case
name|DW_OP_breg22
case|:
case|case
name|DW_OP_breg23
case|:
case|case
name|DW_OP_breg24
case|:
case|case
name|DW_OP_breg25
case|:
case|case
name|DW_OP_breg26
case|:
case|case
name|DW_OP_breg27
case|:
case|case
name|DW_OP_breg28
case|:
case|case
name|DW_OP_breg29
case|:
case|case
name|DW_OP_breg30
case|:
case|case
name|DW_OP_breg31
case|:
name|printf
argument_list|(
literal|"DW_OP_breg%d: %ld"
argument_list|,
name|op
operator|-
name|DW_OP_breg0
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
break|break;
case|case
name|DW_OP_regx
case|:
name|printf
argument_list|(
literal|"DW_OP_regx: %lu"
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
break|break;
case|case
name|DW_OP_fbreg
case|:
name|need_frame_base
operator|=
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"DW_OP_fbreg: %ld"
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
break|break;
case|case
name|DW_OP_bregx
case|:
name|uvalue
operator|=
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
name|printf
argument_list|(
literal|"DW_OP_bregx: %lu %ld"
argument_list|,
name|uvalue
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
break|break;
case|case
name|DW_OP_piece
case|:
name|printf
argument_list|(
literal|"DW_OP_piece: %lu"
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
break|break;
case|case
name|DW_OP_deref_size
case|:
name|printf
argument_list|(
literal|"DW_OP_deref_size: %ld"
argument_list|,
operator|(
name|long
operator|)
name|byte_get
argument_list|(
name|data
operator|++
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_xderef_size
case|:
name|printf
argument_list|(
literal|"DW_OP_xderef_size: %ld"
argument_list|,
operator|(
name|long
operator|)
name|byte_get
argument_list|(
name|data
operator|++
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_nop
case|:
name|printf
argument_list|(
literal|"DW_OP_nop"
argument_list|)
expr_stmt|;
break|break;
comment|/* DWARF 3 extensions.  */
case|case
name|DW_OP_push_object_address
case|:
name|printf
argument_list|(
literal|"DW_OP_push_object_address"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_call2
case|:
comment|/* XXX: Strictly speaking for 64-bit DWARF3 files 	     this ought to be an 8-byte wide computation.  */
name|printf
argument_list|(
literal|"DW_OP_call2:<%lx>"
argument_list|,
operator|(
name|long
operator|)
name|byte_get
argument_list|(
name|data
argument_list|,
literal|2
argument_list|)
operator|+
name|cu_offset
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
name|DW_OP_call4
case|:
comment|/* XXX: Strictly speaking for 64-bit DWARF3 files 	     this ought to be an 8-byte wide computation.  */
name|printf
argument_list|(
literal|"DW_OP_call4:<%lx>"
argument_list|,
operator|(
name|long
operator|)
name|byte_get
argument_list|(
name|data
argument_list|,
literal|4
argument_list|)
operator|+
name|cu_offset
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|4
expr_stmt|;
break|break;
case|case
name|DW_OP_call_ref
case|:
name|printf
argument_list|(
literal|"DW_OP_call_ref"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_OP_form_tls_address
case|:
name|printf
argument_list|(
literal|"DW_OP_form_tls_address"
argument_list|)
expr_stmt|;
break|break;
comment|/* GNU extensions.  */
case|case
name|DW_OP_GNU_push_tls_address
case|:
name|printf
argument_list|(
literal|"DW_OP_GNU_push_tls_address"
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|op
operator|>=
name|DW_OP_lo_user
operator|&&
name|op
operator|<=
name|DW_OP_hi_user
condition|)
name|printf
argument_list|(
name|_
argument_list|(
literal|"(User defined location op)"
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
name|_
argument_list|(
literal|"(Unknown location op)"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* No way to tell where the next op is, so just bail.  */
return|return
name|need_frame_base
return|;
block|}
comment|/* Separate the ops.  */
if|if
condition|(
name|data
operator|<
name|end
condition|)
name|printf
argument_list|(
literal|"; "
argument_list|)
expr_stmt|;
block|}
return|return
name|need_frame_base
return|;
block|}
end_function

begin_function
specifier|static
name|unsigned
name|char
modifier|*
name|read_and_display_attr_value
parameter_list|(
name|unsigned
name|long
name|attribute
parameter_list|,
name|unsigned
name|long
name|form
parameter_list|,
name|unsigned
name|char
modifier|*
name|data
parameter_list|,
name|unsigned
name|long
name|cu_offset
parameter_list|,
name|unsigned
name|long
name|pointer_size
parameter_list|,
name|unsigned
name|long
name|offset_size
parameter_list|,
name|int
name|dwarf_version
parameter_list|,
name|debug_info
modifier|*
name|debug_info_p
parameter_list|,
name|int
name|do_loc
parameter_list|)
block|{
name|unsigned
name|long
name|uvalue
init|=
literal|0
decl_stmt|;
name|unsigned
name|char
modifier|*
name|block_start
init|=
name|NULL
decl_stmt|;
name|unsigned
name|int
name|bytes_read
decl_stmt|;
switch|switch
condition|(
name|form
condition|)
block|{
default|default:
break|break;
case|case
name|DW_FORM_ref_addr
case|:
if|if
condition|(
name|dwarf_version
operator|==
literal|2
condition|)
block|{
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
name|pointer_size
argument_list|)
expr_stmt|;
name|data
operator|+=
name|pointer_size
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|dwarf_version
operator|==
literal|3
condition|)
block|{
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
name|offset_size
argument_list|)
expr_stmt|;
name|data
operator|+=
name|offset_size
expr_stmt|;
block|}
else|else
block|{
name|error
argument_list|(
name|_
argument_list|(
literal|"Internal error: DWARF version is not 2 or 3.\n"
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DW_FORM_addr
case|:
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
name|pointer_size
argument_list|)
expr_stmt|;
name|data
operator|+=
name|pointer_size
expr_stmt|;
break|break;
case|case
name|DW_FORM_strp
case|:
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
name|offset_size
argument_list|)
expr_stmt|;
name|data
operator|+=
name|offset_size
expr_stmt|;
break|break;
case|case
name|DW_FORM_flag_present
case|:
name|uvalue
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|DW_FORM_ref1
case|:
case|case
name|DW_FORM_flag
case|:
case|case
name|DW_FORM_data1
case|:
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
operator|++
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_FORM_ref2
case|:
case|case
name|DW_FORM_data2
case|:
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
name|DW_FORM_ref4
case|:
case|case
name|DW_FORM_data4
case|:
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|4
expr_stmt|;
break|break;
case|case
name|DW_FORM_sdata
case|:
name|uvalue
operator|=
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
break|break;
case|case
name|DW_FORM_ref_udata
case|:
case|case
name|DW_FORM_udata
case|:
name|uvalue
operator|=
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
break|break;
case|case
name|DW_FORM_indirect
case|:
name|form
operator|=
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
if|if
condition|(
operator|!
name|do_loc
condition|)
name|printf
argument_list|(
literal|" %s"
argument_list|,
name|get_FORM_name
argument_list|(
name|form
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|read_and_display_attr_value
argument_list|(
name|attribute
argument_list|,
name|form
argument_list|,
name|data
argument_list|,
name|cu_offset
argument_list|,
name|pointer_size
argument_list|,
name|offset_size
argument_list|,
name|dwarf_version
argument_list|,
name|debug_info_p
argument_list|,
name|do_loc
argument_list|)
return|;
block|}
switch|switch
condition|(
name|form
condition|)
block|{
case|case
name|DW_FORM_ref_addr
case|:
if|if
condition|(
operator|!
name|do_loc
condition|)
name|printf
argument_list|(
literal|"<#%lx>"
argument_list|,
name|uvalue
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_FORM_ref1
case|:
case|case
name|DW_FORM_ref2
case|:
case|case
name|DW_FORM_ref4
case|:
case|case
name|DW_FORM_ref_udata
case|:
if|if
condition|(
operator|!
name|do_loc
condition|)
name|printf
argument_list|(
literal|"<%lx>"
argument_list|,
name|uvalue
operator|+
name|cu_offset
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_FORM_data4
case|:
case|case
name|DW_FORM_addr
case|:
if|if
condition|(
operator|!
name|do_loc
condition|)
name|printf
argument_list|(
literal|" %#lx"
argument_list|,
name|uvalue
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_FORM_flag_present
case|:
case|case
name|DW_FORM_flag
case|:
case|case
name|DW_FORM_data1
case|:
case|case
name|DW_FORM_data2
case|:
case|case
name|DW_FORM_sdata
case|:
case|case
name|DW_FORM_udata
case|:
if|if
condition|(
operator|!
name|do_loc
condition|)
name|printf
argument_list|(
literal|" %ld"
argument_list|,
name|uvalue
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_FORM_ref8
case|:
case|case
name|DW_FORM_data8
case|:
if|if
condition|(
operator|!
name|do_loc
condition|)
block|{
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %lx"
argument_list|,
name|uvalue
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %lx"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|byte_get
argument_list|(
name|data
operator|+
literal|4
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|do_loc
operator|||
name|do_debug_loc
operator|||
name|do_debug_ranges
operator|)
operator|&&
name|num_debug_info_entries
operator|==
literal|0
condition|)
block|{
if|if
condition|(
sizeof|sizeof
argument_list|(
name|uvalue
argument_list|)
operator|==
literal|8
condition|)
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
literal|8
argument_list|)
expr_stmt|;
else|else
name|error
argument_list|(
name|_
argument_list|(
literal|"DW_FORM_data8 is unsupported when sizeof (unsigned long) != 8\n"
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|data
operator|+=
literal|8
expr_stmt|;
break|break;
case|case
name|DW_FORM_string
case|:
if|if
condition|(
operator|!
name|do_loc
condition|)
name|printf
argument_list|(
literal|" %s"
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|data
operator|+=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
operator|+
literal|1
expr_stmt|;
break|break;
case|case
name|DW_FORM_block
case|:
name|uvalue
operator|=
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|block_start
operator|=
name|data
operator|+
name|bytes_read
expr_stmt|;
if|if
condition|(
name|do_loc
condition|)
name|data
operator|=
name|block_start
operator|+
name|uvalue
expr_stmt|;
else|else
name|data
operator|=
name|display_block
argument_list|(
name|block_start
argument_list|,
name|uvalue
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_FORM_block1
case|:
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|block_start
operator|=
name|data
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|do_loc
condition|)
name|data
operator|=
name|block_start
operator|+
name|uvalue
expr_stmt|;
else|else
name|data
operator|=
name|display_block
argument_list|(
name|block_start
argument_list|,
name|uvalue
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_FORM_block2
case|:
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|block_start
operator|=
name|data
operator|+
literal|2
expr_stmt|;
if|if
condition|(
name|do_loc
condition|)
name|data
operator|=
name|block_start
operator|+
name|uvalue
expr_stmt|;
else|else
name|data
operator|=
name|display_block
argument_list|(
name|block_start
argument_list|,
name|uvalue
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_FORM_block4
case|:
name|uvalue
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|block_start
operator|=
name|data
operator|+
literal|4
expr_stmt|;
if|if
condition|(
name|do_loc
condition|)
name|data
operator|=
name|block_start
operator|+
name|uvalue
expr_stmt|;
else|else
name|data
operator|=
name|display_block
argument_list|(
name|block_start
argument_list|,
name|uvalue
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_FORM_strp
case|:
if|if
condition|(
operator|!
name|do_loc
condition|)
name|printf
argument_list|(
name|_
argument_list|(
literal|" (indirect string, offset: 0x%lx): %s"
argument_list|)
argument_list|,
name|uvalue
argument_list|,
name|fetch_indirect_string
argument_list|(
name|uvalue
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_FORM_indirect
case|:
comment|/* Handled above.  */
break|break;
default|default:
name|warn
argument_list|(
name|_
argument_list|(
literal|"Unrecognized form: %lu\n"
argument_list|)
argument_list|,
name|form
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* For some attributes we can display further information.  */
if|if
condition|(
operator|(
name|do_loc
operator|||
name|do_debug_loc
operator|||
name|do_debug_ranges
operator|)
operator|&&
name|num_debug_info_entries
operator|==
literal|0
condition|)
block|{
switch|switch
condition|(
name|attribute
condition|)
block|{
case|case
name|DW_AT_frame_base
case|:
name|have_frame_base
operator|=
literal|1
expr_stmt|;
case|case
name|DW_AT_location
case|:
case|case
name|DW_AT_data_member_location
case|:
case|case
name|DW_AT_vtable_elem_location
case|:
case|case
name|DW_AT_allocated
case|:
case|case
name|DW_AT_associated
case|:
case|case
name|DW_AT_data_location
case|:
case|case
name|DW_AT_stride
case|:
case|case
name|DW_AT_upper_bound
case|:
case|case
name|DW_AT_lower_bound
case|:
if|if
condition|(
name|form
operator|==
name|DW_FORM_data4
operator|||
name|form
operator|==
name|DW_FORM_data8
condition|)
block|{
comment|/* Process location list.  */
name|unsigned
name|int
name|max
init|=
name|debug_info_p
operator|->
name|max_loc_offsets
decl_stmt|;
name|unsigned
name|int
name|num
init|=
name|debug_info_p
operator|->
name|num_loc_offsets
decl_stmt|;
if|if
condition|(
name|max
operator|==
literal|0
operator|||
name|num
operator|>=
name|max
condition|)
block|{
name|max
operator|+=
literal|1024
expr_stmt|;
name|debug_info_p
operator|->
name|loc_offsets
operator|=
name|xcrealloc
argument_list|(
name|debug_info_p
operator|->
name|loc_offsets
argument_list|,
name|max
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|debug_info_p
operator|->
name|loc_offsets
argument_list|)
argument_list|)
expr_stmt|;
name|debug_info_p
operator|->
name|have_frame_base
operator|=
name|xcrealloc
argument_list|(
name|debug_info_p
operator|->
name|have_frame_base
argument_list|,
name|max
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|debug_info_p
operator|->
name|have_frame_base
argument_list|)
argument_list|)
expr_stmt|;
name|debug_info_p
operator|->
name|max_loc_offsets
operator|=
name|max
expr_stmt|;
block|}
name|debug_info_p
operator|->
name|loc_offsets
index|[
name|num
index|]
operator|=
name|uvalue
expr_stmt|;
name|debug_info_p
operator|->
name|have_frame_base
index|[
name|num
index|]
operator|=
name|have_frame_base
expr_stmt|;
name|debug_info_p
operator|->
name|num_loc_offsets
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|DW_AT_low_pc
case|:
if|if
condition|(
name|need_base_address
condition|)
name|debug_info_p
operator|->
name|base_address
operator|=
name|uvalue
expr_stmt|;
break|break;
case|case
name|DW_AT_ranges
case|:
if|if
condition|(
name|form
operator|==
name|DW_FORM_data4
operator|||
name|form
operator|==
name|DW_FORM_data8
condition|)
block|{
comment|/* Process range list.  */
name|unsigned
name|int
name|max
init|=
name|debug_info_p
operator|->
name|max_range_lists
decl_stmt|;
name|unsigned
name|int
name|num
init|=
name|debug_info_p
operator|->
name|num_range_lists
decl_stmt|;
if|if
condition|(
name|max
operator|==
literal|0
operator|||
name|num
operator|>=
name|max
condition|)
block|{
name|max
operator|+=
literal|1024
expr_stmt|;
name|debug_info_p
operator|->
name|range_lists
operator|=
name|xcrealloc
argument_list|(
name|debug_info_p
operator|->
name|range_lists
argument_list|,
name|max
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|debug_info_p
operator|->
name|range_lists
argument_list|)
argument_list|)
expr_stmt|;
name|debug_info_p
operator|->
name|max_range_lists
operator|=
name|max
expr_stmt|;
block|}
name|debug_info_p
operator|->
name|range_lists
index|[
name|num
index|]
operator|=
name|uvalue
expr_stmt|;
name|debug_info_p
operator|->
name|num_range_lists
operator|++
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
block|}
if|if
condition|(
name|do_loc
condition|)
return|return
name|data
return|;
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|attribute
condition|)
block|{
case|case
name|DW_AT_inline
case|:
switch|switch
condition|(
name|uvalue
condition|)
block|{
case|case
name|DW_INL_not_inlined
case|:
name|printf
argument_list|(
name|_
argument_list|(
literal|"(not inlined)"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_INL_inlined
case|:
name|printf
argument_list|(
name|_
argument_list|(
literal|"(inlined)"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_INL_declared_not_inlined
case|:
name|printf
argument_list|(
name|_
argument_list|(
literal|"(declared as inline but ignored)"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_INL_declared_inlined
case|:
name|printf
argument_list|(
name|_
argument_list|(
literal|"(declared as inline and inlined)"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
name|_
argument_list|(
literal|"  (Unknown inline attribute value: %lx)"
argument_list|)
argument_list|,
name|uvalue
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|DW_AT_language
case|:
switch|switch
condition|(
name|uvalue
condition|)
block|{
comment|/* Ordered by the numeric value of these constants.  */
case|case
name|DW_LANG_C89
case|:
name|printf
argument_list|(
literal|"(ANSI C)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_C
case|:
name|printf
argument_list|(
literal|"(non-ANSI C)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_Ada83
case|:
name|printf
argument_list|(
literal|"(Ada)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_C_plus_plus
case|:
name|printf
argument_list|(
literal|"(C++)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_Cobol74
case|:
name|printf
argument_list|(
literal|"(Cobol 74)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_Cobol85
case|:
name|printf
argument_list|(
literal|"(Cobol 85)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_Fortran77
case|:
name|printf
argument_list|(
literal|"(FORTRAN 77)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_Fortran90
case|:
name|printf
argument_list|(
literal|"(Fortran 90)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_Pascal83
case|:
name|printf
argument_list|(
literal|"(ANSI Pascal)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_Modula2
case|:
name|printf
argument_list|(
literal|"(Modula 2)"
argument_list|)
expr_stmt|;
break|break;
comment|/* DWARF 2.1 values.	*/
case|case
name|DW_LANG_Java
case|:
name|printf
argument_list|(
literal|"(Java)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_C99
case|:
name|printf
argument_list|(
literal|"(ANSI C99)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_Ada95
case|:
name|printf
argument_list|(
literal|"(ADA 95)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_Fortran95
case|:
name|printf
argument_list|(
literal|"(Fortran 95)"
argument_list|)
expr_stmt|;
break|break;
comment|/* DWARF 3 values.  */
case|case
name|DW_LANG_PLI
case|:
name|printf
argument_list|(
literal|"(PLI)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_ObjC
case|:
name|printf
argument_list|(
literal|"(Objective C)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_ObjC_plus_plus
case|:
name|printf
argument_list|(
literal|"(Objective C++)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_UPC
case|:
name|printf
argument_list|(
literal|"(Unified Parallel C)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LANG_D
case|:
name|printf
argument_list|(
literal|"(D)"
argument_list|)
expr_stmt|;
break|break;
comment|/* MIPS extension.  */
case|case
name|DW_LANG_Mips_Assembler
case|:
name|printf
argument_list|(
literal|"(MIPS assembler)"
argument_list|)
expr_stmt|;
break|break;
comment|/* UPC extension.  */
case|case
name|DW_LANG_Upc
case|:
name|printf
argument_list|(
literal|"(Unified Parallel C)"
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|uvalue
operator|>=
name|DW_LANG_lo_user
operator|&&
name|uvalue
operator|<=
name|DW_LANG_hi_user
condition|)
name|printf
argument_list|(
literal|"(implementation defined: %lx)"
argument_list|,
name|uvalue
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"(Unknown: %lx)"
argument_list|,
name|uvalue
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|DW_AT_encoding
case|:
switch|switch
condition|(
name|uvalue
condition|)
block|{
case|case
name|DW_ATE_void
case|:
name|printf
argument_list|(
literal|"(void)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ATE_address
case|:
name|printf
argument_list|(
literal|"(machine address)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ATE_boolean
case|:
name|printf
argument_list|(
literal|"(boolean)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ATE_complex_float
case|:
name|printf
argument_list|(
literal|"(complex float)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ATE_float
case|:
name|printf
argument_list|(
literal|"(float)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ATE_signed
case|:
name|printf
argument_list|(
literal|"(signed)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ATE_signed_char
case|:
name|printf
argument_list|(
literal|"(signed char)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ATE_unsigned
case|:
name|printf
argument_list|(
literal|"(unsigned)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ATE_unsigned_char
case|:
name|printf
argument_list|(
literal|"(unsigned char)"
argument_list|)
expr_stmt|;
break|break;
comment|/* DWARF 2.1 value.  */
case|case
name|DW_ATE_imaginary_float
case|:
name|printf
argument_list|(
literal|"(imaginary float)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ATE_decimal_float
case|:
name|printf
argument_list|(
literal|"(decimal float)"
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|uvalue
operator|>=
name|DW_ATE_lo_user
operator|&&
name|uvalue
operator|<=
name|DW_ATE_hi_user
condition|)
name|printf
argument_list|(
literal|"(user defined type)"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"(unknown type)"
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|DW_AT_accessibility
case|:
switch|switch
condition|(
name|uvalue
condition|)
block|{
case|case
name|DW_ACCESS_public
case|:
name|printf
argument_list|(
literal|"(public)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ACCESS_protected
case|:
name|printf
argument_list|(
literal|"(protected)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ACCESS_private
case|:
name|printf
argument_list|(
literal|"(private)"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"(unknown accessibility)"
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|DW_AT_visibility
case|:
switch|switch
condition|(
name|uvalue
condition|)
block|{
case|case
name|DW_VIS_local
case|:
name|printf
argument_list|(
literal|"(local)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_VIS_exported
case|:
name|printf
argument_list|(
literal|"(exported)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_VIS_qualified
case|:
name|printf
argument_list|(
literal|"(qualified)"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"(unknown visibility)"
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|DW_AT_virtuality
case|:
switch|switch
condition|(
name|uvalue
condition|)
block|{
case|case
name|DW_VIRTUALITY_none
case|:
name|printf
argument_list|(
literal|"(none)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_VIRTUALITY_virtual
case|:
name|printf
argument_list|(
literal|"(virtual)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_VIRTUALITY_pure_virtual
case|:
name|printf
argument_list|(
literal|"(pure_virtual)"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"(unknown virtuality)"
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|DW_AT_identifier_case
case|:
switch|switch
condition|(
name|uvalue
condition|)
block|{
case|case
name|DW_ID_case_sensitive
case|:
name|printf
argument_list|(
literal|"(case_sensitive)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ID_up_case
case|:
name|printf
argument_list|(
literal|"(up_case)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ID_down_case
case|:
name|printf
argument_list|(
literal|"(down_case)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_ID_case_insensitive
case|:
name|printf
argument_list|(
literal|"(case_insensitive)"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"(unknown case)"
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|DW_AT_calling_convention
case|:
switch|switch
condition|(
name|uvalue
condition|)
block|{
case|case
name|DW_CC_normal
case|:
name|printf
argument_list|(
literal|"(normal)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CC_program
case|:
name|printf
argument_list|(
literal|"(program)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CC_nocall
case|:
name|printf
argument_list|(
literal|"(nocall)"
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|uvalue
operator|>=
name|DW_CC_lo_user
operator|&&
name|uvalue
operator|<=
name|DW_CC_hi_user
condition|)
name|printf
argument_list|(
literal|"(user defined)"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"(unknown convention)"
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DW_AT_ordering
case|:
switch|switch
condition|(
name|uvalue
condition|)
block|{
case|case
operator|-
literal|1
case|:
name|printf
argument_list|(
literal|"(undefined)"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"(row major)"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"(column major)"
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|DW_AT_frame_base
case|:
name|have_frame_base
operator|=
literal|1
expr_stmt|;
case|case
name|DW_AT_location
case|:
case|case
name|DW_AT_data_member_location
case|:
case|case
name|DW_AT_vtable_elem_location
case|:
case|case
name|DW_AT_allocated
case|:
case|case
name|DW_AT_associated
case|:
case|case
name|DW_AT_data_location
case|:
case|case
name|DW_AT_stride
case|:
case|case
name|DW_AT_upper_bound
case|:
case|case
name|DW_AT_lower_bound
case|:
if|if
condition|(
name|block_start
condition|)
block|{
name|int
name|need_frame_base
decl_stmt|;
name|printf
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
name|need_frame_base
operator|=
name|decode_location_expression
argument_list|(
name|block_start
argument_list|,
name|pointer_size
argument_list|,
name|uvalue
argument_list|,
name|cu_offset
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
if|if
condition|(
name|need_frame_base
operator|&&
operator|!
name|have_frame_base
condition|)
name|printf
argument_list|(
name|_
argument_list|(
literal|" [without DW_AT_frame_base]"
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|form
operator|==
name|DW_FORM_data4
operator|||
name|form
operator|==
name|DW_FORM_data8
condition|)
name|printf
argument_list|(
name|_
argument_list|(
literal|"(location list)"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
name|data
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|get_AT_name
parameter_list|(
name|unsigned
name|long
name|attribute
parameter_list|)
block|{
switch|switch
condition|(
name|attribute
condition|)
block|{
case|case
name|DW_AT_sibling
case|:
return|return
literal|"DW_AT_sibling"
return|;
case|case
name|DW_AT_location
case|:
return|return
literal|"DW_AT_location"
return|;
case|case
name|DW_AT_name
case|:
return|return
literal|"DW_AT_name"
return|;
case|case
name|DW_AT_ordering
case|:
return|return
literal|"DW_AT_ordering"
return|;
case|case
name|DW_AT_subscr_data
case|:
return|return
literal|"DW_AT_subscr_data"
return|;
case|case
name|DW_AT_byte_size
case|:
return|return
literal|"DW_AT_byte_size"
return|;
case|case
name|DW_AT_bit_offset
case|:
return|return
literal|"DW_AT_bit_offset"
return|;
case|case
name|DW_AT_bit_size
case|:
return|return
literal|"DW_AT_bit_size"
return|;
case|case
name|DW_AT_element_list
case|:
return|return
literal|"DW_AT_element_list"
return|;
case|case
name|DW_AT_stmt_list
case|:
return|return
literal|"DW_AT_stmt_list"
return|;
case|case
name|DW_AT_low_pc
case|:
return|return
literal|"DW_AT_low_pc"
return|;
case|case
name|DW_AT_high_pc
case|:
return|return
literal|"DW_AT_high_pc"
return|;
case|case
name|DW_AT_language
case|:
return|return
literal|"DW_AT_language"
return|;
case|case
name|DW_AT_member
case|:
return|return
literal|"DW_AT_member"
return|;
case|case
name|DW_AT_discr
case|:
return|return
literal|"DW_AT_discr"
return|;
case|case
name|DW_AT_discr_value
case|:
return|return
literal|"DW_AT_discr_value"
return|;
case|case
name|DW_AT_visibility
case|:
return|return
literal|"DW_AT_visibility"
return|;
case|case
name|DW_AT_import
case|:
return|return
literal|"DW_AT_import"
return|;
case|case
name|DW_AT_string_length
case|:
return|return
literal|"DW_AT_string_length"
return|;
case|case
name|DW_AT_common_reference
case|:
return|return
literal|"DW_AT_common_reference"
return|;
case|case
name|DW_AT_comp_dir
case|:
return|return
literal|"DW_AT_comp_dir"
return|;
case|case
name|DW_AT_const_value
case|:
return|return
literal|"DW_AT_const_value"
return|;
case|case
name|DW_AT_containing_type
case|:
return|return
literal|"DW_AT_containing_type"
return|;
case|case
name|DW_AT_default_value
case|:
return|return
literal|"DW_AT_default_value"
return|;
case|case
name|DW_AT_inline
case|:
return|return
literal|"DW_AT_inline"
return|;
case|case
name|DW_AT_is_optional
case|:
return|return
literal|"DW_AT_is_optional"
return|;
case|case
name|DW_AT_lower_bound
case|:
return|return
literal|"DW_AT_lower_bound"
return|;
case|case
name|DW_AT_producer
case|:
return|return
literal|"DW_AT_producer"
return|;
case|case
name|DW_AT_prototyped
case|:
return|return
literal|"DW_AT_prototyped"
return|;
case|case
name|DW_AT_return_addr
case|:
return|return
literal|"DW_AT_return_addr"
return|;
case|case
name|DW_AT_start_scope
case|:
return|return
literal|"DW_AT_start_scope"
return|;
case|case
name|DW_AT_stride_size
case|:
return|return
literal|"DW_AT_stride_size"
return|;
case|case
name|DW_AT_upper_bound
case|:
return|return
literal|"DW_AT_upper_bound"
return|;
case|case
name|DW_AT_abstract_origin
case|:
return|return
literal|"DW_AT_abstract_origin"
return|;
case|case
name|DW_AT_accessibility
case|:
return|return
literal|"DW_AT_accessibility"
return|;
case|case
name|DW_AT_address_class
case|:
return|return
literal|"DW_AT_address_class"
return|;
case|case
name|DW_AT_artificial
case|:
return|return
literal|"DW_AT_artificial"
return|;
case|case
name|DW_AT_base_types
case|:
return|return
literal|"DW_AT_base_types"
return|;
case|case
name|DW_AT_calling_convention
case|:
return|return
literal|"DW_AT_calling_convention"
return|;
case|case
name|DW_AT_count
case|:
return|return
literal|"DW_AT_count"
return|;
case|case
name|DW_AT_data_member_location
case|:
return|return
literal|"DW_AT_data_member_location"
return|;
case|case
name|DW_AT_decl_column
case|:
return|return
literal|"DW_AT_decl_column"
return|;
case|case
name|DW_AT_decl_file
case|:
return|return
literal|"DW_AT_decl_file"
return|;
case|case
name|DW_AT_decl_line
case|:
return|return
literal|"DW_AT_decl_line"
return|;
case|case
name|DW_AT_declaration
case|:
return|return
literal|"DW_AT_declaration"
return|;
case|case
name|DW_AT_discr_list
case|:
return|return
literal|"DW_AT_discr_list"
return|;
case|case
name|DW_AT_encoding
case|:
return|return
literal|"DW_AT_encoding"
return|;
case|case
name|DW_AT_external
case|:
return|return
literal|"DW_AT_external"
return|;
case|case
name|DW_AT_frame_base
case|:
return|return
literal|"DW_AT_frame_base"
return|;
case|case
name|DW_AT_friend
case|:
return|return
literal|"DW_AT_friend"
return|;
case|case
name|DW_AT_identifier_case
case|:
return|return
literal|"DW_AT_identifier_case"
return|;
case|case
name|DW_AT_macro_info
case|:
return|return
literal|"DW_AT_macro_info"
return|;
case|case
name|DW_AT_namelist_items
case|:
return|return
literal|"DW_AT_namelist_items"
return|;
case|case
name|DW_AT_priority
case|:
return|return
literal|"DW_AT_priority"
return|;
case|case
name|DW_AT_segment
case|:
return|return
literal|"DW_AT_segment"
return|;
case|case
name|DW_AT_specification
case|:
return|return
literal|"DW_AT_specification"
return|;
case|case
name|DW_AT_static_link
case|:
return|return
literal|"DW_AT_static_link"
return|;
case|case
name|DW_AT_type
case|:
return|return
literal|"DW_AT_type"
return|;
case|case
name|DW_AT_use_location
case|:
return|return
literal|"DW_AT_use_location"
return|;
case|case
name|DW_AT_variable_parameter
case|:
return|return
literal|"DW_AT_variable_parameter"
return|;
case|case
name|DW_AT_virtuality
case|:
return|return
literal|"DW_AT_virtuality"
return|;
case|case
name|DW_AT_vtable_elem_location
case|:
return|return
literal|"DW_AT_vtable_elem_location"
return|;
comment|/* DWARF 2.1 values.  */
case|case
name|DW_AT_allocated
case|:
return|return
literal|"DW_AT_allocated"
return|;
case|case
name|DW_AT_associated
case|:
return|return
literal|"DW_AT_associated"
return|;
case|case
name|DW_AT_data_location
case|:
return|return
literal|"DW_AT_data_location"
return|;
case|case
name|DW_AT_stride
case|:
return|return
literal|"DW_AT_stride"
return|;
case|case
name|DW_AT_entry_pc
case|:
return|return
literal|"DW_AT_entry_pc"
return|;
case|case
name|DW_AT_use_UTF8
case|:
return|return
literal|"DW_AT_use_UTF8"
return|;
case|case
name|DW_AT_extension
case|:
return|return
literal|"DW_AT_extension"
return|;
case|case
name|DW_AT_ranges
case|:
return|return
literal|"DW_AT_ranges"
return|;
case|case
name|DW_AT_trampoline
case|:
return|return
literal|"DW_AT_trampoline"
return|;
case|case
name|DW_AT_call_column
case|:
return|return
literal|"DW_AT_call_column"
return|;
case|case
name|DW_AT_call_file
case|:
return|return
literal|"DW_AT_call_file"
return|;
case|case
name|DW_AT_call_line
case|:
return|return
literal|"DW_AT_call_line"
return|;
comment|/* SGI/MIPS extensions.  */
case|case
name|DW_AT_MIPS_fde
case|:
return|return
literal|"DW_AT_MIPS_fde"
return|;
case|case
name|DW_AT_MIPS_loop_begin
case|:
return|return
literal|"DW_AT_MIPS_loop_begin"
return|;
case|case
name|DW_AT_MIPS_tail_loop_begin
case|:
return|return
literal|"DW_AT_MIPS_tail_loop_begin"
return|;
case|case
name|DW_AT_MIPS_epilog_begin
case|:
return|return
literal|"DW_AT_MIPS_epilog_begin"
return|;
case|case
name|DW_AT_MIPS_loop_unroll_factor
case|:
return|return
literal|"DW_AT_MIPS_loop_unroll_factor"
return|;
case|case
name|DW_AT_MIPS_software_pipeline_depth
case|:
return|return
literal|"DW_AT_MIPS_software_pipeline_depth"
return|;
case|case
name|DW_AT_MIPS_linkage_name
case|:
return|return
literal|"DW_AT_MIPS_linkage_name"
return|;
case|case
name|DW_AT_MIPS_stride
case|:
return|return
literal|"DW_AT_MIPS_stride"
return|;
case|case
name|DW_AT_MIPS_abstract_name
case|:
return|return
literal|"DW_AT_MIPS_abstract_name"
return|;
case|case
name|DW_AT_MIPS_clone_origin
case|:
return|return
literal|"DW_AT_MIPS_clone_origin"
return|;
case|case
name|DW_AT_MIPS_has_inlines
case|:
return|return
literal|"DW_AT_MIPS_has_inlines"
return|;
comment|/* GNU extensions.  */
case|case
name|DW_AT_sf_names
case|:
return|return
literal|"DW_AT_sf_names"
return|;
case|case
name|DW_AT_src_info
case|:
return|return
literal|"DW_AT_src_info"
return|;
case|case
name|DW_AT_mac_info
case|:
return|return
literal|"DW_AT_mac_info"
return|;
case|case
name|DW_AT_src_coords
case|:
return|return
literal|"DW_AT_src_coords"
return|;
case|case
name|DW_AT_body_begin
case|:
return|return
literal|"DW_AT_body_begin"
return|;
case|case
name|DW_AT_body_end
case|:
return|return
literal|"DW_AT_body_end"
return|;
case|case
name|DW_AT_GNU_vector
case|:
return|return
literal|"DW_AT_GNU_vector"
return|;
comment|/* UPC extension.  */
case|case
name|DW_AT_upc_threads_scaled
case|:
return|return
literal|"DW_AT_upc_threads_scaled"
return|;
default|default:
block|{
specifier|static
name|char
name|buffer
index|[
literal|100
index|]
decl_stmt|;
name|snprintf
argument_list|(
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Unknown AT value: %lx"
argument_list|)
argument_list|,
name|attribute
argument_list|)
expr_stmt|;
return|return
name|buffer
return|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|unsigned
name|char
modifier|*
name|read_and_display_attr
parameter_list|(
name|unsigned
name|long
name|attribute
parameter_list|,
name|unsigned
name|long
name|form
parameter_list|,
name|unsigned
name|char
modifier|*
name|data
parameter_list|,
name|unsigned
name|long
name|cu_offset
parameter_list|,
name|unsigned
name|long
name|pointer_size
parameter_list|,
name|unsigned
name|long
name|offset_size
parameter_list|,
name|int
name|dwarf_version
parameter_list|,
name|debug_info
modifier|*
name|debug_info_p
parameter_list|,
name|int
name|do_loc
parameter_list|)
block|{
if|if
condition|(
operator|!
name|do_loc
condition|)
name|printf
argument_list|(
literal|"     %-18s:"
argument_list|,
name|get_AT_name
argument_list|(
name|attribute
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|=
name|read_and_display_attr_value
argument_list|(
name|attribute
argument_list|,
name|form
argument_list|,
name|data
argument_list|,
name|cu_offset
argument_list|,
name|pointer_size
argument_list|,
name|offset_size
argument_list|,
name|dwarf_version
argument_list|,
name|debug_info_p
argument_list|,
name|do_loc
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|do_loc
condition|)
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return
name|data
return|;
block|}
end_function

begin_comment
comment|/* Process the contents of a .debug_info section.  If do_loc is non-zero    then we are scanning for location lists and we do not want to display    anything to the user.  */
end_comment

begin_function
specifier|static
name|int
name|process_debug_info
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
parameter_list|,
name|int
name|do_loc
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|start
init|=
name|section
operator|->
name|start
decl_stmt|;
name|unsigned
name|char
modifier|*
name|end
init|=
name|start
operator|+
name|section
operator|->
name|size
decl_stmt|;
name|unsigned
name|char
modifier|*
name|section_begin
decl_stmt|;
name|unsigned
name|int
name|unit
decl_stmt|;
name|unsigned
name|int
name|num_units
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|do_loc
operator|||
name|do_debug_loc
operator|||
name|do_debug_ranges
operator|)
operator|&&
name|num_debug_info_entries
operator|==
literal|0
condition|)
block|{
name|unsigned
name|long
name|length
decl_stmt|;
comment|/* First scan the section to get the number of comp units.  */
for|for
control|(
name|section_begin
operator|=
name|start
operator|,
name|num_units
operator|=
literal|0
init|;
name|section_begin
operator|<
name|end
condition|;
name|num_units
operator|++
control|)
block|{
comment|/* Read the first 4 bytes.  For a 32-bit DWARF section, this 	     will be the length.  For a 64-bit DWARF section, it'll be 	     the escape code 0xffffffff followed by an 8 byte length.  */
name|length
operator|=
name|byte_get
argument_list|(
name|section_begin
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|==
literal|0xffffffff
condition|)
block|{
name|length
operator|=
name|byte_get
argument_list|(
name|section_begin
operator|+
literal|4
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|section_begin
operator|+=
name|length
operator|+
literal|12
expr_stmt|;
block|}
else|else
name|section_begin
operator|+=
name|length
operator|+
literal|4
expr_stmt|;
block|}
if|if
condition|(
name|num_units
operator|==
literal|0
condition|)
block|{
name|error
argument_list|(
name|_
argument_list|(
literal|"No comp units in %s section ?"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
comment|/* Then allocate an array to hold the information.  */
name|debug_information
operator|=
name|cmalloc
argument_list|(
name|num_units
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|debug_information
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug_information
operator|==
name|NULL
condition|)
block|{
name|error
argument_list|(
name|_
argument_list|(
literal|"Not enough memory for a debug info array of %u entries"
argument_list|)
argument_list|,
name|num_units
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
block|}
if|if
condition|(
operator|!
name|do_loc
condition|)
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|"The section %s contains:\n\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
name|load_debug_section
argument_list|(
name|str
argument_list|,
name|file
argument_list|)
expr_stmt|;
block|}
name|load_debug_section
argument_list|(
name|abbrev
argument_list|,
name|file
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug_displays
index|[
name|abbrev
index|]
operator|.
name|section
operator|.
name|start
operator|==
name|NULL
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"Unable to locate %s section!\n"
argument_list|)
argument_list|,
name|debug_displays
index|[
name|abbrev
index|]
operator|.
name|section
operator|.
name|name
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
for|for
control|(
name|section_begin
operator|=
name|start
operator|,
name|unit
operator|=
literal|0
init|;
name|start
operator|<
name|end
condition|;
name|unit
operator|++
control|)
block|{
name|DWARF2_Internal_CompUnit
name|compunit
decl_stmt|;
name|unsigned
name|char
modifier|*
name|hdrptr
decl_stmt|;
name|unsigned
name|char
modifier|*
name|cu_abbrev_offset_ptr
decl_stmt|;
name|unsigned
name|char
modifier|*
name|tags
decl_stmt|;
name|int
name|level
decl_stmt|;
name|unsigned
name|long
name|cu_offset
decl_stmt|;
name|int
name|offset_size
decl_stmt|;
name|int
name|initial_length_size
decl_stmt|;
name|hdrptr
operator|=
name|start
expr_stmt|;
name|compunit
operator|.
name|cu_length
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|compunit
operator|.
name|cu_length
operator|==
literal|0xffffffff
condition|)
block|{
name|compunit
operator|.
name|cu_length
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|8
expr_stmt|;
name|offset_size
operator|=
literal|8
expr_stmt|;
name|initial_length_size
operator|=
literal|12
expr_stmt|;
block|}
else|else
block|{
name|offset_size
operator|=
literal|4
expr_stmt|;
name|initial_length_size
operator|=
literal|4
expr_stmt|;
block|}
name|compunit
operator|.
name|cu_version
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|2
expr_stmt|;
name|cu_offset
operator|=
name|start
operator|-
name|section_begin
expr_stmt|;
name|cu_abbrev_offset_ptr
operator|=
name|hdrptr
expr_stmt|;
name|compunit
operator|.
name|cu_abbrev_offset
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
name|offset_size
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
name|offset_size
expr_stmt|;
name|compunit
operator|.
name|cu_pointer_size
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|do_loc
operator|||
name|do_debug_loc
operator|||
name|do_debug_ranges
operator|)
operator|&&
name|num_debug_info_entries
operator|==
literal|0
condition|)
block|{
name|debug_information
index|[
name|unit
index|]
operator|.
name|cu_offset
operator|=
name|cu_offset
expr_stmt|;
name|debug_information
index|[
name|unit
index|]
operator|.
name|pointer_size
operator|=
name|compunit
operator|.
name|cu_pointer_size
expr_stmt|;
name|debug_information
index|[
name|unit
index|]
operator|.
name|base_address
operator|=
literal|0
expr_stmt|;
name|debug_information
index|[
name|unit
index|]
operator|.
name|loc_offsets
operator|=
name|NULL
expr_stmt|;
name|debug_information
index|[
name|unit
index|]
operator|.
name|have_frame_base
operator|=
name|NULL
expr_stmt|;
name|debug_information
index|[
name|unit
index|]
operator|.
name|max_loc_offsets
operator|=
literal|0
expr_stmt|;
name|debug_information
index|[
name|unit
index|]
operator|.
name|num_loc_offsets
operator|=
literal|0
expr_stmt|;
name|debug_information
index|[
name|unit
index|]
operator|.
name|range_lists
operator|=
name|NULL
expr_stmt|;
name|debug_information
index|[
name|unit
index|]
operator|.
name|max_range_lists
operator|=
literal|0
expr_stmt|;
name|debug_information
index|[
name|unit
index|]
operator|.
name|num_range_lists
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|do_loc
condition|)
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Compilation Unit @ offset 0x%lx:\n"
argument_list|)
argument_list|,
name|cu_offset
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"   Length:        %ld\n"
argument_list|)
argument_list|,
name|compunit
operator|.
name|cu_length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"   Version:       %d\n"
argument_list|)
argument_list|,
name|compunit
operator|.
name|cu_version
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"   Abbrev Offset: %ld\n"
argument_list|)
argument_list|,
name|compunit
operator|.
name|cu_abbrev_offset
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"   Pointer Size:  %d\n"
argument_list|)
argument_list|,
name|compunit
operator|.
name|cu_pointer_size
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|cu_offset
operator|+
name|compunit
operator|.
name|cu_length
operator|+
name|initial_length_size
operator|>
name|section
operator|->
name|size
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"Debug info is corrupted, length is invalid (section is %lu bytes)\n"
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|section
operator|->
name|size
argument_list|)
expr_stmt|;
break|break;
block|}
name|tags
operator|=
name|hdrptr
expr_stmt|;
name|start
operator|+=
name|compunit
operator|.
name|cu_length
operator|+
name|initial_length_size
expr_stmt|;
if|if
condition|(
name|compunit
operator|.
name|cu_version
operator|!=
literal|2
operator|&&
name|compunit
operator|.
name|cu_version
operator|!=
literal|3
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"Only version 2 and 3 DWARF debug information is currently supported.\n"
argument_list|)
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|free_abbrevs
argument_list|()
expr_stmt|;
comment|/* Process the abbrevs used by this compilation unit. DWARF 	 sections under Mach-O have non-zero addresses.  */
if|if
condition|(
name|compunit
operator|.
name|cu_abbrev_offset
operator|>=
name|debug_displays
index|[
name|abbrev
index|]
operator|.
name|section
operator|.
name|size
condition|)
name|warn
argument_list|(
name|_
argument_list|(
literal|"Debug info is corrupted, abbrev offset is invalid (section is %lu bytes)\n"
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|debug_displays
index|[
name|abbrev
index|]
operator|.
name|section
operator|.
name|size
argument_list|)
expr_stmt|;
else|else
name|process_abbrev_section
argument_list|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|debug_displays
index|[
name|abbrev
index|]
operator|.
name|section
operator|.
name|start
operator|+
name|compunit
operator|.
name|cu_abbrev_offset
operator|-
name|debug_displays
index|[
name|abbrev
index|]
operator|.
name|section
operator|.
name|address
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|debug_displays
index|[
name|abbrev
index|]
operator|.
name|section
operator|.
name|start
operator|+
name|debug_displays
index|[
name|abbrev
index|]
operator|.
name|section
operator|.
name|size
argument_list|)
expr_stmt|;
name|level
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|tags
operator|<
name|start
condition|)
block|{
name|unsigned
name|int
name|bytes_read
decl_stmt|;
name|unsigned
name|long
name|abbrev_number
decl_stmt|;
name|abbrev_entry
modifier|*
name|entry
decl_stmt|;
name|abbrev_attr
modifier|*
name|attr
decl_stmt|;
name|abbrev_number
operator|=
name|read_leb128
argument_list|(
name|tags
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|tags
operator|+=
name|bytes_read
expr_stmt|;
comment|/* A null DIE marks the end of a list of children.  */
if|if
condition|(
name|abbrev_number
operator|==
literal|0
condition|)
block|{
operator|--
name|level
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
operator|!
name|do_loc
condition|)
name|printf
argument_list|(
name|_
argument_list|(
literal|"<%d><%lx>: Abbrev Number: %lu"
argument_list|)
argument_list|,
name|level
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|tags
operator|-
name|section_begin
operator|-
name|bytes_read
argument_list|)
argument_list|,
name|abbrev_number
argument_list|)
expr_stmt|;
comment|/* Scan through the abbreviation list until we reach the 	     correct entry.  */
for|for
control|(
name|entry
operator|=
name|first_abbrev
init|;
name|entry
operator|&&
name|entry
operator|->
name|entry
operator|!=
name|abbrev_number
condition|;
name|entry
operator|=
name|entry
operator|->
name|next
control|)
continue|continue;
if|if
condition|(
name|entry
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
operator|!
name|do_loc
condition|)
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
block|}
name|warn
argument_list|(
name|_
argument_list|(
literal|"Unable to locate entry %lu in the abbreviation table\n"
argument_list|)
argument_list|,
name|abbrev_number
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|do_loc
condition|)
name|printf
argument_list|(
name|_
argument_list|(
literal|" (%s)\n"
argument_list|)
argument_list|,
name|get_TAG_name
argument_list|(
name|entry
operator|->
name|tag
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|entry
operator|->
name|tag
condition|)
block|{
default|default:
name|need_base_address
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|DW_TAG_compile_unit
case|:
name|need_base_address
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|DW_TAG_entry_point
case|:
case|case
name|DW_TAG_subprogram
case|:
name|need_base_address
operator|=
literal|0
expr_stmt|;
comment|/* Assuming that there is no DW_AT_frame_base.  */
name|have_frame_base
operator|=
literal|0
expr_stmt|;
break|break;
block|}
for|for
control|(
name|attr
operator|=
name|entry
operator|->
name|first_attr
init|;
name|attr
condition|;
name|attr
operator|=
name|attr
operator|->
name|next
control|)
block|{
if|if
condition|(
operator|!
name|do_loc
condition|)
comment|/* Show the offset from where the tag was extracted.  */
name|printf
argument_list|(
literal|"<%2lx>"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|tags
operator|-
name|section_begin
argument_list|)
argument_list|)
expr_stmt|;
name|tags
operator|=
name|read_and_display_attr
argument_list|(
name|attr
operator|->
name|attribute
argument_list|,
name|attr
operator|->
name|form
argument_list|,
name|tags
argument_list|,
name|cu_offset
argument_list|,
name|compunit
operator|.
name|cu_pointer_size
argument_list|,
name|offset_size
argument_list|,
name|compunit
operator|.
name|cu_version
argument_list|,
operator|&
name|debug_information
index|[
name|unit
index|]
argument_list|,
name|do_loc
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|entry
operator|->
name|children
condition|)
operator|++
name|level
expr_stmt|;
block|}
block|}
comment|/* Set num_debug_info_entries here so that it can be used to check if      we need to process .debug_loc and .debug_ranges sections.  */
if|if
condition|(
operator|(
name|do_loc
operator|||
name|do_debug_loc
operator|||
name|do_debug_ranges
operator|)
operator|&&
name|num_debug_info_entries
operator|==
literal|0
condition|)
name|num_debug_info_entries
operator|=
name|num_units
expr_stmt|;
if|if
condition|(
operator|!
name|do_loc
condition|)
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* Locate and scan the .debug_info section in the file and record the pointer    sizes and offsets for the compilation units in it.  Usually an executable    will have just one pointer size, but this is not guaranteed, and so we try    not to make any assumptions.  Returns zero upon failure, or the number of    compilation units upon success.  */
end_comment

begin_function
specifier|static
name|unsigned
name|int
name|load_debug_info
parameter_list|(
name|void
modifier|*
name|file
parameter_list|)
block|{
comment|/* Reset the last pointer size so that we can issue correct error      messages if we are displaying the contents of more than one section.  */
name|last_pointer_size
operator|=
literal|0
expr_stmt|;
name|warned_about_missing_comp_units
operator|=
name|FALSE
expr_stmt|;
comment|/* If we already have the information there is nothing else to do.  */
if|if
condition|(
name|num_debug_info_entries
operator|>
literal|0
condition|)
return|return
name|num_debug_info_entries
return|;
if|if
condition|(
name|load_debug_section
argument_list|(
name|info
argument_list|,
name|file
argument_list|)
operator|&&
name|process_debug_info
argument_list|(
operator|&
name|debug_displays
index|[
name|info
index|]
operator|.
name|section
argument_list|,
name|file
argument_list|,
literal|1
argument_list|)
condition|)
return|return
name|num_debug_info_entries
return|;
else|else
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|display_debug_lines
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|start
init|=
name|section
operator|->
name|start
decl_stmt|;
name|unsigned
name|char
modifier|*
name|data
init|=
name|start
decl_stmt|;
name|unsigned
name|char
modifier|*
name|end
init|=
name|start
operator|+
name|section
operator|->
name|size
decl_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"\nDump of debug contents of section %s:\n\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
name|load_debug_info
argument_list|(
name|file
argument_list|)
expr_stmt|;
while|while
condition|(
name|data
operator|<
name|end
condition|)
block|{
name|DWARF2_Internal_LineInfo
name|info
decl_stmt|;
name|unsigned
name|char
modifier|*
name|standard_opcodes
decl_stmt|;
name|unsigned
name|char
modifier|*
name|end_of_sequence
decl_stmt|;
name|unsigned
name|char
modifier|*
name|hdrptr
decl_stmt|;
name|int
name|initial_length_size
decl_stmt|;
name|int
name|offset_size
decl_stmt|;
name|int
name|i
decl_stmt|;
name|hdrptr
operator|=
name|data
expr_stmt|;
comment|/* Check the length of the block.  */
name|info
operator|.
name|li_length
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|info
operator|.
name|li_length
operator|==
literal|0xffffffff
condition|)
block|{
comment|/* This section is 64-bit DWARF 3.  */
name|info
operator|.
name|li_length
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|8
expr_stmt|;
name|offset_size
operator|=
literal|8
expr_stmt|;
name|initial_length_size
operator|=
literal|12
expr_stmt|;
block|}
else|else
block|{
name|offset_size
operator|=
literal|4
expr_stmt|;
name|initial_length_size
operator|=
literal|4
expr_stmt|;
block|}
if|if
condition|(
name|info
operator|.
name|li_length
operator|+
name|initial_length_size
operator|>
name|section
operator|->
name|size
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"The line info appears to be corrupt - the section is too small\n"
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
comment|/* Check its version number.  */
name|info
operator|.
name|li_version
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
name|info
operator|.
name|li_version
operator|!=
literal|2
operator|&&
name|info
operator|.
name|li_version
operator|!=
literal|3
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"Only DWARF version 2 and 3 line info is currently supported.\n"
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|info
operator|.
name|li_prologue_length
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
name|offset_size
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
name|offset_size
expr_stmt|;
name|info
operator|.
name|li_min_insn_length
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|hdrptr
operator|++
expr_stmt|;
name|info
operator|.
name|li_default_is_stmt
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|hdrptr
operator|++
expr_stmt|;
name|info
operator|.
name|li_line_base
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|hdrptr
operator|++
expr_stmt|;
name|info
operator|.
name|li_line_range
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|hdrptr
operator|++
expr_stmt|;
name|info
operator|.
name|li_opcode_base
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|hdrptr
operator|++
expr_stmt|;
comment|/* Sign extend the line base field.  */
name|info
operator|.
name|li_line_base
operator|<<=
literal|24
expr_stmt|;
name|info
operator|.
name|li_line_base
operator|>>=
literal|24
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Length:                      %ld\n"
argument_list|)
argument_list|,
name|info
operator|.
name|li_length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  DWARF Version:               %d\n"
argument_list|)
argument_list|,
name|info
operator|.
name|li_version
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Prologue Length:             %d\n"
argument_list|)
argument_list|,
name|info
operator|.
name|li_prologue_length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Minimum Instruction Length:  %d\n"
argument_list|)
argument_list|,
name|info
operator|.
name|li_min_insn_length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Initial value of 'is_stmt':  %d\n"
argument_list|)
argument_list|,
name|info
operator|.
name|li_default_is_stmt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Line Base:                   %d\n"
argument_list|)
argument_list|,
name|info
operator|.
name|li_line_base
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Line Range:                  %d\n"
argument_list|)
argument_list|,
name|info
operator|.
name|li_line_range
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Opcode Base:                 %d\n"
argument_list|)
argument_list|,
name|info
operator|.
name|li_opcode_base
argument_list|)
expr_stmt|;
name|end_of_sequence
operator|=
name|data
operator|+
name|info
operator|.
name|li_length
operator|+
name|initial_length_size
expr_stmt|;
name|reset_state_machine
argument_list|(
name|info
operator|.
name|li_default_is_stmt
argument_list|)
expr_stmt|;
comment|/* Display the contents of the Opcodes table.  */
name|standard_opcodes
operator|=
name|hdrptr
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"\n Opcodes:\n"
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|info
operator|.
name|li_opcode_base
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Opcode %d has %d args\n"
argument_list|)
argument_list|,
name|i
argument_list|,
name|standard_opcodes
index|[
name|i
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
comment|/* Display the contents of the Directory table.  */
name|data
operator|=
name|standard_opcodes
operator|+
name|info
operator|.
name|li_opcode_base
operator|-
literal|1
expr_stmt|;
if|if
condition|(
operator|*
name|data
operator|==
literal|0
condition|)
name|printf
argument_list|(
name|_
argument_list|(
literal|"\n The Directory Table is empty.\n"
argument_list|)
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|"\n The Directory Table:\n"
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|data
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|"  %s\n"
argument_list|)
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|data
operator|+=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
operator|+
literal|1
expr_stmt|;
block|}
block|}
comment|/* Skip the NUL at the end of the table.  */
name|data
operator|++
expr_stmt|;
comment|/* Display the contents of the File Name table.  */
if|if
condition|(
operator|*
name|data
operator|==
literal|0
condition|)
name|printf
argument_list|(
name|_
argument_list|(
literal|"\n The File Name Table is empty.\n"
argument_list|)
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|"\n The File Name Table:\n"
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Entry\tDir\tTime\tSize\tName\n"
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|data
operator|!=
literal|0
condition|)
block|{
name|unsigned
name|char
modifier|*
name|name
decl_stmt|;
name|unsigned
name|int
name|bytes_read
decl_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  %d\t"
argument_list|)
argument_list|,
operator|++
name|state_machine_regs
operator|.
name|last_file_entry
argument_list|)
expr_stmt|;
name|name
operator|=
name|data
expr_stmt|;
name|data
operator|+=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
operator|+
literal|1
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"%lu\t"
argument_list|)
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"%lu\t"
argument_list|)
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"%lu\t"
argument_list|)
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"%s\n"
argument_list|)
argument_list|,
name|name
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* Skip the NUL at the end of the table.  */
name|data
operator|++
expr_stmt|;
comment|/* Now display the statements.  */
name|printf
argument_list|(
name|_
argument_list|(
literal|"\n Line Number Statements:\n"
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|data
operator|<
name|end_of_sequence
condition|)
block|{
name|unsigned
name|char
name|op_code
decl_stmt|;
name|int
name|adv
decl_stmt|;
name|unsigned
name|long
name|int
name|uladv
decl_stmt|;
name|unsigned
name|int
name|bytes_read
decl_stmt|;
name|op_code
operator|=
operator|*
name|data
operator|++
expr_stmt|;
if|if
condition|(
name|op_code
operator|>=
name|info
operator|.
name|li_opcode_base
condition|)
block|{
name|op_code
operator|-=
name|info
operator|.
name|li_opcode_base
expr_stmt|;
name|uladv
operator|=
operator|(
name|op_code
operator|/
name|info
operator|.
name|li_line_range
operator|)
operator|*
name|info
operator|.
name|li_min_insn_length
expr_stmt|;
name|state_machine_regs
operator|.
name|address
operator|+=
name|uladv
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Special opcode %d: advance Address by %lu to 0x%lx"
argument_list|)
argument_list|,
name|op_code
argument_list|,
name|uladv
argument_list|,
name|state_machine_regs
operator|.
name|address
argument_list|)
expr_stmt|;
name|adv
operator|=
operator|(
name|op_code
operator|%
name|info
operator|.
name|li_line_range
operator|)
operator|+
name|info
operator|.
name|li_line_base
expr_stmt|;
name|state_machine_regs
operator|.
name|line
operator|+=
name|adv
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|" and Line by %d to %d\n"
argument_list|)
argument_list|,
name|adv
argument_list|,
name|state_machine_regs
operator|.
name|line
argument_list|)
expr_stmt|;
block|}
else|else
switch|switch
condition|(
name|op_code
condition|)
block|{
case|case
name|DW_LNS_extended_op
case|:
name|data
operator|+=
name|process_extended_line_op
argument_list|(
name|data
argument_list|,
name|info
operator|.
name|li_default_is_stmt
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LNS_copy
case|:
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Copy\n"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LNS_advance_pc
case|:
name|uladv
operator|=
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|uladv
operator|*=
name|info
operator|.
name|li_min_insn_length
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
name|state_machine_regs
operator|.
name|address
operator|+=
name|uladv
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Advance PC by %lu to 0x%lx\n"
argument_list|)
argument_list|,
name|uladv
argument_list|,
name|state_machine_regs
operator|.
name|address
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LNS_advance_line
case|:
name|adv
operator|=
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
name|state_machine_regs
operator|.
name|line
operator|+=
name|adv
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Advance Line by %d to %d\n"
argument_list|)
argument_list|,
name|adv
argument_list|,
name|state_machine_regs
operator|.
name|line
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LNS_set_file
case|:
name|adv
operator|=
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Set File Name to entry %d in the File Name Table\n"
argument_list|)
argument_list|,
name|adv
argument_list|)
expr_stmt|;
name|state_machine_regs
operator|.
name|file
operator|=
name|adv
expr_stmt|;
break|break;
case|case
name|DW_LNS_set_column
case|:
name|uladv
operator|=
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Set column to %lu\n"
argument_list|)
argument_list|,
name|uladv
argument_list|)
expr_stmt|;
name|state_machine_regs
operator|.
name|column
operator|=
name|uladv
expr_stmt|;
break|break;
case|case
name|DW_LNS_negate_stmt
case|:
name|adv
operator|=
name|state_machine_regs
operator|.
name|is_stmt
expr_stmt|;
name|adv
operator|=
operator|!
name|adv
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Set is_stmt to %d\n"
argument_list|)
argument_list|,
name|adv
argument_list|)
expr_stmt|;
name|state_machine_regs
operator|.
name|is_stmt
operator|=
name|adv
expr_stmt|;
break|break;
case|case
name|DW_LNS_set_basic_block
case|:
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Set basic block\n"
argument_list|)
argument_list|)
expr_stmt|;
name|state_machine_regs
operator|.
name|basic_block
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|DW_LNS_const_add_pc
case|:
name|uladv
operator|=
operator|(
operator|(
operator|(
literal|255
operator|-
name|info
operator|.
name|li_opcode_base
operator|)
operator|/
name|info
operator|.
name|li_line_range
operator|)
operator|*
name|info
operator|.
name|li_min_insn_length
operator|)
expr_stmt|;
name|state_machine_regs
operator|.
name|address
operator|+=
name|uladv
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Advance PC by constant %lu to 0x%lx\n"
argument_list|)
argument_list|,
name|uladv
argument_list|,
name|state_machine_regs
operator|.
name|address
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LNS_fixed_advance_pc
case|:
name|uladv
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|2
expr_stmt|;
name|state_machine_regs
operator|.
name|address
operator|+=
name|uladv
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Advance PC by fixed size amount %lu to 0x%lx\n"
argument_list|)
argument_list|,
name|uladv
argument_list|,
name|state_machine_regs
operator|.
name|address
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LNS_set_prologue_end
case|:
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Set prologue_end to true\n"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LNS_set_epilogue_begin
case|:
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Set epilogue_begin to true\n"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_LNS_set_isa
case|:
name|uladv
operator|=
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Set ISA to %lu\n"
argument_list|)
argument_list|,
name|uladv
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Unknown opcode %d with operands: "
argument_list|)
argument_list|,
name|op_code
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|standard_opcodes
index|[
name|op_code
operator|-
literal|1
index|]
init|;
name|i
operator|>
literal|0
condition|;
operator|--
name|i
control|)
block|{
name|printf
argument_list|(
literal|"0x%lx%s"
argument_list|,
name|read_leb128
argument_list|(
name|data
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
argument_list|,
name|i
operator|==
literal|1
condition|?
literal|""
else|:
literal|", "
argument_list|)
expr_stmt|;
name|data
operator|+=
name|bytes_read
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|display_debug_pubnames
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|DWARF2_Internal_PubNames
name|pubnames
decl_stmt|;
name|unsigned
name|char
modifier|*
name|start
init|=
name|section
operator|->
name|start
decl_stmt|;
name|unsigned
name|char
modifier|*
name|end
init|=
name|start
operator|+
name|section
operator|->
name|size
decl_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"Contents of the %s section:\n\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
while|while
condition|(
name|start
operator|<
name|end
condition|)
block|{
name|unsigned
name|char
modifier|*
name|data
decl_stmt|;
name|unsigned
name|long
name|offset
decl_stmt|;
name|int
name|offset_size
decl_stmt|,
name|initial_length_size
decl_stmt|;
name|data
operator|=
name|start
expr_stmt|;
name|pubnames
operator|.
name|pn_length
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|pubnames
operator|.
name|pn_length
operator|==
literal|0xffffffff
condition|)
block|{
name|pubnames
operator|.
name|pn_length
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|8
expr_stmt|;
name|offset_size
operator|=
literal|8
expr_stmt|;
name|initial_length_size
operator|=
literal|12
expr_stmt|;
block|}
else|else
block|{
name|offset_size
operator|=
literal|4
expr_stmt|;
name|initial_length_size
operator|=
literal|4
expr_stmt|;
block|}
name|pubnames
operator|.
name|pn_version
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|2
expr_stmt|;
name|pubnames
operator|.
name|pn_offset
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
name|offset_size
argument_list|)
expr_stmt|;
name|data
operator|+=
name|offset_size
expr_stmt|;
name|pubnames
operator|.
name|pn_size
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
name|offset_size
argument_list|)
expr_stmt|;
name|data
operator|+=
name|offset_size
expr_stmt|;
name|start
operator|+=
name|pubnames
operator|.
name|pn_length
operator|+
name|initial_length_size
expr_stmt|;
if|if
condition|(
name|pubnames
operator|.
name|pn_version
operator|!=
literal|2
operator|&&
name|pubnames
operator|.
name|pn_version
operator|!=
literal|3
condition|)
block|{
specifier|static
name|int
name|warned
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|warned
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"Only DWARF 2 and 3 pubnames are currently supported\n"
argument_list|)
argument_list|)
expr_stmt|;
name|warned
operator|=
literal|1
expr_stmt|;
block|}
continue|continue;
block|}
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Length:                              %ld\n"
argument_list|)
argument_list|,
name|pubnames
operator|.
name|pn_length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Version:                             %d\n"
argument_list|)
argument_list|,
name|pubnames
operator|.
name|pn_version
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Offset into .debug_info section:     %ld\n"
argument_list|)
argument_list|,
name|pubnames
operator|.
name|pn_offset
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Size of area in .debug_info section: %ld\n"
argument_list|)
argument_list|,
name|pubnames
operator|.
name|pn_size
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"\n    Offset\tName\n"
argument_list|)
argument_list|)
expr_stmt|;
do|do
block|{
name|offset
operator|=
name|byte_get
argument_list|(
name|data
argument_list|,
name|offset_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|offset
operator|!=
literal|0
condition|)
block|{
name|data
operator|+=
name|offset_size
expr_stmt|;
name|printf
argument_list|(
literal|"    %-6ld\t\t%s\n"
argument_list|,
name|offset
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|data
operator|+=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
operator|+
literal|1
expr_stmt|;
block|}
block|}
do|while
condition|(
name|offset
operator|!=
literal|0
condition|)
do|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|display_debug_macinfo
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|start
init|=
name|section
operator|->
name|start
decl_stmt|;
name|unsigned
name|char
modifier|*
name|end
init|=
name|start
operator|+
name|section
operator|->
name|size
decl_stmt|;
name|unsigned
name|char
modifier|*
name|curr
init|=
name|start
decl_stmt|;
name|unsigned
name|int
name|bytes_read
decl_stmt|;
name|enum
name|dwarf_macinfo_record_type
name|op
decl_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"Contents of the %s section:\n\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
while|while
condition|(
name|curr
operator|<
name|end
condition|)
block|{
name|unsigned
name|int
name|lineno
decl_stmt|;
specifier|const
name|char
modifier|*
name|string
decl_stmt|;
name|op
operator|=
operator|*
name|curr
expr_stmt|;
name|curr
operator|++
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|DW_MACINFO_start_file
case|:
block|{
name|unsigned
name|int
name|filenum
decl_stmt|;
name|lineno
operator|=
name|read_leb128
argument_list|(
name|curr
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|curr
operator|+=
name|bytes_read
expr_stmt|;
name|filenum
operator|=
name|read_leb128
argument_list|(
name|curr
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|curr
operator|+=
name|bytes_read
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|" DW_MACINFO_start_file - lineno: %d filenum: %d\n"
argument_list|)
argument_list|,
name|lineno
argument_list|,
name|filenum
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DW_MACINFO_end_file
case|:
name|printf
argument_list|(
name|_
argument_list|(
literal|" DW_MACINFO_end_file\n"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_MACINFO_define
case|:
name|lineno
operator|=
name|read_leb128
argument_list|(
name|curr
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|curr
operator|+=
name|bytes_read
expr_stmt|;
name|string
operator|=
operator|(
name|char
operator|*
operator|)
name|curr
expr_stmt|;
name|curr
operator|+=
name|strlen
argument_list|(
name|string
argument_list|)
operator|+
literal|1
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|" DW_MACINFO_define - lineno : %d macro : %s\n"
argument_list|)
argument_list|,
name|lineno
argument_list|,
name|string
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_MACINFO_undef
case|:
name|lineno
operator|=
name|read_leb128
argument_list|(
name|curr
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|curr
operator|+=
name|bytes_read
expr_stmt|;
name|string
operator|=
operator|(
name|char
operator|*
operator|)
name|curr
expr_stmt|;
name|curr
operator|+=
name|strlen
argument_list|(
name|string
argument_list|)
operator|+
literal|1
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|" DW_MACINFO_undef - lineno : %d macro : %s\n"
argument_list|)
argument_list|,
name|lineno
argument_list|,
name|string
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_MACINFO_vendor_ext
case|:
block|{
name|unsigned
name|int
name|constant
decl_stmt|;
name|constant
operator|=
name|read_leb128
argument_list|(
name|curr
argument_list|,
operator|&
name|bytes_read
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|curr
operator|+=
name|bytes_read
expr_stmt|;
name|string
operator|=
operator|(
name|char
operator|*
operator|)
name|curr
expr_stmt|;
name|curr
operator|+=
name|strlen
argument_list|(
name|string
argument_list|)
operator|+
literal|1
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|" DW_MACINFO_vendor_ext - constant : %d string : %s\n"
argument_list|)
argument_list|,
name|constant
argument_list|,
name|string
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|display_debug_abbrev
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|abbrev_entry
modifier|*
name|entry
decl_stmt|;
name|unsigned
name|char
modifier|*
name|start
init|=
name|section
operator|->
name|start
decl_stmt|;
name|unsigned
name|char
modifier|*
name|end
init|=
name|start
operator|+
name|section
operator|->
name|size
decl_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"Contents of the %s section:\n\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
do|do
block|{
name|free_abbrevs
argument_list|()
expr_stmt|;
name|start
operator|=
name|process_abbrev_section
argument_list|(
name|start
argument_list|,
name|end
argument_list|)
expr_stmt|;
if|if
condition|(
name|first_abbrev
operator|==
name|NULL
condition|)
continue|continue;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Number TAG\n"
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|entry
operator|=
name|first_abbrev
init|;
name|entry
condition|;
name|entry
operator|=
name|entry
operator|->
name|next
control|)
block|{
name|abbrev_attr
modifier|*
name|attr
decl_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"   %ld      %s    [%s]\n"
argument_list|)
argument_list|,
name|entry
operator|->
name|entry
argument_list|,
name|get_TAG_name
argument_list|(
name|entry
operator|->
name|tag
argument_list|)
argument_list|,
name|entry
operator|->
name|children
condition|?
name|_
argument_list|(
literal|"has children"
argument_list|)
else|:
name|_
argument_list|(
literal|"no children"
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|attr
operator|=
name|entry
operator|->
name|first_attr
init|;
name|attr
condition|;
name|attr
operator|=
name|attr
operator|->
name|next
control|)
name|printf
argument_list|(
name|_
argument_list|(
literal|"    %-18s %s\n"
argument_list|)
argument_list|,
name|get_AT_name
argument_list|(
name|attr
operator|->
name|attribute
argument_list|)
argument_list|,
name|get_FORM_name
argument_list|(
name|attr
operator|->
name|form
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
do|while
condition|(
name|start
condition|)
do|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|display_debug_loc
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|start
init|=
name|section
operator|->
name|start
decl_stmt|;
name|unsigned
name|char
modifier|*
name|section_end
decl_stmt|;
name|unsigned
name|long
name|bytes
decl_stmt|;
name|unsigned
name|char
modifier|*
name|section_begin
init|=
name|start
decl_stmt|;
name|unsigned
name|int
name|num_loc_list
init|=
literal|0
decl_stmt|;
name|unsigned
name|long
name|last_offset
init|=
literal|0
decl_stmt|;
name|unsigned
name|int
name|first
init|=
literal|0
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|unsigned
name|int
name|j
decl_stmt|;
name|int
name|seen_first_offset
init|=
literal|0
decl_stmt|;
name|int
name|use_debug_info
init|=
literal|1
decl_stmt|;
name|unsigned
name|char
modifier|*
name|next
decl_stmt|;
name|bytes
operator|=
name|section
operator|->
name|size
expr_stmt|;
name|section_end
operator|=
name|start
operator|+
name|bytes
expr_stmt|;
if|if
condition|(
name|bytes
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|"\nThe %s section is empty.\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|load_debug_info
argument_list|(
name|file
argument_list|)
expr_stmt|;
comment|/* Check the order of location list in .debug_info section. If      offsets of location lists are in the ascending order, we can      use `debug_information' directly.  */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_debug_info_entries
condition|;
name|i
operator|++
control|)
block|{
name|unsigned
name|int
name|num
decl_stmt|;
name|num
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|num_loc_offsets
expr_stmt|;
name|num_loc_list
operator|+=
name|num
expr_stmt|;
comment|/* Check if we can use `debug_information' directly.  */
if|if
condition|(
name|use_debug_info
operator|&&
name|num
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|seen_first_offset
condition|)
block|{
comment|/* This is the first location list.  */
name|last_offset
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|loc_offsets
index|[
literal|0
index|]
expr_stmt|;
name|first
operator|=
name|i
expr_stmt|;
name|seen_first_offset
operator|=
literal|1
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
block|}
else|else
name|j
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
name|j
operator|<
name|num
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|last_offset
operator|>
name|debug_information
index|[
name|i
index|]
operator|.
name|loc_offsets
index|[
name|j
index|]
condition|)
block|{
name|use_debug_info
operator|=
literal|0
expr_stmt|;
break|break;
block|}
name|last_offset
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|loc_offsets
index|[
name|j
index|]
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
operator|!
name|use_debug_info
condition|)
comment|/* FIXME: Should we handle this case?  */
name|error
argument_list|(
name|_
argument_list|(
literal|"Location lists in .debug_info section aren't in ascending order!\n"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|seen_first_offset
condition|)
name|error
argument_list|(
name|_
argument_list|(
literal|"No location lists in .debug_info section!\n"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* DWARF sections under Mach-O have non-zero addresses.  */
if|if
condition|(
name|debug_information
index|[
name|first
index|]
operator|.
name|num_loc_offsets
operator|>
literal|0
operator|&&
name|debug_information
index|[
name|first
index|]
operator|.
name|loc_offsets
index|[
literal|0
index|]
operator|!=
name|section
operator|->
name|address
condition|)
name|warn
argument_list|(
name|_
argument_list|(
literal|"Location lists in %s section start at 0x%lx\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|,
name|debug_information
index|[
name|first
index|]
operator|.
name|loc_offsets
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"Contents of the %s section:\n\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"    Offset   Begin    End      Expression\n"
argument_list|)
argument_list|)
expr_stmt|;
name|seen_first_offset
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
name|first
init|;
name|i
operator|<
name|num_debug_info_entries
condition|;
name|i
operator|++
control|)
block|{
name|unsigned
name|long
name|begin
decl_stmt|;
name|unsigned
name|long
name|end
decl_stmt|;
name|unsigned
name|short
name|length
decl_stmt|;
name|unsigned
name|long
name|offset
decl_stmt|;
name|unsigned
name|int
name|pointer_size
decl_stmt|;
name|unsigned
name|long
name|cu_offset
decl_stmt|;
name|unsigned
name|long
name|base_address
decl_stmt|;
name|int
name|need_frame_base
decl_stmt|;
name|int
name|has_frame_base
decl_stmt|;
name|pointer_size
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|pointer_size
expr_stmt|;
name|cu_offset
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|cu_offset
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|debug_information
index|[
name|i
index|]
operator|.
name|num_loc_offsets
condition|;
name|j
operator|++
control|)
block|{
name|has_frame_base
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|have_frame_base
index|[
name|j
index|]
expr_stmt|;
comment|/* DWARF sections under Mach-O have non-zero addresses.  */
name|offset
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|loc_offsets
index|[
name|j
index|]
operator|-
name|section
operator|->
name|address
expr_stmt|;
name|next
operator|=
name|section_begin
operator|+
name|offset
expr_stmt|;
name|base_address
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|base_address
expr_stmt|;
if|if
condition|(
operator|!
name|seen_first_offset
condition|)
name|seen_first_offset
operator|=
literal|1
expr_stmt|;
else|else
block|{
if|if
condition|(
name|start
operator|<
name|next
condition|)
name|warn
argument_list|(
name|_
argument_list|(
literal|"There is a hole [0x%lx - 0x%lx] in .debug_loc section.\n"
argument_list|)
argument_list|,
call|(
name|long
call|)
argument_list|(
name|start
operator|-
name|section_begin
argument_list|)
argument_list|,
call|(
name|long
call|)
argument_list|(
name|next
operator|-
name|section_begin
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|start
operator|>
name|next
condition|)
name|warn
argument_list|(
name|_
argument_list|(
literal|"There is an overlap [0x%lx - 0x%lx] in .debug_loc section.\n"
argument_list|)
argument_list|,
call|(
name|long
call|)
argument_list|(
name|start
operator|-
name|section_begin
argument_list|)
argument_list|,
call|(
name|long
call|)
argument_list|(
name|next
operator|-
name|section_begin
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|start
operator|=
name|next
expr_stmt|;
if|if
condition|(
name|offset
operator|>=
name|bytes
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"Offset 0x%lx is bigger than .debug_loc section size.\n"
argument_list|)
argument_list|,
name|offset
argument_list|)
expr_stmt|;
continue|continue;
block|}
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
name|start
operator|+
literal|2
operator|*
name|pointer_size
operator|>
name|section_end
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"Location list starting at offset 0x%lx is not terminated.\n"
argument_list|)
argument_list|,
name|offset
argument_list|)
expr_stmt|;
break|break;
block|}
name|begin
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
name|pointer_size
argument_list|)
expr_stmt|;
name|start
operator|+=
name|pointer_size
expr_stmt|;
name|end
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
name|pointer_size
argument_list|)
expr_stmt|;
name|start
operator|+=
name|pointer_size
expr_stmt|;
if|if
condition|(
name|begin
operator|==
literal|0
operator|&&
name|end
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|"    %8.8lx<End of list>\n"
argument_list|)
argument_list|,
name|offset
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* Check base address specifiers.  */
if|if
condition|(
name|begin
operator|==
operator|-
literal|1UL
operator|&&
name|end
operator|!=
operator|-
literal|1UL
condition|)
block|{
name|base_address
operator|=
name|end
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"    %8.8lx %8.8lx %8.8lx (base address)\n"
argument_list|)
argument_list|,
name|offset
argument_list|,
name|begin
argument_list|,
name|end
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|start
operator|+
literal|2
operator|>
name|section_end
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"Location list starting at offset 0x%lx is not terminated.\n"
argument_list|)
argument_list|,
name|offset
argument_list|)
expr_stmt|;
break|break;
block|}
name|length
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|start
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
name|start
operator|+
name|length
operator|>
name|section_end
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"Location list starting at offset 0x%lx is not terminated.\n"
argument_list|)
argument_list|,
name|offset
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|"    %8.8lx %8.8lx %8.8lx ("
argument_list|,
name|offset
argument_list|,
name|begin
operator|+
name|base_address
argument_list|,
name|end
operator|+
name|base_address
argument_list|)
expr_stmt|;
name|need_frame_base
operator|=
name|decode_location_expression
argument_list|(
name|start
argument_list|,
name|pointer_size
argument_list|,
name|length
argument_list|,
name|cu_offset
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|')'
argument_list|)
expr_stmt|;
if|if
condition|(
name|need_frame_base
operator|&&
operator|!
name|has_frame_base
condition|)
name|printf
argument_list|(
name|_
argument_list|(
literal|" [without DW_AT_frame_base]"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|begin
operator|==
name|end
condition|)
name|fputs
argument_list|(
name|_
argument_list|(
literal|" (start == end)"
argument_list|)
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|begin
operator|>
name|end
condition|)
name|fputs
argument_list|(
name|_
argument_list|(
literal|" (start> end)"
argument_list|)
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|start
operator|+=
name|length
expr_stmt|;
block|}
block|}
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|display_debug_str
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|start
init|=
name|section
operator|->
name|start
decl_stmt|;
name|unsigned
name|long
name|bytes
init|=
name|section
operator|->
name|size
decl_stmt|;
name|dwarf_vma
name|addr
init|=
name|section
operator|->
name|address
decl_stmt|;
if|if
condition|(
name|bytes
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|"\nThe %s section is empty.\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|printf
argument_list|(
name|_
argument_list|(
literal|"Contents of the %s section:\n\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
while|while
condition|(
name|bytes
condition|)
block|{
name|int
name|j
decl_stmt|;
name|int
name|k
decl_stmt|;
name|int
name|lbytes
decl_stmt|;
name|lbytes
operator|=
operator|(
name|bytes
operator|>
literal|16
condition|?
literal|16
else|:
name|bytes
operator|)
expr_stmt|;
name|printf
argument_list|(
literal|"  0x%8.8lx "
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|addr
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|16
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|j
operator|<
name|lbytes
condition|)
name|printf
argument_list|(
literal|"%2.2x"
argument_list|,
name|start
index|[
name|j
index|]
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"  "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|j
operator|&
literal|3
operator|)
operator|==
literal|3
condition|)
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|lbytes
condition|;
name|j
operator|++
control|)
block|{
name|k
operator|=
name|start
index|[
name|j
index|]
expr_stmt|;
if|if
condition|(
name|k
operator|>=
literal|' '
operator|&&
name|k
operator|<
literal|0x80
condition|)
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|k
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"."
argument_list|)
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|start
operator|+=
name|lbytes
expr_stmt|;
name|addr
operator|+=
name|lbytes
expr_stmt|;
name|bytes
operator|-=
name|lbytes
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|display_debug_info
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
parameter_list|)
block|{
return|return
name|process_debug_info
argument_list|(
name|section
argument_list|,
name|file
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|display_debug_aranges
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|start
init|=
name|section
operator|->
name|start
decl_stmt|;
name|unsigned
name|char
modifier|*
name|end
init|=
name|start
operator|+
name|section
operator|->
name|size
decl_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"The section %s contains:\n\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
while|while
condition|(
name|start
operator|<
name|end
condition|)
block|{
name|unsigned
name|char
modifier|*
name|hdrptr
decl_stmt|;
name|DWARF2_Internal_ARange
name|arange
decl_stmt|;
name|unsigned
name|char
modifier|*
name|ranges
decl_stmt|;
name|unsigned
name|long
name|length
decl_stmt|;
name|unsigned
name|long
name|address
decl_stmt|;
name|unsigned
name|char
name|address_size
decl_stmt|;
name|int
name|excess
decl_stmt|;
name|int
name|offset_size
decl_stmt|;
name|int
name|initial_length_size
decl_stmt|;
name|hdrptr
operator|=
name|start
expr_stmt|;
name|arange
operator|.
name|ar_length
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|arange
operator|.
name|ar_length
operator|==
literal|0xffffffff
condition|)
block|{
name|arange
operator|.
name|ar_length
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|8
expr_stmt|;
name|offset_size
operator|=
literal|8
expr_stmt|;
name|initial_length_size
operator|=
literal|12
expr_stmt|;
block|}
else|else
block|{
name|offset_size
operator|=
literal|4
expr_stmt|;
name|initial_length_size
operator|=
literal|4
expr_stmt|;
block|}
name|arange
operator|.
name|ar_version
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|2
expr_stmt|;
name|arange
operator|.
name|ar_info_offset
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
name|offset_size
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
name|offset_size
expr_stmt|;
name|arange
operator|.
name|ar_pointer_size
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|1
expr_stmt|;
name|arange
operator|.
name|ar_segment_size
operator|=
name|byte_get
argument_list|(
name|hdrptr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|hdrptr
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
name|arange
operator|.
name|ar_version
operator|!=
literal|2
operator|&&
name|arange
operator|.
name|ar_version
operator|!=
literal|3
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"Only DWARF 2 and 3 aranges are currently supported.\n"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Length:                   %ld\n"
argument_list|)
argument_list|,
name|arange
operator|.
name|ar_length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Version:                  %d\n"
argument_list|)
argument_list|,
name|arange
operator|.
name|ar_version
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Offset into .debug_info:  %lx\n"
argument_list|)
argument_list|,
name|arange
operator|.
name|ar_info_offset
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Pointer Size:             %d\n"
argument_list|)
argument_list|,
name|arange
operator|.
name|ar_pointer_size
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"  Segment Size:             %d\n"
argument_list|)
argument_list|,
name|arange
operator|.
name|ar_segment_size
argument_list|)
expr_stmt|;
name|address_size
operator|=
name|arange
operator|.
name|ar_pointer_size
operator|+
name|arange
operator|.
name|ar_segment_size
expr_stmt|;
comment|/* The DWARF spec does not require that the address size be a power 	 of two, but we do.  This will have to change if we ever encounter 	 an uneven architecture.  */
if|if
condition|(
operator|(
name|address_size
operator|&
operator|(
name|address_size
operator|-
literal|1
operator|)
operator|)
operator|!=
literal|0
condition|)
block|{
name|warn
argument_list|(
name|_
argument_list|(
literal|"Pointer size + Segment size is not a power of two.\n"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|address_size
operator|>
literal|4
condition|)
name|printf
argument_list|(
name|_
argument_list|(
literal|"\n    Address            Length\n"
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
name|_
argument_list|(
literal|"\n    Address    Length\n"
argument_list|)
argument_list|)
expr_stmt|;
name|ranges
operator|=
name|hdrptr
expr_stmt|;
comment|/* Must pad to an alignment boundary that is twice the address size.  */
name|excess
operator|=
operator|(
name|hdrptr
operator|-
name|start
operator|)
operator|%
operator|(
literal|2
operator|*
name|address_size
operator|)
expr_stmt|;
if|if
condition|(
name|excess
condition|)
name|ranges
operator|+=
operator|(
literal|2
operator|*
name|address_size
operator|)
operator|-
name|excess
expr_stmt|;
name|start
operator|+=
name|arange
operator|.
name|ar_length
operator|+
name|initial_length_size
expr_stmt|;
while|while
condition|(
name|ranges
operator|+
literal|2
operator|*
name|address_size
operator|<=
name|start
condition|)
block|{
name|address
operator|=
name|byte_get
argument_list|(
name|ranges
argument_list|,
name|address_size
argument_list|)
expr_stmt|;
name|ranges
operator|+=
name|address_size
expr_stmt|;
name|length
operator|=
name|byte_get
argument_list|(
name|ranges
argument_list|,
name|address_size
argument_list|)
expr_stmt|;
name|ranges
operator|+=
name|address_size
expr_stmt|;
if|if
condition|(
name|address_size
operator|>
literal|4
condition|)
name|printf
argument_list|(
literal|"    0x%16.16lx 0x%lx\n"
argument_list|,
name|address
argument_list|,
name|length
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"    0x%8.8lx 0x%lx\n"
argument_list|,
name|address
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|display_debug_ranges
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|start
init|=
name|section
operator|->
name|start
decl_stmt|;
name|unsigned
name|char
modifier|*
name|section_end
decl_stmt|;
name|unsigned
name|long
name|bytes
decl_stmt|;
name|unsigned
name|char
modifier|*
name|section_begin
init|=
name|start
decl_stmt|;
name|unsigned
name|int
name|num_range_list
init|=
literal|0
decl_stmt|;
name|unsigned
name|long
name|last_offset
init|=
literal|0
decl_stmt|;
name|unsigned
name|int
name|first
init|=
literal|0
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|unsigned
name|int
name|j
decl_stmt|;
name|int
name|seen_first_offset
init|=
literal|0
decl_stmt|;
name|int
name|use_debug_info
init|=
literal|1
decl_stmt|;
name|unsigned
name|char
modifier|*
name|next
decl_stmt|;
name|bytes
operator|=
name|section
operator|->
name|size
expr_stmt|;
name|section_end
operator|=
name|start
operator|+
name|bytes
expr_stmt|;
if|if
condition|(
name|bytes
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|"\nThe %s section is empty.\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|load_debug_info
argument_list|(
name|file
argument_list|)
expr_stmt|;
comment|/* Check the order of range list in .debug_info section. If      offsets of range lists are in the ascending order, we can      use `debug_information' directly.  */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_debug_info_entries
condition|;
name|i
operator|++
control|)
block|{
name|unsigned
name|int
name|num
decl_stmt|;
name|num
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|num_range_lists
expr_stmt|;
name|num_range_list
operator|+=
name|num
expr_stmt|;
comment|/* Check if we can use `debug_information' directly.  */
if|if
condition|(
name|use_debug_info
operator|&&
name|num
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|seen_first_offset
condition|)
block|{
comment|/* This is the first range list.  */
name|last_offset
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|range_lists
index|[
literal|0
index|]
expr_stmt|;
name|first
operator|=
name|i
expr_stmt|;
name|seen_first_offset
operator|=
literal|1
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
block|}
else|else
name|j
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
name|j
operator|<
name|num
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|last_offset
operator|>
name|debug_information
index|[
name|i
index|]
operator|.
name|range_lists
index|[
name|j
index|]
condition|)
block|{
name|use_debug_info
operator|=
literal|0
expr_stmt|;
break|break;
block|}
name|last_offset
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|range_lists
index|[
name|j
index|]
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
operator|!
name|use_debug_info
condition|)
comment|/* FIXME: Should we handle this case?  */
name|error
argument_list|(
name|_
argument_list|(
literal|"Range lists in .debug_info section aren't in ascending order!\n"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|seen_first_offset
condition|)
name|error
argument_list|(
name|_
argument_list|(
literal|"No range lists in .debug_info section!\n"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* DWARF sections under Mach-O have non-zero addresses.  */
if|if
condition|(
name|debug_information
index|[
name|first
index|]
operator|.
name|num_range_lists
operator|>
literal|0
operator|&&
name|debug_information
index|[
name|first
index|]
operator|.
name|range_lists
index|[
literal|0
index|]
operator|!=
name|section
operator|->
name|address
condition|)
name|warn
argument_list|(
name|_
argument_list|(
literal|"Range lists in %s section start at 0x%lx\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|,
name|debug_information
index|[
name|first
index|]
operator|.
name|range_lists
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"Contents of the %s section:\n\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"    Offset   Begin    End\n"
argument_list|)
argument_list|)
expr_stmt|;
name|seen_first_offset
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
name|first
init|;
name|i
operator|<
name|num_debug_info_entries
condition|;
name|i
operator|++
control|)
block|{
name|unsigned
name|long
name|begin
decl_stmt|;
name|unsigned
name|long
name|end
decl_stmt|;
name|unsigned
name|long
name|offset
decl_stmt|;
name|unsigned
name|int
name|pointer_size
decl_stmt|;
name|unsigned
name|long
name|base_address
decl_stmt|;
name|pointer_size
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|pointer_size
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|debug_information
index|[
name|i
index|]
operator|.
name|num_range_lists
condition|;
name|j
operator|++
control|)
block|{
comment|/* DWARF sections under Mach-O have non-zero addresses.  */
name|offset
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|range_lists
index|[
name|j
index|]
operator|-
name|section
operator|->
name|address
expr_stmt|;
name|next
operator|=
name|section_begin
operator|+
name|offset
expr_stmt|;
name|base_address
operator|=
name|debug_information
index|[
name|i
index|]
operator|.
name|base_address
expr_stmt|;
if|if
condition|(
operator|!
name|seen_first_offset
condition|)
name|seen_first_offset
operator|=
literal|1
expr_stmt|;
else|else
block|{
if|if
condition|(
name|start
operator|<
name|next
condition|)
name|warn
argument_list|(
name|_
argument_list|(
literal|"There is a hole [0x%lx - 0x%lx] in %s section.\n"
argument_list|)
argument_list|,
call|(
name|long
call|)
argument_list|(
name|start
operator|-
name|section_begin
argument_list|)
argument_list|,
call|(
name|long
call|)
argument_list|(
name|next
operator|-
name|section_begin
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|start
operator|>
name|next
condition|)
name|warn
argument_list|(
name|_
argument_list|(
literal|"There is an overlap [0x%lx - 0x%lx] in %s section.\n"
argument_list|)
argument_list|,
call|(
name|long
call|)
argument_list|(
name|start
operator|-
name|section_begin
argument_list|)
argument_list|,
call|(
name|long
call|)
argument_list|(
name|next
operator|-
name|section_begin
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
name|start
operator|=
name|next
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|begin
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
name|pointer_size
argument_list|)
expr_stmt|;
name|start
operator|+=
name|pointer_size
expr_stmt|;
name|end
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
name|pointer_size
argument_list|)
expr_stmt|;
name|start
operator|+=
name|pointer_size
expr_stmt|;
if|if
condition|(
name|begin
operator|==
literal|0
operator|&&
name|end
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|"    %8.8lx<End of list>\n"
argument_list|)
argument_list|,
name|offset
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* Check base address specifiers.  */
if|if
condition|(
name|begin
operator|==
operator|-
literal|1UL
operator|&&
name|end
operator|!=
operator|-
literal|1UL
condition|)
block|{
name|base_address
operator|=
name|end
expr_stmt|;
name|printf
argument_list|(
literal|"    %8.8lx %8.8lx %8.8lx (base address)\n"
argument_list|,
name|offset
argument_list|,
name|begin
argument_list|,
name|end
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|printf
argument_list|(
literal|"    %8.8lx %8.8lx %8.8lx"
argument_list|,
name|offset
argument_list|,
name|begin
operator|+
name|base_address
argument_list|,
name|end
operator|+
name|base_address
argument_list|)
expr_stmt|;
if|if
condition|(
name|begin
operator|==
name|end
condition|)
name|fputs
argument_list|(
name|_
argument_list|(
literal|" (start == end)"
argument_list|)
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|begin
operator|>
name|end
condition|)
name|fputs
argument_list|(
name|_
argument_list|(
literal|" (start> end)"
argument_list|)
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_typedef
typedef|typedef
struct|struct
name|Frame_Chunk
block|{
name|struct
name|Frame_Chunk
modifier|*
name|next
decl_stmt|;
name|unsigned
name|char
modifier|*
name|chunk_start
decl_stmt|;
name|int
name|ncols
decl_stmt|;
comment|/* DW_CFA_{undefined,same_value,offset,register,unreferenced}  */
name|short
name|int
modifier|*
name|col_type
decl_stmt|;
name|int
modifier|*
name|col_offset
decl_stmt|;
name|char
modifier|*
name|augmentation
decl_stmt|;
name|unsigned
name|int
name|code_factor
decl_stmt|;
name|int
name|data_factor
decl_stmt|;
name|unsigned
name|long
name|pc_begin
decl_stmt|;
name|unsigned
name|long
name|pc_range
decl_stmt|;
name|int
name|cfa_reg
decl_stmt|;
name|int
name|cfa_offset
decl_stmt|;
name|int
name|ra
decl_stmt|;
name|unsigned
name|char
name|fde_encoding
decl_stmt|;
name|unsigned
name|char
name|cfa_exp
decl_stmt|;
block|}
name|Frame_Chunk
typedef|;
end_typedef

begin_comment
comment|/* A marker for a col_type that means this column was never referenced    in the frame info.  */
end_comment

begin_define
define|#
directive|define
name|DW_CFA_unreferenced
value|(-1)
end_define

begin_function
specifier|static
name|void
name|frame_need_space
parameter_list|(
name|Frame_Chunk
modifier|*
name|fc
parameter_list|,
name|int
name|reg
parameter_list|)
block|{
name|int
name|prev
init|=
name|fc
operator|->
name|ncols
decl_stmt|;
if|if
condition|(
name|reg
operator|<
name|fc
operator|->
name|ncols
condition|)
return|return;
name|fc
operator|->
name|ncols
operator|=
name|reg
operator|+
literal|1
expr_stmt|;
name|fc
operator|->
name|col_type
operator|=
name|xcrealloc
argument_list|(
name|fc
operator|->
name|col_type
argument_list|,
name|fc
operator|->
name|ncols
argument_list|,
expr|sizeof
operator|(
name|short
name|int
operator|)
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_offset
operator|=
name|xcrealloc
argument_list|(
name|fc
operator|->
name|col_offset
argument_list|,
name|fc
operator|->
name|ncols
argument_list|,
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|prev
operator|<
name|fc
operator|->
name|ncols
condition|)
block|{
name|fc
operator|->
name|col_type
index|[
name|prev
index|]
operator|=
name|DW_CFA_unreferenced
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|prev
index|]
operator|=
literal|0
expr_stmt|;
name|prev
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|frame_display_row
parameter_list|(
name|Frame_Chunk
modifier|*
name|fc
parameter_list|,
name|int
modifier|*
name|need_col_headers
parameter_list|,
name|int
modifier|*
name|max_regs
parameter_list|)
block|{
name|int
name|r
decl_stmt|;
name|char
name|tmp
index|[
literal|100
index|]
decl_stmt|;
if|if
condition|(
operator|*
name|max_regs
operator|<
name|fc
operator|->
name|ncols
condition|)
operator|*
name|max_regs
operator|=
name|fc
operator|->
name|ncols
expr_stmt|;
if|if
condition|(
operator|*
name|need_col_headers
condition|)
block|{
operator|*
name|need_col_headers
operator|=
literal|0
expr_stmt|;
name|printf
argument_list|(
literal|"   LOC   CFA      "
argument_list|)
expr_stmt|;
for|for
control|(
name|r
operator|=
literal|0
init|;
name|r
operator|<
operator|*
name|max_regs
condition|;
name|r
operator|++
control|)
if|if
condition|(
name|fc
operator|->
name|col_type
index|[
name|r
index|]
operator|!=
name|DW_CFA_unreferenced
condition|)
block|{
if|if
condition|(
name|r
operator|==
name|fc
operator|->
name|ra
condition|)
name|printf
argument_list|(
literal|"ra   "
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"r%-4d"
argument_list|,
name|r
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%08lx "
argument_list|,
name|fc
operator|->
name|pc_begin
argument_list|)
expr_stmt|;
if|if
condition|(
name|fc
operator|->
name|cfa_exp
condition|)
name|strcpy
argument_list|(
name|tmp
argument_list|,
literal|"exp"
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"r%d%+d"
argument_list|,
name|fc
operator|->
name|cfa_reg
argument_list|,
name|fc
operator|->
name|cfa_offset
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%-8s "
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
for|for
control|(
name|r
operator|=
literal|0
init|;
name|r
operator|<
name|fc
operator|->
name|ncols
condition|;
name|r
operator|++
control|)
block|{
if|if
condition|(
name|fc
operator|->
name|col_type
index|[
name|r
index|]
operator|!=
name|DW_CFA_unreferenced
condition|)
block|{
switch|switch
condition|(
name|fc
operator|->
name|col_type
index|[
name|r
index|]
condition|)
block|{
case|case
name|DW_CFA_undefined
case|:
name|strcpy
argument_list|(
name|tmp
argument_list|,
literal|"u"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_same_value
case|:
name|strcpy
argument_list|(
name|tmp
argument_list|,
literal|"s"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_offset
case|:
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"c%+d"
argument_list|,
name|fc
operator|->
name|col_offset
index|[
name|r
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_val_offset
case|:
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"v%+d"
argument_list|,
name|fc
operator|->
name|col_offset
index|[
name|r
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_register
case|:
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"r%d"
argument_list|,
name|fc
operator|->
name|col_offset
index|[
name|r
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_expression
case|:
name|strcpy
argument_list|(
name|tmp
argument_list|,
literal|"exp"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_val_expression
case|:
name|strcpy
argument_list|(
name|tmp
argument_list|,
literal|"vexp"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|strcpy
argument_list|(
name|tmp
argument_list|,
literal|"n/a"
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|"%-5s"
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|size_of_encoded_value
parameter_list|(
name|int
name|encoding
parameter_list|)
block|{
switch|switch
condition|(
name|encoding
operator|&
literal|0x7
condition|)
block|{
default|default:
comment|/* ??? */
case|case
literal|0
case|:
return|return
name|eh_addr_size
return|;
case|case
literal|2
case|:
return|return
literal|2
return|;
case|case
literal|3
case|:
return|return
literal|4
return|;
case|case
literal|4
case|:
return|return
literal|8
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|dwarf_vma
name|get_encoded_value
parameter_list|(
name|unsigned
name|char
modifier|*
name|data
parameter_list|,
name|int
name|encoding
parameter_list|)
block|{
name|int
name|size
init|=
name|size_of_encoded_value
argument_list|(
name|encoding
argument_list|)
decl_stmt|;
if|if
condition|(
name|encoding
operator|&
name|DW_EH_PE_signed
condition|)
return|return
name|byte_get_signed
argument_list|(
name|data
argument_list|,
name|size
argument_list|)
return|;
else|else
return|return
name|byte_get
argument_list|(
name|data
argument_list|,
name|size
argument_list|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|GET
parameter_list|(
name|N
parameter_list|)
value|byte_get (start, N); start += N
end_define

begin_define
define|#
directive|define
name|LEB
parameter_list|()
value|read_leb128 (start,& length_return, 0); start += length_return
end_define

begin_define
define|#
directive|define
name|SLEB
parameter_list|()
value|read_leb128 (start,& length_return, 1); start += length_return
end_define

begin_function
specifier|static
name|int
name|display_debug_frames
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|start
init|=
name|section
operator|->
name|start
decl_stmt|;
name|unsigned
name|char
modifier|*
name|end
init|=
name|start
operator|+
name|section
operator|->
name|size
decl_stmt|;
name|unsigned
name|char
modifier|*
name|section_start
init|=
name|start
decl_stmt|;
name|Frame_Chunk
modifier|*
name|chunks
init|=
literal|0
decl_stmt|;
name|Frame_Chunk
modifier|*
name|remembered_state
init|=
literal|0
decl_stmt|;
name|Frame_Chunk
modifier|*
name|rs
decl_stmt|;
name|int
name|is_eh
init|=
name|strcmp
argument_list|(
name|section
operator|->
name|name
argument_list|,
literal|".eh_frame"
argument_list|)
operator|==
literal|0
decl_stmt|;
name|unsigned
name|int
name|length_return
decl_stmt|;
name|int
name|max_regs
init|=
literal|0
decl_stmt|;
name|printf
argument_list|(
name|_
argument_list|(
literal|"The section %s contains:\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
while|while
condition|(
name|start
operator|<
name|end
condition|)
block|{
name|unsigned
name|char
modifier|*
name|saved_start
decl_stmt|;
name|unsigned
name|char
modifier|*
name|block_end
decl_stmt|;
name|unsigned
name|long
name|length
decl_stmt|;
name|unsigned
name|long
name|cie_id
decl_stmt|;
name|Frame_Chunk
modifier|*
name|fc
decl_stmt|;
name|Frame_Chunk
modifier|*
name|cie
decl_stmt|;
name|int
name|need_col_headers
init|=
literal|1
decl_stmt|;
name|unsigned
name|char
modifier|*
name|augmentation_data
init|=
name|NULL
decl_stmt|;
name|unsigned
name|long
name|augmentation_data_len
init|=
literal|0
decl_stmt|;
name|int
name|encoded_ptr_size
init|=
name|eh_addr_size
decl_stmt|;
name|int
name|offset_size
decl_stmt|;
name|int
name|initial_length_size
decl_stmt|;
name|saved_start
operator|=
name|start
expr_stmt|;
name|length
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|start
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|length
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"\n%08lx ZERO terminator\n\n"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|saved_start
operator|-
name|section_start
argument_list|)
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|length
operator|==
literal|0xffffffff
condition|)
block|{
name|length
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|start
operator|+=
literal|8
expr_stmt|;
name|offset_size
operator|=
literal|8
expr_stmt|;
name|initial_length_size
operator|=
literal|12
expr_stmt|;
block|}
else|else
block|{
name|offset_size
operator|=
literal|4
expr_stmt|;
name|initial_length_size
operator|=
literal|4
expr_stmt|;
block|}
name|block_end
operator|=
name|saved_start
operator|+
name|length
operator|+
name|initial_length_size
expr_stmt|;
if|if
condition|(
name|block_end
operator|>
name|end
condition|)
block|{
name|warn
argument_list|(
literal|"Invalid length %#08lx in FDE at %#08lx\n"
argument_list|,
name|length
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|saved_start
operator|-
name|section_start
argument_list|)
argument_list|)
expr_stmt|;
name|block_end
operator|=
name|end
expr_stmt|;
block|}
name|cie_id
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
name|offset_size
argument_list|)
expr_stmt|;
name|start
operator|+=
name|offset_size
expr_stmt|;
if|if
condition|(
name|is_eh
condition|?
operator|(
name|cie_id
operator|==
literal|0
operator|)
else|:
operator|(
name|cie_id
operator|==
name|DW_CIE_ID
operator|)
condition|)
block|{
name|int
name|version
decl_stmt|;
name|fc
operator|=
name|xmalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|Frame_Chunk
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|fc
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|Frame_Chunk
argument_list|)
argument_list|)
expr_stmt|;
name|fc
operator|->
name|next
operator|=
name|chunks
expr_stmt|;
name|chunks
operator|=
name|fc
expr_stmt|;
name|fc
operator|->
name|chunk_start
operator|=
name|saved_start
expr_stmt|;
name|fc
operator|->
name|ncols
operator|=
literal|0
expr_stmt|;
name|fc
operator|->
name|col_type
operator|=
name|xmalloc
argument_list|(
expr|sizeof
operator|(
name|short
name|int
operator|)
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_offset
operator|=
name|xmalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|max_regs
operator|-
literal|1
argument_list|)
expr_stmt|;
name|version
operator|=
operator|*
name|start
operator|++
expr_stmt|;
name|fc
operator|->
name|augmentation
operator|=
operator|(
name|char
operator|*
operator|)
name|start
expr_stmt|;
name|start
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|strchr
argument_list|(
operator|(
name|char
operator|*
operator|)
name|start
argument_list|,
literal|'\0'
argument_list|)
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|fc
operator|->
name|augmentation
index|[
literal|0
index|]
operator|==
literal|'z'
condition|)
block|{
name|fc
operator|->
name|code_factor
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|fc
operator|->
name|data_factor
operator|=
name|SLEB
argument_list|()
expr_stmt|;
if|if
condition|(
name|version
operator|==
literal|1
condition|)
block|{
name|fc
operator|->
name|ra
operator|=
name|GET
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fc
operator|->
name|ra
operator|=
name|LEB
argument_list|()
expr_stmt|;
block|}
name|augmentation_data_len
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|augmentation_data
operator|=
name|start
expr_stmt|;
name|start
operator|+=
name|augmentation_data_len
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|fc
operator|->
name|augmentation
argument_list|,
literal|"eh"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|start
operator|+=
name|eh_addr_size
expr_stmt|;
name|fc
operator|->
name|code_factor
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|fc
operator|->
name|data_factor
operator|=
name|SLEB
argument_list|()
expr_stmt|;
if|if
condition|(
name|version
operator|==
literal|1
condition|)
block|{
name|fc
operator|->
name|ra
operator|=
name|GET
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fc
operator|->
name|ra
operator|=
name|LEB
argument_list|()
expr_stmt|;
block|}
block|}
else|else
block|{
name|fc
operator|->
name|code_factor
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|fc
operator|->
name|data_factor
operator|=
name|SLEB
argument_list|()
expr_stmt|;
if|if
condition|(
name|version
operator|==
literal|1
condition|)
block|{
name|fc
operator|->
name|ra
operator|=
name|GET
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fc
operator|->
name|ra
operator|=
name|LEB
argument_list|()
expr_stmt|;
block|}
block|}
name|cie
operator|=
name|fc
expr_stmt|;
if|if
condition|(
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"\n%08lx %08lx %08lx CIE \"%s\" cf=%d df=%d ra=%d\n"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|saved_start
operator|-
name|section_start
argument_list|)
argument_list|,
name|length
argument_list|,
name|cie_id
argument_list|,
name|fc
operator|->
name|augmentation
argument_list|,
name|fc
operator|->
name|code_factor
argument_list|,
name|fc
operator|->
name|data_factor
argument_list|,
name|fc
operator|->
name|ra
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"\n%08lx %08lx %08lx CIE\n"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|saved_start
operator|-
name|section_start
argument_list|)
argument_list|,
name|length
argument_list|,
name|cie_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  Version:               %d\n"
argument_list|,
name|version
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  Augmentation:          \"%s\"\n"
argument_list|,
name|fc
operator|->
name|augmentation
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  Code alignment factor: %u\n"
argument_list|,
name|fc
operator|->
name|code_factor
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  Data alignment factor: %d\n"
argument_list|,
name|fc
operator|->
name|data_factor
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  Return address column: %d\n"
argument_list|,
name|fc
operator|->
name|ra
argument_list|)
expr_stmt|;
if|if
condition|(
name|augmentation_data_len
condition|)
block|{
name|unsigned
name|long
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"  Augmentation data:    "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|augmentation_data_len
condition|;
operator|++
name|i
control|)
name|printf
argument_list|(
literal|" %02x"
argument_list|,
name|augmentation_data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|augmentation_data_len
condition|)
block|{
name|unsigned
name|char
modifier|*
name|p
decl_stmt|,
modifier|*
name|q
decl_stmt|;
name|p
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|fc
operator|->
name|augmentation
operator|+
literal|1
expr_stmt|;
name|q
operator|=
name|augmentation_data
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
operator|*
name|p
operator|==
literal|'L'
condition|)
name|q
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|p
operator|==
literal|'P'
condition|)
name|q
operator|+=
literal|1
operator|+
name|size_of_encoded_value
argument_list|(
operator|*
name|q
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|p
operator|==
literal|'R'
condition|)
name|fc
operator|->
name|fde_encoding
operator|=
operator|*
name|q
operator|++
expr_stmt|;
else|else
break|break;
name|p
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|fc
operator|->
name|fde_encoding
condition|)
name|encoded_ptr_size
operator|=
name|size_of_encoded_value
argument_list|(
name|fc
operator|->
name|fde_encoding
argument_list|)
expr_stmt|;
block|}
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|fc
operator|->
name|ra
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|unsigned
name|char
modifier|*
name|look_for
decl_stmt|;
specifier|static
name|Frame_Chunk
name|fde_fc
decl_stmt|;
name|fc
operator|=
operator|&
name|fde_fc
expr_stmt|;
name|memset
argument_list|(
name|fc
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|Frame_Chunk
argument_list|)
argument_list|)
expr_stmt|;
name|look_for
operator|=
name|is_eh
condition|?
name|start
operator|-
literal|4
operator|-
name|cie_id
else|:
name|section_start
operator|+
name|cie_id
expr_stmt|;
for|for
control|(
name|cie
operator|=
name|chunks
init|;
name|cie
condition|;
name|cie
operator|=
name|cie
operator|->
name|next
control|)
if|if
condition|(
name|cie
operator|->
name|chunk_start
operator|==
name|look_for
condition|)
break|break;
if|if
condition|(
operator|!
name|cie
condition|)
block|{
name|warn
argument_list|(
literal|"Invalid CIE pointer %#08lx in FDE at %#08lx\n"
argument_list|,
name|cie_id
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|saved_start
operator|-
name|section_start
argument_list|)
argument_list|)
expr_stmt|;
name|fc
operator|->
name|ncols
operator|=
literal|0
expr_stmt|;
name|fc
operator|->
name|col_type
operator|=
name|xmalloc
argument_list|(
expr|sizeof
operator|(
name|short
name|int
operator|)
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_offset
operator|=
name|xmalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|max_regs
operator|-
literal|1
argument_list|)
expr_stmt|;
name|cie
operator|=
name|fc
expr_stmt|;
name|fc
operator|->
name|augmentation
operator|=
literal|""
expr_stmt|;
name|fc
operator|->
name|fde_encoding
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|fc
operator|->
name|ncols
operator|=
name|cie
operator|->
name|ncols
expr_stmt|;
name|fc
operator|->
name|col_type
operator|=
name|xcmalloc
argument_list|(
name|fc
operator|->
name|ncols
argument_list|,
expr|sizeof
operator|(
name|short
name|int
operator|)
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_offset
operator|=
name|xcmalloc
argument_list|(
name|fc
operator|->
name|ncols
argument_list|,
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|fc
operator|->
name|col_type
argument_list|,
name|cie
operator|->
name|col_type
argument_list|,
name|fc
operator|->
name|ncols
operator|*
expr|sizeof
operator|(
name|short
name|int
operator|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|fc
operator|->
name|col_offset
argument_list|,
name|cie
operator|->
name|col_offset
argument_list|,
name|fc
operator|->
name|ncols
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
name|fc
operator|->
name|augmentation
operator|=
name|cie
operator|->
name|augmentation
expr_stmt|;
name|fc
operator|->
name|code_factor
operator|=
name|cie
operator|->
name|code_factor
expr_stmt|;
name|fc
operator|->
name|data_factor
operator|=
name|cie
operator|->
name|data_factor
expr_stmt|;
name|fc
operator|->
name|cfa_reg
operator|=
name|cie
operator|->
name|cfa_reg
expr_stmt|;
name|fc
operator|->
name|cfa_offset
operator|=
name|cie
operator|->
name|cfa_offset
expr_stmt|;
name|fc
operator|->
name|ra
operator|=
name|cie
operator|->
name|ra
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|max_regs
operator|-
literal|1
argument_list|)
expr_stmt|;
name|fc
operator|->
name|fde_encoding
operator|=
name|cie
operator|->
name|fde_encoding
expr_stmt|;
block|}
if|if
condition|(
name|fc
operator|->
name|fde_encoding
condition|)
name|encoded_ptr_size
operator|=
name|size_of_encoded_value
argument_list|(
name|fc
operator|->
name|fde_encoding
argument_list|)
expr_stmt|;
name|fc
operator|->
name|pc_begin
operator|=
name|get_encoded_value
argument_list|(
name|start
argument_list|,
name|fc
operator|->
name|fde_encoding
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|fc
operator|->
name|fde_encoding
operator|&
literal|0x70
operator|)
operator|==
name|DW_EH_PE_pcrel
comment|/* Don't adjust for relocatable file since there's 		 invariably a pcrel reloc here, which we haven't 		 applied.  */
operator|&&
operator|!
name|is_relocatable
condition|)
name|fc
operator|->
name|pc_begin
operator|+=
name|section
operator|->
name|address
operator|+
operator|(
name|start
operator|-
name|section_start
operator|)
expr_stmt|;
name|start
operator|+=
name|encoded_ptr_size
expr_stmt|;
name|fc
operator|->
name|pc_range
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
name|encoded_ptr_size
argument_list|)
expr_stmt|;
name|start
operator|+=
name|encoded_ptr_size
expr_stmt|;
if|if
condition|(
name|cie
operator|->
name|augmentation
index|[
literal|0
index|]
operator|==
literal|'z'
condition|)
block|{
name|augmentation_data_len
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|augmentation_data
operator|=
name|start
expr_stmt|;
name|start
operator|+=
name|augmentation_data_len
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n%08lx %08lx %08lx FDE cie=%08lx pc=%08lx..%08lx\n"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|saved_start
operator|-
name|section_start
argument_list|)
argument_list|,
name|length
argument_list|,
name|cie_id
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|cie
operator|->
name|chunk_start
operator|-
name|section_start
argument_list|)
argument_list|,
name|fc
operator|->
name|pc_begin
argument_list|,
name|fc
operator|->
name|pc_begin
operator|+
name|fc
operator|->
name|pc_range
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
operator|&&
name|augmentation_data_len
condition|)
block|{
name|unsigned
name|long
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"  Augmentation data:    "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|augmentation_data_len
condition|;
operator|++
name|i
control|)
name|printf
argument_list|(
literal|" %02x"
argument_list|,
name|augmentation_data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* At this point, fc is the current chunk, cie (if any) is set, and 	 we're about to interpret instructions for the chunk.  */
comment|/* ??? At present we need to do this always, since this sizes the 	 fc->col_type and fc->col_offset arrays, which we write into always. 	 We should probably split the interpreted and non-interpreted bits 	 into two different routines, since there's so much that doesn't 	 really overlap between them.  */
if|if
condition|(
literal|1
operator|||
name|do_debug_frames_interp
condition|)
block|{
comment|/* Start by making a pass over the chunk, allocating storage 	     and taking note of what registers are used.  */
name|unsigned
name|char
modifier|*
name|tmp
init|=
name|start
decl_stmt|;
while|while
condition|(
name|start
operator|<
name|block_end
condition|)
block|{
name|unsigned
name|op
decl_stmt|,
name|opa
decl_stmt|;
name|unsigned
name|long
name|reg
decl_stmt|,
name|tmp
decl_stmt|;
name|op
operator|=
operator|*
name|start
operator|++
expr_stmt|;
name|opa
operator|=
name|op
operator|&
literal|0x3f
expr_stmt|;
if|if
condition|(
name|op
operator|&
literal|0xc0
condition|)
name|op
operator|&=
literal|0xc0
expr_stmt|;
comment|/* Warning: if you add any more cases to this switch, be 		 sure to add them to the corresponding switch below.  */
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|DW_CFA_advance_loc
case|:
break|break;
case|case
name|DW_CFA_offset
case|:
name|LEB
argument_list|()
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|opa
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|opa
index|]
operator|=
name|DW_CFA_undefined
expr_stmt|;
break|break;
case|case
name|DW_CFA_restore
case|:
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|opa
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|opa
index|]
operator|=
name|DW_CFA_undefined
expr_stmt|;
break|break;
case|case
name|DW_CFA_set_loc
case|:
name|start
operator|+=
name|encoded_ptr_size
expr_stmt|;
break|break;
case|case
name|DW_CFA_advance_loc1
case|:
name|start
operator|+=
literal|1
expr_stmt|;
break|break;
case|case
name|DW_CFA_advance_loc2
case|:
name|start
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
name|DW_CFA_advance_loc4
case|:
name|start
operator|+=
literal|4
expr_stmt|;
break|break;
case|case
name|DW_CFA_offset_extended
case|:
case|case
name|DW_CFA_val_offset
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|LEB
argument_list|()
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_undefined
expr_stmt|;
break|break;
case|case
name|DW_CFA_restore_extended
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_undefined
expr_stmt|;
break|break;
case|case
name|DW_CFA_undefined
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_undefined
expr_stmt|;
break|break;
case|case
name|DW_CFA_same_value
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_undefined
expr_stmt|;
break|break;
case|case
name|DW_CFA_register
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|LEB
argument_list|()
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_undefined
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa
case|:
name|LEB
argument_list|()
expr_stmt|;
name|LEB
argument_list|()
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa_register
case|:
name|LEB
argument_list|()
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa_offset
case|:
name|LEB
argument_list|()
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa_expression
case|:
name|tmp
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|start
operator|+=
name|tmp
expr_stmt|;
break|break;
case|case
name|DW_CFA_expression
case|:
case|case
name|DW_CFA_val_expression
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|tmp
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|start
operator|+=
name|tmp
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_undefined
expr_stmt|;
break|break;
case|case
name|DW_CFA_offset_extended_sf
case|:
case|case
name|DW_CFA_val_offset_sf
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|SLEB
argument_list|()
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_undefined
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa_sf
case|:
name|LEB
argument_list|()
expr_stmt|;
name|SLEB
argument_list|()
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa_offset_sf
case|:
name|SLEB
argument_list|()
expr_stmt|;
break|break;
case|case
name|DW_CFA_MIPS_advance_loc8
case|:
name|start
operator|+=
literal|8
expr_stmt|;
break|break;
case|case
name|DW_CFA_GNU_args_size
case|:
name|LEB
argument_list|()
expr_stmt|;
break|break;
case|case
name|DW_CFA_GNU_negative_offset_extended
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|LEB
argument_list|()
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_undefined
expr_stmt|;
default|default:
break|break;
block|}
block|}
name|start
operator|=
name|tmp
expr_stmt|;
block|}
comment|/* Now we know what registers are used, make a second pass over 	 the chunk, this time actually printing out the info.  */
while|while
condition|(
name|start
operator|<
name|block_end
condition|)
block|{
name|unsigned
name|op
decl_stmt|,
name|opa
decl_stmt|;
name|unsigned
name|long
name|ul
decl_stmt|,
name|reg
decl_stmt|,
name|roffs
decl_stmt|;
name|long
name|l
decl_stmt|,
name|ofs
decl_stmt|;
name|dwarf_vma
name|vma
decl_stmt|;
name|op
operator|=
operator|*
name|start
operator|++
expr_stmt|;
name|opa
operator|=
name|op
operator|&
literal|0x3f
expr_stmt|;
if|if
condition|(
name|op
operator|&
literal|0xc0
condition|)
name|op
operator|&=
literal|0xc0
expr_stmt|;
comment|/* Warning: if you add any more cases to this switch, be 	     sure to add them to the corresponding switch above.  */
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|DW_CFA_advance_loc
case|:
if|if
condition|(
name|do_debug_frames_interp
condition|)
name|frame_display_row
argument_list|(
name|fc
argument_list|,
operator|&
name|need_col_headers
argument_list|,
operator|&
name|max_regs
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"  DW_CFA_advance_loc: %d to %08lx\n"
argument_list|,
name|opa
operator|*
name|fc
operator|->
name|code_factor
argument_list|,
name|fc
operator|->
name|pc_begin
operator|+
name|opa
operator|*
name|fc
operator|->
name|code_factor
argument_list|)
expr_stmt|;
name|fc
operator|->
name|pc_begin
operator|+=
name|opa
operator|*
name|fc
operator|->
name|code_factor
expr_stmt|;
break|break;
case|case
name|DW_CFA_offset
case|:
name|roffs
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_offset: r%d at cfa%+ld\n"
argument_list|,
name|opa
argument_list|,
name|roffs
operator|*
name|fc
operator|->
name|data_factor
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|opa
index|]
operator|=
name|DW_CFA_offset
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|opa
index|]
operator|=
name|roffs
operator|*
name|fc
operator|->
name|data_factor
expr_stmt|;
break|break;
case|case
name|DW_CFA_restore
case|:
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_restore: r%d\n"
argument_list|,
name|opa
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|opa
index|]
operator|=
name|cie
operator|->
name|col_type
index|[
name|opa
index|]
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|opa
index|]
operator|=
name|cie
operator|->
name|col_offset
index|[
name|opa
index|]
expr_stmt|;
break|break;
case|case
name|DW_CFA_set_loc
case|:
name|vma
operator|=
name|get_encoded_value
argument_list|(
name|start
argument_list|,
name|fc
operator|->
name|fde_encoding
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|fc
operator|->
name|fde_encoding
operator|&
literal|0x70
operator|)
operator|==
name|DW_EH_PE_pcrel
operator|&&
operator|!
name|is_relocatable
condition|)
name|vma
operator|+=
name|section
operator|->
name|address
operator|+
operator|(
name|start
operator|-
name|section_start
operator|)
expr_stmt|;
name|start
operator|+=
name|encoded_ptr_size
expr_stmt|;
if|if
condition|(
name|do_debug_frames_interp
condition|)
name|frame_display_row
argument_list|(
name|fc
argument_list|,
operator|&
name|need_col_headers
argument_list|,
operator|&
name|max_regs
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"  DW_CFA_set_loc: %08lx\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|vma
argument_list|)
expr_stmt|;
name|fc
operator|->
name|pc_begin
operator|=
name|vma
expr_stmt|;
break|break;
case|case
name|DW_CFA_advance_loc1
case|:
name|ofs
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|start
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
name|do_debug_frames_interp
condition|)
name|frame_display_row
argument_list|(
name|fc
argument_list|,
operator|&
name|need_col_headers
argument_list|,
operator|&
name|max_regs
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"  DW_CFA_advance_loc1: %ld to %08lx\n"
argument_list|,
name|ofs
operator|*
name|fc
operator|->
name|code_factor
argument_list|,
name|fc
operator|->
name|pc_begin
operator|+
name|ofs
operator|*
name|fc
operator|->
name|code_factor
argument_list|)
expr_stmt|;
name|fc
operator|->
name|pc_begin
operator|+=
name|ofs
operator|*
name|fc
operator|->
name|code_factor
expr_stmt|;
break|break;
case|case
name|DW_CFA_advance_loc2
case|:
name|ofs
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|start
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
name|do_debug_frames_interp
condition|)
name|frame_display_row
argument_list|(
name|fc
argument_list|,
operator|&
name|need_col_headers
argument_list|,
operator|&
name|max_regs
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"  DW_CFA_advance_loc2: %ld to %08lx\n"
argument_list|,
name|ofs
operator|*
name|fc
operator|->
name|code_factor
argument_list|,
name|fc
operator|->
name|pc_begin
operator|+
name|ofs
operator|*
name|fc
operator|->
name|code_factor
argument_list|)
expr_stmt|;
name|fc
operator|->
name|pc_begin
operator|+=
name|ofs
operator|*
name|fc
operator|->
name|code_factor
expr_stmt|;
break|break;
case|case
name|DW_CFA_advance_loc4
case|:
name|ofs
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|start
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|do_debug_frames_interp
condition|)
name|frame_display_row
argument_list|(
name|fc
argument_list|,
operator|&
name|need_col_headers
argument_list|,
operator|&
name|max_regs
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"  DW_CFA_advance_loc4: %ld to %08lx\n"
argument_list|,
name|ofs
operator|*
name|fc
operator|->
name|code_factor
argument_list|,
name|fc
operator|->
name|pc_begin
operator|+
name|ofs
operator|*
name|fc
operator|->
name|code_factor
argument_list|)
expr_stmt|;
name|fc
operator|->
name|pc_begin
operator|+=
name|ofs
operator|*
name|fc
operator|->
name|code_factor
expr_stmt|;
break|break;
case|case
name|DW_CFA_offset_extended
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|roffs
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_offset_extended: r%ld at cfa%+ld\n"
argument_list|,
name|reg
argument_list|,
name|roffs
operator|*
name|fc
operator|->
name|data_factor
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_offset
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|reg
index|]
operator|=
name|roffs
operator|*
name|fc
operator|->
name|data_factor
expr_stmt|;
break|break;
case|case
name|DW_CFA_val_offset
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|roffs
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_val_offset: r%ld at cfa%+ld\n"
argument_list|,
name|reg
argument_list|,
name|roffs
operator|*
name|fc
operator|->
name|data_factor
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_val_offset
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|reg
index|]
operator|=
name|roffs
operator|*
name|fc
operator|->
name|data_factor
expr_stmt|;
break|break;
case|case
name|DW_CFA_restore_extended
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_restore_extended: r%ld\n"
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|cie
operator|->
name|col_type
index|[
name|reg
index|]
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|reg
index|]
operator|=
name|cie
operator|->
name|col_offset
index|[
name|reg
index|]
expr_stmt|;
break|break;
case|case
name|DW_CFA_undefined
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_undefined: r%ld\n"
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_undefined
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|reg
index|]
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|DW_CFA_same_value
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_same_value: r%ld\n"
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_same_value
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|reg
index|]
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|DW_CFA_register
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|roffs
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_register: r%ld in r%ld\n"
argument_list|,
name|reg
argument_list|,
name|roffs
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_register
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|reg
index|]
operator|=
name|roffs
expr_stmt|;
break|break;
case|case
name|DW_CFA_remember_state
case|:
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_remember_state\n"
argument_list|)
expr_stmt|;
name|rs
operator|=
name|xmalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|Frame_Chunk
argument_list|)
argument_list|)
expr_stmt|;
name|rs
operator|->
name|ncols
operator|=
name|fc
operator|->
name|ncols
expr_stmt|;
name|rs
operator|->
name|col_type
operator|=
name|xcmalloc
argument_list|(
name|rs
operator|->
name|ncols
argument_list|,
expr|sizeof
operator|(
name|short
name|int
operator|)
argument_list|)
expr_stmt|;
name|rs
operator|->
name|col_offset
operator|=
name|xcmalloc
argument_list|(
name|rs
operator|->
name|ncols
argument_list|,
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|rs
operator|->
name|col_type
argument_list|,
name|fc
operator|->
name|col_type
argument_list|,
name|rs
operator|->
name|ncols
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|rs
operator|->
name|col_offset
argument_list|,
name|fc
operator|->
name|col_offset
argument_list|,
name|rs
operator|->
name|ncols
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
name|rs
operator|->
name|next
operator|=
name|remembered_state
expr_stmt|;
name|remembered_state
operator|=
name|rs
expr_stmt|;
break|break;
case|case
name|DW_CFA_restore_state
case|:
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_restore_state\n"
argument_list|)
expr_stmt|;
name|rs
operator|=
name|remembered_state
expr_stmt|;
if|if
condition|(
name|rs
condition|)
block|{
name|remembered_state
operator|=
name|rs
operator|->
name|next
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|rs
operator|->
name|ncols
operator|-
literal|1
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|fc
operator|->
name|col_type
argument_list|,
name|rs
operator|->
name|col_type
argument_list|,
name|rs
operator|->
name|ncols
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|fc
operator|->
name|col_offset
argument_list|,
name|rs
operator|->
name|col_offset
argument_list|,
name|rs
operator|->
name|ncols
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|rs
operator|->
name|col_type
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|rs
operator|->
name|col_offset
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|rs
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"Mismatched DW_CFA_restore_state\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa
case|:
name|fc
operator|->
name|cfa_reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|fc
operator|->
name|cfa_offset
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|fc
operator|->
name|cfa_exp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_def_cfa: r%d ofs %d\n"
argument_list|,
name|fc
operator|->
name|cfa_reg
argument_list|,
name|fc
operator|->
name|cfa_offset
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa_register
case|:
name|fc
operator|->
name|cfa_reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|fc
operator|->
name|cfa_exp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_def_cfa_reg: r%d\n"
argument_list|,
name|fc
operator|->
name|cfa_reg
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa_offset
case|:
name|fc
operator|->
name|cfa_offset
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_def_cfa_offset: %d\n"
argument_list|,
name|fc
operator|->
name|cfa_offset
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_nop
case|:
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_nop\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa_expression
case|:
name|ul
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
block|{
name|printf
argument_list|(
literal|"  DW_CFA_def_cfa_expression ("
argument_list|)
expr_stmt|;
name|decode_location_expression
argument_list|(
name|start
argument_list|,
name|eh_addr_size
argument_list|,
name|ul
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")\n"
argument_list|)
expr_stmt|;
block|}
name|fc
operator|->
name|cfa_exp
operator|=
literal|1
expr_stmt|;
name|start
operator|+=
name|ul
expr_stmt|;
break|break;
case|case
name|DW_CFA_expression
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|ul
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
block|{
name|printf
argument_list|(
literal|"  DW_CFA_expression: r%ld ("
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|decode_location_expression
argument_list|(
name|start
argument_list|,
name|eh_addr_size
argument_list|,
name|ul
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")\n"
argument_list|)
expr_stmt|;
block|}
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_expression
expr_stmt|;
name|start
operator|+=
name|ul
expr_stmt|;
break|break;
case|case
name|DW_CFA_val_expression
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|ul
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
block|{
name|printf
argument_list|(
literal|"  DW_CFA_val_expression: r%ld ("
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|decode_location_expression
argument_list|(
name|start
argument_list|,
name|eh_addr_size
argument_list|,
name|ul
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")\n"
argument_list|)
expr_stmt|;
block|}
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_val_expression
expr_stmt|;
name|start
operator|+=
name|ul
expr_stmt|;
break|break;
case|case
name|DW_CFA_offset_extended_sf
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|l
operator|=
name|SLEB
argument_list|()
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|reg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_offset_extended_sf: r%ld at cfa%+ld\n"
argument_list|,
name|reg
argument_list|,
name|l
operator|*
name|fc
operator|->
name|data_factor
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_offset
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|reg
index|]
operator|=
name|l
operator|*
name|fc
operator|->
name|data_factor
expr_stmt|;
break|break;
case|case
name|DW_CFA_val_offset_sf
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|l
operator|=
name|SLEB
argument_list|()
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|reg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_val_offset_sf: r%ld at cfa%+ld\n"
argument_list|,
name|reg
argument_list|,
name|l
operator|*
name|fc
operator|->
name|data_factor
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_val_offset
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|reg
index|]
operator|=
name|l
operator|*
name|fc
operator|->
name|data_factor
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa_sf
case|:
name|fc
operator|->
name|cfa_reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|fc
operator|->
name|cfa_offset
operator|=
name|SLEB
argument_list|()
expr_stmt|;
name|fc
operator|->
name|cfa_offset
operator|=
name|fc
operator|->
name|cfa_offset
operator|*
name|fc
operator|->
name|data_factor
expr_stmt|;
name|fc
operator|->
name|cfa_exp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_def_cfa_sf: r%d ofs %d\n"
argument_list|,
name|fc
operator|->
name|cfa_reg
argument_list|,
name|fc
operator|->
name|cfa_offset
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_def_cfa_offset_sf
case|:
name|fc
operator|->
name|cfa_offset
operator|=
name|SLEB
argument_list|()
expr_stmt|;
name|fc
operator|->
name|cfa_offset
operator|=
name|fc
operator|->
name|cfa_offset
operator|*
name|fc
operator|->
name|data_factor
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_def_cfa_offset_sf: %d\n"
argument_list|,
name|fc
operator|->
name|cfa_offset
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_MIPS_advance_loc8
case|:
name|ofs
operator|=
name|byte_get
argument_list|(
name|start
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|start
operator|+=
literal|8
expr_stmt|;
if|if
condition|(
name|do_debug_frames_interp
condition|)
name|frame_display_row
argument_list|(
name|fc
argument_list|,
operator|&
name|need_col_headers
argument_list|,
operator|&
name|max_regs
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"  DW_CFA_MIPS_advance_loc8: %ld to %08lx\n"
argument_list|,
name|ofs
operator|*
name|fc
operator|->
name|code_factor
argument_list|,
name|fc
operator|->
name|pc_begin
operator|+
name|ofs
operator|*
name|fc
operator|->
name|code_factor
argument_list|)
expr_stmt|;
name|fc
operator|->
name|pc_begin
operator|+=
name|ofs
operator|*
name|fc
operator|->
name|code_factor
expr_stmt|;
break|break;
case|case
name|DW_CFA_GNU_window_save
case|:
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_GNU_window_save\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_GNU_args_size
case|:
name|ul
operator|=
name|LEB
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_GNU_args_size: %ld\n"
argument_list|,
name|ul
argument_list|)
expr_stmt|;
break|break;
case|case
name|DW_CFA_GNU_negative_offset_extended
case|:
name|reg
operator|=
name|LEB
argument_list|()
expr_stmt|;
name|l
operator|=
operator|-
name|LEB
argument_list|()
expr_stmt|;
name|frame_need_space
argument_list|(
name|fc
argument_list|,
name|reg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|do_debug_frames_interp
condition|)
name|printf
argument_list|(
literal|"  DW_CFA_GNU_negative_offset_extended: r%ld at cfa%+ld\n"
argument_list|,
name|reg
argument_list|,
name|l
operator|*
name|fc
operator|->
name|data_factor
argument_list|)
expr_stmt|;
name|fc
operator|->
name|col_type
index|[
name|reg
index|]
operator|=
name|DW_CFA_offset
expr_stmt|;
name|fc
operator|->
name|col_offset
index|[
name|reg
index|]
operator|=
name|l
operator|*
name|fc
operator|->
name|data_factor
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|op
operator|>=
name|DW_CFA_lo_user
operator|&&
name|op
operator|<=
name|DW_CFA_hi_user
condition|)
name|printf
argument_list|(
name|_
argument_list|(
literal|"  DW_CFA_??? (User defined call frame op: %#x)\n"
argument_list|)
argument_list|,
name|op
argument_list|)
expr_stmt|;
else|else
name|warn
argument_list|(
name|_
argument_list|(
literal|"unsupported or unknown Dwarf Call Frame Instruction number: %#x\n"
argument_list|)
argument_list|,
name|op
argument_list|)
expr_stmt|;
name|start
operator|=
name|block_end
expr_stmt|;
block|}
block|}
if|if
condition|(
name|do_debug_frames_interp
condition|)
name|frame_display_row
argument_list|(
name|fc
argument_list|,
operator|&
name|need_col_headers
argument_list|,
operator|&
name|max_regs
argument_list|)
expr_stmt|;
name|start
operator|=
name|block_end
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_undef
undef|#
directive|undef
name|GET
end_undef

begin_undef
undef|#
directive|undef
name|LEB
end_undef

begin_undef
undef|#
directive|undef
name|SLEB
end_undef

begin_function
specifier|static
name|int
name|display_debug_not_supported
parameter_list|(
name|struct
name|dwarf_section
modifier|*
name|section
parameter_list|,
name|void
modifier|*
name|file
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|printf
argument_list|(
name|_
argument_list|(
literal|"Displaying the debug contents of section %s is not yet supported.\n"
argument_list|)
argument_list|,
name|section
operator|->
name|name
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|cmalloc
parameter_list|(
name|size_t
name|nmemb
parameter_list|,
name|size_t
name|size
parameter_list|)
block|{
comment|/* Check for overflow.  */
if|if
condition|(
name|nmemb
operator|>=
operator|~
operator|(
name|size_t
operator|)
literal|0
operator|/
name|size
condition|)
return|return
name|NULL
return|;
else|else
return|return
name|malloc
argument_list|(
name|nmemb
operator|*
name|size
argument_list|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|xcmalloc
parameter_list|(
name|size_t
name|nmemb
parameter_list|,
name|size_t
name|size
parameter_list|)
block|{
comment|/* Check for overflow.  */
if|if
condition|(
name|nmemb
operator|>=
operator|~
operator|(
name|size_t
operator|)
literal|0
operator|/
name|size
condition|)
return|return
name|NULL
return|;
else|else
return|return
name|xmalloc
argument_list|(
name|nmemb
operator|*
name|size
argument_list|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|xcrealloc
parameter_list|(
name|void
modifier|*
name|ptr
parameter_list|,
name|size_t
name|nmemb
parameter_list|,
name|size_t
name|size
parameter_list|)
block|{
comment|/* Check for overflow.  */
if|if
condition|(
name|nmemb
operator|>=
operator|~
operator|(
name|size_t
operator|)
literal|0
operator|/
name|size
condition|)
return|return
name|NULL
return|;
else|else
return|return
name|xrealloc
argument_list|(
name|ptr
argument_list|,
name|nmemb
operator|*
name|size
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|error
parameter_list|(
specifier|const
name|char
modifier|*
name|message
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|args
decl_stmt|;
name|va_start
argument_list|(
name|args
argument_list|,
name|message
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|_
argument_list|(
literal|"%s: Error: "
argument_list|)
argument_list|,
name|program_name
argument_list|)
expr_stmt|;
name|vfprintf
argument_list|(
name|stderr
argument_list|,
name|message
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|warn
parameter_list|(
specifier|const
name|char
modifier|*
name|message
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|args
decl_stmt|;
name|va_start
argument_list|(
name|args
argument_list|,
name|message
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|_
argument_list|(
literal|"%s: Warning: "
argument_list|)
argument_list|,
name|program_name
argument_list|)
expr_stmt|;
name|vfprintf
argument_list|(
name|stderr
argument_list|,
name|message
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|free_debug_memory
parameter_list|(
name|void
parameter_list|)
block|{
name|enum
name|dwarf_section_display_enum
name|i
decl_stmt|;
name|free_abbrevs
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|max
condition|;
name|i
operator|++
control|)
name|free_debug_section
argument_list|(
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug_information
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_debug_info_entries
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|debug_information
index|[
name|i
index|]
operator|.
name|max_loc_offsets
condition|)
block|{
name|free
argument_list|(
name|debug_information
index|[
name|i
index|]
operator|.
name|loc_offsets
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|debug_information
index|[
name|i
index|]
operator|.
name|have_frame_base
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|debug_information
index|[
name|i
index|]
operator|.
name|max_range_lists
condition|)
name|free
argument_list|(
name|debug_information
index|[
name|i
index|]
operator|.
name|range_lists
argument_list|)
expr_stmt|;
block|}
name|free
argument_list|(
name|debug_information
argument_list|)
expr_stmt|;
name|debug_information
operator|=
name|NULL
expr_stmt|;
name|num_debug_info_entries
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_decl_stmt
name|struct
name|dwarf_section_display
name|debug_displays
index|[]
init|=
block|{
block|{
block|{
literal|".debug_abbrev"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_abbrev
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_aranges"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_aranges
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_frame"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_frames
block|,
literal|1
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_info"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_info
block|,
literal|1
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_line"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_lines
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_pubnames"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_pubnames
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".eh_frame"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_frames
block|,
literal|1
block|,
literal|1
block|}
block|,
block|{
block|{
literal|".debug_macinfo"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_macinfo
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_str"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_str
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_loc"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_loc
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_pubtypes"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_pubnames
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_ranges"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_ranges
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_static_func"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_not_supported
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_static_vars"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_not_supported
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_types"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_not_supported
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
block|{
literal|".debug_weaknames"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|}
block|,
name|display_debug_not_supported
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

end_unit

