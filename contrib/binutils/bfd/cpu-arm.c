begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* BFD support for the ARM processor    Copyright 1994, 1997, 1999, 2000 Free Software Foundation, Inc.    Contributed by Richard Earnshaw (rwe@pegasus.esprit.ec.org)  This file is part of BFD, the Binary File Descriptor library.  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|"libbfd.h"
end_include

begin_decl_stmt
specifier|static
specifier|const
name|bfd_arch_info_type
modifier|*
name|compatible
name|PARAMS
argument_list|(
operator|(
specifier|const
name|bfd_arch_info_type
operator|*
operator|,
specifier|const
name|bfd_arch_info_type
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|boolean
name|scan
name|PARAMS
argument_list|(
operator|(
specifier|const
expr|struct
name|bfd_arch_info
operator|*
operator|,
specifier|const
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* This routine is provided two arch_infos and works out which ARM    machine which would be compatible with both and returns a pointer    to its info structure */
end_comment

begin_function
specifier|static
specifier|const
name|bfd_arch_info_type
modifier|*
name|compatible
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
specifier|const
name|bfd_arch_info_type
modifier|*
name|a
decl_stmt|;
specifier|const
name|bfd_arch_info_type
modifier|*
name|b
decl_stmt|;
block|{
comment|/* If a& b are for different architecture we can do nothing */
if|if
condition|(
name|a
operator|->
name|arch
operator|!=
name|b
operator|->
name|arch
condition|)
return|return
name|NULL
return|;
comment|/* If a& b are for the same machine then all is well */
if|if
condition|(
name|a
operator|->
name|mach
operator|==
name|b
operator|->
name|mach
condition|)
return|return
name|a
return|;
comment|/* Otherwise if either a or b is the 'default' machine then      it can be polymorphed into the other */
if|if
condition|(
name|a
operator|->
name|the_default
condition|)
return|return
name|b
return|;
if|if
condition|(
name|b
operator|->
name|the_default
condition|)
return|return
name|a
return|;
comment|/* So far all newer ARM architecture cores are supersets of previous cores */
if|if
condition|(
name|a
operator|->
name|mach
operator|<
name|b
operator|->
name|mach
condition|)
return|return
name|b
return|;
elseif|else
if|if
condition|(
name|a
operator|->
name|mach
operator|>
name|b
operator|->
name|mach
condition|)
return|return
name|a
return|;
comment|/* Never reached! */
return|return
name|NULL
return|;
block|}
end_function

begin_struct
specifier|static
struct|struct
block|{
name|enum
name|bfd_architecture
name|arch
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
block|}
name|processors
index|[]
init|=
block|{
block|{
name|bfd_mach_arm_2
block|,
literal|"arm2"
block|}
block|,
block|{
name|bfd_mach_arm_2a
block|,
literal|"arm250"
block|}
block|,
block|{
name|bfd_mach_arm_2a
block|,
literal|"arm3"
block|}
block|,
block|{
name|bfd_mach_arm_3
block|,
literal|"arm6"
block|}
block|,
block|{
name|bfd_mach_arm_3
block|,
literal|"arm60"
block|}
block|,
block|{
name|bfd_mach_arm_3
block|,
literal|"arm600"
block|}
block|,
block|{
name|bfd_mach_arm_3
block|,
literal|"arm610"
block|}
block|,
block|{
name|bfd_mach_arm_3
block|,
literal|"arm7"
block|}
block|,
block|{
name|bfd_mach_arm_3
block|,
literal|"arm710"
block|}
block|,
block|{
name|bfd_mach_arm_3
block|,
literal|"arm7500"
block|}
block|,
block|{
name|bfd_mach_arm_3
block|,
literal|"arm7d"
block|}
block|,
block|{
name|bfd_mach_arm_3
block|,
literal|"arm7di"
block|}
block|,
block|{
name|bfd_mach_arm_3M
block|,
literal|"arm7dm"
block|}
block|,
block|{
name|bfd_mach_arm_3M
block|,
literal|"arm7dmi"
block|}
block|,
block|{
name|bfd_mach_arm_4T
block|,
literal|"arm7tdmi"
block|}
block|,
block|{
name|bfd_mach_arm_4
block|,
literal|"arm8"
block|}
block|,
block|{
name|bfd_mach_arm_4
block|,
literal|"arm810"
block|}
block|,
block|{
name|bfd_mach_arm_4
block|,
literal|"arm9"
block|}
block|,
block|{
name|bfd_mach_arm_4
block|,
literal|"arm920"
block|}
block|,
block|{
name|bfd_mach_arm_4T
block|,
literal|"arm920t"
block|}
block|,
block|{
name|bfd_mach_arm_4T
block|,
literal|"arm9tdmi"
block|}
block|,
block|{
name|bfd_mach_arm_4
block|,
literal|"sa1"
block|}
block|,
block|{
name|bfd_mach_arm_4
block|,
literal|"strongarm"
block|}
block|,
block|{
name|bfd_mach_arm_4
block|,
literal|"strongarm110"
block|}
block|,
block|{
name|bfd_mach_arm_4
block|,
literal|"strongarm1100"
block|}
block|,
block|{
name|bfd_mach_arm_XScale
block|,
literal|"xscale"
block|}
block|}
struct|;
end_struct

begin_function
specifier|static
name|boolean
name|scan
parameter_list|(
name|info
parameter_list|,
name|string
parameter_list|)
specifier|const
name|struct
name|bfd_arch_info
modifier|*
name|info
decl_stmt|;
specifier|const
name|char
modifier|*
name|string
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
comment|/* First test for an exact match */
if|if
condition|(
name|strcasecmp
argument_list|(
name|string
argument_list|,
name|info
operator|->
name|printable_name
argument_list|)
operator|==
literal|0
condition|)
return|return
name|true
return|;
comment|/* Next check for a processor name instead of an Architecture name */
for|for
control|(
name|i
operator|=
sizeof|sizeof
argument_list|(
name|processors
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|processors
index|[
literal|0
index|]
argument_list|)
init|;
name|i
operator|--
condition|;
control|)
block|{
if|if
condition|(
name|strcasecmp
argument_list|(
name|string
argument_list|,
name|processors
index|[
name|i
index|]
operator|.
name|name
argument_list|)
operator|==
literal|0
condition|)
break|break;
block|}
if|if
condition|(
name|i
operator|!=
operator|-
literal|1
operator|&&
name|info
operator|->
name|arch
operator|==
name|processors
index|[
name|i
index|]
operator|.
name|arch
condition|)
return|return
name|true
return|;
comment|/* Finally check for the default architecture */
if|if
condition|(
name|strcasecmp
argument_list|(
name|string
argument_list|,
literal|"arm"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|info
operator|->
name|the_default
return|;
return|return
name|false
return|;
block|}
end_function

begin_define
define|#
directive|define
name|N
parameter_list|(
name|number
parameter_list|,
name|print
parameter_list|,
define|default, next)  \ {  32, 32, 8, bfd_arch_arm, number, "arm", print, 4, default, compatible, scan, next }
end_define

begin_decl_stmt
specifier|static
specifier|const
name|bfd_arch_info_type
name|arch_info_struct
index|[]
init|=
block|{
name|N
argument_list|(
name|bfd_mach_arm_2
argument_list|,
literal|"armv2"
argument_list|,
name|false
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|1
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_arm_2a
argument_list|,
literal|"armv2a"
argument_list|,
name|false
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|2
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_arm_3
argument_list|,
literal|"armv3"
argument_list|,
name|false
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|3
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_arm_3M
argument_list|,
literal|"armv3m"
argument_list|,
name|false
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|4
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_arm_4
argument_list|,
literal|"armv4"
argument_list|,
name|false
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|5
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_arm_4T
argument_list|,
literal|"armv4t"
argument_list|,
name|false
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|6
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_arm_5
argument_list|,
literal|"armv5"
argument_list|,
name|false
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|7
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_arm_5T
argument_list|,
literal|"armv5t"
argument_list|,
name|false
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|8
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_arm_5TE
argument_list|,
literal|"armv5te"
argument_list|,
name|false
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|9
index|]
argument_list|)
block|,
name|N
argument_list|(
argument|bfd_mach_arm_XScale
argument_list|,
literal|"xscale"
argument_list|,
argument|false
argument_list|,
argument|NULL
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|bfd_arch_info_type
name|bfd_arm_arch
init|=
name|N
argument_list|(
literal|0
argument_list|,
literal|"arm"
argument_list|,
name|true
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

end_unit

