begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* BFD support for the NEC V850 processor    Copyright 1996, 1997, 1998, 2000, 2001 Free Software Foundation, Inc.  This file is part of BFD, the Binary File Descriptor library.  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|"libbfd.h"
end_include

begin_include
include|#
directive|include
file|"safe-ctype.h"
end_include

begin_decl_stmt
specifier|static
name|boolean
name|scan
name|PARAMS
argument_list|(
operator|(
specifier|const
expr|struct
name|bfd_arch_info
operator|*
operator|,
specifier|const
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|boolean
name|scan
parameter_list|(
name|info
parameter_list|,
name|string
parameter_list|)
specifier|const
name|struct
name|bfd_arch_info
modifier|*
name|info
decl_stmt|;
specifier|const
name|char
modifier|*
name|string
decl_stmt|;
block|{
specifier|const
name|char
modifier|*
name|ptr_src
decl_stmt|;
specifier|const
name|char
modifier|*
name|ptr_tst
decl_stmt|;
name|unsigned
name|long
name|number
decl_stmt|;
name|enum
name|bfd_architecture
name|arch
decl_stmt|;
comment|/* First test for an exact match.  */
if|if
condition|(
name|strcasecmp
argument_list|(
name|string
argument_list|,
name|info
operator|->
name|printable_name
argument_list|)
operator|==
literal|0
condition|)
return|return
name|true
return|;
comment|/* See how much of the supplied string matches with the      architecture, eg the string m68k:68020 would match the m68k entry      up to the :, then we get left with the machine number.  */
for|for
control|(
name|ptr_src
operator|=
name|string
operator|,
name|ptr_tst
operator|=
name|info
operator|->
name|arch_name
init|;
operator|*
name|ptr_src
operator|&&
operator|*
name|ptr_tst
condition|;
name|ptr_src
operator|++
operator|,
name|ptr_tst
operator|++
control|)
if|if
condition|(
operator|*
name|ptr_src
operator|!=
operator|*
name|ptr_tst
condition|)
break|break;
comment|/* Chewed up as much of the architecture as will match;      if there is a colon present skip it.  */
if|if
condition|(
operator|*
name|ptr_src
operator|==
literal|':'
condition|)
name|ptr_src
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|ptr_src
operator|==
literal|0
condition|)
comment|/* Nothing more, then only keep this one if it is        the default machine for this architecture.  */
return|return
name|info
operator|->
name|the_default
return|;
name|number
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|ISDIGIT
argument_list|(
operator|*
name|ptr_src
argument_list|)
condition|)
block|{
name|number
operator|=
name|number
operator|*
literal|10
operator|+
operator|*
name|ptr_src
operator|-
literal|'0'
expr_stmt|;
name|ptr_src
operator|++
expr_stmt|;
block|}
switch|switch
condition|(
name|number
condition|)
block|{
case|case
name|bfd_mach_v850e
case|:
name|arch
operator|=
name|bfd_arch_v850
expr_stmt|;
break|break;
case|case
name|bfd_mach_v850ea
case|:
name|arch
operator|=
name|bfd_arch_v850
expr_stmt|;
break|break;
default|default:
return|return
name|false
return|;
block|}
if|if
condition|(
name|arch
operator|!=
name|info
operator|->
name|arch
condition|)
return|return
name|false
return|;
if|if
condition|(
name|number
operator|!=
name|info
operator|->
name|mach
condition|)
return|return
name|false
return|;
return|return
name|true
return|;
block|}
end_function

begin_define
define|#
directive|define
name|N
parameter_list|(
name|number
parameter_list|,
name|print
parameter_list|,
define|default, next)  \ {  32, 32, 8, bfd_arch_v850, number, "v850", print, 2, default, \      bfd_default_compatible, scan, next }
end_define

begin_define
define|#
directive|define
name|NEXT
value|NULL
end_define

begin_decl_stmt
specifier|static
specifier|const
name|bfd_arch_info_type
name|arch_info_struct
index|[]
init|=
block|{
name|N
argument_list|(
name|bfd_mach_v850e
argument_list|,
literal|"v850e"
argument_list|,
name|false
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|1
index|]
argument_list|)
block|,
name|N
argument_list|(
argument|bfd_mach_v850ea
argument_list|,
literal|"v850ea"
argument_list|,
argument|false
argument_list|,
argument|NULL
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|NEXT
end_undef

begin_define
define|#
directive|define
name|NEXT
value|& arch_info_struct[0]
end_define

begin_decl_stmt
specifier|const
name|bfd_arch_info_type
name|bfd_v850_arch
init|=
name|N
argument_list|(
name|bfd_mach_v850
argument_list|,
literal|"v850"
argument_list|,
name|true
argument_list|,
name|NEXT
argument_list|)
decl_stmt|;
end_decl_stmt

end_unit

