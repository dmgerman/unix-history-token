begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2003-2007 Tim Kientzle  * Copyright (c) 2011 Andres Mejia  * Copyright (c) 2011-2012 Michihiro NAKAJIMA  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR(S) ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL THE AUTHOR(S) BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|"test.h"
end_include

begin_include
include|#
directive|include
file|<locale.h>
end_include

begin_function
specifier|static
name|void
name|test_basic
parameter_list|(
name|void
parameter_list|)
block|{
name|char
name|buff
index|[
literal|64
index|]
decl_stmt|;
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar.rar"
decl_stmt|;
specifier|const
name|char
name|test_txt
index|[]
init|=
literal|"test text document\r\n"
decl_stmt|;
name|int
name|size
init|=
sizeof|sizeof
argument_list|(
name|test_txt
argument_list|)
operator|-
literal|1
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|20
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
name|size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
name|size
argument_list|)
expr_stmt|;
comment|/* Second header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testlink"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|41471
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"test.txt"
argument_list|,
name|archive_entry_symlink
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
literal|0
argument_list|,
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Third header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir/test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|20
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
name|size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
name|size
argument_list|)
expr_stmt|;
comment|/* Fourth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Fifth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testemptydir"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|5
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_subblock
parameter_list|(
name|void
parameter_list|)
block|{
name|char
name|buff
index|[
literal|64
index|]
decl_stmt|;
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar_subblock.rar"
decl_stmt|;
specifier|const
name|char
name|test_txt
index|[]
init|=
literal|"test text document\r\n"
decl_stmt|;
name|int
name|size
init|=
sizeof|sizeof
argument_list|(
name|test_txt
argument_list|)
operator|-
literal|1
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|20
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
name|size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
name|size
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|1
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_noeof
parameter_list|(
name|void
parameter_list|)
block|{
name|char
name|buff
index|[
literal|64
index|]
decl_stmt|;
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar_noeof.rar"
decl_stmt|;
specifier|const
name|char
name|test_txt
index|[]
init|=
literal|"test text document\r\n"
decl_stmt|;
name|int
name|size
init|=
sizeof|sizeof
argument_list|(
name|test_txt
argument_list|)
operator|-
literal|1
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|20
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
name|size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
name|size
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|1
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_unicode_UTF8
parameter_list|(
name|void
parameter_list|)
block|{
name|char
name|buff
index|[
literal|30
index|]
decl_stmt|;
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar_unicode.rar"
decl_stmt|;
specifier|const
name|char
name|test_txt
index|[]
init|=
literal|"kanji"
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
if|if
condition|(
name|NULL
operator|==
name|setlocale
argument_list|(
name|LC_ALL
argument_list|,
literal|"en_US.UTF-8"
argument_list|)
condition|)
block|{
name|skipping
argument_list|(
literal|"en_US.UTF-8 locale not available on this system."
argument_list|)
expr_stmt|;
return|return;
block|}
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|__APPLE__
argument_list|)
define|#
directive|define
name|f1name
value|"\xE8\xA1\xA8\xE3\x81\x9F\xE3\x82\x99\xE3\x82\x88/"\       "\xE6\x96\xB0\xE3\x81\x97\xE3\x81\x84\xE3\x83\x95\xE3\x82\xA9"\       "\xE3\x83\xAB\xE3\x82\xBF\xE3\x82\x99/\xE6\x96\xB0\xE8\xA6\x8F"\       "\xE3\x83\x86\xE3\x82\xAD\xE3\x82\xB9\xE3\x83\x88 "\       "\xE3\x83\x88\xE3\x82\x99\xE3\x82\xAD\xE3\x83\xA5\xE3\x83\xA1"\       "\xE3\x83\xB3\xE3\x83\x88.txt"
comment|/* NFD */
else|#
directive|else
define|#
directive|define
name|f1name
value|"\xE8\xA1\xA8\xE3\x81\xA0\xE3\x82\x88/"\       "\xE6\x96\xB0\xE3\x81\x97\xE3\x81\x84\xE3\x83\x95\xE3\x82\xA9"\       "\xE3\x83\xAB\xE3\x83\x80/\xE6\x96\xB0\xE8\xA6\x8F"\       "\xE3\x83\x86\xE3\x82\xAD\xE3\x82\xB9\xE3\x83\x88 "\       "\xE3\x83\x89\xE3\x82\xAD\xE3\x83\xA5\xE3\x83\xA1"\       "\xE3\x83\xB3\xE3\x83\x88.txt"
comment|/* NFC */
endif|#
directive|endif
name|assertEqualUTF8String
argument_list|(
name|f1name
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Second header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|__APPLE__
argument_list|)
define|#
directive|define
name|f2name
value|"\xE8\xA1\xA8\xE3\x81\x9F\xE3\x82\x99\xE3\x82\x88/"\       "\xE6\xBC\xA2\xE5\xAD\x97\xE9\x95\xB7\xE3\x81\x84\xE3\x83\x95"\       "\xE3\x82\xA1\xE3\x82\xA4\xE3\x83\xAB\xE5\x90\x8Dlong-filename-in-"\       "\xE6\xBC\xA2\xE5\xAD\x97.txt"
comment|/* NFD */
else|#
directive|else
define|#
directive|define
name|f2name
value|"\xE8\xA1\xA8\xE3\x81\xA0\xE3\x82\x88/"\       "\xE6\xBC\xA2\xE5\xAD\x97\xE9\x95\xB7\xE3\x81\x84\xE3\x83\x95"\       "\xE3\x82\xA1\xE3\x82\xA4\xE3\x83\xAB\xE5\x90\x8Dlong-filename-in-"\       "\xE6\xBC\xA2\xE5\xAD\x97.txt"
comment|/* NFC */
endif|#
directive|endif
name|assertEqualUTF8String
argument_list|(
name|f2name
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|5
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
literal|5
argument_list|,
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* Third header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|__APPLE__
argument_list|)
define|#
directive|define
name|f3name
value|"\xE8\xA1\xA8\xE3\x81\x9F\xE3\x82\x99\xE3\x82\x88/"\       "\xE6\x96\xB0\xE3\x81\x97\xE3\x81\x84\xE3\x83\x95\xE3\x82"\       "\xA9\xE3\x83\xAB\xE3\x82\xBF\xE3\x82\x99"
comment|/* NFD */
else|#
directive|else
define|#
directive|define
name|f3name
value|"\xE8\xA1\xA8\xE3\x81\xA0\xE3\x82\x88/"\       "\xE6\x96\xB0\xE3\x81\x97\xE3\x81\x84\xE3\x83\x95\xE3\x82"\       "\xA9\xE3\x83\xAB\xE3\x83\x80"
comment|/* NFC */
endif|#
directive|endif
name|assertEqualUTF8String
argument_list|(
name|f3name
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Fourth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|__APPLE__
argument_list|)
define|#
directive|define
name|f4name
value|"\xE8\xA1\xA8\xE3\x81\x9F\xE3\x82\x99\xE3\x82\x88"
comment|/* NFD */
else|#
directive|else
define|#
directive|define
name|f4name
value|"\xE8\xA1\xA8\xE3\x81\xA0\xE3\x82\x88"
comment|/* NFC */
endif|#
directive|endif
name|assertEqualUTF8String
argument_list|(
name|f4name
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Fifth header, which has a symbolic-link name in multi-byte characters. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|__APPLE__
argument_list|)
define|#
directive|define
name|f5name
value|"\xE8\xA1\xA8\xE3\x81\x9F\xE3\x82\x99\xE3\x82\x88/"\       "\xE3\x83\x95\xE3\x82\xA1\xE3\x82\xA4\xE3\x83\xAB"
comment|/* NFD */
else|#
directive|else
define|#
directive|define
name|f5name
value|"\xE8\xA1\xA8\xE3\x81\xA0\xE3\x82\x88/"\       "\xE3\x83\x95\xE3\x82\xA1\xE3\x82\xA4\xE3\x83\xAB"
comment|/* NFC */
endif|#
directive|endif
name|assertEqualUTF8String
argument_list|(
name|f5name
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualUTF8String
argument_list|(
literal|"\xE6\xBC\xA2\xE5\xAD\x97\xE9\x95\xB7\xE3\x81\x84\xE3\x83\x95"
literal|"\xE3\x82\xA1\xE3\x82\xA4\xE3\x83\xAB\xE5\x90\x8Dlong-filename-in-"
literal|"\xE6\xBC\xA2\xE5\xAD\x97.txt"
argument_list|,
name|archive_entry_symlink
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|41453
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
literal|0
argument_list|,
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Sixth header */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualUTF8String
argument_list|(
literal|"abcdefghijklmnopqrs\xE3\x83\x86\xE3\x82\xB9\xE3\x83\x88.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33204
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
literal|16
argument_list|,
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|6
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_unicode_CP932
parameter_list|(
name|void
parameter_list|)
block|{
name|char
name|buff
index|[
literal|30
index|]
decl_stmt|;
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar_unicode.rar"
decl_stmt|;
specifier|const
name|char
name|test_txt
index|[]
init|=
literal|"kanji"
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
if|if
condition|(
name|NULL
operator|==
name|setlocale
argument_list|(
name|LC_ALL
argument_list|,
literal|"Japanese_Japan"
argument_list|)
operator|&&
name|NULL
operator|==
name|setlocale
argument_list|(
name|LC_ALL
argument_list|,
literal|"ja_JP.SJIS"
argument_list|)
condition|)
block|{
name|skipping
argument_list|(
literal|"CP932 locale not available on this system."
argument_list|)
expr_stmt|;
return|return;
block|}
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Specify the charset of symbolic-link file name. */
if|if
condition|(
name|ARCHIVE_OK
operator|!=
name|archive_read_set_options
argument_list|(
name|a
argument_list|,
literal|"rar:hdrcharset=UTF-8"
argument_list|)
condition|)
block|{
name|skipping
argument_list|(
literal|"This system cannot convert character-set"
literal|" from UTF-8 to CP932."
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"\x95\x5c\x82\xbe\x82\xe6/\x90\x56\x82\xb5\x82\xa2"
literal|"\x83\x74\x83\x48\x83\x8b\x83\x5f/\x90\x56\x8b\x4b\x83\x65\x83\x4c"
literal|"\x83\x58\x83\x67 \x83\x68\x83\x4c\x83\x85\x83\x81\x83\x93\x83\x67.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Second header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"\x95\x5c\x82\xbe\x82\xe6/\x8a\xbf\x8e\x9a"
literal|"\x92\xb7\x82\xa2\x83\x74\x83\x40\x83\x43\x83\x8b\x96\xbc\x6c"
literal|"\x6f\x6e\x67\x2d\x66\x69\x6c\x65\x6e\x61\x6d\x65\x2d\x69\x6e"
literal|"\x2d\x8a\xbf\x8e\x9a.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|5
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|5
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* Third header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"\x95\x5c\x82\xbe\x82\xe6/"
literal|"\x90\x56\x82\xb5\x82\xa2\x83\x74\x83\x48\x83\x8b\x83\x5f"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Fourth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"\x95\x5c\x82\xbe\x82\xe6"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Fifth header, which has a symbolic-link name in multi-byte characters. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"\x95\x5c\x82\xbe\x82\xe6/"
literal|"\x83\x74\x83\x40\x83\x43\x83\x8B"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"\x8a\xbf\x8e\x9a"
literal|"\x92\xb7\x82\xa2\x83\x74\x83\x40\x83\x43\x83\x8b\x96\xbc\x6c"
literal|"\x6f\x6e\x67\x2d\x66\x69\x6c\x65\x6e\x61\x6d\x65\x2d\x69\x6e"
literal|"\x2d\x8a\xbf\x8e\x9a.txt"
argument_list|,
name|archive_entry_symlink
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|41453
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
literal|0
argument_list|,
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Sixth header */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualUTF8String
argument_list|(
literal|"abcdefghijklmnopqrs\x83\x65\x83\x58\x83\x67.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33204
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
literal|16
argument_list|,
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|6
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_compress_normal
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar_compress_normal.rar"
decl_stmt|;
name|char
name|file1_buff
index|[
literal|20111
index|]
decl_stmt|;
name|int
name|file1_size
init|=
sizeof|sizeof
argument_list|(
name|file1_buff
argument_list|)
decl_stmt|;
specifier|const
name|char
name|file1_test_txt
index|[]
init|=
literal|"<P STYLE=\"margin-bottom: 0in\"><BR>\n"
literal|"</P>\n"
literal|"</BODY>\n"
literal|"</HTML>"
decl_stmt|;
name|char
name|file2_buff
index|[
literal|20
index|]
decl_stmt|;
name|int
name|file2_size
init|=
sizeof|sizeof
argument_list|(
name|file2_buff
argument_list|)
decl_stmt|;
specifier|const
name|char
name|file2_test_txt
index|[]
init|=
literal|"test text document\r\n"
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"LibarchiveAddingTest.html"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|file1_size
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|file1_size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|file1_buff
argument_list|,
name|file1_size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
operator|&
name|file1_buff
index|[
name|file1_size
operator|-
sizeof|sizeof
argument_list|(
name|file1_test_txt
argument_list|)
operator|+
literal|1
index|]
argument_list|,
name|file1_test_txt
argument_list|,
sizeof|sizeof
argument_list|(
name|file1_test_txt
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* Second header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testlink"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|41471
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"LibarchiveAddingTest.html"
argument_list|,
name|archive_entry_symlink
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
literal|0
argument_list|,
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|file1_buff
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Third header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir/test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|file2_size
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|file2_size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|file2_buff
argument_list|,
name|file2_size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
operator|&
name|file2_buff
index|[
name|file2_size
operator|+
literal|1
operator|-
sizeof|sizeof
argument_list|(
name|file2_test_txt
argument_list|)
index|]
argument_list|,
name|file2_test_txt
argument_list|,
sizeof|sizeof
argument_list|(
name|file2_test_txt
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* Fourth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir/LibarchiveAddingTest.html"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|file1_size
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|file1_size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|file1_buff
argument_list|,
name|file1_size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
operator|&
name|file1_buff
index|[
name|file1_size
operator|-
sizeof|sizeof
argument_list|(
name|file1_test_txt
argument_list|)
operator|+
literal|1
index|]
argument_list|,
name|file1_test_txt
argument_list|,
sizeof|sizeof
argument_list|(
name|file1_test_txt
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* Fifth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Sixth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testemptydir"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|6
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* This test is for sufficiently large files that would have been compressed  * using multiple lzss blocks.  */
end_comment

begin_function
specifier|static
name|void
name|test_multi_lzss_blocks
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar_multi_lzss_blocks.rar"
decl_stmt|;
specifier|const
name|char
name|test_txt
index|[]
init|=
literal|"-bottom: 0in\"><BR>\n</P>\n</BODY>\n</HTML>"
decl_stmt|;
name|int
name|size
init|=
literal|20131111
decl_stmt|,
name|offset
init|=
literal|0
decl_stmt|;
name|char
name|buff
index|[
literal|64
index|]
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"multi_lzss_blocks_test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|size
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|offset
operator|+
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
operator|<
name|size
condition|)
block|{
name|assertA
argument_list|(
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|offset
operator|+=
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
expr_stmt|;
block|}
name|assertA
argument_list|(
name|size
operator|-
name|offset
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
name|size
operator|-
name|offset
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
name|size
operator|-
name|offset
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|1
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_compress_best
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar_compress_best.rar"
decl_stmt|;
name|char
name|file1_buff
index|[
literal|20111
index|]
decl_stmt|;
name|int
name|file1_size
init|=
sizeof|sizeof
argument_list|(
name|file1_buff
argument_list|)
decl_stmt|;
specifier|const
name|char
name|file1_test_txt
index|[]
init|=
literal|"<P STYLE=\"margin-bottom: 0in\"><BR>\n"
literal|"</P>\n"
literal|"</BODY>\n"
literal|"</HTML>"
decl_stmt|;
name|char
name|file2_buff
index|[
literal|20
index|]
decl_stmt|;
name|int
name|file2_size
init|=
sizeof|sizeof
argument_list|(
name|file2_buff
argument_list|)
decl_stmt|;
specifier|const
name|char
name|file2_test_txt
index|[]
init|=
literal|"test text document\r\n"
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"LibarchiveAddingTest.html"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|file1_size
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|file1_size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|file1_buff
argument_list|,
name|file1_size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
operator|&
name|file1_buff
index|[
name|file1_size
operator|-
sizeof|sizeof
argument_list|(
name|file1_test_txt
argument_list|)
operator|+
literal|1
index|]
argument_list|,
name|file1_test_txt
argument_list|,
sizeof|sizeof
argument_list|(
name|file1_test_txt
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* Second header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testlink"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|41471
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"LibarchiveAddingTest.html"
argument_list|,
name|archive_entry_symlink
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
literal|0
argument_list|,
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|file1_buff
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Third header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir/test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|file2_size
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|file2_size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|file2_buff
argument_list|,
name|file2_size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
operator|&
name|file2_buff
index|[
name|file2_size
operator|+
literal|1
operator|-
sizeof|sizeof
argument_list|(
name|file2_test_txt
argument_list|)
index|]
argument_list|,
name|file2_test_txt
argument_list|,
sizeof|sizeof
argument_list|(
name|file2_test_txt
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* Fourth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir/LibarchiveAddingTest.html"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|file1_size
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|file1_size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|file1_buff
argument_list|,
name|file1_size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
operator|&
name|file1_buff
index|[
name|file1_size
operator|-
sizeof|sizeof
argument_list|(
name|file1_test_txt
argument_list|)
operator|+
literal|1
index|]
argument_list|,
name|file1_test_txt
argument_list|,
sizeof|sizeof
argument_list|(
name|file1_test_txt
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* Fifth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Sixth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testemptydir"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|6
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* This is a test for RAR files compressed using a technique where compression  * switches back and forth to and from ppmd and lzss decoding.  */
end_comment

begin_function
specifier|static
name|void
name|test_ppmd_lzss_conversion
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar_ppmd_lzss_conversion.rar"
decl_stmt|;
specifier|const
name|char
name|test_txt
index|[]
init|=
literal|"gin-bottom: 0in\"><BR>\n</P>\n</BODY>\n</HTML>"
decl_stmt|;
name|int
name|size
init|=
literal|241647978
decl_stmt|,
name|offset
init|=
literal|0
decl_stmt|;
name|char
name|buff
index|[
literal|64
index|]
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"ppmd_lzss_conversion_test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|size
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|offset
operator|+
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
operator|<
name|size
condition|)
block|{
name|assertA
argument_list|(
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|offset
operator|+=
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
expr_stmt|;
block|}
name|assertA
argument_list|(
name|size
operator|-
name|offset
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
name|size
operator|-
name|offset
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
name|size
operator|-
name|offset
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|1
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_binary
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar_binary_data.rar"
decl_stmt|;
name|char
name|file1_buff
index|[
literal|1048576
index|]
decl_stmt|;
name|int
name|file1_size
init|=
sizeof|sizeof
argument_list|(
name|file1_buff
argument_list|)
decl_stmt|;
specifier|const
name|char
name|file1_test_txt
index|[]
init|=
literal|"\x37\xef\xb2\xbe\x33\xf6\xcc\xcb\xee\x2a\x10"
literal|"\x9d\x2e\x01\xe9\xf6\xf9\xe5\xe6\x67\x0c\x2b"
literal|"\xd8\x6b\xa0\x26\x9a\xf7\x93\x87\x42\xf1\x08"
literal|"\x42\xdc\x9b\x76\x91\x20\xa4\x01\xbe\x67\xbd"
literal|"\x08\x74\xde\xec"
decl_stmt|;
name|char
name|file2_buff
index|[
literal|32618
index|]
decl_stmt|;
name|int
name|file2_size
init|=
sizeof|sizeof
argument_list|(
name|file2_buff
argument_list|)
decl_stmt|;
specifier|const
name|char
name|file2_test_txt
index|[]
init|=
literal|"\x00\xee\x78\x00\x00\x4d\x45\x54\x41\x2d\x49"
literal|"\x4e\x46\x2f\x6d\x61\x6e\x69\x66\x65\x73\x74"
literal|"\x2e\x78\x6d\x6c\x50\x4b\x05\x06\x00\x00\x00"
literal|"\x00\x12\x00\x12\x00\xaa\x04\x00\x00\xaa\x7a"
literal|"\x00\x00\x00\x00"
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"random_data.bin"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|file1_size
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|file1_size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|file1_buff
argument_list|,
name|file1_size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
operator|&
name|file1_buff
index|[
name|file1_size
operator|-
sizeof|sizeof
argument_list|(
name|file1_test_txt
argument_list|)
operator|+
literal|1
index|]
argument_list|,
name|file1_test_txt
argument_list|,
sizeof|sizeof
argument_list|(
name|file1_test_txt
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* Second header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"LibarchiveAddingTest.odt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|file2_size
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|file2_size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|file2_buff
argument_list|,
name|file2_size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
operator|&
name|file2_buff
index|[
name|file2_size
operator|+
literal|1
operator|-
sizeof|sizeof
argument_list|(
name|file2_test_txt
argument_list|)
index|]
argument_list|,
name|file2_test_txt
argument_list|,
sizeof|sizeof
argument_list|(
name|file2_test_txt
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|2
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_windows
parameter_list|(
name|void
parameter_list|)
block|{
name|char
name|buff
index|[
literal|441
index|]
decl_stmt|;
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar_windows.rar"
decl_stmt|;
specifier|const
name|char
name|test_txt
index|[]
init|=
literal|"test text file\r\n"
decl_stmt|;
name|int
name|size
init|=
sizeof|sizeof
argument_list|(
name|test_txt
argument_list|)
operator|-
literal|1
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir/test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
name|size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
name|size
argument_list|)
expr_stmt|;
comment|/* Second header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
name|size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
name|size
argument_list|)
expr_stmt|;
comment|/* Third header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testshortcut.lnk"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Fourth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Fifth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testemptydir"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|5
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_sfx
parameter_list|(
name|void
parameter_list|)
block|{
name|char
name|buff
index|[
literal|441
index|]
decl_stmt|;
specifier|const
name|char
name|reffile
index|[]
init|=
literal|"test_read_format_rar_sfx.exe"
decl_stmt|;
specifier|const
name|char
name|test_txt
index|[]
init|=
literal|"test text file\r\n"
decl_stmt|;
name|int
name|size
init|=
sizeof|sizeof
argument_list|(
name|test_txt
argument_list|)
operator|-
literal|1
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|ae
decl_stmt|;
name|struct
name|archive
modifier|*
name|a
decl_stmt|;
name|extract_reference_file
argument_list|(
name|reffile
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|a
operator|=
name|archive_read_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_filter_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_support_format_all
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_open_file
argument_list|(
name|a
argument_list|,
name|reffile
argument_list|,
literal|10240
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
name|size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
name|size
argument_list|)
expr_stmt|;
comment|/* Second header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testshortcut.lnk"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Third header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir/test.txt"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|33188
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
name|size
operator|==
name|archive_read_data
argument_list|(
name|a
argument_list|,
name|buff
argument_list|,
name|size
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualMem
argument_list|(
name|buff
argument_list|,
name|test_txt
argument_list|,
name|size
argument_list|)
expr_stmt|;
comment|/* Fourth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testdir"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Fifth header. */
name|assertA
argument_list|(
literal|0
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
literal|"testemptydir"
argument_list|,
name|archive_entry_pathname
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_mtime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_ctime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertA
argument_list|(
operator|(
name|int
operator|)
name|archive_entry_atime
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_size
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|16877
argument_list|,
name|archive_entry_mode
argument_list|(
name|ae
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Test EOF */
name|assertA
argument_list|(
literal|1
operator|==
name|archive_read_next_header
argument_list|(
name|a
argument_list|,
operator|&
name|ae
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|5
argument_list|,
name|archive_file_count
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualIntA
argument_list|(
name|a
argument_list|,
name|ARCHIVE_OK
argument_list|,
name|archive_read_close
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_OK
argument_list|,
name|archive_read_free
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|DEFINE_TEST
argument_list|(
argument|test_read_format_rar
argument_list|)
end_macro

begin_block
block|{
name|test_basic
argument_list|()
expr_stmt|;
name|test_subblock
argument_list|()
expr_stmt|;
name|test_noeof
argument_list|()
expr_stmt|;
name|test_unicode_UTF8
argument_list|()
expr_stmt|;
name|test_unicode_CP932
argument_list|()
expr_stmt|;
name|test_compress_normal
argument_list|()
expr_stmt|;
name|test_multi_lzss_blocks
argument_list|()
expr_stmt|;
name|test_compress_best
argument_list|()
expr_stmt|;
name|test_ppmd_lzss_conversion
argument_list|()
expr_stmt|;
name|test_binary
argument_list|()
expr_stmt|;
name|test_windows
argument_list|()
expr_stmt|;
name|test_sfx
argument_list|()
expr_stmt|;
block|}
end_block

end_unit

