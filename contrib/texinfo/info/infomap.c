begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* infomap.c -- Keymaps for Info. */
end_comment

begin_comment
comment|/* This file is part of GNU Info, a program for reading online documentation    stored in Info format.     Copyright (C) 1993 Free Software Foundation, Inc.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2, or (at your option)    any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.     Written by Brian Fox (bfox@ai.mit.edu). */
end_comment

begin_include
include|#
directive|include
file|"stdio.h"
end_include

begin_include
include|#
directive|include
file|"ctype.h"
end_include

begin_include
include|#
directive|include
file|"infomap.h"
end_include

begin_include
include|#
directive|include
file|"funs.h"
end_include

begin_include
include|#
directive|include
file|"info.h"
end_include

begin_function_decl
specifier|static
name|void
name|add_function_key
parameter_list|(
name|char
modifier|*
parameter_list|,
name|VFunction
modifier|*
parameter_list|,
name|Keymap
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|term_ku
decl_stmt|,
modifier|*
name|term_kd
decl_stmt|,
modifier|*
name|term_kr
decl_stmt|,
modifier|*
name|term_kl
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|term_kP
decl_stmt|,
modifier|*
name|term_kN
decl_stmt|,
modifier|*
name|term_kh
decl_stmt|,
modifier|*
name|term_kH
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Return a new keymap which has all the uppercase letters mapped to run    the function info_do_lowercase_version (). */
end_comment

begin_function
name|Keymap
name|keymap_make_keymap
parameter_list|()
block|{
specifier|register
name|int
name|i
decl_stmt|;
name|Keymap
name|keymap
decl_stmt|;
name|keymap
operator|=
operator|(
name|Keymap
operator|)
name|xmalloc
argument_list|(
literal|256
operator|*
sizeof|sizeof
argument_list|(
name|KEYMAP_ENTRY
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
block|{
name|keymap
index|[
name|i
index|]
operator|.
name|type
operator|=
name|ISFUNC
expr_stmt|;
name|keymap
index|[
name|i
index|]
operator|.
name|function
operator|=
operator|(
name|VFunction
operator|*
operator|)
name|NULL
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|'A'
init|;
name|i
operator|<
operator|(
literal|'Z'
operator|+
literal|1
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|keymap
index|[
name|i
index|]
operator|.
name|type
operator|=
name|ISFUNC
expr_stmt|;
name|keymap
index|[
name|i
index|]
operator|.
name|function
operator|=
name|info_do_lowercase_version
expr_stmt|;
block|}
return|return
operator|(
name|keymap
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Return a new keymap which is a copy of MAP. */
end_comment

begin_function
name|Keymap
name|keymap_copy_keymap
parameter_list|(
name|map
parameter_list|)
name|Keymap
name|map
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|;
name|Keymap
name|keymap
decl_stmt|;
name|keymap
operator|=
name|keymap_make_keymap
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
block|{
name|keymap
index|[
name|i
index|]
operator|.
name|type
operator|=
name|map
index|[
name|i
index|]
operator|.
name|type
expr_stmt|;
name|keymap
index|[
name|i
index|]
operator|.
name|function
operator|=
name|map
index|[
name|i
index|]
operator|.
name|function
expr_stmt|;
block|}
return|return
operator|(
name|keymap
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Free the keymap and it's descendents. */
end_comment

begin_function_decl
name|void
name|keymap_discard_keymap
parameter_list|(
name|map
parameter_list|)
function_decl|Keymap
parameter_list|(
name|map
parameter_list|)
function_decl|;
end_function_decl

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|map
condition|)
return|return;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
block|{
switch|switch
condition|(
name|map
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
case|case
name|ISFUNC
case|:
break|break;
case|case
name|ISKMAP
case|:
name|keymap_discard_keymap
argument_list|(
operator|(
name|Keymap
operator|)
name|map
index|[
name|i
index|]
operator|.
name|function
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
end_block

begin_comment
comment|/* Initialize the standard info keymaps. */
end_comment

begin_decl_stmt
name|Keymap
name|info_keymap
init|=
operator|(
name|Keymap
operator|)
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Keymap
name|echo_area_keymap
init|=
operator|(
name|Keymap
operator|)
name|NULL
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|initialize_info_keymaps
parameter_list|()
block|{
specifier|register
name|int
name|i
decl_stmt|;
name|Keymap
name|map
decl_stmt|;
if|if
condition|(
operator|!
name|info_keymap
condition|)
block|{
name|info_keymap
operator|=
name|keymap_make_keymap
argument_list|()
expr_stmt|;
name|info_keymap
index|[
name|ESC
index|]
operator|.
name|type
operator|=
name|ISKMAP
expr_stmt|;
name|info_keymap
index|[
name|ESC
index|]
operator|.
name|function
operator|=
operator|(
name|VFunction
operator|*
operator|)
name|keymap_make_keymap
argument_list|()
expr_stmt|;
name|info_keymap
index|[
name|Control
argument_list|(
literal|'x'
argument_list|)
index|]
operator|.
name|type
operator|=
name|ISKMAP
expr_stmt|;
name|info_keymap
index|[
name|Control
argument_list|(
literal|'x'
argument_list|)
index|]
operator|.
name|function
operator|=
operator|(
name|VFunction
operator|*
operator|)
name|keymap_make_keymap
argument_list|()
expr_stmt|;
name|echo_area_keymap
operator|=
name|keymap_make_keymap
argument_list|()
expr_stmt|;
name|echo_area_keymap
index|[
name|ESC
index|]
operator|.
name|type
operator|=
name|ISKMAP
expr_stmt|;
name|echo_area_keymap
index|[
name|ESC
index|]
operator|.
name|function
operator|=
operator|(
name|VFunction
operator|*
operator|)
name|keymap_make_keymap
argument_list|()
expr_stmt|;
name|echo_area_keymap
index|[
name|Control
argument_list|(
literal|'x'
argument_list|)
index|]
operator|.
name|type
operator|=
name|ISKMAP
expr_stmt|;
name|echo_area_keymap
index|[
name|Control
argument_list|(
literal|'x'
argument_list|)
index|]
operator|.
name|function
operator|=
operator|(
name|VFunction
operator|*
operator|)
name|keymap_make_keymap
argument_list|()
expr_stmt|;
block|}
comment|/* Bind numeric arg functions for both echo area and info window maps. */
for|for
control|(
name|i
operator|=
literal|'0'
init|;
name|i
operator|<
literal|'9'
operator|+
literal|1
condition|;
name|i
operator|++
control|)
block|{
operator|(
operator|(
name|Keymap
operator|)
name|info_keymap
index|[
name|ESC
index|]
operator|.
name|function
operator|)
index|[
name|i
index|]
operator|.
name|function
operator|=
operator|(
operator|(
name|Keymap
operator|)
name|echo_area_keymap
index|[
name|ESC
index|]
operator|.
name|function
operator|)
index|[
name|i
index|]
operator|.
name|function
operator|=
name|info_add_digit_to_numeric_arg
expr_stmt|;
block|}
operator|(
operator|(
name|Keymap
operator|)
name|info_keymap
index|[
name|ESC
index|]
operator|.
name|function
operator|)
index|[
literal|'-'
index|]
operator|.
name|function
operator|=
operator|(
operator|(
name|Keymap
operator|)
name|echo_area_keymap
index|[
name|ESC
index|]
operator|.
name|function
operator|)
index|[
literal|'-'
index|]
operator|.
name|function
operator|=
name|info_add_digit_to_numeric_arg
expr_stmt|;
comment|/* Bind the echo area routines. */
name|map
operator|=
name|echo_area_keymap
expr_stmt|;
comment|/* Bind the echo area insert routines. */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|160
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|isprint
argument_list|(
name|i
argument_list|)
condition|)
name|map
index|[
name|i
index|]
operator|.
name|function
operator|=
name|ea_insert
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'a'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_beg_of_line
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'b'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_backward
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'d'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_delete
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'e'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_end_of_line
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'f'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_forward
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'g'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_abort
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'h'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_rubout
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'k'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_kill_line
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'l'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_redraw_display
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'q'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_quoted_insert
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'t'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_transpose_chars
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'u'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_universal_argument
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'y'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_yank
expr_stmt|;
name|map
index|[
name|LFD
index|]
operator|.
name|function
operator|=
name|ea_newline
expr_stmt|;
name|map
index|[
name|RET
index|]
operator|.
name|function
operator|=
name|ea_newline
expr_stmt|;
name|map
index|[
name|SPC
index|]
operator|.
name|function
operator|=
name|ea_complete
expr_stmt|;
name|map
index|[
name|TAB
index|]
operator|.
name|function
operator|=
name|ea_complete
expr_stmt|;
name|map
index|[
literal|'?'
index|]
operator|.
name|function
operator|=
name|ea_possible_completions
expr_stmt|;
name|map
index|[
name|DEL
index|]
operator|.
name|function
operator|=
name|ea_rubout
expr_stmt|;
comment|/* Bind the echo area ESC keymap. */
name|map
operator|=
operator|(
name|Keymap
operator|)
name|echo_area_keymap
index|[
name|ESC
index|]
operator|.
name|function
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'g'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_abort
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'v'
argument_list|)
index|]
operator|.
name|function
operator|=
name|ea_scroll_completions_window
expr_stmt|;
name|map
index|[
literal|'b'
index|]
operator|.
name|function
operator|=
name|ea_backward_word
expr_stmt|;
name|map
index|[
literal|'d'
index|]
operator|.
name|function
operator|=
name|ea_kill_word
expr_stmt|;
name|map
index|[
literal|'f'
index|]
operator|.
name|function
operator|=
name|ea_forward_word
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|NAMED_FUNCTIONS
argument_list|)
comment|/* map['x'].function = info_execute_command; */
endif|#
directive|endif
comment|/* NAMED_FUNCTIONS */
name|map
index|[
literal|'y'
index|]
operator|.
name|function
operator|=
name|ea_yank_pop
expr_stmt|;
name|map
index|[
literal|'?'
index|]
operator|.
name|function
operator|=
name|ea_possible_completions
expr_stmt|;
name|map
index|[
name|TAB
index|]
operator|.
name|function
operator|=
name|ea_tab_insert
expr_stmt|;
name|map
index|[
name|DEL
index|]
operator|.
name|function
operator|=
name|ea_backward_kill_word
expr_stmt|;
comment|/* Bind the echo area Control-x keymap. */
name|map
operator|=
operator|(
name|Keymap
operator|)
name|echo_area_keymap
index|[
name|Control
argument_list|(
literal|'x'
argument_list|)
index|]
operator|.
name|function
expr_stmt|;
name|map
index|[
literal|'o'
index|]
operator|.
name|function
operator|=
name|info_next_window
expr_stmt|;
name|map
index|[
name|DEL
index|]
operator|.
name|function
operator|=
name|ea_backward_kill_line
expr_stmt|;
comment|/* Bind commands for Info window keymaps. */
name|map
operator|=
name|info_keymap
expr_stmt|;
name|map
index|[
name|TAB
index|]
operator|.
name|function
operator|=
name|info_move_to_next_xref
expr_stmt|;
name|map
index|[
name|LFD
index|]
operator|.
name|function
operator|=
name|info_select_reference_this_line
expr_stmt|;
name|map
index|[
name|RET
index|]
operator|.
name|function
operator|=
name|info_select_reference_this_line
expr_stmt|;
name|map
index|[
name|SPC
index|]
operator|.
name|function
operator|=
name|info_scroll_forward
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'a'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_beginning_of_line
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'b'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_backward_char
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'e'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_end_of_line
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'f'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_forward_char
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'g'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_abort_key
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'h'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_get_help_window
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'l'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_redraw_display
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'n'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_next_line
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'p'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_prev_line
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'r'
argument_list|)
index|]
operator|.
name|function
operator|=
name|isearch_backward
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'s'
argument_list|)
index|]
operator|.
name|function
operator|=
name|isearch_forward
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'u'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_universal_argument
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'v'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_scroll_forward
expr_stmt|;
name|map
index|[
literal|','
index|]
operator|.
name|function
operator|=
name|info_next_index_match
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|'1'
init|;
name|i
operator|<
literal|'9'
operator|+
literal|1
condition|;
name|i
operator|++
control|)
name|map
index|[
name|i
index|]
operator|.
name|function
operator|=
name|info_menu_digit
expr_stmt|;
name|map
index|[
literal|'0'
index|]
operator|.
name|function
operator|=
name|info_last_menu_item
expr_stmt|;
name|map
index|[
literal|'<'
index|]
operator|.
name|function
operator|=
name|info_first_node
expr_stmt|;
name|map
index|[
literal|'>'
index|]
operator|.
name|function
operator|=
name|info_last_node
expr_stmt|;
name|map
index|[
literal|'?'
index|]
operator|.
name|function
operator|=
name|info_get_help_window
expr_stmt|;
name|map
index|[
literal|'['
index|]
operator|.
name|function
operator|=
name|info_global_prev_node
expr_stmt|;
name|map
index|[
literal|']'
index|]
operator|.
name|function
operator|=
name|info_global_next_node
expr_stmt|;
name|map
index|[
literal|'b'
index|]
operator|.
name|function
operator|=
name|info_beginning_of_node
expr_stmt|;
name|map
index|[
literal|'d'
index|]
operator|.
name|function
operator|=
name|info_dir_node
expr_stmt|;
name|map
index|[
literal|'e'
index|]
operator|.
name|function
operator|=
name|info_end_of_node
expr_stmt|;
name|map
index|[
literal|'f'
index|]
operator|.
name|function
operator|=
name|info_xref_item
expr_stmt|;
name|map
index|[
literal|'g'
index|]
operator|.
name|function
operator|=
name|info_goto_node
expr_stmt|;
name|map
index|[
literal|'h'
index|]
operator|.
name|function
operator|=
name|info_get_info_help_node
expr_stmt|;
name|map
index|[
literal|'i'
index|]
operator|.
name|function
operator|=
name|info_index_search
expr_stmt|;
name|map
index|[
literal|'l'
index|]
operator|.
name|function
operator|=
name|info_history_node
expr_stmt|;
name|map
index|[
literal|'m'
index|]
operator|.
name|function
operator|=
name|info_menu_item
expr_stmt|;
name|map
index|[
literal|'n'
index|]
operator|.
name|function
operator|=
name|info_next_node
expr_stmt|;
name|map
index|[
literal|'p'
index|]
operator|.
name|function
operator|=
name|info_prev_node
expr_stmt|;
name|map
index|[
literal|'q'
index|]
operator|.
name|function
operator|=
name|info_quit
expr_stmt|;
name|map
index|[
literal|'r'
index|]
operator|.
name|function
operator|=
name|info_xref_item
expr_stmt|;
name|map
index|[
literal|'s'
index|]
operator|.
name|function
operator|=
name|info_search
expr_stmt|;
name|map
index|[
literal|'t'
index|]
operator|.
name|function
operator|=
name|info_top_node
expr_stmt|;
name|map
index|[
literal|'u'
index|]
operator|.
name|function
operator|=
name|info_up_node
expr_stmt|;
name|map
index|[
name|DEL
index|]
operator|.
name|function
operator|=
name|info_scroll_backward
expr_stmt|;
comment|/* Bind members in the ESC map for Info windows. */
name|map
operator|=
operator|(
name|Keymap
operator|)
name|info_keymap
index|[
name|ESC
index|]
operator|.
name|function
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'f'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_show_footnotes
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'g'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_abort_key
expr_stmt|;
name|map
index|[
name|TAB
index|]
operator|.
name|function
operator|=
name|info_move_to_prev_xref
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'v'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_scroll_other_window
expr_stmt|;
name|map
index|[
literal|'<'
index|]
operator|.
name|function
operator|=
name|info_beginning_of_node
expr_stmt|;
name|map
index|[
literal|'>'
index|]
operator|.
name|function
operator|=
name|info_end_of_node
expr_stmt|;
name|map
index|[
literal|'b'
index|]
operator|.
name|function
operator|=
name|info_backward_word
expr_stmt|;
name|map
index|[
literal|'f'
index|]
operator|.
name|function
operator|=
name|info_forward_word
expr_stmt|;
name|map
index|[
literal|'r'
index|]
operator|.
name|function
operator|=
name|info_move_to_window_line
expr_stmt|;
name|map
index|[
literal|'v'
index|]
operator|.
name|function
operator|=
name|info_scroll_backward
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|NAMED_FUNCTIONS
argument_list|)
name|map
index|[
literal|'x'
index|]
operator|.
name|function
operator|=
name|info_execute_command
expr_stmt|;
endif|#
directive|endif
comment|/* NAMED_FUNCTIONS */
comment|/* Bind members in the Control-X map for Info windows. */
name|map
operator|=
operator|(
name|Keymap
operator|)
name|info_keymap
index|[
name|Control
argument_list|(
literal|'x'
argument_list|)
index|]
operator|.
name|function
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'b'
argument_list|)
index|]
operator|.
name|function
operator|=
name|list_visited_nodes
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'c'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_quit
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'f'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_view_file
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'g'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_abort_key
expr_stmt|;
name|map
index|[
name|Control
argument_list|(
literal|'v'
argument_list|)
index|]
operator|.
name|function
operator|=
name|info_view_file
expr_stmt|;
name|map
index|[
literal|'0'
index|]
operator|.
name|function
operator|=
name|info_delete_window
expr_stmt|;
name|map
index|[
literal|'1'
index|]
operator|.
name|function
operator|=
name|info_keep_one_window
expr_stmt|;
name|map
index|[
literal|'2'
index|]
operator|.
name|function
operator|=
name|info_split_window
expr_stmt|;
name|map
index|[
literal|'^'
index|]
operator|.
name|function
operator|=
name|info_grow_window
expr_stmt|;
name|map
index|[
literal|'b'
index|]
operator|.
name|function
operator|=
name|select_visited_node
expr_stmt|;
name|map
index|[
literal|'k'
index|]
operator|.
name|function
operator|=
name|info_kill_node
expr_stmt|;
name|map
index|[
literal|'o'
index|]
operator|.
name|function
operator|=
name|info_next_window
expr_stmt|;
name|map
index|[
literal|'t'
index|]
operator|.
name|function
operator|=
name|info_tile_windows
expr_stmt|;
name|map
index|[
literal|'w'
index|]
operator|.
name|function
operator|=
name|info_toggle_wrap
expr_stmt|;
comment|/* Add functions for the arrow keys, PageUp, PageDown, Home, HomeDown */
name|add_function_key
argument_list|(
name|term_ku
argument_list|,
name|info_prev_line
argument_list|,
name|info_keymap
argument_list|)
expr_stmt|;
name|add_function_key
argument_list|(
name|term_kd
argument_list|,
name|info_next_line
argument_list|,
name|info_keymap
argument_list|)
expr_stmt|;
name|add_function_key
argument_list|(
name|term_kl
argument_list|,
name|info_backward_char
argument_list|,
name|info_keymap
argument_list|)
expr_stmt|;
name|add_function_key
argument_list|(
name|term_kr
argument_list|,
name|info_forward_char
argument_list|,
name|info_keymap
argument_list|)
expr_stmt|;
name|add_function_key
argument_list|(
name|term_kP
argument_list|,
name|info_scroll_backward
argument_list|,
name|info_keymap
argument_list|)
expr_stmt|;
name|add_function_key
argument_list|(
name|term_kN
argument_list|,
name|info_scroll_forward
argument_list|,
name|info_keymap
argument_list|)
expr_stmt|;
name|add_function_key
argument_list|(
name|term_kh
argument_list|,
name|info_beginning_of_node
argument_list|,
name|info_keymap
argument_list|)
expr_stmt|;
name|add_function_key
argument_list|(
name|term_kH
argument_list|,
name|info_end_of_node
argument_list|,
name|info_keymap
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|add_function_key
parameter_list|(
name|char
modifier|*
name|esc_seq
parameter_list|,
name|VFunction
modifier|*
name|func
parameter_list|,
name|Keymap
name|map
parameter_list|)
block|{
name|char
modifier|*
name|end_str
decl_stmt|,
modifier|*
name|p
decl_stmt|;
if|if
condition|(
operator|!
name|esc_seq
condition|)
return|return;
comment|/* don't add keys which don't exist */
name|end_str
operator|=
name|esc_seq
operator|+
name|strlen
argument_list|(
name|esc_seq
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|esc_seq
init|;
name|p
operator|<
name|end_str
condition|;
name|p
operator|++
control|)
block|{
if|if
condition|(
name|isupper
argument_list|(
operator|*
name|p
argument_list|)
condition|)
operator|*
name|p
operator|=
name|tolower
argument_list|(
operator|*
name|p
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|map
index|[
operator|*
name|p
index|]
operator|.
name|type
condition|)
block|{
case|case
name|ISKMAP
case|:
comment|/* Go one level down. Also has the effect                                that we're not overwriting a previous                                binding if we're at the end of p */
name|map
operator|=
operator|(
name|Keymap
operator|)
name|map
index|[
operator|*
name|p
index|]
operator|.
name|function
expr_stmt|;
break|break;
case|case
name|ISFUNC
case|:
comment|/* two possibilities here:                                1. map[*p].function == NULL means we have                                    a virgin keymap to fill;                                2. else this entry is already taken */
if|if
condition|(
name|map
index|[
operator|*
name|p
index|]
operator|.
name|function
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|p
operator|==
name|end_str
operator|-
literal|1
condition|)
block|{
name|map
index|[
operator|*
name|p
index|]
operator|.
name|function
operator|=
name|func
expr_stmt|;
return|return;
block|}
name|map
index|[
operator|*
name|p
index|]
operator|.
name|type
operator|=
name|ISKMAP
expr_stmt|;
name|map
index|[
operator|*
name|p
index|]
operator|.
name|function
operator|=
operator|(
name|VFunction
operator|*
operator|)
name|keymap_make_keymap
argument_list|()
expr_stmt|;
name|map
operator|=
operator|(
name|Keymap
operator|)
name|map
index|[
operator|*
name|p
index|]
operator|.
name|function
expr_stmt|;
block|}
else|else
return|return;
break|break;
default|default:
comment|/* can't happen */
name|info_error
argument_list|(
literal|"unknown keymap type (%d)."
argument_list|,
name|map
index|[
operator|*
name|p
index|]
operator|.
name|type
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
return|return;
block|}
end_function

end_unit

