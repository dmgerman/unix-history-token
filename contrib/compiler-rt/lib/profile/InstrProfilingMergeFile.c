begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*===- InstrProfilingMergeFile.c - Profile in-process Merging  ------------===*\ |* |*                     The LLVM Compiler Infrastructure |* |* This file is distributed under the University of Illinois Open Source |* License. See LICENSE.TXT for details. |* |*===----------------------------------------------------------------------=== |* This file defines APIs needed to support in-process merging for profile data |* stored in files. \*===----------------------------------------------------------------------===*/
end_comment

begin_include
include|#
directive|include
file|"InstrProfiling.h"
end_include

begin_include
include|#
directive|include
file|"InstrProfilingInternal.h"
end_include

begin_include
include|#
directive|include
file|"InstrProfilingUtil.h"
end_include

begin_define
define|#
directive|define
name|INSTR_PROF_VALUE_PROF_DATA
end_define

begin_include
include|#
directive|include
file|"InstrProfData.inc"
end_include

begin_function_decl
name|void
function_decl|(
modifier|*
name|VPMergeHook
function_decl|)
parameter_list|(
name|ValueProfData
modifier|*
parameter_list|,
name|__llvm_profile_data
modifier|*
parameter_list|)
init|=
operator|&
name|lprofMergeValueProfData
function_decl|;
end_function_decl

begin_comment
comment|/* Merge value profile data pointed to by SrcValueProfData into  * in-memory profile counters pointed by to DstData.  */
end_comment

begin_function
name|void
name|lprofMergeValueProfData
parameter_list|(
name|ValueProfData
modifier|*
name|SrcValueProfData
parameter_list|,
name|__llvm_profile_data
modifier|*
name|DstData
parameter_list|)
block|{
name|unsigned
name|I
decl_stmt|,
name|S
decl_stmt|,
name|V
decl_stmt|,
name|C
decl_stmt|;
name|InstrProfValueData
modifier|*
name|VData
decl_stmt|;
name|ValueProfRecord
modifier|*
name|VR
init|=
name|getFirstValueProfRecord
argument_list|(
name|SrcValueProfData
argument_list|)
decl_stmt|;
for|for
control|(
name|I
operator|=
literal|0
init|;
name|I
operator|<
name|SrcValueProfData
operator|->
name|NumValueKinds
condition|;
name|I
operator|++
control|)
block|{
name|VData
operator|=
name|getValueProfRecordValueData
argument_list|(
name|VR
argument_list|)
expr_stmt|;
for|for
control|(
name|S
operator|=
literal|0
init|;
name|S
operator|<
name|VR
operator|->
name|NumValueSites
condition|;
name|S
operator|++
control|)
block|{
name|uint8_t
name|NV
init|=
name|VR
operator|->
name|SiteCountArray
index|[
name|S
index|]
decl_stmt|;
for|for
control|(
name|V
operator|=
literal|0
init|;
name|V
operator|<
name|NV
condition|;
name|V
operator|++
control|)
block|{
for|for
control|(
name|C
operator|=
literal|0
init|;
name|C
operator|<
name|VData
index|[
name|V
index|]
operator|.
name|Count
condition|;
name|C
operator|++
control|)
name|__llvm_profile_instrument_target
argument_list|(
name|VData
index|[
name|V
index|]
operator|.
name|Value
argument_list|,
name|DstData
argument_list|,
name|S
argument_list|)
expr_stmt|;
block|}
block|}
name|VR
operator|=
name|getValueProfRecordNext
argument_list|(
name|VR
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

