begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* print.c     Turn data structures into printable text. */
end_comment

begin_comment
comment|/*  * Copyright (c) 1995-2001 Internet Software Consortium.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. Neither the name of The Internet Software Consortium nor the names  *    of its contributors may be used to endorse or promote products derived  *    from this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE INTERNET SOFTWARE CONSORTIUM AND  * CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,  * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE  * DISCLAIMED.  IN NO EVENT SHALL THE INTERNET SOFTWARE CONSORTIUM OR  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF  * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT  * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * This software has been written for the Internet Software Consortium  * by Ted Lemon in cooperation with Vixie Enterprises and Nominum, Inc.  * To learn more about the Internet Software Consortium, see  * ``http://www.isc.org/''.  To learn more about Vixie Enterprises,  * see ``http://www.vix.com''.   To learn more about Nominum, Inc., see  * ``http://www.nominum.com''.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|copyright
index|[]
init|=
literal|"$Id: print.c,v 1.53.2.4 2001/08/08 14:49:20 mellon Exp $ Copyright (c) 1995-2001 The Internet Software Consortium.  All rights reserved.\n"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_include
include|#
directive|include
file|"dhcpd.h"
end_include

begin_function
name|char
modifier|*
name|quotify_string
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|,
specifier|const
name|char
modifier|*
name|file
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|unsigned
name|len
init|=
literal|0
decl_stmt|;
specifier|const
name|char
modifier|*
name|sp
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|,
modifier|*
name|nsp
decl_stmt|;
for|for
control|(
name|sp
operator|=
name|s
init|;
name|sp
operator|&&
operator|*
name|sp
condition|;
name|sp
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|sp
operator|==
literal|' '
condition|)
name|len
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|isascii
argument_list|(
operator|*
name|sp
argument_list|)
operator|||
operator|!
name|isprint
argument_list|(
operator|*
name|sp
argument_list|)
condition|)
name|len
operator|+=
literal|4
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|sp
operator|==
literal|'"'
operator|||
operator|*
name|sp
operator|==
literal|'\\'
condition|)
name|len
operator|+=
literal|2
expr_stmt|;
else|else
name|len
operator|++
expr_stmt|;
block|}
name|buf
operator|=
name|dmalloc
argument_list|(
name|len
operator|+
literal|1
argument_list|,
name|file
argument_list|,
name|line
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
condition|)
block|{
name|nsp
operator|=
name|buf
expr_stmt|;
for|for
control|(
name|sp
operator|=
name|s
init|;
name|sp
operator|&&
operator|*
name|sp
condition|;
name|sp
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|sp
operator|==
literal|' '
condition|)
operator|*
name|nsp
operator|++
operator|=
literal|' '
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|isascii
argument_list|(
operator|*
name|sp
argument_list|)
operator|||
operator|!
name|isprint
argument_list|(
operator|*
name|sp
argument_list|)
condition|)
block|{
name|sprintf
argument_list|(
name|nsp
argument_list|,
literal|"\\%03o"
argument_list|,
operator|*
operator|(
specifier|const
name|unsigned
name|char
operator|*
operator|)
name|sp
argument_list|)
expr_stmt|;
name|nsp
operator|+=
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|sp
operator|==
literal|'"'
operator|||
operator|*
name|sp
operator|==
literal|'\\'
condition|)
block|{
operator|*
name|nsp
operator|++
operator|=
literal|'\\'
expr_stmt|;
operator|*
name|nsp
operator|++
operator|=
operator|*
name|sp
expr_stmt|;
block|}
else|else
operator|*
name|nsp
operator|++
operator|=
operator|*
name|sp
expr_stmt|;
block|}
operator|*
name|nsp
operator|++
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|buf
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|quotify_buf
parameter_list|(
specifier|const
name|unsigned
name|char
modifier|*
name|s
parameter_list|,
name|unsigned
name|len
parameter_list|,
specifier|const
name|char
modifier|*
name|file
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|unsigned
name|nulen
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|,
modifier|*
name|nsp
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|s
index|[
name|i
index|]
operator|==
literal|' '
condition|)
name|nulen
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|isascii
argument_list|(
name|s
index|[
name|i
index|]
argument_list|)
operator|||
operator|!
name|isprint
argument_list|(
name|s
index|[
name|i
index|]
argument_list|)
condition|)
name|nulen
operator|+=
literal|4
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
name|i
index|]
operator|==
literal|'"'
operator|||
name|s
index|[
name|i
index|]
operator|==
literal|'\\'
condition|)
name|nulen
operator|+=
literal|2
expr_stmt|;
else|else
name|nulen
operator|++
expr_stmt|;
block|}
name|buf
operator|=
name|dmalloc
argument_list|(
name|nulen
operator|+
literal|1
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
condition|)
block|{
name|nsp
operator|=
name|buf
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|s
index|[
name|i
index|]
operator|==
literal|' '
condition|)
operator|*
name|nsp
operator|++
operator|=
literal|' '
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|isascii
argument_list|(
name|s
index|[
name|i
index|]
argument_list|)
operator|||
operator|!
name|isprint
argument_list|(
name|s
index|[
name|i
index|]
argument_list|)
condition|)
block|{
name|sprintf
argument_list|(
name|nsp
argument_list|,
literal|"\\%03o"
argument_list|,
name|s
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|nsp
operator|+=
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|s
index|[
name|i
index|]
operator|==
literal|'"'
operator|||
name|s
index|[
name|i
index|]
operator|==
literal|'\\'
condition|)
block|{
operator|*
name|nsp
operator|++
operator|=
literal|'\\'
expr_stmt|;
operator|*
name|nsp
operator|++
operator|=
name|s
index|[
name|i
index|]
expr_stmt|;
block|}
else|else
operator|*
name|nsp
operator|++
operator|=
name|s
index|[
name|i
index|]
expr_stmt|;
block|}
operator|*
name|nsp
operator|++
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|buf
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|print_base64
parameter_list|(
specifier|const
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|len
parameter_list|,
specifier|const
name|char
modifier|*
name|file
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|char
modifier|*
name|s
decl_stmt|,
modifier|*
name|b
decl_stmt|;
name|unsigned
name|bl
decl_stmt|;
name|int
name|i
decl_stmt|;
name|unsigned
name|val
decl_stmt|,
name|extra
decl_stmt|;
specifier|static
name|char
name|to64
index|[]
init|=
literal|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
decl_stmt|;
name|bl
operator|=
operator|(
operator|(
name|len
operator|*
literal|4
operator|+
literal|2
operator|)
operator|/
literal|3
operator|)
operator|+
literal|1
expr_stmt|;
name|b
operator|=
name|dmalloc
argument_list|(
name|bl
operator|+
literal|1
argument_list|,
name|file
argument_list|,
name|line
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|b
condition|)
return|return
operator|(
name|char
operator|*
operator|)
literal|0
return|;
name|i
operator|=
literal|0
expr_stmt|;
name|s
operator|=
name|b
expr_stmt|;
while|while
condition|(
name|i
operator|!=
name|len
condition|)
block|{
name|val
operator|=
name|buf
index|[
name|i
operator|++
index|]
expr_stmt|;
name|extra
operator|=
name|val
operator|&
literal|3
expr_stmt|;
name|val
operator|=
name|val
operator|>>
literal|2
expr_stmt|;
operator|*
name|s
operator|++
operator|=
name|to64
index|[
name|val
index|]
expr_stmt|;
if|if
condition|(
name|i
operator|==
name|len
condition|)
block|{
operator|*
name|s
operator|++
operator|=
name|to64
index|[
name|extra
operator|<<
literal|4
index|]
expr_stmt|;
operator|*
name|s
operator|++
operator|=
literal|'='
expr_stmt|;
break|break;
block|}
name|val
operator|=
operator|(
name|extra
operator|<<
literal|8
operator|)
operator|+
name|buf
index|[
name|i
operator|++
index|]
expr_stmt|;
name|extra
operator|=
name|val
operator|&
literal|15
expr_stmt|;
name|val
operator|=
name|val
operator|>>
literal|4
expr_stmt|;
operator|*
name|s
operator|++
operator|=
name|to64
index|[
name|val
index|]
expr_stmt|;
if|if
condition|(
name|i
operator|==
name|len
condition|)
block|{
operator|*
name|s
operator|++
operator|=
name|to64
index|[
name|extra
operator|<<
literal|2
index|]
expr_stmt|;
operator|*
name|s
operator|++
operator|=
literal|'='
expr_stmt|;
break|break;
block|}
name|val
operator|=
operator|(
name|extra
operator|<<
literal|8
operator|)
operator|+
name|buf
index|[
name|i
operator|++
index|]
expr_stmt|;
name|extra
operator|=
name|val
operator|&
literal|0x3f
expr_stmt|;
name|val
operator|=
name|val
operator|>>
literal|6
expr_stmt|;
operator|*
name|s
operator|++
operator|=
name|to64
index|[
name|val
index|]
expr_stmt|;
operator|*
name|s
operator|++
operator|=
name|to64
index|[
name|extra
index|]
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|len
condition|)
operator|*
name|s
operator|++
operator|=
literal|'='
expr_stmt|;
operator|*
name|s
operator|++
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|s
operator|>
name|b
operator|+
name|bl
operator|+
literal|1
condition|)
name|abort
argument_list|()
expr_stmt|;
return|return
name|b
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|print_hw_addr
parameter_list|(
name|htype
parameter_list|,
name|hlen
parameter_list|,
name|data
parameter_list|)
name|int
name|htype
decl_stmt|;
name|int
name|hlen
decl_stmt|;
name|unsigned
name|char
modifier|*
name|data
decl_stmt|;
block|{
specifier|static
name|char
name|habuf
index|[
literal|49
index|]
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|hlen
operator|<=
literal|0
condition|)
name|habuf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
else|else
block|{
name|s
operator|=
name|habuf
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|hlen
condition|;
name|i
operator|++
control|)
block|{
name|sprintf
argument_list|(
name|s
argument_list|,
literal|"%02x"
argument_list|,
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|s
operator|+=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
operator|*
name|s
operator|++
operator|=
literal|':'
expr_stmt|;
block|}
operator|*
operator|--
name|s
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|habuf
return|;
block|}
end_function

begin_function
name|void
name|print_lease
parameter_list|(
name|lease
parameter_list|)
name|struct
name|lease
modifier|*
name|lease
decl_stmt|;
block|{
name|struct
name|tm
modifier|*
name|t
decl_stmt|;
name|char
name|tbuf
index|[
literal|32
index|]
decl_stmt|;
name|log_debug
argument_list|(
literal|"  Lease %s"
argument_list|,
name|piaddr
argument_list|(
name|lease
operator|->
name|ip_addr
argument_list|)
argument_list|)
expr_stmt|;
name|t
operator|=
name|gmtime
argument_list|(
operator|&
name|lease
operator|->
name|starts
argument_list|)
expr_stmt|;
name|strftime
argument_list|(
name|tbuf
argument_list|,
sizeof|sizeof
name|tbuf
argument_list|,
literal|"%Y/%m/%d %H:%M:%S"
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"  start %s"
argument_list|,
name|tbuf
argument_list|)
expr_stmt|;
name|t
operator|=
name|gmtime
argument_list|(
operator|&
name|lease
operator|->
name|ends
argument_list|)
expr_stmt|;
name|strftime
argument_list|(
name|tbuf
argument_list|,
sizeof|sizeof
name|tbuf
argument_list|,
literal|"%Y/%m/%d %H:%M:%S"
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"  end %s"
argument_list|,
name|tbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|lease
operator|->
name|hardware_addr
operator|.
name|hlen
condition|)
name|log_debug
argument_list|(
literal|"    hardware addr = %s"
argument_list|,
name|print_hw_addr
argument_list|(
name|lease
operator|->
name|hardware_addr
operator|.
name|hbuf
index|[
literal|0
index|]
argument_list|,
name|lease
operator|->
name|hardware_addr
operator|.
name|hlen
operator|-
literal|1
argument_list|,
operator|&
name|lease
operator|->
name|hardware_addr
operator|.
name|hbuf
index|[
literal|1
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"  host %s  "
argument_list|,
name|lease
operator|->
name|host
condition|?
name|lease
operator|->
name|host
operator|->
name|name
else|:
literal|"<none>"
argument_list|)
expr_stmt|;
block|}
end_function

begin_if
if|#
directive|if
name|defined
argument_list|(
name|DEBUG
argument_list|)
end_if

begin_function
name|void
name|dump_packet_option
parameter_list|(
name|struct
name|option_cache
modifier|*
name|oc
parameter_list|,
name|struct
name|packet
modifier|*
name|packet
parameter_list|,
name|struct
name|lease
modifier|*
name|lease
parameter_list|,
name|struct
name|client_state
modifier|*
name|client
parameter_list|,
name|struct
name|option_state
modifier|*
name|in_options
parameter_list|,
name|struct
name|option_state
modifier|*
name|cfg_options
parameter_list|,
name|struct
name|binding_scope
modifier|*
modifier|*
name|scope
parameter_list|,
name|struct
name|universe
modifier|*
name|u
parameter_list|,
name|void
modifier|*
name|foo
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|,
modifier|*
name|dot
decl_stmt|;
name|struct
name|data_string
name|ds
decl_stmt|;
name|memset
argument_list|(
operator|&
name|ds
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
name|ds
argument_list|)
expr_stmt|;
if|if
condition|(
name|u
operator|!=
operator|&
name|dhcp_universe
condition|)
block|{
name|name
operator|=
name|u
operator|->
name|name
expr_stmt|;
name|dot
operator|=
literal|"."
expr_stmt|;
block|}
else|else
block|{
name|name
operator|=
literal|""
expr_stmt|;
name|dot
operator|=
literal|""
expr_stmt|;
block|}
if|if
condition|(
name|evaluate_option_cache
argument_list|(
operator|&
name|ds
argument_list|,
name|packet
argument_list|,
name|lease
argument_list|,
name|client
argument_list|,
name|in_options
argument_list|,
name|cfg_options
argument_list|,
name|scope
argument_list|,
name|oc
argument_list|,
name|MDL
argument_list|)
condition|)
block|{
name|log_debug
argument_list|(
literal|"  option %s%s%s %s;\n"
argument_list|,
name|name
argument_list|,
name|dot
argument_list|,
name|oc
operator|->
name|option
operator|->
name|name
argument_list|,
name|pretty_print_option
argument_list|(
name|oc
operator|->
name|option
argument_list|,
name|ds
operator|.
name|data
argument_list|,
name|ds
operator|.
name|len
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|data_string_forget
argument_list|(
operator|&
name|ds
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|dump_packet
parameter_list|(
name|tp
parameter_list|)
name|struct
name|packet
modifier|*
name|tp
decl_stmt|;
block|{
name|struct
name|dhcp_packet
modifier|*
name|tdp
init|=
name|tp
operator|->
name|raw
decl_stmt|;
name|log_debug
argument_list|(
literal|"packet length %d"
argument_list|,
name|tp
operator|->
name|packet_length
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"op = %d  htype = %d  hlen = %d  hops = %d"
argument_list|,
name|tdp
operator|->
name|op
argument_list|,
name|tdp
operator|->
name|htype
argument_list|,
name|tdp
operator|->
name|hlen
argument_list|,
name|tdp
operator|->
name|hops
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"xid = %x  secs = %ld  flags = %x"
argument_list|,
name|tdp
operator|->
name|xid
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|tdp
operator|->
name|secs
argument_list|,
name|tdp
operator|->
name|flags
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"ciaddr = %s"
argument_list|,
name|inet_ntoa
argument_list|(
name|tdp
operator|->
name|ciaddr
argument_list|)
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"yiaddr = %s"
argument_list|,
name|inet_ntoa
argument_list|(
name|tdp
operator|->
name|yiaddr
argument_list|)
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"siaddr = %s"
argument_list|,
name|inet_ntoa
argument_list|(
name|tdp
operator|->
name|siaddr
argument_list|)
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"giaddr = %s"
argument_list|,
name|inet_ntoa
argument_list|(
name|tdp
operator|->
name|giaddr
argument_list|)
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"chaddr = %2.2x:%2.2x:%2.2x:%2.2x:%2.2x:%2.2x"
argument_list|,
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
name|tdp
operator|->
name|chaddr
operator|)
operator|)
index|[
literal|0
index|]
argument_list|,
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
name|tdp
operator|->
name|chaddr
operator|)
operator|)
index|[
literal|1
index|]
argument_list|,
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
name|tdp
operator|->
name|chaddr
operator|)
operator|)
index|[
literal|2
index|]
argument_list|,
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
name|tdp
operator|->
name|chaddr
operator|)
operator|)
index|[
literal|3
index|]
argument_list|,
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
name|tdp
operator|->
name|chaddr
operator|)
operator|)
index|[
literal|4
index|]
argument_list|,
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
name|tdp
operator|->
name|chaddr
operator|)
operator|)
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"filename = %s"
argument_list|,
name|tdp
operator|->
name|file
argument_list|)
expr_stmt|;
name|log_debug
argument_list|(
literal|"server_name = %s"
argument_list|,
name|tdp
operator|->
name|sname
argument_list|)
expr_stmt|;
if|if
condition|(
name|tp
operator|->
name|options_valid
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|tp
operator|->
name|options
operator|->
name|universe_count
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|tp
operator|->
name|options
operator|->
name|universes
index|[
name|i
index|]
condition|)
block|{
name|option_space_foreach
argument_list|(
name|tp
argument_list|,
operator|(
expr|struct
name|lease
operator|*
operator|)
literal|0
argument_list|,
operator|(
expr|struct
name|client_state
operator|*
operator|)
literal|0
argument_list|,
operator|(
expr|struct
name|option_state
operator|*
operator|)
literal|0
argument_list|,
name|tp
operator|->
name|options
argument_list|,
operator|&
name|global_scope
argument_list|,
name|universes
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|,
name|dump_packet_option
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|log_debug
argument_list|(
literal|"%s"
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|dump_raw
parameter_list|(
name|buf
parameter_list|,
name|len
parameter_list|)
specifier|const
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|unsigned
name|len
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|char
name|lbuf
index|[
literal|80
index|]
decl_stmt|;
name|int
name|lbix
init|=
literal|0
decl_stmt|;
name|lbuf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|i
operator|&
literal|15
operator|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|lbix
condition|)
name|log_info
argument_list|(
name|lbuf
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|lbuf
argument_list|,
literal|"%03x:"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|lbix
operator|=
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|i
operator|&
literal|7
operator|)
operator|==
literal|0
condition|)
name|lbuf
index|[
name|lbix
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|sprintf
argument_list|(
operator|&
name|lbuf
index|[
name|lbix
index|]
argument_list|,
literal|" %02x"
argument_list|,
name|buf
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|lbix
operator|+=
literal|3
expr_stmt|;
block|}
name|log_info
argument_list|(
name|lbuf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|hash_dump
parameter_list|(
name|table
parameter_list|)
name|struct
name|hash_table
modifier|*
name|table
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|struct
name|hash_bucket
modifier|*
name|bp
decl_stmt|;
if|if
condition|(
operator|!
name|table
condition|)
return|return;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|table
operator|->
name|hash_count
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|table
operator|->
name|buckets
index|[
name|i
index|]
condition|)
continue|continue;
name|log_info
argument_list|(
literal|"hash bucket %d:"
argument_list|,
name|i
argument_list|)
expr_stmt|;
for|for
control|(
name|bp
operator|=
name|table
operator|->
name|buckets
index|[
name|i
index|]
init|;
name|bp
condition|;
name|bp
operator|=
name|bp
operator|->
name|next
control|)
block|{
if|if
condition|(
name|bp
operator|->
name|len
condition|)
name|dump_raw
argument_list|(
name|bp
operator|->
name|name
argument_list|,
name|bp
operator|->
name|len
argument_list|)
expr_stmt|;
else|else
name|log_info
argument_list|(
operator|(
specifier|const
name|char
operator|*
operator|)
name|bp
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_define
define|#
directive|define
name|HBLEN
value|60
end_define

begin_define
define|#
directive|define
name|DECLARE_HEX_PRINTER
parameter_list|(
name|x
parameter_list|)
define|\
value|char *print_hex##x (len, data, limit)					      \ 	unsigned len;							      \ 	const u_int8_t *data;						      \ 	unsigned limit;							      \ {									      \ 									      \ 	static char hex_buf##x [HBLEN + 1];				      \ 	unsigned i;							      \ 									      \ 	if (limit> HBLEN)						      \ 		limit = HBLEN;						      \ 									      \ 	for (i = 0; i< (limit - 2)&& i< len; i++) {			      \ 		if (!isascii (data [i]) || !isprint (data [i])) {	      \ 			for (i = 0; i< limit / 3&& i< len; i++) {	      \ 				sprintf (&hex_buf##x [i * 3],		      \ 					 "%02x:", data [i]);		      \ 			}						      \ 			hex_buf##x [i * 3 - 1] = 0;			      \ 			return hex_buf##x;				      \ 		}							      \ 	}								      \ 	hex_buf##x [0] = '"';						      \ 	i = len;							      \ 	if (i> limit - 2)						      \ 		i = limit - 2;						      \ 	memcpy (&hex_buf##x [1], data, i);				      \ 	hex_buf##x [i + 1] = '"';					      \ 	hex_buf##x [i + 2] = 0;						      \ 	return hex_buf##x;						      \ }
end_define

begin_macro
name|DECLARE_HEX_PRINTER
argument_list|(
argument|_1
argument_list|)
end_macro

begin_macro
name|DECLARE_HEX_PRINTER
argument_list|(
argument|_2
argument_list|)
end_macro

begin_macro
name|DECLARE_HEX_PRINTER
argument_list|(
argument|_3
argument_list|)
end_macro

begin_define
define|#
directive|define
name|DQLEN
value|80
end_define

begin_function
name|char
modifier|*
name|print_dotted_quads
parameter_list|(
name|len
parameter_list|,
name|data
parameter_list|)
name|unsigned
name|len
decl_stmt|;
specifier|const
name|u_int8_t
modifier|*
name|data
decl_stmt|;
block|{
specifier|static
name|char
name|dq_buf
index|[
name|DQLEN
operator|+
literal|1
index|]
decl_stmt|;
name|int
name|i
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|,
modifier|*
name|last
decl_stmt|;
name|s
operator|=
operator|&
name|dq_buf
index|[
literal|0
index|]
expr_stmt|;
name|last
operator|=
name|s
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
do|do
block|{
name|sprintf
argument_list|(
name|s
argument_list|,
literal|"%d.%d.%d.%d, "
argument_list|,
name|data
index|[
name|i
index|]
argument_list|,
name|data
index|[
name|i
operator|+
literal|1
index|]
argument_list|,
name|data
index|[
name|i
operator|+
literal|2
index|]
argument_list|,
name|data
index|[
name|i
operator|+
literal|3
index|]
argument_list|)
expr_stmt|;
name|s
operator|+=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|i
operator|+=
literal|4
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|s
operator|-
operator|&
name|dq_buf
index|[
literal|0
index|]
operator|>
name|DQLEN
operator|-
literal|21
operator|)
operator|&&
name|i
operator|+
literal|3
operator|<
name|len
condition|)
do|;
if|if
condition|(
name|i
operator|==
name|len
condition|)
name|s
index|[
operator|-
literal|2
index|]
operator|=
literal|0
expr_stmt|;
else|else
name|strcpy
argument_list|(
name|s
argument_list|,
literal|"..."
argument_list|)
expr_stmt|;
return|return
name|dq_buf
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|print_dec_1
parameter_list|(
name|val
parameter_list|)
name|unsigned
name|long
name|val
decl_stmt|;
block|{
specifier|static
name|char
name|vbuf
index|[
literal|32
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|vbuf
argument_list|,
literal|"%lu"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
name|vbuf
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|print_dec_2
parameter_list|(
name|val
parameter_list|)
name|unsigned
name|long
name|val
decl_stmt|;
block|{
specifier|static
name|char
name|vbuf
index|[
literal|32
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|vbuf
argument_list|,
literal|"%lu"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
name|vbuf
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|unsigned
name|print_subexpression
name|PROTO
argument_list|(
operator|(
expr|struct
name|expression
operator|*
operator|,
name|char
operator|*
operator|,
name|unsigned
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|unsigned
name|print_subexpression
parameter_list|(
name|expr
parameter_list|,
name|buf
parameter_list|,
name|len
parameter_list|)
name|struct
name|expression
modifier|*
name|expr
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|;
name|unsigned
name|len
decl_stmt|;
block|{
name|unsigned
name|rv
decl_stmt|,
name|left
decl_stmt|;
specifier|const
name|char
modifier|*
name|s
decl_stmt|;
switch|switch
condition|(
name|expr
operator|->
name|op
condition|)
block|{
case|case
name|expr_none
case|:
if|if
condition|(
name|len
operator|>
literal|3
condition|)
block|{
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"nil"
argument_list|)
expr_stmt|;
return|return
literal|3
return|;
block|}
break|break;
case|case
name|expr_match
case|:
if|if
condition|(
name|len
operator|>
literal|7
condition|)
block|{
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(match)"
argument_list|)
expr_stmt|;
return|return
literal|7
return|;
block|}
break|break;
case|case
name|expr_check
case|:
name|rv
operator|=
literal|10
operator|+
name|strlen
argument_list|(
name|expr
operator|->
name|data
operator|.
name|check
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"(check %s)"
argument_list|,
name|expr
operator|->
name|data
operator|.
name|check
operator|->
name|name
argument_list|)
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_equal
case|:
if|if
condition|(
name|len
operator|>
literal|6
condition|)
block|{
name|rv
operator|=
literal|4
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(eq "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|equal
index|[
literal|0
index|]
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|2
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|equal
index|[
literal|1
index|]
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_not_equal
case|:
if|if
condition|(
name|len
operator|>
literal|7
condition|)
block|{
name|rv
operator|=
literal|5
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(neq "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|equal
index|[
literal|0
index|]
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|2
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|equal
index|[
literal|1
index|]
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_substring
case|:
if|if
condition|(
name|len
operator|>
literal|11
condition|)
block|{
name|rv
operator|=
literal|8
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(substr "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|substring
operator|.
name|expr
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|3
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|substring
operator|.
name|offset
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|2
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|substring
operator|.
name|len
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_suffix
case|:
if|if
condition|(
name|len
operator|>
literal|10
condition|)
block|{
name|rv
operator|=
literal|8
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(suffix "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|suffix
operator|.
name|expr
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
condition|)
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|suffix
operator|.
name|len
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
condition|)
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_concat
case|:
if|if
condition|(
name|len
operator|>
literal|10
condition|)
block|{
name|rv
operator|=
literal|8
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(concat "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|concat
index|[
literal|0
index|]
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|2
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|concat
index|[
literal|1
index|]
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_pick_first_value
case|:
if|if
condition|(
name|len
operator|>
literal|8
condition|)
block|{
name|rv
operator|=
literal|6
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(pick1st "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|pick_first_value
operator|.
name|car
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|2
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|pick_first_value
operator|.
name|cdr
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_host_lookup
case|:
name|rv
operator|=
literal|15
operator|+
name|strlen
argument_list|(
name|expr
operator|->
name|data
operator|.
name|host_lookup
operator|->
name|hostname
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"(dns-lookup %s)"
argument_list|,
name|expr
operator|->
name|data
operator|.
name|host_lookup
operator|->
name|hostname
argument_list|)
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_and
case|:
name|s
operator|=
literal|"and"
expr_stmt|;
name|binop
label|:
name|rv
operator|=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
operator|+
literal|4
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|'('
expr_stmt|;
name|strcpy
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|rv
operator|+=
literal|1
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|and
index|[
literal|0
index|]
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|2
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|and
index|[
literal|1
index|]
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_or
case|:
name|s
operator|=
literal|"or"
expr_stmt|;
goto|goto
name|binop
goto|;
case|case
name|expr_add
case|:
name|s
operator|=
literal|"+"
expr_stmt|;
goto|goto
name|binop
goto|;
case|case
name|expr_subtract
case|:
name|s
operator|=
literal|"-"
expr_stmt|;
goto|goto
name|binop
goto|;
case|case
name|expr_multiply
case|:
name|s
operator|=
literal|"*"
expr_stmt|;
goto|goto
name|binop
goto|;
case|case
name|expr_divide
case|:
name|s
operator|=
literal|"/"
expr_stmt|;
goto|goto
name|binop
goto|;
case|case
name|expr_remainder
case|:
name|s
operator|=
literal|"%"
expr_stmt|;
goto|goto
name|binop
goto|;
case|case
name|expr_binary_and
case|:
name|s
operator|=
literal|"&"
expr_stmt|;
goto|goto
name|binop
goto|;
case|case
name|expr_binary_or
case|:
name|s
operator|=
literal|"|"
expr_stmt|;
goto|goto
name|binop
goto|;
case|case
name|expr_binary_xor
case|:
name|s
operator|=
literal|"^"
expr_stmt|;
goto|goto
name|binop
goto|;
case|case
name|expr_not
case|:
if|if
condition|(
name|len
operator|>
literal|6
condition|)
block|{
name|rv
operator|=
literal|5
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(not "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|not
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_config_option
case|:
name|s
operator|=
literal|"cfg-option"
expr_stmt|;
goto|goto
name|dooption
goto|;
case|case
name|expr_option
case|:
name|s
operator|=
literal|"option"
expr_stmt|;
name|dooption
label|:
name|rv
operator|=
name|strlen
argument_list|(
name|s
argument_list|)
operator|+
literal|2
operator|+
operator|(
name|strlen
argument_list|(
name|expr
operator|->
name|data
operator|.
name|option
operator|->
name|name
argument_list|)
operator|+
name|strlen
argument_list|(
name|expr
operator|->
name|data
operator|.
name|option
operator|->
name|universe
operator|->
name|name
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"(option %s.%s)"
argument_list|,
name|expr
operator|->
name|data
operator|.
name|option
operator|->
name|universe
operator|->
name|name
argument_list|,
name|expr
operator|->
name|data
operator|.
name|option
operator|->
name|name
argument_list|)
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_hardware
case|:
if|if
condition|(
name|len
operator|>
literal|10
condition|)
block|{
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(hardware)"
argument_list|)
expr_stmt|;
return|return
literal|10
return|;
block|}
break|break;
case|case
name|expr_packet
case|:
if|if
condition|(
name|len
operator|>
literal|10
condition|)
block|{
name|rv
operator|=
literal|8
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(substr "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|packet
operator|.
name|offset
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|2
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|packet
operator|.
name|len
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_const_data
case|:
name|s
operator|=
name|print_hex_1
argument_list|(
name|expr
operator|->
name|data
operator|.
name|const_data
operator|.
name|len
argument_list|,
name|expr
operator|->
name|data
operator|.
name|const_data
operator|.
name|data
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|rv
operator|=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|rv
operator|>=
name|len
condition|)
name|rv
operator|=
name|len
operator|-
literal|1
expr_stmt|;
name|strncpy
argument_list|(
name|buf
argument_list|,
name|s
argument_list|,
name|rv
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
case|case
name|expr_encapsulate
case|:
name|rv
operator|=
literal|13
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(encapsulate "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|expr
operator|->
name|data
operator|.
name|encapsulate
operator|.
name|len
expr_stmt|;
if|if
condition|(
name|rv
operator|+
literal|2
operator|>
name|len
condition|)
name|rv
operator|=
name|len
operator|-
literal|2
expr_stmt|;
name|strncpy
argument_list|(
name|buf
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|)
name|expr
operator|->
name|data
operator|.
name|encapsulate
operator|.
name|data
argument_list|,
name|rv
operator|-
literal|13
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|expr_extract_int8
case|:
if|if
condition|(
name|len
operator|>
literal|7
condition|)
block|{
name|rv
operator|=
literal|6
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(int8 "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|extract_int
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_extract_int16
case|:
if|if
condition|(
name|len
operator|>
literal|8
condition|)
block|{
name|rv
operator|=
literal|7
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(int16 "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|extract_int
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_extract_int32
case|:
if|if
condition|(
name|len
operator|>
literal|8
condition|)
block|{
name|rv
operator|=
literal|7
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(int32 "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|extract_int
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_encode_int8
case|:
if|if
condition|(
name|len
operator|>
literal|7
condition|)
block|{
name|rv
operator|=
literal|6
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(to-int8 "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|encode_int
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_encode_int16
case|:
if|if
condition|(
name|len
operator|>
literal|8
condition|)
block|{
name|rv
operator|=
literal|7
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(to-int16 "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|encode_int
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_encode_int32
case|:
if|if
condition|(
name|len
operator|>
literal|8
condition|)
block|{
name|rv
operator|=
literal|7
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(to-int32 "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|encode_int
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_const_int
case|:
name|s
operator|=
name|print_dec_1
argument_list|(
name|expr
operator|->
name|data
operator|.
name|const_int
argument_list|)
expr_stmt|;
name|rv
operator|=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
condition|)
block|{
name|strcpy
argument_list|(
name|buf
argument_list|,
name|s
argument_list|)
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_exists
case|:
name|rv
operator|=
literal|10
operator|+
operator|(
name|strlen
argument_list|(
name|expr
operator|->
name|data
operator|.
name|option
operator|->
name|name
argument_list|)
operator|+
name|strlen
argument_list|(
name|expr
operator|->
name|data
operator|.
name|option
operator|->
name|universe
operator|->
name|name
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"(exists %s.%s)"
argument_list|,
name|expr
operator|->
name|data
operator|.
name|option
operator|->
name|universe
operator|->
name|name
argument_list|,
name|expr
operator|->
name|data
operator|.
name|option
operator|->
name|name
argument_list|)
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_variable_exists
case|:
name|rv
operator|=
literal|10
operator|+
name|strlen
argument_list|(
name|expr
operator|->
name|data
operator|.
name|variable
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"(defined %s)"
argument_list|,
name|expr
operator|->
name|data
operator|.
name|variable
argument_list|)
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_variable_reference
case|:
name|rv
operator|=
name|strlen
argument_list|(
name|expr
operator|->
name|data
operator|.
name|variable
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s"
argument_list|,
name|expr
operator|->
name|data
operator|.
name|variable
argument_list|)
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_known
case|:
name|s
operator|=
literal|"known"
expr_stmt|;
name|astring
label|:
name|rv
operator|=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
condition|)
block|{
name|strcpy
argument_list|(
name|buf
argument_list|,
name|s
argument_list|)
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_leased_address
case|:
name|s
operator|=
literal|"leased-address"
expr_stmt|;
goto|goto
name|astring
goto|;
case|case
name|expr_client_state
case|:
name|s
operator|=
literal|"client-state"
expr_stmt|;
goto|goto
name|astring
goto|;
case|case
name|expr_host_decl_name
case|:
name|s
operator|=
literal|"host-decl-name"
expr_stmt|;
goto|goto
name|astring
goto|;
case|case
name|expr_lease_time
case|:
name|s
operator|=
literal|"lease-time"
expr_stmt|;
goto|goto
name|astring
goto|;
case|case
name|expr_static
case|:
name|s
operator|=
literal|"static"
expr_stmt|;
goto|goto
name|astring
goto|;
case|case
name|expr_filename
case|:
name|s
operator|=
literal|"filename"
expr_stmt|;
goto|goto
name|astring
goto|;
case|case
name|expr_sname
case|:
name|s
operator|=
literal|"server-name"
expr_stmt|;
goto|goto
name|astring
goto|;
case|case
name|expr_reverse
case|:
if|if
condition|(
name|len
operator|>
literal|11
condition|)
block|{
name|rv
operator|=
literal|13
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(reverse "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|reverse
operator|.
name|width
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|2
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|reverse
operator|.
name|buffer
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_binary_to_ascii
case|:
if|if
condition|(
name|len
operator|>
literal|5
condition|)
block|{
name|rv
operator|=
literal|9
expr_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(b2a "
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|b2a
operator|.
name|base
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|4
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|b2a
operator|.
name|width
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|3
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|b2a
operator|.
name|seperator
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|2
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|b2a
operator|.
name|buffer
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_dns_transaction
case|:
name|rv
operator|=
literal|10
expr_stmt|;
if|if
condition|(
name|len
operator|<
name|rv
operator|+
literal|2
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|'('
expr_stmt|;
name|strcpy
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|,
literal|"ns-update "
argument_list|)
expr_stmt|;
while|while
condition|(
name|len
operator|<
name|rv
operator|+
literal|2
condition|)
block|{
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|dns_transaction
operator|.
name|car
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|2
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|expr
operator|=
name|expr
operator|->
name|data
operator|.
name|dns_transaction
operator|.
name|cdr
expr_stmt|;
block|}
name|buf
index|[
name|rv
operator|-
literal|1
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
return|return
literal|0
return|;
case|case
name|expr_ns_delete
case|:
name|s
operator|=
literal|"delete"
expr_stmt|;
name|left
operator|=
literal|4
expr_stmt|;
goto|goto
name|dodnsupd
goto|;
case|case
name|expr_ns_exists
case|:
name|s
operator|=
literal|"exists"
expr_stmt|;
name|left
operator|=
literal|4
expr_stmt|;
goto|goto
name|dodnsupd
goto|;
case|case
name|expr_ns_not_exists
case|:
name|s
operator|=
literal|"not_exists"
expr_stmt|;
name|left
operator|=
literal|4
expr_stmt|;
goto|goto
name|dodnsupd
goto|;
case|case
name|expr_ns_add
case|:
name|s
operator|=
literal|"update"
expr_stmt|;
name|left
operator|=
literal|5
expr_stmt|;
name|dodnsupd
label|:
name|rv
operator|=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|strlen
argument_list|(
name|s
argument_list|)
operator|+
literal|1
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|'('
expr_stmt|;
name|strcpy
argument_list|(
name|buf
operator|+
literal|1
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|rv
operator|++
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|s
operator|=
name|print_dec_1
argument_list|(
name|expr
operator|->
name|data
operator|.
name|ns_add
operator|.
name|rrclass
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
operator|+
name|strlen
argument_list|(
name|s
argument_list|)
operator|+
name|left
condition|)
block|{
name|strcpy
argument_list|(
operator|&
name|buf
index|[
name|rv
index|]
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|strlen
argument_list|(
operator|&
name|buf
index|[
name|rv
index|]
argument_list|)
expr_stmt|;
block|}
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|left
operator|--
expr_stmt|;
name|s
operator|=
name|print_dec_1
argument_list|(
name|expr
operator|->
name|data
operator|.
name|ns_add
operator|.
name|rrtype
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
operator|+
name|strlen
argument_list|(
name|s
argument_list|)
operator|+
name|left
condition|)
block|{
name|strcpy
argument_list|(
operator|&
name|buf
index|[
name|rv
index|]
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|strlen
argument_list|(
operator|&
name|buf
index|[
name|rv
index|]
argument_list|)
expr_stmt|;
block|}
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|left
operator|--
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|ns_add
operator|.
name|rrname
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
name|left
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|left
operator|--
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|ns_add
operator|.
name|rrdata
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
name|left
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|left
operator|--
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|ns_add
operator|.
name|ttl
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
name|left
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_null
case|:
if|if
condition|(
name|len
operator|>
literal|6
condition|)
block|{
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(null)"
argument_list|)
expr_stmt|;
return|return
literal|6
return|;
block|}
break|break;
case|case
name|expr_funcall
case|:
name|rv
operator|=
literal|12
operator|+
name|strlen
argument_list|(
name|expr
operator|->
name|data
operator|.
name|funcall
operator|.
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
operator|+
literal|1
condition|)
block|{
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(funcall  "
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|buf
operator|+
literal|9
argument_list|,
name|expr
operator|->
name|data
operator|.
name|funcall
operator|.
name|name
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|funcall
operator|.
name|arglist
argument_list|,
name|buf
operator|+
name|rv
argument_list|,
name|len
operator|-
name|rv
operator|-
literal|1
argument_list|)
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_arg
case|:
name|rv
operator|=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|arg
operator|.
name|val
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|expr
operator|->
name|data
operator|.
name|arg
operator|.
name|next
operator|&&
name|rv
operator|+
literal|2
operator|<
name|len
condition|)
block|{
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|rv
operator|+=
name|print_subexpression
argument_list|(
name|expr
operator|->
name|data
operator|.
name|arg
operator|.
name|next
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|rv
operator|+
literal|1
operator|<
name|len
condition|)
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
break|break;
case|case
name|expr_function
case|:
name|rv
operator|=
literal|9
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|rv
operator|+
literal|1
condition|)
block|{
name|struct
name|string_list
modifier|*
name|foo
decl_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"(function"
argument_list|)
expr_stmt|;
for|for
control|(
name|foo
operator|=
name|expr
operator|->
name|data
operator|.
name|func
operator|->
name|args
init|;
name|foo
condition|;
name|foo
operator|=
name|foo
operator|->
name|next
control|)
block|{
if|if
condition|(
name|len
operator|>
name|rv
operator|+
literal|2
operator|+
name|strlen
argument_list|(
name|foo
operator|->
name|string
argument_list|)
condition|)
block|{
name|buf
index|[
name|rv
operator|-
literal|1
index|]
operator|=
literal|' '
expr_stmt|;
name|strcpy
argument_list|(
operator|&
name|buf
index|[
name|rv
index|]
argument_list|,
name|foo
operator|->
name|string
argument_list|)
expr_stmt|;
name|rv
operator|+=
name|strlen
argument_list|(
name|foo
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
block|}
name|buf
index|[
name|rv
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
name|rv
operator|++
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|rv
return|;
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|print_expression
parameter_list|(
name|name
parameter_list|,
name|expr
parameter_list|)
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|struct
name|expression
modifier|*
name|expr
decl_stmt|;
block|{
name|char
name|buf
index|[
literal|1024
index|]
decl_stmt|;
name|print_subexpression
argument_list|(
name|expr
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|)
expr_stmt|;
name|log_info
argument_list|(
literal|"%s: %s"
argument_list|,
name|name
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|token_print_indent_concat
parameter_list|(
name|FILE
modifier|*
name|file
parameter_list|,
name|int
name|col
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|char
modifier|*
name|prefix
parameter_list|,
specifier|const
name|char
modifier|*
name|suffix
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|list
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|;
name|unsigned
name|len
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|,
modifier|*
name|t
decl_stmt|,
modifier|*
name|u
decl_stmt|;
name|va_start
argument_list|(
name|list
argument_list|,
name|suffix
argument_list|)
expr_stmt|;
name|s
operator|=
name|va_arg
argument_list|(
name|list
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
name|len
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|s
condition|)
block|{
name|len
operator|+=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|s
operator|=
name|va_arg
argument_list|(
name|list
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
block|}
name|va_end
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|t
operator|=
name|dmalloc
argument_list|(
name|len
operator|+
literal|1
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|t
condition|)
name|log_fatal
argument_list|(
literal|"token_print_indent: no memory for copy buffer"
argument_list|)
expr_stmt|;
name|va_start
argument_list|(
name|list
argument_list|,
name|suffix
argument_list|)
expr_stmt|;
name|s
operator|=
name|va_arg
argument_list|(
name|list
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
name|u
operator|=
name|t
expr_stmt|;
while|while
condition|(
name|s
condition|)
block|{
name|len
operator|=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|u
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|u
operator|+=
name|len
expr_stmt|;
block|}
name|va_end
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|len
operator|=
name|token_print_indent
argument_list|(
name|file
argument_list|,
name|col
argument_list|,
name|indent
argument_list|,
name|prefix
argument_list|,
name|suffix
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|dfree
argument_list|(
name|t
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|col
return|;
block|}
end_function

begin_function
name|int
name|token_indent_data_string
parameter_list|(
name|FILE
modifier|*
name|file
parameter_list|,
name|int
name|col
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|char
modifier|*
name|prefix
parameter_list|,
specifier|const
name|char
modifier|*
name|suffix
parameter_list|,
name|struct
name|data_string
modifier|*
name|data
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|;
name|char
name|obuf
index|[
literal|3
index|]
decl_stmt|;
comment|/* See if this is just ASCII. */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|data
operator|->
name|len
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|isascii
argument_list|(
name|data
operator|->
name|data
index|[
name|i
index|]
argument_list|)
operator|||
operator|!
name|isprint
argument_list|(
name|data
operator|->
name|data
index|[
name|i
index|]
argument_list|)
condition|)
break|break;
comment|/* If we have a purely ASCII string, output it as text. */
if|if
condition|(
name|i
operator|==
name|data
operator|->
name|len
condition|)
block|{
name|char
modifier|*
name|buf
init|=
name|dmalloc
argument_list|(
name|data
operator|->
name|len
operator|+
literal|3
argument_list|,
name|MDL
argument_list|)
decl_stmt|;
if|if
condition|(
name|buf
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|'"'
expr_stmt|;
name|memcpy
argument_list|(
name|buf
operator|+
literal|1
argument_list|,
name|data
operator|->
name|data
argument_list|,
name|data
operator|->
name|len
argument_list|)
expr_stmt|;
name|buf
index|[
name|data
operator|->
name|len
operator|+
literal|1
index|]
operator|=
literal|'"'
expr_stmt|;
name|buf
index|[
name|data
operator|->
name|len
operator|+
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|i
operator|=
name|token_print_indent
argument_list|(
name|file
argument_list|,
name|col
argument_list|,
name|indent
argument_list|,
name|prefix
argument_list|,
name|suffix
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|dfree
argument_list|(
name|buf
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|i
return|;
block|}
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|data
operator|->
name|len
condition|;
name|i
operator|++
control|)
block|{
name|sprintf
argument_list|(
name|obuf
argument_list|,
literal|"%2.2x"
argument_list|,
name|data
operator|->
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|col
operator|=
name|token_print_indent
argument_list|(
name|file
argument_list|,
name|col
argument_list|,
name|indent
argument_list|,
name|i
operator|==
literal|0
condition|?
name|prefix
else|:
literal|""
argument_list|,
operator|(
name|i
operator|+
literal|1
operator|==
name|data
operator|->
name|len
condition|?
name|suffix
else|:
literal|""
operator|)
argument_list|,
name|obuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|+
literal|1
operator|!=
name|data
operator|->
name|len
condition|)
name|col
operator|=
name|token_print_indent
argument_list|(
name|file
argument_list|,
name|col
argument_list|,
name|indent
argument_list|,
name|prefix
argument_list|,
name|suffix
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
return|return
name|col
return|;
block|}
end_function

begin_function
name|int
name|token_print_indent
parameter_list|(
name|FILE
modifier|*
name|file
parameter_list|,
name|int
name|col
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|char
modifier|*
name|prefix
parameter_list|,
specifier|const
name|char
modifier|*
name|suffix
parameter_list|,
specifier|const
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|int
name|len
init|=
name|strlen
argument_list|(
name|buf
argument_list|)
operator|+
name|strlen
argument_list|(
name|prefix
argument_list|)
decl_stmt|;
if|if
condition|(
name|col
operator|+
name|len
operator|>
literal|79
condition|)
block|{
if|if
condition|(
name|indent
operator|+
name|len
operator|<
literal|79
condition|)
block|{
name|indent_spaces
argument_list|(
name|file
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|col
operator|=
name|indent
expr_stmt|;
block|}
else|else
block|{
name|indent_spaces
argument_list|(
name|file
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|col
operator|=
name|len
operator|>
literal|79
condition|?
literal|0
else|:
literal|79
operator|-
name|len
operator|-
literal|1
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|prefix
operator|&&
operator|*
name|prefix
condition|)
block|{
name|fputs
argument_list|(
name|prefix
argument_list|,
name|file
argument_list|)
expr_stmt|;
name|col
operator|+=
name|strlen
argument_list|(
name|prefix
argument_list|)
expr_stmt|;
block|}
name|fputs
argument_list|(
name|buf
argument_list|,
name|file
argument_list|)
expr_stmt|;
name|col
operator|+=
name|len
expr_stmt|;
if|if
condition|(
name|suffix
operator|&&
operator|*
name|suffix
condition|)
block|{
if|if
condition|(
name|col
operator|+
name|strlen
argument_list|(
name|suffix
argument_list|)
operator|>
literal|79
condition|)
block|{
name|indent_spaces
argument_list|(
name|file
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|col
operator|=
name|indent
expr_stmt|;
block|}
else|else
block|{
name|fputs
argument_list|(
name|suffix
argument_list|,
name|file
argument_list|)
expr_stmt|;
name|col
operator|+=
name|strlen
argument_list|(
name|suffix
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|col
return|;
block|}
end_function

begin_function
name|void
name|indent_spaces
parameter_list|(
name|FILE
modifier|*
name|file
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|fputc
argument_list|(
literal|'\n'
argument_list|,
name|file
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|indent
condition|;
name|i
operator|++
control|)
name|fputc
argument_list|(
literal|' '
argument_list|,
name|file
argument_list|)
expr_stmt|;
block|}
end_function

begin_if
if|#
directive|if
name|defined
argument_list|(
name|NSUPDATE
argument_list|)
end_if

begin_function
name|void
name|print_dns_status
parameter_list|(
name|int
name|status
parameter_list|,
name|ns_updque
modifier|*
name|uq
parameter_list|)
block|{
name|char
name|obuf
index|[
literal|1024
index|]
decl_stmt|;
name|char
modifier|*
name|s
init|=
operator|&
name|obuf
index|[
literal|0
index|]
decl_stmt|,
modifier|*
name|end
init|=
operator|&
name|obuf
index|[
literal|1022
index|]
decl_stmt|;
name|ns_updrec
modifier|*
name|u
decl_stmt|;
name|int
name|position
decl_stmt|;
name|int
name|ttlp
decl_stmt|;
specifier|const
name|char
modifier|*
name|predicate
init|=
literal|"if"
decl_stmt|,
modifier|*
name|en
decl_stmt|,
modifier|*
name|op
decl_stmt|;
name|int
name|errorp
decl_stmt|;
for|for
control|(
name|u
operator|=
name|ISC_LIST_HEAD
argument_list|(
operator|*
name|uq
argument_list|)
init|;
name|u
condition|;
name|u
operator|=
name|ISC_LIST_NEXT
argument_list|(
name|u
argument_list|,
name|r_link
argument_list|)
control|)
block|{
name|ttlp
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|u
operator|->
name|r_opcode
condition|)
block|{
case|case
name|NXRRSET
case|:
name|op
operator|=
literal|"rrset doesn't exist"
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|YXRRSET
case|:
name|op
operator|=
literal|"rrset exists"
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|NXDOMAIN
case|:
name|op
operator|=
literal|"domain doesn't exist"
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|YXDOMAIN
case|:
name|op
operator|=
literal|"domain exists"
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|ADD
case|:
name|op
operator|=
literal|"add"
expr_stmt|;
name|position
operator|=
literal|0
expr_stmt|;
name|ttlp
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|DELETE
case|:
name|op
operator|=
literal|"delete"
expr_stmt|;
name|position
operator|=
literal|0
expr_stmt|;
break|break;
default|default:
name|op
operator|=
literal|"unknown"
expr_stmt|;
name|position
operator|=
literal|0
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|position
condition|)
block|{
if|if
condition|(
name|s
operator|!=
operator|&
name|obuf
index|[
literal|0
index|]
operator|&&
name|s
operator|+
literal|1
operator|<
name|end
condition|)
operator|*
name|s
operator|++
operator|=
literal|' '
expr_stmt|;
if|if
condition|(
name|s
operator|+
name|strlen
argument_list|(
name|op
argument_list|)
operator|<
name|end
condition|)
block|{
name|strcpy
argument_list|(
name|s
argument_list|,
name|op
argument_list|)
expr_stmt|;
name|s
operator|+=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|s
operator|!=
operator|&
name|obuf
index|[
literal|0
index|]
operator|&&
name|s
operator|+
literal|1
operator|<
name|end
condition|)
operator|*
name|s
operator|++
operator|=
literal|' '
expr_stmt|;
if|if
condition|(
name|s
operator|+
name|strlen
argument_list|(
name|predicate
argument_list|)
operator|<
name|end
condition|)
block|{
name|strcpy
argument_list|(
name|s
argument_list|,
name|predicate
argument_list|)
expr_stmt|;
name|s
operator|+=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
name|predicate
operator|=
literal|"and"
expr_stmt|;
block|}
if|if
condition|(
name|ttlp
condition|)
block|{
if|if
condition|(
name|s
operator|+
literal|1
operator|<
name|end
condition|)
operator|*
name|s
operator|++
operator|=
literal|' '
expr_stmt|;
comment|/* 27 is as big as a ttl can get. */
if|if
condition|(
name|s
operator|+
literal|27
operator|<
name|end
condition|)
block|{
name|sprintf
argument_list|(
name|s
argument_list|,
literal|"%lu"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|u
operator|->
name|r_ttl
argument_list|)
argument_list|)
expr_stmt|;
name|s
operator|+=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
block|}
switch|switch
condition|(
name|u
operator|->
name|r_class
condition|)
block|{
case|case
name|C_IN
case|:
name|en
operator|=
literal|"IN"
expr_stmt|;
break|break;
case|case
name|C_CHAOS
case|:
name|en
operator|=
literal|"CHAOS"
expr_stmt|;
break|break;
case|case
name|C_HS
case|:
name|en
operator|=
literal|"HS"
expr_stmt|;
break|break;
default|default:
name|en
operator|=
literal|"UNKNOWN"
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|s
operator|+
name|strlen
argument_list|(
name|en
argument_list|)
operator|<
name|end
condition|)
block|{
if|if
condition|(
name|s
operator|+
literal|1
operator|<
name|end
condition|)
operator|*
name|s
operator|++
operator|=
literal|' '
expr_stmt|;
name|strcpy
argument_list|(
name|s
argument_list|,
name|en
argument_list|)
expr_stmt|;
name|s
operator|+=
name|strlen
argument_list|(
name|en
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|u
operator|->
name|r_type
condition|)
block|{
case|case
name|T_A
case|:
name|en
operator|=
literal|"A"
expr_stmt|;
break|break;
case|case
name|T_PTR
case|:
name|en
operator|=
literal|"PTR"
expr_stmt|;
break|break;
case|case
name|T_MX
case|:
name|en
operator|=
literal|"MX"
expr_stmt|;
break|break;
case|case
name|T_TXT
case|:
name|en
operator|=
literal|"TXT"
expr_stmt|;
break|break;
case|case
name|T_CNAME
case|:
name|en
operator|=
literal|"CNAME"
expr_stmt|;
break|break;
default|default:
name|en
operator|=
literal|"UNKNOWN"
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|s
operator|+
name|strlen
argument_list|(
name|en
argument_list|)
operator|<
name|end
condition|)
block|{
if|if
condition|(
name|s
operator|+
literal|1
operator|<
name|end
condition|)
operator|*
name|s
operator|++
operator|=
literal|' '
expr_stmt|;
name|strcpy
argument_list|(
name|s
argument_list|,
name|en
argument_list|)
expr_stmt|;
name|s
operator|+=
name|strlen
argument_list|(
name|en
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|u
operator|->
name|r_dname
condition|)
block|{
if|if
condition|(
name|s
operator|+
literal|1
operator|<
name|end
condition|)
operator|*
name|s
operator|++
operator|=
literal|' '
expr_stmt|;
if|if
condition|(
name|s
operator|+
name|strlen
argument_list|(
name|u
operator|->
name|r_dname
argument_list|)
operator|<
name|end
condition|)
block|{
name|strcpy
argument_list|(
name|s
argument_list|,
name|u
operator|->
name|r_dname
argument_list|)
expr_stmt|;
name|s
operator|+=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|u
operator|->
name|r_data
condition|)
block|{
if|if
condition|(
name|s
operator|+
literal|1
operator|<
name|end
condition|)
operator|*
name|s
operator|++
operator|=
literal|' '
expr_stmt|;
if|if
condition|(
name|u
operator|->
name|r_type
operator|==
name|T_TXT
condition|)
block|{
if|if
condition|(
name|s
operator|+
literal|1
operator|<
name|end
condition|)
operator|*
name|s
operator|++
operator|=
literal|'"'
expr_stmt|;
block|}
if|if
condition|(
name|s
operator|+
name|u
operator|->
name|r_size
operator|<
name|end
condition|)
block|{
name|memcpy
argument_list|(
name|s
argument_list|,
name|u
operator|->
name|r_data
argument_list|,
name|u
operator|->
name|r_size
argument_list|)
expr_stmt|;
name|s
operator|+=
name|u
operator|->
name|r_size
expr_stmt|;
if|if
condition|(
name|u
operator|->
name|r_type
operator|==
name|T_TXT
condition|)
block|{
if|if
condition|(
name|s
operator|+
literal|1
operator|<
name|end
condition|)
operator|*
name|s
operator|++
operator|=
literal|'"'
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|position
condition|)
block|{
if|if
condition|(
name|s
operator|+
literal|1
operator|<
name|end
condition|)
operator|*
name|s
operator|++
operator|=
literal|' '
expr_stmt|;
if|if
condition|(
name|s
operator|+
name|strlen
argument_list|(
name|op
argument_list|)
operator|<
name|end
condition|)
block|{
name|strcpy
argument_list|(
name|s
argument_list|,
name|op
argument_list|)
expr_stmt|;
name|s
operator|+=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|u
operator|==
name|ISC_LIST_TAIL
argument_list|(
operator|*
name|uq
argument_list|)
condition|)
break|break;
block|}
if|if
condition|(
name|s
operator|==
operator|&
name|obuf
index|[
literal|0
index|]
condition|)
block|{
name|strcpy
argument_list|(
name|s
argument_list|,
literal|"empty update"
argument_list|)
expr_stmt|;
name|s
operator|+=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|==
name|NOERROR
condition|)
name|errorp
operator|=
literal|0
expr_stmt|;
else|else
name|errorp
operator|=
literal|1
expr_stmt|;
name|en
operator|=
name|isc_result_totext
argument_list|(
name|status
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|switch (status) { 	      case -1: 		en = "resolver failed"; 		break;  	      case FORMERR: 		en = "format error"; 		break;  	      case NOERROR: 		en = "succeeded"; 		errorp = 0; 		break;  	      case NOTAUTH: 		en = "not authorized"; 		break;  	      case NOTIMP: 		en = "not implemented"; 		break;  	      case NOTZONE: 		en = "not a single valid zone"; 		break;  	      case NXDOMAIN: 		en = "no such domain"; 		break;  	      case NXRRSET: 		en = "no such record"; 		break;  	      case REFUSED: 		en = "refused"; 		break;  	      case SERVFAIL: 		en = "server failed"; 		break;  	      case YXDOMAIN: 		en = "domain exists"; 		break;  	      case YXRRSET: 		en = "record exists"; 		break;  	      default: 		en = "unknown error"; 		break; 	}
endif|#
directive|endif
if|if
condition|(
name|s
operator|+
literal|2
operator|<
name|end
condition|)
block|{
operator|*
name|s
operator|++
operator|=
literal|':'
expr_stmt|;
operator|*
name|s
operator|++
operator|=
literal|' '
expr_stmt|;
block|}
if|if
condition|(
name|s
operator|+
name|strlen
argument_list|(
name|en
argument_list|)
operator|<
name|end
condition|)
block|{
name|strcpy
argument_list|(
name|s
argument_list|,
name|en
argument_list|)
expr_stmt|;
name|s
operator|+=
name|strlen
argument_list|(
name|en
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|s
operator|+
literal|1
operator|<
name|end
condition|)
operator|*
name|s
operator|++
operator|=
literal|'.'
expr_stmt|;
operator|*
name|s
operator|++
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|errorp
condition|)
name|log_error
argument_list|(
name|obuf
argument_list|)
expr_stmt|;
else|else
name|log_info
argument_list|(
name|obuf
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* NSUPDATE */
end_comment

end_unit

