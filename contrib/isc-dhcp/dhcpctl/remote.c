begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* remote.c     The dhcpctl remote object. */
end_comment

begin_comment
comment|/*  * Copyright (c) 2004 by Internet Systems Consortium, Inc. ("ISC")  * Copyright (c) 1999-2003 by Internet Software Consortium  *  * Permission to use, copy, modify, and distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND ISC DISCLAIMS ALL WARRANTIES  * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR  * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES  * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT  * OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  *  *   Internet Systems Consortium, Inc.  *   950 Charter Street  *   Redwood City, CA 94063  *<info@isc.org>  *   http://www.isc.org/  *  * This software has been written for Internet Systems Consortium  * by Ted Lemon in cooperation with Vixie Enterprises and Nominum, Inc.  * To learn more about Internet Systems Consortium, see  * ``http://www.isc.org/''.  To learn more about Vixie Enterprises,  * see ``http://www.vix.com''.   To learn more about Nominum, Inc., see  * ``http://www.nominum.com''.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|copyright
index|[]
init|=
literal|"$Id: remote.c,v 1.12.2.6 2004/06/10 17:59:24 dhankins Exp $ Copyright (c) 2004 Internet Systems Consortium.  All rights reserved.\n"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_include
include|#
directive|include
file|<omapip/omapip_p.h>
end_include

begin_include
include|#
directive|include
file|"dhcpctl.h"
end_include

begin_comment
comment|/* dhcpctl_new_authenticator     synchronous - creates an authenticator object.    returns nonzero status code if the object couldn't be created    stores handle to authenticator through h if successful, and returns zero.    name is the authenticator name (NUL-terminated string).    algorithm is the NUL-terminated string name of the algorithm to use    (currently, only "hmac-md5" is supported).    secret and secret_len is the key secret. */
end_comment

begin_function
name|dhcpctl_status
name|dhcpctl_new_authenticator
parameter_list|(
name|dhcpctl_handle
modifier|*
name|h
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|char
modifier|*
name|algorithm
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|secret
parameter_list|,
name|unsigned
name|secret_len
parameter_list|)
block|{
name|struct
name|auth_key
modifier|*
name|key
init|=
operator|(
expr|struct
name|auth_key
operator|*
operator|)
literal|0
decl_stmt|;
name|isc_result_t
name|status
decl_stmt|;
name|status
operator|=
name|omapi_auth_key_new
argument_list|(
operator|&
name|key
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
return|return
name|status
return|;
name|key
operator|->
name|name
operator|=
name|dmalloc
argument_list|(
name|strlen
argument_list|(
name|name
argument_list|)
operator|+
literal|1
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|key
operator|->
name|name
condition|)
block|{
name|omapi_auth_key_dereference
argument_list|(
operator|&
name|key
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|ISC_R_NOMEMORY
return|;
block|}
name|strcpy
argument_list|(
name|key
operator|->
name|name
argument_list|,
name|name
argument_list|)
expr_stmt|;
comment|/* If the algorithm name isn't an FQDN, tack on the 	   .SIG-ALG.REG.NET. domain. */
if|if
condition|(
name|strchr
argument_list|(
name|algorithm
argument_list|,
literal|'.'
argument_list|)
operator|==
literal|0
condition|)
block|{
specifier|static
name|char
name|add
index|[]
init|=
literal|".SIG-ALG.REG.INT."
decl_stmt|;
name|key
operator|->
name|algorithm
operator|=
name|dmalloc
argument_list|(
name|strlen
argument_list|(
name|algorithm
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|add
argument_list|)
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|key
operator|->
name|algorithm
condition|)
block|{
name|omapi_auth_key_dereference
argument_list|(
operator|&
name|key
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|ISC_R_NOMEMORY
return|;
block|}
name|strcpy
argument_list|(
name|key
operator|->
name|algorithm
argument_list|,
name|algorithm
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|key
operator|->
name|algorithm
argument_list|,
name|add
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|key
operator|->
name|algorithm
operator|=
name|dmalloc
argument_list|(
name|strlen
argument_list|(
name|algorithm
argument_list|)
operator|+
literal|1
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|key
operator|->
name|algorithm
condition|)
block|{
name|omapi_auth_key_dereference
argument_list|(
operator|&
name|key
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|ISC_R_NOMEMORY
return|;
block|}
name|strcpy
argument_list|(
name|key
operator|->
name|algorithm
argument_list|,
name|algorithm
argument_list|)
expr_stmt|;
block|}
name|status
operator|=
name|omapi_data_string_new
argument_list|(
operator|&
name|key
operator|->
name|key
argument_list|,
name|secret_len
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|omapi_auth_key_dereference
argument_list|(
operator|&
name|key
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
name|memcpy
argument_list|(
name|key
operator|->
name|key
operator|->
name|value
argument_list|,
name|secret
argument_list|,
name|secret_len
argument_list|)
expr_stmt|;
name|key
operator|->
name|key
operator|->
name|len
operator|=
name|secret_len
expr_stmt|;
operator|*
name|h
operator|=
operator|(
name|dhcpctl_handle
operator|)
name|key
expr_stmt|;
return|return
name|ISC_R_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/* dhcpctl_new_object     synchronous - creates a local handle for a host entry.    returns nonzero status code if the local host entry couldn't    be created    stores handle to host through h if successful, and returns zero.    object_type is a pointer to a NUL-terminated string containing    the ascii name of the type of object being accessed - e.g., "host" */
end_comment

begin_function
name|dhcpctl_status
name|dhcpctl_new_object
parameter_list|(
name|dhcpctl_handle
modifier|*
name|h
parameter_list|,
name|dhcpctl_handle
name|connection
parameter_list|,
specifier|const
name|char
modifier|*
name|object_type
parameter_list|)
block|{
name|dhcpctl_remote_object_t
modifier|*
name|m
decl_stmt|;
name|omapi_object_t
modifier|*
name|g
decl_stmt|;
name|isc_result_t
name|status
decl_stmt|;
name|m
operator|=
operator|(
name|dhcpctl_remote_object_t
operator|*
operator|)
literal|0
expr_stmt|;
name|status
operator|=
name|omapi_object_allocate
argument_list|(
operator|(
name|omapi_object_t
operator|*
operator|*
operator|)
operator|&
name|m
argument_list|,
name|dhcpctl_remote_type
argument_list|,
literal|0
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
return|return
name|status
return|;
name|g
operator|=
operator|(
name|omapi_object_t
operator|*
operator|)
literal|0
expr_stmt|;
name|status
operator|=
name|omapi_generic_new
argument_list|(
operator|&
name|g
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|dfree
argument_list|(
name|m
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
name|status
operator|=
name|omapi_object_reference
argument_list|(
operator|&
name|m
operator|->
name|inner
argument_list|,
name|g
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|omapi_object_dereference
argument_list|(
operator|(
name|omapi_object_t
operator|*
operator|*
operator|)
operator|&
name|m
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
name|omapi_object_dereference
argument_list|(
operator|&
name|g
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
name|status
operator|=
name|omapi_object_reference
argument_list|(
operator|&
name|g
operator|->
name|outer
argument_list|,
operator|(
name|omapi_object_t
operator|*
operator|)
name|m
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|omapi_object_dereference
argument_list|(
operator|(
name|omapi_object_t
operator|*
operator|*
operator|)
operator|&
name|m
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
name|omapi_object_dereference
argument_list|(
operator|&
name|g
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
name|status
operator|=
name|omapi_typed_data_new
argument_list|(
name|MDL
argument_list|,
operator|&
name|m
operator|->
name|rtype
argument_list|,
name|omapi_datatype_string
argument_list|,
name|object_type
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|omapi_object_dereference
argument_list|(
operator|(
name|omapi_object_t
operator|*
operator|*
operator|)
operator|&
name|m
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
name|omapi_object_dereference
argument_list|(
operator|&
name|g
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
name|status
operator|=
name|omapi_object_reference
argument_list|(
name|h
argument_list|,
operator|(
name|omapi_object_t
operator|*
operator|)
name|m
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
name|omapi_object_dereference
argument_list|(
operator|(
name|omapi_object_t
operator|*
operator|*
operator|)
operator|&
name|m
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
name|omapi_object_dereference
argument_list|(
operator|&
name|g
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
return|return
name|status
return|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/* asynchronous - just queues the request    returns nonzero status code if open couldn't be queued    returns zero if open was queued    h is a handle to an object created by dhcpctl_new_object    connection is a connection to a DHCP server    flags include:      DHCPCTL_CREATE - if the object doesn't exist, create it      DHCPCTL_UPDATE - update the object on the server using the      		      attached parameters       DHCPCTL_EXCL - error if the object exists and DHCPCTL_CREATE      		      was also specified */
end_comment

begin_function
name|dhcpctl_status
name|dhcpctl_open_object
parameter_list|(
name|dhcpctl_handle
name|h
parameter_list|,
name|dhcpctl_handle
name|connection
parameter_list|,
name|int
name|flags
parameter_list|)
block|{
name|isc_result_t
name|status
decl_stmt|;
name|omapi_object_t
modifier|*
name|message
init|=
operator|(
name|omapi_object_t
operator|*
operator|)
literal|0
decl_stmt|;
name|dhcpctl_remote_object_t
modifier|*
name|remote
decl_stmt|;
if|if
condition|(
name|h
operator|->
name|type
operator|!=
name|dhcpctl_remote_type
condition|)
return|return
name|ISC_R_INVALIDARG
return|;
name|remote
operator|=
operator|(
name|dhcpctl_remote_object_t
operator|*
operator|)
name|h
expr_stmt|;
name|status
operator|=
name|omapi_message_new
argument_list|(
operator|&
name|message
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
return|return
name|status
return|;
name|status
operator|=
name|omapi_set_int_value
argument_list|(
name|message
argument_list|,
operator|(
name|omapi_object_t
operator|*
operator|)
literal|0
argument_list|,
literal|"op"
argument_list|,
name|OMAPI_OP_OPEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|omapi_object_dereference
argument_list|(
operator|&
name|message
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
name|status
operator|=
name|omapi_set_object_value
argument_list|(
name|message
argument_list|,
operator|(
name|omapi_object_t
operator|*
operator|)
literal|0
argument_list|,
literal|"object"
argument_list|,
name|h
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|omapi_object_dereference
argument_list|(
operator|&
name|message
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
if|if
condition|(
name|flags
operator|&
name|DHCPCTL_CREATE
condition|)
block|{
name|status
operator|=
name|omapi_set_boolean_value
argument_list|(
name|message
argument_list|,
operator|(
name|omapi_object_t
operator|*
operator|)
literal|0
argument_list|,
literal|"create"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|omapi_object_dereference
argument_list|(
operator|&
name|message
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
block|}
if|if
condition|(
name|flags
operator|&
name|DHCPCTL_UPDATE
condition|)
block|{
name|status
operator|=
name|omapi_set_boolean_value
argument_list|(
name|message
argument_list|,
operator|(
name|omapi_object_t
operator|*
operator|)
literal|0
argument_list|,
literal|"update"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|omapi_object_dereference
argument_list|(
operator|&
name|message
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
block|}
if|if
condition|(
name|flags
operator|&
name|DHCPCTL_EXCL
condition|)
block|{
name|status
operator|=
name|omapi_set_boolean_value
argument_list|(
name|message
argument_list|,
operator|(
name|omapi_object_t
operator|*
operator|)
literal|0
argument_list|,
literal|"exclusive"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|omapi_object_dereference
argument_list|(
operator|&
name|message
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
block|}
if|if
condition|(
name|remote
operator|->
name|rtype
condition|)
block|{
name|status
operator|=
name|omapi_set_value_str
argument_list|(
name|message
argument_list|,
operator|(
name|omapi_object_t
operator|*
operator|)
literal|0
argument_list|,
literal|"type"
argument_list|,
name|remote
operator|->
name|rtype
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|omapi_object_dereference
argument_list|(
operator|&
name|message
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
block|}
name|status
operator|=
name|omapi_message_register
argument_list|(
name|message
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|omapi_object_dereference
argument_list|(
operator|&
name|message
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
name|status
operator|=
name|omapi_protocol_send_message
argument_list|(
name|connection
operator|->
name|outer
argument_list|,
operator|(
name|omapi_object_t
operator|*
operator|)
literal|0
argument_list|,
name|message
argument_list|,
operator|(
name|omapi_object_t
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
name|omapi_message_unregister
argument_list|(
name|message
argument_list|)
expr_stmt|;
name|omapi_object_dereference
argument_list|(
operator|&
name|message
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/* Callback methods (not meant to be called directly) */
end_comment

begin_function
name|isc_result_t
name|dhcpctl_remote_set_value
parameter_list|(
name|omapi_object_t
modifier|*
name|h
parameter_list|,
name|omapi_object_t
modifier|*
name|id
parameter_list|,
name|omapi_data_string_t
modifier|*
name|name
parameter_list|,
name|omapi_typed_data_t
modifier|*
name|value
parameter_list|)
block|{
name|dhcpctl_remote_object_t
modifier|*
name|ro
decl_stmt|;
name|unsigned
name|long
name|rh
decl_stmt|;
name|isc_result_t
name|status
decl_stmt|;
if|if
condition|(
name|h
operator|->
name|type
operator|!=
name|dhcpctl_remote_type
condition|)
return|return
name|ISC_R_INVALIDARG
return|;
name|ro
operator|=
operator|(
name|dhcpctl_remote_object_t
operator|*
operator|)
name|h
expr_stmt|;
if|if
condition|(
operator|!
name|omapi_ds_strcmp
argument_list|(
name|name
argument_list|,
literal|"remote-handle"
argument_list|)
condition|)
block|{
name|status
operator|=
name|omapi_get_int_value
argument_list|(
operator|&
name|rh
argument_list|,
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|ISC_R_SUCCESS
condition|)
name|ro
operator|->
name|remote_handle
operator|=
name|rh
expr_stmt|;
return|return
name|status
return|;
block|}
if|if
condition|(
name|h
operator|->
name|inner
operator|&&
name|h
operator|->
name|inner
operator|->
name|type
operator|->
name|set_value
condition|)
return|return
operator|(
operator|*
operator|(
name|h
operator|->
name|inner
operator|->
name|type
operator|->
name|set_value
operator|)
operator|)
operator|(
name|h
operator|->
name|inner
operator|,
name|id
operator|,
name|name
operator|,
name|value
operator|)
return|;
return|return
name|ISC_R_NOTFOUND
return|;
block|}
end_function

begin_function
name|isc_result_t
name|dhcpctl_remote_get_value
parameter_list|(
name|omapi_object_t
modifier|*
name|h
parameter_list|,
name|omapi_object_t
modifier|*
name|id
parameter_list|,
name|omapi_data_string_t
modifier|*
name|name
parameter_list|,
name|omapi_value_t
modifier|*
modifier|*
name|value
parameter_list|)
block|{
if|if
condition|(
name|h
operator|->
name|type
operator|!=
name|dhcpctl_remote_type
condition|)
return|return
name|ISC_R_INVALIDARG
return|;
if|if
condition|(
name|h
operator|->
name|inner
operator|&&
name|h
operator|->
name|inner
operator|->
name|type
operator|->
name|get_value
condition|)
return|return
operator|(
operator|*
operator|(
name|h
operator|->
name|inner
operator|->
name|type
operator|->
name|get_value
operator|)
operator|)
operator|(
name|h
operator|->
name|inner
operator|,
name|id
operator|,
name|name
operator|,
name|value
operator|)
return|;
return|return
name|ISC_R_NOTFOUND
return|;
block|}
end_function

begin_function
name|isc_result_t
name|dhcpctl_remote_signal_handler
parameter_list|(
name|omapi_object_t
modifier|*
name|o
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|va_list
name|ap
parameter_list|)
block|{
name|dhcpctl_remote_object_t
modifier|*
name|p
decl_stmt|;
name|omapi_typed_data_t
modifier|*
name|tv
decl_stmt|;
if|if
condition|(
name|o
operator|->
name|type
operator|!=
name|dhcpctl_remote_type
condition|)
return|return
name|ISC_R_INVALIDARG
return|;
name|p
operator|=
operator|(
name|dhcpctl_remote_object_t
operator|*
operator|)
name|o
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"updated"
argument_list|)
condition|)
block|{
name|p
operator|->
name|waitstatus
operator|=
name|ISC_R_SUCCESS
expr_stmt|;
if|if
condition|(
name|o
operator|->
name|inner
operator|->
name|type
operator|==
name|omapi_type_generic
condition|)
name|omapi_generic_clear_flags
argument_list|(
name|o
operator|->
name|inner
argument_list|)
expr_stmt|;
return|return
name|omapi_signal_in
argument_list|(
name|o
operator|->
name|inner
argument_list|,
literal|"ready"
argument_list|)
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"status"
argument_list|)
condition|)
block|{
name|p
operator|->
name|waitstatus
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|isc_result_t
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|->
name|message
condition|)
name|omapi_typed_data_dereference
argument_list|(
operator|&
name|p
operator|->
name|message
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
name|tv
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|omapi_typed_data_t
operator|*
argument_list|)
expr_stmt|;
if|if
condition|(
name|tv
condition|)
name|omapi_typed_data_reference
argument_list|(
operator|&
name|p
operator|->
name|message
argument_list|,
name|tv
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
return|return
name|omapi_signal_in
argument_list|(
name|o
operator|->
name|inner
argument_list|,
literal|"ready"
argument_list|)
return|;
block|}
if|if
condition|(
name|p
operator|->
name|inner
operator|&&
name|p
operator|->
name|inner
operator|->
name|type
operator|->
name|signal_handler
condition|)
return|return
operator|(
operator|*
operator|(
name|p
operator|->
name|inner
operator|->
name|type
operator|->
name|signal_handler
operator|)
operator|)
operator|(
name|p
operator|->
name|inner
operator|,
name|name
operator|,
name|ap
operator|)
return|;
return|return
name|ISC_R_SUCCESS
return|;
block|}
end_function

begin_function
name|isc_result_t
name|dhcpctl_remote_destroy
parameter_list|(
name|omapi_object_t
modifier|*
name|h
parameter_list|,
specifier|const
name|char
modifier|*
name|file
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|dhcpctl_remote_object_t
modifier|*
name|p
decl_stmt|;
if|if
condition|(
name|h
operator|->
name|type
operator|!=
name|dhcpctl_remote_type
condition|)
return|return
name|ISC_R_INVALIDARG
return|;
name|p
operator|=
operator|(
name|dhcpctl_remote_object_t
operator|*
operator|)
name|h
expr_stmt|;
if|if
condition|(
name|p
operator|->
name|handle
condition|)
name|omapi_object_dereference
argument_list|(
operator|(
name|omapi_object_t
operator|*
operator|*
operator|)
operator|&
name|p
operator|->
name|handle
argument_list|,
name|file
argument_list|,
name|line
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|->
name|rtype
condition|)
name|omapi_typed_data_dereference
argument_list|(
operator|(
name|omapi_typed_data_t
operator|*
operator|*
operator|)
operator|&
name|p
operator|->
name|rtype
argument_list|,
name|file
argument_list|,
name|line
argument_list|)
expr_stmt|;
return|return
name|ISC_R_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/* Write all the published values associated with the object through the    specified connection. */
end_comment

begin_function
name|isc_result_t
name|dhcpctl_remote_stuff_values
parameter_list|(
name|omapi_object_t
modifier|*
name|c
parameter_list|,
name|omapi_object_t
modifier|*
name|id
parameter_list|,
name|omapi_object_t
modifier|*
name|p
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
name|p
operator|->
name|type
operator|!=
name|dhcpctl_remote_type
condition|)
return|return
name|ISC_R_INVALIDARG
return|;
if|if
condition|(
name|p
operator|->
name|inner
operator|&&
name|p
operator|->
name|inner
operator|->
name|type
operator|->
name|stuff_values
condition|)
return|return
operator|(
operator|*
operator|(
name|p
operator|->
name|inner
operator|->
name|type
operator|->
name|stuff_values
operator|)
operator|)
operator|(
name|c
operator|,
name|id
operator|,
name|p
operator|->
name|inner
operator|)
return|;
return|return
name|ISC_R_SUCCESS
return|;
block|}
end_function

end_unit

