begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* omshell.c     Examine and modify omapi objects. */
end_comment

begin_comment
comment|/*  * Copyright (c) 2004 by Internet Systems Consortium, Inc. ("ISC")  * Copyright (c) 2001-2003 by Internet Software Consortium  *  * Permission to use, copy, modify, and distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND ISC DISCLAIMS ALL WARRANTIES  * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR  * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES  * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT  * OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  *  *   Internet Systems Consortium, Inc.  *   950 Charter Street  *   Redwood City, CA 94063  *<info@isc.org>  *   http://www.isc.org/  *  * This software has been written for Internet Systems Consortium  * by Ted Lemon in cooperation with Vixie Enterprises and Nominum, Inc.  * To learn more about Internet Systems Consortium, see  * ``http://www.isc.org/''.  To learn more about Vixie Enterprises,  * see ``http://www.vix.com''.   To learn more about Nominum, Inc., see  * ``http://www.nominum.com''.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|copyright
index|[]
init|=
literal|"$Id: omshell.c,v 1.7.2.16 2004/06/10 17:59:24 dhankins Exp $ Copyright (c) 2004 Internet Systems Consortium.  All rights reserved.\n"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<isc-dhcp/result.h>
end_include

begin_include
include|#
directive|include
file|"dhcpctl.h"
end_include

begin_include
include|#
directive|include
file|"dhcpd.h"
end_include

begin_comment
comment|/* Fixups */
end_comment

begin_function
name|isc_result_t
name|find_class
parameter_list|(
name|struct
name|class
modifier|*
modifier|*
name|c
parameter_list|,
specifier|const
name|char
modifier|*
name|n
parameter_list|,
specifier|const
name|char
modifier|*
name|f
parameter_list|,
name|int
name|l
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|parse_allow_deny
parameter_list|(
name|struct
name|option_cache
modifier|*
modifier|*
name|oc
parameter_list|,
name|struct
name|parse
modifier|*
name|cfile
parameter_list|,
name|int
name|flag
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|dhcp
parameter_list|(
name|struct
name|packet
modifier|*
name|packet
parameter_list|)
block|{ }
end_function

begin_function
name|void
name|bootp
parameter_list|(
name|struct
name|packet
modifier|*
name|packet
parameter_list|)
block|{ }
end_function

begin_function
name|int
name|check_collection
parameter_list|(
name|struct
name|packet
modifier|*
name|p
parameter_list|,
name|struct
name|lease
modifier|*
name|l
parameter_list|,
name|struct
name|collection
modifier|*
name|c
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|classify
parameter_list|(
name|struct
name|packet
modifier|*
name|packet
parameter_list|,
name|struct
name|class
modifier|*
name|class
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|void
name|usage
parameter_list|(
name|char
modifier|*
name|s
parameter_list|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Usage: %s\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|check
parameter_list|(
name|isc_result_t
name|status
parameter_list|,
specifier|const
name|char
modifier|*
name|func
parameter_list|)
block|{
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: %s\n"
argument_list|,
name|func
argument_list|,
name|isc_result_totext
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
name|char
modifier|*
modifier|*
name|envp
parameter_list|)
block|{
name|isc_result_t
name|status
decl_stmt|,
name|waitstatus
decl_stmt|;
name|dhcpctl_handle
name|connection
decl_stmt|;
name|dhcpctl_handle
name|authenticator
decl_stmt|;
name|dhcpctl_handle
name|oh
decl_stmt|;
name|dhcpctl_data_string
name|cid
decl_stmt|,
name|ip_addr
decl_stmt|;
name|dhcpctl_data_string
name|result
decl_stmt|,
name|groupname
decl_stmt|,
name|identifier
decl_stmt|;
name|struct
name|data_string
name|secret
decl_stmt|;
specifier|const
name|char
modifier|*
name|name
init|=
literal|0
decl_stmt|,
modifier|*
name|algorithm
init|=
literal|"hmac-md5"
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|int
name|port
init|=
literal|7911
decl_stmt|;
specifier|const
name|char
modifier|*
name|server
init|=
literal|"127.0.0.1"
decl_stmt|;
name|struct
name|parse
modifier|*
name|cfile
decl_stmt|;
name|enum
name|dhcp_token
name|token
decl_stmt|;
specifier|const
name|char
modifier|*
name|val
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|;
name|char
name|buf
index|[
literal|1024
index|]
decl_stmt|;
name|char
name|s1
index|[
literal|1024
index|]
decl_stmt|;
name|int
name|connected
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|argc
condition|;
name|i
operator|++
control|)
block|{
name|usage
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
comment|/* Initially, log errors to stderr as well as to syslogd. */
ifdef|#
directive|ifdef
name|SYSLOG_4_2
name|openlog
argument_list|(
literal|"omshell"
argument_list|,
name|LOG_NDELAY
argument_list|)
expr_stmt|;
name|log_priority
operator|=
name|DHCPD_LOG_FACILITY
expr_stmt|;
else|#
directive|else
name|openlog
argument_list|(
literal|"omshell"
argument_list|,
name|LOG_NDELAY
argument_list|,
name|DHCPD_LOG_FACILITY
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|status
operator|=
name|dhcpctl_initialize
argument_list|()
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"dhcpctl_initialize: %s\n"
argument_list|,
name|isc_result_totext
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|memset
argument_list|(
operator|&
name|oh
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
name|oh
argument_list|)
expr_stmt|;
do|do
block|{
if|if
condition|(
operator|!
name|connected
condition|)
block|{ 	    }
elseif|else
if|if
condition|(
name|oh
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"obj:<null>\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dhcpctl_remote_object_t
modifier|*
name|r
init|=
operator|(
name|dhcpctl_remote_object_t
operator|*
operator|)
name|oh
decl_stmt|;
name|omapi_generic_object_t
modifier|*
name|g
init|=
operator|(
name|omapi_generic_object_t
operator|*
operator|)
operator|(
name|r
operator|->
name|inner
operator|)
decl_stmt|;
name|printf
argument_list|(
literal|"obj: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
operator|->
name|rtype
operator|->
name|type
operator|!=
name|omapi_datatype_string
condition|)
block|{
name|printf
argument_list|(
literal|"?\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"%.*s\n"
argument_list|,
call|(
name|int
call|)
argument_list|(
name|r
operator|->
name|rtype
operator|->
name|u
operator|.
name|buffer
operator|.
name|len
argument_list|)
argument_list|,
name|r
operator|->
name|rtype
operator|->
name|u
operator|.
name|buffer
operator|.
name|value
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|g
operator|->
name|nvalues
condition|;
name|i
operator|++
control|)
block|{
name|omapi_value_t
modifier|*
name|v
init|=
name|g
operator|->
name|values
index|[
name|i
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|g
operator|->
name|values
index|[
name|i
index|]
condition|)
continue|continue;
name|printf
argument_list|(
literal|"%.*s = "
argument_list|,
operator|(
name|int
operator|)
name|v
operator|->
name|name
operator|->
name|len
argument_list|,
name|v
operator|->
name|name
operator|->
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|v
operator|->
name|value
condition|)
block|{
name|printf
argument_list|(
literal|"<null>\n"
argument_list|)
expr_stmt|;
continue|continue;
block|}
switch|switch
condition|(
name|v
operator|->
name|value
operator|->
name|type
condition|)
block|{
case|case
name|omapi_datatype_int
case|:
name|printf
argument_list|(
literal|"%d\n"
argument_list|,
name|v
operator|->
name|value
operator|->
name|u
operator|.
name|integer
argument_list|)
expr_stmt|;
break|break;
case|case
name|omapi_datatype_string
case|:
name|printf
argument_list|(
literal|"\"%.*s\"\n"
argument_list|,
operator|(
name|int
operator|)
name|v
operator|->
name|value
operator|->
name|u
operator|.
name|buffer
operator|.
name|len
argument_list|,
name|v
operator|->
name|value
operator|->
name|u
operator|.
name|buffer
operator|.
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|omapi_datatype_data
case|:
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|print_hex_1
argument_list|(
name|v
operator|->
name|value
operator|->
name|u
operator|.
name|buffer
operator|.
name|len
argument_list|,
name|v
operator|->
name|value
operator|->
name|u
operator|.
name|buffer
operator|.
name|value
argument_list|,
literal|60
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|omapi_datatype_object
case|:
name|printf
argument_list|(
literal|"<obj>\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
name|fputs
argument_list|(
literal|"> "
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|stdin
argument_list|)
operator|==
name|NULL
condition|)
break|break;
name|status
operator|=
name|new_parse
argument_list|(
operator|&
name|cfile
argument_list|,
literal|0
argument_list|,
name|buf
argument_list|,
name|strlen
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"<STDIN>"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|status
argument_list|,
literal|"new_parse()"
argument_list|)
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|token
condition|)
block|{
default|default:
name|parse_warn
argument_list|(
name|cfile
argument_list|,
literal|"unknown token: %s"
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
case|case
name|END_OF_FILE
case|:
case|case
name|EOL
case|:
break|break;
case|case
name|TOKEN_HELP
case|:
case|case
literal|'?'
case|:
name|printf
argument_list|(
literal|"Commands:\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  port<server omapi port>\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  server<server address>\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  key<key name><key value>\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  connect\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  new<object-type>\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  set<name> =<value>\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  create\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  open\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  update\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  unset<name>\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  refresh\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  remove\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
case|case
name|PORT
case|:
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|is_identifier
argument_list|(
name|token
argument_list|)
condition|)
block|{
name|struct
name|servent
modifier|*
name|se
decl_stmt|;
name|se
operator|=
name|getservbyname
argument_list|(
name|val
argument_list|,
literal|"tcp"
argument_list|)
expr_stmt|;
if|if
condition|(
name|se
condition|)
name|port
operator|=
name|ntohs
argument_list|(
name|se
operator|->
name|s_port
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"unknown service name: %s\n"
argument_list|,
name|val
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|token
operator|==
name|NUMBER
condition|)
block|{
name|port
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"usage: port<port>\n"
argument_list|)
expr_stmt|;
break|break;
block|}
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
block|{
name|printf
argument_list|(
literal|"usage: port<server>\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|SERVER
case|:
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|==
name|NUMBER
condition|)
block|{
name|int
name|alen
init|=
operator|(
sizeof|sizeof
name|buf
operator|)
operator|-
literal|1
decl_stmt|;
name|int
name|len
decl_stmt|;
name|s
operator|=
operator|&
name|buf
index|[
literal|0
index|]
expr_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|+
literal|1
operator|>
name|alen
condition|)
block|{
name|baddq
label|:
name|printf
argument_list|(
literal|"usage: server<server>\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|strcpy
argument_list|(
name|buf
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|s
operator|+=
name|len
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|DOT
condition|)
goto|goto
name|baddq
goto|;
operator|*
name|s
operator|++
operator|=
literal|'.'
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|NUMBER
condition|)
goto|goto
name|baddq
goto|;
name|len
operator|=
name|strlen
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|+
literal|1
operator|>
name|alen
condition|)
goto|goto
name|baddq
goto|;
name|strcpy
argument_list|(
name|s
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|s
operator|+=
name|len
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|DOT
condition|)
goto|goto
name|baddq
goto|;
operator|*
name|s
operator|++
operator|=
literal|'.'
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|NUMBER
condition|)
goto|goto
name|baddq
goto|;
name|len
operator|=
name|strlen
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|+
literal|1
operator|>
name|alen
condition|)
goto|goto
name|baddq
goto|;
name|strcpy
argument_list|(
name|s
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|s
operator|+=
name|len
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|DOT
condition|)
goto|goto
name|baddq
goto|;
operator|*
name|s
operator|++
operator|=
literal|'.'
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|NUMBER
condition|)
goto|goto
name|baddq
goto|;
name|len
operator|=
name|strlen
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|+
literal|1
operator|>
name|alen
condition|)
goto|goto
name|baddq
goto|;
name|strcpy
argument_list|(
name|s
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|val
operator|=
operator|&
name|buf
index|[
literal|0
index|]
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|is_identifier
argument_list|(
name|token
argument_list|)
condition|)
block|{
comment|/* Use val directly. */
block|}
else|else
block|{
name|printf
argument_list|(
literal|"usage: server<server>\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|s
operator|=
name|dmalloc
argument_list|(
name|strlen
argument_list|(
name|val
argument_list|)
operator|+
literal|1
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|server
condition|)
block|{
name|printf
argument_list|(
literal|"no memory to store server name.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|strcpy
argument_list|(
name|s
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|server
operator|=
name|s
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
block|{
name|printf
argument_list|(
literal|"usage: server<server>\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|KEY
case|:
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|is_identifier
argument_list|(
name|token
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"usage: key<name><value>\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|s
operator|=
name|dmalloc
argument_list|(
name|strlen
argument_list|(
name|val
argument_list|)
operator|+
literal|1
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
condition|)
block|{
name|printf
argument_list|(
literal|"no memory for key name.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|strcpy
argument_list|(
name|s
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|name
operator|=
name|s
expr_stmt|;
name|memset
argument_list|(
operator|&
name|secret
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
name|secret
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|parse_base64
argument_list|(
operator|&
name|secret
argument_list|,
name|cfile
argument_list|)
condition|)
block|{
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
block|{
name|printf
argument_list|(
literal|"usage: key<name><secret>\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|CONNECT
case|:
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
block|{
name|printf
argument_list|(
literal|"usage: connect\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|authenticator
operator|=
name|dhcpctl_null_handle
expr_stmt|;
if|if
condition|(
name|name
condition|)
block|{
name|status
operator|=
name|dhcpctl_new_authenticator
argument_list|(
operator|&
name|authenticator
argument_list|,
name|name
argument_list|,
name|algorithm
argument_list|,
name|secret
operator|.
name|data
argument_list|,
name|secret
operator|.
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Cannot create authenticator: %s\n"
argument_list|,
name|isc_result_totext
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|memset
argument_list|(
operator|&
name|connection
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
name|connection
argument_list|)
expr_stmt|;
name|status
operator|=
name|dhcpctl_connect
argument_list|(
operator|&
name|connection
argument_list|,
name|server
argument_list|,
name|port
argument_list|,
name|authenticator
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"dhcpctl_connect: %s\n"
argument_list|,
name|isc_result_totext
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|connected
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|TOKEN_NEW
case|:
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|!
name|is_identifier
argument_list|(
name|token
argument_list|)
operator|&&
name|token
operator|!=
name|STRING
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"usage: new<object-type>\n"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|oh
condition|)
block|{
name|printf
argument_list|(
literal|"an object is already open.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|connected
condition|)
block|{
name|printf
argument_list|(
literal|"not connected.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|status
operator|=
name|dhcpctl_new_object
argument_list|(
operator|&
name|oh
argument_list|,
name|connection
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|printf
argument_list|(
literal|"can't create object: %s\n"
argument_list|,
name|isc_result_totext
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
block|{
name|printf
argument_list|(
literal|"usage: new<object-type>\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|TOKEN_CLOSE
case|:
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
block|{
name|printf
argument_list|(
literal|"usage: close\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|connected
condition|)
block|{
name|printf
argument_list|(
literal|"not connected.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|oh
condition|)
block|{
name|printf
argument_list|(
literal|"not open.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|omapi_object_dereference
argument_list|(
operator|&
name|oh
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
break|break;
case|case
name|TOKEN_SET
case|:
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|!
name|is_identifier
argument_list|(
name|token
argument_list|)
operator|&&
name|token
operator|!=
name|STRING
operator|)
condition|)
block|{
name|set_usage
label|:
name|printf
argument_list|(
literal|"usage: set<name> =<value>\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|oh
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"no open object.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|connected
condition|)
block|{
name|printf
argument_list|(
literal|"not connected.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|s1
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|strncat
argument_list|(
name|s1
argument_list|,
name|val
argument_list|,
sizeof|sizeof
argument_list|(
name|s1
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|EQUAL
condition|)
goto|goto
name|set_usage
goto|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|token
condition|)
block|{
case|case
name|STRING
case|:
name|dhcpctl_set_string_value
argument_list|(
name|oh
argument_list|,
name|val
argument_list|,
name|s1
argument_list|)
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
break|break;
case|case
name|NUMBER
case|:
name|strcpy
argument_list|(
name|buf
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
comment|/* Colon-seperated hex list? */
if|if
condition|(
name|token
operator|==
name|COLON
condition|)
goto|goto
name|cshl
goto|;
elseif|else
if|if
condition|(
name|token
operator|==
name|DOT
condition|)
block|{
name|s
operator|=
name|buf
expr_stmt|;
name|val
operator|=
name|buf
expr_stmt|;
do|do
block|{
name|int
name|intval
init|=
name|atoi
argument_list|(
name|val
argument_list|)
decl_stmt|;
name|dotiszero
label|:
if|if
condition|(
name|intval
operator|>
literal|255
condition|)
block|{
name|parse_warn
argument_list|(
name|cfile
argument_list|,
literal|"dotted octet> 255: %s"
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
goto|goto
name|badnum
goto|;
block|}
operator|*
name|s
operator|++
operator|=
name|intval
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|DOT
condition|)
break|break;
comment|/* DOT is zero. */
while|while
condition|(
operator|(
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
operator|)
operator|==
name|DOT
condition|)
operator|*
name|s
operator|++
operator|=
literal|0
expr_stmt|;
block|}
do|while
condition|(
name|token
operator|==
name|NUMBER
condition|)
do|;
name|dhcpctl_set_data_value
argument_list|(
name|oh
argument_list|,
name|buf
argument_list|,
call|(
name|unsigned
call|)
argument_list|(
name|s
operator|-
name|buf
argument_list|)
argument_list|,
name|s1
argument_list|)
expr_stmt|;
break|break;
block|}
name|dhcpctl_set_int_value
argument_list|(
name|oh
argument_list|,
name|atoi
argument_list|(
name|buf
argument_list|)
argument_list|,
name|s1
argument_list|)
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
name|badnum
label|:
break|break;
case|case
name|NUMBER_OR_NAME
case|:
name|strcpy
argument_list|(
name|buf
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|cshl
label|:
name|s
operator|=
name|buf
expr_stmt|;
name|val
operator|=
name|buf
expr_stmt|;
do|do
block|{
name|convert_num
argument_list|(
name|cfile
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|s
argument_list|,
name|val
argument_list|,
literal|16
argument_list|,
literal|8
argument_list|)
expr_stmt|;
operator|++
name|s
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|COLON
condition|)
break|break;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|token
operator|==
name|NUMBER
operator|||
name|token
operator|==
name|NUMBER_OR_NAME
condition|)
do|;
name|dhcpctl_set_data_value
argument_list|(
name|oh
argument_list|,
name|buf
argument_list|,
call|(
name|unsigned
call|)
argument_list|(
name|s
operator|-
name|buf
argument_list|)
argument_list|,
name|s1
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"invalid value.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
goto|goto
name|set_usage
goto|;
break|break;
case|case
name|UNSET
case|:
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|!
name|is_identifier
argument_list|(
name|token
argument_list|)
operator|&&
name|token
operator|!=
name|STRING
operator|)
condition|)
block|{
name|unset_usage
label|:
name|printf
argument_list|(
literal|"usage: unset<name>\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|oh
condition|)
block|{
name|printf
argument_list|(
literal|"no open object.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|connected
condition|)
block|{
name|printf
argument_list|(
literal|"not connected.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|s1
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|strncat
argument_list|(
name|s1
argument_list|,
name|val
argument_list|,
sizeof|sizeof
argument_list|(
name|s1
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
goto|goto
name|unset_usage
goto|;
name|dhcpctl_set_null_value
argument_list|(
name|oh
argument_list|,
name|s1
argument_list|)
expr_stmt|;
break|break;
case|case
name|TOKEN_CREATE
case|:
case|case
name|TOKEN_OPEN
case|:
name|i
operator|=
name|token
expr_stmt|;
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
block|{
name|printf
argument_list|(
literal|"usage: %s\n"
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|connected
condition|)
block|{
name|printf
argument_list|(
literal|"not connected.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|oh
condition|)
block|{
name|printf
argument_list|(
literal|"you must make a new object first!\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|i
operator|==
name|TOKEN_CREATE
condition|)
name|i
operator|=
name|DHCPCTL_CREATE
operator||
name|DHCPCTL_EXCL
expr_stmt|;
else|else
name|i
operator|=
literal|0
expr_stmt|;
name|status
operator|=
name|dhcpctl_open_object
argument_list|(
name|oh
argument_list|,
name|connection
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|ISC_R_SUCCESS
condition|)
name|status
operator|=
name|dhcpctl_wait_for_completion
argument_list|(
name|oh
argument_list|,
operator|&
name|waitstatus
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|ISC_R_SUCCESS
condition|)
name|status
operator|=
name|waitstatus
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|printf
argument_list|(
literal|"can't open object: %s\n"
argument_list|,
name|isc_result_totext
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|UPDATE
case|:
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
block|{
name|printf
argument_list|(
literal|"usage: %s\n"
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|connected
condition|)
block|{
name|printf
argument_list|(
literal|"not connected.\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|oh
condition|)
block|{
name|printf
argument_list|(
literal|"you haven't opened an object yet!\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
name|status
operator|=
name|dhcpctl_object_update
argument_list|(
name|connection
argument_list|,
name|oh
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|ISC_R_SUCCESS
condition|)
name|status
operator|=
name|dhcpctl_wait_for_completion
argument_list|(
name|oh
argument_list|,
operator|&
name|waitstatus
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|ISC_R_SUCCESS
condition|)
name|status
operator|=
name|waitstatus
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|printf
argument_list|(
literal|"can't update object: %s\n"
argument_list|,
name|isc_result_totext
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|REMOVE
case|:
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
block|{
name|printf
argument_list|(
literal|"usage: remove\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|connected
condition|)
block|{
name|printf
argument_list|(
literal|"not connected.\n"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|oh
condition|)
block|{
name|printf
argument_list|(
literal|"no object.\n"
argument_list|)
expr_stmt|;
break|break;
block|}
name|status
operator|=
name|dhcpctl_object_remove
argument_list|(
name|connection
argument_list|,
name|oh
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|ISC_R_SUCCESS
condition|)
name|status
operator|=
name|dhcpctl_wait_for_completion
argument_list|(
name|oh
argument_list|,
operator|&
name|waitstatus
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|ISC_R_SUCCESS
condition|)
name|status
operator|=
name|waitstatus
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|printf
argument_list|(
literal|"can't destroy object: %s\n"
argument_list|,
name|isc_result_totext
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|omapi_object_dereference
argument_list|(
operator|&
name|oh
argument_list|,
name|MDL
argument_list|)
expr_stmt|;
break|break;
case|case
name|REFRESH
case|:
name|token
operator|=
name|next_token
argument_list|(
operator|&
name|val
argument_list|,
operator|(
name|unsigned
operator|*
operator|)
literal|0
argument_list|,
name|cfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|END_OF_FILE
operator|&&
name|token
operator|!=
name|EOL
condition|)
block|{
name|printf
argument_list|(
literal|"usage: refresh\n"
argument_list|)
expr_stmt|;
name|skip_to_semi
argument_list|(
name|cfile
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|connected
condition|)
block|{
name|printf
argument_list|(
literal|"not connected.\n"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|oh
condition|)
block|{
name|printf
argument_list|(
literal|"no object.\n"
argument_list|)
expr_stmt|;
break|break;
block|}
name|status
operator|=
name|dhcpctl_object_refresh
argument_list|(
name|connection
argument_list|,
name|oh
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|ISC_R_SUCCESS
condition|)
name|status
operator|=
name|dhcpctl_wait_for_completion
argument_list|(
name|oh
argument_list|,
operator|&
name|waitstatus
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|ISC_R_SUCCESS
condition|)
name|status
operator|=
name|waitstatus
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|ISC_R_SUCCESS
condition|)
block|{
name|printf
argument_list|(
literal|"can't refresh object: %s\n"
argument_list|,
name|isc_result_totext
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
block|}
block|}
do|while
condition|(
literal|1
condition|)
do|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Sigh */
end_comment

begin_function
name|isc_result_t
name|dhcp_set_control_state
parameter_list|(
name|control_object_state_t
name|oldstate
parameter_list|,
name|control_object_state_t
name|newstate
parameter_list|)
block|{
return|return
name|ISC_R_SUCCESS
return|;
block|}
end_function

end_unit

