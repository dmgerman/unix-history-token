begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (C) 2005-2007, 2009, 2011-2015  Internet Systems Consortium, Inc. ("ISC")  *  * Permission to use, copy, modify, and/or distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND ISC DISCLAIMS ALL WARRANTIES WITH  * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY  * AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR ANY SPECIAL, DIRECT,  * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM  * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE  * OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR  * PERFORMANCE OF THIS SOFTWARE.  */
end_comment

begin_comment
comment|/* $Id$ */
end_comment

begin_comment
comment|/*  * This code implements the HMAC-SHA1, HMAC-SHA224, HMAC-SHA256, HMAC-SHA384  * and HMAC-SHA512 keyed hash algorithm described in RFC 2104 and  * draft-ietf-dnsext-tsig-sha-01.txt.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<isc/assertions.h>
end_include

begin_include
include|#
directive|include
file|<isc/hmacsha.h>
end_include

begin_include
include|#
directive|include
file|<isc/platform.h>
end_include

begin_include
include|#
directive|include
file|<isc/safe.h>
end_include

begin_include
include|#
directive|include
file|<isc/sha1.h>
end_include

begin_include
include|#
directive|include
file|<isc/sha2.h>
end_include

begin_include
include|#
directive|include
file|<isc/string.h>
end_include

begin_include
include|#
directive|include
file|<isc/types.h>
end_include

begin_include
include|#
directive|include
file|<isc/util.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|ISC_PLATFORM_OPENSSLHASH
end_ifdef

begin_function
name|void
name|isc_hmacsha1_init
parameter_list|(
name|isc_hmacsha1_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Init
argument_list|(
name|ctx
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|key
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|,
name|EVP_sha1
argument_list|()
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Init
argument_list|(
name|ctx
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|key
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|,
name|EVP_sha1
argument_list|()
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|isc_hmacsha1_invalidate
parameter_list|(
name|isc_hmacsha1_t
modifier|*
name|ctx
parameter_list|)
block|{
name|HMAC_CTX_cleanup
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha1_update
parameter_list|(
name|isc_hmacsha1_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Update
argument_list|(
name|ctx
argument_list|,
name|buf
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Update
argument_list|(
name|ctx
argument_list|,
name|buf
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|isc_hmacsha1_sign
parameter_list|(
name|isc_hmacsha1_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA1_DIGESTLENGTH
index|]
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA1_DIGESTLENGTH
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Final
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|NULL
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Final
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|HMAC_CTX_cleanup
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|newdigest
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|newdigest
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha224_init
parameter_list|(
name|isc_hmacsha224_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Init
argument_list|(
name|ctx
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|key
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|,
name|EVP_sha224
argument_list|()
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Init
argument_list|(
name|ctx
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|key
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|,
name|EVP_sha224
argument_list|()
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|isc_hmacsha224_invalidate
parameter_list|(
name|isc_hmacsha224_t
modifier|*
name|ctx
parameter_list|)
block|{
name|HMAC_CTX_cleanup
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha224_update
parameter_list|(
name|isc_hmacsha224_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Update
argument_list|(
name|ctx
argument_list|,
name|buf
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Update
argument_list|(
name|ctx
argument_list|,
name|buf
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|isc_hmacsha224_sign
parameter_list|(
name|isc_hmacsha224_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA224_DIGESTLENGTH
index|]
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA224_DIGESTLENGTH
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Final
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|NULL
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Final
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|HMAC_CTX_cleanup
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|newdigest
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|newdigest
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha256_init
parameter_list|(
name|isc_hmacsha256_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Init
argument_list|(
name|ctx
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|key
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|,
name|EVP_sha256
argument_list|()
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Init
argument_list|(
name|ctx
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|key
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|,
name|EVP_sha256
argument_list|()
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|isc_hmacsha256_invalidate
parameter_list|(
name|isc_hmacsha256_t
modifier|*
name|ctx
parameter_list|)
block|{
name|HMAC_CTX_cleanup
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha256_update
parameter_list|(
name|isc_hmacsha256_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Update
argument_list|(
name|ctx
argument_list|,
name|buf
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Update
argument_list|(
name|ctx
argument_list|,
name|buf
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|isc_hmacsha256_sign
parameter_list|(
name|isc_hmacsha256_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA256_DIGESTLENGTH
index|]
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA256_DIGESTLENGTH
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Final
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|NULL
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Final
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|HMAC_CTX_cleanup
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|newdigest
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|newdigest
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha384_init
parameter_list|(
name|isc_hmacsha384_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Init
argument_list|(
name|ctx
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|key
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|,
name|EVP_sha384
argument_list|()
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Init
argument_list|(
name|ctx
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|key
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|,
name|EVP_sha384
argument_list|()
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|isc_hmacsha384_invalidate
parameter_list|(
name|isc_hmacsha384_t
modifier|*
name|ctx
parameter_list|)
block|{
name|HMAC_CTX_cleanup
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha384_update
parameter_list|(
name|isc_hmacsha384_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Update
argument_list|(
name|ctx
argument_list|,
name|buf
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Update
argument_list|(
name|ctx
argument_list|,
name|buf
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|isc_hmacsha384_sign
parameter_list|(
name|isc_hmacsha384_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA384_DIGESTLENGTH
index|]
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA384_DIGESTLENGTH
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Final
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|NULL
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Final
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|HMAC_CTX_cleanup
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|newdigest
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|newdigest
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha512_init
parameter_list|(
name|isc_hmacsha512_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Init
argument_list|(
name|ctx
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|key
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|,
name|EVP_sha512
argument_list|()
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Init
argument_list|(
name|ctx
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|key
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|,
name|EVP_sha512
argument_list|()
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|isc_hmacsha512_invalidate
parameter_list|(
name|isc_hmacsha512_t
modifier|*
name|ctx
parameter_list|)
block|{
name|HMAC_CTX_cleanup
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha512_update
parameter_list|(
name|isc_hmacsha512_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Update
argument_list|(
name|ctx
argument_list|,
name|buf
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Update
argument_list|(
name|ctx
argument_list|,
name|buf
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|isc_hmacsha512_sign
parameter_list|(
name|isc_hmacsha512_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA512_DIGESTLENGTH
index|]
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA512_DIGESTLENGTH
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|HMAC_RETURN_INT
name|RUNTIME_CHECK
argument_list|(
name|HMAC_Final
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|NULL
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|HMAC_Final
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|HMAC_CTX_cleanup
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|newdigest
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|newdigest
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|IPAD
value|0x36
end_define

begin_define
define|#
directive|define
name|OPAD
value|0x5C
end_define

begin_comment
comment|/*  * Start HMAC-SHA1 process.  Initialize an sha1 context and digest the key.  */
end_comment

begin_function
name|void
name|isc_hmacsha1_init
parameter_list|(
name|isc_hmacsha1_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|ipad
index|[
name|ISC_SHA1_BLOCK_LENGTH
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|memset
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ctx
operator|->
name|key
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
sizeof|sizeof
argument_list|(
name|ctx
operator|->
name|key
argument_list|)
condition|)
block|{
name|isc_sha1_t
name|sha1ctx
decl_stmt|;
name|isc_sha1_init
argument_list|(
operator|&
name|sha1ctx
argument_list|)
expr_stmt|;
name|isc_sha1_update
argument_list|(
operator|&
name|sha1ctx
argument_list|,
name|key
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|isc_sha1_final
argument_list|(
operator|&
name|sha1ctx
argument_list|,
name|ctx
operator|->
name|key
argument_list|)
expr_stmt|;
block|}
else|else
name|memmove
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
name|key
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|isc_sha1_init
argument_list|(
operator|&
name|ctx
operator|->
name|sha1ctx
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|ipad
argument_list|,
name|IPAD
argument_list|,
sizeof|sizeof
argument_list|(
name|ipad
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISC_SHA1_BLOCK_LENGTH
condition|;
name|i
operator|++
control|)
name|ipad
index|[
name|i
index|]
operator|^=
name|ctx
operator|->
name|key
index|[
name|i
index|]
expr_stmt|;
name|isc_sha1_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha1ctx
argument_list|,
name|ipad
argument_list|,
sizeof|sizeof
argument_list|(
name|ipad
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha1_invalidate
parameter_list|(
name|isc_hmacsha1_t
modifier|*
name|ctx
parameter_list|)
block|{
name|isc_sha1_invalidate
argument_list|(
operator|&
name|ctx
operator|->
name|sha1ctx
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|ctx
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|ctx
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Update context to reflect the concatenation of another buffer full  * of bytes.  */
end_comment

begin_function
name|void
name|isc_hmacsha1_update
parameter_list|(
name|isc_hmacsha1_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|isc_sha1_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha1ctx
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Compute signature - finalize SHA1 operation and reapply SHA1.  */
end_comment

begin_function
name|void
name|isc_hmacsha1_sign
parameter_list|(
name|isc_hmacsha1_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|opad
index|[
name|ISC_SHA1_BLOCK_LENGTH
index|]
decl_stmt|;
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA1_DIGESTLENGTH
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA1_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_sha1_final
argument_list|(
operator|&
name|ctx
operator|->
name|sha1ctx
argument_list|,
name|newdigest
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|opad
argument_list|,
name|OPAD
argument_list|,
sizeof|sizeof
argument_list|(
name|opad
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISC_SHA1_BLOCK_LENGTH
condition|;
name|i
operator|++
control|)
name|opad
index|[
name|i
index|]
operator|^=
name|ctx
operator|->
name|key
index|[
name|i
index|]
expr_stmt|;
name|isc_sha1_init
argument_list|(
operator|&
name|ctx
operator|->
name|sha1ctx
argument_list|)
expr_stmt|;
name|isc_sha1_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha1ctx
argument_list|,
name|opad
argument_list|,
sizeof|sizeof
argument_list|(
name|opad
argument_list|)
argument_list|)
expr_stmt|;
name|isc_sha1_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha1ctx
argument_list|,
name|newdigest
argument_list|,
name|ISC_SHA1_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_sha1_final
argument_list|(
operator|&
name|ctx
operator|->
name|sha1ctx
argument_list|,
name|newdigest
argument_list|)
expr_stmt|;
name|isc_hmacsha1_invalidate
argument_list|(
name|ctx
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|newdigest
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|newdigest
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Start HMAC-SHA224 process.  Initialize an sha224 context and digest the key.  */
end_comment

begin_function
name|void
name|isc_hmacsha224_init
parameter_list|(
name|isc_hmacsha224_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|ipad
index|[
name|ISC_SHA224_BLOCK_LENGTH
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|memset
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ctx
operator|->
name|key
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
sizeof|sizeof
argument_list|(
name|ctx
operator|->
name|key
argument_list|)
condition|)
block|{
name|isc_sha224_t
name|sha224ctx
decl_stmt|;
name|isc_sha224_init
argument_list|(
operator|&
name|sha224ctx
argument_list|)
expr_stmt|;
name|isc_sha224_update
argument_list|(
operator|&
name|sha224ctx
argument_list|,
name|key
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|isc_sha224_final
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
operator|&
name|sha224ctx
argument_list|)
expr_stmt|;
block|}
else|else
name|memmove
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
name|key
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|isc_sha224_init
argument_list|(
operator|&
name|ctx
operator|->
name|sha224ctx
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|ipad
argument_list|,
name|IPAD
argument_list|,
sizeof|sizeof
argument_list|(
name|ipad
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISC_SHA224_BLOCK_LENGTH
condition|;
name|i
operator|++
control|)
name|ipad
index|[
name|i
index|]
operator|^=
name|ctx
operator|->
name|key
index|[
name|i
index|]
expr_stmt|;
name|isc_sha224_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha224ctx
argument_list|,
name|ipad
argument_list|,
sizeof|sizeof
argument_list|(
name|ipad
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha224_invalidate
parameter_list|(
name|isc_hmacsha224_t
modifier|*
name|ctx
parameter_list|)
block|{
name|memset
argument_list|(
name|ctx
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|ctx
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Update context to reflect the concatenation of another buffer full  * of bytes.  */
end_comment

begin_function
name|void
name|isc_hmacsha224_update
parameter_list|(
name|isc_hmacsha224_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|isc_sha224_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha224ctx
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Compute signature - finalize SHA224 operation and reapply SHA224.  */
end_comment

begin_function
name|void
name|isc_hmacsha224_sign
parameter_list|(
name|isc_hmacsha224_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|opad
index|[
name|ISC_SHA224_BLOCK_LENGTH
index|]
decl_stmt|;
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA224_DIGESTLENGTH
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA224_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_sha224_final
argument_list|(
name|newdigest
argument_list|,
operator|&
name|ctx
operator|->
name|sha224ctx
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|opad
argument_list|,
name|OPAD
argument_list|,
sizeof|sizeof
argument_list|(
name|opad
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISC_SHA224_BLOCK_LENGTH
condition|;
name|i
operator|++
control|)
name|opad
index|[
name|i
index|]
operator|^=
name|ctx
operator|->
name|key
index|[
name|i
index|]
expr_stmt|;
name|isc_sha224_init
argument_list|(
operator|&
name|ctx
operator|->
name|sha224ctx
argument_list|)
expr_stmt|;
name|isc_sha224_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha224ctx
argument_list|,
name|opad
argument_list|,
sizeof|sizeof
argument_list|(
name|opad
argument_list|)
argument_list|)
expr_stmt|;
name|isc_sha224_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha224ctx
argument_list|,
name|newdigest
argument_list|,
name|ISC_SHA224_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_sha224_final
argument_list|(
name|newdigest
argument_list|,
operator|&
name|ctx
operator|->
name|sha224ctx
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|newdigest
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|newdigest
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Start HMAC-SHA256 process.  Initialize an sha256 context and digest the key.  */
end_comment

begin_function
name|void
name|isc_hmacsha256_init
parameter_list|(
name|isc_hmacsha256_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|ipad
index|[
name|ISC_SHA256_BLOCK_LENGTH
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|memset
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ctx
operator|->
name|key
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
sizeof|sizeof
argument_list|(
name|ctx
operator|->
name|key
argument_list|)
condition|)
block|{
name|isc_sha256_t
name|sha256ctx
decl_stmt|;
name|isc_sha256_init
argument_list|(
operator|&
name|sha256ctx
argument_list|)
expr_stmt|;
name|isc_sha256_update
argument_list|(
operator|&
name|sha256ctx
argument_list|,
name|key
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|isc_sha256_final
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
operator|&
name|sha256ctx
argument_list|)
expr_stmt|;
block|}
else|else
name|memmove
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
name|key
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|isc_sha256_init
argument_list|(
operator|&
name|ctx
operator|->
name|sha256ctx
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|ipad
argument_list|,
name|IPAD
argument_list|,
sizeof|sizeof
argument_list|(
name|ipad
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISC_SHA256_BLOCK_LENGTH
condition|;
name|i
operator|++
control|)
name|ipad
index|[
name|i
index|]
operator|^=
name|ctx
operator|->
name|key
index|[
name|i
index|]
expr_stmt|;
name|isc_sha256_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha256ctx
argument_list|,
name|ipad
argument_list|,
sizeof|sizeof
argument_list|(
name|ipad
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha256_invalidate
parameter_list|(
name|isc_hmacsha256_t
modifier|*
name|ctx
parameter_list|)
block|{
name|memset
argument_list|(
name|ctx
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|ctx
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Update context to reflect the concatenation of another buffer full  * of bytes.  */
end_comment

begin_function
name|void
name|isc_hmacsha256_update
parameter_list|(
name|isc_hmacsha256_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|isc_sha256_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha256ctx
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Compute signature - finalize SHA256 operation and reapply SHA256.  */
end_comment

begin_function
name|void
name|isc_hmacsha256_sign
parameter_list|(
name|isc_hmacsha256_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|opad
index|[
name|ISC_SHA256_BLOCK_LENGTH
index|]
decl_stmt|;
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA256_DIGESTLENGTH
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA256_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_sha256_final
argument_list|(
name|newdigest
argument_list|,
operator|&
name|ctx
operator|->
name|sha256ctx
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|opad
argument_list|,
name|OPAD
argument_list|,
sizeof|sizeof
argument_list|(
name|opad
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISC_SHA256_BLOCK_LENGTH
condition|;
name|i
operator|++
control|)
name|opad
index|[
name|i
index|]
operator|^=
name|ctx
operator|->
name|key
index|[
name|i
index|]
expr_stmt|;
name|isc_sha256_init
argument_list|(
operator|&
name|ctx
operator|->
name|sha256ctx
argument_list|)
expr_stmt|;
name|isc_sha256_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha256ctx
argument_list|,
name|opad
argument_list|,
sizeof|sizeof
argument_list|(
name|opad
argument_list|)
argument_list|)
expr_stmt|;
name|isc_sha256_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha256ctx
argument_list|,
name|newdigest
argument_list|,
name|ISC_SHA256_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_sha256_final
argument_list|(
name|newdigest
argument_list|,
operator|&
name|ctx
operator|->
name|sha256ctx
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|newdigest
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|newdigest
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Start HMAC-SHA384 process.  Initialize an sha384 context and digest the key.  */
end_comment

begin_function
name|void
name|isc_hmacsha384_init
parameter_list|(
name|isc_hmacsha384_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|ipad
index|[
name|ISC_SHA384_BLOCK_LENGTH
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|memset
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ctx
operator|->
name|key
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
sizeof|sizeof
argument_list|(
name|ctx
operator|->
name|key
argument_list|)
condition|)
block|{
name|isc_sha384_t
name|sha384ctx
decl_stmt|;
name|isc_sha384_init
argument_list|(
operator|&
name|sha384ctx
argument_list|)
expr_stmt|;
name|isc_sha384_update
argument_list|(
operator|&
name|sha384ctx
argument_list|,
name|key
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|isc_sha384_final
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
operator|&
name|sha384ctx
argument_list|)
expr_stmt|;
block|}
else|else
name|memmove
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
name|key
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|isc_sha384_init
argument_list|(
operator|&
name|ctx
operator|->
name|sha384ctx
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|ipad
argument_list|,
name|IPAD
argument_list|,
sizeof|sizeof
argument_list|(
name|ipad
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISC_SHA384_BLOCK_LENGTH
condition|;
name|i
operator|++
control|)
name|ipad
index|[
name|i
index|]
operator|^=
name|ctx
operator|->
name|key
index|[
name|i
index|]
expr_stmt|;
name|isc_sha384_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha384ctx
argument_list|,
name|ipad
argument_list|,
sizeof|sizeof
argument_list|(
name|ipad
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha384_invalidate
parameter_list|(
name|isc_hmacsha384_t
modifier|*
name|ctx
parameter_list|)
block|{
name|memset
argument_list|(
name|ctx
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|ctx
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Update context to reflect the concatenation of another buffer full  * of bytes.  */
end_comment

begin_function
name|void
name|isc_hmacsha384_update
parameter_list|(
name|isc_hmacsha384_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|isc_sha384_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha384ctx
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Compute signature - finalize SHA384 operation and reapply SHA384.  */
end_comment

begin_function
name|void
name|isc_hmacsha384_sign
parameter_list|(
name|isc_hmacsha384_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|opad
index|[
name|ISC_SHA384_BLOCK_LENGTH
index|]
decl_stmt|;
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA384_DIGESTLENGTH
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA384_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_sha384_final
argument_list|(
name|newdigest
argument_list|,
operator|&
name|ctx
operator|->
name|sha384ctx
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|opad
argument_list|,
name|OPAD
argument_list|,
sizeof|sizeof
argument_list|(
name|opad
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISC_SHA384_BLOCK_LENGTH
condition|;
name|i
operator|++
control|)
name|opad
index|[
name|i
index|]
operator|^=
name|ctx
operator|->
name|key
index|[
name|i
index|]
expr_stmt|;
name|isc_sha384_init
argument_list|(
operator|&
name|ctx
operator|->
name|sha384ctx
argument_list|)
expr_stmt|;
name|isc_sha384_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha384ctx
argument_list|,
name|opad
argument_list|,
sizeof|sizeof
argument_list|(
name|opad
argument_list|)
argument_list|)
expr_stmt|;
name|isc_sha384_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha384ctx
argument_list|,
name|newdigest
argument_list|,
name|ISC_SHA384_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_sha384_final
argument_list|(
name|newdigest
argument_list|,
operator|&
name|ctx
operator|->
name|sha384ctx
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|newdigest
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|newdigest
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Start HMAC-SHA512 process.  Initialize an sha512 context and digest the key.  */
end_comment

begin_function
name|void
name|isc_hmacsha512_init
parameter_list|(
name|isc_hmacsha512_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|ipad
index|[
name|ISC_SHA512_BLOCK_LENGTH
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|memset
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ctx
operator|->
name|key
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
sizeof|sizeof
argument_list|(
name|ctx
operator|->
name|key
argument_list|)
condition|)
block|{
name|isc_sha512_t
name|sha512ctx
decl_stmt|;
name|isc_sha512_init
argument_list|(
operator|&
name|sha512ctx
argument_list|)
expr_stmt|;
name|isc_sha512_update
argument_list|(
operator|&
name|sha512ctx
argument_list|,
name|key
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|isc_sha512_final
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
operator|&
name|sha512ctx
argument_list|)
expr_stmt|;
block|}
else|else
name|memmove
argument_list|(
name|ctx
operator|->
name|key
argument_list|,
name|key
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|isc_sha512_init
argument_list|(
operator|&
name|ctx
operator|->
name|sha512ctx
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|ipad
argument_list|,
name|IPAD
argument_list|,
sizeof|sizeof
argument_list|(
name|ipad
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISC_SHA512_BLOCK_LENGTH
condition|;
name|i
operator|++
control|)
name|ipad
index|[
name|i
index|]
operator|^=
name|ctx
operator|->
name|key
index|[
name|i
index|]
expr_stmt|;
name|isc_sha512_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha512ctx
argument_list|,
name|ipad
argument_list|,
sizeof|sizeof
argument_list|(
name|ipad
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|isc_hmacsha512_invalidate
parameter_list|(
name|isc_hmacsha512_t
modifier|*
name|ctx
parameter_list|)
block|{
name|memset
argument_list|(
name|ctx
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|ctx
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Update context to reflect the concatenation of another buffer full  * of bytes.  */
end_comment

begin_function
name|void
name|isc_hmacsha512_update
parameter_list|(
name|isc_hmacsha512_t
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|isc_sha512_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha512ctx
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Compute signature - finalize SHA512 operation and reapply SHA512.  */
end_comment

begin_function
name|void
name|isc_hmacsha512_sign
parameter_list|(
name|isc_hmacsha512_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|opad
index|[
name|ISC_SHA512_BLOCK_LENGTH
index|]
decl_stmt|;
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA512_DIGESTLENGTH
index|]
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA512_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_sha512_final
argument_list|(
name|newdigest
argument_list|,
operator|&
name|ctx
operator|->
name|sha512ctx
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|opad
argument_list|,
name|OPAD
argument_list|,
sizeof|sizeof
argument_list|(
name|opad
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ISC_SHA512_BLOCK_LENGTH
condition|;
name|i
operator|++
control|)
name|opad
index|[
name|i
index|]
operator|^=
name|ctx
operator|->
name|key
index|[
name|i
index|]
expr_stmt|;
name|isc_sha512_init
argument_list|(
operator|&
name|ctx
operator|->
name|sha512ctx
argument_list|)
expr_stmt|;
name|isc_sha512_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha512ctx
argument_list|,
name|opad
argument_list|,
sizeof|sizeof
argument_list|(
name|opad
argument_list|)
argument_list|)
expr_stmt|;
name|isc_sha512_update
argument_list|(
operator|&
name|ctx
operator|->
name|sha512ctx
argument_list|,
name|newdigest
argument_list|,
name|ISC_SHA512_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_sha512_final
argument_list|(
name|newdigest
argument_list|,
operator|&
name|ctx
operator|->
name|sha512ctx
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|newdigest
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|newdigest
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* !ISC_PLATFORM_OPENSSLHASH */
end_comment

begin_comment
comment|/*  * Verify signature - finalize SHA1 operation and reapply SHA1, then  * compare to the supplied digest.  */
end_comment

begin_function
name|isc_boolean_t
name|isc_hmacsha1_verify
parameter_list|(
name|isc_hmacsha1_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA1_DIGESTLENGTH
index|]
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA1_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_hmacsha1_sign
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|ISC_SHA1_DIGESTLENGTH
argument_list|)
expr_stmt|;
return|return
operator|(
name|isc_safe_memequal
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Verify signature - finalize SHA224 operation and reapply SHA224, then  * compare to the supplied digest.  */
end_comment

begin_function
name|isc_boolean_t
name|isc_hmacsha224_verify
parameter_list|(
name|isc_hmacsha224_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA224_DIGESTLENGTH
index|]
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA224_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_hmacsha224_sign
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|ISC_SHA224_DIGESTLENGTH
argument_list|)
expr_stmt|;
return|return
operator|(
name|isc_safe_memequal
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Verify signature - finalize SHA256 operation and reapply SHA256, then  * compare to the supplied digest.  */
end_comment

begin_function
name|isc_boolean_t
name|isc_hmacsha256_verify
parameter_list|(
name|isc_hmacsha256_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA256_DIGESTLENGTH
index|]
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA256_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_hmacsha256_sign
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|ISC_SHA256_DIGESTLENGTH
argument_list|)
expr_stmt|;
return|return
operator|(
name|isc_safe_memequal
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Verify signature - finalize SHA384 operation and reapply SHA384, then  * compare to the supplied digest.  */
end_comment

begin_function
name|isc_boolean_t
name|isc_hmacsha384_verify
parameter_list|(
name|isc_hmacsha384_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA384_DIGESTLENGTH
index|]
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA384_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_hmacsha384_sign
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|ISC_SHA384_DIGESTLENGTH
argument_list|)
expr_stmt|;
return|return
operator|(
name|isc_safe_memequal
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Verify signature - finalize SHA512 operation and reapply SHA512, then  * compare to the supplied digest.  */
end_comment

begin_function
name|isc_boolean_t
name|isc_hmacsha512_verify
parameter_list|(
name|isc_hmacsha512_t
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|digest
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|unsigned
name|char
name|newdigest
index|[
name|ISC_SHA512_DIGESTLENGTH
index|]
decl_stmt|;
name|REQUIRE
argument_list|(
name|len
operator|<=
name|ISC_SHA512_DIGESTLENGTH
argument_list|)
expr_stmt|;
name|isc_hmacsha512_sign
argument_list|(
name|ctx
argument_list|,
name|newdigest
argument_list|,
name|ISC_SHA512_DIGESTLENGTH
argument_list|)
expr_stmt|;
return|return
operator|(
name|isc_safe_memequal
argument_list|(
name|digest
argument_list|,
name|newdigest
argument_list|,
name|len
argument_list|)
operator|)
return|;
block|}
end_function

end_unit

