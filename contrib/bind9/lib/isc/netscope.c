begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (C) 2004, 2006  Internet Systems Consortium, Inc. ("ISC")  * Copyright (C) 2002  Internet Software Consortium.  *  * Permission to use, copy, modify, and distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND ISC DISCLAIMS ALL WARRANTIES WITH  * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY  * AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR ANY SPECIAL, DIRECT,  * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM  * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE  * OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR  * PERFORMANCE OF THIS SOFTWARE.  */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|LIBC_SCCS
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|lint
argument_list|)
end_if

begin_decl_stmt
specifier|static
name|char
name|rcsid
index|[]
init|=
literal|"$Id: netscope.c,v 1.5.142.9 2006/08/25 05:25:50 marka Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* LIBC_SCCS and not lint */
end_comment

begin_include
include|#
directive|include
file|<config.h>
end_include

begin_include
include|#
directive|include
file|<isc/string.h>
end_include

begin_include
include|#
directive|include
file|<isc/net.h>
end_include

begin_include
include|#
directive|include
file|<isc/netscope.h>
end_include

begin_include
include|#
directive|include
file|<isc/result.h>
end_include

begin_function
name|isc_result_t
name|isc_netscope_pton
parameter_list|(
name|int
name|af
parameter_list|,
name|char
modifier|*
name|scopename
parameter_list|,
name|void
modifier|*
name|addr
parameter_list|,
name|isc_uint32_t
modifier|*
name|zoneid
parameter_list|)
block|{
name|char
modifier|*
name|ep
decl_stmt|;
ifdef|#
directive|ifdef
name|ISC_PLATFORM_HAVEIFNAMETOINDEX
name|unsigned
name|int
name|ifid
decl_stmt|;
endif|#
directive|endif
name|struct
name|in6_addr
modifier|*
name|in6
decl_stmt|;
name|isc_uint32_t
name|zone
decl_stmt|;
name|isc_uint64_t
name|llz
decl_stmt|;
comment|/* at this moment, we only support AF_INET6 */
if|if
condition|(
name|af
operator|!=
name|AF_INET6
condition|)
return|return
operator|(
name|ISC_R_FAILURE
operator|)
return|;
name|in6
operator|=
operator|(
expr|struct
name|in6_addr
operator|*
operator|)
name|addr
expr_stmt|;
comment|/* 	 * Basically, "names" are more stable than numeric IDs in terms of 	 * renumbering, and are more preferred.  However, since there is no 	 * standard naming convention and APIs to deal with the names.  Thus, 	 * we only handle the case of link-local addresses, for which we use 	 * interface names as link names, assuming one to one mapping between 	 * interfaces and links. 	 */
ifdef|#
directive|ifdef
name|ISC_PLATFORM_HAVEIFNAMETOINDEX
if|if
condition|(
name|IN6_IS_ADDR_LINKLOCAL
argument_list|(
name|in6
argument_list|)
operator|&&
operator|(
name|ifid
operator|=
name|if_nametoindex
argument_list|(
operator|(
specifier|const
name|char
operator|*
operator|)
name|scopename
argument_list|)
operator|)
operator|!=
literal|0
condition|)
name|zone
operator|=
operator|(
name|isc_uint32_t
operator|)
name|ifid
expr_stmt|;
else|else
block|{
endif|#
directive|endif
name|llz
operator|=
name|isc_string_touint64
argument_list|(
name|scopename
argument_list|,
operator|&
name|ep
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|ep
operator|==
name|scopename
condition|)
return|return
operator|(
name|ISC_R_FAILURE
operator|)
return|;
comment|/* check overflow */
name|zone
operator|=
call|(
name|isc_uint32_t
call|)
argument_list|(
name|llz
operator|&
literal|0xffffffffUL
argument_list|)
expr_stmt|;
if|if
condition|(
name|zone
operator|!=
name|llz
condition|)
return|return
operator|(
name|ISC_R_FAILURE
operator|)
return|;
ifdef|#
directive|ifdef
name|ISC_PLATFORM_HAVEIFNAMETOINDEX
block|}
endif|#
directive|endif
operator|*
name|zoneid
operator|=
name|zone
expr_stmt|;
return|return
operator|(
name|ISC_R_SUCCESS
operator|)
return|;
block|}
end_function

end_unit

