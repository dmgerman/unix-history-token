begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* basename.c -- return the last element in a path     Copyright (C) 1990, 1998, 1999, 2000, 2001, 2003 Free Software    Foundation, Inc.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2, or (at your option)    any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software Foundation,    Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_if
if|#
directive|if
name|HAVE_CONFIG_H
end_if

begin_include
include|#
directive|include
file|<config.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"dirname.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_comment
comment|/* In general, we can't use the builtin `basename' function if available,    since it has different meanings in different environments.    In some environments the builtin `basename' modifies its argument.     Return the address of the last file name component of NAME.  If    NAME has no file name components because it is all slashes, return    NAME if it is empty, the address of its last slash otherwise.  */
end_comment

begin_function
name|char
modifier|*
name|base_name
parameter_list|(
name|char
specifier|const
modifier|*
name|name
parameter_list|)
block|{
name|char
specifier|const
modifier|*
name|base
init|=
name|name
operator|+
name|FILESYSTEM_PREFIX_LEN
argument_list|(
name|name
argument_list|)
decl_stmt|;
name|char
specifier|const
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|p
operator|=
name|base
init|;
operator|*
name|p
condition|;
name|p
operator|++
control|)
block|{
if|if
condition|(
name|ISSLASH
argument_list|(
operator|*
name|p
argument_list|)
condition|)
block|{
comment|/* Treat multiple adjacent slashes like a single slash.  */
do|do
name|p
operator|++
expr_stmt|;
do|while
condition|(
name|ISSLASH
argument_list|(
operator|*
name|p
argument_list|)
condition|)
do|;
comment|/* If the file name ends in slash, use the trailing slash as 	     the basename if no non-slashes have been found.  */
if|if
condition|(
operator|!
operator|*
name|p
condition|)
block|{
if|if
condition|(
name|ISSLASH
argument_list|(
operator|*
name|base
argument_list|)
condition|)
name|base
operator|=
name|p
operator|-
literal|1
expr_stmt|;
break|break;
block|}
comment|/* *P is a non-slash preceded by a slash.  */
name|base
operator|=
name|p
expr_stmt|;
block|}
block|}
return|return
operator|(
name|char
operator|*
operator|)
name|base
return|;
block|}
end_function

begin_comment
comment|/* Return the length of of the basename NAME.  Typically NAME is the    value returned by base_name.  Act like strlen (NAME), except omit    redundant trailing slashes.  */
end_comment

begin_function
name|size_t
name|base_len
parameter_list|(
name|char
specifier|const
modifier|*
name|name
parameter_list|)
block|{
name|size_t
name|len
decl_stmt|;
for|for
control|(
name|len
operator|=
name|strlen
argument_list|(
name|name
argument_list|)
init|;
literal|1
operator|<
name|len
operator|&&
name|ISSLASH
argument_list|(
name|name
index|[
name|len
operator|-
literal|1
index|]
argument_list|)
condition|;
name|len
operator|--
control|)
continue|continue;
return|return
name|len
return|;
block|}
end_function

end_unit

