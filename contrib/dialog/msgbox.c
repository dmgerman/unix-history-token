begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  $Id: msgbox.c,v 1.74 2012/07/06 16:53:53 tom Exp $  *  *  msgbox.c -- implements the message box and info box  *  *  Copyright 2000-2011,2012	Thomas E. Dickey  *  *  This program is free software; you can redistribute it and/or modify  *  it under the terms of the GNU Lesser General Public License, version 2.1  *  as published by the Free Software Foundation.  *  *  This program is distributed in the hope that it will be useful, but  *  WITHOUT ANY WARRANTY; without even the implied warranty of  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  *  Lesser General Public License for more details.  *  *  You should have received a copy of the GNU Lesser General Public  *  License along with this program; if not, write to  *	Free Software Foundation, Inc.  *	51 Franklin St., Fifth Floor  *	Boston, MA 02110, USA.  *  *  An earlier version of this program lists as authors:  *	Savio Lam (lam836@cs.cuhk.hk)  */
end_comment

begin_include
include|#
directive|include
file|<dialog.h>
end_include

begin_include
include|#
directive|include
file|<dlg_keys.h>
end_include

begin_comment
comment|/*  * Display a message box. Program will pause and display an "OK" button  * if the parameter 'pauseopt' is non-zero.  */
end_comment

begin_function
name|int
name|dialog_msgbox
parameter_list|(
specifier|const
name|char
modifier|*
name|title
parameter_list|,
specifier|const
name|char
modifier|*
name|cprompt
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|pauseopt
parameter_list|)
block|{
comment|/* *INDENT-OFF* */
specifier|static
name|DLG_KEYS_BINDING
name|binding
index|[]
init|=
block|{
name|HELPKEY_BINDINGS
block|,
name|ENTERKEY_BINDINGS
block|,
name|TRAVERSE_BINDINGS
block|,
name|SCROLLKEY_BINDINGS
block|,
name|END_KEYS_BINDING
block|}
decl_stmt|;
comment|/* *INDENT-ON* */
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|last
init|=
literal|0
decl_stmt|,
name|page
decl_stmt|;
name|int
name|button
decl_stmt|;
name|int
name|key
init|=
literal|0
decl_stmt|,
name|fkey
decl_stmt|;
name|int
name|result
init|=
name|DLG_EXIT_UNKNOWN
decl_stmt|;
name|WINDOW
modifier|*
name|dialog
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|prompt
init|=
name|dlg_strclone
argument_list|(
name|cprompt
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
modifier|*
name|buttons
init|=
name|dlg_ok_label
argument_list|()
decl_stmt|;
name|int
name|offset
init|=
literal|0
decl_stmt|;
name|int
name|check
decl_stmt|;
name|bool
name|show
init|=
name|TRUE
decl_stmt|;
name|int
name|min_width
init|=
operator|(
name|pauseopt
operator|==
literal|1
condition|?
literal|12
else|:
literal|0
operator|)
decl_stmt|;
name|int
name|save_nocancel
init|=
name|dialog_vars
operator|.
name|nocancel
decl_stmt|;
ifdef|#
directive|ifdef
name|KEY_RESIZE
name|int
name|req_high
decl_stmt|;
name|int
name|req_wide
decl_stmt|;
endif|#
directive|endif
name|dialog_vars
operator|.
name|nocancel
operator|=
name|TRUE
expr_stmt|;
name|button
operator|=
name|dlg_default_button
argument_list|()
expr_stmt|;
ifdef|#
directive|ifdef
name|KEY_RESIZE
name|req_high
operator|=
name|height
expr_stmt|;
name|req_wide
operator|=
name|width
expr_stmt|;
name|restart
label|:
endif|#
directive|endif
name|dlg_button_layout
argument_list|(
name|buttons
argument_list|,
operator|&
name|min_width
argument_list|)
expr_stmt|;
name|dlg_tab_correct_str
argument_list|(
name|prompt
argument_list|)
expr_stmt|;
name|dlg_auto_size
argument_list|(
name|title
argument_list|,
name|prompt
argument_list|,
operator|&
name|height
argument_list|,
operator|&
name|width
argument_list|,
operator|(
name|pauseopt
operator|==
literal|1
condition|?
literal|2
else|:
literal|0
operator|)
argument_list|,
name|min_width
argument_list|)
expr_stmt|;
name|dlg_print_size
argument_list|(
name|height
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|dlg_ctl_size
argument_list|(
name|height
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|x
operator|=
name|dlg_box_x_ordinate
argument_list|(
name|width
argument_list|)
expr_stmt|;
name|y
operator|=
name|dlg_box_y_ordinate
argument_list|(
name|height
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|KEY_RESIZE
if|if
condition|(
name|dialog
operator|!=
literal|0
condition|)
name|dlg_move_window
argument_list|(
name|dialog
argument_list|,
name|height
argument_list|,
name|width
argument_list|,
name|y
argument_list|,
name|x
argument_list|)
expr_stmt|;
else|else
endif|#
directive|endif
block|{
name|dialog
operator|=
name|dlg_new_window
argument_list|(
name|height
argument_list|,
name|width
argument_list|,
name|y
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|dlg_register_window
argument_list|(
name|dialog
argument_list|,
literal|"msgbox"
argument_list|,
name|binding
argument_list|)
expr_stmt|;
name|dlg_register_buttons
argument_list|(
name|dialog
argument_list|,
literal|"msgbox"
argument_list|,
name|buttons
argument_list|)
expr_stmt|;
block|}
name|page
operator|=
name|height
operator|-
operator|(
literal|1
operator|+
literal|3
operator|*
name|MARGIN
operator|)
expr_stmt|;
name|dlg_mouse_setbase
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|dlg_draw_box2
argument_list|(
name|dialog
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|height
argument_list|,
name|width
argument_list|,
name|dialog_attr
argument_list|,
name|border_attr
argument_list|,
name|border2_attr
argument_list|)
expr_stmt|;
name|dlg_draw_title
argument_list|(
name|dialog
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|dialog
argument_list|,
name|dialog_attr
argument_list|)
expr_stmt|;
if|if
condition|(
name|pauseopt
condition|)
block|{
name|dlg_draw_bottom_box2
argument_list|(
name|dialog
argument_list|,
name|border_attr
argument_list|,
name|border2_attr
argument_list|,
name|dialog_attr
argument_list|)
expr_stmt|;
name|mouse_mkbutton
argument_list|(
name|height
operator|-
literal|2
argument_list|,
name|width
operator|/
literal|2
operator|-
literal|4
argument_list|,
literal|6
argument_list|,
literal|'\n'
argument_list|)
expr_stmt|;
name|dlg_draw_buttons
argument_list|(
name|dialog
argument_list|,
name|height
operator|-
literal|2
argument_list|,
literal|0
argument_list|,
name|buttons
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|dlg_draw_helpline
argument_list|(
name|dialog
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
while|while
condition|(
name|result
operator|==
name|DLG_EXIT_UNKNOWN
condition|)
block|{
if|if
condition|(
name|show
condition|)
block|{
name|last
operator|=
name|dlg_print_scrolled
argument_list|(
name|dialog
argument_list|,
name|prompt
argument_list|,
name|offset
argument_list|,
name|page
argument_list|,
name|width
argument_list|,
name|pauseopt
argument_list|)
expr_stmt|;
name|dlg_trace_win
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|show
operator|=
name|FALSE
expr_stmt|;
block|}
name|key
operator|=
name|dlg_mouse_wgetch
argument_list|(
name|dialog
argument_list|,
operator|&
name|fkey
argument_list|)
expr_stmt|;
if|if
condition|(
name|dlg_result_key
argument_list|(
name|key
argument_list|,
name|fkey
argument_list|,
operator|&
name|result
argument_list|)
condition|)
break|break;
if|if
condition|(
operator|!
name|fkey
operator|&&
operator|(
name|check
operator|=
name|dlg_char_to_button
argument_list|(
name|key
argument_list|,
name|buttons
argument_list|)
operator|)
operator|>=
literal|0
condition|)
block|{
name|result
operator|=
name|dlg_ok_buttoncode
argument_list|(
name|check
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|fkey
condition|)
block|{
switch|switch
condition|(
name|key
condition|)
block|{
ifdef|#
directive|ifdef
name|KEY_RESIZE
case|case
name|KEY_RESIZE
case|:
name|dlg_clear
argument_list|()
expr_stmt|;
name|height
operator|=
name|req_high
expr_stmt|;
name|width
operator|=
name|req_wide
expr_stmt|;
name|show
operator|=
name|TRUE
expr_stmt|;
goto|goto
name|restart
goto|;
endif|#
directive|endif
case|case
name|DLGK_FIELD_NEXT
case|:
name|button
operator|=
name|dlg_next_button
argument_list|(
name|buttons
argument_list|,
name|button
argument_list|)
expr_stmt|;
if|if
condition|(
name|button
operator|<
literal|0
condition|)
name|button
operator|=
literal|0
expr_stmt|;
name|dlg_draw_buttons
argument_list|(
name|dialog
argument_list|,
name|height
operator|-
literal|2
argument_list|,
literal|0
argument_list|,
name|buttons
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|width
argument_list|)
expr_stmt|;
break|break;
case|case
name|DLGK_FIELD_PREV
case|:
name|button
operator|=
name|dlg_prev_button
argument_list|(
name|buttons
argument_list|,
name|button
argument_list|)
expr_stmt|;
if|if
condition|(
name|button
operator|<
literal|0
condition|)
name|button
operator|=
literal|0
expr_stmt|;
name|dlg_draw_buttons
argument_list|(
name|dialog
argument_list|,
name|height
operator|-
literal|2
argument_list|,
literal|0
argument_list|,
name|buttons
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|width
argument_list|)
expr_stmt|;
break|break;
case|case
name|DLGK_ENTER
case|:
name|result
operator|=
name|dlg_ok_buttoncode
argument_list|(
name|button
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|is_DLGK_MOUSE
argument_list|(
name|key
argument_list|)
condition|)
block|{
name|result
operator|=
name|dlg_ok_buttoncode
argument_list|(
name|key
operator|-
name|M_EVENT
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|<
literal|0
condition|)
name|result
operator|=
name|DLG_EXIT_OK
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|dlg_check_scrolled
argument_list|(
name|key
argument_list|,
name|last
argument_list|,
name|page
argument_list|,
operator|&
name|show
argument_list|,
operator|&
name|offset
argument_list|)
operator|==
literal|0
condition|)
block|{ 		    }
else|else
block|{
name|beep
argument_list|()
expr_stmt|;
block|}
break|break;
block|}
block|}
else|else
block|{
name|beep
argument_list|()
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|dlg_print_scrolled
argument_list|(
name|dialog
argument_list|,
name|prompt
argument_list|,
name|offset
argument_list|,
name|page
argument_list|,
name|width
argument_list|,
name|pauseopt
argument_list|)
expr_stmt|;
name|dlg_draw_helpline
argument_list|(
name|dialog
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|dlg_trace_win
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|result
operator|=
name|DLG_EXIT_OK
expr_stmt|;
block|}
name|dlg_del_window
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|dlg_mouse_free_regions
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|prompt
argument_list|)
expr_stmt|;
name|dialog_vars
operator|.
name|nocancel
operator|=
name|save_nocancel
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

end_unit

