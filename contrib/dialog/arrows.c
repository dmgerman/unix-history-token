begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  $Id: arrows.c,v 1.33 2011/01/19 00:27:53 tom Exp $  *  *  arrows.c -- draw arrows to indicate end-of-range for lists  *  *  Copyright 2000-2010,2011	Thomas E. Dickey  *  *  This program is free software; you can redistribute it and/or modify  *  it under the terms of the GNU Lesser General Public License, version 2.1  *  as published by the Free Software Foundation.  *  *  This program is distributed in the hope that it will be useful, but  *  WITHOUT ANY WARRANTY; without even the implied warranty of  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  *  Lesser General Public License for more details.  *  *  You should have received a copy of the GNU Lesser General Public  *  License along with this program; if not, write to  *	Free Software Foundation, Inc.  *	51 Franklin St., Fifth Floor  *	Boston, MA 02110, USA.  */
end_comment

begin_include
include|#
directive|include
file|<dialog.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|USE_WIDE_CURSES
end_ifdef

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CURSES_WACS_ARRAY
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|CURSES_WACS_SYMBOLS
argument_list|)
end_if

begin_comment
comment|/* workaround for NetBSD 5.1 curses */
end_comment

begin_undef
undef|#
directive|undef
name|WACS_DARROW
end_undef

begin_undef
undef|#
directive|undef
name|WACS_UARROW
end_undef

begin_define
define|#
directive|define
name|WACS_DARROW
value|&(CURSES_WACS_ARRAY['.'])
end_define

begin_define
define|#
directive|define
name|WACS_UARROW
value|&(CURSES_WACS_ARRAY['-'])
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|add_acs
parameter_list|(
name|win
parameter_list|,
name|code
parameter_list|)
value|wadd_wch(win, W ## code)
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|add_acs
parameter_list|(
name|win
parameter_list|,
name|code
parameter_list|)
value|waddch(win, dlg_boxchar(code))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_COLOR
end_ifdef

begin_function
specifier|static
name|chtype
name|merge_colors
parameter_list|(
name|chtype
name|foreground
parameter_list|,
name|chtype
name|background
parameter_list|)
block|{
name|chtype
name|result
init|=
name|foreground
decl_stmt|;
if|if
condition|(
operator|(
name|foreground
operator|&
name|A_COLOR
operator|)
operator|!=
operator|(
name|background
operator|&
name|A_COLOR
operator|)
condition|)
block|{
name|short
name|fg_f
decl_stmt|,
name|bg_f
decl_stmt|;
name|short
name|fg_b
decl_stmt|,
name|bg_b
decl_stmt|;
name|short
name|fg_pair
init|=
operator|(
name|short
operator|)
name|PAIR_NUMBER
argument_list|(
name|foreground
argument_list|)
decl_stmt|;
name|short
name|bg_pair
init|=
operator|(
name|short
operator|)
name|PAIR_NUMBER
argument_list|(
name|background
argument_list|)
decl_stmt|;
if|if
condition|(
name|pair_content
argument_list|(
name|fg_pair
argument_list|,
operator|&
name|fg_f
argument_list|,
operator|&
name|bg_f
argument_list|)
operator|!=
name|ERR
operator|&&
name|pair_content
argument_list|(
name|bg_pair
argument_list|,
operator|&
name|fg_b
argument_list|,
operator|&
name|bg_b
argument_list|)
operator|!=
name|ERR
condition|)
block|{
name|result
operator|&=
operator|~
name|A_COLOR
expr_stmt|;
name|result
operator||=
name|dlg_color_pair
argument_list|(
name|fg_f
argument_list|,
name|bg_b
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|result
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|merge_colors
parameter_list|(
name|f
parameter_list|,
name|b
parameter_list|)
value|(f)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|dlg_draw_arrows2
parameter_list|(
name|WINDOW
modifier|*
name|win
parameter_list|,
name|int
name|top_arrow
parameter_list|,
name|int
name|bottom_arrow
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|top
parameter_list|,
name|int
name|bottom
parameter_list|,
name|chtype
name|attr
parameter_list|,
name|chtype
name|borderattr
parameter_list|)
block|{
name|chtype
name|save
init|=
name|dlg_get_attrs
argument_list|(
name|win
argument_list|)
decl_stmt|;
name|int
name|cur_x
decl_stmt|,
name|cur_y
decl_stmt|;
name|int
name|limit_x
init|=
name|getmaxx
argument_list|(
name|win
argument_list|)
decl_stmt|;
name|bool
name|draw_top
init|=
name|TRUE
decl_stmt|;
name|getyx
argument_list|(
name|win
argument_list|,
name|cur_y
argument_list|,
name|cur_x
argument_list|)
expr_stmt|;
comment|/*      * If we're drawing a centered title, do not overwrite with the arrows.      */
if|if
condition|(
name|dialog_vars
operator|.
name|title
condition|)
block|{
name|int
name|have
init|=
operator|(
name|limit_x
operator|-
name|dlg_count_columns
argument_list|(
name|dialog_vars
operator|.
name|title
argument_list|)
operator|)
operator|/
literal|2
decl_stmt|;
name|int
name|need
init|=
name|x
operator|+
literal|5
decl_stmt|;
if|if
condition|(
name|need
operator|>
name|have
condition|)
name|draw_top
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|draw_top
condition|)
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|win
argument_list|,
name|top
argument_list|,
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|top_arrow
condition|)
block|{
name|wattrset
argument_list|(
name|win
argument_list|,
name|merge_colors
argument_list|(
name|uarrow_attr
argument_list|,
name|attr
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|add_acs
argument_list|(
name|win
argument_list|,
name|ACS_UARROW
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|win
argument_list|,
literal|"(-)"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|wattrset
argument_list|(
name|win
argument_list|,
name|attr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|whline
argument_list|(
name|win
argument_list|,
name|dlg_boxchar
argument_list|(
name|ACS_HLINE
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
block|}
block|}
name|mouse_mkbutton
argument_list|(
name|top
argument_list|,
name|x
operator|-
literal|1
argument_list|,
literal|6
argument_list|,
name|KEY_PPAGE
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|win
argument_list|,
name|bottom
argument_list|,
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|bottom_arrow
condition|)
block|{
name|wattrset
argument_list|(
name|win
argument_list|,
name|merge_colors
argument_list|(
name|darrow_attr
argument_list|,
name|attr
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|add_acs
argument_list|(
name|win
argument_list|,
name|ACS_DARROW
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|win
argument_list|,
literal|"(+)"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|wattrset
argument_list|(
name|win
argument_list|,
name|borderattr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|whline
argument_list|(
name|win
argument_list|,
name|dlg_boxchar
argument_list|(
name|ACS_HLINE
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
block|}
name|mouse_mkbutton
argument_list|(
name|bottom
argument_list|,
name|x
operator|-
literal|1
argument_list|,
literal|6
argument_list|,
name|KEY_NPAGE
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|win
argument_list|,
name|cur_y
argument_list|,
name|cur_x
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|win
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|win
argument_list|,
name|save
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|dlg_draw_scrollbar
parameter_list|(
name|WINDOW
modifier|*
name|win
parameter_list|,
name|long
name|first_data
parameter_list|,
name|long
name|this_data
parameter_list|,
name|long
name|next_data
parameter_list|,
name|long
name|total_data
parameter_list|,
name|int
name|left
parameter_list|,
name|int
name|right
parameter_list|,
name|int
name|top
parameter_list|,
name|int
name|bottom
parameter_list|,
name|chtype
name|attr
parameter_list|,
name|chtype
name|borderattr
parameter_list|)
block|{
name|char
name|buffer
index|[
literal|80
index|]
decl_stmt|;
name|int
name|percent
decl_stmt|;
name|int
name|len
decl_stmt|;
name|int
name|oldy
decl_stmt|,
name|oldx
decl_stmt|,
name|maxy
decl_stmt|,
name|maxx
decl_stmt|;
name|chtype
name|save
init|=
name|dlg_get_attrs
argument_list|(
name|win
argument_list|)
decl_stmt|;
name|int
name|top_arrow
init|=
operator|(
name|first_data
operator|!=
literal|0
operator|)
decl_stmt|;
name|int
name|bottom_arrow
init|=
operator|(
name|next_data
operator|<
name|total_data
operator|)
decl_stmt|;
name|getyx
argument_list|(
name|win
argument_list|,
name|oldy
argument_list|,
name|oldx
argument_list|)
expr_stmt|;
name|getmaxyx
argument_list|(
name|win
argument_list|,
name|maxy
argument_list|,
name|maxx
argument_list|)
expr_stmt|;
if|if
condition|(
name|bottom_arrow
operator|||
name|top_arrow
operator|||
name|dialog_state
operator|.
name|use_scrollbar
condition|)
block|{
name|percent
operator|=
operator|(
operator|!
name|total_data
condition|?
literal|100
else|:
call|(
name|int
call|)
argument_list|(
operator|(
name|next_data
operator|*
literal|100
operator|)
operator|/
name|total_data
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|percent
operator|<
literal|0
condition|)
name|percent
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|percent
operator|>
literal|100
condition|)
name|percent
operator|=
literal|100
expr_stmt|;
name|wattrset
argument_list|(
name|win
argument_list|,
name|position_indicator_attr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%d%%"
argument_list|,
name|percent
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|win
argument_list|,
name|bottom
argument_list|,
name|right
operator|-
literal|7
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|win
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|len
operator|=
name|dlg_count_columns
argument_list|(
name|buffer
argument_list|)
operator|)
operator|<
literal|4
condition|)
block|{
name|wattrset
argument_list|(
name|win
argument_list|,
name|border_attr
argument_list|)
expr_stmt|;
name|whline
argument_list|(
name|win
argument_list|,
name|dlg_boxchar
argument_list|(
name|ACS_HLINE
argument_list|)
argument_list|,
literal|4
operator|-
name|len
argument_list|)
expr_stmt|;
block|}
block|}
define|#
directive|define
name|BARSIZE
parameter_list|(
name|num
parameter_list|)
value|(int) (((all_high * (num)) + all_high - 1) / total_data)
if|if
condition|(
name|dialog_state
operator|.
name|use_scrollbar
condition|)
block|{
name|int
name|all_high
init|=
operator|(
name|bottom
operator|-
name|top
operator|-
literal|1
operator|)
decl_stmt|;
if|if
condition|(
name|total_data
operator|>
literal|0
operator|&&
name|all_high
operator|>
literal|0
condition|)
block|{
name|int
name|bar_high
decl_stmt|;
name|int
name|bar_y
decl_stmt|;
name|bar_high
operator|=
name|BARSIZE
argument_list|(
name|next_data
operator|-
name|this_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|bar_high
operator|<=
literal|0
condition|)
name|bar_high
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|bar_high
operator|<
name|all_high
condition|)
block|{
name|wmove
argument_list|(
name|win
argument_list|,
name|top
operator|+
literal|1
argument_list|,
name|right
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|win
argument_list|,
name|save
argument_list|)
expr_stmt|;
name|wvline
argument_list|(
name|win
argument_list|,
name|ACS_VLINE
operator||
name|A_REVERSE
argument_list|,
name|all_high
argument_list|)
expr_stmt|;
name|bar_y
operator|=
name|BARSIZE
argument_list|(
name|this_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|bar_y
operator|>
name|all_high
operator|-
name|bar_high
condition|)
name|bar_y
operator|=
name|all_high
operator|-
name|bar_high
expr_stmt|;
name|wmove
argument_list|(
name|win
argument_list|,
name|top
operator|+
literal|1
operator|+
name|bar_y
argument_list|,
name|right
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|win
argument_list|,
name|position_indicator_attr
argument_list|)
expr_stmt|;
name|wattron
argument_list|(
name|win
argument_list|,
name|A_REVERSE
argument_list|)
expr_stmt|;
name|wvline
argument_list|(
name|win
argument_list|,
name|ACS_BLOCK
argument_list|,
name|bar_high
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|dlg_draw_arrows2
argument_list|(
name|win
argument_list|,
name|top_arrow
argument_list|,
name|bottom_arrow
argument_list|,
name|left
operator|+
name|ARROWS_COL
argument_list|,
name|top
argument_list|,
name|bottom
argument_list|,
name|attr
argument_list|,
name|borderattr
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|win
argument_list|,
name|save
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|win
argument_list|,
name|oldy
argument_list|,
name|oldx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|dlg_draw_arrows
parameter_list|(
name|WINDOW
modifier|*
name|win
parameter_list|,
name|int
name|top_arrow
parameter_list|,
name|int
name|bottom_arrow
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|top
parameter_list|,
name|int
name|bottom
parameter_list|)
block|{
name|dlg_draw_arrows2
argument_list|(
name|win
argument_list|,
name|top_arrow
argument_list|,
name|bottom_arrow
argument_list|,
name|x
argument_list|,
name|top
argument_list|,
name|bottom
argument_list|,
name|menubox_attr
argument_list|,
name|menubox_border_attr
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

