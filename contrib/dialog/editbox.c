begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  $Id: editbox.c,v 1.61 2012/07/01 18:13:32 Zoltan.Kelemen Exp $  *  *  editbox.c -- implements the edit box  *  *  Copyright 2007-2011,2012 Thomas E. Dickey  *  *  This program is free software; you can redistribute it and/or modify  *  it under the terms of the GNU Lesser General Public License, version 2.1  *  *  This program is distributed in the hope that it will be useful, but  *  WITHOUT ANY WARRANTY; without even the implied warranty of  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  *  Lesser General Public License for more details.  *  *  You should have received a copy of the GNU Lesser General Public  *  License along with this program; if not, write to  *	Free Software Foundation, Inc.  *	51 Franklin St., Fifth Floor  *	Boston, MA 02110, USA.  */
end_comment

begin_include
include|#
directive|include
file|<dialog.h>
end_include

begin_include
include|#
directive|include
file|<dlg_keys.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_define
define|#
directive|define
name|sTEXT
value|-1
end_define

begin_function
specifier|static
name|void
name|fail_list
parameter_list|(
name|void
parameter_list|)
block|{
name|dlg_exiterr
argument_list|(
literal|"File too large"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|grow_list
parameter_list|(
name|char
modifier|*
modifier|*
modifier|*
name|list
parameter_list|,
name|int
modifier|*
name|have
parameter_list|,
name|int
name|want
parameter_list|)
block|{
if|if
condition|(
name|want
operator|>
operator|*
name|have
condition|)
block|{
name|size_t
name|last
init|=
operator|(
name|size_t
operator|)
operator|*
name|have
decl_stmt|;
name|size_t
name|need
init|=
call|(
name|size_t
call|)
argument_list|(
name|want
operator||
literal|31
argument_list|)
operator|+
literal|3
decl_stmt|;
operator|*
name|have
operator|=
operator|(
name|int
operator|)
name|need
expr_stmt|;
operator|(
operator|*
name|list
operator|)
operator|=
name|dlg_realloc
argument_list|(
name|char
operator|*
argument_list|,
name|need
argument_list|,
operator|*
name|list
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|list
operator|)
operator|==
literal|0
condition|)
block|{
name|fail_list
argument_list|()
expr_stmt|;
block|}
else|else
block|{
while|while
condition|(
operator|++
name|last
operator|<
name|need
condition|)
block|{
operator|(
operator|*
name|list
operator|)
index|[
name|last
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|load_list
parameter_list|(
specifier|const
name|char
modifier|*
name|file
parameter_list|,
name|char
modifier|*
modifier|*
modifier|*
name|list
parameter_list|,
name|int
modifier|*
name|rows
parameter_list|)
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
name|char
modifier|*
name|blob
init|=
literal|0
decl_stmt|;
name|struct
name|stat
name|sb
decl_stmt|;
name|unsigned
name|n
decl_stmt|,
name|pass
decl_stmt|;
name|unsigned
name|need
decl_stmt|;
name|size_t
name|size
decl_stmt|;
operator|*
name|list
operator|=
literal|0
expr_stmt|;
operator|*
name|rows
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|stat
argument_list|(
name|file
argument_list|,
operator|&
name|sb
argument_list|)
operator|<
literal|0
operator|||
operator|(
name|sb
operator|.
name|st_mode
operator|&
name|S_IFMT
operator|)
operator|!=
name|S_IFREG
condition|)
name|dlg_exiterr
argument_list|(
literal|"Not a file: %s"
argument_list|,
name|file
argument_list|)
expr_stmt|;
name|size
operator|=
operator|(
name|size_t
operator|)
name|sb
operator|.
name|st_size
expr_stmt|;
if|if
condition|(
operator|(
name|blob
operator|=
name|dlg_malloc
argument_list|(
name|char
argument_list|,
name|size
operator|+
literal|1
argument_list|)
operator|)
operator|==
literal|0
condition|)
block|{
name|fail_list
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|blob
index|[
name|size
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
operator|(
name|fp
operator|=
name|fopen
argument_list|(
name|file
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|==
literal|0
condition|)
name|dlg_exiterr
argument_list|(
literal|"Cannot open: %s"
argument_list|,
name|file
argument_list|)
expr_stmt|;
name|size
operator|=
name|fread
argument_list|(
name|blob
argument_list|,
sizeof|sizeof
argument_list|(
name|char
argument_list|)
argument_list|,
name|size
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
for|for
control|(
name|pass
operator|=
literal|0
init|;
name|pass
operator|<
literal|2
condition|;
operator|++
name|pass
control|)
block|{
name|int
name|first
init|=
name|TRUE
decl_stmt|;
name|need
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|size
condition|;
operator|++
name|n
control|)
block|{
if|if
condition|(
name|first
operator|&&
name|pass
condition|)
block|{
operator|(
operator|*
name|list
operator|)
index|[
name|need
index|]
operator|=
name|blob
operator|+
name|n
expr_stmt|;
name|first
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|blob
index|[
name|n
index|]
operator|==
literal|'\n'
condition|)
block|{
name|first
operator|=
name|TRUE
expr_stmt|;
operator|++
name|need
expr_stmt|;
if|if
condition|(
name|pass
condition|)
name|blob
index|[
name|n
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
block|}
if|if
condition|(
name|pass
condition|)
block|{
if|if
condition|(
name|need
operator|==
literal|0
condition|)
block|{
operator|(
operator|*
name|list
operator|)
index|[
literal|0
index|]
operator|=
name|dlg_strclone
argument_list|(
literal|""
argument_list|)
expr_stmt|;
operator|(
operator|*
name|list
operator|)
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|need
condition|;
operator|++
name|n
control|)
block|{
operator|(
operator|*
name|list
operator|)
index|[
name|n
index|]
operator|=
name|dlg_strclone
argument_list|(
operator|(
operator|*
name|list
operator|)
index|[
name|n
index|]
argument_list|)
expr_stmt|;
block|}
operator|(
operator|*
name|list
operator|)
index|[
name|need
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
else|else
block|{
name|grow_list
argument_list|(
name|list
argument_list|,
name|rows
argument_list|,
operator|(
name|int
operator|)
name|need
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
name|free
argument_list|(
name|blob
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|free_list
parameter_list|(
name|char
modifier|*
modifier|*
modifier|*
name|list
parameter_list|,
name|int
modifier|*
name|rows
parameter_list|)
block|{
if|if
condition|(
operator|*
name|list
operator|!=
literal|0
condition|)
block|{
name|int
name|n
decl_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
operator|(
operator|*
name|rows
operator|)
condition|;
operator|++
name|n
control|)
block|{
if|if
condition|(
operator|(
operator|*
name|list
operator|)
index|[
name|n
index|]
operator|!=
literal|0
condition|)
name|free
argument_list|(
operator|(
operator|*
name|list
operator|)
index|[
name|n
index|]
argument_list|)
expr_stmt|;
block|}
name|free
argument_list|(
operator|*
name|list
argument_list|)
expr_stmt|;
operator|*
name|list
operator|=
literal|0
expr_stmt|;
block|}
operator|*
name|rows
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Display a single row in the editing window:  * thisrow is the actual row number that's being displayed.  * show_row is the row number that's highlighted for edit.  * base_row is the first row number in the window  */
end_comment

begin_function
specifier|static
name|bool
name|display_one
parameter_list|(
name|WINDOW
modifier|*
name|win
parameter_list|,
name|char
modifier|*
name|text
parameter_list|,
name|int
name|thisrow
parameter_list|,
name|int
name|show_row
parameter_list|,
name|int
name|base_row
parameter_list|,
name|int
name|chr_offset
parameter_list|)
block|{
name|bool
name|result
decl_stmt|;
if|if
condition|(
name|text
operator|!=
literal|0
condition|)
block|{
name|dlg_show_string
argument_list|(
name|win
argument_list|,
name|text
argument_list|,
name|chr_offset
argument_list|,
operator|(
operator|(
name|thisrow
operator|==
name|show_row
operator|)
condition|?
name|form_active_text_attr
else|:
name|form_text_attr
operator|)
argument_list|,
name|thisrow
operator|-
name|base_row
argument_list|,
literal|0
argument_list|,
name|getmaxx
argument_list|(
name|win
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|result
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|result
operator|=
name|FALSE
expr_stmt|;
block|}
return|return
name|result
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|display_all
parameter_list|(
name|WINDOW
modifier|*
name|win
parameter_list|,
name|char
modifier|*
modifier|*
name|list
parameter_list|,
name|int
name|show_row
parameter_list|,
name|int
name|firstrow
parameter_list|,
name|int
name|lastrow
parameter_list|,
name|int
name|chr_offset
parameter_list|)
block|{
name|int
name|limit
init|=
name|getmaxy
argument_list|(
name|win
argument_list|)
decl_stmt|;
name|int
name|row
decl_stmt|;
name|dlg_attr_clear
argument_list|(
name|win
argument_list|,
name|getmaxy
argument_list|(
name|win
argument_list|)
argument_list|,
name|getmaxx
argument_list|(
name|win
argument_list|)
argument_list|,
name|dialog_attr
argument_list|)
expr_stmt|;
if|if
condition|(
name|lastrow
operator|-
name|firstrow
operator|>=
name|limit
condition|)
name|lastrow
operator|=
name|firstrow
operator|+
name|limit
expr_stmt|;
for|for
control|(
name|row
operator|=
name|firstrow
init|;
name|row
operator|<
name|lastrow
condition|;
operator|++
name|row
control|)
block|{
if|if
condition|(
operator|!
name|display_one
argument_list|(
name|win
argument_list|,
name|list
index|[
name|row
index|]
argument_list|,
name|row
argument_list|,
name|show_row
argument_list|,
name|firstrow
argument_list|,
operator|(
name|row
operator|==
name|show_row
operator|)
condition|?
name|chr_offset
else|:
literal|0
argument_list|)
condition|)
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|size_list
parameter_list|(
name|char
modifier|*
modifier|*
name|list
parameter_list|)
block|{
name|int
name|result
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|list
operator|!=
literal|0
condition|)
block|{
while|while
condition|(
operator|*
name|list
operator|++
operator|!=
literal|0
condition|)
block|{
operator|++
name|result
expr_stmt|;
block|}
block|}
return|return
name|result
return|;
block|}
end_function

begin_function
specifier|static
name|bool
name|scroll_to
parameter_list|(
name|int
name|pagesize
parameter_list|,
name|int
name|rows
parameter_list|,
name|int
modifier|*
name|base_row
parameter_list|,
name|int
modifier|*
name|this_row
parameter_list|,
name|int
name|target
parameter_list|)
block|{
name|bool
name|result
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
name|target
operator|<
operator|*
name|base_row
condition|)
block|{
if|if
condition|(
name|target
operator|<
literal|0
condition|)
block|{
if|if
condition|(
operator|*
name|base_row
operator|==
literal|0
operator|&&
operator|*
name|this_row
operator|==
literal|0
condition|)
block|{
name|beep
argument_list|()
expr_stmt|;
block|}
else|else
block|{
operator|*
name|this_row
operator|=
literal|0
expr_stmt|;
operator|*
name|base_row
operator|=
literal|0
expr_stmt|;
name|result
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
else|else
block|{
operator|*
name|this_row
operator|=
name|target
expr_stmt|;
operator|*
name|base_row
operator|=
name|target
expr_stmt|;
name|result
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|target
operator|>=
name|rows
condition|)
block|{
if|if
condition|(
operator|*
name|this_row
operator|<
name|rows
operator|-
literal|1
condition|)
block|{
operator|*
name|this_row
operator|=
name|rows
operator|-
literal|1
expr_stmt|;
operator|*
name|base_row
operator|=
name|rows
operator|-
literal|1
expr_stmt|;
name|result
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|beep
argument_list|()
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|target
operator|>=
operator|*
name|base_row
operator|+
name|pagesize
condition|)
block|{
operator|*
name|this_row
operator|=
name|target
expr_stmt|;
operator|*
name|base_row
operator|=
name|target
expr_stmt|;
name|result
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
operator|*
name|this_row
operator|=
name|target
expr_stmt|;
name|result
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|pagesize
operator|<
name|rows
condition|)
block|{
if|if
condition|(
operator|*
name|base_row
operator|+
name|pagesize
operator|>=
name|rows
condition|)
block|{
operator|*
name|base_row
operator|=
name|rows
operator|-
name|pagesize
expr_stmt|;
block|}
block|}
else|else
block|{
operator|*
name|base_row
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|result
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|col_to_chr_offset
parameter_list|(
specifier|const
name|char
modifier|*
name|text
parameter_list|,
name|int
name|col
parameter_list|)
block|{
specifier|const
name|int
modifier|*
name|cols
init|=
name|dlg_index_columns
argument_list|(
name|text
argument_list|)
decl_stmt|;
specifier|const
name|int
modifier|*
name|indx
init|=
name|dlg_index_wchars
argument_list|(
name|text
argument_list|)
decl_stmt|;
name|bool
name|found
init|=
name|FALSE
decl_stmt|;
name|int
name|result
init|=
literal|0
decl_stmt|;
name|unsigned
name|n
decl_stmt|;
name|unsigned
name|len
init|=
operator|(
name|unsigned
operator|)
name|dlg_count_wchars
argument_list|(
name|text
argument_list|)
decl_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|len
condition|;
operator|++
name|n
control|)
block|{
if|if
condition|(
name|cols
index|[
name|n
index|]
operator|<=
name|col
operator|&&
name|cols
index|[
name|n
operator|+
literal|1
index|]
operator|>
name|col
condition|)
block|{
name|result
operator|=
name|indx
index|[
name|n
index|]
expr_stmt|;
name|found
operator|=
name|TRUE
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|found
operator|&&
name|len
operator|&&
name|cols
index|[
name|len
index|]
operator|==
name|col
condition|)
block|{
name|result
operator|=
name|indx
index|[
name|len
index|]
expr_stmt|;
block|}
return|return
name|result
return|;
block|}
end_function

begin_define
define|#
directive|define
name|SCROLL_TO
parameter_list|(
name|target
parameter_list|)
value|show_all = scroll_to(pagesize, listsize,&base_row,&thisrow, target)
end_define

begin_define
define|#
directive|define
name|PREV_ROW
value|(*list)[thisrow - 1]
end_define

begin_define
define|#
directive|define
name|THIS_ROW
value|(*list)[thisrow]
end_define

begin_define
define|#
directive|define
name|NEXT_ROW
value|(*list)[thisrow + 1]
end_define

begin_define
define|#
directive|define
name|UPDATE_COL
parameter_list|(
name|input
parameter_list|)
value|col_offset = dlg_edit_offset(input, chr_offset, box_width)
end_define

begin_function
specifier|static
name|int
name|widest_line
parameter_list|(
name|char
modifier|*
modifier|*
name|list
parameter_list|)
block|{
name|int
name|result
init|=
name|MAX_LEN
decl_stmt|;
name|char
modifier|*
name|value
decl_stmt|;
if|if
condition|(
name|list
operator|!=
literal|0
condition|)
block|{
while|while
condition|(
operator|(
name|value
operator|=
operator|*
name|list
operator|++
operator|)
operator|!=
literal|0
condition|)
block|{
name|int
name|check
init|=
operator|(
name|int
operator|)
name|strlen
argument_list|(
name|value
argument_list|)
decl_stmt|;
if|if
condition|(
name|check
operator|>
name|result
condition|)
name|result
operator|=
name|check
expr_stmt|;
block|}
block|}
return|return
name|result
return|;
block|}
end_function

begin_define
define|#
directive|define
name|NAVIGATE_BINDINGS
define|\
value|DLG_KEYS_DATA( DLGK_GRID_DOWN,	KEY_DOWN ), \ 	DLG_KEYS_DATA( DLGK_GRID_RIGHT,	KEY_RIGHT ), \ 	DLG_KEYS_DATA( DLGK_GRID_LEFT,	KEY_LEFT ), \ 	DLG_KEYS_DATA( DLGK_GRID_UP,	KEY_UP ), \ 	DLG_KEYS_DATA( DLGK_FIELD_NEXT,	TAB ), \ 	DLG_KEYS_DATA( DLGK_FIELD_PREV,	KEY_BTAB ), \ 	DLG_KEYS_DATA( DLGK_PAGE_FIRST,	KEY_HOME ), \ 	DLG_KEYS_DATA( DLGK_PAGE_LAST,	KEY_END ), \ 	DLG_KEYS_DATA( DLGK_PAGE_LAST,	KEY_LL ), \ 	DLG_KEYS_DATA( DLGK_PAGE_NEXT,	KEY_NPAGE ), \ 	DLG_KEYS_DATA( DLGK_PAGE_NEXT,	DLGK_MOUSE(KEY_NPAGE) ), \ 	DLG_KEYS_DATA( DLGK_PAGE_PREV,	KEY_PPAGE ), \ 	DLG_KEYS_DATA( DLGK_PAGE_PREV,	DLGK_MOUSE(KEY_PPAGE) )
end_define

begin_comment
comment|/*  * Display a dialog box for editing a copy of a file  */
end_comment

begin_function
name|int
name|dlg_editbox
parameter_list|(
specifier|const
name|char
modifier|*
name|title
parameter_list|,
name|char
modifier|*
modifier|*
modifier|*
name|list
parameter_list|,
name|int
modifier|*
name|rows
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|width
parameter_list|)
block|{
comment|/* *INDENT-OFF* */
specifier|static
name|DLG_KEYS_BINDING
name|binding
index|[]
init|=
block|{
name|HELPKEY_BINDINGS
block|,
name|ENTERKEY_BINDINGS
block|,
name|NAVIGATE_BINDINGS
block|,
name|END_KEYS_BINDING
block|}
decl_stmt|;
specifier|static
name|DLG_KEYS_BINDING
name|binding2
index|[]
init|=
block|{
name|INPUTSTR_BINDINGS
block|,
name|HELPKEY_BINDINGS
block|,
name|ENTERKEY_BINDINGS
block|,
name|NAVIGATE_BINDINGS
block|,
name|END_KEYS_BINDING
block|}
decl_stmt|;
comment|/* *INDENT-ON* */
ifdef|#
directive|ifdef
name|KEY_RESIZE
name|int
name|old_height
init|=
name|height
decl_stmt|;
name|int
name|old_width
init|=
name|width
decl_stmt|;
endif|#
directive|endif
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|box_y
decl_stmt|,
name|box_x
decl_stmt|,
name|box_height
decl_stmt|,
name|box_width
decl_stmt|;
name|int
name|show_buttons
decl_stmt|;
name|int
name|thisrow
decl_stmt|,
name|base_row
decl_stmt|,
name|lastrow
decl_stmt|;
name|int
name|goal_col
init|=
operator|-
literal|1
decl_stmt|;
name|int
name|col_offset
init|=
literal|0
decl_stmt|;
name|int
name|chr_offset
init|=
literal|0
decl_stmt|;
name|int
name|key
decl_stmt|,
name|fkey
decl_stmt|,
name|code
decl_stmt|;
name|int
name|pagesize
decl_stmt|;
name|int
name|listsize
init|=
name|size_list
argument_list|(
operator|*
name|list
argument_list|)
decl_stmt|;
name|int
name|result
init|=
name|DLG_EXIT_UNKNOWN
decl_stmt|;
name|int
name|state
decl_stmt|;
name|size_t
name|max_len
init|=
operator|(
name|size_t
operator|)
name|dlg_max_input
argument_list|(
name|widest_line
argument_list|(
operator|*
name|list
argument_list|)
argument_list|)
decl_stmt|;
name|char
modifier|*
name|input
decl_stmt|,
modifier|*
name|buffer
decl_stmt|;
name|bool
name|show_all
decl_stmt|,
name|show_one
decl_stmt|,
name|was_mouse
decl_stmt|;
name|bool
name|first_trace
init|=
name|TRUE
decl_stmt|;
name|WINDOW
modifier|*
name|dialog
decl_stmt|;
name|WINDOW
modifier|*
name|editing
decl_stmt|;
name|DIALOG_VARS
name|save_vars
decl_stmt|;
specifier|const
name|char
modifier|*
modifier|*
name|buttons
init|=
name|dlg_ok_labels
argument_list|()
decl_stmt|;
name|int
name|mincols
init|=
operator|(
literal|3
operator|*
name|COLS
operator|/
literal|4
operator|)
decl_stmt|;
name|dlg_save_vars
argument_list|(
operator|&
name|save_vars
argument_list|)
expr_stmt|;
name|dialog_vars
operator|.
name|separate_output
operator|=
name|TRUE
expr_stmt|;
name|dlg_does_output
argument_list|()
expr_stmt|;
name|buffer
operator|=
name|dlg_malloc
argument_list|(
name|char
argument_list|,
name|max_len
operator|+
literal|1
argument_list|)
expr_stmt|;
name|assert_ptr
argument_list|(
name|buffer
argument_list|,
literal|"dlg_editbox"
argument_list|)
expr_stmt|;
name|thisrow
operator|=
name|base_row
operator|=
name|lastrow
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|KEY_RESIZE
name|retry
label|:
endif|#
directive|endif
name|show_buttons
operator|=
name|TRUE
expr_stmt|;
name|state
operator|=
name|dialog_vars
operator|.
name|default_button
operator|>=
literal|0
condition|?
name|dlg_default_button
argument_list|()
else|:
name|sTEXT
expr_stmt|;
name|fkey
operator|=
literal|0
expr_stmt|;
name|dlg_button_layout
argument_list|(
name|buttons
argument_list|,
operator|&
name|mincols
argument_list|)
expr_stmt|;
name|dlg_auto_size
argument_list|(
name|title
argument_list|,
literal|""
argument_list|,
operator|&
name|height
argument_list|,
operator|&
name|width
argument_list|,
literal|3
operator|*
name|LINES
operator|/
literal|4
argument_list|,
name|mincols
argument_list|)
expr_stmt|;
name|dlg_print_size
argument_list|(
name|height
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|dlg_ctl_size
argument_list|(
name|height
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|x
operator|=
name|dlg_box_x_ordinate
argument_list|(
name|width
argument_list|)
expr_stmt|;
name|y
operator|=
name|dlg_box_y_ordinate
argument_list|(
name|height
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|dlg_new_window
argument_list|(
name|height
argument_list|,
name|width
argument_list|,
name|y
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|dlg_register_window
argument_list|(
name|dialog
argument_list|,
literal|"editbox"
argument_list|,
name|binding
argument_list|)
expr_stmt|;
name|dlg_register_buttons
argument_list|(
name|dialog
argument_list|,
literal|"editbox"
argument_list|,
name|buttons
argument_list|)
expr_stmt|;
name|dlg_mouse_setbase
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|dlg_draw_box2
argument_list|(
name|dialog
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|height
argument_list|,
name|width
argument_list|,
name|dialog_attr
argument_list|,
name|border_attr
argument_list|,
name|border2_attr
argument_list|)
expr_stmt|;
name|dlg_draw_bottom_box2
argument_list|(
name|dialog
argument_list|,
name|border_attr
argument_list|,
name|border2_attr
argument_list|,
name|dialog_attr
argument_list|)
expr_stmt|;
name|dlg_draw_title
argument_list|(
name|dialog
argument_list|,
name|title
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wattrset
argument_list|(
name|dialog
argument_list|,
name|dialog_attr
argument_list|)
expr_stmt|;
comment|/* Draw the editing field in a box */
name|box_y
operator|=
name|MARGIN
operator|+
literal|0
expr_stmt|;
name|box_x
operator|=
name|MARGIN
operator|+
literal|1
expr_stmt|;
name|box_width
operator|=
name|width
operator|-
literal|2
operator|-
operator|(
literal|2
operator|*
name|MARGIN
operator|)
expr_stmt|;
name|box_height
operator|=
name|height
operator|-
operator|(
literal|4
operator|*
name|MARGIN
operator|)
expr_stmt|;
name|dlg_draw_box
argument_list|(
name|dialog
argument_list|,
name|box_y
argument_list|,
name|box_x
argument_list|,
name|box_height
argument_list|,
name|box_width
argument_list|,
name|border_attr
argument_list|,
name|border2_attr
argument_list|)
expr_stmt|;
name|dlg_mouse_mkbigregion
argument_list|(
name|box_y
operator|+
name|MARGIN
argument_list|,
name|box_x
operator|+
name|MARGIN
argument_list|,
name|box_height
operator|-
operator|(
literal|2
operator|*
name|MARGIN
operator|)
argument_list|,
name|box_width
operator|-
operator|(
literal|2
operator|*
name|MARGIN
operator|)
argument_list|,
name|KEY_MAX
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|editing
operator|=
name|dlg_sub_window
argument_list|(
name|dialog
argument_list|,
name|box_height
operator|-
operator|(
literal|2
operator|*
name|MARGIN
operator|)
argument_list|,
name|box_width
operator|-
operator|(
literal|2
operator|*
name|MARGIN
operator|)
argument_list|,
name|getbegy
argument_list|(
name|dialog
argument_list|)
operator|+
name|box_y
operator|+
literal|1
argument_list|,
name|getbegx
argument_list|(
name|dialog
argument_list|)
operator|+
name|box_x
operator|+
literal|1
argument_list|)
expr_stmt|;
name|dlg_register_window
argument_list|(
name|editing
argument_list|,
literal|"editbox2"
argument_list|,
name|binding2
argument_list|)
expr_stmt|;
name|show_all
operator|=
name|TRUE
expr_stmt|;
name|show_one
operator|=
name|FALSE
expr_stmt|;
name|pagesize
operator|=
name|getmaxy
argument_list|(
name|editing
argument_list|)
expr_stmt|;
while|while
condition|(
name|result
operator|==
name|DLG_EXIT_UNKNOWN
condition|)
block|{
name|int
name|edit
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|show_all
condition|)
block|{
name|display_all
argument_list|(
name|editing
argument_list|,
operator|*
name|list
argument_list|,
name|thisrow
argument_list|,
name|base_row
argument_list|,
name|listsize
argument_list|,
name|chr_offset
argument_list|)
expr_stmt|;
name|display_one
argument_list|(
name|editing
argument_list|,
name|THIS_ROW
argument_list|,
name|thisrow
argument_list|,
name|thisrow
argument_list|,
name|base_row
argument_list|,
name|chr_offset
argument_list|)
expr_stmt|;
name|show_all
operator|=
name|FALSE
expr_stmt|;
name|show_one
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|thisrow
operator|!=
name|lastrow
condition|)
block|{
name|display_one
argument_list|(
name|editing
argument_list|,
operator|(
operator|*
name|list
operator|)
index|[
name|lastrow
index|]
argument_list|,
name|lastrow
argument_list|,
name|thisrow
argument_list|,
name|base_row
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|show_one
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|show_one
condition|)
block|{
name|display_one
argument_list|(
name|editing
argument_list|,
name|THIS_ROW
argument_list|,
name|thisrow
argument_list|,
name|thisrow
argument_list|,
name|base_row
argument_list|,
name|chr_offset
argument_list|)
expr_stmt|;
name|getyx
argument_list|(
name|editing
argument_list|,
name|y
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|dlg_draw_scrollbar
argument_list|(
name|dialog
argument_list|,
name|base_row
argument_list|,
name|base_row
argument_list|,
name|base_row
operator|+
name|pagesize
argument_list|,
name|listsize
argument_list|,
name|box_x
argument_list|,
name|box_x
operator|+
name|getmaxx
argument_list|(
name|editing
argument_list|)
argument_list|,
name|box_y
operator|+
literal|0
argument_list|,
name|box_y
operator|+
name|getmaxy
argument_list|(
name|editing
argument_list|)
operator|+
literal|1
argument_list|,
name|border2_attr
argument_list|,
name|border_attr
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|editing
argument_list|,
name|y
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|show_one
operator|=
name|FALSE
expr_stmt|;
block|}
name|lastrow
operator|=
name|thisrow
expr_stmt|;
name|input
operator|=
name|THIS_ROW
expr_stmt|;
comment|/* 	 * The last field drawn determines where the cursor is shown: 	 */
if|if
condition|(
name|show_buttons
condition|)
block|{
name|show_buttons
operator|=
name|FALSE
expr_stmt|;
name|UPDATE_COL
argument_list|(
name|input
argument_list|)
expr_stmt|;
if|if
condition|(
name|state
operator|!=
name|sTEXT
condition|)
block|{
name|display_one
argument_list|(
name|editing
argument_list|,
name|input
argument_list|,
name|thisrow
argument_list|,
operator|-
literal|1
argument_list|,
name|base_row
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|editing
argument_list|)
expr_stmt|;
block|}
name|dlg_draw_buttons
argument_list|(
name|dialog
argument_list|,
name|height
operator|-
literal|2
argument_list|,
literal|0
argument_list|,
name|buttons
argument_list|,
operator|(
name|state
operator|!=
name|sTEXT
operator|)
condition|?
name|state
else|:
literal|99
argument_list|,
name|FALSE
argument_list|,
name|width
argument_list|)
expr_stmt|;
if|if
condition|(
name|state
operator|==
name|sTEXT
condition|)
block|{
name|display_one
argument_list|(
name|editing
argument_list|,
name|input
argument_list|,
name|thisrow
argument_list|,
name|thisrow
argument_list|,
name|base_row
argument_list|,
name|chr_offset
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|first_trace
condition|)
block|{
name|first_trace
operator|=
name|FALSE
expr_stmt|;
name|dlg_trace_win
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
name|key
operator|=
name|dlg_mouse_wgetch
argument_list|(
operator|(
name|state
operator|==
name|sTEXT
operator|)
condition|?
name|editing
else|:
name|dialog
argument_list|,
operator|&
name|fkey
argument_list|)
expr_stmt|;
if|if
condition|(
name|key
operator|==
name|ERR
condition|)
block|{
name|result
operator|=
name|DLG_EXIT_ERROR
expr_stmt|;
break|break;
block|}
elseif|else
if|if
condition|(
name|key
operator|==
name|ESC
condition|)
block|{
name|result
operator|=
name|DLG_EXIT_ESC
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|state
operator|!=
name|sTEXT
condition|)
block|{
if|if
condition|(
name|dlg_result_key
argument_list|(
name|key
argument_list|,
name|fkey
argument_list|,
operator|&
name|result
argument_list|)
condition|)
break|break;
block|}
name|was_mouse
operator|=
operator|(
name|fkey
operator|&&
name|is_DLGK_MOUSE
argument_list|(
name|key
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|was_mouse
condition|)
name|key
operator|-=
name|M_EVENT
expr_stmt|;
comment|/* 	 * Handle mouse clicks first, since we want to know if this is a 	 * button, or something that dlg_edit_string() should handle. 	 */
if|if
condition|(
name|fkey
operator|&&
name|was_mouse
operator|&&
operator|(
name|code
operator|=
name|dlg_ok_buttoncode
argument_list|(
name|key
argument_list|)
operator|)
operator|>=
literal|0
condition|)
block|{
name|result
operator|=
name|code
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|was_mouse
operator|&&
operator|(
name|key
operator|>=
name|KEY_MAX
operator|)
condition|)
block|{
name|int
name|wide
init|=
name|getmaxx
argument_list|(
name|editing
argument_list|)
decl_stmt|;
name|int
name|cell
init|=
name|key
operator|-
name|KEY_MAX
decl_stmt|;
name|thisrow
operator|=
operator|(
name|cell
operator|/
name|wide
operator|)
operator|+
name|base_row
expr_stmt|;
name|col_offset
operator|=
operator|(
name|cell
operator|%
name|wide
operator|)
expr_stmt|;
name|chr_offset
operator|=
name|col_to_chr_offset
argument_list|(
name|THIS_ROW
argument_list|,
name|col_offset
argument_list|)
expr_stmt|;
name|show_one
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|state
operator|!=
name|sTEXT
condition|)
block|{
name|state
operator|=
name|sTEXT
expr_stmt|;
name|show_buttons
operator|=
name|TRUE
expr_stmt|;
block|}
continue|continue;
block|}
elseif|else
if|if
condition|(
name|was_mouse
operator|&&
name|key
operator|>=
name|KEY_MIN
condition|)
block|{
name|key
operator|=
name|dlg_lookup_key
argument_list|(
name|dialog
argument_list|,
name|key
argument_list|,
operator|&
name|fkey
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|state
operator|==
name|sTEXT
condition|)
block|{
comment|/* editing box selected */
comment|/* 	     * Intercept scrolling keys that dlg_edit_string() does not 	     * understand. 	     */
if|if
condition|(
name|fkey
condition|)
block|{
name|bool
name|moved
init|=
name|TRUE
decl_stmt|;
switch|switch
condition|(
name|key
condition|)
block|{
case|case
name|DLGK_GRID_UP
case|:
name|SCROLL_TO
argument_list|(
name|thisrow
operator|-
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|DLGK_GRID_DOWN
case|:
name|SCROLL_TO
argument_list|(
name|thisrow
operator|+
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|DLGK_PAGE_FIRST
case|:
name|SCROLL_TO
argument_list|(
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|DLGK_PAGE_LAST
case|:
name|SCROLL_TO
argument_list|(
name|listsize
argument_list|)
expr_stmt|;
break|break;
case|case
name|DLGK_PAGE_NEXT
case|:
name|SCROLL_TO
argument_list|(
name|base_row
operator|+
name|pagesize
argument_list|)
expr_stmt|;
break|break;
case|case
name|DLGK_PAGE_PREV
case|:
if|if
condition|(
name|thisrow
operator|>
name|base_row
condition|)
block|{
name|SCROLL_TO
argument_list|(
name|base_row
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SCROLL_TO
argument_list|(
name|base_row
operator|-
name|pagesize
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DLGK_DELETE_LEFT
case|:
if|if
condition|(
name|chr_offset
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|thisrow
operator|==
literal|0
condition|)
block|{
name|beep
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|size_t
name|len
init|=
operator|(
name|strlen
argument_list|(
name|THIS_ROW
argument_list|)
operator|+
name|strlen
argument_list|(
name|PREV_ROW
argument_list|)
operator|+
literal|1
operator|)
decl_stmt|;
name|char
modifier|*
name|tmp
init|=
name|dlg_malloc
argument_list|(
name|char
argument_list|,
name|len
argument_list|)
decl_stmt|;
name|assert_ptr
argument_list|(
name|tmp
argument_list|,
literal|"dlg_editbox"
argument_list|)
expr_stmt|;
name|chr_offset
operator|=
name|dlg_count_wchars
argument_list|(
name|PREV_ROW
argument_list|)
expr_stmt|;
name|UPDATE_COL
argument_list|(
name|PREV_ROW
argument_list|)
expr_stmt|;
name|goal_col
operator|=
name|col_offset
expr_stmt|;
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"%s%s"
argument_list|,
name|PREV_ROW
argument_list|,
name|THIS_ROW
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|max_len
condition|)
name|tmp
index|[
name|max_len
index|]
operator|=
literal|'\0'
expr_stmt|;
name|free
argument_list|(
name|PREV_ROW
argument_list|)
expr_stmt|;
name|PREV_ROW
operator|=
name|tmp
expr_stmt|;
for|for
control|(
name|y
operator|=
name|thisrow
init|;
name|y
operator|<
name|listsize
condition|;
operator|++
name|y
control|)
block|{
operator|(
operator|*
name|list
operator|)
index|[
name|y
index|]
operator|=
operator|(
operator|*
name|list
operator|)
index|[
name|y
operator|+
literal|1
index|]
expr_stmt|;
block|}
operator|--
name|listsize
expr_stmt|;
operator|--
name|thisrow
expr_stmt|;
name|SCROLL_TO
argument_list|(
name|thisrow
argument_list|)
expr_stmt|;
name|show_all
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* dlg_edit_string() can handle this case */
name|moved
operator|=
name|FALSE
expr_stmt|;
block|}
break|break;
default|default:
name|moved
operator|=
name|FALSE
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|moved
condition|)
block|{
if|if
condition|(
name|thisrow
operator|!=
name|lastrow
condition|)
block|{
if|if
condition|(
name|goal_col
operator|<
literal|0
condition|)
name|goal_col
operator|=
name|col_offset
expr_stmt|;
name|chr_offset
operator|=
name|col_to_chr_offset
argument_list|(
name|THIS_ROW
argument_list|,
name|goal_col
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UPDATE_COL
argument_list|(
name|THIS_ROW
argument_list|)
expr_stmt|;
block|}
continue|continue;
block|}
block|}
name|strncpy
argument_list|(
name|buffer
argument_list|,
name|input
argument_list|,
name|max_len
operator|-
literal|1
argument_list|)
index|[
name|max_len
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|edit
operator|=
name|dlg_edit_string
argument_list|(
name|buffer
argument_list|,
operator|&
name|chr_offset
argument_list|,
name|key
argument_list|,
name|fkey
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|edit
condition|)
block|{
name|goal_col
operator|=
name|UPDATE_COL
argument_list|(
name|input
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|input
argument_list|,
name|buffer
argument_list|)
condition|)
block|{
name|free
argument_list|(
name|input
argument_list|)
expr_stmt|;
name|THIS_ROW
operator|=
name|dlg_strclone
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|input
operator|=
name|THIS_ROW
expr_stmt|;
block|}
name|display_one
argument_list|(
name|editing
argument_list|,
name|input
argument_list|,
name|thisrow
argument_list|,
name|thisrow
argument_list|,
name|base_row
argument_list|,
name|chr_offset
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
comment|/* handle non-functionkeys */
if|if
condition|(
operator|!
name|fkey
operator|&&
operator|(
name|code
operator|=
name|dlg_char_to_button
argument_list|(
name|key
argument_list|,
name|buttons
argument_list|)
operator|)
operator|>=
literal|0
condition|)
block|{
name|dlg_del_window
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|result
operator|=
name|dlg_ok_buttoncode
argument_list|(
name|code
argument_list|)
expr_stmt|;
continue|continue;
block|}
comment|/* handle functionkeys */
if|if
condition|(
name|fkey
condition|)
block|{
switch|switch
condition|(
name|key
condition|)
block|{
case|case
name|DLGK_FIELD_PREV
case|:
name|show_buttons
operator|=
name|TRUE
expr_stmt|;
name|state
operator|=
name|dlg_prev_ok_buttonindex
argument_list|(
name|state
argument_list|,
name|sTEXT
argument_list|)
expr_stmt|;
break|break;
case|case
name|DLGK_FIELD_NEXT
case|:
name|show_buttons
operator|=
name|TRUE
expr_stmt|;
name|state
operator|=
name|dlg_next_ok_buttonindex
argument_list|(
name|state
argument_list|,
name|sTEXT
argument_list|)
expr_stmt|;
break|break;
case|case
name|DLGK_ENTER
case|:
if|if
condition|(
name|state
operator|==
name|sTEXT
condition|)
block|{
specifier|const
name|int
modifier|*
name|indx
init|=
name|dlg_index_wchars
argument_list|(
name|THIS_ROW
argument_list|)
decl_stmt|;
name|int
name|split
init|=
name|indx
index|[
name|chr_offset
index|]
decl_stmt|;
name|char
modifier|*
name|tmp
init|=
name|dlg_strclone
argument_list|(
name|THIS_ROW
operator|+
name|split
argument_list|)
decl_stmt|;
name|assert_ptr
argument_list|(
name|tmp
argument_list|,
literal|"dlg_editbox"
argument_list|)
expr_stmt|;
name|grow_list
argument_list|(
name|list
argument_list|,
name|rows
argument_list|,
name|listsize
operator|+
literal|1
argument_list|)
expr_stmt|;
operator|++
name|listsize
expr_stmt|;
for|for
control|(
name|y
operator|=
name|listsize
init|;
name|y
operator|>
name|thisrow
condition|;
operator|--
name|y
control|)
block|{
operator|(
operator|*
name|list
operator|)
index|[
name|y
index|]
operator|=
operator|(
operator|*
name|list
operator|)
index|[
name|y
operator|-
literal|1
index|]
expr_stmt|;
block|}
name|THIS_ROW
index|[
name|split
index|]
operator|=
literal|'\0'
expr_stmt|;
operator|++
name|thisrow
expr_stmt|;
name|chr_offset
operator|=
literal|0
expr_stmt|;
name|col_offset
operator|=
literal|0
expr_stmt|;
name|THIS_ROW
operator|=
name|tmp
expr_stmt|;
name|SCROLL_TO
argument_list|(
name|thisrow
argument_list|)
expr_stmt|;
name|show_all
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|result
operator|=
name|dlg_ok_buttoncode
argument_list|(
name|state
argument_list|)
expr_stmt|;
block|}
break|break;
ifdef|#
directive|ifdef
name|KEY_RESIZE
case|case
name|KEY_RESIZE
case|:
comment|/* reset data */
name|height
operator|=
name|old_height
expr_stmt|;
name|width
operator|=
name|old_width
expr_stmt|;
comment|/* repaint */
name|dlg_clear
argument_list|()
expr_stmt|;
name|dlg_del_window
argument_list|(
name|editing
argument_list|)
expr_stmt|;
name|dlg_del_window
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
name|dlg_mouse_free_regions
argument_list|()
expr_stmt|;
goto|goto
name|retry
goto|;
endif|#
directive|endif
default|default:
name|beep
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
else|else
block|{
if|if
condition|(
operator|(
name|key
operator|==
literal|' '
operator|)
operator|&&
operator|(
name|state
operator|!=
name|sTEXT
operator|)
condition|)
block|{
name|result
operator|=
name|dlg_ok_buttoncode
argument_list|(
name|state
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|beep
argument_list|()
expr_stmt|;
block|}
block|}
block|}
name|dlg_unregister_window
argument_list|(
name|editing
argument_list|)
expr_stmt|;
name|dlg_del_window
argument_list|(
name|editing
argument_list|)
expr_stmt|;
name|dlg_del_window
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|dlg_mouse_free_regions
argument_list|()
expr_stmt|;
comment|/*      * The caller's copy of the (*list)[] array has been updated, but for      * consistency with the other widgets, we put the "real" result in      * the output buffer.      */
if|if
condition|(
name|result
operator|==
name|DLG_EXIT_OK
condition|)
block|{
name|int
name|n
decl_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|listsize
condition|;
operator|++
name|n
control|)
block|{
name|dlg_add_result
argument_list|(
operator|(
operator|*
name|list
operator|)
index|[
name|n
index|]
argument_list|)
expr_stmt|;
name|dlg_add_separator
argument_list|()
expr_stmt|;
block|}
block|}
name|free
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|dlg_restore_vars
argument_list|(
operator|&
name|save_vars
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|int
name|dialog_editbox
parameter_list|(
specifier|const
name|char
modifier|*
name|title
parameter_list|,
specifier|const
name|char
modifier|*
name|file
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|width
parameter_list|)
block|{
name|int
name|result
decl_stmt|;
name|char
modifier|*
modifier|*
name|list
decl_stmt|;
name|int
name|rows
decl_stmt|;
name|load_list
argument_list|(
name|file
argument_list|,
operator|&
name|list
argument_list|,
operator|&
name|rows
argument_list|)
expr_stmt|;
name|result
operator|=
name|dlg_editbox
argument_list|(
name|title
argument_list|,
operator|&
name|list
argument_list|,
operator|&
name|rows
argument_list|,
name|height
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|free_list
argument_list|(
operator|&
name|list
argument_list|,
operator|&
name|rows
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

end_unit

