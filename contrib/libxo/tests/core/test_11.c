begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2014, Juniper Networks, Inc.  * All rights reserved.  * This SOFTWARE is licensed under the LICENSE provided in the  * ../Copyright file. By downloading, installing, copying, or otherwise  * using the SOFTWARE, you agree to be bound by the terms of that  * LICENSE.  * Phil Shafer, July 2014  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<syslog.h>
end_include

begin_include
include|#
directive|include
file|"xo.h"
end_include

begin_function
name|void
name|test_syslog_open
parameter_list|(
name|void
parameter_list|)
block|{
name|printf
argument_list|(
literal|"syslog open\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_syslog_close
parameter_list|(
name|void
parameter_list|)
block|{
name|printf
argument_list|(
literal|"syslog close\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|test_syslog_send
parameter_list|(
specifier|const
name|char
modifier|*
name|full_msg
parameter_list|,
specifier|const
name|char
modifier|*
name|v0_hdr
parameter_list|,
specifier|const
name|char
modifier|*
name|text_only
parameter_list|)
block|{
name|printf
argument_list|(
literal|"{{%s}}\n{{%s}}\n{{%s}}\n\n"
argument_list|,
name|full_msg
argument_list|,
name|v0_hdr
argument_list|,
name|text_only
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|int
name|unit_test
init|=
literal|1
decl_stmt|;
name|int
name|fire
init|=
literal|0
decl_stmt|;
specifier|const
name|char
modifier|*
name|tzone
init|=
literal|"EST"
decl_stmt|;
name|argc
operator|=
name|xo_parse_args
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|<
literal|0
condition|)
return|return
literal|1
return|;
for|for
control|(
name|argc
operator|=
literal|1
init|;
name|argv
index|[
name|argc
index|]
condition|;
name|argc
operator|++
control|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argc
index|]
argument_list|,
literal|"full"
argument_list|)
operator|==
literal|0
condition|)
name|unit_test
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argc
index|]
argument_list|,
literal|"fire"
argument_list|)
operator|==
literal|0
condition|)
name|fire
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argc
index|]
argument_list|,
literal|"tz"
argument_list|)
operator|==
literal|0
condition|)
name|tzone
operator|=
name|argv
index|[
operator|++
name|argc
index|]
expr_stmt|;
block|}
name|setenv
argument_list|(
literal|"TZ"
argument_list|,
name|tzone
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|tzset
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|fire
condition|)
block|{
name|xo_set_syslog_handler
argument_list|(
name|test_syslog_open
argument_list|,
name|test_syslog_send
argument_list|,
name|test_syslog_close
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|unit_test
condition|)
block|{
name|xo_set_unit_test_mode
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|xo_open_log
argument_list|(
literal|"test-program"
argument_list|,
name|LOG_PERROR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|xo_set_version
argument_list|(
literal|"3.1.4"
argument_list|)
expr_stmt|;
name|xo_set_syslog_enterprise_id
argument_list|(
literal|42
argument_list|)
expr_stmt|;
comment|/* SunOs */
name|xo_open_container_h
argument_list|(
name|NULL
argument_list|,
literal|"top"
argument_list|)
expr_stmt|;
name|xo_syslog
argument_list|(
name|LOG_INFO
operator||
name|LOG_KERN
argument_list|,
literal|"animal-status"
argument_list|,
literal|"The {:animal} is {:state}"
argument_list|,
literal|"snake"
argument_list|,
literal|"loose"
argument_list|)
expr_stmt|;
name|xo_syslog
argument_list|(
name|LOG_INFO
operator||
name|LOG_MAIL
argument_list|,
literal|"animal-consumed"
argument_list|,
literal|"My {:animal} ate your {:pet}"
argument_list|,
literal|"snake"
argument_list|,
literal|"hamster"
argument_list|)
expr_stmt|;
name|xo_syslog
argument_list|(
name|LOG_NOTICE
operator||
name|LOG_DAEMON
argument_list|,
literal|"animal-talk"
argument_list|,
literal|"{:count/%d} {:animal} said {:quote}"
argument_list|,
literal|1
argument_list|,
literal|"owl"
argument_list|,
literal|"\"e=m\\c[2]\""
argument_list|)
expr_stmt|;
comment|/*<165>1 2003-10-11T22:14:15.003Z mymachine.example.com            evntslog - ID47 [exampleSDID@32473 iut="3" eventSource=            "Application" eventID="1011"] BOMAn application            event log entry...     This example is modeled after Example 1.  However, this time it    contains STRUCTURED-DATA, a single element with the value    "[exampleSDID@32473 iut="3" eventSource="Application"    eventID="1011"]".  The MSG itself is "An application event log    entry..."  The BOM at the beginning of MSG indicates UTF-8 encoding.     */
name|xo_set_syslog_enterprise_id
argument_list|(
literal|32473
argument_list|)
expr_stmt|;
name|xo_syslog
argument_list|(
name|LOG_LOCAL4
operator||
name|LOG_NOTICE
argument_list|,
literal|"ID47"
argument_list|,
literal|"{e:iut/%u}An {:event-source} {:event-id/%u} log entry"
argument_list|,
literal|3
argument_list|,
literal|"application"
argument_list|,
literal|1011
argument_list|)
expr_stmt|;
name|xo_close_container_h
argument_list|(
name|NULL
argument_list|,
literal|"top"
argument_list|)
expr_stmt|;
name|xo_finish
argument_list|()
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

