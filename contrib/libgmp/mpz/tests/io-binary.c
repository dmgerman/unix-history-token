begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Test mpz_inp_binary and mpz_out_binary.     We write and read back some test strings, and both compare    the numerical result, and make sure the pattern on file is    what we expect.  The latter is important for compatibility    between machines with different word sizes.  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"gmp.h"
end_include

begin_decl_stmt
name|FILE
modifier|*
name|file
decl_stmt|;
end_decl_stmt

begin_macro
name|test
argument_list|(
argument|str
argument_list|,
argument|binary_len
argument_list|,
argument|binary_str
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|binary_len
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|binary_str
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|mpz_t
name|x
decl_stmt|,
name|y
decl_stmt|;
name|int
name|n_written
decl_stmt|;
name|char
name|buf
index|[
literal|100
index|]
decl_stmt|;
name|mpz_init_set_str
argument_list|(
name|x
argument_list|,
name|str
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|mpz_init
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|fseek
argument_list|(
name|file
argument_list|,
literal|0
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
name|mpz_out_binary
argument_list|(
name|file
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|n_written
operator|=
name|ftell
argument_list|(
name|file
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_written
operator|!=
name|binary_len
condition|)
name|abort
argument_list|()
expr_stmt|;
name|fseek
argument_list|(
name|file
argument_list|,
literal|0
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
name|mpz_inp_binary
argument_list|(
name|y
argument_list|,
name|file
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_written
operator|!=
name|ftell
argument_list|(
name|file
argument_list|)
condition|)
name|abort
argument_list|()
expr_stmt|;
if|if
condition|(
name|mpz_cmp
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
name|fseek
argument_list|(
name|file
argument_list|,
literal|0
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
name|fread
argument_list|(
name|buf
argument_list|,
name|n_written
argument_list|,
literal|1
argument_list|,
name|file
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|buf
argument_list|,
name|binary_str
argument_list|,
name|binary_len
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
name|mpz_clear
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|main
parameter_list|()
block|{
name|file
operator|=
name|fopen
argument_list|(
literal|"xtmpfile"
argument_list|,
literal|"w+"
argument_list|)
expr_stmt|;
name|test
argument_list|(
literal|"0"
argument_list|,
literal|4
argument_list|,
literal|"\000\000\000\000"
argument_list|)
expr_stmt|;
name|test
argument_list|(
literal|"1"
argument_list|,
literal|5
argument_list|,
literal|"\000\000\000\001\001"
argument_list|)
expr_stmt|;
name|test
argument_list|(
literal|"0x123"
argument_list|,
literal|6
argument_list|,
literal|"\000\000\000\002\001\043"
argument_list|)
expr_stmt|;
name|test
argument_list|(
literal|"0xdeadbeef"
argument_list|,
literal|8
argument_list|,
literal|"\000\000\000\004\336\255\276\357"
argument_list|)
expr_stmt|;
name|test
argument_list|(
literal|"0xbabefaced"
argument_list|,
literal|9
argument_list|,
literal|"\000\000\000\005\013\253\357\254\355"
argument_list|)
expr_stmt|;
name|test
argument_list|(
literal|"0x123456789facade0"
argument_list|,
literal|12
argument_list|,
literal|"\000\000\000\010\022\064\126\170\237\254\255\340"
argument_list|)
expr_stmt|;
name|test
argument_list|(
literal|"-1"
argument_list|,
literal|5
argument_list|,
literal|"\377\377\377\377\001"
argument_list|)
expr_stmt|;
name|test
argument_list|(
literal|"-0x123"
argument_list|,
literal|6
argument_list|,
literal|"\377\377\377\376\001\043"
argument_list|)
expr_stmt|;
name|test
argument_list|(
literal|"-0xdeadbeef"
argument_list|,
literal|8
argument_list|,
literal|"\377\377\377\374\336\255\276\357"
argument_list|)
expr_stmt|;
name|test
argument_list|(
literal|"-0xbabefaced"
argument_list|,
literal|9
argument_list|,
literal|"\377\377\377\373\013\253\357\254\355"
argument_list|)
expr_stmt|;
name|test
argument_list|(
literal|"-0x123456789facade0"
argument_list|,
literal|12
argument_list|,
literal|"\377\377\377\370\022\064\126\170\237\254\255\340"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

