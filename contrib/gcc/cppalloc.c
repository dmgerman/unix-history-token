begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Part of CPP library.  (memory allocation - xmalloc etc)    Copyright (C) 1986, 87, 89, 92, 93, 94, 1995, 1998 Free Software Foundation, Inc.    Written by Per Bothner, 1994.    Based on CCCP program by Paul Rubin, June 1986    Adapted to ANSI C, Richard Stallman, Jan 1987  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2, or (at your option) any later version.  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.   In other words, you are welcome to use, share and improve this program.  You are forbidden to forbid anyone else to use, share and improve  what you give them.   Help stamp out software-hoarding!  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"system.h"
end_include

begin_include
include|#
directive|include
file|"cpplib.h"
end_include

begin_decl_stmt
specifier|static
name|void
name|memory_full
name|PROTO
argument_list|(
operator|(
name|void
operator|)
argument_list|)
name|ATTRIBUTE_NORETURN
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|memory_full
parameter_list|()
block|{
name|cpp_notice
argument_list|(
literal|"%s: Memory exhausted.\n"
argument_list|,
name|progname
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|FATAL_EXIT_CODE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|PTR
name|xmalloc
parameter_list|(
name|size
parameter_list|)
name|size_t
name|size
decl_stmt|;
block|{
specifier|register
name|PTR
name|ptr
init|=
operator|(
name|PTR
operator|)
name|malloc
argument_list|(
name|size
argument_list|)
decl_stmt|;
if|if
condition|(
name|ptr
operator|==
literal|0
condition|)
name|memory_full
argument_list|()
expr_stmt|;
return|return
name|ptr
return|;
block|}
end_function

begin_function
name|PTR
name|xcalloc
parameter_list|(
name|number
parameter_list|,
name|size
parameter_list|)
name|size_t
name|number
decl_stmt|,
name|size
decl_stmt|;
block|{
specifier|register
name|PTR
name|ptr
init|=
operator|(
name|PTR
operator|)
name|calloc
argument_list|(
name|number
argument_list|,
name|size
argument_list|)
decl_stmt|;
if|if
condition|(
name|ptr
operator|==
literal|0
condition|)
name|memory_full
argument_list|()
expr_stmt|;
return|return
name|ptr
return|;
block|}
end_function

begin_function
name|PTR
name|xrealloc
parameter_list|(
name|old
parameter_list|,
name|size
parameter_list|)
name|PTR
name|old
decl_stmt|;
name|size_t
name|size
decl_stmt|;
block|{
specifier|register
name|PTR
name|ptr
decl_stmt|;
if|if
condition|(
name|old
condition|)
name|ptr
operator|=
operator|(
name|PTR
operator|)
name|realloc
argument_list|(
name|old
argument_list|,
name|size
argument_list|)
expr_stmt|;
else|else
name|ptr
operator|=
operator|(
name|PTR
operator|)
name|malloc
argument_list|(
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptr
operator|==
literal|0
condition|)
name|memory_full
argument_list|()
expr_stmt|;
return|return
name|ptr
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|xstrdup
parameter_list|(
name|input
parameter_list|)
specifier|const
name|char
modifier|*
name|input
decl_stmt|;
block|{
name|unsigned
name|size
init|=
name|strlen
argument_list|(
name|input
argument_list|)
decl_stmt|;
name|char
modifier|*
name|output
init|=
name|xmalloc
argument_list|(
name|size
operator|+
literal|1
argument_list|)
decl_stmt|;
name|strcpy
argument_list|(
name|output
argument_list|,
name|input
argument_list|)
expr_stmt|;
return|return
name|output
return|;
block|}
end_function

end_unit

