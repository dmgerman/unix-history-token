begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Dump a gcov file, for debugging use.    Copyright (C) 2002, 2003 Free Software Foundation, Inc.    Contributed by Nathan Sidwell<nathan@codesourcery.com>  Gcov is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2, or (at your option) any later version.  Gcov is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with Gcov; see the file COPYING.  If not, write to the Free Software Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"system.h"
end_include

begin_include
include|#
directive|include
file|"coretypes.h"
end_include

begin_include
include|#
directive|include
file|"tm.h"
end_include

begin_include
include|#
directive|include
file|"version.h"
end_include

begin_include
include|#
directive|include
file|<getopt.h>
end_include

begin_define
define|#
directive|define
name|IN_GCOV
value|(-1)
end_define

begin_include
include|#
directive|include
file|"gcov-io.h"
end_include

begin_include
include|#
directive|include
file|"gcov-io.c"
end_include

begin_function_decl
specifier|static
name|void
name|dump_file
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_prefix
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|unsigned
parameter_list|,
name|gcov_position_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_usage
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_version
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tag_function
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|unsigned
parameter_list|,
name|unsigned
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tag_blocks
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|unsigned
parameter_list|,
name|unsigned
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tag_arcs
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|unsigned
parameter_list|,
name|unsigned
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tag_lines
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|unsigned
parameter_list|,
name|unsigned
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tag_counters
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|unsigned
parameter_list|,
name|unsigned
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tag_summary
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|unsigned
parameter_list|,
name|unsigned
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|main
parameter_list|(
name|int
parameter_list|,
name|char
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_typedef
typedef|typedef
struct|struct
name|tag_format
block|{
name|unsigned
name|tag
decl_stmt|;
name|char
specifier|const
modifier|*
name|name
decl_stmt|;
name|void
function_decl|(
modifier|*
name|proc
function_decl|)
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|unsigned
parameter_list|,
name|unsigned
parameter_list|)
function_decl|;
block|}
name|tag_format_t
typedef|;
end_typedef

begin_decl_stmt
specifier|static
name|int
name|flag_dump_contents
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|flag_dump_positions
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|option
name|options
index|[]
init|=
block|{
block|{
literal|"help"
block|,
name|no_argument
block|,
name|NULL
block|,
literal|'h'
block|}
block|,
block|{
literal|"version"
block|,
name|no_argument
block|,
name|NULL
block|,
literal|'v'
block|}
block|,
block|{
literal|"long"
block|,
name|no_argument
block|,
name|NULL
block|,
literal|'l'
block|}
block|,
block|{
literal|"positions"
block|,
name|no_argument
block|,
name|NULL
block|,
literal|'o'
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|tag_format_t
name|tag_table
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"NOP"
block|,
name|NULL
block|}
block|,
block|{
literal|0
block|,
literal|"UNKNOWN"
block|,
name|NULL
block|}
block|,
block|{
literal|0
block|,
literal|"COUNTERS"
block|,
name|tag_counters
block|}
block|,
block|{
name|GCOV_TAG_FUNCTION
block|,
literal|"FUNCTION"
block|,
name|tag_function
block|}
block|,
block|{
name|GCOV_TAG_BLOCKS
block|,
literal|"BLOCKS"
block|,
name|tag_blocks
block|}
block|,
block|{
name|GCOV_TAG_ARCS
block|,
literal|"ARCS"
block|,
name|tag_arcs
block|}
block|,
block|{
name|GCOV_TAG_LINES
block|,
literal|"LINES"
block|,
name|tag_lines
block|}
block|,
block|{
name|GCOV_TAG_OBJECT_SUMMARY
block|,
literal|"OBJECT_SUMMARY"
block|,
name|tag_summary
block|}
block|,
block|{
name|GCOV_TAG_PROGRAM_SUMMARY
block|,
literal|"PROGRAM_SUMMARY"
block|,
name|tag_summary
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
name|ATTRIBUTE_UNUSED
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|int
name|opt
decl_stmt|;
while|while
condition|(
operator|(
name|opt
operator|=
name|getopt_long
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"hlpv"
argument_list|,
name|options
argument_list|,
name|NULL
argument_list|)
operator|)
operator|!=
operator|-
literal|1
condition|)
block|{
switch|switch
condition|(
name|opt
condition|)
block|{
case|case
literal|'h'
case|:
name|print_usage
argument_list|()
expr_stmt|;
break|break;
case|case
literal|'v'
case|:
name|print_version
argument_list|()
expr_stmt|;
break|break;
case|case
literal|'l'
case|:
name|flag_dump_contents
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'p'
case|:
name|flag_dump_positions
operator|=
literal|1
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"unknown flag `%c'\n"
argument_list|,
name|opt
argument_list|)
expr_stmt|;
block|}
block|}
while|while
condition|(
name|argv
index|[
name|optind
index|]
condition|)
name|dump_file
argument_list|(
name|argv
index|[
name|optind
operator|++
index|]
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_usage
parameter_list|(
name|void
parameter_list|)
block|{
name|printf
argument_list|(
literal|"Usage: gcov-dump [OPTION] ... gcovfiles\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Print coverage file contents\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  -h, --help           Print this help\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  -v, --version        Print version number\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  -l, --long           Dump record contents too\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  -p, --positions      Dump record positions\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_version
parameter_list|(
name|void
parameter_list|)
block|{
name|printf
argument_list|(
literal|"gcov-dump (GCC) %s\n"
argument_list|,
name|version_string
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Copyright (C) 2003 Free Software Foundation, Inc.\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is free software; see the source for copying conditions.\n"
literal|"There is NO warranty; not even for MERCHANTABILITY or \n"
literal|"FITNESS FOR A PARTICULAR PURPOSE.\n\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_prefix
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
parameter_list|,
name|unsigned
name|depth
parameter_list|,
name|gcov_position_t
name|position
parameter_list|)
block|{
specifier|static
specifier|const
name|char
name|prefix
index|[]
init|=
literal|"    "
decl_stmt|;
name|printf
argument_list|(
literal|"%s:"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|flag_dump_positions
condition|)
name|printf
argument_list|(
literal|"%lu:"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|position
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%.*s"
argument_list|,
operator|(
name|int
operator|)
name|depth
argument_list|,
name|prefix
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dump_file
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
parameter_list|)
block|{
name|unsigned
name|tags
index|[
literal|4
index|]
decl_stmt|;
name|unsigned
name|depth
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|gcov_open
argument_list|(
name|filename
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s:cannot open\n"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* magic */
block|{
name|unsigned
name|magic
init|=
name|gcov_read_unsigned
argument_list|()
decl_stmt|;
name|unsigned
name|version
decl_stmt|;
specifier|const
name|char
modifier|*
name|type
init|=
name|NULL
decl_stmt|;
name|int
name|endianness
init|=
literal|0
decl_stmt|;
name|char
name|m
index|[
literal|4
index|]
decl_stmt|,
name|v
index|[
literal|4
index|]
decl_stmt|;
if|if
condition|(
operator|(
name|endianness
operator|=
name|gcov_magic
argument_list|(
name|magic
argument_list|,
name|GCOV_DATA_MAGIC
argument_list|)
operator|)
condition|)
name|type
operator|=
literal|"data"
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|endianness
operator|=
name|gcov_magic
argument_list|(
name|magic
argument_list|,
name|GCOV_NOTE_MAGIC
argument_list|)
operator|)
condition|)
name|type
operator|=
literal|"note"
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"%s:not a gcov file\n"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|gcov_close
argument_list|()
expr_stmt|;
return|return;
block|}
name|version
operator|=
name|gcov_read_unsigned
argument_list|()
expr_stmt|;
name|GCOV_UNSIGNED2STRING
argument_list|(
name|v
argument_list|,
name|version
argument_list|)
expr_stmt|;
name|GCOV_UNSIGNED2STRING
argument_list|(
name|m
argument_list|,
name|magic
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s:%s:magic `%.4s':version `%.4s'%s\n"
argument_list|,
name|filename
argument_list|,
name|type
argument_list|,
name|m
argument_list|,
name|v
argument_list|,
name|endianness
operator|<
literal|0
condition|?
literal|" (swapped endianness)"
else|:
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|version
operator|!=
name|GCOV_VERSION
condition|)
block|{
name|char
name|e
index|[
literal|4
index|]
decl_stmt|;
name|GCOV_UNSIGNED2STRING
argument_list|(
name|e
argument_list|,
name|GCOV_VERSION
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s:warning:current version is `%.4s'\n"
argument_list|,
name|filename
argument_list|,
name|e
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* stamp */
block|{
name|unsigned
name|stamp
init|=
name|gcov_read_unsigned
argument_list|()
decl_stmt|;
name|printf
argument_list|(
literal|"%s:stamp %lu\n"
argument_list|,
name|filename
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|stamp
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
literal|1
condition|)
block|{
name|gcov_position_t
name|base
decl_stmt|,
name|position
init|=
name|gcov_position
argument_list|()
decl_stmt|;
name|unsigned
name|tag
decl_stmt|,
name|length
decl_stmt|;
name|tag_format_t
specifier|const
modifier|*
name|format
decl_stmt|;
name|unsigned
name|tag_depth
decl_stmt|;
name|int
name|error
decl_stmt|;
name|unsigned
name|mask
decl_stmt|;
name|tag
operator|=
name|gcov_read_unsigned
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|tag
condition|)
break|break;
name|length
operator|=
name|gcov_read_unsigned
argument_list|()
expr_stmt|;
name|base
operator|=
name|gcov_position
argument_list|()
expr_stmt|;
name|mask
operator|=
name|GCOV_TAG_MASK
argument_list|(
name|tag
argument_list|)
operator|>>
literal|1
expr_stmt|;
for|for
control|(
name|tag_depth
operator|=
literal|4
init|;
name|mask
condition|;
name|mask
operator|>>=
literal|8
control|)
block|{
if|if
condition|(
operator|(
name|mask
operator|&
literal|0xff
operator|)
operator|!=
literal|0xff
condition|)
block|{
name|printf
argument_list|(
literal|"%s:tag `%08x' is invalid\n"
argument_list|,
name|filename
argument_list|,
name|tag
argument_list|)
expr_stmt|;
break|break;
block|}
name|tag_depth
operator|--
expr_stmt|;
block|}
for|for
control|(
name|format
operator|=
name|tag_table
init|;
name|format
operator|->
name|name
condition|;
name|format
operator|++
control|)
if|if
condition|(
name|format
operator|->
name|tag
operator|==
name|tag
condition|)
goto|goto
name|found
goto|;
name|format
operator|=
operator|&
name|tag_table
index|[
name|GCOV_TAG_IS_COUNTER
argument_list|(
name|tag
argument_list|)
condition|?
literal|2
else|:
literal|1
index|]
expr_stmt|;
name|found
label|:
empty_stmt|;
if|if
condition|(
name|tag
condition|)
block|{
if|if
condition|(
name|depth
operator|&&
name|depth
operator|<
name|tag_depth
condition|)
block|{
if|if
condition|(
operator|!
name|GCOV_TAG_IS_SUBTAG
argument_list|(
name|tags
index|[
name|depth
operator|-
literal|1
index|]
argument_list|,
name|tag
argument_list|)
condition|)
name|printf
argument_list|(
literal|"%s:tag `%08x' is incorrectly nested\n"
argument_list|,
name|filename
argument_list|,
name|tag
argument_list|)
expr_stmt|;
block|}
name|depth
operator|=
name|tag_depth
expr_stmt|;
name|tags
index|[
name|depth
operator|-
literal|1
index|]
operator|=
name|tag
expr_stmt|;
block|}
name|print_prefix
argument_list|(
name|filename
argument_list|,
name|tag_depth
argument_list|,
name|position
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%08x:%4u:%s"
argument_list|,
name|tag
argument_list|,
name|length
argument_list|,
name|format
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|format
operator|->
name|proc
condition|)
call|(
modifier|*
name|format
operator|->
name|proc
call|)
argument_list|(
name|filename
argument_list|,
name|tag
argument_list|,
name|length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|flag_dump_contents
operator|&&
name|format
operator|->
name|proc
condition|)
block|{
name|unsigned
name|long
name|actual_length
init|=
name|gcov_position
argument_list|()
operator|-
name|base
decl_stmt|;
if|if
condition|(
name|actual_length
operator|>
name|length
condition|)
name|printf
argument_list|(
literal|"%s:record size mismatch %lu bytes overread\n"
argument_list|,
name|filename
argument_list|,
name|actual_length
operator|-
name|length
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|length
operator|>
name|actual_length
condition|)
name|printf
argument_list|(
literal|"%s:record size mismatch %lu bytes unread\n"
argument_list|,
name|filename
argument_list|,
name|length
operator|-
name|actual_length
argument_list|)
expr_stmt|;
block|}
name|gcov_sync
argument_list|(
name|base
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|error
operator|=
name|gcov_is_error
argument_list|()
operator|)
condition|)
block|{
name|printf
argument_list|(
name|error
operator|<
literal|0
condition|?
literal|"%s:counter overflow at %lu\n"
else|:
literal|"%s:read error at %lu\n"
argument_list|,
name|filename
argument_list|,
operator|(
name|long
name|unsigned
operator|)
name|gcov_position
argument_list|()
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|gcov_is_eof
argument_list|()
condition|)
name|printf
argument_list|(
literal|"%s:early end of file\n"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|gcov_close
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|tag_function
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|tag
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|length
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|unsigned
name|long
name|pos
init|=
name|gcov_position
argument_list|()
decl_stmt|;
name|printf
argument_list|(
literal|" ident=%u"
argument_list|,
name|gcov_read_unsigned
argument_list|()
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", checksum=0x%08x"
argument_list|,
name|gcov_read_unsigned
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|gcov_position
argument_list|()
operator|-
name|pos
operator|<
name|length
condition|)
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|name
operator|=
name|gcov_read_string
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|", `%s'"
argument_list|,
name|name
condition|?
name|name
else|:
literal|"NULL"
argument_list|)
expr_stmt|;
name|name
operator|=
name|gcov_read_string
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|" %s"
argument_list|,
name|name
condition|?
name|name
else|:
literal|"NULL"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|":%u"
argument_list|,
name|gcov_read_unsigned
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|tag_blocks
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|tag
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|length
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|unsigned
name|n_blocks
init|=
name|GCOV_TAG_BLOCKS_NUM
argument_list|(
name|length
argument_list|)
decl_stmt|;
name|printf
argument_list|(
literal|" %u blocks"
argument_list|,
name|n_blocks
argument_list|)
expr_stmt|;
if|if
condition|(
name|flag_dump_contents
condition|)
block|{
name|unsigned
name|ix
decl_stmt|;
for|for
control|(
name|ix
operator|=
literal|0
init|;
name|ix
operator|!=
name|n_blocks
condition|;
name|ix
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|ix
operator|&
literal|7
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|print_prefix
argument_list|(
name|filename
argument_list|,
literal|0
argument_list|,
name|gcov_position
argument_list|()
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t\t%u"
argument_list|,
name|ix
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|" %04x"
argument_list|,
name|gcov_read_unsigned
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|tag_arcs
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|tag
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|length
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|unsigned
name|n_arcs
init|=
name|GCOV_TAG_ARCS_NUM
argument_list|(
name|length
argument_list|)
decl_stmt|;
name|printf
argument_list|(
literal|" %u arcs"
argument_list|,
name|n_arcs
argument_list|)
expr_stmt|;
if|if
condition|(
name|flag_dump_contents
condition|)
block|{
name|unsigned
name|ix
decl_stmt|;
name|unsigned
name|blockno
init|=
name|gcov_read_unsigned
argument_list|()
decl_stmt|;
for|for
control|(
name|ix
operator|=
literal|0
init|;
name|ix
operator|!=
name|n_arcs
condition|;
name|ix
operator|++
control|)
block|{
name|unsigned
name|dst
decl_stmt|,
name|flags
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|ix
operator|&
literal|3
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|print_prefix
argument_list|(
name|filename
argument_list|,
literal|0
argument_list|,
name|gcov_position
argument_list|()
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tblock %u:"
argument_list|,
name|blockno
argument_list|)
expr_stmt|;
block|}
name|dst
operator|=
name|gcov_read_unsigned
argument_list|()
expr_stmt|;
name|flags
operator|=
name|gcov_read_unsigned
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|" %u:%04x"
argument_list|,
name|dst
argument_list|,
name|flags
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|tag_lines
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|tag
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|length
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
if|if
condition|(
name|flag_dump_contents
condition|)
block|{
name|unsigned
name|blockno
init|=
name|gcov_read_unsigned
argument_list|()
decl_stmt|;
name|char
specifier|const
modifier|*
name|sep
init|=
name|NULL
decl_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|gcov_position_t
name|position
init|=
name|gcov_position
argument_list|()
decl_stmt|;
specifier|const
name|char
modifier|*
name|source
init|=
name|NULL
decl_stmt|;
name|unsigned
name|lineno
init|=
name|gcov_read_unsigned
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|lineno
condition|)
block|{
name|source
operator|=
name|gcov_read_string
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|source
condition|)
break|break;
name|sep
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|sep
condition|)
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|print_prefix
argument_list|(
name|filename
argument_list|,
literal|0
argument_list|,
name|position
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tblock %u:"
argument_list|,
name|blockno
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|""
expr_stmt|;
block|}
if|if
condition|(
name|lineno
condition|)
block|{
name|printf
argument_list|(
literal|"%s%u"
argument_list|,
name|sep
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|", "
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"%s`%s'"
argument_list|,
name|sep
argument_list|,
name|source
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|":"
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|tag_counters
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|tag
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|length
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
specifier|static
specifier|const
name|char
modifier|*
specifier|const
name|counter_names
index|[]
init|=
name|GCOV_COUNTER_NAMES
decl_stmt|;
name|unsigned
name|n_counts
init|=
name|GCOV_TAG_COUNTER_NUM
argument_list|(
name|length
argument_list|)
decl_stmt|;
name|printf
argument_list|(
literal|" %s %u counts"
argument_list|,
name|counter_names
index|[
name|GCOV_COUNTER_FOR_TAG
argument_list|(
name|tag
argument_list|)
index|]
argument_list|,
name|n_counts
argument_list|)
expr_stmt|;
if|if
condition|(
name|flag_dump_contents
condition|)
block|{
name|unsigned
name|ix
decl_stmt|;
for|for
control|(
name|ix
operator|=
literal|0
init|;
name|ix
operator|!=
name|n_counts
condition|;
name|ix
operator|++
control|)
block|{
name|gcov_type
name|count
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|ix
operator|&
literal|7
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|print_prefix
argument_list|(
name|filename
argument_list|,
literal|0
argument_list|,
name|gcov_position
argument_list|()
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t\t%u"
argument_list|,
name|ix
argument_list|)
expr_stmt|;
block|}
name|count
operator|=
name|gcov_read_counter
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|HOST_WIDEST_INT_PRINT_DEC
argument_list|,
name|count
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|tag_summary
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|tag
name|ATTRIBUTE_UNUSED
parameter_list|,
name|unsigned
name|length
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|struct
name|gcov_summary
name|summary
decl_stmt|;
name|unsigned
name|ix
decl_stmt|;
name|gcov_read_summary
argument_list|(
operator|&
name|summary
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" checksum=0x%08x"
argument_list|,
name|summary
operator|.
name|checksum
argument_list|)
expr_stmt|;
for|for
control|(
name|ix
operator|=
literal|0
init|;
name|ix
operator|!=
name|GCOV_COUNTERS
condition|;
name|ix
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|print_prefix
argument_list|(
name|filename
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t\tcounts=%u, runs=%u"
argument_list|,
name|summary
operator|.
name|ctrs
index|[
name|ix
index|]
operator|.
name|num
argument_list|,
name|summary
operator|.
name|ctrs
index|[
name|ix
index|]
operator|.
name|runs
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", sum_all="
name|HOST_WIDEST_INT_PRINT_DEC
argument_list|,
operator|(
name|HOST_WIDEST_INT
operator|)
name|summary
operator|.
name|ctrs
index|[
name|ix
index|]
operator|.
name|sum_all
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", run_max="
name|HOST_WIDEST_INT_PRINT_DEC
argument_list|,
operator|(
name|HOST_WIDEST_INT
operator|)
name|summary
operator|.
name|ctrs
index|[
name|ix
index|]
operator|.
name|run_max
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", sum_max="
name|HOST_WIDEST_INT_PRINT_DEC
argument_list|,
operator|(
name|HOST_WIDEST_INT
operator|)
name|summary
operator|.
name|ctrs
index|[
name|ix
index|]
operator|.
name|sum_max
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

