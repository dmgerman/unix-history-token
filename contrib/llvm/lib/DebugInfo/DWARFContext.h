begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|//===-- DWARFContext.h ------------------------------------------*- C++ -*-===//
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//                     The LLVM Compiler Infrastructure
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// This file is distributed under the University of Illinois Open Source
end_comment

begin_comment
comment|// License. See LICENSE.TXT for details.
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//===----------------------------------------------------------------------===/
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|LLVM_DEBUGINFO_DWARFCONTEXT_H
end_ifndef

begin_define
define|#
directive|define
name|LLVM_DEBUGINFO_DWARFCONTEXT_H
end_define

begin_include
include|#
directive|include
file|"DWARFCompileUnit.h"
end_include

begin_include
include|#
directive|include
file|"DWARFDebugAranges.h"
end_include

begin_include
include|#
directive|include
file|"DWARFDebugFrame.h"
end_include

begin_include
include|#
directive|include
file|"DWARFDebugLine.h"
end_include

begin_include
include|#
directive|include
file|"DWARFDebugLoc.h"
end_include

begin_include
include|#
directive|include
file|"DWARFDebugRangeList.h"
end_include

begin_include
include|#
directive|include
file|"DWARFTypeUnit.h"
end_include

begin_include
include|#
directive|include
file|"llvm/ADT/OwningPtr.h"
end_include

begin_include
include|#
directive|include
file|"llvm/ADT/SmallVector.h"
end_include

begin_include
include|#
directive|include
file|"llvm/DebugInfo/DIContext.h"
end_include

begin_decl_stmt
name|namespace
name|llvm
block|{
comment|/// DWARFContext
comment|/// This data structure is the top level entity that deals with dwarf debug
comment|/// information parsing. The actual data is supplied through pure virtual
comment|/// methods that a concrete implementation provides.
name|class
name|DWARFContext
range|:
name|public
name|DIContext
block|{
name|SmallVector
operator|<
name|DWARFCompileUnit
operator|*
block|,
literal|1
operator|>
name|CUs
block|;
name|SmallVector
operator|<
name|DWARFTypeUnit
operator|*
block|,
literal|1
operator|>
name|TUs
block|;
name|OwningPtr
operator|<
name|DWARFDebugAbbrev
operator|>
name|Abbrev
block|;
name|OwningPtr
operator|<
name|DWARFDebugLoc
operator|>
name|Loc
block|;
name|OwningPtr
operator|<
name|DWARFDebugAranges
operator|>
name|Aranges
block|;
name|OwningPtr
operator|<
name|DWARFDebugLine
operator|>
name|Line
block|;
name|OwningPtr
operator|<
name|DWARFDebugFrame
operator|>
name|DebugFrame
block|;
name|SmallVector
operator|<
name|DWARFCompileUnit
operator|*
block|,
literal|1
operator|>
name|DWOCUs
block|;
name|OwningPtr
operator|<
name|DWARFDebugAbbrev
operator|>
name|AbbrevDWO
block|;
name|DWARFContext
argument_list|(
argument|DWARFContext&
argument_list|)
name|LLVM_DELETED_FUNCTION
block|;
name|DWARFContext
operator|&
name|operator
operator|=
operator|(
name|DWARFContext
operator|&
operator|)
name|LLVM_DELETED_FUNCTION
block|;
comment|/// Read compile units from the debug_info section and store them in CUs.
name|void
name|parseCompileUnits
argument_list|()
block|;
comment|/// Read type units from the debug_types sections and store them in CUs.
name|void
name|parseTypeUnits
argument_list|()
block|;
comment|/// Read compile units from the debug_info.dwo section and store them in
comment|/// DWOCUs.
name|void
name|parseDWOCompileUnits
argument_list|()
block|;
name|public
operator|:
expr|struct
name|Section
block|{
name|StringRef
name|Data
block|;
name|RelocAddrMap
name|Relocs
block|;   }
block|;
name|DWARFContext
argument_list|()
operator|:
name|DIContext
argument_list|(
argument|CK_DWARF
argument_list|)
block|{}
name|virtual
operator|~
name|DWARFContext
argument_list|()
block|;
specifier|static
name|bool
name|classof
argument_list|(
argument|const DIContext *DICtx
argument_list|)
block|{
return|return
name|DICtx
operator|->
name|getKind
argument_list|()
operator|==
name|CK_DWARF
return|;
block|}
name|virtual
name|void
name|dump
argument_list|(
argument|raw_ostream&OS
argument_list|,
argument|DIDumpType DumpType = DIDT_All
argument_list|)
block|;
comment|/// Get the number of compile units in this context.
name|unsigned
name|getNumCompileUnits
argument_list|()
block|{
if|if
condition|(
name|CUs
operator|.
name|empty
argument_list|()
condition|)
name|parseCompileUnits
argument_list|()
expr_stmt|;
return|return
name|CUs
operator|.
name|size
argument_list|()
return|;
block|}
comment|/// Get the number of compile units in this context.
name|unsigned
name|getNumTypeUnits
parameter_list|()
block|{
if|if
condition|(
name|TUs
operator|.
name|empty
argument_list|()
condition|)
name|parseTypeUnits
argument_list|()
expr_stmt|;
return|return
name|TUs
operator|.
name|size
argument_list|()
return|;
block|}
comment|/// Get the number of compile units in the DWO context.
name|unsigned
name|getNumDWOCompileUnits
parameter_list|()
block|{
if|if
condition|(
name|DWOCUs
operator|.
name|empty
argument_list|()
condition|)
name|parseDWOCompileUnits
argument_list|()
expr_stmt|;
return|return
name|DWOCUs
operator|.
name|size
argument_list|()
return|;
block|}
comment|/// Get the compile unit at the specified index for this compile unit.
name|DWARFCompileUnit
modifier|*
name|getCompileUnitAtIndex
parameter_list|(
name|unsigned
name|index
parameter_list|)
block|{
if|if
condition|(
name|CUs
operator|.
name|empty
argument_list|()
condition|)
name|parseCompileUnits
argument_list|()
expr_stmt|;
return|return
name|CUs
index|[
name|index
index|]
return|;
block|}
comment|/// Get the type unit at the specified index for this compile unit.
name|DWARFTypeUnit
modifier|*
name|getTypeUnitAtIndex
parameter_list|(
name|unsigned
name|index
parameter_list|)
block|{
if|if
condition|(
name|TUs
operator|.
name|empty
argument_list|()
condition|)
name|parseTypeUnits
argument_list|()
expr_stmt|;
return|return
name|TUs
index|[
name|index
index|]
return|;
block|}
comment|/// Get the compile unit at the specified index for the DWO compile units.
name|DWARFCompileUnit
modifier|*
name|getDWOCompileUnitAtIndex
parameter_list|(
name|unsigned
name|index
parameter_list|)
block|{
if|if
condition|(
name|DWOCUs
operator|.
name|empty
argument_list|()
condition|)
name|parseDWOCompileUnits
argument_list|()
expr_stmt|;
return|return
name|DWOCUs
index|[
name|index
index|]
return|;
block|}
comment|/// Get a pointer to the parsed DebugAbbrev object.
specifier|const
name|DWARFDebugAbbrev
modifier|*
name|getDebugAbbrev
parameter_list|()
function_decl|;
comment|/// Get a pointer to the parsed DebugLoc object.
specifier|const
name|DWARFDebugLoc
modifier|*
name|getDebugLoc
parameter_list|()
function_decl|;
comment|/// Get a pointer to the parsed dwo abbreviations object.
specifier|const
name|DWARFDebugAbbrev
modifier|*
name|getDebugAbbrevDWO
parameter_list|()
function_decl|;
comment|/// Get a pointer to the parsed DebugAranges object.
specifier|const
name|DWARFDebugAranges
modifier|*
name|getDebugAranges
parameter_list|()
function_decl|;
comment|/// Get a pointer to the parsed frame information object.
specifier|const
name|DWARFDebugFrame
modifier|*
name|getDebugFrame
parameter_list|()
function_decl|;
comment|/// Get a pointer to a parsed line table corresponding to a compile unit.
specifier|const
name|DWARFDebugLine
operator|::
name|LineTable
operator|*
name|getLineTableForCompileUnit
argument_list|(
name|DWARFCompileUnit
operator|*
name|cu
argument_list|)
expr_stmt|;
name|virtual
name|DILineInfo
name|getLineInfoForAddress
parameter_list|(
name|uint64_t
name|Address
parameter_list|,
name|DILineInfoSpecifier
name|Specifier
init|=
name|DILineInfoSpecifier
argument_list|()
parameter_list|)
function_decl|;
name|virtual
name|DILineInfoTable
name|getLineInfoForAddressRange
parameter_list|(
name|uint64_t
name|Address
parameter_list|,
name|uint64_t
name|Size
parameter_list|,
name|DILineInfoSpecifier
name|Specifier
init|=
name|DILineInfoSpecifier
argument_list|()
parameter_list|)
function_decl|;
name|virtual
name|DIInliningInfo
name|getInliningInfoForAddress
parameter_list|(
name|uint64_t
name|Address
parameter_list|,
name|DILineInfoSpecifier
name|Specifier
init|=
name|DILineInfoSpecifier
argument_list|()
parameter_list|)
function_decl|;
name|virtual
name|bool
name|isLittleEndian
argument_list|()
specifier|const
operator|=
literal|0
expr_stmt|;
name|virtual
name|uint8_t
name|getAddressSize
argument_list|()
specifier|const
operator|=
literal|0
expr_stmt|;
name|virtual
specifier|const
name|Section
modifier|&
name|getInfoSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
specifier|const
name|std
operator|::
name|map
operator|<
name|object
operator|::
name|SectionRef
operator|,
name|Section
operator|>
operator|&
name|getTypesSections
argument_list|()
operator|=
literal|0
expr_stmt|;
name|virtual
name|StringRef
name|getAbbrevSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
specifier|const
name|Section
modifier|&
name|getLocSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getARangeSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getDebugFrameSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
specifier|const
name|Section
modifier|&
name|getLineSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getStringSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getRangeSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getPubNamesSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getPubTypesSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getGnuPubNamesSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getGnuPubTypesSection
parameter_list|()
init|=
literal|0
function_decl|;
comment|// Sections for DWARF5 split dwarf proposal.
name|virtual
specifier|const
name|Section
modifier|&
name|getInfoDWOSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getAbbrevDWOSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getStringDWOSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getStringOffsetDWOSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getRangeDWOSection
parameter_list|()
init|=
literal|0
function_decl|;
name|virtual
name|StringRef
name|getAddrSection
parameter_list|()
init|=
literal|0
function_decl|;
specifier|static
name|bool
name|isSupportedVersion
parameter_list|(
name|unsigned
name|version
parameter_list|)
block|{
return|return
name|version
operator|==
literal|2
operator|||
name|version
operator|==
literal|3
operator|||
name|version
operator|==
literal|4
return|;
block|}
name|private
label|:
comment|/// Return the compile unit that includes an offset (relative to .debug_info).
name|DWARFCompileUnit
modifier|*
name|getCompileUnitForOffset
parameter_list|(
name|uint32_t
name|Offset
parameter_list|)
function_decl|;
comment|/// Return the compile unit which contains instruction with provided
comment|/// address.
name|DWARFCompileUnit
modifier|*
name|getCompileUnitForAddress
parameter_list|(
name|uint64_t
name|Address
parameter_list|)
function_decl|;
block|}
end_decl_stmt

begin_empty_stmt
empty_stmt|;
end_empty_stmt

begin_comment
comment|/// DWARFContextInMemory is the simplest possible implementation of a
end_comment

begin_comment
comment|/// DWARFContext. It assumes all content is available in memory and stores
end_comment

begin_comment
comment|/// pointers to it.
end_comment

begin_decl_stmt
name|class
name|DWARFContextInMemory
range|:
name|public
name|DWARFContext
block|{
name|virtual
name|void
name|anchor
argument_list|()
block|;
name|bool
name|IsLittleEndian
block|;
name|uint8_t
name|AddressSize
block|;
name|Section
name|InfoSection
block|;
name|std
operator|::
name|map
operator|<
name|object
operator|::
name|SectionRef
block|,
name|Section
operator|>
name|TypesSections
block|;
name|StringRef
name|AbbrevSection
block|;
name|Section
name|LocSection
block|;
name|StringRef
name|ARangeSection
block|;
name|StringRef
name|DebugFrameSection
block|;
name|Section
name|LineSection
block|;
name|StringRef
name|StringSection
block|;
name|StringRef
name|RangeSection
block|;
name|StringRef
name|PubNamesSection
block|;
name|StringRef
name|PubTypesSection
block|;
name|StringRef
name|GnuPubNamesSection
block|;
name|StringRef
name|GnuPubTypesSection
block|;
comment|// Sections for DWARF5 split dwarf proposal.
name|Section
name|InfoDWOSection
block|;
name|StringRef
name|AbbrevDWOSection
block|;
name|StringRef
name|StringDWOSection
block|;
name|StringRef
name|StringOffsetDWOSection
block|;
name|StringRef
name|RangeDWOSection
block|;
name|StringRef
name|AddrSection
block|;
name|SmallVector
operator|<
name|MemoryBuffer
operator|*
block|,
literal|4
operator|>
name|UncompressedSections
block|;
name|public
operator|:
name|DWARFContextInMemory
argument_list|(
name|object
operator|::
name|ObjectFile
operator|*
argument_list|)
block|;
operator|~
name|DWARFContextInMemory
argument_list|()
block|;
name|virtual
name|bool
name|isLittleEndian
argument_list|()
specifier|const
block|{
return|return
name|IsLittleEndian
return|;
block|}
name|virtual
name|uint8_t
name|getAddressSize
argument_list|()
specifier|const
block|{
return|return
name|AddressSize
return|;
block|}
name|virtual
specifier|const
name|Section
operator|&
name|getInfoSection
argument_list|()
block|{
return|return
name|InfoSection
return|;
block|}
name|virtual
specifier|const
name|std
operator|::
name|map
operator|<
name|object
operator|::
name|SectionRef
block|,
name|Section
operator|>
operator|&
name|getTypesSections
argument_list|()
block|{
return|return
name|TypesSections
return|;
block|}
name|virtual
name|StringRef
name|getAbbrevSection
argument_list|()
block|{
return|return
name|AbbrevSection
return|;
block|}
name|virtual
specifier|const
name|Section
operator|&
name|getLocSection
argument_list|()
block|{
return|return
name|LocSection
return|;
block|}
name|virtual
name|StringRef
name|getARangeSection
argument_list|()
block|{
return|return
name|ARangeSection
return|;
block|}
name|virtual
name|StringRef
name|getDebugFrameSection
argument_list|()
block|{
return|return
name|DebugFrameSection
return|;
block|}
name|virtual
specifier|const
name|Section
operator|&
name|getLineSection
argument_list|()
block|{
return|return
name|LineSection
return|;
block|}
name|virtual
name|StringRef
name|getStringSection
argument_list|()
block|{
return|return
name|StringSection
return|;
block|}
name|virtual
name|StringRef
name|getRangeSection
argument_list|()
block|{
return|return
name|RangeSection
return|;
block|}
name|virtual
name|StringRef
name|getPubNamesSection
argument_list|()
block|{
return|return
name|PubNamesSection
return|;
block|}
name|virtual
name|StringRef
name|getPubTypesSection
argument_list|()
block|{
return|return
name|PubTypesSection
return|;
block|}
name|virtual
name|StringRef
name|getGnuPubNamesSection
argument_list|()
block|{
return|return
name|GnuPubNamesSection
return|;
block|}
name|virtual
name|StringRef
name|getGnuPubTypesSection
argument_list|()
block|{
return|return
name|GnuPubTypesSection
return|;
block|}
comment|// Sections for DWARF5 split dwarf proposal.
name|virtual
specifier|const
name|Section
operator|&
name|getInfoDWOSection
argument_list|()
block|{
return|return
name|InfoDWOSection
return|;
block|}
name|virtual
name|StringRef
name|getAbbrevDWOSection
argument_list|()
block|{
return|return
name|AbbrevDWOSection
return|;
block|}
name|virtual
name|StringRef
name|getStringDWOSection
argument_list|()
block|{
return|return
name|StringDWOSection
return|;
block|}
name|virtual
name|StringRef
name|getStringOffsetDWOSection
argument_list|()
block|{
return|return
name|StringOffsetDWOSection
return|;
block|}
name|virtual
name|StringRef
name|getRangeDWOSection
argument_list|()
block|{
return|return
name|RangeDWOSection
return|;
block|}
name|virtual
name|StringRef
name|getAddrSection
argument_list|()
block|{
return|return
name|AddrSection
return|;
block|}
expr|}
block|;  }
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

end_unit

