begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|//===-- MipsABIFlagsSection.h - Mips ELF ABI Flags Section -----*- C++ -*--===//
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//                     The LLVM Compiler Infrastructure
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// This file is distributed under the University of Illinois Open Source
end_comment

begin_comment
comment|// License. See LICENSE.TXT for details.
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//===----------------------------------------------------------------------===//
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|LLVM_LIB_TARGET_MIPS_MCTARGETDESC_MIPSABIFLAGSSECTION_H
end_ifndef

begin_define
define|#
directive|define
name|LLVM_LIB_TARGET_MIPS_MCTARGETDESC_MIPSABIFLAGSSECTION_H
end_define

begin_include
include|#
directive|include
file|"llvm/MC/MCStreamer.h"
end_include

begin_decl_stmt
name|namespace
name|llvm
block|{
name|class
name|MCStreamer
decl_stmt|;
struct|struct
name|MipsABIFlagsSection
block|{
comment|// Values for the xxx_size bytes of an ABI flags structure.
enum|enum
name|AFL_REG
block|{
name|AFL_REG_NONE
init|=
literal|0x00
block|,
comment|// No registers.
name|AFL_REG_32
init|=
literal|0x01
block|,
comment|// 32-bit registers.
name|AFL_REG_64
init|=
literal|0x02
block|,
comment|// 64-bit registers.
name|AFL_REG_128
init|=
literal|0x03
comment|// 128-bit registers.
block|}
enum|;
comment|// Masks for the ases word of an ABI flags structure.
enum|enum
name|AFL_ASE
block|{
name|AFL_ASE_DSP
init|=
literal|0x00000001
block|,
comment|// DSP ASE.
name|AFL_ASE_DSPR2
init|=
literal|0x00000002
block|,
comment|// DSP R2 ASE.
name|AFL_ASE_EVA
init|=
literal|0x00000004
block|,
comment|// Enhanced VA Scheme.
name|AFL_ASE_MCU
init|=
literal|0x00000008
block|,
comment|// MCU (MicroController) ASE.
name|AFL_ASE_MDMX
init|=
literal|0x00000010
block|,
comment|// MDMX ASE.
name|AFL_ASE_MIPS3D
init|=
literal|0x00000020
block|,
comment|// MIPS-3D ASE.
name|AFL_ASE_MT
init|=
literal|0x00000040
block|,
comment|// MT ASE.
name|AFL_ASE_SMARTMIPS
init|=
literal|0x00000080
block|,
comment|// SmartMIPS ASE.
name|AFL_ASE_VIRT
init|=
literal|0x00000100
block|,
comment|// VZ ASE.
name|AFL_ASE_MSA
init|=
literal|0x00000200
block|,
comment|// MSA ASE.
name|AFL_ASE_MIPS16
init|=
literal|0x00000400
block|,
comment|// MIPS16 ASE.
name|AFL_ASE_MICROMIPS
init|=
literal|0x00000800
block|,
comment|// MICROMIPS ASE.
name|AFL_ASE_XPA
init|=
literal|0x00001000
comment|// XPA ASE.
block|}
enum|;
comment|// Values for the isa_ext word of an ABI flags structure.
enum|enum
name|AFL_EXT
block|{
name|AFL_EXT_XLR
init|=
literal|1
block|,
comment|// RMI Xlr instruction.
name|AFL_EXT_OCTEON2
init|=
literal|2
block|,
comment|// Cavium Networks Octeon2.
name|AFL_EXT_OCTEONP
init|=
literal|3
block|,
comment|// Cavium Networks OcteonP.
name|AFL_EXT_LOONGSON_3A
init|=
literal|4
block|,
comment|// Loongson 3A.
name|AFL_EXT_OCTEON
init|=
literal|5
block|,
comment|// Cavium Networks Octeon.
name|AFL_EXT_5900
init|=
literal|6
block|,
comment|// MIPS R5900 instruction.
name|AFL_EXT_4650
init|=
literal|7
block|,
comment|// MIPS R4650 instruction.
name|AFL_EXT_4010
init|=
literal|8
block|,
comment|// LSI R4010 instruction.
name|AFL_EXT_4100
init|=
literal|9
block|,
comment|// NEC VR4100 instruction.
name|AFL_EXT_3900
init|=
literal|10
block|,
comment|// Toshiba R3900 instruction.
name|AFL_EXT_10000
init|=
literal|11
block|,
comment|// MIPS R10000 instruction.
name|AFL_EXT_SB1
init|=
literal|12
block|,
comment|// Broadcom SB-1 instruction.
name|AFL_EXT_4111
init|=
literal|13
block|,
comment|// NEC VR4111/VR4181 instruction.
name|AFL_EXT_4120
init|=
literal|14
block|,
comment|// NEC VR4120 instruction.
name|AFL_EXT_5400
init|=
literal|15
block|,
comment|// NEC VR5400 instruction.
name|AFL_EXT_5500
init|=
literal|16
block|,
comment|// NEC VR5500 instruction.
name|AFL_EXT_LOONGSON_2E
init|=
literal|17
block|,
comment|// ST Microelectronics Loongson 2E.
name|AFL_EXT_LOONGSON_2F
init|=
literal|18
comment|// ST Microelectronics Loongson 2F.
block|}
enum|;
comment|// Values for the fp_abi word of an ABI flags structure.
enum|enum
name|Val_GNU_MIPS_ABI
block|{
name|Val_GNU_MIPS_ABI_FP_ANY
init|=
literal|0
block|,
name|Val_GNU_MIPS_ABI_FP_DOUBLE
init|=
literal|1
block|,
name|Val_GNU_MIPS_ABI_FP_XX
init|=
literal|5
block|,
name|Val_GNU_MIPS_ABI_FP_64
init|=
literal|6
block|,
name|Val_GNU_MIPS_ABI_FP_64A
init|=
literal|7
block|}
enum|;
enum|enum
name|AFL_FLAGS1
block|{
name|AFL_FLAGS1_ODDSPREG
init|=
literal|1
block|}
enum|;
comment|// Internal representation of the values used in .module fp=value
name|enum
name|class
name|FpABIKind
block|{
name|ANY
operator|,
name|XX
operator|,
name|S32
operator|,
name|S64
block|}
empty_stmt|;
comment|// Version of flags structure.
name|uint16_t
name|Version
decl_stmt|;
comment|// The level of the ISA: 1-5, 32, 64.
name|uint8_t
name|ISALevel
decl_stmt|;
comment|// The revision of ISA: 0 for MIPS V and below, 1-n otherwise.
name|uint8_t
name|ISARevision
decl_stmt|;
comment|// The size of general purpose registers.
name|AFL_REG
name|GPRSize
decl_stmt|;
comment|// The size of co-processor 1 registers.
name|AFL_REG
name|CPR1Size
decl_stmt|;
comment|// The size of co-processor 2 registers.
name|AFL_REG
name|CPR2Size
decl_stmt|;
comment|// Processor-specific extension.
name|uint32_t
name|ISAExtensionSet
decl_stmt|;
comment|// Mask of ASEs used.
name|uint32_t
name|ASESet
decl_stmt|;
name|bool
name|OddSPReg
decl_stmt|;
name|bool
name|Is32BitABI
decl_stmt|;
name|protected
label|:
comment|// The floating-point ABI.
name|FpABIKind
name|FpABI
decl_stmt|;
name|public
label|:
name|MipsABIFlagsSection
argument_list|()
operator|:
name|Version
argument_list|(
literal|0
argument_list|)
operator|,
name|ISALevel
argument_list|(
literal|0
argument_list|)
operator|,
name|ISARevision
argument_list|(
literal|0
argument_list|)
operator|,
name|GPRSize
argument_list|(
name|AFL_REG_NONE
argument_list|)
operator|,
name|CPR1Size
argument_list|(
name|AFL_REG_NONE
argument_list|)
operator|,
name|CPR2Size
argument_list|(
name|AFL_REG_NONE
argument_list|)
operator|,
name|ISAExtensionSet
argument_list|(
literal|0
argument_list|)
operator|,
name|ASESet
argument_list|(
literal|0
argument_list|)
operator|,
name|OddSPReg
argument_list|(
name|false
argument_list|)
operator|,
name|Is32BitABI
argument_list|(
name|false
argument_list|)
operator|,
name|FpABI
argument_list|(
argument|FpABIKind::ANY
argument_list|)
block|{}
name|uint16_t
name|getVersionValue
argument_list|()
block|{
return|return
operator|(
name|uint16_t
operator|)
name|Version
return|;
block|}
name|uint8_t
name|getISALevelValue
parameter_list|()
block|{
return|return
operator|(
name|uint8_t
operator|)
name|ISALevel
return|;
block|}
name|uint8_t
name|getISARevisionValue
parameter_list|()
block|{
return|return
operator|(
name|uint8_t
operator|)
name|ISARevision
return|;
block|}
name|uint8_t
name|getGPRSizeValue
parameter_list|()
block|{
return|return
operator|(
name|uint8_t
operator|)
name|GPRSize
return|;
block|}
name|uint8_t
name|getCPR1SizeValue
parameter_list|()
function_decl|;
name|uint8_t
name|getCPR2SizeValue
parameter_list|()
block|{
return|return
operator|(
name|uint8_t
operator|)
name|CPR2Size
return|;
block|}
name|uint8_t
name|getFpABIValue
parameter_list|()
function_decl|;
name|uint32_t
name|getISAExtensionSetValue
parameter_list|()
block|{
return|return
operator|(
name|uint32_t
operator|)
name|ISAExtensionSet
return|;
block|}
name|uint32_t
name|getASESetValue
parameter_list|()
block|{
return|return
operator|(
name|uint32_t
operator|)
name|ASESet
return|;
block|}
name|uint32_t
name|getFlags1Value
parameter_list|()
block|{
name|uint32_t
name|Value
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|OddSPReg
condition|)
name|Value
operator||=
operator|(
name|uint32_t
operator|)
name|AFL_FLAGS1_ODDSPREG
expr_stmt|;
return|return
name|Value
return|;
block|}
name|uint32_t
name|getFlags2Value
parameter_list|()
block|{
return|return
literal|0
return|;
block|}
name|FpABIKind
name|getFpABI
parameter_list|()
block|{
return|return
name|FpABI
return|;
block|}
name|void
name|setFpABI
parameter_list|(
name|FpABIKind
name|Value
parameter_list|,
name|bool
name|IsABI32Bit
parameter_list|)
block|{
name|FpABI
operator|=
name|Value
expr_stmt|;
name|Is32BitABI
operator|=
name|IsABI32Bit
expr_stmt|;
block|}
name|StringRef
name|getFpABIString
parameter_list|(
name|FpABIKind
name|Value
parameter_list|)
function_decl|;
name|template
operator|<
name|class
name|PredicateLibrary
operator|>
name|void
name|setISALevelAndRevisionFromPredicates
argument_list|(
argument|const PredicateLibrary&P
argument_list|)
block|{
if|if
condition|(
name|P
operator|.
name|hasMips64
argument_list|()
condition|)
block|{
name|ISALevel
operator|=
literal|64
expr_stmt|;
if|if
condition|(
name|P
operator|.
name|hasMips64r6
argument_list|()
condition|)
name|ISARevision
operator|=
literal|6
expr_stmt|;
elseif|else
if|if
condition|(
name|P
operator|.
name|hasMips64r2
argument_list|()
condition|)
name|ISARevision
operator|=
literal|2
expr_stmt|;
else|else
name|ISARevision
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|P
operator|.
name|hasMips32
argument_list|()
condition|)
block|{
name|ISALevel
operator|=
literal|32
expr_stmt|;
if|if
condition|(
name|P
operator|.
name|hasMips32r6
argument_list|()
condition|)
name|ISARevision
operator|=
literal|6
expr_stmt|;
elseif|else
if|if
condition|(
name|P
operator|.
name|hasMips32r2
argument_list|()
condition|)
name|ISARevision
operator|=
literal|2
expr_stmt|;
else|else
name|ISARevision
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|ISARevision
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|P
operator|.
name|hasMips5
argument_list|()
condition|)
name|ISALevel
operator|=
literal|5
expr_stmt|;
elseif|else
if|if
condition|(
name|P
operator|.
name|hasMips4
argument_list|()
condition|)
name|ISALevel
operator|=
literal|4
expr_stmt|;
elseif|else
if|if
condition|(
name|P
operator|.
name|hasMips3
argument_list|()
condition|)
name|ISALevel
operator|=
literal|3
expr_stmt|;
elseif|else
if|if
condition|(
name|P
operator|.
name|hasMips2
argument_list|()
condition|)
name|ISALevel
operator|=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
name|P
operator|.
name|hasMips1
argument_list|()
condition|)
name|ISALevel
operator|=
literal|1
expr_stmt|;
else|else
name|llvm_unreachable
argument_list|(
literal|"Unknown ISA level!"
argument_list|)
expr_stmt|;
block|}
block|}
name|template
operator|<
name|class
name|PredicateLibrary
operator|>
name|void
name|setGPRSizeFromPredicates
argument_list|(
argument|const PredicateLibrary&P
argument_list|)
block|{
name|GPRSize
operator|=
name|P
operator|.
name|isGP64bit
argument_list|()
operator|?
name|AFL_REG_64
operator|:
name|AFL_REG_32
block|;   }
name|template
operator|<
name|class
name|PredicateLibrary
operator|>
name|void
name|setCPR1SizeFromPredicates
argument_list|(
argument|const PredicateLibrary&P
argument_list|)
block|{
if|if
condition|(
name|P
operator|.
name|abiUsesSoftFloat
argument_list|()
condition|)
name|CPR1Size
operator|=
name|AFL_REG_NONE
expr_stmt|;
elseif|else
if|if
condition|(
name|P
operator|.
name|hasMSA
argument_list|()
condition|)
name|CPR1Size
operator|=
name|AFL_REG_128
expr_stmt|;
else|else
name|CPR1Size
operator|=
name|P
operator|.
name|isFP64bit
argument_list|()
condition|?
name|AFL_REG_64
else|:
name|AFL_REG_32
expr_stmt|;
block|}
name|template
operator|<
name|class
name|PredicateLibrary
operator|>
name|void
name|setASESetFromPredicates
argument_list|(
argument|const PredicateLibrary&P
argument_list|)
block|{
name|ASESet
operator|=
literal|0
block|;
if|if
condition|(
name|P
operator|.
name|hasDSP
argument_list|()
condition|)
name|ASESet
operator||=
name|AFL_ASE_DSP
expr_stmt|;
if|if
condition|(
name|P
operator|.
name|hasDSPR2
argument_list|()
condition|)
name|ASESet
operator||=
name|AFL_ASE_DSPR2
expr_stmt|;
if|if
condition|(
name|P
operator|.
name|hasMSA
argument_list|()
condition|)
name|ASESet
operator||=
name|AFL_ASE_MSA
expr_stmt|;
if|if
condition|(
name|P
operator|.
name|inMicroMipsMode
argument_list|()
condition|)
name|ASESet
operator||=
name|AFL_ASE_MICROMIPS
expr_stmt|;
if|if
condition|(
name|P
operator|.
name|inMips16Mode
argument_list|()
condition|)
name|ASESet
operator||=
name|AFL_ASE_MIPS16
expr_stmt|;
block|}
name|template
decl|<
name|class
name|PredicateLibrary
decl|>
name|void
name|setFpAbiFromPredicates
argument_list|(
specifier|const
name|PredicateLibrary
operator|&
name|P
argument_list|)
block|{
name|Is32BitABI
operator|=
name|P
operator|.
name|isABI_O32
argument_list|()
expr_stmt|;
name|FpABI
operator|=
name|FpABIKind
operator|::
name|ANY
expr_stmt|;
if|if
condition|(
name|P
operator|.
name|isABI_N32
argument_list|()
operator|||
name|P
operator|.
name|isABI_N64
argument_list|()
condition|)
name|FpABI
operator|=
name|FpABIKind
operator|::
name|S64
expr_stmt|;
elseif|else
if|if
condition|(
name|P
operator|.
name|isABI_O32
argument_list|()
condition|)
block|{
if|if
condition|(
name|P
operator|.
name|isABI_FPXX
argument_list|()
condition|)
name|FpABI
operator|=
name|FpABIKind
operator|::
name|XX
expr_stmt|;
elseif|else
if|if
condition|(
name|P
operator|.
name|isFP64bit
argument_list|()
condition|)
name|FpABI
operator|=
name|FpABIKind
operator|::
name|S64
expr_stmt|;
else|else
name|FpABI
operator|=
name|FpABIKind
operator|::
name|S32
expr_stmt|;
block|}
block|}
name|template
decl|<
name|class
name|PredicateLibrary
decl|>
name|void
name|setAllFromPredicates
argument_list|(
specifier|const
name|PredicateLibrary
operator|&
name|P
argument_list|)
block|{
name|setISALevelAndRevisionFromPredicates
argument_list|(
name|P
argument_list|)
expr_stmt|;
name|setGPRSizeFromPredicates
argument_list|(
name|P
argument_list|)
expr_stmt|;
name|setCPR1SizeFromPredicates
argument_list|(
name|P
argument_list|)
expr_stmt|;
name|setASESetFromPredicates
argument_list|(
name|P
argument_list|)
expr_stmt|;
name|setFpAbiFromPredicates
argument_list|(
name|P
argument_list|)
expr_stmt|;
name|OddSPReg
operator|=
name|P
operator|.
name|useOddSPReg
argument_list|()
expr_stmt|;
block|}
block|}
end_decl_stmt

begin_empty_stmt
empty_stmt|;
end_empty_stmt

begin_expr_stmt
name|MCStreamer
operator|&
name|operator
operator|<<
operator|(
name|MCStreamer
operator|&
name|OS
operator|,
name|MipsABIFlagsSection
operator|&
name|ABIFlagsSection
operator|)
expr_stmt|;
end_expr_stmt

begin_endif
unit|}
endif|#
directive|endif
end_endif

end_unit

