begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|//===-- MipsBaseInfo.h - Top level definitions for MIPS MC ------*- C++ -*-===//
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//                     The LLVM Compiler Infrastructure
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// This file is distributed under the University of Illinois Open Source
end_comment

begin_comment
comment|// License. See LICENSE.TXT for details.
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//===----------------------------------------------------------------------===//
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// This file contains small standalone helper functions and enum definitions for
end_comment

begin_comment
comment|// the Mips target useful for the compiler back-end and the MC libraries.
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//===----------------------------------------------------------------------===//
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|MIPSBASEINFO_H
end_ifndef

begin_define
define|#
directive|define
name|MIPSBASEINFO_H
end_define

begin_include
include|#
directive|include
file|"MipsFixupKinds.h"
end_include

begin_include
include|#
directive|include
file|"MipsMCTargetDesc.h"
end_include

begin_include
include|#
directive|include
file|"llvm/MC/MCExpr.h"
end_include

begin_include
include|#
directive|include
file|"llvm/Support/DataTypes.h"
end_include

begin_include
include|#
directive|include
file|"llvm/Support/ErrorHandling.h"
end_include

begin_decl_stmt
name|namespace
name|llvm
block|{
comment|/// MipsII - This namespace holds all of the target specific flags that
comment|/// instruction info tracks.
comment|///
name|namespace
name|MipsII
block|{
comment|/// Target Operand Flag enum.
enum|enum
name|TOF
block|{
comment|//===------------------------------------------------------------------===//
comment|// Mips Specific MachineOperand flags.
name|MO_NO_FLAG
block|,
comment|/// MO_GOT16 - Represents the offset into the global offset table at which
comment|/// the address the relocation entry symbol resides during execution.
name|MO_GOT16
block|,
name|MO_GOT
block|,
comment|/// MO_GOT_CALL - Represents the offset into the global offset table at
comment|/// which the address of a call site relocation entry symbol resides
comment|/// during execution. This is different from the above since this flag
comment|/// can only be present in call instructions.
name|MO_GOT_CALL
block|,
comment|/// MO_GPREL - Represents the offset from the current gp value to be used
comment|/// for the relocatable object file being produced.
name|MO_GPREL
block|,
comment|/// MO_ABS_HI/LO - Represents the hi or low part of an absolute symbol
comment|/// address.
name|MO_ABS_HI
block|,
name|MO_ABS_LO
block|,
comment|/// MO_TLSGD - Represents the offset into the global offset table at which
comment|// the module ID and TSL block offset reside during execution (General
comment|// Dynamic TLS).
name|MO_TLSGD
block|,
comment|/// MO_TLSLDM - Represents the offset into the global offset table at which
comment|// the module ID and TSL block offset reside during execution (Local
comment|// Dynamic TLS).
name|MO_TLSLDM
block|,
name|MO_DTPREL_HI
block|,
name|MO_DTPREL_LO
block|,
comment|/// MO_GOTTPREL - Represents the offset from the thread pointer (Initial
comment|// Exec TLS).
name|MO_GOTTPREL
block|,
comment|/// MO_TPREL_HI/LO - Represents the hi and low part of the offset from
comment|// the thread pointer (Local Exec TLS).
name|MO_TPREL_HI
block|,
name|MO_TPREL_LO
block|,
comment|// N32/64 Flags.
name|MO_GPOFF_HI
block|,
name|MO_GPOFF_LO
block|,
name|MO_GOT_DISP
block|,
name|MO_GOT_PAGE
block|,
name|MO_GOT_OFST
block|,
comment|/// MO_HIGHER/HIGHEST - Represents the highest or higher half word of a
comment|/// 64-bit symbol address.
name|MO_HIGHER
block|,
name|MO_HIGHEST
block|}
enum|;
enum|enum
block|{
comment|//===------------------------------------------------------------------===//
comment|// Instruction encodings.  These are the standard/most common forms for
comment|// Mips instructions.
comment|//
comment|// Pseudo - This represents an instruction that is a pseudo instruction
comment|// or one that has not been implemented yet.  It is illegal to code generate
comment|// it, but tolerated for intermediate implementation stages.
name|Pseudo
init|=
literal|0
block|,
comment|/// FrmR - This form is for instructions of the format R.
name|FrmR
init|=
literal|1
block|,
comment|/// FrmI - This form is for instructions of the format I.
name|FrmI
init|=
literal|2
block|,
comment|/// FrmJ - This form is for instructions of the format J.
name|FrmJ
init|=
literal|3
block|,
comment|/// FrmFR - This form is for instructions of the format FR.
name|FrmFR
init|=
literal|4
block|,
comment|/// FrmFI - This form is for instructions of the format FI.
name|FrmFI
init|=
literal|5
block|,
comment|/// FrmOther - This form is for instructions that have no specific format.
name|FrmOther
init|=
literal|6
block|,
name|FormMask
init|=
literal|15
block|}
enum|;
block|}
comment|/// getMipsRegisterNumbering - Given the enum value for some register,
comment|/// return the number that it corresponds to.
specifier|inline
specifier|static
name|unsigned
name|getMipsRegisterNumbering
parameter_list|(
name|unsigned
name|RegEnum
parameter_list|)
block|{
switch|switch
condition|(
name|RegEnum
condition|)
block|{
case|case
name|Mips
operator|::
name|ZERO
case|:
case|case
name|Mips
operator|::
name|ZERO_64
case|:
case|case
name|Mips
operator|::
name|F0
case|:
case|case
name|Mips
operator|::
name|D0_64
case|:
case|case
name|Mips
operator|::
name|D0
case|:
case|case
name|Mips
operator|::
name|FCC0
case|:
case|case
name|Mips
operator|::
name|AC0
case|:
return|return
literal|0
return|;
case|case
name|Mips
operator|::
name|AT
case|:
case|case
name|Mips
operator|::
name|AT_64
case|:
case|case
name|Mips
operator|::
name|F1
case|:
case|case
name|Mips
operator|::
name|D1_64
case|:
case|case
name|Mips
operator|::
name|AC1
case|:
return|return
literal|1
return|;
case|case
name|Mips
operator|::
name|V0
case|:
case|case
name|Mips
operator|::
name|V0_64
case|:
case|case
name|Mips
operator|::
name|F2
case|:
case|case
name|Mips
operator|::
name|D2_64
case|:
case|case
name|Mips
operator|::
name|D1
case|:
case|case
name|Mips
operator|::
name|AC2
case|:
return|return
literal|2
return|;
case|case
name|Mips
operator|::
name|V1
case|:
case|case
name|Mips
operator|::
name|V1_64
case|:
case|case
name|Mips
operator|::
name|F3
case|:
case|case
name|Mips
operator|::
name|D3_64
case|:
case|case
name|Mips
operator|::
name|AC3
case|:
return|return
literal|3
return|;
case|case
name|Mips
operator|::
name|A0
case|:
case|case
name|Mips
operator|::
name|A0_64
case|:
case|case
name|Mips
operator|::
name|F4
case|:
case|case
name|Mips
operator|::
name|D4_64
case|:
case|case
name|Mips
operator|::
name|D2
case|:
return|return
literal|4
return|;
case|case
name|Mips
operator|::
name|A1
case|:
case|case
name|Mips
operator|::
name|A1_64
case|:
case|case
name|Mips
operator|::
name|F5
case|:
case|case
name|Mips
operator|::
name|D5_64
case|:
return|return
literal|5
return|;
case|case
name|Mips
operator|::
name|A2
case|:
case|case
name|Mips
operator|::
name|A2_64
case|:
case|case
name|Mips
operator|::
name|F6
case|:
case|case
name|Mips
operator|::
name|D6_64
case|:
case|case
name|Mips
operator|::
name|D3
case|:
return|return
literal|6
return|;
case|case
name|Mips
operator|::
name|A3
case|:
case|case
name|Mips
operator|::
name|A3_64
case|:
case|case
name|Mips
operator|::
name|F7
case|:
case|case
name|Mips
operator|::
name|D7_64
case|:
return|return
literal|7
return|;
case|case
name|Mips
operator|::
name|T0
case|:
case|case
name|Mips
operator|::
name|T0_64
case|:
case|case
name|Mips
operator|::
name|F8
case|:
case|case
name|Mips
operator|::
name|D8_64
case|:
case|case
name|Mips
operator|::
name|D4
case|:
return|return
literal|8
return|;
case|case
name|Mips
operator|::
name|T1
case|:
case|case
name|Mips
operator|::
name|T1_64
case|:
case|case
name|Mips
operator|::
name|F9
case|:
case|case
name|Mips
operator|::
name|D9_64
case|:
return|return
literal|9
return|;
case|case
name|Mips
operator|::
name|T2
case|:
case|case
name|Mips
operator|::
name|T2_64
case|:
case|case
name|Mips
operator|::
name|F10
case|:
case|case
name|Mips
operator|::
name|D10_64
case|:
case|case
name|Mips
operator|::
name|D5
case|:
return|return
literal|10
return|;
case|case
name|Mips
operator|::
name|T3
case|:
case|case
name|Mips
operator|::
name|T3_64
case|:
case|case
name|Mips
operator|::
name|F11
case|:
case|case
name|Mips
operator|::
name|D11_64
case|:
return|return
literal|11
return|;
case|case
name|Mips
operator|::
name|T4
case|:
case|case
name|Mips
operator|::
name|T4_64
case|:
case|case
name|Mips
operator|::
name|F12
case|:
case|case
name|Mips
operator|::
name|D12_64
case|:
case|case
name|Mips
operator|::
name|D6
case|:
return|return
literal|12
return|;
case|case
name|Mips
operator|::
name|T5
case|:
case|case
name|Mips
operator|::
name|T5_64
case|:
case|case
name|Mips
operator|::
name|F13
case|:
case|case
name|Mips
operator|::
name|D13_64
case|:
return|return
literal|13
return|;
case|case
name|Mips
operator|::
name|T6
case|:
case|case
name|Mips
operator|::
name|T6_64
case|:
case|case
name|Mips
operator|::
name|F14
case|:
case|case
name|Mips
operator|::
name|D14_64
case|:
case|case
name|Mips
operator|::
name|D7
case|:
return|return
literal|14
return|;
case|case
name|Mips
operator|::
name|T7
case|:
case|case
name|Mips
operator|::
name|T7_64
case|:
case|case
name|Mips
operator|::
name|F15
case|:
case|case
name|Mips
operator|::
name|D15_64
case|:
return|return
literal|15
return|;
case|case
name|Mips
operator|::
name|S0
case|:
case|case
name|Mips
operator|::
name|S0_64
case|:
case|case
name|Mips
operator|::
name|F16
case|:
case|case
name|Mips
operator|::
name|D16_64
case|:
case|case
name|Mips
operator|::
name|D8
case|:
return|return
literal|16
return|;
case|case
name|Mips
operator|::
name|S1
case|:
case|case
name|Mips
operator|::
name|S1_64
case|:
case|case
name|Mips
operator|::
name|F17
case|:
case|case
name|Mips
operator|::
name|D17_64
case|:
return|return
literal|17
return|;
case|case
name|Mips
operator|::
name|S2
case|:
case|case
name|Mips
operator|::
name|S2_64
case|:
case|case
name|Mips
operator|::
name|F18
case|:
case|case
name|Mips
operator|::
name|D18_64
case|:
case|case
name|Mips
operator|::
name|D9
case|:
return|return
literal|18
return|;
case|case
name|Mips
operator|::
name|S3
case|:
case|case
name|Mips
operator|::
name|S3_64
case|:
case|case
name|Mips
operator|::
name|F19
case|:
case|case
name|Mips
operator|::
name|D19_64
case|:
return|return
literal|19
return|;
case|case
name|Mips
operator|::
name|S4
case|:
case|case
name|Mips
operator|::
name|S4_64
case|:
case|case
name|Mips
operator|::
name|F20
case|:
case|case
name|Mips
operator|::
name|D20_64
case|:
case|case
name|Mips
operator|::
name|D10
case|:
return|return
literal|20
return|;
case|case
name|Mips
operator|::
name|S5
case|:
case|case
name|Mips
operator|::
name|S5_64
case|:
case|case
name|Mips
operator|::
name|F21
case|:
case|case
name|Mips
operator|::
name|D21_64
case|:
return|return
literal|21
return|;
case|case
name|Mips
operator|::
name|S6
case|:
case|case
name|Mips
operator|::
name|S6_64
case|:
case|case
name|Mips
operator|::
name|F22
case|:
case|case
name|Mips
operator|::
name|D22_64
case|:
case|case
name|Mips
operator|::
name|D11
case|:
return|return
literal|22
return|;
case|case
name|Mips
operator|::
name|S7
case|:
case|case
name|Mips
operator|::
name|S7_64
case|:
case|case
name|Mips
operator|::
name|F23
case|:
case|case
name|Mips
operator|::
name|D23_64
case|:
return|return
literal|23
return|;
case|case
name|Mips
operator|::
name|T8
case|:
case|case
name|Mips
operator|::
name|T8_64
case|:
case|case
name|Mips
operator|::
name|F24
case|:
case|case
name|Mips
operator|::
name|D24_64
case|:
case|case
name|Mips
operator|::
name|D12
case|:
return|return
literal|24
return|;
case|case
name|Mips
operator|::
name|T9
case|:
case|case
name|Mips
operator|::
name|T9_64
case|:
case|case
name|Mips
operator|::
name|F25
case|:
case|case
name|Mips
operator|::
name|D25_64
case|:
return|return
literal|25
return|;
case|case
name|Mips
operator|::
name|K0
case|:
case|case
name|Mips
operator|::
name|K0_64
case|:
case|case
name|Mips
operator|::
name|F26
case|:
case|case
name|Mips
operator|::
name|D26_64
case|:
case|case
name|Mips
operator|::
name|D13
case|:
return|return
literal|26
return|;
case|case
name|Mips
operator|::
name|K1
case|:
case|case
name|Mips
operator|::
name|K1_64
case|:
case|case
name|Mips
operator|::
name|F27
case|:
case|case
name|Mips
operator|::
name|D27_64
case|:
return|return
literal|27
return|;
case|case
name|Mips
operator|::
name|GP
case|:
case|case
name|Mips
operator|::
name|GP_64
case|:
case|case
name|Mips
operator|::
name|F28
case|:
case|case
name|Mips
operator|::
name|D28_64
case|:
case|case
name|Mips
operator|::
name|D14
case|:
return|return
literal|28
return|;
case|case
name|Mips
operator|::
name|SP
case|:
case|case
name|Mips
operator|::
name|SP_64
case|:
case|case
name|Mips
operator|::
name|F29
case|:
case|case
name|Mips
operator|::
name|D29_64
case|:
case|case
name|Mips
operator|::
name|HWR29
case|:
return|return
literal|29
return|;
case|case
name|Mips
operator|::
name|FP
case|:
case|case
name|Mips
operator|::
name|FP_64
case|:
case|case
name|Mips
operator|::
name|F30
case|:
case|case
name|Mips
operator|::
name|D30_64
case|:
case|case
name|Mips
operator|::
name|D15
case|:
return|return
literal|30
return|;
case|case
name|Mips
operator|::
name|RA
case|:
case|case
name|Mips
operator|::
name|RA_64
case|:
case|case
name|Mips
operator|::
name|F31
case|:
case|case
name|Mips
operator|::
name|D31_64
case|:
return|return
literal|31
return|;
default|default:
name|llvm_unreachable
argument_list|(
literal|"Unknown register number!"
argument_list|)
expr_stmt|;
block|}
block|}
specifier|inline
specifier|static
name|std
operator|::
name|pair
operator|<
specifier|const
name|MCSymbolRefExpr
operator|*
operator|,
name|int64_t
operator|>
name|MipsGetSymAndOffset
argument_list|(
argument|const MCFixup&Fixup
argument_list|)
block|{
name|MCFixupKind
name|FixupKind
operator|=
name|Fixup
operator|.
name|getKind
argument_list|()
block|;
if|if
condition|(
operator|(
name|FixupKind
operator|<
name|FirstTargetFixupKind
operator|)
operator|||
operator|(
name|FixupKind
operator|>=
name|MCFixupKind
argument_list|(
name|Mips
operator|::
name|LastTargetFixupKind
argument_list|)
operator|)
condition|)
return|return
name|std
operator|::
name|make_pair
argument_list|(
operator|(
specifier|const
name|MCSymbolRefExpr
operator|*
operator|)
literal|0
argument_list|,
operator|(
name|int64_t
operator|)
literal|0
argument_list|)
return|;
specifier|const
name|MCExpr
operator|*
name|Expr
operator|=
name|Fixup
operator|.
name|getValue
argument_list|()
expr_stmt|;
name|MCExpr
operator|::
name|ExprKind
name|Kind
operator|=
name|Expr
operator|->
name|getKind
argument_list|()
expr_stmt|;
if|if
condition|(
name|Kind
operator|==
name|MCExpr
operator|::
name|Binary
condition|)
block|{
specifier|const
name|MCBinaryExpr
modifier|*
name|BE
init|=
name|static_cast
operator|<
specifier|const
name|MCBinaryExpr
operator|*
operator|>
operator|(
name|Expr
operator|)
decl_stmt|;
specifier|const
name|MCExpr
modifier|*
name|LHS
init|=
name|BE
operator|->
name|getLHS
argument_list|()
decl_stmt|;
specifier|const
name|MCConstantExpr
modifier|*
name|CE
init|=
name|dyn_cast
operator|<
name|MCConstantExpr
operator|>
operator|(
name|BE
operator|->
name|getRHS
argument_list|()
operator|)
decl_stmt|;
if|if
condition|(
operator|(
name|LHS
operator|->
name|getKind
argument_list|()
operator|!=
name|MCExpr
operator|::
name|SymbolRef
operator|)
operator|||
operator|!
name|CE
condition|)
return|return
name|std
operator|::
name|make_pair
argument_list|(
operator|(
specifier|const
name|MCSymbolRefExpr
operator|*
operator|)
literal|0
argument_list|,
operator|(
name|int64_t
operator|)
literal|0
argument_list|)
return|;
return|return
name|std
operator|::
name|make_pair
argument_list|(
name|cast
operator|<
name|MCSymbolRefExpr
operator|>
operator|(
name|LHS
operator|)
argument_list|,
name|CE
operator|->
name|getValue
argument_list|()
argument_list|)
return|;
block|}
if|if
condition|(
name|Kind
operator|!=
name|MCExpr
operator|::
name|SymbolRef
condition|)
return|return
name|std
operator|::
name|make_pair
argument_list|(
operator|(
specifier|const
name|MCSymbolRefExpr
operator|*
operator|)
literal|0
argument_list|,
operator|(
name|int64_t
operator|)
literal|0
argument_list|)
return|;
return|return
name|std
operator|::
name|make_pair
argument_list|(
name|cast
operator|<
name|MCSymbolRefExpr
operator|>
operator|(
name|Expr
operator|)
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_decl_stmt

begin_endif
unit|}
endif|#
directive|endif
end_endif

end_unit

