begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|//===-- DWARFCompileUnit.h --------------------------------------*- C++ -*-===//
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//                     The LLVM Compiler Infrastructure
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// This file is distributed under the University of Illinois Open Source
end_comment

begin_comment
comment|// License. See LICENSE.TXT for details.
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//===----------------------------------------------------------------------===//
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|SymbolFileDWARF_DWARFCompileUnit_h_
end_ifndef

begin_define
define|#
directive|define
name|SymbolFileDWARF_DWARFCompileUnit_h_
end_define

begin_include
include|#
directive|include
file|"lldb/lldb-enumerations.h"
end_include

begin_include
include|#
directive|include
file|"DWARFDebugInfoEntry.h"
end_include

begin_include
include|#
directive|include
file|"DWARFDIE.h"
end_include

begin_decl_stmt
name|class
name|NameToDIE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|class
name|SymbolFileDWARF
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|class
name|SymbolFileDWARFDwo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|class
name|DWARFCompileUnit
block|{
name|public
label|:
enum|enum
name|Producer
block|{
name|eProducerInvalid
init|=
literal|0
block|,
name|eProducerClang
block|,
name|eProducerGCC
block|,
name|eProducerLLVMGCC
block|,
name|eProcucerOther
block|}
enum|;
name|DWARFCompileUnit
argument_list|(
name|SymbolFileDWARF
operator|*
name|dwarf2Data
argument_list|)
expr_stmt|;
operator|~
name|DWARFCompileUnit
argument_list|()
expr_stmt|;
name|bool
name|Extract
argument_list|(
specifier|const
name|lldb_private
operator|::
name|DWARFDataExtractor
operator|&
name|debug_info
argument_list|,
name|lldb
operator|::
name|offset_t
operator|*
name|offset_ptr
argument_list|)
decl_stmt|;
name|size_t
name|ExtractDIEsIfNeeded
parameter_list|(
name|bool
name|cu_die_only
parameter_list|)
function_decl|;
name|DWARFDIE
name|LookupAddress
parameter_list|(
specifier|const
name|dw_addr_t
name|address
parameter_list|)
function_decl|;
name|size_t
name|AppendDIEsWithTag
argument_list|(
specifier|const
name|dw_tag_t
name|tag
argument_list|,
name|DWARFDIECollection
operator|&
name|matching_dies
argument_list|,
name|uint32_t
name|depth
operator|=
name|UINT32_MAX
argument_list|)
decl|const
decl_stmt|;
name|void
name|Clear
parameter_list|()
function_decl|;
name|bool
name|Verify
argument_list|(
name|lldb_private
operator|::
name|Stream
operator|*
name|s
argument_list|)
decl|const
decl_stmt|;
name|void
name|Dump
argument_list|(
name|lldb_private
operator|::
name|Stream
operator|*
name|s
argument_list|)
decl|const
decl_stmt|;
name|dw_offset_t
name|GetOffset
argument_list|()
specifier|const
block|{
return|return
name|m_offset
return|;
block|}
name|lldb
operator|::
name|user_id_t
name|GetID
argument_list|()
specifier|const
expr_stmt|;
name|uint32_t
name|Size
argument_list|()
specifier|const
block|{
return|return
name|m_is_dwarf64
operator|?
literal|23
operator|:
literal|11
return|;
comment|/* Size in bytes of the compile unit header */
block|}
name|bool
name|ContainsDIEOffset
argument_list|(
name|dw_offset_t
name|die_offset
argument_list|)
decl|const
block|{
return|return
name|die_offset
operator|>=
name|GetFirstDIEOffset
argument_list|()
operator|&&
name|die_offset
operator|<
name|GetNextCompileUnitOffset
argument_list|()
return|;
block|}
name|dw_offset_t
name|GetFirstDIEOffset
argument_list|()
specifier|const
block|{
return|return
name|m_offset
operator|+
name|Size
argument_list|()
return|;
block|}
name|dw_offset_t
name|GetNextCompileUnitOffset
argument_list|()
specifier|const
block|{
return|return
name|m_offset
operator|+
name|m_length
operator|+
operator|(
name|m_is_dwarf64
operator|?
literal|12
operator|:
literal|4
operator|)
return|;
block|}
name|size_t
name|GetDebugInfoSize
argument_list|()
specifier|const
block|{
return|return
name|m_length
operator|+
operator|(
name|m_is_dwarf64
operator|?
literal|12
operator|:
literal|4
operator|)
operator|-
name|Size
argument_list|()
return|;
comment|/* Size in bytes of the .debug_info data associated with this compile unit. */
block|}
name|uint32_t
name|GetLength
argument_list|()
specifier|const
block|{
return|return
name|m_length
return|;
block|}
name|uint16_t
name|GetVersion
argument_list|()
specifier|const
block|{
return|return
name|m_version
return|;
block|}
specifier|const
name|DWARFAbbreviationDeclarationSet
operator|*
name|GetAbbreviations
argument_list|()
specifier|const
block|{
return|return
name|m_abbrevs
return|;
block|}
name|dw_offset_t
name|GetAbbrevOffset
argument_list|()
specifier|const
expr_stmt|;
name|uint8_t
name|GetAddressByteSize
argument_list|()
specifier|const
block|{
return|return
name|m_addr_size
return|;
block|}
name|dw_addr_t
name|GetBaseAddress
argument_list|()
specifier|const
block|{
return|return
name|m_base_addr
return|;
block|}
name|dw_addr_t
name|GetAddrBase
argument_list|()
specifier|const
block|{
return|return
name|m_addr_base
return|;
block|}
name|void
name|SetAddrBase
parameter_list|(
name|dw_addr_t
name|addr_base
parameter_list|,
name|dw_offset_t
name|base_obj_offset
parameter_list|)
function_decl|;
name|void
name|ClearDIEs
parameter_list|(
name|bool
name|keep_compile_unit_die
parameter_list|)
function_decl|;
name|void
name|BuildAddressRangeTable
parameter_list|(
name|SymbolFileDWARF
modifier|*
name|dwarf2Data
parameter_list|,
name|DWARFDebugAranges
modifier|*
name|debug_aranges
parameter_list|)
function_decl|;
name|lldb
operator|::
name|ByteOrder
name|GetByteOrder
argument_list|()
specifier|const
expr_stmt|;
name|lldb_private
operator|::
name|TypeSystem
operator|*
name|GetTypeSystem
argument_list|()
expr_stmt|;
name|DWARFFormValue
operator|::
name|FixedFormSizes
name|GetFixedFormSizes
argument_list|()
expr_stmt|;
name|void
name|SetBaseAddress
parameter_list|(
name|dw_addr_t
name|base_addr
parameter_list|)
block|{
name|m_base_addr
operator|=
name|base_addr
expr_stmt|;
block|}
name|DWARFDIE
name|GetCompileUnitDIEOnly
parameter_list|()
block|{
return|return
name|DWARFDIE
argument_list|(
name|this
argument_list|,
name|GetCompileUnitDIEPtrOnly
argument_list|()
argument_list|)
return|;
block|}
name|DWARFDIE
name|DIE
parameter_list|()
block|{
return|return
name|DWARFDIE
argument_list|(
name|this
argument_list|,
name|DIEPtr
argument_list|()
argument_list|)
return|;
block|}
name|void
name|AddDIE
parameter_list|(
name|DWARFDebugInfoEntry
modifier|&
name|die
parameter_list|)
block|{
comment|// The average bytes per DIE entry has been seen to be
comment|// around 14-20 so lets pre-reserve half of that since
comment|// we are now stripping the NULL tags.
comment|// Only reserve the memory if we are adding children of
comment|// the main compile unit DIE. The compile unit DIE is always
comment|// the first entry, so if our size is 1, then we are adding
comment|// the first compile unit child DIE and should reserve
comment|// the memory.
if|if
condition|(
name|m_die_array
operator|.
name|empty
argument_list|()
condition|)
name|m_die_array
operator|.
name|reserve
argument_list|(
name|GetDebugInfoSize
argument_list|()
operator|/
literal|24
argument_list|)
expr_stmt|;
name|m_die_array
operator|.
name|push_back
argument_list|(
name|die
argument_list|)
expr_stmt|;
block|}
name|void
name|AddCompileUnitDIE
parameter_list|(
name|DWARFDebugInfoEntry
modifier|&
name|die
parameter_list|)
function_decl|;
name|bool
name|HasDIEsParsed
argument_list|()
specifier|const
block|{
return|return
name|m_die_array
operator|.
name|size
argument_list|()
operator|>
literal|1
return|;
block|}
name|DWARFDIE
name|GetDIE
parameter_list|(
name|dw_offset_t
name|die_offset
parameter_list|)
function_decl|;
specifier|static
name|uint8_t
name|GetAddressByteSize
parameter_list|(
specifier|const
name|DWARFCompileUnit
modifier|*
name|cu
parameter_list|)
function_decl|;
specifier|static
name|bool
name|IsDWARF64
parameter_list|(
specifier|const
name|DWARFCompileUnit
modifier|*
name|cu
parameter_list|)
function_decl|;
specifier|static
name|uint8_t
name|GetDefaultAddressSize
parameter_list|()
function_decl|;
specifier|static
name|void
name|SetDefaultAddressSize
parameter_list|(
name|uint8_t
name|addr_size
parameter_list|)
function_decl|;
name|void
operator|*
name|GetUserData
argument_list|()
specifier|const
block|{
return|return
name|m_user_data
return|;
block|}
name|void
name|SetUserData
parameter_list|(
name|void
modifier|*
name|d
parameter_list|)
function_decl|;
name|bool
name|Supports_DW_AT_APPLE_objc_complete_type
parameter_list|()
function_decl|;
name|bool
name|DW_AT_decl_file_attributes_are_invalid
parameter_list|()
function_decl|;
name|bool
name|Supports_unnamed_objc_bitfields
parameter_list|()
function_decl|;
name|void
name|Index
parameter_list|(
name|NameToDIE
modifier|&
name|func_basenames
parameter_list|,
name|NameToDIE
modifier|&
name|func_fullnames
parameter_list|,
name|NameToDIE
modifier|&
name|func_methods
parameter_list|,
name|NameToDIE
modifier|&
name|func_selectors
parameter_list|,
name|NameToDIE
modifier|&
name|objc_class_selectors
parameter_list|,
name|NameToDIE
modifier|&
name|globals
parameter_list|,
name|NameToDIE
modifier|&
name|types
parameter_list|,
name|NameToDIE
modifier|&
name|namespaces
parameter_list|)
function_decl|;
specifier|const
name|DWARFDebugAranges
modifier|&
name|GetFunctionAranges
parameter_list|()
function_decl|;
name|SymbolFileDWARF
operator|*
name|GetSymbolFileDWARF
argument_list|()
specifier|const
block|{
return|return
name|m_dwarf2Data
return|;
block|}
name|Producer
name|GetProducer
parameter_list|()
function_decl|;
name|uint32_t
name|GetProducerVersionMajor
parameter_list|()
function_decl|;
name|uint32_t
name|GetProducerVersionMinor
parameter_list|()
function_decl|;
name|uint32_t
name|GetProducerVersionUpdate
parameter_list|()
function_decl|;
specifier|static
name|lldb
operator|::
name|LanguageType
name|LanguageTypeFromDWARF
argument_list|(
argument|uint64_t val
argument_list|)
expr_stmt|;
name|lldb
operator|::
name|LanguageType
name|GetLanguageType
argument_list|()
expr_stmt|;
name|bool
name|IsDWARF64
argument_list|()
specifier|const
expr_stmt|;
name|bool
name|GetIsOptimized
parameter_list|()
function_decl|;
name|SymbolFileDWARFDwo
operator|*
name|GetDwoSymbolFile
argument_list|()
specifier|const
block|{
return|return
name|m_dwo_symbol_file
operator|.
name|get
argument_list|()
return|;
block|}
name|dw_offset_t
name|GetBaseObjOffset
argument_list|()
specifier|const
block|{
return|return
name|m_base_obj_offset
return|;
block|}
name|protected
label|:
name|SymbolFileDWARF
modifier|*
name|m_dwarf2Data
decl_stmt|;
name|std
operator|::
name|unique_ptr
operator|<
name|SymbolFileDWARFDwo
operator|>
name|m_dwo_symbol_file
expr_stmt|;
specifier|const
name|DWARFAbbreviationDeclarationSet
modifier|*
name|m_abbrevs
decl_stmt|;
name|void
modifier|*
name|m_user_data
decl_stmt|;
name|DWARFDebugInfoEntry
operator|::
name|collection
name|m_die_array
expr_stmt|;
comment|// The compile unit debug information entry item
name|std
operator|::
name|unique_ptr
operator|<
name|DWARFDebugAranges
operator|>
name|m_func_aranges_ap
expr_stmt|;
comment|// A table similar to the .debug_aranges table, but this one points to the exact DW_TAG_subprogram DIEs
name|dw_addr_t
name|m_base_addr
decl_stmt|;
name|dw_offset_t
name|m_offset
decl_stmt|;
name|dw_offset_t
name|m_length
decl_stmt|;
name|uint16_t
name|m_version
decl_stmt|;
name|uint8_t
name|m_addr_size
decl_stmt|;
name|Producer
name|m_producer
decl_stmt|;
name|uint32_t
name|m_producer_version_major
decl_stmt|;
name|uint32_t
name|m_producer_version_minor
decl_stmt|;
name|uint32_t
name|m_producer_version_update
decl_stmt|;
name|lldb
operator|::
name|LanguageType
name|m_language_type
expr_stmt|;
name|bool
name|m_is_dwarf64
decl_stmt|;
name|lldb_private
operator|::
name|LazyBool
name|m_is_optimized
expr_stmt|;
name|dw_addr_t
name|m_addr_base
decl_stmt|;
comment|// Value of DW_AT_addr_base
name|dw_offset_t
name|m_base_obj_offset
decl_stmt|;
comment|// If this is a dwo compile unit this is the offset of
comment|// the base compile unit in the main object file
name|void
name|ParseProducerInfo
parameter_list|()
function_decl|;
specifier|static
name|void
name|IndexPrivate
argument_list|(
name|DWARFCompileUnit
operator|*
name|dwarf_cu
argument_list|,
specifier|const
name|lldb
operator|::
name|LanguageType
name|cu_language
argument_list|,
specifier|const
name|DWARFFormValue
operator|::
name|FixedFormSizes
operator|&
name|fixed_form_sizes
argument_list|,
specifier|const
name|dw_offset_t
name|cu_offset
argument_list|,
name|NameToDIE
operator|&
name|func_basenames
argument_list|,
name|NameToDIE
operator|&
name|func_fullnames
argument_list|,
name|NameToDIE
operator|&
name|func_methods
argument_list|,
name|NameToDIE
operator|&
name|func_selectors
argument_list|,
name|NameToDIE
operator|&
name|objc_class_selectors
argument_list|,
name|NameToDIE
operator|&
name|globals
argument_list|,
name|NameToDIE
operator|&
name|types
argument_list|,
name|NameToDIE
operator|&
name|namespaces
argument_list|)
decl_stmt|;
name|private
label|:
specifier|const
name|DWARFDebugInfoEntry
modifier|*
name|GetCompileUnitDIEPtrOnly
parameter_list|()
block|{
name|ExtractDIEsIfNeeded
argument_list|(
name|true
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_die_array
operator|.
name|empty
argument_list|()
condition|)
return|return
name|NULL
return|;
return|return
operator|&
name|m_die_array
index|[
literal|0
index|]
return|;
block|}
specifier|const
name|DWARFDebugInfoEntry
modifier|*
name|DIEPtr
parameter_list|()
block|{
name|ExtractDIEsIfNeeded
argument_list|(
name|false
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_die_array
operator|.
name|empty
argument_list|()
condition|)
return|return
name|NULL
return|;
return|return
operator|&
name|m_die_array
index|[
literal|0
index|]
return|;
block|}
name|DISALLOW_COPY_AND_ASSIGN
argument_list|(
name|DWARFCompileUnit
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_empty_stmt
empty_stmt|;
end_empty_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|// SymbolFileDWARF_DWARFCompileUnit_h_
end_comment

end_unit

