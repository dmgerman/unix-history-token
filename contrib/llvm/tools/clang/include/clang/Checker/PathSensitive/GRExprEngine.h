begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|//===-- GRExprEngine.h - Path-Sensitive Expression-Level Dataflow ---*- C++ -*-=
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//                     The LLVM Compiler Infrastructure
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// This file is distributed under the University of Illinois Open Source
end_comment

begin_comment
comment|// License. See LICENSE.TXT for details.
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//===----------------------------------------------------------------------===//
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//  This file defines a meta-engine for path-sensitive dataflow analysis that
end_comment

begin_comment
comment|//  is built on GRCoreEngine, but provides the boilerplate to execute transfer
end_comment

begin_comment
comment|//  functions and build the ExplodedGraph at the expression level.
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//===----------------------------------------------------------------------===//
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|LLVM_CLANG_ANALYSIS_GREXPRENGINE
end_ifndef

begin_define
define|#
directive|define
name|LLVM_CLANG_ANALYSIS_GREXPRENGINE
end_define

begin_include
include|#
directive|include
file|"clang/Checker/PathSensitive/AnalysisManager.h"
end_include

begin_include
include|#
directive|include
file|"clang/Checker/PathSensitive/GRSubEngine.h"
end_include

begin_include
include|#
directive|include
file|"clang/Checker/PathSensitive/GRCoreEngine.h"
end_include

begin_include
include|#
directive|include
file|"clang/Checker/PathSensitive/GRState.h"
end_include

begin_include
include|#
directive|include
file|"clang/Checker/PathSensitive/GRSimpleAPICheck.h"
end_include

begin_include
include|#
directive|include
file|"clang/Checker/PathSensitive/GRTransferFuncs.h"
end_include

begin_include
include|#
directive|include
file|"clang/Checker/BugReporter/BugReporter.h"
end_include

begin_include
include|#
directive|include
file|"clang/AST/Type.h"
end_include

begin_include
include|#
directive|include
file|"clang/AST/ExprObjC.h"
end_include

begin_include
include|#
directive|include
file|"clang/AST/ExprCXX.h"
end_include

begin_decl_stmt
name|namespace
name|clang
block|{
name|class
name|AnalysisManager
decl_stmt|;
name|class
name|Checker
decl_stmt|;
name|class
name|ObjCForCollectionStmt
decl_stmt|;
name|class
name|GRExprEngine
range|:
name|public
name|GRSubEngine
block|{
name|AnalysisManager
operator|&
name|AMgr
block|;
name|GRCoreEngine
name|CoreEngine
block|;
comment|/// G - the simulation graph.
name|ExplodedGraph
operator|&
name|G
block|;
comment|/// Builder - The current GRStmtNodeBuilder which is used when building the
comment|///  nodes for a given statement.
name|GRStmtNodeBuilder
operator|*
name|Builder
block|;
comment|/// StateMgr - Object that manages the data for all created states.
name|GRStateManager
name|StateMgr
block|;
comment|/// SymMgr - Object that manages the symbol information.
name|SymbolManager
operator|&
name|SymMgr
block|;
comment|/// ValMgr - Object that manages/creates SVals.
name|ValueManager
operator|&
name|ValMgr
block|;
comment|/// SVator - SValuator object that creates SVals from expressions.
name|SValuator
operator|&
name|SVator
block|;
comment|/// EntryNode - The immediate predecessor node.
name|ExplodedNode
operator|*
name|EntryNode
block|;
comment|/// CleanedState - The state for EntryNode "cleaned" of all dead
comment|///  variables and symbols (as determined by a liveness analysis).
specifier|const
name|GRState
operator|*
name|CleanedState
block|;
comment|/// CurrentStmt - The current block-level statement.
specifier|const
name|Stmt
operator|*
name|CurrentStmt
block|;
comment|// Obj-C Class Identifiers.
name|IdentifierInfo
operator|*
name|NSExceptionII
block|;
comment|// Obj-C Selectors.
name|Selector
operator|*
name|NSExceptionInstanceRaiseSelectors
block|;
name|Selector
name|RaiseSel
block|;
name|llvm
operator|::
name|OwningPtr
operator|<
name|GRSimpleAPICheck
operator|>
name|BatchAuditor
block|;    enum
name|CallbackKind
block|{
name|PreVisitStmtCallback
block|,
name|PostVisitStmtCallback
block|,
name|ProcessAssumeCallback
block|,
name|EvalRegionChangesCallback
block|}
block|;
typedef|typedef
name|uint32_t
name|CallbackTag
typedef|;
comment|/// GetCallbackTag - Create a tag for a certain kind of callback. The 'Sub'
comment|///  argument can be used to differentiate callbacks that depend on another
comment|///  value from a small set of possibilities, such as statement classes.
specifier|static
specifier|inline
name|CallbackTag
name|GetCallbackTag
argument_list|(
argument|CallbackKind K
argument_list|,
argument|uint32_t Sub =
literal|0
argument_list|)
block|{
name|assert
argument_list|(
name|Sub
operator|==
operator|(
operator|(
name|Sub
operator|<<
literal|8
operator|)
operator|>>
literal|8
operator|)
operator|&&
literal|"Tag sub-kind must fit into 24 bits"
argument_list|)
block|;
return|return
name|K
operator||
operator|(
name|Sub
operator|<<
literal|8
operator|)
return|;
block|}
typedef|typedef
name|llvm
operator|::
name|DenseMap
operator|<
name|void
operator|*
operator|,
name|unsigned
operator|>
name|CheckerMap
expr_stmt|;
typedef|typedef
name|std
operator|::
name|vector
operator|<
name|std
operator|::
name|pair
operator|<
name|void
operator|*
operator|,
name|Checker
operator|*
operator|>
expr|>
name|CheckersOrdered
expr_stmt|;
typedef|typedef
name|llvm
operator|::
name|DenseMap
operator|<
name|CallbackTag
operator|,
name|CheckersOrdered
operator|*
operator|>
name|CheckersOrderedCache
expr_stmt|;
comment|/// A registration map from checker tag to the index into the
comment|///  ordered checkers vector.
name|CheckerMap
name|CheckerM
decl_stmt|;
comment|/// An ordered vector of checkers that are called when evaluating
comment|///  various expressions and statements.
name|CheckersOrdered
name|Checkers
decl_stmt|;
comment|/// A map used for caching the checkers that respond to the callback for
comment|///  a particular callback tag.
name|CheckersOrderedCache
name|COCache
decl_stmt|;
comment|/// The BugReporter associated with this engine.  It is important that
comment|///  this object be placed at the very end of member variables so that its
comment|///  destructor is called before the rest of the GRExprEngine is destroyed.
name|GRBugReporter
name|BR
decl_stmt|;
name|llvm
operator|::
name|OwningPtr
operator|<
name|GRTransferFuncs
operator|>
name|TF
expr_stmt|;
name|class
name|CallExprWLItem
block|{
name|public
label|:
name|CallExpr
operator|::
name|const_arg_iterator
name|I
expr_stmt|;
name|ExplodedNode
modifier|*
name|N
decl_stmt|;
name|CallExprWLItem
argument_list|(
specifier|const
name|CallExpr
operator|::
name|const_arg_iterator
operator|&
name|i
argument_list|,
name|ExplodedNode
operator|*
name|n
argument_list|)
operator|:
name|I
argument_list|(
name|i
argument_list|)
operator|,
name|N
argument_list|(
argument|n
argument_list|)
block|{}
block|}
empty_stmt|;
name|public
label|:
name|GRExprEngine
argument_list|(
name|AnalysisManager
operator|&
name|mgr
argument_list|,
name|GRTransferFuncs
operator|*
name|tf
argument_list|)
expr_stmt|;
operator|~
name|GRExprEngine
argument_list|()
expr_stmt|;
name|void
name|ExecuteWorkList
parameter_list|(
specifier|const
name|LocationContext
modifier|*
name|L
parameter_list|,
name|unsigned
name|Steps
init|=
literal|150000
parameter_list|)
block|{
name|CoreEngine
operator|.
name|ExecuteWorkList
argument_list|(
name|L
argument_list|,
name|Steps
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
comment|/// Execute the work list with an initial state. Nodes that reaches the exit
comment|/// of the function are added into the Dst set, which represent the exit
comment|/// state of the function call.
name|void
name|ExecuteWorkListWithInitialState
parameter_list|(
specifier|const
name|LocationContext
modifier|*
name|L
parameter_list|,
name|unsigned
name|Steps
parameter_list|,
specifier|const
name|GRState
modifier|*
name|InitState
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
block|{
name|CoreEngine
operator|.
name|ExecuteWorkListWithInitialState
argument_list|(
name|L
argument_list|,
name|Steps
argument_list|,
name|InitState
argument_list|,
name|Dst
argument_list|)
expr_stmt|;
block|}
comment|/// getContext - Return the ASTContext associated with this analysis.
name|ASTContext
operator|&
name|getContext
argument_list|()
specifier|const
block|{
return|return
name|AMgr
operator|.
name|getASTContext
argument_list|()
return|;
block|}
name|virtual
name|AnalysisManager
modifier|&
name|getAnalysisManager
parameter_list|()
block|{
return|return
name|AMgr
return|;
block|}
name|SValuator
modifier|&
name|getSValuator
parameter_list|()
block|{
return|return
name|SVator
return|;
block|}
name|GRTransferFuncs
modifier|&
name|getTF
parameter_list|()
block|{
return|return
operator|*
name|TF
return|;
block|}
name|BugReporter
modifier|&
name|getBugReporter
parameter_list|()
block|{
return|return
name|BR
return|;
block|}
name|GRStmtNodeBuilder
modifier|&
name|getBuilder
parameter_list|()
block|{
name|assert
argument_list|(
name|Builder
argument_list|)
expr_stmt|;
return|return
operator|*
name|Builder
return|;
block|}
comment|// FIXME: Remove once GRTransferFuncs is no longer referenced.
name|void
name|setTransferFunction
parameter_list|(
name|GRTransferFuncs
modifier|*
name|tf
parameter_list|)
function_decl|;
comment|/// ViewGraph - Visualize the ExplodedGraph created by executing the
comment|///  simulation.
name|void
name|ViewGraph
parameter_list|(
name|bool
name|trim
init|=
name|false
parameter_list|)
function_decl|;
name|void
name|ViewGraph
parameter_list|(
name|ExplodedNode
modifier|*
modifier|*
name|Beg
parameter_list|,
name|ExplodedNode
modifier|*
modifier|*
name|End
parameter_list|)
function_decl|;
comment|/// getInitialState - Return the initial state used for the root vertex
comment|///  in the ExplodedGraph.
specifier|const
name|GRState
modifier|*
name|getInitialState
parameter_list|(
specifier|const
name|LocationContext
modifier|*
name|InitLoc
parameter_list|)
function_decl|;
name|ExplodedGraph
modifier|&
name|getGraph
parameter_list|()
block|{
return|return
name|G
return|;
block|}
specifier|const
name|ExplodedGraph
operator|&
name|getGraph
argument_list|()
specifier|const
block|{
return|return
name|G
return|;
block|}
name|template
operator|<
name|typename
name|CHECKER
operator|>
name|void
name|registerCheck
argument_list|(
argument|CHECKER *check
argument_list|)
block|{
name|unsigned
name|entry
operator|=
name|Checkers
operator|.
name|size
argument_list|()
block|;
name|void
operator|*
name|tag
operator|=
name|CHECKER
operator|::
name|getTag
argument_list|()
block|;
name|Checkers
operator|.
name|push_back
argument_list|(
name|std
operator|::
name|make_pair
argument_list|(
name|tag
argument_list|,
name|check
argument_list|)
argument_list|)
block|;
name|CheckerM
index|[
name|tag
index|]
operator|=
name|entry
block|;   }
name|Checker
operator|*
name|lookupChecker
argument_list|(
argument|void *tag
argument_list|)
specifier|const
expr_stmt|;
name|template
operator|<
name|typename
name|CHECKER
operator|>
name|CHECKER
operator|*
name|getChecker
argument_list|()
specifier|const
block|{
return|return
name|static_cast
operator|<
name|CHECKER
operator|*
operator|>
operator|(
name|lookupChecker
argument_list|(
name|CHECKER
operator|::
name|getTag
argument_list|()
argument_list|)
operator|)
return|;
block|}
name|void
name|AddCheck
argument_list|(
name|GRSimpleAPICheck
operator|*
name|A
argument_list|,
name|Stmt
operator|::
name|StmtClass
name|C
argument_list|)
decl_stmt|;
name|void
name|AddCheck
parameter_list|(
name|GRSimpleAPICheck
modifier|*
name|A
parameter_list|)
function_decl|;
comment|/// ProcessStmt - Called by GRCoreEngine. Used to generate new successor
comment|///  nodes by processing the 'effects' of a block-level statement.
name|void
name|ProcessStmt
parameter_list|(
specifier|const
name|CFGElement
name|E
parameter_list|,
name|GRStmtNodeBuilder
modifier|&
name|builder
parameter_list|)
function_decl|;
comment|/// ProcessBlockEntrance - Called by GRCoreEngine when start processing
comment|///  a CFGBlock.  This method returns true if the analysis should continue
comment|///  exploring the given path, and false otherwise.
name|bool
name|ProcessBlockEntrance
parameter_list|(
specifier|const
name|CFGBlock
modifier|*
name|B
parameter_list|,
specifier|const
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|GRBlockCounter
name|BC
parameter_list|)
function_decl|;
comment|/// ProcessBranch - Called by GRCoreEngine.  Used to generate successor
comment|///  nodes by processing the 'effects' of a branch condition.
name|void
name|ProcessBranch
parameter_list|(
specifier|const
name|Stmt
modifier|*
name|Condition
parameter_list|,
specifier|const
name|Stmt
modifier|*
name|Term
parameter_list|,
name|GRBranchNodeBuilder
modifier|&
name|builder
parameter_list|)
function_decl|;
comment|/// ProcessIndirectGoto - Called by GRCoreEngine.  Used to generate successor
comment|///  nodes by processing the 'effects' of a computed goto jump.
name|void
name|ProcessIndirectGoto
parameter_list|(
name|GRIndirectGotoNodeBuilder
modifier|&
name|builder
parameter_list|)
function_decl|;
comment|/// ProcessSwitch - Called by GRCoreEngine.  Used to generate successor
comment|///  nodes by processing the 'effects' of a switch statement.
name|void
name|ProcessSwitch
parameter_list|(
name|GRSwitchNodeBuilder
modifier|&
name|builder
parameter_list|)
function_decl|;
comment|/// ProcessEndPath - Called by GRCoreEngine.  Used to generate end-of-path
comment|///  nodes when the control reaches the end of a function.
name|void
name|ProcessEndPath
parameter_list|(
name|GREndPathNodeBuilder
modifier|&
name|builder
parameter_list|)
function_decl|;
comment|/// Generate the entry node of the callee.
name|void
name|ProcessCallEnter
parameter_list|(
name|GRCallEnterNodeBuilder
modifier|&
name|builder
parameter_list|)
function_decl|;
comment|/// Generate the first post callsite node.
name|void
name|ProcessCallExit
parameter_list|(
name|GRCallExitNodeBuilder
modifier|&
name|builder
parameter_list|)
function_decl|;
comment|/// Called by GRCoreEngine when the analysis worklist has terminated.
name|void
name|ProcessEndWorklist
parameter_list|(
name|bool
name|hasWorkRemaining
parameter_list|)
function_decl|;
comment|/// EvalAssume - Callback function invoked by the ConstraintManager when
comment|///  making assumptions about state values.
specifier|const
name|GRState
modifier|*
name|ProcessAssume
parameter_list|(
specifier|const
name|GRState
modifier|*
name|state
parameter_list|,
name|SVal
name|cond
parameter_list|,
name|bool
name|assumption
parameter_list|)
function_decl|;
comment|/// WantsRegionChangeUpdate - Called by GRStateManager to determine if a
comment|///  region change should trigger a ProcessRegionChanges update.
name|bool
name|WantsRegionChangeUpdate
parameter_list|(
specifier|const
name|GRState
modifier|*
name|state
parameter_list|)
function_decl|;
comment|/// ProcessRegionChanges - Called by GRStateManager whenever a change is made
comment|///  to the store. Used to update checkers that track region values.
specifier|const
name|GRState
modifier|*
name|ProcessRegionChanges
parameter_list|(
specifier|const
name|GRState
modifier|*
name|state
parameter_list|,
specifier|const
name|MemRegion
modifier|*
specifier|const
modifier|*
name|Begin
parameter_list|,
specifier|const
name|MemRegion
modifier|*
specifier|const
modifier|*
name|End
parameter_list|)
function_decl|;
name|virtual
name|GRStateManager
modifier|&
name|getStateManager
parameter_list|()
block|{
return|return
name|StateMgr
return|;
block|}
name|StoreManager
modifier|&
name|getStoreManager
parameter_list|()
block|{
return|return
name|StateMgr
operator|.
name|getStoreManager
argument_list|()
return|;
block|}
name|ConstraintManager
modifier|&
name|getConstraintManager
parameter_list|()
block|{
return|return
name|StateMgr
operator|.
name|getConstraintManager
argument_list|()
return|;
block|}
comment|// FIXME: Remove when we migrate over to just using ValueManager.
name|BasicValueFactory
modifier|&
name|getBasicVals
parameter_list|()
block|{
return|return
name|StateMgr
operator|.
name|getBasicVals
argument_list|()
return|;
block|}
specifier|const
name|BasicValueFactory
operator|&
name|getBasicVals
argument_list|()
specifier|const
block|{
return|return
name|StateMgr
operator|.
name|getBasicVals
argument_list|()
return|;
block|}
name|ValueManager
modifier|&
name|getValueManager
parameter_list|()
block|{
return|return
name|ValMgr
return|;
block|}
specifier|const
name|ValueManager
operator|&
name|getValueManager
argument_list|()
specifier|const
block|{
return|return
name|ValMgr
return|;
block|}
comment|// FIXME: Remove when we migrate over to just using ValueManager.
name|SymbolManager
modifier|&
name|getSymbolManager
parameter_list|()
block|{
return|return
name|SymMgr
return|;
block|}
specifier|const
name|SymbolManager
operator|&
name|getSymbolManager
argument_list|()
specifier|const
block|{
return|return
name|SymMgr
return|;
block|}
comment|// Functions for external checking of whether we have unfinished work
name|bool
name|wasBlockAborted
argument_list|()
specifier|const
block|{
return|return
name|CoreEngine
operator|.
name|wasBlockAborted
argument_list|()
return|;
block|}
name|bool
name|hasWorkRemaining
argument_list|()
specifier|const
block|{
return|return
name|wasBlockAborted
argument_list|()
operator|||
name|CoreEngine
operator|.
name|getWorkList
argument_list|()
operator|->
name|hasWork
argument_list|()
return|;
block|}
specifier|const
name|GRCoreEngine
operator|&
name|getCoreEngine
argument_list|()
specifier|const
block|{
return|return
name|CoreEngine
return|;
block|}
name|protected
label|:
specifier|const
name|GRState
modifier|*
name|GetState
parameter_list|(
name|ExplodedNode
modifier|*
name|N
parameter_list|)
block|{
return|return
name|N
operator|==
name|EntryNode
condition|?
name|CleanedState
else|:
name|N
operator|->
name|getState
argument_list|()
return|;
block|}
name|public
label|:
name|ExplodedNode
modifier|*
name|MakeNode
argument_list|(
name|ExplodedNodeSet
operator|&
name|Dst
argument_list|,
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
name|ExplodedNode
operator|*
name|Pred
argument_list|,
specifier|const
name|GRState
operator|*
name|St
argument_list|,
name|ProgramPoint
operator|::
name|Kind
name|K
operator|=
name|ProgramPoint
operator|::
name|PostStmtKind
argument_list|,
specifier|const
name|void
operator|*
name|tag
operator|=
literal|0
argument_list|)
decl_stmt|;
comment|/// CheckerVisit - Dispatcher for performing checker-specific logic
comment|///  at specific statements.
name|void
name|CheckerVisit
parameter_list|(
specifier|const
name|Stmt
modifier|*
name|S
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Src
parameter_list|,
name|CallbackKind
name|Kind
parameter_list|)
function_decl|;
name|bool
name|CheckerEvalCall
parameter_list|(
specifier|const
name|CallExpr
modifier|*
name|CE
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|)
function_decl|;
name|void
name|CheckerEvalNilReceiver
parameter_list|(
specifier|const
name|ObjCMessageExpr
modifier|*
name|ME
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
specifier|const
name|GRState
modifier|*
name|state
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|)
function_decl|;
name|void
name|CheckerVisitBind
parameter_list|(
specifier|const
name|Stmt
modifier|*
name|StoreE
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Src
parameter_list|,
name|SVal
name|location
parameter_list|,
name|SVal
name|val
parameter_list|,
name|bool
name|isPrevisit
parameter_list|)
function_decl|;
comment|/// Visit - Transfer function logic for all statements.  Dispatches to
comment|///  other functions that handle specific kinds of statements.
name|void
name|Visit
parameter_list|(
specifier|const
name|Stmt
modifier|*
name|S
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// VisitLValue - Evaluate the lvalue of the expression. For example, if Ex is
comment|/// a DeclRefExpr, it evaluates to the MemRegionVal which represents its
comment|/// storage location. Note that not all kinds of expressions has lvalue.
name|void
name|VisitLValue
parameter_list|(
specifier|const
name|Expr
modifier|*
name|Ex
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// VisitArraySubscriptExpr - Transfer function for array accesses.
name|void
name|VisitArraySubscriptExpr
parameter_list|(
specifier|const
name|ArraySubscriptExpr
modifier|*
name|Ex
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|bool
name|asLValue
parameter_list|)
function_decl|;
comment|/// VisitAsmStmt - Transfer function logic for inline asm.
name|void
name|VisitAsmStmt
parameter_list|(
specifier|const
name|AsmStmt
modifier|*
name|A
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
name|void
name|VisitAsmStmtHelperOutputs
argument_list|(
specifier|const
name|AsmStmt
operator|*
name|A
argument_list|,
name|AsmStmt
operator|::
name|const_outputs_iterator
name|I
argument_list|,
name|AsmStmt
operator|::
name|const_outputs_iterator
name|E
argument_list|,
name|ExplodedNode
operator|*
name|Pred
argument_list|,
name|ExplodedNodeSet
operator|&
name|Dst
argument_list|)
decl_stmt|;
name|void
name|VisitAsmStmtHelperInputs
argument_list|(
specifier|const
name|AsmStmt
operator|*
name|A
argument_list|,
name|AsmStmt
operator|::
name|const_inputs_iterator
name|I
argument_list|,
name|AsmStmt
operator|::
name|const_inputs_iterator
name|E
argument_list|,
name|ExplodedNode
operator|*
name|Pred
argument_list|,
name|ExplodedNodeSet
operator|&
name|Dst
argument_list|)
decl_stmt|;
comment|/// VisitBlockExpr - Transfer function logic for BlockExprs.
name|void
name|VisitBlockExpr
parameter_list|(
specifier|const
name|BlockExpr
modifier|*
name|BE
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// VisitBinaryOperator - Transfer function logic for binary operators.
name|void
name|VisitBinaryOperator
parameter_list|(
specifier|const
name|BinaryOperator
modifier|*
name|B
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|bool
name|asLValue
parameter_list|)
function_decl|;
comment|/// VisitCall - Transfer function for function calls.
name|void
name|VisitCall
argument_list|(
specifier|const
name|CallExpr
operator|*
name|CE
argument_list|,
name|ExplodedNode
operator|*
name|Pred
argument_list|,
name|CallExpr
operator|::
name|const_arg_iterator
name|AI
argument_list|,
name|CallExpr
operator|::
name|const_arg_iterator
name|AE
argument_list|,
name|ExplodedNodeSet
operator|&
name|Dst
argument_list|,
name|bool
name|asLValue
argument_list|)
decl_stmt|;
comment|/// VisitCast - Transfer function logic for all casts (implicit and explicit).
name|void
name|VisitCast
parameter_list|(
specifier|const
name|CastExpr
modifier|*
name|CastE
parameter_list|,
specifier|const
name|Expr
modifier|*
name|Ex
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|bool
name|asLValue
parameter_list|)
function_decl|;
comment|/// VisitCompoundLiteralExpr - Transfer function logic for compound literals.
name|void
name|VisitCompoundLiteralExpr
parameter_list|(
specifier|const
name|CompoundLiteralExpr
modifier|*
name|CL
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|bool
name|asLValue
parameter_list|)
function_decl|;
comment|/// VisitDeclRefExpr - Transfer function logic for DeclRefExprs.
name|void
name|VisitDeclRefExpr
parameter_list|(
specifier|const
name|DeclRefExpr
modifier|*
name|DR
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|bool
name|asLValue
parameter_list|)
function_decl|;
comment|/// VisitBlockDeclRefExpr - Transfer function logic for BlockDeclRefExprs.
name|void
name|VisitBlockDeclRefExpr
parameter_list|(
specifier|const
name|BlockDeclRefExpr
modifier|*
name|DR
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|bool
name|asLValue
parameter_list|)
function_decl|;
name|void
name|VisitCommonDeclRefExpr
parameter_list|(
specifier|const
name|Expr
modifier|*
name|DR
parameter_list|,
specifier|const
name|NamedDecl
modifier|*
name|D
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|bool
name|asLValue
parameter_list|)
function_decl|;
comment|/// VisitDeclStmt - Transfer function logic for DeclStmts.
name|void
name|VisitDeclStmt
parameter_list|(
specifier|const
name|DeclStmt
modifier|*
name|DS
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// VisitGuardedExpr - Transfer function logic for ?, __builtin_choose
name|void
name|VisitGuardedExpr
parameter_list|(
specifier|const
name|Expr
modifier|*
name|Ex
parameter_list|,
specifier|const
name|Expr
modifier|*
name|L
parameter_list|,
specifier|const
name|Expr
modifier|*
name|R
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// VisitCondInit - Transfer function for handling the initialization
comment|///  of a condition variable in an IfStmt, SwitchStmt, etc.
name|void
name|VisitCondInit
parameter_list|(
specifier|const
name|VarDecl
modifier|*
name|VD
parameter_list|,
specifier|const
name|Stmt
modifier|*
name|S
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
name|void
name|VisitInitListExpr
parameter_list|(
specifier|const
name|InitListExpr
modifier|*
name|E
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// VisitLogicalExpr - Transfer function logic for '&&', '||'
name|void
name|VisitLogicalExpr
parameter_list|(
specifier|const
name|BinaryOperator
modifier|*
name|B
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// VisitMemberExpr - Transfer function for member expressions.
name|void
name|VisitMemberExpr
parameter_list|(
specifier|const
name|MemberExpr
modifier|*
name|M
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|bool
name|asLValue
parameter_list|)
function_decl|;
comment|/// VisitObjCIvarRefExpr - Transfer function logic for ObjCIvarRefExprs.
name|void
name|VisitObjCIvarRefExpr
parameter_list|(
specifier|const
name|ObjCIvarRefExpr
modifier|*
name|DR
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|bool
name|asLValue
parameter_list|)
function_decl|;
comment|/// VisitObjCForCollectionStmt - Transfer function logic for
comment|///  ObjCForCollectionStmt.
name|void
name|VisitObjCForCollectionStmt
parameter_list|(
specifier|const
name|ObjCForCollectionStmt
modifier|*
name|S
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
name|void
name|VisitObjCForCollectionStmtAux
parameter_list|(
specifier|const
name|ObjCForCollectionStmt
modifier|*
name|S
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|SVal
name|ElementV
parameter_list|)
function_decl|;
comment|/// VisitObjCMessageExpr - Transfer function for ObjC message expressions.
name|void
name|VisitObjCMessageExpr
parameter_list|(
specifier|const
name|ObjCMessageExpr
modifier|*
name|ME
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|bool
name|asLValue
parameter_list|)
function_decl|;
comment|/// VisitReturnStmt - Transfer function logic for return statements.
name|void
name|VisitReturnStmt
parameter_list|(
specifier|const
name|ReturnStmt
modifier|*
name|R
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// VisitOffsetOfExpr - Transfer function for offsetof.
name|void
name|VisitOffsetOfExpr
parameter_list|(
specifier|const
name|OffsetOfExpr
modifier|*
name|Ex
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// VisitSizeOfAlignOfExpr - Transfer function for sizeof.
name|void
name|VisitSizeOfAlignOfExpr
parameter_list|(
specifier|const
name|SizeOfAlignOfExpr
modifier|*
name|Ex
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// VisitUnaryOperator - Transfer function logic for unary operators.
name|void
name|VisitUnaryOperator
parameter_list|(
specifier|const
name|UnaryOperator
modifier|*
name|B
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|bool
name|asLValue
parameter_list|)
function_decl|;
name|void
name|VisitCXXThisExpr
parameter_list|(
specifier|const
name|CXXThisExpr
modifier|*
name|TE
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
name|void
name|VisitCXXConstructExpr
parameter_list|(
specifier|const
name|CXXConstructExpr
modifier|*
name|E
parameter_list|,
name|SVal
name|Dest
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
name|void
name|VisitCXXMemberCallExpr
parameter_list|(
specifier|const
name|CXXMemberCallExpr
modifier|*
name|MCE
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
name|void
name|VisitCXXNewExpr
parameter_list|(
specifier|const
name|CXXNewExpr
modifier|*
name|CNE
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
name|void
name|VisitCXXDeleteExpr
parameter_list|(
specifier|const
name|CXXDeleteExpr
modifier|*
name|CDE
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
name|void
name|VisitAggExpr
parameter_list|(
specifier|const
name|Expr
modifier|*
name|E
parameter_list|,
name|SVal
name|Dest
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// Create a C++ temporary object for an rvalue.
name|void
name|CreateCXXTemporaryObject
parameter_list|(
specifier|const
name|Expr
modifier|*
name|Ex
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// Synthesize CXXThisRegion.
specifier|const
name|CXXThisRegion
modifier|*
name|getCXXThisRegion
parameter_list|(
specifier|const
name|CXXMethodDecl
modifier|*
name|MD
parameter_list|,
specifier|const
name|StackFrameContext
modifier|*
name|SFC
parameter_list|)
function_decl|;
comment|/// Evaluate arguments with a work list algorithm.
name|void
name|EvalArguments
parameter_list|(
name|ConstExprIterator
name|AI
parameter_list|,
name|ConstExprIterator
name|AE
parameter_list|,
specifier|const
name|FunctionProtoType
modifier|*
name|FnType
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|)
function_decl|;
comment|/// EvalEagerlyAssume - Given the nodes in 'Src', eagerly assume symbolic
comment|///  expressions of the form 'x != 0' and generate new nodes (stored in Dst)
comment|///  with those assumptions.
name|void
name|EvalEagerlyAssume
parameter_list|(
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
name|ExplodedNodeSet
modifier|&
name|Src
parameter_list|,
specifier|const
name|Expr
modifier|*
name|Ex
parameter_list|)
function_decl|;
name|SVal
name|EvalMinus
parameter_list|(
name|SVal
name|X
parameter_list|)
block|{
return|return
name|X
operator|.
name|isValid
argument_list|()
condition|?
name|SVator
operator|.
name|EvalMinus
argument_list|(
name|cast
operator|<
name|NonLoc
operator|>
operator|(
name|X
operator|)
argument_list|)
else|:
name|X
return|;
block|}
name|SVal
name|EvalComplement
parameter_list|(
name|SVal
name|X
parameter_list|)
block|{
return|return
name|X
operator|.
name|isValid
argument_list|()
condition|?
name|SVator
operator|.
name|EvalComplement
argument_list|(
name|cast
operator|<
name|NonLoc
operator|>
operator|(
name|X
operator|)
argument_list|)
else|:
name|X
return|;
block|}
name|public
label|:
name|SVal
name|EvalBinOp
argument_list|(
specifier|const
name|GRState
operator|*
name|state
argument_list|,
name|BinaryOperator
operator|::
name|Opcode
name|op
argument_list|,
name|NonLoc
name|L
argument_list|,
name|NonLoc
name|R
argument_list|,
name|QualType
name|T
argument_list|)
block|{
return|return
name|SVator
operator|.
name|EvalBinOpNN
argument_list|(
name|state
argument_list|,
name|op
argument_list|,
name|L
argument_list|,
name|R
argument_list|,
name|T
argument_list|)
return|;
block|}
name|SVal
name|EvalBinOp
argument_list|(
specifier|const
name|GRState
operator|*
name|state
argument_list|,
name|BinaryOperator
operator|::
name|Opcode
name|op
argument_list|,
name|NonLoc
name|L
argument_list|,
name|SVal
name|R
argument_list|,
name|QualType
name|T
argument_list|)
block|{
return|return
name|R
operator|.
name|isValid
argument_list|()
condition|?
name|SVator
operator|.
name|EvalBinOpNN
argument_list|(
name|state
argument_list|,
name|op
argument_list|,
name|L
argument_list|,
name|cast
operator|<
name|NonLoc
operator|>
operator|(
name|R
operator|)
argument_list|,
name|T
argument_list|)
else|:
name|R
return|;
block|}
name|SVal
name|EvalBinOp
argument_list|(
specifier|const
name|GRState
operator|*
name|ST
argument_list|,
name|BinaryOperator
operator|::
name|Opcode
name|Op
argument_list|,
name|SVal
name|LHS
argument_list|,
name|SVal
name|RHS
argument_list|,
name|QualType
name|T
argument_list|)
block|{
return|return
name|SVator
operator|.
name|EvalBinOp
argument_list|(
name|ST
argument_list|,
name|Op
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|T
argument_list|)
return|;
block|}
name|protected
label|:
name|void
name|EvalObjCMessageExpr
parameter_list|(
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
specifier|const
name|ObjCMessageExpr
modifier|*
name|ME
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
specifier|const
name|GRState
modifier|*
name|state
parameter_list|)
block|{
name|assert
argument_list|(
name|Builder
operator|&&
literal|"GRStmtNodeBuilder must be defined."
argument_list|)
expr_stmt|;
name|getTF
argument_list|()
operator|.
name|EvalObjCMessageExpr
argument_list|(
name|Dst
argument_list|,
operator|*
name|this
argument_list|,
operator|*
name|Builder
argument_list|,
name|ME
argument_list|,
name|Pred
argument_list|,
name|state
argument_list|)
expr_stmt|;
block|}
specifier|const
name|GRState
modifier|*
name|MarkBranch
parameter_list|(
specifier|const
name|GRState
modifier|*
name|St
parameter_list|,
specifier|const
name|Stmt
modifier|*
name|Terminator
parameter_list|,
name|bool
name|branchTaken
parameter_list|)
function_decl|;
comment|/// EvalBind - Handle the semantics of binding a value to a specific location.
comment|///  This method is used by EvalStore, VisitDeclStmt, and others.
name|void
name|EvalBind
parameter_list|(
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
specifier|const
name|Stmt
modifier|*
name|StoreE
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
specifier|const
name|GRState
modifier|*
name|St
parameter_list|,
name|SVal
name|location
parameter_list|,
name|SVal
name|Val
parameter_list|,
name|bool
name|atDeclInit
init|=
name|false
parameter_list|)
function_decl|;
name|public
label|:
comment|// FIXME: 'tag' should be removed, and a LocationContext should be used
comment|// instead.
name|void
name|EvalLoad
parameter_list|(
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
specifier|const
name|Expr
modifier|*
name|Ex
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
specifier|const
name|GRState
modifier|*
name|St
parameter_list|,
name|SVal
name|location
parameter_list|,
specifier|const
name|void
modifier|*
name|tag
init|=
literal|0
parameter_list|,
name|QualType
name|LoadTy
init|=
name|QualType
argument_list|()
parameter_list|)
function_decl|;
comment|// FIXME: 'tag' should be removed, and a LocationContext should be used
comment|// instead.
name|void
name|EvalStore
parameter_list|(
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
specifier|const
name|Expr
modifier|*
name|AssignE
parameter_list|,
specifier|const
name|Expr
modifier|*
name|StoreE
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
specifier|const
name|GRState
modifier|*
name|St
parameter_list|,
name|SVal
name|TargetLV
parameter_list|,
name|SVal
name|Val
parameter_list|,
specifier|const
name|void
modifier|*
name|tag
init|=
literal|0
parameter_list|)
function_decl|;
name|private
label|:
name|void
name|EvalLoadCommon
parameter_list|(
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
specifier|const
name|Expr
modifier|*
name|Ex
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
specifier|const
name|GRState
modifier|*
name|St
parameter_list|,
name|SVal
name|location
parameter_list|,
specifier|const
name|void
modifier|*
name|tag
parameter_list|,
name|QualType
name|LoadTy
parameter_list|)
function_decl|;
comment|// FIXME: 'tag' should be removed, and a LocationContext should be used
comment|// instead.
name|void
name|EvalLocation
parameter_list|(
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
specifier|const
name|Stmt
modifier|*
name|S
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|,
specifier|const
name|GRState
modifier|*
name|St
parameter_list|,
name|SVal
name|location
parameter_list|,
specifier|const
name|void
modifier|*
name|tag
parameter_list|,
name|bool
name|isLoad
parameter_list|)
function_decl|;
name|bool
name|InlineCall
parameter_list|(
name|ExplodedNodeSet
modifier|&
name|Dst
parameter_list|,
specifier|const
name|CallExpr
modifier|*
name|CE
parameter_list|,
name|ExplodedNode
modifier|*
name|Pred
parameter_list|)
function_decl|;
block|}
end_decl_stmt

begin_empty_stmt
empty_stmt|;
end_empty_stmt

begin_comment
unit|}
comment|// end clang namespace
end_comment

begin_endif
endif|#
directive|endif
end_endif

end_unit

