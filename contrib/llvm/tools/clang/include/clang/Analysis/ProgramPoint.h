begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|//==- ProgramPoint.h - Program Points for Path-Sensitive Analysis --*- C++ -*-//
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//                     The LLVM Compiler Infrastructure
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// This file is distributed under the University of Illinois Open Source
end_comment

begin_comment
comment|// License. See LICENSE.TXT for details.
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//===----------------------------------------------------------------------===//
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//  This file defines the interface ProgramPoint, which identifies a
end_comment

begin_comment
comment|//  distinct location in a function.
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//===----------------------------------------------------------------------===//
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|LLVM_CLANG_ANALYSIS_PROGRAM_POINT
end_ifndef

begin_define
define|#
directive|define
name|LLVM_CLANG_ANALYSIS_PROGRAM_POINT
end_define

begin_include
include|#
directive|include
file|"clang/Analysis/AnalysisContext.h"
end_include

begin_include
include|#
directive|include
file|"clang/Analysis/CFG.h"
end_include

begin_include
include|#
directive|include
file|"llvm/ADT/DenseMap.h"
end_include

begin_include
include|#
directive|include
file|"llvm/ADT/FoldingSet.h"
end_include

begin_include
include|#
directive|include
file|"llvm/ADT/Optional.h"
end_include

begin_include
include|#
directive|include
file|"llvm/ADT/PointerIntPair.h"
end_include

begin_include
include|#
directive|include
file|"llvm/ADT/StringRef.h"
end_include

begin_include
include|#
directive|include
file|"llvm/Support/Casting.h"
end_include

begin_include
include|#
directive|include
file|"llvm/Support/DataTypes.h"
end_include

begin_include
include|#
directive|include
file|<cassert>
end_include

begin_include
include|#
directive|include
file|<string>
end_include

begin_include
include|#
directive|include
file|<utility>
end_include

begin_decl_stmt
name|namespace
name|clang
block|{
name|class
name|AnalysisDeclContext
decl_stmt|;
name|class
name|FunctionDecl
decl_stmt|;
name|class
name|LocationContext
decl_stmt|;
name|class
name|ProgramPointTag
decl_stmt|;
name|class
name|ProgramPoint
block|{
name|public
label|:
enum|enum
name|Kind
block|{
name|BlockEdgeKind
block|,
name|BlockEntranceKind
block|,
name|BlockExitKind
block|,
name|PreStmtKind
block|,
name|PreStmtPurgeDeadSymbolsKind
block|,
name|PostStmtPurgeDeadSymbolsKind
block|,
name|PostStmtKind
block|,
name|PreLoadKind
block|,
name|PostLoadKind
block|,
name|PreStoreKind
block|,
name|PostStoreKind
block|,
name|PostConditionKind
block|,
name|PostLValueKind
block|,
name|MinPostStmtKind
init|=
name|PostStmtKind
block|,
name|MaxPostStmtKind
init|=
name|PostLValueKind
block|,
name|PostInitializerKind
block|,
name|CallEnterKind
block|,
name|CallExitBeginKind
block|,
name|CallExitEndKind
block|,
name|PreImplicitCallKind
block|,
name|PostImplicitCallKind
block|,
name|MinImplicitCallKind
init|=
name|PreImplicitCallKind
block|,
name|MaxImplicitCallKind
init|=
name|PostImplicitCallKind
block|,
name|EpsilonKind
block|}
enum|;
name|private
label|:
specifier|const
name|void
modifier|*
name|Data1
decl_stmt|;
name|llvm
operator|::
name|PointerIntPair
operator|<
specifier|const
name|void
operator|*
operator|,
literal|2
operator|,
name|unsigned
operator|>
name|Data2
expr_stmt|;
comment|// The LocationContext could be NULL to allow ProgramPoint to be used in
comment|// context insensitive analysis.
name|llvm
operator|::
name|PointerIntPair
operator|<
specifier|const
name|LocationContext
operator|*
operator|,
literal|2
operator|,
name|unsigned
operator|>
name|L
expr_stmt|;
name|llvm
operator|::
name|PointerIntPair
operator|<
specifier|const
name|ProgramPointTag
operator|*
operator|,
literal|2
operator|,
name|unsigned
operator|>
name|Tag
expr_stmt|;
name|protected
label|:
name|ProgramPoint
argument_list|()
block|{}
name|ProgramPoint
argument_list|(
argument|const void *P
argument_list|,
argument|Kind k
argument_list|,
argument|const LocationContext *l
argument_list|,
argument|const ProgramPointTag *tag = nullptr
argument_list|)
block|:
name|Data1
argument_list|(
name|P
argument_list|)
operator|,
name|Data2
argument_list|(
name|nullptr
argument_list|,
operator|(
operator|(
operator|(
name|unsigned
operator|)
name|k
operator|)
operator|>>
literal|0
operator|)
operator|&
literal|0x3
argument_list|)
operator|,
name|L
argument_list|(
name|l
argument_list|,
operator|(
operator|(
operator|(
name|unsigned
operator|)
name|k
operator|)
operator|>>
literal|2
operator|)
operator|&
literal|0x3
argument_list|)
operator|,
name|Tag
argument_list|(
argument|tag
argument_list|,
argument|(((unsigned) k)>>
literal|4
argument|)&
literal|0x3
argument_list|)
block|{
name|assert
argument_list|(
name|getKind
argument_list|()
operator|==
name|k
argument_list|)
block|;
name|assert
argument_list|(
name|getLocationContext
argument_list|()
operator|==
name|l
argument_list|)
block|;
name|assert
argument_list|(
name|getData1
argument_list|()
operator|==
name|P
argument_list|)
block|;       }
name|ProgramPoint
argument_list|(
argument|const void *P1
argument_list|,
argument|const void *P2
argument_list|,
argument|Kind k
argument_list|,
argument|const LocationContext *l
argument_list|,
argument|const ProgramPointTag *tag = nullptr
argument_list|)
operator|:
name|Data1
argument_list|(
name|P1
argument_list|)
operator|,
name|Data2
argument_list|(
name|P2
argument_list|,
operator|(
operator|(
operator|(
name|unsigned
operator|)
name|k
operator|)
operator|>>
literal|0
operator|)
operator|&
literal|0x3
argument_list|)
operator|,
name|L
argument_list|(
name|l
argument_list|,
operator|(
operator|(
operator|(
name|unsigned
operator|)
name|k
operator|)
operator|>>
literal|2
operator|)
operator|&
literal|0x3
argument_list|)
operator|,
name|Tag
argument_list|(
argument|tag
argument_list|,
argument|(((unsigned) k)>>
literal|4
argument|)&
literal|0x3
argument_list|)
block|{}
name|protected
operator|:
specifier|const
name|void
operator|*
name|getData1
argument_list|()
specifier|const
block|{
return|return
name|Data1
return|;
block|}
specifier|const
name|void
operator|*
name|getData2
argument_list|()
specifier|const
block|{
return|return
name|Data2
operator|.
name|getPointer
argument_list|()
return|;
block|}
name|void
name|setData2
parameter_list|(
specifier|const
name|void
modifier|*
name|d
parameter_list|)
block|{
name|Data2
operator|.
name|setPointer
argument_list|(
name|d
argument_list|)
expr_stmt|;
block|}
name|public
label|:
comment|/// Create a new ProgramPoint object that is the same as the original
comment|/// except for using the specified tag value.
name|ProgramPoint
name|withTag
argument_list|(
specifier|const
name|ProgramPointTag
operator|*
name|tag
argument_list|)
decl|const
block|{
return|return
name|ProgramPoint
argument_list|(
name|getData1
argument_list|()
argument_list|,
name|getData2
argument_list|()
argument_list|,
name|getKind
argument_list|()
argument_list|,
name|getLocationContext
argument_list|()
argument_list|,
name|tag
argument_list|)
return|;
block|}
comment|/// \brief Convert to the specified ProgramPoint type, asserting that this
comment|/// ProgramPoint is of the desired type.
name|template
operator|<
name|typename
name|T
operator|>
name|T
name|castAs
argument_list|()
specifier|const
block|{
name|assert
argument_list|(
name|T
operator|::
name|isKind
argument_list|(
operator|*
name|this
argument_list|)
argument_list|)
block|;
name|T
name|t
block|;
name|ProgramPoint
operator|&
name|PP
operator|=
name|t
block|;
name|PP
operator|=
operator|*
name|this
block|;
return|return
name|t
return|;
block|}
comment|/// \brief Convert to the specified ProgramPoint type, returning None if this
comment|/// ProgramPoint is not of the desired type.
name|template
operator|<
name|typename
name|T
operator|>
name|Optional
operator|<
name|T
operator|>
name|getAs
argument_list|()
specifier|const
block|{
if|if
condition|(
operator|!
name|T
operator|::
name|isKind
argument_list|(
operator|*
name|this
argument_list|)
condition|)
return|return
name|None
return|;
name|T
name|t
expr_stmt|;
name|ProgramPoint
modifier|&
name|PP
init|=
name|t
decl_stmt|;
name|PP
operator|=
operator|*
name|this
expr_stmt|;
return|return
name|t
return|;
block|}
name|Kind
name|getKind
argument_list|()
specifier|const
block|{
name|unsigned
name|x
operator|=
name|Tag
operator|.
name|getInt
argument_list|()
block|;
name|x
operator|<<=
literal|2
block|;
name|x
operator||=
name|L
operator|.
name|getInt
argument_list|()
block|;
name|x
operator|<<=
literal|2
block|;
name|x
operator||=
name|Data2
operator|.
name|getInt
argument_list|()
block|;
return|return
operator|(
name|Kind
operator|)
name|x
return|;
block|}
comment|/// \brief Is this a program point corresponding to purge/removal of dead
comment|/// symbols and bindings.
name|bool
name|isPurgeKind
parameter_list|()
block|{
name|Kind
name|K
init|=
name|getKind
argument_list|()
decl_stmt|;
return|return
operator|(
name|K
operator|==
name|PostStmtPurgeDeadSymbolsKind
operator|||
name|K
operator|==
name|PreStmtPurgeDeadSymbolsKind
operator|)
return|;
block|}
specifier|const
name|ProgramPointTag
operator|*
name|getTag
argument_list|()
specifier|const
block|{
return|return
name|Tag
operator|.
name|getPointer
argument_list|()
return|;
block|}
specifier|const
name|LocationContext
operator|*
name|getLocationContext
argument_list|()
specifier|const
block|{
return|return
name|L
operator|.
name|getPointer
argument_list|()
return|;
block|}
comment|// For use with DenseMap.  This hash is probably slow.
name|unsigned
name|getHashValue
argument_list|()
specifier|const
block|{
name|llvm
operator|::
name|FoldingSetNodeID
name|ID
block|;
name|Profile
argument_list|(
name|ID
argument_list|)
block|;
return|return
name|ID
operator|.
name|ComputeHash
argument_list|()
return|;
block|}
name|bool
name|operator
operator|==
operator|(
specifier|const
name|ProgramPoint
operator|&
name|RHS
operator|)
specifier|const
block|{
return|return
name|Data1
operator|==
name|RHS
operator|.
name|Data1
operator|&&
name|Data2
operator|==
name|RHS
operator|.
name|Data2
operator|&&
name|L
operator|==
name|RHS
operator|.
name|L
operator|&&
name|Tag
operator|==
name|RHS
operator|.
name|Tag
return|;
block|}
name|bool
name|operator
operator|!=
operator|(
specifier|const
name|ProgramPoint
operator|&
name|RHS
operator|)
specifier|const
block|{
return|return
name|Data1
operator|!=
name|RHS
operator|.
name|Data1
operator|||
name|Data2
operator|!=
name|RHS
operator|.
name|Data2
operator|||
name|L
operator|!=
name|RHS
operator|.
name|L
operator|||
name|Tag
operator|!=
name|RHS
operator|.
name|Tag
return|;
block|}
name|void
name|Profile
argument_list|(
name|llvm
operator|::
name|FoldingSetNodeID
operator|&
name|ID
argument_list|)
decl|const
block|{
name|ID
operator|.
name|AddInteger
argument_list|(
operator|(
name|unsigned
operator|)
name|getKind
argument_list|()
argument_list|)
expr_stmt|;
name|ID
operator|.
name|AddPointer
argument_list|(
name|getData1
argument_list|()
argument_list|)
expr_stmt|;
name|ID
operator|.
name|AddPointer
argument_list|(
name|getData2
argument_list|()
argument_list|)
expr_stmt|;
name|ID
operator|.
name|AddPointer
argument_list|(
name|getLocationContext
argument_list|()
argument_list|)
expr_stmt|;
name|ID
operator|.
name|AddPointer
argument_list|(
name|getTag
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|static
name|ProgramPoint
name|getProgramPoint
argument_list|(
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
name|ProgramPoint
operator|::
name|Kind
name|K
argument_list|,
specifier|const
name|LocationContext
operator|*
name|LC
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
argument_list|)
decl_stmt|;
block|}
end_decl_stmt

begin_empty_stmt
empty_stmt|;
end_empty_stmt

begin_decl_stmt
name|class
name|BlockEntrance
range|:
name|public
name|ProgramPoint
block|{
name|public
operator|:
name|BlockEntrance
argument_list|(
specifier|const
name|CFGBlock
operator|*
name|B
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
operator|=
name|nullptr
argument_list|)
operator|:
name|ProgramPoint
argument_list|(
argument|B
argument_list|,
argument|BlockEntranceKind
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{
name|assert
argument_list|(
name|B
operator|&&
literal|"BlockEntrance requires non-null block"
argument_list|)
block|;   }
specifier|const
name|CFGBlock
operator|*
name|getBlock
argument_list|()
specifier|const
block|{
return|return
name|reinterpret_cast
operator|<
specifier|const
name|CFGBlock
operator|*
operator|>
operator|(
name|getData1
argument_list|()
operator|)
return|;
block|}
name|Optional
operator|<
name|CFGElement
operator|>
name|getFirstElement
argument_list|()
specifier|const
block|{
specifier|const
name|CFGBlock
operator|*
name|B
operator|=
name|getBlock
argument_list|()
block|;
return|return
name|B
operator|->
name|empty
argument_list|()
condition|?
name|Optional
operator|<
name|CFGElement
operator|>
operator|(
operator|)
else|:
name|B
operator|->
name|front
argument_list|()
return|;
block|}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|BlockEntrance
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|BlockEntranceKind
return|;
block|}
expr|}
block|;
name|class
name|BlockExit
operator|:
name|public
name|ProgramPoint
block|{
name|public
operator|:
name|BlockExit
argument_list|(
specifier|const
name|CFGBlock
operator|*
name|B
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|)
operator|:
name|ProgramPoint
argument_list|(
argument|B
argument_list|,
argument|BlockExitKind
argument_list|,
argument|L
argument_list|)
block|{}
specifier|const
name|CFGBlock
operator|*
name|getBlock
argument_list|()
specifier|const
block|{
return|return
name|reinterpret_cast
operator|<
specifier|const
name|CFGBlock
operator|*
operator|>
operator|(
name|getData1
argument_list|()
operator|)
return|;
block|}
specifier|const
name|Stmt
operator|*
name|getTerminator
argument_list|()
specifier|const
block|{
return|return
name|getBlock
argument_list|()
operator|->
name|getTerminator
argument_list|()
return|;
block|}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|BlockExit
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|BlockExitKind
return|;
block|}
expr|}
block|;
name|class
name|StmtPoint
operator|:
name|public
name|ProgramPoint
block|{
name|public
operator|:
name|StmtPoint
argument_list|(
argument|const Stmt *S
argument_list|,
argument|const void *p2
argument_list|,
argument|Kind k
argument_list|,
argument|const LocationContext *L
argument_list|,
argument|const ProgramPointTag *tag
argument_list|)
operator|:
name|ProgramPoint
argument_list|(
argument|S
argument_list|,
argument|p2
argument_list|,
argument|k
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{
name|assert
argument_list|(
name|S
argument_list|)
block|;   }
specifier|const
name|Stmt
operator|*
name|getStmt
argument_list|()
specifier|const
block|{
return|return
operator|(
specifier|const
name|Stmt
operator|*
operator|)
name|getData1
argument_list|()
return|;
block|}
name|template
operator|<
name|typename
name|T
operator|>
specifier|const
name|T
operator|*
name|getStmtAs
argument_list|()
specifier|const
block|{
return|return
name|dyn_cast
operator|<
name|T
operator|>
operator|(
name|getStmt
argument_list|()
operator|)
return|;
block|}
name|protected
operator|:
name|StmtPoint
argument_list|()
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
name|unsigned
name|k
operator|=
name|Location
operator|.
name|getKind
argument_list|()
block|;
return|return
name|k
operator|>=
name|PreStmtKind
operator|&&
name|k
operator|<=
name|MaxPostStmtKind
return|;
block|}
expr|}
block|;
name|class
name|PreStmt
operator|:
name|public
name|StmtPoint
block|{
name|public
operator|:
name|PreStmt
argument_list|(
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
argument_list|,
specifier|const
name|Stmt
operator|*
name|SubStmt
operator|=
name|nullptr
argument_list|)
operator|:
name|StmtPoint
argument_list|(
argument|S
argument_list|,
argument|SubStmt
argument_list|,
argument|PreStmtKind
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{}
specifier|const
name|Stmt
operator|*
name|getSubStmt
argument_list|()
specifier|const
block|{
return|return
operator|(
specifier|const
name|Stmt
operator|*
operator|)
name|getData2
argument_list|()
return|;
block|}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PreStmt
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|PreStmtKind
return|;
block|}
expr|}
block|;
name|class
name|PostStmt
operator|:
name|public
name|StmtPoint
block|{
name|protected
operator|:
name|PostStmt
argument_list|()
block|{}
name|PostStmt
argument_list|(
argument|const Stmt *S
argument_list|,
argument|const void *data
argument_list|,
argument|Kind k
argument_list|,
argument|const LocationContext *L
argument_list|,
argument|const ProgramPointTag *tag = nullptr
argument_list|)
operator|:
name|StmtPoint
argument_list|(
argument|S
argument_list|,
argument|data
argument_list|,
argument|k
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{}
name|public
operator|:
name|explicit
name|PostStmt
argument_list|(
argument|const Stmt *S
argument_list|,
argument|Kind k
argument_list|,
argument|const LocationContext *L
argument_list|,
argument|const ProgramPointTag *tag = nullptr
argument_list|)
operator|:
name|StmtPoint
argument_list|(
argument|S
argument_list|,
argument|nullptr
argument_list|,
argument|k
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{}
name|explicit
name|PostStmt
argument_list|(
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
operator|=
name|nullptr
argument_list|)
operator|:
name|StmtPoint
argument_list|(
argument|S
argument_list|,
argument|nullptr
argument_list|,
argument|PostStmtKind
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
name|unsigned
name|k
operator|=
name|Location
operator|.
name|getKind
argument_list|()
block|;
return|return
name|k
operator|>=
name|MinPostStmtKind
operator|&&
name|k
operator|<=
name|MaxPostStmtKind
return|;
block|}
expr|}
block|;
comment|// PostCondition represents the post program point of a branch condition.
name|class
name|PostCondition
operator|:
name|public
name|PostStmt
block|{
name|public
operator|:
name|PostCondition
argument_list|(
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
operator|=
name|nullptr
argument_list|)
operator|:
name|PostStmt
argument_list|(
argument|S
argument_list|,
argument|PostConditionKind
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PostCondition
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|PostConditionKind
return|;
block|}
expr|}
block|;
name|class
name|LocationCheck
operator|:
name|public
name|StmtPoint
block|{
name|protected
operator|:
name|LocationCheck
argument_list|()
block|{}
name|LocationCheck
argument_list|(
argument|const Stmt *S
argument_list|,
argument|const LocationContext *L
argument_list|,
argument|ProgramPoint::Kind K
argument_list|,
argument|const ProgramPointTag *tag
argument_list|)
operator|:
name|StmtPoint
argument_list|(
argument|S
argument_list|,
argument|nullptr
argument_list|,
argument|K
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&location
argument_list|)
block|{
name|unsigned
name|k
operator|=
name|location
operator|.
name|getKind
argument_list|()
block|;
return|return
name|k
operator|==
name|PreLoadKind
operator|||
name|k
operator|==
name|PreStoreKind
return|;
block|}
expr|}
block|;
name|class
name|PreLoad
operator|:
name|public
name|LocationCheck
block|{
name|public
operator|:
name|PreLoad
argument_list|(
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
operator|=
name|nullptr
argument_list|)
operator|:
name|LocationCheck
argument_list|(
argument|S
argument_list|,
argument|L
argument_list|,
argument|PreLoadKind
argument_list|,
argument|tag
argument_list|)
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PreLoad
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&location
argument_list|)
block|{
return|return
name|location
operator|.
name|getKind
argument_list|()
operator|==
name|PreLoadKind
return|;
block|}
expr|}
block|;
name|class
name|PreStore
operator|:
name|public
name|LocationCheck
block|{
name|public
operator|:
name|PreStore
argument_list|(
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
operator|=
name|nullptr
argument_list|)
operator|:
name|LocationCheck
argument_list|(
argument|S
argument_list|,
argument|L
argument_list|,
argument|PreStoreKind
argument_list|,
argument|tag
argument_list|)
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PreStore
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&location
argument_list|)
block|{
return|return
name|location
operator|.
name|getKind
argument_list|()
operator|==
name|PreStoreKind
return|;
block|}
expr|}
block|;
name|class
name|PostLoad
operator|:
name|public
name|PostStmt
block|{
name|public
operator|:
name|PostLoad
argument_list|(
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
operator|=
name|nullptr
argument_list|)
operator|:
name|PostStmt
argument_list|(
argument|S
argument_list|,
argument|PostLoadKind
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PostLoad
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|PostLoadKind
return|;
block|}
expr|}
block|;
comment|/// \brief Represents a program point after a store evaluation.
name|class
name|PostStore
operator|:
name|public
name|PostStmt
block|{
name|public
operator|:
comment|/// Construct the post store point.
comment|/// \param Loc can be used to store the information about the location
comment|/// used in the form it was uttered in the code.
name|PostStore
argument_list|(
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|void
operator|*
name|Loc
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
operator|=
name|nullptr
argument_list|)
operator|:
name|PostStmt
argument_list|(
argument|S
argument_list|,
argument|PostStoreKind
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{
name|assert
argument_list|(
name|getData2
argument_list|()
operator|==
name|nullptr
argument_list|)
block|;
name|setData2
argument_list|(
name|Loc
argument_list|)
block|;   }
comment|/// \brief Returns the information about the location used in the store,
comment|/// how it was uttered in the code.
specifier|const
name|void
operator|*
name|getLocationValue
argument_list|()
specifier|const
block|{
return|return
name|getData2
argument_list|()
return|;
block|}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PostStore
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|PostStoreKind
return|;
block|}
expr|}
block|;
name|class
name|PostLValue
operator|:
name|public
name|PostStmt
block|{
name|public
operator|:
name|PostLValue
argument_list|(
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
operator|=
name|nullptr
argument_list|)
operator|:
name|PostStmt
argument_list|(
argument|S
argument_list|,
argument|PostLValueKind
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PostLValue
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|PostLValueKind
return|;
block|}
expr|}
block|;
comment|/// Represents a point after we ran remove dead bindings BEFORE
comment|/// processing the given statement.
name|class
name|PreStmtPurgeDeadSymbols
operator|:
name|public
name|StmtPoint
block|{
name|public
operator|:
name|PreStmtPurgeDeadSymbols
argument_list|(
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
operator|=
name|nullptr
argument_list|)
operator|:
name|StmtPoint
argument_list|(
argument|S
argument_list|,
argument|nullptr
argument_list|,
argument|PreStmtPurgeDeadSymbolsKind
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{ }
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PreStmtPurgeDeadSymbols
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|PreStmtPurgeDeadSymbolsKind
return|;
block|}
expr|}
block|;
comment|/// Represents a point after we ran remove dead bindings AFTER
comment|/// processing the  given statement.
name|class
name|PostStmtPurgeDeadSymbols
operator|:
name|public
name|StmtPoint
block|{
name|public
operator|:
name|PostStmtPurgeDeadSymbols
argument_list|(
specifier|const
name|Stmt
operator|*
name|S
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
operator|=
name|nullptr
argument_list|)
operator|:
name|StmtPoint
argument_list|(
argument|S
argument_list|,
argument|nullptr
argument_list|,
argument|PostStmtPurgeDeadSymbolsKind
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{ }
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PostStmtPurgeDeadSymbols
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|PostStmtPurgeDeadSymbolsKind
return|;
block|}
expr|}
block|;
name|class
name|BlockEdge
operator|:
name|public
name|ProgramPoint
block|{
name|public
operator|:
name|BlockEdge
argument_list|(
specifier|const
name|CFGBlock
operator|*
name|B1
argument_list|,
specifier|const
name|CFGBlock
operator|*
name|B2
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|)
operator|:
name|ProgramPoint
argument_list|(
argument|B1
argument_list|,
argument|B2
argument_list|,
argument|BlockEdgeKind
argument_list|,
argument|L
argument_list|)
block|{
name|assert
argument_list|(
name|B1
operator|&&
literal|"BlockEdge: source block must be non-null"
argument_list|)
block|;
name|assert
argument_list|(
name|B2
operator|&&
literal|"BlockEdge: destination block must be non-null"
argument_list|)
block|;       }
specifier|const
name|CFGBlock
operator|*
name|getSrc
argument_list|()
specifier|const
block|{
return|return
name|static_cast
operator|<
specifier|const
name|CFGBlock
operator|*
operator|>
operator|(
name|getData1
argument_list|()
operator|)
return|;
block|}
specifier|const
name|CFGBlock
operator|*
name|getDst
argument_list|()
specifier|const
block|{
return|return
name|static_cast
operator|<
specifier|const
name|CFGBlock
operator|*
operator|>
operator|(
name|getData2
argument_list|()
operator|)
return|;
block|}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|BlockEdge
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|BlockEdgeKind
return|;
block|}
expr|}
block|;
name|class
name|PostInitializer
operator|:
name|public
name|ProgramPoint
block|{
name|public
operator|:
comment|/// \brief Construct a PostInitializer point that represents a location after
comment|///   CXXCtorInitializer expression evaluation.
comment|///
comment|/// \param I The initializer.
comment|/// \param Loc The location of the field being initialized.
name|PostInitializer
argument_list|(
specifier|const
name|CXXCtorInitializer
operator|*
name|I
argument_list|,
specifier|const
name|void
operator|*
name|Loc
argument_list|,
specifier|const
name|LocationContext
operator|*
name|L
argument_list|)
operator|:
name|ProgramPoint
argument_list|(
argument|I
argument_list|,
argument|Loc
argument_list|,
argument|PostInitializerKind
argument_list|,
argument|L
argument_list|)
block|{}
specifier|const
name|CXXCtorInitializer
operator|*
name|getInitializer
argument_list|()
specifier|const
block|{
return|return
name|static_cast
operator|<
specifier|const
name|CXXCtorInitializer
operator|*
operator|>
operator|(
name|getData1
argument_list|()
operator|)
return|;
block|}
comment|/// \brief Returns the location of the field.
specifier|const
name|void
operator|*
name|getLocationValue
argument_list|()
specifier|const
block|{
return|return
name|getData2
argument_list|()
return|;
block|}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PostInitializer
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|PostInitializerKind
return|;
block|}
expr|}
block|;
comment|/// Represents an implicit call event.
comment|///
comment|/// The nearest statement is provided for diagnostic purposes.
name|class
name|ImplicitCallPoint
operator|:
name|public
name|ProgramPoint
block|{
name|public
operator|:
name|ImplicitCallPoint
argument_list|(
argument|const Decl *D
argument_list|,
argument|SourceLocation Loc
argument_list|,
argument|Kind K
argument_list|,
argument|const LocationContext *L
argument_list|,
argument|const ProgramPointTag *Tag
argument_list|)
operator|:
name|ProgramPoint
argument_list|(
argument|Loc.getPtrEncoding()
argument_list|,
argument|D
argument_list|,
argument|K
argument_list|,
argument|L
argument_list|,
argument|Tag
argument_list|)
block|{}
specifier|const
name|Decl
operator|*
name|getDecl
argument_list|()
specifier|const
block|{
return|return
name|static_cast
operator|<
specifier|const
name|Decl
operator|*
operator|>
operator|(
name|getData2
argument_list|()
operator|)
return|;
block|}
name|SourceLocation
name|getLocation
argument_list|()
specifier|const
block|{
return|return
name|SourceLocation
operator|::
name|getFromPtrEncoding
argument_list|(
name|getData1
argument_list|()
argument_list|)
return|;
block|}
name|protected
operator|:
name|ImplicitCallPoint
argument_list|()
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|>=
name|MinImplicitCallKind
operator|&&
name|Location
operator|.
name|getKind
argument_list|()
operator|<=
name|MaxImplicitCallKind
return|;
block|}
expr|}
block|;
comment|/// Represents a program point just before an implicit call event.
comment|///
comment|/// Explicit calls will appear as PreStmt program points.
name|class
name|PreImplicitCall
operator|:
name|public
name|ImplicitCallPoint
block|{
name|public
operator|:
name|PreImplicitCall
argument_list|(
argument|const Decl *D
argument_list|,
argument|SourceLocation Loc
argument_list|,
argument|const LocationContext *L
argument_list|,
argument|const ProgramPointTag *Tag = nullptr
argument_list|)
operator|:
name|ImplicitCallPoint
argument_list|(
argument|D
argument_list|,
argument|Loc
argument_list|,
argument|PreImplicitCallKind
argument_list|,
argument|L
argument_list|,
argument|Tag
argument_list|)
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PreImplicitCall
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|PreImplicitCallKind
return|;
block|}
expr|}
block|;
comment|/// Represents a program point just after an implicit call event.
comment|///
comment|/// Explicit calls will appear as PostStmt program points.
name|class
name|PostImplicitCall
operator|:
name|public
name|ImplicitCallPoint
block|{
name|public
operator|:
name|PostImplicitCall
argument_list|(
argument|const Decl *D
argument_list|,
argument|SourceLocation Loc
argument_list|,
argument|const LocationContext *L
argument_list|,
argument|const ProgramPointTag *Tag = nullptr
argument_list|)
operator|:
name|ImplicitCallPoint
argument_list|(
argument|D
argument_list|,
argument|Loc
argument_list|,
argument|PostImplicitCallKind
argument_list|,
argument|L
argument_list|,
argument|Tag
argument_list|)
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|PostImplicitCall
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|PostImplicitCallKind
return|;
block|}
expr|}
block|;
comment|/// Represents a point when we begin processing an inlined call.
comment|/// CallEnter uses the caller's location context.
name|class
name|CallEnter
operator|:
name|public
name|ProgramPoint
block|{
name|public
operator|:
name|CallEnter
argument_list|(
specifier|const
name|Stmt
operator|*
name|stmt
argument_list|,
specifier|const
name|StackFrameContext
operator|*
name|calleeCtx
argument_list|,
specifier|const
name|LocationContext
operator|*
name|callerCtx
argument_list|)
operator|:
name|ProgramPoint
argument_list|(
argument|stmt
argument_list|,
argument|calleeCtx
argument_list|,
argument|CallEnterKind
argument_list|,
argument|callerCtx
argument_list|,
argument|nullptr
argument_list|)
block|{}
specifier|const
name|Stmt
operator|*
name|getCallExpr
argument_list|()
specifier|const
block|{
return|return
name|static_cast
operator|<
specifier|const
name|Stmt
operator|*
operator|>
operator|(
name|getData1
argument_list|()
operator|)
return|;
block|}
specifier|const
name|StackFrameContext
operator|*
name|getCalleeContext
argument_list|()
specifier|const
block|{
return|return
name|static_cast
operator|<
specifier|const
name|StackFrameContext
operator|*
operator|>
operator|(
name|getData2
argument_list|()
operator|)
return|;
block|}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|CallEnter
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|CallEnterKind
return|;
block|}
expr|}
block|;
comment|/// Represents a point when we start the call exit sequence (for inlined call).
comment|///
comment|/// The call exit is simulated with a sequence of nodes, which occur between
comment|/// CallExitBegin and CallExitEnd. The following operations occur between the
comment|/// two program points:
comment|/// - CallExitBegin
comment|/// - Bind the return value
comment|/// - Run Remove dead bindings (to clean up the dead symbols from the callee).
comment|/// - CallExitEnd
name|class
name|CallExitBegin
operator|:
name|public
name|ProgramPoint
block|{
name|public
operator|:
comment|// CallExitBegin uses the callee's location context.
name|CallExitBegin
argument_list|(
specifier|const
name|StackFrameContext
operator|*
name|L
argument_list|)
operator|:
name|ProgramPoint
argument_list|(
argument|nullptr
argument_list|,
argument|CallExitBeginKind
argument_list|,
argument|L
argument_list|,
argument|nullptr
argument_list|)
block|{}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|CallExitBegin
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|CallExitBeginKind
return|;
block|}
expr|}
block|;
comment|/// Represents a point when we finish the call exit sequence (for inlined call).
comment|/// \sa CallExitBegin
name|class
name|CallExitEnd
operator|:
name|public
name|ProgramPoint
block|{
name|public
operator|:
comment|// CallExitEnd uses the caller's location context.
name|CallExitEnd
argument_list|(
specifier|const
name|StackFrameContext
operator|*
name|CalleeCtx
argument_list|,
specifier|const
name|LocationContext
operator|*
name|CallerCtx
argument_list|)
operator|:
name|ProgramPoint
argument_list|(
argument|CalleeCtx
argument_list|,
argument|CallExitEndKind
argument_list|,
argument|CallerCtx
argument_list|,
argument|nullptr
argument_list|)
block|{}
specifier|const
name|StackFrameContext
operator|*
name|getCalleeContext
argument_list|()
specifier|const
block|{
return|return
name|static_cast
operator|<
specifier|const
name|StackFrameContext
operator|*
operator|>
operator|(
name|getData1
argument_list|()
operator|)
return|;
block|}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|CallExitEnd
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|CallExitEndKind
return|;
block|}
expr|}
block|;
comment|/// This is a meta program point, which should be skipped by all the diagnostic
comment|/// reasoning etc.
name|class
name|EpsilonPoint
operator|:
name|public
name|ProgramPoint
block|{
name|public
operator|:
name|EpsilonPoint
argument_list|(
specifier|const
name|LocationContext
operator|*
name|L
argument_list|,
specifier|const
name|void
operator|*
name|Data1
argument_list|,
specifier|const
name|void
operator|*
name|Data2
operator|=
name|nullptr
argument_list|,
specifier|const
name|ProgramPointTag
operator|*
name|tag
operator|=
name|nullptr
argument_list|)
operator|:
name|ProgramPoint
argument_list|(
argument|Data1
argument_list|,
argument|Data2
argument_list|,
argument|EpsilonKind
argument_list|,
argument|L
argument_list|,
argument|tag
argument_list|)
block|{}
specifier|const
name|void
operator|*
name|getData
argument_list|()
specifier|const
block|{
return|return
name|getData1
argument_list|()
return|;
block|}
name|private
operator|:
name|friend
name|class
name|ProgramPoint
block|;
name|EpsilonPoint
argument_list|()
block|{}
specifier|static
name|bool
name|isKind
argument_list|(
argument|const ProgramPoint&Location
argument_list|)
block|{
return|return
name|Location
operator|.
name|getKind
argument_list|()
operator|==
name|EpsilonKind
return|;
block|}
expr|}
block|;
comment|/// ProgramPoints can be "tagged" as representing points specific to a given
comment|/// analysis entity.  Tags are abstract annotations, with an associated
comment|/// description and potentially other information.
name|class
name|ProgramPointTag
block|{
name|public
operator|:
name|ProgramPointTag
argument_list|(
name|void
operator|*
name|tagKind
operator|=
name|nullptr
argument_list|)
operator|:
name|TagKind
argument_list|(
argument|tagKind
argument_list|)
block|{}
name|virtual
operator|~
name|ProgramPointTag
argument_list|()
block|;
name|virtual
name|StringRef
name|getTagDescription
argument_list|()
specifier|const
operator|=
literal|0
block|;
name|protected
operator|:
comment|/// Used to implement 'isKind' in subclasses.
specifier|const
name|void
operator|*
name|getTagKind
argument_list|()
block|{
return|return
name|TagKind
return|;
block|}
name|private
operator|:
specifier|const
name|void
operator|*
name|TagKind
block|; }
block|;
name|class
name|SimpleProgramPointTag
operator|:
name|public
name|ProgramPointTag
block|{
name|std
operator|::
name|string
name|Desc
block|;
name|public
operator|:
name|SimpleProgramPointTag
argument_list|(
argument|StringRef MsgProvider
argument_list|,
argument|StringRef Msg
argument_list|)
block|;
name|StringRef
name|getTagDescription
argument_list|()
specifier|const
name|override
block|; }
block|;  }
comment|// end namespace clang
name|namespace
name|llvm
block|{
comment|// Traits specialization for DenseMap
name|template
operator|<
operator|>
expr|struct
name|DenseMapInfo
operator|<
name|clang
operator|::
name|ProgramPoint
operator|>
block|{
specifier|static
specifier|inline
name|clang
operator|::
name|ProgramPoint
name|getEmptyKey
argument_list|()
block|{
name|uintptr_t
name|x
operator|=
name|reinterpret_cast
operator|<
name|uintptr_t
operator|>
operator|(
name|DenseMapInfo
operator|<
name|void
operator|*
operator|>
operator|::
name|getEmptyKey
argument_list|()
operator|)
operator|&
operator|~
literal|0x7
block|;
return|return
name|clang
operator|::
name|BlockEntrance
argument_list|(
name|reinterpret_cast
operator|<
name|clang
operator|::
name|CFGBlock
operator|*
operator|>
operator|(
name|x
operator|)
argument_list|,
name|nullptr
argument_list|)
return|;
block|}
specifier|static
specifier|inline
name|clang
operator|::
name|ProgramPoint
name|getTombstoneKey
argument_list|()
block|{
name|uintptr_t
name|x
operator|=
name|reinterpret_cast
operator|<
name|uintptr_t
operator|>
operator|(
name|DenseMapInfo
operator|<
name|void
operator|*
operator|>
operator|::
name|getTombstoneKey
argument_list|()
operator|)
operator|&
operator|~
literal|0x7
block|;
return|return
name|clang
operator|::
name|BlockEntrance
argument_list|(
name|reinterpret_cast
operator|<
name|clang
operator|::
name|CFGBlock
operator|*
operator|>
operator|(
name|x
operator|)
argument_list|,
name|nullptr
argument_list|)
return|;
block|}
specifier|static
name|unsigned
name|getHashValue
argument_list|(
argument|const clang::ProgramPoint&Loc
argument_list|)
block|{
return|return
name|Loc
operator|.
name|getHashValue
argument_list|()
return|;
block|}
specifier|static
name|bool
name|isEqual
argument_list|(
argument|const clang::ProgramPoint&L
argument_list|,
argument|const clang::ProgramPoint&R
argument_list|)
block|{
return|return
name|L
operator|==
name|R
return|;
block|}
expr|}
block|;
name|template
operator|<
operator|>
expr|struct
name|isPodLike
operator|<
name|clang
operator|::
name|ProgramPoint
operator|>
block|{
specifier|static
specifier|const
name|bool
name|value
operator|=
name|true
block|; }
block|;  }
end_decl_stmt

begin_comment
comment|// end namespace llvm
end_comment

begin_endif
endif|#
directive|endif
end_endif

end_unit

