begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_define
define|#
directive|define
name|JEMALLOC_CTL_C_
end_define

begin_include
include|#
directive|include
file|"jemalloc/internal/jemalloc_internal.h"
end_include

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/* Data. */
end_comment

begin_comment
comment|/*  * ctl_mtx protects the following:  * - ctl_stats.*  * - opt_prof_active  */
end_comment

begin_decl_stmt
specifier|static
name|malloc_mutex_t
name|ctl_mtx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|bool
name|ctl_initialized
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|uint64_t
name|ctl_epoch
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|ctl_stats_t
name|ctl_stats
decl_stmt|;
end_decl_stmt

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/* Helpers for named and indexed nodes. */
end_comment

begin_function
specifier|static
specifier|inline
specifier|const
name|ctl_named_node_t
modifier|*
name|ctl_named_node
parameter_list|(
specifier|const
name|ctl_node_t
modifier|*
name|node
parameter_list|)
block|{
return|return
operator|(
operator|(
name|node
operator|->
name|named
operator|)
condition|?
operator|(
specifier|const
name|ctl_named_node_t
operator|*
operator|)
name|node
else|:
name|NULL
operator|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|ctl_named_node_t
modifier|*
name|ctl_named_children
parameter_list|(
specifier|const
name|ctl_named_node_t
modifier|*
name|node
parameter_list|,
name|int
name|index
parameter_list|)
block|{
specifier|const
name|ctl_named_node_t
modifier|*
name|children
init|=
name|ctl_named_node
argument_list|(
name|node
operator|->
name|children
argument_list|)
decl_stmt|;
return|return
operator|(
name|children
condition|?
operator|&
name|children
index|[
name|index
index|]
else|:
name|NULL
operator|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|ctl_indexed_node_t
modifier|*
name|ctl_indexed_node
parameter_list|(
specifier|const
name|ctl_node_t
modifier|*
name|node
parameter_list|)
block|{
return|return
operator|(
operator|(
name|node
operator|->
name|named
operator|==
name|false
operator|)
condition|?
operator|(
specifier|const
name|ctl_indexed_node_t
operator|*
operator|)
name|node
else|:
name|NULL
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/* Function prototypes for non-inline static functions. */
end_comment

begin_define
define|#
directive|define
name|CTL_PROTO
parameter_list|(
name|n
parameter_list|)
define|\
value|static int	n##_ctl(const size_t *mib, size_t miblen, void *oldp,	\     size_t *oldlenp, void *newp, size_t newlen);
end_define

begin_define
define|#
directive|define
name|INDEX_PROTO
parameter_list|(
name|n
parameter_list|)
define|\
value|static const ctl_named_node_t	*n##_index(const size_t *mib,		\     size_t miblen, size_t i);
end_define

begin_function_decl
specifier|static
name|bool
name|ctl_arena_init
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ctl_arena_clear
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ctl_arena_stats_amerge
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|cstats
parameter_list|,
name|arena_t
modifier|*
name|arena
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ctl_arena_stats_smerge
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|sstats
parameter_list|,
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ctl_arena_refresh
parameter_list|(
name|arena_t
modifier|*
name|arena
parameter_list|,
name|unsigned
name|i
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|bool
name|ctl_grow
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ctl_refresh
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|bool
name|ctl_init
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|ctl_lookup
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|ctl_node_t
specifier|const
modifier|*
modifier|*
name|nodesp
parameter_list|,
name|size_t
modifier|*
name|mibp
parameter_list|,
name|size_t
modifier|*
name|depthp
parameter_list|)
function_decl|;
end_function_decl

begin_macro
name|CTL_PROTO
argument_list|(
argument|version
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|epoch
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_tcache_enabled
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_tcache_flush
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_arena
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_allocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_allocatedp
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_deallocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_deallocatedp
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_debug
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_dss
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_fill
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_lazy_lock
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_mremap
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_munmap
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_prof
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_prof_libgcc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_prof_libunwind
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_stats
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_tcache
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_tls
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_utrace
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_valgrind
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_xmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_abort
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_dss
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_lg_chunk
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_narenas
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_lg_dirty_mult
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_stats_print
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_junk
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_zero
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_quarantine
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_redzone
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_utrace
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_valgrind
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_xmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_tcache
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_lg_tcache_max
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_prefix
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_active
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_lg_prof_sample
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_lg_prof_interval
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_gdump
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_final
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_leak
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_accum
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arena_i_purge
argument_list|)
end_macro

begin_function_decl
specifier|static
name|void
name|arena_purge
parameter_list|(
name|unsigned
name|arena_ind
parameter_list|)
function_decl|;
end_function_decl

begin_macro
name|CTL_PROTO
argument_list|(
argument|arena_i_dss
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|arena_i
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_bin_i_size
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_bin_i_nregs
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_bin_i_run_size
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|arenas_bin_i
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_lrun_i_size
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|arenas_lrun_i
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_narenas
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_initialized
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_quantum
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_page
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_tcache_max
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_nbins
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_nhbins
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_nlruns
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_purge
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_extend
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|prof_active
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|prof_dump
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|prof_interval
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_chunks_current
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_chunks_total
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_chunks_high
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_huge_allocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_huge_nmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_huge_ndalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_small_allocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_small_nmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_small_ndalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_small_nrequests
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_large_allocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_large_nmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_large_ndalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_large_nrequests
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_allocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_ndalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nrequests
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nfills
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nflushes
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nruns
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nreruns
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_curruns
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|stats_arenas_i_bins_j
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_lruns_j_nmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_lruns_j_ndalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_lruns_j_nrequests
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_lruns_j_curruns
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|stats_arenas_i_lruns_j
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_nthreads
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_dss
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_pactive
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_pdirty
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_mapped
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_npurge
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_nmadvise
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_purged
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|stats_arenas_i
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_cactive
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_allocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_active
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_mapped
argument_list|)
end_macro

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/* mallctl tree. */
end_comment

begin_comment
comment|/* Maximum tree depth. */
end_comment

begin_define
define|#
directive|define
name|CTL_MAX_DEPTH
value|6
end_define

begin_define
define|#
directive|define
name|NAME
parameter_list|(
name|n
parameter_list|)
value|{true},	n
end_define

begin_define
define|#
directive|define
name|CHILD
parameter_list|(
name|t
parameter_list|,
name|c
parameter_list|)
define|\
value|sizeof(c##_node) / sizeof(ctl_##t##_node_t),			\ 	(ctl_node_t *)c##_node,						\ 	NULL
end_define

begin_define
define|#
directive|define
name|CTL
parameter_list|(
name|c
parameter_list|)
value|0, NULL, c##_ctl
end_define

begin_comment
comment|/*  * Only handles internal indexed nodes, since there are currently no external  * ones.  */
end_comment

begin_define
define|#
directive|define
name|INDEX
parameter_list|(
name|i
parameter_list|)
value|{false},	i##_index
end_define

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|tcache_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"enabled"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_tcache_enabled
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"flush"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_tcache_flush
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|thread_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"arena"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_arena
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_allocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"allocatedp"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_allocatedp
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"deallocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_deallocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"deallocatedp"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_deallocatedp
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"tcache"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|tcache
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|config_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"debug"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_debug
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"dss"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_dss
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"fill"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_fill
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lazy_lock"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_lazy_lock
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"mremap"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_mremap
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"munmap"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_munmap
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_prof
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_libgcc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_prof_libgcc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_libunwind"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_prof_libunwind
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"stats"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_stats
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"tcache"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_tcache
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"tls"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_tls
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"utrace"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_utrace
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"valgrind"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_valgrind
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"xmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_xmalloc
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|opt_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"abort"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_abort
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"dss"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_dss
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_chunk"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_lg_chunk
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"narenas"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_narenas
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_dirty_mult"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_lg_dirty_mult
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"stats_print"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_stats_print
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"junk"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_junk
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"zero"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_zero
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"quarantine"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_quarantine
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"redzone"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_redzone
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"utrace"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_utrace
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"valgrind"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_valgrind
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"xmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_xmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"tcache"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_tcache
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_tcache_max"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_lg_tcache_max
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_prefix"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_prefix
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_active"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_active
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_prof_sample"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_lg_prof_sample
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_prof_interval"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_lg_prof_interval
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_gdump"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_gdump
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_final"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_final
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_leak"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_leak
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_accum"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_accum
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|arena_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"purge"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arena_i_purge
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"dss"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arena_i_dss
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_arena_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|arena_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|arena_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|arena_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|arenas_bin_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"size"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_bin_i_size
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nregs"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_bin_i_nregs
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"run_size"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_bin_i_run_size
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_arenas_bin_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|arenas_bin_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|arenas_bin_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|arenas_bin_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|arenas_lrun_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"size"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_lrun_i_size
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_arenas_lrun_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|arenas_lrun_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|arenas_lrun_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|arenas_lrun_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|arenas_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"narenas"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_narenas
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"initialized"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_initialized
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"quantum"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_quantum
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"page"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_page
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"tcache_max"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_tcache_max
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nbins"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_nbins
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nhbins"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_nhbins
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"bin"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|arenas_bin
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nlruns"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_nlruns
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lrun"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|arenas_lrun
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"purge"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_purge
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"extend"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_extend
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|prof_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"active"
argument_list|)
block|,
name|CTL
argument_list|(
argument|prof_active
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"dump"
argument_list|)
block|,
name|CTL
argument_list|(
argument|prof_dump
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"interval"
argument_list|)
block|,
name|CTL
argument_list|(
argument|prof_interval
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_chunks_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"current"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_chunks_current
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"total"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_chunks_total
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"high"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_chunks_high
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_huge_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_huge_allocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_huge_nmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"ndalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_huge_ndalloc
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_small_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_small_allocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_small_nmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"ndalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_small_ndalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nrequests"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_small_nrequests
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_large_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_large_allocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_large_nmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"ndalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_large_ndalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nrequests"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_large_nrequests
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_bins_j_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_allocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"ndalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_ndalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nrequests"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nrequests
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nfills"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nfills
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nflushes"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nflushes
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nruns"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nruns
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nreruns"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nreruns
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"curruns"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_curruns
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_stats_arenas_i_bins_j_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i_bins_j
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|stats_arenas_i_bins_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|stats_arenas_i_bins_j
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_lruns_j_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"nmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_lruns_j_nmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"ndalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_lruns_j_ndalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nrequests"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_lruns_j_nrequests
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"curruns"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_lruns_j_curruns
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_stats_arenas_i_lruns_j_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i_lruns_j
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|stats_arenas_i_lruns_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|stats_arenas_i_lruns_j
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"nthreads"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_nthreads
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"dss"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_dss
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"pactive"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_pactive
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"pdirty"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_pdirty
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"mapped"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_mapped
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"npurge"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_npurge
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nmadvise"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_nmadvise
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"purged"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_purged
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"small"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i_small
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"large"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i_large
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"bins"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|stats_arenas_i_bins
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lruns"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|stats_arenas_i_lruns
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_stats_arenas_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|stats_arenas_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|stats_arenas_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"cactive"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_cactive
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_allocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"active"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_active
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"mapped"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_mapped
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"chunks"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_chunks
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"huge"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_huge
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"arenas"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|stats_arenas
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|root_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"version"
argument_list|)
block|,
name|CTL
argument_list|(
argument|version
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"epoch"
argument_list|)
block|,
name|CTL
argument_list|(
argument|epoch
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"thread"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|thread
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"config"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|config
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"opt"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|opt
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"arena"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|arena
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"arenas"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|arenas
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|prof
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"stats"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_root_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|root
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|NAME
end_undef

begin_undef
undef|#
directive|undef
name|CHILD
end_undef

begin_undef
undef|#
directive|undef
name|CTL
end_undef

begin_undef
undef|#
directive|undef
name|INDEX
end_undef

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|bool
name|ctl_arena_init
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
block|{
if|if
condition|(
name|astats
operator|->
name|lstats
operator|==
name|NULL
condition|)
block|{
name|astats
operator|->
name|lstats
operator|=
operator|(
name|malloc_large_stats_t
operator|*
operator|)
name|base_alloc
argument_list|(
name|nlclasses
operator|*
sizeof|sizeof
argument_list|(
name|malloc_large_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|astats
operator|->
name|lstats
operator|==
name|NULL
condition|)
return|return
operator|(
name|true
operator|)
return|;
block|}
return|return
operator|(
name|false
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|ctl_arena_clear
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
block|{
name|astats
operator|->
name|dss
operator|=
name|dss_prec_names
index|[
name|dss_prec_limit
index|]
expr_stmt|;
name|astats
operator|->
name|pactive
operator|=
literal|0
expr_stmt|;
name|astats
operator|->
name|pdirty
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|config_stats
condition|)
block|{
name|memset
argument_list|(
operator|&
name|astats
operator|->
name|astats
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
name|astats
operator|->
name|allocated_small
operator|=
literal|0
expr_stmt|;
name|astats
operator|->
name|nmalloc_small
operator|=
literal|0
expr_stmt|;
name|astats
operator|->
name|ndalloc_small
operator|=
literal|0
expr_stmt|;
name|astats
operator|->
name|nrequests_small
operator|=
literal|0
expr_stmt|;
name|memset
argument_list|(
name|astats
operator|->
name|bstats
argument_list|,
literal|0
argument_list|,
name|NBINS
operator|*
sizeof|sizeof
argument_list|(
name|malloc_bin_stats_t
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|astats
operator|->
name|lstats
argument_list|,
literal|0
argument_list|,
name|nlclasses
operator|*
sizeof|sizeof
argument_list|(
name|malloc_large_stats_t
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|ctl_arena_stats_amerge
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|cstats
parameter_list|,
name|arena_t
modifier|*
name|arena
parameter_list|)
block|{
name|unsigned
name|i
decl_stmt|;
name|arena_stats_merge
argument_list|(
name|arena
argument_list|,
operator|&
name|cstats
operator|->
name|dss
argument_list|,
operator|&
name|cstats
operator|->
name|pactive
argument_list|,
operator|&
name|cstats
operator|->
name|pdirty
argument_list|,
operator|&
name|cstats
operator|->
name|astats
argument_list|,
name|cstats
operator|->
name|bstats
argument_list|,
name|cstats
operator|->
name|lstats
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NBINS
condition|;
name|i
operator|++
control|)
block|{
name|cstats
operator|->
name|allocated_small
operator|+=
name|cstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|allocated
expr_stmt|;
name|cstats
operator|->
name|nmalloc_small
operator|+=
name|cstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nmalloc
expr_stmt|;
name|cstats
operator|->
name|ndalloc_small
operator|+=
name|cstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|ndalloc
expr_stmt|;
name|cstats
operator|->
name|nrequests_small
operator|+=
name|cstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nrequests
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|ctl_arena_stats_smerge
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|sstats
parameter_list|,
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
block|{
name|unsigned
name|i
decl_stmt|;
name|sstats
operator|->
name|pactive
operator|+=
name|astats
operator|->
name|pactive
expr_stmt|;
name|sstats
operator|->
name|pdirty
operator|+=
name|astats
operator|->
name|pdirty
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|mapped
operator|+=
name|astats
operator|->
name|astats
operator|.
name|mapped
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|npurge
operator|+=
name|astats
operator|->
name|astats
operator|.
name|npurge
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|nmadvise
operator|+=
name|astats
operator|->
name|astats
operator|.
name|nmadvise
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|purged
operator|+=
name|astats
operator|->
name|astats
operator|.
name|purged
expr_stmt|;
name|sstats
operator|->
name|allocated_small
operator|+=
name|astats
operator|->
name|allocated_small
expr_stmt|;
name|sstats
operator|->
name|nmalloc_small
operator|+=
name|astats
operator|->
name|nmalloc_small
expr_stmt|;
name|sstats
operator|->
name|ndalloc_small
operator|+=
name|astats
operator|->
name|ndalloc_small
expr_stmt|;
name|sstats
operator|->
name|nrequests_small
operator|+=
name|astats
operator|->
name|nrequests_small
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|allocated_large
operator|+=
name|astats
operator|->
name|astats
operator|.
name|allocated_large
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|nmalloc_large
operator|+=
name|astats
operator|->
name|astats
operator|.
name|nmalloc_large
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|ndalloc_large
operator|+=
name|astats
operator|->
name|astats
operator|.
name|ndalloc_large
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|nrequests_large
operator|+=
name|astats
operator|->
name|astats
operator|.
name|nrequests_large
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nlclasses
condition|;
name|i
operator|++
control|)
block|{
name|sstats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|nmalloc
operator|+=
name|astats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|nmalloc
expr_stmt|;
name|sstats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|ndalloc
operator|+=
name|astats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|ndalloc
expr_stmt|;
name|sstats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|nrequests
operator|+=
name|astats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|nrequests
expr_stmt|;
name|sstats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|curruns
operator|+=
name|astats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|curruns
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NBINS
condition|;
name|i
operator|++
control|)
block|{
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|allocated
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|allocated
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nmalloc
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nmalloc
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|ndalloc
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|ndalloc
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nrequests
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nrequests
expr_stmt|;
if|if
condition|(
name|config_tcache
condition|)
block|{
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nfills
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nfills
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nflushes
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nflushes
expr_stmt|;
block|}
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nruns
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nruns
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|reruns
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|reruns
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|curruns
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|curruns
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|ctl_arena_refresh
parameter_list|(
name|arena_t
modifier|*
name|arena
parameter_list|,
name|unsigned
name|i
parameter_list|)
block|{
name|ctl_arena_stats_t
modifier|*
name|astats
init|=
operator|&
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
decl_stmt|;
name|ctl_arena_stats_t
modifier|*
name|sstats
init|=
operator|&
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
decl_stmt|;
name|ctl_arena_clear
argument_list|(
name|astats
argument_list|)
expr_stmt|;
name|sstats
operator|->
name|nthreads
operator|+=
name|astats
operator|->
name|nthreads
expr_stmt|;
if|if
condition|(
name|config_stats
condition|)
block|{
name|ctl_arena_stats_amerge
argument_list|(
name|astats
argument_list|,
name|arena
argument_list|)
expr_stmt|;
comment|/* Merge into sum stats as well. */
name|ctl_arena_stats_smerge
argument_list|(
name|sstats
argument_list|,
name|astats
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|astats
operator|->
name|pactive
operator|+=
name|arena
operator|->
name|nactive
expr_stmt|;
name|astats
operator|->
name|pdirty
operator|+=
name|arena
operator|->
name|ndirty
expr_stmt|;
comment|/* Merge into sum stats as well. */
name|sstats
operator|->
name|pactive
operator|+=
name|arena
operator|->
name|nactive
expr_stmt|;
name|sstats
operator|->
name|pdirty
operator|+=
name|arena
operator|->
name|ndirty
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|bool
name|ctl_grow
parameter_list|(
name|void
parameter_list|)
block|{
name|ctl_arena_stats_t
modifier|*
name|astats
decl_stmt|;
name|arena_t
modifier|*
modifier|*
name|tarenas
decl_stmt|;
comment|/* Allocate extended arena stats and arenas arrays. */
name|astats
operator|=
operator|(
name|ctl_arena_stats_t
operator|*
operator|)
name|imalloc
argument_list|(
operator|(
name|ctl_stats
operator|.
name|narenas
operator|+
literal|2
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|astats
operator|==
name|NULL
condition|)
return|return
operator|(
name|true
operator|)
return|;
name|tarenas
operator|=
operator|(
name|arena_t
operator|*
operator|*
operator|)
name|imalloc
argument_list|(
operator|(
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|arena_t
operator|*
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|tarenas
operator|==
name|NULL
condition|)
block|{
name|idalloc
argument_list|(
name|astats
argument_list|)
expr_stmt|;
return|return
operator|(
name|true
operator|)
return|;
block|}
comment|/* Initialize the new astats element. */
name|memcpy
argument_list|(
name|astats
argument_list|,
name|ctl_stats
operator|.
name|arenas
argument_list|,
operator|(
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
index|]
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl_arena_init
argument_list|(
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
index|]
argument_list|)
condition|)
block|{
name|idalloc
argument_list|(
name|tarenas
argument_list|)
expr_stmt|;
name|idalloc
argument_list|(
name|astats
argument_list|)
expr_stmt|;
return|return
operator|(
name|true
operator|)
return|;
block|}
comment|/* Swap merged stats to their new location. */
block|{
name|ctl_arena_stats_t
name|tstats
decl_stmt|;
name|memcpy
argument_list|(
operator|&
name|tstats
argument_list|,
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
index|]
argument_list|,
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
index|]
argument_list|,
operator|&
name|tstats
argument_list|,
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* Initialize the new arenas element. */
name|tarenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|=
name|NULL
expr_stmt|;
block|{
name|arena_t
modifier|*
modifier|*
name|arenas_old
init|=
name|arenas
decl_stmt|;
comment|/* 		 * Swap extended arenas array into place.  Although ctl_mtx 		 * protects this function from other threads extending the 		 * array, it does not protect from other threads mutating it 		 * (i.e. initializing arenas and setting array elements to 		 * point to them).  Therefore, array copying must happen under 		 * the protection of arenas_lock. 		 */
name|malloc_mutex_lock
argument_list|(
operator|&
name|arenas_lock
argument_list|)
expr_stmt|;
name|arenas
operator|=
name|tarenas
expr_stmt|;
name|memcpy
argument_list|(
name|arenas
argument_list|,
name|arenas_old
argument_list|,
name|ctl_stats
operator|.
name|narenas
operator|*
sizeof|sizeof
argument_list|(
name|arena_t
operator|*
argument_list|)
argument_list|)
expr_stmt|;
name|narenas_total
operator|++
expr_stmt|;
name|arenas_extend
argument_list|(
name|narenas_total
operator|-
literal|1
argument_list|)
expr_stmt|;
name|malloc_mutex_unlock
argument_list|(
operator|&
name|arenas_lock
argument_list|)
expr_stmt|;
comment|/* 		 * Deallocate arenas_old only if it came from imalloc() (not 		 * base_alloc()). 		 */
if|if
condition|(
name|ctl_stats
operator|.
name|narenas
operator|!=
name|narenas_auto
condition|)
name|idalloc
argument_list|(
name|arenas_old
argument_list|)
expr_stmt|;
block|}
name|ctl_stats
operator|.
name|arenas
operator|=
name|astats
expr_stmt|;
name|ctl_stats
operator|.
name|narenas
operator|++
expr_stmt|;
return|return
operator|(
name|false
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|ctl_refresh
parameter_list|(
name|void
parameter_list|)
block|{
name|unsigned
name|i
decl_stmt|;
name|VARIABLE_ARRAY
argument_list|(
name|arena_t
operator|*
argument_list|,
name|tarenas
argument_list|,
name|ctl_stats
operator|.
name|narenas
argument_list|)
expr_stmt|;
if|if
condition|(
name|config_stats
condition|)
block|{
name|malloc_mutex_lock
argument_list|(
operator|&
name|chunks_mtx
argument_list|)
expr_stmt|;
name|ctl_stats
operator|.
name|chunks
operator|.
name|current
operator|=
name|stats_chunks
operator|.
name|curchunks
expr_stmt|;
name|ctl_stats
operator|.
name|chunks
operator|.
name|total
operator|=
name|stats_chunks
operator|.
name|nchunks
expr_stmt|;
name|ctl_stats
operator|.
name|chunks
operator|.
name|high
operator|=
name|stats_chunks
operator|.
name|highchunks
expr_stmt|;
name|malloc_mutex_unlock
argument_list|(
operator|&
name|chunks_mtx
argument_list|)
expr_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|huge_mtx
argument_list|)
expr_stmt|;
name|ctl_stats
operator|.
name|huge
operator|.
name|allocated
operator|=
name|huge_allocated
expr_stmt|;
name|ctl_stats
operator|.
name|huge
operator|.
name|nmalloc
operator|=
name|huge_nmalloc
expr_stmt|;
name|ctl_stats
operator|.
name|huge
operator|.
name|ndalloc
operator|=
name|huge_ndalloc
expr_stmt|;
name|malloc_mutex_unlock
argument_list|(
operator|&
name|huge_mtx
argument_list|)
expr_stmt|;
block|}
comment|/* 	 * Clear sum stats, since they will be merged into by 	 * ctl_arena_refresh(). 	 */
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|nthreads
operator|=
literal|0
expr_stmt|;
name|ctl_arena_clear
argument_list|(
operator|&
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
argument_list|)
expr_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|arenas_lock
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|tarenas
argument_list|,
name|arenas
argument_list|,
sizeof|sizeof
argument_list|(
name|arena_t
operator|*
argument_list|)
operator|*
name|ctl_stats
operator|.
name|narenas
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ctl_stats
operator|.
name|narenas
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|arenas
index|[
name|i
index|]
operator|!=
name|NULL
condition|)
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
operator|.
name|nthreads
operator|=
name|arenas
index|[
name|i
index|]
operator|->
name|nthreads
expr_stmt|;
else|else
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
operator|.
name|nthreads
operator|=
literal|0
expr_stmt|;
block|}
name|malloc_mutex_unlock
argument_list|(
operator|&
name|arenas_lock
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ctl_stats
operator|.
name|narenas
condition|;
name|i
operator|++
control|)
block|{
name|bool
name|initialized
init|=
operator|(
name|tarenas
index|[
name|i
index|]
operator|!=
name|NULL
operator|)
decl_stmt|;
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
operator|.
name|initialized
operator|=
name|initialized
expr_stmt|;
if|if
condition|(
name|initialized
condition|)
name|ctl_arena_refresh
argument_list|(
name|tarenas
index|[
name|i
index|]
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|config_stats
condition|)
block|{
name|ctl_stats
operator|.
name|allocated
operator|=
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|allocated_small
operator|+
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|astats
operator|.
name|allocated_large
operator|+
name|ctl_stats
operator|.
name|huge
operator|.
name|allocated
expr_stmt|;
name|ctl_stats
operator|.
name|active
operator|=
operator|(
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|pactive
operator|<<
name|LG_PAGE
operator|)
operator|+
name|ctl_stats
operator|.
name|huge
operator|.
name|allocated
expr_stmt|;
name|ctl_stats
operator|.
name|mapped
operator|=
operator|(
name|ctl_stats
operator|.
name|chunks
operator|.
name|current
operator|<<
name|opt_lg_chunk
operator|)
expr_stmt|;
block|}
name|ctl_epoch
operator|++
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|bool
name|ctl_init
parameter_list|(
name|void
parameter_list|)
block|{
name|bool
name|ret
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl_initialized
operator|==
name|false
condition|)
block|{
comment|/* 		 * Allocate space for one extra arena stats element, which 		 * contains summed stats across all arenas. 		 */
name|assert
argument_list|(
name|narenas_auto
operator|==
name|narenas_total_get
argument_list|()
argument_list|)
expr_stmt|;
name|ctl_stats
operator|.
name|narenas
operator|=
name|narenas_auto
expr_stmt|;
name|ctl_stats
operator|.
name|arenas
operator|=
operator|(
name|ctl_arena_stats_t
operator|*
operator|)
name|base_alloc
argument_list|(
operator|(
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl_stats
operator|.
name|arenas
operator|==
name|NULL
condition|)
block|{
name|ret
operator|=
name|true
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|memset
argument_list|(
name|ctl_stats
operator|.
name|arenas
argument_list|,
literal|0
argument_list|,
operator|(
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 		 * Initialize all stats structures, regardless of whether they 		 * ever get used.  Lazy initialization would allow errors to 		 * cause inconsistent state to be viewable by the application. 		 */
if|if
condition|(
name|config_stats
condition|)
block|{
name|unsigned
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|ctl_stats
operator|.
name|narenas
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ctl_arena_init
argument_list|(
operator|&
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
argument_list|)
condition|)
block|{
name|ret
operator|=
name|true
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
block|}
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|initialized
operator|=
name|true
expr_stmt|;
name|ctl_epoch
operator|=
literal|0
expr_stmt|;
name|ctl_refresh
argument_list|()
expr_stmt|;
name|ctl_initialized
operator|=
name|true
expr_stmt|;
block|}
name|ret
operator|=
name|false
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ctl_lookup
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|ctl_node_t
specifier|const
modifier|*
modifier|*
name|nodesp
parameter_list|,
name|size_t
modifier|*
name|mibp
parameter_list|,
name|size_t
modifier|*
name|depthp
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
specifier|const
name|char
modifier|*
name|elm
decl_stmt|,
modifier|*
name|tdot
decl_stmt|,
modifier|*
name|dot
decl_stmt|;
name|size_t
name|elen
decl_stmt|,
name|i
decl_stmt|,
name|j
decl_stmt|;
specifier|const
name|ctl_named_node_t
modifier|*
name|node
decl_stmt|;
name|elm
operator|=
name|name
expr_stmt|;
comment|/* Equivalent to strchrnul(). */
name|dot
operator|=
operator|(
operator|(
name|tdot
operator|=
name|strchr
argument_list|(
name|elm
argument_list|,
literal|'.'
argument_list|)
operator|)
operator|!=
name|NULL
operator|)
condition|?
name|tdot
else|:
name|strchr
argument_list|(
name|elm
argument_list|,
literal|'\0'
argument_list|)
expr_stmt|;
name|elen
operator|=
call|(
name|size_t
call|)
argument_list|(
operator|(
name|uintptr_t
operator|)
name|dot
operator|-
operator|(
name|uintptr_t
operator|)
name|elm
argument_list|)
expr_stmt|;
if|if
condition|(
name|elen
operator|==
literal|0
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|node
operator|=
name|super_root_node
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|*
name|depthp
condition|;
name|i
operator|++
control|)
block|{
name|assert
argument_list|(
name|node
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|node
operator|->
name|nchildren
operator|>
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl_named_node
argument_list|(
name|node
operator|->
name|children
argument_list|)
operator|!=
name|NULL
condition|)
block|{
specifier|const
name|ctl_named_node_t
modifier|*
name|pnode
init|=
name|node
decl_stmt|;
comment|/* Children are named. */
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|node
operator|->
name|nchildren
condition|;
name|j
operator|++
control|)
block|{
specifier|const
name|ctl_named_node_t
modifier|*
name|child
init|=
name|ctl_named_children
argument_list|(
name|node
argument_list|,
name|j
argument_list|)
decl_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|child
operator|->
name|name
argument_list|)
operator|==
name|elen
operator|&&
name|strncmp
argument_list|(
name|elm
argument_list|,
name|child
operator|->
name|name
argument_list|,
name|elen
argument_list|)
operator|==
literal|0
condition|)
block|{
name|node
operator|=
name|child
expr_stmt|;
if|if
condition|(
name|nodesp
operator|!=
name|NULL
condition|)
name|nodesp
index|[
name|i
index|]
operator|=
operator|(
specifier|const
name|ctl_node_t
operator|*
operator|)
name|node
expr_stmt|;
name|mibp
index|[
name|i
index|]
operator|=
name|j
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|node
operator|==
name|pnode
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
else|else
block|{
name|uintmax_t
name|index
decl_stmt|;
specifier|const
name|ctl_indexed_node_t
modifier|*
name|inode
decl_stmt|;
comment|/* Children are indexed. */
name|index
operator|=
name|malloc_strtoumax
argument_list|(
name|elm
argument_list|,
name|NULL
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
operator|==
name|UINTMAX_MAX
operator|||
name|index
operator|>
name|SIZE_T_MAX
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|inode
operator|=
name|ctl_indexed_node
argument_list|(
name|node
operator|->
name|children
argument_list|)
expr_stmt|;
name|node
operator|=
name|inode
operator|->
name|index
argument_list|(
name|mibp
argument_list|,
operator|*
name|depthp
argument_list|,
operator|(
name|size_t
operator|)
name|index
argument_list|)
expr_stmt|;
if|if
condition|(
name|node
operator|==
name|NULL
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
if|if
condition|(
name|nodesp
operator|!=
name|NULL
condition|)
name|nodesp
index|[
name|i
index|]
operator|=
operator|(
specifier|const
name|ctl_node_t
operator|*
operator|)
name|node
expr_stmt|;
name|mibp
index|[
name|i
index|]
operator|=
operator|(
name|size_t
operator|)
name|index
expr_stmt|;
block|}
if|if
condition|(
name|node
operator|->
name|ctl
operator|!=
name|NULL
condition|)
block|{
comment|/* Terminal node. */
if|if
condition|(
operator|*
name|dot
operator|!=
literal|'\0'
condition|)
block|{
comment|/* 				 * The name contains more elements than are 				 * in this path through the tree. 				 */
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
comment|/* Complete lookup successful. */
operator|*
name|depthp
operator|=
name|i
operator|+
literal|1
expr_stmt|;
break|break;
block|}
comment|/* Update elm. */
if|if
condition|(
operator|*
name|dot
operator|==
literal|'\0'
condition|)
block|{
comment|/* No more elements. */
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|elm
operator|=
operator|&
name|dot
index|[
literal|1
index|]
expr_stmt|;
name|dot
operator|=
operator|(
operator|(
name|tdot
operator|=
name|strchr
argument_list|(
name|elm
argument_list|,
literal|'.'
argument_list|)
operator|)
operator|!=
name|NULL
operator|)
condition|?
name|tdot
else|:
name|strchr
argument_list|(
name|elm
argument_list|,
literal|'\0'
argument_list|)
expr_stmt|;
name|elen
operator|=
call|(
name|size_t
call|)
argument_list|(
operator|(
name|uintptr_t
operator|)
name|dot
operator|-
operator|(
name|uintptr_t
operator|)
name|elm
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|int
name|ctl_byname
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|size_t
name|depth
decl_stmt|;
name|ctl_node_t
specifier|const
modifier|*
name|nodes
index|[
name|CTL_MAX_DEPTH
index|]
decl_stmt|;
name|size_t
name|mib
index|[
name|CTL_MAX_DEPTH
index|]
decl_stmt|;
specifier|const
name|ctl_named_node_t
modifier|*
name|node
decl_stmt|;
if|if
condition|(
name|ctl_initialized
operator|==
name|false
operator|&&
name|ctl_init
argument_list|()
condition|)
block|{
name|ret
operator|=
name|EAGAIN
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|depth
operator|=
name|CTL_MAX_DEPTH
expr_stmt|;
name|ret
operator|=
name|ctl_lookup
argument_list|(
name|name
argument_list|,
name|nodes
argument_list|,
name|mib
argument_list|,
operator|&
name|depth
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|0
condition|)
goto|goto
name|label_return
goto|;
name|node
operator|=
name|ctl_named_node
argument_list|(
name|nodes
index|[
name|depth
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|node
operator|!=
name|NULL
operator|&&
name|node
operator|->
name|ctl
condition|)
name|ret
operator|=
name|node
operator|->
name|ctl
argument_list|(
name|mib
argument_list|,
name|depth
argument_list|,
name|oldp
argument_list|,
name|oldlenp
argument_list|,
name|newp
argument_list|,
name|newlen
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* The name refers to a partial path through the ctl tree. */
name|ret
operator|=
name|ENOENT
expr_stmt|;
block|}
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|int
name|ctl_nametomib
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|size_t
modifier|*
name|mibp
parameter_list|,
name|size_t
modifier|*
name|miblenp
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|ctl_initialized
operator|==
name|false
operator|&&
name|ctl_init
argument_list|()
condition|)
block|{
name|ret
operator|=
name|EAGAIN
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|ret
operator|=
name|ctl_lookup
argument_list|(
name|name
argument_list|,
name|NULL
argument_list|,
name|mibp
argument_list|,
name|miblenp
argument_list|)
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|int
name|ctl_bymib
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
specifier|const
name|ctl_named_node_t
modifier|*
name|node
decl_stmt|;
name|size_t
name|i
decl_stmt|;
if|if
condition|(
name|ctl_initialized
operator|==
name|false
operator|&&
name|ctl_init
argument_list|()
condition|)
block|{
name|ret
operator|=
name|EAGAIN
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
comment|/* Iterate down the tree. */
name|node
operator|=
name|super_root_node
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|miblen
condition|;
name|i
operator|++
control|)
block|{
name|assert
argument_list|(
name|node
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|node
operator|->
name|nchildren
operator|>
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl_named_node
argument_list|(
name|node
operator|->
name|children
argument_list|)
operator|!=
name|NULL
condition|)
block|{
comment|/* Children are named. */
if|if
condition|(
name|node
operator|->
name|nchildren
operator|<=
name|mib
index|[
name|i
index|]
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|node
operator|=
name|ctl_named_children
argument_list|(
name|node
argument_list|,
name|mib
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
specifier|const
name|ctl_indexed_node_t
modifier|*
name|inode
decl_stmt|;
comment|/* Indexed element. */
name|inode
operator|=
name|ctl_indexed_node
argument_list|(
name|node
operator|->
name|children
argument_list|)
expr_stmt|;
name|node
operator|=
name|inode
operator|->
name|index
argument_list|(
name|mib
argument_list|,
name|miblen
argument_list|,
name|mib
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|node
operator|==
name|NULL
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
block|}
comment|/* Call the ctl function. */
if|if
condition|(
name|node
operator|&&
name|node
operator|->
name|ctl
condition|)
name|ret
operator|=
name|node
operator|->
name|ctl
argument_list|(
name|mib
argument_list|,
name|miblen
argument_list|,
name|oldp
argument_list|,
name|oldlenp
argument_list|,
name|newp
argument_list|,
name|newlen
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* Partial MIB. */
name|ret
operator|=
name|ENOENT
expr_stmt|;
block|}
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|bool
name|ctl_boot
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|malloc_mutex_init
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
condition|)
return|return
operator|(
name|true
operator|)
return|;
name|ctl_initialized
operator|=
name|false
expr_stmt|;
return|return
operator|(
name|false
operator|)
return|;
block|}
end_function

begin_function
name|void
name|ctl_prefork
parameter_list|(
name|void
parameter_list|)
block|{
name|malloc_mutex_prefork
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ctl_postfork_parent
parameter_list|(
name|void
parameter_list|)
block|{
name|malloc_mutex_postfork_parent
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ctl_postfork_child
parameter_list|(
name|void
parameter_list|)
block|{
name|malloc_mutex_postfork_child
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/* *_ctl() functions. */
end_comment

begin_define
define|#
directive|define
name|READONLY
parameter_list|()
value|do {						\ 	if (newp != NULL || newlen != 0) {				\ 		ret = EPERM;						\ 		goto label_return;					\ 	}								\ } while (0)
end_define

begin_define
define|#
directive|define
name|WRITEONLY
parameter_list|()
value|do {						\ 	if (oldp != NULL || oldlenp != NULL) {				\ 		ret = EPERM;						\ 		goto label_return;					\ 	}								\ } while (0)
end_define

begin_define
define|#
directive|define
name|READ
parameter_list|(
name|v
parameter_list|,
name|t
parameter_list|)
value|do {						\ 	if (oldp != NULL&& oldlenp != NULL) {				\ 		if (*oldlenp != sizeof(t)) {				\ 			size_t	copylen = (sizeof(t)<= *oldlenp)	\ 			    ? sizeof(t) : *oldlenp;			\ 			memcpy(oldp, (void *)&(v), copylen);		\ 			ret = EINVAL;					\ 			goto label_return;				\ 		} else							\ 			*(t *)oldp = (v);				\ 	}								\ } while (0)
end_define

begin_define
define|#
directive|define
name|WRITE
parameter_list|(
name|v
parameter_list|,
name|t
parameter_list|)
value|do {						\ 	if (newp != NULL) {						\ 		if (newlen != sizeof(t)) {				\ 			ret = EINVAL;					\ 			goto label_return;				\ 		}							\ 		(v) = *(t *)newp;					\ 	}								\ } while (0)
end_define

begin_comment
comment|/*  * There's a lot of code duplication in the following macros due to limitations  * in how nested cpp macros are expanded.  */
end_comment

begin_define
define|#
directive|define
name|CTL_RO_CLGEN
parameter_list|(
name|c
parameter_list|,
name|l
parameter_list|,
name|n
parameter_list|,
name|v
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(const size_t *mib, size_t miblen, void *oldp, size_t *oldlenp,	\     void *newp, size_t newlen)						\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	if ((c) == false)						\ 		return (ENOENT);					\ 	if (l)								\ 		malloc_mutex_lock(&ctl_mtx);				\ 	READONLY();							\ 	oldval = (v);							\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	if (l)								\ 		malloc_mutex_unlock(&ctl_mtx);				\ 	return (ret);							\ }
end_define

begin_define
define|#
directive|define
name|CTL_RO_CGEN
parameter_list|(
name|c
parameter_list|,
name|n
parameter_list|,
name|v
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(const size_t *mib, size_t miblen, void *oldp, size_t *oldlenp,	\     void *newp, size_t newlen)						\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	if ((c) == false)						\ 		return (ENOENT);					\ 	malloc_mutex_lock(&ctl_mtx);					\ 	READONLY();							\ 	oldval = (v);							\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	malloc_mutex_unlock(&ctl_mtx);					\ 	return (ret);							\ }
end_define

begin_define
define|#
directive|define
name|CTL_RO_GEN
parameter_list|(
name|n
parameter_list|,
name|v
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(const size_t *mib, size_t miblen, void *oldp, size_t *oldlenp,	\     void *newp, size_t newlen)						\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	malloc_mutex_lock(&ctl_mtx);					\ 	READONLY();							\ 	oldval = (v);							\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	malloc_mutex_unlock(&ctl_mtx);					\ 	return (ret);							\ }
end_define

begin_comment
comment|/*  * ctl_mtx is not acquired, under the assumption that no pertinent data will  * mutate during the call.  */
end_comment

begin_define
define|#
directive|define
name|CTL_RO_NL_CGEN
parameter_list|(
name|c
parameter_list|,
name|n
parameter_list|,
name|v
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(const size_t *mib, size_t miblen, void *oldp, size_t *oldlenp,	\     void *newp, size_t newlen)						\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	if ((c) == false)						\ 		return (ENOENT);					\ 	READONLY();							\ 	oldval = (v);							\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	return (ret);							\ }
end_define

begin_define
define|#
directive|define
name|CTL_RO_NL_GEN
parameter_list|(
name|n
parameter_list|,
name|v
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(const size_t *mib, size_t miblen, void *oldp, size_t *oldlenp,	\     void *newp, size_t newlen)						\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	READONLY();							\ 	oldval = (v);							\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	return (ret);							\ }
end_define

begin_define
define|#
directive|define
name|CTL_RO_BOOL_CONFIG_GEN
parameter_list|(
name|n
parameter_list|)
define|\
value|static int								\ n##_ctl(const size_t *mib, size_t miblen, void *oldp, size_t *oldlenp,	\     void *newp, size_t newlen)						\ {									\ 	int ret;							\ 	bool oldval;							\ 									\ 	READONLY();							\ 	oldval = n;							\ 	READ(oldval, bool);						\ 									\ 	ret = 0;							\ label_return:								\ 	return (ret);							\ }
end_define

begin_comment
comment|/******************************************************************************/
end_comment

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|version
argument_list|,
argument|JEMALLOC_VERSION
argument_list|,
argument|const char *
argument_list|)
end_macro

begin_function
specifier|static
name|int
name|epoch_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|UNUSED
name|uint64_t
name|newval
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|WRITE
argument_list|(
name|newval
argument_list|,
name|uint64_t
argument_list|)
expr_stmt|;
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
name|ctl_refresh
argument_list|()
expr_stmt|;
name|READ
argument_list|(
name|ctl_epoch
argument_list|,
name|uint64_t
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_debug
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_dss
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_fill
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_lazy_lock
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_mremap
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_munmap
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_prof
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_prof_libgcc
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_prof_libunwind
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_stats
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_tcache
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_tls
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_utrace
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_valgrind
argument_list|)
end_macro

begin_macro
name|CTL_RO_BOOL_CONFIG_GEN
argument_list|(
argument|config_xmalloc
argument_list|)
end_macro

begin_comment
comment|/******************************************************************************/
end_comment

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_abort
argument_list|,
argument|opt_abort
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_dss
argument_list|,
argument|opt_dss
argument_list|,
argument|const char *
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_lg_chunk
argument_list|,
argument|opt_lg_chunk
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_narenas
argument_list|,
argument|opt_narenas
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_lg_dirty_mult
argument_list|,
argument|opt_lg_dirty_mult
argument_list|,
argument|ssize_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_stats_print
argument_list|,
argument|opt_stats_print
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_fill
argument_list|,
argument|opt_junk
argument_list|,
argument|opt_junk
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_fill
argument_list|,
argument|opt_quarantine
argument_list|,
argument|opt_quarantine
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_fill
argument_list|,
argument|opt_redzone
argument_list|,
argument|opt_redzone
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_fill
argument_list|,
argument|opt_zero
argument_list|,
argument|opt_zero
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_utrace
argument_list|,
argument|opt_utrace
argument_list|,
argument|opt_utrace
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_valgrind
argument_list|,
argument|opt_valgrind
argument_list|,
argument|opt_valgrind
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_xmalloc
argument_list|,
argument|opt_xmalloc
argument_list|,
argument|opt_xmalloc
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_tcache
argument_list|,
argument|opt_tcache
argument_list|,
argument|opt_tcache
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_tcache
argument_list|,
argument|opt_lg_tcache_max
argument_list|,
argument|opt_lg_tcache_max
argument_list|,
argument|ssize_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof
argument_list|,
argument|opt_prof
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_prefix
argument_list|,
argument|opt_prof_prefix
argument_list|,
argument|const char *
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_active
argument_list|,
argument|opt_prof_active
argument_list|,
argument|bool
argument_list|)
end_macro

begin_comment
comment|/* Mutable. */
end_comment

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_lg_prof_sample
argument_list|,
argument|opt_lg_prof_sample
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_accum
argument_list|,
argument|opt_prof_accum
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_lg_prof_interval
argument_list|,
argument|opt_lg_prof_interval
argument_list|,
argument|ssize_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_gdump
argument_list|,
argument|opt_prof_gdump
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_final
argument_list|,
argument|opt_prof_final
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_leak
argument_list|,
argument|opt_prof_leak
argument_list|,
argument|bool
argument_list|)
end_macro

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|thread_arena_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|newind
decl_stmt|,
name|oldind
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|newind
operator|=
name|oldind
operator|=
name|choose_arena
argument_list|(
name|NULL
argument_list|)
operator|->
name|ind
expr_stmt|;
name|WRITE
argument_list|(
name|newind
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
name|READ
argument_list|(
name|oldind
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
if|if
condition|(
name|newind
operator|!=
name|oldind
condition|)
block|{
name|arena_t
modifier|*
name|arena
decl_stmt|;
if|if
condition|(
name|newind
operator|>=
name|ctl_stats
operator|.
name|narenas
condition|)
block|{
comment|/* New arena index is out of range. */
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
comment|/* Initialize arena if necessary. */
name|malloc_mutex_lock
argument_list|(
operator|&
name|arenas_lock
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|arena
operator|=
name|arenas
index|[
name|newind
index|]
operator|)
operator|==
name|NULL
operator|&&
operator|(
name|arena
operator|=
name|arenas_extend
argument_list|(
name|newind
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|malloc_mutex_unlock
argument_list|(
operator|&
name|arenas_lock
argument_list|)
expr_stmt|;
name|ret
operator|=
name|EAGAIN
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|assert
argument_list|(
name|arena
operator|==
name|arenas
index|[
name|newind
index|]
argument_list|)
expr_stmt|;
name|arenas
index|[
name|oldind
index|]
operator|->
name|nthreads
operator|--
expr_stmt|;
name|arenas
index|[
name|newind
index|]
operator|->
name|nthreads
operator|++
expr_stmt|;
name|malloc_mutex_unlock
argument_list|(
operator|&
name|arenas_lock
argument_list|)
expr_stmt|;
comment|/* Set new arena association. */
if|if
condition|(
name|config_tcache
condition|)
block|{
name|tcache_t
modifier|*
name|tcache
decl_stmt|;
if|if
condition|(
call|(
name|uintptr_t
call|)
argument_list|(
name|tcache
operator|=
operator|*
name|tcache_tsd_get
argument_list|()
argument_list|)
operator|>
operator|(
name|uintptr_t
operator|)
name|TCACHE_STATE_MAX
condition|)
block|{
name|tcache_arena_dissociate
argument_list|(
name|tcache
argument_list|)
expr_stmt|;
name|tcache_arena_associate
argument_list|(
name|tcache
argument_list|,
name|arena
argument_list|)
expr_stmt|;
block|}
block|}
name|arenas_tsd_set
argument_list|(
operator|&
name|arena
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|thread_allocated
argument_list|,
argument|thread_allocated_tsd_get()->allocated
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|thread_allocatedp
argument_list|,
argument|&thread_allocated_tsd_get()->allocated
argument_list|,
argument|uint64_t *
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|thread_deallocated
argument_list|,
argument|thread_allocated_tsd_get()->deallocated
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|thread_deallocatedp
argument_list|,
argument|&thread_allocated_tsd_get()->deallocated
argument_list|,
argument|uint64_t *
argument_list|)
end_macro

begin_function
specifier|static
name|int
name|thread_tcache_enabled_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|bool
name|oldval
decl_stmt|;
if|if
condition|(
name|config_tcache
operator|==
name|false
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|oldval
operator|=
name|tcache_enabled_get
argument_list|()
expr_stmt|;
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newlen
operator|!=
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|tcache_enabled_set
argument_list|(
operator|*
operator|(
name|bool
operator|*
operator|)
name|newp
argument_list|)
expr_stmt|;
block|}
name|READ
argument_list|(
name|oldval
argument_list|,
name|bool
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|thread_tcache_flush_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|config_tcache
operator|==
name|false
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|READONLY
argument_list|()
expr_stmt|;
name|WRITEONLY
argument_list|()
expr_stmt|;
name|tcache_flush
argument_list|()
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/* ctl_mutex must be held during execution of this function. */
end_comment

begin_function
specifier|static
name|void
name|arena_purge
parameter_list|(
name|unsigned
name|arena_ind
parameter_list|)
block|{
name|VARIABLE_ARRAY
argument_list|(
name|arena_t
operator|*
argument_list|,
name|tarenas
argument_list|,
name|ctl_stats
operator|.
name|narenas
argument_list|)
expr_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|arenas_lock
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|tarenas
argument_list|,
name|arenas
argument_list|,
sizeof|sizeof
argument_list|(
name|arena_t
operator|*
argument_list|)
operator|*
name|ctl_stats
operator|.
name|narenas
argument_list|)
expr_stmt|;
name|malloc_mutex_unlock
argument_list|(
operator|&
name|arenas_lock
argument_list|)
expr_stmt|;
if|if
condition|(
name|arena_ind
operator|==
name|ctl_stats
operator|.
name|narenas
condition|)
block|{
name|unsigned
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ctl_stats
operator|.
name|narenas
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|tarenas
index|[
name|i
index|]
operator|!=
name|NULL
condition|)
name|arena_purge_all
argument_list|(
name|tarenas
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|assert
argument_list|(
name|arena_ind
operator|<
name|ctl_stats
operator|.
name|narenas
argument_list|)
expr_stmt|;
if|if
condition|(
name|tarenas
index|[
name|arena_ind
index|]
operator|!=
name|NULL
condition|)
name|arena_purge_all
argument_list|(
name|tarenas
index|[
name|arena_ind
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|arena_i_purge_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|READONLY
argument_list|()
expr_stmt|;
name|WRITEONLY
argument_list|()
expr_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|arena_purge
argument_list|(
name|mib
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arena_i_dss_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|,
name|i
decl_stmt|;
name|bool
name|match
decl_stmt|,
name|err
decl_stmt|;
specifier|const
name|char
modifier|*
name|dss
decl_stmt|;
name|unsigned
name|arena_ind
init|=
name|mib
index|[
literal|1
index|]
decl_stmt|;
name|dss_prec_t
name|dss_prec_old
init|=
name|dss_prec_limit
decl_stmt|;
name|dss_prec_t
name|dss_prec
init|=
name|dss_prec_limit
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|WRITE
argument_list|(
name|dss
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
expr_stmt|;
name|match
operator|=
name|false
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|dss_prec_limit
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|dss_prec_names
index|[
name|i
index|]
argument_list|,
name|dss
argument_list|)
operator|==
literal|0
condition|)
block|{
name|dss_prec
operator|=
name|i
expr_stmt|;
name|match
operator|=
name|true
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|match
operator|==
name|false
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
if|if
condition|(
name|arena_ind
operator|<
name|ctl_stats
operator|.
name|narenas
condition|)
block|{
name|arena_t
modifier|*
name|arena
init|=
name|arenas
index|[
name|arena_ind
index|]
decl_stmt|;
if|if
condition|(
name|arena
operator|!=
name|NULL
condition|)
block|{
name|dss_prec_old
operator|=
name|arena_dss_prec_get
argument_list|(
name|arena
argument_list|)
expr_stmt|;
name|arena_dss_prec_set
argument_list|(
name|arena
argument_list|,
name|dss_prec
argument_list|)
expr_stmt|;
name|err
operator|=
name|false
expr_stmt|;
block|}
else|else
name|err
operator|=
name|true
expr_stmt|;
block|}
else|else
block|{
name|dss_prec_old
operator|=
name|chunk_dss_prec_get
argument_list|()
expr_stmt|;
name|err
operator|=
name|chunk_dss_prec_set
argument_list|(
name|dss_prec
argument_list|)
expr_stmt|;
block|}
name|dss
operator|=
name|dss_prec_names
index|[
name|dss_prec_old
index|]
expr_stmt|;
name|READ
argument_list|(
name|dss
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|arena_i_index
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|i
parameter_list|)
block|{
specifier|const
name|ctl_named_node_t
modifier|*
name|ret
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|ctl_stats
operator|.
name|narenas
condition|)
block|{
name|ret
operator|=
name|NULL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|ret
operator|=
name|super_arena_i_node
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|arenas_narenas_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|narenas
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|READONLY
argument_list|()
expr_stmt|;
if|if
condition|(
operator|*
name|oldlenp
operator|!=
sizeof|sizeof
argument_list|(
name|unsigned
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|narenas
operator|=
name|ctl_stats
operator|.
name|narenas
expr_stmt|;
name|READ
argument_list|(
name|narenas
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arenas_initialized_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|nread
decl_stmt|,
name|i
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|READONLY
argument_list|()
expr_stmt|;
if|if
condition|(
operator|*
name|oldlenp
operator|!=
name|ctl_stats
operator|.
name|narenas
operator|*
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
name|nread
operator|=
operator|(
operator|*
name|oldlenp
operator|<
name|ctl_stats
operator|.
name|narenas
operator|*
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
operator|)
condition|?
operator|(
operator|*
name|oldlenp
operator|/
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
operator|)
else|:
name|ctl_stats
operator|.
name|narenas
expr_stmt|;
block|}
else|else
block|{
name|ret
operator|=
literal|0
expr_stmt|;
name|nread
operator|=
name|ctl_stats
operator|.
name|narenas
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nread
condition|;
name|i
operator|++
control|)
operator|(
operator|(
name|bool
operator|*
operator|)
name|oldp
operator|)
index|[
name|i
index|]
operator|=
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
operator|.
name|initialized
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_quantum
argument_list|,
argument|QUANTUM
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_page
argument_list|,
argument|PAGE
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_tcache
argument_list|,
argument|arenas_tcache_max
argument_list|,
argument|tcache_maxclass
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_nbins
argument_list|,
argument|NBINS
argument_list|,
argument|unsigned
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_tcache
argument_list|,
argument|arenas_nhbins
argument_list|,
argument|nhbins
argument_list|,
argument|unsigned
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_bin_i_size
argument_list|,
argument|arena_bin_info[mib[
literal|2
argument|]].reg_size
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_bin_i_nregs
argument_list|,
argument|arena_bin_info[mib[
literal|2
argument|]].nregs
argument_list|,
argument|uint32_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_bin_i_run_size
argument_list|,
argument|arena_bin_info[mib[
literal|2
argument|]].run_size
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|arenas_bin_i_index
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|i
parameter_list|)
block|{
if|if
condition|(
name|i
operator|>
name|NBINS
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|super_arenas_bin_i_node
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_nlruns
argument_list|,
argument|nlclasses
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_lrun_i_size
argument_list|,
argument|((mib[
literal|2
argument|]+
literal|1
argument|)<< LG_PAGE)
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|arenas_lrun_i_index
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|i
parameter_list|)
block|{
if|if
condition|(
name|i
operator|>
name|nlclasses
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|super_arenas_lrun_i_node
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arenas_purge_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|arena_ind
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|WRITEONLY
argument_list|()
expr_stmt|;
name|arena_ind
operator|=
name|UINT_MAX
expr_stmt|;
name|WRITE
argument_list|(
name|arena_ind
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
if|if
condition|(
name|newp
operator|!=
name|NULL
operator|&&
name|arena_ind
operator|>=
name|ctl_stats
operator|.
name|narenas
condition|)
name|ret
operator|=
name|EFAULT
expr_stmt|;
else|else
block|{
if|if
condition|(
name|arena_ind
operator|==
name|UINT_MAX
condition|)
name|arena_ind
operator|=
name|ctl_stats
operator|.
name|narenas
expr_stmt|;
name|arena_purge
argument_list|(
name|arena_ind
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
block|}
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arenas_extend_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|narenas
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|READONLY
argument_list|()
expr_stmt|;
if|if
condition|(
name|ctl_grow
argument_list|()
condition|)
block|{
name|ret
operator|=
name|EAGAIN
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|narenas
operator|=
name|ctl_stats
operator|.
name|narenas
operator|-
literal|1
expr_stmt|;
name|READ
argument_list|(
name|narenas
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|prof_active_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|bool
name|oldval
decl_stmt|;
if|if
condition|(
name|config_prof
operator|==
name|false
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
comment|/* Protect opt_prof_active. */
name|oldval
operator|=
name|opt_prof_active
expr_stmt|;
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
comment|/* 		 * The memory barriers will tend to make opt_prof_active 		 * propagate faster on systems with weak memory ordering. 		 */
name|mb_write
argument_list|()
expr_stmt|;
name|WRITE
argument_list|(
name|opt_prof_active
argument_list|,
name|bool
argument_list|)
expr_stmt|;
name|mb_write
argument_list|()
expr_stmt|;
block|}
name|READ
argument_list|(
name|oldval
argument_list|,
name|bool
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prof_dump_ctl
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
specifier|const
name|char
modifier|*
name|filename
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|config_prof
operator|==
name|false
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|WRITEONLY
argument_list|()
expr_stmt|;
name|WRITE
argument_list|(
name|filename
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
expr_stmt|;
if|if
condition|(
name|prof_mdump
argument_list|(
name|filename
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|prof_interval
argument_list|,
argument|prof_interval
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_comment
comment|/******************************************************************************/
end_comment

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_cactive
argument_list|,
argument|&stats_cactive
argument_list|,
argument|size_t *
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_allocated
argument_list|,
argument|ctl_stats.allocated
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_active
argument_list|,
argument|ctl_stats.active
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_mapped
argument_list|,
argument|ctl_stats.mapped
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_chunks_current
argument_list|,
argument|ctl_stats.chunks.current
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_chunks_total
argument_list|,
argument|ctl_stats.chunks.total
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_chunks_high
argument_list|,
argument|ctl_stats.chunks.high
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_huge_allocated
argument_list|,
argument|huge_allocated
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_huge_nmalloc
argument_list|,
argument|huge_nmalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_huge_ndalloc
argument_list|,
argument|huge_ndalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_GEN
argument_list|(
argument|stats_arenas_i_dss
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].dss
argument_list|,
argument|const char *
argument_list|)
end_macro

begin_macro
name|CTL_RO_GEN
argument_list|(
argument|stats_arenas_i_nthreads
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].nthreads
argument_list|,
argument|unsigned
argument_list|)
end_macro

begin_macro
name|CTL_RO_GEN
argument_list|(
argument|stats_arenas_i_pactive
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].pactive
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_GEN
argument_list|(
argument|stats_arenas_i_pdirty
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].pdirty
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_mapped
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.mapped
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_npurge
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.npurge
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_nmadvise
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.nmadvise
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_purged
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.purged
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_small_allocated
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].allocated_small
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_small_nmalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].nmalloc_small
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_small_ndalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].ndalloc_small
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_small_nrequests
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].nrequests_small
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_large_allocated
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.allocated_large
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_large_nmalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.nmalloc_large
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_large_ndalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.ndalloc_large
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_large_nrequests
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.nrequests_large
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_allocated
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].allocated
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_nmalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].nmalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_ndalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].ndalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_nrequests
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].nrequests
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats&& config_tcache
argument_list|,
argument|stats_arenas_i_bins_j_nfills
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].nfills
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats&& config_tcache
argument_list|,
argument|stats_arenas_i_bins_j_nflushes
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].nflushes
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_nruns
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].nruns
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_nreruns
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].reruns
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_curruns
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].curruns
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|stats_arenas_i_bins_j_index
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|j
parameter_list|)
block|{
if|if
condition|(
name|j
operator|>
name|NBINS
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|super_stats_arenas_i_bins_j_node
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_lruns_j_nmalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].lstats[mib[
literal|4
argument|]].nmalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_lruns_j_ndalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].lstats[mib[
literal|4
argument|]].ndalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_lruns_j_nrequests
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].lstats[mib[
literal|4
argument|]].nrequests
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_lruns_j_curruns
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].lstats[mib[
literal|4
argument|]].curruns
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|stats_arenas_i_lruns_j_index
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|j
parameter_list|)
block|{
if|if
condition|(
name|j
operator|>
name|nlclasses
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|super_stats_arenas_i_lruns_j_node
operator|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|stats_arenas_i_index
parameter_list|(
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|i
parameter_list|)
block|{
specifier|const
name|ctl_named_node_t
modifier|*
name|ret
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|ctl_stats
operator|.
name|narenas
operator|||
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
operator|.
name|initialized
operator|==
name|false
condition|)
block|{
name|ret
operator|=
name|NULL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|ret
operator|=
name|super_stats_arenas_i_node
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

end_unit

