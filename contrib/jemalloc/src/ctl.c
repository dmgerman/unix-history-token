begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_define
define|#
directive|define
name|JEMALLOC_CTL_C_
end_define

begin_include
include|#
directive|include
file|"jemalloc/internal/jemalloc_internal.h"
end_include

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/* Data. */
end_comment

begin_comment
comment|/*  * ctl_mtx protects the following:  * - ctl_stats.*  */
end_comment

begin_decl_stmt
specifier|static
name|malloc_mutex_t
name|ctl_mtx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|bool
name|ctl_initialized
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|uint64_t
name|ctl_epoch
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|ctl_stats_t
name|ctl_stats
decl_stmt|;
end_decl_stmt

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/* Helpers for named and indexed nodes. */
end_comment

begin_function
name|JEMALLOC_INLINE_C
specifier|const
name|ctl_named_node_t
modifier|*
name|ctl_named_node
parameter_list|(
specifier|const
name|ctl_node_t
modifier|*
name|node
parameter_list|)
block|{
return|return
operator|(
operator|(
name|node
operator|->
name|named
operator|)
condition|?
operator|(
specifier|const
name|ctl_named_node_t
operator|*
operator|)
name|node
else|:
name|NULL
operator|)
return|;
block|}
end_function

begin_function
name|JEMALLOC_INLINE_C
specifier|const
name|ctl_named_node_t
modifier|*
name|ctl_named_children
parameter_list|(
specifier|const
name|ctl_named_node_t
modifier|*
name|node
parameter_list|,
name|size_t
name|index
parameter_list|)
block|{
specifier|const
name|ctl_named_node_t
modifier|*
name|children
init|=
name|ctl_named_node
argument_list|(
name|node
operator|->
name|children
argument_list|)
decl_stmt|;
return|return
operator|(
name|children
condition|?
operator|&
name|children
index|[
name|index
index|]
else|:
name|NULL
operator|)
return|;
block|}
end_function

begin_function
name|JEMALLOC_INLINE_C
specifier|const
name|ctl_indexed_node_t
modifier|*
name|ctl_indexed_node
parameter_list|(
specifier|const
name|ctl_node_t
modifier|*
name|node
parameter_list|)
block|{
return|return
operator|(
operator|!
name|node
operator|->
name|named
condition|?
operator|(
specifier|const
name|ctl_indexed_node_t
operator|*
operator|)
name|node
else|:
name|NULL
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/* Function prototypes for non-inline static functions. */
end_comment

begin_define
define|#
directive|define
name|CTL_PROTO
parameter_list|(
name|n
parameter_list|)
define|\
value|static int	n##_ctl(tsd_t *tsd, const size_t *mib, size_t miblen,	\     void *oldp, size_t *oldlenp, void *newp, size_t newlen);
end_define

begin_define
define|#
directive|define
name|INDEX_PROTO
parameter_list|(
name|n
parameter_list|)
define|\
value|static const ctl_named_node_t	*n##_index(tsdn_t *tsdn,		\     const size_t *mib, size_t miblen, size_t i);
end_define

begin_function_decl
specifier|static
name|bool
name|ctl_arena_init
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ctl_arena_clear
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ctl_arena_stats_amerge
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
name|ctl_arena_stats_t
modifier|*
name|cstats
parameter_list|,
name|arena_t
modifier|*
name|arena
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ctl_arena_stats_smerge
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|sstats
parameter_list|,
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ctl_arena_refresh
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
name|arena_t
modifier|*
name|arena
parameter_list|,
name|unsigned
name|i
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|bool
name|ctl_grow
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ctl_refresh
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|bool
name|ctl_init
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|ctl_lookup
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|ctl_node_t
specifier|const
modifier|*
modifier|*
name|nodesp
parameter_list|,
name|size_t
modifier|*
name|mibp
parameter_list|,
name|size_t
modifier|*
name|depthp
parameter_list|)
function_decl|;
end_function_decl

begin_macro
name|CTL_PROTO
argument_list|(
argument|version
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|epoch
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_tcache_enabled
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_tcache_flush
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_prof_name
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_prof_active
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_arena
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_allocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_allocatedp
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_deallocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|thread_deallocatedp
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_cache_oblivious
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_debug
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_fill
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_lazy_lock
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_malloc_conf
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_munmap
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_prof
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_prof_libgcc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_prof_libunwind
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_stats
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_tcache
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_tls
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_utrace
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_valgrind
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|config_xmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_abort
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_dss
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_lg_chunk
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_narenas
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_purge
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_lg_dirty_mult
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_decay_time
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_stats_print
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_junk
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_zero
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_quarantine
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_redzone
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_utrace
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_xmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_tcache
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_lg_tcache_max
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_prefix
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_active
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_thread_active_init
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_lg_prof_sample
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_lg_prof_interval
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_gdump
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_final
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_leak
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|opt_prof_accum
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|tcache_create
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|tcache_flush
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|tcache_destroy
argument_list|)
end_macro

begin_function_decl
specifier|static
name|void
name|arena_i_purge
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
name|unsigned
name|arena_ind
parameter_list|,
name|bool
name|all
parameter_list|)
function_decl|;
end_function_decl

begin_macro
name|CTL_PROTO
argument_list|(
argument|arena_i_purge
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arena_i_decay
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arena_i_reset
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arena_i_dss
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arena_i_lg_dirty_mult
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arena_i_decay_time
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arena_i_chunk_hooks
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|arena_i
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_bin_i_size
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_bin_i_nregs
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_bin_i_run_size
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|arenas_bin_i
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_lrun_i_size
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|arenas_lrun_i
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_hchunk_i_size
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|arenas_hchunk_i
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_narenas
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_initialized
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_lg_dirty_mult
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_decay_time
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_quantum
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_page
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_tcache_max
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_nbins
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_nhbins
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_nlruns
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_nhchunks
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|arenas_extend
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|prof_thread_active_init
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|prof_active
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|prof_dump
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|prof_gdump
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|prof_reset
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|prof_interval
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|lg_prof_sample
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_small_allocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_small_nmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_small_ndalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_small_nrequests
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_large_allocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_large_nmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_large_ndalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_large_nrequests
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_huge_allocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_huge_nmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_huge_ndalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_huge_nrequests
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_ndalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nrequests
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_curregs
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nfills
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nflushes
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nruns
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_nreruns
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_bins_j_curruns
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|stats_arenas_i_bins_j
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_lruns_j_nmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_lruns_j_ndalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_lruns_j_nrequests
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_lruns_j_curruns
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|stats_arenas_i_lruns_j
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_hchunks_j_nmalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_hchunks_j_ndalloc
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_hchunks_j_nrequests
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_hchunks_j_curhchunks
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|stats_arenas_i_hchunks_j
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_nthreads
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_dss
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_lg_dirty_mult
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_decay_time
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_pactive
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_pdirty
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_mapped
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_retained
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_npurge
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_nmadvise
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_purged
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_metadata_mapped
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_arenas_i_metadata_allocated
argument_list|)
end_macro

begin_macro
name|INDEX_PROTO
argument_list|(
argument|stats_arenas_i
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_cactive
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_allocated
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_active
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_metadata
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_resident
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_mapped
argument_list|)
end_macro

begin_macro
name|CTL_PROTO
argument_list|(
argument|stats_retained
argument_list|)
end_macro

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/* mallctl tree. */
end_comment

begin_comment
comment|/* Maximum tree depth. */
end_comment

begin_define
define|#
directive|define
name|CTL_MAX_DEPTH
value|6
end_define

begin_define
define|#
directive|define
name|NAME
parameter_list|(
name|n
parameter_list|)
value|{true},	n
end_define

begin_define
define|#
directive|define
name|CHILD
parameter_list|(
name|t
parameter_list|,
name|c
parameter_list|)
define|\
value|sizeof(c##_node) / sizeof(ctl_##t##_node_t),			\ 	(ctl_node_t *)c##_node,						\ 	NULL
end_define

begin_define
define|#
directive|define
name|CTL
parameter_list|(
name|c
parameter_list|)
value|0, NULL, c##_ctl
end_define

begin_comment
comment|/*  * Only handles internal indexed nodes, since there are currently no external  * ones.  */
end_comment

begin_define
define|#
directive|define
name|INDEX
parameter_list|(
name|i
parameter_list|)
value|{false},	i##_index
end_define

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|thread_tcache_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"enabled"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_tcache_enabled
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"flush"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_tcache_flush
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|thread_prof_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"name"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_prof_name
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"active"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_prof_active
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|thread_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"arena"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_arena
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_allocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"allocatedp"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_allocatedp
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"deallocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_deallocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"deallocatedp"
argument_list|)
block|,
name|CTL
argument_list|(
argument|thread_deallocatedp
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"tcache"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|thread_tcache
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|thread_prof
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|config_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"cache_oblivious"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_cache_oblivious
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"debug"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_debug
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"fill"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_fill
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lazy_lock"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_lazy_lock
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"malloc_conf"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_malloc_conf
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"munmap"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_munmap
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_prof
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_libgcc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_prof_libgcc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_libunwind"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_prof_libunwind
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"stats"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_stats
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"tcache"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_tcache
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"tls"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_tls
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"utrace"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_utrace
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"valgrind"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_valgrind
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"xmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|config_xmalloc
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|opt_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"abort"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_abort
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"dss"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_dss
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_chunk"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_lg_chunk
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"narenas"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_narenas
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"purge"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_purge
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_dirty_mult"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_lg_dirty_mult
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"decay_time"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_decay_time
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"stats_print"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_stats_print
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"junk"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_junk
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"zero"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_zero
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"quarantine"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_quarantine
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"redzone"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_redzone
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"utrace"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_utrace
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"xmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_xmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"tcache"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_tcache
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_tcache_max"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_lg_tcache_max
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_prefix"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_prefix
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_active"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_active
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_thread_active_init"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_thread_active_init
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_prof_sample"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_lg_prof_sample
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_prof_interval"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_lg_prof_interval
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_gdump"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_gdump
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_final"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_final
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_leak"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_leak
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof_accum"
argument_list|)
block|,
name|CTL
argument_list|(
argument|opt_prof_accum
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|tcache_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"create"
argument_list|)
block|,
name|CTL
argument_list|(
argument|tcache_create
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"flush"
argument_list|)
block|,
name|CTL
argument_list|(
argument|tcache_flush
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"destroy"
argument_list|)
block|,
name|CTL
argument_list|(
argument|tcache_destroy
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|arena_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"purge"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arena_i_purge
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"decay"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arena_i_decay
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"reset"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arena_i_reset
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"dss"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arena_i_dss
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_dirty_mult"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arena_i_lg_dirty_mult
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"decay_time"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arena_i_decay_time
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"chunk_hooks"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arena_i_chunk_hooks
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_arena_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|arena_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|arena_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|arena_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|arenas_bin_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"size"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_bin_i_size
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nregs"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_bin_i_nregs
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"run_size"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_bin_i_run_size
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_arenas_bin_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|arenas_bin_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|arenas_bin_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|arenas_bin_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|arenas_lrun_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"size"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_lrun_i_size
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_arenas_lrun_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|arenas_lrun_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|arenas_lrun_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|arenas_lrun_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|arenas_hchunk_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"size"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_hchunk_i_size
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_arenas_hchunk_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|arenas_hchunk_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|arenas_hchunk_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|arenas_hchunk_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|arenas_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"narenas"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_narenas
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"initialized"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_initialized
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_dirty_mult"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_lg_dirty_mult
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"decay_time"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_decay_time
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"quantum"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_quantum
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"page"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_page
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"tcache_max"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_tcache_max
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nbins"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_nbins
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nhbins"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_nhbins
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"bin"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|arenas_bin
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nlruns"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_nlruns
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lrun"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|arenas_lrun
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nhchunks"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_nhchunks
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"hchunk"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|arenas_hchunk
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"extend"
argument_list|)
block|,
name|CTL
argument_list|(
argument|arenas_extend
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|prof_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"thread_active_init"
argument_list|)
block|,
name|CTL
argument_list|(
argument|prof_thread_active_init
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"active"
argument_list|)
block|,
name|CTL
argument_list|(
argument|prof_active
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"dump"
argument_list|)
block|,
name|CTL
argument_list|(
argument|prof_dump
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"gdump"
argument_list|)
block|,
name|CTL
argument_list|(
argument|prof_gdump
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"reset"
argument_list|)
block|,
name|CTL
argument_list|(
argument|prof_reset
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"interval"
argument_list|)
block|,
name|CTL
argument_list|(
argument|prof_interval
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_sample"
argument_list|)
block|,
name|CTL
argument_list|(
argument|lg_prof_sample
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_metadata_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"mapped"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_metadata_mapped
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_metadata_allocated
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_small_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_small_allocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_small_nmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"ndalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_small_ndalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nrequests"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_small_nrequests
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_large_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_large_allocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_large_nmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"ndalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_large_ndalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nrequests"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_large_nrequests
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_huge_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_huge_allocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_huge_nmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"ndalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_huge_ndalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nrequests"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_huge_nrequests
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_bins_j_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"nmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"ndalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_ndalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nrequests"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nrequests
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"curregs"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_curregs
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nfills"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nfills
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nflushes"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nflushes
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nruns"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nruns
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nreruns"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_nreruns
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"curruns"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_bins_j_curruns
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_stats_arenas_i_bins_j_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i_bins_j
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|stats_arenas_i_bins_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|stats_arenas_i_bins_j
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_lruns_j_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"nmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_lruns_j_nmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"ndalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_lruns_j_ndalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nrequests"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_lruns_j_nrequests
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"curruns"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_lruns_j_curruns
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_stats_arenas_i_lruns_j_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i_lruns_j
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|stats_arenas_i_lruns_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|stats_arenas_i_lruns_j
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_hchunks_j_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"nmalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_hchunks_j_nmalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"ndalloc"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_hchunks_j_ndalloc
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nrequests"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_hchunks_j_nrequests
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"curhchunks"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_hchunks_j_curhchunks
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_stats_arenas_i_hchunks_j_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i_hchunks_j
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|stats_arenas_i_hchunks_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|stats_arenas_i_hchunks_j
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_arenas_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"nthreads"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_nthreads
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"dss"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_dss
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lg_dirty_mult"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_lg_dirty_mult
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"decay_time"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_decay_time
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"pactive"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_pactive
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"pdirty"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_pdirty
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"mapped"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_mapped
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"retained"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_retained
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"npurge"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_npurge
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"nmadvise"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_nmadvise
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"purged"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_arenas_i_purged
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"metadata"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i_metadata
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"small"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i_small
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"large"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i_large
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"huge"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i_huge
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"bins"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|stats_arenas_i_bins
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"lruns"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|stats_arenas_i_lruns
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"hchunks"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|stats_arenas_i_hchunks
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_stats_arenas_i_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats_arenas_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_indexed_node_t
name|stats_arenas_node
index|[]
init|=
block|{
block|{
name|INDEX
argument_list|(
argument|stats_arenas_i
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|stats_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"cactive"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_cactive
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"allocated"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_allocated
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"active"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_active
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"metadata"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_metadata
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"resident"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_resident
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"mapped"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_mapped
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"retained"
argument_list|)
block|,
name|CTL
argument_list|(
argument|stats_retained
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"arenas"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|stats_arenas
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|root_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|"version"
argument_list|)
block|,
name|CTL
argument_list|(
argument|version
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"epoch"
argument_list|)
block|,
name|CTL
argument_list|(
argument|epoch
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"thread"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|thread
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"config"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|config
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"opt"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|opt
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"tcache"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|tcache
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"arena"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|indexed
argument_list|,
argument|arena
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"arenas"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|arenas
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"prof"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|prof
argument_list|)
block|}
block|,
block|{
name|NAME
argument_list|(
literal|"stats"
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|stats
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|ctl_named_node_t
name|super_root_node
index|[]
init|=
block|{
block|{
name|NAME
argument_list|(
literal|""
argument_list|)
block|,
name|CHILD
argument_list|(
argument|named
argument_list|,
argument|root
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|NAME
end_undef

begin_undef
undef|#
directive|undef
name|CHILD
end_undef

begin_undef
undef|#
directive|undef
name|CTL
end_undef

begin_undef
undef|#
directive|undef
name|INDEX
end_undef

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|bool
name|ctl_arena_init
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
block|{
if|if
condition|(
name|astats
operator|->
name|lstats
operator|==
name|NULL
condition|)
block|{
name|astats
operator|->
name|lstats
operator|=
operator|(
name|malloc_large_stats_t
operator|*
operator|)
name|a0malloc
argument_list|(
name|nlclasses
operator|*
sizeof|sizeof
argument_list|(
name|malloc_large_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|astats
operator|->
name|lstats
operator|==
name|NULL
condition|)
return|return
operator|(
name|true
operator|)
return|;
block|}
if|if
condition|(
name|astats
operator|->
name|hstats
operator|==
name|NULL
condition|)
block|{
name|astats
operator|->
name|hstats
operator|=
operator|(
name|malloc_huge_stats_t
operator|*
operator|)
name|a0malloc
argument_list|(
name|nhclasses
operator|*
sizeof|sizeof
argument_list|(
name|malloc_huge_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|astats
operator|->
name|hstats
operator|==
name|NULL
condition|)
return|return
operator|(
name|true
operator|)
return|;
block|}
return|return
operator|(
name|false
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|ctl_arena_clear
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
block|{
name|astats
operator|->
name|nthreads
operator|=
literal|0
expr_stmt|;
name|astats
operator|->
name|dss
operator|=
name|dss_prec_names
index|[
name|dss_prec_limit
index|]
expr_stmt|;
name|astats
operator|->
name|lg_dirty_mult
operator|=
operator|-
literal|1
expr_stmt|;
name|astats
operator|->
name|decay_time
operator|=
operator|-
literal|1
expr_stmt|;
name|astats
operator|->
name|pactive
operator|=
literal|0
expr_stmt|;
name|astats
operator|->
name|pdirty
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|config_stats
condition|)
block|{
name|memset
argument_list|(
operator|&
name|astats
operator|->
name|astats
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
name|astats
operator|->
name|allocated_small
operator|=
literal|0
expr_stmt|;
name|astats
operator|->
name|nmalloc_small
operator|=
literal|0
expr_stmt|;
name|astats
operator|->
name|ndalloc_small
operator|=
literal|0
expr_stmt|;
name|astats
operator|->
name|nrequests_small
operator|=
literal|0
expr_stmt|;
name|memset
argument_list|(
name|astats
operator|->
name|bstats
argument_list|,
literal|0
argument_list|,
name|NBINS
operator|*
sizeof|sizeof
argument_list|(
name|malloc_bin_stats_t
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|astats
operator|->
name|lstats
argument_list|,
literal|0
argument_list|,
name|nlclasses
operator|*
sizeof|sizeof
argument_list|(
name|malloc_large_stats_t
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|astats
operator|->
name|hstats
argument_list|,
literal|0
argument_list|,
name|nhclasses
operator|*
sizeof|sizeof
argument_list|(
name|malloc_huge_stats_t
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|ctl_arena_stats_amerge
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
name|ctl_arena_stats_t
modifier|*
name|cstats
parameter_list|,
name|arena_t
modifier|*
name|arena
parameter_list|)
block|{
name|unsigned
name|i
decl_stmt|;
if|if
condition|(
name|config_stats
condition|)
block|{
name|arena_stats_merge
argument_list|(
name|tsdn
argument_list|,
name|arena
argument_list|,
operator|&
name|cstats
operator|->
name|nthreads
argument_list|,
operator|&
name|cstats
operator|->
name|dss
argument_list|,
operator|&
name|cstats
operator|->
name|lg_dirty_mult
argument_list|,
operator|&
name|cstats
operator|->
name|decay_time
argument_list|,
operator|&
name|cstats
operator|->
name|pactive
argument_list|,
operator|&
name|cstats
operator|->
name|pdirty
argument_list|,
operator|&
name|cstats
operator|->
name|astats
argument_list|,
name|cstats
operator|->
name|bstats
argument_list|,
name|cstats
operator|->
name|lstats
argument_list|,
name|cstats
operator|->
name|hstats
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NBINS
condition|;
name|i
operator|++
control|)
block|{
name|cstats
operator|->
name|allocated_small
operator|+=
name|cstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|curregs
operator|*
name|index2size
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|cstats
operator|->
name|nmalloc_small
operator|+=
name|cstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nmalloc
expr_stmt|;
name|cstats
operator|->
name|ndalloc_small
operator|+=
name|cstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|ndalloc
expr_stmt|;
name|cstats
operator|->
name|nrequests_small
operator|+=
name|cstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nrequests
expr_stmt|;
block|}
block|}
else|else
block|{
name|arena_basic_stats_merge
argument_list|(
name|tsdn
argument_list|,
name|arena
argument_list|,
operator|&
name|cstats
operator|->
name|nthreads
argument_list|,
operator|&
name|cstats
operator|->
name|dss
argument_list|,
operator|&
name|cstats
operator|->
name|lg_dirty_mult
argument_list|,
operator|&
name|cstats
operator|->
name|decay_time
argument_list|,
operator|&
name|cstats
operator|->
name|pactive
argument_list|,
operator|&
name|cstats
operator|->
name|pdirty
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|ctl_arena_stats_smerge
parameter_list|(
name|ctl_arena_stats_t
modifier|*
name|sstats
parameter_list|,
name|ctl_arena_stats_t
modifier|*
name|astats
parameter_list|)
block|{
name|unsigned
name|i
decl_stmt|;
name|sstats
operator|->
name|nthreads
operator|+=
name|astats
operator|->
name|nthreads
expr_stmt|;
name|sstats
operator|->
name|pactive
operator|+=
name|astats
operator|->
name|pactive
expr_stmt|;
name|sstats
operator|->
name|pdirty
operator|+=
name|astats
operator|->
name|pdirty
expr_stmt|;
if|if
condition|(
name|config_stats
condition|)
block|{
name|sstats
operator|->
name|astats
operator|.
name|mapped
operator|+=
name|astats
operator|->
name|astats
operator|.
name|mapped
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|retained
operator|+=
name|astats
operator|->
name|astats
operator|.
name|retained
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|npurge
operator|+=
name|astats
operator|->
name|astats
operator|.
name|npurge
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|nmadvise
operator|+=
name|astats
operator|->
name|astats
operator|.
name|nmadvise
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|purged
operator|+=
name|astats
operator|->
name|astats
operator|.
name|purged
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|metadata_mapped
operator|+=
name|astats
operator|->
name|astats
operator|.
name|metadata_mapped
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|metadata_allocated
operator|+=
name|astats
operator|->
name|astats
operator|.
name|metadata_allocated
expr_stmt|;
name|sstats
operator|->
name|allocated_small
operator|+=
name|astats
operator|->
name|allocated_small
expr_stmt|;
name|sstats
operator|->
name|nmalloc_small
operator|+=
name|astats
operator|->
name|nmalloc_small
expr_stmt|;
name|sstats
operator|->
name|ndalloc_small
operator|+=
name|astats
operator|->
name|ndalloc_small
expr_stmt|;
name|sstats
operator|->
name|nrequests_small
operator|+=
name|astats
operator|->
name|nrequests_small
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|allocated_large
operator|+=
name|astats
operator|->
name|astats
operator|.
name|allocated_large
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|nmalloc_large
operator|+=
name|astats
operator|->
name|astats
operator|.
name|nmalloc_large
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|ndalloc_large
operator|+=
name|astats
operator|->
name|astats
operator|.
name|ndalloc_large
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|nrequests_large
operator|+=
name|astats
operator|->
name|astats
operator|.
name|nrequests_large
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|allocated_huge
operator|+=
name|astats
operator|->
name|astats
operator|.
name|allocated_huge
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|nmalloc_huge
operator|+=
name|astats
operator|->
name|astats
operator|.
name|nmalloc_huge
expr_stmt|;
name|sstats
operator|->
name|astats
operator|.
name|ndalloc_huge
operator|+=
name|astats
operator|->
name|astats
operator|.
name|ndalloc_huge
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NBINS
condition|;
name|i
operator|++
control|)
block|{
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nmalloc
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nmalloc
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|ndalloc
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|ndalloc
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nrequests
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nrequests
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|curregs
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|curregs
expr_stmt|;
if|if
condition|(
name|config_tcache
condition|)
block|{
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nfills
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nfills
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nflushes
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nflushes
expr_stmt|;
block|}
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nruns
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|nruns
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|reruns
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|reruns
expr_stmt|;
name|sstats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|curruns
operator|+=
name|astats
operator|->
name|bstats
index|[
name|i
index|]
operator|.
name|curruns
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nlclasses
condition|;
name|i
operator|++
control|)
block|{
name|sstats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|nmalloc
operator|+=
name|astats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|nmalloc
expr_stmt|;
name|sstats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|ndalloc
operator|+=
name|astats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|ndalloc
expr_stmt|;
name|sstats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|nrequests
operator|+=
name|astats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|nrequests
expr_stmt|;
name|sstats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|curruns
operator|+=
name|astats
operator|->
name|lstats
index|[
name|i
index|]
operator|.
name|curruns
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nhclasses
condition|;
name|i
operator|++
control|)
block|{
name|sstats
operator|->
name|hstats
index|[
name|i
index|]
operator|.
name|nmalloc
operator|+=
name|astats
operator|->
name|hstats
index|[
name|i
index|]
operator|.
name|nmalloc
expr_stmt|;
name|sstats
operator|->
name|hstats
index|[
name|i
index|]
operator|.
name|ndalloc
operator|+=
name|astats
operator|->
name|hstats
index|[
name|i
index|]
operator|.
name|ndalloc
expr_stmt|;
name|sstats
operator|->
name|hstats
index|[
name|i
index|]
operator|.
name|curhchunks
operator|+=
name|astats
operator|->
name|hstats
index|[
name|i
index|]
operator|.
name|curhchunks
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|ctl_arena_refresh
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
name|arena_t
modifier|*
name|arena
parameter_list|,
name|unsigned
name|i
parameter_list|)
block|{
name|ctl_arena_stats_t
modifier|*
name|astats
init|=
operator|&
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
decl_stmt|;
name|ctl_arena_stats_t
modifier|*
name|sstats
init|=
operator|&
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
decl_stmt|;
name|ctl_arena_clear
argument_list|(
name|astats
argument_list|)
expr_stmt|;
name|ctl_arena_stats_amerge
argument_list|(
name|tsdn
argument_list|,
name|astats
argument_list|,
name|arena
argument_list|)
expr_stmt|;
comment|/* Merge into sum stats as well. */
name|ctl_arena_stats_smerge
argument_list|(
name|sstats
argument_list|,
name|astats
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|bool
name|ctl_grow
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|)
block|{
name|ctl_arena_stats_t
modifier|*
name|astats
decl_stmt|;
comment|/* Initialize new arena. */
if|if
condition|(
name|arena_init
argument_list|(
name|tsdn
argument_list|,
name|ctl_stats
operator|.
name|narenas
argument_list|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|true
operator|)
return|;
comment|/* Allocate extended arena stats. */
name|astats
operator|=
operator|(
name|ctl_arena_stats_t
operator|*
operator|)
name|a0malloc
argument_list|(
operator|(
name|ctl_stats
operator|.
name|narenas
operator|+
literal|2
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|astats
operator|==
name|NULL
condition|)
return|return
operator|(
name|true
operator|)
return|;
comment|/* Initialize the new astats element. */
name|memcpy
argument_list|(
name|astats
argument_list|,
name|ctl_stats
operator|.
name|arenas
argument_list|,
operator|(
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
index|]
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl_arena_init
argument_list|(
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
index|]
argument_list|)
condition|)
block|{
name|a0dalloc
argument_list|(
name|astats
argument_list|)
expr_stmt|;
return|return
operator|(
name|true
operator|)
return|;
block|}
comment|/* Swap merged stats to their new location. */
block|{
name|ctl_arena_stats_t
name|tstats
decl_stmt|;
name|memcpy
argument_list|(
operator|&
name|tstats
argument_list|,
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
index|]
argument_list|,
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|astats
index|[
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
index|]
argument_list|,
operator|&
name|tstats
argument_list|,
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|a0dalloc
argument_list|(
name|ctl_stats
operator|.
name|arenas
argument_list|)
expr_stmt|;
name|ctl_stats
operator|.
name|arenas
operator|=
name|astats
expr_stmt|;
name|ctl_stats
operator|.
name|narenas
operator|++
expr_stmt|;
return|return
operator|(
name|false
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|ctl_refresh
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|)
block|{
name|unsigned
name|i
decl_stmt|;
name|VARIABLE_ARRAY
argument_list|(
name|arena_t
operator|*
argument_list|,
name|tarenas
argument_list|,
name|ctl_stats
operator|.
name|narenas
argument_list|)
expr_stmt|;
comment|/* 	 * Clear sum stats, since they will be merged into by 	 * ctl_arena_refresh(). 	 */
name|ctl_arena_clear
argument_list|(
operator|&
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ctl_stats
operator|.
name|narenas
condition|;
name|i
operator|++
control|)
name|tarenas
index|[
name|i
index|]
operator|=
name|arena_get
argument_list|(
name|tsdn
argument_list|,
name|i
argument_list|,
name|false
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ctl_stats
operator|.
name|narenas
condition|;
name|i
operator|++
control|)
block|{
name|bool
name|initialized
init|=
operator|(
name|tarenas
index|[
name|i
index|]
operator|!=
name|NULL
operator|)
decl_stmt|;
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
operator|.
name|initialized
operator|=
name|initialized
expr_stmt|;
if|if
condition|(
name|initialized
condition|)
name|ctl_arena_refresh
argument_list|(
name|tsdn
argument_list|,
name|tarenas
index|[
name|i
index|]
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|config_stats
condition|)
block|{
name|size_t
name|base_allocated
decl_stmt|,
name|base_resident
decl_stmt|,
name|base_mapped
decl_stmt|;
name|base_stats_get
argument_list|(
name|tsdn
argument_list|,
operator|&
name|base_allocated
argument_list|,
operator|&
name|base_resident
argument_list|,
operator|&
name|base_mapped
argument_list|)
expr_stmt|;
name|ctl_stats
operator|.
name|allocated
operator|=
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|allocated_small
operator|+
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|astats
operator|.
name|allocated_large
operator|+
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|astats
operator|.
name|allocated_huge
expr_stmt|;
name|ctl_stats
operator|.
name|active
operator|=
operator|(
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|pactive
operator|<<
name|LG_PAGE
operator|)
expr_stmt|;
name|ctl_stats
operator|.
name|metadata
operator|=
name|base_allocated
operator|+
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|astats
operator|.
name|metadata_mapped
operator|+
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|astats
operator|.
name|metadata_allocated
expr_stmt|;
name|ctl_stats
operator|.
name|resident
operator|=
name|base_resident
operator|+
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|astats
operator|.
name|metadata_mapped
operator|+
operator|(
operator|(
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|pactive
operator|+
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|pdirty
operator|)
operator|<<
name|LG_PAGE
operator|)
expr_stmt|;
name|ctl_stats
operator|.
name|mapped
operator|=
name|base_mapped
operator|+
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|astats
operator|.
name|mapped
expr_stmt|;
name|ctl_stats
operator|.
name|retained
operator|=
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|astats
operator|.
name|retained
expr_stmt|;
block|}
name|ctl_epoch
operator|++
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|bool
name|ctl_init
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|)
block|{
name|bool
name|ret
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ctl_initialized
condition|)
block|{
comment|/* 		 * Allocate space for one extra arena stats element, which 		 * contains summed stats across all arenas. 		 */
name|ctl_stats
operator|.
name|narenas
operator|=
name|narenas_total_get
argument_list|()
expr_stmt|;
name|ctl_stats
operator|.
name|arenas
operator|=
operator|(
name|ctl_arena_stats_t
operator|*
operator|)
name|a0malloc
argument_list|(
operator|(
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl_stats
operator|.
name|arenas
operator|==
name|NULL
condition|)
block|{
name|ret
operator|=
name|true
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|memset
argument_list|(
name|ctl_stats
operator|.
name|arenas
argument_list|,
literal|0
argument_list|,
operator|(
name|ctl_stats
operator|.
name|narenas
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|ctl_arena_stats_t
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 		 * Initialize all stats structures, regardless of whether they 		 * ever get used.  Lazy initialization would allow errors to 		 * cause inconsistent state to be viewable by the application. 		 */
if|if
condition|(
name|config_stats
condition|)
block|{
name|unsigned
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|ctl_stats
operator|.
name|narenas
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ctl_arena_init
argument_list|(
operator|&
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
argument_list|)
condition|)
block|{
name|unsigned
name|j
decl_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|i
condition|;
name|j
operator|++
control|)
block|{
name|a0dalloc
argument_list|(
name|ctl_stats
operator|.
name|arenas
index|[
name|j
index|]
operator|.
name|lstats
argument_list|)
expr_stmt|;
name|a0dalloc
argument_list|(
name|ctl_stats
operator|.
name|arenas
index|[
name|j
index|]
operator|.
name|hstats
argument_list|)
expr_stmt|;
block|}
name|a0dalloc
argument_list|(
name|ctl_stats
operator|.
name|arenas
argument_list|)
expr_stmt|;
name|ctl_stats
operator|.
name|arenas
operator|=
name|NULL
expr_stmt|;
name|ret
operator|=
name|true
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
block|}
name|ctl_stats
operator|.
name|arenas
index|[
name|ctl_stats
operator|.
name|narenas
index|]
operator|.
name|initialized
operator|=
name|true
expr_stmt|;
name|ctl_epoch
operator|=
literal|0
expr_stmt|;
name|ctl_refresh
argument_list|(
name|tsdn
argument_list|)
expr_stmt|;
name|ctl_initialized
operator|=
name|true
expr_stmt|;
block|}
name|ret
operator|=
name|false
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ctl_lookup
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|ctl_node_t
specifier|const
modifier|*
modifier|*
name|nodesp
parameter_list|,
name|size_t
modifier|*
name|mibp
parameter_list|,
name|size_t
modifier|*
name|depthp
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
specifier|const
name|char
modifier|*
name|elm
decl_stmt|,
modifier|*
name|tdot
decl_stmt|,
modifier|*
name|dot
decl_stmt|;
name|size_t
name|elen
decl_stmt|,
name|i
decl_stmt|,
name|j
decl_stmt|;
specifier|const
name|ctl_named_node_t
modifier|*
name|node
decl_stmt|;
name|elm
operator|=
name|name
expr_stmt|;
comment|/* Equivalent to strchrnul(). */
name|dot
operator|=
operator|(
operator|(
name|tdot
operator|=
name|strchr
argument_list|(
name|elm
argument_list|,
literal|'.'
argument_list|)
operator|)
operator|!=
name|NULL
operator|)
condition|?
name|tdot
else|:
name|strchr
argument_list|(
name|elm
argument_list|,
literal|'\0'
argument_list|)
expr_stmt|;
name|elen
operator|=
call|(
name|size_t
call|)
argument_list|(
operator|(
name|uintptr_t
operator|)
name|dot
operator|-
operator|(
name|uintptr_t
operator|)
name|elm
argument_list|)
expr_stmt|;
if|if
condition|(
name|elen
operator|==
literal|0
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|node
operator|=
name|super_root_node
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|*
name|depthp
condition|;
name|i
operator|++
control|)
block|{
name|assert
argument_list|(
name|node
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|node
operator|->
name|nchildren
operator|>
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl_named_node
argument_list|(
name|node
operator|->
name|children
argument_list|)
operator|!=
name|NULL
condition|)
block|{
specifier|const
name|ctl_named_node_t
modifier|*
name|pnode
init|=
name|node
decl_stmt|;
comment|/* Children are named. */
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|node
operator|->
name|nchildren
condition|;
name|j
operator|++
control|)
block|{
specifier|const
name|ctl_named_node_t
modifier|*
name|child
init|=
name|ctl_named_children
argument_list|(
name|node
argument_list|,
name|j
argument_list|)
decl_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|child
operator|->
name|name
argument_list|)
operator|==
name|elen
operator|&&
name|strncmp
argument_list|(
name|elm
argument_list|,
name|child
operator|->
name|name
argument_list|,
name|elen
argument_list|)
operator|==
literal|0
condition|)
block|{
name|node
operator|=
name|child
expr_stmt|;
if|if
condition|(
name|nodesp
operator|!=
name|NULL
condition|)
name|nodesp
index|[
name|i
index|]
operator|=
operator|(
specifier|const
name|ctl_node_t
operator|*
operator|)
name|node
expr_stmt|;
name|mibp
index|[
name|i
index|]
operator|=
name|j
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|node
operator|==
name|pnode
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
else|else
block|{
name|uintmax_t
name|index
decl_stmt|;
specifier|const
name|ctl_indexed_node_t
modifier|*
name|inode
decl_stmt|;
comment|/* Children are indexed. */
name|index
operator|=
name|malloc_strtoumax
argument_list|(
name|elm
argument_list|,
name|NULL
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
operator|==
name|UINTMAX_MAX
operator|||
name|index
operator|>
name|SIZE_T_MAX
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|inode
operator|=
name|ctl_indexed_node
argument_list|(
name|node
operator|->
name|children
argument_list|)
expr_stmt|;
name|node
operator|=
name|inode
operator|->
name|index
argument_list|(
name|tsdn
argument_list|,
name|mibp
argument_list|,
operator|*
name|depthp
argument_list|,
operator|(
name|size_t
operator|)
name|index
argument_list|)
expr_stmt|;
if|if
condition|(
name|node
operator|==
name|NULL
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
if|if
condition|(
name|nodesp
operator|!=
name|NULL
condition|)
name|nodesp
index|[
name|i
index|]
operator|=
operator|(
specifier|const
name|ctl_node_t
operator|*
operator|)
name|node
expr_stmt|;
name|mibp
index|[
name|i
index|]
operator|=
operator|(
name|size_t
operator|)
name|index
expr_stmt|;
block|}
if|if
condition|(
name|node
operator|->
name|ctl
operator|!=
name|NULL
condition|)
block|{
comment|/* Terminal node. */
if|if
condition|(
operator|*
name|dot
operator|!=
literal|'\0'
condition|)
block|{
comment|/* 				 * The name contains more elements than are 				 * in this path through the tree. 				 */
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
comment|/* Complete lookup successful. */
operator|*
name|depthp
operator|=
name|i
operator|+
literal|1
expr_stmt|;
break|break;
block|}
comment|/* Update elm. */
if|if
condition|(
operator|*
name|dot
operator|==
literal|'\0'
condition|)
block|{
comment|/* No more elements. */
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|elm
operator|=
operator|&
name|dot
index|[
literal|1
index|]
expr_stmt|;
name|dot
operator|=
operator|(
operator|(
name|tdot
operator|=
name|strchr
argument_list|(
name|elm
argument_list|,
literal|'.'
argument_list|)
operator|)
operator|!=
name|NULL
operator|)
condition|?
name|tdot
else|:
name|strchr
argument_list|(
name|elm
argument_list|,
literal|'\0'
argument_list|)
expr_stmt|;
name|elen
operator|=
call|(
name|size_t
call|)
argument_list|(
operator|(
name|uintptr_t
operator|)
name|dot
operator|-
operator|(
name|uintptr_t
operator|)
name|elm
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|int
name|ctl_byname
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|size_t
name|depth
decl_stmt|;
name|ctl_node_t
specifier|const
modifier|*
name|nodes
index|[
name|CTL_MAX_DEPTH
index|]
decl_stmt|;
name|size_t
name|mib
index|[
name|CTL_MAX_DEPTH
index|]
decl_stmt|;
specifier|const
name|ctl_named_node_t
modifier|*
name|node
decl_stmt|;
if|if
condition|(
operator|!
name|ctl_initialized
operator|&&
name|ctl_init
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EAGAIN
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|depth
operator|=
name|CTL_MAX_DEPTH
expr_stmt|;
name|ret
operator|=
name|ctl_lookup
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|name
argument_list|,
name|nodes
argument_list|,
name|mib
argument_list|,
operator|&
name|depth
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|0
condition|)
goto|goto
name|label_return
goto|;
name|node
operator|=
name|ctl_named_node
argument_list|(
name|nodes
index|[
name|depth
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|node
operator|!=
name|NULL
operator|&&
name|node
operator|->
name|ctl
condition|)
name|ret
operator|=
name|node
operator|->
name|ctl
argument_list|(
name|tsd
argument_list|,
name|mib
argument_list|,
name|depth
argument_list|,
name|oldp
argument_list|,
name|oldlenp
argument_list|,
name|newp
argument_list|,
name|newlen
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* The name refers to a partial path through the ctl tree. */
name|ret
operator|=
name|ENOENT
expr_stmt|;
block|}
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|int
name|ctl_nametomib
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|size_t
modifier|*
name|mibp
parameter_list|,
name|size_t
modifier|*
name|miblenp
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
if|if
condition|(
operator|!
name|ctl_initialized
operator|&&
name|ctl_init
argument_list|(
name|tsdn
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EAGAIN
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|ret
operator|=
name|ctl_lookup
argument_list|(
name|tsdn
argument_list|,
name|name
argument_list|,
name|NULL
argument_list|,
name|mibp
argument_list|,
name|miblenp
argument_list|)
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|int
name|ctl_bymib
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
specifier|const
name|ctl_named_node_t
modifier|*
name|node
decl_stmt|;
name|size_t
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|ctl_initialized
operator|&&
name|ctl_init
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EAGAIN
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
comment|/* Iterate down the tree. */
name|node
operator|=
name|super_root_node
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|miblen
condition|;
name|i
operator|++
control|)
block|{
name|assert
argument_list|(
name|node
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|node
operator|->
name|nchildren
operator|>
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl_named_node
argument_list|(
name|node
operator|->
name|children
argument_list|)
operator|!=
name|NULL
condition|)
block|{
comment|/* Children are named. */
if|if
condition|(
name|node
operator|->
name|nchildren
operator|<=
operator|(
name|unsigned
operator|)
name|mib
index|[
name|i
index|]
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|node
operator|=
name|ctl_named_children
argument_list|(
name|node
argument_list|,
name|mib
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
specifier|const
name|ctl_indexed_node_t
modifier|*
name|inode
decl_stmt|;
comment|/* Indexed element. */
name|inode
operator|=
name|ctl_indexed_node
argument_list|(
name|node
operator|->
name|children
argument_list|)
expr_stmt|;
name|node
operator|=
name|inode
operator|->
name|index
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|mib
argument_list|,
name|miblen
argument_list|,
name|mib
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|node
operator|==
name|NULL
condition|)
block|{
name|ret
operator|=
name|ENOENT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
block|}
comment|/* Call the ctl function. */
if|if
condition|(
name|node
operator|&&
name|node
operator|->
name|ctl
condition|)
name|ret
operator|=
name|node
operator|->
name|ctl
argument_list|(
name|tsd
argument_list|,
name|mib
argument_list|,
name|miblen
argument_list|,
name|oldp
argument_list|,
name|oldlenp
argument_list|,
name|newp
argument_list|,
name|newlen
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* Partial MIB. */
name|ret
operator|=
name|ENOENT
expr_stmt|;
block|}
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|bool
name|ctl_boot
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|malloc_mutex_init
argument_list|(
operator|&
name|ctl_mtx
argument_list|,
literal|"ctl"
argument_list|,
name|WITNESS_RANK_CTL
argument_list|)
condition|)
return|return
operator|(
name|true
operator|)
return|;
name|ctl_initialized
operator|=
name|false
expr_stmt|;
return|return
operator|(
name|false
operator|)
return|;
block|}
end_function

begin_function
name|void
name|ctl_prefork
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|)
block|{
name|malloc_mutex_prefork
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ctl_postfork_parent
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|)
block|{
name|malloc_mutex_postfork_parent
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ctl_postfork_child
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|)
block|{
name|malloc_mutex_postfork_child
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/* *_ctl() functions. */
end_comment

begin_define
define|#
directive|define
name|READONLY
parameter_list|()
value|do {						\ 	if (newp != NULL || newlen != 0) {				\ 		ret = EPERM;						\ 		goto label_return;					\ 	}								\ } while (0)
end_define

begin_define
define|#
directive|define
name|WRITEONLY
parameter_list|()
value|do {						\ 	if (oldp != NULL || oldlenp != NULL) {				\ 		ret = EPERM;						\ 		goto label_return;					\ 	}								\ } while (0)
end_define

begin_define
define|#
directive|define
name|READ_XOR_WRITE
parameter_list|()
value|do {					\ 	if ((oldp != NULL&& oldlenp != NULL)&& (newp != NULL ||	\ 	    newlen != 0)) {						\ 		ret = EPERM;						\ 		goto label_return;					\ 	}								\ } while (0)
end_define

begin_define
define|#
directive|define
name|READ
parameter_list|(
name|v
parameter_list|,
name|t
parameter_list|)
value|do {						\ 	if (oldp != NULL&& oldlenp != NULL) {				\ 		if (*oldlenp != sizeof(t)) {				\ 			size_t	copylen = (sizeof(t)<= *oldlenp)	\ 			    ? sizeof(t) : *oldlenp;			\ 			memcpy(oldp, (void *)&(v), copylen);		\ 			ret = EINVAL;					\ 			goto label_return;				\ 		}							\ 		*(t *)oldp = (v);					\ 	}								\ } while (0)
end_define

begin_define
define|#
directive|define
name|WRITE
parameter_list|(
name|v
parameter_list|,
name|t
parameter_list|)
value|do {						\ 	if (newp != NULL) {						\ 		if (newlen != sizeof(t)) {				\ 			ret = EINVAL;					\ 			goto label_return;				\ 		}							\ 		(v) = *(t *)newp;					\ 	}								\ } while (0)
end_define

begin_comment
comment|/*  * There's a lot of code duplication in the following macros due to limitations  * in how nested cpp macros are expanded.  */
end_comment

begin_define
define|#
directive|define
name|CTL_RO_CLGEN
parameter_list|(
name|c
parameter_list|,
name|l
parameter_list|,
name|n
parameter_list|,
name|v
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(tsd_t *tsd, const size_t *mib, size_t miblen, void *oldp,	\     size_t *oldlenp, void *newp, size_t newlen)				\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	if (!(c))							\ 		return (ENOENT);					\ 	if (l)								\ 		malloc_mutex_lock(tsd_tsdn(tsd),&ctl_mtx);		\ 	READONLY();							\ 	oldval = (v);							\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	if (l)								\ 		malloc_mutex_unlock(tsd_tsdn(tsd),&ctl_mtx);		\ 	return (ret);							\ }
end_define

begin_define
define|#
directive|define
name|CTL_RO_CGEN
parameter_list|(
name|c
parameter_list|,
name|n
parameter_list|,
name|v
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(tsd_t *tsd, const size_t *mib, size_t miblen, void *oldp,	\     size_t *oldlenp, void *newp, size_t newlen)				\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	if (!(c))							\ 		return (ENOENT);					\ 	malloc_mutex_lock(tsd_tsdn(tsd),&ctl_mtx);			\ 	READONLY();							\ 	oldval = (v);							\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	malloc_mutex_unlock(tsd_tsdn(tsd),&ctl_mtx);			\ 	return (ret);							\ }
end_define

begin_define
define|#
directive|define
name|CTL_RO_GEN
parameter_list|(
name|n
parameter_list|,
name|v
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(tsd_t *tsd, const size_t *mib, size_t miblen, void *oldp,	\     size_t *oldlenp, void *newp, size_t newlen)				\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	malloc_mutex_lock(tsd_tsdn(tsd),&ctl_mtx);			\ 	READONLY();							\ 	oldval = (v);							\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	malloc_mutex_unlock(tsd_tsdn(tsd),&ctl_mtx);			\ 	return (ret);							\ }
end_define

begin_comment
comment|/*  * ctl_mtx is not acquired, under the assumption that no pertinent data will  * mutate during the call.  */
end_comment

begin_define
define|#
directive|define
name|CTL_RO_NL_CGEN
parameter_list|(
name|c
parameter_list|,
name|n
parameter_list|,
name|v
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(tsd_t *tsd, const size_t *mib, size_t miblen, void *oldp,	\     size_t *oldlenp, void *newp, size_t newlen)				\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	if (!(c))							\ 		return (ENOENT);					\ 	READONLY();							\ 	oldval = (v);							\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	return (ret);							\ }
end_define

begin_define
define|#
directive|define
name|CTL_RO_NL_GEN
parameter_list|(
name|n
parameter_list|,
name|v
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(tsd_t *tsd, const size_t *mib, size_t miblen, void *oldp,	\     size_t *oldlenp, void *newp, size_t newlen)				\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	READONLY();							\ 	oldval = (v);							\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	return (ret);							\ }
end_define

begin_define
define|#
directive|define
name|CTL_TSD_RO_NL_CGEN
parameter_list|(
name|c
parameter_list|,
name|n
parameter_list|,
name|m
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(tsd_t *tsd, const size_t *mib, size_t miblen, void *oldp,	\     size_t *oldlenp, void *newp, size_t newlen)				\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	if (!(c))							\ 		return (ENOENT);					\ 	READONLY();							\ 	oldval = (m(tsd));						\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	return (ret);							\ }
end_define

begin_define
define|#
directive|define
name|CTL_RO_CONFIG_GEN
parameter_list|(
name|n
parameter_list|,
name|t
parameter_list|)
define|\
value|static int								\ n##_ctl(tsd_t *tsd, const size_t *mib, size_t miblen, void *oldp,	\     size_t *oldlenp, void *newp, size_t newlen)				\ {									\ 	int ret;							\ 	t oldval;							\ 									\ 	READONLY();							\ 	oldval = n;							\ 	READ(oldval, t);						\ 									\ 	ret = 0;							\ label_return:								\ 	return (ret);							\ }
end_define

begin_comment
comment|/******************************************************************************/
end_comment

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|version
argument_list|,
argument|JEMALLOC_VERSION
argument_list|,
argument|const char *
argument_list|)
end_macro

begin_function
specifier|static
name|int
name|epoch_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|UNUSED
name|uint64_t
name|newval
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|WRITE
argument_list|(
name|newval
argument_list|,
name|uint64_t
argument_list|)
expr_stmt|;
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
name|ctl_refresh
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|)
expr_stmt|;
name|READ
argument_list|(
name|ctl_epoch
argument_list|,
name|uint64_t
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_cache_oblivious
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_debug
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_fill
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_lazy_lock
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_malloc_conf
argument_list|,
argument|const char *
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_munmap
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_prof
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_prof_libgcc
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_prof_libunwind
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_stats
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_tcache
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_tls
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_utrace
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_valgrind
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_CONFIG_GEN
argument_list|(
argument|config_xmalloc
argument_list|,
argument|bool
argument_list|)
end_macro

begin_comment
comment|/******************************************************************************/
end_comment

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_abort
argument_list|,
argument|opt_abort
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_dss
argument_list|,
argument|opt_dss
argument_list|,
argument|const char *
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_lg_chunk
argument_list|,
argument|opt_lg_chunk
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_narenas
argument_list|,
argument|opt_narenas
argument_list|,
argument|unsigned
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_purge
argument_list|,
argument|purge_mode_names[opt_purge]
argument_list|,
argument|const char *
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_lg_dirty_mult
argument_list|,
argument|opt_lg_dirty_mult
argument_list|,
argument|ssize_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_decay_time
argument_list|,
argument|opt_decay_time
argument_list|,
argument|ssize_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|opt_stats_print
argument_list|,
argument|opt_stats_print
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_fill
argument_list|,
argument|opt_junk
argument_list|,
argument|opt_junk
argument_list|,
argument|const char *
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_fill
argument_list|,
argument|opt_quarantine
argument_list|,
argument|opt_quarantine
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_fill
argument_list|,
argument|opt_redzone
argument_list|,
argument|opt_redzone
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_fill
argument_list|,
argument|opt_zero
argument_list|,
argument|opt_zero
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_utrace
argument_list|,
argument|opt_utrace
argument_list|,
argument|opt_utrace
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_xmalloc
argument_list|,
argument|opt_xmalloc
argument_list|,
argument|opt_xmalloc
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_tcache
argument_list|,
argument|opt_tcache
argument_list|,
argument|opt_tcache
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_tcache
argument_list|,
argument|opt_lg_tcache_max
argument_list|,
argument|opt_lg_tcache_max
argument_list|,
argument|ssize_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof
argument_list|,
argument|opt_prof
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_prefix
argument_list|,
argument|opt_prof_prefix
argument_list|,
argument|const char *
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_active
argument_list|,
argument|opt_prof_active
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_thread_active_init
argument_list|,
argument|opt_prof_thread_active_init
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_lg_prof_sample
argument_list|,
argument|opt_lg_prof_sample
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_accum
argument_list|,
argument|opt_prof_accum
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_lg_prof_interval
argument_list|,
argument|opt_lg_prof_interval
argument_list|,
argument|ssize_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_gdump
argument_list|,
argument|opt_prof_gdump
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_final
argument_list|,
argument|opt_prof_final
argument_list|,
argument|bool
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|opt_prof_leak
argument_list|,
argument|opt_prof_leak
argument_list|,
argument|bool
argument_list|)
end_macro

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|thread_arena_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|arena_t
modifier|*
name|oldarena
decl_stmt|;
name|unsigned
name|newind
decl_stmt|,
name|oldind
decl_stmt|;
name|oldarena
operator|=
name|arena_choose
argument_list|(
name|tsd
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|oldarena
operator|==
name|NULL
condition|)
return|return
operator|(
name|EAGAIN
operator|)
return|;
name|malloc_mutex_lock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|newind
operator|=
name|oldind
operator|=
name|oldarena
operator|->
name|ind
expr_stmt|;
name|WRITE
argument_list|(
name|newind
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
name|READ
argument_list|(
name|oldind
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
if|if
condition|(
name|newind
operator|!=
name|oldind
condition|)
block|{
name|arena_t
modifier|*
name|newarena
decl_stmt|;
if|if
condition|(
name|newind
operator|>=
name|ctl_stats
operator|.
name|narenas
condition|)
block|{
comment|/* New arena index is out of range. */
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
comment|/* Initialize arena if necessary. */
name|newarena
operator|=
name|arena_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|newind
argument_list|,
name|true
argument_list|)
expr_stmt|;
if|if
condition|(
name|newarena
operator|==
name|NULL
condition|)
block|{
name|ret
operator|=
name|EAGAIN
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
comment|/* Set new arena/tcache associations. */
name|arena_migrate
argument_list|(
name|tsd
argument_list|,
name|oldind
argument_list|,
name|newind
argument_list|)
expr_stmt|;
if|if
condition|(
name|config_tcache
condition|)
block|{
name|tcache_t
modifier|*
name|tcache
init|=
name|tsd_tcache_get
argument_list|(
name|tsd
argument_list|)
decl_stmt|;
if|if
condition|(
name|tcache
operator|!=
name|NULL
condition|)
block|{
name|tcache_arena_reassociate
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|tcache
argument_list|,
name|oldarena
argument_list|,
name|newarena
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_TSD_RO_NL_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|thread_allocated
argument_list|,
argument|tsd_thread_allocated_get
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_TSD_RO_NL_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|thread_allocatedp
argument_list|,
argument|tsd_thread_allocatedp_get
argument_list|,
argument|uint64_t *
argument_list|)
end_macro

begin_macro
name|CTL_TSD_RO_NL_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|thread_deallocated
argument_list|,
argument|tsd_thread_deallocated_get
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_TSD_RO_NL_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|thread_deallocatedp
argument_list|,
argument|tsd_thread_deallocatedp_get
argument_list|,
argument|uint64_t *
argument_list|)
end_macro

begin_function
specifier|static
name|int
name|thread_tcache_enabled_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|bool
name|oldval
decl_stmt|;
if|if
condition|(
operator|!
name|config_tcache
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|oldval
operator|=
name|tcache_enabled_get
argument_list|()
expr_stmt|;
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newlen
operator|!=
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|tcache_enabled_set
argument_list|(
operator|*
operator|(
name|bool
operator|*
operator|)
name|newp
argument_list|)
expr_stmt|;
block|}
name|READ
argument_list|(
name|oldval
argument_list|,
name|bool
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|thread_tcache_flush_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
if|if
condition|(
operator|!
name|config_tcache
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|READONLY
argument_list|()
expr_stmt|;
name|WRITEONLY
argument_list|()
expr_stmt|;
name|tcache_flush
argument_list|()
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|thread_prof_name_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
if|if
condition|(
operator|!
name|config_prof
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|READ_XOR_WRITE
argument_list|()
expr_stmt|;
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newlen
operator|!=
sizeof|sizeof
argument_list|(
specifier|const
name|char
operator|*
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
if|if
condition|(
operator|(
name|ret
operator|=
name|prof_thread_name_set
argument_list|(
name|tsd
argument_list|,
operator|*
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|newp
argument_list|)
operator|)
operator|!=
literal|0
condition|)
goto|goto
name|label_return
goto|;
block|}
else|else
block|{
specifier|const
name|char
modifier|*
name|oldname
init|=
name|prof_thread_name_get
argument_list|(
name|tsd
argument_list|)
decl_stmt|;
name|READ
argument_list|(
name|oldname
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|thread_prof_active_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|bool
name|oldval
decl_stmt|;
if|if
condition|(
operator|!
name|config_prof
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|oldval
operator|=
name|prof_thread_active_get
argument_list|(
name|tsd
argument_list|)
expr_stmt|;
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newlen
operator|!=
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
if|if
condition|(
name|prof_thread_active_set
argument_list|(
name|tsd
argument_list|,
operator|*
operator|(
name|bool
operator|*
operator|)
name|newp
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EAGAIN
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
name|READ
argument_list|(
name|oldval
argument_list|,
name|bool
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|tcache_create_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|tcache_ind
decl_stmt|;
if|if
condition|(
operator|!
name|config_tcache
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|malloc_mutex_lock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|READONLY
argument_list|()
expr_stmt|;
if|if
condition|(
name|tcaches_create
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|tcache_ind
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|READ
argument_list|(
name|tcache_ind
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|tcache_flush_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|tcache_ind
decl_stmt|;
if|if
condition|(
operator|!
name|config_tcache
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|WRITEONLY
argument_list|()
expr_stmt|;
name|tcache_ind
operator|=
name|UINT_MAX
expr_stmt|;
name|WRITE
argument_list|(
name|tcache_ind
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
if|if
condition|(
name|tcache_ind
operator|==
name|UINT_MAX
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|tcaches_flush
argument_list|(
name|tsd
argument_list|,
name|tcache_ind
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|tcache_destroy_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|tcache_ind
decl_stmt|;
if|if
condition|(
operator|!
name|config_tcache
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|WRITEONLY
argument_list|()
expr_stmt|;
name|tcache_ind
operator|=
name|UINT_MAX
expr_stmt|;
name|WRITE
argument_list|(
name|tcache_ind
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
if|if
condition|(
name|tcache_ind
operator|==
name|UINT_MAX
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|tcaches_destroy
argument_list|(
name|tsd
argument_list|,
name|tcache_ind
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|arena_i_purge
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
name|unsigned
name|arena_ind
parameter_list|,
name|bool
name|all
parameter_list|)
block|{
name|malloc_mutex_lock
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
block|{
name|unsigned
name|narenas
init|=
name|ctl_stats
operator|.
name|narenas
decl_stmt|;
if|if
condition|(
name|arena_ind
operator|==
name|narenas
condition|)
block|{
name|unsigned
name|i
decl_stmt|;
name|VARIABLE_ARRAY
argument_list|(
name|arena_t
operator|*
argument_list|,
name|tarenas
argument_list|,
name|narenas
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|narenas
condition|;
name|i
operator|++
control|)
name|tarenas
index|[
name|i
index|]
operator|=
name|arena_get
argument_list|(
name|tsdn
argument_list|,
name|i
argument_list|,
name|false
argument_list|)
expr_stmt|;
comment|/* 			 * No further need to hold ctl_mtx, since narenas and 			 * tarenas contain everything needed below. 			 */
name|malloc_mutex_unlock
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|narenas
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|tarenas
index|[
name|i
index|]
operator|!=
name|NULL
condition|)
name|arena_purge
argument_list|(
name|tsdn
argument_list|,
name|tarenas
index|[
name|i
index|]
argument_list|,
name|all
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|arena_t
modifier|*
name|tarena
decl_stmt|;
name|assert
argument_list|(
name|arena_ind
operator|<
name|narenas
argument_list|)
expr_stmt|;
name|tarena
operator|=
name|arena_get
argument_list|(
name|tsdn
argument_list|,
name|arena_ind
argument_list|,
name|false
argument_list|)
expr_stmt|;
comment|/* No further need to hold ctl_mtx. */
name|malloc_mutex_unlock
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
if|if
condition|(
name|tarena
operator|!=
name|NULL
condition|)
name|arena_purge
argument_list|(
name|tsdn
argument_list|,
name|tarena
argument_list|,
name|all
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|arena_i_purge_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|READONLY
argument_list|()
expr_stmt|;
name|WRITEONLY
argument_list|()
expr_stmt|;
name|arena_i_purge
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|(
name|unsigned
operator|)
name|mib
index|[
literal|1
index|]
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arena_i_decay_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|READONLY
argument_list|()
expr_stmt|;
name|WRITEONLY
argument_list|()
expr_stmt|;
name|arena_i_purge
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|(
name|unsigned
operator|)
name|mib
index|[
literal|1
index|]
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arena_i_reset_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|arena_ind
decl_stmt|;
name|arena_t
modifier|*
name|arena
decl_stmt|;
name|READONLY
argument_list|()
expr_stmt|;
name|WRITEONLY
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|config_valgrind
operator|&&
name|unlikely
argument_list|(
name|in_valgrind
argument_list|)
operator|)
operator|||
operator|(
name|config_fill
operator|&&
name|unlikely
argument_list|(
name|opt_quarantine
argument_list|)
operator|)
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|arena_ind
operator|=
operator|(
name|unsigned
operator|)
name|mib
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|config_debug
condition|)
block|{
name|malloc_mutex_lock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|arena_ind
operator|<
name|ctl_stats
operator|.
name|narenas
argument_list|)
expr_stmt|;
name|malloc_mutex_unlock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
block|}
name|assert
argument_list|(
name|arena_ind
operator|>=
name|opt_narenas
argument_list|)
expr_stmt|;
name|arena
operator|=
name|arena_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena_ind
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|arena_reset
argument_list|(
name|tsd
argument_list|,
name|arena
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arena_i_dss_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
specifier|const
name|char
modifier|*
name|dss
init|=
name|NULL
decl_stmt|;
name|unsigned
name|arena_ind
init|=
operator|(
name|unsigned
operator|)
name|mib
index|[
literal|1
index|]
decl_stmt|;
name|dss_prec_t
name|dss_prec_old
init|=
name|dss_prec_limit
decl_stmt|;
name|dss_prec_t
name|dss_prec
init|=
name|dss_prec_limit
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|WRITE
argument_list|(
name|dss
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
expr_stmt|;
if|if
condition|(
name|dss
operator|!=
name|NULL
condition|)
block|{
name|int
name|i
decl_stmt|;
name|bool
name|match
init|=
name|false
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|dss_prec_limit
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|dss_prec_names
index|[
name|i
index|]
argument_list|,
name|dss
argument_list|)
operator|==
literal|0
condition|)
block|{
name|dss_prec
operator|=
name|i
expr_stmt|;
name|match
operator|=
name|true
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|match
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
if|if
condition|(
name|arena_ind
operator|<
name|ctl_stats
operator|.
name|narenas
condition|)
block|{
name|arena_t
modifier|*
name|arena
init|=
name|arena_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena_ind
argument_list|,
name|false
argument_list|)
decl_stmt|;
if|if
condition|(
name|arena
operator|==
name|NULL
operator|||
operator|(
name|dss_prec
operator|!=
name|dss_prec_limit
operator|&&
name|arena_dss_prec_set
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena
argument_list|,
name|dss_prec
argument_list|)
operator|)
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|dss_prec_old
operator|=
name|arena_dss_prec_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|dss_prec
operator|!=
name|dss_prec_limit
operator|&&
name|chunk_dss_prec_set
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|dss_prec
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|dss_prec_old
operator|=
name|chunk_dss_prec_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|dss
operator|=
name|dss_prec_names
index|[
name|dss_prec_old
index|]
expr_stmt|;
name|READ
argument_list|(
name|dss
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arena_i_lg_dirty_mult_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|arena_ind
init|=
operator|(
name|unsigned
operator|)
name|mib
index|[
literal|1
index|]
decl_stmt|;
name|arena_t
modifier|*
name|arena
decl_stmt|;
name|arena
operator|=
name|arena_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena_ind
argument_list|,
name|false
argument_list|)
expr_stmt|;
if|if
condition|(
name|arena
operator|==
name|NULL
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
if|if
condition|(
name|oldp
operator|!=
name|NULL
operator|&&
name|oldlenp
operator|!=
name|NULL
condition|)
block|{
name|size_t
name|oldval
init|=
name|arena_lg_dirty_mult_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena
argument_list|)
decl_stmt|;
name|READ
argument_list|(
name|oldval
argument_list|,
name|ssize_t
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newlen
operator|!=
sizeof|sizeof
argument_list|(
name|ssize_t
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
if|if
condition|(
name|arena_lg_dirty_mult_set
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena
argument_list|,
operator|*
operator|(
name|ssize_t
operator|*
operator|)
name|newp
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arena_i_decay_time_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|arena_ind
init|=
operator|(
name|unsigned
operator|)
name|mib
index|[
literal|1
index|]
decl_stmt|;
name|arena_t
modifier|*
name|arena
decl_stmt|;
name|arena
operator|=
name|arena_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena_ind
argument_list|,
name|false
argument_list|)
expr_stmt|;
if|if
condition|(
name|arena
operator|==
name|NULL
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
if|if
condition|(
name|oldp
operator|!=
name|NULL
operator|&&
name|oldlenp
operator|!=
name|NULL
condition|)
block|{
name|size_t
name|oldval
init|=
name|arena_decay_time_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena
argument_list|)
decl_stmt|;
name|READ
argument_list|(
name|oldval
argument_list|,
name|ssize_t
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newlen
operator|!=
sizeof|sizeof
argument_list|(
name|ssize_t
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
if|if
condition|(
name|arena_decay_time_set
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena
argument_list|,
operator|*
operator|(
name|ssize_t
operator|*
operator|)
name|newp
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arena_i_chunk_hooks_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|arena_ind
init|=
operator|(
name|unsigned
operator|)
name|mib
index|[
literal|1
index|]
decl_stmt|;
name|arena_t
modifier|*
name|arena
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
if|if
condition|(
name|arena_ind
operator|<
name|narenas_total_get
argument_list|()
operator|&&
operator|(
name|arena
operator|=
name|arena_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena_ind
argument_list|,
name|false
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
name|chunk_hooks_t
name|old_chunk_hooks
decl_stmt|,
name|new_chunk_hooks
decl_stmt|;
name|WRITE
argument_list|(
name|new_chunk_hooks
argument_list|,
name|chunk_hooks_t
argument_list|)
expr_stmt|;
name|old_chunk_hooks
operator|=
name|chunk_hooks_set
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena
argument_list|,
operator|&
name|new_chunk_hooks
argument_list|)
expr_stmt|;
name|READ
argument_list|(
name|old_chunk_hooks
argument_list|,
name|chunk_hooks_t
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|chunk_hooks_t
name|old_chunk_hooks
init|=
name|chunk_hooks_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|arena
argument_list|)
decl_stmt|;
name|READ
argument_list|(
name|old_chunk_hooks
argument_list|,
name|chunk_hooks_t
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|arena_i_index
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|i
parameter_list|)
block|{
specifier|const
name|ctl_named_node_t
modifier|*
name|ret
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|ctl_stats
operator|.
name|narenas
condition|)
block|{
name|ret
operator|=
name|NULL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|ret
operator|=
name|super_arena_i_node
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|arenas_narenas_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|narenas
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|READONLY
argument_list|()
expr_stmt|;
if|if
condition|(
operator|*
name|oldlenp
operator|!=
sizeof|sizeof
argument_list|(
name|unsigned
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|narenas
operator|=
name|ctl_stats
operator|.
name|narenas
expr_stmt|;
name|READ
argument_list|(
name|narenas
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arenas_initialized_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|nread
decl_stmt|,
name|i
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|READONLY
argument_list|()
expr_stmt|;
if|if
condition|(
operator|*
name|oldlenp
operator|!=
name|ctl_stats
operator|.
name|narenas
operator|*
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
name|nread
operator|=
operator|(
operator|*
name|oldlenp
operator|<
name|ctl_stats
operator|.
name|narenas
operator|*
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
operator|)
condition|?
call|(
name|unsigned
call|)
argument_list|(
operator|*
name|oldlenp
operator|/
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
argument_list|)
else|:
name|ctl_stats
operator|.
name|narenas
expr_stmt|;
block|}
else|else
block|{
name|ret
operator|=
literal|0
expr_stmt|;
name|nread
operator|=
name|ctl_stats
operator|.
name|narenas
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nread
condition|;
name|i
operator|++
control|)
operator|(
operator|(
name|bool
operator|*
operator|)
name|oldp
operator|)
index|[
name|i
index|]
operator|=
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
operator|.
name|initialized
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arenas_lg_dirty_mult_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|oldp
operator|!=
name|NULL
operator|&&
name|oldlenp
operator|!=
name|NULL
condition|)
block|{
name|size_t
name|oldval
init|=
name|arena_lg_dirty_mult_default_get
argument_list|()
decl_stmt|;
name|READ
argument_list|(
name|oldval
argument_list|,
name|ssize_t
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newlen
operator|!=
sizeof|sizeof
argument_list|(
name|ssize_t
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
if|if
condition|(
name|arena_lg_dirty_mult_default_set
argument_list|(
operator|*
operator|(
name|ssize_t
operator|*
operator|)
name|newp
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arenas_decay_time_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|oldp
operator|!=
name|NULL
operator|&&
name|oldlenp
operator|!=
name|NULL
condition|)
block|{
name|size_t
name|oldval
init|=
name|arena_decay_time_default_get
argument_list|()
decl_stmt|;
name|READ
argument_list|(
name|oldval
argument_list|,
name|ssize_t
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newlen
operator|!=
sizeof|sizeof
argument_list|(
name|ssize_t
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
if|if
condition|(
name|arena_decay_time_default_set
argument_list|(
operator|*
operator|(
name|ssize_t
operator|*
operator|)
name|newp
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_quantum
argument_list|,
argument|QUANTUM
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_page
argument_list|,
argument|PAGE
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_tcache
argument_list|,
argument|arenas_tcache_max
argument_list|,
argument|tcache_maxclass
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_nbins
argument_list|,
argument|NBINS
argument_list|,
argument|unsigned
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_tcache
argument_list|,
argument|arenas_nhbins
argument_list|,
argument|nhbins
argument_list|,
argument|unsigned
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_bin_i_size
argument_list|,
argument|arena_bin_info[mib[
literal|2
argument|]].reg_size
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_bin_i_nregs
argument_list|,
argument|arena_bin_info[mib[
literal|2
argument|]].nregs
argument_list|,
argument|uint32_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_bin_i_run_size
argument_list|,
argument|arena_bin_info[mib[
literal|2
argument|]].run_size
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|arenas_bin_i_index
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|i
parameter_list|)
block|{
if|if
condition|(
name|i
operator|>
name|NBINS
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|super_arenas_bin_i_node
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_nlruns
argument_list|,
argument|nlclasses
argument_list|,
argument|unsigned
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_lrun_i_size
argument_list|,
argument|index2size(NBINS+(szind_t)mib[
literal|2
argument|])
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|arenas_lrun_i_index
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|i
parameter_list|)
block|{
if|if
condition|(
name|i
operator|>
name|nlclasses
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|super_arenas_lrun_i_node
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_nhchunks
argument_list|,
argument|nhclasses
argument_list|,
argument|unsigned
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_GEN
argument_list|(
argument|arenas_hchunk_i_size
argument_list|,
argument|index2size(NBINS+nlclasses+(szind_t)mib[
literal|2
argument|])
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|arenas_hchunk_i_index
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|i
parameter_list|)
block|{
if|if
condition|(
name|i
operator|>
name|nhclasses
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|super_arenas_hchunk_i_node
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arenas_extend_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|unsigned
name|narenas
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
name|READONLY
argument_list|()
expr_stmt|;
if|if
condition|(
name|ctl_grow
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EAGAIN
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|narenas
operator|=
name|ctl_stats
operator|.
name|narenas
operator|-
literal|1
expr_stmt|;
name|READ
argument_list|(
name|narenas
argument_list|,
name|unsigned
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|prof_thread_active_init_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|bool
name|oldval
decl_stmt|;
if|if
condition|(
operator|!
name|config_prof
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newlen
operator|!=
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|oldval
operator|=
name|prof_thread_active_init_set
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|*
operator|(
name|bool
operator|*
operator|)
name|newp
argument_list|)
expr_stmt|;
block|}
else|else
name|oldval
operator|=
name|prof_thread_active_init_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|)
expr_stmt|;
name|READ
argument_list|(
name|oldval
argument_list|,
name|bool
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prof_active_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|bool
name|oldval
decl_stmt|;
if|if
condition|(
operator|!
name|config_prof
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newlen
operator|!=
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|oldval
operator|=
name|prof_active_set
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|*
operator|(
name|bool
operator|*
operator|)
name|newp
argument_list|)
expr_stmt|;
block|}
else|else
name|oldval
operator|=
name|prof_active_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|)
expr_stmt|;
name|READ
argument_list|(
name|oldval
argument_list|,
name|bool
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prof_dump_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
specifier|const
name|char
modifier|*
name|filename
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|config_prof
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|WRITEONLY
argument_list|()
expr_stmt|;
name|WRITE
argument_list|(
name|filename
argument_list|,
specifier|const
name|char
operator|*
argument_list|)
expr_stmt|;
if|if
condition|(
name|prof_mdump
argument_list|(
name|tsd
argument_list|,
name|filename
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EFAULT
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prof_gdump_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|bool
name|oldval
decl_stmt|;
if|if
condition|(
operator|!
name|config_prof
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
if|if
condition|(
name|newp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|newlen
operator|!=
sizeof|sizeof
argument_list|(
name|bool
argument_list|)
condition|)
block|{
name|ret
operator|=
name|EINVAL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|oldval
operator|=
name|prof_gdump_set
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
operator|*
operator|(
name|bool
operator|*
operator|)
name|newp
argument_list|)
expr_stmt|;
block|}
else|else
name|oldval
operator|=
name|prof_gdump_get
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|)
expr_stmt|;
name|READ
argument_list|(
name|oldval
argument_list|,
name|bool
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prof_reset_ctl
parameter_list|(
name|tsd_t
modifier|*
name|tsd
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|void
modifier|*
name|oldp
parameter_list|,
name|size_t
modifier|*
name|oldlenp
parameter_list|,
name|void
modifier|*
name|newp
parameter_list|,
name|size_t
name|newlen
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|size_t
name|lg_sample
init|=
name|lg_prof_sample
decl_stmt|;
if|if
condition|(
operator|!
name|config_prof
condition|)
return|return
operator|(
name|ENOENT
operator|)
return|;
name|WRITEONLY
argument_list|()
expr_stmt|;
name|WRITE
argument_list|(
name|lg_sample
argument_list|,
name|size_t
argument_list|)
expr_stmt|;
if|if
condition|(
name|lg_sample
operator|>=
operator|(
sizeof|sizeof
argument_list|(
name|uint64_t
argument_list|)
operator|<<
literal|3
operator|)
condition|)
name|lg_sample
operator|=
operator|(
sizeof|sizeof
argument_list|(
name|uint64_t
argument_list|)
operator|<<
literal|3
operator|)
operator|-
literal|1
expr_stmt|;
name|prof_reset
argument_list|(
name|tsd_tsdn
argument_list|(
name|tsd
argument_list|)
argument_list|,
name|lg_sample
argument_list|)
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|label_return
label|:
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|prof_interval
argument_list|,
argument|prof_interval
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_NL_CGEN
argument_list|(
argument|config_prof
argument_list|,
argument|lg_prof_sample
argument_list|,
argument|lg_prof_sample
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_comment
comment|/******************************************************************************/
end_comment

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_cactive
argument_list|,
argument|&stats_cactive
argument_list|,
argument|size_t *
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_allocated
argument_list|,
argument|ctl_stats.allocated
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_active
argument_list|,
argument|ctl_stats.active
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_metadata
argument_list|,
argument|ctl_stats.metadata
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_resident
argument_list|,
argument|ctl_stats.resident
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_mapped
argument_list|,
argument|ctl_stats.mapped
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_retained
argument_list|,
argument|ctl_stats.retained
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_GEN
argument_list|(
argument|stats_arenas_i_dss
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].dss
argument_list|,
argument|const char *
argument_list|)
end_macro

begin_macro
name|CTL_RO_GEN
argument_list|(
argument|stats_arenas_i_lg_dirty_mult
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].lg_dirty_mult
argument_list|,
argument|ssize_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_GEN
argument_list|(
argument|stats_arenas_i_decay_time
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].decay_time
argument_list|,
argument|ssize_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_GEN
argument_list|(
argument|stats_arenas_i_nthreads
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].nthreads
argument_list|,
argument|unsigned
argument_list|)
end_macro

begin_macro
name|CTL_RO_GEN
argument_list|(
argument|stats_arenas_i_pactive
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].pactive
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_GEN
argument_list|(
argument|stats_arenas_i_pdirty
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].pdirty
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_mapped
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.mapped
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_retained
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.retained
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_npurge
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.npurge
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_nmadvise
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.nmadvise
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_purged
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.purged
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_metadata_mapped
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.metadata_mapped
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_metadata_allocated
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.metadata_allocated
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_small_allocated
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].allocated_small
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_small_nmalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].nmalloc_small
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_small_ndalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].ndalloc_small
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_small_nrequests
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].nrequests_small
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_large_allocated
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.allocated_large
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_large_nmalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.nmalloc_large
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_large_ndalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.ndalloc_large
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_large_nrequests
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.nrequests_large
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_huge_allocated
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.allocated_huge
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_huge_nmalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.nmalloc_huge
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_huge_ndalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.ndalloc_huge
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_huge_nrequests
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].astats.nmalloc_huge
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_comment
comment|/* Intentional. */
end_comment

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_nmalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].nmalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_ndalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].ndalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_nrequests
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].nrequests
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_curregs
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].curregs
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats&& config_tcache
argument_list|,
argument|stats_arenas_i_bins_j_nfills
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].nfills
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats&& config_tcache
argument_list|,
argument|stats_arenas_i_bins_j_nflushes
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].nflushes
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_nruns
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].nruns
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_nreruns
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].reruns
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_bins_j_curruns
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].bstats[mib[
literal|4
argument|]].curruns
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|stats_arenas_i_bins_j_index
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|j
parameter_list|)
block|{
if|if
condition|(
name|j
operator|>
name|NBINS
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|super_stats_arenas_i_bins_j_node
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_lruns_j_nmalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].lstats[mib[
literal|4
argument|]].nmalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_lruns_j_ndalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].lstats[mib[
literal|4
argument|]].ndalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_lruns_j_nrequests
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].lstats[mib[
literal|4
argument|]].nrequests
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_lruns_j_curruns
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].lstats[mib[
literal|4
argument|]].curruns
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|stats_arenas_i_lruns_j_index
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|j
parameter_list|)
block|{
if|if
condition|(
name|j
operator|>
name|nlclasses
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|super_stats_arenas_i_lruns_j_node
operator|)
return|;
block|}
end_function

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_hchunks_j_nmalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].hstats[mib[
literal|4
argument|]].nmalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_hchunks_j_ndalloc
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].hstats[mib[
literal|4
argument|]].ndalloc
argument_list|,
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_hchunks_j_nrequests
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].hstats[mib[
literal|4
argument|]].nmalloc
argument_list|,
comment|/* Intentional. */
argument|uint64_t
argument_list|)
end_macro

begin_macro
name|CTL_RO_CGEN
argument_list|(
argument|config_stats
argument_list|,
argument|stats_arenas_i_hchunks_j_curhchunks
argument_list|,
argument|ctl_stats.arenas[mib[
literal|2
argument|]].hstats[mib[
literal|4
argument|]].curhchunks
argument_list|,
argument|size_t
argument_list|)
end_macro

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|stats_arenas_i_hchunks_j_index
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|j
parameter_list|)
block|{
if|if
condition|(
name|j
operator|>
name|nhclasses
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|super_stats_arenas_i_hchunks_j_node
operator|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|ctl_named_node_t
modifier|*
name|stats_arenas_i_index
parameter_list|(
name|tsdn_t
modifier|*
name|tsdn
parameter_list|,
specifier|const
name|size_t
modifier|*
name|mib
parameter_list|,
name|size_t
name|miblen
parameter_list|,
name|size_t
name|i
parameter_list|)
block|{
specifier|const
name|ctl_named_node_t
modifier|*
name|ret
decl_stmt|;
name|malloc_mutex_lock
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|ctl_stats
operator|.
name|narenas
operator|||
operator|!
name|ctl_stats
operator|.
name|arenas
index|[
name|i
index|]
operator|.
name|initialized
condition|)
block|{
name|ret
operator|=
name|NULL
expr_stmt|;
goto|goto
name|label_return
goto|;
block|}
name|ret
operator|=
name|super_stats_arenas_i_node
expr_stmt|;
name|label_return
label|:
name|malloc_mutex_unlock
argument_list|(
name|tsdn
argument_list|,
operator|&
name|ctl_mtx
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

end_unit

