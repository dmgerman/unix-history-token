begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1992, 1993, 1994, 1995, 1996, 1997  *	The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code distributions  * retain the above copyright notice and this paragraph in its entirety, (2)  * distributions including binary code include the above copyright notice and  * this paragraph in its entirety in the documentation or other materials  * provided with the distribution, and (3) all advertising materials mentioning  * features or use of this software display the following acknowledgement:  * ``This product includes software developed by the University of California,  * Lawrence Berkeley Laboratory and its contributors.'' Neither the name of  * the University nor the names of its contributors may be used to endorse  * or promote products derived from this software without specific prior  * written permission.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED  * WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  *  * Code by Gert Doering, SpaceNet GmbH, gert@space.net  *  * Reference documentation:  *    http://www.cisco.com/univercd/cc/td/doc/product/lan/trsrb/frames.htm  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
name|_U_
init|=
literal|"@(#) $Header: /tcpdump/master/tcpdump/print-cdp.c,v 1.25 2004-10-07 14:53:11 hannes Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<tcpdump-stdinc.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_comment
comment|/* must come after interface.h */
end_comment

begin_include
include|#
directive|include
file|"nlpid.h"
end_include

begin_define
define|#
directive|define
name|CDP_HEADER_LEN
value|4
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|cdp_tlv_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Device-ID"
block|}
block|,
block|{
literal|0x02
block|,
literal|"Address"
block|}
block|,
block|{
literal|0x03
block|,
literal|"Port-ID"
block|}
block|,
block|{
literal|0x04
block|,
literal|"Capability"
block|}
block|,
block|{
literal|0x05
block|,
literal|"Version String"
block|}
block|,
block|{
literal|0x06
block|,
literal|"Platform"
block|}
block|,
block|{
literal|0x07
block|,
literal|"Prefixes"
block|}
block|,
block|{
literal|0x08
block|,
literal|"Protocol-Hello option"
block|}
block|,
block|{
literal|0x09
block|,
literal|"VTP Management Domain"
block|}
block|,
block|{
literal|0x0a
block|,
literal|"Native VLAN ID"
block|}
block|,
block|{
literal|0x0b
block|,
literal|"Duplex"
block|}
block|,
block|{
literal|0x0e
block|,
literal|"ATA-186 VoIP VLAN request"
block|}
block|,
block|{
literal|0x0f
block|,
literal|"ATA-186 VoIP VLAN assignment"
block|}
block|,
block|{
literal|0x10
block|,
literal|"power consumption"
block|}
block|,
block|{
literal|0x11
block|,
literal|"MTU"
block|}
block|,
block|{
literal|0x12
block|,
literal|"AVVID trust bitmap"
block|}
block|,
block|{
literal|0x13
block|,
literal|"AVVID untrusted ports CoS"
block|}
block|,
block|{
literal|0x14
block|,
literal|"System Name"
block|}
block|,
block|{
literal|0x15
block|,
literal|"System Object ID (not decoded)"
block|}
block|,
block|{
literal|0x16
block|,
literal|"Management Addresses"
block|}
block|,
block|{
literal|0x17
block|,
literal|"Physical Location"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|tok
name|cdp_capability_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Router"
block|}
block|,
block|{
literal|0x02
block|,
literal|"Transparent Bridge"
block|}
block|,
block|{
literal|0x04
block|,
literal|"Source Route Bridge"
block|}
block|,
block|{
literal|0x08
block|,
literal|"L2 Switch"
block|}
block|,
block|{
literal|0x10
block|,
literal|"L3 capable"
block|}
block|,
block|{
literal|0x20
block|,
literal|"IGMP snooping"
block|}
block|,
block|{
literal|0x40
block|,
literal|"L1 capable"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|int
name|cdp_print_addr
parameter_list|(
specifier|const
name|u_char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|cdp_print_prefixes
parameter_list|(
specifier|const
name|u_char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|unsigned
name|long
name|cdp_get_number
parameter_list|(
specifier|const
name|u_char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|cdp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|pptr
parameter_list|,
name|u_int
name|length
parameter_list|,
name|u_int
name|caplen
parameter_list|)
block|{
name|int
name|type
decl_stmt|,
name|len
decl_stmt|,
name|i
decl_stmt|,
name|j
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|tptr
decl_stmt|;
if|if
condition|(
name|caplen
operator|<
name|CDP_HEADER_LEN
condition|)
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"[|cdp]"
argument_list|)
expr_stmt|;
return|return;
block|}
name|tptr
operator|=
name|pptr
expr_stmt|;
comment|/* temporary pointer */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|CDP_HEADER_LEN
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
name|printf
argument_list|(
literal|"CDPv%u, ttl: %us"
argument_list|,
operator|*
name|tptr
argument_list|,
operator|*
operator|(
name|tptr
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|vflag
condition|)
name|printf
argument_list|(
literal|", checksum: %u (unverified), length %u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
argument_list|,
name|length
argument_list|)
expr_stmt|;
name|tptr
operator|+=
name|CDP_HEADER_LEN
expr_stmt|;
while|while
condition|(
name|tptr
operator|<
operator|(
name|pptr
operator|+
name|length
operator|)
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
comment|/* read out Type and Length */
goto|goto
name|trunc
goto|;
name|type
operator|=
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
expr_stmt|;
name|len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|tptr
operator|+
literal|2
argument_list|)
expr_stmt|;
comment|/* object length includes the 4 bytes header length */
name|tptr
operator|+=
literal|4
expr_stmt|;
name|len
operator|-=
literal|4
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|len
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
if|if
condition|(
name|vflag
operator|||
name|type
operator|==
literal|1
condition|)
block|{
comment|/* in non-verbose mode just print Device-ID */
if|if
condition|(
name|vflag
condition|)
name|printf
argument_list|(
literal|"\n\t%s (0x%02x), length: %u byte%s: "
argument_list|,
name|tok2str
argument_list|(
name|cdp_tlv_values
argument_list|,
literal|"unknown field type"
argument_list|,
name|type
argument_list|)
argument_list|,
name|type
argument_list|,
name|len
argument_list|,
name|len
operator|>
literal|1
condition|?
literal|"s"
else|:
literal|""
argument_list|)
expr_stmt|;
comment|/* plural */
switch|switch
condition|(
name|type
condition|)
block|{
case|case
literal|0x01
case|:
comment|/* Device-ID */
if|if
condition|(
operator|!
name|vflag
condition|)
name|printf
argument_list|(
literal|", Device-ID "
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
name|fn_printn
argument_list|(
name|tptr
argument_list|,
name|len
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x02
case|:
comment|/* Address */
if|if
condition|(
name|cdp_print_addr
argument_list|(
name|tptr
argument_list|,
name|len
argument_list|)
operator|<
literal|0
condition|)
goto|goto
name|trunc
goto|;
break|break;
case|case
literal|0x03
case|:
comment|/* Port-ID */
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
name|fn_printn
argument_list|(
name|tptr
argument_list|,
name|len
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x04
case|:
comment|/* Capabilities */
name|printf
argument_list|(
literal|"(0x%08x): %s"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
argument_list|,
name|bittok2str
argument_list|(
name|cdp_capability_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x05
case|:
comment|/* Version */
name|printf
argument_list|(
literal|"\n\t  "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
name|j
operator|=
operator|*
operator|(
name|tptr
operator|+
name|i
operator|)
expr_stmt|;
name|putchar
argument_list|(
name|j
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|==
literal|0x0a
condition|)
comment|/* lets rework the version string to get a nice identation */
name|printf
argument_list|(
literal|"\t  "
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|0x06
case|:
comment|/* Platform */
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
name|fn_printn
argument_list|(
name|tptr
argument_list|,
name|len
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x07
case|:
comment|/* Prefixes */
if|if
condition|(
name|cdp_print_prefixes
argument_list|(
name|tptr
argument_list|,
name|len
argument_list|)
operator|<
literal|0
condition|)
goto|goto
name|trunc
goto|;
break|break;
case|case
literal|0x08
case|:
comment|/* Protocol Hello Option - not documented */
break|break;
case|case
literal|0x09
case|:
comment|/* VTP Mgmt Domain  - not documented */
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
name|fn_printn
argument_list|(
name|tptr
argument_list|,
name|len
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x0a
case|:
comment|/* Native VLAN ID - not documented */
name|printf
argument_list|(
literal|"%d"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x0b
case|:
comment|/* Duplex - not documented */
name|printf
argument_list|(
literal|"%s"
argument_list|,
operator|*
operator|(
name|tptr
operator|)
condition|?
literal|"full"
else|:
literal|"half"
argument_list|)
expr_stmt|;
break|break;
comment|/* http://www.cisco.com/univercd/cc/td/doc/product/voice/ata/atarn/186rn21m.htm                      * plus more details from other sources                      */
case|case
literal|0x0e
case|:
comment|/* ATA-186 VoIP VLAN request - incomplete doc. */
name|printf
argument_list|(
literal|"app %d, vlan %d"
argument_list|,
operator|*
operator|(
name|tptr
operator|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tptr
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x10
case|:
comment|/* ATA-186 VoIP VLAN assignment - incomplete doc. */
name|printf
argument_list|(
literal|"%1.2fW"
argument_list|,
name|cdp_get_number
argument_list|(
name|tptr
argument_list|,
name|len
argument_list|)
operator|/
literal|1000.0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x11
case|:
comment|/* MTU - not documented */
name|printf
argument_list|(
literal|"%u bytes"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x12
case|:
comment|/* AVVID trust bitmap - not documented */
name|printf
argument_list|(
literal|"0x%02x"
argument_list|,
operator|*
operator|(
name|tptr
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x13
case|:
comment|/* AVVID untrusted port CoS - not documented */
name|printf
argument_list|(
literal|"0x%02x"
argument_list|,
operator|*
operator|(
name|tptr
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x14
case|:
comment|/* System Name - not documented */
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
name|fn_printn
argument_list|(
name|tptr
argument_list|,
name|len
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x16
case|:
comment|/* System Object ID - not documented */
if|if
condition|(
name|cdp_print_addr
argument_list|(
name|tptr
argument_list|,
name|len
argument_list|)
operator|<
literal|0
condition|)
goto|goto
name|trunc
goto|;
break|break;
case|case
literal|0x17
case|:
comment|/* Physical Location - not documented */
name|printf
argument_list|(
literal|"0x%02x"
argument_list|,
operator|*
operator|(
name|tptr
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"/"
argument_list|)
expr_stmt|;
name|fn_printn
argument_list|(
name|tptr
operator|+
literal|1
argument_list|,
name|len
operator|-
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|print_unknown_data
argument_list|(
name|tptr
argument_list|,
literal|"\n\t  "
argument_list|,
name|len
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
comment|/* avoid infinite loop */
if|if
condition|(
name|len
operator|==
literal|0
condition|)
break|break;
name|tptr
operator|=
name|tptr
operator|+
name|len
expr_stmt|;
block|}
if|if
condition|(
name|vflag
operator|<
literal|1
condition|)
name|printf
argument_list|(
literal|", length %u"
argument_list|,
name|caplen
argument_list|)
expr_stmt|;
return|return;
name|trunc
label|:
name|printf
argument_list|(
literal|"[|cdp]"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Protocol type values.  *  * PT_NLPID means that the protocol type field contains an OSI NLPID.  *  * PT_IEEE_802_2 means that the protocol type field contains an IEEE 802.2  * LLC header that specifies that the payload is for that protocol.  */
end_comment

begin_define
define|#
directive|define
name|PT_NLPID
value|1
end_define

begin_comment
comment|/* OSI NLPID */
end_comment

begin_define
define|#
directive|define
name|PT_IEEE_802_2
value|2
end_define

begin_comment
comment|/* IEEE 802.2 LLC header */
end_comment

begin_function
specifier|static
name|int
name|cdp_print_addr
parameter_list|(
specifier|const
name|u_char
modifier|*
name|p
parameter_list|,
name|int
name|l
parameter_list|)
block|{
name|int
name|pt
decl_stmt|,
name|pl
decl_stmt|,
name|al
decl_stmt|,
name|num
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|endp
init|=
name|p
operator|+
name|l
decl_stmt|;
ifdef|#
directive|ifdef
name|INET6
specifier|static
name|u_char
name|prot_ipv6
index|[]
init|=
block|{
literal|0xaa
block|,
literal|0xaa
block|,
literal|0x03
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
literal|0x86
block|,
literal|0xdd
block|}
decl_stmt|;
endif|#
directive|endif
name|TCHECK2
argument_list|(
operator|*
name|p
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|num
operator|=
name|EXTRACT_32BITS
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|4
expr_stmt|;
while|while
condition|(
name|p
operator|<
name|endp
operator|&&
name|num
operator|>=
literal|0
condition|)
block|{
name|TCHECK2
argument_list|(
operator|*
name|p
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|+
literal|2
operator|>
name|endp
condition|)
goto|goto
name|trunc
goto|;
name|pt
operator|=
name|p
index|[
literal|0
index|]
expr_stmt|;
comment|/* type of "protocol" field */
name|pl
operator|=
name|p
index|[
literal|1
index|]
expr_stmt|;
comment|/* length of "protocol" field */
name|p
operator|+=
literal|2
expr_stmt|;
name|TCHECK2
argument_list|(
name|p
index|[
name|pl
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|+
name|pl
operator|+
literal|2
operator|>
name|endp
condition|)
goto|goto
name|trunc
goto|;
name|al
operator|=
name|EXTRACT_16BITS
argument_list|(
operator|&
name|p
index|[
name|pl
index|]
argument_list|)
expr_stmt|;
comment|/* address length */
if|if
condition|(
name|pt
operator|==
name|PT_NLPID
operator|&&
name|pl
operator|==
literal|1
operator|&&
operator|*
name|p
operator|==
name|NLPID_IP
operator|&&
name|al
operator|==
literal|4
condition|)
block|{
comment|/* 			 * IPv4: protocol type = NLPID, protocol length = 1 			 * (1-byte NLPID), protocol = 0xcc (NLPID for IPv4), 			 * address length = 4 			 */
name|p
operator|+=
literal|3
expr_stmt|;
name|TCHECK2
argument_list|(
operator|*
name|p
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|+
literal|4
operator|>
name|endp
condition|)
goto|goto
name|trunc
goto|;
name|printf
argument_list|(
literal|"IPv4 (%u) %s"
argument_list|,
name|num
argument_list|,
name|ipaddr_string
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|INET6
elseif|else
if|if
condition|(
name|pt
operator|==
name|PT_IEEE_802_2
operator|&&
name|pl
operator|==
literal|8
operator|&&
name|memcmp
argument_list|(
name|p
argument_list|,
name|prot_ipv6
argument_list|,
literal|8
argument_list|)
operator|==
literal|0
operator|&&
name|al
operator|==
literal|16
condition|)
block|{
comment|/* 			 * IPv6: protocol type = IEEE 802.2 header, 			 * protocol length = 8 (size of LLC+SNAP header), 			 * protocol = LLC+SNAP header with the IPv6 			 * Ethertype, address length = 16 			 */
name|p
operator|+=
literal|10
expr_stmt|;
name|TCHECK2
argument_list|(
operator|*
name|p
argument_list|,
name|al
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|+
name|al
operator|>
name|endp
condition|)
goto|goto
name|trunc
goto|;
name|printf
argument_list|(
literal|"IPv6 (%u) %s"
argument_list|,
name|num
argument_list|,
name|ip6addr_string
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
name|p
operator|+=
name|al
expr_stmt|;
block|}
endif|#
directive|endif
else|else
block|{
comment|/* 			 * Generic case: just print raw data 			 */
name|TCHECK2
argument_list|(
operator|*
name|p
argument_list|,
name|pl
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|+
name|pl
operator|>
name|endp
condition|)
goto|goto
name|trunc
goto|;
name|printf
argument_list|(
literal|"pt=0x%02x, pl=%d, pb="
argument_list|,
operator|*
operator|(
name|p
operator|-
literal|2
operator|)
argument_list|,
name|pl
argument_list|)
expr_stmt|;
while|while
condition|(
name|pl
operator|--
operator|>
literal|0
condition|)
name|printf
argument_list|(
literal|" %02x"
argument_list|,
operator|*
name|p
operator|++
argument_list|)
expr_stmt|;
name|TCHECK2
argument_list|(
operator|*
name|p
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|+
literal|2
operator|>
name|endp
condition|)
goto|goto
name|trunc
goto|;
name|al
operator|=
operator|(
operator|*
name|p
operator|<<
literal|8
operator|)
operator|+
operator|*
operator|(
name|p
operator|+
literal|1
operator|)
expr_stmt|;
name|printf
argument_list|(
literal|", al=%d, a="
argument_list|,
name|al
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
name|TCHECK2
argument_list|(
operator|*
name|p
argument_list|,
name|al
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|+
name|al
operator|>
name|endp
condition|)
goto|goto
name|trunc
goto|;
while|while
condition|(
name|al
operator|--
operator|>
literal|0
condition|)
name|printf
argument_list|(
literal|" %02x"
argument_list|,
operator|*
name|p
operator|++
argument_list|)
expr_stmt|;
block|}
name|num
operator|--
expr_stmt|;
if|if
condition|(
name|num
condition|)
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
name|trunc
label|:
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|cdp_print_prefixes
parameter_list|(
specifier|const
name|u_char
modifier|*
name|p
parameter_list|,
name|int
name|l
parameter_list|)
block|{
if|if
condition|(
name|l
operator|%
literal|5
condition|)
goto|goto
name|trunc
goto|;
name|printf
argument_list|(
literal|" IPv4 Prefixes (%d):"
argument_list|,
name|l
operator|/
literal|5
argument_list|)
expr_stmt|;
while|while
condition|(
name|l
operator|>
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|" %u.%u.%u.%u/%u"
argument_list|,
name|p
index|[
literal|0
index|]
argument_list|,
name|p
index|[
literal|1
index|]
argument_list|,
name|p
index|[
literal|2
index|]
argument_list|,
name|p
index|[
literal|3
index|]
argument_list|,
name|p
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|l
operator|-=
literal|5
expr_stmt|;
name|p
operator|+=
literal|5
expr_stmt|;
block|}
return|return
literal|0
return|;
name|trunc
label|:
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_comment
comment|/* read in a<n>-byte number, MSB first  * (of course this can handle max sizeof(long))  */
end_comment

begin_function
specifier|static
name|unsigned
name|long
name|cdp_get_number
parameter_list|(
specifier|const
name|u_char
modifier|*
name|p
parameter_list|,
name|int
name|l
parameter_list|)
block|{
name|unsigned
name|long
name|res
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|l
operator|>
literal|0
condition|)
block|{
name|res
operator|=
operator|(
name|res
operator|<<
literal|8
operator|)
operator|+
operator|*
name|p
expr_stmt|;
name|p
operator|++
expr_stmt|;
name|l
operator|--
expr_stmt|;
block|}
return|return
name|res
return|;
block|}
end_function

end_unit

