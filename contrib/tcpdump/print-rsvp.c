begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code  * distributions retain the above copyright notice and this paragraph  * in its entirety, and (2) distributions including binary code include  * the above copyright notice and this paragraph in its entirety in  * the documentation or other materials provided with the distribution.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND  * WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT  * LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS  * FOR A PARTICULAR PURPOSE.  *  * Original code by Hannes Gredler (hannes@juniper.net)  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
name|_U_
init|=
literal|"@(#) $Header: /tcpdump/master/tcpdump/print-rsvp.c,v 1.33.2.3 2005/06/16 00:50:12 guy Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<tcpdump-stdinc.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_include
include|#
directive|include
file|"ethertype.h"
end_include

begin_include
include|#
directive|include
file|"gmpls.h"
end_include

begin_comment
comment|/*  * RFC 2205 common header  *  *               0             1              2             3  *        +-------------+-------------+-------------+-------------+  *        | Vers | Flags|  Msg Type   |       RSVP Checksum       |  *        +-------------+-------------+-------------+-------------+  *        |  Send_TTL   | (Reserved)  |        RSVP Length        |  *        +-------------+-------------+-------------+-------------+  *  */
end_comment

begin_struct
struct|struct
name|rsvp_common_header
block|{
name|u_int8_t
name|version_flags
decl_stmt|;
name|u_int8_t
name|msg_type
decl_stmt|;
name|u_int8_t
name|checksum
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|ttl
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*   * RFC2205 object header  *  *   *               0             1              2             3  *        +-------------+-------------+-------------+-------------+  *        |       Length (bytes)      |  Class-Num  |   C-Type    |  *        +-------------+-------------+-------------+-------------+  *        |                                                       |  *        //                  (Object contents)                   //  *        |                                                       |  *        +-------------+-------------+-------------+-------------+  */
end_comment

begin_struct
struct|struct
name|rsvp_object_header
block|{
name|u_int8_t
name|length
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|class_num
decl_stmt|;
name|u_int8_t
name|ctype
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|RSVP_VERSION
value|1
end_define

begin_define
define|#
directive|define
name|RSVP_EXTRACT_VERSION
parameter_list|(
name|x
parameter_list|)
value|(((x)&0xf0)>>4)
end_define

begin_define
define|#
directive|define
name|RSVP_EXTRACT_FLAGS
parameter_list|(
name|x
parameter_list|)
value|((x)&0x0f)
end_define

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_PATH
value|1
end_define

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_RESV
value|2
end_define

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_PATHERR
value|3
end_define

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_RESVERR
value|4
end_define

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_PATHTEAR
value|5
end_define

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_RESVTEAR
value|6
end_define

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_RESVCONF
value|7
end_define

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_AGGREGATE
value|12
end_define

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_ACK
value|13
end_define

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_HELLO_OLD
value|14
end_define

begin_comment
comment|/* ancient Hellos */
end_comment

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_SREFRESH
value|15
end_define

begin_define
define|#
directive|define
name|RSVP_MSGTYPE_HELLO
value|20
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|rsvp_msg_type_values
index|[]
init|=
block|{
block|{
name|RSVP_MSGTYPE_PATH
block|,
literal|"Path"
block|}
block|,
block|{
name|RSVP_MSGTYPE_RESV
block|,
literal|"Resv"
block|}
block|,
block|{
name|RSVP_MSGTYPE_PATHERR
block|,
literal|"PathErr"
block|}
block|,
block|{
name|RSVP_MSGTYPE_RESVERR
block|,
literal|"ResvErr"
block|}
block|,
block|{
name|RSVP_MSGTYPE_PATHTEAR
block|,
literal|"PathTear"
block|}
block|,
block|{
name|RSVP_MSGTYPE_RESVTEAR
block|,
literal|"ResvTear"
block|}
block|,
block|{
name|RSVP_MSGTYPE_RESVCONF
block|,
literal|"ResvConf"
block|}
block|,
block|{
name|RSVP_MSGTYPE_AGGREGATE
block|,
literal|"Aggregate"
block|}
block|,
block|{
name|RSVP_MSGTYPE_ACK
block|,
literal|"Acknowledgement"
block|}
block|,
block|{
name|RSVP_MSGTYPE_HELLO_OLD
block|,
literal|"Hello (Old)"
block|}
block|,
block|{
name|RSVP_MSGTYPE_SREFRESH
block|,
literal|"Refresh"
block|}
block|,
block|{
name|RSVP_MSGTYPE_HELLO
block|,
literal|"Hello"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|rsvp_header_flag_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Refresh reduction capable"
block|}
block|,
comment|/* rfc2961 */
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|RSVP_OBJ_SESSION
value|1
end_define

begin_comment
comment|/* rfc2205 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_RSVP_HOP
value|3
end_define

begin_comment
comment|/* rfc2205, rfc3473 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_INTEGRITY
value|4
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_TIME_VALUES
value|5
end_define

begin_comment
comment|/* rfc2205 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_ERROR_SPEC
value|6
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_SCOPE
value|7
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_STYLE
value|8
end_define

begin_comment
comment|/* rfc2205 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_FLOWSPEC
value|9
end_define

begin_comment
comment|/* rfc2215 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_FILTERSPEC
value|10
end_define

begin_comment
comment|/* rfc2215 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_SENDER_TEMPLATE
value|11
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_SENDER_TSPEC
value|12
end_define

begin_comment
comment|/* rfc2215 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_ADSPEC
value|13
end_define

begin_comment
comment|/* rfc2215 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_POLICY_DATA
value|14
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_CONFIRM
value|15
end_define

begin_comment
comment|/* rfc2205 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_LABEL
value|16
end_define

begin_comment
comment|/* rfc3209 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_LABEL_REQ
value|19
end_define

begin_comment
comment|/* rfc3209 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_ERO
value|20
end_define

begin_comment
comment|/* rfc3209 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_RRO
value|21
end_define

begin_comment
comment|/* rfc3209 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_HELLO
value|22
end_define

begin_comment
comment|/* rfc3209 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_MESSAGE_ID
value|23
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_MESSAGE_ID_ACK
value|24
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_MESSAGE_ID_LIST
value|25
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_RECOVERY_LABEL
value|34
end_define

begin_comment
comment|/* rfc3473 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_UPSTREAM_LABEL
value|35
end_define

begin_comment
comment|/* rfc3473 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_LABEL_SET
value|36
end_define

begin_comment
comment|/* rfc3473 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_PROTECTION
value|37
end_define

begin_comment
comment|/* rfc3473 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_DETOUR
value|63
end_define

begin_comment
comment|/* draft-ietf-mpls-rsvp-lsp-fastreroute-01 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_CLASSTYPE
value|125
end_define

begin_comment
comment|/* draft-ietf-tewg-diff-te-proto-07 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_SUGGESTED_LABEL
value|129
end_define

begin_comment
comment|/* rfc3473 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_ACCEPT_LABEL_SET
value|130
end_define

begin_comment
comment|/* rfc3473 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_RESTART_CAPABILITY
value|131
end_define

begin_comment
comment|/* rfc3473 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_NOTIFY_REQ
value|195
end_define

begin_comment
comment|/* rfc3473 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_ADMIN_STATUS
value|196
end_define

begin_comment
comment|/* rfc3473 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_PROPERTIES
value|204
end_define

begin_comment
comment|/* juniper proprietary */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_FASTREROUTE
value|205
end_define

begin_comment
comment|/* draft-ietf-mpls-rsvp-lsp-fastreroute-01 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_SESSION_ATTRIBUTE
value|207
end_define

begin_comment
comment|/* rfc3209 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_CALL_ID
value|230
end_define

begin_comment
comment|/* rfc3474 */
end_comment

begin_define
define|#
directive|define
name|RSVP_OBJ_CALL_OPS
value|236
end_define

begin_comment
comment|/* rfc3474 */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|rsvp_obj_values
index|[]
init|=
block|{
block|{
name|RSVP_OBJ_SESSION
block|,
literal|"Session"
block|}
block|,
block|{
name|RSVP_OBJ_RSVP_HOP
block|,
literal|"RSVP Hop"
block|}
block|,
block|{
name|RSVP_OBJ_INTEGRITY
block|,
literal|"Integrity"
block|}
block|,
block|{
name|RSVP_OBJ_TIME_VALUES
block|,
literal|"Time Values"
block|}
block|,
block|{
name|RSVP_OBJ_ERROR_SPEC
block|,
literal|"Error Spec"
block|}
block|,
block|{
name|RSVP_OBJ_SCOPE
block|,
literal|"Scope"
block|}
block|,
block|{
name|RSVP_OBJ_STYLE
block|,
literal|"Style"
block|}
block|,
block|{
name|RSVP_OBJ_FLOWSPEC
block|,
literal|"Flowspec"
block|}
block|,
block|{
name|RSVP_OBJ_FILTERSPEC
block|,
literal|"FilterSpec"
block|}
block|,
block|{
name|RSVP_OBJ_SENDER_TEMPLATE
block|,
literal|"Sender Template"
block|}
block|,
block|{
name|RSVP_OBJ_SENDER_TSPEC
block|,
literal|"Sender TSpec"
block|}
block|,
block|{
name|RSVP_OBJ_ADSPEC
block|,
literal|"Adspec"
block|}
block|,
block|{
name|RSVP_OBJ_POLICY_DATA
block|,
literal|"Policy Data"
block|}
block|,
block|{
name|RSVP_OBJ_CONFIRM
block|,
literal|"Confirm"
block|}
block|,
block|{
name|RSVP_OBJ_LABEL
block|,
literal|"Label"
block|}
block|,
block|{
name|RSVP_OBJ_LABEL_REQ
block|,
literal|"Label Request"
block|}
block|,
block|{
name|RSVP_OBJ_ERO
block|,
literal|"ERO"
block|}
block|,
block|{
name|RSVP_OBJ_RRO
block|,
literal|"RRO"
block|}
block|,
block|{
name|RSVP_OBJ_HELLO
block|,
literal|"Hello"
block|}
block|,
block|{
name|RSVP_OBJ_MESSAGE_ID
block|,
literal|"Message ID"
block|}
block|,
block|{
name|RSVP_OBJ_MESSAGE_ID_ACK
block|,
literal|"Message ID Ack"
block|}
block|,
block|{
name|RSVP_OBJ_MESSAGE_ID_LIST
block|,
literal|"Message ID List"
block|}
block|,
block|{
name|RSVP_OBJ_RECOVERY_LABEL
block|,
literal|"Recovery Label"
block|}
block|,
block|{
name|RSVP_OBJ_UPSTREAM_LABEL
block|,
literal|"Upstream Label"
block|}
block|,
block|{
name|RSVP_OBJ_LABEL_SET
block|,
literal|"Label Set"
block|}
block|,
block|{
name|RSVP_OBJ_ACCEPT_LABEL_SET
block|,
literal|"Acceptable Label Set"
block|}
block|,
block|{
name|RSVP_OBJ_DETOUR
block|,
literal|"Detour"
block|}
block|,
block|{
name|RSVP_OBJ_CLASSTYPE
block|,
literal|"Class Type"
block|}
block|,
block|{
name|RSVP_OBJ_SUGGESTED_LABEL
block|,
literal|"Suggested Label"
block|}
block|,
block|{
name|RSVP_OBJ_PROPERTIES
block|,
literal|"Properties"
block|}
block|,
block|{
name|RSVP_OBJ_FASTREROUTE
block|,
literal|"Fast Re-Route"
block|}
block|,
block|{
name|RSVP_OBJ_SESSION_ATTRIBUTE
block|,
literal|"Session Attribute"
block|}
block|,
block|{
name|RSVP_OBJ_CALL_ID
block|,
literal|"Call-ID"
block|}
block|,
block|{
name|RSVP_OBJ_CALL_OPS
block|,
literal|"Call Capability"
block|}
block|,
block|{
name|RSVP_OBJ_RESTART_CAPABILITY
block|,
literal|"Restart Capability"
block|}
block|,
block|{
name|RSVP_OBJ_NOTIFY_REQ
block|,
literal|"Notify Request"
block|}
block|,
block|{
name|RSVP_OBJ_PROTECTION
block|,
literal|"Protection"
block|}
block|,
block|{
name|RSVP_OBJ_ADMIN_STATUS
block|,
literal|"Administrative Status"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|RSVP_CTYPE_IPV4
value|1
end_define

begin_define
define|#
directive|define
name|RSVP_CTYPE_IPV6
value|2
end_define

begin_define
define|#
directive|define
name|RSVP_CTYPE_TUNNEL_IPV4
value|7
end_define

begin_define
define|#
directive|define
name|RSVP_CTYPE_TUNNEL_IPV6
value|8
end_define

begin_define
define|#
directive|define
name|RSVP_CTYPE_1
value|1
end_define

begin_define
define|#
directive|define
name|RSVP_CTYPE_2
value|2
end_define

begin_define
define|#
directive|define
name|RSVP_CTYPE_3
value|3
end_define

begin_define
define|#
directive|define
name|RSVP_CTYPE_4
value|4
end_define

begin_comment
comment|/*  * the ctypes are not globally unique so for  * translating it to strings we build a table based  * on objects offsetted by the ctype  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|rsvp_ctype_values
index|[]
init|=
block|{
block|{
literal|256
operator|*
name|RSVP_OBJ_RSVP_HOP
operator|+
name|RSVP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_RSVP_HOP
operator|+
name|RSVP_CTYPE_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_RSVP_HOP
operator|+
name|RSVP_CTYPE_3
block|,
literal|"IPv4 plus opt. TLVs"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_RSVP_HOP
operator|+
name|RSVP_CTYPE_4
block|,
literal|"IPv6 plus opt. TLVs"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_NOTIFY_REQ
operator|+
name|RSVP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_NOTIFY_REQ
operator|+
name|RSVP_CTYPE_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_CONFIRM
operator|+
name|RSVP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_CONFIRM
operator|+
name|RSVP_CTYPE_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_TIME_VALUES
operator|+
name|RSVP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_FLOWSPEC
operator|+
name|RSVP_CTYPE_1
block|,
literal|"obsolete"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_FLOWSPEC
operator|+
name|RSVP_CTYPE_2
block|,
literal|"IntServ"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_SENDER_TSPEC
operator|+
name|RSVP_CTYPE_2
block|,
literal|"IntServ"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_ADSPEC
operator|+
name|RSVP_CTYPE_2
block|,
literal|"IntServ"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_FILTERSPEC
operator|+
name|RSVP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_FILTERSPEC
operator|+
name|RSVP_CTYPE_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_FILTERSPEC
operator|+
name|RSVP_CTYPE_3
block|,
literal|"IPv6 Flow-label"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_FILTERSPEC
operator|+
name|RSVP_CTYPE_TUNNEL_IPV4
block|,
literal|"Tunnel IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_SESSION
operator|+
name|RSVP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_SESSION
operator|+
name|RSVP_CTYPE_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_SESSION
operator|+
name|RSVP_CTYPE_TUNNEL_IPV4
block|,
literal|"Tunnel IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_SENDER_TEMPLATE
operator|+
name|RSVP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_SENDER_TEMPLATE
operator|+
name|RSVP_CTYPE_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_SENDER_TEMPLATE
operator|+
name|RSVP_CTYPE_TUNNEL_IPV4
block|,
literal|"Tunnel IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_MESSAGE_ID
operator|+
name|RSVP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_MESSAGE_ID_ACK
operator|+
name|RSVP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_MESSAGE_ID_LIST
operator|+
name|RSVP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_STYLE
operator|+
name|RSVP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_HELLO
operator|+
name|RSVP_CTYPE_1
block|,
literal|"Hello Request"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_HELLO
operator|+
name|RSVP_CTYPE_2
block|,
literal|"Hello Ack"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_LABEL_REQ
operator|+
name|RSVP_CTYPE_1
block|,
literal|"without label range"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_LABEL_REQ
operator|+
name|RSVP_CTYPE_2
block|,
literal|"with ATM label range"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_LABEL_REQ
operator|+
name|RSVP_CTYPE_3
block|,
literal|"with FR label range"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_LABEL_REQ
operator|+
name|RSVP_CTYPE_4
block|,
literal|"Generalized Label"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_LABEL
operator|+
name|RSVP_CTYPE_1
block|,
literal|"Label"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_LABEL
operator|+
name|RSVP_CTYPE_2
block|,
literal|"Generalized Label"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_LABEL
operator|+
name|RSVP_CTYPE_3
block|,
literal|"Waveband Switching"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_SUGGESTED_LABEL
operator|+
name|RSVP_CTYPE_1
block|,
literal|"Label"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_SUGGESTED_LABEL
operator|+
name|RSVP_CTYPE_2
block|,
literal|"Generalized Label"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_SUGGESTED_LABEL
operator|+
name|RSVP_CTYPE_3
block|,
literal|"Waveband Switching"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_UPSTREAM_LABEL
operator|+
name|RSVP_CTYPE_1
block|,
literal|"Label"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_UPSTREAM_LABEL
operator|+
name|RSVP_CTYPE_2
block|,
literal|"Generalized Label"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_UPSTREAM_LABEL
operator|+
name|RSVP_CTYPE_3
block|,
literal|"Waveband Switching"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_RECOVERY_LABEL
operator|+
name|RSVP_CTYPE_1
block|,
literal|"Label"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_RECOVERY_LABEL
operator|+
name|RSVP_CTYPE_2
block|,
literal|"Generalized Label"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_RECOVERY_LABEL
operator|+
name|RSVP_CTYPE_3
block|,
literal|"Waveband Switching"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_ERO
operator|+
name|RSVP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_RRO
operator|+
name|RSVP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_ERROR_SPEC
operator|+
name|RSVP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_ERROR_SPEC
operator|+
name|RSVP_CTYPE_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_ERROR_SPEC
operator|+
name|RSVP_CTYPE_3
block|,
literal|"IPv4 plus opt. TLVs"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_ERROR_SPEC
operator|+
name|RSVP_CTYPE_4
block|,
literal|"IPv6 plus opt. TLVs"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_RESTART_CAPABILITY
operator|+
name|RSVP_CTYPE_1
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_SESSION_ATTRIBUTE
operator|+
name|RSVP_CTYPE_TUNNEL_IPV4
block|,
literal|"Tunnel IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_FASTREROUTE
operator|+
name|RSVP_CTYPE_TUNNEL_IPV4
block|,
literal|"Tunnel IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_DETOUR
operator|+
name|RSVP_CTYPE_TUNNEL_IPV4
block|,
literal|"Tunnel IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_PROPERTIES
operator|+
name|RSVP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|RSVP_OBJ_CLASSTYPE
operator|+
name|RSVP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|RSVP_OBJ_XRO_MASK_SUBOBJ
parameter_list|(
name|x
parameter_list|)
value|((x)&0x7f)
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_XRO_MASK_LOOSE
parameter_list|(
name|x
parameter_list|)
value|((x)&0x80)
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_XRO_RES
value|0
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_XRO_IPV4
value|1
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_XRO_IPV6
value|2
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_XRO_ASN
value|32
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_XRO_MPLS
value|64
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|rsvp_obj_xro_values
index|[]
init|=
block|{
block|{
name|RSVP_OBJ_XRO_RES
block|,
literal|"Reserved"
block|}
block|,
block|{
name|RSVP_OBJ_XRO_IPV4
block|,
literal|"IPv4 prefix"
block|}
block|,
block|{
name|RSVP_OBJ_XRO_IPV6
block|,
literal|"IPv6 prefix"
block|}
block|,
block|{
name|RSVP_OBJ_XRO_ASN
block|,
literal|"Autonomous system number"
block|}
block|,
block|{
name|RSVP_OBJ_XRO_MPLS
block|,
literal|"MPLS label switched path termination"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* draft-ietf-mpls-rsvp-lsp-fastreroute-02.txt */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|rsvp_obj_rro_flag_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Local protection available"
block|}
block|,
block|{
literal|0x02
block|,
literal|"Local protection in use"
block|}
block|,
block|{
literal|0x04
block|,
literal|"Bandwidth protection"
block|}
block|,
block|{
literal|0x08
block|,
literal|"Node protection"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|rsvp_resstyle_values
index|[]
init|=
block|{
block|{
literal|17
block|,
literal|"Wildcard Filter"
block|}
block|,
block|{
literal|10
block|,
literal|"Fixed Filter"
block|}
block|,
block|{
literal|18
block|,
literal|"Shared Explicit"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|RSVP_OBJ_INTSERV_GUARANTEED_SERV
value|2
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_INTSERV_CONTROLLED_LOAD
value|5
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|rsvp_intserv_service_type_values
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"Default/Global Information"
block|}
block|,
block|{
name|RSVP_OBJ_INTSERV_GUARANTEED_SERV
block|,
literal|"Guaranteed Service"
block|}
block|,
block|{
name|RSVP_OBJ_INTSERV_CONTROLLED_LOAD
block|,
literal|"Controlled Load"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|rsvp_intserv_parameter_id_values
index|[]
init|=
block|{
block|{
literal|4
block|,
literal|"IS hop cnt"
block|}
block|,
block|{
literal|6
block|,
literal|"Path b/w estimate"
block|}
block|,
block|{
literal|8
block|,
literal|"Minimum path latency"
block|}
block|,
block|{
literal|10
block|,
literal|"Composed MTU"
block|}
block|,
block|{
literal|127
block|,
literal|"Token Bucket TSpec"
block|}
block|,
block|{
literal|130
block|,
literal|"Guaranteed Service RSpec"
block|}
block|,
block|{
literal|133
block|,
literal|"End-to-end composed value for C"
block|}
block|,
block|{
literal|134
block|,
literal|"End-to-end composed value for D"
block|}
block|,
block|{
literal|135
block|,
literal|"Since-last-reshaping point composed C"
block|}
block|,
block|{
literal|136
block|,
literal|"Since-last-reshaping point composed D"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|tok
name|rsvp_session_attribute_flag_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Local Protection desired"
block|}
block|,
block|{
literal|0x02
block|,
literal|"Label Recording desired"
block|}
block|,
block|{
literal|0x04
block|,
literal|"SE Style desired"
block|}
block|,
block|{
literal|0x08
block|,
literal|"Bandwidth protection desired"
block|}
block|,
comment|/* draft-ietf-mpls-rsvp-lsp-fastreroute-02.txt */
block|{
literal|0x10
block|,
literal|"Node protection desired"
block|}
block|,
comment|/* draft-ietf-mpls-rsvp-lsp-fastreroute-02.txt */
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|tok
name|rsvp_obj_prop_tlv_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Cos"
block|}
block|,
block|{
literal|0x02
block|,
literal|"Metric 1"
block|}
block|,
block|{
literal|0x04
block|,
literal|"Metric 2"
block|}
block|,
block|{
literal|0x08
block|,
literal|"CCC Status"
block|}
block|,
block|{
literal|0x10
block|,
literal|"Path Type"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|RSVP_OBJ_ERROR_SPEC_CODE_ROUTING
value|24
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_ERROR_SPEC_CODE_NOTIFY
value|25
end_define

begin_define
define|#
directive|define
name|RSVP_OBJ_ERROR_SPEC_CODE_DIFFSERV_TE
value|125
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|rsvp_obj_error_code_values
index|[]
init|=
block|{
block|{
name|RSVP_OBJ_ERROR_SPEC_CODE_ROUTING
block|,
literal|"Routing Problem"
block|}
block|,
block|{
name|RSVP_OBJ_ERROR_SPEC_CODE_NOTIFY
block|,
literal|"Notify Error"
block|}
block|,
block|{
name|RSVP_OBJ_ERROR_SPEC_CODE_DIFFSERV_TE
block|,
literal|"Diffserv TE Error"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|tok
name|rsvp_obj_error_code_routing_values
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"Bad EXPLICIT_ROUTE object"
block|}
block|,
block|{
literal|2
block|,
literal|"Bad strict node"
block|}
block|,
block|{
literal|3
block|,
literal|"Bad loose node"
block|}
block|,
block|{
literal|4
block|,
literal|"Bad initial subobject"
block|}
block|,
block|{
literal|5
block|,
literal|"No route available toward destination"
block|}
block|,
block|{
literal|6
block|,
literal|"Unacceptable label value"
block|}
block|,
block|{
literal|7
block|,
literal|"RRO indicated routing loops"
block|}
block|,
block|{
literal|8
block|,
literal|"non-RSVP-capable router in the path"
block|}
block|,
block|{
literal|9
block|,
literal|"MPLS label allocation failure"
block|}
block|,
block|{
literal|10
block|,
literal|"Unsupported L3PID"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|tok
name|rsvp_obj_error_code_diffserv_te_values
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"Unexpected CLASSTYPE object"
block|}
block|,
block|{
literal|2
block|,
literal|"Unsupported Class-Type"
block|}
block|,
block|{
literal|3
block|,
literal|"Invalid Class-Type value"
block|}
block|,
block|{
literal|4
block|,
literal|"Class-Type and setup priority do not form a configured TE-Class"
block|}
block|,
block|{
literal|5
block|,
literal|"Class-Type and holding priority do not form a configured TE-Class"
block|}
block|,
block|{
literal|6
block|,
literal|"Inconsistency between signaled PSC and signaled Class-Type"
block|}
block|,
block|{
literal|7
block|,
literal|"Inconsistency between signaled PHBs and signaled Class-Type"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|FALSE
value|0
end_define

begin_define
define|#
directive|define
name|TRUE
value|1
end_define

begin_function_decl
specifier|static
name|int
name|rsvp_intserv_print
parameter_list|(
specifier|const
name|u_char
modifier|*
parameter_list|,
name|u_short
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*   * this is a dissector for all the intserv defined  * specs as defined per rfc2215  * it is called from various rsvp objects;  * returns the amount of bytes being processed  */
end_comment

begin_function
specifier|static
name|int
name|rsvp_intserv_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|tptr
parameter_list|,
name|u_short
name|obj_tlen
parameter_list|)
block|{
name|int
name|parameter_id
decl_stmt|,
name|parameter_length
decl_stmt|;
union|union
block|{
name|float
name|f
decl_stmt|;
name|u_int32_t
name|i
decl_stmt|;
block|}
name|bw
union|;
if|if
condition|(
name|obj_tlen
operator|<
literal|4
condition|)
return|return
literal|0
return|;
name|parameter_id
operator|=
operator|*
operator|(
name|tptr
operator|)
expr_stmt|;
name|parameter_length
operator|=
name|EXTRACT_16BITS
argument_list|(
name|tptr
operator|+
literal|2
argument_list|)
operator|<<
literal|2
expr_stmt|;
comment|/* convert wordcount to bytecount */
name|printf
argument_list|(
literal|"\n\t      Parameter ID: %s (%u), length: %u, Flags: [0x%02x]"
argument_list|,
name|tok2str
argument_list|(
name|rsvp_intserv_parameter_id_values
argument_list|,
literal|"unknown"
argument_list|,
name|parameter_id
argument_list|)
argument_list|,
name|parameter_id
argument_list|,
name|parameter_length
argument_list|,
operator|*
operator|(
name|tptr
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj_tlen
operator|<
name|parameter_length
operator|+
literal|4
condition|)
return|return
literal|0
return|;
switch|switch
condition|(
name|parameter_id
condition|)
block|{
comment|/* parameter_id */
case|case
literal|4
case|:
comment|/*         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |    4 (e)      |    (f)        |           1 (g)               |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |        IS hop cnt (32-bit unsigned integer)                   |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         */
if|if
condition|(
name|parameter_length
operator|==
literal|4
condition|)
name|printf
argument_list|(
literal|"\n\t\tIS hop count: %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
comment|/*         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |    6 (h)      |    (i)        |           1 (j)               |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |  Path b/w estimate  (32-bit IEEE floating point number)       |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         */
if|if
condition|(
name|parameter_length
operator|==
literal|4
condition|)
block|{
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\tPath b/w estimate: %.10g Mbps"
argument_list|,
name|bw
operator|.
name|f
operator|/
literal|125000
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|8
case|:
comment|/*         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |     8 (k)     |    (l)        |           1 (m)               |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |        Minimum path latency (32-bit integer)                  |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         */
if|if
condition|(
name|parameter_length
operator|==
literal|4
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t\tMinimum path latency: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
operator|==
literal|0xffffffff
condition|)
name|printf
argument_list|(
literal|"don't care"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|10
case|:
comment|/*         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |     10 (n)    |      (o)      |           1 (p)               |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |      Composed MTU (32-bit unsigned integer)                   |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         */
if|if
condition|(
name|parameter_length
operator|==
literal|4
condition|)
name|printf
argument_list|(
literal|"\n\t\tComposed MTU: %u bytes"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|127
case|:
comment|/*          * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |   127 (e)     |    0 (f)      |             5 (g)             |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |  Token Bucket Rate [r] (32-bit IEEE floating point number)    |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |  Token Bucket Size [b] (32-bit IEEE floating point number)    |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |  Peak Data Rate [p] (32-bit IEEE floating point number)       |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |  Minimum Policed Unit [m] (32-bit integer)                    |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |  Maximum Packet Size [M]  (32-bit integer)                    |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         */
if|if
condition|(
name|parameter_length
operator|==
literal|20
condition|)
block|{
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\tToken Bucket Rate: %.10g Mbps"
argument_list|,
name|bw
operator|.
name|f
operator|/
literal|125000
argument_list|)
expr_stmt|;
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|8
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\tToken Bucket Size: %.10g bytes"
argument_list|,
name|bw
operator|.
name|f
argument_list|)
expr_stmt|;
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|12
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\tPeak Data Rate: %.10g Mbps"
argument_list|,
name|bw
operator|.
name|f
operator|/
literal|125000
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\tMinimum Policed Unit: %u bytes"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|16
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\tMaximum Packet Size: %u bytes"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|20
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|130
case|:
comment|/*          * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |     130 (h)   |    0 (i)      |            2 (j)              |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |  Rate [R]  (32-bit IEEE floating point number)                |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         * |  Slack Term [S]  (32-bit integer)                             |         * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         */
if|if
condition|(
name|parameter_length
operator|==
literal|8
condition|)
block|{
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\tRate: %.10g Mbps"
argument_list|,
name|bw
operator|.
name|f
operator|/
literal|125000
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\tSlack Term: %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|8
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|133
case|:
case|case
literal|134
case|:
case|case
literal|135
case|:
case|case
literal|136
case|:
if|if
condition|(
name|parameter_length
operator|==
literal|4
condition|)
name|printf
argument_list|(
literal|"\n\t\tValue: %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|vflag
operator|<=
literal|1
condition|)
name|print_unknown_data
argument_list|(
name|tptr
operator|+
literal|4
argument_list|,
literal|"\n\t\t"
argument_list|,
name|parameter_length
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|parameter_length
operator|+
literal|4
operator|)
return|;
comment|/* header length 4 bytes */
block|}
end_function

begin_function
specifier|static
name|int
name|rsvp_obj_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|tptr
parameter_list|,
specifier|const
name|char
modifier|*
name|ident
parameter_list|,
name|u_int
name|tlen
parameter_list|)
block|{
specifier|const
name|struct
name|rsvp_object_header
modifier|*
name|rsvp_obj_header
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|obj_tptr
decl_stmt|;
name|u_short
name|rsvp_obj_len
decl_stmt|,
name|rsvp_obj_ctype
decl_stmt|,
name|obj_tlen
decl_stmt|,
name|intserv_serv_tlen
decl_stmt|;
name|int
name|hexdump
decl_stmt|,
name|processed
decl_stmt|,
name|padbytes
decl_stmt|,
name|error_code
decl_stmt|,
name|error_value
decl_stmt|,
name|i
decl_stmt|;
union|union
block|{
name|float
name|f
decl_stmt|;
name|u_int32_t
name|i
decl_stmt|;
block|}
name|bw
union|;
name|u_int8_t
name|namelen
decl_stmt|;
while|while
condition|(
name|tlen
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|rsvp_object_header
argument_list|)
condition|)
block|{
comment|/* did we capture enough for fully decoding the object header ? */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|rsvp_object_header
argument_list|)
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
name|rsvp_obj_header
operator|=
operator|(
specifier|const
expr|struct
name|rsvp_object_header
operator|*
operator|)
name|tptr
expr_stmt|;
name|rsvp_obj_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|rsvp_obj_header
operator|->
name|length
argument_list|)
expr_stmt|;
name|rsvp_obj_ctype
operator|=
name|rsvp_obj_header
operator|->
name|ctype
expr_stmt|;
if|if
condition|(
name|rsvp_obj_len
operator|%
literal|4
condition|)
block|{
name|printf
argument_list|(
literal|"%sERROR: object header size %u not a multiple of 4"
argument_list|,
name|ident
argument_list|,
name|rsvp_obj_len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|rsvp_obj_len
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|rsvp_object_header
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"%sERROR: object header too short %u< %lu"
argument_list|,
name|ident
argument_list|,
name|rsvp_obj_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|rsvp_object_header
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|printf
argument_list|(
literal|"%s%s Object (%u) Flags: [%s"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|rsvp_obj_values
argument_list|,
literal|"Unknown"
argument_list|,
name|rsvp_obj_header
operator|->
name|class_num
argument_list|)
argument_list|,
name|rsvp_obj_header
operator|->
name|class_num
argument_list|,
operator|(
operator|(
name|rsvp_obj_header
operator|->
name|class_num
operator|)
operator|&
literal|0x80
operator|)
condition|?
literal|"ignore"
else|:
literal|"reject"
argument_list|)
expr_stmt|;
if|if
condition|(
name|rsvp_obj_header
operator|->
name|class_num
operator|>
literal|128
condition|)
name|printf
argument_list|(
literal|" %s"
argument_list|,
operator|(
operator|(
name|rsvp_obj_header
operator|->
name|class_num
operator|)
operator|&
literal|0x40
operator|)
condition|?
literal|"and forward"
else|:
literal|"silently"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" if unknown], Class-Type: %s (%u), length: %u"
argument_list|,
name|tok2str
argument_list|(
name|rsvp_ctype_values
argument_list|,
literal|"Unknown"
argument_list|,
operator|(
operator|(
name|rsvp_obj_header
operator|->
name|class_num
operator|)
operator|<<
literal|8
operator|)
operator|+
name|rsvp_obj_ctype
argument_list|)
argument_list|,
name|rsvp_obj_ctype
argument_list|,
name|rsvp_obj_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|tlen
operator|<
name|rsvp_obj_len
condition|)
block|{
name|printf
argument_list|(
literal|"%sERROR: object goes past end of objects TLV"
argument_list|,
name|ident
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|obj_tptr
operator|=
name|tptr
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|rsvp_object_header
argument_list|)
expr_stmt|;
name|obj_tlen
operator|=
name|rsvp_obj_len
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|rsvp_object_header
argument_list|)
expr_stmt|;
comment|/* did we capture enough for fully decoding the object ? */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|rsvp_obj_len
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|hexdump
operator|=
name|FALSE
expr_stmt|;
switch|switch
condition|(
name|rsvp_obj_header
operator|->
name|class_num
condition|)
block|{
case|case
name|RSVP_OBJ_SESSION
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  IPv4 DestAddress: %s, Protocol ID: 0x%02x"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|4
operator|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Flags: [0x%02x], DestPort %u"
argument_list|,
name|ident
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|5
operator|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|8
expr_stmt|;
name|obj_tptr
operator|+=
literal|8
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|RSVP_CTYPE_IPV6
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|20
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  IPv6 DestAddress: %s, Protocol ID: 0x%02x"
argument_list|,
name|ident
argument_list|,
name|ip6addr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|16
operator|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Flags: [0x%02x], DestPort %u"
argument_list|,
name|ident
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|17
operator|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|18
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|20
expr_stmt|;
name|obj_tptr
operator|+=
literal|20
expr_stmt|;
break|break;
case|case
name|RSVP_CTYPE_TUNNEL_IPV6
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|36
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  IPv6 Tunnel EndPoint: %s, Tunnel ID: 0x%04x, Extended Tunnel ID: %s"
argument_list|,
name|ident
argument_list|,
name|ip6addr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|18
argument_list|)
argument_list|,
name|ip6addr_string
argument_list|(
name|obj_tptr
operator|+
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|36
expr_stmt|;
name|obj_tptr
operator|+=
literal|36
expr_stmt|;
break|break;
endif|#
directive|endif
case|case
name|RSVP_CTYPE_TUNNEL_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|12
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  IPv4 Tunnel EndPoint: %s, Tunnel ID: 0x%04x, Extended Tunnel ID: %s"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|6
argument_list|)
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
operator|+
literal|8
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|12
expr_stmt|;
name|obj_tptr
operator|+=
literal|12
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_CONFIRM
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  IPv4 Receiver Address: %s"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|RSVP_CTYPE_IPV6
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|16
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  IPv6 Receiver Address: %s"
argument_list|,
name|ident
argument_list|,
name|ip6addr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|16
expr_stmt|;
name|obj_tptr
operator|+=
literal|16
expr_stmt|;
break|break;
endif|#
directive|endif
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_NOTIFY_REQ
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  IPv4 Notify Node Address: %s"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|RSVP_CTYPE_IPV6
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|16
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  IPv6 Notify Node Address: %s"
argument_list|,
name|ident
argument_list|,
name|ip6addr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|16
expr_stmt|;
name|obj_tptr
operator|+=
literal|16
expr_stmt|;
break|break;
endif|#
directive|endif
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_SUGGESTED_LABEL
case|:
comment|/* fall through */
case|case
name|RSVP_OBJ_UPSTREAM_LABEL
case|:
comment|/* fall through */
case|case
name|RSVP_OBJ_RECOVERY_LABEL
case|:
comment|/* fall through */
case|case
name|RSVP_OBJ_LABEL
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_1
case|:
while|while
condition|(
name|obj_tlen
operator|>=
literal|4
condition|)
block|{
name|printf
argument_list|(
literal|"%s  Label: %u"
argument_list|,
name|ident
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_CTYPE_2
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Generalized Label: %u"
argument_list|,
name|ident
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
break|break;
case|case
name|RSVP_CTYPE_3
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|12
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Waveband ID: %u%s  Start Label: %u, Stop Label: %u"
argument_list|,
name|ident
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|ident
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|8
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|12
expr_stmt|;
name|obj_tptr
operator|+=
literal|12
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_STYLE
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_1
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Reservation Style: %s, Flags: [0x%02x]"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|rsvp_resstyle_values
argument_list|,
literal|"Unknown"
argument_list|,
name|EXTRACT_24BITS
argument_list|(
name|obj_tptr
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_SENDER_TEMPLATE
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Source Address: %s, Source Port: %u"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|8
expr_stmt|;
name|obj_tptr
operator|+=
literal|8
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|RSVP_CTYPE_IPV6
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|20
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Source Address: %s, Source Port: %u"
argument_list|,
name|ident
argument_list|,
name|ip6addr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|18
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|20
expr_stmt|;
name|obj_tptr
operator|+=
literal|20
expr_stmt|;
break|break;
endif|#
directive|endif
case|case
name|RSVP_CTYPE_TUNNEL_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  IPv4 Tunnel Sender Address: %s, LSP-ID: 0x%04x"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|8
expr_stmt|;
name|obj_tptr
operator|+=
literal|8
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_LABEL_REQ
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_1
case|:
while|while
condition|(
name|obj_tlen
operator|>=
literal|4
condition|)
block|{
name|printf
argument_list|(
literal|"%s  L3 Protocol ID: %s"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|ethertype_values
argument_list|,
literal|"Unknown Protocol (0x%04x)"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_CTYPE_2
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|12
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  L3 Protocol ID: %s"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|ethertype_values
argument_list|,
literal|"Unknown Protocol (0x%04x)"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|",%s merge capability"
argument_list|,
operator|(
operator|(
operator|*
operator|(
name|obj_tptr
operator|+
literal|4
operator|)
operator|)
operator|&
literal|0x80
operator|)
condition|?
literal|"no"
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Minimum VPI/VCI: %u/%u"
argument_list|,
name|ident
argument_list|,
operator|(
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
operator|)
operator|&
literal|0xfff
argument_list|,
operator|(
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|6
argument_list|)
operator|)
operator|&
literal|0xfff
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Maximum VPI/VCI: %u/%u"
argument_list|,
name|ident
argument_list|,
operator|(
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|8
argument_list|)
operator|)
operator|&
literal|0xfff
argument_list|,
operator|(
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|10
argument_list|)
operator|)
operator|&
literal|0xfff
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|12
expr_stmt|;
name|obj_tptr
operator|+=
literal|12
expr_stmt|;
break|break;
case|case
name|RSVP_CTYPE_3
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|12
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  L3 Protocol ID: %s"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|ethertype_values
argument_list|,
literal|"Unknown Protocol (0x%04x)"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Minimum/Maximum DLCI: %u/%u, %s%s bit DLCI"
argument_list|,
name|ident
argument_list|,
operator|(
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
operator|)
operator|&
literal|0x7fffff
argument_list|,
operator|(
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|8
argument_list|)
operator|)
operator|&
literal|0x7fffff
argument_list|,
operator|(
operator|(
operator|(
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
operator|>>
literal|7
operator|)
operator|&
literal|3
operator|)
operator|==
literal|0
operator|)
condition|?
literal|"10"
else|:
literal|""
argument_list|,
operator|(
operator|(
operator|(
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
operator|>>
literal|7
operator|)
operator|&
literal|3
operator|)
operator|==
literal|2
operator|)
condition|?
literal|"23"
else|:
literal|""
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|12
expr_stmt|;
name|obj_tptr
operator|+=
literal|12
expr_stmt|;
break|break;
case|case
name|RSVP_CTYPE_4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  LSP Encoding Type: %s (%u)"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|gmpls_encoding_values
argument_list|,
literal|"Unknown"
argument_list|,
operator|*
name|obj_tptr
argument_list|)
argument_list|,
operator|*
name|obj_tptr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Switching Type: %s (%u), Payload ID: %s (0x%04x)"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|gmpls_switch_cap_values
argument_list|,
literal|"Unknown"
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
argument_list|)
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
argument_list|,
name|tok2str
argument_list|(
name|gmpls_payload_values
argument_list|,
literal|"Unknown"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|8
expr_stmt|;
name|obj_tptr
operator|+=
literal|8
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_RRO
case|:
case|case
name|RSVP_OBJ_ERO
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_IPV4
case|:
while|while
condition|(
name|obj_tlen
operator|>=
literal|4
condition|)
block|{
name|printf
argument_list|(
literal|"%s  Subobject Type: %s, length %u"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|rsvp_obj_xro_values
argument_list|,
literal|"Unknown %u"
argument_list|,
name|RSVP_OBJ_XRO_MASK_SUBOBJ
argument_list|(
operator|*
name|obj_tptr
argument_list|)
argument_list|)
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
operator|==
literal|0
condition|)
block|{
comment|/* prevent infinite loops */
name|printf
argument_list|(
literal|"%s  ERROR: zero length ERO subtype"
argument_list|,
name|ident
argument_list|)
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|RSVP_OBJ_XRO_MASK_SUBOBJ
argument_list|(
operator|*
name|obj_tptr
argument_list|)
condition|)
block|{
case|case
name|RSVP_OBJ_XRO_IPV4
case|:
name|printf
argument_list|(
literal|", %s, %s/%u, Flags: [%s]"
argument_list|,
name|RSVP_OBJ_XRO_MASK_LOOSE
argument_list|(
operator|*
name|obj_tptr
argument_list|)
condition|?
literal|"Loose"
else|:
literal|"Strict"
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|6
operator|)
argument_list|,
name|bittok2str
argument_list|(
name|rsvp_obj_rro_flag_values
argument_list|,
literal|"none"
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|7
operator|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* rfc3209 says that this field is rsvd. */
block|}
name|obj_tlen
operator|-=
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
expr_stmt|;
name|obj_tptr
operator|+=
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
expr_stmt|;
block|}
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_HELLO
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_1
case|:
case|case
name|RSVP_CTYPE_2
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Source Instance: 0x%08x, Destination Instance: 0x%08x"
argument_list|,
name|ident
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|8
expr_stmt|;
name|obj_tptr
operator|+=
literal|8
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_RESTART_CAPABILITY
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_1
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Restart  Time: %ums, Recovery Time: %ums"
argument_list|,
name|ident
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|8
expr_stmt|;
name|obj_tptr
operator|+=
literal|8
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_SESSION_ATTRIBUTE
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_TUNNEL_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|namelen
operator|=
operator|*
operator|(
name|obj_tptr
operator|+
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|obj_tlen
operator|<
literal|4
operator|+
name|namelen
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Session Name: "
argument_list|,
name|ident
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|namelen
condition|;
name|i
operator|++
control|)
name|safeputchar
argument_list|(
operator|*
operator|(
name|obj_tptr
operator|+
literal|4
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Setup Priority: %u, Holding Priority: %u, Flags: [%s]"
argument_list|,
name|ident
argument_list|,
operator|(
name|int
operator|)
operator|*
name|obj_tptr
argument_list|,
operator|(
name|int
operator|)
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
argument_list|,
name|tok2str
argument_list|(
name|rsvp_session_attribute_flag_values
argument_list|,
literal|"none"
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|2
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
operator|+
operator|*
operator|(
name|obj_tptr
operator|+
literal|3
operator|)
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
operator|+
operator|*
operator|(
name|obj_tptr
operator|+
literal|3
operator|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_RSVP_HOP
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_3
case|:
comment|/* fall through - FIXME add TLV parser */
case|case
name|RSVP_CTYPE_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Previous/Next Interface: %s, Logical Interface Handle: 0x%08x"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|8
expr_stmt|;
name|obj_tptr
operator|+=
literal|8
expr_stmt|;
name|hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unless we have a TLV parser lets just hexdump */
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|RSVP_CTYPE_4
case|:
comment|/* fall through - FIXME add TLV parser */
case|case
name|RSVP_CTYPE_IPV6
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|20
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Previous/Next Interface: %s, Logical Interface Handle: 0x%08x"
argument_list|,
name|ident
argument_list|,
name|ip6addr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|16
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|20
expr_stmt|;
name|obj_tptr
operator|+=
literal|20
expr_stmt|;
name|hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unless we have a TLV parser lets just hexdump */
break|break;
endif|#
directive|endif
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_TIME_VALUES
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_1
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Refresh Period: %ums"
argument_list|,
name|ident
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
comment|/* those three objects do share the same semantics */
case|case
name|RSVP_OBJ_SENDER_TSPEC
case|:
case|case
name|RSVP_OBJ_ADSPEC
case|:
case|case
name|RSVP_OBJ_FLOWSPEC
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_2
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Msg-Version: %u, length: %u"
argument_list|,
name|ident
argument_list|,
operator|(
operator|*
name|obj_tptr
operator|&
literal|0xf0
operator|)
operator|>>
literal|4
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
operator|<<
literal|2
argument_list|)
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
comment|/* get to the start of the service header */
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
while|while
condition|(
name|obj_tlen
operator|>=
literal|4
condition|)
block|{
name|intserv_serv_tlen
operator|=
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
operator|<<
literal|2
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Service Type: %s (%u), break bit %s set, Service length: %u"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|rsvp_intserv_service_type_values
argument_list|,
literal|"unknown"
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|)
argument_list|)
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|)
argument_list|,
operator|(
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
operator|&
literal|0x80
operator|)
condition|?
literal|""
else|:
literal|"not"
argument_list|,
name|intserv_serv_tlen
argument_list|)
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
comment|/* get to the start of the parameter list */
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
while|while
condition|(
name|intserv_serv_tlen
operator|>=
literal|4
condition|)
block|{
name|processed
operator|=
name|rsvp_intserv_print
argument_list|(
name|obj_tptr
argument_list|,
name|obj_tlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|processed
operator|==
literal|0
condition|)
break|break;
name|obj_tlen
operator|-=
name|processed
expr_stmt|;
name|intserv_serv_tlen
operator|-=
name|processed
expr_stmt|;
name|obj_tptr
operator|+=
name|processed
expr_stmt|;
block|}
block|}
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_FILTERSPEC
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Source Address: %s, Source Port: %u"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|8
expr_stmt|;
name|obj_tptr
operator|+=
literal|8
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|RSVP_CTYPE_IPV6
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|20
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Source Address: %s, Source Port: %u"
argument_list|,
name|ident
argument_list|,
name|ip6addr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|18
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|20
expr_stmt|;
name|obj_tptr
operator|+=
literal|20
expr_stmt|;
break|break;
case|case
name|RSVP_CTYPE_3
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|20
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Source Address: %s, Flow Label: %u"
argument_list|,
name|ident
argument_list|,
name|ip6addr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_24BITS
argument_list|(
name|obj_tptr
operator|+
literal|17
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|20
expr_stmt|;
name|obj_tptr
operator|+=
literal|20
expr_stmt|;
break|break;
case|case
name|RSVP_CTYPE_TUNNEL_IPV6
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|20
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Source Address: %s, LSP-ID: 0x%04x"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|18
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|20
expr_stmt|;
name|obj_tptr
operator|+=
literal|20
expr_stmt|;
break|break;
endif|#
directive|endif
case|case
name|RSVP_CTYPE_TUNNEL_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Source Address: %s, LSP-ID: 0x%04x"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|8
expr_stmt|;
name|obj_tptr
operator|+=
literal|8
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_FASTREROUTE
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_TUNNEL_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|16
condition|)
return|return
operator|-
literal|1
return|;
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Setup Priority: %u, Holding Priority: %u, Hop-limit: %u, Bandwidth: %.10g Mbps"
argument_list|,
name|ident
argument_list|,
operator|(
name|int
operator|)
operator|*
name|obj_tptr
argument_list|,
operator|(
name|int
operator|)
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
argument_list|,
operator|(
name|int
operator|)
operator|*
operator|(
name|obj_tptr
operator|+
literal|2
operator|)
argument_list|,
name|bw
operator|.
name|f
operator|*
literal|8
operator|/
literal|1000000
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Include Colors: 0x%08x, Exclude Colors: 0x%08x"
argument_list|,
name|ident
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|8
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|12
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|16
expr_stmt|;
name|obj_tptr
operator|+=
literal|16
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_DETOUR
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_TUNNEL_IPV4
case|:
while|while
condition|(
name|obj_tlen
operator|>=
literal|8
condition|)
block|{
name|printf
argument_list|(
literal|"%s  PLR-ID: %s, Avoid-Node-ID: %s"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|8
expr_stmt|;
name|obj_tptr
operator|+=
literal|8
expr_stmt|;
block|}
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_CLASSTYPE
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_1
case|:
name|printf
argument_list|(
literal|"%s  Class Type: %u"
argument_list|,
name|ident
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
operator|&
literal|0x7
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_ERROR_SPEC
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_3
case|:
comment|/* fall through - FIXME add TLV parser */
case|case
name|RSVP_CTYPE_IPV4
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|error_code
operator|=
operator|*
operator|(
name|obj_tptr
operator|+
literal|5
operator|)
expr_stmt|;
name|error_value
operator|=
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|6
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Error Node Address: %s, Flags: [0x%02x]%s  Error Code: %s (%u)"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|4
operator|)
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|rsvp_obj_error_code_values
argument_list|,
literal|"unknown"
argument_list|,
name|error_code
argument_list|)
argument_list|,
name|error_code
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|error_code
condition|)
block|{
case|case
name|RSVP_OBJ_ERROR_SPEC_CODE_ROUTING
case|:
name|printf
argument_list|(
literal|", Error Value: %s (%u)"
argument_list|,
name|tok2str
argument_list|(
name|rsvp_obj_error_code_routing_values
argument_list|,
literal|"unknown"
argument_list|,
name|error_value
argument_list|)
argument_list|,
name|error_value
argument_list|)
expr_stmt|;
break|break;
case|case
name|RSVP_OBJ_ERROR_SPEC_CODE_DIFFSERV_TE
case|:
name|printf
argument_list|(
literal|", Error Value: %s (%u)"
argument_list|,
name|tok2str
argument_list|(
name|rsvp_obj_error_code_diffserv_te_values
argument_list|,
literal|"unknown"
argument_list|,
name|error_value
argument_list|)
argument_list|,
name|error_value
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|", Unknown Error Value (%u)"
argument_list|,
name|error_value
argument_list|)
expr_stmt|;
break|break;
block|}
name|obj_tlen
operator|-=
literal|8
expr_stmt|;
name|obj_tptr
operator|+=
literal|8
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|RSVP_CTYPE_4
case|:
comment|/* fall through - FIXME add TLV parser */
case|case
name|RSVP_CTYPE_IPV6
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|20
condition|)
return|return
operator|-
literal|1
return|;
name|error_code
operator|=
operator|*
operator|(
name|obj_tptr
operator|+
literal|17
operator|)
expr_stmt|;
name|error_value
operator|=
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|18
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Error Node Address: %s, Flags: [0x%02x]%s  Error Code: %s (%u)"
argument_list|,
name|ident
argument_list|,
name|ip6addr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|16
operator|)
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|rsvp_obj_error_code_values
argument_list|,
literal|"unknown"
argument_list|,
name|error_code
argument_list|)
argument_list|,
name|error_code
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|error_code
condition|)
block|{
case|case
name|RSVP_OBJ_ERROR_SPEC_CODE_ROUTING
case|:
name|printf
argument_list|(
literal|", Error Value: %s (%u)"
argument_list|,
name|tok2str
argument_list|(
name|rsvp_obj_error_code_routing_values
argument_list|,
literal|"unknown"
argument_list|,
name|error_value
argument_list|)
argument_list|,
name|error_value
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|obj_tlen
operator|-=
literal|20
expr_stmt|;
name|obj_tptr
operator|+=
literal|20
expr_stmt|;
break|break;
endif|#
directive|endif
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_PROPERTIES
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_1
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|padbytes
operator|=
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  TLV count: %u, padding bytes: %u"
argument_list|,
name|ident
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|padbytes
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
comment|/* loop through as long there is anything longer than the TLV header (2) */
while|while
condition|(
name|obj_tlen
operator|>=
literal|2
operator|+
name|padbytes
condition|)
block|{
name|printf
argument_list|(
literal|"%s    %s TLV (0x%02x), length: %u"
argument_list|,
comment|/* length includes header */
name|ident
argument_list|,
name|tok2str
argument_list|(
name|rsvp_obj_prop_tlv_values
argument_list|,
literal|"unknown"
argument_list|,
operator|*
name|obj_tptr
argument_list|)
argument_list|,
operator|*
name|obj_tptr
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj_tlen
operator|<
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
operator|<
literal|2
condition|)
return|return
operator|-
literal|1
return|;
name|print_unknown_data
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|,
literal|"\n\t\t"
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
operator|-
literal|2
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
expr_stmt|;
name|obj_tptr
operator|+=
operator|*
operator|(
name|obj_tptr
operator|+
literal|1
operator|)
expr_stmt|;
block|}
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_OBJ_MESSAGE_ID
case|:
comment|/* fall through */
case|case
name|RSVP_OBJ_MESSAGE_ID_ACK
case|:
comment|/* fall through */
case|case
name|RSVP_OBJ_MESSAGE_ID_LIST
case|:
switch|switch
condition|(
name|rsvp_obj_ctype
condition|)
block|{
case|case
name|RSVP_CTYPE_1
case|:
if|if
condition|(
name|obj_tlen
operator|<
literal|8
condition|)
return|return
operator|-
literal|1
return|;
name|printf
argument_list|(
literal|"%s  Flags [0x%02x], epoch: %u"
argument_list|,
name|ident
argument_list|,
operator|*
name|obj_tptr
argument_list|,
name|EXTRACT_24BITS
argument_list|(
name|obj_tptr
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
comment|/* loop through as long there are no messages left */
while|while
condition|(
name|obj_tlen
operator|>=
literal|4
condition|)
block|{
name|printf
argument_list|(
literal|"%s    Message-ID 0x%08x (%u)"
argument_list|,
name|ident
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
name|obj_tlen
operator|-=
literal|4
expr_stmt|;
name|obj_tptr
operator|+=
literal|4
expr_stmt|;
block|}
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
comment|/*          *  FIXME those are the defined objects that lack a decoder          *  you are welcome to contribute code ;-)          */
case|case
name|RSVP_OBJ_INTEGRITY
case|:
case|case
name|RSVP_OBJ_SCOPE
case|:
case|case
name|RSVP_OBJ_POLICY_DATA
case|:
case|case
name|RSVP_OBJ_LABEL_SET
case|:
case|case
name|RSVP_OBJ_ACCEPT_LABEL_SET
case|:
case|case
name|RSVP_OBJ_PROTECTION
case|:
default|default:
if|if
condition|(
name|vflag
operator|<=
literal|1
condition|)
name|print_unknown_data
argument_list|(
name|obj_tptr
argument_list|,
literal|"\n\t    "
argument_list|,
name|obj_tlen
argument_list|)
expr_stmt|;
comment|/* FIXME indentation */
break|break;
block|}
comment|/* do we also want to see a hex dump ? */
if|if
condition|(
name|vflag
operator|>
literal|1
operator|||
name|hexdump
operator|==
name|TRUE
condition|)
name|print_unknown_data
argument_list|(
name|tptr
operator|+
sizeof|sizeof
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|rsvp_object_header
argument_list|)
argument_list|)
argument_list|,
literal|"\n\t    "
argument_list|,
comment|/* FIXME indentation */
name|rsvp_obj_len
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|rsvp_object_header
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
name|rsvp_obj_len
expr_stmt|;
name|tlen
operator|-=
name|rsvp_obj_len
expr_stmt|;
block|}
return|return
literal|0
return|;
name|trunc
label|:
name|printf
argument_list|(
literal|"\n\t\t packet exceeded snapshot"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
name|void
name|rsvp_print
parameter_list|(
specifier|register
specifier|const
name|u_char
modifier|*
name|pptr
parameter_list|,
specifier|register
name|u_int
name|len
parameter_list|)
block|{
specifier|const
name|struct
name|rsvp_common_header
modifier|*
name|rsvp_com_header
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|tptr
decl_stmt|,
modifier|*
name|subtptr
decl_stmt|;
name|u_short
name|tlen
decl_stmt|,
name|subtlen
decl_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
name|rsvp_com_header
operator|=
operator|(
specifier|const
expr|struct
name|rsvp_common_header
operator|*
operator|)
name|pptr
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|rsvp_com_header
argument_list|)
expr_stmt|;
comment|/*      * Sanity checking of the header.      */
if|if
condition|(
name|RSVP_EXTRACT_VERSION
argument_list|(
name|rsvp_com_header
operator|->
name|version_flags
argument_list|)
operator|!=
name|RSVP_VERSION
condition|)
block|{
name|printf
argument_list|(
literal|"ERROR: RSVP version %u packet not supported"
argument_list|,
name|RSVP_EXTRACT_VERSION
argument_list|(
name|rsvp_com_header
operator|->
name|version_flags
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* in non-verbose mode just lets print the basic Message Type*/
if|if
condition|(
name|vflag
operator|<
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"RSVPv%u %s Message, length: %u"
argument_list|,
name|RSVP_EXTRACT_VERSION
argument_list|(
name|rsvp_com_header
operator|->
name|version_flags
argument_list|)
argument_list|,
name|tok2str
argument_list|(
name|rsvp_msg_type_values
argument_list|,
literal|"unknown (%u)"
argument_list|,
name|rsvp_com_header
operator|->
name|msg_type
argument_list|)
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* ok they seem to want to know everything - lets fully decode it */
name|tlen
operator|=
name|EXTRACT_16BITS
argument_list|(
name|rsvp_com_header
operator|->
name|length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\tRSVPv%u %s Message (%u), Flags: [%s], length: %u, ttl: %u, checksum: 0x%04x"
argument_list|,
name|RSVP_EXTRACT_VERSION
argument_list|(
name|rsvp_com_header
operator|->
name|version_flags
argument_list|)
argument_list|,
name|tok2str
argument_list|(
name|rsvp_msg_type_values
argument_list|,
literal|"unknown, type: %u"
argument_list|,
name|rsvp_com_header
operator|->
name|msg_type
argument_list|)
argument_list|,
name|rsvp_com_header
operator|->
name|msg_type
argument_list|,
name|bittok2str
argument_list|(
name|rsvp_header_flag_values
argument_list|,
literal|"none"
argument_list|,
name|RSVP_EXTRACT_FLAGS
argument_list|(
name|rsvp_com_header
operator|->
name|version_flags
argument_list|)
argument_list|)
argument_list|,
name|tlen
argument_list|,
name|rsvp_com_header
operator|->
name|ttl
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|rsvp_com_header
operator|->
name|checksum
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|tlen
operator|<
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|rsvp_common_header
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"ERROR: common header too short %u< %lu"
argument_list|,
name|tlen
argument_list|,
operator|(
name|unsigned
name|long
operator|)
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|rsvp_common_header
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|tptr
operator|+=
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|rsvp_common_header
argument_list|)
expr_stmt|;
name|tlen
operator|-=
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|rsvp_common_header
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|rsvp_com_header
operator|->
name|msg_type
condition|)
block|{
case|case
name|RSVP_MSGTYPE_AGGREGATE
case|:
while|while
condition|(
name|tlen
operator|>
literal|0
condition|)
block|{
name|subtptr
operator|=
name|tptr
expr_stmt|;
name|rsvp_com_header
operator|=
operator|(
specifier|const
expr|struct
name|rsvp_common_header
operator|*
operator|)
name|subtptr
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|rsvp_com_header
argument_list|)
expr_stmt|;
comment|/*              * Sanity checking of the header.              */
if|if
condition|(
name|RSVP_EXTRACT_VERSION
argument_list|(
name|rsvp_com_header
operator|->
name|version_flags
argument_list|)
operator|!=
name|RSVP_VERSION
condition|)
block|{
name|printf
argument_list|(
literal|"ERROR: RSVP version %u packet not supported"
argument_list|,
name|RSVP_EXTRACT_VERSION
argument_list|(
name|rsvp_com_header
operator|->
name|version_flags
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|subtlen
operator|=
name|EXTRACT_16BITS
argument_list|(
name|rsvp_com_header
operator|->
name|length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  RSVPv%u %s Message (%u), Flags: [%s], length: %u, ttl: %u, checksum: 0x%04x"
argument_list|,
name|RSVP_EXTRACT_VERSION
argument_list|(
name|rsvp_com_header
operator|->
name|version_flags
argument_list|)
argument_list|,
name|tok2str
argument_list|(
name|rsvp_msg_type_values
argument_list|,
literal|"unknown, type: %u"
argument_list|,
name|rsvp_com_header
operator|->
name|msg_type
argument_list|)
argument_list|,
name|rsvp_com_header
operator|->
name|msg_type
argument_list|,
name|bittok2str
argument_list|(
name|rsvp_header_flag_values
argument_list|,
literal|"none"
argument_list|,
name|RSVP_EXTRACT_FLAGS
argument_list|(
name|rsvp_com_header
operator|->
name|version_flags
argument_list|)
argument_list|)
argument_list|,
name|subtlen
argument_list|,
name|rsvp_com_header
operator|->
name|ttl
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|rsvp_com_header
operator|->
name|checksum
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|subtlen
operator|<
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|rsvp_common_header
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"ERROR: common header too short %u< %lu"
argument_list|,
name|subtlen
argument_list|,
operator|(
name|unsigned
name|long
operator|)
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|rsvp_common_header
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|tlen
operator|<
name|subtlen
condition|)
block|{
name|printf
argument_list|(
literal|"ERROR: common header too large %u> %u"
argument_list|,
name|subtlen
argument_list|,
name|tlen
argument_list|)
expr_stmt|;
return|return;
block|}
name|subtptr
operator|+=
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|rsvp_common_header
argument_list|)
expr_stmt|;
name|subtlen
operator|-=
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|rsvp_common_header
argument_list|)
expr_stmt|;
if|if
condition|(
name|rsvp_obj_print
argument_list|(
name|subtptr
argument_list|,
literal|"\n\t    "
argument_list|,
name|subtlen
argument_list|)
operator|==
operator|-
literal|1
condition|)
return|return;
name|tptr
operator|+=
name|subtlen
operator|+
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|rsvp_common_header
argument_list|)
expr_stmt|;
name|tlen
operator|-=
name|subtlen
operator|+
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|rsvp_common_header
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|RSVP_MSGTYPE_PATH
case|:
case|case
name|RSVP_MSGTYPE_RESV
case|:
case|case
name|RSVP_MSGTYPE_PATHERR
case|:
case|case
name|RSVP_MSGTYPE_RESVERR
case|:
case|case
name|RSVP_MSGTYPE_PATHTEAR
case|:
case|case
name|RSVP_MSGTYPE_RESVTEAR
case|:
case|case
name|RSVP_MSGTYPE_RESVCONF
case|:
case|case
name|RSVP_MSGTYPE_HELLO_OLD
case|:
case|case
name|RSVP_MSGTYPE_HELLO
case|:
case|case
name|RSVP_MSGTYPE_ACK
case|:
case|case
name|RSVP_MSGTYPE_SREFRESH
case|:
if|if
condition|(
name|rsvp_obj_print
argument_list|(
name|tptr
argument_list|,
literal|"\n\t  "
argument_list|,
name|tlen
argument_list|)
operator|==
operator|-
literal|1
condition|)
return|return;
break|break;
default|default:
name|print_unknown_data
argument_list|(
name|tptr
argument_list|,
literal|"\n\t    "
argument_list|,
name|tlen
argument_list|)
expr_stmt|;
break|break;
block|}
return|return;
name|trunc
label|:
name|printf
argument_list|(
literal|"\n\t\t packet exceeded snapshot"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

