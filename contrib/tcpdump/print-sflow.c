begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1998-2007 The TCPDUMP project  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code  * distributions retain the above copyright notice and this paragraph  * in its entirety, and (2) distributions including binary code include  * the above copyright notice and this paragraph in its entirety in  * the documentation or other materials provided with the distribution.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND  * WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT  * LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS  * FOR A PARTICULAR PURPOSE.  *  * The SFLOW protocol as per http://www.sflow.org/developers/specifications.php  *  * Original code by Carles Kishimoto<carles.kishimoto@gmail.com>  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
name|_U_
init|=
literal|"@(#) $Header: /tcpdump/master/tcpdump/print-sflow.c,v 1.1 2007-08-08 17:20:58 hannes Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<tcpdump-stdinc.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_comment
comment|/*   * sFlow datagram  *   * 0                   1                   2                   3  * 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                     Sflow version (2,4,5)                     |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |               IP version (1 for IPv4 | 2 for IPv6)            |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                     IP Address AGENT (4 or 16 bytes)          |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                          Sub agent ID                         |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                      Datagram sequence number                 |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                      Switch uptime in ms                      |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                    num samples in datagram                    |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  *   */
end_comment

begin_struct
struct|struct
name|sflow_datagram_t
block|{
name|u_int8_t
name|version
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ip_version
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|agent
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|agent_id
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|seqnum
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|uptime
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|samples
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|sflow_sample_header
block|{
name|u_int8_t
name|format
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|len
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|SFLOW_FLOW_SAMPLE
value|1
end_define

begin_define
define|#
directive|define
name|SFLOW_COUNTER_SAMPLE
value|2
end_define

begin_define
define|#
directive|define
name|SFLOW_EXPANDED_FLOW_SAMPLE
value|3
end_define

begin_define
define|#
directive|define
name|SFLOW_EXPANDED_COUNTER_SAMPLE
value|4
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|sflow_format_values
index|[]
init|=
block|{
block|{
name|SFLOW_FLOW_SAMPLE
block|,
literal|"flow sample"
block|}
block|,
block|{
name|SFLOW_COUNTER_SAMPLE
block|,
literal|"counter sample"
block|}
block|,
block|{
name|SFLOW_EXPANDED_FLOW_SAMPLE
block|,
literal|"expanded flow sample"
block|}
block|,
block|{
name|SFLOW_EXPANDED_COUNTER_SAMPLE
block|,
literal|"expanded counter sample"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|sflow_expanded_flow_sample_t
block|{
name|u_int8_t
name|seqnum
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|type
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|index
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|rate
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|pool
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|drops
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|in_interface_format
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|in_interface_value
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|out_interface_format
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|out_interface_value
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|records
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|SFLOW_FLOW_RAW_PACKET
value|1
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_ETHERNET_FRAME
value|2
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_IPV4_DATA
value|3
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_IPV6_DATA
value|4
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_SWITCH_DATA
value|1001
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_ROUTER_DATA
value|1002
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_GATEWAY_DATA
value|1003
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_USER_DATA
value|1004
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_URL_DATA
value|1005
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_MPLS_DATA
value|1006
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_NAT_DATA
value|1007
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_MPLS_TUNNEL
value|1008
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_MPLS_VC
value|1009
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_MPLS_FEC
value|1010
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_MPLS_LVP_FEC
value|1011
end_define

begin_define
define|#
directive|define
name|SFLOW_FLOW_EXTENDED_VLAN_TUNNEL
value|1012
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|sflow_flow_type_values
index|[]
init|=
block|{
block|{
name|SFLOW_FLOW_RAW_PACKET
block|,
literal|"Raw packet"
block|}
block|,
block|{
name|SFLOW_FLOW_ETHERNET_FRAME
block|,
literal|"Ethernet frame"
block|}
block|,
block|{
name|SFLOW_FLOW_IPV4_DATA
block|,
literal|"IPv4 Data"
block|}
block|,
block|{
name|SFLOW_FLOW_IPV6_DATA
block|,
literal|"IPv6 Data"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_SWITCH_DATA
block|,
literal|"Extended Switch data"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_ROUTER_DATA
block|,
literal|"Extended Router data"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_GATEWAY_DATA
block|,
literal|"Extended Gateway data"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_USER_DATA
block|,
literal|"Extended User data"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_URL_DATA
block|,
literal|"Extended URL data"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_MPLS_DATA
block|,
literal|"Extended MPLS data"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_NAT_DATA
block|,
literal|"Extended NAT data"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_MPLS_TUNNEL
block|,
literal|"Extended MPLS tunnel"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_MPLS_VC
block|,
literal|"Extended MPLS VC"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_MPLS_FEC
block|,
literal|"Extended MPLS FEC"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_MPLS_LVP_FEC
block|,
literal|"Extended MPLS LVP FEC"
block|}
block|,
block|{
name|SFLOW_FLOW_EXTENDED_VLAN_TUNNEL
block|,
literal|"Extended VLAN Tunnel"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|SFLOW_HEADER_PROTOCOL_ETHERNET
value|1
end_define

begin_define
define|#
directive|define
name|SFLOW_HEADER_PROTOCOL_IPV4
value|11
end_define

begin_define
define|#
directive|define
name|SFLOW_HEADER_PROTOCOL_IPV6
value|12
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|sflow_flow_raw_protocol_values
index|[]
init|=
block|{
block|{
name|SFLOW_HEADER_PROTOCOL_ETHERNET
block|,
literal|"Ethernet"
block|}
block|,
block|{
name|SFLOW_HEADER_PROTOCOL_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
name|SFLOW_HEADER_PROTOCOL_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|sflow_expanded_flow_raw_t
block|{
name|u_int8_t
name|protocol
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|stripped_bytes
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|header_size
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|sflow_expanded_counter_sample_t
block|{
name|u_int8_t
name|seqnum
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|type
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|index
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|records
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|SFLOW_COUNTER_GENERIC
value|1
end_define

begin_define
define|#
directive|define
name|SFLOW_COUNTER_ETHERNET
value|2
end_define

begin_define
define|#
directive|define
name|SFLOW_COUNTER_TOKEN_RING
value|3
end_define

begin_define
define|#
directive|define
name|SFLOW_COUNTER_BASEVG
value|4
end_define

begin_define
define|#
directive|define
name|SFLOW_COUNTER_VLAN
value|5
end_define

begin_define
define|#
directive|define
name|SFLOW_COUNTER_PROCESSOR
value|1001
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|sflow_counter_type_values
index|[]
init|=
block|{
block|{
name|SFLOW_COUNTER_GENERIC
block|,
literal|"Generic counter"
block|}
block|,
block|{
name|SFLOW_COUNTER_ETHERNET
block|,
literal|"Ethernet counter"
block|}
block|,
block|{
name|SFLOW_COUNTER_TOKEN_RING
block|,
literal|"Token ring counter"
block|}
block|,
block|{
name|SFLOW_COUNTER_BASEVG
block|,
literal|"100 BaseVG counter"
block|}
block|,
block|{
name|SFLOW_COUNTER_VLAN
block|,
literal|"Vlan counter"
block|}
block|,
block|{
name|SFLOW_COUNTER_PROCESSOR
block|,
literal|"Processor counter"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|SFLOW_IFACE_DIRECTION_UNKNOWN
value|0
end_define

begin_define
define|#
directive|define
name|SFLOW_IFACE_DIRECTION_FULLDUPLEX
value|1
end_define

begin_define
define|#
directive|define
name|SFLOW_IFACE_DIRECTION_HALFDUPLEX
value|2
end_define

begin_define
define|#
directive|define
name|SFLOW_IFACE_DIRECTION_IN
value|3
end_define

begin_define
define|#
directive|define
name|SFLOW_IFACE_DIRECTION_OUT
value|4
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|sflow_iface_direction_values
index|[]
init|=
block|{
block|{
name|SFLOW_IFACE_DIRECTION_UNKNOWN
block|,
literal|"unknown"
block|}
block|,
block|{
name|SFLOW_IFACE_DIRECTION_FULLDUPLEX
block|,
literal|"full-duplex"
block|}
block|,
block|{
name|SFLOW_IFACE_DIRECTION_HALFDUPLEX
block|,
literal|"half-duplex"
block|}
block|,
block|{
name|SFLOW_IFACE_DIRECTION_IN
block|,
literal|"in"
block|}
block|,
block|{
name|SFLOW_IFACE_DIRECTION_OUT
block|,
literal|"out"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|sflow_generic_counter_t
block|{
name|u_int8_t
name|ifindex
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|iftype
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifspeed
index|[
literal|8
index|]
decl_stmt|;
name|u_int8_t
name|ifdirection
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifstatus
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifinoctets
index|[
literal|8
index|]
decl_stmt|;
name|u_int8_t
name|ifinunicastpkts
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifinmulticastpkts
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifinbroadcastpkts
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifindiscards
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifinerrors
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifinunkownprotos
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifoutoctets
index|[
literal|8
index|]
decl_stmt|;
name|u_int8_t
name|ifoutunicastpkts
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifoutmulticastpkts
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifoutbroadcastpkts
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifoutdiscards
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifouterrors
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ifpromiscmode
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|sflow_ethernet_counter_t
block|{
name|u_int8_t
name|alignerrors
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|fcserrors
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|single_collision_frames
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|multiple_collision_frames
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|test_errors
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|deferred_transmissions
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|late_collisions
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|excessive_collisions
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|mac_transmit_errors
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|carrier_sense_errors
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|frame_too_longs
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|mac_receive_errors
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|symbol_errors
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|sflow_100basevg_counter_t
block|{
name|u_int8_t
name|in_highpriority_frames
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|in_highpriority_octets
index|[
literal|8
index|]
decl_stmt|;
name|u_int8_t
name|in_normpriority_frames
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|in_normpriority_octets
index|[
literal|8
index|]
decl_stmt|;
name|u_int8_t
name|in_ipmerrors
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|in_oversized
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|in_data_errors
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|in_null_addressed_frames
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|out_highpriority_frames
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|out_highpriority_octets
index|[
literal|8
index|]
decl_stmt|;
name|u_int8_t
name|transitioninto_frames
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|hc_in_highpriority_octets
index|[
literal|8
index|]
decl_stmt|;
name|u_int8_t
name|hc_in_normpriority_octets
index|[
literal|8
index|]
decl_stmt|;
name|u_int8_t
name|hc_out_highpriority_octets
index|[
literal|8
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|sflow_vlan_counter_t
block|{
name|u_int8_t
name|vlan_id
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|octets
index|[
literal|8
index|]
decl_stmt|;
name|u_int8_t
name|unicast_pkt
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|multicast_pkt
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|broadcast_pkt
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|discards
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|void
name|sflow_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|pptr
parameter_list|,
name|u_int
name|len
parameter_list|)
block|{
specifier|const
name|struct
name|sflow_datagram_t
modifier|*
name|sflow_datagram
decl_stmt|;
specifier|const
name|struct
name|sflow_sample_header
modifier|*
name|sflow_sample
decl_stmt|;
specifier|const
name|struct
name|sflow_expanded_flow_sample_t
modifier|*
name|sflow_expanded_flow_sample
decl_stmt|;
specifier|const
name|struct
name|sflow_expanded_flow_raw_t
modifier|*
name|sflow_flow_raw
decl_stmt|;
specifier|const
name|struct
name|sflow_expanded_counter_sample_t
modifier|*
name|sflow_expanded_counter_sample
decl_stmt|;
specifier|const
name|struct
name|sflow_generic_counter_t
modifier|*
name|sflow_gen_counter
decl_stmt|;
specifier|const
name|struct
name|sflow_ethernet_counter_t
modifier|*
name|sflow_eth_counter
decl_stmt|;
specifier|const
name|struct
name|sflow_100basevg_counter_t
modifier|*
name|sflow_100basevg_counter
decl_stmt|;
specifier|const
name|struct
name|sflow_vlan_counter_t
modifier|*
name|sflow_vlan_counter
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|tptr
decl_stmt|;
name|int
name|tlen
decl_stmt|;
name|u_int32_t
name|sflow_sample_type
decl_stmt|,
name|sflow_sample_len
decl_stmt|;
name|int
name|nsamples
decl_stmt|,
name|nrecords
decl_stmt|,
name|counter_len
decl_stmt|,
name|counter_type
decl_stmt|,
name|flow_len
decl_stmt|,
name|flow_type
decl_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
name|tlen
operator|=
name|len
expr_stmt|;
name|sflow_datagram
operator|=
operator|(
specifier|const
expr|struct
name|sflow_datagram_t
operator|*
operator|)
name|pptr
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|sflow_datagram
argument_list|)
expr_stmt|;
comment|/*      * Sanity checking of the header.      */
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|sflow_datagram
operator|->
name|version
argument_list|)
operator|!=
literal|5
condition|)
block|{
name|printf
argument_list|(
literal|"sFlow version %u packet not supported"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_datagram
operator|->
name|version
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vflag
operator|<
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"sFlowv%u, %s agent %s, agent-id %u, length %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_datagram
operator|->
name|version
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_datagram
operator|->
name|ip_version
argument_list|)
operator|==
literal|1
condition|?
literal|"IPv4"
else|:
literal|"IPv6"
argument_list|,
name|ipaddr_string
argument_list|(
name|sflow_datagram
operator|->
name|agent
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_datagram
operator|->
name|samples
argument_list|)
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* ok they seem to want to know everything - lets fully decode it */
name|nsamples
operator|=
name|EXTRACT_32BITS
argument_list|(
name|sflow_datagram
operator|->
name|samples
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"sFlowv%u, %s agent %s, agent-id %u, seqnum %u, uptime %u, samples %u, length %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_datagram
operator|->
name|version
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_datagram
operator|->
name|ip_version
argument_list|)
operator|==
literal|1
condition|?
literal|"IPv4"
else|:
literal|"IPv6"
argument_list|,
name|ipaddr_string
argument_list|(
name|sflow_datagram
operator|->
name|agent
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_datagram
operator|->
name|agent_id
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_datagram
operator|->
name|seqnum
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_datagram
operator|->
name|uptime
argument_list|)
argument_list|,
name|nsamples
argument_list|,
name|len
argument_list|)
expr_stmt|;
comment|/* skip Common header */
name|tptr
operator|+=
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|sflow_datagram_t
argument_list|)
expr_stmt|;
name|tlen
operator|-=
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|sflow_datagram_t
argument_list|)
expr_stmt|;
while|while
condition|(
name|nsamples
operator|>
literal|0
operator|&&
name|tlen
operator|>
literal|0
condition|)
block|{
name|sflow_sample
operator|=
operator|(
specifier|const
expr|struct
name|sflow_sample_header
operator|*
operator|)
name|tptr
expr_stmt|;
name|sflow_sample_type
operator|=
operator|(
name|EXTRACT_32BITS
argument_list|(
name|sflow_sample
operator|->
name|format
argument_list|)
operator|&
literal|0x0FFF
operator|)
expr_stmt|;
name|sflow_sample_len
operator|=
name|EXTRACT_32BITS
argument_list|(
name|sflow_sample
operator|->
name|len
argument_list|)
expr_stmt|;
name|tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|sflow_sample_header
argument_list|)
expr_stmt|;
name|tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|sflow_sample_header
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t%s (%u), length %u,"
argument_list|,
name|tok2str
argument_list|(
name|sflow_format_values
argument_list|,
literal|"Unknown"
argument_list|,
name|sflow_sample_type
argument_list|)
argument_list|,
name|sflow_sample_type
argument_list|,
name|sflow_sample_len
argument_list|)
expr_stmt|;
comment|/* basic sanity check */
if|if
condition|(
name|sflow_sample_type
operator|==
literal|0
operator|||
name|sflow_sample_len
operator|==
literal|0
condition|)
block|{
return|return;
block|}
comment|/* did we capture enough for fully decoding the sample ? */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|sflow_sample_len
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
switch|switch
condition|(
name|sflow_sample_type
condition|)
block|{
case|case
name|SFLOW_FLOW_SAMPLE
case|:
comment|/* XXX */
break|break;
case|case
name|SFLOW_COUNTER_SAMPLE
case|:
comment|/* XXX */
break|break;
case|case
name|SFLOW_EXPANDED_FLOW_SAMPLE
case|:
name|sflow_expanded_flow_sample
operator|=
operator|(
specifier|const
expr|struct
name|sflow_expanded_flow_sample_t
operator|*
operator|)
name|tptr
expr_stmt|;
name|nrecords
operator|=
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_flow_sample
operator|->
name|records
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" seqnum %u, type %u, idx %u, rate %u, pool %u, drops %u, records %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_flow_sample
operator|->
name|seqnum
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_flow_sample
operator|->
name|type
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_flow_sample
operator|->
name|index
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_flow_sample
operator|->
name|rate
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_flow_sample
operator|->
name|pool
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_flow_sample
operator|->
name|drops
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_flow_sample
operator|->
name|records
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|sflow_expanded_flow_sample_t
argument_list|)
expr_stmt|;
name|tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|sflow_expanded_flow_sample_t
argument_list|)
expr_stmt|;
while|while
condition|(
name|nrecords
operator|>
literal|0
operator|&&
name|tlen
operator|>
literal|0
condition|)
block|{
comment|/* decode Flow record - 2 bytes */
name|flow_type
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
operator|&
literal|0x0FFF
expr_stmt|;
name|flow_len
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  %s (%u) length %u"
argument_list|,
name|tok2str
argument_list|(
name|sflow_flow_type_values
argument_list|,
literal|"Unknown"
argument_list|,
name|flow_type
argument_list|)
argument_list|,
name|flow_type
argument_list|,
name|flow_len
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|8
expr_stmt|;
name|tlen
operator|-=
literal|8
expr_stmt|;
comment|/* did we capture enough for fully decoding the flow ? */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|flow_len
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
switch|switch
condition|(
name|flow_type
condition|)
block|{
case|case
name|SFLOW_FLOW_RAW_PACKET
case|:
name|sflow_flow_raw
operator|=
operator|(
specifier|const
expr|struct
name|sflow_expanded_flow_raw_t
operator|*
operator|)
name|tptr
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    protocol %s (%u), length %u, stripped bytes %u, header_size %u"
argument_list|,
name|tok2str
argument_list|(
name|sflow_flow_raw_protocol_values
argument_list|,
literal|"Unknown"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_flow_raw
operator|->
name|protocol
argument_list|)
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_flow_raw
operator|->
name|protocol
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_flow_raw
operator|->
name|length
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_flow_raw
operator|->
name|stripped_bytes
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_flow_raw
operator|->
name|header_size
argument_list|)
argument_list|)
expr_stmt|;
break|break;
comment|/*                      * FIXME those are the defined flow types that lack a decoder                      */
case|case
name|SFLOW_FLOW_ETHERNET_FRAME
case|:
case|case
name|SFLOW_FLOW_IPV4_DATA
case|:
case|case
name|SFLOW_FLOW_IPV6_DATA
case|:
case|case
name|SFLOW_FLOW_EXTENDED_SWITCH_DATA
case|:
case|case
name|SFLOW_FLOW_EXTENDED_ROUTER_DATA
case|:
case|case
name|SFLOW_FLOW_EXTENDED_GATEWAY_DATA
case|:
case|case
name|SFLOW_FLOW_EXTENDED_USER_DATA
case|:
case|case
name|SFLOW_FLOW_EXTENDED_URL_DATA
case|:
case|case
name|SFLOW_FLOW_EXTENDED_MPLS_DATA
case|:
case|case
name|SFLOW_FLOW_EXTENDED_NAT_DATA
case|:
case|case
name|SFLOW_FLOW_EXTENDED_MPLS_TUNNEL
case|:
case|case
name|SFLOW_FLOW_EXTENDED_MPLS_VC
case|:
case|case
name|SFLOW_FLOW_EXTENDED_MPLS_FEC
case|:
case|case
name|SFLOW_FLOW_EXTENDED_MPLS_LVP_FEC
case|:
case|case
name|SFLOW_FLOW_EXTENDED_VLAN_TUNNEL
case|:
break|break;
default|default:
if|if
condition|(
name|vflag
operator|<=
literal|1
condition|)
name|print_unknown_data
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|,
name|flow_len
argument_list|)
expr_stmt|;
break|break;
block|}
name|tptr
operator|+=
name|flow_len
expr_stmt|;
name|tlen
operator|-=
name|flow_len
expr_stmt|;
name|nrecords
operator|--
expr_stmt|;
block|}
break|break;
case|case
name|SFLOW_EXPANDED_COUNTER_SAMPLE
case|:
name|sflow_expanded_counter_sample
operator|=
operator|(
specifier|const
expr|struct
name|sflow_expanded_counter_sample_t
operator|*
operator|)
name|tptr
expr_stmt|;
name|nrecords
operator|=
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_counter_sample
operator|->
name|records
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" seqnum %u, type %u, idx %u, records %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_counter_sample
operator|->
name|seqnum
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_counter_sample
operator|->
name|type
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_expanded_counter_sample
operator|->
name|index
argument_list|)
argument_list|,
name|nrecords
argument_list|)
expr_stmt|;
name|tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|sflow_expanded_counter_sample_t
argument_list|)
expr_stmt|;
name|tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|sflow_expanded_counter_sample_t
argument_list|)
expr_stmt|;
while|while
condition|(
name|nrecords
operator|>
literal|0
operator|&&
name|tlen
operator|>
literal|0
condition|)
block|{
comment|/* decode counter record - 2 bytes */
name|counter_type
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
operator|&
literal|0x0FFF
expr_stmt|;
name|counter_len
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    %s (%u) length %u"
argument_list|,
name|tok2str
argument_list|(
name|sflow_counter_type_values
argument_list|,
literal|"Unknown"
argument_list|,
name|counter_type
argument_list|)
argument_list|,
name|counter_type
argument_list|,
name|counter_len
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|8
expr_stmt|;
name|tlen
operator|-=
literal|8
expr_stmt|;
comment|/* did we capture enough for fully decoding the counter ? */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|counter_len
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
switch|switch
condition|(
name|counter_type
condition|)
block|{
case|case
name|SFLOW_COUNTER_GENERIC
case|:
name|sflow_gen_counter
operator|=
operator|(
specifier|const
expr|struct
name|sflow_generic_counter_t
operator|*
operator|)
name|tptr
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      ifindex %u, iftype %u, ifspeed %u, ifdirection %u (%s)"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifindex
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|iftype
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifspeed
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifdirection
argument_list|)
argument_list|,
name|tok2str
argument_list|(
name|sflow_iface_direction_values
argument_list|,
literal|"Unknown"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifdirection
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      ifstatus %u, adminstatus: %s, operstatus: %s"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifstatus
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifstatus
argument_list|)
operator|&
literal|1
condition|?
literal|"up"
else|:
literal|"down"
argument_list|,
operator|(
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifstatus
argument_list|)
operator|>>
literal|1
operator|)
operator|&
literal|1
condition|?
literal|"up"
else|:
literal|"down"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      In octets %"
name|PRIu64
literal|", unicast pkts %u, multicast pkts %u, broadcast pkts %u, discards %u"
argument_list|,
name|EXTRACT_64BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifinoctets
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifinunicastpkts
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifinmulticastpkts
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifinbroadcastpkts
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifindiscards
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      In errors %u, unknown protos %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifinerrors
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifinunkownprotos
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      Out octets %"
name|PRIu64
literal|", unicast pkts %u, multicast pkts %u, broadcast pkts %u, discards %u"
argument_list|,
name|EXTRACT_64BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifoutoctets
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifoutunicastpkts
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifoutmulticastpkts
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifoutbroadcastpkts
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifoutdiscards
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      Out errors %u, promisc mode %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifouterrors
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_gen_counter
operator|->
name|ifpromiscmode
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SFLOW_COUNTER_ETHERNET
case|:
name|sflow_eth_counter
operator|=
operator|(
specifier|const
expr|struct
name|sflow_ethernet_counter_t
operator|*
operator|)
name|tptr
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      align errors %u, fcs errors %u, single collision %u, multiple collision %u, test error %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|alignerrors
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|fcserrors
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|single_collision_frames
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|multiple_collision_frames
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|test_errors
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      deferred %u, late collision %u, excessive collision %u, mac trans error %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|deferred_transmissions
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|late_collisions
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|excessive_collisions
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|mac_transmit_errors
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      carrier error %u, frames too long %u, mac receive errors %u, symbol errors %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|carrier_sense_errors
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|frame_too_longs
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|mac_receive_errors
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_eth_counter
operator|->
name|symbol_errors
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SFLOW_COUNTER_TOKEN_RING
case|:
comment|/* XXX */
break|break;
case|case
name|SFLOW_COUNTER_BASEVG
case|:
name|sflow_100basevg_counter
operator|=
operator|(
specifier|const
expr|struct
name|sflow_100basevg_counter_t
operator|*
operator|)
name|tptr
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      in high prio frames %u, in high prio octets %"
name|PRIu64
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|in_highpriority_frames
argument_list|)
argument_list|,
name|EXTRACT_64BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|in_highpriority_octets
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      in norm prio frames %u, in norm prio octets %"
name|PRIu64
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|in_normpriority_frames
argument_list|)
argument_list|,
name|EXTRACT_64BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|in_normpriority_octets
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      in ipm errors %u, oversized %u, in data errors %u, null addressed frames %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|in_ipmerrors
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|in_oversized
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|in_data_errors
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|in_null_addressed_frames
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      out high prio frames %u, out high prio octets %"
name|PRIu64
literal|", trans into frames %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|out_highpriority_frames
argument_list|)
argument_list|,
name|EXTRACT_64BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|out_highpriority_octets
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|transitioninto_frames
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      in hc high prio octets %"
name|PRIu64
literal|", in hc norm prio octets %"
name|PRIu64
literal|", out hc high prio octets %"
name|PRIu64
argument_list|,
name|EXTRACT_64BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|hc_in_highpriority_octets
argument_list|)
argument_list|,
name|EXTRACT_64BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|hc_in_normpriority_octets
argument_list|)
argument_list|,
name|EXTRACT_64BITS
argument_list|(
name|sflow_100basevg_counter
operator|->
name|hc_out_highpriority_octets
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SFLOW_COUNTER_VLAN
case|:
name|sflow_vlan_counter
operator|=
operator|(
specifier|const
expr|struct
name|sflow_vlan_counter_t
operator|*
operator|)
name|tptr
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      vlan_id %u, octets %"
name|PRIu64
literal|", unicast_pkt %u, multicast_pkt %u, broadcast_pkt %u, discards %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_vlan_counter
operator|->
name|vlan_id
argument_list|)
argument_list|,
name|EXTRACT_64BITS
argument_list|(
name|sflow_vlan_counter
operator|->
name|octets
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_vlan_counter
operator|->
name|unicast_pkt
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_vlan_counter
operator|->
name|multicast_pkt
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_vlan_counter
operator|->
name|broadcast_pkt
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|sflow_vlan_counter
operator|->
name|discards
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SFLOW_COUNTER_PROCESSOR
case|:
comment|/* XXX */
break|break;
default|default:
if|if
condition|(
name|vflag
operator|<=
literal|1
condition|)
name|print_unknown_data
argument_list|(
name|tptr
argument_list|,
literal|"\n\t\t"
argument_list|,
name|counter_len
argument_list|)
expr_stmt|;
break|break;
block|}
name|tptr
operator|+=
name|counter_len
expr_stmt|;
name|tlen
operator|-=
name|counter_len
expr_stmt|;
name|nrecords
operator|--
expr_stmt|;
block|}
break|break;
default|default:
if|if
condition|(
name|vflag
operator|<=
literal|1
condition|)
name|print_unknown_data
argument_list|(
name|tptr
argument_list|,
literal|"\n\t    "
argument_list|,
name|sflow_sample_len
argument_list|)
expr_stmt|;
break|break;
block|}
name|tptr
operator|+=
name|sflow_sample_len
expr_stmt|;
name|tlen
operator|-=
name|sflow_sample_len
expr_stmt|;
name|nsamples
operator|--
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|printf
argument_list|(
literal|"[|SFLOW]"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Local Variables:  * c-style: whitesmith  * c-basic-offset: 4  * End:  */
end_comment

end_unit

