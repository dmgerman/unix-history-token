begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1998-2007 The TCPDUMP project  * Copyright (c) 2009  Florian Forster  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code  * distributions retain the above copyright notice and this paragraph  * in its entirety, and (2) distributions including binary code include  * the above copyright notice and this paragraph in its entirety in  * the documentation or other materials provided with the distribution.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND  * WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT  * LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS  * FOR A PARTICULAR PURPOSE.  *  * Original code by Hannes Gredler<hannes@juniper.net>  * IPv6 additions by Florian Forster<octo at verplant.org>  */
end_comment

begin_comment
comment|/* \summary: Optimized Link State Routing Protocol (OLSR) printer */
end_comment

begin_comment
comment|/* specification: RFC 3626 */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<netdissect-stdinc.h>
end_include

begin_include
include|#
directive|include
file|"netdissect.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_comment
comment|/*  * RFC 3626 common header  *  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |         Packet Length         |    Packet Sequence Number     |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |  Message Type |     Vtime     |         Message Size          |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                      Originator Address                       |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |  Time To Live |   Hop Count   |    Message Sequence Number    |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                                                               |  * :                            MESSAGE                            :  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |  Message Type |     Vtime     |         Message Size          |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                      Originator Address                       |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |  Time To Live |   Hop Count   |    Message Sequence Number    |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                                                               |  * :                            MESSAGE                            :  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * :                                                               :  */
end_comment

begin_struct
struct|struct
name|olsr_common
block|{
name|uint8_t
name|packet_len
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|packet_seq
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|OLSR_HELLO_MSG
value|1
end_define

begin_comment
comment|/* rfc3626 */
end_comment

begin_define
define|#
directive|define
name|OLSR_TC_MSG
value|2
end_define

begin_comment
comment|/* rfc3626 */
end_comment

begin_define
define|#
directive|define
name|OLSR_MID_MSG
value|3
end_define

begin_comment
comment|/* rfc3626 */
end_comment

begin_define
define|#
directive|define
name|OLSR_HNA_MSG
value|4
end_define

begin_comment
comment|/* rfc3626 */
end_comment

begin_define
define|#
directive|define
name|OLSR_POWERINFO_MSG
value|128
end_define

begin_define
define|#
directive|define
name|OLSR_NAMESERVICE_MSG
value|130
end_define

begin_define
define|#
directive|define
name|OLSR_HELLO_LQ_MSG
value|201
end_define

begin_comment
comment|/* LQ extensions olsr.org */
end_comment

begin_define
define|#
directive|define
name|OLSR_TC_LQ_MSG
value|202
end_define

begin_comment
comment|/* LQ extensions olsr.org */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|olsr_msg_values
index|[]
init|=
block|{
block|{
name|OLSR_HELLO_MSG
block|,
literal|"Hello"
block|}
block|,
block|{
name|OLSR_TC_MSG
block|,
literal|"TC"
block|}
block|,
block|{
name|OLSR_MID_MSG
block|,
literal|"MID"
block|}
block|,
block|{
name|OLSR_HNA_MSG
block|,
literal|"HNA"
block|}
block|,
block|{
name|OLSR_POWERINFO_MSG
block|,
literal|"Powerinfo"
block|}
block|,
block|{
name|OLSR_NAMESERVICE_MSG
block|,
literal|"Nameservice"
block|}
block|,
block|{
name|OLSR_HELLO_LQ_MSG
block|,
literal|"Hello-LQ"
block|}
block|,
block|{
name|OLSR_TC_LQ_MSG
block|,
literal|"TC-LQ"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|olsr_msg4
block|{
name|uint8_t
name|msg_type
decl_stmt|;
name|uint8_t
name|vtime
decl_stmt|;
name|uint8_t
name|msg_len
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|originator
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|ttl
decl_stmt|;
name|uint8_t
name|hopcount
decl_stmt|;
name|uint8_t
name|msg_seq
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|olsr_msg6
block|{
name|uint8_t
name|msg_type
decl_stmt|;
name|uint8_t
name|vtime
decl_stmt|;
name|uint8_t
name|msg_len
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|originator
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|ttl
decl_stmt|;
name|uint8_t
name|hopcount
decl_stmt|;
name|uint8_t
name|msg_seq
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|olsr_hello
block|{
name|uint8_t
name|res
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|htime
decl_stmt|;
name|uint8_t
name|will
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|olsr_hello_link
block|{
name|uint8_t
name|link_code
decl_stmt|;
name|uint8_t
name|res
decl_stmt|;
name|uint8_t
name|len
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|olsr_tc
block|{
name|uint8_t
name|ans_seq
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|res
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|olsr_hna4
block|{
name|uint8_t
name|network
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|mask
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|olsr_hna6
block|{
name|uint8_t
name|network
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|mask
index|[
literal|16
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/** gateway HNA flags */
end_comment

begin_enum
enum|enum
name|gateway_hna_flags
block|{
name|GW_HNA_FLAG_LINKSPEED
init|=
literal|1
operator|<<
literal|0
block|,
name|GW_HNA_FLAG_IPV4
init|=
literal|1
operator|<<
literal|1
block|,
name|GW_HNA_FLAG_IPV4_NAT
init|=
literal|1
operator|<<
literal|2
block|,
name|GW_HNA_FLAG_IPV6
init|=
literal|1
operator|<<
literal|3
block|,
name|GW_HNA_FLAG_IPV6PREFIX
init|=
literal|1
operator|<<
literal|4
block|}
enum|;
end_enum

begin_comment
comment|/** gateway HNA field byte offsets in the netmask field of the HNA */
end_comment

begin_enum
enum|enum
name|gateway_hna_fields
block|{
name|GW_HNA_PAD
init|=
literal|0
block|,
name|GW_HNA_FLAGS
init|=
literal|1
block|,
name|GW_HNA_UPLINK
init|=
literal|2
block|,
name|GW_HNA_DOWNLINK
init|=
literal|3
block|,
name|GW_HNA_V6PREFIXLEN
init|=
literal|4
block|,
name|GW_HNA_V6PREFIX
init|=
literal|5
block|}
enum|;
end_enum

begin_define
define|#
directive|define
name|OLSR_EXTRACT_LINK_TYPE
parameter_list|(
name|link_code
parameter_list|)
value|(link_code& 0x3)
end_define

begin_define
define|#
directive|define
name|OLSR_EXTRACT_NEIGHBOR_TYPE
parameter_list|(
name|link_code
parameter_list|)
value|(link_code>> 2)
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|olsr_link_type_values
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"Unspecified"
block|}
block|,
block|{
literal|1
block|,
literal|"Asymmetric"
block|}
block|,
block|{
literal|2
block|,
literal|"Symmetric"
block|}
block|,
block|{
literal|3
block|,
literal|"Lost"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|olsr_neighbor_type_values
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"Not-Neighbor"
block|}
block|,
block|{
literal|1
block|,
literal|"Symmetric"
block|}
block|,
block|{
literal|2
block|,
literal|"Symmetric-MPR"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|olsr_lq_neighbor4
block|{
name|uint8_t
name|neighbor
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|link_quality
decl_stmt|;
name|uint8_t
name|neighbor_link_quality
decl_stmt|;
name|uint8_t
name|res
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|olsr_lq_neighbor6
block|{
name|uint8_t
name|neighbor
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|link_quality
decl_stmt|;
name|uint8_t
name|neighbor_link_quality
decl_stmt|;
name|uint8_t
name|res
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MAX_SMARTGW_SPEED
value|320000000
end_define

begin_comment
comment|/**  * Convert an encoded 1 byte transport value (5 bits mantissa, 3 bits exponent)  * to an uplink/downlink speed value  *  * @param value the encoded 1 byte transport value  * @return the uplink/downlink speed value (in kbit/s)  */
end_comment

begin_function
specifier|static
name|uint32_t
name|deserialize_gw_speed
parameter_list|(
name|uint8_t
name|value
parameter_list|)
block|{
name|uint32_t
name|speed
decl_stmt|;
name|uint32_t
name|exp
decl_stmt|;
if|if
condition|(
operator|!
name|value
condition|)
block|{
return|return
literal|0
return|;
block|}
if|if
condition|(
name|value
operator|==
name|UINT8_MAX
condition|)
block|{
comment|/* maximum value: also return maximum value */
return|return
name|MAX_SMARTGW_SPEED
return|;
block|}
name|speed
operator|=
operator|(
name|value
operator|>>
literal|3
operator|)
operator|+
literal|1
expr_stmt|;
name|exp
operator|=
name|value
operator|&
literal|7
expr_stmt|;
while|while
condition|(
name|exp
operator|--
operator|>
literal|0
condition|)
block|{
name|speed
operator|*=
literal|10
expr_stmt|;
block|}
return|return
name|speed
return|;
block|}
end_function

begin_comment
comment|/*  * macro to convert the 8-bit mantissa/exponent to a double float  * taken from olsr.org.  */
end_comment

begin_define
define|#
directive|define
name|VTIME_SCALE_FACTOR
value|0.0625
end_define

begin_define
define|#
directive|define
name|ME_TO_DOUBLE
parameter_list|(
name|me
parameter_list|)
define|\
value|(double)(VTIME_SCALE_FACTOR*(1+(double)(me>>4)/16)*(double)(1<<(me&0x0F)))
end_define

begin_comment
comment|/*  * print a neighbor list with LQ extensions.  */
end_comment

begin_function
specifier|static
name|int
name|olsr_print_lq_neighbor4
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|msg_data
parameter_list|,
name|u_int
name|hello_len
parameter_list|)
block|{
specifier|const
name|struct
name|olsr_lq_neighbor4
modifier|*
name|lq_neighbor
decl_stmt|;
while|while
condition|(
name|hello_len
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_lq_neighbor4
argument_list|)
condition|)
block|{
name|lq_neighbor
operator|=
operator|(
specifier|const
expr|struct
name|olsr_lq_neighbor4
operator|*
operator|)
name|msg_data
expr_stmt|;
if|if
condition|(
operator|!
name|ND_TTEST
argument_list|(
operator|*
name|lq_neighbor
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      neighbor %s, link-quality %.2f%%"
literal|", neighbor-link-quality %.2f%%"
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|lq_neighbor
operator|->
name|neighbor
argument_list|)
operator|,
operator|(
operator|(
name|double
operator|)
name|lq_neighbor
operator|->
name|link_quality
operator|/
literal|2.55
operator|)
operator|,
operator|(
operator|(
name|double
operator|)
name|lq_neighbor
operator|->
name|neighbor_link_quality
operator|/
literal|2.55
operator|)
operator|)
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_lq_neighbor4
argument_list|)
expr_stmt|;
name|hello_len
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_lq_neighbor4
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|olsr_print_lq_neighbor6
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|msg_data
parameter_list|,
name|u_int
name|hello_len
parameter_list|)
block|{
specifier|const
name|struct
name|olsr_lq_neighbor6
modifier|*
name|lq_neighbor
decl_stmt|;
while|while
condition|(
name|hello_len
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_lq_neighbor6
argument_list|)
condition|)
block|{
name|lq_neighbor
operator|=
operator|(
specifier|const
expr|struct
name|olsr_lq_neighbor6
operator|*
operator|)
name|msg_data
expr_stmt|;
if|if
condition|(
operator|!
name|ND_TTEST
argument_list|(
operator|*
name|lq_neighbor
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      neighbor %s, link-quality %.2f%%"
literal|", neighbor-link-quality %.2f%%"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|lq_neighbor
operator|->
name|neighbor
argument_list|)
operator|,
operator|(
operator|(
name|double
operator|)
name|lq_neighbor
operator|->
name|link_quality
operator|/
literal|2.55
operator|)
operator|,
operator|(
operator|(
name|double
operator|)
name|lq_neighbor
operator|->
name|neighbor_link_quality
operator|/
literal|2.55
operator|)
operator|)
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_lq_neighbor6
argument_list|)
expr_stmt|;
name|hello_len
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_lq_neighbor6
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * print a neighbor list.  */
end_comment

begin_function
specifier|static
name|int
name|olsr_print_neighbor
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|msg_data
parameter_list|,
name|u_int
name|hello_len
parameter_list|)
block|{
name|int
name|neighbor
decl_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      neighbor\n\t\t"
operator|)
argument_list|)
expr_stmt|;
name|neighbor
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|hello_len
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|ND_TTEST2
argument_list|(
operator|*
name|msg_data
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
comment|/* print 4 neighbors per line */
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s%s"
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|)
operator|,
name|neighbor
operator|%
literal|4
operator|==
literal|0
condition|?
literal|"\n\t\t"
else|:
literal|" "
operator|)
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
expr_stmt|;
name|hello_len
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
name|olsr_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|pptr
parameter_list|,
name|u_int
name|length
parameter_list|,
name|int
name|is_ipv6
parameter_list|)
block|{
union|union
block|{
specifier|const
name|struct
name|olsr_common
modifier|*
name|common
decl_stmt|;
specifier|const
name|struct
name|olsr_msg4
modifier|*
name|msg4
decl_stmt|;
specifier|const
name|struct
name|olsr_msg6
modifier|*
name|msg6
decl_stmt|;
specifier|const
name|struct
name|olsr_hello
modifier|*
name|hello
decl_stmt|;
specifier|const
name|struct
name|olsr_hello_link
modifier|*
name|hello_link
decl_stmt|;
specifier|const
name|struct
name|olsr_tc
modifier|*
name|tc
decl_stmt|;
specifier|const
name|struct
name|olsr_hna4
modifier|*
name|hna
decl_stmt|;
block|}
name|ptr
union|;
name|u_int
name|msg_type
decl_stmt|,
name|msg_len
decl_stmt|,
name|msg_tlen
decl_stmt|,
name|hello_len
decl_stmt|;
name|uint16_t
name|name_entry_type
decl_stmt|,
name|name_entry_len
decl_stmt|;
name|u_int
name|name_entry_padding
decl_stmt|;
name|uint8_t
name|link_type
decl_stmt|,
name|neighbor_type
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|tptr
decl_stmt|,
modifier|*
name|msg_data
decl_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
if|if
condition|(
name|length
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_common
argument_list|)
condition|)
block|{
goto|goto
name|trunc
goto|;
block|}
name|ND_TCHECK2
argument_list|(
operator|*
name|tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_common
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|.
name|common
operator|=
operator|(
specifier|const
expr|struct
name|olsr_common
operator|*
operator|)
name|tptr
expr_stmt|;
name|length
operator|=
name|min
argument_list|(
name|length
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
operator|.
name|common
operator|->
name|packet_len
argument_list|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"OLSRv%i, seq 0x%04x, length %u"
operator|,
operator|(
name|is_ipv6
operator|==
literal|0
operator|)
condition|?
literal|4
else|:
literal|6
operator|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
operator|.
name|common
operator|->
name|packet_seq
argument_list|)
operator|,
name|length
operator|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_common
argument_list|)
expr_stmt|;
comment|/*      * In non-verbose mode, just print version.      */
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|<
literal|1
condition|)
block|{
return|return;
block|}
while|while
condition|(
name|tptr
operator|<
operator|(
name|pptr
operator|+
name|length
operator|)
condition|)
block|{
union|union
block|{
specifier|const
name|struct
name|olsr_msg4
modifier|*
name|v4
decl_stmt|;
specifier|const
name|struct
name|olsr_msg6
modifier|*
name|v6
decl_stmt|;
block|}
name|msgptr
union|;
name|int
name|msg_len_valid
init|=
literal|0
decl_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_msg4
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|is_ipv6
condition|)
block|{
name|msgptr
operator|.
name|v6
operator|=
operator|(
specifier|const
expr|struct
name|olsr_msg6
operator|*
operator|)
name|tptr
expr_stmt|;
name|msg_type
operator|=
name|msgptr
operator|.
name|v6
operator|->
name|msg_type
expr_stmt|;
name|msg_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|msgptr
operator|.
name|v6
operator|->
name|msg_len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|msg_len
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_msg6
argument_list|)
operator|)
operator|&&
operator|(
name|msg_len
operator|<=
name|length
operator|)
condition|)
name|msg_len_valid
operator|=
literal|1
expr_stmt|;
comment|/* infinite loop check */
if|if
condition|(
name|msg_type
operator|==
literal|0
operator|||
name|msg_len
operator|==
literal|0
condition|)
block|{
return|return;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t%s Message (%#04x), originator %s, ttl %u, hop %u"
literal|"\n\t  vtime %.3fs, msg-seq 0x%04x, length %u%s"
operator|,
name|tok2str
argument_list|(
name|olsr_msg_values
argument_list|,
literal|"Unknown"
argument_list|,
name|msg_type
argument_list|)
operator|,
name|msg_type
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|msgptr
operator|.
name|v6
operator|->
name|originator
argument_list|)
operator|,
name|msgptr
operator|.
name|v6
operator|->
name|ttl
operator|,
name|msgptr
operator|.
name|v6
operator|->
name|hopcount
operator|,
name|ME_TO_DOUBLE
argument_list|(
name|msgptr
operator|.
name|v6
operator|->
name|vtime
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
name|msgptr
operator|.
name|v6
operator|->
name|msg_seq
argument_list|)
operator|,
name|msg_len
operator|,
operator|(
name|msg_len_valid
operator|==
literal|0
operator|)
condition|?
literal|" (invalid)"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|msg_len_valid
condition|)
block|{
return|return;
block|}
name|msg_tlen
operator|=
name|msg_len
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_msg6
argument_list|)
expr_stmt|;
name|msg_data
operator|=
name|tptr
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_msg6
argument_list|)
expr_stmt|;
block|}
else|else
comment|/* (!is_ipv6) */
block|{
name|msgptr
operator|.
name|v4
operator|=
operator|(
specifier|const
expr|struct
name|olsr_msg4
operator|*
operator|)
name|tptr
expr_stmt|;
name|msg_type
operator|=
name|msgptr
operator|.
name|v4
operator|->
name|msg_type
expr_stmt|;
name|msg_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|msgptr
operator|.
name|v4
operator|->
name|msg_len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|msg_len
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_msg4
argument_list|)
operator|)
operator|&&
operator|(
name|msg_len
operator|<=
name|length
operator|)
condition|)
name|msg_len_valid
operator|=
literal|1
expr_stmt|;
comment|/* infinite loop check */
if|if
condition|(
name|msg_type
operator|==
literal|0
operator|||
name|msg_len
operator|==
literal|0
condition|)
block|{
return|return;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t%s Message (%#04x), originator %s, ttl %u, hop %u"
literal|"\n\t  vtime %.3fs, msg-seq 0x%04x, length %u%s"
operator|,
name|tok2str
argument_list|(
name|olsr_msg_values
argument_list|,
literal|"Unknown"
argument_list|,
name|msg_type
argument_list|)
operator|,
name|msg_type
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|msgptr
operator|.
name|v4
operator|->
name|originator
argument_list|)
operator|,
name|msgptr
operator|.
name|v4
operator|->
name|ttl
operator|,
name|msgptr
operator|.
name|v4
operator|->
name|hopcount
operator|,
name|ME_TO_DOUBLE
argument_list|(
name|msgptr
operator|.
name|v4
operator|->
name|vtime
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
name|msgptr
operator|.
name|v4
operator|->
name|msg_seq
argument_list|)
operator|,
name|msg_len
operator|,
operator|(
name|msg_len_valid
operator|==
literal|0
operator|)
condition|?
literal|" (invalid)"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|msg_len_valid
condition|)
block|{
return|return;
block|}
name|msg_tlen
operator|=
name|msg_len
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_msg4
argument_list|)
expr_stmt|;
name|msg_data
operator|=
name|tptr
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_msg4
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|msg_type
condition|)
block|{
case|case
name|OLSR_HELLO_MSG
case|:
case|case
name|OLSR_HELLO_LQ_MSG
case|:
if|if
condition|(
name|msg_tlen
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
name|ND_TCHECK2
argument_list|(
operator|*
name|msg_data
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|.
name|hello
operator|=
operator|(
specifier|const
expr|struct
name|olsr_hello
operator|*
operator|)
name|msg_data
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  hello-time %.3fs, MPR willingness %u"
operator|,
name|ME_TO_DOUBLE
argument_list|(
name|ptr
operator|.
name|hello
operator|->
name|htime
argument_list|)
operator|,
name|ptr
operator|.
name|hello
operator|->
name|will
operator|)
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello
argument_list|)
expr_stmt|;
name|msg_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello
argument_list|)
expr_stmt|;
while|while
condition|(
name|msg_tlen
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello_link
argument_list|)
condition|)
block|{
name|int
name|hello_len_valid
init|=
literal|0
decl_stmt|;
comment|/*                  * link-type.                  */
name|ND_TCHECK2
argument_list|(
operator|*
name|msg_data
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello_link
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|.
name|hello_link
operator|=
operator|(
specifier|const
expr|struct
name|olsr_hello_link
operator|*
operator|)
name|msg_data
expr_stmt|;
name|hello_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
operator|.
name|hello_link
operator|->
name|len
argument_list|)
expr_stmt|;
name|link_type
operator|=
name|OLSR_EXTRACT_LINK_TYPE
argument_list|(
name|ptr
operator|.
name|hello_link
operator|->
name|link_code
argument_list|)
expr_stmt|;
name|neighbor_type
operator|=
name|OLSR_EXTRACT_NEIGHBOR_TYPE
argument_list|(
name|ptr
operator|.
name|hello_link
operator|->
name|link_code
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|hello_len
operator|<=
name|msg_tlen
operator|)
operator|&&
operator|(
name|hello_len
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello_link
argument_list|)
operator|)
condition|)
name|hello_len_valid
operator|=
literal|1
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    link-type %s, neighbor-type %s, len %u%s"
operator|,
name|tok2str
argument_list|(
name|olsr_link_type_values
argument_list|,
literal|"Unknown"
argument_list|,
name|link_type
argument_list|)
operator|,
name|tok2str
argument_list|(
name|olsr_neighbor_type_values
argument_list|,
literal|"Unknown"
argument_list|,
name|neighbor_type
argument_list|)
operator|,
name|hello_len
operator|,
operator|(
name|hello_len_valid
operator|==
literal|0
operator|)
condition|?
literal|" (invalid)"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|hello_len_valid
operator|==
literal|0
condition|)
break|break;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello_link
argument_list|)
expr_stmt|;
name|msg_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello_link
argument_list|)
expr_stmt|;
name|hello_len
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello_link
argument_list|)
expr_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|msg_data
argument_list|,
name|hello_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg_type
operator|==
name|OLSR_HELLO_MSG
condition|)
block|{
if|if
condition|(
name|olsr_print_neighbor
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|,
name|hello_len
argument_list|)
operator|==
operator|-
literal|1
condition|)
goto|goto
name|trunc
goto|;
block|}
else|else
block|{
if|if
condition|(
name|is_ipv6
condition|)
block|{
if|if
condition|(
name|olsr_print_lq_neighbor6
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|,
name|hello_len
argument_list|)
operator|==
operator|-
literal|1
condition|)
goto|goto
name|trunc
goto|;
block|}
else|else
block|{
if|if
condition|(
name|olsr_print_lq_neighbor4
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|,
name|hello_len
argument_list|)
operator|==
operator|-
literal|1
condition|)
goto|goto
name|trunc
goto|;
block|}
block|}
name|msg_data
operator|+=
name|hello_len
expr_stmt|;
name|msg_tlen
operator|-=
name|hello_len
expr_stmt|;
block|}
break|break;
case|case
name|OLSR_TC_MSG
case|:
case|case
name|OLSR_TC_LQ_MSG
case|:
if|if
condition|(
name|msg_tlen
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_tc
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
name|ND_TCHECK2
argument_list|(
operator|*
name|msg_data
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_tc
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|.
name|tc
operator|=
operator|(
specifier|const
expr|struct
name|olsr_tc
operator|*
operator|)
name|msg_data
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    advertised neighbor seq 0x%04x"
operator|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
operator|.
name|tc
operator|->
name|ans_seq
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_tc
argument_list|)
expr_stmt|;
name|msg_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_tc
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg_type
operator|==
name|OLSR_TC_MSG
condition|)
block|{
if|if
condition|(
name|olsr_print_neighbor
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|,
name|msg_tlen
argument_list|)
operator|==
operator|-
literal|1
condition|)
goto|goto
name|trunc
goto|;
block|}
else|else
block|{
if|if
condition|(
name|is_ipv6
condition|)
block|{
if|if
condition|(
name|olsr_print_lq_neighbor6
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|,
name|msg_tlen
argument_list|)
operator|==
operator|-
literal|1
condition|)
goto|goto
name|trunc
goto|;
block|}
else|else
block|{
if|if
condition|(
name|olsr_print_lq_neighbor4
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|,
name|msg_tlen
argument_list|)
operator|==
operator|-
literal|1
condition|)
goto|goto
name|trunc
goto|;
block|}
block|}
break|break;
case|case
name|OLSR_MID_MSG
case|:
block|{
name|size_t
name|addr_size
init|=
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
decl_stmt|;
if|if
condition|(
name|is_ipv6
condition|)
name|addr_size
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
expr_stmt|;
while|while
condition|(
name|msg_tlen
operator|>=
name|addr_size
condition|)
block|{
name|ND_TCHECK2
argument_list|(
operator|*
name|msg_data
argument_list|,
name|addr_size
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  interface address %s"
operator|,
name|is_ipv6
condition|?
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|)
else|:
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
name|addr_size
expr_stmt|;
name|msg_tlen
operator|-=
name|addr_size
expr_stmt|;
block|}
break|break;
block|}
case|case
name|OLSR_HNA_MSG
case|:
if|if
condition|(
name|is_ipv6
condition|)
block|{
name|int
name|i
init|=
literal|0
decl_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  Advertised networks (total %u)"
operator|,
call|(
name|unsigned
name|int
call|)
argument_list|(
name|msg_tlen
operator|/
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna6
argument_list|)
argument_list|)
operator|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|msg_tlen
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna6
argument_list|)
condition|)
block|{
specifier|const
name|struct
name|olsr_hna6
modifier|*
name|hna6
decl_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|msg_data
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna6
argument_list|)
argument_list|)
expr_stmt|;
name|hna6
operator|=
operator|(
specifier|const
expr|struct
name|olsr_hna6
operator|*
operator|)
name|msg_data
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    #%i: %s/%u"
operator|,
name|i
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|hna6
operator|->
name|network
argument_list|)
operator|,
name|mask62plen
argument_list|(
name|hna6
operator|->
name|mask
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna6
argument_list|)
expr_stmt|;
name|msg_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna6
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|int
name|col
init|=
literal|0
decl_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  Advertised networks (total %u)"
operator|,
call|(
name|unsigned
name|int
call|)
argument_list|(
name|msg_tlen
operator|/
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna4
argument_list|)
argument_list|)
operator|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|msg_tlen
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna4
argument_list|)
condition|)
block|{
name|ND_TCHECK2
argument_list|(
operator|*
name|msg_data
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna4
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|.
name|hna
operator|=
operator|(
specifier|const
expr|struct
name|olsr_hna4
operator|*
operator|)
name|msg_data
expr_stmt|;
comment|/* print 4 prefixes per line */
if|if
condition|(
operator|!
name|ptr
operator|.
name|hna
operator|->
name|network
index|[
literal|0
index|]
operator|&&
operator|!
name|ptr
operator|.
name|hna
operator|->
name|network
index|[
literal|1
index|]
operator|&&
operator|!
name|ptr
operator|.
name|hna
operator|->
name|network
index|[
literal|2
index|]
operator|&&
operator|!
name|ptr
operator|.
name|hna
operator|->
name|network
index|[
literal|3
index|]
operator|&&
operator|!
name|ptr
operator|.
name|hna
operator|->
name|mask
index|[
name|GW_HNA_PAD
index|]
operator|&&
name|ptr
operator|.
name|hna
operator|->
name|mask
index|[
name|GW_HNA_FLAGS
index|]
condition|)
block|{
comment|/* smart gateway */
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%sSmart-Gateway:%s%s%s%s%s %u/%u"
operator|,
name|col
operator|==
literal|0
condition|?
literal|"\n\t    "
else|:
literal|", "
operator|,
comment|/* indent */
comment|/* sgw */
comment|/* LINKSPEED */
operator|(
name|ptr
operator|.
name|hna
operator|->
name|mask
index|[
name|GW_HNA_FLAGS
index|]
operator|&
name|GW_HNA_FLAG_LINKSPEED
operator|)
condition|?
literal|" LINKSPEED"
else|:
literal|""
operator|,
comment|/* IPV4 */
operator|(
name|ptr
operator|.
name|hna
operator|->
name|mask
index|[
name|GW_HNA_FLAGS
index|]
operator|&
name|GW_HNA_FLAG_IPV4
operator|)
condition|?
literal|" IPV4"
else|:
literal|""
operator|,
comment|/* IPV4-NAT */
operator|(
name|ptr
operator|.
name|hna
operator|->
name|mask
index|[
name|GW_HNA_FLAGS
index|]
operator|&
name|GW_HNA_FLAG_IPV4_NAT
operator|)
condition|?
literal|" IPV4-NAT"
else|:
literal|""
operator|,
comment|/* IPV6 */
operator|(
name|ptr
operator|.
name|hna
operator|->
name|mask
index|[
name|GW_HNA_FLAGS
index|]
operator|&
name|GW_HNA_FLAG_IPV6
operator|)
condition|?
literal|" IPV6"
else|:
literal|""
operator|,
comment|/* IPv6PREFIX */
operator|(
name|ptr
operator|.
name|hna
operator|->
name|mask
index|[
name|GW_HNA_FLAGS
index|]
operator|&
name|GW_HNA_FLAG_IPV6PREFIX
operator|)
condition|?
literal|" IPv6-PREFIX"
else|:
literal|""
operator|,
comment|/* uplink */
operator|(
name|ptr
operator|.
name|hna
operator|->
name|mask
index|[
name|GW_HNA_FLAGS
index|]
operator|&
name|GW_HNA_FLAG_LINKSPEED
operator|)
condition|?
name|deserialize_gw_speed
argument_list|(
name|ptr
operator|.
name|hna
operator|->
name|mask
index|[
name|GW_HNA_UPLINK
index|]
argument_list|)
else|:
literal|0
operator|,
comment|/* downlink */
operator|(
name|ptr
operator|.
name|hna
operator|->
name|mask
index|[
name|GW_HNA_FLAGS
index|]
operator|&
name|GW_HNA_FLAG_LINKSPEED
operator|)
condition|?
name|deserialize_gw_speed
argument_list|(
name|ptr
operator|.
name|hna
operator|->
name|mask
index|[
name|GW_HNA_DOWNLINK
index|]
argument_list|)
else|:
literal|0
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* normal route */
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s%s/%u"
operator|,
name|col
operator|==
literal|0
condition|?
literal|"\n\t    "
else|:
literal|", "
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|ptr
operator|.
name|hna
operator|->
name|network
argument_list|)
operator|,
name|mask2plen
argument_list|(
name|EXTRACT_32BITS
argument_list|(
name|ptr
operator|.
name|hna
operator|->
name|mask
argument_list|)
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna4
argument_list|)
expr_stmt|;
name|msg_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna4
argument_list|)
expr_stmt|;
name|col
operator|=
operator|(
name|col
operator|+
literal|1
operator|)
operator|%
literal|4
expr_stmt|;
block|}
block|}
break|break;
case|case
name|OLSR_NAMESERVICE_MSG
case|:
block|{
name|u_int
name|name_entries
init|=
name|EXTRACT_16BITS
argument_list|(
name|msg_data
operator|+
literal|2
argument_list|)
decl_stmt|;
name|u_int
name|addr_size
init|=
literal|4
decl_stmt|;
name|int
name|name_entries_valid
init|=
literal|0
decl_stmt|;
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|is_ipv6
condition|)
name|addr_size
operator|=
literal|16
expr_stmt|;
if|if
condition|(
operator|(
name|name_entries
operator|>
literal|0
operator|)
operator|&&
operator|(
operator|(
name|name_entries
operator|*
operator|(
literal|4
operator|+
name|addr_size
operator|)
operator|)
operator|<=
name|msg_tlen
operator|)
condition|)
name|name_entries_valid
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|msg_tlen
operator|<
literal|4
condition|)
goto|goto
name|trunc
goto|;
name|ND_TCHECK2
argument_list|(
operator|*
name|msg_data
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  Version %u, Entries %u%s"
operator|,
name|EXTRACT_16BITS
argument_list|(
name|msg_data
argument_list|)
operator|,
name|name_entries
operator|,
operator|(
name|name_entries_valid
operator|==
literal|0
operator|)
condition|?
literal|" (invalid)"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|name_entries_valid
operator|==
literal|0
condition|)
break|break;
name|msg_data
operator|+=
literal|4
expr_stmt|;
name|msg_tlen
operator|-=
literal|4
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|name_entries
condition|;
name|i
operator|++
control|)
block|{
name|int
name|name_entry_len_valid
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|msg_tlen
operator|<
literal|4
condition|)
break|break;
name|ND_TCHECK2
argument_list|(
operator|*
name|msg_data
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|name_entry_type
operator|=
name|EXTRACT_16BITS
argument_list|(
name|msg_data
argument_list|)
expr_stmt|;
name|name_entry_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|msg_data
operator|+
literal|2
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
literal|4
expr_stmt|;
name|msg_tlen
operator|-=
literal|4
expr_stmt|;
if|if
condition|(
operator|(
name|name_entry_len
operator|>
literal|0
operator|)
operator|&&
operator|(
operator|(
name|addr_size
operator|+
name|name_entry_len
operator|)
operator|<=
name|msg_tlen
operator|)
condition|)
name|name_entry_len_valid
operator|=
literal|1
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    #%u: type %#06x, length %u%s"
operator|,
operator|(
name|unsigned
name|int
operator|)
name|i
operator|,
name|name_entry_type
operator|,
name|name_entry_len
operator|,
operator|(
name|name_entry_len_valid
operator|==
literal|0
operator|)
condition|?
literal|" (invalid)"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|name_entry_len_valid
operator|==
literal|0
condition|)
break|break;
comment|/* 32-bit alignment */
name|name_entry_padding
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|name_entry_len
operator|%
literal|4
operator|!=
literal|0
condition|)
name|name_entry_padding
operator|=
literal|4
operator|-
operator|(
name|name_entry_len
operator|%
literal|4
operator|)
expr_stmt|;
if|if
condition|(
name|msg_tlen
operator|<
name|addr_size
operator|+
name|name_entry_len
operator|+
name|name_entry_padding
condition|)
goto|goto
name|trunc
goto|;
name|ND_TCHECK2
argument_list|(
operator|*
name|msg_data
argument_list|,
name|addr_size
operator|+
name|name_entry_len
operator|+
name|name_entry_padding
argument_list|)
expr_stmt|;
if|if
condition|(
name|is_ipv6
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", address %s, name \""
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", address %s, name \""
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fn_printn
argument_list|(
name|ndo
argument_list|,
name|msg_data
operator|+
name|addr_size
argument_list|,
name|name_entry_len
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\""
operator|)
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
name|addr_size
operator|+
name|name_entry_len
operator|+
name|name_entry_padding
expr_stmt|;
name|msg_tlen
operator|-=
name|addr_size
operator|+
name|name_entry_len
operator|+
name|name_entry_padding
expr_stmt|;
block|}
comment|/* for (i = 0; i< name_entries; i++) */
break|break;
block|}
comment|/* case OLSR_NAMESERVICE_MSG */
comment|/*              * FIXME those are the defined messages that lack a decoder              * you are welcome to contribute code ;-)              */
case|case
name|OLSR_POWERINFO_MSG
case|:
default|default:
name|print_unknown_data
argument_list|(
name|ndo
argument_list|,
name|msg_data
argument_list|,
literal|"\n\t    "
argument_list|,
name|msg_tlen
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* switch (msg_type) */
name|tptr
operator|+=
name|msg_len
expr_stmt|;
block|}
comment|/* while (tptr< (pptr+length)) */
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"[|olsr]"
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Local Variables:  * c-style: whitesmith  * c-basic-offset: 4  * End:  */
end_comment

end_unit

