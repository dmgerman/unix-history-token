begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1992, 1993, 1994, 1995, 1996  *	The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code distributions  * retain the above copyright notice and this paragraph in its entirety, (2)  * distributions including binary code include the above copyright notice and  * this paragraph in its entirety in the documentation or other materials  * provided with the distribution, and (3) all advertising materials mentioning  * features or use of this software display the following acknowledgement:  * ``This product includes software developed by the University of California,  * Lawrence Berkeley Laboratory and its contributors.'' Neither the name of  * the University nor the names of its contributors may be used to endorse  * or promote products derived from this software without specific prior  * written permission.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED  * WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  *  * Original code by Matt Thomas, Digital Equipment Corporation  *  * Extensively modified by Hannes Gredler (hannes@juniper.net) for more  * complete IS-IS support.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
name|_U_
init|=
literal|"@(#) $Header: /tcpdump/master/tcpdump/print-isoclns.c,v 1.106.2.5 2004/03/24 01:45:26 guy Exp $ (LBL)"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<tcpdump-stdinc.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_include
include|#
directive|include
file|"ethertype.h"
end_include

begin_include
include|#
directive|include
file|"ether.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_include
include|#
directive|include
file|"gmpls.h"
end_include

begin_define
define|#
directive|define
name|NLPID_CLNS
value|129
end_define

begin_comment
comment|/* 0x81 */
end_comment

begin_define
define|#
directive|define
name|NLPID_ESIS
value|130
end_define

begin_comment
comment|/* 0x82 */
end_comment

begin_define
define|#
directive|define
name|NLPID_ISIS
value|131
end_define

begin_comment
comment|/* 0x83 */
end_comment

begin_define
define|#
directive|define
name|NLPID_IP6
value|0x8e
end_define

begin_define
define|#
directive|define
name|NLPID_IP
value|0xcc
end_define

begin_define
define|#
directive|define
name|NLPID_NULLNS
value|0
end_define

begin_define
define|#
directive|define
name|IPV4
value|1
end_define

begin_comment
comment|/* AFI value */
end_comment

begin_define
define|#
directive|define
name|IPV6
value|2
end_define

begin_comment
comment|/* AFI value */
end_comment

begin_comment
comment|/*  * IS-IS is defined in ISO 10589.  Look there for protocol definitions.  */
end_comment

begin_define
define|#
directive|define
name|SYSTEM_ID_LEN
value|ETHER_ADDR_LEN
end_define

begin_define
define|#
directive|define
name|NODE_ID_LEN
value|SYSTEM_ID_LEN+1
end_define

begin_define
define|#
directive|define
name|LSP_ID_LEN
value|SYSTEM_ID_LEN+2
end_define

begin_define
define|#
directive|define
name|ISIS_VERSION
value|1
end_define

begin_define
define|#
directive|define
name|PDU_TYPE_MASK
value|0x1F
end_define

begin_define
define|#
directive|define
name|PRIORITY_MASK
value|0x7F
end_define

begin_define
define|#
directive|define
name|L1_LAN_IIH
value|15
end_define

begin_define
define|#
directive|define
name|L2_LAN_IIH
value|16
end_define

begin_define
define|#
directive|define
name|PTP_IIH
value|17
end_define

begin_define
define|#
directive|define
name|L1_LSP
value|18
end_define

begin_define
define|#
directive|define
name|L2_LSP
value|20
end_define

begin_define
define|#
directive|define
name|L1_CSNP
value|24
end_define

begin_define
define|#
directive|define
name|L2_CSNP
value|25
end_define

begin_define
define|#
directive|define
name|L1_PSNP
value|26
end_define

begin_define
define|#
directive|define
name|L2_PSNP
value|27
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_pdu_values
index|[]
init|=
block|{
block|{
name|L1_LAN_IIH
block|,
literal|"L1 Lan IIH"
block|}
block|,
block|{
name|L2_LAN_IIH
block|,
literal|"L2 Lan IIH"
block|}
block|,
block|{
name|PTP_IIH
block|,
literal|"p2p IIH"
block|}
block|,
block|{
name|L1_LSP
block|,
literal|"L1 LSP"
block|}
block|,
block|{
name|L2_LSP
block|,
literal|"L2 LSP"
block|}
block|,
block|{
name|L1_CSNP
block|,
literal|"L1 CSNP"
block|}
block|,
block|{
name|L2_CSNP
block|,
literal|"L2 CSNP"
block|}
block|,
block|{
name|L1_PSNP
block|,
literal|"L1 PSNP"
block|}
block|,
block|{
name|L2_PSNP
block|,
literal|"L2 PSNP"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * A TLV is a tuple of a type, length and a value and is normally used for  * encoding information in all sorts of places.  This is an enumeration of  * the well known types.  *  * list taken from rfc3359 plus some memory from veterans ;-)  */
end_comment

begin_define
define|#
directive|define
name|TLV_AREA_ADDR
value|1
end_define

begin_comment
comment|/* iso10589 */
end_comment

begin_define
define|#
directive|define
name|TLV_IS_REACH
value|2
end_define

begin_comment
comment|/* iso10589 */
end_comment

begin_define
define|#
directive|define
name|TLV_ESNEIGH
value|3
end_define

begin_comment
comment|/* iso10589 */
end_comment

begin_define
define|#
directive|define
name|TLV_PART_DIS
value|4
end_define

begin_comment
comment|/* iso10589 */
end_comment

begin_define
define|#
directive|define
name|TLV_PREFIX_NEIGH
value|5
end_define

begin_comment
comment|/* iso10589 */
end_comment

begin_define
define|#
directive|define
name|TLV_ISNEIGH
value|6
end_define

begin_comment
comment|/* iso10589 */
end_comment

begin_define
define|#
directive|define
name|TLV_ISNEIGH_VARLEN
value|7
end_define

begin_comment
comment|/* iso10589 */
end_comment

begin_define
define|#
directive|define
name|TLV_PADDING
value|8
end_define

begin_comment
comment|/* iso10589 */
end_comment

begin_define
define|#
directive|define
name|TLV_LSP
value|9
end_define

begin_comment
comment|/* iso10589 */
end_comment

begin_define
define|#
directive|define
name|TLV_AUTH
value|10
end_define

begin_comment
comment|/* iso10589, rfc3567 */
end_comment

begin_define
define|#
directive|define
name|TLV_CHECKSUM
value|12
end_define

begin_comment
comment|/* rfc3358 */
end_comment

begin_define
define|#
directive|define
name|TLV_LSP_BUFFERSIZE
value|14
end_define

begin_comment
comment|/* iso10589 rev2 */
end_comment

begin_define
define|#
directive|define
name|TLV_EXT_IS_REACH
value|22
end_define

begin_comment
comment|/* draft-ietf-isis-traffic-05 */
end_comment

begin_define
define|#
directive|define
name|TLV_IS_ALIAS_ID
value|24
end_define

begin_comment
comment|/* draft-ietf-isis-ext-lsp-frags-02 */
end_comment

begin_define
define|#
directive|define
name|TLV_DECNET_PHASE4
value|42
end_define

begin_define
define|#
directive|define
name|TLV_LUCENT_PRIVATE
value|66
end_define

begin_define
define|#
directive|define
name|TLV_INT_IP_REACH
value|128
end_define

begin_comment
comment|/* rfc1195, rfc2966 */
end_comment

begin_define
define|#
directive|define
name|TLV_PROTOCOLS
value|129
end_define

begin_comment
comment|/* rfc1195 */
end_comment

begin_define
define|#
directive|define
name|TLV_EXT_IP_REACH
value|130
end_define

begin_comment
comment|/* rfc1195, rfc2966 */
end_comment

begin_define
define|#
directive|define
name|TLV_IDRP_INFO
value|131
end_define

begin_comment
comment|/* rfc1195 */
end_comment

begin_define
define|#
directive|define
name|TLV_IPADDR
value|132
end_define

begin_comment
comment|/* rfc1195 */
end_comment

begin_define
define|#
directive|define
name|TLV_IPAUTH
value|133
end_define

begin_comment
comment|/* rfc1195 */
end_comment

begin_define
define|#
directive|define
name|TLV_TE_ROUTER_ID
value|134
end_define

begin_comment
comment|/* draft-ietf-isis-traffic-05 */
end_comment

begin_define
define|#
directive|define
name|TLV_EXTD_IP_REACH
value|135
end_define

begin_comment
comment|/* draft-ietf-isis-traffic-05 */
end_comment

begin_define
define|#
directive|define
name|TLV_HOSTNAME
value|137
end_define

begin_comment
comment|/* rfc2763 */
end_comment

begin_define
define|#
directive|define
name|TLV_SHARED_RISK_GROUP
value|138
end_define

begin_comment
comment|/* draft-ietf-isis-gmpls-extensions */
end_comment

begin_define
define|#
directive|define
name|TLV_NORTEL_PRIVATE1
value|176
end_define

begin_define
define|#
directive|define
name|TLV_NORTEL_PRIVATE2
value|177
end_define

begin_define
define|#
directive|define
name|TLV_HOLDTIME
value|198
end_define

begin_comment
comment|/* ES-IS */
end_comment

begin_define
define|#
directive|define
name|TLV_RESTART_SIGNALING
value|211
end_define

begin_comment
comment|/* draft-ietf-isis-restart-01 */
end_comment

begin_define
define|#
directive|define
name|TLV_MT_IS_REACH
value|222
end_define

begin_comment
comment|/* draft-ietf-isis-wg-multi-topology-05 */
end_comment

begin_define
define|#
directive|define
name|TLV_MT_SUPPORTED
value|229
end_define

begin_comment
comment|/* draft-ietf-isis-wg-multi-topology-05 */
end_comment

begin_define
define|#
directive|define
name|TLV_IP6ADDR
value|232
end_define

begin_comment
comment|/* draft-ietf-isis-ipv6-02 */
end_comment

begin_define
define|#
directive|define
name|TLV_MT_IP_REACH
value|235
end_define

begin_comment
comment|/* draft-ietf-isis-wg-multi-topology-05 */
end_comment

begin_define
define|#
directive|define
name|TLV_IP6_REACH
value|236
end_define

begin_comment
comment|/* draft-ietf-isis-ipv6-02 */
end_comment

begin_define
define|#
directive|define
name|TLV_MT_IP6_REACH
value|237
end_define

begin_comment
comment|/* draft-ietf-isis-wg-multi-topology-05 */
end_comment

begin_define
define|#
directive|define
name|TLV_PTP_ADJ
value|240
end_define

begin_comment
comment|/* rfc3373 */
end_comment

begin_define
define|#
directive|define
name|TLV_IIH_SEQNR
value|241
end_define

begin_comment
comment|/* draft-shen-isis-iih-sequence-00 */
end_comment

begin_define
define|#
directive|define
name|TLV_VENDOR_PRIVATE
value|250
end_define

begin_comment
comment|/* draft-ietf-isis-proprietary-tlv-00 */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_tlv_values
index|[]
init|=
block|{
block|{
name|TLV_AREA_ADDR
block|,
literal|"Area address(es)"
block|}
block|,
block|{
name|TLV_IS_REACH
block|,
literal|"IS Reachability"
block|}
block|,
block|{
name|TLV_ESNEIGH
block|,
literal|"ES Neighbor(s)"
block|}
block|,
block|{
name|TLV_PART_DIS
block|,
literal|"Partition DIS"
block|}
block|,
block|{
name|TLV_PREFIX_NEIGH
block|,
literal|"Prefix Neighbors"
block|}
block|,
block|{
name|TLV_ISNEIGH
block|,
literal|"IS Neighbor(s)"
block|}
block|,
block|{
name|TLV_ISNEIGH_VARLEN
block|,
literal|"IS Neighbor(s) (variable length)"
block|}
block|,
block|{
name|TLV_PADDING
block|,
literal|"Padding"
block|}
block|,
block|{
name|TLV_LSP
block|,
literal|"LSP entries"
block|}
block|,
block|{
name|TLV_AUTH
block|,
literal|"Authentication"
block|}
block|,
block|{
name|TLV_CHECKSUM
block|,
literal|"Checksum"
block|}
block|,
block|{
name|TLV_LSP_BUFFERSIZE
block|,
literal|"LSP Buffersize"
block|}
block|,
block|{
name|TLV_EXT_IS_REACH
block|,
literal|"Extended IS Reachability"
block|}
block|,
block|{
name|TLV_IS_ALIAS_ID
block|,
literal|"IS Alias ID"
block|}
block|,
block|{
name|TLV_DECNET_PHASE4
block|,
literal|"DECnet Phase IV"
block|}
block|,
block|{
name|TLV_LUCENT_PRIVATE
block|,
literal|"Lucent Proprietary"
block|}
block|,
block|{
name|TLV_INT_IP_REACH
block|,
literal|"IPv4 Internal Reachability"
block|}
block|,
block|{
name|TLV_PROTOCOLS
block|,
literal|"Protocols supported"
block|}
block|,
block|{
name|TLV_EXT_IP_REACH
block|,
literal|"IPv4 External Reachability"
block|}
block|,
block|{
name|TLV_IDRP_INFO
block|,
literal|"Inter-Domain Information Type"
block|}
block|,
block|{
name|TLV_IPADDR
block|,
literal|"IPv4 Interface address(es)"
block|}
block|,
block|{
name|TLV_IPAUTH
block|,
literal|"IPv4 authentication (deprecated)"
block|}
block|,
block|{
name|TLV_TE_ROUTER_ID
block|,
literal|"Traffic Engineering Router ID"
block|}
block|,
block|{
name|TLV_EXTD_IP_REACH
block|,
literal|"Extended IPv4 Reachability"
block|}
block|,
block|{
name|TLV_HOSTNAME
block|,
literal|"Hostname"
block|}
block|,
block|{
name|TLV_SHARED_RISK_GROUP
block|,
literal|"Shared Risk Link Group"
block|}
block|,
block|{
name|TLV_NORTEL_PRIVATE1
block|,
literal|"Nortel Proprietary"
block|}
block|,
block|{
name|TLV_NORTEL_PRIVATE2
block|,
literal|"Nortel Proprietary"
block|}
block|,
block|{
name|TLV_HOLDTIME
block|,
literal|"Holdtime"
block|}
block|,
block|{
name|TLV_RESTART_SIGNALING
block|,
literal|"Restart Signaling"
block|}
block|,
block|{
name|TLV_MT_IS_REACH
block|,
literal|"Multi Topology IS Reachability"
block|}
block|,
block|{
name|TLV_MT_SUPPORTED
block|,
literal|"Multi Topology"
block|}
block|,
block|{
name|TLV_IP6ADDR
block|,
literal|"IPv6 Interface address(es)"
block|}
block|,
block|{
name|TLV_MT_IP_REACH
block|,
literal|"Multi-Topology IPv4 Reachability"
block|}
block|,
block|{
name|TLV_IP6_REACH
block|,
literal|"IPv6 reachability"
block|}
block|,
block|{
name|TLV_MT_IP6_REACH
block|,
literal|"Multi-Topology IP6 Reachability"
block|}
block|,
block|{
name|TLV_PTP_ADJ
block|,
literal|"Point-to-point Adjacency State"
block|}
block|,
block|{
name|TLV_IIH_SEQNR
block|,
literal|"Hello PDU Sequence Number"
block|}
block|,
block|{
name|TLV_VENDOR_PRIVATE
block|,
literal|"Vendor Private"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_ADMIN_GROUP
value|3
end_define

begin_comment
comment|/* draft-ietf-isis-traffic-05 */
end_comment

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_LINK_LOCAL_REMOTE_ID
value|4
end_define

begin_comment
comment|/* draft-ietf-isis-gmpls-extensions */
end_comment

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_LINK_REMOTE_ID
value|5
end_define

begin_comment
comment|/* draft-ietf-isis-traffic-05 */
end_comment

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_IPV4_INTF_ADDR
value|6
end_define

begin_comment
comment|/* draft-ietf-isis-traffic-05 */
end_comment

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_IPV4_NEIGHBOR_ADDR
value|8
end_define

begin_comment
comment|/* draft-ietf-isis-traffic-05 */
end_comment

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_MAX_LINK_BW
value|9
end_define

begin_comment
comment|/* draft-ietf-isis-traffic-05 */
end_comment

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_RESERVABLE_BW
value|10
end_define

begin_comment
comment|/* draft-ietf-isis-traffic-05 */
end_comment

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_UNRESERVED_BW
value|11
end_define

begin_comment
comment|/* draft-ietf-isis-traffic-05 */
end_comment

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_TE_METRIC
value|18
end_define

begin_comment
comment|/* draft-ietf-isis-traffic-05 */
end_comment

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_LINK_PROTECTION_TYPE
value|20
end_define

begin_comment
comment|/* draft-ietf-isis-gmpls-extensions */
end_comment

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_INTF_SW_CAP_DESCR
value|21
end_define

begin_comment
comment|/* draft-ietf-isis-gmpls-extensions */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_ext_is_reach_subtlv_values
index|[]
init|=
block|{
block|{
name|SUBTLV_EXT_IS_REACH_ADMIN_GROUP
block|,
literal|"Administrative groups"
block|}
block|,
block|{
name|SUBTLV_EXT_IS_REACH_LINK_LOCAL_REMOTE_ID
block|,
literal|"Link Local/Remote Identifier"
block|}
block|,
block|{
name|SUBTLV_EXT_IS_REACH_LINK_REMOTE_ID
block|,
literal|"Link Remote Identifier"
block|}
block|,
block|{
name|SUBTLV_EXT_IS_REACH_IPV4_INTF_ADDR
block|,
literal|"IPv4 interface address"
block|}
block|,
block|{
name|SUBTLV_EXT_IS_REACH_IPV4_NEIGHBOR_ADDR
block|,
literal|"IPv4 neighbor address"
block|}
block|,
block|{
name|SUBTLV_EXT_IS_REACH_MAX_LINK_BW
block|,
literal|"Maximum link bandwidth"
block|}
block|,
block|{
name|SUBTLV_EXT_IS_REACH_RESERVABLE_BW
block|,
literal|"Reservable link bandwidth"
block|}
block|,
block|{
name|SUBTLV_EXT_IS_REACH_UNRESERVED_BW
block|,
literal|"Unreserved bandwidth"
block|}
block|,
block|{
name|SUBTLV_EXT_IS_REACH_TE_METRIC
block|,
literal|"Traffic Engineering Metric"
block|}
block|,
block|{
name|SUBTLV_EXT_IS_REACH_LINK_PROTECTION_TYPE
block|,
literal|"Link Protection Type"
block|}
block|,
block|{
name|SUBTLV_EXT_IS_REACH_INTF_SW_CAP_DESCR
block|,
literal|"Interface Switching Capability"
block|}
block|,
block|{
literal|250
block|,
literal|"Reserved for cisco specific extensions"
block|}
block|,
block|{
literal|251
block|,
literal|"Reserved for cisco specific extensions"
block|}
block|,
block|{
literal|252
block|,
literal|"Reserved for cisco specific extensions"
block|}
block|,
block|{
literal|253
block|,
literal|"Reserved for cisco specific extensions"
block|}
block|,
block|{
literal|254
block|,
literal|"Reserved for cisco specific extensions"
block|}
block|,
block|{
literal|255
block|,
literal|"Reserved for future expansion"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|SUBTLV_EXTD_IP_REACH_ADMIN_TAG32
value|1
end_define

begin_define
define|#
directive|define
name|SUBTLV_EXTD_IP_REACH_ADMIN_TAG64
value|2
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_ext_ip_reach_subtlv_values
index|[]
init|=
block|{
block|{
name|SUBTLV_EXTD_IP_REACH_ADMIN_TAG32
block|,
literal|"32-Bit Administrative tag"
block|}
block|,
block|{
name|SUBTLV_EXTD_IP_REACH_ADMIN_TAG64
block|,
literal|"64-Bit Administrative tag"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|SUBTLV_AUTH_SIMPLE
value|1
end_define

begin_define
define|#
directive|define
name|SUBTLV_AUTH_MD5
value|54
end_define

begin_define
define|#
directive|define
name|SUBTLV_AUTH_MD5_LEN
value|16
end_define

begin_define
define|#
directive|define
name|SUBTLV_AUTH_PRIVATE
value|255
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_subtlv_auth_values
index|[]
init|=
block|{
block|{
name|SUBTLV_AUTH_SIMPLE
block|,
literal|"simple text password"
block|}
block|,
block|{
name|SUBTLV_AUTH_MD5
block|,
literal|"HMAC-MD5 password"
block|}
block|,
block|{
name|SUBTLV_AUTH_PRIVATE
block|,
literal|"Routing Domain private password"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|SUBTLV_IDRP_RES
value|0
end_define

begin_define
define|#
directive|define
name|SUBTLV_IDRP_LOCAL
value|1
end_define

begin_define
define|#
directive|define
name|SUBTLV_IDRP_ASN
value|2
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_subtlv_idrp_values
index|[]
init|=
block|{
block|{
name|SUBTLV_IDRP_RES
block|,
literal|"Reserved"
block|}
block|,
block|{
name|SUBTLV_IDRP_LOCAL
block|,
literal|"Routing-Domain Specific"
block|}
block|,
block|{
name|SUBTLV_IDRP_ASN
block|,
literal|"AS Number Tag"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|ISIS_8BIT_MASK
parameter_list|(
name|x
parameter_list|)
value|((x)&0xff)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_OL_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x4)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ISTYPE_BITS
parameter_list|(
name|x
parameter_list|)
value|((x)&0x3)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_PARTITION_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x80)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ATT_BITS
parameter_list|(
name|x
parameter_list|)
value|((x)&0x78)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ATT_ERROR_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x40)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ATT_EXPENSE_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x20)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ATT_DELAY_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x10)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ATT_DEFAULT_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x8)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_MTID
parameter_list|(
name|x
parameter_list|)
value|((x)&0x0fff)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_MTFLAGS
parameter_list|(
name|x
parameter_list|)
value|((x)&0xf000)
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_mt_flag_values
index|[]
init|=
block|{
block|{
literal|0x4000
block|,
literal|"sub-TLVs present"
block|}
block|,
block|{
literal|0x8000
block|,
literal|"ATT bit set"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|ISIS_MASK_TLV_EXTD_IP_UPDOWN
parameter_list|(
name|x
parameter_list|)
value|((x)&0x80)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_TLV_EXTD_IP_SUBTLV
parameter_list|(
name|x
parameter_list|)
value|((x)&0x40)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_TLV_EXTD_IP6_IE
parameter_list|(
name|x
parameter_list|)
value|((x)&0x40)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_TLV_EXTD_IP6_SUBTLV
parameter_list|(
name|x
parameter_list|)
value|((x)&0x20)
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TLV_METRIC_SUPPORTED
parameter_list|(
name|x
parameter_list|)
value|((x)&0x80)
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TLV_METRIC_IE
parameter_list|(
name|x
parameter_list|)
value|((x)&0x40)
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TLV_METRIC_UPDOWN
parameter_list|(
name|x
parameter_list|)
value|((x)&0x80)
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TLV_METRIC_VALUE
parameter_list|(
name|x
parameter_list|)
value|((x)&0x3f)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_TLV_SHARED_RISK_GROUP
parameter_list|(
name|x
parameter_list|)
value|((x)&0x1)
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_mt_values
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"IPv4 unicast"
block|}
block|,
block|{
literal|1
block|,
literal|"In-Band Management"
block|}
block|,
block|{
literal|2
block|,
literal|"IPv6 unicast"
block|}
block|,
block|{
literal|3
block|,
literal|"Multicast"
block|}
block|,
block|{
literal|4095
block|,
literal|"Development, Experimental or Proprietary"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_iih_circuit_type_values
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"Level 1 only"
block|}
block|,
block|{
literal|2
block|,
literal|"Level 2 only"
block|}
block|,
block|{
literal|3
block|,
literal|"Level 1, Level 2"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|ISIS_LSP_TYPE_UNUSED0
value|0
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TYPE_LEVEL_1
value|1
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TYPE_UNUSED2
value|2
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TYPE_LEVEL_2
value|3
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_lsp_istype_values
index|[]
init|=
block|{
block|{
name|ISIS_LSP_TYPE_UNUSED0
block|,
literal|"Unused 0x0 (invalid)"
block|}
block|,
block|{
name|ISIS_LSP_TYPE_LEVEL_1
block|,
literal|"L1 IS"
block|}
block|,
block|{
name|ISIS_LSP_TYPE_UNUSED2
block|,
literal|"Unused 0x2 (invalid)"
block|}
block|,
block|{
name|ISIS_LSP_TYPE_LEVEL_2
block|,
literal|"L1L2 IS"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|tok
name|osi_nlpid_values
index|[]
init|=
block|{
block|{
name|NLPID_CLNS
block|,
literal|"CLNS"
block|}
block|,
block|{
name|NLPID_IP
block|,
literal|"IPv4"
block|}
block|,
block|{
name|NLPID_IP6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Katz's point to point adjacency TLV uses codes to tell us the state of  * the remote adjacency.  Enumerate them.  */
end_comment

begin_define
define|#
directive|define
name|ISIS_PTP_ADJ_UP
value|0
end_define

begin_define
define|#
directive|define
name|ISIS_PTP_ADJ_INIT
value|1
end_define

begin_define
define|#
directive|define
name|ISIS_PTP_ADJ_DOWN
value|2
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_ptp_adjancey_values
index|[]
init|=
block|{
block|{
name|ISIS_PTP_ADJ_UP
block|,
literal|"Up"
block|}
block|,
block|{
name|ISIS_PTP_ADJ_INIT
block|,
literal|"Initializing"
block|}
block|,
block|{
name|ISIS_PTP_ADJ_DOWN
block|,
literal|"Down"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|isis_tlv_ptp_adj
block|{
name|u_int8_t
name|adjacency_state
decl_stmt|;
name|u_int8_t
name|extd_local_circuit_id
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|neighbor_sysid
index|[
name|SYSTEM_ID_LEN
index|]
decl_stmt|;
name|u_int8_t
name|neighbor_extd_local_circuit_id
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function_decl
specifier|static
name|int
name|osi_cksum
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|esis_print
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|isis_print
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_struct
struct|struct
name|isis_metric_block
block|{
name|u_int8_t
name|metric_default
decl_stmt|;
name|u_int8_t
name|metric_delay
decl_stmt|;
name|u_int8_t
name|metric_expense
decl_stmt|;
name|u_int8_t
name|metric_error
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_tlv_is_reach
block|{
name|struct
name|isis_metric_block
name|isis_metric_block
decl_stmt|;
name|u_int8_t
name|neighbor_nodeid
index|[
name|NODE_ID_LEN
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_tlv_es_reach
block|{
name|struct
name|isis_metric_block
name|isis_metric_block
decl_stmt|;
name|u_int8_t
name|neighbor_sysid
index|[
name|SYSTEM_ID_LEN
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_tlv_ip_reach
block|{
name|struct
name|isis_metric_block
name|isis_metric_block
decl_stmt|;
name|u_int8_t
name|prefix
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|mask
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_is_reach_virtual_values
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"IsNotVirtual"
block|}
block|,
block|{
literal|1
block|,
literal|"IsVirtual"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_restart_flag_values
index|[]
init|=
block|{
block|{
literal|0x1
block|,
literal|"Restart Request"
block|}
block|,
block|{
literal|0x2
block|,
literal|"Restart Acknowledgement"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|isis_common_header
block|{
name|u_int8_t
name|nlpid
decl_stmt|;
name|u_int8_t
name|fixed_len
decl_stmt|;
name|u_int8_t
name|version
decl_stmt|;
comment|/* Protocol version */
name|u_int8_t
name|id_length
decl_stmt|;
name|u_int8_t
name|pdu_type
decl_stmt|;
comment|/* 3 MSbits are reserved */
name|u_int8_t
name|pdu_version
decl_stmt|;
comment|/* Packet format version */
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|max_area
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_iih_lan_header
block|{
name|u_int8_t
name|circuit_type
decl_stmt|;
name|u_int8_t
name|source_id
index|[
name|SYSTEM_ID_LEN
index|]
decl_stmt|;
name|u_int8_t
name|holding_time
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|pdu_len
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|priority
decl_stmt|;
name|u_int8_t
name|lan_id
index|[
name|NODE_ID_LEN
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_iih_ptp_header
block|{
name|u_int8_t
name|circuit_type
decl_stmt|;
name|u_int8_t
name|source_id
index|[
name|SYSTEM_ID_LEN
index|]
decl_stmt|;
name|u_int8_t
name|holding_time
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|pdu_len
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|circuit_id
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_lsp_header
block|{
name|u_int8_t
name|pdu_len
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|remaining_lifetime
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|lsp_id
index|[
name|LSP_ID_LEN
index|]
decl_stmt|;
name|u_int8_t
name|sequence_number
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|checksum
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|typeblock
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_csnp_header
block|{
name|u_int8_t
name|pdu_len
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|source_id
index|[
name|NODE_ID_LEN
index|]
decl_stmt|;
name|u_int8_t
name|start_lsp_id
index|[
name|LSP_ID_LEN
index|]
decl_stmt|;
name|u_int8_t
name|end_lsp_id
index|[
name|LSP_ID_LEN
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_psnp_header
block|{
name|u_int8_t
name|pdu_len
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|source_id
index|[
name|NODE_ID_LEN
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_tlv_lsp
block|{
name|u_int8_t
name|remaining_lifetime
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|lsp_id
index|[
name|LSP_ID_LEN
index|]
decl_stmt|;
name|u_int8_t
name|sequence_number
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|checksum
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|char
modifier|*
name|print_nsap
parameter_list|(
specifier|register
specifier|const
name|u_int8_t
modifier|*
name|pptr
parameter_list|,
specifier|register
name|int
name|nsap_length
parameter_list|)
block|{
name|int
name|nsap_idx
decl_stmt|;
specifier|static
name|char
name|nsap_ascii_output
index|[
sizeof|sizeof
argument_list|(
literal|"xx.xxxx.xxxx.xxxx.xxxx.xxxx.xxxx.xxxx.xxxx.xxxx.xx"
argument_list|)
index|]
decl_stmt|;
name|char
modifier|*
name|junk_buf
init|=
name|nsap_ascii_output
decl_stmt|;
if|if
condition|(
name|nsap_length
operator|<
literal|1
operator|||
name|nsap_length
operator|>
literal|20
condition|)
block|{
name|snprintf
argument_list|(
name|nsap_ascii_output
argument_list|,
sizeof|sizeof
argument_list|(
name|nsap_ascii_output
argument_list|)
argument_list|,
literal|"illegal length"
argument_list|)
expr_stmt|;
return|return
operator|(
name|nsap_ascii_output
operator|)
return|;
block|}
for|for
control|(
name|nsap_idx
operator|=
literal|0
init|;
name|nsap_idx
operator|<
name|nsap_length
condition|;
name|nsap_idx
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|pptr
argument_list|,
literal|1
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|snprintf
argument_list|(
name|junk_buf
argument_list|,
sizeof|sizeof
argument_list|(
name|nsap_ascii_output
argument_list|)
operator|-
operator|(
name|junk_buf
operator|-
name|nsap_ascii_output
operator|)
argument_list|,
literal|"%02x"
argument_list|,
operator|*
name|pptr
operator|++
argument_list|)
expr_stmt|;
name|junk_buf
operator|+=
name|strlen
argument_list|(
name|junk_buf
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|nsap_idx
operator|&
literal|1
operator|)
operator|==
literal|0
operator|)
operator|&&
operator|(
name|nsap_idx
operator|+
literal|1
operator|<
name|nsap_length
operator|)
condition|)
block|{
operator|*
name|junk_buf
operator|++
operator|=
literal|'.'
expr_stmt|;
block|}
block|}
operator|*
operator|(
name|junk_buf
operator|)
operator|=
literal|'\0'
expr_stmt|;
return|return
operator|(
name|nsap_ascii_output
operator|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|ISIS_COMMON_HEADER_SIZE
value|(sizeof(struct isis_common_header))
end_define

begin_define
define|#
directive|define
name|ISIS_IIH_LAN_HEADER_SIZE
value|(sizeof(struct isis_iih_lan_header))
end_define

begin_define
define|#
directive|define
name|ISIS_IIH_PTP_HEADER_SIZE
value|(sizeof(struct isis_iih_ptp_header))
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_HEADER_SIZE
value|(sizeof(struct isis_lsp_header))
end_define

begin_define
define|#
directive|define
name|ISIS_CSNP_HEADER_SIZE
value|(sizeof(struct isis_csnp_header))
end_define

begin_define
define|#
directive|define
name|ISIS_PSNP_HEADER_SIZE
value|(sizeof(struct isis_psnp_header))
end_define

begin_function
name|void
name|isoclns_print
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|p
parameter_list|,
name|u_int
name|length
parameter_list|,
name|u_int
name|caplen
parameter_list|)
block|{
specifier|const
name|struct
name|isis_common_header
modifier|*
name|header
decl_stmt|;
name|header
operator|=
operator|(
specifier|const
expr|struct
name|isis_common_header
operator|*
operator|)
name|p
expr_stmt|;
name|printf
argument_list|(
literal|"%sOSI"
argument_list|,
name|caplen
operator|<
literal|1
condition|?
literal|"|"
else|:
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|caplen
operator|<
literal|1
condition|)
comment|/* enough bytes on the wire ? */
return|return;
switch|switch
condition|(
operator|*
name|p
condition|)
block|{
case|case
name|NLPID_CLNS
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|", CLNS, length %u"
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|NLPID_ESIS
case|:
name|esis_print
argument_list|(
name|p
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
case|case
name|NLPID_ISIS
case|:
if|if
condition|(
operator|!
name|isis_print
argument_list|(
name|p
argument_list|,
name|length
argument_list|)
condition|)
name|print_unknown_data
argument_list|(
name|p
argument_list|,
literal|"\n\t"
argument_list|,
name|caplen
argument_list|)
expr_stmt|;
break|break;
case|case
name|NLPID_NULLNS
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|", ISO NULLNS, length: %u"
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|", Unknown NLPID 0x%02x, length: %u"
argument_list|,
name|p
index|[
literal|0
index|]
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
name|caplen
operator|>
literal|1
condition|)
name|print_unknown_data
argument_list|(
name|p
argument_list|,
literal|"\n\t"
argument_list|,
name|caplen
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|ESIS_REDIRECT
value|6
end_define

begin_define
define|#
directive|define
name|ESIS_ESH
value|2
end_define

begin_define
define|#
directive|define
name|ESIS_ISH
value|4
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|esis_values
index|[]
init|=
block|{
block|{
name|ESIS_REDIRECT
block|,
literal|"redirect"
block|}
block|,
block|{
name|ESIS_ESH
block|,
literal|"ESH"
block|}
block|,
block|{
name|ESIS_ISH
block|,
literal|"ISH"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|esis_hdr
block|{
name|u_int8_t
name|version
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|type
decl_stmt|;
name|u_int8_t
name|tmo
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|cksum
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|esis_print
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|p
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
specifier|const
name|u_int8_t
modifier|*
name|ep
decl_stmt|;
name|u_int
name|li
decl_stmt|;
specifier|const
name|struct
name|esis_hdr
modifier|*
name|eh
decl_stmt|;
if|if
condition|(
name|length
operator|<=
literal|2
condition|)
block|{
if|if
condition|(
name|qflag
condition|)
name|printf
argument_list|(
literal|" bad pkt!"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" no header at all!"
argument_list|)
expr_stmt|;
return|return;
block|}
name|li
operator|=
name|p
index|[
literal|1
index|]
expr_stmt|;
name|eh
operator|=
operator|(
specifier|const
expr|struct
name|esis_hdr
operator|*
operator|)
operator|&
name|p
index|[
literal|2
index|]
expr_stmt|;
name|ep
operator|=
name|p
operator|+
name|li
expr_stmt|;
if|if
condition|(
name|li
operator|>
name|length
condition|)
block|{
if|if
condition|(
name|qflag
condition|)
name|printf
argument_list|(
literal|" bad pkt!"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" LI(%d)> PDU size (%d)!"
argument_list|,
name|li
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|li
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|esis_hdr
argument_list|)
operator|+
literal|2
condition|)
block|{
if|if
condition|(
name|qflag
condition|)
name|printf
argument_list|(
literal|" bad pkt!"
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|" too short for esis header %d:"
argument_list|,
name|li
argument_list|)
expr_stmt|;
while|while
condition|(
operator|--
name|length
operator|!=
literal|0
condition|)
name|printf
argument_list|(
literal|"%02X"
argument_list|,
operator|*
name|p
operator|++
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
name|printf
argument_list|(
literal|", ES-IS, %s, length %u"
argument_list|,
name|tok2str
argument_list|(
name|esis_values
argument_list|,
literal|"unknown type: %u"
argument_list|,
name|eh
operator|->
name|type
operator|&
literal|0x1f
argument_list|)
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
name|vflag
operator|<
literal|1
condition|)
return|return;
if|if
condition|(
name|vflag
operator|&&
name|osi_cksum
argument_list|(
name|p
argument_list|,
name|li
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|" bad cksum (got 0x%02x%02x)"
argument_list|,
name|eh
operator|->
name|cksum
index|[
literal|1
index|]
argument_list|,
name|eh
operator|->
name|cksum
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|default_print
argument_list|(
name|p
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|eh
operator|->
name|version
operator|!=
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|" unsupported version %d"
argument_list|,
name|eh
operator|->
name|version
argument_list|)
expr_stmt|;
return|return;
block|}
name|p
operator|+=
sizeof|sizeof
argument_list|(
operator|*
name|eh
argument_list|)
operator|+
literal|2
expr_stmt|;
name|li
operator|-=
sizeof|sizeof
argument_list|(
operator|*
name|eh
argument_list|)
operator|+
literal|2
expr_stmt|;
comment|/* protoid * li */
switch|switch
condition|(
name|eh
operator|->
name|type
operator|&
literal|0x1f
condition|)
block|{
case|case
name|ESIS_REDIRECT
case|:
block|{
specifier|const
name|u_int8_t
modifier|*
name|dst
decl_stmt|,
modifier|*
name|snpa
decl_stmt|,
modifier|*
name|is
decl_stmt|;
name|dst
operator|=
name|p
expr_stmt|;
name|p
operator|+=
operator|*
name|p
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|p
operator|>
name|snapend
condition|)
return|return;
name|printf
argument_list|(
literal|"\n\t\t %s"
argument_list|,
name|isonsap_string
argument_list|(
name|dst
argument_list|)
argument_list|)
expr_stmt|;
name|snpa
operator|=
name|p
expr_stmt|;
name|p
operator|+=
operator|*
name|p
operator|+
literal|1
expr_stmt|;
name|is
operator|=
name|p
expr_stmt|;
name|p
operator|+=
operator|*
name|p
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|p
operator|>
name|snapend
condition|)
return|return;
if|if
condition|(
name|p
operator|>
name|ep
condition|)
block|{
name|printf
argument_list|(
literal|" [bad li]"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|is
index|[
literal|0
index|]
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"> %s"
argument_list|,
name|etheraddr_string
argument_list|(
operator|&
name|snpa
index|[
literal|1
index|]
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"> %s"
argument_list|,
name|isonsap_string
argument_list|(
name|is
argument_list|)
argument_list|)
expr_stmt|;
name|li
operator|=
name|ep
operator|-
name|p
expr_stmt|;
break|break;
block|}
case|case
name|ESIS_ESH
case|:
break|break;
case|case
name|ESIS_ISH
case|:
block|{
specifier|const
name|u_int8_t
modifier|*
name|is
decl_stmt|;
name|is
operator|=
name|p
expr_stmt|;
name|p
operator|+=
operator|*
name|p
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|p
operator|>
name|ep
condition|)
block|{
name|printf
argument_list|(
literal|" [bad li]"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|p
operator|>
name|snapend
condition|)
return|return;
if|if
condition|(
operator|!
name|qflag
condition|)
name|printf
argument_list|(
literal|"\n\tNET: %s"
argument_list|,
name|print_nsap
argument_list|(
name|is
operator|+
literal|1
argument_list|,
operator|*
name|is
argument_list|)
argument_list|)
expr_stmt|;
name|li
operator|=
name|ep
operator|-
name|p
expr_stmt|;
break|break;
block|}
default|default:
if|if
condition|(
name|vflag
operator|<=
literal|1
condition|)
block|{
if|if
condition|(
name|p
operator|<
name|snapend
condition|)
name|print_unknown_data
argument_list|(
name|p
argument_list|,
literal|"\n\t  "
argument_list|,
name|snapend
operator|-
name|p
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
comment|/* hexdump - FIXME ? */
if|if
condition|(
name|vflag
operator|>
literal|1
condition|)
block|{
if|if
condition|(
name|p
operator|<
name|snapend
condition|)
name|print_unknown_data
argument_list|(
name|p
argument_list|,
literal|"\n\t  "
argument_list|,
name|snapend
operator|-
name|p
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|vflag
condition|)
while|while
condition|(
name|p
operator|<
name|ep
operator|&&
name|li
condition|)
block|{
name|u_int
name|op
decl_stmt|,
name|opli
decl_stmt|;
specifier|const
name|u_int8_t
modifier|*
name|q
decl_stmt|;
if|if
condition|(
name|snapend
operator|-
name|p
operator|<
literal|2
condition|)
return|return;
if|if
condition|(
name|li
operator|<
literal|2
condition|)
block|{
name|printf
argument_list|(
literal|", bad opts/li"
argument_list|)
expr_stmt|;
return|return;
block|}
name|op
operator|=
operator|*
name|p
operator|++
expr_stmt|;
name|opli
operator|=
operator|*
name|p
operator|++
expr_stmt|;
name|li
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|opli
operator|>
name|li
condition|)
block|{
name|printf
argument_list|(
literal|", opt (%d) too long"
argument_list|,
name|op
argument_list|)
expr_stmt|;
return|return;
block|}
name|li
operator|-=
name|opli
expr_stmt|;
name|q
operator|=
name|p
expr_stmt|;
name|p
operator|+=
name|opli
expr_stmt|;
if|if
condition|(
name|snapend
operator|<
name|p
condition|)
return|return;
if|if
condition|(
name|op
operator|==
name|TLV_HOLDTIME
operator|&&
name|opli
operator|==
literal|2
condition|)
block|{
name|printf
argument_list|(
literal|"\n\tholdtime: %us"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|q
argument_list|)
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|op
operator|==
name|TLV_PROTOCOLS
operator|&&
name|opli
operator|>=
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t%s (length: %u): %s"
argument_list|,
name|tok2str
argument_list|(
name|isis_tlv_values
argument_list|,
literal|"unknown"
argument_list|,
name|op
argument_list|)
argument_list|,
name|opli
argument_list|,
name|tok2str
argument_list|(
name|osi_nlpid_values
argument_list|,
literal|"Unknown 0x%02x"
argument_list|,
operator|*
name|q
argument_list|)
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|print_unknown_data
argument_list|(
name|q
argument_list|,
literal|"\n\t  "
argument_list|,
name|opli
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* shared routine for printing system, node and lsp-ids */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|isis_print_id
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|cp
parameter_list|,
name|int
name|id_len
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
specifier|static
name|char
name|id
index|[
sizeof|sizeof
argument_list|(
literal|"xxxx.xxxx.xxxx.yy-zz"
argument_list|)
index|]
decl_stmt|;
name|char
modifier|*
name|pos
init|=
name|id
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|SYSTEM_ID_LEN
condition|;
name|i
operator|++
control|)
block|{
name|snprintf
argument_list|(
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|id
argument_list|)
operator|-
operator|(
name|pos
operator|-
name|id
operator|)
argument_list|,
literal|"%02x"
argument_list|,
operator|*
name|cp
operator|++
argument_list|)
expr_stmt|;
name|pos
operator|+=
name|strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|2
operator|||
name|i
operator|==
literal|4
condition|)
operator|*
name|pos
operator|++
operator|=
literal|'.'
expr_stmt|;
block|}
if|if
condition|(
name|id_len
operator|>=
name|NODE_ID_LEN
condition|)
block|{
name|snprintf
argument_list|(
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|id
argument_list|)
operator|-
operator|(
name|pos
operator|-
name|id
operator|)
argument_list|,
literal|".%02x"
argument_list|,
operator|*
name|cp
operator|++
argument_list|)
expr_stmt|;
name|pos
operator|+=
name|strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|id_len
operator|==
name|LSP_ID_LEN
condition|)
name|snprintf
argument_list|(
name|pos
argument_list|,
sizeof|sizeof
argument_list|(
name|id
argument_list|)
operator|-
operator|(
name|pos
operator|-
name|id
operator|)
argument_list|,
literal|"-%02x"
argument_list|,
operator|*
name|cp
argument_list|)
expr_stmt|;
return|return
operator|(
name|id
operator|)
return|;
block|}
end_function

begin_comment
comment|/* print the 4-byte metric block which is common found in the old-style TLVs */
end_comment

begin_function
specifier|static
name|int
name|isis_print_metric_block
parameter_list|(
specifier|const
name|struct
name|isis_metric_block
modifier|*
name|isis_metric_block
parameter_list|)
block|{
name|printf
argument_list|(
literal|", Default Metric: %d, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|isis_metric_block
operator|->
name|metric_default
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|isis_metric_block
operator|->
name|metric_default
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|isis_metric_block
operator|->
name|metric_delay
argument_list|)
condition|)
name|printf
argument_list|(
literal|"\n\t\t  Delay Metric: %d, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|isis_metric_block
operator|->
name|metric_delay
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|isis_metric_block
operator|->
name|metric_delay
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|isis_metric_block
operator|->
name|metric_expense
argument_list|)
condition|)
name|printf
argument_list|(
literal|"\n\t\t  Expense Metric: %d, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|isis_metric_block
operator|->
name|metric_expense
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|isis_metric_block
operator|->
name|metric_expense
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|isis_metric_block
operator|->
name|metric_error
argument_list|)
condition|)
name|printf
argument_list|(
literal|"\n\t\t  Error Metric: %d, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|isis_metric_block
operator|->
name|metric_error
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|isis_metric_block
operator|->
name|metric_error
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
comment|/* everything is ok */
block|}
end_function

begin_function
specifier|static
name|int
name|isis_print_tlv_ip_reach
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|cp
parameter_list|,
specifier|const
name|char
modifier|*
name|ident
parameter_list|,
name|int
name|length
parameter_list|)
block|{
name|int
name|prefix_len
decl_stmt|;
specifier|const
name|struct
name|isis_tlv_ip_reach
modifier|*
name|tlv_ip_reach
decl_stmt|;
name|tlv_ip_reach
operator|=
operator|(
specifier|const
expr|struct
name|isis_tlv_ip_reach
operator|*
operator|)
name|cp
expr_stmt|;
while|while
condition|(
name|length
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|size_t
operator|)
name|length
operator|<
sizeof|sizeof
argument_list|(
operator|*
name|tlv_ip_reach
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"short IPv4 Reachability (%d vs %lu)"
argument_list|,
name|length
argument_list|,
operator|(
name|unsigned
name|long
operator|)
sizeof|sizeof
argument_list|(
operator|*
name|tlv_ip_reach
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
operator|!
name|TTEST
argument_list|(
operator|*
name|tlv_ip_reach
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|prefix_len
operator|=
name|mask2plen
argument_list|(
name|EXTRACT_32BITS
argument_list|(
name|tlv_ip_reach
operator|->
name|mask
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|prefix_len
operator|==
operator|-
literal|1
condition|)
name|printf
argument_list|(
literal|"%sIPv4 prefix: %s mask %s"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
operator|(
name|tlv_ip_reach
operator|->
name|prefix
operator|)
argument_list|)
argument_list|,
name|ipaddr_string
argument_list|(
operator|(
name|tlv_ip_reach
operator|->
name|mask
operator|)
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%sIPv4 prefix: %15s/%u"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
operator|(
name|tlv_ip_reach
operator|->
name|prefix
operator|)
argument_list|)
argument_list|,
name|prefix_len
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", Distribution: %s, Metric: %u, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_UPDOWN
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_default
argument_list|)
condition|?
literal|"down"
else|:
literal|"up"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_default
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_default
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_delay
argument_list|)
condition|)
name|printf
argument_list|(
literal|"%s  Delay Metric: %u, %s"
argument_list|,
name|ident
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_delay
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_delay
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_expense
argument_list|)
condition|)
name|printf
argument_list|(
literal|"%s  Expense Metric: %u, %s"
argument_list|,
name|ident
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_expense
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_expense
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_error
argument_list|)
condition|)
name|printf
argument_list|(
literal|"%s  Error Metric: %u, %s"
argument_list|,
name|ident
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_error
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_ip_reach
operator|->
name|isis_metric_block
operator|.
name|metric_error
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
name|length
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_tlv_ip_reach
argument_list|)
expr_stmt|;
name|tlv_ip_reach
operator|++
expr_stmt|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * this is the common IP-REACH subTLV decoder it is called  * from various EXTD-IP REACH TLVs (135,235,236,237)  */
end_comment

begin_function
specifier|static
name|int
name|isis_print_ip_reach_subtlv
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|tptr
parameter_list|,
name|int
name|subt
parameter_list|,
name|int
name|subl
parameter_list|,
specifier|const
name|char
modifier|*
name|ident
parameter_list|)
block|{
comment|/* first lets see if we know the subTLVs name*/
name|printf
argument_list|(
literal|"%s%s subTLV #%u, length: %u"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|isis_ext_ip_reach_subtlv_values
argument_list|,
literal|"unknown"
argument_list|,
name|subt
argument_list|)
argument_list|,
name|subt
argument_list|,
name|subl
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|subl
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
switch|switch
condition|(
name|subt
condition|)
block|{
case|case
name|SUBTLV_EXTD_IP_REACH_ADMIN_TAG32
case|:
while|while
condition|(
name|subl
operator|>=
literal|4
condition|)
block|{
name|printf
argument_list|(
literal|", 0x%08x (=%u)"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
name|subl
operator|-=
literal|4
expr_stmt|;
block|}
break|break;
case|case
name|SUBTLV_EXTD_IP_REACH_ADMIN_TAG64
case|:
while|while
condition|(
name|subl
operator|>=
literal|8
condition|)
block|{
name|printf
argument_list|(
literal|", 0x%08x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|8
expr_stmt|;
name|subl
operator|-=
literal|8
expr_stmt|;
block|}
break|break;
default|default:
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|tptr
argument_list|,
literal|"\n\t\t    "
argument_list|,
name|subl
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
break|break;
block|}
return|return
operator|(
literal|1
operator|)
return|;
name|trunctlv
label|:
name|printf
argument_list|(
literal|"%spacket exceeded snapshot"
argument_list|,
name|ident
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * this is the common IS-REACH subTLV decoder it is called  * from isis_print_ext_is_reach()  */
end_comment

begin_function
specifier|static
name|int
name|isis_print_is_reach_subtlv
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|tptr
parameter_list|,
name|int
name|subt
parameter_list|,
name|int
name|subl
parameter_list|,
specifier|const
name|char
modifier|*
name|ident
parameter_list|)
block|{
name|int
name|priority_level
decl_stmt|;
union|union
block|{
comment|/* int to float conversion buffer for several subTLVs */
name|float
name|f
decl_stmt|;
name|u_int32_t
name|i
decl_stmt|;
block|}
name|bw
union|;
comment|/* first lets see if we know the subTLVs name*/
name|printf
argument_list|(
literal|"%s%s subTLV #%u, length: %u"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|isis_ext_is_reach_subtlv_values
argument_list|,
literal|"unknown"
argument_list|,
name|subt
argument_list|)
argument_list|,
name|subt
argument_list|,
name|subl
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|subl
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
switch|switch
condition|(
name|subt
condition|)
block|{
case|case
name|SUBTLV_EXT_IS_REACH_ADMIN_GROUP
case|:
case|case
name|SUBTLV_EXT_IS_REACH_LINK_LOCAL_REMOTE_ID
case|:
case|case
name|SUBTLV_EXT_IS_REACH_LINK_REMOTE_ID
case|:
if|if
condition|(
name|subl
operator|>=
literal|4
condition|)
block|{
name|printf
argument_list|(
literal|", 0x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|subl
operator|==
literal|8
condition|)
comment|/* draft-ietf-isis-gmpls-extensions */
name|printf
argument_list|(
literal|", 0x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_IPV4_INTF_ADDR
case|:
case|case
name|SUBTLV_EXT_IS_REACH_IPV4_NEIGHBOR_ADDR
case|:
if|if
condition|(
name|subl
operator|>=
literal|4
condition|)
name|printf
argument_list|(
literal|", %s"
argument_list|,
name|ipaddr_string
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_MAX_LINK_BW
case|:
case|case
name|SUBTLV_EXT_IS_REACH_RESERVABLE_BW
case|:
if|if
condition|(
name|subl
operator|>=
literal|4
condition|)
block|{
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", %.3f Mbps"
argument_list|,
name|bw
operator|.
name|f
operator|*
literal|8
operator|/
literal|1000000
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_UNRESERVED_BW
case|:
if|if
condition|(
name|subl
operator|>=
literal|32
condition|)
block|{
for|for
control|(
name|priority_level
operator|=
literal|0
init|;
name|priority_level
operator|<
literal|8
condition|;
name|priority_level
operator|++
control|)
block|{
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s  priority level %d: %.3f Mbps"
argument_list|,
name|ident
argument_list|,
name|priority_level
argument_list|,
name|bw
operator|.
name|f
operator|*
literal|8
operator|/
literal|1000000
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
block|}
block|}
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_TE_METRIC
case|:
if|if
condition|(
name|subl
operator|>=
literal|3
condition|)
name|printf
argument_list|(
literal|", %u"
argument_list|,
name|EXTRACT_24BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_LINK_PROTECTION_TYPE
case|:
if|if
condition|(
name|subl
operator|>=
literal|2
condition|)
block|{
name|printf
argument_list|(
literal|", %s, Priority %u"
argument_list|,
name|bittok2str
argument_list|(
name|gmpls_link_prot_values
argument_list|,
literal|"none"
argument_list|,
operator|*
name|tptr
argument_list|)
argument_list|,
operator|*
operator|(
name|tptr
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_INTF_SW_CAP_DESCR
case|:
if|if
condition|(
name|subl
operator|>=
literal|36
condition|)
block|{
name|printf
argument_list|(
literal|"%s  Interface Switching Capability:%s"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|gmpls_switch_cap_values
argument_list|,
literal|"Unknown"
argument_list|,
operator|*
operator|(
name|tptr
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", LSP Encoding: %s"
argument_list|,
name|tok2str
argument_list|(
name|gmpls_encoding_values
argument_list|,
literal|"Unknown"
argument_list|,
operator|*
operator|(
name|tptr
operator|+
literal|1
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
name|printf
argument_list|(
literal|"%s  Max LSP Bandwidth:"
argument_list|,
name|ident
argument_list|)
expr_stmt|;
for|for
control|(
name|priority_level
operator|=
literal|0
init|;
name|priority_level
operator|<
literal|8
condition|;
name|priority_level
operator|++
control|)
block|{
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s    priority level %d: %.3f Mbps"
argument_list|,
name|ident
argument_list|,
name|priority_level
argument_list|,
name|bw
operator|.
name|f
operator|*
literal|8
operator|/
literal|1000000
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
block|}
name|subl
operator|-=
literal|36
expr_stmt|;
comment|/* there is some optional stuff left to decode but this is as of yet                  not specified so just lets hexdump what is left */
if|if
condition|(
name|subl
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|tptr
argument_list|,
literal|"\n\t\t    "
argument_list|,
name|subl
operator|-
literal|36
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
break|break;
default|default:
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|tptr
argument_list|,
literal|"\n\t\t    "
argument_list|,
name|subl
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
break|break;
block|}
return|return
operator|(
literal|1
operator|)
return|;
name|trunctlv
label|:
name|printf
argument_list|(
literal|"%spacket exceeded snapshot"
argument_list|,
name|ident
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * this is the common IS-REACH decoder it is called  * from various EXTD-IS REACH style TLVs (22,24,222)  */
end_comment

begin_function
specifier|static
name|int
name|isis_print_ext_is_reach
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|tptr
parameter_list|,
specifier|const
name|char
modifier|*
name|ident
parameter_list|,
name|int
name|tlv_type
parameter_list|)
block|{
name|char
name|ident_buffer
index|[
literal|20
index|]
decl_stmt|;
name|int
name|subtlv_type
decl_stmt|,
name|subtlv_len
decl_stmt|,
name|subtlv_sum_len
decl_stmt|;
name|int
name|proc_bytes
init|=
literal|0
decl_stmt|;
comment|/* how many bytes did we process ? */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|NODE_ID_LEN
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|printf
argument_list|(
literal|"%sIS Neighbor: %s"
argument_list|,
name|ident
argument_list|,
name|isis_print_id
argument_list|(
name|tptr
argument_list|,
name|NODE_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
operator|(
name|NODE_ID_LEN
operator|)
expr_stmt|;
if|if
condition|(
name|tlv_type
operator|!=
name|TLV_IS_ALIAS_ID
condition|)
block|{
comment|/* the Alias TLV Metric field is implicit 0 */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|3
argument_list|)
condition|)
comment|/* and is therefore skipped */
return|return
operator|(
literal|0
operator|)
return|;
name|printf
argument_list|(
literal|", Metric: %d"
argument_list|,
name|EXTRACT_24BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|3
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|subtlv_sum_len
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
comment|/* read out subTLV length */
name|proc_bytes
operator|=
name|NODE_ID_LEN
operator|+
literal|3
operator|+
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|", %ssub-TLVs present"
argument_list|,
name|subtlv_sum_len
condition|?
literal|""
else|:
literal|"no "
argument_list|)
expr_stmt|;
if|if
condition|(
name|subtlv_sum_len
condition|)
block|{
name|printf
argument_list|(
literal|" (%u)"
argument_list|,
name|subtlv_sum_len
argument_list|)
expr_stmt|;
while|while
condition|(
name|subtlv_sum_len
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|2
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|subtlv_type
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
name|subtlv_len
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
comment|/* prepend the ident string */
name|snprintf
argument_list|(
name|ident_buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|ident_buffer
argument_list|)
argument_list|,
literal|"%s  "
argument_list|,
name|ident
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isis_print_is_reach_subtlv
argument_list|(
name|tptr
argument_list|,
name|subtlv_type
argument_list|,
name|subtlv_len
argument_list|,
name|ident_buffer
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|tptr
operator|+=
name|subtlv_len
expr_stmt|;
name|subtlv_sum_len
operator|-=
operator|(
name|subtlv_len
operator|+
literal|2
operator|)
expr_stmt|;
name|proc_bytes
operator|+=
operator|(
name|subtlv_len
operator|+
literal|2
operator|)
expr_stmt|;
block|}
block|}
return|return
operator|(
name|proc_bytes
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * this is the common Multi Topology ID decoder  * it is called from various MT-TLVs (222,229,235,237)  */
end_comment

begin_function
specifier|static
name|int
name|isis_print_mtid
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|tptr
parameter_list|,
specifier|const
name|char
modifier|*
name|ident
parameter_list|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|2
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|printf
argument_list|(
literal|"%s%s"
argument_list|,
name|ident
argument_list|,
name|tok2str
argument_list|(
name|isis_mt_values
argument_list|,
literal|"Reserved for IETF Consensus"
argument_list|,
name|ISIS_MASK_MTID
argument_list|(
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" Topology (0x%03x), Flags: [%s]"
argument_list|,
name|ISIS_MASK_MTID
argument_list|(
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
argument_list|,
name|bittok2str
argument_list|(
name|isis_mt_flag_values
argument_list|,
literal|"none"
argument_list|,
name|ISIS_MASK_MTFLAGS
argument_list|(
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
literal|2
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * this is the common extended IP reach decoder  * it is called from TLVs (135,235,236,237)  * we process the TLV and optional subTLVs and return  * the amount of processed bytes  */
end_comment

begin_function
specifier|static
name|int
name|isis_print_extd_ip_reach
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|tptr
parameter_list|,
specifier|const
name|char
modifier|*
name|ident
parameter_list|,
name|u_int16_t
name|afi
parameter_list|)
block|{
name|char
name|ident_buffer
index|[
literal|20
index|]
decl_stmt|;
name|u_int8_t
name|prefix
index|[
literal|16
index|]
decl_stmt|;
comment|/* shared copy buffer for IPv4 and IPv6 prefixes */
name|u_int
name|metric
decl_stmt|,
name|status_byte
decl_stmt|,
name|bit_length
decl_stmt|,
name|byte_length
decl_stmt|,
name|sublen
decl_stmt|,
name|processed
decl_stmt|,
name|subtlvtype
decl_stmt|,
name|subtlvlen
decl_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|metric
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
expr_stmt|;
name|processed
operator|=
literal|4
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|afi
operator|==
name|IPV4
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
comment|/* fetch status byte */
return|return
operator|(
literal|0
operator|)
return|;
name|status_byte
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
name|bit_length
operator|=
name|status_byte
operator|&
literal|0x3f
expr_stmt|;
name|processed
operator|++
expr_stmt|;
ifdef|#
directive|ifdef
name|INET6
block|}
elseif|else
if|if
condition|(
name|afi
operator|==
name|IPV6
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
comment|/* fetch status& prefix_len byte */
return|return
operator|(
literal|0
operator|)
return|;
name|status_byte
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
name|bit_length
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
name|processed
operator|+=
literal|2
expr_stmt|;
endif|#
directive|endif
block|}
else|else
return|return
operator|(
literal|0
operator|)
return|;
comment|/* somebody is fooling us */
name|byte_length
operator|=
operator|(
name|bit_length
operator|+
literal|7
operator|)
operator|/
literal|8
expr_stmt|;
comment|/* prefix has variable length encoding */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|byte_length
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|memset
argument_list|(
name|prefix
argument_list|,
literal|0
argument_list|,
literal|16
argument_list|)
expr_stmt|;
comment|/* clear the copy buffer */
name|memcpy
argument_list|(
name|prefix
argument_list|,
name|tptr
argument_list|,
name|byte_length
argument_list|)
expr_stmt|;
comment|/* copy as much as is stored in the TLV */
name|tptr
operator|+=
name|byte_length
expr_stmt|;
name|processed
operator|+=
name|byte_length
expr_stmt|;
if|if
condition|(
name|afi
operator|==
name|IPV4
condition|)
name|printf
argument_list|(
literal|"%sIPv4 prefix: %15s/%u"
argument_list|,
name|ident
argument_list|,
name|ipaddr_string
argument_list|(
name|prefix
argument_list|)
argument_list|,
name|bit_length
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|INET6
if|if
condition|(
name|afi
operator|==
name|IPV6
condition|)
name|printf
argument_list|(
literal|"%sIPv6 prefix: %s/%u"
argument_list|,
name|ident
argument_list|,
name|ip6addr_string
argument_list|(
name|prefix
argument_list|)
argument_list|,
name|bit_length
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|printf
argument_list|(
literal|", Distribution: %s, Metric: %u"
argument_list|,
name|ISIS_MASK_TLV_EXTD_IP_UPDOWN
argument_list|(
name|status_byte
argument_list|)
condition|?
literal|"down"
else|:
literal|"up"
argument_list|,
name|metric
argument_list|)
expr_stmt|;
if|if
condition|(
name|afi
operator|==
name|IPV4
operator|&&
name|ISIS_MASK_TLV_EXTD_IP_SUBTLV
argument_list|(
name|status_byte
argument_list|)
condition|)
name|printf
argument_list|(
literal|", sub-TLVs present"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|INET6
if|if
condition|(
name|afi
operator|==
name|IPV6
condition|)
name|printf
argument_list|(
literal|", %s%s"
argument_list|,
name|ISIS_MASK_TLV_EXTD_IP6_IE
argument_list|(
name|status_byte
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|,
name|ISIS_MASK_TLV_EXTD_IP6_SUBTLV
argument_list|(
name|status_byte
argument_list|)
condition|?
literal|", sub-TLVs present"
else|:
literal|""
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|(
name|ISIS_MASK_TLV_EXTD_IP_SUBTLV
argument_list|(
name|status_byte
argument_list|)
operator|&&
name|afi
operator|==
name|IPV4
operator|)
operator|||
operator|(
name|ISIS_MASK_TLV_EXTD_IP6_SUBTLV
argument_list|(
name|status_byte
argument_list|)
operator|&&
name|afi
operator|==
name|IPV6
operator|)
condition|)
block|{
comment|/* assume that one prefix can hold more            than one subTLV - therefore the first byte must reflect            the aggregate bytecount of the subTLVs for this prefix         */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|sublen
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
name|processed
operator|+=
name|sublen
operator|+
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|" (%u)"
argument_list|,
name|sublen
argument_list|)
expr_stmt|;
comment|/* print out subTLV length */
while|while
condition|(
name|sublen
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|2
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|subtlvtype
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
name|subtlvlen
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
comment|/* prepend the ident string */
name|snprintf
argument_list|(
name|ident_buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|ident_buffer
argument_list|)
argument_list|,
literal|"%s  "
argument_list|,
name|ident
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isis_print_ip_reach_subtlv
argument_list|(
name|tptr
argument_list|,
name|subtlvtype
argument_list|,
name|subtlvlen
argument_list|,
name|ident_buffer
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|tptr
operator|+=
name|subtlvlen
expr_stmt|;
name|sublen
operator|-=
operator|(
name|subtlvlen
operator|+
literal|2
operator|)
expr_stmt|;
block|}
block|}
return|return
operator|(
name|processed
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * isis_print  * Decode IS-IS packets.  Return 0 on error.  */
end_comment

begin_function
specifier|static
name|int
name|isis_print
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|p
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
specifier|const
name|struct
name|isis_common_header
modifier|*
name|header
decl_stmt|;
specifier|const
name|struct
name|isis_iih_lan_header
modifier|*
name|header_iih_lan
decl_stmt|;
specifier|const
name|struct
name|isis_iih_ptp_header
modifier|*
name|header_iih_ptp
decl_stmt|;
specifier|const
name|struct
name|isis_lsp_header
modifier|*
name|header_lsp
decl_stmt|;
specifier|const
name|struct
name|isis_csnp_header
modifier|*
name|header_csnp
decl_stmt|;
specifier|const
name|struct
name|isis_psnp_header
modifier|*
name|header_psnp
decl_stmt|;
specifier|const
name|struct
name|isis_tlv_lsp
modifier|*
name|tlv_lsp
decl_stmt|;
specifier|const
name|struct
name|isis_tlv_ptp_adj
modifier|*
name|tlv_ptp_adj
decl_stmt|;
specifier|const
name|struct
name|isis_tlv_is_reach
modifier|*
name|tlv_is_reach
decl_stmt|;
specifier|const
name|struct
name|isis_tlv_es_reach
modifier|*
name|tlv_es_reach
decl_stmt|;
name|u_int8_t
name|pdu_type
decl_stmt|,
name|max_area
decl_stmt|,
name|id_length
decl_stmt|,
name|tlv_type
decl_stmt|,
name|tlv_len
decl_stmt|,
name|tmp
decl_stmt|,
name|alen
decl_stmt|,
name|lan_alen
decl_stmt|,
name|prefix_len
decl_stmt|;
name|u_int8_t
name|ext_is_len
decl_stmt|,
name|ext_ip_len
decl_stmt|,
name|mt_len
decl_stmt|;
specifier|const
name|u_int8_t
modifier|*
name|optr
decl_stmt|,
modifier|*
name|pptr
decl_stmt|,
modifier|*
name|tptr
decl_stmt|;
name|u_short
name|packet_len
decl_stmt|,
name|pdu_len
decl_stmt|;
name|u_int
name|i
decl_stmt|;
name|packet_len
operator|=
name|length
expr_stmt|;
name|optr
operator|=
name|p
expr_stmt|;
comment|/* initialize the _o_riginal pointer to the packet start -                  need it for parsing the checksum TLV */
name|header
operator|=
operator|(
specifier|const
expr|struct
name|isis_common_header
operator|*
operator|)
name|p
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|header
argument_list|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|)
expr_stmt|;
name|header_iih_lan
operator|=
operator|(
specifier|const
expr|struct
name|isis_iih_lan_header
operator|*
operator|)
name|pptr
expr_stmt|;
name|header_iih_ptp
operator|=
operator|(
specifier|const
expr|struct
name|isis_iih_ptp_header
operator|*
operator|)
name|pptr
expr_stmt|;
name|header_lsp
operator|=
operator|(
specifier|const
expr|struct
name|isis_lsp_header
operator|*
operator|)
name|pptr
expr_stmt|;
name|header_csnp
operator|=
operator|(
specifier|const
expr|struct
name|isis_csnp_header
operator|*
operator|)
name|pptr
expr_stmt|;
name|header_psnp
operator|=
operator|(
specifier|const
expr|struct
name|isis_psnp_header
operator|*
operator|)
name|pptr
expr_stmt|;
comment|/*      * Sanity checking of the header.      */
if|if
condition|(
name|header
operator|->
name|version
operator|!=
name|ISIS_VERSION
condition|)
block|{
name|printf
argument_list|(
literal|", version %d packet not supported"
argument_list|,
name|header
operator|->
name|version
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|header
operator|->
name|id_length
operator|!=
name|SYSTEM_ID_LEN
operator|)
operator|&&
operator|(
name|header
operator|->
name|id_length
operator|!=
literal|0
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|", system ID length of %d is not supported"
argument_list|,
name|header
operator|->
name|id_length
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|header
operator|->
name|pdu_version
operator|!=
name|ISIS_VERSION
condition|)
block|{
name|printf
argument_list|(
literal|", version %d packet not supported"
argument_list|,
name|header
operator|->
name|pdu_version
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|max_area
operator|=
name|header
operator|->
name|max_area
expr_stmt|;
switch|switch
condition|(
name|max_area
condition|)
block|{
case|case
literal|0
case|:
name|max_area
operator|=
literal|3
expr_stmt|;
comment|/* silly shit */
break|break;
case|case
literal|255
case|:
name|printf
argument_list|(
literal|", bad packet -- 255 areas"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
default|default:
break|break;
block|}
name|id_length
operator|=
name|header
operator|->
name|id_length
expr_stmt|;
switch|switch
condition|(
name|id_length
condition|)
block|{
case|case
literal|0
case|:
name|id_length
operator|=
literal|6
expr_stmt|;
comment|/* silly shit again */
break|break;
case|case
literal|1
case|:
comment|/* 1-8 are valid sys-ID lenghts */
case|case
literal|2
case|:
case|case
literal|3
case|:
case|case
literal|4
case|:
case|case
literal|5
case|:
case|case
literal|6
case|:
case|case
literal|7
case|:
case|case
literal|8
case|:
break|break;
case|case
literal|255
case|:
name|id_length
operator|=
literal|0
expr_stmt|;
comment|/* entirely useless */
break|break;
default|default:
break|break;
block|}
comment|/* toss any non 6-byte sys-ID len PDUs */
if|if
condition|(
name|id_length
operator|!=
literal|6
condition|)
block|{
name|printf
argument_list|(
literal|", bad packet -- illegal sys-ID length (%u)"
argument_list|,
name|id_length
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pdu_type
operator|=
name|header
operator|->
name|pdu_type
expr_stmt|;
comment|/* in non-verbose mode print the basic PDU Type plus PDU specific brief information*/
if|if
condition|(
name|vflag
operator|<
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|", IS-IS, %s"
argument_list|,
name|tok2str
argument_list|(
name|isis_pdu_values
argument_list|,
literal|"unknown PDU-Type %u"
argument_list|,
name|pdu_type
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|pdu_type
condition|)
block|{
case|case
name|L1_LAN_IIH
case|:
case|case
name|L2_LAN_IIH
case|:
name|printf
argument_list|(
literal|", src-id %s"
argument_list|,
name|isis_print_id
argument_list|(
name|header_iih_lan
operator|->
name|source_id
argument_list|,
name|SYSTEM_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", lan-id %s, prio %u"
argument_list|,
name|isis_print_id
argument_list|(
name|header_iih_lan
operator|->
name|lan_id
argument_list|,
name|NODE_ID_LEN
argument_list|)
argument_list|,
name|header_iih_lan
operator|->
name|priority
argument_list|)
expr_stmt|;
break|break;
case|case
name|PTP_IIH
case|:
name|printf
argument_list|(
literal|", src-id %s"
argument_list|,
name|isis_print_id
argument_list|(
name|header_iih_ptp
operator|->
name|source_id
argument_list|,
name|SYSTEM_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|L1_LSP
case|:
case|case
name|L2_LSP
case|:
name|printf
argument_list|(
literal|", lsp-id %s, seq 0x%08x, lifetime %5us"
argument_list|,
name|isis_print_id
argument_list|(
name|header_lsp
operator|->
name|lsp_id
argument_list|,
name|LSP_ID_LEN
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|header_lsp
operator|->
name|sequence_number
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|header_lsp
operator|->
name|remaining_lifetime
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|L1_CSNP
case|:
case|case
name|L2_CSNP
case|:
name|printf
argument_list|(
literal|", src-id %s"
argument_list|,
name|isis_print_id
argument_list|(
name|header_csnp
operator|->
name|source_id
argument_list|,
name|SYSTEM_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|L1_PSNP
case|:
case|case
name|L2_PSNP
case|:
name|printf
argument_list|(
literal|", src-id %s"
argument_list|,
name|isis_print_id
argument_list|(
name|header_psnp
operator|->
name|source_id
argument_list|,
name|SYSTEM_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|", length %u"
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
comment|/* ok they seem to want to know everything - lets fully decode it */
name|printf
argument_list|(
literal|", IS-IS, length: %u"
argument_list|,
name|length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t%s, hlen: %u, v: %u, pdu-v: %u, sys-id-len: %u (%u), max-area: %u (%u)"
argument_list|,
name|tok2str
argument_list|(
name|isis_pdu_values
argument_list|,
literal|"unknown, type %u"
argument_list|,
name|pdu_type
argument_list|)
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
name|header
operator|->
name|version
argument_list|,
name|header
operator|->
name|pdu_version
argument_list|,
name|id_length
argument_list|,
name|header
operator|->
name|id_length
argument_list|,
name|max_area
argument_list|,
name|header
operator|->
name|max_area
argument_list|)
expr_stmt|;
if|if
condition|(
name|vflag
operator|>
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|optr
argument_list|,
literal|"\n\t"
argument_list|,
literal|8
argument_list|)
condition|)
comment|/* provide the _o_riginal pointer */
return|return
operator|(
literal|0
operator|)
return|;
comment|/* for optionally debugging the common header */
block|}
switch|switch
condition|(
name|pdu_type
condition|)
block|{
case|case
name|L1_LAN_IIH
case|:
case|case
name|L2_LAN_IIH
case|:
if|if
condition|(
name|header
operator|->
name|fixed_len
operator|!=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_LAN_HEADER_SIZE
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|", bogus fixed header length %u should be %lu"
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ISIS_IIH_LAN_HEADER_SIZE
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pdu_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|header_iih_lan
operator|->
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|packet_len
operator|>
name|pdu_len
condition|)
block|{
name|packet_len
operator|=
name|pdu_len
expr_stmt|;
comment|/* do TLV decoding as long as it makes sense */
name|length
operator|=
name|pdu_len
expr_stmt|;
block|}
name|TCHECK
argument_list|(
operator|*
name|header_iih_lan
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  source-id: %s,  holding time: %us, Flags: [%s]"
argument_list|,
name|isis_print_id
argument_list|(
name|header_iih_lan
operator|->
name|source_id
argument_list|,
name|SYSTEM_ID_LEN
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|header_iih_lan
operator|->
name|holding_time
argument_list|)
argument_list|,
name|tok2str
argument_list|(
name|isis_iih_circuit_type_values
argument_list|,
literal|"unknown circuit type 0x%02x"
argument_list|,
name|header_iih_lan
operator|->
name|circuit_type
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  lan-id:    %s, Priority: %u, PDU length: %u"
argument_list|,
name|isis_print_id
argument_list|(
name|header_iih_lan
operator|->
name|lan_id
argument_list|,
name|NODE_ID_LEN
argument_list|)
argument_list|,
operator|(
name|header_iih_lan
operator|->
name|priority
operator|)
operator|&
name|PRIORITY_MASK
argument_list|,
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|vflag
operator|>
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|pptr
argument_list|,
literal|"\n\t  "
argument_list|,
name|ISIS_IIH_LAN_HEADER_SIZE
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|packet_len
operator|-=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_LAN_HEADER_SIZE
operator|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_LAN_HEADER_SIZE
operator|)
expr_stmt|;
break|break;
case|case
name|PTP_IIH
case|:
if|if
condition|(
name|header
operator|->
name|fixed_len
operator|!=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_PTP_HEADER_SIZE
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|", bogus fixed header length %u should be %lu"
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ISIS_IIH_PTP_HEADER_SIZE
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pdu_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|header_iih_ptp
operator|->
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|packet_len
operator|>
name|pdu_len
condition|)
block|{
name|packet_len
operator|=
name|pdu_len
expr_stmt|;
comment|/* do TLV decoding as long as it makes sense */
name|length
operator|=
name|pdu_len
expr_stmt|;
block|}
name|TCHECK
argument_list|(
operator|*
name|header_iih_ptp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  source-id: %s, holding time: %us, Flags: [%s]"
argument_list|,
name|isis_print_id
argument_list|(
name|header_iih_ptp
operator|->
name|source_id
argument_list|,
name|SYSTEM_ID_LEN
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|header_iih_ptp
operator|->
name|holding_time
argument_list|)
argument_list|,
name|tok2str
argument_list|(
name|isis_iih_circuit_type_values
argument_list|,
literal|"unknown circuit type 0x%02x"
argument_list|,
name|header_iih_ptp
operator|->
name|circuit_type
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  circuit-id: 0x%02x, PDU length: %u"
argument_list|,
name|header_iih_ptp
operator|->
name|circuit_id
argument_list|,
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|vflag
operator|>
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|pptr
argument_list|,
literal|"\n\t  "
argument_list|,
name|ISIS_IIH_PTP_HEADER_SIZE
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|packet_len
operator|-=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_PTP_HEADER_SIZE
operator|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_PTP_HEADER_SIZE
operator|)
expr_stmt|;
break|break;
case|case
name|L1_LSP
case|:
case|case
name|L2_LSP
case|:
if|if
condition|(
name|header
operator|->
name|fixed_len
operator|!=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_LSP_HEADER_SIZE
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|", bogus fixed header length %u should be %lu"
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ISIS_LSP_HEADER_SIZE
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pdu_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|header_lsp
operator|->
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|packet_len
operator|>
name|pdu_len
condition|)
block|{
name|packet_len
operator|=
name|pdu_len
expr_stmt|;
comment|/* do TLV decoding as long as it makes sense */
name|length
operator|=
name|pdu_len
expr_stmt|;
block|}
name|TCHECK
argument_list|(
operator|*
name|header_lsp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  lsp-id: %s, seq: 0x%08x, lifetime: %5us\n\t  chksum: 0x%04x"
argument_list|,
name|isis_print_id
argument_list|(
name|header_lsp
operator|->
name|lsp_id
argument_list|,
name|LSP_ID_LEN
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|header_lsp
operator|->
name|sequence_number
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|header_lsp
operator|->
name|remaining_lifetime
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|header_lsp
operator|->
name|checksum
argument_list|)
argument_list|)
expr_stmt|;
comment|/* if this is a purge do not attempt to verify the checksum */
if|if
condition|(
name|EXTRACT_16BITS
argument_list|(
name|header_lsp
operator|->
name|remaining_lifetime
argument_list|)
operator|==
literal|0
operator|&&
name|EXTRACT_16BITS
argument_list|(
name|header_lsp
operator|->
name|checksum
argument_list|)
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|" (purged)"
argument_list|)
expr_stmt|;
else|else
comment|/* verify the checksum -              * checking starts at the lsp-id field at byte position [12]              * hence the length needs to be reduced by 12 bytes */
name|printf
argument_list|(
literal|" (%s)"
argument_list|,
operator|(
name|osi_cksum
argument_list|(
operator|(
name|u_int8_t
operator|*
operator|)
name|header_lsp
operator|->
name|lsp_id
argument_list|,
name|length
operator|-
literal|12
argument_list|)
operator|)
condition|?
literal|"incorrect"
else|:
literal|"correct"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", PDU length: %u, Flags: [ %s"
argument_list|,
name|pdu_len
argument_list|,
name|ISIS_MASK_LSP_OL_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"Overload bit set, "
else|:
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISIS_MASK_LSP_ATT_BITS
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ISIS_MASK_LSP_ATT_DEFAULT_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"default "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ISIS_MASK_LSP_ATT_DELAY_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"delay "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ISIS_MASK_LSP_ATT_EXPENSE_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"expense "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ISIS_MASK_LSP_ATT_ERROR_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"error "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"ATT bit set, "
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ISIS_MASK_LSP_PARTITION_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"P bit set, "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s ]"
argument_list|,
name|tok2str
argument_list|(
name|isis_lsp_istype_values
argument_list|,
literal|"Unknown(0x%x)"
argument_list|,
name|ISIS_MASK_LSP_ISTYPE_BITS
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|vflag
operator|>
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|pptr
argument_list|,
literal|"\n\t  "
argument_list|,
name|ISIS_LSP_HEADER_SIZE
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|packet_len
operator|-=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_LSP_HEADER_SIZE
operator|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_LSP_HEADER_SIZE
operator|)
expr_stmt|;
break|break;
case|case
name|L1_CSNP
case|:
case|case
name|L2_CSNP
case|:
if|if
condition|(
name|header
operator|->
name|fixed_len
operator|!=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_CSNP_HEADER_SIZE
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|", bogus fixed header length %u should be %lu"
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ISIS_CSNP_HEADER_SIZE
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pdu_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|header_csnp
operator|->
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|packet_len
operator|>
name|pdu_len
condition|)
block|{
name|packet_len
operator|=
name|pdu_len
expr_stmt|;
comment|/* do TLV decoding as long as it makes sense */
name|length
operator|=
name|pdu_len
expr_stmt|;
block|}
name|TCHECK
argument_list|(
operator|*
name|header_csnp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  source-id:    %s, PDU length: %u"
argument_list|,
name|isis_print_id
argument_list|(
name|header_csnp
operator|->
name|source_id
argument_list|,
name|NODE_ID_LEN
argument_list|)
argument_list|,
name|pdu_len
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  start lsp-id: %s"
argument_list|,
name|isis_print_id
argument_list|(
name|header_csnp
operator|->
name|start_lsp_id
argument_list|,
name|LSP_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  end lsp-id:   %s"
argument_list|,
name|isis_print_id
argument_list|(
name|header_csnp
operator|->
name|end_lsp_id
argument_list|,
name|LSP_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|vflag
operator|>
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|pptr
argument_list|,
literal|"\n\t  "
argument_list|,
name|ISIS_CSNP_HEADER_SIZE
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|packet_len
operator|-=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_CSNP_HEADER_SIZE
operator|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_CSNP_HEADER_SIZE
operator|)
expr_stmt|;
break|break;
case|case
name|L1_PSNP
case|:
case|case
name|L2_PSNP
case|:
if|if
condition|(
name|header
operator|->
name|fixed_len
operator|!=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_PSNP_HEADER_SIZE
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"- bogus fixed header length %u should be %lu"
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ISIS_PSNP_HEADER_SIZE
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pdu_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|header_psnp
operator|->
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|packet_len
operator|>
name|pdu_len
condition|)
block|{
name|packet_len
operator|=
name|pdu_len
expr_stmt|;
comment|/* do TLV decoding as long as it makes sense */
name|length
operator|=
name|pdu_len
expr_stmt|;
block|}
name|TCHECK
argument_list|(
operator|*
name|header_psnp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  source-id:    %s, PDU length: %u"
argument_list|,
name|isis_print_id
argument_list|(
name|header_psnp
operator|->
name|source_id
argument_list|,
name|NODE_ID_LEN
argument_list|)
argument_list|,
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|vflag
operator|>
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|pptr
argument_list|,
literal|"\n\t  "
argument_list|,
name|ISIS_PSNP_HEADER_SIZE
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|packet_len
operator|-=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_PSNP_HEADER_SIZE
operator|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_PSNP_HEADER_SIZE
operator|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|pptr
argument_list|,
literal|"\n\t  "
argument_list|,
name|length
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/*      * Now print the TLV's.      */
while|while
condition|(
name|packet_len
operator|>=
literal|2
condition|)
block|{
if|if
condition|(
name|pptr
operator|==
name|snapend
condition|)
block|{
return|return
operator|(
literal|1
operator|)
return|;
block|}
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|pptr
argument_list|,
literal|2
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t\t packet exceeded snapshot (%ld) bytes"
argument_list|,
call|(
name|long
call|)
argument_list|(
name|pptr
operator|-
name|snapend
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
name|tlv_type
operator|=
operator|*
name|pptr
operator|++
expr_stmt|;
name|tlv_len
operator|=
operator|*
name|pptr
operator|++
expr_stmt|;
name|tmp
operator|=
name|tlv_len
expr_stmt|;
comment|/* copy temporary len& pointer to packet data */
name|tptr
operator|=
name|pptr
expr_stmt|;
name|packet_len
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|tlv_len
operator|>
name|packet_len
condition|)
block|{
break|break;
block|}
comment|/* first lets see if we know the TLVs name*/
name|printf
argument_list|(
literal|"\n\t    %s TLV #%u, length: %u"
argument_list|,
name|tok2str
argument_list|(
name|isis_tlv_values
argument_list|,
literal|"unknown"
argument_list|,
name|tlv_type
argument_list|)
argument_list|,
name|tlv_type
argument_list|,
name|tlv_len
argument_list|)
expr_stmt|;
comment|/* now check if we have a decoder otherwise do a hexdump at the end*/
switch|switch
condition|(
name|tlv_type
condition|)
block|{
case|case
name|TLV_AREA_ADDR
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|alen
operator|=
operator|*
name|tptr
operator|++
expr_stmt|;
while|while
condition|(
name|tmp
operator|&&
name|alen
operator|<
name|tmp
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t      Area address (length: %u): %s"
argument_list|,
name|alen
argument_list|,
name|print_nsap
argument_list|(
name|tptr
argument_list|,
name|alen
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
name|alen
expr_stmt|;
name|tmp
operator|-=
name|alen
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|tmp
operator|==
literal|0
condition|)
comment|/* if this is the last area address do not attemt a boundary check */
break|break;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|alen
operator|=
operator|*
name|tptr
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|TLV_ISNEIGH
case|:
while|while
condition|(
name|tmp
operator|>=
name|ETHER_ADDR_LEN
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      SNPA: %s"
argument_list|,
name|isis_print_id
argument_list|(
name|tptr
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
argument_list|)
expr_stmt|;
name|tmp
operator|-=
name|ETHER_ADDR_LEN
expr_stmt|;
name|tptr
operator|+=
name|ETHER_ADDR_LEN
expr_stmt|;
block|}
break|break;
case|case
name|TLV_ISNEIGH_VARLEN
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|lan_alen
operator|=
operator|*
name|tptr
operator|++
expr_stmt|;
comment|/* LAN adress length */
name|tmp
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      LAN address length %u bytes "
argument_list|,
name|lan_alen
argument_list|)
expr_stmt|;
while|while
condition|(
name|tmp
operator|>=
name|lan_alen
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|lan_alen
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\tIS Neighbor: %s"
argument_list|,
name|isis_print_id
argument_list|(
name|tptr
argument_list|,
name|lan_alen
argument_list|)
argument_list|)
expr_stmt|;
name|tmp
operator|-=
name|lan_alen
expr_stmt|;
name|tptr
operator|+=
name|lan_alen
expr_stmt|;
block|}
break|break;
case|case
name|TLV_PADDING
case|:
break|break;
case|case
name|TLV_MT_IS_REACH
case|:
while|while
condition|(
name|tmp
operator|>=
literal|2
operator|+
name|NODE_ID_LEN
operator|+
literal|3
operator|+
literal|1
condition|)
block|{
name|mt_len
operator|=
name|isis_print_mtid
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|)
expr_stmt|;
if|if
condition|(
name|mt_len
operator|==
literal|0
condition|)
comment|/* did something go wrong ? */
goto|goto
name|trunctlv
goto|;
name|tptr
operator|+=
name|mt_len
expr_stmt|;
name|tmp
operator|-=
name|mt_len
expr_stmt|;
name|ext_is_len
operator|=
name|isis_print_ext_is_reach
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|,
name|tlv_type
argument_list|)
expr_stmt|;
if|if
condition|(
name|ext_is_len
operator|==
literal|0
condition|)
comment|/* did something go wrong ? */
goto|goto
name|trunctlv
goto|;
name|tmp
operator|-=
name|ext_is_len
expr_stmt|;
name|tptr
operator|+=
name|ext_is_len
expr_stmt|;
block|}
break|break;
case|case
name|TLV_IS_ALIAS_ID
case|:
while|while
condition|(
name|tmp
operator|>=
name|NODE_ID_LEN
operator|+
literal|1
condition|)
block|{
comment|/* is it worth attempting a decode ? */
name|ext_is_len
operator|=
name|isis_print_ext_is_reach
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|,
name|tlv_type
argument_list|)
expr_stmt|;
if|if
condition|(
name|ext_is_len
operator|==
literal|0
condition|)
comment|/* did something go wrong ? */
goto|goto
name|trunctlv
goto|;
name|tmp
operator|-=
name|ext_is_len
expr_stmt|;
name|tptr
operator|+=
name|ext_is_len
expr_stmt|;
block|}
break|break;
case|case
name|TLV_EXT_IS_REACH
case|:
while|while
condition|(
name|tmp
operator|>=
name|NODE_ID_LEN
operator|+
literal|3
operator|+
literal|1
condition|)
block|{
comment|/* is it worth attempting a decode ? */
name|ext_is_len
operator|=
name|isis_print_ext_is_reach
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|,
name|tlv_type
argument_list|)
expr_stmt|;
if|if
condition|(
name|ext_is_len
operator|==
literal|0
condition|)
comment|/* did something go wrong ? */
goto|goto
name|trunctlv
goto|;
name|tmp
operator|-=
name|ext_is_len
expr_stmt|;
name|tptr
operator|+=
name|ext_is_len
expr_stmt|;
block|}
break|break;
case|case
name|TLV_IS_REACH
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
comment|/* check if there is one byte left to read out the virtual flag */
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      %s"
argument_list|,
name|tok2str
argument_list|(
name|isis_is_reach_virtual_values
argument_list|,
literal|"bogus virtual flag 0x%02x"
argument_list|,
operator|*
name|tptr
operator|++
argument_list|)
argument_list|)
expr_stmt|;
name|tlv_is_reach
operator|=
operator|(
specifier|const
expr|struct
name|isis_tlv_is_reach
operator|*
operator|)
name|tptr
expr_stmt|;
while|while
condition|(
name|tmp
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_tlv_is_reach
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST
argument_list|(
operator|*
name|tlv_is_reach
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      IS Neighbor: %s"
argument_list|,
name|isis_print_id
argument_list|(
name|tlv_is_reach
operator|->
name|neighbor_nodeid
argument_list|,
name|NODE_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
name|isis_print_metric_block
argument_list|(
operator|&
name|tlv_is_reach
operator|->
name|isis_metric_block
argument_list|)
expr_stmt|;
name|tmp
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_tlv_is_reach
argument_list|)
expr_stmt|;
name|tlv_is_reach
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|TLV_ESNEIGH
case|:
name|tlv_es_reach
operator|=
operator|(
specifier|const
expr|struct
name|isis_tlv_es_reach
operator|*
operator|)
name|tptr
expr_stmt|;
while|while
condition|(
name|tmp
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_tlv_es_reach
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST
argument_list|(
operator|*
name|tlv_es_reach
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      ES Neighbor: %s"
argument_list|,
name|isis_print_id
argument_list|(
name|tlv_es_reach
operator|->
name|neighbor_sysid
argument_list|,
name|SYSTEM_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
name|isis_print_metric_block
argument_list|(
operator|&
name|tlv_es_reach
operator|->
name|isis_metric_block
argument_list|)
expr_stmt|;
name|tmp
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_tlv_es_reach
argument_list|)
expr_stmt|;
name|tlv_es_reach
operator|++
expr_stmt|;
block|}
break|break;
comment|/* those two TLVs share the same format */
case|case
name|TLV_INT_IP_REACH
case|:
case|case
name|TLV_EXT_IP_REACH
case|:
if|if
condition|(
operator|!
name|isis_print_tlv_ip_reach
argument_list|(
name|pptr
argument_list|,
literal|"\n\t      "
argument_list|,
name|tlv_len
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
break|break;
case|case
name|TLV_EXTD_IP_REACH
case|:
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
name|ext_ip_len
operator|=
name|isis_print_extd_ip_reach
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|,
name|IPV4
argument_list|)
expr_stmt|;
if|if
condition|(
name|ext_ip_len
operator|==
literal|0
condition|)
comment|/* did something go wrong ? */
goto|goto
name|trunctlv
goto|;
name|tptr
operator|+=
name|ext_ip_len
expr_stmt|;
name|tmp
operator|-=
name|ext_ip_len
expr_stmt|;
block|}
break|break;
case|case
name|TLV_MT_IP_REACH
case|:
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
name|mt_len
operator|=
name|isis_print_mtid
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|)
expr_stmt|;
if|if
condition|(
name|mt_len
operator|==
literal|0
condition|)
comment|/* did something go wrong ? */
goto|goto
name|trunctlv
goto|;
name|tptr
operator|+=
name|mt_len
expr_stmt|;
name|tmp
operator|-=
name|mt_len
expr_stmt|;
name|ext_ip_len
operator|=
name|isis_print_extd_ip_reach
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|,
name|IPV4
argument_list|)
expr_stmt|;
if|if
condition|(
name|ext_ip_len
operator|==
literal|0
condition|)
comment|/* did something go wrong ? */
goto|goto
name|trunctlv
goto|;
name|tptr
operator|+=
name|ext_ip_len
expr_stmt|;
name|tmp
operator|-=
name|ext_ip_len
expr_stmt|;
block|}
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|TLV_IP6_REACH
case|:
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
name|ext_ip_len
operator|=
name|isis_print_extd_ip_reach
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|,
name|IPV6
argument_list|)
expr_stmt|;
if|if
condition|(
name|ext_ip_len
operator|==
literal|0
condition|)
comment|/* did something go wrong ? */
goto|goto
name|trunctlv
goto|;
name|tptr
operator|+=
name|ext_ip_len
expr_stmt|;
name|tmp
operator|-=
name|ext_ip_len
expr_stmt|;
block|}
break|break;
case|case
name|TLV_MT_IP6_REACH
case|:
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
name|mt_len
operator|=
name|isis_print_mtid
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|)
expr_stmt|;
if|if
condition|(
name|mt_len
operator|==
literal|0
condition|)
comment|/* did something go wrong ? */
goto|goto
name|trunctlv
goto|;
name|tptr
operator|+=
name|mt_len
expr_stmt|;
name|tmp
operator|-=
name|mt_len
expr_stmt|;
name|ext_ip_len
operator|=
name|isis_print_extd_ip_reach
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|,
name|IPV6
argument_list|)
expr_stmt|;
if|if
condition|(
name|ext_ip_len
operator|==
literal|0
condition|)
comment|/* did something go wrong ? */
goto|goto
name|trunctlv
goto|;
name|tptr
operator|+=
name|ext_ip_len
expr_stmt|;
name|tmp
operator|-=
name|ext_ip_len
expr_stmt|;
block|}
break|break;
case|case
name|TLV_IP6ADDR
case|:
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|16
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      IPv6 interface address: %s"
argument_list|,
name|ip6addr_string
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|16
expr_stmt|;
name|tmp
operator|-=
literal|16
expr_stmt|;
block|}
break|break;
endif|#
directive|endif
case|case
name|TLV_AUTH
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      %s: "
argument_list|,
name|tok2str
argument_list|(
name|isis_subtlv_auth_values
argument_list|,
literal|"unknown Authentication type 0x%02x"
argument_list|,
operator|*
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|*
name|tptr
condition|)
block|{
case|case
name|SUBTLV_AUTH_SIMPLE
case|:
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|tlv_len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
operator|(
name|tptr
operator|+
name|i
operator|)
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
operator|*
operator|(
name|tptr
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SUBTLV_AUTH_MD5
case|:
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|tlv_len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
operator|(
name|tptr
operator|+
name|i
operator|)
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
operator|(
name|tptr
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|tlv_len
operator|!=
name|SUBTLV_AUTH_MD5_LEN
operator|+
literal|1
condition|)
name|printf
argument_list|(
literal|", (malformed subTLV) "
argument_list|)
expr_stmt|;
break|break;
case|case
name|SUBTLV_AUTH_PRIVATE
case|:
default|default:
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|tptr
operator|+
literal|1
argument_list|,
literal|"\n\t\t  "
argument_list|,
name|tlv_len
operator|-
literal|1
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
break|break;
block|}
break|break;
case|case
name|TLV_PTP_ADJ
case|:
name|tlv_ptp_adj
operator|=
operator|(
specifier|const
expr|struct
name|isis_tlv_ptp_adj
operator|*
operator|)
name|tptr
expr_stmt|;
if|if
condition|(
name|tmp
operator|>=
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      Adjacency State: %s (%u)"
argument_list|,
name|tok2str
argument_list|(
name|isis_ptp_adjancey_values
argument_list|,
literal|"unknown"
argument_list|,
operator|*
name|tptr
argument_list|)
argument_list|,
operator|*
name|tptr
argument_list|)
expr_stmt|;
name|tmp
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|tmp
operator|>
sizeof|sizeof
argument_list|(
name|tlv_ptp_adj
operator|->
name|extd_local_circuit_id
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_ptp_adj
operator|->
name|extd_local_circuit_id
argument_list|,
sizeof|sizeof
argument_list|(
name|tlv_ptp_adj
operator|->
name|extd_local_circuit_id
argument_list|)
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      Extended Local circuit-ID: 0x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tlv_ptp_adj
operator|->
name|extd_local_circuit_id
argument_list|)
argument_list|)
expr_stmt|;
name|tmp
operator|-=
sizeof|sizeof
argument_list|(
name|tlv_ptp_adj
operator|->
name|extd_local_circuit_id
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|tmp
operator|>=
name|SYSTEM_ID_LEN
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_ptp_adj
operator|->
name|neighbor_sysid
argument_list|,
name|SYSTEM_ID_LEN
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      Neighbor System-ID: %s"
argument_list|,
name|isis_print_id
argument_list|(
name|tlv_ptp_adj
operator|->
name|neighbor_sysid
argument_list|,
name|SYSTEM_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
name|tmp
operator|-=
name|SYSTEM_ID_LEN
expr_stmt|;
block|}
if|if
condition|(
name|tmp
operator|>=
sizeof|sizeof
argument_list|(
name|tlv_ptp_adj
operator|->
name|neighbor_extd_local_circuit_id
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_ptp_adj
operator|->
name|neighbor_extd_local_circuit_id
argument_list|,
sizeof|sizeof
argument_list|(
name|tlv_ptp_adj
operator|->
name|neighbor_extd_local_circuit_id
argument_list|)
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      Neighbor Extended Local circuit-ID: 0x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tlv_ptp_adj
operator|->
name|neighbor_extd_local_circuit_id
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|TLV_PROTOCOLS
case|:
name|printf
argument_list|(
literal|"\n\t      NLPID(s): "
argument_list|)
expr_stmt|;
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
operator|(
name|tptr
operator|)
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"%s (0x%02x)"
argument_list|,
name|tok2str
argument_list|(
name|osi_nlpid_values
argument_list|,
literal|"unknown"
argument_list|,
operator|*
name|tptr
argument_list|)
argument_list|,
operator|*
name|tptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp
operator|>
literal|1
condition|)
comment|/* further NPLIDs ? - put comma */
name|printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|tptr
operator|++
expr_stmt|;
name|tmp
operator|--
expr_stmt|;
block|}
break|break;
case|case
name|TLV_TE_ROUTER_ID
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|pptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      Traffic Engineering Router ID: %s"
argument_list|,
name|ipaddr_string
argument_list|(
name|pptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|TLV_IPADDR
case|:
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      IPv4 interface address: %s"
argument_list|,
name|ipaddr_string
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
name|tmp
operator|-=
literal|4
expr_stmt|;
block|}
break|break;
case|case
name|TLV_HOSTNAME
case|:
name|printf
argument_list|(
literal|"\n\t      Hostname: "
argument_list|)
expr_stmt|;
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
operator|*
name|tptr
operator|++
argument_list|)
expr_stmt|;
name|tmp
operator|--
expr_stmt|;
block|}
break|break;
case|case
name|TLV_SHARED_RISK_GROUP
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|NODE_ID_LEN
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      IS Neighbor: %s"
argument_list|,
name|isis_print_id
argument_list|(
name|tptr
argument_list|,
name|NODE_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
operator|(
name|NODE_ID_LEN
operator|)
expr_stmt|;
name|tmp
operator|-=
operator|(
name|NODE_ID_LEN
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|", Flags: [%s]"
argument_list|,
name|ISIS_MASK_TLV_SHARED_RISK_GROUP
argument_list|(
operator|*
name|tptr
operator|++
argument_list|)
condition|?
literal|"numbered"
else|:
literal|"unnumbered"
argument_list|)
expr_stmt|;
name|tmp
operator|--
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      IPv4 interface address: %s"
argument_list|,
name|ipaddr_string
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
name|tmp
operator|-=
literal|4
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      IPv4 neighbor address: %s"
argument_list|,
name|ipaddr_string
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
name|tmp
operator|-=
literal|4
expr_stmt|;
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      Link-ID: 0x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
name|tmp
operator|-=
literal|4
expr_stmt|;
block|}
break|break;
case|case
name|TLV_LSP
case|:
name|tlv_lsp
operator|=
operator|(
specifier|const
expr|struct
name|isis_tlv_lsp
operator|*
operator|)
name|tptr
expr_stmt|;
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST
argument_list|(
operator|(
name|tlv_lsp
operator|->
name|lsp_id
operator|)
index|[
name|LSP_ID_LEN
operator|-
literal|1
index|]
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      lsp-id: %s"
argument_list|,
name|isis_print_id
argument_list|(
name|tlv_lsp
operator|->
name|lsp_id
argument_list|,
name|LSP_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_lsp
operator|->
name|sequence_number
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|", seq: 0x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tlv_lsp
operator|->
name|sequence_number
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_lsp
operator|->
name|remaining_lifetime
argument_list|,
literal|2
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|", lifetime: %5ds"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tlv_lsp
operator|->
name|remaining_lifetime
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_lsp
operator|->
name|checksum
argument_list|,
literal|2
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|", chksum: 0x%04x"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tlv_lsp
operator|->
name|checksum
argument_list|)
argument_list|)
expr_stmt|;
name|tmp
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_tlv_lsp
argument_list|)
expr_stmt|;
name|tlv_lsp
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|TLV_CHECKSUM
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|2
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      checksum: 0x%04x "
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
comment|/* do not attempt to verify the checksum if it is zero              * most likely a HMAC-MD5 TLV is also present and              * to avoid conflicts the checksum TLV is zeroed.              * see rfc3358 for details              */
if|if
condition|(
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"(unverified)"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"(%s)"
argument_list|,
name|osi_cksum
argument_list|(
name|optr
argument_list|,
name|length
argument_list|)
condition|?
literal|"incorrect"
else|:
literal|"correct"
argument_list|)
expr_stmt|;
break|break;
case|case
name|TLV_MT_SUPPORTED
case|:
while|while
condition|(
name|tmp
operator|>
literal|1
condition|)
block|{
comment|/* length can only be a multiple of 2, otherwise there is 		   something broken -> so decode down until length is 1 */
if|if
condition|(
name|tmp
operator|!=
literal|1
condition|)
block|{
name|mt_len
operator|=
name|isis_print_mtid
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|)
expr_stmt|;
if|if
condition|(
name|mt_len
operator|==
literal|0
condition|)
comment|/* did something go wrong ? */
goto|goto
name|trunctlv
goto|;
name|tptr
operator|+=
name|mt_len
expr_stmt|;
name|tmp
operator|-=
name|mt_len
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"\n\t      malformed MT-ID"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
break|break;
case|case
name|TLV_RESTART_SIGNALING
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|3
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      Flags [%s], Remaining holding time %us"
argument_list|,
name|bittok2str
argument_list|(
name|isis_restart_flag_values
argument_list|,
literal|"none"
argument_list|,
operator|*
name|tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tptr
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|3
expr_stmt|;
break|break;
case|case
name|TLV_IDRP_INFO
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      Inter-Domain Information Type: %s"
argument_list|,
name|tok2str
argument_list|(
name|isis_subtlv_idrp_values
argument_list|,
literal|"Unknown (0x%02x)"
argument_list|,
operator|*
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|*
name|tptr
operator|++
condition|)
block|{
case|case
name|SUBTLV_IDRP_ASN
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|2
argument_list|)
condition|)
comment|/* fetch AS number */
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"AS Number: %u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SUBTLV_IDRP_LOCAL
case|:
case|case
name|SUBTLV_IDRP_RES
case|:
default|default:
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|tptr
argument_list|,
literal|"\n\t      "
argument_list|,
name|tlv_len
operator|-
literal|1
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
break|break;
block|}
break|break;
case|case
name|TLV_LSP_BUFFERSIZE
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|2
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      LSP Buffersize: %u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|TLV_PART_DIS
case|:
while|while
condition|(
name|tmp
operator|>=
name|SYSTEM_ID_LEN
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|SYSTEM_ID_LEN
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      %s"
argument_list|,
name|isis_print_id
argument_list|(
name|tptr
argument_list|,
name|SYSTEM_ID_LEN
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
name|SYSTEM_ID_LEN
expr_stmt|;
name|tmp
operator|-=
name|SYSTEM_ID_LEN
expr_stmt|;
block|}
break|break;
case|case
name|TLV_PREFIX_NEIGH
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|isis_metric_block
argument_list|)
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      Metric Block"
argument_list|)
expr_stmt|;
name|isis_print_metric_block
argument_list|(
operator|(
specifier|const
expr|struct
name|isis_metric_block
operator|*
operator|)
name|tptr
argument_list|)
expr_stmt|;
name|tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_metric_block
argument_list|)
expr_stmt|;
name|tmp
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_metric_block
argument_list|)
expr_stmt|;
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|prefix_len
operator|=
operator|*
name|tptr
operator|++
expr_stmt|;
comment|/* read out prefix length in semioctets*/
name|tmp
operator|--
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|prefix_len
operator|/
literal|2
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\tAddress: %s/%u"
argument_list|,
name|print_nsap
argument_list|(
name|tptr
argument_list|,
name|prefix_len
operator|/
literal|2
argument_list|)
argument_list|,
name|prefix_len
operator|*
literal|4
argument_list|)
expr_stmt|;
name|tptr
operator|+=
name|prefix_len
operator|/
literal|2
expr_stmt|;
name|tmp
operator|-=
name|prefix_len
operator|/
literal|2
expr_stmt|;
block|}
break|break;
case|case
name|TLV_IIH_SEQNR
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
comment|/* check if four bytes are on the wire */
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      Sequence number: %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|TLV_VENDOR_PRIVATE
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|3
argument_list|)
condition|)
comment|/* check if enough byte for a full oui */
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t      Vendor OUI Code: 0x%06x"
argument_list|,
name|EXTRACT_24BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|3
expr_stmt|;
name|tmp
operator|-=
literal|3
expr_stmt|;
if|if
condition|(
name|tmp
operator|>
literal|0
condition|)
comment|/* hexdump the rest */
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|tptr
argument_list|,
literal|"\n\t\t"
argument_list|,
name|tmp
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
break|break;
comment|/*              * FIXME those are the defined TLVs that lack a decoder              * you are welcome to contribute code ;-)              */
case|case
name|TLV_DECNET_PHASE4
case|:
case|case
name|TLV_LUCENT_PRIVATE
case|:
case|case
name|TLV_IPAUTH
case|:
case|case
name|TLV_NORTEL_PRIVATE1
case|:
case|case
name|TLV_NORTEL_PRIVATE2
case|:
default|default:
if|if
condition|(
name|vflag
operator|<=
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|pptr
argument_list|,
literal|"\n\t\t"
argument_list|,
name|tlv_len
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
break|break;
block|}
comment|/* do we want to see an additionally hexdump ? */
if|if
condition|(
name|vflag
operator|>
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|print_unknown_data
argument_list|(
name|pptr
argument_list|,
literal|"\n\t      "
argument_list|,
name|tlv_len
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pptr
operator|+=
name|tlv_len
expr_stmt|;
name|packet_len
operator|-=
name|tlv_len
expr_stmt|;
block|}
if|if
condition|(
name|packet_len
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t      %u straggler bytes"
argument_list|,
name|packet_len
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
name|trunc
label|:
name|fputs
argument_list|(
literal|"[|isis]"
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
name|trunctlv
label|:
name|printf
argument_list|(
literal|"\n\t\t packet exceeded snapshot"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Verify the checksum.  See 8473-1, Appendix C, section C.4.  */
end_comment

begin_function
specifier|static
name|int
name|osi_cksum
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|tptr
parameter_list|,
name|u_int
name|len
parameter_list|)
block|{
name|int32_t
name|c0
init|=
literal|0
decl_stmt|,
name|c1
init|=
literal|0
decl_stmt|;
while|while
condition|(
operator|(
name|int
operator|)
operator|--
name|len
operator|>=
literal|0
condition|)
block|{
name|c0
operator|+=
operator|*
name|tptr
operator|++
expr_stmt|;
name|c0
operator|%=
literal|255
expr_stmt|;
name|c1
operator|+=
name|c0
expr_stmt|;
name|c1
operator|%=
literal|255
expr_stmt|;
block|}
return|return
operator|(
name|c0
operator||
name|c1
operator|)
return|;
block|}
end_function

end_unit

