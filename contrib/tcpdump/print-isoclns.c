begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1992, 1993, 1994, 1995, 1996  *	The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code distributions  * retain the above copyright notice and this paragraph in its entirety, (2)  * distributions including binary code include the above copyright notice and  * this paragraph in its entirety in the documentation or other materials  * provided with the distribution, and (3) all advertising materials mentioning  * features or use of this software display the following acknowledgement:  * ``This product includes software developed by the University of California,  * Lawrence Berkeley Laboratory and its contributors.'' Neither the name of  * the University nor the names of its contributors may be used to endorse  * or promote products derived from this software without specific prior  * written permission.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED  * WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  *  * Original code by Matt Thomas, Digital Equipment Corporation  *  *  * Extensively modified by Hannes Gredler (hannes@juniper.net) for more  * complete IS-IS support.  *  * $FreeBSD$  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
init|=
literal|"@(#) $Header: /tcpdump/master/tcpdump/print-isoclns.c,v 1.36 2002/01/10 09:33:23 guy Exp $ (LBL)"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_include
include|#
directive|include
file|"ethertype.h"
end_include

begin_include
include|#
directive|include
file|"ether.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_define
define|#
directive|define
name|NLPID_CLNS
value|129
end_define

begin_comment
comment|/* 0x81 */
end_comment

begin_define
define|#
directive|define
name|NLPID_ESIS
value|130
end_define

begin_comment
comment|/* 0x82 */
end_comment

begin_define
define|#
directive|define
name|NLPID_ISIS
value|131
end_define

begin_comment
comment|/* 0x83 */
end_comment

begin_define
define|#
directive|define
name|NLPID_IP6
value|0x8e
end_define

begin_define
define|#
directive|define
name|NLPID_IP
value|0xcc
end_define

begin_define
define|#
directive|define
name|NLPID_NULLNS
value|0
end_define

begin_comment
comment|/*  * IS-IS is defined in ISO 10589.  Look there for protocol definitions.  */
end_comment

begin_define
define|#
directive|define
name|SYSTEM_ID_LEN
value|ETHER_ADDR_LEN
end_define

begin_define
define|#
directive|define
name|ISIS_VERSION
value|1
end_define

begin_define
define|#
directive|define
name|PDU_TYPE_MASK
value|0x1F
end_define

begin_define
define|#
directive|define
name|PRIORITY_MASK
value|0x7F
end_define

begin_define
define|#
directive|define
name|L1_LAN_IIH
value|15
end_define

begin_define
define|#
directive|define
name|L2_LAN_IIH
value|16
end_define

begin_define
define|#
directive|define
name|PTP_IIH
value|17
end_define

begin_define
define|#
directive|define
name|L1_LSP
value|18
end_define

begin_define
define|#
directive|define
name|L2_LSP
value|20
end_define

begin_define
define|#
directive|define
name|L1_CSNP
value|24
end_define

begin_define
define|#
directive|define
name|L2_CSNP
value|25
end_define

begin_define
define|#
directive|define
name|L1_PSNP
value|26
end_define

begin_define
define|#
directive|define
name|L2_PSNP
value|27
end_define

begin_comment
comment|/*  * A TLV is a tuple of a type, length and a value and is normally used for  * encoding information in all sorts of places.  This is an enumeration of  * the well known types.  */
end_comment

begin_define
define|#
directive|define
name|TLV_AREA_ADDR
value|1
end_define

begin_define
define|#
directive|define
name|TLV_IS_REACH
value|2
end_define

begin_define
define|#
directive|define
name|TLV_ES_REACH
value|3
end_define

begin_define
define|#
directive|define
name|TLV_SUMMARY
value|5
end_define

begin_define
define|#
directive|define
name|TLV_ISNEIGH
value|6
end_define

begin_define
define|#
directive|define
name|TLV_PADDING
value|8
end_define

begin_define
define|#
directive|define
name|TLV_LSP
value|9
end_define

begin_define
define|#
directive|define
name|TLV_AUTH
value|10
end_define

begin_define
define|#
directive|define
name|TLV_CHECKSUM
value|12
end_define

begin_define
define|#
directive|define
name|TLV_EXT_IS_REACH
value|22
end_define

begin_define
define|#
directive|define
name|TLV_IP_REACH
value|128
end_define

begin_define
define|#
directive|define
name|TLV_PROTOCOLS
value|129
end_define

begin_define
define|#
directive|define
name|TLV_IP_REACH_EXT
value|130
end_define

begin_define
define|#
directive|define
name|TLV_IDRP_INFO
value|131
end_define

begin_define
define|#
directive|define
name|TLV_IPADDR
value|132
end_define

begin_define
define|#
directive|define
name|TLV_IPAUTH
value|133
end_define

begin_define
define|#
directive|define
name|TLV_TE_ROUTER_ID
value|134
end_define

begin_define
define|#
directive|define
name|TLV_EXT_IP_REACH
value|135
end_define

begin_define
define|#
directive|define
name|TLV_HOSTNAME
value|137
end_define

begin_define
define|#
directive|define
name|TLV_RESTART_SIGNALING
value|211
end_define

begin_define
define|#
directive|define
name|TLV_MT_IS_REACH
value|222
end_define

begin_define
define|#
directive|define
name|TLV_MT_SUPPORTED
value|229
end_define

begin_define
define|#
directive|define
name|TLV_IP6ADDR
value|232
end_define

begin_define
define|#
directive|define
name|TLV_MT_REACH
value|235
end_define

begin_define
define|#
directive|define
name|TLV_IP6_REACH
value|236
end_define

begin_define
define|#
directive|define
name|TLV_PTP_ADJ
value|240
end_define

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_ADMIN_GROUP
value|3
end_define

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_IPV4_INTF_ADDR
value|6
end_define

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_IPV4_NEIGHBOR_ADDR
value|8
end_define

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_MAX_LINK_BW
value|9
end_define

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_RESERVABLE_BW
value|10
end_define

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_UNRESERVED_BW
value|11
end_define

begin_define
define|#
directive|define
name|SUBTLV_EXT_IS_REACH_TE_METRIC
value|18
end_define

begin_define
define|#
directive|define
name|SUBTLV_AUTH_SIMPLE
value|1
end_define

begin_define
define|#
directive|define
name|SUBTLV_AUTH_MD5
value|54
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LEVEL_BITS
parameter_list|(
name|x
parameter_list|)
value|((x)&0x1)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_OL_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x4)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ISTYPE_BITS
parameter_list|(
name|x
parameter_list|)
value|((x)&0x3)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_PARTITION_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x80)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ATT_BITS
parameter_list|(
name|x
parameter_list|)
value|((x)&0x78)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ATT_ERROR_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x40)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ATT_EXPENSE_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x20)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ATT_DELAY_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x10)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_LSP_ATT_DEFAULT_BIT
parameter_list|(
name|x
parameter_list|)
value|((x)&0x8)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_TLV_EXT_IP_UPDOWN
parameter_list|(
name|x
parameter_list|)
value|((x)&0x80)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_TLV_EXT_IP_SUBTLV
parameter_list|(
name|x
parameter_list|)
value|((x)&0x40)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_TLV_IP6_UPDOWN
parameter_list|(
name|x
parameter_list|)
value|((x)&0x80)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_TLV_IP6_IE
parameter_list|(
name|x
parameter_list|)
value|((x)&0x40)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_TLV_IP6_SUBTLV
parameter_list|(
name|x
parameter_list|)
value|((x)&0x20)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_RESTART_RR
parameter_list|(
name|x
parameter_list|)
value|((x)&0x1)
end_define

begin_define
define|#
directive|define
name|ISIS_MASK_RESTART_RA
parameter_list|(
name|x
parameter_list|)
value|((x)&0x2)
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TLV_METRIC_SUPPORTED
parameter_list|(
name|x
parameter_list|)
value|((x)&0x80)
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TLV_METRIC_IE
parameter_list|(
name|x
parameter_list|)
value|((x)&0x40)
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TLV_METRIC_UPDOWN
parameter_list|(
name|x
parameter_list|)
value|((x)&0x80)
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TLV_METRIC_VALUE
parameter_list|(
name|x
parameter_list|)
value|((x)&0x3f)
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TYPE_UNUSED0
value|0
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TYPE_LEVEL_1
value|1
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TYPE_UNUSED2
value|2
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_TYPE_LEVEL_2
value|3
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_lsp_istype_values
index|[]
init|=
block|{
block|{
name|ISIS_LSP_TYPE_UNUSED0
block|,
literal|"Unused 0x0 (invalid)"
block|}
block|,
block|{
name|ISIS_LSP_TYPE_LEVEL_1
block|,
literal|"L1 IS"
block|}
block|,
block|{
name|ISIS_LSP_TYPE_UNUSED2
block|,
literal|"Unused 0x2 (invalid)"
block|}
block|,
block|{
name|ISIS_LSP_TYPE_LEVEL_2
block|,
literal|"L1L2 IS"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_nlpid_values
index|[]
init|=
block|{
block|{
name|NLPID_CLNS
block|,
literal|"CLNS"
block|}
block|,
block|{
name|NLPID_IP
block|,
literal|"IPv4"
block|}
block|,
block|{
name|NLPID_IP6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|0
block|,
literal|"unknown"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Katz's point to point adjacency TLV uses codes to tell us the state of  * the remote adjacency.  Enumerate them.  */
end_comment

begin_define
define|#
directive|define
name|ISIS_PTP_ADJ_UP
value|0
end_define

begin_define
define|#
directive|define
name|ISIS_PTP_ADJ_INIT
value|1
end_define

begin_define
define|#
directive|define
name|ISIS_PTP_ADJ_DOWN
value|2
end_define

begin_function_decl
specifier|static
name|int
name|osi_cksum
parameter_list|(
specifier|const
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|,
name|u_char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|esis_print
parameter_list|(
specifier|const
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|isis_print
parameter_list|(
specifier|const
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|struct
name|tok
name|isis_ptp_adjancey_values
index|[]
init|=
block|{
block|{
name|ISIS_PTP_ADJ_UP
block|,
literal|"Up"
block|}
block|,
block|{
name|ISIS_PTP_ADJ_INIT
block|,
literal|"Initializing"
block|}
block|,
block|{
name|ISIS_PTP_ADJ_DOWN
block|,
literal|"Down"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|isis_tlv_ptp_adj
block|{
name|u_char
name|adjacency_state
decl_stmt|;
name|u_char
name|ext_local_circuit_id
index|[
literal|4
index|]
decl_stmt|;
name|u_char
name|neighbor_sysid
index|[
name|SYSTEM_ID_LEN
index|]
decl_stmt|;
name|u_char
name|neighbor_ext_local_circuit_id
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_tlv_ip_reach
block|{
name|u_char
name|metric_default
decl_stmt|;
name|u_char
name|metric_delay
decl_stmt|;
name|u_char
name|metric_expense
decl_stmt|;
name|u_char
name|metric_error
decl_stmt|;
name|u_char
name|prefix
index|[
literal|4
index|]
decl_stmt|;
name|u_char
name|mask
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_tlv_is_reach
block|{
name|u_char
name|metric_default
decl_stmt|;
name|u_char
name|metric_delay
decl_stmt|;
name|u_char
name|metric_expense
decl_stmt|;
name|u_char
name|metric_error
decl_stmt|;
name|u_char
name|neighbor_nodeid
index|[
name|SYSTEM_ID_LEN
operator|+
literal|1
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_common_header
block|{
name|u_char
name|nlpid
decl_stmt|;
name|u_char
name|fixed_len
decl_stmt|;
name|u_char
name|version
decl_stmt|;
comment|/* Protocol version? */
name|u_char
name|id_length
decl_stmt|;
name|u_char
name|pdu_type
decl_stmt|;
comment|/* 3 MSbs are reserved */
name|u_char
name|pkt_version
decl_stmt|;
comment|/* Packet format version? */
name|u_char
name|reserved
decl_stmt|;
name|u_char
name|max_area
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_iih_lan_header
block|{
name|u_char
name|circuit_type
decl_stmt|;
name|u_char
name|source_id
index|[
name|SYSTEM_ID_LEN
index|]
decl_stmt|;
name|u_char
name|holding_time
index|[
literal|2
index|]
decl_stmt|;
name|u_char
name|pdu_len
index|[
literal|2
index|]
decl_stmt|;
name|u_char
name|priority
decl_stmt|;
name|u_char
name|lan_id
index|[
name|SYSTEM_ID_LEN
operator|+
literal|1
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_iih_ptp_header
block|{
name|u_char
name|circuit_type
decl_stmt|;
name|u_char
name|source_id
index|[
name|SYSTEM_ID_LEN
index|]
decl_stmt|;
name|u_char
name|holding_time
index|[
literal|2
index|]
decl_stmt|;
name|u_char
name|pdu_len
index|[
literal|2
index|]
decl_stmt|;
name|u_char
name|circuit_id
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_lsp_header
block|{
name|u_char
name|pdu_len
index|[
literal|2
index|]
decl_stmt|;
name|u_char
name|remaining_lifetime
index|[
literal|2
index|]
decl_stmt|;
name|u_char
name|lsp_id
index|[
name|SYSTEM_ID_LEN
operator|+
literal|2
index|]
decl_stmt|;
name|u_char
name|sequence_number
index|[
literal|4
index|]
decl_stmt|;
name|u_char
name|checksum
index|[
literal|2
index|]
decl_stmt|;
name|u_char
name|typeblock
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_csnp_header
block|{
name|u_char
name|pdu_len
index|[
literal|2
index|]
decl_stmt|;
name|u_char
name|source_id
index|[
name|SYSTEM_ID_LEN
operator|+
literal|1
index|]
decl_stmt|;
name|u_char
name|start_lsp_id
index|[
name|SYSTEM_ID_LEN
operator|+
literal|2
index|]
decl_stmt|;
name|u_char
name|end_lsp_id
index|[
name|SYSTEM_ID_LEN
operator|+
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_psnp_header
block|{
name|u_char
name|pdu_len
index|[
literal|2
index|]
decl_stmt|;
name|u_char
name|source_id
index|[
name|SYSTEM_ID_LEN
operator|+
literal|1
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|isis_tlv_lsp
block|{
name|u_char
name|remaining_lifetime
index|[
literal|2
index|]
decl_stmt|;
name|u_char
name|lsp_id
index|[
name|SYSTEM_ID_LEN
operator|+
literal|2
index|]
decl_stmt|;
name|u_char
name|sequence_number
index|[
literal|4
index|]
decl_stmt|;
name|u_char
name|checksum
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|ISIS_COMMON_HEADER_SIZE
value|(sizeof(struct isis_common_header))
end_define

begin_define
define|#
directive|define
name|ISIS_IIH_LAN_HEADER_SIZE
value|(sizeof(struct isis_iih_lan_header))
end_define

begin_define
define|#
directive|define
name|ISIS_IIH_PTP_HEADER_SIZE
value|(sizeof(struct isis_iih_ptp_header))
end_define

begin_define
define|#
directive|define
name|ISIS_LSP_HEADER_SIZE
value|(sizeof(struct isis_lsp_header))
end_define

begin_define
define|#
directive|define
name|ISIS_CSNP_HEADER_SIZE
value|(sizeof(struct isis_csnp_header))
end_define

begin_define
define|#
directive|define
name|ISIS_PSNP_HEADER_SIZE
value|(sizeof(struct isis_psnp_header))
end_define

begin_function
name|void
name|isoclns_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|p
parameter_list|,
name|u_int
name|length
parameter_list|,
name|u_int
name|caplen
parameter_list|,
specifier|const
name|u_char
modifier|*
name|esrc
parameter_list|,
specifier|const
name|u_char
modifier|*
name|edst
parameter_list|)
block|{
name|u_char
name|pdu_type
decl_stmt|;
specifier|const
name|struct
name|isis_common_header
modifier|*
name|header
decl_stmt|;
name|header
operator|=
operator|(
specifier|const
expr|struct
name|isis_common_header
operator|*
operator|)
name|p
expr_stmt|;
name|pdu_type
operator|=
name|header
operator|->
name|pdu_type
operator|&
name|PDU_TYPE_MASK
expr_stmt|;
if|if
condition|(
name|caplen
operator|<
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"[|iso-clns] "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|eflag
operator|&&
name|esrc
operator|!=
name|NULL
operator|&&
name|edst
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
literal|"%s> %s"
argument_list|,
name|etheraddr_string
argument_list|(
name|esrc
argument_list|)
argument_list|,
name|etheraddr_string
argument_list|(
name|edst
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
operator|*
name|p
condition|)
block|{
case|case
name|NLPID_CLNS
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"CLNS(%d)"
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|eflag
operator|&&
name|esrc
operator|!=
name|NULL
operator|&&
name|edst
operator|!=
name|NULL
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|", %s> %s"
argument_list|,
name|etheraddr_string
argument_list|(
name|esrc
argument_list|)
argument_list|,
name|etheraddr_string
argument_list|(
name|edst
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|NLPID_ESIS
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ESIS"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|eflag
operator|&&
name|esrc
operator|!=
name|NULL
operator|&&
name|edst
operator|!=
name|NULL
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|", %s> %s"
argument_list|,
name|etheraddr_string
argument_list|(
name|esrc
argument_list|)
argument_list|,
name|etheraddr_string
argument_list|(
name|edst
argument_list|)
argument_list|)
expr_stmt|;
name|esis_print
argument_list|(
name|p
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
case|case
name|NLPID_ISIS
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ISIS(%d)"
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|eflag
operator|&&
name|esrc
operator|!=
name|NULL
operator|&&
name|edst
operator|!=
name|NULL
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|", %s> %s"
argument_list|,
name|etheraddr_string
argument_list|(
name|esrc
argument_list|)
argument_list|,
name|etheraddr_string
argument_list|(
name|edst
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isis_print
argument_list|(
name|p
argument_list|,
name|length
argument_list|)
condition|)
name|default_print_unaligned
argument_list|(
name|p
argument_list|,
name|caplen
argument_list|)
expr_stmt|;
break|break;
case|case
name|NLPID_NULLNS
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ISO NULLNS(%d)"
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|eflag
operator|&&
name|esrc
operator|!=
name|NULL
operator|&&
name|edst
operator|!=
name|NULL
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|", %s> %s"
argument_list|,
name|etheraddr_string
argument_list|(
name|esrc
argument_list|)
argument_list|,
name|etheraddr_string
argument_list|(
name|edst
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"CLNS %02x(%d)"
argument_list|,
name|p
index|[
literal|0
index|]
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|eflag
operator|&&
name|esrc
operator|!=
name|NULL
operator|&&
name|edst
operator|!=
name|NULL
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|", %s> %s"
argument_list|,
name|etheraddr_string
argument_list|(
name|esrc
argument_list|)
argument_list|,
name|etheraddr_string
argument_list|(
name|edst
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|caplen
operator|>
literal|1
condition|)
name|default_print_unaligned
argument_list|(
name|p
argument_list|,
name|caplen
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|ESIS_REDIRECT
value|6
end_define

begin_define
define|#
directive|define
name|ESIS_ESH
value|2
end_define

begin_define
define|#
directive|define
name|ESIS_ISH
value|4
end_define

begin_struct
struct|struct
name|esis_hdr
block|{
name|u_char
name|version
decl_stmt|;
name|u_char
name|reserved
decl_stmt|;
name|u_char
name|type
decl_stmt|;
name|u_char
name|tmo
index|[
literal|2
index|]
decl_stmt|;
name|u_char
name|cksum
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|esis_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|p
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
specifier|const
name|u_char
modifier|*
name|ep
decl_stmt|;
name|u_int
name|li
decl_stmt|;
specifier|const
name|struct
name|esis_hdr
modifier|*
name|eh
decl_stmt|;
name|u_char
name|off
index|[
literal|2
index|]
decl_stmt|;
if|if
condition|(
name|length
operator|<=
literal|2
condition|)
block|{
if|if
condition|(
name|qflag
condition|)
name|printf
argument_list|(
literal|" bad pkt!"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" no header at all!"
argument_list|)
expr_stmt|;
return|return;
block|}
name|li
operator|=
name|p
index|[
literal|1
index|]
expr_stmt|;
name|eh
operator|=
operator|(
specifier|const
expr|struct
name|esis_hdr
operator|*
operator|)
operator|&
name|p
index|[
literal|2
index|]
expr_stmt|;
name|ep
operator|=
name|p
operator|+
name|li
expr_stmt|;
if|if
condition|(
name|li
operator|>
name|length
condition|)
block|{
if|if
condition|(
name|qflag
condition|)
name|printf
argument_list|(
literal|" bad pkt!"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" LI(%d)> PDU size (%d)!"
argument_list|,
name|li
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|li
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|esis_hdr
argument_list|)
operator|+
literal|2
condition|)
block|{
if|if
condition|(
name|qflag
condition|)
name|printf
argument_list|(
literal|" bad pkt!"
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|" too short for esis header %d:"
argument_list|,
name|li
argument_list|)
expr_stmt|;
while|while
condition|(
operator|--
name|length
operator|!=
literal|0
condition|)
name|printf
argument_list|(
literal|"%02X"
argument_list|,
operator|*
name|p
operator|++
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
switch|switch
condition|(
name|eh
operator|->
name|type
operator|&
literal|0x1f
condition|)
block|{
case|case
name|ESIS_REDIRECT
case|:
name|printf
argument_list|(
literal|" redirect"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ESIS_ESH
case|:
name|printf
argument_list|(
literal|" esh"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ESIS_ISH
case|:
name|printf
argument_list|(
literal|" ish"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|" type %d"
argument_list|,
name|eh
operator|->
name|type
operator|&
literal|0x1f
argument_list|)
expr_stmt|;
break|break;
block|}
name|off
index|[
literal|0
index|]
operator|=
name|eh
operator|->
name|cksum
index|[
literal|0
index|]
expr_stmt|;
name|off
index|[
literal|1
index|]
operator|=
name|eh
operator|->
name|cksum
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|vflag
operator|&&
name|osi_cksum
argument_list|(
name|p
argument_list|,
name|li
argument_list|,
name|off
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|" bad cksum (got %02x%02x)"
argument_list|,
name|eh
operator|->
name|cksum
index|[
literal|1
index|]
argument_list|,
name|eh
operator|->
name|cksum
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|default_print
argument_list|(
name|p
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|eh
operator|->
name|version
operator|!=
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|" unsupported version %d"
argument_list|,
name|eh
operator|->
name|version
argument_list|)
expr_stmt|;
return|return;
block|}
name|p
operator|+=
sizeof|sizeof
argument_list|(
operator|*
name|eh
argument_list|)
operator|+
literal|2
expr_stmt|;
name|li
operator|-=
sizeof|sizeof
argument_list|(
operator|*
name|eh
argument_list|)
operator|+
literal|2
expr_stmt|;
comment|/* protoid * li */
switch|switch
condition|(
name|eh
operator|->
name|type
operator|&
literal|0x1f
condition|)
block|{
case|case
name|ESIS_REDIRECT
case|:
block|{
specifier|const
name|u_char
modifier|*
name|dst
decl_stmt|,
modifier|*
name|snpa
decl_stmt|,
modifier|*
name|is
decl_stmt|;
name|dst
operator|=
name|p
expr_stmt|;
name|p
operator|+=
operator|*
name|p
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|p
operator|>
name|snapend
condition|)
return|return;
name|printf
argument_list|(
literal|"\n\t\t\t %s"
argument_list|,
name|isonsap_string
argument_list|(
name|dst
argument_list|)
argument_list|)
expr_stmt|;
name|snpa
operator|=
name|p
expr_stmt|;
name|p
operator|+=
operator|*
name|p
operator|+
literal|1
expr_stmt|;
name|is
operator|=
name|p
expr_stmt|;
name|p
operator|+=
operator|*
name|p
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|p
operator|>
name|snapend
condition|)
return|return;
if|if
condition|(
name|p
operator|>
name|ep
condition|)
block|{
name|printf
argument_list|(
literal|" [bad li]"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|is
index|[
literal|0
index|]
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"> %s"
argument_list|,
name|etheraddr_string
argument_list|(
operator|&
name|snpa
index|[
literal|1
index|]
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"> %s"
argument_list|,
name|isonsap_string
argument_list|(
name|is
argument_list|)
argument_list|)
expr_stmt|;
name|li
operator|=
name|ep
operator|-
name|p
expr_stmt|;
break|break;
block|}
if|#
directive|if
literal|0
block|case ESIS_ESH: 		printf(" esh"); 		break;
endif|#
directive|endif
case|case
name|ESIS_ISH
case|:
block|{
specifier|const
name|u_char
modifier|*
name|is
decl_stmt|;
name|is
operator|=
name|p
expr_stmt|;
name|p
operator|+=
operator|*
name|p
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|p
operator|>
name|ep
condition|)
block|{
name|printf
argument_list|(
literal|" [bad li]"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|p
operator|>
name|snapend
condition|)
return|return;
if|if
condition|(
operator|!
name|qflag
condition|)
name|printf
argument_list|(
literal|"\n\t\t\t %s"
argument_list|,
name|isonsap_string
argument_list|(
name|is
argument_list|)
argument_list|)
expr_stmt|;
name|li
operator|=
name|ep
operator|-
name|p
expr_stmt|;
break|break;
block|}
default|default:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|" len=%d"
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|&&
name|p
operator|<
name|snapend
condition|)
block|{
name|length
operator|=
name|snapend
operator|-
name|p
expr_stmt|;
name|default_print
argument_list|(
name|p
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
if|if
condition|(
name|vflag
condition|)
while|while
condition|(
name|p
operator|<
name|ep
operator|&&
name|li
condition|)
block|{
name|u_int
name|op
decl_stmt|,
name|opli
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|q
decl_stmt|;
if|if
condition|(
name|snapend
operator|-
name|p
operator|<
literal|2
condition|)
return|return;
if|if
condition|(
name|li
operator|<
literal|2
condition|)
block|{
name|printf
argument_list|(
literal|" bad opts/li"
argument_list|)
expr_stmt|;
return|return;
block|}
name|op
operator|=
operator|*
name|p
operator|++
expr_stmt|;
name|opli
operator|=
operator|*
name|p
operator|++
expr_stmt|;
name|li
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|opli
operator|>
name|li
condition|)
block|{
name|printf
argument_list|(
literal|" opt (%d) too long"
argument_list|,
name|op
argument_list|)
expr_stmt|;
return|return;
block|}
name|li
operator|-=
name|opli
expr_stmt|;
name|q
operator|=
name|p
expr_stmt|;
name|p
operator|+=
name|opli
expr_stmt|;
if|if
condition|(
name|snapend
operator|<
name|p
condition|)
return|return;
if|if
condition|(
name|op
operator|==
literal|198
operator|&&
name|opli
operator|==
literal|2
condition|)
block|{
name|printf
argument_list|(
literal|" tmo=%d"
argument_list|,
name|q
index|[
literal|0
index|]
operator|*
literal|256
operator|+
name|q
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|printf
argument_list|(
literal|" %d:<"
argument_list|,
name|op
argument_list|)
expr_stmt|;
while|while
condition|(
name|opli
operator|--
operator|>
literal|0
condition|)
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
name|q
operator|++
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|">"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * print_nsap  * Print out an NSAP.   */
end_comment

begin_function
specifier|static
name|int
name|print_nsap
parameter_list|(
specifier|register
specifier|const
name|u_char
modifier|*
name|cp
parameter_list|,
specifier|register
name|int
name|length
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|length
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|cp
argument_list|,
literal|1
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
name|cp
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|i
operator|&
literal|1
operator|)
operator|==
literal|0
operator|)
operator|&&
operator|(
name|i
operator|+
literal|1
operator|<
name|length
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"."
argument_list|)
expr_stmt|;
block|}
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|isis_print_sysid
parameter_list|(
specifier|const
name|u_char
modifier|*
name|cp
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|6
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|cp
argument_list|,
literal|1
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
name|cp
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|i
operator|==
literal|2
operator|)
operator|^
operator|(
name|i
operator|==
literal|4
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"."
argument_list|)
expr_stmt|;
block|}
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|isis_print_nodeid
parameter_list|(
specifier|const
name|u_char
modifier|*
name|cp
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|7
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|cp
argument_list|,
literal|1
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
name|cp
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|i
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"."
argument_list|)
expr_stmt|;
block|}
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|isis_print_lspid
parameter_list|(
specifier|const
name|u_char
modifier|*
name|cp
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|7
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
name|cp
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|i
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"."
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"-%02x"
argument_list|,
operator|*
name|cp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|isis_print_tlv_ip_reach
parameter_list|(
specifier|const
name|u_char
modifier|*
name|cp
parameter_list|,
name|int
name|length
parameter_list|)
block|{
name|int
name|bitmasks
index|[
literal|33
index|]
init|=
block|{
literal|0x00000000
block|,
literal|0x80000000
block|,
literal|0xc0000000
block|,
literal|0xe0000000
block|,
literal|0xf0000000
block|,
literal|0xf8000000
block|,
literal|0xfc000000
block|,
literal|0xfe000000
block|,
literal|0xff000000
block|,
literal|0xff800000
block|,
literal|0xffc00000
block|,
literal|0xffe00000
block|,
literal|0xfff00000
block|,
literal|0xfff80000
block|,
literal|0xfffc0000
block|,
literal|0xfffe0000
block|,
literal|0xffff0000
block|,
literal|0xffff8000
block|,
literal|0xffffc000
block|,
literal|0xffffe000
block|,
literal|0xfffff000
block|,
literal|0xfffff800
block|,
literal|0xfffffc00
block|,
literal|0xfffffe00
block|,
literal|0xffffff00
block|,
literal|0xffffff80
block|,
literal|0xffffffc0
block|,
literal|0xffffffe0
block|,
literal|0xfffffff0
block|,
literal|0xfffffff8
block|,
literal|0xfffffffc
block|,
literal|0xfffffffe
block|,
literal|0xffffffff
block|}
decl_stmt|;
name|int
name|mask
decl_stmt|,
name|prefix_len
decl_stmt|;
specifier|const
name|struct
name|isis_tlv_ip_reach
modifier|*
name|tlv_ip_reach
decl_stmt|;
name|tlv_ip_reach
operator|=
operator|(
specifier|const
expr|struct
name|isis_tlv_ip_reach
operator|*
operator|)
name|cp
expr_stmt|;
while|while
condition|(
name|length
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|length
operator|<
sizeof|sizeof
argument_list|(
operator|*
name|tlv_ip_reach
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"short IP reachability (%d vs %lu)"
argument_list|,
name|length
argument_list|,
operator|(
name|unsigned
name|long
operator|)
sizeof|sizeof
argument_list|(
operator|*
name|tlv_ip_reach
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
operator|!
name|TTEST
argument_list|(
operator|*
name|tlv_ip_reach
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|mask
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tlv_ip_reach
operator|->
name|mask
argument_list|)
expr_stmt|;
name|prefix_len
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|prefix_len
operator|<=
literal|33
condition|)
block|{
if|if
condition|(
name|bitmasks
index|[
name|prefix_len
operator|++
index|]
operator|==
name|mask
condition|)
block|{
name|prefix_len
operator|--
expr_stmt|;
break|break;
block|}
block|}
comment|/* 		 * 34 indicates no match -> must be a discontiguous netmask 		 * lets dump the mask, otherwise print the prefix_len 		 */
if|if
condition|(
name|prefix_len
operator|==
literal|34
condition|)
name|printf
argument_list|(
literal|"\n\t\t\tIPv4 prefix: %u.%u.%u.%u mask %u.%u.%u.%u"
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|prefix
operator|)
index|[
literal|0
index|]
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|prefix
operator|)
index|[
literal|1
index|]
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|prefix
operator|)
index|[
literal|2
index|]
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|prefix
operator|)
index|[
literal|3
index|]
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|mask
operator|)
index|[
literal|0
index|]
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|mask
operator|)
index|[
literal|1
index|]
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|mask
operator|)
index|[
literal|2
index|]
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|mask
operator|)
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\n\t\t\tIPv4 prefix: %u.%u.%u.%u/%u"
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|prefix
operator|)
index|[
literal|0
index|]
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|prefix
operator|)
index|[
literal|1
index|]
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|prefix
operator|)
index|[
literal|2
index|]
argument_list|,
operator|(
name|tlv_ip_reach
operator|->
name|prefix
operator|)
index|[
literal|3
index|]
argument_list|,
name|prefix_len
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t\t  Default Metric: %02d, %s, Distribution: %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_default
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_default
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|,
name|ISIS_LSP_TLV_METRIC_UPDOWN
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_default
argument_list|)
condition|?
literal|"down"
else|:
literal|"up"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_delay
argument_list|)
condition|)
name|printf
argument_list|(
literal|"\n\t\t\t  Delay Metric: %02d, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_delay
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_delay
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_expense
argument_list|)
condition|)
name|printf
argument_list|(
literal|"\n\t\t\t  Expense Metric: %02d, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_expense
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_expense
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_error
argument_list|)
condition|)
name|printf
argument_list|(
literal|"\n\t\t\t  Error Metric: %02d, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_error
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_ip_reach
operator|->
name|metric_error
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
name|length
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_tlv_ip_reach
argument_list|)
expr_stmt|;
name|tlv_ip_reach
operator|++
expr_stmt|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * isis_print  * Decode IS-IS packets.  Return 0 on error.  */
end_comment

begin_function
specifier|static
name|int
name|isis_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|p
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
specifier|const
name|struct
name|isis_common_header
modifier|*
name|header
decl_stmt|;
specifier|const
name|struct
name|isis_iih_lan_header
modifier|*
name|header_iih_lan
decl_stmt|;
specifier|const
name|struct
name|isis_iih_ptp_header
modifier|*
name|header_iih_ptp
decl_stmt|;
specifier|const
name|struct
name|isis_lsp_header
modifier|*
name|header_lsp
decl_stmt|;
specifier|const
name|struct
name|isis_csnp_header
modifier|*
name|header_csnp
decl_stmt|;
specifier|const
name|struct
name|isis_psnp_header
modifier|*
name|header_psnp
decl_stmt|;
specifier|const
name|struct
name|isis_tlv_lsp
modifier|*
name|tlv_lsp
decl_stmt|;
specifier|const
name|struct
name|isis_tlv_ptp_adj
modifier|*
name|tlv_ptp_adj
decl_stmt|;
specifier|const
name|struct
name|isis_tlv_is_reach
modifier|*
name|tlv_is_reach
decl_stmt|;
name|u_char
name|pdu_type
decl_stmt|,
name|max_area
decl_stmt|,
name|type
decl_stmt|,
name|len
decl_stmt|,
name|tmp
decl_stmt|,
name|alen
decl_stmt|,
name|subl
decl_stmt|,
name|subt
decl_stmt|,
name|tslen
decl_stmt|,
name|ttslen
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|optr
decl_stmt|,
modifier|*
name|pptr
decl_stmt|,
modifier|*
name|tptr
decl_stmt|;
name|u_short
name|packet_len
decl_stmt|,
name|pdu_len
decl_stmt|;
name|u_int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|bit_length
decl_stmt|,
name|byte_length
decl_stmt|,
name|metric
decl_stmt|;
name|u_char
name|prefix
index|[
literal|4
index|]
decl_stmt|;
comment|/* copy buffer for ipv4 prefixes */
ifdef|#
directive|ifdef
name|INET6
name|u_char
name|prefix6
index|[
literal|16
index|]
decl_stmt|;
comment|/* copy buffer for ipv6 prefixes */
endif|#
directive|endif
name|u_char
name|off
index|[
literal|2
index|]
decl_stmt|;
name|float
name|bw
decl_stmt|;
comment|/* copy buffer for several subTLVs of the extended IS reachability TLV */
name|packet_len
operator|=
name|length
expr_stmt|;
name|optr
operator|=
name|p
expr_stmt|;
comment|/* initialize the _o_riginal pointer - need it for parsing the checksum TLV */
name|header
operator|=
operator|(
specifier|const
expr|struct
name|isis_common_header
operator|*
operator|)
name|p
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|header
argument_list|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|)
expr_stmt|;
name|header_iih_lan
operator|=
operator|(
specifier|const
expr|struct
name|isis_iih_lan_header
operator|*
operator|)
name|pptr
expr_stmt|;
name|header_iih_ptp
operator|=
operator|(
specifier|const
expr|struct
name|isis_iih_ptp_header
operator|*
operator|)
name|pptr
expr_stmt|;
name|header_lsp
operator|=
operator|(
specifier|const
expr|struct
name|isis_lsp_header
operator|*
operator|)
name|pptr
expr_stmt|;
name|header_csnp
operator|=
operator|(
specifier|const
expr|struct
name|isis_csnp_header
operator|*
operator|)
name|pptr
expr_stmt|;
name|header_psnp
operator|=
operator|(
specifier|const
expr|struct
name|isis_psnp_header
operator|*
operator|)
name|pptr
expr_stmt|;
comment|/*      * Sanity checking of the header.      */
if|if
condition|(
name|header
operator|->
name|nlpid
operator|!=
name|NLPID_ISIS
condition|)
block|{
name|printf
argument_list|(
literal|", coding error!"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|header
operator|->
name|version
operator|!=
name|ISIS_VERSION
condition|)
block|{
name|printf
argument_list|(
literal|", version %d packet not supported"
argument_list|,
name|header
operator|->
name|version
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|header
operator|->
name|id_length
operator|!=
name|SYSTEM_ID_LEN
operator|)
operator|&&
operator|(
name|header
operator|->
name|id_length
operator|!=
literal|0
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|", system ID length of %d is not supported"
argument_list|,
name|header
operator|->
name|id_length
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|header
operator|->
name|pkt_version
operator|!=
name|ISIS_VERSION
condition|)
block|{
name|printf
argument_list|(
literal|", version %d packet not supported"
argument_list|,
name|header
operator|->
name|pkt_version
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|max_area
operator|=
name|header
operator|->
name|max_area
expr_stmt|;
switch|switch
condition|(
name|max_area
condition|)
block|{
case|case
literal|0
case|:
name|max_area
operator|=
literal|3
expr_stmt|;
comment|/* silly shit */
break|break;
case|case
literal|255
case|:
name|printf
argument_list|(
literal|", bad packet -- 255 areas"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
default|default:
break|break;
block|}
name|printf
argument_list|(
literal|", hlen: %u, v: %u, sys-id-len: 6 (0), max-area: %u (%u)"
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
name|header
operator|->
name|pkt_version
argument_list|,
name|max_area
argument_list|,
name|header
operator|->
name|max_area
argument_list|)
expr_stmt|;
name|pdu_type
operator|=
name|header
operator|->
name|pdu_type
expr_stmt|;
switch|switch
condition|(
name|pdu_type
condition|)
block|{
case|case
name|L1_LAN_IIH
case|:
case|case
name|L2_LAN_IIH
case|:
if|if
condition|(
name|header
operator|->
name|fixed_len
operator|!=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_LAN_HEADER_SIZE
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|", bogus fixed header length %u should be %lu"
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ISIS_IIH_LAN_HEADER_SIZE
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pdu_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|header_iih_lan
operator|->
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|packet_len
operator|>
name|pdu_len
condition|)
block|{
name|packet_len
operator|=
name|pdu_len
expr_stmt|;
comment|/* do TLV decoding as long as it makes sense */
name|length
operator|=
name|pdu_len
expr_stmt|;
block|}
name|printf
argument_list|(
literal|", L%s Lan IIH (%u)"
argument_list|,
name|ISIS_MASK_LEVEL_BITS
argument_list|(
name|pdu_type
argument_list|)
condition|?
literal|"1"
else|:
literal|"2"
argument_list|,
name|pdu_len
argument_list|)
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|header_iih_lan
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t  source-id: "
argument_list|)
expr_stmt|;
name|isis_print_sysid
argument_list|(
name|header_iih_lan
operator|->
name|source_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", holding time: %us"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|header_iih_lan
operator|->
name|holding_time
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|header_iih_lan
operator|->
name|circuit_type
condition|)
block|{
case|case
literal|1
case|:
name|printf
argument_list|(
literal|", Level 1 only"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|", Level 2 only"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|", Level 1, Level 2"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|", unknown 0x%02x"
argument_list|,
name|header_iih_lan
operator|->
name|circuit_type
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|"\n\t\t  lan-id:    "
argument_list|)
expr_stmt|;
name|isis_print_nodeid
argument_list|(
name|header_iih_lan
operator|->
name|lan_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", Priority: %u"
argument_list|,
operator|(
name|header_iih_lan
operator|->
name|priority
operator|)
operator|&
name|PRIORITY_MASK
argument_list|)
expr_stmt|;
name|packet_len
operator|-=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_LAN_HEADER_SIZE
operator|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_LAN_HEADER_SIZE
operator|)
expr_stmt|;
break|break;
case|case
name|PTP_IIH
case|:
if|if
condition|(
name|header
operator|->
name|fixed_len
operator|!=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_PTP_HEADER_SIZE
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|", bogus fixed header length %u should be %lu"
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ISIS_IIH_PTP_HEADER_SIZE
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pdu_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|header_iih_ptp
operator|->
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|packet_len
operator|>
name|pdu_len
condition|)
block|{
name|packet_len
operator|=
name|pdu_len
expr_stmt|;
comment|/* do TLV decoding as long as it makes sense */
name|length
operator|=
name|pdu_len
expr_stmt|;
block|}
name|printf
argument_list|(
literal|", PTP IIH (%u)"
argument_list|,
name|pdu_len
argument_list|)
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|header_iih_ptp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t  source-id: "
argument_list|)
expr_stmt|;
name|isis_print_sysid
argument_list|(
name|header_iih_ptp
operator|->
name|source_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", holding time: %us"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|header_iih_ptp
operator|->
name|holding_time
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", circuit-id: 0x%02x"
argument_list|,
name|header_iih_ptp
operator|->
name|circuit_id
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|header_iih_ptp
operator|->
name|circuit_type
condition|)
block|{
case|case
literal|1
case|:
name|printf
argument_list|(
literal|", Level 1 only"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|", Level 2 only"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|", Level 1, Level 2"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|", unknown 0x%02x"
argument_list|,
name|header_iih_ptp
operator|->
name|circuit_type
argument_list|)
expr_stmt|;
break|break;
block|}
name|packet_len
operator|-=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_PTP_HEADER_SIZE
operator|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_IIH_PTP_HEADER_SIZE
operator|)
expr_stmt|;
break|break;
case|case
name|L1_LSP
case|:
case|case
name|L2_LSP
case|:
if|if
condition|(
name|header
operator|->
name|fixed_len
operator|!=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_LSP_HEADER_SIZE
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|", bogus fixed header length %u should be %lu"
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ISIS_LSP_HEADER_SIZE
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pdu_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|header_lsp
operator|->
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|packet_len
operator|>
name|pdu_len
condition|)
block|{
name|packet_len
operator|=
name|pdu_len
expr_stmt|;
comment|/* do TLV decoding as long as it makes sense */
name|length
operator|=
name|pdu_len
expr_stmt|;
block|}
if|if
condition|(
name|pdu_type
operator|==
name|L1_LSP
condition|)
name|printf
argument_list|(
literal|", L1 LSP (%u)"
argument_list|,
name|pdu_len
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|pdu_type
operator|==
name|L2_LSP
condition|)
name|printf
argument_list|(
literal|", L2 LSP (%u)"
argument_list|,
name|pdu_len
argument_list|)
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|header_lsp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t  lsp-id: "
argument_list|)
expr_stmt|;
name|isis_print_lspid
argument_list|(
name|header_lsp
operator|->
name|lsp_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", sequence number: 0x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|header_lsp
operator|->
name|sequence_number
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", lifetime: %5us"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|header_lsp
operator|->
name|remaining_lifetime
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t  checksum: 0x%04x"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|header_lsp
operator|->
name|checksum
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", %s"
argument_list|,
name|ISIS_MASK_LSP_OL_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"Overload bit set, "
else|:
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISIS_MASK_LSP_ATT_BITS
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ISIS_MASK_LSP_ATT_DEFAULT_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"default "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ISIS_MASK_LSP_ATT_DELAY_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"delay "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ISIS_MASK_LSP_ATT_EXPENSE_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"expense "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ISIS_MASK_LSP_ATT_ERROR_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"error "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"ATT bit set, "
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ISIS_MASK_LSP_PARTITION_BIT
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
condition|?
literal|"P bit set, "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tok2str
argument_list|(
name|isis_lsp_istype_values
argument_list|,
literal|"Unknown(0x%x)"
argument_list|,
name|ISIS_MASK_LSP_ISTYPE_BITS
argument_list|(
name|header_lsp
operator|->
name|typeblock
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|packet_len
operator|-=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_LSP_HEADER_SIZE
operator|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_LSP_HEADER_SIZE
operator|)
expr_stmt|;
break|break;
case|case
name|L1_CSNP
case|:
case|case
name|L2_CSNP
case|:
if|if
condition|(
name|header
operator|->
name|fixed_len
operator|!=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_CSNP_HEADER_SIZE
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|", bogus fixed header length %u should be %lu"
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ISIS_CSNP_HEADER_SIZE
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pdu_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|header_csnp
operator|->
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|packet_len
operator|>
name|pdu_len
condition|)
block|{
name|packet_len
operator|=
name|pdu_len
expr_stmt|;
comment|/* do TLV decoding as long as it makes sense */
name|length
operator|=
name|pdu_len
expr_stmt|;
block|}
name|printf
argument_list|(
literal|", L%s CSNP (%u)"
argument_list|,
name|ISIS_MASK_LEVEL_BITS
argument_list|(
name|pdu_type
argument_list|)
condition|?
literal|"2"
else|:
literal|"1"
argument_list|,
name|pdu_len
argument_list|)
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|header_csnp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t  source-id:    "
argument_list|)
expr_stmt|;
name|isis_print_nodeid
argument_list|(
name|header_csnp
operator|->
name|source_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t  start lsp-id: "
argument_list|)
expr_stmt|;
name|isis_print_lspid
argument_list|(
name|header_csnp
operator|->
name|start_lsp_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t  end lsp-id:   "
argument_list|)
expr_stmt|;
name|isis_print_lspid
argument_list|(
name|header_csnp
operator|->
name|end_lsp_id
argument_list|)
expr_stmt|;
name|packet_len
operator|-=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_CSNP_HEADER_SIZE
operator|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_CSNP_HEADER_SIZE
operator|)
expr_stmt|;
break|break;
case|case
name|L1_PSNP
case|:
case|case
name|L2_PSNP
case|:
if|if
condition|(
name|header
operator|->
name|fixed_len
operator|!=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_PSNP_HEADER_SIZE
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"- bogus fixed header length %u should be %lu"
argument_list|,
name|header
operator|->
name|fixed_len
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|ISIS_PSNP_HEADER_SIZE
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pdu_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|header_psnp
operator|->
name|pdu_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|packet_len
operator|>
name|pdu_len
condition|)
block|{
name|packet_len
operator|=
name|pdu_len
expr_stmt|;
comment|/* do TLV decoding as long as it makes sense */
name|length
operator|=
name|pdu_len
expr_stmt|;
block|}
name|printf
argument_list|(
literal|", L%s PSNP (%u)"
argument_list|,
name|ISIS_MASK_LEVEL_BITS
argument_list|(
name|pdu_type
argument_list|)
condition|?
literal|"2"
else|:
literal|"1"
argument_list|,
name|pdu_len
argument_list|)
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|header_psnp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t  source-id:    "
argument_list|)
expr_stmt|;
name|isis_print_nodeid
argument_list|(
name|header_psnp
operator|->
name|source_id
argument_list|)
expr_stmt|;
name|packet_len
operator|-=
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_PSNP_HEADER_SIZE
operator|)
expr_stmt|;
name|pptr
operator|=
name|p
operator|+
operator|(
name|ISIS_COMMON_HEADER_SIZE
operator|+
name|ISIS_PSNP_HEADER_SIZE
operator|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|", PDU type (0x%02x) not supported"
argument_list|,
name|pdu_type
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
comment|/*      * Now print the TLV's.      */
while|while
condition|(
name|packet_len
operator|>=
literal|2
condition|)
block|{
if|if
condition|(
name|pptr
operator|==
name|snapend
condition|)
block|{
return|return
operator|(
literal|1
operator|)
return|;
block|}
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|pptr
argument_list|,
literal|2
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t\t\t packet exceeded snapshot (%ld) bytes"
argument_list|,
call|(
name|long
call|)
argument_list|(
name|pptr
operator|-
name|snapend
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
name|type
operator|=
operator|*
name|pptr
operator|++
expr_stmt|;
name|len
operator|=
operator|*
name|pptr
operator|++
expr_stmt|;
name|packet_len
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|packet_len
condition|)
block|{
break|break;
block|}
name|printf
argument_list|(
literal|"\n\t\t    "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|TLV_AREA_ADDR
case|:
name|printf
argument_list|(
literal|"Area address(es) (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|len
expr_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|alen
operator|=
operator|*
name|tptr
operator|++
expr_stmt|;
while|while
condition|(
name|tmp
operator|&&
name|alen
operator|<
name|tmp
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t\t\tArea address (%u): "
argument_list|,
name|alen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|print_nsap
argument_list|(
name|tptr
argument_list|,
name|alen
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|tptr
operator|+=
name|alen
expr_stmt|;
name|tmp
operator|-=
name|alen
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|tmp
operator|==
literal|0
condition|)
comment|/* if this is the last area address do not attemt a boundary check */
break|break;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|alen
operator|=
operator|*
name|tptr
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|TLV_ISNEIGH
case|:
name|printf
argument_list|(
literal|"IS Neighbor(s) (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|len
expr_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
while|while
condition|(
name|tmp
operator|>=
name|ETHER_ADDR_LEN
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t\t\tIS Neighbor: "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isis_print_sysid
argument_list|(
name|tptr
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|tmp
operator|-=
name|ETHER_ADDR_LEN
expr_stmt|;
name|tptr
operator|+=
name|ETHER_ADDR_LEN
expr_stmt|;
block|}
break|break;
case|case
name|TLV_PADDING
case|:
name|printf
argument_list|(
literal|"Padding (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
break|break;
case|case
name|TLV_MT_IS_REACH
case|:
name|printf
argument_list|(
literal|"Multi Topology IS Reachability (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
name|tmp
operator|=
name|len
expr_stmt|;
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t\t\t"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|2
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
switch|switch
condition|(
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
operator|&
literal|0x0fff
condition|)
block|{
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"IPv4 unicast"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"In-Band Management"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"IPv6 unicast"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|"Multicast"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4095
case|:
name|printf
argument_list|(
literal|"Development, Experimental or Proprietary"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"Reserved for IETF Consensus"
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|" Topology (0x%03x)"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
operator|&
literal|0x0fff
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|2
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t\t  IS Neighbor: "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isis_print_nodeid
argument_list|(
name|tptr
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|tptr
operator|+=
operator|(
name|SYSTEM_ID_LEN
operator|+
literal|1
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|3
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|", Metric: %d"
argument_list|,
name|EXTRACT_24BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|3
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|tslen
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
name|printf
argument_list|(
literal|", %ssub-TLVs present"
argument_list|,
name|tslen
condition|?
literal|""
else|:
literal|"no "
argument_list|)
expr_stmt|;
name|tptr
operator|+=
name|tslen
expr_stmt|;
name|tmp
operator|-=
operator|(
literal|13
operator|+
name|tslen
operator|)
expr_stmt|;
block|}
break|break;
case|case
name|TLV_EXT_IS_REACH
case|:
name|printf
argument_list|(
literal|"Extended IS Reachability (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
name|tmp
operator|=
name|len
expr_stmt|;
while|while
condition|(
name|tmp
operator|>
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t\t\tIS Neighbor: "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isis_print_nodeid
argument_list|(
name|tptr
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|tptr
operator|+=
operator|(
name|SYSTEM_ID_LEN
operator|+
literal|1
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|3
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|", Metric: %d"
argument_list|,
name|EXTRACT_24BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|3
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|tslen
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
name|printf
argument_list|(
literal|", %ssub-TLVs present"
argument_list|,
name|tslen
condition|?
literal|""
else|:
literal|"no "
argument_list|)
expr_stmt|;
if|if
condition|(
name|tslen
condition|)
block|{
name|printf
argument_list|(
literal|" (%u)"
argument_list|,
name|tslen
argument_list|)
expr_stmt|;
name|ttslen
operator|=
name|tslen
expr_stmt|;
while|while
condition|(
name|ttslen
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|2
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\t  "
argument_list|)
expr_stmt|;
name|subt
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
name|subl
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
switch|switch
condition|(
name|subt
condition|)
block|{
case|case
name|SUBTLV_EXT_IS_REACH_ADMIN_GROUP
case|:
name|printf
argument_list|(
literal|"Administrative groups: 0x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_MAX_LINK_BW
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|j
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|bw
argument_list|,
operator|&
name|j
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Maximum link bandwidth : %.3f Mbps"
argument_list|,
name|bw
operator|*
literal|8
operator|/
literal|1000000
argument_list|)
expr_stmt|;
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_RESERVABLE_BW
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|j
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|bw
argument_list|,
operator|&
name|j
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Reservable link bandwidth: %.3f Mbps"
argument_list|,
name|bw
operator|*
literal|8
operator|/
literal|1000000
argument_list|)
expr_stmt|;
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_UNRESERVED_BW
case|:
name|printf
argument_list|(
literal|"Unreserved bandwidth:"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|j
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|bw
argument_list|,
operator|&
name|j
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t\t    priority level %d: %.3f Mbps"
argument_list|,
name|i
argument_list|,
name|bw
operator|*
literal|8
operator|/
literal|1000000
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
block|}
name|tptr
operator|-=
literal|32
expr_stmt|;
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_TE_METRIC
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|3
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"Traffic Engineering Metric: %d"
argument_list|,
name|EXTRACT_24BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_IPV4_INTF_ADDR
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"IPv4 interface address: %s"
argument_list|,
name|ipaddr_string
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SUBTLV_EXT_IS_REACH_IPV4_NEIGHBOR_ADDR
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"IPv4 neighbor address: %s"
argument_list|,
name|ipaddr_string
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|250
case|:
case|case
literal|251
case|:
case|case
literal|252
case|:
case|case
literal|253
case|:
case|case
literal|254
case|:
name|printf
argument_list|(
literal|"Reserved for cisco specific extensions, type %d, length %d"
argument_list|,
name|subt
argument_list|,
name|subl
argument_list|)
expr_stmt|;
break|break;
case|case
literal|255
case|:
name|printf
argument_list|(
literal|"Reserved for future expansion, type %d, length %d"
argument_list|,
name|subt
argument_list|,
name|subl
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"unknown subTLV, type %d, length %d"
argument_list|,
name|subt
argument_list|,
name|subl
argument_list|)
expr_stmt|;
block|}
name|tptr
operator|+=
name|subl
expr_stmt|;
name|ttslen
operator|-=
operator|(
name|subl
operator|+
literal|2
operator|)
expr_stmt|;
block|}
block|}
name|tptr
operator|+=
name|tslen
expr_stmt|;
name|tmp
operator|-=
operator|(
literal|11
operator|+
name|tslen
operator|)
expr_stmt|;
block|}
break|break;
case|case
name|TLV_IS_REACH
case|:
name|printf
argument_list|(
literal|"IS Reachability (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
comment|/* check if there is one byte left to read out the virtual flag */
goto|goto
name|trunctlv
goto|;
switch|switch
condition|(
operator|*
name|tptr
condition|)
block|{
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"\n\t\t\tIsNotVirtual"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"\n\t\t\tIsVirtual"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"\n\t\t\tbogus virtual flag 0x%02x"
argument_list|,
operator|(
operator|*
name|tptr
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|tptr
operator|++
expr_stmt|;
name|tlv_is_reach
operator|=
operator|(
specifier|const
expr|struct
name|isis_tlv_is_reach
operator|*
operator|)
name|tptr
expr_stmt|;
name|tmp
operator|=
name|len
expr_stmt|;
while|while
condition|(
name|tmp
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_tlv_is_reach
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST
argument_list|(
operator|*
name|tlv_is_reach
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\tIS Neighbor: "
argument_list|)
expr_stmt|;
name|isis_print_nodeid
argument_list|(
name|tlv_is_reach
operator|->
name|neighbor_nodeid
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", Default Metric: %d, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_is_reach
operator|->
name|metric_default
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_is_reach
operator|->
name|metric_default
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|tlv_is_reach
operator|->
name|metric_delay
argument_list|)
condition|)
name|printf
argument_list|(
literal|"\n\t\t\t  Delay Metric: %d, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_is_reach
operator|->
name|metric_delay
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_is_reach
operator|->
name|metric_delay
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|tlv_is_reach
operator|->
name|metric_expense
argument_list|)
condition|)
name|printf
argument_list|(
literal|"\n\t\t\t  Expense Metric: %d, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_is_reach
operator|->
name|metric_expense
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_is_reach
operator|->
name|metric_expense
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ISIS_LSP_TLV_METRIC_SUPPORTED
argument_list|(
name|tlv_is_reach
operator|->
name|metric_error
argument_list|)
condition|)
name|printf
argument_list|(
literal|"\n\t\t\t  Error Metric: %d, %s"
argument_list|,
name|ISIS_LSP_TLV_METRIC_VALUE
argument_list|(
name|tlv_is_reach
operator|->
name|metric_error
argument_list|)
argument_list|,
name|ISIS_LSP_TLV_METRIC_IE
argument_list|(
name|tlv_is_reach
operator|->
name|metric_error
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|)
expr_stmt|;
name|tmp
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_tlv_is_reach
argument_list|)
expr_stmt|;
name|tlv_is_reach
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|TLV_IP_REACH
case|:
name|printf
argument_list|(
literal|"IP Internal reachability (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isis_print_tlv_ip_reach
argument_list|(
name|pptr
argument_list|,
name|len
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
break|break;
case|case
name|TLV_IP_REACH_EXT
case|:
name|printf
argument_list|(
literal|"IP External reachability (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isis_print_tlv_ip_reach
argument_list|(
name|pptr
argument_list|,
name|len
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
break|break;
case|case
name|TLV_EXT_IP_REACH
case|:
name|printf
argument_list|(
literal|"Extended IP reachability (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|i
operator|=
name|len
expr_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
while|while
condition|(
name|i
operator|>
literal|0
condition|)
block|{
name|memset
argument_list|(
name|prefix
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|metric
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|j
operator|=
operator|*
operator|(
name|tptr
operator|)
expr_stmt|;
name|bit_length
operator|=
operator|(
operator|*
operator|(
name|tptr
operator|)
operator|++
operator|&
literal|0x3f
operator|)
expr_stmt|;
name|byte_length
operator|=
operator|(
name|bit_length
operator|+
literal|7
operator|)
operator|/
literal|8
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|byte_length
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|memcpy
argument_list|(
name|prefix
argument_list|,
name|tptr
argument_list|,
name|byte_length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t\tIPv4 prefix: %u.%u.%u.%u/%d"
argument_list|,
name|prefix
index|[
literal|0
index|]
argument_list|,
name|prefix
index|[
literal|1
index|]
argument_list|,
name|prefix
index|[
literal|2
index|]
argument_list|,
name|prefix
index|[
literal|3
index|]
argument_list|,
name|bit_length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t\t  Metric: %u, Distribution: %s"
argument_list|,
name|metric
argument_list|,
name|ISIS_MASK_TLV_EXT_IP_UPDOWN
argument_list|(
name|j
argument_list|)
condition|?
literal|"down"
else|:
literal|"up"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", %ssub-TLVs present"
argument_list|,
name|ISIS_MASK_TLV_EXT_IP_SUBTLV
argument_list|(
name|j
argument_list|)
condition|?
literal|""
else|:
literal|"no "
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISIS_MASK_TLV_EXT_IP_SUBTLV
argument_list|(
name|j
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|printf
argument_list|(
literal|" (%u)"
argument_list|,
operator|*
name|tptr
argument_list|)
expr_stmt|;
comment|/* no subTLV decoder supported - just print out subTLV length */
name|i
operator|-=
operator|*
name|tptr
expr_stmt|;
name|tptr
operator|+=
operator|*
name|tptr
operator|++
expr_stmt|;
block|}
name|i
operator|-=
operator|(
literal|5
operator|+
name|byte_length
operator|)
expr_stmt|;
name|tptr
operator|+=
name|byte_length
expr_stmt|;
block|}
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|TLV_IP6_REACH
case|:
name|printf
argument_list|(
literal|"IP6 reachability (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|i
operator|=
name|len
expr_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
while|while
condition|(
name|i
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|metric
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|2
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|j
operator|=
operator|*
operator|(
name|tptr
operator|++
operator|)
expr_stmt|;
name|bit_length
operator|=
operator|(
operator|*
operator|(
name|tptr
operator|)
operator|++
operator|)
expr_stmt|;
name|byte_length
operator|=
operator|(
name|bit_length
operator|+
literal|7
operator|)
operator|/
literal|8
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|byte_length
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|memset
argument_list|(
name|prefix6
argument_list|,
literal|0
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|prefix6
argument_list|,
name|tptr
argument_list|,
name|byte_length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t\tIPv6 prefix: %s/%u"
argument_list|,
name|ip6addr_string
argument_list|(
name|prefix6
argument_list|)
argument_list|,
name|bit_length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t\t  Metric: %u, %s, Distribution: %s, %ssub-TLVs present"
argument_list|,
name|metric
argument_list|,
name|ISIS_MASK_TLV_IP6_IE
argument_list|(
name|j
argument_list|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|,
name|ISIS_MASK_TLV_IP6_UPDOWN
argument_list|(
name|j
argument_list|)
condition|?
literal|"down"
else|:
literal|"up"
argument_list|,
name|ISIS_MASK_TLV_IP6_SUBTLV
argument_list|(
name|j
argument_list|)
condition|?
literal|""
else|:
literal|"no "
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISIS_MASK_TLV_IP6_SUBTLV
argument_list|(
name|j
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|1
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|printf
argument_list|(
literal|" (%u)"
argument_list|,
operator|*
name|tptr
argument_list|)
expr_stmt|;
comment|/* no subTLV decoder supported - just print out subTLV length */
name|i
operator|-=
operator|*
name|tptr
expr_stmt|;
name|tptr
operator|+=
operator|*
name|tptr
operator|++
expr_stmt|;
block|}
name|i
operator|-=
operator|(
literal|6
operator|+
name|byte_length
operator|)
expr_stmt|;
name|tptr
operator|+=
name|byte_length
expr_stmt|;
block|}
break|break;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|INET6
case|case
name|TLV_IP6ADDR
case|:
name|printf
argument_list|(
literal|"IPv6 Interface address(es) (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|i
operator|=
name|len
expr_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
while|while
condition|(
name|i
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|16
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\tIPv6 interface address: %s"
argument_list|,
name|ip6addr_string
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|16
expr_stmt|;
name|i
operator|-=
literal|16
expr_stmt|;
block|}
break|break;
endif|#
directive|endif
case|case
name|TLV_AUTH
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|pptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"Authentication (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|pptr
operator|==
name|SUBTLV_AUTH_SIMPLE
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t\t\tsimple text password: "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
operator|(
name|pptr
operator|+
name|i
operator|)
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
operator|*
operator|(
name|pptr
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|pptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
if|if
condition|(
operator|*
name|pptr
operator|==
name|SUBTLV_AUTH_MD5
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t\t\tMD5 password: "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
operator|(
name|pptr
operator|+
name|i
operator|)
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
operator|(
name|pptr
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|TLV_PTP_ADJ
case|:
name|printf
argument_list|(
literal|"Point-to-point Adjacency State (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|tlv_ptp_adj
operator|=
operator|(
specifier|const
expr|struct
name|isis_tlv_ptp_adj
operator|*
operator|)
name|pptr
expr_stmt|;
name|i
operator|=
name|len
expr_stmt|;
if|if
condition|(
name|i
operator|>=
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|pptr
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\tAdjacency State: %s"
argument_list|,
name|tok2str
argument_list|(
name|isis_ptp_adjancey_values
argument_list|,
literal|"#0x%x"
argument_list|,
operator|*
name|pptr
argument_list|)
argument_list|)
expr_stmt|;
name|i
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|>=
literal|4
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_ptp_adj
operator|->
name|ext_local_circuit_id
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\tExtended Local circuit ID: 0x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tlv_ptp_adj
operator|->
name|ext_local_circuit_id
argument_list|)
argument_list|)
expr_stmt|;
name|i
operator|-=
literal|4
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|>=
literal|6
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_ptp_adj
operator|->
name|neighbor_sysid
argument_list|,
literal|6
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\tNeighbor SystemID: "
argument_list|)
expr_stmt|;
name|isis_print_sysid
argument_list|(
name|tlv_ptp_adj
operator|->
name|neighbor_sysid
argument_list|)
expr_stmt|;
name|i
operator|-=
literal|6
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|>=
literal|4
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_ptp_adj
operator|->
name|neighbor_ext_local_circuit_id
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\tNeighbor Extended Local circuit ID: 0x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tlv_ptp_adj
operator|->
name|neighbor_ext_local_circuit_id
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|TLV_PROTOCOLS
case|:
name|printf
argument_list|(
literal|"Protocols supported (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t\tNLPID(s): "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
operator|(
name|pptr
operator|+
name|i
operator|)
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"%s (0x%02x)"
argument_list|,
name|tok2str
argument_list|(
name|isis_nlpid_values
argument_list|,
literal|"Unknown"
argument_list|,
operator|*
operator|(
name|pptr
operator|+
name|i
operator|)
argument_list|)
argument_list|,
operator|*
operator|(
name|pptr
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
name|len
operator|-
literal|1
condition|)
name|printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|TLV_TE_ROUTER_ID
case|:
name|printf
argument_list|(
literal|"Traffic Engineering Router ID (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|pptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\tTraffic Engineering Router ID: %s"
argument_list|,
name|ipaddr_string
argument_list|(
name|pptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|TLV_IPADDR
case|:
name|printf
argument_list|(
literal|"IPv4 Interface address(es) (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|i
operator|=
name|len
expr_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
while|while
condition|(
name|i
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\tIPv4 interface address: %s"
argument_list|,
name|ipaddr_string
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
literal|4
expr_stmt|;
name|i
operator|-=
literal|4
expr_stmt|;
block|}
break|break;
case|case
name|TLV_HOSTNAME
case|:
name|printf
argument_list|(
literal|"Hostname (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t\tHostname: "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
operator|(
name|pptr
operator|+
name|i
operator|)
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
operator|*
operator|(
name|pptr
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|TLV_LSP
case|:
name|tlv_lsp
operator|=
operator|(
specifier|const
expr|struct
name|isis_tlv_lsp
operator|*
operator|)
name|pptr
expr_stmt|;
name|printf
argument_list|(
literal|"LSP entries (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|i
operator|<
name|len
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t\t\tlsp-id: "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isis_print_nodeid
argument_list|(
name|tlv_lsp
operator|->
name|lsp_id
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
if|if
condition|(
operator|!
name|TTEST
argument_list|(
operator|(
name|tlv_lsp
operator|->
name|lsp_id
operator|)
index|[
name|SYSTEM_ID_LEN
operator|+
literal|1
index|]
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"-%02x"
argument_list|,
operator|(
name|tlv_lsp
operator|->
name|lsp_id
operator|)
index|[
name|SYSTEM_ID_LEN
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_lsp
operator|->
name|sequence_number
argument_list|,
literal|4
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\t  sequence number: 0x%08x"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|tlv_lsp
operator|->
name|sequence_number
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_lsp
operator|->
name|remaining_lifetime
argument_list|,
literal|2
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\t  Remaining lifetime: %5ds"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tlv_lsp
operator|->
name|remaining_lifetime
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
name|tlv_lsp
operator|->
name|checksum
argument_list|,
literal|2
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\t  checksum: 0x%04x"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tlv_lsp
operator|->
name|checksum
argument_list|)
argument_list|)
expr_stmt|;
name|i
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|isis_tlv_lsp
argument_list|)
expr_stmt|;
name|tlv_lsp
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|TLV_CHECKSUM
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|pptr
argument_list|,
literal|2
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"Checksum (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t\tchecksum: 0x%04x"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|pptr
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|osi_cksum
argument_list|(
name|optr
argument_list|,
name|length
argument_list|,
name|off
argument_list|)
condition|)
name|printf
argument_list|(
literal|" (incorrect)"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" (correct)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|TLV_MT_SUPPORTED
case|:
name|printf
argument_list|(
literal|"Multi Topology (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|i
operator|=
name|len
expr_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
while|while
condition|(
name|i
operator|>
literal|1
condition|)
block|{
comment|/* length can only be a multiple of 2, otherwise there is  		   something broken -> so decode down until length is 1 */
if|if
condition|(
name|i
operator|!=
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|2
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\t"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
operator|&
literal|0x0fff
condition|)
block|{
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"IPv4 unicast"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"In-Band Management"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"IPv6 unicast"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|"Multicast"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4095
case|:
name|printf
argument_list|(
literal|"Development, Experimental or Proprietary"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"Reserved for IETF Consensus"
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|" Topology (0x%03x)%s%s"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
operator|&
literal|0xfff
argument_list|,
operator|(
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
operator|&
literal|0x8000
operator|)
condition|?
literal|""
else|:
literal|", no sub-TLVs present"
argument_list|,
operator|(
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
operator|&
literal|0x4000
operator|)
condition|?
literal|", ATT bit set"
else|:
literal|""
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"\n\t\t\tmalformed MT-ID"
argument_list|)
expr_stmt|;
break|break;
block|}
name|i
operator|-=
literal|2
expr_stmt|;
name|tptr
operator|+=
literal|2
expr_stmt|;
block|}
break|break;
case|case
name|TLV_RESTART_SIGNALING
case|:
name|tptr
operator|=
name|pptr
expr_stmt|;
name|printf
argument_list|(
literal|"Restart Signaling (%u)"
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
literal|3
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"\n\t\t\tRestart Request bit %s, Restart Acknowledgement bit %s\n\t\t\tRemaining holding time: %us"
argument_list|,
name|ISIS_MASK_RESTART_RR
argument_list|(
operator|*
name|tptr
argument_list|)
condition|?
literal|"set"
else|:
literal|"clear"
argument_list|,
name|ISIS_MASK_RESTART_RA
argument_list|(
operator|*
name|tptr
operator|++
argument_list|)
condition|?
literal|"set"
else|:
literal|"clear"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"unknown TLV, type %d, length %d\n\t\t\t"
argument_list|,
name|type
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
operator|(
name|tptr
operator|+
name|i
operator|)
argument_list|,
literal|1
argument_list|)
condition|)
goto|goto
name|trunctlv
goto|;
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
operator|(
name|tptr
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
comment|/* formatted hex output of unknown TLV data */
if|if
condition|(
name|i
operator|%
literal|2
condition|)
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|/
literal|16
operator|!=
operator|(
name|i
operator|+
literal|1
operator|)
operator|/
literal|16
condition|)
block|{
if|if
condition|(
name|i
operator|<
operator|(
name|len
operator|-
literal|1
operator|)
condition|)
name|printf
argument_list|(
literal|"\n\t\t\t"
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
block|}
name|pptr
operator|+=
name|len
expr_stmt|;
name|packet_len
operator|-=
name|len
expr_stmt|;
block|}
if|if
condition|(
name|packet_len
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t\t\t %d straggler bytes"
argument_list|,
name|packet_len
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
name|trunc
label|:
name|fputs
argument_list|(
literal|"[|isis]"
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
name|trunctlv
label|:
name|printf
argument_list|(
literal|"\n\t\t\t packet exceeded snapshot"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Verify the checksum.  See 8473-1, Appendix C, section C.4.  */
end_comment

begin_function
specifier|static
name|int
name|osi_cksum
parameter_list|(
specifier|register
specifier|const
name|u_char
modifier|*
name|p
parameter_list|,
specifier|register
name|u_int
name|len
parameter_list|,
name|u_char
modifier|*
name|off
parameter_list|)
block|{
name|int32_t
name|c0
init|=
literal|0
decl_stmt|,
name|c1
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|off
index|[
literal|0
index|]
operator|==
literal|0
operator|)
operator|&&
operator|(
name|off
index|[
literal|1
index|]
operator|==
literal|0
operator|)
condition|)
return|return
literal|0
return|;
name|off
index|[
literal|0
index|]
operator|=
name|off
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|int
operator|)
operator|--
name|len
operator|>=
literal|0
condition|)
block|{
name|c0
operator|+=
operator|*
name|p
operator|++
expr_stmt|;
name|c0
operator|%=
literal|255
expr_stmt|;
name|c1
operator|+=
name|c0
expr_stmt|;
name|c1
operator|%=
literal|255
expr_stmt|;
block|}
return|return
operator|(
name|c0
operator||
name|c1
operator|)
return|;
block|}
end_function

end_unit

