begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code  * distributions retain the above copyright notice and this paragraph  * in its entirety, and (2) distributions including binary code include  * the above copyright notice and this paragraph in its entirety in  * the documentation or other materials provided with the distribution.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND  * WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT  * LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS  * FOR A PARTICULAR PURPOSE.  *  * Original code by Hannes Gredler (hannes@juniper.net)  * Support for LMP service discovery extensions (defined by UNI 1.0) added  * by Manu Pathak (mapathak@cisco.com), May 2005  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
name|_U_
init|=
literal|"@(#) $Header: /tcpdump/master/tcpdump/print-lmp.c,v 1.5.2.1 2005/05/19 06:44:03 guy Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<tcpdump-stdinc.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_include
include|#
directive|include
file|"gmpls.h"
end_include

begin_comment
comment|/*  * LMP common header  *  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * | Vers  |      (Reserved)       |    Flags      |    Msg Type   |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |          LMP Length           |          (Reserved)           |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lmp_common_header
block|{
name|u_int8_t
name|version_res
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|flags
decl_stmt|;
name|u_int8_t
name|msg_type
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|reserved
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|LMP_VERSION
value|1
end_define

begin_define
define|#
directive|define
name|LMP_EXTRACT_VERSION
parameter_list|(
name|x
parameter_list|)
value|(((x)&0xf0)>>4)
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_header_flag_values
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|"Control Channel Down"
block|}
block|,
block|{
literal|0x02
block|,
literal|"LMP restart"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_te_link_flag_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Fault Management Supported"
block|}
block|,
block|{
literal|0x02
block|,
literal|"Link Verification Supported"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_data_link_flag_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Data Link Port"
block|}
block|,
block|{
literal|0x02
block|,
literal|"Allocated for user traffic"
block|}
block|,
block|{
literal|0x04
block|,
literal|"Failed link"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_channel_status_values
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"Signal Okay"
block|}
block|,
block|{
literal|2
block|,
literal|"Signal Degraded"
block|}
block|,
block|{
literal|3
block|,
literal|"Signal Fail"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_begin_verify_flag_values
index|[]
init|=
block|{
block|{
literal|0x0001
block|,
literal|"Verify all links"
block|}
block|,
block|{
literal|0x0002
block|,
literal|"Data link type"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_begin_verify_error_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"\n\t\tLink Verification Procedure Not supported"
block|}
block|,
block|{
literal|0x02
block|,
literal|"\n\t\tUnwilling to verify"
block|}
block|,
block|{
literal|0x04
block|,
literal|"\n\t\tUnsupported verification transport mechanism"
block|}
block|,
block|{
literal|0x08
block|,
literal|"\n\t\tLink_Id configuration error"
block|}
block|,
block|{
literal|0x10
block|,
literal|"\n\t\tUnknown object c-type"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_link_summary_error_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"\n\t\tUnacceptable non-negotiable LINK_SUMMARY parameters"
block|}
block|,
block|{
literal|0x02
block|,
literal|"\n\t\tRenegotiate LINK_SUMMARY parameters"
block|}
block|,
block|{
literal|0x04
block|,
literal|"\n\t\tInvalid TE-LINK Object"
block|}
block|,
block|{
literal|0x08
block|,
literal|"\n\t\tInvalid DATA-LINK Object"
block|}
block|,
block|{
literal|0x10
block|,
literal|"\n\t\tUnknown TE-LINK Object c-type"
block|}
block|,
block|{
literal|0x20
block|,
literal|"\n\t\tUnknown DATA-LINK Object c-type"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Service Config Supported Protocols Flags */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_service_config_sp_flag_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"RSVP Supported"
block|}
block|,
block|{
literal|0x02
block|,
literal|"LDP Supported"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Service Config Client Port Service Attribute Transparency Flags */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_service_config_cpsa_tp_flag_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Path/VC Overhead Transparency Supported"
block|}
block|,
block|{
literal|0x02
block|,
literal|"Line/MS Overhead Transparency Supported"
block|}
block|,
block|{
literal|0x04
block|,
literal|"Section/RS Overhead Transparency Supported"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Service Config Client Port Service Attribute Contiguous Concatenation Types Flags */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_service_config_cpsa_cct_flag_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Contiguous Concatenation Types Supported"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Service Config Network Service Attributes Transparency Flags */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_service_config_nsa_transparency_flag_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Standard SOH/RSOH Transparency Supported"
block|}
block|,
block|{
literal|0x02
block|,
literal|"Standard LOH/MSOH Transparency Supported"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Service Config Network Service Attributes TCM Monitoring Flags */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_service_config_nsa_tcm_flag_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Transparent Tandem Connection Monitoring Supported"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Network Service Attributes Network Diversity Flags */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_service_config_nsa_network_diversity_flag_values
index|[]
init|=
block|{
block|{
literal|0x01
block|,
literal|"Node Diversity Supported"
block|}
block|,
block|{
literal|0x02
block|,
literal|"Link Diversity Supported"
block|}
block|,
block|{
literal|0x04
block|,
literal|"SRLG Diversity Supported"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|LMP_MSGTYPE_CONFIG
value|1
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_CONFIG_ACK
value|2
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_CONFIG_NACK
value|3
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_HELLO
value|4
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_VERIFY_BEGIN
value|5
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_VERIFY_BEGIN_ACK
value|6
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_VERIFY_BEGIN_NACK
value|7
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_VERIFY_END
value|8
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_VERIFY_END_ACK
value|9
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_TEST
value|10
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_TEST_STATUS_SUCCESS
value|11
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_TEST_STATUS_FAILURE
value|12
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_TEST_STATUS_ACK
value|13
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_LINK_SUMMARY
value|14
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_LINK_SUMMARY_ACK
value|15
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_LINK_SUMMARY_NACK
value|16
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_CHANNEL_STATUS
value|17
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_CHANNEL_STATUS_ACK
value|18
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_CHANNEL_STATUS_REQ
value|19
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_CHANNEL_STATUS_RESP
value|20
end_define

begin_comment
comment|/* LMP Service Discovery message types defined by UNI 1.0 */
end_comment

begin_define
define|#
directive|define
name|LMP_MSGTYPE_SERVICE_CONFIG
value|50
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_SERVICE_CONFIG_ACK
value|51
end_define

begin_define
define|#
directive|define
name|LMP_MSGTYPE_SERVICE_CONFIG_NACK
value|52
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_msg_type_values
index|[]
init|=
block|{
block|{
name|LMP_MSGTYPE_CONFIG
block|,
literal|"Config"
block|}
block|,
block|{
name|LMP_MSGTYPE_CONFIG_ACK
block|,
literal|"Config ACK"
block|}
block|,
block|{
name|LMP_MSGTYPE_CONFIG_NACK
block|,
literal|"Config NACK"
block|}
block|,
block|{
name|LMP_MSGTYPE_HELLO
block|,
literal|"Hello"
block|}
block|,
block|{
name|LMP_MSGTYPE_VERIFY_BEGIN
block|,
literal|"Begin Verify"
block|}
block|,
block|{
name|LMP_MSGTYPE_VERIFY_BEGIN_ACK
block|,
literal|"Begin Verify ACK"
block|}
block|,
block|{
name|LMP_MSGTYPE_VERIFY_BEGIN_NACK
block|,
literal|"Begin Verify NACK"
block|}
block|,
block|{
name|LMP_MSGTYPE_VERIFY_END
block|,
literal|"End Verify"
block|}
block|,
block|{
name|LMP_MSGTYPE_VERIFY_END_ACK
block|,
literal|"End Verify ACK"
block|}
block|,
block|{
name|LMP_MSGTYPE_TEST
block|,
literal|"Test"
block|}
block|,
block|{
name|LMP_MSGTYPE_TEST_STATUS_SUCCESS
block|,
literal|"Test Status Success"
block|}
block|,
block|{
name|LMP_MSGTYPE_TEST_STATUS_FAILURE
block|,
literal|"Test Status Failure"
block|}
block|,
block|{
name|LMP_MSGTYPE_TEST_STATUS_ACK
block|,
literal|"Test Status ACK"
block|}
block|,
block|{
name|LMP_MSGTYPE_LINK_SUMMARY
block|,
literal|"Link Summary"
block|}
block|,
block|{
name|LMP_MSGTYPE_LINK_SUMMARY_ACK
block|,
literal|"Link Summary ACK"
block|}
block|,
block|{
name|LMP_MSGTYPE_LINK_SUMMARY_NACK
block|,
literal|"Link Summary NACK"
block|}
block|,
block|{
name|LMP_MSGTYPE_CHANNEL_STATUS
block|,
literal|"Channel Status"
block|}
block|,
block|{
name|LMP_MSGTYPE_CHANNEL_STATUS_ACK
block|,
literal|"Channel Status ACK"
block|}
block|,
block|{
name|LMP_MSGTYPE_CHANNEL_STATUS_REQ
block|,
literal|"Channel Status Request"
block|}
block|,
block|{
name|LMP_MSGTYPE_CHANNEL_STATUS_RESP
block|,
literal|"Channel Status Response"
block|}
block|,
block|{
name|LMP_MSGTYPE_SERVICE_CONFIG
block|,
literal|"Service Config"
block|}
block|,
block|{
name|LMP_MSGTYPE_SERVICE_CONFIG_ACK
block|,
literal|"Service Config ACK"
block|}
block|,
block|{
name|LMP_MSGTYPE_SERVICE_CONFIG_NACK
block|,
literal|"Service Config NACK"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*   * LMP object header  *  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |N|   C-Type    |     Class     |            Length             |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                                                               |  * //                       (object contents)                     //  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   */
end_comment

begin_struct
struct|struct
name|lmp_object_header
block|{
name|u_int8_t
name|ctype
decl_stmt|;
name|u_int8_t
name|class_num
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|LMP_OBJ_CC_ID
value|1
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_NODE_ID
value|2
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_LINK_ID
value|3
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_INTERFACE_ID
value|4
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_MESSAGE_ID
value|5
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_CONFIG
value|6
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_HELLO
value|7
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_VERIFY_BEGIN
value|8
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_VERIFY_BEGIN_ACK
value|9
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_VERIFY_ID
value|10
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_TE_LINK
value|11
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_DATA_LINK
value|12
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_CHANNEL_STATUS
value|13
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_CHANNEL_STATUS_REQ
value|14
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_ERROR_CODE
value|20
end_define

begin_define
define|#
directive|define
name|LMP_OBJ_SERVICE_CONFIG
value|51
end_define

begin_comment
comment|/* defined in UNI 1.0 */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_obj_values
index|[]
init|=
block|{
block|{
name|LMP_OBJ_CC_ID
block|,
literal|"Control Channel ID"
block|}
block|,
block|{
name|LMP_OBJ_NODE_ID
block|,
literal|"Node ID"
block|}
block|,
block|{
name|LMP_OBJ_LINK_ID
block|,
literal|"Link ID"
block|}
block|,
block|{
name|LMP_OBJ_INTERFACE_ID
block|,
literal|"Interface ID"
block|}
block|,
block|{
name|LMP_OBJ_MESSAGE_ID
block|,
literal|"Message ID"
block|}
block|,
block|{
name|LMP_OBJ_CONFIG
block|,
literal|"Configuration"
block|}
block|,
block|{
name|LMP_OBJ_HELLO
block|,
literal|"Hello"
block|}
block|,
block|{
name|LMP_OBJ_VERIFY_BEGIN
block|,
literal|"Verify Begin"
block|}
block|,
block|{
name|LMP_OBJ_VERIFY_BEGIN_ACK
block|,
literal|"Verify Begin ACK"
block|}
block|,
block|{
name|LMP_OBJ_VERIFY_ID
block|,
literal|"Verify ID"
block|}
block|,
block|{
name|LMP_OBJ_TE_LINK
block|,
literal|"TE Link"
block|}
block|,
block|{
name|LMP_OBJ_DATA_LINK
block|,
literal|"Data Link"
block|}
block|,
block|{
name|LMP_OBJ_CHANNEL_STATUS
block|,
literal|"Channel Status"
block|}
block|,
block|{
name|LMP_OBJ_CHANNEL_STATUS_REQ
block|,
literal|"Channel Status Request"
block|}
block|,
block|{
name|LMP_OBJ_ERROR_CODE
block|,
literal|"Error Code"
block|}
block|,
block|{
name|LMP_OBJ_SERVICE_CONFIG
block|,
literal|"Service Config"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|INT_SWITCHING_TYPE_SUBOBJ
value|1
end_define

begin_define
define|#
directive|define
name|WAVELENGTH_SUBOBJ
value|2
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_data_link_subobj
index|[]
init|=
block|{
block|{
name|INT_SWITCHING_TYPE_SUBOBJ
block|,
literal|"Interface Switching Type"
block|}
block|,
block|{
name|WAVELENGTH_SUBOBJ
block|,
literal|"Wavelength"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|LMP_CTYPE_IPV4
value|1
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_IPV6
value|2
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_LOC
value|1
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_RMT
value|2
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_UNMD
value|3
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_IPV4_LOC
value|1
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_IPV4_RMT
value|2
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_IPV6_LOC
value|3
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_IPV6_RMT
value|4
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_UNMD_LOC
value|5
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_UNMD_RMT
value|6
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_1
value|1
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_2
value|2
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_HELLO_CONFIG
value|1
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_HELLO
value|1
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_BEGIN_VERIFY_ERROR
value|1
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_LINK_SUMMARY_ERROR
value|2
end_define

begin_comment
comment|/* C-Types for Service Config Object */
end_comment

begin_define
define|#
directive|define
name|LMP_CTYPE_SERVICE_CONFIG_SP
value|1
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_SERVICE_CONFIG_CPSA
value|2
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_SERVICE_CONFIG_TRANSPARENCY_TCM
value|3
end_define

begin_define
define|#
directive|define
name|LMP_CTYPE_SERVICE_CONFIG_NETWORK_DIVERSITY
value|4
end_define

begin_comment
comment|/*   * Different link types allowed in the Client Port Service Attributes  * subobject defined for LMP Service Discovery in the UNI 1.0 spec  */
end_comment

begin_define
define|#
directive|define
name|LMP_SD_SERVICE_CONFIG_CPSA_LINK_TYPE_SDH
value|5
end_define

begin_comment
comment|/* UNI 1.0 Sec 9.4.2 */
end_comment

begin_define
define|#
directive|define
name|LMP_SD_SERVICE_CONFIG_CPSA_LINK_TYPE_SONET
value|6
end_define

begin_comment
comment|/* UNI 1.0 Sec 9.4.2 */
end_comment

begin_define
define|#
directive|define
name|FALSE
value|0
end_define

begin_define
define|#
directive|define
name|TRUE
value|1
end_define

begin_comment
comment|/*  * the ctypes are not globally unique so for  * translating it to strings we build a table based  * on objects offsetted by the ctype  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lmp_ctype_values
index|[]
init|=
block|{
block|{
literal|256
operator|*
name|LMP_OBJ_CC_ID
operator|+
name|LMP_CTYPE_LOC
block|,
literal|"Local"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_CC_ID
operator|+
name|LMP_CTYPE_RMT
block|,
literal|"Remote"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_NODE_ID
operator|+
name|LMP_CTYPE_LOC
block|,
literal|"Local"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_NODE_ID
operator|+
name|LMP_CTYPE_RMT
block|,
literal|"Remote"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_LINK_ID
operator|+
name|LMP_CTYPE_IPV4_LOC
block|,
literal|"IPv4 Local"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_LINK_ID
operator|+
name|LMP_CTYPE_IPV4_RMT
block|,
literal|"IPv4 Remote"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_LINK_ID
operator|+
name|LMP_CTYPE_IPV6_LOC
block|,
literal|"IPv6 Local"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_LINK_ID
operator|+
name|LMP_CTYPE_IPV6_RMT
block|,
literal|"IPv6 Remote"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_LINK_ID
operator|+
name|LMP_CTYPE_UNMD_LOC
block|,
literal|"Unnumbered Local"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_LINK_ID
operator|+
name|LMP_CTYPE_UNMD_RMT
block|,
literal|"Unnumbered Remote"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_INTERFACE_ID
operator|+
name|LMP_CTYPE_IPV4_LOC
block|,
literal|"IPv4 Local"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_INTERFACE_ID
operator|+
name|LMP_CTYPE_IPV4_RMT
block|,
literal|"IPv4 Remote"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_INTERFACE_ID
operator|+
name|LMP_CTYPE_IPV6_LOC
block|,
literal|"IPv6 Local"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_INTERFACE_ID
operator|+
name|LMP_CTYPE_IPV6_RMT
block|,
literal|"IPv6 Remote"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_INTERFACE_ID
operator|+
name|LMP_CTYPE_UNMD_LOC
block|,
literal|"Unnumbered Local"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_INTERFACE_ID
operator|+
name|LMP_CTYPE_UNMD_RMT
block|,
literal|"Unnumbered Remote"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_MESSAGE_ID
operator|+
name|LMP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_MESSAGE_ID
operator|+
name|LMP_CTYPE_2
block|,
literal|"2"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_CONFIG
operator|+
name|LMP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_HELLO
operator|+
name|LMP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_VERIFY_BEGIN
operator|+
name|LMP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_VERIFY_BEGIN_ACK
operator|+
name|LMP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_VERIFY_ID
operator|+
name|LMP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_TE_LINK
operator|+
name|LMP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_TE_LINK
operator|+
name|LMP_CTYPE_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_TE_LINK
operator|+
name|LMP_CTYPE_UNMD
block|,
literal|"Unnumbered"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_DATA_LINK
operator|+
name|LMP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_DATA_LINK
operator|+
name|LMP_CTYPE_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_DATA_LINK
operator|+
name|LMP_CTYPE_UNMD
block|,
literal|"Unnumbered"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_CHANNEL_STATUS
operator|+
name|LMP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_CHANNEL_STATUS
operator|+
name|LMP_CTYPE_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_CHANNEL_STATUS
operator|+
name|LMP_CTYPE_UNMD
block|,
literal|"Unnumbered"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_CHANNEL_STATUS_REQ
operator|+
name|LMP_CTYPE_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_CHANNEL_STATUS_REQ
operator|+
name|LMP_CTYPE_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_CHANNEL_STATUS_REQ
operator|+
name|LMP_CTYPE_UNMD
block|,
literal|"Unnumbered"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_ERROR_CODE
operator|+
name|LMP_CTYPE_1
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_ERROR_CODE
operator|+
name|LMP_CTYPE_2
block|,
literal|"2"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_SERVICE_CONFIG
operator|+
name|LMP_CTYPE_SERVICE_CONFIG_SP
block|,
literal|"1"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_SERVICE_CONFIG
operator|+
name|LMP_CTYPE_SERVICE_CONFIG_CPSA
block|,
literal|"2"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_SERVICE_CONFIG
operator|+
name|LMP_CTYPE_SERVICE_CONFIG_TRANSPARENCY_TCM
block|,
literal|"3"
block|}
block|,
block|{
literal|256
operator|*
name|LMP_OBJ_SERVICE_CONFIG
operator|+
name|LMP_CTYPE_SERVICE_CONFIG_NETWORK_DIVERSITY
block|,
literal|"4"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|lmp_print
parameter_list|(
specifier|register
specifier|const
name|u_char
modifier|*
name|pptr
parameter_list|,
specifier|register
name|u_int
name|len
parameter_list|)
block|{
specifier|const
name|struct
name|lmp_common_header
modifier|*
name|lmp_com_header
decl_stmt|;
specifier|const
name|struct
name|lmp_object_header
modifier|*
name|lmp_obj_header
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|tptr
decl_stmt|,
modifier|*
name|obj_tptr
decl_stmt|;
name|int
name|tlen
decl_stmt|,
name|lmp_obj_len
decl_stmt|,
name|lmp_obj_ctype
decl_stmt|,
name|obj_tlen
decl_stmt|;
name|int
name|hexdump
decl_stmt|;
name|int
name|offset
decl_stmt|,
name|subobj_type
decl_stmt|,
name|subobj_len
decl_stmt|,
name|total_subobj_len
decl_stmt|;
name|int
name|link_type
decl_stmt|;
union|union
block|{
comment|/* int to float conversion buffer */
name|float
name|f
decl_stmt|;
name|u_int32_t
name|i
decl_stmt|;
block|}
name|bw
union|;
name|tptr
operator|=
name|pptr
expr_stmt|;
name|lmp_com_header
operator|=
operator|(
specifier|const
expr|struct
name|lmp_common_header
operator|*
operator|)
name|pptr
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|lmp_com_header
argument_list|)
expr_stmt|;
comment|/*      * Sanity checking of the header.      */
if|if
condition|(
name|LMP_EXTRACT_VERSION
argument_list|(
name|lmp_com_header
operator|->
name|version_res
index|[
literal|0
index|]
argument_list|)
operator|!=
name|LMP_VERSION
condition|)
block|{
name|printf
argument_list|(
literal|"LMP version %u packet not supported"
argument_list|,
name|LMP_EXTRACT_VERSION
argument_list|(
name|lmp_com_header
operator|->
name|version_res
index|[
literal|0
index|]
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* in non-verbose mode just lets print the basic Message Type*/
if|if
condition|(
name|vflag
operator|<
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"LMPv%u %s Message, length: %u"
argument_list|,
name|LMP_EXTRACT_VERSION
argument_list|(
name|lmp_com_header
operator|->
name|version_res
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|tok2str
argument_list|(
name|lmp_msg_type_values
argument_list|,
literal|"unknown (%u)"
argument_list|,
name|lmp_com_header
operator|->
name|msg_type
argument_list|)
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* ok they seem to want to know everything - lets fully decode it */
name|tlen
operator|=
name|EXTRACT_16BITS
argument_list|(
name|lmp_com_header
operator|->
name|length
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\tLMPv%u, msg-type: %s, Flags: [%s], length: %u"
argument_list|,
name|LMP_EXTRACT_VERSION
argument_list|(
name|lmp_com_header
operator|->
name|version_res
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|tok2str
argument_list|(
name|lmp_msg_type_values
argument_list|,
literal|"unknown, type: %u"
argument_list|,
name|lmp_com_header
operator|->
name|msg_type
argument_list|)
argument_list|,
name|bittok2str
argument_list|(
name|lmp_header_flag_values
argument_list|,
literal|"none"
argument_list|,
name|lmp_com_header
operator|->
name|flags
argument_list|)
argument_list|,
name|tlen
argument_list|)
expr_stmt|;
name|tptr
operator|+=
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|lmp_common_header
argument_list|)
expr_stmt|;
name|tlen
operator|-=
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|lmp_common_header
argument_list|)
expr_stmt|;
while|while
condition|(
name|tlen
operator|>
literal|0
condition|)
block|{
comment|/* did we capture enough for fully decoding the object header ? */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|lmp_object_header
argument_list|)
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
name|lmp_obj_header
operator|=
operator|(
specifier|const
expr|struct
name|lmp_object_header
operator|*
operator|)
name|tptr
expr_stmt|;
name|lmp_obj_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|lmp_obj_header
operator|->
name|length
argument_list|)
expr_stmt|;
name|lmp_obj_ctype
operator|=
operator|(
name|lmp_obj_header
operator|->
name|ctype
operator|)
operator|&
literal|0x7f
expr_stmt|;
if|if
condition|(
name|lmp_obj_len
operator|%
literal|4
operator|||
name|lmp_obj_len
operator|<
literal|4
condition|)
return|return;
name|printf
argument_list|(
literal|"\n\t  %s Object (%u), Class-Type: %s (%u) Flags: [%snegotiable], length: %u"
argument_list|,
name|tok2str
argument_list|(
name|lmp_obj_values
argument_list|,
literal|"Unknown"
argument_list|,
name|lmp_obj_header
operator|->
name|class_num
argument_list|)
argument_list|,
name|lmp_obj_header
operator|->
name|class_num
argument_list|,
name|tok2str
argument_list|(
name|lmp_ctype_values
argument_list|,
literal|"Unknown"
argument_list|,
operator|(
operator|(
name|lmp_obj_header
operator|->
name|class_num
operator|)
operator|<<
literal|8
operator|)
operator|+
name|lmp_obj_ctype
argument_list|)
argument_list|,
name|lmp_obj_ctype
argument_list|,
operator|(
name|lmp_obj_header
operator|->
name|ctype
operator|)
operator|&
literal|0x80
condition|?
literal|""
else|:
literal|"non-"
argument_list|,
name|lmp_obj_len
argument_list|)
expr_stmt|;
name|obj_tptr
operator|=
name|tptr
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lmp_object_header
argument_list|)
expr_stmt|;
name|obj_tlen
operator|=
name|lmp_obj_len
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|lmp_object_header
argument_list|)
expr_stmt|;
comment|/* did we capture enough for fully decoding the object ? */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
name|lmp_obj_len
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
name|hexdump
operator|=
name|FALSE
expr_stmt|;
switch|switch
condition|(
name|lmp_obj_header
operator|->
name|class_num
condition|)
block|{
case|case
name|LMP_OBJ_CC_ID
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_LOC
case|:
case|case
name|LMP_CTYPE_RMT
case|:
name|printf
argument_list|(
literal|"\n\t    Control Channel ID: %u (0x%08x)"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_LINK_ID
case|:
case|case
name|LMP_OBJ_INTERFACE_ID
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_IPV4_LOC
case|:
case|case
name|LMP_CTYPE_IPV4_RMT
case|:
name|printf
argument_list|(
literal|"\n\t    IPv4 Link ID: %s (0x%08x)"
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|LMP_CTYPE_IPV6_LOC
case|:
case|case
name|LMP_CTYPE_IPV6_RMT
case|:
name|printf
argument_list|(
literal|"\n\t    IPv6 Link ID: %s (0x%08x)"
argument_list|,
name|ip6addr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
endif|#
directive|endif
case|case
name|LMP_CTYPE_UNMD_LOC
case|:
case|case
name|LMP_CTYPE_UNMD_RMT
case|:
name|printf
argument_list|(
literal|"\n\t    Link ID: %u (0x%08x)"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_MESSAGE_ID
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_1
case|:
name|printf
argument_list|(
literal|"\n\t    Message ID: %u (0x%08x)"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|LMP_CTYPE_2
case|:
name|printf
argument_list|(
literal|"\n\t    Message ID Ack: %u (0x%08x)"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_NODE_ID
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_LOC
case|:
case|case
name|LMP_CTYPE_RMT
case|:
name|printf
argument_list|(
literal|"\n\t    Node ID: %s (0x%08x)"
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_CONFIG
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_HELLO_CONFIG
case|:
name|printf
argument_list|(
literal|"\n\t    Hello Interval: %u\n\t    Hello Dead Interval: %u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_HELLO
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_HELLO
case|:
name|printf
argument_list|(
literal|"\n\t    TxSeqNum: %u\n\t    RcvSeqNum: %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_TE_LINK
case|:
name|printf
argument_list|(
literal|"\n\t    Flags: [%s]"
argument_list|,
name|bittok2str
argument_list|(
name|lmp_obj_te_link_flag_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
operator|>>
literal|8
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_IPV4
case|:
name|printf
argument_list|(
literal|"\n\t    Local Link-ID: %s (0x%08x) \ 			\n\t    Remote Link-ID: %s (0x%08x)"
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
operator|+
literal|8
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|8
argument_list|)
argument_list|)
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|LMP_CTYPE_IPV6
case|:
endif|#
directive|endif
case|case
name|LMP_CTYPE_UNMD
case|:
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_DATA_LINK
case|:
name|printf
argument_list|(
literal|"\n\t    Flags: [%s]"
argument_list|,
name|bittok2str
argument_list|(
name|lmp_obj_data_link_flag_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
operator|>>
literal|8
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_IPV4
case|:
case|case
name|LMP_CTYPE_UNMD
case|:
name|printf
argument_list|(
literal|"\n\t    Local Interface ID: %s (0x%08x) \ 			\n\t    Remote Interface ID: %s (0x%08x)"
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
operator|+
literal|8
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|8
argument_list|)
argument_list|)
expr_stmt|;
name|total_subobj_len
operator|=
name|lmp_obj_len
operator|-
literal|16
expr_stmt|;
name|offset
operator|=
literal|12
expr_stmt|;
while|while
condition|(
name|total_subobj_len
operator|>
literal|0
operator|&&
name|hexdump
operator|==
name|FALSE
condition|)
block|{
name|subobj_type
operator|=
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
argument_list|)
operator|>>
literal|8
expr_stmt|;
name|subobj_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
argument_list|)
operator|&
literal|0x00FF
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    Subobject, Type: %s (%u), Length: %u"
argument_list|,
name|tok2str
argument_list|(
name|lmp_data_link_subobj
argument_list|,
literal|"Unknown"
argument_list|,
name|subobj_type
argument_list|)
argument_list|,
name|subobj_type
argument_list|,
name|subobj_len
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|subobj_type
condition|)
block|{
case|case
name|INT_SWITCHING_TYPE_SUBOBJ
case|:
name|printf
argument_list|(
literal|"\n\t\t    Switching Type: %s (%u)"
argument_list|,
name|tok2str
argument_list|(
name|gmpls_switch_cap_values
argument_list|,
literal|"Unknown"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|2
argument_list|)
operator|>>
literal|8
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|2
argument_list|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t    Encoding Type: %s (%u)"
argument_list|,
name|tok2str
argument_list|(
name|gmpls_encoding_values
argument_list|,
literal|"Unknown"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|2
argument_list|)
operator|&
literal|0x00FF
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|2
argument_list|)
operator|&
literal|0x00FF
argument_list|)
expr_stmt|;
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t    Min Reservable Bandwidth: %.3f Mbps"
argument_list|,
name|bw
operator|.
name|f
argument_list|)
expr_stmt|;
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|8
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t    Max Reservable Bandwidth: %.3f Mbps"
argument_list|,
name|bw
operator|.
name|f
argument_list|)
expr_stmt|;
break|break;
case|case
name|WAVELENGTH_SUBOBJ
case|:
name|printf
argument_list|(
literal|"\n\t\t    Wavelength: %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* Any Unknown Subobject ==> Exit loop */
name|hexdump
operator|=
name|TRUE
expr_stmt|;
break|break;
block|}
name|total_subobj_len
operator|-=
name|subobj_len
expr_stmt|;
name|offset
operator|+=
name|subobj_len
expr_stmt|;
block|}
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|LMP_CTYPE_IPV6
case|:
endif|#
directive|endif
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_VERIFY_BEGIN
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_1
case|:
name|printf
argument_list|(
literal|"\n\t    Flags: %s"
argument_list|,
name|bittok2str
argument_list|(
name|lmp_obj_begin_verify_flag_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    Verify Interval: %u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    Data links: %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    Encoding type: %s"
argument_list|,
name|tok2str
argument_list|(
name|gmpls_encoding_values
argument_list|,
literal|"Unknown"
argument_list|,
operator|*
operator|(
name|obj_tptr
operator|+
literal|8
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    Verify Tranport Mechanism: %u (0x%x) %s"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|10
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|10
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|10
argument_list|)
operator|&
literal|8000
condition|?
literal|"(Payload test messages capable)"
else|:
literal|""
argument_list|)
expr_stmt|;
name|bw
operator|.
name|i
operator|=
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|12
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    Transmission Rate: %.3f Mbps"
argument_list|,
name|bw
operator|.
name|f
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    Wavelength: %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|16
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_VERIFY_BEGIN_ACK
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_1
case|:
name|printf
argument_list|(
literal|"\n\t    Verify Dead Interval: %u 	\ 			\n\t    Verify Transport Response: %u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_VERIFY_ID
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_1
case|:
name|printf
argument_list|(
literal|"\n\t    Verify ID: %u"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_CHANNEL_STATUS
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_IPV4
case|:
case|case
name|LMP_CTYPE_UNMD
case|:
name|offset
operator|=
literal|0
expr_stmt|;
comment|/* Decode pairs:<Interface_ID (4 bytes), Channel_status (4 bytes)> */
while|while
condition|(
name|offset
operator|<
operator|(
name|lmp_obj_len
operator|-
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
expr|struct
name|lmp_object_header
argument_list|)
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t    Interface ID: %s (0x%08x)"
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
operator|+
name|offset
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t    Active: %s (%u)"
argument_list|,
operator|(
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|4
argument_list|)
operator|>>
literal|31
operator|)
condition|?
literal|"Allocated"
else|:
literal|"Non-allocated"
argument_list|,
operator|(
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|4
argument_list|)
operator|>>
literal|31
operator|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t    Direction: %s (%u)"
argument_list|,
operator|(
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|4
argument_list|)
operator|>>
literal|30
operator|)
operator|&
literal|0x1
condition|?
literal|"Transmit"
else|:
literal|"Receive"
argument_list|,
operator|(
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|4
argument_list|)
operator|>>
literal|30
operator|)
operator|&
literal|0x1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t\t    Channel Status: %s (%u)"
argument_list|,
name|tok2str
argument_list|(
name|lmp_obj_channel_status_values
argument_list|,
literal|"Unknown"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|4
argument_list|)
operator|&
literal|0x3FFFFFF
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
operator|+
literal|4
argument_list|)
operator|&
literal|0x3FFFFFF
argument_list|)
expr_stmt|;
name|offset
operator|+=
literal|8
expr_stmt|;
block|}
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|LMP_CTYPE_IPV6
case|:
endif|#
directive|endif
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_CHANNEL_STATUS_REQ
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_IPV4
case|:
case|case
name|LMP_CTYPE_UNMD
case|:
name|offset
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|offset
operator|<
operator|(
name|lmp_obj_len
operator|-
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
expr|struct
name|lmp_object_header
argument_list|)
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t    Interface ID: %s (0x%08x)"
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
operator|+
name|offset
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
name|offset
argument_list|)
argument_list|)
expr_stmt|;
name|offset
operator|+=
literal|4
expr_stmt|;
block|}
break|break;
ifdef|#
directive|ifdef
name|INET6
case|case
name|LMP_CTYPE_IPV6
case|:
endif|#
directive|endif
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_ERROR_CODE
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_BEGIN_VERIFY_ERROR
case|:
name|printf
argument_list|(
literal|"\n\t    Error Code: %s"
argument_list|,
name|bittok2str
argument_list|(
name|lmp_obj_begin_verify_error_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|LMP_CTYPE_LINK_SUMMARY_ERROR
case|:
name|printf
argument_list|(
literal|"\n\t    Error Code: %s"
argument_list|,
name|bittok2str
argument_list|(
name|lmp_obj_link_summary_error_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|LMP_OBJ_SERVICE_CONFIG
case|:
switch|switch
condition|(
name|lmp_obj_ctype
condition|)
block|{
case|case
name|LMP_CTYPE_SERVICE_CONFIG_SP
case|:
name|printf
argument_list|(
literal|"\n\t Flags: %s"
argument_list|,
name|bittok2str
argument_list|(
name|lmp_obj_service_config_sp_flag_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
operator|>>
literal|8
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  UNI Version: %u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
operator|&
literal|0x00FF
argument_list|)
expr_stmt|;
break|break;
case|case
name|LMP_CTYPE_SERVICE_CONFIG_CPSA
case|:
name|link_type
operator|=
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
operator|>>
literal|8
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t Link Type: %s (%u)"
argument_list|,
name|tok2str
argument_list|(
name|lmp_sd_service_config_cpsa_link_type_values
argument_list|,
literal|"Unknown"
argument_list|,
name|link_type
argument_list|)
argument_list|,
name|link_type
argument_list|)
expr_stmt|;
if|if
condition|(
name|link_type
operator|==
name|LMP_SD_SERVICE_CONFIG_CPSA_LINK_TYPE_SDH
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t Signal Type: %s (%u)"
argument_list|,
name|tok2str
argument_list|(
name|lmp_sd_service_config_cpsa_signal_type_sdh_values
argument_list|,
literal|"Unknown"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
operator|&
literal|0x00FF
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
operator|&
literal|0x00FF
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|link_type
operator|==
name|LMP_SD_SERVICE_CONFIG_CPSA_LINK_TYPE_SONET
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t Signal Type: %s (%u)"
argument_list|,
name|tok2str
argument_list|(
name|lmp_sd_service_config_cpsa_signal_type_sonet_values
argument_list|,
literal|"Unknown"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
operator|&
literal|0x00FF
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
argument_list|)
operator|&
literal|0x00FF
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n\t Transparency: %s"
argument_list|,
name|bittok2str
argument_list|(
name|lmp_obj_service_config_cpsa_tp_flag_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
operator|>>
literal|8
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t Contiguous Concatenation Types: %s"
argument_list|,
name|bittok2str
argument_list|(
name|lmp_obj_service_config_cpsa_cct_flag_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
operator|>>
literal|8
operator|&
literal|0x00FF
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t Minimum NCC: %u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t Maximum NCC: %u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t Minimum NVC:%u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|8
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t Maximum NVC:%u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    Local Interface ID: %s (0x%08x)"
argument_list|,
name|ipaddr_string
argument_list|(
name|obj_tptr
operator|+
literal|12
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
operator|+
literal|12
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|LMP_CTYPE_SERVICE_CONFIG_TRANSPARENCY_TCM
case|:
name|printf
argument_list|(
literal|"\n\t Transparency Flags: %s"
argument_list|,
name|bittok2str
argument_list|(
name|lmp_obj_service_config_nsa_transparency_flag_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
name|obj_tptr
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t TCM Monitoring Flags: %s"
argument_list|,
name|bittok2str
argument_list|(
name|lmp_obj_service_config_nsa_tcm_flag_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|6
argument_list|)
operator|&
literal|0x00FF
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|LMP_CTYPE_SERVICE_CONFIG_NETWORK_DIVERSITY
case|:
name|printf
argument_list|(
literal|"\n\t Diversity: Flags: %s"
argument_list|,
name|bittok2str
argument_list|(
name|lmp_obj_service_config_nsa_network_diversity_flag_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|obj_tptr
operator|+
literal|2
argument_list|)
operator|&
literal|0x00FF
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|hexdump
operator|=
name|TRUE
expr_stmt|;
block|}
empty_stmt|;
break|break;
default|default:
if|if
condition|(
name|vflag
operator|<=
literal|1
condition|)
name|print_unknown_data
argument_list|(
name|obj_tptr
argument_list|,
literal|"\n\t    "
argument_list|,
name|obj_tlen
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* do we want to see an additionally hexdump ? */
if|if
condition|(
name|vflag
operator|>
literal|1
operator|||
name|hexdump
operator|==
name|TRUE
condition|)
name|print_unknown_data
argument_list|(
name|tptr
operator|+
sizeof|sizeof
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|lmp_object_header
argument_list|)
argument_list|)
argument_list|,
literal|"\n\t    "
argument_list|,
name|lmp_obj_len
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|lmp_object_header
argument_list|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
name|lmp_obj_len
expr_stmt|;
name|tlen
operator|-=
name|lmp_obj_len
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|printf
argument_list|(
literal|"\n\t\t packet exceeded snapshot"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

