begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1991, 1993, 1994, 1995, 1996, 1997  *      The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code distributions  * retain the above copyright notice and this paragraph in its entirety, (2)  * distributions including binary code include the above copyright notice and  * this paragraph in its entirety in the documentation or other materials  * provided with the distribution, and (3) all advertising materials mentioning  * features or use of this software display the following acknowledgement:  * ``This product includes software developed by the University of California,  * Lawrence Berkeley Laboratory and its contributors.'' Neither the name of  * the University nor the names of its contributors may be used to endorse  * or promote products derived from this software without specific prior  * written permission.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED  * WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  *  * L2TP support contributed by Motonori Shindo (mshindo@mshindo.net)  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
init|=
literal|"@(#) $Header: /tcpdump/master/tcpdump/print-l2tp.c,v 1.8 2000/08/18 07:44:46 itojun Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_include
include|#
directive|include
file|"l2tp.h"
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_decl_stmt
specifier|static
name|char
name|tstr
index|[]
init|=
literal|" [|l2tp]"
decl_stmt|;
end_decl_stmt

begin_ifndef
ifndef|#
directive|ifndef
name|TRUE
end_ifndef

begin_define
define|#
directive|define
name|TRUE
value|1
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|FALSE
end_ifndef

begin_define
define|#
directive|define
name|FALSE
value|0
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|char
modifier|*
name|l2tp_message_type_string
index|[]
init|=
block|{
literal|"RESERVED_0"
block|,
comment|/* 0  Reserved */
literal|"SCCRQ"
block|,
comment|/* 1  Start-Control-Connection-Request */
literal|"SCCRP"
block|,
comment|/* 2  Start-Control-Connection-Reply */
literal|"SCCCN"
block|,
comment|/* 3  Start-Control-Connection-Connected */
literal|"StopCCN"
block|,
comment|/* 4  Stop-Control-Connection-Notification */
literal|"RESERVED_5"
block|,
comment|/* 5  Reserved */
literal|"HELLO"
block|,
comment|/* 6  Hello */
literal|"OCRQ"
block|,
comment|/* 7  Outgoing-Call-Request */
literal|"OCRP"
block|,
comment|/* 8  Outgoing-Call-Reply */
literal|"OCCN"
block|,
comment|/* 9  Outgoing-Call-Connected */
literal|"ICRQ"
block|,
comment|/* 10 Incoming-Call-Request */
literal|"ICRP"
block|,
comment|/* 11 Incoming-Call-Reply */
literal|"ICCN"
block|,
comment|/* 12 Incoming-Call-Connected */
literal|"RESERVED_13"
block|,
comment|/* 13 Reserved */
literal|"CDN"
block|,
comment|/* 14 Call-Disconnect-Notify */
literal|"WEN"
block|,
comment|/* 15 WAN-Error-Notify */
literal|"SLI"
comment|/* 16 Set-Link-Info */
define|#
directive|define
name|L2TP_MAX_MSGTYPE_INDEX
value|17
block|}
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|l2tp_msgtype_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_result_code_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_proto_ver_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_framing_cap_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_bearer_cap_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_tie_breaker_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_firm_ver_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_host_name_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_vendor_name_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_assnd_tun_id_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_recv_win_size_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_challenge_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_q931_cc_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_challenge_resp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_assnd_sess_id_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_call_ser_num_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_minimum_bps_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_maximum_bps_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_bearer_type_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_framing_type_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_packet_proc_delay_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_called_number_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_calling_number_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_sub_address_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_tx_conn_speed_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_phy_channel_id_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_ini_recv_lcp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_last_sent_lcp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_last_recv_lcp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_proxy_auth_type_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_proxy_auth_name_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_proxy_auth_chal_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_proxy_auth_id_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_proxy_auth_resp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_call_errors_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_accm_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_random_vector_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_private_grp_id_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_rx_conn_speed_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_seq_required_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|l2tp_avp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|struct
name|l2tp_avp_vec
name|l2tp_avp
index|[]
init|=
block|{
block|{
literal|"MSGTYPE"
block|,
name|l2tp_msgtype_print
block|}
block|,
comment|/* 0  Message Type */
block|{
literal|"RESULT_CODE"
block|,
name|l2tp_result_code_print
block|}
block|,
comment|/* 1  Result Code */
block|{
literal|"PROTO_VER"
block|,
name|l2tp_proto_ver_print
block|}
block|,
comment|/* 2  Protocol Version */
block|{
literal|"FRAMING_CAP"
block|,
name|l2tp_framing_cap_print
block|}
block|,
comment|/* 3  Framing Capabilities */
block|{
literal|"BEARER_CAP"
block|,
name|l2tp_bearer_cap_print
block|}
block|,
comment|/* 4  Bearer Capabilities */
block|{
literal|"TIE_BREAKER"
block|,
name|l2tp_tie_breaker_print
block|}
block|,
comment|/* 5  Tie Breaker */
block|{
literal|"FIRM_VER"
block|,
name|l2tp_firm_ver_print
block|}
block|,
comment|/* 6  Firmware Revision */
block|{
literal|"HOST_NAME"
block|,
name|l2tp_host_name_print
block|}
block|,
comment|/* 7  Host Name */
block|{
literal|"VENDOR_NAME"
block|,
name|l2tp_vendor_name_print
block|}
block|,
comment|/* 8  Vendor Name */
block|{
literal|"ASSND_TUN_ID"
block|,
name|l2tp_assnd_tun_id_print
block|}
block|,
comment|/* 9  Assigned Tunnel ID */
block|{
literal|"RECV_WIN_SIZE"
block|,
name|l2tp_recv_win_size_print
block|}
block|,
comment|/* 10 Receive Window Size */
block|{
literal|"CHALLENGE"
block|,
name|l2tp_challenge_print
block|}
block|,
comment|/* 11 Challenge */
block|{
literal|"Q931_CC"
block|,
name|l2tp_q931_cc_print
block|}
block|,
comment|/* 12 Q.931 Cause Code */
block|{
literal|"CHALLENGE_RESP"
block|,
name|l2tp_challenge_resp_print
block|}
block|,
comment|/* 13 Challenge Response */
block|{
literal|"ASSND_SESS_ID"
block|,
name|l2tp_assnd_sess_id_print
block|}
block|,
comment|/* 14 Assigned Session ID */
block|{
literal|"CALL_SER_NUM"
block|,
name|l2tp_call_ser_num_print
block|}
block|,
comment|/* 15 Call Serial Number */
block|{
literal|"MINIMUM_BPS"
block|,
name|l2tp_minimum_bps_print
block|}
block|,
comment|/* 16 Minimum BPS */
block|{
literal|"MAXIMUM_BPS"
block|,
name|l2tp_maximum_bps_print
block|}
block|,
comment|/* 17 Maximum BPS */
block|{
literal|"BEARER_TYPE"
block|,
name|l2tp_bearer_type_print
block|}
block|,
comment|/* 18 Bearer Type */
block|{
literal|"FRAMING_TYPE"
block|,
name|l2tp_framing_type_print
block|}
block|,
comment|/* 19 Framing Type */
block|{
literal|"PACKET_PROC_DELAY"
block|,
name|l2tp_packet_proc_delay_print
block|}
block|,
comment|/* 20 Packet Processing Delay (OBSOLETE) */
block|{
literal|"CALLED_NUMBER"
block|,
name|l2tp_called_number_print
block|}
block|,
comment|/* 21 Called Number */
block|{
literal|"CALLING_NUMBER"
block|,
name|l2tp_calling_number_print
block|}
block|,
comment|/* 22 Calling Number */
block|{
literal|"SUB_ADDRESS"
block|,
name|l2tp_sub_address_print
block|}
block|,
comment|/* 23 Sub-Address */
block|{
literal|"TX_CONN_SPEED"
block|,
name|l2tp_tx_conn_speed_print
block|}
block|,
comment|/* 24 (Tx) Connect Speed */
block|{
literal|"PHY_CHANNEL_ID"
block|,
name|l2tp_phy_channel_id_print
block|}
block|,
comment|/* 25 Physical Channel ID */
block|{
literal|"INI_RECV_LCP"
block|,
name|l2tp_ini_recv_lcp_print
block|}
block|,
comment|/* 26 Initial Received LCP CONFREQ */
block|{
literal|"LAST_SENT_LCP"
block|,
name|l2tp_last_sent_lcp_print
block|}
block|,
comment|/* 27 Last Sent LCP CONFREQ */
block|{
literal|"LAST_RECV_LCP"
block|,
name|l2tp_last_recv_lcp_print
block|}
block|,
comment|/* 28 Last Received LCP CONFREQ */
block|{
literal|"PROXY_AUTH_TYPE"
block|,
name|l2tp_proxy_auth_type_print
block|}
block|,
comment|/* 29 Proxy Authen Type */
block|{
literal|"PROXY_AUTH_NAME"
block|,
name|l2tp_proxy_auth_name_print
block|}
block|,
comment|/* 30 Proxy Authen Name */
block|{
literal|"PROXY_AUTH_CHAL"
block|,
name|l2tp_proxy_auth_chal_print
block|}
block|,
comment|/* 31 Proxy Authen Challenge */
block|{
literal|"PROXY_AUTH_ID"
block|,
name|l2tp_proxy_auth_id_print
block|}
block|,
comment|/* 32 Proxy Authen ID */
block|{
literal|"PROXY_AUTH_RESP"
block|,
name|l2tp_proxy_auth_resp_print
block|}
block|,
comment|/* 33 Proxy Authen Response */
block|{
literal|"CALL_ERRORS"
block|,
name|l2tp_call_errors_print
block|}
block|,
comment|/* 34 Call Errors */
block|{
literal|"ACCM"
block|,
name|l2tp_accm_print
block|}
block|,
comment|/* 35 ACCM */
block|{
literal|"RANDOM_VECTOR"
block|,
name|l2tp_random_vector_print
block|}
block|,
comment|/* 36 Random Vector */
block|{
literal|"PRIVATE_GRP_ID"
block|,
name|l2tp_private_grp_id_print
block|}
block|,
comment|/* 37 Private Group ID */
block|{
literal|"RX_CONN_SPEED"
block|,
name|l2tp_rx_conn_speed_print
block|}
block|,
comment|/* 38 (Rx) Connect Speed */
block|{
literal|"SEQ_REQUIRED"
block|,
name|l2tp_seq_required_print
block|}
block|,
comment|/* 39 Sequencing Required */
define|#
directive|define
name|L2TP_MAX_AVP_INDEX
value|40
block|}
decl_stmt|;
end_decl_stmt

begin_if
if|#
directive|if
literal|0
end_if

begin_define
unit|static char *l2tp_result_code_StopCCN[] = {          "Reserved",          "General request to clear control connection",          "General error--Error Code indicates the problem",          "Control channel already exists",          "Requester is not authorized to establish a control channel",          "The protocol version of the requester is not supported",          "Requester is being shut down",          "Finite State Machine error"
define|#
directive|define
name|L2TP_MAX_RESULT_CODE_STOPCC_INDEX
value|8
end_define

begin_endif
unit|};
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
literal|0
end_if

begin_define
unit|static char *l2tp_result_code_CDN[] = { 	"Reserved", 	"Call disconnected due to loss of carrier", 	"Call disconnected for the reason indicated in error code", 	"Call disconnected for administrative reasons", 	"Call failed due to lack of appropriate facilities being " \ 	"available (temporary condition)", 	"Call failed due to lack of appropriate facilities being " \ 	"available (permanent condition)", 	"Invalid destination", 	"Call failed due to no carrier detected", 	"Call failed due to detection of a busy signal", 	"Call failed due to lack of a dial tone", 	"Call was not established within time allotted by LAC", 	"Call was connected but no appropriate framing was detected"
define|#
directive|define
name|L2TP_MAX_RESULT_CODE_CDN_INDEX
value|12
end_define

begin_endif
unit|};
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
literal|0
end_if

begin_define
unit|static char *l2tp_error_code_general[] = { 	"No general error", 	"No control connection exists yet for this LAC-LNS pair", 	"Length is wrong", 	"One of the field values was out of range or " \ 	"reserved field was non-zero" 	"Insufficient resources to handle this operation now", 	"The Session ID is invalid in this context", 	"A generic vendor-specific error occurred in the LAC", 	"Try another"
define|#
directive|define
name|L2TP_MAX_ERROR_CODE_GENERAL_INDEX
value|8
end_define

begin_endif
unit|};
endif|#
directive|endif
end_endif

begin_comment
comment|/******************************/
end_comment

begin_comment
comment|/* generic print out routines */
end_comment

begin_comment
comment|/******************************/
end_comment

begin_function
specifier|static
name|void
name|print_string
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|length
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%c"
argument_list|,
operator|*
name|dat
operator|++
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_octets
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|length
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
name|dat
operator|++
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_short
parameter_list|(
specifier|const
name|u_short
modifier|*
name|dat
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%u"
argument_list|,
name|ntohs
argument_list|(
operator|*
name|dat
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_int
parameter_list|(
specifier|const
name|u_int
modifier|*
name|dat
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%lu"
argument_list|,
operator|(
name|u_long
operator|)
name|ntohl
argument_list|(
operator|*
name|dat
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**********************************/
end_comment

begin_comment
comment|/* AVP-specific print out routines*/
end_comment

begin_comment
comment|/**********************************/
end_comment

begin_function
specifier|static
name|void
name|l2tp_msgtype_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_short
modifier|*
name|ptr
init|=
operator|(
name|u_short
operator|*
operator|)
name|dat
decl_stmt|;
if|if
condition|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|<
name|L2TP_MAX_MSGTYPE_INDEX
condition|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|l2tp_message_type_string
index|[
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_result_code_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
comment|/* we just print out the result and error code number */
name|u_short
modifier|*
name|ptr
init|=
operator|(
name|u_short
operator|*
operator|)
name|dat
decl_stmt|;
if|if
condition|(
name|length
operator|==
literal|2
condition|)
block|{
comment|/* result code */
name|printf
argument_list|(
literal|"%u"
argument_list|,
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|length
operator|==
literal|4
condition|)
block|{
comment|/* result& error code */
name|printf
argument_list|(
literal|"%u/%u"
argument_list|,
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
argument_list|,
name|ntohs
argument_list|(
operator|*
operator|(
name|ptr
operator|+
literal|1
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|length
operator|>
literal|4
condition|)
block|{
comment|/* result& error code& msg */
name|printf
argument_list|(
literal|"%u/%u "
argument_list|,
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
argument_list|,
name|ntohs
argument_list|(
operator|*
operator|(
name|ptr
operator|+
literal|1
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
operator|(
name|u_char
operator|*
operator|)
operator|(
name|ptr
operator|+
literal|2
operator|)
argument_list|,
name|length
operator|-
literal|4
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_proto_ver_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%d.%d"
argument_list|,
operator|*
name|dat
argument_list|,
operator|*
operator|(
name|dat
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_framing_cap_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_int
modifier|*
name|ptr
init|=
operator|(
name|u_int
operator|*
operator|)
name|dat
decl_stmt|;
if|if
condition|(
name|ntohl
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_FRAMING_CAP_ASYNC_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"A"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ntohl
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_FRAMING_CAP_SYNC_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"S"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_bearer_cap_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_int
modifier|*
name|ptr
init|=
operator|(
name|u_int
operator|*
operator|)
name|dat
decl_stmt|;
if|if
condition|(
name|ntohl
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_BEARER_CAP_ANALOG_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"A"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ntohl
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_BEARER_CAP_DIGITAL_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"D"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_tie_breaker_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_octets
argument_list|(
name|dat
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* Tie Break Value is 64bits long */
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_firm_ver_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_short
argument_list|(
operator|(
name|u_short
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_host_name_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_string
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_vendor_name_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_string
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_assnd_tun_id_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_short
argument_list|(
operator|(
name|u_short
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_recv_win_size_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_short
argument_list|(
operator|(
name|u_short
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_challenge_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_octets
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_q931_cc_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_short
argument_list|(
operator|(
name|u_short
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", %02x"
argument_list|,
name|dat
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|>
literal|3
condition|)
block|{
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|dat
operator|+
literal|3
argument_list|,
name|length
operator|-
literal|3
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_challenge_resp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_octets
argument_list|(
name|dat
argument_list|,
literal|16
argument_list|)
expr_stmt|;
comment|/* XXX length should be 16? */
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_assnd_sess_id_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_short
argument_list|(
operator|(
name|u_short
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_call_ser_num_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_int
argument_list|(
operator|(
name|u_int
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_minimum_bps_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_int
argument_list|(
operator|(
name|u_int
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_maximum_bps_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_int
argument_list|(
operator|(
name|u_int
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_bearer_type_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_int
modifier|*
name|ptr
init|=
operator|(
name|u_int
operator|*
operator|)
name|dat
decl_stmt|;
if|if
condition|(
name|ntohl
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_BEARER_TYPE_ANALOG_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"A"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ntohl
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_BEARER_TYPE_DIGITAL_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"D"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_framing_type_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_int
modifier|*
name|ptr
init|=
operator|(
name|u_int
operator|*
operator|)
name|dat
decl_stmt|;
if|if
condition|(
name|ntohl
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_FRAMING_TYPE_ASYNC_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"A"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ntohl
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_FRAMING_TYPE_SYNC_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"S"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_packet_proc_delay_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|printf
argument_list|(
literal|"obsolete"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_called_number_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_string
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_calling_number_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_string
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_sub_address_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_string
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_tx_conn_speed_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_int
argument_list|(
operator|(
name|u_int
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_phy_channel_id_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_int
argument_list|(
operator|(
name|u_int
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_ini_recv_lcp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_octets
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_last_sent_lcp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_octets
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_last_recv_lcp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_octets
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_proxy_auth_type_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_short
modifier|*
name|ptr
init|=
operator|(
name|u_short
operator|*
operator|)
name|dat
decl_stmt|;
switch|switch
condition|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
condition|)
block|{
case|case
name|L2TP_AUTHEN_TYPE_RESERVED
case|:
name|printf
argument_list|(
literal|"Reserved"
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AUTHEN_TYPE_TEXTUAL
case|:
name|printf
argument_list|(
literal|"Textual"
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AUTHEN_TYPE_CHAP
case|:
name|printf
argument_list|(
literal|"CHAP"
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AUTHEN_TYPE_PAP
case|:
name|printf
argument_list|(
literal|"PAP"
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AUTHEN_TYPE_NO_AUTH
case|:
name|printf
argument_list|(
literal|"No Auth"
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AUTHEN_TYPE_MSCHAP
case|:
name|printf
argument_list|(
literal|"MS-CHAP"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"unknown"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_proxy_auth_name_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_octets
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_proxy_auth_chal_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_octets
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_proxy_auth_id_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_short
modifier|*
name|ptr
init|=
operator|(
name|u_short
operator|*
operator|)
name|dat
decl_stmt|;
name|printf
argument_list|(
literal|"%u"
argument_list|,
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_PROXY_AUTH_ID_MASK
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_proxy_auth_resp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_octets
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_call_errors_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|struct
name|l2tp_call_errors
modifier|*
name|ptr
init|=
operator|(
expr|struct
name|l2tp_call_errors
operator|*
operator|)
name|dat
decl_stmt|;
name|printf
argument_list|(
literal|"CRCErr=%d FrameErr=%d HardOver=%d BufOver=%d "
argument_list|,
name|ptr
operator|->
name|crc_errs
argument_list|,
name|ptr
operator|->
name|framing_errs
argument_list|,
name|ptr
operator|->
name|hardware_overruns
argument_list|,
name|ptr
operator|->
name|buffer_overruns
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Timeout=%d AlingErr=%d"
argument_list|,
name|ptr
operator|->
name|timeout_errs
argument_list|,
name|ptr
operator|->
name|alignment_errs
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_accm_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|struct
name|l2tp_accm
modifier|*
name|ptr
init|=
operator|(
expr|struct
name|l2tp_accm
operator|*
operator|)
name|dat
decl_stmt|;
name|printf
argument_list|(
literal|"send=%x recv=%x"
argument_list|,
name|ptr
operator|->
name|send_accm
argument_list|,
name|ptr
operator|->
name|recv_accm
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_random_vector_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_octets
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_private_grp_id_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_string
argument_list|(
name|dat
argument_list|,
name|length
argument_list|)
expr_stmt|;
comment|/* XXX print_octets is more appropriate?? */
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_rx_conn_speed_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_int
argument_list|(
operator|(
name|u_int
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_seq_required_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_avp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_int
name|len
decl_stmt|;
specifier|const
name|u_short
modifier|*
name|ptr
init|=
operator|(
name|u_short
operator|*
operator|)
name|dat
decl_stmt|;
name|int
name|hidden
init|=
name|FALSE
decl_stmt|;
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|>
literal|0
operator|&&
operator|(
name|snapend
operator|-
name|dat
operator|)
operator|>=
literal|2
condition|)
block|{
comment|/* there must be at least two octets for the length 		   to be decoded */
if|if
condition|(
operator|(
name|len
operator|=
operator|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_AVP_HDR_LEN_MASK
operator|)
operator|)
operator|<=
operator|(
name|snapend
operator|-
name|dat
operator|)
condition|)
block|{
if|if
condition|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_AVP_HDR_FLAG_MANDATORY
condition|)
block|{
name|printf
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_AVP_HDR_FLAG_HIDDEN
condition|)
block|{
name|hidden
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"?"
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|printf
argument_list|(
literal|"|..."
argument_list|)
expr_stmt|;
return|return;
block|}
name|ptr
operator|++
expr_stmt|;
if|if
condition|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
condition|)
block|{
comment|/* Vendor Specific Attribute */
name|printf
argument_list|(
literal|"VENDOR%04x:"
argument_list|,
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"ATTR%04x"
argument_list|,
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
name|print_octets
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
operator|+
literal|2
argument_list|,
name|len
operator|-
literal|6
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* IETF-defined Attribute */
name|ptr
operator|++
expr_stmt|;
if|if
condition|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|<
name|L2TP_MAX_AVP_INDEX
condition|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|l2tp_avp
index|[
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|hidden
condition|)
block|{
operator|(
name|l2tp_avp
index|[
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
index|]
operator|.
name|print
operator|)
operator|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
operator|+
literal|2
operator|,
name|len
operator|-
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"???"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|" invalid AVP %u"
argument_list|,
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|l2tp_avp_print
argument_list|(
name|dat
operator|+
name|len
argument_list|,
name|length
operator|-
name|len
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|length
operator|==
literal|0
condition|)
block|{
return|return;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"|..."
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|l2tp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
specifier|const
name|u_short
modifier|*
name|ptr
init|=
operator|(
name|u_short
operator|*
operator|)
name|dat
decl_stmt|;
name|u_int
name|cnt
init|=
literal|0
decl_stmt|;
comment|/* total octets consumed */
name|u_short
name|pad
decl_stmt|;
name|int
name|flag_t
decl_stmt|,
name|flag_l
decl_stmt|,
name|flag_s
decl_stmt|,
name|flag_o
decl_stmt|,
name|flag_p
decl_stmt|;
name|u_short
name|l2tp_len
decl_stmt|;
name|flag_t
operator|=
name|flag_l
operator|=
name|flag_s
operator|=
name|flag_o
operator|=
name|flag_p
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|min
argument_list|(
name|length
argument_list|,
name|snapend
operator|-
name|dat
argument_list|)
operator|-
literal|6
operator|<
literal|0
condition|)
block|{
comment|/* flag/ver, tunnel_id, session_id must be present for 		   this packet to be properly decoded */
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tstr
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_VERSION_MASK
operator|)
operator|==
name|L2TP_VERSION_L2TP
condition|)
block|{
name|printf
argument_list|(
literal|" l2tp:"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_VERSION_MASK
operator|)
operator|==
name|L2TP_VERSION_L2F
condition|)
block|{
name|printf
argument_list|(
literal|" l2f:"
argument_list|)
expr_stmt|;
return|return;
comment|/* nothing to do */
block|}
else|else
block|{
name|printf
argument_list|(
literal|" Unknown Version, neither L2F(1) nor L2TP(2)"
argument_list|)
expr_stmt|;
return|return;
comment|/* nothing we can do */
block|}
name|printf
argument_list|(
literal|"["
argument_list|)
expr_stmt|;
if|if
condition|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_FLAG_TYPE
condition|)
block|{
name|flag_t
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"T"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_FLAG_LENGTH
condition|)
block|{
name|flag_l
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"L"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_FLAG_SEQUENCE
condition|)
block|{
name|flag_s
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"S"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_FLAG_OFFSET
condition|)
block|{
name|flag_o
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"O"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ntohs
argument_list|(
operator|*
name|ptr
argument_list|)
operator|&
name|L2TP_FLAG_PRIORITY
condition|)
block|{
name|flag_p
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"P"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|cnt
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
name|flag_l
condition|)
block|{
name|l2tp_len
operator|=
name|ntohs
argument_list|(
operator|*
name|ptr
operator|++
argument_list|)
expr_stmt|;
comment|/* XXX need to consider  						   truncation ?? */
name|cnt
operator|+=
literal|2
expr_stmt|;
block|}
else|else
block|{
name|l2tp_len
operator|=
literal|0
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"(%u/"
argument_list|,
name|ntohs
argument_list|(
operator|*
name|ptr
operator|++
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Tunnel ID */
name|printf
argument_list|(
literal|"%u)"
argument_list|,
name|ntohs
argument_list|(
operator|*
name|ptr
operator|++
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Session ID */
name|cnt
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|flag_s
condition|)
block|{
name|printf
argument_list|(
literal|"Ns=%u,"
argument_list|,
name|ntohs
argument_list|(
operator|*
name|ptr
operator|++
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Nr=%u"
argument_list|,
name|ntohs
argument_list|(
operator|*
name|ptr
operator|++
argument_list|)
argument_list|)
expr_stmt|;
name|cnt
operator|+=
literal|4
expr_stmt|;
block|}
if|if
condition|(
name|flag_o
condition|)
block|{
name|pad
operator|=
name|ntohs
argument_list|(
operator|*
name|ptr
operator|++
argument_list|)
expr_stmt|;
name|ptr
operator|+=
name|pad
operator|/
sizeof|sizeof
argument_list|(
operator|*
name|ptr
argument_list|)
expr_stmt|;
name|cnt
operator|+=
operator|(
literal|2
operator|+
name|pad
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|flag_t
condition|)
block|{
if|if
condition|(
name|length
operator|-
name|cnt
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|" ZLB"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|l2tp_avp_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|length
operator|-
name|cnt
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|printf
argument_list|(
literal|" {"
argument_list|)
expr_stmt|;
name|ppp_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|length
operator|-
name|cnt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

