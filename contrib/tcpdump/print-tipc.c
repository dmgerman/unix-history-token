begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997  *	The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code distributions  * retain the above copyright notice and this paragraph in its entirety, (2)  * distributions including binary code include the above copyright notice and  * this paragraph in its entirety in the documentation or other materials  * provided with the distribution, and (3) all advertising materials mentioning  * features or use of this software display the following acknowledgement:  * ``This product includes software developed by the University of California,  * Lawrence Berkeley Laboratory and its contributors.'' Neither the name of  * the University nor the names of its contributors may be used to endorse  * or promote products derived from this software without specific prior  * written permission.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED  * WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  */
end_comment

begin_define
define|#
directive|define
name|NETDISSECT_REWORKED
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<tcpdump-stdinc.h>
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"ether.h"
end_include

begin_include
include|#
directive|include
file|"ethertype.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_comment
comment|/* must come after interface.h */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
name|tstr
index|[]
init|=
literal|"[|TIPC]"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Transparent Inter-Process Communication (TIPC) protocol.  *  *	http://tipc.sourceforge.net/doc/draft-spec-tipc-07.html  *	http://tipc.sourceforge.net/doc/tipc_message_formats.html  */
end_comment

begin_define
define|#
directive|define
name|TIPC_USER_LOW_IMPORTANCE
value|0
end_define

begin_define
define|#
directive|define
name|TIPC_USER_MEDIUM_IMPORTANCE
value|1
end_define

begin_define
define|#
directive|define
name|TIPC_USER_HIGH_IMPORTANCE
value|2
end_define

begin_define
define|#
directive|define
name|TIPC_USER_CRITICAL_IMPORTANCE
value|3
end_define

begin_define
define|#
directive|define
name|TIPC_USER_BCAST_PROTOCOL
value|5
end_define

begin_define
define|#
directive|define
name|TIPC_USER_MSG_BUNDLER
value|6
end_define

begin_define
define|#
directive|define
name|TIPC_USER_LINK_PROTOCOL
value|7
end_define

begin_define
define|#
directive|define
name|TIPC_USER_CONN_MANAGER
value|8
end_define

begin_define
define|#
directive|define
name|TIPC_USER_CHANGEOVER_PROTOCOL
value|10
end_define

begin_define
define|#
directive|define
name|TIPC_USER_NAME_DISTRIBUTOR
value|11
end_define

begin_define
define|#
directive|define
name|TIPC_USER_MSG_FRAGMENTER
value|12
end_define

begin_define
define|#
directive|define
name|TIPC_USER_LINK_CONFIG
value|13
end_define

begin_define
define|#
directive|define
name|TIPC_CONN_MSG
value|0
end_define

begin_define
define|#
directive|define
name|TIPC_DIRECT_MSG
value|1
end_define

begin_define
define|#
directive|define
name|TIPC_NAMED_MSG
value|2
end_define

begin_define
define|#
directive|define
name|TIPC_MCAST_MSG
value|3
end_define

begin_define
define|#
directive|define
name|TIPC_ZONE
parameter_list|(
name|addr
parameter_list|)
value|(((addr)>> 24)& 0xFF)
end_define

begin_define
define|#
directive|define
name|TIPC_CLUSTER
parameter_list|(
name|addr
parameter_list|)
value|(((addr)>> 12)& 0xFFF)
end_define

begin_define
define|#
directive|define
name|TIPC_NODE
parameter_list|(
name|addr
parameter_list|)
value|(((addr)>> 0)& 0xFFF)
end_define

begin_struct
struct|struct
name|tipc_pkthdr
block|{
name|uint32_t
name|w0
decl_stmt|;
name|uint32_t
name|w1
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|TIPC_VER
parameter_list|(
name|w0
parameter_list|)
value|(((w0)>> 29)& 0x07)
end_define

begin_define
define|#
directive|define
name|TIPC_USER
parameter_list|(
name|w0
parameter_list|)
value|(((w0)>> 25)& 0x0F)
end_define

begin_define
define|#
directive|define
name|TIPC_HSIZE
parameter_list|(
name|w0
parameter_list|)
value|(((w0)>> 21)& 0x0F)
end_define

begin_define
define|#
directive|define
name|TIPC_MSIZE
parameter_list|(
name|w0
parameter_list|)
value|(((w0)>> 0)& 0xFFFF)
end_define

begin_define
define|#
directive|define
name|TIPC_MTYPE
parameter_list|(
name|w1
parameter_list|)
value|(((w1)>> 29)& 0x07)
end_define

begin_define
define|#
directive|define
name|TIPC_BROADCAST_ACK
parameter_list|(
name|w1
parameter_list|)
value|(((w1)>> 0)& 0xFFFF)
end_define

begin_define
define|#
directive|define
name|TIPC_LINK_ACK
parameter_list|(
name|w2
parameter_list|)
value|(((w2)>> 16)& 0xFFFF)
end_define

begin_define
define|#
directive|define
name|TIPC_LINK_SEQ
parameter_list|(
name|w2
parameter_list|)
value|(((w2)>> 0)& 0xFFFF)
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|tipcuser_values
index|[]
init|=
block|{
block|{
name|TIPC_USER_LOW_IMPORTANCE
block|,
literal|"Low Importance Data payload"
block|}
block|,
block|{
name|TIPC_USER_MEDIUM_IMPORTANCE
block|,
literal|"Medium Importance Data payload"
block|}
block|,
block|{
name|TIPC_USER_HIGH_IMPORTANCE
block|,
literal|"High Importance Data payload"
block|}
block|,
block|{
name|TIPC_USER_CRITICAL_IMPORTANCE
block|,
literal|"Critical Importance Data payload"
block|}
block|,
block|{
name|TIPC_USER_BCAST_PROTOCOL
block|,
literal|"Broadcast Link Protocol internal"
block|}
block|,
block|{
name|TIPC_USER_MSG_BUNDLER
block|,
literal|"Message Bundler Protocol internal"
block|}
block|,
block|{
name|TIPC_USER_LINK_PROTOCOL
block|,
literal|"Link State Protocol internal"
block|}
block|,
block|{
name|TIPC_USER_CONN_MANAGER
block|,
literal|"Connection Manager internal"
block|}
block|,
block|{
name|TIPC_USER_CHANGEOVER_PROTOCOL
block|,
literal|"Link Changeover Protocol internal"
block|}
block|,
block|{
name|TIPC_USER_NAME_DISTRIBUTOR
block|,
literal|"Name Table Update Protocol internal"
block|}
block|,
block|{
name|TIPC_USER_MSG_FRAGMENTER
block|,
literal|"Message Fragmentation Protocol internal"
block|}
block|,
block|{
name|TIPC_USER_LINK_CONFIG
block|,
literal|"Neighbor Detection Protocol internal"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|tipcmtype_values
index|[]
init|=
block|{
block|{
name|TIPC_CONN_MSG
block|,
literal|"CONN_MSG"
block|}
block|,
block|{
name|TIPC_DIRECT_MSG
block|,
literal|"MCAST_MSG"
block|}
block|,
block|{
name|TIPC_NAMED_MSG
block|,
literal|"NAMED_MSG"
block|}
block|,
block|{
name|TIPC_MCAST_MSG
block|,
literal|"DIRECT_MSG"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|tipc_linkconf_mtype_values
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"Link request"
block|}
block|,
block|{
literal|1
block|,
literal|"Link response"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|payload_tipc_pkthdr
block|{
name|uint32_t
name|w0
decl_stmt|;
name|uint32_t
name|w1
decl_stmt|;
name|uint32_t
name|w2
decl_stmt|;
name|uint32_t
name|prev_node
decl_stmt|;
name|uint32_t
name|orig_port
decl_stmt|;
name|uint32_t
name|dest_port
decl_stmt|;
name|uint32_t
name|orig_node
decl_stmt|;
name|uint32_t
name|dest_node
decl_stmt|;
name|uint32_t
name|name_type
decl_stmt|;
name|uint32_t
name|w9
decl_stmt|;
name|uint32_t
name|wA
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|internal_tipc_pkthdr
block|{
name|uint32_t
name|w0
decl_stmt|;
name|uint32_t
name|w1
decl_stmt|;
name|uint32_t
name|w2
decl_stmt|;
name|uint32_t
name|prev_node
decl_stmt|;
name|uint32_t
name|w4
decl_stmt|;
name|uint32_t
name|w5
decl_stmt|;
name|uint32_t
name|orig_node
decl_stmt|;
name|uint32_t
name|dest_node
decl_stmt|;
name|uint32_t
name|trans_seq
decl_stmt|;
name|uint32_t
name|w9
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|TIPC_SEQ_GAP
parameter_list|(
name|w1
parameter_list|)
value|(((w1)>> 16)& 0x1FFF)
end_define

begin_define
define|#
directive|define
name|TIPC_BC_GAP_AFTER
parameter_list|(
name|w2
parameter_list|)
value|(((w2)>> 16)& 0xFFFF)
end_define

begin_define
define|#
directive|define
name|TIPC_BC_GAP_TO
parameter_list|(
name|w2
parameter_list|)
value|(((w2)>> 0)& 0xFFFF)
end_define

begin_define
define|#
directive|define
name|TIPC_LAST_SENT_FRAG
parameter_list|(
name|w4
parameter_list|)
value|(((w4)>> 16)& 0xFFFF)
end_define

begin_define
define|#
directive|define
name|TIPC_NEXT_SENT_FRAG
parameter_list|(
name|w4
parameter_list|)
value|(((w4)>> 0)& 0xFFFF)
end_define

begin_define
define|#
directive|define
name|TIPC_SESS_NO
parameter_list|(
name|w5
parameter_list|)
value|(((w5)>> 16)& 0xFFFF)
end_define

begin_define
define|#
directive|define
name|TIPC_MSG_CNT
parameter_list|(
name|w9
parameter_list|)
value|(((w9)>> 16)& 0xFFFF)
end_define

begin_define
define|#
directive|define
name|TIPC_LINK_TOL
parameter_list|(
name|w9
parameter_list|)
value|(((w9)>> 0)& 0xFFFF)
end_define

begin_struct
struct|struct
name|link_conf_tipc_pkthdr
block|{
name|uint32_t
name|w0
decl_stmt|;
name|uint32_t
name|w1
decl_stmt|;
name|uint32_t
name|dest_domain
decl_stmt|;
name|uint32_t
name|prev_node
decl_stmt|;
name|uint32_t
name|ntwrk_id
decl_stmt|;
name|uint32_t
name|w5
decl_stmt|;
name|uint8_t
name|media_address
index|[
literal|16
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|TIPC_NODE_SIG
parameter_list|(
name|w1
parameter_list|)
value|(((w1)>> 0)& 0xFFFF)
end_define

begin_define
define|#
directive|define
name|TIPC_MEDIA_ID
parameter_list|(
name|w5
parameter_list|)
value|(((w5)>> 0)& 0xFF)
end_define

begin_function
specifier|static
name|void
name|print_payload
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|struct
name|payload_tipc_pkthdr
modifier|*
name|ap
parameter_list|)
block|{
name|uint32_t
name|w0
decl_stmt|,
name|w1
decl_stmt|,
name|w2
decl_stmt|;
name|u_int
name|user
decl_stmt|;
name|u_int
name|hsize
decl_stmt|;
name|u_int
name|msize
decl_stmt|;
name|u_int
name|mtype
decl_stmt|;
name|u_int
name|broadcast_ack
decl_stmt|;
name|u_int
name|link_ack
decl_stmt|;
name|u_int
name|link_seq
decl_stmt|;
name|u_int
name|prev_node
decl_stmt|;
name|u_int
name|orig_port
decl_stmt|;
name|u_int
name|dest_port
decl_stmt|;
name|u_int
name|orig_node
decl_stmt|;
name|u_int
name|dest_node
decl_stmt|;
name|ND_TCHECK
argument_list|(
name|ap
operator|->
name|dest_port
argument_list|)
expr_stmt|;
name|w0
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w0
argument_list|)
expr_stmt|;
name|user
operator|=
name|TIPC_USER
argument_list|(
name|w0
argument_list|)
expr_stmt|;
name|hsize
operator|=
name|TIPC_HSIZE
argument_list|(
name|w0
argument_list|)
expr_stmt|;
name|msize
operator|=
name|TIPC_MSIZE
argument_list|(
name|w0
argument_list|)
expr_stmt|;
name|w1
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w1
argument_list|)
expr_stmt|;
name|mtype
operator|=
name|TIPC_MTYPE
argument_list|(
name|w1
argument_list|)
expr_stmt|;
name|prev_node
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|prev_node
argument_list|)
expr_stmt|;
name|orig_port
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|orig_port
argument_list|)
expr_stmt|;
name|dest_port
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|dest_port
argument_list|)
expr_stmt|;
if|if
condition|(
name|hsize
operator|<=
literal|6
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"TIPC v%u.0 %u.%u.%u:%u> %u, headerlength %u bytes, MessageSize %u bytes, %s, messageType %s"
operator|,
name|TIPC_VER
argument_list|(
name|w0
argument_list|)
operator|,
name|TIPC_ZONE
argument_list|(
name|prev_node
argument_list|)
operator|,
name|TIPC_CLUSTER
argument_list|(
name|prev_node
argument_list|)
operator|,
name|TIPC_NODE
argument_list|(
name|prev_node
argument_list|)
operator|,
name|orig_port
operator|,
name|dest_port
operator|,
name|hsize
operator|*
literal|4
operator|,
name|msize
operator|,
name|tok2str
argument_list|(
name|tipcuser_values
argument_list|,
literal|"unknown"
argument_list|,
name|user
argument_list|)
operator|,
name|tok2str
argument_list|(
name|tipcmtype_values
argument_list|,
literal|"Unknown"
argument_list|,
name|mtype
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ND_TCHECK
argument_list|(
name|ap
operator|->
name|dest_node
argument_list|)
expr_stmt|;
name|orig_node
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|orig_node
argument_list|)
expr_stmt|;
name|dest_node
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|dest_node
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"TIPC v%u.0 %u.%u.%u:%u> %u.%u.%u:%u, headerlength %u bytes, MessageSize %u bytes, %s, messageType %s"
operator|,
name|TIPC_VER
argument_list|(
name|w0
argument_list|)
operator|,
name|TIPC_ZONE
argument_list|(
name|orig_node
argument_list|)
operator|,
name|TIPC_CLUSTER
argument_list|(
name|orig_node
argument_list|)
operator|,
name|TIPC_NODE
argument_list|(
name|orig_node
argument_list|)
operator|,
name|orig_port
operator|,
name|TIPC_ZONE
argument_list|(
name|dest_node
argument_list|)
operator|,
name|TIPC_CLUSTER
argument_list|(
name|dest_node
argument_list|)
operator|,
name|TIPC_NODE
argument_list|(
name|dest_node
argument_list|)
operator|,
name|dest_port
operator|,
name|hsize
operator|*
literal|4
operator|,
name|msize
operator|,
name|tok2str
argument_list|(
name|tipcuser_values
argument_list|,
literal|"unknown"
argument_list|,
name|user
argument_list|)
operator|,
name|tok2str
argument_list|(
name|tipcmtype_values
argument_list|,
literal|"Unknown"
argument_list|,
name|mtype
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|broadcast_ack
operator|=
name|TIPC_BROADCAST_ACK
argument_list|(
name|w1
argument_list|)
expr_stmt|;
name|w2
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w2
argument_list|)
expr_stmt|;
name|link_ack
operator|=
name|TIPC_LINK_ACK
argument_list|(
name|w2
argument_list|)
expr_stmt|;
name|link_seq
operator|=
name|TIPC_LINK_SEQ
argument_list|(
name|w2
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\tPrevious Node %u.%u.%u, Broadcast Ack %u, Link Ack %u, Link Sequence %u"
operator|,
name|TIPC_ZONE
argument_list|(
name|prev_node
argument_list|)
operator|,
name|TIPC_CLUSTER
argument_list|(
name|prev_node
argument_list|)
operator|,
name|TIPC_NODE
argument_list|(
name|prev_node
argument_list|)
operator|,
name|broadcast_ack
operator|,
name|link_ack
operator|,
name|link_seq
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_internal
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|struct
name|internal_tipc_pkthdr
modifier|*
name|ap
parameter_list|)
block|{
name|uint32_t
name|w0
decl_stmt|,
name|w1
decl_stmt|,
name|w2
decl_stmt|,
name|w4
decl_stmt|,
name|w5
decl_stmt|,
name|w9
decl_stmt|;
name|u_int
name|user
decl_stmt|;
name|u_int
name|hsize
decl_stmt|;
name|u_int
name|msize
decl_stmt|;
name|u_int
name|mtype
decl_stmt|;
name|u_int
name|seq_gap
decl_stmt|;
name|u_int
name|broadcast_ack
decl_stmt|;
name|u_int
name|bc_gap_after
decl_stmt|;
name|u_int
name|bc_gap_to
decl_stmt|;
name|u_int
name|prev_node
decl_stmt|;
name|u_int
name|last_sent_frag
decl_stmt|;
name|u_int
name|next_sent_frag
decl_stmt|;
name|u_int
name|sess_no
decl_stmt|;
name|u_int
name|orig_node
decl_stmt|;
name|u_int
name|dest_node
decl_stmt|;
name|u_int
name|trans_seq
decl_stmt|;
name|u_int
name|msg_cnt
decl_stmt|;
name|u_int
name|link_tol
decl_stmt|;
name|ND_TCHECK
argument_list|(
name|ap
operator|->
name|dest_node
argument_list|)
expr_stmt|;
name|w0
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w0
argument_list|)
expr_stmt|;
name|user
operator|=
name|TIPC_USER
argument_list|(
name|w0
argument_list|)
expr_stmt|;
name|hsize
operator|=
name|TIPC_HSIZE
argument_list|(
name|w0
argument_list|)
expr_stmt|;
name|msize
operator|=
name|TIPC_MSIZE
argument_list|(
name|w0
argument_list|)
expr_stmt|;
name|w1
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w1
argument_list|)
expr_stmt|;
name|mtype
operator|=
name|TIPC_MTYPE
argument_list|(
name|w1
argument_list|)
expr_stmt|;
name|orig_node
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|orig_node
argument_list|)
expr_stmt|;
name|dest_node
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|dest_node
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"TIPC v%u.0 %u.%u.%u> %u.%u.%u, headerlength %u bytes, MessageSize %u bytes, %s, messageType %s (0x%08x)"
operator|,
name|TIPC_VER
argument_list|(
name|w0
argument_list|)
operator|,
name|TIPC_ZONE
argument_list|(
name|orig_node
argument_list|)
operator|,
name|TIPC_CLUSTER
argument_list|(
name|orig_node
argument_list|)
operator|,
name|TIPC_NODE
argument_list|(
name|orig_node
argument_list|)
operator|,
name|TIPC_ZONE
argument_list|(
name|dest_node
argument_list|)
operator|,
name|TIPC_CLUSTER
argument_list|(
name|dest_node
argument_list|)
operator|,
name|TIPC_NODE
argument_list|(
name|dest_node
argument_list|)
operator|,
name|hsize
operator|*
literal|4
operator|,
name|msize
operator|,
name|tok2str
argument_list|(
name|tipcuser_values
argument_list|,
literal|"unknown"
argument_list|,
name|user
argument_list|)
operator|,
name|tok2str
argument_list|(
name|tipcmtype_values
argument_list|,
literal|"Unknown"
argument_list|,
name|mtype
argument_list|)
operator|,
name|w1
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|ND_TCHECK
argument_list|(
operator|*
name|ap
argument_list|)
expr_stmt|;
name|seq_gap
operator|=
name|TIPC_SEQ_GAP
argument_list|(
name|w1
argument_list|)
expr_stmt|;
name|broadcast_ack
operator|=
name|TIPC_BROADCAST_ACK
argument_list|(
name|w1
argument_list|)
expr_stmt|;
name|w2
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w2
argument_list|)
expr_stmt|;
name|bc_gap_after
operator|=
name|TIPC_BC_GAP_AFTER
argument_list|(
name|w2
argument_list|)
expr_stmt|;
name|bc_gap_to
operator|=
name|TIPC_BC_GAP_TO
argument_list|(
name|w2
argument_list|)
expr_stmt|;
name|prev_node
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|prev_node
argument_list|)
expr_stmt|;
name|w4
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w4
argument_list|)
expr_stmt|;
name|last_sent_frag
operator|=
name|TIPC_LAST_SENT_FRAG
argument_list|(
name|w4
argument_list|)
expr_stmt|;
name|next_sent_frag
operator|=
name|TIPC_NEXT_SENT_FRAG
argument_list|(
name|w4
argument_list|)
expr_stmt|;
name|w5
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w5
argument_list|)
expr_stmt|;
name|sess_no
operator|=
name|TIPC_SESS_NO
argument_list|(
name|w5
argument_list|)
expr_stmt|;
name|trans_seq
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|trans_seq
argument_list|)
expr_stmt|;
name|w9
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w9
argument_list|)
expr_stmt|;
name|msg_cnt
operator|=
name|TIPC_MSG_CNT
argument_list|(
name|w9
argument_list|)
expr_stmt|;
name|link_tol
operator|=
name|TIPC_LINK_TOL
argument_list|(
name|w9
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\tPrevious Node %u.%u.%u, Session No. %u, Broadcast Ack %u, Sequence Gap %u,  Broadcast Gap After %u, Broadcast Gap To %u, Last Sent Packet No. %u, Next sent Packet No. %u, Transport Sequence %u, msg_count %u, Link Tolerance %u"
operator|,
name|TIPC_ZONE
argument_list|(
name|prev_node
argument_list|)
operator|,
name|TIPC_CLUSTER
argument_list|(
name|prev_node
argument_list|)
operator|,
name|TIPC_NODE
argument_list|(
name|prev_node
argument_list|)
operator|,
name|sess_no
operator|,
name|broadcast_ack
operator|,
name|seq_gap
operator|,
name|bc_gap_after
operator|,
name|bc_gap_to
operator|,
name|last_sent_frag
operator|,
name|next_sent_frag
operator|,
name|trans_seq
operator|,
name|msg_cnt
operator|,
name|link_tol
operator|)
argument_list|)
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_link_conf
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|struct
name|link_conf_tipc_pkthdr
modifier|*
name|ap
parameter_list|)
block|{
name|uint32_t
name|w0
decl_stmt|,
name|w1
decl_stmt|,
name|w5
decl_stmt|;
name|u_int
name|user
decl_stmt|;
name|u_int
name|hsize
decl_stmt|;
name|u_int
name|msize
decl_stmt|;
name|u_int
name|mtype
decl_stmt|;
name|u_int
name|node_sig
decl_stmt|;
name|u_int
name|prev_node
decl_stmt|;
name|u_int
name|dest_domain
decl_stmt|;
name|u_int
name|ntwrk_id
decl_stmt|;
name|u_int
name|media_id
decl_stmt|;
name|ND_TCHECK
argument_list|(
name|ap
operator|->
name|prev_node
argument_list|)
expr_stmt|;
name|w0
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w0
argument_list|)
expr_stmt|;
name|user
operator|=
name|TIPC_USER
argument_list|(
name|w0
argument_list|)
expr_stmt|;
name|hsize
operator|=
name|TIPC_HSIZE
argument_list|(
name|w0
argument_list|)
expr_stmt|;
name|msize
operator|=
name|TIPC_MSIZE
argument_list|(
name|w0
argument_list|)
expr_stmt|;
name|w1
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w1
argument_list|)
expr_stmt|;
name|mtype
operator|=
name|TIPC_MTYPE
argument_list|(
name|w1
argument_list|)
expr_stmt|;
name|dest_domain
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|dest_domain
argument_list|)
expr_stmt|;
name|prev_node
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|prev_node
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"TIPC v%u.0 %u.%u.%u> %u.%u.%u, headerlength %u bytes, MessageSize %u bytes, %s, messageType %s"
operator|,
name|TIPC_VER
argument_list|(
name|w0
argument_list|)
operator|,
name|TIPC_ZONE
argument_list|(
name|prev_node
argument_list|)
operator|,
name|TIPC_CLUSTER
argument_list|(
name|prev_node
argument_list|)
operator|,
name|TIPC_NODE
argument_list|(
name|prev_node
argument_list|)
operator|,
name|TIPC_ZONE
argument_list|(
name|dest_domain
argument_list|)
operator|,
name|TIPC_CLUSTER
argument_list|(
name|dest_domain
argument_list|)
operator|,
name|TIPC_NODE
argument_list|(
name|dest_domain
argument_list|)
operator|,
name|hsize
operator|*
literal|4
operator|,
name|msize
operator|,
name|tok2str
argument_list|(
name|tipcuser_values
argument_list|,
literal|"unknown"
argument_list|,
name|user
argument_list|)
operator|,
name|tok2str
argument_list|(
name|tipc_linkconf_mtype_values
argument_list|,
literal|"Unknown"
argument_list|,
name|mtype
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|ND_TCHECK
argument_list|(
name|ap
operator|->
name|w5
argument_list|)
expr_stmt|;
name|node_sig
operator|=
name|TIPC_NODE_SIG
argument_list|(
name|w1
argument_list|)
expr_stmt|;
name|ntwrk_id
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|ntwrk_id
argument_list|)
expr_stmt|;
name|w5
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w5
argument_list|)
expr_stmt|;
name|media_id
operator|=
name|TIPC_MEDIA_ID
argument_list|(
name|w5
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\tNodeSignature %u, network_id %u, media_id %u"
operator|,
name|node_sig
operator|,
name|ntwrk_id
operator|,
name|media_id
operator|)
argument_list|)
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|tipc_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
name|u_int
name|length
name|_U_
parameter_list|,
name|u_int
name|caplen
name|_U_
parameter_list|)
block|{
specifier|const
name|struct
name|tipc_pkthdr
modifier|*
name|ap
decl_stmt|;
name|uint32_t
name|w0
decl_stmt|;
name|u_int
name|user
decl_stmt|;
name|ap
operator|=
operator|(
expr|struct
name|tipc_pkthdr
operator|*
operator|)
name|bp
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|ap
operator|->
name|w0
argument_list|)
expr_stmt|;
name|w0
operator|=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|ap
operator|->
name|w0
argument_list|)
expr_stmt|;
name|user
operator|=
name|TIPC_USER
argument_list|(
name|w0
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|user
condition|)
block|{
case|case
name|TIPC_USER_LOW_IMPORTANCE
case|:
case|case
name|TIPC_USER_MEDIUM_IMPORTANCE
case|:
case|case
name|TIPC_USER_HIGH_IMPORTANCE
case|:
case|case
name|TIPC_USER_CRITICAL_IMPORTANCE
case|:
case|case
name|TIPC_USER_NAME_DISTRIBUTOR
case|:
case|case
name|TIPC_USER_CONN_MANAGER
case|:
name|print_payload
argument_list|(
name|ndo
argument_list|,
operator|(
expr|struct
name|payload_tipc_pkthdr
operator|*
operator|)
name|bp
argument_list|)
expr_stmt|;
break|break;
case|case
name|TIPC_USER_LINK_CONFIG
case|:
name|print_link_conf
argument_list|(
name|ndo
argument_list|,
operator|(
expr|struct
name|link_conf_tipc_pkthdr
operator|*
operator|)
name|bp
argument_list|)
expr_stmt|;
break|break;
case|case
name|TIPC_USER_BCAST_PROTOCOL
case|:
case|case
name|TIPC_USER_MSG_BUNDLER
case|:
case|case
name|TIPC_USER_LINK_PROTOCOL
case|:
case|case
name|TIPC_USER_CHANGEOVER_PROTOCOL
case|:
case|case
name|TIPC_USER_MSG_FRAGMENTER
case|:
name|print_internal
argument_list|(
name|ndo
argument_list|,
operator|(
expr|struct
name|internal_tipc_pkthdr
operator|*
operator|)
name|bp
argument_list|)
expr_stmt|;
break|break;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Local Variables:  * c-style: bsd  * End:  */
end_comment

end_unit

