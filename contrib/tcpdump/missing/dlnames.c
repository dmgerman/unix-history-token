begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1993, 1994, 1995, 1996, 1997, 1998  *	The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *	This product includes software developed by the Computer Systems  *	Engineering Group at Lawrence Berkeley Laboratory.  * 4. Neither the name of the University nor of the Laboratory may be used  *    to endorse or promote products derived from this software without  *    specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<netdissect-stdinc.h>
end_include

begin_include
include|#
directive|include
file|<pcap.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"pcap-missing.h"
end_include

begin_include
include|#
directive|include
file|"ascii_strcasecmp.h"
end_include

begin_struct
struct|struct
name|dlt_choice
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
specifier|const
name|char
modifier|*
name|description
decl_stmt|;
name|int
name|dlt
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|DLT_CHOICE
parameter_list|(
name|code
parameter_list|,
name|description
parameter_list|)
value|{ #code, description, code }
end_define

begin_define
define|#
directive|define
name|DLT_CHOICE_SENTINEL
value|{ NULL, NULL, 0 }
end_define

begin_decl_stmt
specifier|static
name|struct
name|dlt_choice
name|dlt_choices
index|[]
init|=
block|{
name|DLT_CHOICE
argument_list|(
name|DLT_NULL
argument_list|,
literal|"BSD loopback"
argument_list|)
block|,
name|DLT_CHOICE
argument_list|(
name|DLT_EN10MB
argument_list|,
literal|"Ethernet"
argument_list|)
block|,
name|DLT_CHOICE
argument_list|(
name|DLT_IEEE802
argument_list|,
literal|"Token ring"
argument_list|)
block|,
name|DLT_CHOICE
argument_list|(
name|DLT_ARCNET
argument_list|,
literal|"ARCNET"
argument_list|)
block|,
name|DLT_CHOICE
argument_list|(
name|DLT_SLIP
argument_list|,
literal|"SLIP"
argument_list|)
block|,
name|DLT_CHOICE
argument_list|(
name|DLT_PPP
argument_list|,
literal|"PPP"
argument_list|)
block|,
name|DLT_CHOICE
argument_list|(
name|DLT_FDDI
argument_list|,
literal|"FDDI"
argument_list|)
block|,
name|DLT_CHOICE
argument_list|(
name|DLT_ATM_RFC1483
argument_list|,
literal|"RFC 1483 IP-over-ATM"
argument_list|)
block|,
name|DLT_CHOICE
argument_list|(
name|DLT_RAW
argument_list|,
literal|"Raw IP"
argument_list|)
block|,
ifdef|#
directive|ifdef
name|DLT_SLIP_BSDOS
name|DLT_CHOICE
argument_list|(
name|DLT_SLIP_BSDOS
argument_list|,
literal|"BSD/OS SLIP"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_PPP_BSDOS
name|DLT_CHOICE
argument_list|(
name|DLT_PPP_BSDOS
argument_list|,
literal|"BSD/OS PPP"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_ATM_CLIP
name|DLT_CHOICE
argument_list|(
name|DLT_ATM_CLIP
argument_list|,
literal|"Linux Classical IP-over-ATM"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_PPP_SERIAL
name|DLT_CHOICE
argument_list|(
name|DLT_PPP_SERIAL
argument_list|,
literal|"PPP over serial"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_PPP_ETHER
name|DLT_CHOICE
argument_list|(
name|DLT_PPP_ETHER
argument_list|,
literal|"PPPoE"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_C_HDLC
name|DLT_CHOICE
argument_list|(
name|DLT_C_HDLC
argument_list|,
literal|"Cisco HDLC"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_IEEE802_11
name|DLT_CHOICE
argument_list|(
name|DLT_IEEE802_11
argument_list|,
literal|"802.11"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_FRELAY
name|DLT_CHOICE
argument_list|(
name|DLT_FRELAY
argument_list|,
literal|"Frame Relay"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_LOOP
name|DLT_CHOICE
argument_list|(
name|DLT_LOOP
argument_list|,
literal|"OpenBSD loopback"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_ENC
name|DLT_CHOICE
argument_list|(
name|DLT_ENC
argument_list|,
literal|"OpenBSD encapsulated IP"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_LINUX_SLL
name|DLT_CHOICE
argument_list|(
name|DLT_LINUX_SLL
argument_list|,
literal|"Linux cooked"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_LTALK
name|DLT_CHOICE
argument_list|(
name|DLT_LTALK
argument_list|,
literal|"Localtalk"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_PFLOG
name|DLT_CHOICE
argument_list|(
name|DLT_PFLOG
argument_list|,
literal|"OpenBSD pflog file"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_PRISM_HEADER
name|DLT_CHOICE
argument_list|(
name|DLT_PRISM_HEADER
argument_list|,
literal|"802.11 plus Prism header"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_IP_OVER_FC
name|DLT_CHOICE
argument_list|(
name|DLT_IP_OVER_FC
argument_list|,
literal|"RFC 2625 IP-over-Fibre Channel"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_SUNATM
name|DLT_CHOICE
argument_list|(
name|DLT_SUNATM
argument_list|,
literal|"Sun raw ATM"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_IEEE802_11_RADIO
name|DLT_CHOICE
argument_list|(
name|DLT_IEEE802_11_RADIO
argument_list|,
literal|"802.11 plus radio information header"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_ARCNET_LINUX
name|DLT_CHOICE
argument_list|(
name|DLT_ARCNET_LINUX
argument_list|,
literal|"Linux ARCNET"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_LINUX_IRDA
name|DLT_CHOICE
argument_list|(
name|DLT_LINUX_IRDA
argument_list|,
literal|"Linux IrDA"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_LANE8023
name|DLT_CHOICE
argument_list|(
name|DLT_LANE8023
argument_list|,
literal|"Linux 802.3 LANE"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_CIP
name|DLT_CHOICE
argument_list|(
name|DLT_CIP
argument_list|,
literal|"Linux Classical IP-over-ATM"
argument_list|)
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DLT_HDLC
name|DLT_CHOICE
argument_list|(
name|DLT_HDLC
argument_list|,
literal|"Cisco HDLC"
argument_list|)
block|,
endif|#
directive|endif
name|DLT_CHOICE_SENTINEL
block|}
decl_stmt|;
end_decl_stmt

begin_ifndef
ifndef|#
directive|ifndef
name|HAVE_PCAP_DATALINK_NAME_TO_VAL
end_ifndef

begin_function
name|int
name|pcap_datalink_name_to_val
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|dlt_choices
index|[
name|i
index|]
operator|.
name|name
operator|!=
name|NULL
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ascii_strcasecmp
argument_list|(
name|dlt_choices
index|[
name|i
index|]
operator|.
name|name
operator|+
sizeof|sizeof
argument_list|(
literal|"DLT_"
argument_list|)
operator|-
literal|1
argument_list|,
name|name
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
name|dlt_choices
index|[
name|i
index|]
operator|.
name|dlt
operator|)
return|;
block|}
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|pcap_datalink_val_to_name
parameter_list|(
name|int
name|dlt
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|dlt_choices
index|[
name|i
index|]
operator|.
name|name
operator|!=
name|NULL
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|dlt_choices
index|[
name|i
index|]
operator|.
name|dlt
operator|==
name|dlt
condition|)
return|return
operator|(
name|dlt_choices
index|[
name|i
index|]
operator|.
name|name
operator|+
sizeof|sizeof
argument_list|(
literal|"DLT_"
argument_list|)
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|const
name|char
modifier|*
name|pcap_datalink_val_to_description
parameter_list|(
name|int
name|dlt
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|dlt_choices
index|[
name|i
index|]
operator|.
name|name
operator|!=
name|NULL
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|dlt_choices
index|[
name|i
index|]
operator|.
name|dlt
operator|==
name|dlt
condition|)
return|return
operator|(
name|dlt_choices
index|[
name|i
index|]
operator|.
name|description
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

end_unit

