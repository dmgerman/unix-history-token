begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1988, 1989, 1990, 1991, 1993, 1994  *	The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code distributions  * retain the above copyright notice and this paragraph in its entirety, (2)  * distributions including binary code include the above copyright notice and  * this paragraph in its entirety in the documentation or other materials  * provided with the distribution, and (3) all advertising materials mentioning  * features or use of this software display the following acknowledgement:  * ``This product includes software developed by the University of California,  * Lawrence Berkeley Laboratory and its contributors.'' Neither the name of  * the University nor the names of its contributors may be used to endorse  * or promote products derived from this software without specific prior  * written permission.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED  * WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  */
end_comment

begin_define
define|#
directive|define
name|NETDISSECT_REWORKED
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|INET6
end_ifdef

begin_include
include|#
directive|include
file|<tcpdump-stdinc.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_include
include|#
directive|include
file|"ip6.h"
end_include

begin_include
include|#
directive|include
file|"ipproto.h"
end_include

begin_include
include|#
directive|include
file|"udp.h"
end_include

begin_include
include|#
directive|include
file|"ah.h"
end_include

begin_comment
comment|/*	NetBSD: icmp6.h,v 1.13 2000/08/03 16:30:37 itojun Exp 	*/
end_comment

begin_comment
comment|/*	$KAME: icmp6.h,v 1.22 2000/08/03 15:25:16 jinmei Exp $	*/
end_comment

begin_comment
comment|/*  * Copyright (C) 1995, 1996, 1997, and 1998 WIDE Project.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. Neither the name of the project nor the names of its contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_struct
struct|struct
name|icmp6_hdr
block|{
name|uint8_t
name|icmp6_type
decl_stmt|;
comment|/* type field */
name|uint8_t
name|icmp6_code
decl_stmt|;
comment|/* code field */
name|uint16_t
name|icmp6_cksum
decl_stmt|;
comment|/* checksum field */
union|union
block|{
name|uint32_t
name|icmp6_un_data32
index|[
literal|1
index|]
decl_stmt|;
comment|/* type-specific field */
name|uint16_t
name|icmp6_un_data16
index|[
literal|2
index|]
decl_stmt|;
comment|/* type-specific field */
name|uint8_t
name|icmp6_un_data8
index|[
literal|4
index|]
decl_stmt|;
comment|/* type-specific field */
block|}
name|icmp6_dataun
union|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|icmp6_data32
value|icmp6_dataun.icmp6_un_data32
end_define

begin_define
define|#
directive|define
name|icmp6_data16
value|icmp6_dataun.icmp6_un_data16
end_define

begin_define
define|#
directive|define
name|icmp6_data8
value|icmp6_dataun.icmp6_un_data8
end_define

begin_define
define|#
directive|define
name|icmp6_pptr
value|icmp6_data32[0]
end_define

begin_comment
comment|/* parameter prob */
end_comment

begin_define
define|#
directive|define
name|icmp6_mtu
value|icmp6_data32[0]
end_define

begin_comment
comment|/* packet too big */
end_comment

begin_define
define|#
directive|define
name|icmp6_id
value|icmp6_data16[0]
end_define

begin_comment
comment|/* echo request/reply */
end_comment

begin_define
define|#
directive|define
name|icmp6_seq
value|icmp6_data16[1]
end_define

begin_comment
comment|/* echo request/reply */
end_comment

begin_define
define|#
directive|define
name|icmp6_maxdelay
value|icmp6_data16[0]
end_define

begin_comment
comment|/* mcast group membership */
end_comment

begin_define
define|#
directive|define
name|ICMP6_DST_UNREACH
value|1
end_define

begin_comment
comment|/* dest unreachable, codes: */
end_comment

begin_define
define|#
directive|define
name|ICMP6_PACKET_TOO_BIG
value|2
end_define

begin_comment
comment|/* packet too big */
end_comment

begin_define
define|#
directive|define
name|ICMP6_TIME_EXCEEDED
value|3
end_define

begin_comment
comment|/* time exceeded, code: */
end_comment

begin_define
define|#
directive|define
name|ICMP6_PARAM_PROB
value|4
end_define

begin_comment
comment|/* ip6 header bad */
end_comment

begin_define
define|#
directive|define
name|ICMP6_ECHO_REQUEST
value|128
end_define

begin_comment
comment|/* echo service */
end_comment

begin_define
define|#
directive|define
name|ICMP6_ECHO_REPLY
value|129
end_define

begin_comment
comment|/* echo reply */
end_comment

begin_define
define|#
directive|define
name|ICMP6_MEMBERSHIP_QUERY
value|130
end_define

begin_comment
comment|/* group membership query */
end_comment

begin_define
define|#
directive|define
name|MLD6_LISTENER_QUERY
value|130
end_define

begin_comment
comment|/* multicast listener query */
end_comment

begin_define
define|#
directive|define
name|ICMP6_MEMBERSHIP_REPORT
value|131
end_define

begin_comment
comment|/* group membership report */
end_comment

begin_define
define|#
directive|define
name|MLD6_LISTENER_REPORT
value|131
end_define

begin_comment
comment|/* multicast listener report */
end_comment

begin_define
define|#
directive|define
name|ICMP6_MEMBERSHIP_REDUCTION
value|132
end_define

begin_comment
comment|/* group membership termination */
end_comment

begin_define
define|#
directive|define
name|MLD6_LISTENER_DONE
value|132
end_define

begin_comment
comment|/* multicast listener done */
end_comment

begin_define
define|#
directive|define
name|ND_ROUTER_SOLICIT
value|133
end_define

begin_comment
comment|/* router solicitation */
end_comment

begin_define
define|#
directive|define
name|ND_ROUTER_ADVERT
value|134
end_define

begin_comment
comment|/* router advertisement */
end_comment

begin_define
define|#
directive|define
name|ND_NEIGHBOR_SOLICIT
value|135
end_define

begin_comment
comment|/* neighbor solicitation */
end_comment

begin_define
define|#
directive|define
name|ND_NEIGHBOR_ADVERT
value|136
end_define

begin_comment
comment|/* neighbor advertisement */
end_comment

begin_define
define|#
directive|define
name|ND_REDIRECT
value|137
end_define

begin_comment
comment|/* redirect */
end_comment

begin_define
define|#
directive|define
name|ICMP6_ROUTER_RENUMBERING
value|138
end_define

begin_comment
comment|/* router renumbering */
end_comment

begin_define
define|#
directive|define
name|ICMP6_WRUREQUEST
value|139
end_define

begin_comment
comment|/* who are you request */
end_comment

begin_define
define|#
directive|define
name|ICMP6_WRUREPLY
value|140
end_define

begin_comment
comment|/* who are you reply */
end_comment

begin_define
define|#
directive|define
name|ICMP6_FQDN_QUERY
value|139
end_define

begin_comment
comment|/* FQDN query */
end_comment

begin_define
define|#
directive|define
name|ICMP6_FQDN_REPLY
value|140
end_define

begin_comment
comment|/* FQDN reply */
end_comment

begin_define
define|#
directive|define
name|ICMP6_NI_QUERY
value|139
end_define

begin_comment
comment|/* node information request */
end_comment

begin_define
define|#
directive|define
name|ICMP6_NI_REPLY
value|140
end_define

begin_comment
comment|/* node information reply */
end_comment

begin_define
define|#
directive|define
name|IND_SOLICIT
value|141
end_define

begin_comment
comment|/* inverse neighbor solicitation */
end_comment

begin_define
define|#
directive|define
name|IND_ADVERT
value|142
end_define

begin_comment
comment|/* inverse neighbor advertisement */
end_comment

begin_define
define|#
directive|define
name|ICMP6_V2_MEMBERSHIP_REPORT
value|143
end_define

begin_comment
comment|/* v2 membership report */
end_comment

begin_define
define|#
directive|define
name|MLDV2_LISTENER_REPORT
value|143
end_define

begin_comment
comment|/* v2 multicast listener report */
end_comment

begin_define
define|#
directive|define
name|ICMP6_HADISCOV_REQUEST
value|144
end_define

begin_define
define|#
directive|define
name|ICMP6_HADISCOV_REPLY
value|145
end_define

begin_define
define|#
directive|define
name|ICMP6_MOBILEPREFIX_SOLICIT
value|146
end_define

begin_define
define|#
directive|define
name|ICMP6_MOBILEPREFIX_ADVERT
value|147
end_define

begin_define
define|#
directive|define
name|MLD6_MTRACE_RESP
value|200
end_define

begin_comment
comment|/* mtrace response(to sender) */
end_comment

begin_define
define|#
directive|define
name|MLD6_MTRACE
value|201
end_define

begin_comment
comment|/* mtrace messages */
end_comment

begin_define
define|#
directive|define
name|ICMP6_MAXTYPE
value|201
end_define

begin_define
define|#
directive|define
name|ICMP6_DST_UNREACH_NOROUTE
value|0
end_define

begin_comment
comment|/* no route to destination */
end_comment

begin_define
define|#
directive|define
name|ICMP6_DST_UNREACH_ADMIN
value|1
end_define

begin_comment
comment|/* administratively prohibited */
end_comment

begin_define
define|#
directive|define
name|ICMP6_DST_UNREACH_NOTNEIGHBOR
value|2
end_define

begin_comment
comment|/* not a neighbor(obsolete) */
end_comment

begin_define
define|#
directive|define
name|ICMP6_DST_UNREACH_BEYONDSCOPE
value|2
end_define

begin_comment
comment|/* beyond scope of source address */
end_comment

begin_define
define|#
directive|define
name|ICMP6_DST_UNREACH_ADDR
value|3
end_define

begin_comment
comment|/* address unreachable */
end_comment

begin_define
define|#
directive|define
name|ICMP6_DST_UNREACH_NOPORT
value|4
end_define

begin_comment
comment|/* port unreachable */
end_comment

begin_define
define|#
directive|define
name|ICMP6_TIME_EXCEED_TRANSIT
value|0
end_define

begin_comment
comment|/* ttl==0 in transit */
end_comment

begin_define
define|#
directive|define
name|ICMP6_TIME_EXCEED_REASSEMBLY
value|1
end_define

begin_comment
comment|/* ttl==0 in reass */
end_comment

begin_define
define|#
directive|define
name|ICMP6_PARAMPROB_HEADER
value|0
end_define

begin_comment
comment|/* erroneous header field */
end_comment

begin_define
define|#
directive|define
name|ICMP6_PARAMPROB_NEXTHEADER
value|1
end_define

begin_comment
comment|/* unrecognized next header */
end_comment

begin_define
define|#
directive|define
name|ICMP6_PARAMPROB_OPTION
value|2
end_define

begin_comment
comment|/* unrecognized option */
end_comment

begin_define
define|#
directive|define
name|ICMP6_INFOMSG_MASK
value|0x80
end_define

begin_comment
comment|/* all informational messages */
end_comment

begin_define
define|#
directive|define
name|ICMP6_NI_SUBJ_IPV6
value|0
end_define

begin_comment
comment|/* Query Subject is an IPv6 address */
end_comment

begin_define
define|#
directive|define
name|ICMP6_NI_SUBJ_FQDN
value|1
end_define

begin_comment
comment|/* Query Subject is a Domain name */
end_comment

begin_define
define|#
directive|define
name|ICMP6_NI_SUBJ_IPV4
value|2
end_define

begin_comment
comment|/* Query Subject is an IPv4 address */
end_comment

begin_define
define|#
directive|define
name|ICMP6_NI_SUCCESS
value|0
end_define

begin_comment
comment|/* node information successful reply */
end_comment

begin_define
define|#
directive|define
name|ICMP6_NI_REFUSED
value|1
end_define

begin_comment
comment|/* node information request is refused */
end_comment

begin_define
define|#
directive|define
name|ICMP6_NI_UNKNOWN
value|2
end_define

begin_comment
comment|/* unknown Qtype */
end_comment

begin_define
define|#
directive|define
name|ICMP6_ROUTER_RENUMBERING_COMMAND
value|0
end_define

begin_comment
comment|/* rr command */
end_comment

begin_define
define|#
directive|define
name|ICMP6_ROUTER_RENUMBERING_RESULT
value|1
end_define

begin_comment
comment|/* rr result */
end_comment

begin_define
define|#
directive|define
name|ICMP6_ROUTER_RENUMBERING_SEQNUM_RESET
value|255
end_define

begin_comment
comment|/* rr seq num reset */
end_comment

begin_comment
comment|/* Used in kernel only */
end_comment

begin_define
define|#
directive|define
name|ND_REDIRECT_ONLINK
value|0
end_define

begin_comment
comment|/* redirect to an on-link node */
end_comment

begin_define
define|#
directive|define
name|ND_REDIRECT_ROUTER
value|1
end_define

begin_comment
comment|/* redirect to a better router */
end_comment

begin_comment
comment|/*  * Multicast Listener Discovery  */
end_comment

begin_struct
struct|struct
name|mld6_hdr
block|{
name|struct
name|icmp6_hdr
name|mld6_hdr
decl_stmt|;
name|struct
name|in6_addr
name|mld6_addr
decl_stmt|;
comment|/* multicast address */
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|mld6_type
value|mld6_hdr.icmp6_type
end_define

begin_define
define|#
directive|define
name|mld6_code
value|mld6_hdr.icmp6_code
end_define

begin_define
define|#
directive|define
name|mld6_cksum
value|mld6_hdr.icmp6_cksum
end_define

begin_define
define|#
directive|define
name|mld6_maxdelay
value|mld6_hdr.icmp6_data16[0]
end_define

begin_define
define|#
directive|define
name|mld6_reserved
value|mld6_hdr.icmp6_data16[1]
end_define

begin_define
define|#
directive|define
name|MLD_MINLEN
value|24
end_define

begin_define
define|#
directive|define
name|MLDV2_MINLEN
value|28
end_define

begin_comment
comment|/*  * Neighbor Discovery  */
end_comment

begin_struct
struct|struct
name|nd_router_solicit
block|{
comment|/* router solicitation */
name|struct
name|icmp6_hdr
name|nd_rs_hdr
decl_stmt|;
comment|/* could be followed by options */
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|nd_rs_type
value|nd_rs_hdr.icmp6_type
end_define

begin_define
define|#
directive|define
name|nd_rs_code
value|nd_rs_hdr.icmp6_code
end_define

begin_define
define|#
directive|define
name|nd_rs_cksum
value|nd_rs_hdr.icmp6_cksum
end_define

begin_define
define|#
directive|define
name|nd_rs_reserved
value|nd_rs_hdr.icmp6_data32[0]
end_define

begin_struct
struct|struct
name|nd_router_advert
block|{
comment|/* router advertisement */
name|struct
name|icmp6_hdr
name|nd_ra_hdr
decl_stmt|;
name|uint32_t
name|nd_ra_reachable
decl_stmt|;
comment|/* reachable time */
name|uint32_t
name|nd_ra_retransmit
decl_stmt|;
comment|/* retransmit timer */
comment|/* could be followed by options */
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|nd_ra_type
value|nd_ra_hdr.icmp6_type
end_define

begin_define
define|#
directive|define
name|nd_ra_code
value|nd_ra_hdr.icmp6_code
end_define

begin_define
define|#
directive|define
name|nd_ra_cksum
value|nd_ra_hdr.icmp6_cksum
end_define

begin_define
define|#
directive|define
name|nd_ra_curhoplimit
value|nd_ra_hdr.icmp6_data8[0]
end_define

begin_define
define|#
directive|define
name|nd_ra_flags_reserved
value|nd_ra_hdr.icmp6_data8[1]
end_define

begin_define
define|#
directive|define
name|ND_RA_FLAG_MANAGED
value|0x80
end_define

begin_define
define|#
directive|define
name|ND_RA_FLAG_OTHER
value|0x40
end_define

begin_define
define|#
directive|define
name|ND_RA_FLAG_HOME_AGENT
value|0x20
end_define

begin_comment
comment|/*  * Router preference values based on draft-draves-ipngwg-router-selection-01.  * These are non-standard definitions.  */
end_comment

begin_define
define|#
directive|define
name|ND_RA_FLAG_RTPREF_MASK
value|0x18
end_define

begin_comment
comment|/* 00011000 */
end_comment

begin_define
define|#
directive|define
name|ND_RA_FLAG_RTPREF_HIGH
value|0x08
end_define

begin_comment
comment|/* 00001000 */
end_comment

begin_define
define|#
directive|define
name|ND_RA_FLAG_RTPREF_MEDIUM
value|0x00
end_define

begin_comment
comment|/* 00000000 */
end_comment

begin_define
define|#
directive|define
name|ND_RA_FLAG_RTPREF_LOW
value|0x18
end_define

begin_comment
comment|/* 00011000 */
end_comment

begin_define
define|#
directive|define
name|ND_RA_FLAG_RTPREF_RSV
value|0x10
end_define

begin_comment
comment|/* 00010000 */
end_comment

begin_define
define|#
directive|define
name|nd_ra_router_lifetime
value|nd_ra_hdr.icmp6_data16[1]
end_define

begin_struct
struct|struct
name|nd_neighbor_solicit
block|{
comment|/* neighbor solicitation */
name|struct
name|icmp6_hdr
name|nd_ns_hdr
decl_stmt|;
name|struct
name|in6_addr
name|nd_ns_target
decl_stmt|;
comment|/*target address */
comment|/* could be followed by options */
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|nd_ns_type
value|nd_ns_hdr.icmp6_type
end_define

begin_define
define|#
directive|define
name|nd_ns_code
value|nd_ns_hdr.icmp6_code
end_define

begin_define
define|#
directive|define
name|nd_ns_cksum
value|nd_ns_hdr.icmp6_cksum
end_define

begin_define
define|#
directive|define
name|nd_ns_reserved
value|nd_ns_hdr.icmp6_data32[0]
end_define

begin_struct
struct|struct
name|nd_neighbor_advert
block|{
comment|/* neighbor advertisement */
name|struct
name|icmp6_hdr
name|nd_na_hdr
decl_stmt|;
name|struct
name|in6_addr
name|nd_na_target
decl_stmt|;
comment|/* target address */
comment|/* could be followed by options */
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|nd_na_type
value|nd_na_hdr.icmp6_type
end_define

begin_define
define|#
directive|define
name|nd_na_code
value|nd_na_hdr.icmp6_code
end_define

begin_define
define|#
directive|define
name|nd_na_cksum
value|nd_na_hdr.icmp6_cksum
end_define

begin_define
define|#
directive|define
name|nd_na_flags_reserved
value|nd_na_hdr.icmp6_data32[0]
end_define

begin_define
define|#
directive|define
name|ND_NA_FLAG_ROUTER
value|0x80000000
end_define

begin_define
define|#
directive|define
name|ND_NA_FLAG_SOLICITED
value|0x40000000
end_define

begin_define
define|#
directive|define
name|ND_NA_FLAG_OVERRIDE
value|0x20000000
end_define

begin_struct
struct|struct
name|nd_redirect
block|{
comment|/* redirect */
name|struct
name|icmp6_hdr
name|nd_rd_hdr
decl_stmt|;
name|struct
name|in6_addr
name|nd_rd_target
decl_stmt|;
comment|/* target address */
name|struct
name|in6_addr
name|nd_rd_dst
decl_stmt|;
comment|/* destination address */
comment|/* could be followed by options */
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|nd_rd_type
value|nd_rd_hdr.icmp6_type
end_define

begin_define
define|#
directive|define
name|nd_rd_code
value|nd_rd_hdr.icmp6_code
end_define

begin_define
define|#
directive|define
name|nd_rd_cksum
value|nd_rd_hdr.icmp6_cksum
end_define

begin_define
define|#
directive|define
name|nd_rd_reserved
value|nd_rd_hdr.icmp6_data32[0]
end_define

begin_struct
struct|struct
name|nd_opt_hdr
block|{
comment|/* Neighbor discovery option header */
name|uint8_t
name|nd_opt_type
decl_stmt|;
name|uint8_t
name|nd_opt_len
decl_stmt|;
comment|/* followed by option specific data*/
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|ND_OPT_SOURCE_LINKADDR
value|1
end_define

begin_define
define|#
directive|define
name|ND_OPT_TARGET_LINKADDR
value|2
end_define

begin_define
define|#
directive|define
name|ND_OPT_PREFIX_INFORMATION
value|3
end_define

begin_define
define|#
directive|define
name|ND_OPT_REDIRECTED_HEADER
value|4
end_define

begin_define
define|#
directive|define
name|ND_OPT_MTU
value|5
end_define

begin_define
define|#
directive|define
name|ND_OPT_ADVINTERVAL
value|7
end_define

begin_define
define|#
directive|define
name|ND_OPT_HOMEAGENT_INFO
value|8
end_define

begin_define
define|#
directive|define
name|ND_OPT_ROUTE_INFO
value|24
end_define

begin_comment
comment|/* RFC4191 */
end_comment

begin_define
define|#
directive|define
name|ND_OPT_RDNSS
value|25
end_define

begin_define
define|#
directive|define
name|ND_OPT_DNSSL
value|31
end_define

begin_struct
struct|struct
name|nd_opt_prefix_info
block|{
comment|/* prefix information */
name|uint8_t
name|nd_opt_pi_type
decl_stmt|;
name|uint8_t
name|nd_opt_pi_len
decl_stmt|;
name|uint8_t
name|nd_opt_pi_prefix_len
decl_stmt|;
name|uint8_t
name|nd_opt_pi_flags_reserved
decl_stmt|;
name|uint8_t
name|nd_opt_pi_valid_time
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|nd_opt_pi_preferred_time
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|nd_opt_pi_reserved2
index|[
literal|4
index|]
decl_stmt|;
name|struct
name|in6_addr
name|nd_opt_pi_prefix
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|ND_OPT_PI_FLAG_ONLINK
value|0x80
end_define

begin_define
define|#
directive|define
name|ND_OPT_PI_FLAG_AUTO
value|0x40
end_define

begin_define
define|#
directive|define
name|ND_OPT_PI_FLAG_ROUTER
value|0x20
end_define

begin_comment
comment|/*2292bis*/
end_comment

begin_struct
struct|struct
name|nd_opt_rd_hdr
block|{
comment|/* redirected header */
name|uint8_t
name|nd_opt_rh_type
decl_stmt|;
name|uint8_t
name|nd_opt_rh_len
decl_stmt|;
name|uint16_t
name|nd_opt_rh_reserved1
decl_stmt|;
name|uint32_t
name|nd_opt_rh_reserved2
decl_stmt|;
comment|/* followed by IP header and data */
block|}
struct|;
end_struct

begin_struct
struct|struct
name|nd_opt_mtu
block|{
comment|/* MTU option */
name|uint8_t
name|nd_opt_mtu_type
decl_stmt|;
name|uint8_t
name|nd_opt_mtu_len
decl_stmt|;
name|uint16_t
name|nd_opt_mtu_reserved
decl_stmt|;
name|uint32_t
name|nd_opt_mtu_mtu
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|nd_opt_rdnss
block|{
comment|/* RDNSS RFC 6106 5.1 */
name|uint8_t
name|nd_opt_rdnss_type
decl_stmt|;
name|uint8_t
name|nd_opt_rdnss_len
decl_stmt|;
name|uint16_t
name|nd_opt_rdnss_reserved
decl_stmt|;
name|uint32_t
name|nd_opt_rdnss_lifetime
decl_stmt|;
name|struct
name|in6_addr
name|nd_opt_rdnss_addr
index|[
literal|1
index|]
decl_stmt|;
comment|/* variable-length */
block|}
struct|;
end_struct

begin_struct
struct|struct
name|nd_opt_dnssl
block|{
comment|/* DNSSL RFC 6106 5.2 */
name|uint8_t
name|nd_opt_dnssl_type
decl_stmt|;
name|uint8_t
name|nd_opt_dnssl_len
decl_stmt|;
name|uint16_t
name|nd_opt_dnssl_reserved
decl_stmt|;
name|uint32_t
name|nd_opt_dnssl_lifetime
decl_stmt|;
comment|/* followed by list of DNS search domains, variable-length */
block|}
struct|;
end_struct

begin_struct
struct|struct
name|nd_opt_advinterval
block|{
comment|/* Advertisement interval option */
name|uint8_t
name|nd_opt_adv_type
decl_stmt|;
name|uint8_t
name|nd_opt_adv_len
decl_stmt|;
name|uint16_t
name|nd_opt_adv_reserved
decl_stmt|;
name|uint32_t
name|nd_opt_adv_interval
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|nd_opt_homeagent_info
block|{
comment|/* Home Agent info */
name|uint8_t
name|nd_opt_hai_type
decl_stmt|;
name|uint8_t
name|nd_opt_hai_len
decl_stmt|;
name|uint16_t
name|nd_opt_hai_reserved
decl_stmt|;
name|int16_t
name|nd_opt_hai_preference
decl_stmt|;
name|uint16_t
name|nd_opt_hai_lifetime
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|nd_opt_route_info
block|{
comment|/* route info */
name|uint8_t
name|nd_opt_rti_type
decl_stmt|;
name|uint8_t
name|nd_opt_rti_len
decl_stmt|;
name|uint8_t
name|nd_opt_rti_prefixlen
decl_stmt|;
name|uint8_t
name|nd_opt_rti_flags
decl_stmt|;
name|uint32_t
name|nd_opt_rti_lifetime
decl_stmt|;
comment|/* prefix follows */
block|}
struct|;
end_struct

begin_comment
comment|/*  * icmp6 namelookup  */
end_comment

begin_struct
struct|struct
name|icmp6_namelookup
block|{
name|struct
name|icmp6_hdr
name|icmp6_nl_hdr
decl_stmt|;
name|uint8_t
name|icmp6_nl_nonce
index|[
literal|8
index|]
decl_stmt|;
name|int32_t
name|icmp6_nl_ttl
decl_stmt|;
if|#
directive|if
literal|0
block|uint8_t		icmp6_nl_len; 	uint8_t		icmp6_nl_name[3];
endif|#
directive|endif
comment|/* could be followed by options */
block|}
struct|;
end_struct

begin_comment
comment|/*  * icmp6 node information  */
end_comment

begin_struct
struct|struct
name|icmp6_nodeinfo
block|{
name|struct
name|icmp6_hdr
name|icmp6_ni_hdr
decl_stmt|;
name|uint8_t
name|icmp6_ni_nonce
index|[
literal|8
index|]
decl_stmt|;
comment|/* could be followed by reply data */
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|ni_type
value|icmp6_ni_hdr.icmp6_type
end_define

begin_define
define|#
directive|define
name|ni_code
value|icmp6_ni_hdr.icmp6_code
end_define

begin_define
define|#
directive|define
name|ni_cksum
value|icmp6_ni_hdr.icmp6_cksum
end_define

begin_define
define|#
directive|define
name|ni_qtype
value|icmp6_ni_hdr.icmp6_data16[0]
end_define

begin_define
define|#
directive|define
name|ni_flags
value|icmp6_ni_hdr.icmp6_data16[1]
end_define

begin_define
define|#
directive|define
name|NI_QTYPE_NOOP
value|0
end_define

begin_comment
comment|/* NOOP  */
end_comment

begin_define
define|#
directive|define
name|NI_QTYPE_SUPTYPES
value|1
end_define

begin_comment
comment|/* Supported Qtypes */
end_comment

begin_define
define|#
directive|define
name|NI_QTYPE_FQDN
value|2
end_define

begin_comment
comment|/* FQDN (draft 04) */
end_comment

begin_define
define|#
directive|define
name|NI_QTYPE_DNSNAME
value|2
end_define

begin_comment
comment|/* DNS Name */
end_comment

begin_define
define|#
directive|define
name|NI_QTYPE_NODEADDR
value|3
end_define

begin_comment
comment|/* Node Addresses */
end_comment

begin_define
define|#
directive|define
name|NI_QTYPE_IPV4ADDR
value|4
end_define

begin_comment
comment|/* IPv4 Addresses */
end_comment

begin_comment
comment|/* network endian */
end_comment

begin_define
define|#
directive|define
name|NI_SUPTYPE_FLAG_COMPRESS
value|((uint16_t)htons(0x1))
end_define

begin_define
define|#
directive|define
name|NI_FQDN_FLAG_VALIDTTL
value|((uint16_t)htons(0x1))
end_define

begin_comment
comment|/* network endian */
end_comment

begin_define
define|#
directive|define
name|NI_NODEADDR_FLAG_TRUNCATE
value|((uint16_t)htons(0x1))
end_define

begin_define
define|#
directive|define
name|NI_NODEADDR_FLAG_ALL
value|((uint16_t)htons(0x2))
end_define

begin_define
define|#
directive|define
name|NI_NODEADDR_FLAG_COMPAT
value|((uint16_t)htons(0x4))
end_define

begin_define
define|#
directive|define
name|NI_NODEADDR_FLAG_LINKLOCAL
value|((uint16_t)htons(0x8))
end_define

begin_define
define|#
directive|define
name|NI_NODEADDR_FLAG_SITELOCAL
value|((uint16_t)htons(0x10))
end_define

begin_define
define|#
directive|define
name|NI_NODEADDR_FLAG_GLOBAL
value|((uint16_t)htons(0x20))
end_define

begin_define
define|#
directive|define
name|NI_NODEADDR_FLAG_ANYCAST
value|((uint16_t)htons(0x40))
end_define

begin_comment
comment|/* just experimental. not in spec */
end_comment

begin_struct
struct|struct
name|ni_reply_fqdn
block|{
name|uint32_t
name|ni_fqdn_ttl
decl_stmt|;
comment|/* TTL */
name|uint8_t
name|ni_fqdn_namelen
decl_stmt|;
comment|/* length in octets of the FQDN */
name|uint8_t
name|ni_fqdn_name
index|[
literal|3
index|]
decl_stmt|;
comment|/* XXX: alignment */
block|}
struct|;
end_struct

begin_comment
comment|/*  * Router Renumbering. as router-renum-08.txt  */
end_comment

begin_struct
struct|struct
name|icmp6_router_renum
block|{
comment|/* router renumbering header */
name|struct
name|icmp6_hdr
name|rr_hdr
decl_stmt|;
name|uint8_t
name|rr_segnum
decl_stmt|;
name|uint8_t
name|rr_flags
decl_stmt|;
name|uint16_t
name|rr_maxdelay
decl_stmt|;
name|uint32_t
name|rr_reserved
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|ICMP6_RR_FLAGS_TEST
value|0x80
end_define

begin_define
define|#
directive|define
name|ICMP6_RR_FLAGS_REQRESULT
value|0x40
end_define

begin_define
define|#
directive|define
name|ICMP6_RR_FLAGS_FORCEAPPLY
value|0x20
end_define

begin_define
define|#
directive|define
name|ICMP6_RR_FLAGS_SPECSITE
value|0x10
end_define

begin_define
define|#
directive|define
name|ICMP6_RR_FLAGS_PREVDONE
value|0x08
end_define

begin_define
define|#
directive|define
name|rr_type
value|rr_hdr.icmp6_type
end_define

begin_define
define|#
directive|define
name|rr_code
value|rr_hdr.icmp6_code
end_define

begin_define
define|#
directive|define
name|rr_cksum
value|rr_hdr.icmp6_cksum
end_define

begin_define
define|#
directive|define
name|rr_seqnum
value|rr_hdr.icmp6_data32[0]
end_define

begin_struct
struct|struct
name|rr_pco_match
block|{
comment|/* match prefix part */
name|uint8_t
name|rpm_code
decl_stmt|;
name|uint8_t
name|rpm_len
decl_stmt|;
name|uint8_t
name|rpm_ordinal
decl_stmt|;
name|uint8_t
name|rpm_matchlen
decl_stmt|;
name|uint8_t
name|rpm_minlen
decl_stmt|;
name|uint8_t
name|rpm_maxlen
decl_stmt|;
name|uint16_t
name|rpm_reserved
decl_stmt|;
name|struct
name|in6_addr
name|rpm_prefix
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|RPM_PCO_ADD
value|1
end_define

begin_define
define|#
directive|define
name|RPM_PCO_CHANGE
value|2
end_define

begin_define
define|#
directive|define
name|RPM_PCO_SETGLOBAL
value|3
end_define

begin_define
define|#
directive|define
name|RPM_PCO_MAX
value|4
end_define

begin_struct
struct|struct
name|rr_pco_use
block|{
comment|/* use prefix part */
name|uint8_t
name|rpu_uselen
decl_stmt|;
name|uint8_t
name|rpu_keeplen
decl_stmt|;
name|uint8_t
name|rpu_ramask
decl_stmt|;
name|uint8_t
name|rpu_raflags
decl_stmt|;
name|uint32_t
name|rpu_vltime
decl_stmt|;
name|uint32_t
name|rpu_pltime
decl_stmt|;
name|uint32_t
name|rpu_flags
decl_stmt|;
name|struct
name|in6_addr
name|rpu_prefix
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|ICMP6_RR_PCOUSE_RAFLAGS_ONLINK
value|0x80
end_define

begin_define
define|#
directive|define
name|ICMP6_RR_PCOUSE_RAFLAGS_AUTO
value|0x40
end_define

begin_comment
comment|/* network endian */
end_comment

begin_define
define|#
directive|define
name|ICMP6_RR_PCOUSE_FLAGS_DECRVLTIME
value|((uint32_t)htonl(0x80000000))
end_define

begin_define
define|#
directive|define
name|ICMP6_RR_PCOUSE_FLAGS_DECRPLTIME
value|((uint32_t)htonl(0x40000000))
end_define

begin_struct
struct|struct
name|rr_result
block|{
comment|/* router renumbering result message */
name|uint16_t
name|rrr_flags
decl_stmt|;
name|uint8_t
name|rrr_ordinal
decl_stmt|;
name|uint8_t
name|rrr_matchedlen
decl_stmt|;
name|uint32_t
name|rrr_ifid
decl_stmt|;
name|struct
name|in6_addr
name|rrr_prefix
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* network endian */
end_comment

begin_define
define|#
directive|define
name|ICMP6_RR_RESULT_FLAGS_OOB
value|((uint16_t)htons(0x0002))
end_define

begin_define
define|#
directive|define
name|ICMP6_RR_RESULT_FLAGS_FORBIDDEN
value|((uint16_t)htons(0x0001))
end_define

begin_function_decl
specifier|static
specifier|const
name|char
modifier|*
name|get_rtpref
parameter_list|(
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|const
name|char
modifier|*
name|get_lifetime
parameter_list|(
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_lladdr
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|,
name|size_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|icmp6_opt_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mld6_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mldv2_report_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|mldv2_query_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|const
name|struct
name|udphdr
modifier|*
name|get_upperlayer
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|,
name|u_int
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dnsname_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|icmp6_nodeinfo_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
name|u_int
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|icmp6_rrenum_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_ifndef
ifndef|#
directive|ifndef
name|abs
end_ifndef

begin_define
define|#
directive|define
name|abs
parameter_list|(
name|a
parameter_list|)
value|((0< (a)) ? (a) : -(a))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"rpl.h"
end_include

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|icmp6_type_values
index|[]
init|=
block|{
block|{
name|ICMP6_DST_UNREACH
block|,
literal|"destination unreachable"
block|}
block|,
block|{
name|ICMP6_PACKET_TOO_BIG
block|,
literal|"packet too big"
block|}
block|,
block|{
name|ICMP6_TIME_EXCEEDED
block|,
literal|"time exceeded in-transit"
block|}
block|,
block|{
name|ICMP6_PARAM_PROB
block|,
literal|"parameter problem"
block|}
block|,
block|{
name|ICMP6_ECHO_REQUEST
block|,
literal|"echo request"
block|}
block|,
block|{
name|ICMP6_ECHO_REPLY
block|,
literal|"echo reply"
block|}
block|,
block|{
name|MLD6_LISTENER_QUERY
block|,
literal|"multicast listener query"
block|}
block|,
block|{
name|MLD6_LISTENER_REPORT
block|,
literal|"multicast listener report"
block|}
block|,
block|{
name|MLD6_LISTENER_DONE
block|,
literal|"multicast listener done"
block|}
block|,
block|{
name|ND_ROUTER_SOLICIT
block|,
literal|"router solicitation"
block|}
block|,
block|{
name|ND_ROUTER_ADVERT
block|,
literal|"router advertisement"
block|}
block|,
block|{
name|ND_NEIGHBOR_SOLICIT
block|,
literal|"neighbor solicitation"
block|}
block|,
block|{
name|ND_NEIGHBOR_ADVERT
block|,
literal|"neighbor advertisement"
block|}
block|,
block|{
name|ND_REDIRECT
block|,
literal|"redirect"
block|}
block|,
block|{
name|ICMP6_ROUTER_RENUMBERING
block|,
literal|"router renumbering"
block|}
block|,
block|{
name|IND_SOLICIT
block|,
literal|"inverse neighbor solicitation"
block|}
block|,
block|{
name|IND_ADVERT
block|,
literal|"inverse neighbor advertisement"
block|}
block|,
block|{
name|MLDV2_LISTENER_REPORT
block|,
literal|"multicast listener report v2"
block|}
block|,
block|{
name|ICMP6_HADISCOV_REQUEST
block|,
literal|"ha discovery request"
block|}
block|,
block|{
name|ICMP6_HADISCOV_REPLY
block|,
literal|"ha discovery reply"
block|}
block|,
block|{
name|ICMP6_MOBILEPREFIX_SOLICIT
block|,
literal|"mobile router solicitation"
block|}
block|,
block|{
name|ICMP6_MOBILEPREFIX_ADVERT
block|,
literal|"mobile router advertisement"
block|}
block|,
block|{
name|ICMP6_WRUREQUEST
block|,
literal|"who-are-you request"
block|}
block|,
block|{
name|ICMP6_WRUREPLY
block|,
literal|"who-are-you reply"
block|}
block|,
block|{
name|ICMP6_NI_QUERY
block|,
literal|"node information query"
block|}
block|,
block|{
name|ICMP6_NI_REPLY
block|,
literal|"node information reply"
block|}
block|,
block|{
name|MLD6_MTRACE
block|,
literal|"mtrace message"
block|}
block|,
block|{
name|MLD6_MTRACE_RESP
block|,
literal|"mtrace response"
block|}
block|,
block|{
name|ND_RPL_MESSAGE
block|,
literal|"RPL"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|icmp6_dst_unreach_code_values
index|[]
init|=
block|{
block|{
name|ICMP6_DST_UNREACH_NOROUTE
block|,
literal|"unreachable route"
block|}
block|,
block|{
name|ICMP6_DST_UNREACH_ADMIN
block|,
literal|" unreachable prohibited"
block|}
block|,
block|{
name|ICMP6_DST_UNREACH_BEYONDSCOPE
block|,
literal|"beyond scope"
block|}
block|,
block|{
name|ICMP6_DST_UNREACH_ADDR
block|,
literal|"unreachable address"
block|}
block|,
block|{
name|ICMP6_DST_UNREACH_NOPORT
block|,
literal|"unreachable port"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|icmp6_opt_pi_flag_values
index|[]
init|=
block|{
block|{
name|ND_OPT_PI_FLAG_ONLINK
block|,
literal|"onlink"
block|}
block|,
block|{
name|ND_OPT_PI_FLAG_AUTO
block|,
literal|"auto"
block|}
block|,
block|{
name|ND_OPT_PI_FLAG_ROUTER
block|,
literal|"router"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|icmp6_opt_ra_flag_values
index|[]
init|=
block|{
block|{
name|ND_RA_FLAG_MANAGED
block|,
literal|"managed"
block|}
block|,
block|{
name|ND_RA_FLAG_OTHER
block|,
literal|"other stateful"
block|}
block|,
block|{
name|ND_RA_FLAG_HOME_AGENT
block|,
literal|"home agent"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|icmp6_nd_na_flag_values
index|[]
init|=
block|{
block|{
name|ND_NA_FLAG_ROUTER
block|,
literal|"router"
block|}
block|,
block|{
name|ND_NA_FLAG_SOLICITED
block|,
literal|"solicited"
block|}
block|,
block|{
name|ND_NA_FLAG_OVERRIDE
block|,
literal|"override"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|icmp6_opt_values
index|[]
init|=
block|{
block|{
name|ND_OPT_SOURCE_LINKADDR
block|,
literal|"source link-address"
block|}
block|,
block|{
name|ND_OPT_TARGET_LINKADDR
block|,
literal|"destination link-address"
block|}
block|,
block|{
name|ND_OPT_PREFIX_INFORMATION
block|,
literal|"prefix info"
block|}
block|,
block|{
name|ND_OPT_REDIRECTED_HEADER
block|,
literal|"redirected header"
block|}
block|,
block|{
name|ND_OPT_MTU
block|,
literal|"mtu"
block|}
block|,
block|{
name|ND_OPT_RDNSS
block|,
literal|"rdnss"
block|}
block|,
block|{
name|ND_OPT_DNSSL
block|,
literal|"dnssl"
block|}
block|,
block|{
name|ND_OPT_ADVINTERVAL
block|,
literal|"advertisement interval"
block|}
block|,
block|{
name|ND_OPT_HOMEAGENT_INFO
block|,
literal|"homeagent information"
block|}
block|,
block|{
name|ND_OPT_ROUTE_INFO
block|,
literal|"route info"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* mldv2 report types */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|mldv2report2str
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"is_in"
block|}
block|,
block|{
literal|2
block|,
literal|"is_ex"
block|}
block|,
block|{
literal|3
block|,
literal|"to_in"
block|}
block|,
block|{
literal|4
block|,
literal|"to_ex"
block|}
block|,
block|{
literal|5
block|,
literal|"allow"
block|}
block|,
block|{
literal|6
block|,
literal|"block"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|get_rtpref
parameter_list|(
name|u_int
name|v
parameter_list|)
block|{
specifier|static
specifier|const
name|char
modifier|*
name|rtpref_str
index|[]
init|=
block|{
literal|"medium"
block|,
comment|/* 00 */
literal|"high"
block|,
comment|/* 01 */
literal|"rsv"
block|,
comment|/* 10 */
literal|"low"
comment|/* 11 */
block|}
decl_stmt|;
return|return
name|rtpref_str
index|[
operator|(
operator|(
name|v
operator|&
name|ND_RA_FLAG_RTPREF_MASK
operator|)
operator|>>
literal|3
operator|)
operator|&
literal|0xff
index|]
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|get_lifetime
parameter_list|(
name|uint32_t
name|v
parameter_list|)
block|{
specifier|static
name|char
name|buf
index|[
literal|20
index|]
decl_stmt|;
if|if
condition|(
name|v
operator|==
operator|(
name|uint32_t
operator|)
operator|~
literal|0UL
condition|)
return|return
literal|"infinity"
return|;
else|else
block|{
name|snprintf
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%us"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
name|buf
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_lladdr
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|uint8_t
modifier|*
name|p
parameter_list|,
name|size_t
name|l
parameter_list|)
block|{
specifier|const
name|uint8_t
modifier|*
name|ep
decl_stmt|,
modifier|*
name|q
decl_stmt|;
name|q
operator|=
name|p
expr_stmt|;
name|ep
operator|=
name|p
operator|+
name|l
expr_stmt|;
while|while
condition|(
name|l
operator|>
literal|0
operator|&&
name|q
operator|<
name|ep
condition|)
block|{
if|if
condition|(
name|q
operator|>
name|p
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|":"
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%02x"
operator|,
operator|*
name|q
operator|++
operator|)
argument_list|)
expr_stmt|;
name|l
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|icmp6_cksum
parameter_list|(
specifier|const
name|struct
name|ip6_hdr
modifier|*
name|ip6
parameter_list|,
specifier|const
name|struct
name|icmp6_hdr
modifier|*
name|icp
parameter_list|,
name|u_int
name|len
parameter_list|)
block|{
return|return
name|nextproto6_cksum
argument_list|(
name|ip6
argument_list|,
operator|(
specifier|const
name|uint8_t
operator|*
operator|)
operator|(
name|void
operator|*
operator|)
name|icp
argument_list|,
name|len
argument_list|,
name|len
argument_list|,
name|IPPROTO_ICMPV6
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
specifier|const
name|struct
name|tok
name|rpl_mop_values
index|[]
init|=
block|{
block|{
name|RPL_DIO_NONSTORING
block|,
literal|"nonstoring"
block|}
block|,
block|{
name|RPL_DIO_STORING
block|,
literal|"storing"
block|}
block|,
block|{
name|RPL_DIO_NONSTORING_MULTICAST
block|,
literal|"nonstoring-multicast"
block|}
block|,
block|{
name|RPL_DIO_STORING_MULTICAST
block|,
literal|"storing-multicast"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|struct
name|tok
name|rpl_subopt_values
index|[]
init|=
block|{
block|{
name|RPL_OPT_PAD0
block|,
literal|"pad0"
block|}
block|,
block|{
name|RPL_OPT_PADN
block|,
literal|"padN"
block|}
block|,
block|{
name|RPL_DIO_METRICS
block|,
literal|"metrics"
block|}
block|,
block|{
name|RPL_DIO_ROUTINGINFO
block|,
literal|"routinginfo"
block|}
block|,
block|{
name|RPL_DIO_CONFIG
block|,
literal|"config"
block|}
block|,
block|{
name|RPL_DAO_RPLTARGET
block|,
literal|"rpltarget"
block|}
block|,
block|{
name|RPL_DAO_TRANSITINFO
block|,
literal|"transitinfo"
block|}
block|,
block|{
name|RPL_DIO_DESTPREFIX
block|,
literal|"destprefix"
block|}
block|,
block|{
name|RPL_DAO_RPLTARGET_DESC
block|,
literal|"rpltargetdesc"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|rpl_format_dagid
parameter_list|(
name|char
name|dagid_str
index|[
literal|65
index|]
parameter_list|,
specifier|const
name|u_char
modifier|*
name|dagid
parameter_list|)
block|{
name|char
modifier|*
name|d
init|=
name|dagid_str
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|isprint
argument_list|(
name|dagid
index|[
name|i
index|]
argument_list|)
condition|)
block|{
operator|*
name|d
operator|++
operator|=
name|dagid
index|[
name|i
index|]
expr_stmt|;
block|}
else|else
block|{
name|snprintf
argument_list|(
name|d
argument_list|,
literal|5
argument_list|,
literal|"0x%02x"
argument_list|,
name|dagid
index|[
name|i
index|]
argument_list|)
expr_stmt|;
comment|/* 4 + null char */
name|d
operator|+=
literal|4
expr_stmt|;
block|}
block|}
operator|*
name|d
operator|++
operator|=
literal|'\0'
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|rpl_dio_printopt
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|struct
name|rpl_dio_genoption
modifier|*
name|opt
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
if|if
condition|(
name|length
operator|<
name|RPL_DIO_GENOPTION_LEN
condition|)
return|return;
name|length
operator|-=
name|RPL_DIO_GENOPTION_LEN
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|opt
operator|->
name|rpl_dio_len
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|opt
operator|->
name|rpl_dio_type
operator|==
name|RPL_OPT_PAD0
operator|&&
operator|(
name|u_char
operator|*
operator|)
name|opt
operator|<
name|ndo
operator|->
name|ndo_snapend
operator|)
operator|||
name|ND_TTEST2
argument_list|(
operator|*
name|opt
argument_list|,
operator|(
name|opt
operator|->
name|rpl_dio_len
operator|+
literal|2
operator|)
argument_list|)
condition|)
block|{
name|unsigned
name|int
name|optlen
init|=
name|opt
operator|->
name|rpl_dio_len
operator|+
literal|2
decl_stmt|;
if|if
condition|(
name|opt
operator|->
name|rpl_dio_type
operator|==
name|RPL_OPT_PAD0
condition|)
block|{
name|optlen
operator|=
literal|1
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" opt:pad0"
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" opt:%s len:%u "
operator|,
name|tok2str
argument_list|(
name|rpl_subopt_values
argument_list|,
literal|"%subopt:%u"
argument_list|,
name|opt
operator|->
name|rpl_dio_type
argument_list|)
operator|,
name|optlen
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|2
condition|)
block|{
name|unsigned
name|int
name|paylen
init|=
name|opt
operator|->
name|rpl_dio_len
decl_stmt|;
if|if
condition|(
name|paylen
operator|>
name|length
condition|)
name|paylen
operator|=
name|length
expr_stmt|;
name|hex_print
argument_list|(
name|ndo
argument_list|,
literal|" "
argument_list|,
operator|(
operator|(
name|uint8_t
operator|*
operator|)
name|opt
operator|)
operator|+
name|RPL_DIO_GENOPTION_LEN
argument_list|,
comment|/* content of DIO option */
name|paylen
argument_list|)
expr_stmt|;
block|}
block|}
name|opt
operator|=
operator|(
expr|struct
name|rpl_dio_genoption
operator|*
operator|)
operator|(
operator|(
operator|(
name|char
operator|*
operator|)
name|opt
operator|)
operator|+
name|optlen
operator|)
expr_stmt|;
name|length
operator|-=
name|optlen
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [|truncated]"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|rpl_dio_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
specifier|const
name|struct
name|nd_rpl_dio
modifier|*
name|dio
init|=
operator|(
expr|struct
name|nd_rpl_dio
operator|*
operator|)
name|bp
decl_stmt|;
name|char
name|dagid_str
index|[
literal|65
index|]
decl_stmt|;
name|ND_TCHECK
argument_list|(
operator|*
name|dio
argument_list|)
expr_stmt|;
name|rpl_format_dagid
argument_list|(
name|dagid_str
argument_list|,
name|dio
operator|->
name|rpl_dagid
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [dagid:%s,seq:%u,instance:%u,rank:%u,%smop:%s,prf:%u]"
operator|,
name|dagid_str
operator|,
name|dio
operator|->
name|rpl_dtsn
operator|,
name|dio
operator|->
name|rpl_instanceid
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|dio
operator|->
name|rpl_dagrank
argument_list|)
operator|,
name|RPL_DIO_GROUNDED
argument_list|(
name|dio
operator|->
name|rpl_mopprf
argument_list|)
condition|?
literal|"grounded,"
else|:
literal|""
operator|,
name|tok2str
argument_list|(
name|rpl_mop_values
argument_list|,
literal|"mop%u"
argument_list|,
name|RPL_DIO_MOP
argument_list|(
name|dio
operator|->
name|rpl_mopprf
argument_list|)
argument_list|)
operator|,
name|RPL_DIO_PRF
argument_list|(
name|dio
operator|->
name|rpl_mopprf
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|1
condition|)
block|{
name|struct
name|rpl_dio_genoption
modifier|*
name|opt
init|=
operator|(
expr|struct
name|rpl_dio_genoption
operator|*
operator|)
operator|&
name|dio
index|[
literal|1
index|]
decl_stmt|;
name|rpl_dio_printopt
argument_list|(
name|ndo
argument_list|,
name|opt
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [|truncated]"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|rpl_dao_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
specifier|const
name|struct
name|nd_rpl_dao
modifier|*
name|dao
init|=
operator|(
expr|struct
name|nd_rpl_dao
operator|*
operator|)
name|bp
decl_stmt|;
name|char
name|dagid_str
index|[
literal|65
index|]
decl_stmt|;
name|ND_TCHECK
argument_list|(
operator|*
name|dao
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|<
name|ND_RPL_DAO_MIN_LEN
condition|)
goto|goto
name|tooshort
goto|;
name|strcpy
argument_list|(
name|dagid_str
argument_list|,
literal|"<elided>"
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|ND_RPL_DAO_MIN_LEN
expr_stmt|;
name|length
operator|-=
name|ND_RPL_DAO_MIN_LEN
expr_stmt|;
if|if
condition|(
name|RPL_DAO_D
argument_list|(
name|dao
operator|->
name|rpl_flags
argument_list|)
condition|)
block|{
name|ND_TCHECK2
argument_list|(
name|dao
operator|->
name|rpl_dagid
argument_list|,
name|DAGID_LEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|<
name|DAGID_LEN
condition|)
goto|goto
name|tooshort
goto|;
name|rpl_format_dagid
argument_list|(
name|dagid_str
argument_list|,
name|dao
operator|->
name|rpl_dagid
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|DAGID_LEN
expr_stmt|;
name|length
operator|-=
name|DAGID_LEN
expr_stmt|;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [dagid:%s,seq:%u,instance:%u%s%s,%02x]"
operator|,
name|dagid_str
operator|,
name|dao
operator|->
name|rpl_daoseq
operator|,
name|dao
operator|->
name|rpl_instanceid
operator|,
name|RPL_DAO_K
argument_list|(
name|dao
operator|->
name|rpl_flags
argument_list|)
condition|?
literal|",acK"
else|:
literal|""
operator|,
name|RPL_DAO_D
argument_list|(
name|dao
operator|->
name|rpl_flags
argument_list|)
condition|?
literal|",Dagid"
else|:
literal|""
operator|,
name|dao
operator|->
name|rpl_flags
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|1
condition|)
block|{
specifier|const
name|struct
name|rpl_dio_genoption
modifier|*
name|opt
init|=
operator|(
expr|struct
name|rpl_dio_genoption
operator|*
operator|)
name|bp
decl_stmt|;
name|rpl_dio_printopt
argument_list|(
name|ndo
argument_list|,
name|opt
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [|truncated]"
operator|)
argument_list|)
expr_stmt|;
return|return;
name|tooshort
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [|length too short]"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|rpl_daoack_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
specifier|const
name|struct
name|nd_rpl_daoack
modifier|*
name|daoack
init|=
operator|(
expr|struct
name|nd_rpl_daoack
operator|*
operator|)
name|bp
decl_stmt|;
name|char
name|dagid_str
index|[
literal|65
index|]
decl_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|daoack
argument_list|,
name|ND_RPL_DAOACK_MIN_LEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|<
name|ND_RPL_DAOACK_MIN_LEN
condition|)
goto|goto
name|tooshort
goto|;
name|strcpy
argument_list|(
name|dagid_str
argument_list|,
literal|"<elided>"
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|ND_RPL_DAOACK_MIN_LEN
expr_stmt|;
name|length
operator|-=
name|ND_RPL_DAOACK_MIN_LEN
expr_stmt|;
if|if
condition|(
name|RPL_DAOACK_D
argument_list|(
name|daoack
operator|->
name|rpl_flags
argument_list|)
condition|)
block|{
name|ND_TCHECK2
argument_list|(
name|daoack
operator|->
name|rpl_dagid
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|<
name|DAGID_LEN
condition|)
goto|goto
name|tooshort
goto|;
name|rpl_format_dagid
argument_list|(
name|dagid_str
argument_list|,
name|daoack
operator|->
name|rpl_dagid
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|DAGID_LEN
expr_stmt|;
name|length
operator|-=
name|DAGID_LEN
expr_stmt|;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [dagid:%s,seq:%u,instance:%u,status:%u]"
operator|,
name|dagid_str
operator|,
name|daoack
operator|->
name|rpl_daoseq
operator|,
name|daoack
operator|->
name|rpl_instanceid
operator|,
name|daoack
operator|->
name|rpl_status
operator|)
argument_list|)
expr_stmt|;
comment|/* no officially defined options for DAOACK, but print any we find */
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|1
condition|)
block|{
specifier|const
name|struct
name|rpl_dio_genoption
modifier|*
name|opt
init|=
operator|(
expr|struct
name|rpl_dio_genoption
operator|*
operator|)
name|bp
decl_stmt|;
name|rpl_dio_printopt
argument_list|(
name|ndo
argument_list|,
name|opt
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [|dao-truncated]"
operator|)
argument_list|)
expr_stmt|;
return|return;
name|tooshort
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [|dao-length too short]"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|rpl_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|struct
name|icmp6_hdr
modifier|*
name|hdr
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|int
name|secured
init|=
name|hdr
operator|->
name|icmp6_code
operator|&
literal|0x80
decl_stmt|;
name|int
name|basecode
init|=
name|hdr
operator|->
name|icmp6_code
operator|&
literal|0x7f
decl_stmt|;
if|if
condition|(
name|secured
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", (SEC) [worktodo]"
operator|)
argument_list|)
expr_stmt|;
comment|/* XXX                  * the next header pointer needs to move forward to                  * skip the secure part.                  */
return|return;
block|}
else|else
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", (CLR)"
operator|)
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|basecode
condition|)
block|{
case|case
name|ND_RPL_DAG_IS
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"DODAG Information Solicitation"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{                 }
break|break;
case|case
name|ND_RPL_DAG_IO
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"DODAG Information Object"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|rpl_dio_print
argument_list|(
name|ndo
argument_list|,
name|bp
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ND_RPL_DAO
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Destination Advertisement Object"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|rpl_dao_print
argument_list|(
name|ndo
argument_list|,
name|bp
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ND_RPL_DAO_ACK
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Destination Advertisement Object Ack"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|rpl_daoack_print
argument_list|(
name|ndo
argument_list|,
name|bp
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"RPL message, unknown code %u"
operator|,
name|hdr
operator|->
name|icmp6_code
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
return|return;
if|#
directive|if
literal|0
block|trunc: 	ND_PRINT((ndo," [|truncated]")); 	return;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|icmp6_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
name|u_int
name|length
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp2
parameter_list|,
name|int
name|fragmented
parameter_list|)
block|{
specifier|const
name|struct
name|icmp6_hdr
modifier|*
name|dp
decl_stmt|;
specifier|const
name|struct
name|ip6_hdr
modifier|*
name|ip
decl_stmt|;
specifier|const
name|struct
name|ip6_hdr
modifier|*
name|oip
decl_stmt|;
specifier|const
name|struct
name|udphdr
modifier|*
name|ouh
decl_stmt|;
name|int
name|dport
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|ep
decl_stmt|;
name|u_int
name|prot
decl_stmt|;
name|dp
operator|=
operator|(
expr|struct
name|icmp6_hdr
operator|*
operator|)
name|bp
expr_stmt|;
name|ip
operator|=
operator|(
expr|struct
name|ip6_hdr
operator|*
operator|)
name|bp2
expr_stmt|;
name|oip
operator|=
operator|(
expr|struct
name|ip6_hdr
operator|*
operator|)
operator|(
name|dp
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* 'ep' points to the end of available data. */
name|ep
operator|=
name|ndo
operator|->
name|ndo_snapend
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|dp
operator|->
name|icmp6_cksum
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|&&
operator|!
name|fragmented
condition|)
block|{
name|uint16_t
name|sum
decl_stmt|,
name|udp_sum
decl_stmt|;
if|if
condition|(
name|ND_TTEST2
argument_list|(
name|bp
index|[
literal|0
index|]
argument_list|,
name|length
argument_list|)
condition|)
block|{
name|udp_sum
operator|=
name|EXTRACT_16BITS
argument_list|(
operator|&
name|dp
operator|->
name|icmp6_cksum
argument_list|)
expr_stmt|;
name|sum
operator|=
name|icmp6_cksum
argument_list|(
name|ip
argument_list|,
name|dp
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
name|sum
operator|!=
literal|0
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"[bad icmp6 cksum 0x%04x -> 0x%04x!] "
operator|,
name|udp_sum
operator|,
name|in_cksum_shouldbe
argument_list|(
name|udp_sum
argument_list|,
name|sum
argument_list|)
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"[icmp6 sum ok] "
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"ICMP6, %s"
operator|,
name|tok2str
argument_list|(
name|icmp6_type_values
argument_list|,
literal|"unknown icmp6 type (%u)"
argument_list|,
name|dp
operator|->
name|icmp6_type
argument_list|)
operator|)
argument_list|)
expr_stmt|;
comment|/* display cosmetics: print the packet length for printer that use the vflag now */
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|&&
operator|(
name|dp
operator|->
name|icmp6_type
operator|==
name|ND_ROUTER_SOLICIT
operator|||
name|dp
operator|->
name|icmp6_type
operator|==
name|ND_ROUTER_ADVERT
operator|||
name|dp
operator|->
name|icmp6_type
operator|==
name|ND_NEIGHBOR_ADVERT
operator|||
name|dp
operator|->
name|icmp6_type
operator|==
name|ND_NEIGHBOR_SOLICIT
operator|||
name|dp
operator|->
name|icmp6_type
operator|==
name|ND_REDIRECT
operator|||
name|dp
operator|->
name|icmp6_type
operator|==
name|ICMP6_HADISCOV_REPLY
operator|||
name|dp
operator|->
name|icmp6_type
operator|==
name|ICMP6_MOBILEPREFIX_ADVERT
operator|)
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", length %u"
operator|,
name|length
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|dp
operator|->
name|icmp6_type
condition|)
block|{
case|case
name|ICMP6_DST_UNREACH
case|:
name|ND_TCHECK
argument_list|(
name|oip
operator|->
name|ip6_dst
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", %s"
operator|,
name|tok2str
argument_list|(
name|icmp6_dst_unreach_code_values
argument_list|,
literal|"unknown unreach code (%u)"
argument_list|,
name|dp
operator|->
name|icmp6_code
argument_list|)
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|dp
operator|->
name|icmp6_code
condition|)
block|{
case|case
name|ICMP6_DST_UNREACH_NOROUTE
case|:
comment|/* fall through */
case|case
name|ICMP6_DST_UNREACH_ADMIN
case|:
case|case
name|ICMP6_DST_UNREACH_ADDR
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|oip
operator|->
name|ip6_dst
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_DST_UNREACH_BEYONDSCOPE
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" %s, source address %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|oip
operator|->
name|ip6_dst
argument_list|)
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|oip
operator|->
name|ip6_src
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_DST_UNREACH_NOPORT
case|:
if|if
condition|(
operator|(
name|ouh
operator|=
name|get_upperlayer
argument_list|(
name|ndo
argument_list|,
operator|(
name|u_char
operator|*
operator|)
name|oip
argument_list|,
operator|&
name|prot
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|trunc
goto|;
name|dport
operator|=
name|EXTRACT_16BITS
argument_list|(
operator|&
name|ouh
operator|->
name|uh_dport
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|prot
condition|)
block|{
case|case
name|IPPROTO_TCP
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", %s tcp port %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|oip
operator|->
name|ip6_dst
argument_list|)
operator|,
name|tcpport_string
argument_list|(
name|dport
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|IPPROTO_UDP
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", %s udp port %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|oip
operator|->
name|ip6_dst
argument_list|)
operator|,
name|udpport_string
argument_list|(
name|dport
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", %s protocol %d port %d unreachable"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|oip
operator|->
name|ip6_dst
argument_list|)
operator|,
name|oip
operator|->
name|ip6_nxt
operator|,
name|dport
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
default|default:
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|<=
literal|1
condition|)
block|{
name|print_unknown_data
argument_list|(
name|ndo
argument_list|,
name|bp
argument_list|,
literal|"\n\t"
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
block|}
break|break;
block|}
break|break;
case|case
name|ICMP6_PACKET_TOO_BIG
case|:
name|ND_TCHECK
argument_list|(
name|dp
operator|->
name|icmp6_mtu
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", mtu %u"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|dp
operator|->
name|icmp6_mtu
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_TIME_EXCEEDED
case|:
name|ND_TCHECK
argument_list|(
name|oip
operator|->
name|ip6_dst
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|dp
operator|->
name|icmp6_code
condition|)
block|{
case|case
name|ICMP6_TIME_EXCEED_TRANSIT
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" for %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|oip
operator|->
name|ip6_dst
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_TIME_EXCEED_REASSEMBLY
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" (reassembly)"
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", unknown code (%u)"
operator|,
name|dp
operator|->
name|icmp6_code
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|ICMP6_PARAM_PROB
case|:
name|ND_TCHECK
argument_list|(
name|oip
operator|->
name|ip6_dst
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|dp
operator|->
name|icmp6_code
condition|)
block|{
case|case
name|ICMP6_PARAMPROB_HEADER
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", erroneous - octet %u"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|dp
operator|->
name|icmp6_pptr
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_PARAMPROB_NEXTHEADER
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", next header - octet %u"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|dp
operator|->
name|icmp6_pptr
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_PARAMPROB_OPTION
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", option - octet %u"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|dp
operator|->
name|icmp6_pptr
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", code-#%d"
operator|,
name|dp
operator|->
name|icmp6_code
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|ICMP6_ECHO_REQUEST
case|:
case|case
name|ICMP6_ECHO_REPLY
case|:
name|ND_TCHECK
argument_list|(
name|dp
operator|->
name|icmp6_seq
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", seq %u"
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|dp
operator|->
name|icmp6_seq
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_MEMBERSHIP_QUERY
case|:
if|if
condition|(
name|length
operator|==
name|MLD_MINLEN
condition|)
block|{
name|mld6_print
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|dp
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|length
operator|>=
name|MLDV2_MINLEN
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" v2"
operator|)
argument_list|)
expr_stmt|;
name|mldv2_query_print
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|dp
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" unknown-version (len %u) "
operator|,
name|length
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ICMP6_MEMBERSHIP_REPORT
case|:
name|mld6_print
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|dp
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_MEMBERSHIP_REDUCTION
case|:
name|mld6_print
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|dp
argument_list|)
expr_stmt|;
break|break;
case|case
name|ND_ROUTER_SOLICIT
case|:
define|#
directive|define
name|RTSOLLEN
value|8
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|icmp6_opt_print
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|dp
operator|+
name|RTSOLLEN
argument_list|,
name|length
operator|-
name|RTSOLLEN
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ND_ROUTER_ADVERT
case|:
define|#
directive|define
name|RTADVLEN
value|16
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|struct
name|nd_router_advert
modifier|*
name|p
decl_stmt|;
name|p
operator|=
operator|(
expr|struct
name|nd_router_advert
operator|*
operator|)
name|dp
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|p
operator|->
name|nd_ra_retransmit
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\thop limit %u, Flags [%s]"
expr|\
literal|", pref %s, router lifetime %us, reachable time %us, retrans time %us"
operator|,
operator|(
name|u_int
operator|)
name|p
operator|->
name|nd_ra_curhoplimit
operator|,
name|bittok2str
argument_list|(
name|icmp6_opt_ra_flag_values
argument_list|,
literal|"none"
argument_list|,
operator|(
name|p
operator|->
name|nd_ra_flags_reserved
operator|)
argument_list|)
operator|,
name|get_rtpref
argument_list|(
name|p
operator|->
name|nd_ra_flags_reserved
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|p
operator|->
name|nd_ra_router_lifetime
argument_list|)
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|p
operator|->
name|nd_ra_reachable
argument_list|)
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|p
operator|->
name|nd_ra_retransmit
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|icmp6_opt_print
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|dp
operator|+
name|RTADVLEN
argument_list|,
name|length
operator|-
name|RTADVLEN
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ND_NEIGHBOR_SOLICIT
case|:
block|{
name|struct
name|nd_neighbor_solicit
modifier|*
name|p
decl_stmt|;
name|p
operator|=
operator|(
expr|struct
name|nd_neighbor_solicit
operator|*
operator|)
name|dp
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|p
operator|->
name|nd_ns_target
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", who has %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|p
operator|->
name|nd_ns_target
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
define|#
directive|define
name|NDSOLLEN
value|24
name|icmp6_opt_print
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|dp
operator|+
name|NDSOLLEN
argument_list|,
name|length
operator|-
name|NDSOLLEN
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|ND_NEIGHBOR_ADVERT
case|:
block|{
name|struct
name|nd_neighbor_advert
modifier|*
name|p
decl_stmt|;
name|p
operator|=
operator|(
expr|struct
name|nd_neighbor_advert
operator|*
operator|)
name|dp
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|p
operator|->
name|nd_na_target
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", tgt is %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|p
operator|->
name|nd_na_target
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", Flags [%s]"
operator|,
name|bittok2str
argument_list|(
name|icmp6_nd_na_flag_values
argument_list|,
literal|"none"
argument_list|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|p
operator|->
name|nd_na_flags_reserved
argument_list|)
argument_list|)
operator|)
argument_list|)
expr_stmt|;
define|#
directive|define
name|NDADVLEN
value|24
name|icmp6_opt_print
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|dp
operator|+
name|NDADVLEN
argument_list|,
name|length
operator|-
name|NDADVLEN
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|NDADVLEN
block|}
block|}
break|break;
case|case
name|ND_REDIRECT
case|:
define|#
directive|define
name|RDR
parameter_list|(
name|i
parameter_list|)
value|((struct nd_redirect *)(i))
name|ND_TCHECK
argument_list|(
name|RDR
argument_list|(
name|dp
argument_list|)
operator|->
name|nd_rd_dst
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", %s"
operator|,
name|getname6
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
operator|&
name|RDR
argument_list|(
name|dp
argument_list|)
operator|->
name|nd_rd_dst
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|RDR
argument_list|(
name|dp
argument_list|)
operator|->
name|nd_rd_target
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" to %s"
operator|,
name|getname6
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
operator|&
name|RDR
argument_list|(
name|dp
argument_list|)
operator|->
name|nd_rd_target
argument_list|)
operator|)
argument_list|)
expr_stmt|;
define|#
directive|define
name|REDIRECTLEN
value|40
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|icmp6_opt_print
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|dp
operator|+
name|REDIRECTLEN
argument_list|,
name|length
operator|-
name|REDIRECTLEN
argument_list|)
expr_stmt|;
block|}
break|break;
undef|#
directive|undef
name|REDIRECTLEN
undef|#
directive|undef
name|RDR
case|case
name|ICMP6_ROUTER_RENUMBERING
case|:
name|icmp6_rrenum_print
argument_list|(
name|ndo
argument_list|,
name|bp
argument_list|,
name|ep
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_NI_QUERY
case|:
case|case
name|ICMP6_NI_REPLY
case|:
name|icmp6_nodeinfo_print
argument_list|(
name|ndo
argument_list|,
name|length
argument_list|,
name|bp
argument_list|,
name|ep
argument_list|)
expr_stmt|;
break|break;
case|case
name|IND_SOLICIT
case|:
case|case
name|IND_ADVERT
case|:
break|break;
case|case
name|ICMP6_V2_MEMBERSHIP_REPORT
case|:
name|mldv2_report_print
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|dp
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_MOBILEPREFIX_SOLICIT
case|:
comment|/* fall through */
case|case
name|ICMP6_HADISCOV_REQUEST
case|:
name|ND_TCHECK
argument_list|(
name|dp
operator|->
name|icmp6_data16
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", id 0x%04x"
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|dp
operator|->
name|icmp6_data16
index|[
literal|0
index|]
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_HADISCOV_REPLY
case|:
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|struct
name|in6_addr
modifier|*
name|in6
decl_stmt|;
name|u_char
modifier|*
name|cp
decl_stmt|;
name|ND_TCHECK
argument_list|(
name|dp
operator|->
name|icmp6_data16
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", id 0x%04x"
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|dp
operator|->
name|icmp6_data16
index|[
literal|0
index|]
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cp
operator|=
operator|(
name|u_char
operator|*
operator|)
name|dp
operator|+
name|length
expr_stmt|;
name|in6
operator|=
operator|(
expr|struct
name|in6_addr
operator|*
operator|)
operator|(
name|dp
operator|+
literal|1
operator|)
expr_stmt|;
for|for
control|(
init|;
operator|(
name|u_char
operator|*
operator|)
name|in6
operator|<
name|cp
condition|;
name|in6
operator|++
control|)
block|{
name|ND_TCHECK
argument_list|(
operator|*
name|in6
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|in6
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|ICMP6_MOBILEPREFIX_ADVERT
case|:
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|ND_TCHECK
argument_list|(
name|dp
operator|->
name|icmp6_data16
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", id 0x%04x"
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|dp
operator|->
name|icmp6_data16
index|[
literal|0
index|]
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|dp
operator|->
name|icmp6_data16
index|[
literal|1
index|]
operator|&
literal|0xc0
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" "
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|dp
operator|->
name|icmp6_data16
index|[
literal|1
index|]
operator|&
literal|0x80
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"M"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|dp
operator|->
name|icmp6_data16
index|[
literal|1
index|]
operator|&
literal|0x40
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"O"
operator|)
argument_list|)
expr_stmt|;
define|#
directive|define
name|MPADVLEN
value|8
name|icmp6_opt_print
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|dp
operator|+
name|MPADVLEN
argument_list|,
name|length
operator|-
name|MPADVLEN
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ND_RPL_MESSAGE
case|:
comment|/* plus 4, because struct icmp6_hdr contains 4 bytes of icmp payload */
name|rpl_print
argument_list|(
name|ndo
argument_list|,
name|dp
argument_list|,
operator|&
name|dp
operator|->
name|icmp6_data8
index|[
literal|0
index|]
argument_list|,
name|length
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|icmp6_hdr
argument_list|)
operator|+
literal|4
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", length %u"
operator|,
name|length
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|<=
literal|1
condition|)
name|print_unknown_data
argument_list|(
name|ndo
argument_list|,
name|bp
argument_list|,
literal|"\n\t"
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|ndo
operator|->
name|ndo_vflag
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", length %u"
operator|,
name|length
operator|)
argument_list|)
expr_stmt|;
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"[|icmp6]"
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|struct
name|udphdr
modifier|*
name|get_upperlayer
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
name|u_int
modifier|*
name|prot
parameter_list|)
block|{
specifier|const
name|u_char
modifier|*
name|ep
decl_stmt|;
specifier|const
name|struct
name|ip6_hdr
modifier|*
name|ip6
init|=
operator|(
expr|struct
name|ip6_hdr
operator|*
operator|)
name|bp
decl_stmt|;
specifier|const
name|struct
name|udphdr
modifier|*
name|uh
decl_stmt|;
specifier|const
name|struct
name|ip6_hbh
modifier|*
name|hbh
decl_stmt|;
specifier|const
name|struct
name|ip6_frag
modifier|*
name|fragh
decl_stmt|;
specifier|const
name|struct
name|ah
modifier|*
name|ah
decl_stmt|;
name|u_int
name|nh
decl_stmt|;
name|int
name|hlen
decl_stmt|;
comment|/* 'ep' points to the end of available data. */
name|ep
operator|=
name|ndo
operator|->
name|ndo_snapend
expr_stmt|;
if|if
condition|(
operator|!
name|ND_TTEST
argument_list|(
name|ip6
operator|->
name|ip6_nxt
argument_list|)
condition|)
return|return
name|NULL
return|;
name|nh
operator|=
name|ip6
operator|->
name|ip6_nxt
expr_stmt|;
name|hlen
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ip6_hdr
argument_list|)
expr_stmt|;
while|while
condition|(
name|bp
operator|<
name|ep
condition|)
block|{
name|bp
operator|+=
name|hlen
expr_stmt|;
switch|switch
condition|(
name|nh
condition|)
block|{
case|case
name|IPPROTO_UDP
case|:
case|case
name|IPPROTO_TCP
case|:
name|uh
operator|=
operator|(
expr|struct
name|udphdr
operator|*
operator|)
name|bp
expr_stmt|;
if|if
condition|(
name|ND_TTEST
argument_list|(
name|uh
operator|->
name|uh_dport
argument_list|)
condition|)
block|{
operator|*
name|prot
operator|=
name|nh
expr_stmt|;
return|return
operator|(
name|uh
operator|)
return|;
block|}
else|else
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* NOTREACHED */
case|case
name|IPPROTO_HOPOPTS
case|:
case|case
name|IPPROTO_DSTOPTS
case|:
case|case
name|IPPROTO_ROUTING
case|:
name|hbh
operator|=
operator|(
expr|struct
name|ip6_hbh
operator|*
operator|)
name|bp
expr_stmt|;
if|if
condition|(
operator|!
name|ND_TTEST
argument_list|(
name|hbh
operator|->
name|ip6h_len
argument_list|)
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|nh
operator|=
name|hbh
operator|->
name|ip6h_nxt
expr_stmt|;
name|hlen
operator|=
operator|(
name|hbh
operator|->
name|ip6h_len
operator|+
literal|1
operator|)
operator|<<
literal|3
expr_stmt|;
break|break;
case|case
name|IPPROTO_FRAGMENT
case|:
comment|/* this should be odd, but try anyway */
name|fragh
operator|=
operator|(
expr|struct
name|ip6_frag
operator|*
operator|)
name|bp
expr_stmt|;
if|if
condition|(
operator|!
name|ND_TTEST
argument_list|(
name|fragh
operator|->
name|ip6f_offlg
argument_list|)
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* fragments with non-zero offset are meaningless */
if|if
condition|(
operator|(
name|EXTRACT_16BITS
argument_list|(
operator|&
name|fragh
operator|->
name|ip6f_offlg
argument_list|)
operator|&
name|IP6F_OFF_MASK
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|nh
operator|=
name|fragh
operator|->
name|ip6f_nxt
expr_stmt|;
name|hlen
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ip6_frag
argument_list|)
expr_stmt|;
break|break;
case|case
name|IPPROTO_AH
case|:
name|ah
operator|=
operator|(
expr|struct
name|ah
operator|*
operator|)
name|bp
expr_stmt|;
if|if
condition|(
operator|!
name|ND_TTEST
argument_list|(
name|ah
operator|->
name|ah_len
argument_list|)
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|nh
operator|=
name|ah
operator|->
name|ah_nxt
expr_stmt|;
name|hlen
operator|=
operator|(
name|ah
operator|->
name|ah_len
operator|+
literal|2
operator|)
operator|<<
literal|2
expr_stmt|;
break|break;
default|default:
comment|/* unknown or undecodable header */
operator|*
name|prot
operator|=
name|nh
expr_stmt|;
comment|/* meaningless, but set here anyway */
return|return
operator|(
name|NULL
operator|)
return|;
block|}
block|}
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* should be notreached, though */
block|}
end_function

begin_function
specifier|static
name|void
name|icmp6_opt_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
name|int
name|resid
parameter_list|)
block|{
specifier|const
name|struct
name|nd_opt_hdr
modifier|*
name|op
decl_stmt|;
specifier|const
name|struct
name|nd_opt_prefix_info
modifier|*
name|opp
decl_stmt|;
specifier|const
name|struct
name|nd_opt_mtu
modifier|*
name|opm
decl_stmt|;
specifier|const
name|struct
name|nd_opt_rdnss
modifier|*
name|oprd
decl_stmt|;
specifier|const
name|struct
name|nd_opt_dnssl
modifier|*
name|opds
decl_stmt|;
specifier|const
name|struct
name|nd_opt_advinterval
modifier|*
name|opa
decl_stmt|;
specifier|const
name|struct
name|nd_opt_homeagent_info
modifier|*
name|oph
decl_stmt|;
specifier|const
name|struct
name|nd_opt_route_info
modifier|*
name|opri
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|cp
decl_stmt|,
modifier|*
name|ep
decl_stmt|,
modifier|*
name|domp
decl_stmt|;
name|struct
name|in6_addr
name|in6
decl_stmt|,
modifier|*
name|in6p
decl_stmt|;
name|size_t
name|l
decl_stmt|;
name|u_int
name|i
decl_stmt|;
define|#
directive|define
name|ECHECK
parameter_list|(
name|var
parameter_list|)
value|if ((u_char *)&(var)> ep - sizeof(var)) return
name|cp
operator|=
name|bp
expr_stmt|;
comment|/* 'ep' points to the end of available data. */
name|ep
operator|=
name|ndo
operator|->
name|ndo_snapend
expr_stmt|;
while|while
condition|(
name|cp
operator|<
name|ep
condition|)
block|{
name|op
operator|=
operator|(
expr|struct
name|nd_opt_hdr
operator|*
operator|)
name|cp
expr_stmt|;
name|ECHECK
argument_list|(
name|op
operator|->
name|nd_opt_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|resid
operator|<=
literal|0
condition|)
return|return;
if|if
condition|(
name|op
operator|->
name|nd_opt_len
operator|==
literal|0
condition|)
goto|goto
name|trunc
goto|;
if|if
condition|(
name|cp
operator|+
operator|(
name|op
operator|->
name|nd_opt_len
operator|<<
literal|3
operator|)
operator|>
name|ep
condition|)
goto|goto
name|trunc
goto|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  %s option (%u), length %u (%u): "
operator|,
name|tok2str
argument_list|(
name|icmp6_opt_values
argument_list|,
literal|"unknown"
argument_list|,
name|op
operator|->
name|nd_opt_type
argument_list|)
operator|,
name|op
operator|->
name|nd_opt_type
operator|,
name|op
operator|->
name|nd_opt_len
operator|<<
literal|3
operator|,
name|op
operator|->
name|nd_opt_len
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|op
operator|->
name|nd_opt_type
condition|)
block|{
case|case
name|ND_OPT_SOURCE_LINKADDR
case|:
name|l
operator|=
operator|(
name|op
operator|->
name|nd_opt_len
operator|<<
literal|3
operator|)
operator|-
literal|2
expr_stmt|;
name|print_lladdr
argument_list|(
name|ndo
argument_list|,
name|cp
operator|+
literal|2
argument_list|,
name|l
argument_list|)
expr_stmt|;
break|break;
case|case
name|ND_OPT_TARGET_LINKADDR
case|:
name|l
operator|=
operator|(
name|op
operator|->
name|nd_opt_len
operator|<<
literal|3
operator|)
operator|-
literal|2
expr_stmt|;
name|print_lladdr
argument_list|(
name|ndo
argument_list|,
name|cp
operator|+
literal|2
argument_list|,
name|l
argument_list|)
expr_stmt|;
break|break;
case|case
name|ND_OPT_PREFIX_INFORMATION
case|:
name|opp
operator|=
operator|(
expr|struct
name|nd_opt_prefix_info
operator|*
operator|)
name|op
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|opp
operator|->
name|nd_opt_pi_prefix
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s/%u%s, Flags [%s], valid time %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|opp
operator|->
name|nd_opt_pi_prefix
argument_list|)
operator|,
name|opp
operator|->
name|nd_opt_pi_prefix_len
operator|,
operator|(
name|op
operator|->
name|nd_opt_len
operator|!=
literal|4
operator|)
condition|?
literal|"badlen"
else|:
literal|""
operator|,
name|bittok2str
argument_list|(
name|icmp6_opt_pi_flag_values
argument_list|,
literal|"none"
argument_list|,
name|opp
operator|->
name|nd_opt_pi_flags_reserved
argument_list|)
operator|,
name|get_lifetime
argument_list|(
name|EXTRACT_32BITS
argument_list|(
operator|&
name|opp
operator|->
name|nd_opt_pi_valid_time
argument_list|)
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", pref. time %s"
operator|,
name|get_lifetime
argument_list|(
name|EXTRACT_32BITS
argument_list|(
operator|&
name|opp
operator|->
name|nd_opt_pi_preferred_time
argument_list|)
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ND_OPT_REDIRECTED_HEADER
case|:
name|print_unknown_data
argument_list|(
name|ndo
argument_list|,
name|bp
argument_list|,
literal|"\n\t    "
argument_list|,
name|op
operator|->
name|nd_opt_len
operator|<<
literal|3
argument_list|)
expr_stmt|;
comment|/* xxx */
break|break;
case|case
name|ND_OPT_MTU
case|:
name|opm
operator|=
operator|(
expr|struct
name|nd_opt_mtu
operator|*
operator|)
name|op
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|opm
operator|->
name|nd_opt_mtu_mtu
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" %u%s"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|opm
operator|->
name|nd_opt_mtu_mtu
argument_list|)
operator|,
operator|(
name|op
operator|->
name|nd_opt_len
operator|!=
literal|1
operator|)
condition|?
literal|"bad option length"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ND_OPT_RDNSS
case|:
name|oprd
operator|=
operator|(
expr|struct
name|nd_opt_rdnss
operator|*
operator|)
name|op
expr_stmt|;
name|l
operator|=
operator|(
name|op
operator|->
name|nd_opt_len
operator|-
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" lifetime %us,"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|oprd
operator|->
name|nd_opt_rdnss_lifetime
argument_list|)
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|l
condition|;
name|i
operator|++
control|)
block|{
name|ND_TCHECK
argument_list|(
name|oprd
operator|->
name|nd_opt_rdnss_addr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" addr: %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|oprd
operator|->
name|nd_opt_rdnss_addr
index|[
name|i
index|]
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ND_OPT_DNSSL
case|:
name|opds
operator|=
operator|(
expr|struct
name|nd_opt_dnssl
operator|*
operator|)
name|op
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" lifetime %us, domain(s):"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|opds
operator|->
name|nd_opt_dnssl_lifetime
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|domp
operator|=
name|cp
operator|+
literal|8
expr_stmt|;
comment|/* domain names, variable-sized, RFC1035-encoded */
while|while
condition|(
name|domp
operator|<
name|cp
operator|+
operator|(
name|op
operator|->
name|nd_opt_len
operator|<<
literal|3
operator|)
operator|&&
operator|*
name|domp
operator|!=
literal|'\0'
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" "
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|domp
operator|=
name|ns_nprint
argument_list|(
name|ndo
argument_list|,
name|domp
argument_list|,
name|bp
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|trunc
goto|;
block|}
break|break;
case|case
name|ND_OPT_ADVINTERVAL
case|:
name|opa
operator|=
operator|(
expr|struct
name|nd_opt_advinterval
operator|*
operator|)
name|op
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|opa
operator|->
name|nd_opt_adv_interval
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" %ums"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|opa
operator|->
name|nd_opt_adv_interval
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ND_OPT_HOMEAGENT_INFO
case|:
name|oph
operator|=
operator|(
expr|struct
name|nd_opt_homeagent_info
operator|*
operator|)
name|op
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|oph
operator|->
name|nd_opt_hai_lifetime
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" preference %u, lifetime %u"
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|oph
operator|->
name|nd_opt_hai_preference
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|oph
operator|->
name|nd_opt_hai_lifetime
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ND_OPT_ROUTE_INFO
case|:
name|opri
operator|=
operator|(
expr|struct
name|nd_opt_route_info
operator|*
operator|)
name|op
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|opri
operator|->
name|nd_opt_rti_lifetime
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|in6
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|in6
argument_list|)
argument_list|)
expr_stmt|;
name|in6p
operator|=
operator|(
expr|struct
name|in6_addr
operator|*
operator|)
operator|(
name|opri
operator|+
literal|1
operator|)
expr_stmt|;
switch|switch
condition|(
name|op
operator|->
name|nd_opt_len
condition|)
block|{
case|case
literal|1
case|:
break|break;
case|case
literal|2
case|:
name|ND_TCHECK2
argument_list|(
operator|*
name|in6p
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|in6
argument_list|,
name|opri
operator|+
literal|1
argument_list|,
literal|8
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|ND_TCHECK
argument_list|(
operator|*
name|in6p
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|in6
argument_list|,
name|opri
operator|+
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|in6
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
goto|goto
name|trunc
goto|;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" %s/%u"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|in6
argument_list|)
operator|,
name|opri
operator|->
name|nd_opt_rti_prefixlen
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", pref=%s"
operator|,
name|get_rtpref
argument_list|(
name|opri
operator|->
name|nd_opt_rti_flags
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", lifetime=%s"
operator|,
name|get_lifetime
argument_list|(
name|EXTRACT_32BITS
argument_list|(
operator|&
name|opri
operator|->
name|nd_opt_rti_lifetime
argument_list|)
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|<=
literal|1
condition|)
block|{
name|print_unknown_data
argument_list|(
name|ndo
argument_list|,
name|cp
operator|+
literal|2
argument_list|,
literal|"\n\t  "
argument_list|,
operator|(
name|op
operator|->
name|nd_opt_len
operator|<<
literal|3
operator|)
operator|-
literal|2
argument_list|)
expr_stmt|;
comment|/* skip option header */
return|return;
block|}
break|break;
block|}
comment|/* do we want to see an additional hexdump ? */
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|1
condition|)
name|print_unknown_data
argument_list|(
name|ndo
argument_list|,
name|cp
operator|+
literal|2
argument_list|,
literal|"\n\t    "
argument_list|,
operator|(
name|op
operator|->
name|nd_opt_len
operator|<<
literal|3
operator|)
operator|-
literal|2
argument_list|)
expr_stmt|;
comment|/* skip option header */
name|cp
operator|+=
name|op
operator|->
name|nd_opt_len
operator|<<
literal|3
expr_stmt|;
name|resid
operator|-=
name|op
operator|->
name|nd_opt_len
operator|<<
literal|3
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"[ndp opt]"
operator|)
argument_list|)
expr_stmt|;
return|return;
undef|#
directive|undef
name|ECHECK
block|}
end_function

begin_function
specifier|static
name|void
name|mld6_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|)
block|{
specifier|const
name|struct
name|mld6_hdr
modifier|*
name|mp
init|=
operator|(
expr|struct
name|mld6_hdr
operator|*
operator|)
name|bp
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|ep
decl_stmt|;
comment|/* 'ep' points to the end of available data. */
name|ep
operator|=
name|ndo
operator|->
name|ndo_snapend
expr_stmt|;
if|if
condition|(
operator|(
name|u_char
operator|*
operator|)
name|mp
operator|+
sizeof|sizeof
argument_list|(
operator|*
name|mp
argument_list|)
operator|>
name|ep
condition|)
return|return;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"max resp delay: %d "
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|mp
operator|->
name|mld6_maxdelay
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"addr: %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|mp
operator|->
name|mld6_addr
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|mldv2_report_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
name|u_int
name|len
parameter_list|)
block|{
name|struct
name|icmp6_hdr
modifier|*
name|icp
init|=
operator|(
expr|struct
name|icmp6_hdr
operator|*
operator|)
name|bp
decl_stmt|;
name|u_int
name|group
decl_stmt|,
name|nsrcs
decl_stmt|,
name|ngroups
decl_stmt|;
name|u_int
name|i
decl_stmt|,
name|j
decl_stmt|;
comment|/* Minimum len is 8 */
if|if
condition|(
name|len
operator|<
literal|8
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [invalid len %d]"
operator|,
name|len
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|ND_TCHECK
argument_list|(
name|icp
operator|->
name|icmp6_data16
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|ngroups
operator|=
name|EXTRACT_16BITS
argument_list|(
operator|&
name|icp
operator|->
name|icmp6_data16
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", %d group record(s)"
operator|,
name|ngroups
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|0
condition|)
block|{
comment|/* Print the group records */
name|group
operator|=
literal|8
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ngroups
condition|;
name|i
operator|++
control|)
block|{
comment|/* type(1) + auxlen(1) + numsrc(2) + grp(16) */
if|if
condition|(
name|len
operator|<
name|group
operator|+
literal|20
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [invalid number of groups]"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|ND_TCHECK2
argument_list|(
name|bp
index|[
name|group
operator|+
literal|4
index|]
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [gaddr %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|bp
index|[
name|group
operator|+
literal|4
index|]
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" %s"
operator|,
name|tok2str
argument_list|(
name|mldv2report2str
argument_list|,
literal|" [v2-report-#%d]"
argument_list|,
name|bp
index|[
name|group
index|]
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|nsrcs
operator|=
operator|(
name|bp
index|[
name|group
operator|+
literal|2
index|]
operator|<<
literal|8
operator|)
operator|+
name|bp
index|[
name|group
operator|+
literal|3
index|]
expr_stmt|;
comment|/* Check the number of sources and print them */
if|if
condition|(
name|len
operator|<
name|group
operator|+
literal|20
operator|+
operator|(
name|nsrcs
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
operator|)
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [invalid number of sources %d]"
operator|,
name|nsrcs
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|==
literal|1
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", %d source(s)"
operator|,
name|nsrcs
operator|)
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* Print the sources */
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" {"
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|nsrcs
condition|;
name|j
operator|++
control|)
block|{
name|ND_TCHECK2
argument_list|(
name|bp
index|[
name|group
operator|+
literal|20
operator|+
name|j
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
index|]
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|bp
index|[
name|group
operator|+
literal|20
operator|+
name|j
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
index|]
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" }"
operator|)
argument_list|)
expr_stmt|;
block|}
comment|/* Next group record */
name|group
operator|+=
literal|20
operator|+
name|nsrcs
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"]"
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"[|icmp6]"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|mldv2_query_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
name|u_int
name|len
parameter_list|)
block|{
name|struct
name|icmp6_hdr
modifier|*
name|icp
init|=
operator|(
expr|struct
name|icmp6_hdr
operator|*
operator|)
name|bp
decl_stmt|;
name|u_int
name|mrc
decl_stmt|;
name|int
name|mrt
decl_stmt|,
name|qqi
decl_stmt|;
name|u_int
name|nsrcs
decl_stmt|;
specifier|register
name|u_int
name|i
decl_stmt|;
comment|/* Minimum len is 28 */
if|if
condition|(
name|len
operator|<
literal|28
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [invalid len %d]"
operator|,
name|len
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|ND_TCHECK
argument_list|(
name|icp
operator|->
name|icmp6_data16
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|mrc
operator|=
name|EXTRACT_16BITS
argument_list|(
operator|&
name|icp
operator|->
name|icmp6_data16
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|mrc
operator|<
literal|32768
condition|)
block|{
name|mrt
operator|=
name|mrc
expr_stmt|;
block|}
else|else
block|{
name|mrt
operator|=
operator|(
operator|(
name|mrc
operator|&
literal|0x0fff
operator|)
operator||
literal|0x1000
operator|)
operator|<<
operator|(
operator|(
operator|(
name|mrc
operator|&
literal|0x7000
operator|)
operator|>>
literal|12
operator|)
operator|+
literal|3
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [max resp delay=%d]"
operator|,
name|mrt
operator|)
argument_list|)
expr_stmt|;
block|}
name|ND_TCHECK2
argument_list|(
name|bp
index|[
literal|8
index|]
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [gaddr %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|bp
index|[
literal|8
index|]
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|ND_TCHECK
argument_list|(
name|bp
index|[
literal|25
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|bp
index|[
literal|24
index|]
operator|&
literal|0x08
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" sflag"
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bp
index|[
literal|24
index|]
operator|&
literal|0x07
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" robustness=%d"
operator|,
name|bp
index|[
literal|24
index|]
operator|&
literal|0x07
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bp
index|[
literal|25
index|]
operator|<
literal|128
condition|)
block|{
name|qqi
operator|=
name|bp
index|[
literal|25
index|]
expr_stmt|;
block|}
else|else
block|{
name|qqi
operator|=
operator|(
operator|(
name|bp
index|[
literal|25
index|]
operator|&
literal|0x0f
operator|)
operator||
literal|0x10
operator|)
operator|<<
operator|(
operator|(
operator|(
name|bp
index|[
literal|25
index|]
operator|&
literal|0x70
operator|)
operator|>>
literal|4
operator|)
operator|+
literal|3
operator|)
expr_stmt|;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" qqi=%d"
operator|,
name|qqi
operator|)
argument_list|)
expr_stmt|;
block|}
name|ND_TCHECK2
argument_list|(
name|bp
index|[
literal|26
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|nsrcs
operator|=
name|EXTRACT_16BITS
argument_list|(
operator|&
name|bp
index|[
literal|26
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|nsrcs
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|len
operator|<
literal|28
operator|+
name|nsrcs
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [invalid number of sources]"
operator|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|1
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" {"
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nsrcs
condition|;
name|i
operator|++
control|)
block|{
name|ND_TCHECK2
argument_list|(
name|bp
index|[
literal|28
operator|+
name|i
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
index|]
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
operator|&
name|bp
index|[
literal|28
operator|+
name|i
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
index|]
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" }"
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", %d source(s)"
operator|,
name|nsrcs
operator|)
argument_list|)
expr_stmt|;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"]"
operator|)
argument_list|)
expr_stmt|;
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"[|icmp6]"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|dnsname_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|cp
parameter_list|,
specifier|const
name|u_char
modifier|*
name|ep
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
comment|/* DNS name decoding - no decompression */
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", \""
operator|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|cp
operator|<
name|ep
condition|)
block|{
name|i
operator|=
operator|*
name|cp
operator|++
expr_stmt|;
if|if
condition|(
name|i
condition|)
block|{
if|if
condition|(
name|i
operator|>
name|ep
operator|-
name|cp
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"???"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
while|while
condition|(
name|i
operator|--
operator|&&
name|cp
operator|<
name|ep
condition|)
block|{
name|safeputchar
argument_list|(
name|ndo
argument_list|,
operator|*
name|cp
argument_list|)
expr_stmt|;
name|cp
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|cp
operator|+
literal|1
operator|<
name|ep
operator|&&
operator|*
name|cp
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"."
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|cp
operator|==
name|ep
condition|)
block|{
comment|/* FQDN */
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"."
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|cp
operator|+
literal|1
operator|==
name|ep
operator|&&
operator|*
name|cp
operator|==
literal|'\0'
condition|)
block|{
comment|/* truncated */
block|}
else|else
block|{
comment|/* invalid */
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"???"
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\""
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|icmp6_nodeinfo_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
name|u_int
name|icmp6len
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
specifier|const
name|u_char
modifier|*
name|ep
parameter_list|)
block|{
specifier|const
name|struct
name|icmp6_nodeinfo
modifier|*
name|ni6
decl_stmt|;
specifier|const
name|struct
name|icmp6_hdr
modifier|*
name|dp
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|cp
decl_stmt|;
name|size_t
name|siz
decl_stmt|,
name|i
decl_stmt|;
name|int
name|needcomma
decl_stmt|;
if|if
condition|(
name|ep
operator|<
name|bp
condition|)
return|return;
name|dp
operator|=
operator|(
expr|struct
name|icmp6_hdr
operator|*
operator|)
name|bp
expr_stmt|;
name|ni6
operator|=
operator|(
expr|struct
name|icmp6_nodeinfo
operator|*
operator|)
name|bp
expr_stmt|;
name|siz
operator|=
name|ep
operator|-
name|bp
expr_stmt|;
switch|switch
condition|(
name|ni6
operator|->
name|ni_type
condition|)
block|{
case|case
name|ICMP6_NI_QUERY
case|:
if|if
condition|(
name|siz
operator|==
sizeof|sizeof
argument_list|(
operator|*
name|dp
argument_list|)
operator|+
literal|4
condition|)
block|{
comment|/* KAME who-are-you */
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" who-are-you request"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" node information query"
operator|)
argument_list|)
expr_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|dp
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|ni6
argument_list|)
argument_list|)
expr_stmt|;
name|ni6
operator|=
operator|(
expr|struct
name|icmp6_nodeinfo
operator|*
operator|)
name|dp
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" ("
operator|)
argument_list|)
expr_stmt|;
comment|/*)*/
switch|switch
condition|(
name|EXTRACT_16BITS
argument_list|(
operator|&
name|ni6
operator|->
name|ni_qtype
argument_list|)
condition|)
block|{
case|case
name|NI_QTYPE_NOOP
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"noop"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|NI_QTYPE_SUPTYPES
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"supported qtypes"
operator|)
argument_list|)
expr_stmt|;
name|i
operator|=
name|EXTRACT_16BITS
argument_list|(
operator|&
name|ni6
operator|->
name|ni_flags
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [%s]"
operator|,
operator|(
name|i
operator|&
literal|0x01
operator|)
condition|?
literal|"C"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|NI_QTYPE_FQDN
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"DNS name"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|NI_QTYPE_NODEADDR
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"node addresses"
operator|)
argument_list|)
expr_stmt|;
name|i
operator|=
name|ni6
operator|->
name|ni_flags
expr_stmt|;
if|if
condition|(
operator|!
name|i
condition|)
break|break;
comment|/* NI_NODEADDR_FLAG_TRUNCATE undefined for query */
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [%s%s%s%s%s%s]"
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_ANYCAST
operator|)
condition|?
literal|"a"
else|:
literal|""
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_GLOBAL
operator|)
condition|?
literal|"G"
else|:
literal|""
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_SITELOCAL
operator|)
condition|?
literal|"S"
else|:
literal|""
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_LINKLOCAL
operator|)
condition|?
literal|"L"
else|:
literal|""
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_COMPAT
operator|)
condition|?
literal|"C"
else|:
literal|""
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_ALL
operator|)
condition|?
literal|"A"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"unknown"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|ni6
operator|->
name|ni_qtype
operator|==
name|NI_QTYPE_NOOP
operator|||
name|ni6
operator|->
name|ni_qtype
operator|==
name|NI_QTYPE_SUPTYPES
condition|)
block|{
if|if
condition|(
name|siz
operator|!=
sizeof|sizeof
argument_list|(
operator|*
name|ni6
argument_list|)
condition|)
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", invalid len"
operator|)
argument_list|)
expr_stmt|;
comment|/*(*/
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|")"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* XXX backward compat, icmp-name-lookup-03 */
if|if
condition|(
name|siz
operator|==
sizeof|sizeof
argument_list|(
operator|*
name|ni6
argument_list|)
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", 03 draft"
operator|)
argument_list|)
expr_stmt|;
comment|/*(*/
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|")"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|ni6
operator|->
name|ni_code
condition|)
block|{
case|case
name|ICMP6_NI_SUBJ_IPV6
case|:
if|if
condition|(
operator|!
name|ND_TTEST2
argument_list|(
operator|*
name|dp
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|ni6
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
argument_list|)
condition|)
break|break;
if|if
condition|(
name|siz
operator|!=
sizeof|sizeof
argument_list|(
operator|*
name|ni6
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
condition|)
block|{
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", invalid subject len"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", subject=%s"
operator|,
name|getname6
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
operator|(
name|ni6
operator|+
literal|1
operator|)
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_NI_SUBJ_FQDN
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", subject=DNS name"
operator|)
argument_list|)
expr_stmt|;
name|cp
operator|=
operator|(
specifier|const
name|u_char
operator|*
operator|)
operator|(
name|ni6
operator|+
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|cp
index|[
literal|0
index|]
operator|==
name|ep
operator|-
name|cp
operator|-
literal|1
condition|)
block|{
comment|/* icmp-name-lookup-03, pascal string */
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", 03 draft"
operator|)
argument_list|)
expr_stmt|;
name|cp
operator|++
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", \""
operator|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|cp
operator|<
name|ep
condition|)
block|{
name|safeputchar
argument_list|(
name|ndo
argument_list|,
operator|*
name|cp
argument_list|)
expr_stmt|;
name|cp
operator|++
expr_stmt|;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\""
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
name|dnsname_print
argument_list|(
name|ndo
argument_list|,
name|cp
argument_list|,
name|ep
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_NI_SUBJ_IPV4
case|:
if|if
condition|(
operator|!
name|ND_TTEST2
argument_list|(
operator|*
name|dp
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|ni6
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
argument_list|)
condition|)
break|break;
if|if
condition|(
name|siz
operator|!=
sizeof|sizeof
argument_list|(
operator|*
name|ni6
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
condition|)
block|{
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", invalid subject len"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", subject=%s"
operator|,
name|getname
argument_list|(
name|ndo
argument_list|,
operator|(
specifier|const
name|u_char
operator|*
operator|)
operator|(
name|ni6
operator|+
literal|1
operator|)
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", unknown subject"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/*(*/
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|")"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_NI_REPLY
case|:
if|if
condition|(
name|icmp6len
operator|>
name|siz
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"[|icmp6: node information reply]"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|needcomma
operator|=
literal|0
expr_stmt|;
name|ni6
operator|=
operator|(
expr|struct
name|icmp6_nodeinfo
operator|*
operator|)
name|dp
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" node information reply"
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" ("
operator|)
argument_list|)
expr_stmt|;
comment|/*)*/
switch|switch
condition|(
name|ni6
operator|->
name|ni_code
condition|)
block|{
case|case
name|ICMP6_NI_SUCCESS
case|:
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"success"
operator|)
argument_list|)
expr_stmt|;
name|needcomma
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|ICMP6_NI_REFUSED
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"refused"
operator|)
argument_list|)
expr_stmt|;
name|needcomma
operator|++
expr_stmt|;
if|if
condition|(
name|siz
operator|!=
sizeof|sizeof
argument_list|(
operator|*
name|ni6
argument_list|)
condition|)
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", invalid length"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_NI_UNKNOWN
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"unknown"
operator|)
argument_list|)
expr_stmt|;
name|needcomma
operator|++
expr_stmt|;
if|if
condition|(
name|siz
operator|!=
sizeof|sizeof
argument_list|(
operator|*
name|ni6
argument_list|)
condition|)
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", invalid length"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|ni6
operator|->
name|ni_code
operator|!=
name|ICMP6_NI_SUCCESS
condition|)
block|{
comment|/*(*/
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|")"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|EXTRACT_16BITS
argument_list|(
operator|&
name|ni6
operator|->
name|ni_qtype
argument_list|)
condition|)
block|{
case|case
name|NI_QTYPE_NOOP
case|:
if|if
condition|(
name|needcomma
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", "
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"noop"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|siz
operator|!=
sizeof|sizeof
argument_list|(
operator|*
name|ni6
argument_list|)
condition|)
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", invalid length"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|NI_QTYPE_SUPTYPES
case|:
if|if
condition|(
name|needcomma
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", "
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"supported qtypes"
operator|)
argument_list|)
expr_stmt|;
name|i
operator|=
name|EXTRACT_16BITS
argument_list|(
operator|&
name|ni6
operator|->
name|ni_flags
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [%s]"
operator|,
operator|(
name|i
operator|&
literal|0x01
operator|)
condition|?
literal|"C"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|NI_QTYPE_FQDN
case|:
if|if
condition|(
name|needcomma
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", "
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"DNS name"
operator|)
argument_list|)
expr_stmt|;
name|cp
operator|=
operator|(
specifier|const
name|u_char
operator|*
operator|)
operator|(
name|ni6
operator|+
literal|1
operator|)
operator|+
literal|4
expr_stmt|;
if|if
condition|(
name|cp
index|[
literal|0
index|]
operator|==
name|ep
operator|-
name|cp
operator|-
literal|1
condition|)
block|{
comment|/* icmp-name-lookup-03, pascal string */
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", 03 draft"
operator|)
argument_list|)
expr_stmt|;
name|cp
operator|++
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", \""
operator|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|cp
operator|<
name|ep
condition|)
block|{
name|safeputchar
argument_list|(
name|ndo
argument_list|,
operator|*
name|cp
argument_list|)
expr_stmt|;
name|cp
operator|++
expr_stmt|;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\""
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
name|dnsname_print
argument_list|(
name|ndo
argument_list|,
name|cp
argument_list|,
name|ep
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|EXTRACT_16BITS
argument_list|(
operator|&
name|ni6
operator|->
name|ni_flags
argument_list|)
operator|&
literal|0x01
operator|)
operator|!=
literal|0
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [TTL=%u]"
operator|,
operator|*
operator|(
name|uint32_t
operator|*
operator|)
operator|(
name|ni6
operator|+
literal|1
operator|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|NI_QTYPE_NODEADDR
case|:
if|if
condition|(
name|needcomma
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", "
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"node addresses"
operator|)
argument_list|)
expr_stmt|;
name|i
operator|=
sizeof|sizeof
argument_list|(
operator|*
name|ni6
argument_list|)
expr_stmt|;
while|while
condition|(
name|i
operator|<
name|siz
condition|)
block|{
if|if
condition|(
name|i
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|int32_t
argument_list|)
operator|>
name|siz
condition|)
break|break;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" %s"
operator|,
name|getname6
argument_list|(
name|ndo
argument_list|,
name|bp
operator|+
name|i
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|i
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|in6_addr
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"(%d)"
operator|,
operator|(
name|int32_t
operator|)
name|EXTRACT_32BITS
argument_list|(
name|bp
operator|+
name|i
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|i
operator|+=
sizeof|sizeof
argument_list|(
name|int32_t
argument_list|)
expr_stmt|;
block|}
name|i
operator|=
name|ni6
operator|->
name|ni_flags
expr_stmt|;
if|if
condition|(
operator|!
name|i
condition|)
break|break;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" [%s%s%s%s%s%s%s]"
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_ANYCAST
operator|)
condition|?
literal|"a"
else|:
literal|""
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_GLOBAL
operator|)
condition|?
literal|"G"
else|:
literal|""
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_SITELOCAL
operator|)
condition|?
literal|"S"
else|:
literal|""
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_LINKLOCAL
operator|)
condition|?
literal|"L"
else|:
literal|""
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_COMPAT
operator|)
condition|?
literal|"C"
else|:
literal|""
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_ALL
operator|)
condition|?
literal|"A"
else|:
literal|""
operator|,
operator|(
name|i
operator|&
name|NI_NODEADDR_FLAG_TRUNCATE
operator|)
condition|?
literal|"T"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|needcomma
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", "
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"unknown"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/*(*/
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|")"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"[|icmp6]"
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|icmp6_rrenum_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|bp
parameter_list|,
specifier|const
name|u_char
modifier|*
name|ep
parameter_list|)
block|{
specifier|const
name|struct
name|icmp6_router_renum
modifier|*
name|rr6
decl_stmt|;
specifier|const
name|char
modifier|*
name|cp
decl_stmt|;
name|struct
name|rr_pco_match
modifier|*
name|match
decl_stmt|;
name|struct
name|rr_pco_use
modifier|*
name|use
decl_stmt|;
name|char
name|hbuf
index|[
name|NI_MAXHOST
index|]
decl_stmt|;
name|int
name|n
decl_stmt|;
if|if
condition|(
name|ep
operator|<
name|bp
condition|)
return|return;
name|rr6
operator|=
operator|(
expr|struct
name|icmp6_router_renum
operator|*
operator|)
name|bp
expr_stmt|;
name|cp
operator|=
operator|(
specifier|const
name|char
operator|*
operator|)
operator|(
name|rr6
operator|+
literal|1
operator|)
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|rr6
operator|->
name|rr_reserved
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|rr6
operator|->
name|rr_code
condition|)
block|{
case|case
name|ICMP6_ROUTER_RENUMBERING_COMMAND
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"router renum: command"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_ROUTER_RENUMBERING_RESULT
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"router renum: result"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ICMP6_ROUTER_RENUMBERING_SEQNUM_RESET
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"router renum: sequence number reset"
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"router renum: code-#%d"
operator|,
name|rr6
operator|->
name|rr_code
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", seq=%u"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|rr6
operator|->
name|rr_seqnum
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
define|#
directive|define
name|F
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
value|((rr6->rr_flags)& (x) ? (y) : "")
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"["
operator|)
argument_list|)
expr_stmt|;
comment|/*]*/
if|if
condition|(
name|rr6
operator|->
name|rr_flags
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s%s%s%s%s,"
operator|,
name|F
argument_list|(
name|ICMP6_RR_FLAGS_TEST
argument_list|,
literal|"T"
argument_list|)
operator|,
name|F
argument_list|(
name|ICMP6_RR_FLAGS_REQRESULT
argument_list|,
literal|"R"
argument_list|)
operator|,
name|F
argument_list|(
name|ICMP6_RR_FLAGS_FORCEAPPLY
argument_list|,
literal|"A"
argument_list|)
operator|,
name|F
argument_list|(
name|ICMP6_RR_FLAGS_SPECSITE
argument_list|,
literal|"S"
argument_list|)
operator|,
name|F
argument_list|(
name|ICMP6_RR_FLAGS_PREVDONE
argument_list|,
literal|"P"
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"seg=%u,"
operator|,
name|rr6
operator|->
name|rr_segnum
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"maxdelay=%u"
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|rr6
operator|->
name|rr_maxdelay
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|rr6
operator|->
name|rr_reserved
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"rsvd=0x%x"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|rr6
operator|->
name|rr_reserved
argument_list|)
operator|)
argument_list|)
expr_stmt|;
comment|/*[*/
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"]"
operator|)
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|F
block|}
if|if
condition|(
name|rr6
operator|->
name|rr_code
operator|==
name|ICMP6_ROUTER_RENUMBERING_COMMAND
condition|)
block|{
name|match
operator|=
operator|(
expr|struct
name|rr_pco_match
operator|*
operator|)
name|cp
expr_stmt|;
name|cp
operator|=
operator|(
specifier|const
name|char
operator|*
operator|)
operator|(
name|match
operator|+
literal|1
operator|)
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|match
operator|->
name|rpm_prefix
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|1
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t"
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" "
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"match("
operator|)
argument_list|)
expr_stmt|;
comment|/*)*/
switch|switch
condition|(
name|match
operator|->
name|rpm_code
condition|)
block|{
case|case
name|RPM_PCO_ADD
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"add"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|RPM_PCO_CHANGE
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"change"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|RPM_PCO_SETGLOBAL
case|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"setglobal"
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"#%u"
operator|,
name|match
operator|->
name|rpm_code
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|",ord=%u"
operator|,
name|match
operator|->
name|rpm_ordinal
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|",min=%u"
operator|,
name|match
operator|->
name|rpm_minlen
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|",max=%u"
operator|,
name|match
operator|->
name|rpm_maxlen
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|inet_ntop
argument_list|(
name|AF_INET6
argument_list|,
operator|&
name|match
operator|->
name|rpm_prefix
argument_list|,
name|hbuf
argument_list|,
sizeof|sizeof
argument_list|(
name|hbuf
argument_list|)
argument_list|)
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|",%s/%u"
operator|,
name|hbuf
operator|,
name|match
operator|->
name|rpm_matchlen
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|",?/%u"
operator|,
name|match
operator|->
name|rpm_matchlen
operator|)
argument_list|)
expr_stmt|;
comment|/*(*/
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|")"
operator|)
argument_list|)
expr_stmt|;
name|n
operator|=
name|match
operator|->
name|rpm_len
operator|-
literal|3
expr_stmt|;
if|if
condition|(
name|n
operator|%
literal|4
condition|)
goto|goto
name|trunc
goto|;
name|n
operator|/=
literal|4
expr_stmt|;
while|while
condition|(
name|n
operator|--
operator|>
literal|0
condition|)
block|{
name|use
operator|=
operator|(
expr|struct
name|rr_pco_use
operator|*
operator|)
name|cp
expr_stmt|;
name|cp
operator|=
operator|(
specifier|const
name|char
operator|*
operator|)
operator|(
name|use
operator|+
literal|1
operator|)
expr_stmt|;
name|ND_TCHECK
argument_list|(
name|use
operator|->
name|rpu_prefix
argument_list|)
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|1
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t"
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" "
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"use("
operator|)
argument_list|)
expr_stmt|;
comment|/*)*/
if|if
condition|(
name|use
operator|->
name|rpu_flags
condition|)
block|{
define|#
directive|define
name|F
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
value|((use->rpu_flags)& (x) ? (y) : "")
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s%s,"
operator|,
name|F
argument_list|(
name|ICMP6_RR_PCOUSE_FLAGS_DECRVLTIME
argument_list|,
literal|"V"
argument_list|)
operator|,
name|F
argument_list|(
name|ICMP6_RR_PCOUSE_FLAGS_DECRPLTIME
argument_list|,
literal|"P"
argument_list|)
operator|)
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|F
block|}
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"mask=0x%x,"
operator|,
name|use
operator|->
name|rpu_ramask
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"raflags=0x%x,"
operator|,
name|use
operator|->
name|rpu_raflags
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|~
name|use
operator|->
name|rpu_vltime
operator|==
literal|0
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"vltime=infty,"
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"vltime=%u,"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|use
operator|->
name|rpu_vltime
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|~
name|use
operator|->
name|rpu_pltime
operator|==
literal|0
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"pltime=infty,"
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"pltime=%u,"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|use
operator|->
name|rpu_pltime
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|inet_ntop
argument_list|(
name|AF_INET6
argument_list|,
operator|&
name|use
operator|->
name|rpu_prefix
argument_list|,
name|hbuf
argument_list|,
sizeof|sizeof
argument_list|(
name|hbuf
argument_list|)
argument_list|)
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s/%u/%u"
operator|,
name|hbuf
operator|,
name|use
operator|->
name|rpu_uselen
operator|,
name|use
operator|->
name|rpu_keeplen
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"?/%u/%u"
operator|,
name|use
operator|->
name|rpu_uselen
operator|,
name|use
operator|->
name|rpu_keeplen
operator|)
argument_list|)
expr_stmt|;
comment|/*(*/
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|")"
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"[|icmp6]"
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* INET6 */
end_comment

begin_comment
comment|/*  * Local Variables:  * c-style: whitesmith  * c-basic-offset: 8  * End:  */
end_comment

end_unit

