begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1992, 1993, 1994, 1995, 1996, 1997  *	The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code distributions  * retain the above copyright notice and this paragraph in its entirety, (2)  * distributions including binary code include the above copyright notice and  * this paragraph in its entirety in the documentation or other materials  * provided with the distribution, and (3) all advertising materials mentioning  * features or use of this software display the following acknowledgement:  * ``This product includes software developed by the University of California,  * Lawrence Berkeley Laboratory and its contributors.'' Neither the name of  * the University nor the names of its contributors may be used to endorse  * or promote products derived from this software without specific prior  * written permission.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED  * WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
init|=
literal|"@(#) $Header: /tcpdump/master/tcpdump/print-decnet.c,v 1.30 2000/09/28 06:42:57 guy Exp $ (LBL)"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_struct_decl
struct_decl|struct
name|mbuf
struct_decl|;
end_struct_decl

begin_struct_decl
struct_decl|struct
name|rtentry
struct_decl|;
end_struct_decl

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_LIBDNET
end_ifdef

begin_include
include|#
directive|include
file|<netdnet/dnetdb.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|"decnet.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_comment
comment|/* Forwards */
end_comment

begin_function_decl
specifier|static
name|void
name|print_decnet_ctlmsg
parameter_list|(
specifier|const
name|union
name|routehdr
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_t_info
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_l1_routes
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_l2_routes
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_i_info
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_elist
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_nsp
parameter_list|(
specifier|const
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_reason
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
end_ifdef

begin_function_decl
specifier|static
name|void
name|pdata
parameter_list|(
name|u_char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_LIBDNET
end_ifdef

begin_function_decl
specifier|extern
name|char
modifier|*
name|dnet_htoa
parameter_list|(
name|struct
name|dn_naddr
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|decnet_print
parameter_list|(
specifier|register
specifier|const
name|u_char
modifier|*
name|ap
parameter_list|,
specifier|register
name|u_int
name|length
parameter_list|,
specifier|register
name|u_int
name|caplen
parameter_list|)
block|{
specifier|static
name|union
name|routehdr
name|rhcopy
decl_stmt|;
specifier|register
name|union
name|routehdr
modifier|*
name|rhp
init|=
operator|&
name|rhcopy
decl_stmt|;
specifier|register
name|int
name|mflags
decl_stmt|;
name|int
name|dst
decl_stmt|,
name|src
decl_stmt|,
name|hops
decl_stmt|;
name|u_int
name|rhlen
decl_stmt|,
name|nsplen
decl_stmt|,
name|pktlen
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|nspp
decl_stmt|;
if|if
condition|(
name|length
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|shorthdr
argument_list|)
condition|)
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"[|decnet]"
argument_list|)
expr_stmt|;
return|return;
block|}
name|pktlen
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|ap
argument_list|)
expr_stmt|;
name|rhlen
operator|=
name|min
argument_list|(
name|length
argument_list|,
name|caplen
argument_list|)
expr_stmt|;
name|rhlen
operator|=
name|min
argument_list|(
name|rhlen
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|rhp
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|rhp
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
operator|(
name|ap
index|[
sizeof|sizeof
argument_list|(
name|short
argument_list|)
index|]
operator|)
argument_list|,
name|rhlen
argument_list|)
expr_stmt|;
name|mflags
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|rhp
operator|->
name|rh_short
operator|.
name|sh_flags
argument_list|)
expr_stmt|;
if|if
condition|(
name|mflags
operator|&
name|RMF_PAD
condition|)
block|{
comment|/* pad bytes of some sort in front of message */
name|u_int
name|padlen
init|=
name|mflags
operator|&
name|RMF_PADMASK
decl_stmt|;
if|if
condition|(
name|vflag
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"[pad:%d] "
argument_list|,
name|padlen
argument_list|)
expr_stmt|;
name|ap
operator|+=
name|padlen
expr_stmt|;
name|length
operator|-=
name|padlen
expr_stmt|;
name|caplen
operator|-=
name|padlen
expr_stmt|;
name|rhlen
operator|=
name|min
argument_list|(
name|length
argument_list|,
name|caplen
argument_list|)
expr_stmt|;
name|rhlen
operator|=
name|min
argument_list|(
name|rhlen
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|rhp
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|rhp
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
operator|(
name|ap
index|[
sizeof|sizeof
argument_list|(
name|short
argument_list|)
index|]
operator|)
argument_list|,
name|rhlen
argument_list|)
expr_stmt|;
name|mflags
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|rhp
operator|->
name|rh_short
operator|.
name|sh_flags
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|mflags
operator|&
name|RMF_FVER
condition|)
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"future-version-decnet"
argument_list|)
expr_stmt|;
name|default_print
argument_list|(
name|ap
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* is it a control message? */
if|if
condition|(
name|mflags
operator|&
name|RMF_CTLMSG
condition|)
block|{
name|print_decnet_ctlmsg
argument_list|(
name|rhp
argument_list|,
name|min
argument_list|(
name|length
argument_list|,
name|caplen
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|mflags
operator|&
name|RMF_MASK
condition|)
block|{
case|case
name|RMF_LONG
case|:
name|dst
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|rhp
operator|->
name|rh_long
operator|.
name|lg_dst
operator|.
name|dne_remote
operator|.
name|dne_nodeaddr
argument_list|)
expr_stmt|;
name|src
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|rhp
operator|->
name|rh_long
operator|.
name|lg_src
operator|.
name|dne_remote
operator|.
name|dne_nodeaddr
argument_list|)
expr_stmt|;
name|hops
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|rhp
operator|->
name|rh_long
operator|.
name|lg_visits
argument_list|)
expr_stmt|;
name|nspp
operator|=
operator|&
operator|(
name|ap
index|[
sizeof|sizeof
argument_list|(
name|short
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|longhdr
argument_list|)
index|]
operator|)
expr_stmt|;
name|nsplen
operator|=
name|min
argument_list|(
operator|(
name|length
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|longhdr
argument_list|)
operator|)
argument_list|,
operator|(
name|caplen
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|longhdr
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|RMF_SHORT
case|:
name|dst
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|rhp
operator|->
name|rh_short
operator|.
name|sh_dst
argument_list|)
expr_stmt|;
name|src
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|rhp
operator|->
name|rh_short
operator|.
name|sh_src
argument_list|)
expr_stmt|;
name|hops
operator|=
operator|(
name|EXTRACT_LE_8BITS
argument_list|(
name|rhp
operator|->
name|rh_short
operator|.
name|sh_visits
argument_list|)
operator|&
name|VIS_MASK
operator|)
operator|+
literal|1
expr_stmt|;
name|nspp
operator|=
operator|&
operator|(
name|ap
index|[
sizeof|sizeof
argument_list|(
name|short
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|shorthdr
argument_list|)
index|]
operator|)
expr_stmt|;
name|nsplen
operator|=
name|min
argument_list|(
operator|(
name|length
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|shorthdr
argument_list|)
operator|)
argument_list|,
operator|(
name|caplen
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|shorthdr
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"unknown message flags under mask"
argument_list|)
expr_stmt|;
name|default_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ap
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"%s> %s %d "
argument_list|,
name|dnaddr_string
argument_list|(
name|src
argument_list|)
argument_list|,
name|dnaddr_string
argument_list|(
name|dst
argument_list|)
argument_list|,
name|pktlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|vflag
condition|)
block|{
if|if
condition|(
name|mflags
operator|&
name|RMF_RQR
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"RQR "
argument_list|)
expr_stmt|;
if|if
condition|(
name|mflags
operator|&
name|RMF_RTS
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"RTS "
argument_list|)
expr_stmt|;
if|if
condition|(
name|mflags
operator|&
name|RMF_IE
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"IE "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"%d hops "
argument_list|,
name|hops
argument_list|)
expr_stmt|;
block|}
name|print_nsp
argument_list|(
name|nspp
argument_list|,
name|nsplen
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_decnet_ctlmsg
parameter_list|(
specifier|register
specifier|const
name|union
name|routehdr
modifier|*
name|rhp
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|int
name|mflags
init|=
name|EXTRACT_LE_8BITS
argument_list|(
name|rhp
operator|->
name|rh_short
operator|.
name|sh_flags
argument_list|)
decl_stmt|;
specifier|register
name|union
name|controlmsg
modifier|*
name|cmp
init|=
operator|(
expr|union
name|controlmsg
operator|*
operator|)
name|rhp
decl_stmt|;
name|int
name|src
decl_stmt|,
name|dst
decl_stmt|,
name|info
decl_stmt|,
name|blksize
decl_stmt|,
name|eco
decl_stmt|,
name|ueco
decl_stmt|,
name|hello
decl_stmt|,
name|other
decl_stmt|,
name|vers
decl_stmt|;
name|etheraddr
name|srcea
decl_stmt|,
name|rtea
decl_stmt|;
name|int
name|priority
decl_stmt|;
name|char
modifier|*
name|rhpx
init|=
operator|(
name|char
operator|*
operator|)
name|rhp
decl_stmt|;
switch|switch
condition|(
name|mflags
operator|&
name|RMF_CTLMASK
condition|)
block|{
case|case
name|RMF_INIT
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"init "
argument_list|)
expr_stmt|;
name|src
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cmp
operator|->
name|cm_init
operator|.
name|in_src
argument_list|)
expr_stmt|;
name|info
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_init
operator|.
name|in_info
argument_list|)
expr_stmt|;
name|blksize
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cmp
operator|->
name|cm_init
operator|.
name|in_blksize
argument_list|)
expr_stmt|;
name|vers
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_init
operator|.
name|in_vers
argument_list|)
expr_stmt|;
name|eco
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_init
operator|.
name|in_eco
argument_list|)
expr_stmt|;
name|ueco
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_init
operator|.
name|in_ueco
argument_list|)
expr_stmt|;
name|hello
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cmp
operator|->
name|cm_init
operator|.
name|in_hello
argument_list|)
expr_stmt|;
name|print_t_info
argument_list|(
name|info
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src %sblksize %d vers %d eco %d ueco %d hello %d"
argument_list|,
name|dnaddr_string
argument_list|(
name|src
argument_list|)
argument_list|,
name|blksize
argument_list|,
name|vers
argument_list|,
name|eco
argument_list|,
name|ueco
argument_list|,
name|hello
argument_list|)
expr_stmt|;
break|break;
case|case
name|RMF_VER
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"verification "
argument_list|)
expr_stmt|;
name|src
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cmp
operator|->
name|cm_ver
operator|.
name|ve_src
argument_list|)
expr_stmt|;
name|other
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_ver
operator|.
name|ve_fcnval
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src %s fcnval %o"
argument_list|,
name|dnaddr_string
argument_list|(
name|src
argument_list|)
argument_list|,
name|other
argument_list|)
expr_stmt|;
break|break;
case|case
name|RMF_TEST
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"test "
argument_list|)
expr_stmt|;
name|src
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cmp
operator|->
name|cm_test
operator|.
name|te_src
argument_list|)
expr_stmt|;
name|other
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_test
operator|.
name|te_data
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src %s data %o"
argument_list|,
name|dnaddr_string
argument_list|(
name|src
argument_list|)
argument_list|,
name|other
argument_list|)
expr_stmt|;
break|break;
case|case
name|RMF_L1ROUT
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"lev-1-routing "
argument_list|)
expr_stmt|;
name|src
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cmp
operator|->
name|cm_l1rou
operator|.
name|r1_src
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src %s "
argument_list|,
name|dnaddr_string
argument_list|(
name|src
argument_list|)
argument_list|)
expr_stmt|;
name|print_l1_routes
argument_list|(
operator|&
operator|(
name|rhpx
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|l1rout
argument_list|)
index|]
operator|)
argument_list|,
name|length
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|l1rout
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|RMF_L2ROUT
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"lev-2-routing "
argument_list|)
expr_stmt|;
name|src
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cmp
operator|->
name|cm_l2rout
operator|.
name|r2_src
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src %s "
argument_list|,
name|dnaddr_string
argument_list|(
name|src
argument_list|)
argument_list|)
expr_stmt|;
name|print_l2_routes
argument_list|(
operator|&
operator|(
name|rhpx
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|l2rout
argument_list|)
index|]
operator|)
argument_list|,
name|length
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|l2rout
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|RMF_RHELLO
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"router-hello "
argument_list|)
expr_stmt|;
name|vers
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_rhello
operator|.
name|rh_vers
argument_list|)
expr_stmt|;
name|eco
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_rhello
operator|.
name|rh_eco
argument_list|)
expr_stmt|;
name|ueco
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_rhello
operator|.
name|rh_ueco
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|srcea
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
operator|(
name|cmp
operator|->
name|cm_rhello
operator|.
name|rh_src
operator|)
argument_list|,
sizeof|sizeof
argument_list|(
name|srcea
argument_list|)
argument_list|)
expr_stmt|;
name|src
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|srcea
operator|.
name|dne_remote
operator|.
name|dne_nodeaddr
argument_list|)
expr_stmt|;
name|info
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_rhello
operator|.
name|rh_info
argument_list|)
expr_stmt|;
name|blksize
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cmp
operator|->
name|cm_rhello
operator|.
name|rh_blksize
argument_list|)
expr_stmt|;
name|priority
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_rhello
operator|.
name|rh_priority
argument_list|)
expr_stmt|;
name|hello
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cmp
operator|->
name|cm_rhello
operator|.
name|rh_hello
argument_list|)
expr_stmt|;
name|print_i_info
argument_list|(
name|info
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"vers %d eco %d ueco %d src %s blksize %d pri %d hello %d"
argument_list|,
name|vers
argument_list|,
name|eco
argument_list|,
name|ueco
argument_list|,
name|dnaddr_string
argument_list|(
name|src
argument_list|)
argument_list|,
name|blksize
argument_list|,
name|priority
argument_list|,
name|hello
argument_list|)
expr_stmt|;
name|print_elist
argument_list|(
operator|&
operator|(
name|rhpx
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|rhellomsg
argument_list|)
index|]
operator|)
argument_list|,
name|length
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|rhellomsg
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|RMF_EHELLO
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"endnode-hello "
argument_list|)
expr_stmt|;
name|vers
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_ehello
operator|.
name|eh_vers
argument_list|)
expr_stmt|;
name|eco
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_ehello
operator|.
name|eh_eco
argument_list|)
expr_stmt|;
name|ueco
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_ehello
operator|.
name|eh_ueco
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|srcea
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
operator|(
name|cmp
operator|->
name|cm_ehello
operator|.
name|eh_src
operator|)
argument_list|,
sizeof|sizeof
argument_list|(
name|srcea
argument_list|)
argument_list|)
expr_stmt|;
name|src
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|srcea
operator|.
name|dne_remote
operator|.
name|dne_nodeaddr
argument_list|)
expr_stmt|;
name|info
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_ehello
operator|.
name|eh_info
argument_list|)
expr_stmt|;
name|blksize
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cmp
operator|->
name|cm_ehello
operator|.
name|eh_blksize
argument_list|)
expr_stmt|;
comment|/*seed*/
name|memcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|rtea
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
operator|(
name|cmp
operator|->
name|cm_ehello
operator|.
name|eh_router
operator|)
argument_list|,
sizeof|sizeof
argument_list|(
name|rtea
argument_list|)
argument_list|)
expr_stmt|;
name|dst
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|rtea
operator|.
name|dne_remote
operator|.
name|dne_nodeaddr
argument_list|)
expr_stmt|;
name|hello
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cmp
operator|->
name|cm_ehello
operator|.
name|eh_hello
argument_list|)
expr_stmt|;
name|other
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cmp
operator|->
name|cm_ehello
operator|.
name|eh_data
argument_list|)
expr_stmt|;
name|print_i_info
argument_list|(
name|info
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"vers %d eco %d ueco %d src %s blksize %d rtr %s hello %d data %o"
argument_list|,
name|vers
argument_list|,
name|eco
argument_list|,
name|ueco
argument_list|,
name|dnaddr_string
argument_list|(
name|src
argument_list|)
argument_list|,
name|blksize
argument_list|,
name|dnaddr_string
argument_list|(
name|dst
argument_list|)
argument_list|,
name|hello
argument_list|,
name|other
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"unknown control message"
argument_list|)
expr_stmt|;
name|default_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|rhp
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_t_info
parameter_list|(
name|int
name|info
parameter_list|)
block|{
name|int
name|ntype
init|=
name|info
operator|&
literal|3
decl_stmt|;
switch|switch
condition|(
name|ntype
condition|)
block|{
case|case
literal|0
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"reserved-ntype? "
argument_list|)
expr_stmt|;
break|break;
case|case
name|TI_L2ROUT
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"l2rout "
argument_list|)
expr_stmt|;
break|break;
case|case
name|TI_L1ROUT
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"l1rout "
argument_list|)
expr_stmt|;
break|break;
case|case
name|TI_ENDNODE
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"endnode "
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|info
operator|&
name|TI_VERIF
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"verif "
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|&
name|TI_BLOCK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"blo "
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_l1_routes
parameter_list|(
specifier|const
name|char
modifier|*
name|rp
parameter_list|,
name|u_int
name|len
parameter_list|)
block|{
name|int
name|count
decl_stmt|;
name|int
name|id
decl_stmt|;
name|int
name|info
decl_stmt|;
comment|/* The last short is a checksum */
while|while
condition|(
name|len
operator|>
operator|(
literal|3
operator|*
sizeof|sizeof
argument_list|(
name|short
argument_list|)
operator|)
condition|)
block|{
name|count
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|>
literal|1024
condition|)
return|return;
comment|/* seems to be bogus from here on */
name|rp
operator|+=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|len
operator|-=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|id
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|rp
argument_list|)
expr_stmt|;
name|rp
operator|+=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|len
operator|-=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|info
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|rp
argument_list|)
expr_stmt|;
name|rp
operator|+=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|len
operator|-=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"{ids %d-%d cost %d hops %d} "
argument_list|,
name|id
argument_list|,
name|id
operator|+
name|count
argument_list|,
name|RI_COST
argument_list|(
name|info
argument_list|)
argument_list|,
name|RI_HOPS
argument_list|(
name|info
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_l2_routes
parameter_list|(
specifier|const
name|char
modifier|*
name|rp
parameter_list|,
name|u_int
name|len
parameter_list|)
block|{
name|int
name|count
decl_stmt|;
name|int
name|area
decl_stmt|;
name|int
name|info
decl_stmt|;
comment|/* The last short is a checksum */
while|while
condition|(
name|len
operator|>
operator|(
literal|3
operator|*
sizeof|sizeof
argument_list|(
name|short
argument_list|)
operator|)
condition|)
block|{
name|count
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|>
literal|1024
condition|)
return|return;
comment|/* seems to be bogus from here on */
name|rp
operator|+=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|len
operator|-=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|area
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|rp
argument_list|)
expr_stmt|;
name|rp
operator|+=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|len
operator|-=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|info
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|rp
argument_list|)
expr_stmt|;
name|rp
operator|+=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|len
operator|-=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"{areas %d-%d cost %d hops %d} "
argument_list|,
name|area
argument_list|,
name|area
operator|+
name|count
argument_list|,
name|RI_COST
argument_list|(
name|info
argument_list|)
argument_list|,
name|RI_HOPS
argument_list|(
name|info
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_i_info
parameter_list|(
name|int
name|info
parameter_list|)
block|{
name|int
name|ntype
init|=
name|info
operator|&
name|II_TYPEMASK
decl_stmt|;
switch|switch
condition|(
name|ntype
condition|)
block|{
case|case
literal|0
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"reserved-ntype? "
argument_list|)
expr_stmt|;
break|break;
case|case
name|II_L2ROUT
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"l2rout "
argument_list|)
expr_stmt|;
break|break;
case|case
name|II_L1ROUT
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"l1rout "
argument_list|)
expr_stmt|;
break|break;
case|case
name|II_ENDNODE
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"endnode "
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|info
operator|&
name|II_VERIF
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"verif "
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|&
name|II_NOMCAST
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"nomcast "
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|&
name|II_BLOCK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"blo "
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_elist
parameter_list|(
specifier|const
name|char
modifier|*
name|elp
parameter_list|,
name|u_int
name|len
parameter_list|)
block|{
comment|/* Not enough examples available for me to debug this */
block|}
end_function

begin_function
specifier|static
name|void
name|print_nsp
parameter_list|(
specifier|const
name|u_char
modifier|*
name|nspp
parameter_list|,
name|u_int
name|nsplen
parameter_list|)
block|{
specifier|const
name|struct
name|nsphdr
modifier|*
name|nsphp
init|=
operator|(
expr|struct
name|nsphdr
operator|*
operator|)
name|nspp
decl_stmt|;
name|int
name|dst
decl_stmt|,
name|src
decl_stmt|,
name|flags
decl_stmt|;
name|flags
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|nsphp
operator|->
name|nh_flags
argument_list|)
expr_stmt|;
name|dst
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|nsphp
operator|->
name|nh_dst
argument_list|)
expr_stmt|;
name|src
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|nsphp
operator|->
name|nh_src
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|flags
operator|&
name|NSP_TYPEMASK
condition|)
block|{
case|case
name|MFT_DATA
case|:
switch|switch
condition|(
name|flags
operator|&
name|NSP_SUBMASK
condition|)
block|{
case|case
name|MFS_BOM
case|:
case|case
name|MFS_MOM
case|:
case|case
name|MFS_EOM
case|:
case|case
name|MFS_BOM
operator|+
name|MFS_EOM
case|:
name|printf
argument_list|(
literal|"data %d>%d "
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
block|{
name|struct
name|seghdr
modifier|*
name|shp
init|=
operator|(
expr|struct
name|seghdr
operator|*
operator|)
name|nspp
decl_stmt|;
name|int
name|ack
decl_stmt|;
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
name|u_char
modifier|*
name|dp
decl_stmt|;
endif|#
directive|endif
name|u_int
name|data_off
init|=
sizeof|sizeof
argument_list|(
expr|struct
name|minseghdr
argument_list|)
decl_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|shp
operator|->
name|sh_seq
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|&
name|SGQ_ACK
condition|)
block|{
comment|/* acknum field */
if|if
condition|(
operator|(
name|ack
operator|&
name|SGQ_NAK
operator|)
operator|==
name|SGQ_NAK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"nak %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ack %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|shp
operator|->
name|sh_seq
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|data_off
operator|+=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|&
name|SGQ_OACK
condition|)
block|{
comment|/* ackoth field */
if|if
condition|(
operator|(
name|ack
operator|&
name|SGQ_ONAK
operator|)
operator|==
name|SGQ_ONAK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"onak %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"oack %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|shp
operator|->
name|sh_seq
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|data_off
operator|+=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
block|}
block|}
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"seg %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
name|dp
operator|=
operator|&
operator|(
name|nspp
index|[
name|data_off
index|]
operator|)
expr_stmt|;
name|pdata
argument_list|(
name|dp
argument_list|,
literal|10
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
break|break;
case|case
name|MFS_ILS
operator|+
name|MFS_INT
case|:
name|printf
argument_list|(
literal|"intr "
argument_list|)
expr_stmt|;
block|{
name|struct
name|seghdr
modifier|*
name|shp
init|=
operator|(
expr|struct
name|seghdr
operator|*
operator|)
name|nspp
decl_stmt|;
name|int
name|ack
decl_stmt|;
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
name|u_char
modifier|*
name|dp
decl_stmt|;
endif|#
directive|endif
name|u_int
name|data_off
init|=
sizeof|sizeof
argument_list|(
expr|struct
name|minseghdr
argument_list|)
decl_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|shp
operator|->
name|sh_seq
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|&
name|SGQ_ACK
condition|)
block|{
comment|/* acknum field */
if|if
condition|(
operator|(
name|ack
operator|&
name|SGQ_NAK
operator|)
operator|==
name|SGQ_NAK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"nak %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ack %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|shp
operator|->
name|sh_seq
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|data_off
operator|+=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|&
name|SGQ_OACK
condition|)
block|{
comment|/* ackdat field */
if|if
condition|(
operator|(
name|ack
operator|&
name|SGQ_ONAK
operator|)
operator|==
name|SGQ_ONAK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"nakdat %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ackdat %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|shp
operator|->
name|sh_seq
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|data_off
operator|+=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
block|}
block|}
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"seg %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
name|dp
operator|=
operator|&
operator|(
name|nspp
index|[
name|data_off
index|]
operator|)
expr_stmt|;
name|pdata
argument_list|(
name|dp
argument_list|,
literal|10
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
break|break;
case|case
name|MFS_ILS
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"link-service %d>%d "
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
block|{
name|struct
name|seghdr
modifier|*
name|shp
init|=
operator|(
expr|struct
name|seghdr
operator|*
operator|)
name|nspp
decl_stmt|;
name|struct
name|lsmsg
modifier|*
name|lsmp
init|=
operator|(
expr|struct
name|lsmsg
operator|*
operator|)
operator|&
operator|(
name|nspp
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|seghdr
argument_list|)
index|]
operator|)
decl_stmt|;
name|int
name|ack
decl_stmt|;
name|int
name|lsflags
decl_stmt|,
name|fcval
decl_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|shp
operator|->
name|sh_seq
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|&
name|SGQ_ACK
condition|)
block|{
comment|/* acknum field */
if|if
condition|(
operator|(
name|ack
operator|&
name|SGQ_NAK
operator|)
operator|==
name|SGQ_NAK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"nak %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ack %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|shp
operator|->
name|sh_seq
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|&
name|SGQ_OACK
condition|)
block|{
comment|/* ackdat field */
if|if
condition|(
operator|(
name|ack
operator|&
name|SGQ_ONAK
operator|)
operator|==
name|SGQ_ONAK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"nakdat %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ackdat %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|shp
operator|->
name|sh_seq
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
block|}
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"seg %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
name|lsflags
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|lsmp
operator|->
name|ls_lsflags
argument_list|)
expr_stmt|;
name|fcval
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|lsmp
operator|->
name|ls_fcval
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|lsflags
operator|&
name|LSI_MASK
condition|)
block|{
case|case
name|LSI_DATA
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"dat seg count %d "
argument_list|,
name|fcval
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|lsflags
operator|&
name|LSM_MASK
condition|)
block|{
case|case
name|LSM_NOCHANGE
case|:
break|break;
case|case
name|LSM_DONOTSEND
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"donotsend-data "
argument_list|)
expr_stmt|;
break|break;
case|case
name|LSM_SEND
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"send-data "
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"reserved-fcmod? %x"
argument_list|,
name|lsflags
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|LSI_INTR
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"intr req count %d "
argument_list|,
name|fcval
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"reserved-fcval-int? %x"
argument_list|,
name|lsflags
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
break|break;
default|default:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"reserved-subtype? %x %d> %d"
argument_list|,
name|flags
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|MFT_ACK
case|:
switch|switch
condition|(
name|flags
operator|&
name|NSP_SUBMASK
condition|)
block|{
case|case
name|MFS_DACK
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"data-ack %d>%d "
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
block|{
name|struct
name|ackmsg
modifier|*
name|amp
init|=
operator|(
expr|struct
name|ackmsg
operator|*
operator|)
name|nspp
decl_stmt|;
name|int
name|ack
decl_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|amp
operator|->
name|ak_acknum
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|&
name|SGQ_ACK
condition|)
block|{
comment|/* acknum field */
if|if
condition|(
operator|(
name|ack
operator|&
name|SGQ_NAK
operator|)
operator|==
name|SGQ_NAK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"nak %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ack %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|amp
operator|->
name|ak_acknum
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|&
name|SGQ_OACK
condition|)
block|{
comment|/* ackoth field */
if|if
condition|(
operator|(
name|ack
operator|&
name|SGQ_ONAK
operator|)
operator|==
name|SGQ_ONAK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"onak %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"oack %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
block|}
block|}
block|}
break|break;
case|case
name|MFS_IACK
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ils-ack %d>%d "
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
block|{
name|struct
name|ackmsg
modifier|*
name|amp
init|=
operator|(
expr|struct
name|ackmsg
operator|*
operator|)
name|nspp
decl_stmt|;
name|int
name|ack
decl_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|amp
operator|->
name|ak_acknum
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|&
name|SGQ_ACK
condition|)
block|{
comment|/* acknum field */
if|if
condition|(
operator|(
name|ack
operator|&
name|SGQ_NAK
operator|)
operator|==
name|SGQ_NAK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"nak %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ack %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
name|ack
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|amp
operator|->
name|ak_acknum
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|&
name|SGQ_OACK
condition|)
block|{
comment|/* ackdat field */
if|if
condition|(
operator|(
name|ack
operator|&
name|SGQ_ONAK
operator|)
operator|==
name|SGQ_ONAK
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"nakdat %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ackdat %d "
argument_list|,
name|ack
operator|&
name|SGQ_MASK
argument_list|)
expr_stmt|;
block|}
block|}
block|}
break|break;
case|case
name|MFS_CACK
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"conn-ack %d"
argument_list|,
name|dst
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"reserved-acktype? %x %d> %d"
argument_list|,
name|flags
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|MFT_CTL
case|:
switch|switch
condition|(
name|flags
operator|&
name|NSP_SUBMASK
condition|)
block|{
case|case
name|MFS_CI
case|:
case|case
name|MFS_RCI
case|:
if|if
condition|(
operator|(
name|flags
operator|&
name|NSP_SUBMASK
operator|)
operator|==
name|MFS_CI
condition|)
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"conn-initiate "
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"retrans-conn-initiate "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"%d>%d "
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
block|{
name|struct
name|cimsg
modifier|*
name|cimp
init|=
operator|(
expr|struct
name|cimsg
operator|*
operator|)
name|nspp
decl_stmt|;
name|int
name|services
decl_stmt|,
name|info
decl_stmt|,
name|segsize
decl_stmt|;
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
name|u_char
modifier|*
name|dp
decl_stmt|;
endif|#
directive|endif
name|services
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cimp
operator|->
name|ci_services
argument_list|)
expr_stmt|;
name|info
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|cimp
operator|->
name|ci_info
argument_list|)
expr_stmt|;
name|segsize
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|cimp
operator|->
name|ci_segsize
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|services
operator|&
name|COS_MASK
condition|)
block|{
case|case
name|COS_NONE
case|:
break|break;
case|case
name|COS_SEGMENT
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"seg "
argument_list|)
expr_stmt|;
break|break;
case|case
name|COS_MESSAGE
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"msg "
argument_list|)
expr_stmt|;
break|break;
case|case
name|COS_CRYPTSER
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"crypt "
argument_list|)
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|info
operator|&
name|COI_MASK
condition|)
block|{
case|case
name|COI_32
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ver 3.2 "
argument_list|)
expr_stmt|;
break|break;
case|case
name|COI_31
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ver 3.1 "
argument_list|)
expr_stmt|;
break|break;
case|case
name|COI_40
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ver 4.0 "
argument_list|)
expr_stmt|;
break|break;
case|case
name|COI_41
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ver 4.1 "
argument_list|)
expr_stmt|;
break|break;
block|}
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"segsize %d "
argument_list|,
name|segsize
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
name|dp
operator|=
operator|&
operator|(
name|nspp
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|cimsg
argument_list|)
index|]
operator|)
expr_stmt|;
name|pdata
argument_list|(
name|dp
argument_list|,
name|nsplen
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|cimsg
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
break|break;
case|case
name|MFS_CC
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"conn-confirm %d>%d "
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
block|{
name|struct
name|ccmsg
modifier|*
name|ccmp
init|=
operator|(
expr|struct
name|ccmsg
operator|*
operator|)
name|nspp
decl_stmt|;
name|int
name|services
decl_stmt|,
name|info
decl_stmt|;
name|u_int
name|segsize
decl_stmt|,
name|optlen
decl_stmt|;
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
name|u_char
modifier|*
name|dp
decl_stmt|;
endif|#
directive|endif
name|services
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|ccmp
operator|->
name|cc_services
argument_list|)
expr_stmt|;
name|info
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|ccmp
operator|->
name|cc_info
argument_list|)
expr_stmt|;
name|segsize
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|ccmp
operator|->
name|cc_segsize
argument_list|)
expr_stmt|;
name|optlen
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|ccmp
operator|->
name|cc_optlen
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|services
operator|&
name|COS_MASK
condition|)
block|{
case|case
name|COS_NONE
case|:
break|break;
case|case
name|COS_SEGMENT
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"seg "
argument_list|)
expr_stmt|;
break|break;
case|case
name|COS_MESSAGE
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"msg "
argument_list|)
expr_stmt|;
break|break;
case|case
name|COS_CRYPTSER
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"crypt "
argument_list|)
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|info
operator|&
name|COI_MASK
condition|)
block|{
case|case
name|COI_32
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ver 3.2 "
argument_list|)
expr_stmt|;
break|break;
case|case
name|COI_31
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ver 3.1 "
argument_list|)
expr_stmt|;
break|break;
case|case
name|COI_40
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ver 4.0 "
argument_list|)
expr_stmt|;
break|break;
case|case
name|COI_41
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"ver 4.1 "
argument_list|)
expr_stmt|;
break|break;
block|}
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"segsize %d "
argument_list|,
name|segsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|optlen
condition|)
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"optlen %d "
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
name|optlen
operator|=
name|min
argument_list|(
name|optlen
argument_list|,
name|nsplen
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|ccmsg
argument_list|)
argument_list|)
expr_stmt|;
name|dp
operator|=
operator|&
operator|(
name|nspp
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|ccmsg
argument_list|)
index|]
operator|)
expr_stmt|;
name|pdata
argument_list|(
name|dp
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
break|break;
case|case
name|MFS_DI
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"disconn-initiate %d>%d "
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
block|{
name|struct
name|dimsg
modifier|*
name|dimp
init|=
operator|(
expr|struct
name|dimsg
operator|*
operator|)
name|nspp
decl_stmt|;
name|int
name|reason
decl_stmt|;
name|u_int
name|optlen
decl_stmt|;
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
name|u_char
modifier|*
name|dp
decl_stmt|;
endif|#
directive|endif
name|reason
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|dimp
operator|->
name|di_reason
argument_list|)
expr_stmt|;
name|optlen
operator|=
name|EXTRACT_LE_8BITS
argument_list|(
name|dimp
operator|->
name|di_optlen
argument_list|)
expr_stmt|;
name|print_reason
argument_list|(
name|reason
argument_list|)
expr_stmt|;
if|if
condition|(
name|optlen
condition|)
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"optlen %d "
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
name|optlen
operator|=
name|min
argument_list|(
name|optlen
argument_list|,
name|nsplen
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|dimsg
argument_list|)
argument_list|)
expr_stmt|;
name|dp
operator|=
operator|&
operator|(
name|nspp
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|dimsg
argument_list|)
index|]
operator|)
expr_stmt|;
name|pdata
argument_list|(
name|dp
argument_list|,
name|optlen
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
break|break;
case|case
name|MFS_DC
case|:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"disconn-confirm %d>%d "
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
block|{
name|struct
name|dcmsg
modifier|*
name|dcmp
init|=
operator|(
expr|struct
name|dcmsg
operator|*
operator|)
name|nspp
decl_stmt|;
name|int
name|reason
decl_stmt|;
name|reason
operator|=
name|EXTRACT_LE_16BITS
argument_list|(
name|dcmp
operator|->
name|dc_reason
argument_list|)
expr_stmt|;
name|print_reason
argument_list|(
name|reason
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"reserved-ctltype? %x %d> %d"
argument_list|,
name|flags
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
default|default:
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"reserved-type? %x %d> %d"
argument_list|,
name|flags
argument_list|,
name|src
argument_list|,
name|dst
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_decl_stmt
specifier|static
name|struct
name|tok
name|reason2str
index|[]
init|=
block|{
block|{
name|UC_OBJREJECT
block|,
literal|"object rejected connect"
block|}
block|,
block|{
name|UC_RESOURCES
block|,
literal|"insufficient resources"
block|}
block|,
block|{
name|UC_NOSUCHNODE
block|,
literal|"unrecognized node name"
block|}
block|,
block|{
name|DI_SHUT
block|,
literal|"node is shutting down"
block|}
block|,
block|{
name|UC_NOSUCHOBJ
block|,
literal|"unrecognized object"
block|}
block|,
block|{
name|UC_INVOBJFORMAT
block|,
literal|"invalid object name format"
block|}
block|,
block|{
name|UC_OBJTOOBUSY
block|,
literal|"object too busy"
block|}
block|,
block|{
name|DI_PROTOCOL
block|,
literal|"protocol error discovered"
block|}
block|,
block|{
name|DI_TPA
block|,
literal|"third party abort"
block|}
block|,
block|{
name|UC_USERABORT
block|,
literal|"user abort"
block|}
block|,
block|{
name|UC_INVNODEFORMAT
block|,
literal|"invalid node name format"
block|}
block|,
block|{
name|UC_LOCALSHUT
block|,
literal|"local node shutting down"
block|}
block|,
block|{
name|DI_LOCALRESRC
block|,
literal|"insufficient local resources"
block|}
block|,
block|{
name|DI_REMUSERRESRC
block|,
literal|"insufficient remote user resources"
block|}
block|,
block|{
name|UC_ACCESSREJECT
block|,
literal|"invalid access control information"
block|}
block|,
block|{
name|DI_BADACCNT
block|,
literal|"bad ACCOUNT information"
block|}
block|,
block|{
name|UC_NORESPONSE
block|,
literal|"no response from object"
block|}
block|,
block|{
name|UC_UNREACHABLE
block|,
literal|"node unreachable"
block|}
block|,
block|{
name|DC_NOLINK
block|,
literal|"no link terminate"
block|}
block|,
block|{
name|DC_COMPLETE
block|,
literal|"disconnect complete"
block|}
block|,
block|{
name|DI_BADIMAGE
block|,
literal|"bad image data in connect"
block|}
block|,
block|{
name|DI_SERVMISMATCH
block|,
literal|"cryptographic service mismatch"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|print_reason
parameter_list|(
specifier|register
name|int
name|reason
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|tok2str
argument_list|(
name|reason2str
argument_list|,
literal|"reason-%d"
argument_list|,
name|reason
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
name|dnnum_string
parameter_list|(
name|u_short
name|dnaddr
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|size_t
name|siz
decl_stmt|;
name|int
name|area
init|=
call|(
name|u_short
call|)
argument_list|(
name|dnaddr
operator|&
name|AREAMASK
argument_list|)
operator|>>
name|AREASHIFT
decl_stmt|;
name|int
name|node
init|=
name|dnaddr
operator|&
name|NODEMASK
decl_stmt|;
name|str
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|siz
operator|=
sizeof|sizeof
argument_list|(
literal|"00.0000"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|str
operator|==
name|NULL
condition|)
name|error
argument_list|(
literal|"dnnum_string: malloc"
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|str
argument_list|,
name|siz
argument_list|,
literal|"%d.%d"
argument_list|,
name|area
argument_list|,
name|node
argument_list|)
expr_stmt|;
return|return
operator|(
name|str
operator|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|dnname_string
parameter_list|(
name|u_short
name|dnaddr
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_LIBDNET
name|struct
name|dn_naddr
name|dna
decl_stmt|;
name|dna
operator|.
name|a_len
operator|=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|dna
operator|.
name|a_addr
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|dnaddr
argument_list|,
sizeof|sizeof
argument_list|(
name|short
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|savestr
argument_list|(
name|dnet_htoa
argument_list|(
operator|&
name|dna
argument_list|)
argument_list|)
operator|)
return|;
else|#
directive|else
return|return
operator|(
name|dnnum_string
argument_list|(
name|dnaddr
argument_list|)
operator|)
return|;
comment|/* punt */
endif|#
directive|endif
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|PRINT_NSPDATA
end_ifdef

begin_function
specifier|static
name|void
name|pdata
parameter_list|(
name|u_char
modifier|*
name|dp
parameter_list|,
name|u_int
name|maxlen
parameter_list|)
block|{
name|char
name|c
decl_stmt|;
name|u_int
name|x
init|=
name|maxlen
decl_stmt|;
while|while
condition|(
name|x
operator|--
operator|>
literal|0
condition|)
block|{
name|c
operator|=
operator|*
name|dp
operator|++
expr_stmt|;
if|if
condition|(
name|isprint
argument_list|(
name|c
argument_list|)
condition|)
name|putchar
argument_list|(
name|c
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\\%o"
argument_list|,
name|c
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

