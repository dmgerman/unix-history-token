begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (C) 2000 Alfredo Andres Omella.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  *   1. Redistributions of source code must retain the above copyright  *      notice, this list of conditions and the following disclaimer.  *   2. Redistributions in binary form must reproduce the above copyright  *      notice, this list of conditions and the following disclaimer in  *      the documentation and/or other materials provided with the  *      distribution.  *   3. The names of the authors may not be used to endorse or promote  *      products derived from this software without specific prior  *      written permission.  *  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  */
end_comment

begin_comment
comment|/*  * Radius printer routines as specified on:  *  * RFC 2865:  *      "Remote Authentication Dial In User Service (RADIUS)"  *  * RFC 2866:  *      "RADIUS Accounting"  *  * RFC 2867:  *      "RADIUS Accounting Modifications for Tunnel Protocol Support"  *  * RFC 2868:  *      "RADIUS Attributes for Tunnel Protocol Support"  *  * RFC 2869:  *      "RADIUS Extensions"  *  * Alfredo Andres Omella (aandres@s21sec.com) v0.1 2000/09/15  *  * TODO: Among other things to print ok MacIntosh and Vendor values  */
end_comment

begin_define
define|#
directive|define
name|NETDISSECT_REWORKED
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<tcpdump-stdinc.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_include
include|#
directive|include
file|"oui.h"
end_include

begin_decl_stmt
specifier|static
specifier|const
name|char
name|tstr
index|[]
init|=
literal|" [|radius]"
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|TAM_SIZE
parameter_list|(
name|x
parameter_list|)
value|(sizeof(x)/sizeof(x[0]) )
end_define

begin_define
define|#
directive|define
name|PRINT_HEX
parameter_list|(
name|bytes_len
parameter_list|,
name|ptr_data
parameter_list|)
define|\
value|while(bytes_len)                                          \            {                                                         \               ND_PRINT((ndo, "%02X", *ptr_data ));                   \               ptr_data++;                                            \               bytes_len--;                                           \            }
end_define

begin_comment
comment|/* Radius packet codes */
end_comment

begin_define
define|#
directive|define
name|RADCMD_ACCESS_REQ
value|1
end_define

begin_comment
comment|/* Access-Request      */
end_comment

begin_define
define|#
directive|define
name|RADCMD_ACCESS_ACC
value|2
end_define

begin_comment
comment|/* Access-Accept       */
end_comment

begin_define
define|#
directive|define
name|RADCMD_ACCESS_REJ
value|3
end_define

begin_comment
comment|/* Access-Reject       */
end_comment

begin_define
define|#
directive|define
name|RADCMD_ACCOUN_REQ
value|4
end_define

begin_comment
comment|/* Accounting-Request  */
end_comment

begin_define
define|#
directive|define
name|RADCMD_ACCOUN_RES
value|5
end_define

begin_comment
comment|/* Accounting-Response */
end_comment

begin_define
define|#
directive|define
name|RADCMD_ACCESS_CHA
value|11
end_define

begin_comment
comment|/* Access-Challenge    */
end_comment

begin_define
define|#
directive|define
name|RADCMD_STATUS_SER
value|12
end_define

begin_comment
comment|/* Status-Server       */
end_comment

begin_define
define|#
directive|define
name|RADCMD_STATUS_CLI
value|13
end_define

begin_comment
comment|/* Status-Client       */
end_comment

begin_define
define|#
directive|define
name|RADCMD_RESERVED
value|255
end_define

begin_comment
comment|/* Reserved            */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|radius_command_values
index|[]
init|=
block|{
block|{
name|RADCMD_ACCESS_REQ
block|,
literal|"Access Request"
block|}
block|,
block|{
name|RADCMD_ACCESS_ACC
block|,
literal|"Access Accept"
block|}
block|,
block|{
name|RADCMD_ACCESS_REJ
block|,
literal|"Access Reject"
block|}
block|,
block|{
name|RADCMD_ACCOUN_REQ
block|,
literal|"Accounting Request"
block|}
block|,
block|{
name|RADCMD_ACCOUN_RES
block|,
literal|"Accounting Response"
block|}
block|,
block|{
name|RADCMD_ACCESS_CHA
block|,
literal|"Access Challenge"
block|}
block|,
block|{
name|RADCMD_STATUS_SER
block|,
literal|"Status Server"
block|}
block|,
block|{
name|RADCMD_STATUS_CLI
block|,
literal|"Status Client"
block|}
block|,
block|{
name|RADCMD_RESERVED
block|,
literal|"Reserved"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/********************************/
end_comment

begin_comment
comment|/* Begin Radius Attribute types */
end_comment

begin_comment
comment|/********************************/
end_comment

begin_define
define|#
directive|define
name|SERV_TYPE
value|6
end_define

begin_define
define|#
directive|define
name|FRM_IPADDR
value|8
end_define

begin_define
define|#
directive|define
name|LOG_IPHOST
value|14
end_define

begin_define
define|#
directive|define
name|LOG_SERVICE
value|15
end_define

begin_define
define|#
directive|define
name|FRM_IPX
value|23
end_define

begin_define
define|#
directive|define
name|SESSION_TIMEOUT
value|27
end_define

begin_define
define|#
directive|define
name|IDLE_TIMEOUT
value|28
end_define

begin_define
define|#
directive|define
name|FRM_ATALK_LINK
value|37
end_define

begin_define
define|#
directive|define
name|FRM_ATALK_NETWORK
value|38
end_define

begin_define
define|#
directive|define
name|ACCT_DELAY
value|41
end_define

begin_define
define|#
directive|define
name|ACCT_SESSION_TIME
value|46
end_define

begin_define
define|#
directive|define
name|TUNNEL_TYPE
value|64
end_define

begin_define
define|#
directive|define
name|TUNNEL_MEDIUM
value|65
end_define

begin_define
define|#
directive|define
name|TUNNEL_CLIENT_END
value|66
end_define

begin_define
define|#
directive|define
name|TUNNEL_SERVER_END
value|67
end_define

begin_define
define|#
directive|define
name|TUNNEL_PASS
value|69
end_define

begin_define
define|#
directive|define
name|ARAP_PASS
value|70
end_define

begin_define
define|#
directive|define
name|ARAP_FEATURES
value|71
end_define

begin_define
define|#
directive|define
name|TUNNEL_PRIV_GROUP
value|81
end_define

begin_define
define|#
directive|define
name|TUNNEL_ASSIGN_ID
value|82
end_define

begin_define
define|#
directive|define
name|TUNNEL_PREFERENCE
value|83
end_define

begin_define
define|#
directive|define
name|ARAP_CHALLENGE_RESP
value|84
end_define

begin_define
define|#
directive|define
name|ACCT_INT_INTERVAL
value|85
end_define

begin_define
define|#
directive|define
name|TUNNEL_CLIENT_AUTH
value|90
end_define

begin_define
define|#
directive|define
name|TUNNEL_SERVER_AUTH
value|91
end_define

begin_comment
comment|/********************************/
end_comment

begin_comment
comment|/* End Radius Attribute types */
end_comment

begin_comment
comment|/********************************/
end_comment

begin_function_decl
specifier|static
name|void
name|print_attr_string
parameter_list|(
name|netdissect_options
modifier|*
parameter_list|,
specifier|register
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|,
name|u_short
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_attr_num
parameter_list|(
name|netdissect_options
modifier|*
parameter_list|,
specifier|register
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|,
name|u_short
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_vendor_attr
parameter_list|(
name|netdissect_options
modifier|*
parameter_list|,
specifier|register
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|,
name|u_short
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_attr_address
parameter_list|(
name|netdissect_options
modifier|*
parameter_list|,
specifier|register
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|,
name|u_short
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_attr_time
parameter_list|(
name|netdissect_options
modifier|*
parameter_list|,
specifier|register
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|,
name|u_short
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_attr_strange
parameter_list|(
name|netdissect_options
modifier|*
parameter_list|,
specifier|register
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|,
name|u_short
parameter_list|)
function_decl|;
end_function_decl

begin_struct
struct|struct
name|radius_hdr
block|{
name|uint8_t
name|code
decl_stmt|;
comment|/* Radius packet code  */
name|uint8_t
name|id
decl_stmt|;
comment|/* Radius packet id    */
name|uint16_t
name|len
decl_stmt|;
comment|/* Radius total length */
name|uint8_t
name|auth
index|[
literal|16
index|]
decl_stmt|;
comment|/* Authenticator   */
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|MIN_RADIUS_LEN
value|20
end_define

begin_struct
struct|struct
name|radius_attr
block|{
name|uint8_t
name|type
decl_stmt|;
comment|/* Attribute type   */
name|uint8_t
name|len
decl_stmt|;
comment|/* Attribute length */
block|}
struct|;
end_struct

begin_comment
comment|/* Service-Type Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|serv_type
index|[]
init|=
block|{
name|NULL
block|,
literal|"Login"
block|,
literal|"Framed"
block|,
literal|"Callback Login"
block|,
literal|"Callback Framed"
block|,
literal|"Outbound"
block|,
literal|"Administrative"
block|,
literal|"NAS Prompt"
block|,
literal|"Authenticate Only"
block|,
literal|"Callback NAS Prompt"
block|,
literal|"Call Check"
block|,
literal|"Callback Administrative"
block|,                                }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Framed-Protocol Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|frm_proto
index|[]
init|=
block|{
name|NULL
block|,
literal|"PPP"
block|,
literal|"SLIP"
block|,
literal|"ARAP"
block|,
literal|"Gandalf proprietary"
block|,
literal|"Xylogics IPX/SLIP"
block|,
literal|"X.75 Synchronous"
block|,                                }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Framed-Routing Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|frm_routing
index|[]
init|=
block|{
literal|"None"
block|,
literal|"Send"
block|,
literal|"Listen"
block|,
literal|"Send&Listen"
block|,                                  }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Framed-Compression Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|frm_comp
index|[]
init|=
block|{
literal|"None"
block|,
literal|"VJ TCP/IP"
block|,
literal|"IPX"
block|,
literal|"Stac-LZS"
block|,                               }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Login-Service Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|login_serv
index|[]
init|=
block|{
literal|"Telnet"
block|,
literal|"Rlogin"
block|,
literal|"TCP Clear"
block|,
literal|"PortMaster(proprietary)"
block|,
literal|"LAT"
block|,
literal|"X.25-PAD"
block|,
literal|"X.25-T3POS"
block|,
literal|"Unassigned"
block|,
literal|"TCP Clear Quiet"
block|,                                 }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Termination-Action Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|term_action
index|[]
init|=
block|{
literal|"Default"
block|,
literal|"RADIUS-Request"
block|,                                  }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* NAS-Port-Type Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|nas_port_type
index|[]
init|=
block|{
literal|"Async"
block|,
literal|"Sync"
block|,
literal|"ISDN Sync"
block|,
literal|"ISDN Async V.120"
block|,
literal|"ISDN Async V.110"
block|,
literal|"Virtual"
block|,
literal|"PIAFS"
block|,
literal|"HDLC Clear Channel"
block|,
literal|"X.25"
block|,
literal|"X.75"
block|,
literal|"G.3 Fax"
block|,
literal|"SDSL"
block|,
literal|"ADSL-CAP"
block|,
literal|"ADSL-DMT"
block|,
literal|"ISDN-DSL"
block|,
literal|"Ethernet"
block|,
literal|"xDSL"
block|,
literal|"Cable"
block|,
literal|"Wireless - Other"
block|,
literal|"Wireless - IEEE 802.11"
block|,                                    }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Acct-Status-Type Accounting Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|acct_status
index|[]
init|=
block|{
name|NULL
block|,
literal|"Start"
block|,
literal|"Stop"
block|,
literal|"Interim-Update"
block|,
literal|"Unassigned"
block|,
literal|"Unassigned"
block|,
literal|"Unassigned"
block|,
literal|"Accounting-On"
block|,
literal|"Accounting-Off"
block|,
literal|"Tunnel-Start"
block|,
literal|"Tunnel-Stop"
block|,
literal|"Tunnel-Reject"
block|,
literal|"Tunnel-Link-Start"
block|,
literal|"Tunnel-Link-Stop"
block|,
literal|"Tunnel-Link-Reject"
block|,
literal|"Failed"
block|,                                  }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Acct-Authentic Accounting Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|acct_auth
index|[]
init|=
block|{
name|NULL
block|,
literal|"RADIUS"
block|,
literal|"Local"
block|,
literal|"Remote"
block|,                                }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Acct-Terminate-Cause Accounting Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|acct_term
index|[]
init|=
block|{
name|NULL
block|,
literal|"User Request"
block|,
literal|"Lost Carrier"
block|,
literal|"Lost Service"
block|,
literal|"Idle Timeout"
block|,
literal|"Session Timeout"
block|,
literal|"Admin Reset"
block|,
literal|"Admin Reboot"
block|,
literal|"Port Error"
block|,
literal|"NAS Error"
block|,
literal|"NAS Request"
block|,
literal|"NAS Reboot"
block|,
literal|"Port Unneeded"
block|,
literal|"Port Preempted"
block|,
literal|"Port Suspended"
block|,
literal|"Service Unavailable"
block|,
literal|"Callback"
block|,
literal|"User Error"
block|,
literal|"Host Request"
block|,                                }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Tunnel-Type Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|tunnel_type
index|[]
init|=
block|{
name|NULL
block|,
literal|"PPTP"
block|,
literal|"L2F"
block|,
literal|"L2TP"
block|,
literal|"ATMP"
block|,
literal|"VTP"
block|,
literal|"AH"
block|,
literal|"IP-IP"
block|,
literal|"MIN-IP-IP"
block|,
literal|"ESP"
block|,
literal|"GRE"
block|,
literal|"DVS"
block|,
literal|"IP-in-IP Tunneling"
block|,                                  }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Tunnel-Medium-Type Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|tunnel_medium
index|[]
init|=
block|{
name|NULL
block|,
literal|"IPv4"
block|,
literal|"IPv6"
block|,
literal|"NSAP"
block|,
literal|"HDLC"
block|,
literal|"BBN 1822"
block|,
literal|"802"
block|,
literal|"E.163"
block|,
literal|"E.164"
block|,
literal|"F.69"
block|,
literal|"X.121"
block|,
literal|"IPX"
block|,
literal|"Appletalk"
block|,
literal|"Decnet IV"
block|,
literal|"Banyan Vines"
block|,
literal|"E.164 with NSAP subaddress"
block|,                                    }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ARAP-Zone-Access Attribute standard values */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|arap_zone
index|[]
init|=
block|{
name|NULL
block|,
literal|"Only access to dfl zone"
block|,
literal|"Use zone filter inc."
block|,
literal|"Not used"
block|,
literal|"Use zone filter exc."
block|,                                }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|prompt
index|[]
init|=
block|{
literal|"No Echo"
block|,
literal|"Echo"
block|,                             }
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|attrtype
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
comment|/* Attribute name                 */
specifier|const
name|char
modifier|*
modifier|*
name|subtypes
decl_stmt|;
comment|/* Standard Values (if any)       */
name|u_char
name|siz_subtypes
decl_stmt|;
comment|/* Size of total standard values  */
name|u_char
name|first_subtype
decl_stmt|;
comment|/* First standard value is 0 or 1 */
name|void
function_decl|(
modifier|*
name|print_func
function_decl|)
parameter_list|(
name|netdissect_options
modifier|*
parameter_list|,
specifier|register
name|u_char
modifier|*
parameter_list|,
name|u_int
parameter_list|,
name|u_short
parameter_list|)
function_decl|;
block|}
name|attr_type
index|[]
init|=
block|{
block|{
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|,
block|{
literal|"Username"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Password"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|,
block|{
literal|"CHAP Password"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|,
block|{
literal|"NAS IP Address"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_address
block|}
block|,
block|{
literal|"NAS Port"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Service Type"
block|,
name|serv_type
block|,
name|TAM_SIZE
argument_list|(
name|serv_type
argument_list|)
operator|-
literal|1
block|,
literal|1
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Framed Protocol"
block|,
name|frm_proto
block|,
name|TAM_SIZE
argument_list|(
name|frm_proto
argument_list|)
operator|-
literal|1
block|,
literal|1
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Framed IP Address"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_address
block|}
block|,
block|{
literal|"Framed IP Network"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_address
block|}
block|,
block|{
literal|"Framed Routing"
block|,
name|frm_routing
block|,
name|TAM_SIZE
argument_list|(
name|frm_routing
argument_list|)
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Filter ID"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Framed MTU"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Framed Compression"
block|,
name|frm_comp
block|,
name|TAM_SIZE
argument_list|(
name|frm_comp
argument_list|)
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Login IP Host"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_address
block|}
block|,
block|{
literal|"Login Service"
block|,
name|login_serv
block|,
name|TAM_SIZE
argument_list|(
name|login_serv
argument_list|)
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Login TCP Port"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Unassigned"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|,
comment|/*17*/
block|{
literal|"Reply"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Callback-number"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Callback-ID"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Unassigned"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|,
comment|/*21*/
block|{
literal|"Framed Route"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Framed IPX Network"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"State"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Class"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Vendor Specific"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_vendor_attr
block|}
block|,
block|{
literal|"Session Timeout"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Idle Timeout"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Termination Action"
block|,
name|term_action
block|,
name|TAM_SIZE
argument_list|(
name|term_action
argument_list|)
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Called Station"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Calling Station"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"NAS ID"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Proxy State"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Login LAT Service"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Login LAT Node"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Login LAT Group"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Framed Appletalk Link"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Framed Appltalk Net"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Framed Appletalk Zone"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Accounting Status"
block|,
name|acct_status
block|,
name|TAM_SIZE
argument_list|(
name|acct_status
argument_list|)
operator|-
literal|1
block|,
literal|1
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Delay"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Input Octets"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Output Octets"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Session ID"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Accounting Authentication"
block|,
name|acct_auth
block|,
name|TAM_SIZE
argument_list|(
name|acct_auth
argument_list|)
operator|-
literal|1
block|,
literal|1
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Session Time"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Input Packets"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Output Packets"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Termination Cause"
block|,
name|acct_term
block|,
name|TAM_SIZE
argument_list|(
name|acct_term
argument_list|)
operator|-
literal|1
block|,
literal|1
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Multilink Session ID"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Accounting Link Count"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Input Giga"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Output Giga"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Unassigned"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|,
comment|/*54*/
block|{
literal|"Event Timestamp"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_time
block|}
block|,
block|{
literal|"Unassigned"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|,
comment|/*56*/
block|{
literal|"Unassigned"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|,
comment|/*57*/
block|{
literal|"Unassigned"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|,
comment|/*58*/
block|{
literal|"Unassigned"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|,
comment|/*59*/
block|{
literal|"CHAP challenge"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"NAS Port Type"
block|,
name|nas_port_type
block|,
name|TAM_SIZE
argument_list|(
name|nas_port_type
argument_list|)
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Port Limit"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Login LAT Port"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
comment|/*63*/
block|{
literal|"Tunnel Type"
block|,
name|tunnel_type
block|,
name|TAM_SIZE
argument_list|(
name|tunnel_type
argument_list|)
operator|-
literal|1
block|,
literal|1
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Tunnel Medium"
block|,
name|tunnel_medium
block|,
name|TAM_SIZE
argument_list|(
name|tunnel_medium
argument_list|)
operator|-
literal|1
block|,
literal|1
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Tunnel Client End"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Tunnel Server End"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Accounting Tunnel connect"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Tunnel Password"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"ARAP Password"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_strange
block|}
block|,
block|{
literal|"ARAP Feature"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_strange
block|}
block|,
block|{
literal|"ARAP Zone Acces"
block|,
name|arap_zone
block|,
name|TAM_SIZE
argument_list|(
name|arap_zone
argument_list|)
operator|-
literal|1
block|,
literal|1
block|,
name|print_attr_num
block|}
block|,
comment|/*72*/
block|{
literal|"ARAP Security"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"ARAP Security Data"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Password Retry"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Prompt"
block|,
name|prompt
block|,
name|TAM_SIZE
argument_list|(
name|prompt
argument_list|)
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Connect Info"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Config Token"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"EAP Message"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Message Authentication"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
comment|/*80*/
block|{
literal|"Tunnel Private Group"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Tunnel Assigned ID"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Tunnel Preference"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"ARAP Challenge Response"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_strange
block|}
block|,
block|{
literal|"Accounting Interim Interval"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
block|{
literal|"Accounting Tunnel packets lost"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_num
block|}
block|,
comment|/*86*/
block|{
literal|"NAS Port ID"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Framed Pool"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Chargeable User Identity"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Tunnel Client Authentication ID"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Tunnel Server Authentication ID"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|print_attr_string
block|}
block|,
block|{
literal|"Unassigned"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|,
comment|/*92*/
block|{
literal|"Unassigned"
block|,
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
comment|/*93*/
block|}
struct|;
end_struct

begin_comment
comment|/*****************************/
end_comment

begin_comment
comment|/* Print an attribute string */
end_comment

begin_comment
comment|/* value pointed by 'data'   */
end_comment

begin_comment
comment|/* and 'length' size.        */
end_comment

begin_comment
comment|/*****************************/
end_comment

begin_comment
comment|/* Returns nothing.          */
end_comment

begin_comment
comment|/*****************************/
end_comment

begin_function
specifier|static
name|void
name|print_attr_string
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|register
name|u_char
modifier|*
name|data
parameter_list|,
name|u_int
name|length
parameter_list|,
name|u_short
name|attr_code
parameter_list|)
block|{
specifier|register
name|u_int
name|i
decl_stmt|;
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
name|length
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|attr_code
condition|)
block|{
case|case
name|TUNNEL_PASS
case|:
if|if
condition|(
name|length
operator|<
literal|3
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|*
name|data
operator|&&
operator|(
operator|*
name|data
operator|<=
literal|0x1F
operator|)
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Tag %u, "
operator|,
operator|*
name|data
operator|)
argument_list|)
expr_stmt|;
name|data
operator|++
expr_stmt|;
name|length
operator|--
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Salt %u "
operator|,
name|EXTRACT_16BITS
argument_list|(
name|data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|2
expr_stmt|;
name|length
operator|-=
literal|2
expr_stmt|;
break|break;
case|case
name|TUNNEL_CLIENT_END
case|:
case|case
name|TUNNEL_SERVER_END
case|:
case|case
name|TUNNEL_PRIV_GROUP
case|:
case|case
name|TUNNEL_ASSIGN_ID
case|:
case|case
name|TUNNEL_CLIENT_AUTH
case|:
case|case
name|TUNNEL_SERVER_AUTH
case|:
if|if
condition|(
operator|*
name|data
operator|<=
literal|0x1F
condition|)
block|{
if|if
condition|(
name|length
operator|<
literal|1
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Tag %u"
operator|,
operator|*
name|data
operator|)
argument_list|)
expr_stmt|;
name|data
operator|++
expr_stmt|;
name|length
operator|--
expr_stmt|;
block|}
break|break;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|*
name|data
operator|&&
name|i
operator|<
name|length
condition|;
name|i
operator|++
operator|,
name|data
operator|++
control|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%c"
operator|,
operator|(
operator|*
name|data
operator|<
literal|32
operator|||
operator|*
name|data
operator|>
literal|128
operator|)
condition|?
literal|'.'
else|:
operator|*
name|data
operator|)
argument_list|)
expr_stmt|;
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * print vendor specific attributes  */
end_comment

begin_function
specifier|static
name|void
name|print_vendor_attr
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|register
name|u_char
modifier|*
name|data
parameter_list|,
name|u_int
name|length
parameter_list|,
name|u_short
name|attr_code
name|_U_
parameter_list|)
block|{
name|u_int
name|idx
decl_stmt|;
name|u_int
name|vendor_id
decl_stmt|;
name|u_int
name|vendor_type
decl_stmt|;
name|u_int
name|vendor_length
decl_stmt|;
if|if
condition|(
name|length
operator|<
literal|4
condition|)
goto|goto
name|trunc
goto|;
name|ND_TCHECK2
argument_list|(
operator|*
name|data
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vendor_id
operator|=
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|data
operator|+=
literal|4
expr_stmt|;
name|length
operator|-=
literal|4
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Vendor: %s (%u)"
operator|,
name|tok2str
argument_list|(
name|smi_values
argument_list|,
literal|"Unknown"
argument_list|,
name|vendor_id
argument_list|)
operator|,
name|vendor_id
operator|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|length
operator|>=
literal|2
condition|)
block|{
name|ND_TCHECK2
argument_list|(
operator|*
name|data
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|vendor_type
operator|=
operator|*
operator|(
name|data
operator|)
expr_stmt|;
name|vendor_length
operator|=
operator|*
operator|(
name|data
operator|+
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|vendor_length
operator|<
literal|2
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    Vendor Attribute: %u, Length: %u (bogus, must be>= 2)"
operator|,
name|vendor_type
operator|,
name|vendor_length
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|vendor_length
operator|>
name|length
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    Vendor Attribute: %u, Length: %u (bogus, goes past end of vendor-specific attribute)"
operator|,
name|vendor_type
operator|,
name|vendor_length
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|data
operator|+=
literal|2
expr_stmt|;
name|vendor_length
operator|-=
literal|2
expr_stmt|;
name|length
operator|-=
literal|2
expr_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|data
argument_list|,
name|vendor_length
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    Vendor Attribute: %u, Length: %u, Value: "
operator|,
name|vendor_type
operator|,
name|vendor_length
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|idx
operator|=
literal|0
init|;
name|idx
operator|<
name|vendor_length
condition|;
name|idx
operator|++
operator|,
name|data
operator|++
control|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%c"
operator|,
operator|(
operator|*
name|data
operator|<
literal|32
operator|||
operator|*
name|data
operator|>
literal|128
operator|)
condition|?
literal|'.'
else|:
operator|*
name|data
operator|)
argument_list|)
expr_stmt|;
name|length
operator|-=
name|vendor_length
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************/
end_comment

begin_comment
comment|/* Print an attribute numeric */
end_comment

begin_comment
comment|/* value pointed by 'data'    */
end_comment

begin_comment
comment|/* and 'length' size.         */
end_comment

begin_comment
comment|/******************************/
end_comment

begin_comment
comment|/* Returns nothing.           */
end_comment

begin_comment
comment|/******************************/
end_comment

begin_function
specifier|static
name|void
name|print_attr_num
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|register
name|u_char
modifier|*
name|data
parameter_list|,
name|u_int
name|length
parameter_list|,
name|u_short
name|attr_code
parameter_list|)
block|{
name|uint8_t
name|tag
decl_stmt|;
name|uint32_t
name|timeout
decl_stmt|;
if|if
condition|(
name|length
operator|!=
literal|4
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"ERROR: length %u != 4"
operator|,
name|length
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|/* This attribute has standard values */
if|if
condition|(
name|attr_type
index|[
name|attr_code
index|]
operator|.
name|siz_subtypes
condition|)
block|{
specifier|static
specifier|const
name|char
modifier|*
modifier|*
name|table
decl_stmt|;
name|uint32_t
name|data_value
decl_stmt|;
name|table
operator|=
name|attr_type
index|[
name|attr_code
index|]
operator|.
name|subtypes
expr_stmt|;
if|if
condition|(
operator|(
name|attr_code
operator|==
name|TUNNEL_TYPE
operator|)
operator|||
operator|(
name|attr_code
operator|==
name|TUNNEL_MEDIUM
operator|)
condition|)
block|{
if|if
condition|(
operator|!
operator|*
name|data
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Tag[Unused]"
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Tag[%d]"
operator|,
operator|*
name|data
operator|)
argument_list|)
expr_stmt|;
name|data
operator|++
expr_stmt|;
name|data_value
operator|=
name|EXTRACT_24BITS
argument_list|(
name|data
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|data_value
operator|=
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|data_value
operator|<=
call|(
name|uint32_t
call|)
argument_list|(
name|attr_type
index|[
name|attr_code
index|]
operator|.
name|siz_subtypes
operator|-
literal|1
operator|+
name|attr_type
index|[
name|attr_code
index|]
operator|.
name|first_subtype
argument_list|)
operator|&&
name|data_value
operator|>=
name|attr_type
index|[
name|attr_code
index|]
operator|.
name|first_subtype
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|table
index|[
name|data_value
index|]
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"#%u"
operator|,
name|data_value
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
switch|switch
condition|(
name|attr_code
condition|)
comment|/* Be aware of special cases... */
block|{
case|case
name|FRM_IPX
case|:
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
operator|==
literal|0xFFFFFFFE
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"NAS Select"
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%d"
operator|,
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SESSION_TIMEOUT
case|:
case|case
name|IDLE_TIMEOUT
case|:
case|case
name|ACCT_DELAY
case|:
case|case
name|ACCT_SESSION_TIME
case|:
case|case
name|ACCT_INT_INTERVAL
case|:
name|timeout
operator|=
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|timeout
operator|<
literal|60
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%02d secs"
operator|,
name|timeout
operator|)
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|timeout
operator|<
literal|3600
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%02d:%02d min"
operator|,
name|timeout
operator|/
literal|60
operator|,
name|timeout
operator|%
literal|60
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%02d:%02d:%02d hours"
operator|,
name|timeout
operator|/
literal|3600
operator|,
operator|(
name|timeout
operator|%
literal|3600
operator|)
operator|/
literal|60
operator|,
name|timeout
operator|%
literal|60
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|FRM_ATALK_LINK
case|:
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%d"
operator|,
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Unnumbered"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|FRM_ATALK_NETWORK
case|:
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%d"
operator|,
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"NAS assigned"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|TUNNEL_PREFERENCE
case|:
name|tag
operator|=
operator|*
name|data
expr_stmt|;
name|data
operator|++
expr_stmt|;
if|if
condition|(
name|tag
operator|==
literal|0
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Tag (Unused) %d"
operator|,
name|EXTRACT_24BITS
argument_list|(
name|data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Tag (%d) %d"
operator|,
name|tag
operator|,
name|EXTRACT_24BITS
argument_list|(
name|data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%d"
operator|,
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* switch */
block|}
comment|/* if-else */
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****************************/
end_comment

begin_comment
comment|/* Print an attribute IPv4   */
end_comment

begin_comment
comment|/* address value pointed by  */
end_comment

begin_comment
comment|/* 'data' and 'length' size. */
end_comment

begin_comment
comment|/*****************************/
end_comment

begin_comment
comment|/* Returns nothing.          */
end_comment

begin_comment
comment|/*****************************/
end_comment

begin_function
specifier|static
name|void
name|print_attr_address
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|register
name|u_char
modifier|*
name|data
parameter_list|,
name|u_int
name|length
parameter_list|,
name|u_short
name|attr_code
parameter_list|)
block|{
if|if
condition|(
name|length
operator|!=
literal|4
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"ERROR: length %u != 4"
operator|,
name|length
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
literal|4
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|attr_code
condition|)
block|{
case|case
name|FRM_IPADDR
case|:
case|case
name|LOG_IPHOST
case|:
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
operator|==
literal|0xFFFFFFFF
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"User Selected"
operator|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
operator|==
literal|0xFFFFFFFE
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"NAS Select"
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|data
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*************************************/
end_comment

begin_comment
comment|/* Print an attribute of 'secs since */
end_comment

begin_comment
comment|/* January 1, 1970 00:00 UTC' value  */
end_comment

begin_comment
comment|/* pointed by 'data' and 'length'    */
end_comment

begin_comment
comment|/* size.                             */
end_comment

begin_comment
comment|/*************************************/
end_comment

begin_comment
comment|/* Returns nothing.                  */
end_comment

begin_comment
comment|/*************************************/
end_comment

begin_function
specifier|static
name|void
name|print_attr_time
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|register
name|u_char
modifier|*
name|data
parameter_list|,
name|u_int
name|length
parameter_list|,
name|u_short
name|attr_code
name|_U_
parameter_list|)
block|{
name|time_t
name|attr_time
decl_stmt|;
name|char
name|string
index|[
literal|26
index|]
decl_stmt|;
if|if
condition|(
name|length
operator|!=
literal|4
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"ERROR: length %u != 4"
operator|,
name|length
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|attr_time
operator|=
name|EXTRACT_32BITS
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|string
argument_list|,
name|ctime
argument_list|(
operator|&
name|attr_time
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|string
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Get rid of the newline */
name|string
index|[
literal|24
index|]
operator|=
literal|'\0'
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%.24s"
operator|,
name|string
operator|)
argument_list|)
expr_stmt|;
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/***********************************/
end_comment

begin_comment
comment|/* Print an attribute of 'strange' */
end_comment

begin_comment
comment|/* data format pointed by 'data'   */
end_comment

begin_comment
comment|/* and 'length' size.              */
end_comment

begin_comment
comment|/***********************************/
end_comment

begin_comment
comment|/* Returns nothing.                */
end_comment

begin_comment
comment|/***********************************/
end_comment

begin_function
specifier|static
name|void
name|print_attr_strange
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|register
name|u_char
modifier|*
name|data
parameter_list|,
name|u_int
name|length
parameter_list|,
name|u_short
name|attr_code
parameter_list|)
block|{
name|u_short
name|len_data
decl_stmt|;
switch|switch
condition|(
name|attr_code
condition|)
block|{
case|case
name|ARAP_PASS
case|:
if|if
condition|(
name|length
operator|!=
literal|16
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"ERROR: length %u != 16"
operator|,
name|length
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"User_challenge ("
operator|)
argument_list|)
expr_stmt|;
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|len_data
operator|=
literal|8
expr_stmt|;
name|PRINT_HEX
argument_list|(
name|len_data
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|") User_resp("
operator|)
argument_list|)
expr_stmt|;
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|len_data
operator|=
literal|8
expr_stmt|;
name|PRINT_HEX
argument_list|(
name|len_data
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|")"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ARAP_FEATURES
case|:
if|if
condition|(
name|length
operator|!=
literal|14
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"ERROR: length %u != 14"
operator|,
name|length
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|data
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"User can change password"
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"User cannot change password"
operator|)
argument_list|)
expr_stmt|;
name|data
operator|++
expr_stmt|;
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", Min password length: %d"
operator|,
operator|*
name|data
operator|)
argument_list|)
expr_stmt|;
name|data
operator|++
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", created at: "
operator|)
argument_list|)
expr_stmt|;
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|len_data
operator|=
literal|4
expr_stmt|;
name|PRINT_HEX
argument_list|(
name|len_data
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", expires in: "
operator|)
argument_list|)
expr_stmt|;
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|len_data
operator|=
literal|4
expr_stmt|;
name|PRINT_HEX
argument_list|(
name|len_data
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|", Current Time: "
operator|)
argument_list|)
expr_stmt|;
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|len_data
operator|=
literal|4
expr_stmt|;
name|PRINT_HEX
argument_list|(
name|len_data
argument_list|,
name|data
argument_list|)
expr_stmt|;
break|break;
case|case
name|ARAP_CHALLENGE_RESP
case|:
if|if
condition|(
name|length
operator|<
literal|8
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"ERROR: length %u != 8"
operator|,
name|length
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|ND_TCHECK2
argument_list|(
name|data
index|[
literal|0
index|]
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|len_data
operator|=
literal|8
expr_stmt|;
name|PRINT_HEX
argument_list|(
name|len_data
argument_list|,
name|data
argument_list|)
expr_stmt|;
break|break;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|radius_attrs_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|register
specifier|const
name|u_char
modifier|*
name|attr
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
specifier|register
specifier|const
name|struct
name|radius_attr
modifier|*
name|rad_attr
init|=
operator|(
expr|struct
name|radius_attr
operator|*
operator|)
name|attr
decl_stmt|;
specifier|const
name|char
modifier|*
name|attr_string
decl_stmt|;
while|while
condition|(
name|length
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|length
operator|<
literal|2
condition|)
goto|goto
name|trunc
goto|;
name|ND_TCHECK
argument_list|(
operator|*
name|rad_attr
argument_list|)
expr_stmt|;
if|if
condition|(
name|rad_attr
operator|->
name|type
operator|>
literal|0
operator|&&
name|rad_attr
operator|->
name|type
operator|<
name|TAM_SIZE
argument_list|(
name|attr_type
argument_list|)
condition|)
name|attr_string
operator|=
name|attr_type
index|[
name|rad_attr
operator|->
name|type
index|]
operator|.
name|name
expr_stmt|;
else|else
name|attr_string
operator|=
literal|"Unknown"
expr_stmt|;
if|if
condition|(
name|rad_attr
operator|->
name|len
operator|<
literal|2
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  %s Attribute (%u), length: %u (bogus, must be>= 2)"
operator|,
name|attr_string
operator|,
name|rad_attr
operator|->
name|type
operator|,
name|rad_attr
operator|->
name|len
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|rad_attr
operator|->
name|len
operator|>
name|length
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  %s Attribute (%u), length: %u (bogus, goes past end of packet)"
operator|,
name|attr_string
operator|,
name|rad_attr
operator|->
name|type
operator|,
name|rad_attr
operator|->
name|len
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  %s Attribute (%u), length: %u, Value: "
operator|,
name|attr_string
operator|,
name|rad_attr
operator|->
name|type
operator|,
name|rad_attr
operator|->
name|len
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|rad_attr
operator|->
name|type
operator|<
name|TAM_SIZE
argument_list|(
name|attr_type
argument_list|)
condition|)
block|{
if|if
condition|(
name|rad_attr
operator|->
name|len
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|attr_type
index|[
name|rad_attr
operator|->
name|type
index|]
operator|.
name|print_func
condition|)
operator|(
operator|*
name|attr_type
index|[
name|rad_attr
operator|->
name|type
index|]
operator|.
name|print_func
operator|)
operator|(
name|ndo
operator|,
operator|(
operator|(
name|u_char
operator|*
operator|)
operator|(
name|rad_attr
operator|+
literal|1
operator|)
operator|)
operator|,
name|rad_attr
operator|->
name|len
operator|-
literal|2
operator|,
name|rad_attr
operator|->
name|type
operator|)
expr_stmt|;
block|}
block|}
comment|/* do we also want to see a hex dump ? */
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|1
condition|)
name|print_unknown_data
argument_list|(
name|ndo
argument_list|,
operator|(
name|u_char
operator|*
operator|)
name|rad_attr
operator|+
literal|2
argument_list|,
literal|"\n\t    "
argument_list|,
operator|(
name|rad_attr
operator|->
name|len
operator|)
operator|-
literal|2
argument_list|)
expr_stmt|;
name|length
operator|-=
operator|(
name|rad_attr
operator|->
name|len
operator|)
expr_stmt|;
name|rad_attr
operator|=
operator|(
expr|struct
name|radius_attr
operator|*
operator|)
operator|(
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|rad_attr
operator|)
operator|)
operator|+
name|rad_attr
operator|->
name|len
operator|)
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|radius_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
specifier|register
specifier|const
name|struct
name|radius_hdr
modifier|*
name|rad
decl_stmt|;
name|u_int
name|len
decl_stmt|,
name|auth_idx
decl_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|dat
argument_list|,
name|MIN_RADIUS_LEN
argument_list|)
expr_stmt|;
name|rad
operator|=
operator|(
expr|struct
name|radius_hdr
operator|*
operator|)
name|dat
expr_stmt|;
name|len
operator|=
name|EXTRACT_16BITS
argument_list|(
operator|&
name|rad
operator|->
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|<
name|MIN_RADIUS_LEN
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|len
operator|>
name|length
condition|)
name|len
operator|=
name|length
expr_stmt|;
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|<
literal|1
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"RADIUS, %s (%u), id: 0x%02x length: %u"
operator|,
name|tok2str
argument_list|(
name|radius_command_values
argument_list|,
literal|"Unknown Command"
argument_list|,
name|rad
operator|->
name|code
argument_list|)
operator|,
name|rad
operator|->
name|code
operator|,
name|rad
operator|->
name|id
operator|,
name|len
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
else|else
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"RADIUS, length: %u\n\t%s (%u), id: 0x%02x, Authenticator: "
operator|,
name|len
operator|,
name|tok2str
argument_list|(
name|radius_command_values
argument_list|,
literal|"Unknown Command"
argument_list|,
name|rad
operator|->
name|code
argument_list|)
operator|,
name|rad
operator|->
name|code
operator|,
name|rad
operator|->
name|id
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|auth_idx
operator|=
literal|0
init|;
name|auth_idx
operator|<
literal|16
condition|;
name|auth_idx
operator|++
control|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%02x"
operator|,
name|rad
operator|->
name|auth
index|[
name|auth_idx
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|len
operator|>
name|MIN_RADIUS_LEN
condition|)
name|radius_attrs_print
argument_list|(
name|ndo
argument_list|,
name|dat
operator|+
name|MIN_RADIUS_LEN
argument_list|,
name|len
operator|-
name|MIN_RADIUS_LEN
argument_list|)
expr_stmt|;
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

