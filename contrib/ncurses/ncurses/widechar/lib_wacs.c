begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/****************************************************************************  * Copyright (c) 2002-2013,2014 Free Software Foundation, Inc.              *  *                                                                          *  * Permission is hereby granted, free of charge, to any person obtaining a  *  * copy of this software and associated documentation files (the            *  * "Software"), to deal in the Software without restriction, including      *  * without limitation the rights to use, copy, modify, merge, publish,      *  * distribute, distribute with modifications, sublicense, and/or sell       *  * copies of the Software, and to permit persons to whom the Software is    *  * furnished to do so, subject to the following conditions:                 *  *                                                                          *  * The above copyright notice and this permission notice shall be included  *  * in all copies or substantial portions of the Software.                   *  *                                                                          *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS  *  * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF               *  * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.   *  * IN NO EVENT SHALL THE ABOVE COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,   *  * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR    *  * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR    *  * THE USE OR OTHER DEALINGS IN THE SOFTWARE.                               *  *                                                                          *  * Except as contained in this notice, the name(s) of the above copyright   *  * holders shall not be used in advertising or otherwise to promote the     *  * sale, use or other dealings in this Software without prior written       *  * authorization.                                                           *  ****************************************************************************/
end_comment

begin_comment
comment|/****************************************************************************  *  Author: Thomas Dickey 2002                                              *  ****************************************************************************/
end_comment

begin_include
include|#
directive|include
file|<curses.priv.h>
end_include

begin_macro
name|MODULE_ID
argument_list|(
literal|"$Id: lib_wacs.c,v 1.14 2014/02/23 01:21:08 tom Exp $"
argument_list|)
end_macro

begin_expr_stmt
name|NCURSES_EXPORT_VAR
argument_list|(
name|cchar_t
argument_list|)
operator|*
name|_nc_wacs
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_macro
name|NCURSES_EXPORT
argument_list|(
argument|void
argument_list|)
end_macro

begin_macro
name|_nc_init_wacs
argument_list|(
argument|void
argument_list|)
end_macro

begin_block
block|{
comment|/* *INDENT-OFF* */
specifier|static
specifier|const
struct|struct
block|{
name|unsigned
name|map
decl_stmt|;
name|int
name|value
index|[
literal|2
index|]
decl_stmt|;
block|}
name|table
index|[]
init|=
block|{
comment|/* VT100 symbols */
block|{
literal|'l'
block|,
block|{
literal|'+'
block|,
literal|0x250c
block|}
block|}
block|,
comment|/* upper left corner */
block|{
literal|'m'
block|,
block|{
literal|'+'
block|,
literal|0x2514
block|}
block|}
block|,
comment|/* lower left corner */
block|{
literal|'k'
block|,
block|{
literal|'+'
block|,
literal|0x2510
block|}
block|}
block|,
comment|/* upper right corner */
block|{
literal|'j'
block|,
block|{
literal|'+'
block|,
literal|0x2518
block|}
block|}
block|,
comment|/* lower right corner */
block|{
literal|'t'
block|,
block|{
literal|'+'
block|,
literal|0x251c
block|}
block|}
block|,
comment|/* tee pointing left */
block|{
literal|'u'
block|,
block|{
literal|'+'
block|,
literal|0x2524
block|}
block|}
block|,
comment|/* tee pointing right */
block|{
literal|'v'
block|,
block|{
literal|'+'
block|,
literal|0x2534
block|}
block|}
block|,
comment|/* tee pointing up */
block|{
literal|'w'
block|,
block|{
literal|'+'
block|,
literal|0x252c
block|}
block|}
block|,
comment|/* tee pointing down */
block|{
literal|'q'
block|,
block|{
literal|'-'
block|,
literal|0x2500
block|}
block|}
block|,
comment|/* horizontal line */
block|{
literal|'x'
block|,
block|{
literal|'|'
block|,
literal|0x2502
block|}
block|}
block|,
comment|/* vertical line */
block|{
literal|'n'
block|,
block|{
literal|'+'
block|,
literal|0x253c
block|}
block|}
block|,
comment|/* large plus or crossover */
block|{
literal|'o'
block|,
block|{
literal|'~'
block|,
literal|0x23ba
block|}
block|}
block|,
comment|/* scan line 1 */
block|{
literal|'s'
block|,
block|{
literal|'_'
block|,
literal|0x23bd
block|}
block|}
block|,
comment|/* scan line 9 */
block|{
literal|'`'
block|,
block|{
literal|'+'
block|,
literal|0x25c6
block|}
block|}
block|,
comment|/* diamond */
block|{
literal|'a'
block|,
block|{
literal|':'
block|,
literal|0x2592
block|}
block|}
block|,
comment|/* checker board (stipple) */
block|{
literal|'f'
block|,
block|{
literal|'\''
block|,
literal|0x00b0
block|}
block|}
block|,
comment|/* degree symbol */
block|{
literal|'g'
block|,
block|{
literal|'#'
block|,
literal|0x00b1
block|}
block|}
block|,
comment|/* plus/minus */
block|{
literal|'~'
block|,
block|{
literal|'o'
block|,
literal|0x00b7
block|}
block|}
block|,
comment|/* bullet */
comment|/* Teletype 5410v1 symbols */
block|{
literal|','
block|,
block|{
literal|'<'
block|,
literal|0x2190
block|}
block|}
block|,
comment|/* arrow pointing left */
block|{
literal|'+'
block|,
block|{
literal|'>'
block|,
literal|0x2192
block|}
block|}
block|,
comment|/* arrow pointing right */
block|{
literal|'.'
block|,
block|{
literal|'v'
block|,
literal|0x2193
block|}
block|}
block|,
comment|/* arrow pointing down */
block|{
literal|'-'
block|,
block|{
literal|'^'
block|,
literal|0x2191
block|}
block|}
block|,
comment|/* arrow pointing up */
block|{
literal|'h'
block|,
block|{
literal|'#'
block|,
literal|0x2592
block|}
block|}
block|,
comment|/* board of squares */
block|{
literal|'i'
block|,
block|{
literal|'#'
block|,
literal|0x2603
block|}
block|}
block|,
comment|/* lantern symbol */
block|{
literal|'0'
block|,
block|{
literal|'#'
block|,
literal|0x25ae
block|}
block|}
block|,
comment|/* solid square block */
comment|/* these defaults were invented for ncurses */
block|{
literal|'p'
block|,
block|{
literal|'-'
block|,
literal|0x23bb
block|}
block|}
block|,
comment|/* scan line 3 */
block|{
literal|'r'
block|,
block|{
literal|'-'
block|,
literal|0x23bc
block|}
block|}
block|,
comment|/* scan line 7 */
block|{
literal|'y'
block|,
block|{
literal|'<'
block|,
literal|0x2264
block|}
block|}
block|,
comment|/* less-than-or-equal-to */
block|{
literal|'z'
block|,
block|{
literal|'>'
block|,
literal|0x2265
block|}
block|}
block|,
comment|/* greater-than-or-equal-to */
block|{
literal|'{'
block|,
block|{
literal|'*'
block|,
literal|0x03c0
block|}
block|}
block|,
comment|/* greek pi */
block|{
literal|'|'
block|,
block|{
literal|'!'
block|,
literal|0x2260
block|}
block|}
block|,
comment|/* not-equal */
block|{
literal|'}'
block|,
block|{
literal|'f'
block|,
literal|0x00a3
block|}
block|}
block|,
comment|/* pound-sterling symbol */
comment|/* thick-line-drawing */
block|{
literal|'L'
block|,
block|{
literal|'+'
block|,
literal|0x250f
block|}
block|}
block|,
comment|/* upper left corner */
block|{
literal|'M'
block|,
block|{
literal|'+'
block|,
literal|0x2517
block|}
block|}
block|,
comment|/* lower left corner */
block|{
literal|'K'
block|,
block|{
literal|'+'
block|,
literal|0x2513
block|}
block|}
block|,
comment|/* upper right corner */
block|{
literal|'J'
block|,
block|{
literal|'+'
block|,
literal|0x251b
block|}
block|}
block|,
comment|/* lower right corner */
block|{
literal|'T'
block|,
block|{
literal|'+'
block|,
literal|0x2523
block|}
block|}
block|,
comment|/* tee pointing left */
block|{
literal|'U'
block|,
block|{
literal|'+'
block|,
literal|0x252b
block|}
block|}
block|,
comment|/* tee pointing right */
block|{
literal|'V'
block|,
block|{
literal|'+'
block|,
literal|0x253b
block|}
block|}
block|,
comment|/* tee pointing up */
block|{
literal|'W'
block|,
block|{
literal|'+'
block|,
literal|0x2533
block|}
block|}
block|,
comment|/* tee pointing down */
block|{
literal|'Q'
block|,
block|{
literal|'-'
block|,
literal|0x2501
block|}
block|}
block|,
comment|/* horizontal line */
block|{
literal|'X'
block|,
block|{
literal|'|'
block|,
literal|0x2503
block|}
block|}
block|,
comment|/* vertical line */
block|{
literal|'N'
block|,
block|{
literal|'+'
block|,
literal|0x254b
block|}
block|}
block|,
comment|/* large plus or crossover */
comment|/* double-line-drawing */
block|{
literal|'C'
block|,
block|{
literal|'+'
block|,
literal|0x2554
block|}
block|}
block|,
comment|/* upper left corner */
block|{
literal|'D'
block|,
block|{
literal|'+'
block|,
literal|0x255a
block|}
block|}
block|,
comment|/* lower left corner */
block|{
literal|'B'
block|,
block|{
literal|'+'
block|,
literal|0x2557
block|}
block|}
block|,
comment|/* upper right corner */
block|{
literal|'A'
block|,
block|{
literal|'+'
block|,
literal|0x255d
block|}
block|}
block|,
comment|/* lower right corner */
block|{
literal|'G'
block|,
block|{
literal|'+'
block|,
literal|0x2563
block|}
block|}
block|,
comment|/* tee pointing left */
block|{
literal|'F'
block|,
block|{
literal|'+'
block|,
literal|0x2560
block|}
block|}
block|,
comment|/* tee pointing right */
block|{
literal|'H'
block|,
block|{
literal|'+'
block|,
literal|0x2569
block|}
block|}
block|,
comment|/* tee pointing up */
block|{
literal|'I'
block|,
block|{
literal|'+'
block|,
literal|0x2566
block|}
block|}
block|,
comment|/* tee pointing down */
block|{
literal|'R'
block|,
block|{
literal|'-'
block|,
literal|0x2550
block|}
block|}
block|,
comment|/* horizontal line */
block|{
literal|'Y'
block|,
block|{
literal|'|'
block|,
literal|0x2551
block|}
block|}
block|,
comment|/* vertical line */
block|{
literal|'E'
block|,
block|{
literal|'+'
block|,
literal|0x256c
block|}
block|}
block|,
comment|/* large plus or crossover */
block|}
struct|;
comment|/* *INDENT-ON* */
name|unsigned
name|n
decl_stmt|,
name|m
decl_stmt|;
name|int
name|active
init|=
name|_nc_unicode_locale
argument_list|()
decl_stmt|;
comment|/*      * If we're running in a UTF-8 locale, will use the Unicode equivalents      * rather than the terminfo information.  Actually the terminfo should      * be the rule, but there are people who are offended by the notion that      * a Unicode-capable terminal would have something resembling a mode.      * So the smacs/rmacs may be disabled -- sometime.      */
name|T
argument_list|(
operator|(
literal|"initializing WIDE-ACS map (Unicode is%s active)"
operator|,
name|active
condition|?
literal|""
else|:
literal|" not"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|_nc_wacs
operator|=
name|typeCalloc
argument_list|(
name|cchar_t
argument_list|,
name|ACS_LEN
argument_list|)
operator|)
operator|!=
literal|0
condition|)
block|{
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|SIZEOF
argument_list|(
name|table
argument_list|)
condition|;
operator|++
name|n
control|)
block|{
name|int
name|wide
init|=
name|wcwidth
argument_list|(
operator|(
name|wchar_t
operator|)
name|table
index|[
name|n
index|]
operator|.
name|value
index|[
name|active
index|]
argument_list|)
decl_stmt|;
name|m
operator|=
name|table
index|[
name|n
index|]
operator|.
name|map
expr_stmt|;
if|if
condition|(
name|active
operator|&&
operator|(
name|wide
operator|==
literal|1
operator|)
condition|)
block|{
name|SetChar
argument_list|(
name|_nc_wacs
index|[
name|m
index|]
argument_list|,
name|table
index|[
name|n
index|]
operator|.
name|value
index|[
literal|1
index|]
argument_list|,
name|A_NORMAL
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|acs_map
index|[
name|m
index|]
operator|&
name|A_ALTCHARSET
condition|)
block|{
name|SetChar
argument_list|(
name|_nc_wacs
index|[
name|m
index|]
argument_list|,
name|m
argument_list|,
name|A_ALTCHARSET
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SetChar
argument_list|(
name|_nc_wacs
index|[
name|m
index|]
argument_list|,
name|table
index|[
name|n
index|]
operator|.
name|value
index|[
literal|0
index|]
argument_list|,
name|A_NORMAL
argument_list|)
expr_stmt|;
block|}
name|T
argument_list|(
operator|(
literal|"#%d, SetChar(%c, %#04x) = %s"
operator|,
name|n
operator|,
name|m
operator|,
name|table
index|[
name|n
index|]
operator|.
name|value
index|[
name|active
index|]
operator|,
name|_tracecchar_t
argument_list|(
operator|&
name|_nc_wacs
index|[
name|m
index|]
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

end_unit

