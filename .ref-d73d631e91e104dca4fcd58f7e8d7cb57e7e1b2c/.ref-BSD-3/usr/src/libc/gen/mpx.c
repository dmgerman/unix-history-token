begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/tty.h>
end_include

begin_include
include|#
directive|include
file|<sys/mx.h>
end_include

begin_decl_stmt
specifier|static
name|struct
name|mx_args
name|vec
decl_stmt|;
end_decl_stmt

begin_function_decl
name|int
name|mpxcall
parameter_list|()
function_decl|;
end_function_decl

begin_macro
name|mpx
argument_list|(
argument|name
argument_list|,
argument|mode
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|name
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
operator|*
name|name
condition|)
block|{
name|vec
operator|.
name|m_name
operator|=
name|name
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|1
index|]
operator|=
name|mode
expr_stmt|;
return|return
operator|(
name|mpxcall
argument_list|(
name|MPX
argument_list|,
operator|&
name|vec
argument_list|)
operator|)
return|;
block|}
else|else
return|return
operator|(
name|mpxcall
argument_list|(
name|MPXN
argument_list|,
literal|0
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|chan
argument_list|(
argument|gr
argument_list|)
end_macro

begin_block
block|{
name|vec
operator|.
name|m_arg
index|[
literal|1
index|]
operator|=
name|gr
expr_stmt|;
return|return
operator|(
name|mpxcall
argument_list|(
name|CHAN
argument_list|,
operator|&
name|vec
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|join
argument_list|(
argument|fd
argument_list|,
argument|ch
argument_list|)
end_macro

begin_block
block|{
name|vec
operator|.
name|m_arg
index|[
literal|0
index|]
operator|=
name|fd
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|1
index|]
operator|=
name|ch
expr_stmt|;
return|return
operator|(
name|mpxcall
argument_list|(
name|JOIN
argument_list|,
operator|&
name|vec
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|connect
argument_list|(
argument|fd
argument_list|,
argument|ch
argument_list|,
argument|side
argument_list|)
end_macro

begin_block
block|{
name|vec
operator|.
name|m_arg
index|[
literal|0
index|]
operator|=
name|fd
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|1
index|]
operator|=
name|ch
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|2
index|]
operator|=
name|side
expr_stmt|;
return|return
operator|(
name|mpxcall
argument_list|(
name|CONNECT
argument_list|,
operator|&
name|vec
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|attach
argument_list|(
argument|sub
argument_list|,
argument|gp
argument_list|)
end_macro

begin_block
block|{
name|vec
operator|.
name|m_arg
index|[
literal|0
index|]
operator|=
name|sub
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|1
index|]
operator|=
name|gp
expr_stmt|;
return|return
operator|(
name|mpxcall
argument_list|(
name|ATTACH
argument_list|,
operator|&
name|vec
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|detach
argument_list|(
argument|sub
argument_list|,
argument|gp
argument_list|)
end_macro

begin_block
block|{
name|vec
operator|.
name|m_arg
index|[
literal|0
index|]
operator|=
name|sub
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|1
index|]
operator|=
name|gp
expr_stmt|;
return|return
operator|(
name|mpxcall
argument_list|(
name|DETACH
argument_list|,
operator|&
name|vec
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|extract
argument_list|(
argument|sub
argument_list|,
argument|ch
argument_list|,
argument|side
argument_list|)
end_macro

begin_block
block|{
name|vec
operator|.
name|m_arg
index|[
literal|0
index|]
operator|=
name|sub
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|1
index|]
operator|=
name|ch
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|2
index|]
operator|=
name|side
expr_stmt|;
return|return
operator|(
name|mpxcall
argument_list|(
name|EXTR
argument_list|,
operator|&
name|vec
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|debug
argument_list|(
argument|var
argument_list|,
argument|val
argument_list|)
end_macro

begin_block
block|{
name|vec
operator|.
name|m_arg
index|[
literal|0
index|]
operator|=
name|var
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|1
index|]
operator|=
name|val
expr_stmt|;
return|return
operator|(
name|mpxcall
argument_list|(
name|DEBUG
argument_list|,
operator|&
name|vec
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|npgrp
argument_list|(
argument|ch
argument_list|,
argument|gfd
argument_list|,
argument|pid
argument_list|)
end_macro

begin_block
block|{
name|vec
operator|.
name|m_arg
index|[
literal|0
index|]
operator|=
name|ch
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|1
index|]
operator|=
name|gfd
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|2
index|]
operator|=
name|pid
expr_stmt|;
return|return
operator|(
name|mpxcall
argument_list|(
name|NPGRP
argument_list|,
operator|&
name|vec
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|ckill
argument_list|(
argument|index
argument_list|,
argument|gp
argument_list|,
argument|sig
argument_list|)
end_macro

begin_block
block|{
name|vec
operator|.
name|m_arg
index|[
literal|0
index|]
operator|=
name|index
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|1
index|]
operator|=
name|gp
expr_stmt|;
name|vec
operator|.
name|m_arg
index|[
literal|2
index|]
operator|=
name|sig
expr_stmt|;
return|return
operator|(
name|mpxcall
argument_list|(
name|CSIG
argument_list|,
operator|&
name|vec
argument_list|)
operator|)
return|;
block|}
end_block

end_unit

