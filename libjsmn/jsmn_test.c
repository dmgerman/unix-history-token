begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_decl_stmt
specifier|static
name|int
name|test_passed
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|test_failed
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Terminate current test with error */
end_comment

begin_define
define|#
directive|define
name|fail
parameter_list|()
value|return __LINE__
end_define

begin_comment
comment|/* Successfull end of the test case */
end_comment

begin_define
define|#
directive|define
name|done
parameter_list|()
value|return 0
end_define

begin_comment
comment|/* Check single condition */
end_comment

begin_define
define|#
directive|define
name|check
parameter_list|(
name|cond
parameter_list|)
value|do { if (!(cond)) fail(); } while (0)
end_define

begin_comment
comment|/* Test runner */
end_comment

begin_function
specifier|static
name|void
name|test
parameter_list|(
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|(
name|void
parameter_list|)
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|int
name|r
init|=
name|func
argument_list|()
decl_stmt|;
if|if
condition|(
name|r
operator|==
literal|0
condition|)
block|{
name|test_passed
operator|++
expr_stmt|;
block|}
else|else
block|{
name|test_failed
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"FAILED: %s (at line %d)\n"
argument_list|,
name|name
argument_list|,
name|r
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|TOKEN_EQ
parameter_list|(
name|t
parameter_list|,
name|tok_start
parameter_list|,
name|tok_end
parameter_list|,
name|tok_type
parameter_list|)
define|\
value|((t).start == tok_start \&& (t).end == tok_end  \&& (t).type == (tok_type))
end_define

begin_define
define|#
directive|define
name|TOKEN_STRING
parameter_list|(
name|js
parameter_list|,
name|t
parameter_list|,
name|s
parameter_list|)
define|\
value|(strncmp(js+(t).start, s, (t).end - (t).start) == 0 \&& strlen(s) == (t).end - (t).start)
end_define

begin_define
define|#
directive|define
name|TOKEN_PRINT
parameter_list|(
name|t
parameter_list|)
define|\
value|printf("start: %d, end: %d, type: %d, size: %d\n", \ 			(t).start, (t).end, (t).type, (t).size)
end_define

begin_define
define|#
directive|define
name|JSMN_STRICT
end_define

begin_include
include|#
directive|include
file|"jsmn.c"
end_include

begin_function
name|int
name|test_empty
parameter_list|()
block|{
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|t
index|[
literal|10
index|]
decl_stmt|;
name|js
operator|=
literal|"{}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|t
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|t
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_OBJECT
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|t
index|[
literal|0
index|]
operator|.
name|start
operator|==
literal|0
operator|&&
name|t
index|[
literal|0
index|]
operator|.
name|end
operator|==
literal|2
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|t
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|t
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|t
index|[
literal|0
index|]
operator|.
name|start
operator|==
literal|0
operator|&&
name|t
index|[
literal|0
index|]
operator|.
name|end
operator|==
literal|2
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\":[]}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|t
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|t
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_OBJECT
operator|&&
name|t
index|[
literal|0
index|]
operator|.
name|start
operator|==
literal|0
operator|&&
name|t
index|[
literal|0
index|]
operator|.
name|end
operator|==
literal|8
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|t
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|t
index|[
literal|1
index|]
operator|.
name|start
operator|==
literal|2
operator|&&
name|t
index|[
literal|1
index|]
operator|.
name|end
operator|==
literal|3
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|t
index|[
literal|2
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
operator|&&
name|t
index|[
literal|2
index|]
operator|.
name|start
operator|==
literal|5
operator|&&
name|t
index|[
literal|2
index|]
operator|.
name|end
operator|==
literal|7
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[{},{}]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|t
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|t
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
operator|&&
name|t
index|[
literal|0
index|]
operator|.
name|start
operator|==
literal|0
operator|&&
name|t
index|[
literal|0
index|]
operator|.
name|end
operator|==
literal|7
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|t
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_OBJECT
operator|&&
name|t
index|[
literal|1
index|]
operator|.
name|start
operator|==
literal|1
operator|&&
name|t
index|[
literal|1
index|]
operator|.
name|end
operator|==
literal|3
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|t
index|[
literal|2
index|]
operator|.
name|type
operator|==
name|JSMN_OBJECT
operator|&&
name|t
index|[
literal|2
index|]
operator|.
name|start
operator|==
literal|4
operator|&&
name|t
index|[
literal|2
index|]
operator|.
name|end
operator|==
literal|6
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_simple
parameter_list|()
block|{
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tokens
index|[
literal|10
index|]
decl_stmt|;
name|js
operator|=
literal|"{\"a\": 0}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_EQ
argument_list|(
name|tokens
index|[
literal|0
index|]
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|,
name|JSMN_OBJECT
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_EQ
argument_list|(
name|tokens
index|[
literal|1
index|]
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|JSMN_STRING
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_EQ
argument_list|(
name|tokens
index|[
literal|2
index|]
argument_list|,
literal|6
argument_list|,
literal|7
argument_list|,
name|JSMN_PRIMITIVE
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tokens
index|[
literal|0
index|]
argument_list|,
name|js
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tokens
index|[
literal|1
index|]
argument_list|,
literal|"a"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tokens
index|[
literal|2
index|]
argument_list|,
literal|"0"
argument_list|)
argument_list|)
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[\"a\":{},\"b\":{}]"
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\n \"Day\": 26,\n \"Month\": 9,\n \"Year\": 12\n }"
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_primitive
parameter_list|()
block|{
ifndef|#
directive|ifndef
name|JSMN_STRICT
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tok
index|[
literal|10
index|]
decl_stmt|;
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|js
operator|=
literal|"\"boolVar\" : true"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"boolVar"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|1
index|]
argument_list|,
literal|"true"
argument_list|)
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"\"boolVar\" : false"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"boolVar"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|1
index|]
argument_list|,
literal|"false"
argument_list|)
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"\"intVar\" : 12345"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"intVar"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|1
index|]
argument_list|,
literal|"12345"
argument_list|)
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"\"floatVar\" : 12.345"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"floatVar"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|1
index|]
argument_list|,
literal|"12.345"
argument_list|)
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"\"nullVar\" : null"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"nullVar"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|1
index|]
argument_list|,
literal|"null"
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_string
parameter_list|()
block|{
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tok
index|[
literal|10
index|]
decl_stmt|;
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|js
operator|=
literal|"\"strVar\" : \"hello world\""
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"strVar"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|1
index|]
argument_list|,
literal|"hello world"
argument_list|)
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"\"strVar\" : \"escapes: \\/\\r\\n\\t\\b\\f\\\"\\\\\""
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"strVar"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|1
index|]
argument_list|,
literal|"escapes: \\/\\r\\n\\t\\b\\f\\\"\\\\"
argument_list|)
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"\"strVar\" : \"\""
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"strVar"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|1
index|]
argument_list|,
literal|""
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_partial_string
parameter_list|()
block|{
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tok
index|[
literal|10
index|]
decl_stmt|;
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"\"x\": \"va"
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_PART
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"x"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|p
operator|.
name|toknext
operator|==
literal|1
argument_list|)
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|char
name|js_slash
index|[
literal|9
index|]
init|=
literal|"\"x\": \"va\\"
decl_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js_slash
argument_list|,
sizeof|sizeof
argument_list|(
name|js_slash
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_PART
argument_list|)
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|char
name|js_unicode
index|[
literal|10
index|]
init|=
literal|"\"x\": \"va\\u"
decl_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js_unicode
argument_list|,
sizeof|sizeof
argument_list|(
name|js_unicode
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_PART
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"\"x\": \"valu"
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_PART
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"x"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|p
operator|.
name|toknext
operator|==
literal|1
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"\"x\": \"value\""
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"x"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|1
index|]
argument_list|,
literal|"value"
argument_list|)
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"\"x\": \"value\", \"y\": \"value y\""
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|2
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|3
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"x"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|1
index|]
argument_list|,
literal|"value"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|2
index|]
argument_list|,
literal|"y"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|3
index|]
argument_list|,
literal|"value y"
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_unquoted_keys
parameter_list|()
block|{
ifndef|#
directive|ifndef
name|JSMN_STRICT
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tok
index|[
literal|10
index|]
decl_stmt|;
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"key1: \"value\"\nkey2 : 123"
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
operator|&&
name|tok
index|[
literal|2
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
operator|&&
name|tok
index|[
literal|3
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|0
index|]
argument_list|,
literal|"key1"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|1
index|]
argument_list|,
literal|"value"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|2
index|]
argument_list|,
literal|"key2"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tok
index|[
literal|3
index|]
argument_list|,
literal|"123"
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_partial_array
parameter_list|()
block|{
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tok
index|[
literal|10
index|]
decl_stmt|;
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"  [ 1, true, "
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_PART
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
operator|&&
name|tok
index|[
literal|2
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"  [ 1, true, [123, \"hello"
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_PART
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
operator|&&
name|tok
index|[
literal|2
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
operator|&&
name|tok
index|[
literal|3
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
operator|&&
name|tok
index|[
literal|4
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"  [ 1, true, [123, \"hello\"]"
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_PART
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
operator|&&
name|tok
index|[
literal|2
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
operator|&&
name|tok
index|[
literal|3
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
operator|&&
name|tok
index|[
literal|4
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
operator|&&
name|tok
index|[
literal|5
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
argument_list|)
expr_stmt|;
comment|/* check child nodes of the 2nd array */
name|check
argument_list|(
name|tok
index|[
literal|3
index|]
operator|.
name|size
operator|==
literal|2
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"  [ 1, true, [123, \"hello\"]]"
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tok
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
operator|&&
name|tok
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
operator|&&
name|tok
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
operator|&&
name|tok
index|[
literal|2
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
operator|&&
name|tok
index|[
literal|3
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
operator|&&
name|tok
index|[
literal|4
index|]
operator|.
name|type
operator|==
name|JSMN_PRIMITIVE
operator|&&
name|tok
index|[
literal|5
index|]
operator|.
name|type
operator|==
name|JSMN_STRING
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|tok
index|[
literal|3
index|]
operator|.
name|size
operator|==
literal|2
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|tok
index|[
literal|0
index|]
operator|.
name|size
operator|==
literal|3
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_array_nomem
parameter_list|()
block|{
name|int
name|i
decl_stmt|;
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|toksmall
index|[
literal|10
index|]
decl_stmt|,
name|toklarge
index|[
literal|10
index|]
decl_stmt|;
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|js
operator|=
literal|"  [ 1, true, [123, \"hello\"]]"
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
block|{
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|toksmall
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|toksmall
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|toklarge
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|toklarge
argument_list|)
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|toksmall
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_NOMEM
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|toklarge
argument_list|,
name|toksmall
argument_list|,
sizeof|sizeof
argument_list|(
name|toksmall
argument_list|)
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|toklarge
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|toklarge
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
operator|&&
name|toklarge
index|[
literal|0
index|]
operator|.
name|size
operator|==
literal|3
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|toklarge
index|[
literal|3
index|]
operator|.
name|type
operator|==
name|JSMN_ARRAY
operator|&&
name|toklarge
index|[
literal|3
index|]
operator|.
name|size
operator|==
literal|2
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_objects_arrays
parameter_list|()
block|{
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tokens
index|[
literal|10
index|]
decl_stmt|;
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|js
operator|=
literal|"[10}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_INVAL
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[10]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\": 1]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_INVAL
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\": 1}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_issue_22
parameter_list|()
block|{
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tokens
index|[
literal|128
index|]
decl_stmt|;
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|js
operator|=
literal|"{ \"height\":10, \"layers\":[ { \"data\":[6,6], \"height\":10, "
literal|"\"name\":\"Calque de Tile 1\", \"opacity\":1, \"type\":\"tilelayer\", "
literal|"\"visible\":true, \"width\":10, \"x\":0, \"y\":0 }], "
literal|"\"orientation\":\"orthogonal\", \"properties\": { }, \"tileheight\":32, "
literal|"\"tilesets\":[ { \"firstgid\":1, \"image\":\"..\\/images\\/tiles.png\", "
literal|"\"imageheight\":64, \"imagewidth\":160, \"margin\":0, \"name\":\"Tiles\", "
literal|"\"properties\":{}, \"spacing\":0, \"tileheight\":32, \"tilewidth\":32 }], "
literal|"\"tilewidth\":32, \"version\":1, \"width\":10 }"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|128
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|for (i = 1; tokens[i].end< tokens[0].end; i++) { 		if (tokens[i].type == JSMN_STRING || tokens[i].type == JSMN_PRIMITIVE) { 			printf("%.*s\n", tokens[i].end - tokens[i].start, js + tokens[i].start); 		} else if (tokens[i].type == JSMN_ARRAY) { 			printf("[%d elems]\n", tokens[i].size); 		} else if (tokens[i].type == JSMN_OBJECT) { 			printf("{%d elems}\n", tokens[i].size); 		} else { 			TOKEN_PRINT(tokens[i]); 		} 	}
endif|#
directive|endif
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_unicode_characters
parameter_list|()
block|{
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tokens
index|[
literal|10
index|]
decl_stmt|;
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|int
name|r
decl_stmt|;
name|js
operator|=
literal|"{\"a\":\"\\uAbcD\"}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\":\"str\\u0000\"}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\":\"\\uFFFFstr\"}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\":\"str\\uFFGFstr\"}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_INVAL
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\":\"str\\u@FfF\"}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_INVAL
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\":[\"\\u028\"]}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_INVAL
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\":[\"\\u0280\"]}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|>=
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_input_length
parameter_list|()
block|{
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tokens
index|[
literal|10
index|]
decl_stmt|;
name|js
operator|=
literal|"{\"a\": 0}garbage"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
literal|8
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
literal|3
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tokens
index|[
literal|0
index|]
argument_list|,
literal|"{\"a\": 0}"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tokens
index|[
literal|1
index|]
argument_list|,
literal|"a"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tokens
index|[
literal|2
index|]
argument_list|,
literal|"0"
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_count
parameter_list|()
block|{
name|jsmn_parser
name|p
decl_stmt|;
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|js
operator|=
literal|"{}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[[]]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|2
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[[], []]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|3
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[[], []]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|3
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[[], [[]], [[], []]]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|7
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[\"a\", [[], []]]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|5
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[[], \"[], [[]]\", [[]]]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|5
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[1, 2, 3]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|4
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"[1, 2, [3, \"a\"], null]"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|7
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|test_keyvalue
parameter_list|()
block|{
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tokens
index|[
literal|10
index|]
decl_stmt|;
name|js
operator|=
literal|"{\"a\": 0, \"b\": \"c\"}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
literal|5
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|tokens
index|[
literal|0
index|]
operator|.
name|size
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|/* two keys */
name|check
argument_list|(
name|tokens
index|[
literal|1
index|]
operator|.
name|size
operator|==
literal|1
operator|&&
name|tokens
index|[
literal|3
index|]
operator|.
name|size
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|/* one value per key */
name|check
argument_list|(
name|tokens
index|[
literal|2
index|]
operator|.
name|size
operator|==
literal|0
operator|&&
name|tokens
index|[
literal|4
index|]
operator|.
name|size
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|/* values have zero size */
name|js
operator|=
literal|"{\"a\"\n0}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_INVAL
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\", 0}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_INVAL
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\": {2}}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_INVAL
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\": {2: 3}}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_INVAL
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"{\"a\": {\"a\": 2 3}}"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
name|JSMN_ERROR_INVAL
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/** A huge redefinition of everything to include jsmn in non-script mode */
end_comment

begin_define
define|#
directive|define
name|jsmn_init
value|jsmn_init_nonstrict
end_define

begin_define
define|#
directive|define
name|jsmn_parse
value|jsmn_parse_nonstrict
end_define

begin_define
define|#
directive|define
name|jsmn_parser
value|jsmn_parser_nonstrict
end_define

begin_define
define|#
directive|define
name|jsmn_alloc_token
value|jsmn_alloc_token_nonstrict
end_define

begin_define
define|#
directive|define
name|jsmn_fill_token
value|jsmn_fill_token_nonstrict
end_define

begin_define
define|#
directive|define
name|jsmn_parse_primitive
value|jsmn_parse_primitive_nonstrict
end_define

begin_define
define|#
directive|define
name|jsmn_parse_string
value|jsmn_parse_string_nonstrict
end_define

begin_define
define|#
directive|define
name|jsmntype_t
value|jsmntype_nonstrict_t
end_define

begin_define
define|#
directive|define
name|jsmnerr_t
value|jsmnerr_nonstrict_t
end_define

begin_define
define|#
directive|define
name|jsmntok_t
value|jsmntok_nonstrict_t
end_define

begin_define
define|#
directive|define
name|JSMN_PRIMITIVE
value|JSMN_PRIMITIVE_NONSTRICT
end_define

begin_define
define|#
directive|define
name|JSMN_OBJECT
value|JSMN_OBJECT_NONSTRICT
end_define

begin_define
define|#
directive|define
name|JSMN_ARRAY
value|JSMN_ARRAY_NONSTRICT
end_define

begin_define
define|#
directive|define
name|JSMN_STRING
value|JSMN_STRING_NONSTRICT
end_define

begin_define
define|#
directive|define
name|JSMN_ERROR_NOMEM
value|JSMN_ERROR_NOMEM_NONSTRICT
end_define

begin_define
define|#
directive|define
name|JSMN_ERROR_INVAL
value|JSMN_ERROR_INVAL_NONSTRICT
end_define

begin_define
define|#
directive|define
name|JSMN_ERROR_PART
value|JSMN_ERROR_PART_NONSTRICT
end_define

begin_undef
undef|#
directive|undef
name|__JSMN_H_
end_undef

begin_undef
undef|#
directive|undef
name|JSMN_STRICT
end_undef

begin_include
include|#
directive|include
file|"jsmn.c"
end_include

begin_function
name|int
name|test_nonstrict
parameter_list|()
block|{
specifier|const
name|char
modifier|*
name|js
decl_stmt|;
name|int
name|r
decl_stmt|;
name|jsmn_parser
name|p
decl_stmt|;
name|jsmntok_t
name|tokens
index|[
literal|10
index|]
decl_stmt|;
name|js
operator|=
literal|"a: 0garbage"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
literal|4
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
literal|2
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tokens
index|[
literal|0
index|]
argument_list|,
literal|"a"
argument_list|)
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|TOKEN_STRING
argument_list|(
name|js
argument_list|,
name|tokens
index|[
literal|1
index|]
argument_list|,
literal|"0"
argument_list|)
argument_list|)
expr_stmt|;
name|js
operator|=
literal|"Day : 26\nMonth : Sep\n\nYear: 12"
expr_stmt|;
name|jsmn_init
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|r
operator|=
name|jsmn_parse
argument_list|(
operator|&
name|p
argument_list|,
name|js
argument_list|,
name|strlen
argument_list|(
name|js
argument_list|)
argument_list|,
name|tokens
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|check
argument_list|(
name|r
operator|==
literal|6
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|()
block|{
name|test
argument_list|(
name|test_empty
argument_list|,
literal|"general test for a empty JSON objects/arrays"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_simple
argument_list|,
literal|"general test for a simple JSON string"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_primitive
argument_list|,
literal|"test primitive JSON data types"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_string
argument_list|,
literal|"test string JSON data types"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_partial_string
argument_list|,
literal|"test partial JSON string parsing"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_partial_array
argument_list|,
literal|"test partial array reading"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_array_nomem
argument_list|,
literal|"test array reading with a smaller number of tokens"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_unquoted_keys
argument_list|,
literal|"test unquoted keys (like in JavaScript)"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_objects_arrays
argument_list|,
literal|"test objects and arrays"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_unicode_characters
argument_list|,
literal|"test unicode characters"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_input_length
argument_list|,
literal|"test strings that are not null-terminated"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_issue_22
argument_list|,
literal|"test issue #22"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_count
argument_list|,
literal|"test tokens count estimation"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_nonstrict
argument_list|,
literal|"test for non-strict mode"
argument_list|)
expr_stmt|;
name|test
argument_list|(
name|test_keyvalue
argument_list|,
literal|"test for keys/values"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nPASSED: %d\nFAILED: %d\n"
argument_list|,
name|test_passed
argument_list|,
name|test_failed
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

