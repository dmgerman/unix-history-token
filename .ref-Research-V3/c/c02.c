begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_macro
name|extdef
argument_list|()
end_macro

begin_block
block|{
extern|extern eof
operator|,
extern|cval
operator|,
extern|defsym;
extern|extern csym
operator|,
extern|strflg
operator|,
extern|xdflg
operator|,
extern|peeksym
operator|,
extern|fcval;
name|int
name|o
decl_stmt|,
name|c
decl_stmt|,
name|cs
index|[]
decl_stmt|,
name|type
decl_stmt|,
name|csym
index|[]
decl_stmt|,
name|width
decl_stmt|,
name|nel
decl_stmt|,
name|ninit
decl_stmt|,
name|defsym
index|[]
decl_stmt|;
name|char
name|s
index|[]
decl_stmt|;
name|float
name|sf
decl_stmt|;
name|double
name|fcval
decl_stmt|;
if|if
condition|(
operator|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|==
literal|0
operator|)
operator||
name|o
operator|==
literal|1
condition|)
comment|/* EOF */
return|return;
name|type
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|o
operator|==
literal|19
condition|)
block|{
comment|/* keyword */
if|if
condition|(
operator|(
name|type
operator|=
name|cval
operator|)
operator|>
literal|4
condition|)
goto|goto
name|syntax
goto|;
comment|/* not type */
block|}
else|else
block|{
if|if
condition|(
name|o
operator|==
literal|20
condition|)
name|csym
index|[
literal|4
index|]
operator|=
operator||
literal|0200
expr_stmt|;
comment|/* remember name */
name|peeksym
operator|=
name|o
expr_stmt|;
block|}
name|defsym
operator|=
literal|0
expr_stmt|;
name|xdflg
operator|++
expr_stmt|;
name|tdeclare
argument_list|(
name|type
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|defsym
operator|==
literal|0
condition|)
return|return;
operator|*
name|defsym
operator|=
literal|6
expr_stmt|;
name|cs
operator|=
operator|&
name|defsym
index|[
literal|4
index|]
expr_stmt|;
name|printf
argument_list|(
literal|".globl	%p\n"
argument_list|,
name|cs
argument_list|)
expr_stmt|;
name|strflg
operator|=
literal|1
expr_stmt|;
name|xdflg
operator|=
literal|0
expr_stmt|;
name|type
operator|=
name|defsym
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
operator|(
name|type
operator|&
literal|030
operator|)
operator|==
literal|020
condition|)
block|{
comment|/* a function */
name|printf
argument_list|(
literal|".text\n%p:\nmov r5,-(sp); mov sp,r5\n"
argument_list|,
name|cs
argument_list|)
expr_stmt|;
name|declist
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|strflg
operator|=
literal|0
expr_stmt|;
name|c
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|peeksym
operator|=
name|symbol
argument_list|()
operator|)
operator|!=
literal|2
condition|)
block|{
comment|/* { */
name|blkhed
argument_list|()
expr_stmt|;
name|c
operator|++
expr_stmt|;
block|}
name|statement
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|retseq
argument_list|()
expr_stmt|;
if|if
condition|(
name|c
condition|)
name|blkend
argument_list|()
expr_stmt|;
return|return;
block|}
name|width
operator|=
name|length
argument_list|(
name|defsym
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|type
operator|&
literal|030
operator|)
operator|==
literal|030
condition|)
comment|/* array */
name|width
operator|=
name|plength
argument_list|(
name|defsym
argument_list|)
expr_stmt|;
name|nel
operator|=
name|defsym
index|[
literal|8
index|]
expr_stmt|;
name|ninit
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|peeksym
operator|=
name|symbol
argument_list|()
operator|)
operator|==
literal|1
condition|)
block|{
comment|/* ; */
name|printf
argument_list|(
literal|".comm	%p,%o\n"
argument_list|,
operator|&
name|defsym
index|[
literal|4
index|]
argument_list|,
name|nel
operator|*
name|width
argument_list|)
expr_stmt|;
name|peeksym
operator|=
operator|-
literal|1
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|".data\n%p:"
argument_list|,
operator|&
name|defsym
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|loop
label|:
block|{
name|ninit
operator|++
expr_stmt|;
switch|switch
condition|(
name|o
operator|=
name|symbol
argument_list|()
condition|)
block|{
case|case
literal|22
case|:
comment|/* string */
if|if
condition|(
name|width
operator|!=
literal|2
condition|)
name|bxdec
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"L%d\n"
argument_list|,
name|cval
argument_list|)
expr_stmt|;
break|break;
case|case
literal|41
case|:
comment|/* - const */
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|==
literal|23
condition|)
block|{
comment|/* float */
name|fcval
operator|=
operator|-
name|fcval
expr_stmt|;
goto|goto
name|case23
goto|;
block|}
if|if
condition|(
name|o
operator|!=
literal|21
condition|)
goto|goto
name|syntax
goto|;
name|cval
operator|=
operator|-
name|cval
expr_stmt|;
case|case
literal|21
case|:
comment|/* const */
if|if
condition|(
name|width
operator|==
literal|1
condition|)
name|printf
argument_list|(
literal|".byte "
argument_list|)
expr_stmt|;
if|if
condition|(
name|width
operator|>
literal|2
condition|)
block|{
name|fcval
operator|=
name|cval
expr_stmt|;
goto|goto
name|case23
goto|;
block|}
name|printf
argument_list|(
literal|"%o\n"
argument_list|,
name|cval
argument_list|)
expr_stmt|;
break|break;
case|case
literal|20
case|:
comment|/* name */
if|if
condition|(
name|width
operator|!=
literal|2
condition|)
name|bxdec
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"%p\n"
argument_list|,
operator|&
name|csym
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
literal|23
case|:
name|case23
label|:
if|if
condition|(
name|width
operator|==
literal|4
condition|)
block|{
name|sf
operator|=
name|fcval
expr_stmt|;
name|printf
argument_list|(
literal|"%o;%o\n"
argument_list|,
name|sf
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|width
operator|==
literal|8
condition|)
block|{
name|printf
argument_list|(
literal|"%o;%o;%o;%o\n"
argument_list|,
name|fcval
argument_list|)
expr_stmt|;
break|break;
block|}
name|bxdec
argument_list|()
expr_stmt|;
break|break;
default|default:
goto|goto
name|syntax
goto|;
block|}
block|}
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|==
literal|9
condition|)
goto|goto
name|loop
goto|;
comment|/* , */
if|if
condition|(
name|o
operator|==
literal|1
condition|)
block|{
comment|/* ; */
name|done
label|:
if|if
condition|(
name|ninit
operator|<
name|nel
condition|)
name|printf
argument_list|(
literal|".=.+%d.\n"
argument_list|,
operator|(
name|nel
operator|-
name|ninit
operator|)
operator|*
name|width
argument_list|)
expr_stmt|;
return|return;
block|}
name|syntax
label|:
name|error
argument_list|(
literal|"External definition syntax"
argument_list|)
expr_stmt|;
name|errflush
argument_list|(
name|o
argument_list|)
expr_stmt|;
name|statement
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|bxdec
argument_list|()
end_macro

begin_block
block|{
name|error
argument_list|(
literal|"Inconsistent external initialization"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|statement
argument_list|(
argument|d
argument_list|)
end_macro

begin_block
block|{
extern|extern symbol
operator|,
extern|error
operator|,
extern|blkhed
operator|,
extern|eof
operator|,
extern|peeksym;
extern|extern blkend
operator|,
extern|csym[]
operator|,
extern|rcexpr
operator|,
extern|block[]
operator|,
extern|tree[]
operator|,
extern|regtab[];
extern|extern retseq
operator|,
extern|jumpc
operator|,
extern|jump
operator|,
extern|label
operator|,
extern|contlab
operator|,
extern|brklab
operator|,
extern|cval;
extern|extern swp[]
operator|,
extern|isn
operator|,
extern|pswitch
operator|,
extern|peekc;
extern|extern efftab[]
operator|,
extern|deflab
operator|,
extern|errflush
operator|,
extern|swtab[]
operator|,
extern|swsiz
operator|,
extern|branch;
name|int
name|o
decl_stmt|,
name|o1
decl_stmt|,
name|o2
decl_stmt|,
name|o3
decl_stmt|,
name|np
index|[]
decl_stmt|;
name|stmt
label|:
switch|switch
condition|(
name|o
operator|=
name|symbol
argument_list|()
condition|)
block|{
comment|/* EOF */
case|case
literal|0
case|:
name|error
argument_list|(
literal|"Unexpected EOF"
argument_list|)
expr_stmt|;
comment|/* ; */
case|case
literal|1
case|:
comment|/* } */
case|case
literal|3
case|:
return|return;
comment|/* { */
case|case
literal|2
case|:
block|{
if|if
condition|(
name|d
condition|)
name|blkhed
argument_list|()
expr_stmt|;
while|while
condition|(
operator|!
name|eof
condition|)
block|{
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|==
literal|3
condition|)
comment|/* } */
goto|goto
name|bend
goto|;
name|peeksym
operator|=
name|o
expr_stmt|;
name|statement
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|error
argument_list|(
literal|"Missing '}'"
argument_list|)
expr_stmt|;
name|bend
label|:
return|return;
block|}
comment|/* keyword */
case|case
literal|19
case|:
switch|switch
condition|(
name|cval
condition|)
block|{
comment|/* goto */
case|case
literal|10
case|:
name|np
operator|=
name|tree
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|np
index|[
literal|1
index|]
operator|&
literal|030
operator|)
operator|!=
literal|030
condition|)
comment|/* not array */
name|np
operator|=
name|block
argument_list|(
literal|1
argument_list|,
literal|36
argument_list|,
literal|1
argument_list|,
name|np
index|[
literal|2
index|]
operator|+
literal|1
argument_list|,
name|np
argument_list|)
expr_stmt|;
name|rcexpr
argument_list|(
name|block
argument_list|(
literal|1
argument_list|,
literal|102
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|np
argument_list|)
argument_list|,
name|regtab
argument_list|)
expr_stmt|;
goto|goto
name|semi
goto|;
comment|/* return */
case|case
literal|11
case|:
if|if
condition|(
operator|(
name|peeksym
operator|=
name|symbol
argument_list|()
operator|)
operator|==
literal|6
condition|)
comment|/* ( */
name|rcexpr
argument_list|(
name|block
argument_list|(
literal|1
argument_list|,
literal|110
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|pexpr
argument_list|()
argument_list|)
argument_list|,
name|regtab
argument_list|)
expr_stmt|;
name|retseq
argument_list|()
expr_stmt|;
goto|goto
name|semi
goto|;
comment|/* if */
case|case
literal|12
case|:
name|jumpc
argument_list|(
name|pexpr
argument_list|()
argument_list|,
name|o1
operator|=
name|isn
operator|++
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|statement
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|==
literal|19
operator|&
name|cval
operator|==
literal|14
condition|)
block|{
comment|/* else */
name|o2
operator|=
name|isn
operator|++
expr_stmt|;
operator|(
name|easystmt
argument_list|()
condition|?
name|branch
else|:
name|jump
operator|)
operator|(
name|o2
operator|)
expr_stmt|;
name|label
argument_list|(
name|o1
argument_list|)
expr_stmt|;
name|statement
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|label
argument_list|(
name|o2
argument_list|)
expr_stmt|;
return|return;
block|}
name|peeksym
operator|=
name|o
expr_stmt|;
name|label
argument_list|(
name|o1
argument_list|)
expr_stmt|;
return|return;
comment|/* while */
case|case
literal|13
case|:
name|o1
operator|=
name|contlab
expr_stmt|;
name|o2
operator|=
name|brklab
expr_stmt|;
name|label
argument_list|(
name|contlab
operator|=
name|isn
operator|++
argument_list|)
expr_stmt|;
name|jumpc
argument_list|(
name|pexpr
argument_list|()
argument_list|,
name|brklab
operator|=
name|isn
operator|++
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|o3
operator|=
name|easystmt
argument_list|()
expr_stmt|;
name|statement
argument_list|(
literal|0
argument_list|)
expr_stmt|;
operator|(
name|o3
condition|?
name|branch
else|:
name|jump
operator|)
operator|(
name|contlab
operator|)
expr_stmt|;
name|label
argument_list|(
name|brklab
argument_list|)
expr_stmt|;
name|contlab
operator|=
name|o1
expr_stmt|;
name|brklab
operator|=
name|o2
expr_stmt|;
return|return;
comment|/* break */
case|case
literal|17
case|:
if|if
condition|(
name|brklab
operator|==
literal|0
condition|)
name|error
argument_list|(
literal|"Nothing to break from"
argument_list|)
expr_stmt|;
name|jump
argument_list|(
name|brklab
argument_list|)
expr_stmt|;
goto|goto
name|semi
goto|;
comment|/* continue */
case|case
literal|18
case|:
if|if
condition|(
name|contlab
operator|==
literal|0
condition|)
name|error
argument_list|(
literal|"Nothing to continue"
argument_list|)
expr_stmt|;
name|jump
argument_list|(
name|contlab
argument_list|)
expr_stmt|;
goto|goto
name|semi
goto|;
comment|/* do */
case|case
literal|19
case|:
name|o1
operator|=
name|contlab
expr_stmt|;
name|o2
operator|=
name|brklab
expr_stmt|;
name|contlab
operator|=
name|isn
operator|++
expr_stmt|;
name|brklab
operator|=
name|isn
operator|++
expr_stmt|;
name|label
argument_list|(
name|o3
operator|=
name|isn
operator|++
argument_list|)
expr_stmt|;
name|statement
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|label
argument_list|(
name|contlab
argument_list|)
expr_stmt|;
name|contlab
operator|=
name|o1
expr_stmt|;
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|==
literal|19
operator|&
name|cval
operator|==
literal|13
condition|)
block|{
comment|/* while */
name|jumpc
argument_list|(
name|tree
argument_list|()
argument_list|,
name|o3
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|label
argument_list|(
name|brklab
argument_list|)
expr_stmt|;
name|brklab
operator|=
name|o2
expr_stmt|;
goto|goto
name|semi
goto|;
block|}
goto|goto
name|syntax
goto|;
comment|/* case */
case|case
literal|16
case|:
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|!=
literal|21
condition|)
block|{
comment|/* constant */
if|if
condition|(
name|o
operator|!=
literal|41
condition|)
comment|/* - */
goto|goto
name|syntax
goto|;
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|!=
literal|21
condition|)
goto|goto
name|syntax
goto|;
name|cval
operator|=
operator|-
name|cval
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|!=
literal|8
condition|)
comment|/* : */
goto|goto
name|syntax
goto|;
if|if
condition|(
name|swp
operator|==
literal|0
condition|)
block|{
name|error
argument_list|(
literal|"Case not in switch"
argument_list|)
expr_stmt|;
goto|goto
name|stmt
goto|;
block|}
if|if
condition|(
name|swp
operator|>=
name|swtab
operator|+
name|swsiz
condition|)
block|{
name|error
argument_list|(
literal|"Switch table overflow"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|*
name|swp
operator|++
operator|=
name|isn
expr_stmt|;
operator|*
name|swp
operator|++
operator|=
name|cval
expr_stmt|;
name|label
argument_list|(
name|isn
operator|++
argument_list|)
expr_stmt|;
block|}
goto|goto
name|stmt
goto|;
comment|/* switch */
case|case
literal|15
case|:
name|o1
operator|=
name|brklab
expr_stmt|;
name|brklab
operator|=
name|isn
operator|++
expr_stmt|;
name|np
operator|=
name|pexpr
argument_list|()
expr_stmt|;
if|if
condition|(
name|np
index|[
literal|1
index|]
operator|>
literal|1
operator|&
name|np
index|[
literal|1
index|]
operator|<
literal|07
condition|)
name|error
argument_list|(
literal|"Integer required"
argument_list|)
expr_stmt|;
name|rcexpr
argument_list|(
name|block
argument_list|(
literal|1
argument_list|,
literal|110
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|np
argument_list|)
argument_list|,
name|regtab
argument_list|)
expr_stmt|;
name|pswitch
argument_list|()
expr_stmt|;
name|brklab
operator|=
name|o1
expr_stmt|;
return|return;
comment|/* default */
case|case
literal|20
case|:
if|if
condition|(
name|swp
operator|==
literal|0
condition|)
name|error
argument_list|(
literal|"Default not in switch"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|!=
literal|8
condition|)
comment|/* : */
goto|goto
name|syntax
goto|;
name|deflab
operator|=
name|isn
operator|++
expr_stmt|;
name|label
argument_list|(
name|deflab
argument_list|)
expr_stmt|;
goto|goto
name|stmt
goto|;
block|}
name|error
argument_list|(
literal|"Unknown keyword"
argument_list|)
expr_stmt|;
goto|goto
name|syntax
goto|;
comment|/* name */
case|case
literal|20
case|:
if|if
condition|(
name|peekc
operator|==
literal|':'
condition|)
block|{
name|peekc
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|csym
index|[
literal|0
index|]
operator|>
literal|0
condition|)
block|{
name|error
argument_list|(
literal|"Redefinition"
argument_list|)
expr_stmt|;
goto|goto
name|stmt
goto|;
block|}
name|csym
index|[
literal|0
index|]
operator|=
literal|7
expr_stmt|;
name|csym
index|[
literal|1
index|]
operator|=
literal|030
expr_stmt|;
comment|/* int[] */
if|if
condition|(
name|csym
index|[
literal|2
index|]
operator|==
literal|0
condition|)
name|csym
index|[
literal|2
index|]
operator|=
name|isn
operator|++
expr_stmt|;
name|label
argument_list|(
name|csym
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
goto|goto
name|stmt
goto|;
block|}
block|}
name|peeksym
operator|=
name|o
expr_stmt|;
name|rcexpr
argument_list|(
name|tree
argument_list|()
argument_list|,
name|efftab
argument_list|)
expr_stmt|;
goto|goto
name|semi
goto|;
name|semi
label|:
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|!=
literal|1
condition|)
comment|/* ; */
goto|goto
name|syntax
goto|;
return|return;
name|syntax
label|:
name|error
argument_list|(
literal|"Statement syntax"
argument_list|)
expr_stmt|;
name|errflush
argument_list|(
name|o
argument_list|)
expr_stmt|;
goto|goto
name|stmt
goto|;
block|}
end_block

begin_macro
name|pexpr
argument_list|()
end_macro

begin_block
block|{
name|auto
name|o
decl_stmt|,
name|t
decl_stmt|;
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|!=
literal|6
condition|)
comment|/* ( */
goto|goto
name|syntax
goto|;
name|t
operator|=
name|tree
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|!=
literal|7
condition|)
comment|/* ) */
goto|goto
name|syntax
goto|;
return|return
operator|(
name|t
operator|)
return|;
name|syntax
label|:
name|error
argument_list|(
literal|"Statement syntax"
argument_list|)
expr_stmt|;
name|errflush
argument_list|(
name|o
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|pswitch
argument_list|()
end_macro

begin_block
block|{
extern|extern swp[]
operator|,
extern|isn
operator|,
extern|swtab[]
operator|,
extern|printf
operator|,
extern|deflab
operator|,
extern|statement
operator|,
extern|brklab;
extern|extern label;
name|int
name|sswp
index|[]
decl_stmt|,
name|dl
decl_stmt|,
name|cv
decl_stmt|,
name|swlab
decl_stmt|;
name|sswp
operator|=
name|swp
expr_stmt|;
if|if
condition|(
name|swp
operator|==
literal|0
condition|)
name|swp
operator|=
name|swtab
expr_stmt|;
name|swlab
operator|=
name|isn
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"jsr	pc,bswitch; l%d\n"
argument_list|,
name|swlab
argument_list|)
expr_stmt|;
name|dl
operator|=
name|deflab
expr_stmt|;
name|deflab
operator|=
literal|0
expr_stmt|;
name|statement
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|deflab
condition|)
block|{
name|deflab
operator|=
name|isn
operator|++
expr_stmt|;
name|label
argument_list|(
name|deflab
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"L%d:.data;L%d:"
argument_list|,
name|brklab
argument_list|,
name|swlab
argument_list|)
expr_stmt|;
while|while
condition|(
name|swp
operator|>
name|sswp
operator|&
name|swp
operator|>
name|swtab
condition|)
block|{
name|cv
operator|=
operator|*
operator|--
name|swp
expr_stmt|;
name|printf
argument_list|(
literal|"%o; l%d\n"
argument_list|,
name|cv
argument_list|,
operator|*
operator|--
name|swp
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"L%d; 0\n.text\n"
argument_list|,
name|deflab
argument_list|)
expr_stmt|;
name|deflab
operator|=
name|dl
expr_stmt|;
name|swp
operator|=
name|sswp
expr_stmt|;
block|}
end_block

begin_macro
name|blkhed
argument_list|()
end_macro

begin_block
block|{
extern|extern symbol
operator|,
extern|cval
operator|,
extern|peeksym
operator|,
extern|paraml[]
operator|,
extern|parame[];
extern|extern error
operator|,
extern|rlength
operator|,
extern|setstk
operator|,
extern|defvec
operator|,
extern|isn
operator|,
extern|defstat;
extern|extern stack
operator|,
extern|hshtab[]
operator|,
extern|hshsiz
operator|,
extern|pssiz;
name|int
name|al
decl_stmt|,
name|pl
decl_stmt|,
name|cs
index|[]
decl_stmt|,
name|hl
decl_stmt|,
name|t
index|[]
decl_stmt|;
name|declist
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|stack
operator|=
name|al
operator|=
literal|0
expr_stmt|;
name|pl
operator|=
literal|4
expr_stmt|;
while|while
condition|(
name|paraml
condition|)
block|{
operator|*
name|parame
operator|=
literal|0
expr_stmt|;
name|paraml
operator|=
operator|*
operator|(
name|cs
operator|=
name|paraml
operator|)
expr_stmt|;
if|if
condition|(
name|cs
index|[
literal|1
index|]
operator|==
literal|2
condition|)
comment|/* float args -> double */
name|cs
index|[
literal|1
index|]
operator|=
literal|3
expr_stmt|;
name|cs
index|[
literal|2
index|]
operator|=
name|pl
expr_stmt|;
operator|*
name|cs
operator|=
literal|10
expr_stmt|;
if|if
condition|(
operator|(
name|cs
index|[
literal|1
index|]
operator|&
literal|030
operator|)
operator|==
literal|030
condition|)
comment|/* array */
name|cs
index|[
literal|1
index|]
operator|=
operator|-
literal|020
expr_stmt|;
comment|/* set ref */
name|pl
operator|=
operator|+
name|rlength
argument_list|(
name|cs
argument_list|)
expr_stmt|;
block|}
name|cs
operator|=
name|hshtab
expr_stmt|;
name|hl
operator|=
name|hshsiz
expr_stmt|;
while|while
condition|(
name|hl
operator|--
condition|)
block|{
if|if
condition|(
name|cs
index|[
literal|4
index|]
condition|)
block|{
if|if
condition|(
name|cs
index|[
literal|0
index|]
operator|>
literal|1
operator|&
operator|(
name|cs
index|[
literal|1
index|]
operator|&
literal|07
operator|)
operator|==
literal|05
condition|)
block|{
comment|/* referred structure */
name|t
operator|=
name|cs
index|[
literal|3
index|]
expr_stmt|;
name|cs
index|[
literal|3
index|]
operator|=
name|t
index|[
literal|3
index|]
expr_stmt|;
name|cs
index|[
literal|1
index|]
operator|=
name|cs
index|[
literal|1
index|]
operator|&
literal|077770
operator||
literal|04
expr_stmt|;
block|}
switch|switch
condition|(
name|cs
index|[
literal|0
index|]
condition|)
block|{
comment|/* sort unmentioned */
case|case
operator|-
literal|2
case|:
name|cs
index|[
literal|0
index|]
operator|=
literal|5
expr_stmt|;
comment|/* auto */
comment|/* auto */
case|case
literal|5
case|:
name|al
operator|=
operator|-
name|trlength
argument_list|(
name|cs
argument_list|)
expr_stmt|;
name|cs
index|[
literal|2
index|]
operator|=
name|al
expr_stmt|;
break|break;
comment|/* parameter */
case|case
literal|10
case|:
name|cs
index|[
literal|0
index|]
operator|=
literal|5
expr_stmt|;
break|break;
comment|/* static */
case|case
literal|7
case|:
name|cs
index|[
literal|2
index|]
operator|=
name|isn
expr_stmt|;
name|printf
argument_list|(
literal|".bss; L%d: .=.+%o; .text\n"
argument_list|,
name|isn
operator|++
argument_list|,
name|trlength
argument_list|(
name|cs
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|cs
operator|=
name|cs
operator|+
name|pssiz
expr_stmt|;
block|}
name|setstk
argument_list|(
name|al
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|blkend
argument_list|()
end_macro

begin_block
block|{
extern|extern hshtab[]
operator|,
extern|hshsiz
operator|,
extern|pssiz
operator|,
extern|hshused
operator|,
extern|debug;
name|auto
name|i
decl_stmt|,
name|hl
decl_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
name|hl
operator|=
name|hshsiz
expr_stmt|;
while|while
condition|(
name|hl
operator|--
condition|)
block|{
if|if
condition|(
name|hshtab
index|[
name|i
operator|+
literal|4
index|]
condition|)
block|{
if|if
condition|(
name|debug
condition|)
if|if
condition|(
name|hshtab
index|[
name|i
index|]
operator|!=
literal|1
condition|)
name|error
argument_list|(
literal|"%p	%o	%o	%o	%o	%o"
argument_list|,
operator|&
name|hshtab
index|[
name|i
operator|+
literal|4
index|]
argument_list|,
name|hshtab
index|[
name|i
index|]
argument_list|,
name|hshtab
index|[
name|i
operator|+
literal|1
index|]
argument_list|,
name|hshtab
index|[
name|i
operator|+
literal|2
index|]
argument_list|,
name|hshtab
index|[
name|i
operator|+
literal|3
index|]
argument_list|,
name|hshtab
index|[
name|i
operator|+
literal|8
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|hshtab
index|[
name|i
index|]
operator|==
literal|0
condition|)
name|error
argument_list|(
literal|"%p undefined"
argument_list|,
operator|&
name|hshtab
index|[
name|i
operator|+
literal|4
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|hshtab
index|[
name|i
operator|+
literal|4
index|]
operator|&
literal|0200
operator|)
operator|==
literal|0
condition|)
block|{
comment|/* not top-level */
name|hshtab
index|[
name|i
operator|+
literal|4
index|]
operator|=
literal|0
expr_stmt|;
name|hshused
operator|--
expr_stmt|;
block|}
block|}
name|i
operator|=
operator|+
name|pssiz
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|errflush
argument_list|(
argument|o
argument_list|)
end_macro

begin_block
block|{
extern|extern symbol
operator|,
extern|peeksym
operator|,
extern|eof;
while|while
condition|(
name|o
operator|>
literal|3
condition|)
comment|/* ; { } */
name|o
operator|=
name|symbol
argument_list|()
expr_stmt|;
name|peeksym
operator|=
name|o
expr_stmt|;
block|}
end_block

begin_macro
name|declist
argument_list|(
argument|mosflg
argument_list|)
end_macro

begin_block
block|{
extern|extern peeksym
operator|,
extern|csym[]
operator|,
extern|cval;
name|auto
name|o
decl_stmt|,
name|offset
decl_stmt|;
name|offset
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|o
operator|=
name|symbol
argument_list|()
operator|)
operator|==
literal|19
operator|&
name|cval
operator|<
literal|10
condition|)
if|if
condition|(
name|cval
operator|<=
literal|4
condition|)
name|offset
operator|=
name|tdeclare
argument_list|(
name|cval
argument_list|,
name|offset
argument_list|,
name|mosflg
argument_list|)
expr_stmt|;
else|else
name|scdeclare
argument_list|(
name|cval
argument_list|)
expr_stmt|;
name|peeksym
operator|=
name|o
expr_stmt|;
return|return
operator|(
name|offset
operator|)
return|;
block|}
end_block

begin_macro
name|easystmt
argument_list|()
end_macro

begin_block
block|{
extern|extern peeksym
operator|,
extern|peekc
operator|,
extern|cval;
if|if
condition|(
operator|(
name|peeksym
operator|=
name|symbol
argument_list|()
operator|)
operator|==
literal|20
condition|)
comment|/* name */
return|return
operator|(
name|peekc
operator|!=
literal|':'
operator|)
return|;
comment|/* not label */
if|if
condition|(
name|peeksym
operator|==
literal|19
condition|)
block|{
comment|/* keyword */
switch|switch
condition|(
name|cval
condition|)
case|case
literal|10
case|:
comment|/* goto */
case|case
literal|11
case|:
comment|/* return */
case|case
literal|17
case|:
comment|/* break */
case|case
literal|18
case|:
comment|/* continue */
return|return
operator|(
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
return|return
operator|(
name|peeksym
operator|!=
literal|2
operator|)
return|;
comment|/* { */
block|}
end_block

begin_macro
name|branch
argument_list|(
argument|lab
argument_list|)
end_macro

begin_block
block|{
name|printf
argument_list|(
literal|"br	L%d\n"
argument_list|,
name|lab
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

