begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_decl_stmt
specifier|static
name|char
modifier|*
name|sccsid
init|=
literal|"@(#)talkto.c	1.1\t1/23/83"
decl_stmt|;
end_decl_stmt

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|"parms.h"
end_include

begin_include
include|#
directive|include
file|"structs.h"
end_include

begin_comment
comment|/*  *	talkto(auth, uniq) struct auth_f *auth; struct id_d *uniq;  *	see if the author is a local user (by checking the sys field of  *	the note to see where it was written) and then grab his name from  *	the auth structure. If he is not "Anonymous", and is local then  *	we do a 'write name' command to talk with him.  *  *	Ray Essick	December 1981  */
end_comment

begin_macro
name|talkto
argument_list|(
argument|auth
argument_list|,
argument|uniq
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|auth_f
modifier|*
name|auth
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|id_f
modifier|*
name|uniq
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|extern
name|char
modifier|*
name|mywrite
decl_stmt|;
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
literal|"Anonymous"
argument_list|,
name|auth
operator|->
name|aname
argument_list|)
operator|==
literal|0
condition|)
block|{
name|warn
argument_list|(
literal|"Anonymous author"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|SYSTEM
argument_list|,
name|uniq
operator|->
name|sys
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|warn
argument_list|(
literal|"Author on remote machine"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|prompt
argument_list|(
literal|"%s %s"
argument_list|,
name|mywrite
argument_list|,
name|auth
operator|->
name|aname
argument_list|)
expr_stmt|;
comment|/* let him know what doing */
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|ret
operator|=
name|dounix
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
name|mywrite
argument_list|,
name|auth
operator|->
name|aname
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|0
condition|)
name|wfchar
argument_list|()
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_block

end_unit

