begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Routine to convert a localtime(3) format date back into  * a system format date.  *  * Hats off to Bob Kridle for the insight that the way to do  * this is by binary search of the system date space.  */
end_comment

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_function_decl
name|struct
name|tm
modifier|*
name|localtime
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|long
name|emitl
parameter_list|(
name|dp
parameter_list|)
name|struct
name|tm
modifier|*
name|dp
decl_stmt|;
block|{
name|long
name|conv
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|,
name|bit
decl_stmt|;
name|struct
name|tm
name|dcopy
decl_stmt|;
name|dcopy
operator|=
operator|*
name|dp
expr_stmt|;
name|dp
operator|=
operator|&
name|dcopy
expr_stmt|;
name|conv
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|31
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|bit
operator|=
literal|1
operator|<<
name|i
expr_stmt|;
name|conv
operator||=
name|bit
expr_stmt|;
if|if
condition|(
name|dcmp
argument_list|(
name|localtime
argument_list|(
operator|&
name|conv
argument_list|)
argument_list|,
name|dp
argument_list|)
operator|>
literal|0
condition|)
name|conv
operator|&=
operator|~
name|bit
expr_stmt|;
block|}
return|return
operator|(
name|conv
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Compare two localtime dates, return result.  */
end_comment

begin_define
define|#
directive|define
name|DECIDE
parameter_list|(
name|a
parameter_list|)
define|\
value|if (dp->a> dp2->a) \ 		return(1); \ 	if (dp->a< dp2->a) \ 		return(-1)
end_define

begin_expr_stmt
specifier|static
name|dcmp
argument_list|(
name|dp
argument_list|,
name|dp2
argument_list|)
specifier|register
expr|struct
name|tm
operator|*
name|dp
operator|,
operator|*
name|dp2
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|DECIDE
argument_list|(
name|tm_year
argument_list|)
expr_stmt|;
name|DECIDE
argument_list|(
name|tm_mon
argument_list|)
expr_stmt|;
name|DECIDE
argument_list|(
name|tm_mday
argument_list|)
expr_stmt|;
name|DECIDE
argument_list|(
name|tm_hour
argument_list|)
expr_stmt|;
name|DECIDE
argument_list|(
name|tm_min
argument_list|)
expr_stmt|;
name|DECIDE
argument_list|(
name|tm_sec
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

end_unit

