begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/timeb.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_comment
comment|/*  * Output the date in right format gotten from  * the passed ctime(3) format date.  * If the passed date is NULL, output the current  * date and time.  */
end_comment

begin_macro
name|putdate
argument_list|(
argument|timestr
argument_list|,
argument|out
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|timestr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|FILE
modifier|*
name|out
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|t
decl_stmt|,
modifier|*
name|p
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
name|char
modifier|*
name|timezone
parameter_list|()
function_decl|;
name|struct
name|tm
modifier|*
name|tmp
decl_stmt|;
name|struct
name|tm
modifier|*
name|localtime
parameter_list|()
function_decl|;
name|struct
name|timeb
name|tb
decl_stmt|;
name|long
name|now
decl_stmt|;
name|int
name|isdst
decl_stmt|;
name|char
modifier|*
name|asctime
parameter_list|()
function_decl|;
specifier|static
name|char
modifier|*
name|str
init|=
literal|"SunMonTueWedThuFriSat"
decl_stmt|;
specifier|static
name|char
modifier|*
name|daytag
index|[]
init|=
block|{
literal|"Sunday"
block|,
literal|"Monday"
block|,
literal|"Tuesday"
block|,
literal|"Wednesday"
block|,
literal|"Thursday"
block|,
literal|"Friday"
block|,
literal|"Saturday"
block|}
decl_stmt|;
name|now
operator|=
name|time
argument_list|(
operator|(
name|long
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|localtime
argument_list|(
operator|&
name|now
argument_list|)
expr_stmt|;
name|isdst
operator|=
name|tmp
operator|->
name|tm_isdst
expr_stmt|;
if|if
condition|(
name|timestr
operator|==
literal|0
condition|)
name|timestr
operator|=
name|asctime
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
name|cp
operator|=
name|str
expr_stmt|;
name|t
operator|=
name|timestr
expr_stmt|;
while|while
condition|(
operator|*
name|cp
condition|)
block|{
if|if
condition|(
name|strcmpn
argument_list|(
name|cp
argument_list|,
name|t
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
break|break;
name|cp
operator|+=
literal|3
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|cp
condition|)
name|cp
operator|=
name|daytag
index|[
operator|(
name|cp
operator|-
name|str
operator|)
operator|/
literal|3
index|]
expr_stmt|;
else|else
name|cp
operator|=
literal|0
expr_stmt|;
name|ftime
argument_list|(
operator|&
name|tb
argument_list|)
expr_stmt|;
comment|/* 	 * This call to timezone() may be wrong: 	 * really need the tm_isdst whoever generated timestr. 	 */
name|p
operator|=
name|timezone
argument_list|(
name|tb
operator|.
name|timezone
argument_list|,
name|isdst
argument_list|)
expr_stmt|;
if|if
condition|(
name|cp
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|out
argument_list|,
literal|"Date: %.2s %.3s %.4s %.2s%.2s-%.3s\n"
argument_list|,
name|t
operator|+
literal|8
argument_list|,
name|t
operator|+
literal|4
argument_list|,
name|t
operator|+
literal|20
argument_list|,
name|t
operator|+
literal|11
argument_list|,
name|t
operator|+
literal|14
argument_list|,
name|p
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|out
argument_list|,
literal|"Date: %.2s %.3s %.4s %.2s%.2s-%.3s (%s)\n"
argument_list|,
name|t
operator|+
literal|8
argument_list|,
name|t
operator|+
literal|4
argument_list|,
name|t
operator|+
literal|20
argument_list|,
name|t
operator|+
literal|11
argument_list|,
name|t
operator|+
literal|14
argument_list|,
name|p
argument_list|,
name|cp
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

