begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (C) 1995 Florian La Roche */
end_comment

begin_comment
comment|/* Who wants to help coding? I don't like doing this... */
end_comment

begin_comment
comment|/* You can just start setup as normal user and see how far it is coded    right now. This will do a fake installation and won't actually chnage    any data on your computer. */
end_comment

begin_comment
comment|/* TODO: write a good package selection code          change functions to return better error code  */
end_comment

begin_comment
comment|/* Show an extra text-box with the contents of all external commands,    before they are executed. So you can abort the installation, if any    wrong commands are to be executed. (So don't format wrong partition.) */
end_comment

begin_define
define|#
directive|define
name|VERBOSE
value|1
end_define

begin_comment
comment|/* If defined, don't actually execute any comands and don't actually modify    any files. So you can test any possible installation without doing any    damage to your computer.    The file FDISK.TEST is used instead of real "fdisk -l" output, so that    it can be started as normal user. */
end_comment

begin_define
define|#
directive|define
name|DEBUG_THIS
value|1
end_define

begin_include
include|#
directive|include
file|<dialog.h>
end_include

begin_comment
comment|/* max length of a partition name like e.g. '/dev/hda1' */
end_comment

begin_define
define|#
directive|define
name|MAX_DEV_NAME
value|25
end_define

begin_comment
comment|/* max number of possible Linux/Swap/MsDos partitions */
end_comment

begin_define
define|#
directive|define
name|MAX_PARTS
value|20
end_define

begin_decl_stmt
name|char
modifier|*
name|progname
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|error
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: %s\n"
argument_list|,
name|progname
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|my_system
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|,
modifier|...
parameter_list|)
block|{
name|int
name|ret
decl_stmt|,
name|i
decl_stmt|;
name|va_list
name|ap
decl_stmt|;
name|char
name|sh
index|[
literal|200
index|]
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|vsprintf
argument_list|(
name|sh
argument_list|,
name|s
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|VERBOSE
name|i
operator|=
name|dialog_msgbox
argument_list|(
literal|"I will run the following command:"
argument_list|,
name|sh
argument_list|,
literal|10
argument_list|,
literal|65
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|dialog_clear
argument_list|()
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_THIS
return|return
literal|0
return|;
endif|#
directive|endif
endif|#
directive|endif
name|ret
operator|=
name|system
argument_list|(
name|sh
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|ret
operator|>>
literal|8
operator|)
condition|)
return|return
literal|0
return|;
name|i
operator|=
name|dialog_msgbox
argument_list|(
literal|"Error-Exit on the following command:"
argument_list|,
name|sh
argument_list|,
literal|12
argument_list|,
literal|73
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|dialog_clear
argument_list|()
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* We support to install from DOS/Linux-partitions. */
end_comment

begin_enum
enum|enum
name|partition_type
block|{
name|MsDos
block|,
name|Linux
block|,
name|Swap
block|}
enum|;
end_enum

begin_struct
struct|struct
name|partition
block|{
name|enum
name|partition_type
name|type
decl_stmt|;
name|char
name|name
index|[
name|MAX_DEV_NAME
index|]
decl_stmt|;
name|int
name|blocks
decl_stmt|;
name|int
name|flag
decl_stmt|;
block|}
name|partitions
index|[
name|MAX_PARTS
index|]
struct|;
end_struct

begin_decl_stmt
name|int
name|num_partition
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|num_linux
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|num_swap
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|num_msdos
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|get_line
parameter_list|(
name|char
modifier|*
name|line
parameter_list|,
name|int
name|size
parameter_list|,
name|FILE
modifier|*
name|f
parameter_list|)
block|{
name|char
modifier|*
name|ptr
init|=
name|line
decl_stmt|;
name|int
name|c
decl_stmt|;
if|if
condition|(
name|feof
argument_list|(
name|f
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
while|while
condition|(
name|size
operator|--
operator|&&
operator|(
operator|(
name|c
operator|=
name|getc
argument_list|(
name|f
argument_list|)
operator|)
operator|!=
name|EOF
operator|)
operator|&&
operator|(
name|c
operator|!=
literal|'\n'
operator|)
condition|)
operator|*
name|ptr
operator|++
operator|=
name|c
expr_stmt|;
operator|*
name|ptr
operator|++
operator|=
literal|'\0'
expr_stmt|;
return|return
call|(
name|int
call|)
argument_list|(
name|ptr
operator|-
name|line
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|read_partitions
parameter_list|(
name|void
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|line
index|[
literal|200
index|]
decl_stmt|;
name|int
name|length
decl_stmt|;
ifndef|#
directive|ifndef
name|DEBUG_THIS
name|int
name|ret
init|=
name|system
argument_list|(
literal|"fdisk -l 2>/dev/null 1>/tmp/fdisk.output"
argument_list|)
decl_stmt|;
if|if
condition|(
operator|(
name|ret
operator|>>
literal|8
operator|)
operator|!=
literal|0
condition|)
block|{
name|error
argument_list|(
literal|"fdisk didn't run"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|f
operator|=
name|fopen
argument_list|(
literal|"/tmp/fdisk.output"
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
else|#
directive|else
if|if
condition|(
operator|(
name|f
operator|=
name|fopen
argument_list|(
literal|"FDISK.TEST"
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
endif|#
directive|endif
name|error
argument_list|(
literal|"cannot read fdisk output"
argument_list|)
expr_stmt|;
while|while
condition|(
name|num_partition
operator|<=
name|MAX_PARTS
operator|&&
operator|(
name|length
operator|=
name|get_line
argument_list|(
name|line
argument_list|,
literal|200
argument_list|,
name|f
argument_list|)
operator|)
operator|>=
literal|0
condition|)
block|{
if|if
condition|(
name|strncmp
argument_list|(
name|line
argument_list|,
literal|"/dev/"
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
block|{
name|int
name|n
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|s
init|=
name|line
operator|+
literal|5
decl_stmt|;
name|char
modifier|*
name|t
init|=
name|partitions
index|[
name|num_partition
index|]
operator|.
name|name
decl_stmt|;
name|strcpy
argument_list|(
name|t
argument_list|,
literal|"/dev/"
argument_list|)
expr_stmt|;
name|t
operator|+=
literal|5
expr_stmt|;
while|while
condition|(
name|n
operator|<
name|MAX_DEV_NAME
operator|&&
operator|*
name|s
operator|!=
literal|'\0'
operator|&&
operator|!
name|isspace
argument_list|(
operator|(
name|unsigned
name|char
operator|)
operator|*
name|s
argument_list|)
condition|)
block|{
operator|*
name|t
operator|++
operator|=
operator|*
name|s
operator|++
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
operator|*
name|t
operator|=
literal|'\0'
expr_stmt|;
comment|/* Read the size of the partition. */
name|t
operator|=
name|line
operator|+
literal|37
expr_stmt|;
while|while
condition|(
name|isspace
argument_list|(
operator|(
name|unsigned
name|char
operator|)
operator|*
name|t
argument_list|)
condition|)
name|t
operator|++
expr_stmt|;
name|partitions
index|[
name|num_partition
index|]
operator|.
name|blocks
operator|=
name|atoi
argument_list|(
name|t
argument_list|)
expr_stmt|;
if|if
condition|(
name|strstr
argument_list|(
name|line
argument_list|,
literal|"Linux native"
argument_list|)
condition|)
block|{
name|partitions
index|[
name|num_partition
index|]
operator|.
name|type
operator|=
name|Linux
expr_stmt|;
name|num_partition
operator|++
expr_stmt|;
name|num_linux
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strstr
argument_list|(
name|line
argument_list|,
literal|"Linux swap"
argument_list|)
condition|)
block|{
name|partitions
index|[
name|num_partition
index|]
operator|.
name|type
operator|=
name|Swap
expr_stmt|;
name|num_partition
operator|++
expr_stmt|;
name|num_swap
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strstr
argument_list|(
name|line
argument_list|,
literal|"DOS"
argument_list|)
condition|)
block|{
name|partitions
index|[
name|num_partition
index|]
operator|.
name|type
operator|=
name|MsDos
expr_stmt|;
name|num_partition
operator|++
expr_stmt|;
name|num_msdos
operator|++
expr_stmt|;
block|}
block|}
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|DEBUG_THIS
name|unlink
argument_list|(
literal|"/tmp/fdisk.output"
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|int
name|select_partition
parameter_list|(
specifier|const
name|char
modifier|*
name|title
parameter_list|,
specifier|const
name|char
modifier|*
name|prompt
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|x
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|num
decl_stmt|,
name|ret
decl_stmt|;
name|char
name|info
index|[
name|MAX_PARTS
index|]
index|[
literal|40
index|]
decl_stmt|;
name|char
modifier|*
name|items
index|[
name|MAX_PARTS
operator|*
literal|2
index|]
decl_stmt|;
name|int
name|num_pa
index|[
name|MAX_PARTS
index|]
decl_stmt|;
name|num
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_partition
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|partitions
index|[
name|i
index|]
operator|.
name|type
operator|==
name|Linux
condition|)
block|{
name|items
index|[
name|num
operator|*
literal|2
index|]
operator|=
name|partitions
index|[
name|i
index|]
operator|.
name|name
expr_stmt|;
name|sprintf
argument_list|(
name|info
index|[
name|num
index|]
argument_list|,
literal|"Linux partition with %d blocks"
argument_list|,
name|partitions
index|[
name|i
index|]
operator|.
name|blocks
argument_list|)
expr_stmt|;
name|items
index|[
name|num
operator|*
literal|2
operator|+
literal|1
index|]
operator|=
name|info
index|[
name|num
index|]
expr_stmt|;
name|num_pa
index|[
name|num
index|]
operator|=
name|i
expr_stmt|;
name|num
operator|++
expr_stmt|;
block|}
block|}
name|ret
operator|=
name|dialog_menu
argument_list|(
name|title
argument_list|,
name|prompt
argument_list|,
name|y
operator|+
name|num
argument_list|,
name|x
argument_list|,
name|num
argument_list|,
name|num
argument_list|,
name|items
argument_list|)
expr_stmt|;
name|dialog_clear
argument_list|()
expr_stmt|;
if|if
condition|(
name|ret
operator|>=
literal|0
condition|)
comment|/* item selected */
name|ret
operator|=
name|num_pa
index|[
name|ret
index|]
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|select_install_partition
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|select_partition
argument_list|(
literal|"Select Install Partition"
argument_list|,
literal|"\\nWhere do you want to install Linux?\\n"
argument_list|,
literal|9
argument_list|,
literal|60
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|select_source_partition
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|select_partition
argument_list|(
literal|"Select Source Partition"
argument_list|,
literal|"\\nOn which partition is the source?\\n"
argument_list|,
literal|9
argument_list|,
literal|60
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
specifier|const
name|char
modifier|*
name|null
init|=
literal|">/dev/null 2>/dev/null"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|char
modifier|*
name|install_partition
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|extract_packages
parameter_list|(
specifier|const
name|char
modifier|*
name|source_path
parameter_list|)
block|{
ifndef|#
directive|ifndef
name|DEBUG_THIS
name|FILE
modifier|*
name|f
decl_stmt|;
endif|#
directive|endif
if|if
condition|(
name|my_system
argument_list|(
literal|"mkdir -p /install/var/installed/packages %s"
argument_list|,
name|null
argument_list|)
condition|)
return|return;
if|if
condition|(
name|my_system
argument_list|(
literal|"cd /install; for i in /source%s/*.tgz; do "
literal|"tar xzplvvkf $i>> var/installed/packages/base "
literal|"2>>var/installed/packages/ERROR; done"
argument_list|,
name|source_path
argument_list|)
condition|)
return|return;
ifndef|#
directive|ifndef
name|DEBUG_THIS
if|if
condition|(
operator|(
name|f
operator|=
name|fopen
argument_list|(
literal|"/install/etc/fstab"
argument_list|,
literal|"w"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
comment|/* i = */
name|dialog_msgbox
argument_list|(
literal|"Error"
argument_list|,
literal|"Cannot write /etc/fstab"
argument_list|,
literal|12
argument_list|,
literal|40
argument_list|,
literal|1
argument_list|)
expr_stmt|;
return|return;
block|}
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%s / ext2 defaults 1 1\n"
argument_list|,
name|install_partition
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"none /proc proc defaults 0 2\n"
argument_list|)
expr_stmt|;
comment|/* XXX write swap-partitions */
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|void
name|install_premounted
parameter_list|(
name|void
parameter_list|)
block|{
name|extract_packages
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|install_harddisk
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|int
name|part
decl_stmt|,
name|ret
decl_stmt|;
if|if
condition|(
operator|(
name|part
operator|=
name|select_source_partition
argument_list|()
operator|)
operator|<=
operator|-
literal|1
condition|)
return|return;
name|name
operator|=
name|partitions
index|[
name|part
index|]
operator|.
name|name
expr_stmt|;
if|if
condition|(
name|my_system
argument_list|(
literal|"mount -t ext2 %s /source %s"
argument_list|,
name|name
argument_list|,
name|null
argument_list|)
condition|)
return|return;
name|ret
operator|=
name|dialog_inputbox
argument_list|(
literal|"Path in partition"
argument_list|,
literal|"Please enter the directory in which the "
literal|"source files are."
argument_list|,
literal|13
argument_list|,
literal|50
argument_list|,
literal|""
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|dialog_clear
argument_list|()
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|0
condition|)
return|return;
comment|/* XXX strdup */
name|extract_packages
argument_list|(
name|strdup
argument_list|(
name|dialog_input_result
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|my_system
argument_list|(
literal|"umount /source %s"
argument_list|,
name|null
argument_list|)
condition|)
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|install_nfs
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|my_system
argument_list|(
literal|"ifconfig eth0 134.96.81.36 netmask 255.255.255.224 "
literal|"broadcast 134.96.81.63 %s"
argument_list|,
name|null
argument_list|)
condition|)
return|return;
if|if
condition|(
name|my_system
argument_list|(
literal|"route add -net 134.96.81.32 %s"
argument_list|,
name|null
argument_list|)
condition|)
return|return;
if|if
condition|(
name|my_system
argument_list|(
literal|"mount -t nfs 134.96.81.38:"
literal|"/local/ftp/pub/linux/ELF.binary/tar /source %s"
argument_list|,
name|null
argument_list|)
condition|)
return|return;
name|extract_packages
argument_list|(
literal|"/base"
argument_list|)
expr_stmt|;
if|if
condition|(
name|my_system
argument_list|(
literal|"umount /source %s"
argument_list|,
name|null
argument_list|)
condition|)
return|return;
if|if
condition|(
name|my_system
argument_list|(
literal|"ifconfig eth0 down %s"
argument_list|,
name|null
argument_list|)
condition|)
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|main_install
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|part
decl_stmt|,
name|ret
decl_stmt|;
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|char
modifier|*
name|items1
index|[]
init|=
block|{
literal|"1"
block|,
literal|"Harddisk Install"
block|,
literal|"2"
block|,
literal|"Network Install(NFS)"
block|,
literal|"3"
block|,
literal|"Premounted on /source"
block|}
decl_stmt|;
if|if
condition|(
name|num_linux
operator|==
literal|0
condition|)
block|{
comment|/* XXX */
return|return;
block|}
if|if
condition|(
operator|(
name|part
operator|=
name|select_install_partition
argument_list|()
operator|)
operator|<=
operator|-
literal|1
condition|)
return|return;
name|install_partition
operator|=
name|name
operator|=
name|partitions
index|[
name|part
index|]
operator|.
name|name
expr_stmt|;
if|if
condition|(
name|my_system
argument_list|(
literal|"mke2fs %s %s"
argument_list|,
name|name
argument_list|,
name|null
argument_list|)
condition|)
return|return;
if|if
condition|(
name|my_system
argument_list|(
literal|"mount -t ext2 %s /install %s"
argument_list|,
name|name
argument_list|,
name|null
argument_list|)
condition|)
return|return;
name|ret
operator|=
name|dialog_menu
argument_list|(
literal|"Choose install medium"
argument_list|,
literal|"\\nPlease say from where you want to install.\\n"
argument_list|,
literal|12
argument_list|,
literal|62
argument_list|,
literal|3
argument_list|,
literal|3
argument_list|,
name|items1
argument_list|)
expr_stmt|;
name|dialog_clear
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|ret
condition|)
block|{
case|case
literal|0
case|:
name|install_harddisk
argument_list|()
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|install_nfs
argument_list|()
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|install_premounted
argument_list|()
expr_stmt|;
break|break;
case|case
operator|-
literal|2
case|:
comment|/* cancel */
case|case
operator|-
literal|1
case|:
break|break;
comment|/* esc */
block|}
if|if
condition|(
name|my_system
argument_list|(
literal|"umount /install %s"
argument_list|,
name|null
argument_list|)
condition|)
return|return;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|int
name|stop
init|=
literal|0
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|char
modifier|*
name|items1
index|[]
init|=
block|{
literal|"1"
block|,
literal|"Display a help text"
block|,
literal|"2"
block|,
literal|"Start an installation"
block|,
literal|"3"
block|,
literal|"Exit to the shell"
block|}
decl_stmt|;
name|progname
operator|=
name|argv
index|[
literal|0
index|]
expr_stmt|;
name|read_partitions
argument_list|()
expr_stmt|;
if|if
condition|(
name|num_linux
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"\n\nPlease start \"fdisk\" or \"cfdisk\" and create a"
literal|"\nnative Linux-partition to install Linux on.\n\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|init_dialog
argument_list|()
expr_stmt|;
while|while
condition|(
operator|!
name|stop
condition|)
block|{
name|ret
operator|=
name|dialog_menu
argument_list|(
literal|"Linux Install Utility"
argument_list|,
literal|"\\nCopyright (C) 1995 Florian La Roche\\n"
literal|"\\nPre-Alpha version, be careful, read the doc!!!"
literal|"\\nemail: florian@jurix.jura.uni-sb.de, "
literal|"flla@stud.uni-sb.de\\n"
argument_list|,
literal|15
argument_list|,
literal|64
argument_list|,
literal|3
argument_list|,
literal|3
argument_list|,
name|items1
argument_list|)
expr_stmt|;
name|dialog_clear
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|ret
condition|)
block|{
case|case
literal|0
case|:
name|ret
operator|=
name|dialog_textbox
argument_list|(
literal|"Help Text"
argument_list|,
literal|"setup.help"
argument_list|,
literal|20
argument_list|,
literal|70
argument_list|)
expr_stmt|;
name|dialog_clear
argument_list|()
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|main_install
argument_list|()
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|stop
operator|=
literal|1
expr_stmt|;
break|break;
case|case
operator|-
literal|2
case|:
comment|/* cancel */
case|case
operator|-
literal|1
case|:
name|stop
operator|=
literal|1
expr_stmt|;
comment|/* esc */
block|}
block|}
name|end_dialog
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"\nExecute \"reboot\" to restart your computer...\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

