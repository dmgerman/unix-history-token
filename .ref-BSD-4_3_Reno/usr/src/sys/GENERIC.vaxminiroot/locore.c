begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_define
define|#
directive|define
name|P_LINK
value|0
end_define

begin_define
define|#
directive|define
name|P_RLINK
value|4
end_define

begin_define
define|#
directive|define
name|P_XLINK
value|116
end_define

begin_define
define|#
directive|define
name|P_ADDR
value|16
end_define

begin_define
define|#
directive|define
name|P_PRI
value|21
end_define

begin_define
define|#
directive|define
name|P_STAT
value|23
end_define

begin_define
define|#
directive|define
name|P_WCHAN
value|104
end_define

begin_define
define|#
directive|define
name|P_TSIZE
value|72
end_define

begin_define
define|#
directive|define
name|P_DSIZE
value|76
end_define

begin_define
define|#
directive|define
name|P_SSIZE
value|84
end_define

begin_define
define|#
directive|define
name|P_P0BR
value|112
end_define

begin_define
define|#
directive|define
name|P_SZPT
value|70
end_define

begin_define
define|#
directive|define
name|P_TEXTP
value|108
end_define

begin_define
define|#
directive|define
name|P_FLAG
value|44
end_define

begin_define
define|#
directive|define
name|SSLEEP
value|1
end_define

begin_define
define|#
directive|define
name|SRUN
value|3
end_define

begin_define
define|#
directive|define
name|UBA_BRRVR
value|48
end_define

begin_define
define|#
directive|define
name|UH_UBA
value|4
end_define

begin_define
define|#
directive|define
name|UH_VEC
value|28
end_define

begin_define
define|#
directive|define
name|UH_SIZE
value|84
end_define

begin_define
define|#
directive|define
name|RP_FLAG
value|12
end_define

begin_define
define|#
directive|define
name|X_CADDR
value|64
end_define

begin_define
define|#
directive|define
name|V_SWTCH
value|0
end_define

begin_define
define|#
directive|define
name|V_TRAP
value|4
end_define

begin_define
define|#
directive|define
name|V_SYSCALL
value|8
end_define

begin_define
define|#
directive|define
name|V_INTR
value|12
end_define

begin_define
define|#
directive|define
name|V_SOFT
value|16
end_define

begin_define
define|#
directive|define
name|V_PDMA
value|20
end_define

begin_define
define|#
directive|define
name|V_FAULTS
value|92
end_define

begin_define
define|#
directive|define
name|V_PGREC
value|52
end_define

begin_define
define|#
directive|define
name|V_FASTPGREC
value|112
end_define

begin_define
define|#
directive|define
name|UPAGES
value|16
end_define

begin_define
define|#
directive|define
name|CLSIZE
value|2
end_define

begin_define
define|#
directive|define
name|MAXPHYS
value|64512
end_define

begin_define
define|#
directive|define
name|SYSPTSIZE
value|3584
end_define

begin_define
define|#
directive|define
name|USRPTSIZE
value|4096
end_define

begin_define
define|#
directive|define
name|MSGBUFPTECNT
value|8
end_define

begin_define
define|#
directive|define
name|MCLBYTES
value|1024
end_define

begin_define
define|#
directive|define
name|NMBCLUSTERS
value|256
end_define

begin_define
define|#
directive|define
name|NKMEMCLUSTERS
value|512
end_define

begin_define
define|#
directive|define
name|U_PROCP
value|128
end_define

begin_define
define|#
directive|define
name|U_RU
value|1472
end_define

begin_define
define|#
directive|define
name|RU_MINFLT
value|32
end_define

begin_define
define|#
directive|define
name|SZ_CMAP
value|20
end_define

begin_comment
comment|/*  * Copyright (c) 1982, 1986 Regents of the University of California.  * All rights reserved.  The Berkeley software License Agreement  * specifies the terms and conditions for redistribution.  *  *	@(#)rpb.s	7.1 (Berkeley) 6/5/86  */
end_comment

begin_comment
comment|/*  * This has to get loaded first (physical 0) as 780 memory restart rom  * only looks for rpb on a 64K page boundary (doc isn't wrong,  * it never says what size "page boundary" rpb has to be on).  */
end_comment

begin_expr_stmt
operator|.
name|globl
name|_rpb
name|_rpb
operator|:
operator|.
name|space
literal|508
name|erpb
operator|:
operator|.
name|space
literal|4
comment|/*  * Copyright (c) 1982, 1986 Regents of the University of California.  * All rights reserved.  The Berkeley software License Agreement  * specifies the terms and conditions for redistribution.  *  *	@(#)scb.s	7.4 (Berkeley) 5/14/88  */
include|#
directive|include
file|"uba.h"
comment|/*  * System control block  */
operator|.
name|set
name|INTSTK
operator|,
literal|1
operator|#
name|handle
name|this
name|interrupt
name|on
name|the
name|interrupt
name|stack
operator|.
name|set
name|HALT
operator|,
literal|3
operator|#
name|halt
end_expr_stmt

begin_if
if|if this interrupt occurs  _scb:	.globl	_scb
define|#
directive|define
name|KS
parameter_list|(
name|a
parameter_list|)
value|.long	_X
comment|/**/
value|a
define|#
directive|define
name|IS
parameter_list|(
name|a
parameter_list|)
value|.long	_X
comment|/**/
value|a+INTSTK
define|#
directive|define
name|STOP
parameter_list|(
name|a
parameter_list|)
value|.long	_X
comment|/**/
value|a+HALT
define|#
directive|define
name|STRAY
parameter_list|(
name|x
parameter_list|)
value|.long	_scbstray+2*(x)+INTSTK
define|#
directive|define
name|STRAY3
parameter_list|(
name|n
parameter_list|)
value|STRAY(n);STRAY(n+4);STRAY(n+8)
define|#
directive|define
name|STRAY4
parameter_list|(
name|n
parameter_list|)
value|STRAY3(n);STRAY(n+12)
define|#
directive|define
name|STRAY15
parameter_list|(
name|n
parameter_list|)
value|STRAY4(n);STRAY4(n+16);STRAY4(n+32);STRAY3(n+48)
define|#
directive|define
name|STRAY16
parameter_list|(
name|n
parameter_list|)
value|STRAY15(n);STRAY(n+60)
define|#
directive|define
name|NEX0
parameter_list|(
name|n
parameter_list|)
value|IS(nex0zvec);STRAY15(n+4)
define|#
directive|define
name|NEX1
parameter_list|(
name|n
parameter_list|)
value|IS(nex1zvec);STRAY15(n+4)
comment|/* 000 */
if|IS
condition|(
name|passiverel
condition|)
empty_stmt|;
end_if

begin_expr_stmt
name|IS
argument_list|(
name|machcheck
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|IS
argument_list|(
name|kspnotval
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STOP
argument_list|(
name|powfail
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 010 */
end_comment

begin_expr_stmt
name|KS
argument_list|(
name|privinflt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|xfcflt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|resopflt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|resadflt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 020 */
end_comment

begin_expr_stmt
name|KS
argument_list|(
name|protflt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|transflt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|tracep
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|bptflt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 030 */
end_comment

begin_expr_stmt
name|KS
argument_list|(
name|compatflt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|arithtrap
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x38
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x3c
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 040 */
end_comment

begin_expr_stmt
name|KS
argument_list|(
name|syscall
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|chme
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|chms
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|chmu
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 050 */
end_comment

begin_expr_stmt
name|IS
argument_list|(
name|sbisilo
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|IS
argument_list|(
name|cmrd
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|IS
argument_list|(
name|sbi0alert
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|IS
argument_list|(
name|sbi0fault
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 060 */
end_comment

begin_expr_stmt
name|IS
argument_list|(
name|wtime
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|IS
argument_list|(
name|sbi0fail
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x68
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x6c
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 070 */
end_comment

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x70
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x74
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x78
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x7c
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 080 */
end_comment

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x80
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x84
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|astflt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x8c
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 090 */
end_comment

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x90
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x94
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x98
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0x9c
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 0a0 */
end_comment

begin_expr_stmt
name|IS
argument_list|(
name|softclock
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xa4
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xa8
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xac
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 0b0 */
end_comment

begin_expr_stmt
name|IS
argument_list|(
name|netintr
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xb4
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xb8
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|IS
argument_list|(
name|kdbintr
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 0c0 */
end_comment

begin_expr_stmt
name|IS
argument_list|(
name|hardclock
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xc4
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|emulate
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|KS
argument_list|(
name|emulateFPD
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 0d0 */
end_comment

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xd0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xd4
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xd8
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xdc
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 0e0 */
end_comment

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xe0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xe4
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xe8
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|STRAY
argument_list|(
literal|0xec
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 0f0 */
end_comment

begin_expr_stmt
name|IS
argument_list|(
name|consdin
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|IS
argument_list|(
name|consdout
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|IS
argument_list|(
name|cnrint
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|IS
argument_list|(
name|cnxint
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 100 */
end_comment

begin_expr_stmt
name|NEX0
argument_list|(
literal|0x100
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* ipl 0x14, nexus 0-15 */
end_comment

begin_comment
comment|/* 140 */
end_comment

begin_expr_stmt
name|NEX0
argument_list|(
literal|0x140
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* ipl 0x15, nexus 0-15 */
end_comment

begin_comment
comment|/* 180 */
end_comment

begin_expr_stmt
name|NEX0
argument_list|(
literal|0x180
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* ipl 0x16, nexus 0-15 */
end_comment

begin_comment
comment|/* 1c0 */
end_comment

begin_expr_stmt
name|NEX0
argument_list|(
literal|0x1c0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* ipl 0x17, nexus 0-15 */
end_comment

begin_comment
comment|/*  * 750 hardware reads through UNIvec (scb + 512 bytes) to find Unibus  * interrupt vectors.  780s use this space as a jump table (lookup  * code in locore.s makes 780s work like 750s).  Additional pages  * of interrupt vectors for additional UBAs follow immediately.  *  * 8600s may use the next page as a second SCB, for which purpose we init  * it here.  Everything else will simply replace these with Unibus vectors.  * An additional page is provided for UBA jump tables if the second  * scb might be present.  Other CPUs with additional scbs should expand  * this area as needed.  */
end_comment

begin_expr_stmt
operator|.
name|globl
name|_UNIvec
operator|.
name|globl
name|_eUNIvec
name|_UNIvec
operator|:
if|#
directive|if
name|VAX8600
comment|/* 200 */
name|STRAY16
argument_list|(
literal|0x200
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* unused (?) */
end_comment

begin_comment
comment|/* 240 */
end_comment

begin_expr_stmt
name|STRAY16
argument_list|(
literal|0x240
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* sbi1fail etc. set at boot time */
end_comment

begin_comment
comment|/* 280 */
end_comment

begin_expr_stmt
name|STRAY16
argument_list|(
literal|0x280
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* unused (?) */
end_comment

begin_comment
comment|/* 2c0 */
end_comment

begin_expr_stmt
name|STRAY16
argument_list|(
literal|0x2c0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* unused (?) */
end_comment

begin_comment
comment|/* 300 */
end_comment

begin_expr_stmt
name|NEX1
argument_list|(
literal|0x300
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* ipl 0x14, nexus 0-15, sbia 1 */
end_comment

begin_comment
comment|/* 340 */
end_comment

begin_expr_stmt
name|NEX1
argument_list|(
literal|0x340
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* ipl 0x15, nexus 0-15, sbia 1 */
end_comment

begin_comment
comment|/* 380 */
end_comment

begin_expr_stmt
name|NEX1
argument_list|(
literal|0x380
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* ipl 0x16, nexus 0-15, sbia 1 */
end_comment

begin_comment
comment|/* 3c0 */
end_comment

begin_expr_stmt
name|NEX1
argument_list|(
literal|0x3c0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* ipl 0x17, nexus 0-15, sbia 1 */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NUBA
operator|>
literal|0
end_if

begin_expr_stmt
operator|.
name|space
literal|512
operator|*
name|NUBA
operator|#
literal|750
name|first
operator|/
name|second
name|unibus
name|intr
name|vector
empty|# UBA jump tables on 780's
endif|#
directive|endif
name|_eUNIvec
operator|:
define|#
directive|define
name|I_CLOCK
value|0
define|#
directive|define
name|I_CNR
value|4
define|#
directive|define
name|I_CNX
value|8
define|#
directive|define
name|I_TUR
value|12
define|#
directive|define
name|I_TUX
value|16
define|#
directive|define
name|I_MBA0
value|20
define|#
directive|define
name|I_MBA1
value|24
define|#
directive|define
name|I_MBA2
value|28
define|#
directive|define
name|I_MBA3
value|32
define|#
directive|define
name|I_UBA0
value|36
define|#
directive|define
name|I_UBA1
value|40
define|#
directive|define
name|I_UBA2
value|44
define|#
directive|define
name|I_UBA3
value|48
comment|/*  * Copyright (c) 1980, 1986 Regents of the University of California.  * All rights reserved.  The Berkeley software License Agreement  * specifies the terms and conditions for redistribution.  *  *	@(#)locore.s	7.24 (Berkeley) 5/10/90  */
include|#
directive|include
file|"psl.h"
include|#
directive|include
file|"pte.h"
include|#
directive|include
file|"errno.h"
include|#
directive|include
file|"syscall.h"
include|#
directive|include
file|"cmap.h"
include|#
directive|include
file|"mtpr.h"
include|#
directive|include
file|"trap.h"
include|#
directive|include
file|"cpu.h"
include|#
directive|include
file|"nexus.h"
include|#
directive|include
file|"cons.h"
include|#
directive|include
file|"clock.h"
include|#
directive|include
file|"ioa.h"
include|#
directive|include
file|"ka630.h"
include|#
directive|include
file|"ka650.h"
include|#
directive|include
file|"ka820.h"
include|#
directive|include
file|"../vaxuba/ubareg.h"
include|#
directive|include
file|"dz.h"
include|#
directive|include
file|"uu.h"
include|#
directive|include
file|"ps.h"
include|#
directive|include
file|"mba.h"
include|#
directive|include
file|"uba.h"
operator|.
name|set
name|HIGH
operator|,
literal|0x1f
operator|#
name|mask
end_expr_stmt

begin_for
for|for total disable 	.set	MCKVEC
operator|,
literal|4
operator|#
name|offset
name|into
name|scb
name|of
name|machine
name|check
name|vector
operator|.
name|set
name|NBPG
operator|,
literal|512
operator|.
name|set
name|PGSHIFT
operator|,
literal|9
operator|.
name|set
name|SYSTEM
operator|,
literal|0x80000000
operator|#
name|virtual
name|address
name|of
name|system
name|start
operator|.
name|set
name|NISP
operator|,
literal|3
operator|#
name|number
name|of
name|interrupt
name|stack
name|pages
comment|/*  * User structure is UPAGES at top of user space.  */
operator|.
name|globl
name|_u
operator|.
name|set
name|_u
operator|,
literal|0x80000000
operator|-
name|UPAGES
operator|*
name|NBPG
operator|.
name|globl
name|_intstack
name|_intstack
operator|:
operator|.
name|space
name|NISP
operator|*
name|NBPG
name|eintstack
operator|:
comment|/*  * Do a dump.  * Called by auto-restart.  * May be called manually.  */
operator|.
name|align
literal|2
operator|.
name|globl
name|_doadump
operator|.
name|globl
name|_msgbufmapped
name|_doadump
operator|:
name|nop
expr_stmt|;
end_for

begin_expr_stmt
name|nop
operator|#
operator|.
name|word
literal|0x0101
define|#
directive|define
name|_rpbmap
value|_Sysmap				# rpb, scb, UNIvec[], istack*4
name|bicl2
name|$PG_PROT
operator|,
name|_rpbmap
name|bisl2
name|$PG_KW
operator|,
name|_rpbmap
name|mtpr
name|$0
operator|,
name|$TBIA
name|tstl
name|_rpb
operator|+
name|RP_FLAG
operator|#
name|dump
name|only
name|once
operator|!
name|bneq
literal|1f
name|incl
name|_rpb
operator|+
name|RP_FLAG
name|movl
name|sp
operator|,
name|erpb
name|movab
name|erpb
operator|,
name|sp
name|mfpr
name|$PCBB
operator|,
operator|-
operator|(
name|sp
operator|)
name|mfpr
name|$MAPEN
operator|,
operator|-
operator|(
name|sp
operator|)
name|mfpr
name|$IPL
operator|,
operator|-
operator|(
name|sp
operator|)
name|clrl
name|_msgbufmapped
name|mtpr
name|$0
operator|,
name|$MAPEN
name|mtpr
name|$HIGH
operator|,
name|$IPL
name|pushr
name|$0x3fff
name|calls
name|$0
operator|,
name|_dumpsys
literal|1
operator|:
name|clrl
name|r11
operator|#
name|boot
name|flags
name|calls
name|$0
operator|,
name|_vaxboot
name|halt
comment|/*  * Interrupt vector routines  */
operator|.
name|globl
name|_waittime
define|#
directive|define
name|SCBVEC
parameter_list|(
name|name
parameter_list|)
value|.align 2; .globl _X
comment|/**/
value|name; _X
comment|/**/
value|name
define|#
directive|define
name|PANIC
parameter_list|(
name|msg
parameter_list|)
value|clrl _waittime; pushab 1f; \ 			calls $1,_panic; 1: .asciz msg
define|#
directive|define
name|PRINTF
parameter_list|(
name|n
parameter_list|,
name|msg
parameter_list|)
value|pushab 1f; calls $n+1,_printf; MSG(msg)
define|#
directive|define
name|MSG
parameter_list|(
name|msg
parameter_list|)
value|.data; 1: .asciz msg; .text
define|#
directive|define
name|PUSHR
value|pushr $0x3f
define|#
directive|define
name|POPR
value|popr $0x3f
operator|.
name|data
name|nofault
operator|:
operator|.
name|long
literal|0
operator|#
name|where
name|to
name|go
name|on
name|predicted
name|machcheck
operator|.
name|text
name|SCBVEC
argument_list|(
name|machcheck
argument_list|)
operator|:
name|tstl
name|nofault
name|bneq
literal|1f
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|pushab
literal|6
operator|*
literal|4
operator|(
name|sp
operator|)
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$1
decl_stmt|,
name|_machinecheck
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|POPR
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|addl2
argument_list|(
name|sp
argument_list|)
operator|+
operator|,
name|sp
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|rei
operator|.
name|align
literal|2
literal|1
operator|:
name|casel
name|_cpu
operator|,
name|$1
operator|,
name|$VAX_MAX
literal|0
operator|:
operator|.
name|word
literal|8f
operator|-
literal|0b
operator|#
literal|1
name|is
literal|780
operator|.
name|word
literal|5f
operator|-
literal|0b
operator|#
literal|2
name|is
literal|750
operator|.
name|word
literal|5f
operator|-
literal|0b
operator|#
literal|3
name|is
literal|730
operator|.
name|word
literal|7f
operator|-
literal|0b
operator|#
literal|4
name|is
literal|8600
operator|.
name|word
literal|5f
operator|-
literal|0b
operator|#
literal|5
name|is
literal|8200
operator|.
name|word
literal|1f
operator|-
literal|0b
operator|#
literal|6
name|is
literal|8800
operator|(
name|unsupported
operator|)
operator|.
name|word
literal|1f
operator|-
literal|0b
operator|#
literal|7
name|is
literal|610
operator|(
name|unsupported
operator|)
operator|.
name|word
literal|1f
operator|-
literal|0b
operator|#
literal|8
name|is
literal|630
operator|.
name|word
literal|1f
operator|-
literal|0b
operator|#
literal|9
name|is
operator|???
operator|.
name|word
literal|9f
operator|-
literal|0b
operator|#
literal|10
name|is
literal|650
literal|5
operator|:
if|#
directive|if
name|defined
argument_list|(
name|VAX8200
argument_list|)
operator|||
name|defined
argument_list|(
name|VAX750
argument_list|)
operator|||
name|defined
argument_list|(
name|VAX730
argument_list|)
name|mtpr
name|$0xf
operator|,
name|$MCESR
endif|#
directive|endif
name|brb
literal|1f
literal|7
operator|:
if|#
directive|if
name|VAX8600
name|mtpr
name|$0
operator|,
name|$EHSR
endif|#
directive|endif
name|brb
literal|1f
literal|8
operator|:
if|#
directive|if
name|VAX780
name|mtpr
name|$0
operator|,
name|$SBIFS
endif|#
directive|endif
name|brb
literal|1f
literal|9
operator|:
if|#
directive|if
name|VAX650
name|bitl
name|$PG_V
operator|,
name|_KA650MERRmap
name|beql
literal|1f
operator|#
name|don
literal|'t bother clearing err reg if not mapped in 	movl	$DSER_CLEAR,_ka650merr+4 #endif 1: 	addl2	(sp)+,sp		# discard mchchk trash 	movl	nofault,(sp) 	rei  SCBVEC(kspnotval): 	PANIC("KSP not valid"); SCBVEC(powfail): 	halt SCBVEC(chme): SCBVEC(chms): SCBVEC(chmu): 	PANIC("CHM? in kernel");  SCBVEC(nex0zvec): 	PUSHR 	clrl	r0 	brb	1f SCBVEC(nex1zvec): 	PUSHR 	movl	$1,r0 1: 	cmpl	_cpu,$VAX_8600		# this is a frill 	beql	2f 	mfpr	$IPL,-(sp) 	PRINTF(1, "nexus stray intr ipl%x\n") 	POPR 	rei 2: 	pushl	r0 	mfpr	$IPL,-(sp) 	PRINTF(2, "nexus stray intr ipl%x sbia%d\n") 	POPR 	rei  SCBVEC(cmrd): 	PUSHR; calls $0,_memerr; POPR; rei  SCBVEC(wtime):			/* sbi0err on 8600 */ #if VAX8600 	cmpl	_cpu,$VAX_8600 	bneq	wtimo 	PANIC("sbia0 error") wtimo: #endif 	PUSHR; pushl 6*4(sp); PRINTF(1, "write timeout %x\n"); POPR 	PANIC("wtimo")  SCBVEC(sbi0fail): 	PANIC("sbia0 fail") SCBVEC(sbi0alert): #if VAX8200 	cmpl	_cpu,$VAX_8200 	bneq	alert 	PUSHR; calls $0,_rxcdintr; POPR; rei alert: #endif 	PANIC("sbia0 alert") SCBVEC(sbi0fault): 	PANIC("sbia0 fault")  #ifdef notyet #if VAX8600 SCBVEC(sbi1fail): 	PANIC("sbia1 fail") SCBVEC(sbi1alert): 	PANIC("sbia1 alert") SCBVEC(sbi1fault): 	PANIC("sbia1 fault") SCBVEC(sbi1err): 	PANIC("sbia1 error") #endif #endif  /*  * BI 0 bus error (8200), or SBI silo compare error (others)  * VMS boot leaves us 1 BI error to ignore.  */ #if VAX8200&& 0 	.data 	.align	2 _ignorebi: .globl _ignorebi 	.long	1 	.text #endif VAX8200  SCBVEC(sbisilo): #if VAX8200 	cmpl	_cpu,$VAX_8200 	bneq	sbisilo #if 0 	blbs	_ignorebi,1f #else 	blbs	_cold,1f #endif 	PUSHR; pushl $0; calls $1,_bi_buserr; POPR 1: 	rei #endif sbisilo: 	PANIC("sbi silo compare error")  /*  * SCB stray interrupt catcher.  Compute and print the actual  * SCB vector (for fault diagnosis).  */ 	.align	2 _scbstray: .globl _scbstray #define	PJ	PUSHR;jsb 1f 	/* 128 of '
name|em
operator|*
operator|/
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
if|#
directive|if
name|VAX8600
comment|/* and another 128, for the second SBIA's scb */
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
endif|#
directive|endif
undef|#
directive|undef
name|PJ
literal|1
operator|:
name|subl3
name|$_scbstray
operator|+
literal|8
operator|,
operator|(
name|sp
operator|)
operator|+
operator|,
name|r0
name|mfpr
name|$IPL
operator|,
operator|-
operator|(
name|sp
operator|)
name|ashl
name|$
operator|-
literal|1
operator|,
name|r0
operator|,
operator|-
operator|(
name|sp
operator|)
comment|/* call a C handler instead? perhaps later */
name|PRINTF
argument_list|(
literal|2
argument_list|,
literal|"stray scb intr vec 0x%x ipl%x\n"
argument_list|)
name|POPR
name|rei
if|#
directive|if
name|NMBA
operator|>
literal|0
name|SCBVEC
argument_list|(
name|mba3int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|incl
name|_intrcnt
operator|+
name|I_MBA3
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|pushl
name|$3
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|brb
literal|1f
name|SCBVEC
argument_list|(
name|mba2int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|incl
name|_intrcnt
operator|+
name|I_MBA2
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|pushl
name|$2
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|brb
literal|1f
name|SCBVEC
argument_list|(
name|mba1int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|incl
name|_intrcnt
operator|+
name|I_MBA1
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|pushl
name|$1
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|brb
literal|1f
name|SCBVEC
argument_list|(
name|mba0int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|incl
name|_intrcnt
operator|+
name|I_MBA0
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|pushl
name|$0
literal|1
operator|:
name|calls
name|$1
operator|,
name|_mbintr
name|POPR
name|incl
name|_cnt
operator|+
name|V_INTR
name|rei
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DW780
comment|/*  * Registers for the uba handling code  */
define|#
directive|define
name|rUBANUM
value|r0
define|#
directive|define
name|rUBAHD
value|r1
define|#
directive|define
name|rUVEC
value|r3
define|#
directive|define
name|rUBA
value|r4
comment|/* r2,r5 are scratch */
define|#
directive|define
name|I_UBA
value|I_UBA0
comment|/* base of UBA interrupt counters */
if|#
directive|if
name|NUBA
operator|>
literal|4
name|SCBVEC
argument_list|(
name|ua7int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|movl
name|$7
decl_stmt|,
name|rUBANUM
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|moval
name|_uba_hd
operator|+
operator|(
literal|7
operator|*
name|UH_SIZE
operator|)
operator|,
name|rUBAHD
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|brb
literal|1f
name|SCBVEC
argument_list|(
name|ua6int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|movl
name|$6
decl_stmt|,
name|rUBANUM
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|moval
name|_uba_hd
operator|+
operator|(
literal|6
operator|*
name|UH_SIZE
operator|)
operator|,
name|rUBAHD
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|brb
literal|1f
name|SCBVEC
argument_list|(
name|ua5int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|movl
name|$5
decl_stmt|,
name|rUBANUM
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|moval
name|_uba_hd
operator|+
operator|(
literal|5
operator|*
name|UH_SIZE
operator|)
operator|,
name|rUBAHD
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|brb
literal|1f
name|SCBVEC
argument_list|(
name|ua4int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|movl
name|$4
decl_stmt|,
name|rUBANUM
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|moval
name|_uba_hd
operator|+
operator|(
literal|4
operator|*
name|UH_SIZE
operator|)
operator|,
name|rUBAHD
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|brb
literal|1f
endif|#
directive|endif
name|SCBVEC
argument_list|(
name|ua3int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|movl
name|$3
decl_stmt|,
name|rUBANUM
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|moval
name|_uba_hd
operator|+
operator|(
literal|3
operator|*
name|UH_SIZE
operator|)
operator|,
name|rUBAHD
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|brb
literal|1f
name|SCBVEC
argument_list|(
name|ua2int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|movl
name|$2
decl_stmt|,
name|rUBANUM
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|moval
name|_uba_hd
operator|+
operator|(
literal|2
operator|*
name|UH_SIZE
operator|)
operator|,
name|rUBAHD
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|brb
literal|1f
name|SCBVEC
argument_list|(
name|ua1int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|movl
name|$1
decl_stmt|,
name|rUBANUM
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|moval
name|_uba_hd
operator|+
operator|(
literal|1
operator|*
name|UH_SIZE
operator|)
operator|,
name|rUBAHD
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|brb
literal|1f
name|SCBVEC
argument_list|(
name|ua0int
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|movl
name|$0
decl_stmt|,
name|rUBANUM
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|moval
name|_uba_hd
operator|+
operator|(
literal|0
operator|*
name|UH_SIZE
operator|)
operator|,
name|rUBAHD
expr_stmt|;
end_expr_stmt

begin_expr_stmt
literal|1
operator|:
name|mfpr
name|$IPL
operator|,
name|r2
comment|/* r2 = mfpr(IPL); */
name|movl
name|UH_UBA
argument_list|(
name|rUBAHD
argument_list|)
operator|,
name|rUBA
comment|/* uba = uhp->uh_uba; */
name|movl
name|UBA_BRRVR
operator|-
literal|0x14
operator|*
literal|4
operator|(
name|rUBA
operator|)
index|[
name|r2
index|]
operator|,
name|rUVEC
comment|/* uvec = uba->uba_brrvr[r2-0x14] */
name|ubanorm
operator|:
name|bleq
name|ubaerror
name|addl2
name|UH_VEC
argument_list|(
name|rUBAHD
argument_list|)
operator|,
name|rUVEC
comment|/* uvec += uh->uh_vec */
name|bicl3
name|$3
operator|,
operator|(
name|rUVEC
operator|)
operator|,
name|r1
name|jmp
literal|2
operator|(
name|r1
operator|)
comment|/* 2 skips ``pushr $0x3f'' */
name|ubaerror
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$0
decl_stmt|,
name|_ubaerror
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|POPR
comment|/* ubaerror r/w's r0-r5 */
name|tstl
name|rUVEC
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|jneq
name|ubanorm
comment|/* rUVEC contains result */
name|incl
name|_intrcnt
operator|+
name|I_UBA
index|[
name|rUBANUM
index|]
name|incl
name|_cnt
operator|+
name|V_INTR
name|POPR
name|rei
endif|#
directive|endif
name|SCBVEC
argument_list|(
name|cnrint
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$0
decl_stmt|,
name|_cnrint
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|POPR
name|incl
name|_cnt
operator|+
name|V_INTR
name|incl
name|_intrcnt
operator|+
name|I_CNR
name|rei
name|SCBVEC
argument_list|(
name|cnxint
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$0
decl_stmt|,
name|_cnxint
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|POPR
name|incl
name|_cnt
operator|+
name|V_INTR
name|incl
name|_intrcnt
operator|+
name|I_CNX
name|rei
name|SCBVEC
argument_list|(
name|hardclock
argument_list|)
operator|:
name|PUSHR
name|mtpr
name|$ICCS_RUN
operator||
name|ICCS_IE
operator||
name|ICCS_INT
operator||
name|ICCS_ERR
operator|,
name|$ICCS
if|#
directive|if
name|NPS
operator|>
literal|0
name|pushl
literal|4
operator|+
literal|6
operator|*
literal|4
operator|(
name|sp
operator|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|pushl
literal|4
operator|+
literal|6
operator|*
literal|4
operator|(
name|sp
operator|)
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$2
decl_stmt|,
name|_psextsync
endif|#
directive|endif
name|pushl
decl|4+6
modifier|*
decl|4
argument_list|(
name|sp
argument_list|)
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|pushl
literal|4
operator|+
literal|6
operator|*
literal|4
operator|(
name|sp
operator|)
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$2
decl_stmt|,
name|_hardclock
decl|#
name|hardclock
argument_list|(
name|pc
argument_list|,
name|psl
argument_list|)
name|POPR
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|incl
name|_cnt
operator|+
name|V_INTR
name|incl
name|_intrcnt
operator|+
name|I_CLOCK
name|rei
name|SCBVEC
argument_list|(
name|softclock
argument_list|)
operator|:
name|PUSHR
name|pushl
literal|4
operator|+
literal|6
operator|*
literal|4
operator|(
name|sp
operator|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|pushl
literal|4
operator|+
literal|6
operator|*
literal|4
operator|(
name|sp
operator|)
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$2
decl_stmt|,
name|_softclock
decl|#
name|softclock
argument_list|(
name|pc
argument_list|,
name|psl
argument_list|)
name|POPR
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|incl
name|_cnt
operator|+
name|V_SOFT
name|rei
include|#
directive|include
file|"../net/netisr.h"
operator|.
name|globl
name|_netisr
name|SCBVEC
argument_list|(
name|netintr
argument_list|)
operator|:
name|PUSHR
include|#
directive|include
file|"imp.h"
if|#
directive|if
name|NIMP
operator|>
literal|0
name|bbcc
name|$NETISR_IMP
operator|,
name|_netisr
operator|,
literal|1f
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$0
decl_stmt|,
name|_impintr
decl_stmt|;
end_decl_stmt

begin_expr_stmt
literal|1
operator|:
endif|#
directive|endif
ifdef|#
directive|ifdef
name|INET
name|bbcc
name|$NETISR_IP
operator|,
name|_netisr
operator|,
literal|1f
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$0
decl_stmt|,
name|_ipintr
decl_stmt|;
end_decl_stmt

begin_expr_stmt
literal|1
operator|:
endif|#
directive|endif
ifdef|#
directive|ifdef
name|NS
name|bbcc
name|$NETISR_NS
operator|,
name|_netisr
operator|,
literal|1f
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$0
decl_stmt|,
name|_nsintr
decl_stmt|;
end_decl_stmt

begin_expr_stmt
literal|1
operator|:
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ISO
name|bbcc
name|$NETISR_ISO
operator|,
name|_netisr
operator|,
literal|1f
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$0
decl_stmt|,
name|_clnlintr
decl_stmt|;
end_decl_stmt

begin_expr_stmt
literal|1
operator|:
endif|#
directive|endif
name|POPR
name|incl
name|_cnt
operator|+
name|V_SOFT
name|rei
name|SCBVEC
argument_list|(
name|consdin
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|incl
name|_intrcnt
operator|+
name|I_TUR
name|casel
name|_cpu
operator|,
name|$VAX_750
operator|,
name|$VAX_8200
literal|0
operator|:
operator|.
name|word
literal|5f
operator|-
literal|0b
operator|#
literal|2
name|is
name|VAX_750
operator|.
name|word
literal|3f
operator|-
literal|0b
operator|#
literal|3
name|is
name|VAX_730
operator|.
name|word
literal|6f
operator|-
literal|0b
operator|#
literal|4
name|is
name|VAX_8600
operator|.
name|word
literal|7f
operator|-
literal|0b
operator|#
literal|5
name|is
name|VAX_8200
name|halt
literal|5
operator|:
if|#
directive|if
name|defined
argument_list|(
name|VAX750
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|MRSP
argument_list|)
name|jsb
name|tudma
endif|#
directive|endif
literal|3
operator|:
if|#
directive|if
name|defined
argument_list|(
name|VAX750
argument_list|)
operator|||
name|defined
argument_list|(
name|VAX730
argument_list|)
name|calls
name|$0
operator|,
name|_turintr
name|brb
literal|2f
else|#
directive|else
name|halt
endif|#
directive|endif
literal|7
operator|:
if|#
directive|if
name|VAX8200
name|calls
name|$0
operator|,
name|_rx50intr
name|brb
literal|2f
else|#
directive|else
name|halt
endif|#
directive|endif
literal|6
operator|:
if|#
directive|if
name|VAX8600
name|calls
name|$0
operator|,
name|_crlintr
else|#
directive|else
name|halt
endif|#
directive|endif
literal|2
operator|:
name|POPR
name|incl
name|_cnt
operator|+
name|V_INTR
name|rei
if|#
directive|if
name|defined
argument_list|(
name|VAX750
argument_list|)
operator|||
name|defined
argument_list|(
name|VAX730
argument_list|)
name|SCBVEC
argument_list|(
name|consdout
argument_list|)
operator|:
name|PUSHR
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$0
decl_stmt|,
name|_tuxintr
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|POPR
name|incl
name|_cnt
operator|+
name|V_INTR
name|incl
name|_intrcnt
operator|+
name|I_TUX
name|rei
else|#
directive|else
name|SCBVEC
argument_list|(
name|consdout
argument_list|)
operator|:
name|halt
endif|#
directive|endif
if|#
directive|if
name|NDZ
operator|>
literal|0
comment|/*  * DZ pseudo dma routine:  *	r0 - controller number  */
operator|.
name|align
literal|1
operator|.
name|globl
name|dzdma
name|dzdma
operator|:
name|mull2
name|$8
operator|*
literal|20
operator|,
name|r0
name|movab
name|_dzpdma
argument_list|(
name|r0
argument_list|)
operator|,
name|r3
operator|#
name|pdma
name|structure
name|base
empty|# for this controller
name|dzploop
operator|:
name|movl
name|r3
operator|,
name|r0
name|movl
argument_list|(
name|r0
argument_list|)
operator|+
operator|,
name|r1
operator|#
name|device
specifier|register
name|address
name|movzbl
literal|1
operator|(
name|r1
operator|)
operator|,
name|r2
operator|#
name|get
name|line
name|number
name|bitb
name|$0x80
operator|,
name|r2
operator|#
name|TRDY
name|on
condition|?
name|beql
name|dzprei
operator|#
name|no
name|bicb2
name|$0xf8
operator|,
name|r2
operator|#
name|clear
name|garbage
name|bits
name|mull2
name|$20
operator|,
name|r2
name|addl2
name|r2
operator|,
name|r0
operator|#
name|point
name|at
name|line
literal|'s pdma structure 	movl	(r0)+,r2		# p_mem 	cmpl	r2,(r0)+		# p_mem< p_end ? 	bgequ	dzpcall			# no, go call dzxint 	movb	(r2)+,6(r1)		# dztbuf = *p_mem++ 	movl	r2,-8(r0) 	brb 	dzploop			# check for another line dzprei: 	POPR 	incl	_cnt+V_PDMA 	rei  dzpcall: 	pushl	r3 	pushl	(r0)+			# push tty address 	calls	$1,*(r0)		# call interrupt rtn 	movl	(sp)+,r3 	brb 	dzploop			# check for another line #endif  #if NUU> 0&& defined(UUDMA) /*  * Pseudo DMA routine for tu58 (on DL11)  *	r0 - controller number  */ 	.align	1 	.globl	uudma uudma: 	movl	_uudinfo[r0],r2 	movl	16(r2),r2		# r2 = uuaddr 	mull3	$48,r0,r3 	movab	_uu_softc(r3),r5	# r5 = uuc  	cvtwl	2(r2),r1		# c = uuaddr->rdb 	bbc	$15,r1,1f		# if (c& UUDB_ERROR) 	movl	$13,16(r5)		#	uuc->tu_state = TUC_RCVERR; 	rsb				#	let uurintr handle it 1: 	tstl	4(r5)			# if (uuc->tu_rcnt) { 	beql	1f 	movb	r1,*0(r5)		#	*uuc->tu_rbptr++ = r1 	incl	(r5) 	decl	4(r5)			#	if (--uuc->tu_rcnt) 	beql	2f			#		done 	tstl	(sp)+ 	POPR				# 	registers saved in ubglue.s 	rei				# } 2: 	cmpl	16(r5),$8		# if (uuc->tu_state != TUS_GETH) 	beql	2f			# 	let uurintr handle it 1: 	rsb 2: 	mull2	$14,r0			# sizeof(uudata[ctlr]) = 14 	movab	_uudata(r0),r4		# data =&uudata[ctlr]; 	cmpb	$1,(r4)			# if (data->pk_flag != TUF_DATA) 	bneq	1b #ifdef notdef 	/* this is for command packets */ 	beql	1f			# 	r0 = uuc->tu_rbptr 	movl	(r5),r0 	brb	2f 1:					# else #endif 	movl	24(r5),r0		# 	r0 = uuc->tu_addr 2: 	movzbl	1(r4),r3		# counter to r3 (data->pk_count) 	movzwl	(r4),r1			# first word of checksum (=header) 	mfpr	$IPL,-(sp)		# s = spl5(); 	mtpr	$0x15,$IPL		# to keep disk interrupts out 	clrw	(r2)			# disable receiver interrupts 3:	bbc	$7,(r2),3b		# while ((uuaddr->rcs& UUCS_READY)==0); 	cvtwb	2(r2),(r0)+		# *buffer = uuaddr->rdb& 0xff 	sobgtr	r3,1f			# continue with next byte ... 	addw2	2(r2),r1		# unless this was the last (odd count) 	brb	2f  1:	bbc	$7,(r2),1b		# while ((uuaddr->rcs& UUCS_READY)==0); 	cvtwb	2(r2),(r0)+		# *buffer = uuaddr->rdb& 0xff 	addw2	-2(r0),r1		# add to checksum.. 2: 	adwc	$0,r1			# get the carry 	sobgtr	r3,3b			# loop while r3> 0 /*  * We'
name|re
name|ready
name|to
name|get
name|the
name|checksum
operator|*
operator|/
literal|1
operator|:
name|bbc
name|$7
operator|,
operator|(
name|r2
operator|)
operator|,
literal|1b
operator|#
end_expr_stmt

begin_while
while|while
condition|(
operator|(
name|uuaddr
operator|->
name|rcs
operator|&
name|UUCS_READY
operator|)
operator|==
literal|0
condition|)
empty_stmt|;
end_while

begin_expr_stmt
name|cvtwb
literal|2
operator|(
name|r2
operator|)
operator|,
literal|12
operator|(
name|r4
operator|)
operator|#
name|get
name|first
argument_list|(
argument|lower
argument_list|)
name|byte
literal|1
operator|:
name|bbc
name|$7
operator|,
operator|(
name|r2
operator|)
operator|,
literal|1b
name|cvtwb
literal|2
operator|(
name|r2
operator|)
operator|,
literal|13
operator|(
name|r4
operator|)
operator|#
operator|..
name|and
name|second
name|cmpw
literal|12
operator|(
name|r4
operator|)
operator|,
name|r1
operator|#
name|is
name|checksum
name|ok
condition|?
name|beql
literal|1f
name|movl
name|$14
operator|,
literal|16
operator|(
name|r5
operator|)
operator|#
name|uuc
operator|->
name|tu_state
operator|=
name|TUS_CHKERR
name|brb
literal|2f
operator|#
name|exit
literal|1
operator|:
name|movl
name|$11
operator|,
literal|16
operator|(
name|r5
operator|)
operator|#
name|uuc
operator|->
name|tu_state
operator|=
name|TUS_GET
argument_list|(
name|ok
argument_list|)
literal|2
operator|:
name|movw
name|$0x40
operator|,
operator|(
name|r2
operator|)
operator|#
name|enable
name|receiver
name|interrupts
name|mtpr
argument_list|(
name|sp
argument_list|)
operator|+
operator|,
name|$IPL
operator|#
name|splx
argument_list|(
name|s
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|rsb
operator|#
end_expr_stmt

begin_continue
continue|continue
name|processing
name|in
name|uurintr
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|VAX750
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|MRSP
argument_list|)
comment|/*  * Pseudo DMA routine for VAX-11/750 console tu58   *   	    (without MRSP)  */
operator|.
name|align
continue|1 	.
name|globl
name|tudma
name|tudma
continue|:
name|movab
name|_tu
operator|,
name|r5
continue|#
name|r5
continue|=
name|tu
name|tstl
continue|4(
name|r5
end_continue

begin_expr_stmt
unit|)
operator|#
end_expr_stmt

begin_if
if|if
condition|(
name|tu
operator|.
name|tu_rcnt
condition|)
block|{
name|beql
literal|3f
name|mfpr
name|$CSRD
operator|,
name|r1
operator|#
name|get
name|data
name|from
name|tu58
name|movb
name|r1
operator|,
operator|*
literal|0
operator|(
name|r5
operator|)
operator|#
operator|*
name|tu
operator|.
name|tu_rbptr
operator|++
operator|=
name|r1
name|incl
argument_list|(
argument|r5
argument_list|)
name|decl
literal|4
operator|(
name|r5
operator|)
operator|#
if|if
condition|(
operator|--
name|tu
operator|.
name|tu_rcnt
condition|)
name|beql
literal|1f
operator|#
name|done
name|tstl
argument_list|(
name|sp
argument_list|)
operator|+
name|POPR
operator|#
name|registers
name|saved
name|in
name|ubglue
operator|.
name|s
name|rei
operator|#
name|data
name|handled
operator|,
name|done
literal|1
operator|:
operator|#
block|}
end_if

begin_expr_stmt
name|cmpl
literal|16
operator|(
name|r5
operator|)
operator|,
name|$8
operator|#
end_expr_stmt

begin_if
if|if
condition|(
name|tu
operator|.
name|tu_state
operator|!=
name|TUS_GETH
condition|)
name|beql
literal|2f
operator|#
name|let
name|turintr
name|handle
name|it
literal|3
operator|:
name|rsb
literal|2
operator|:
name|movab
name|_tudata
operator|,
name|r4
operator|#
name|r4
operator|=
name|tudata
name|cmpb
name|$1
operator|,
operator|(
name|r4
operator|)
operator|#
end_if

begin_if
if|if
condition|(
name|tudata
operator|.
name|pk_flag
operator|!=
name|TUF_DATA
condition|)
name|bneq
literal|3b
operator|#
name|let
name|turintr
name|handle
name|it
literal|1
operator|:
operator|#
else|else
name|movl
literal|24
operator|(
name|r5
operator|)
operator|,
name|r1
operator|#
name|get
name|buffer
name|pointer
name|to
name|r1
name|movzbl
literal|1
operator|(
name|r4
operator|)
operator|,
name|r3
operator|#
name|counter
name|to
name|r3
name|movzwl
argument_list|(
name|r4
argument_list|)
operator|,
name|r0
operator|#
name|first
name|word
name|of
name|checksum
argument_list|(
argument|=header
argument_list|)
name|mtpr
name|$0
operator|,
name|$CSRS
operator|#
name|disable
name|receiver
name|interrupts
literal|3
operator|:
name|bsbw
literal|5f
operator|#
name|wait
end_if

begin_for
for|for next byte 	mfpr	$CSRD
operator|,
name|r5
name|movb
name|r5
decl_stmt|,
argument_list|(
name|r1
argument_list|)
decl_stmt|+		#
modifier|*
name|buffer
init|=
name|rdb
name|sobgtr
name|r3
decl_stmt|,1f			# continue
name|with
name|next
name|byte
modifier|...
name|mfpr
name|$CSRD
decl_stmt|,
name|r2
decl|#
name|unless
name|this
name|was
name|the
name|last
argument_list|(
name|odd
name|count
argument_list|)
name|brb
decl|2f  1
range|:
name|bsbw
literal|5f
operator|#
name|wait
end_for

begin_for
for|for next byte 	mfpr	$CSRD
operator|,
name|r5
name|movb
name|r5
decl_stmt|,
argument_list|(
name|r1
argument_list|)
decl_stmt|+		#
modifier|*
name|buffer
init|=
name|rdb
name|movzwl
operator|-
literal|2
operator|(
name|r1
operator|)
decl_stmt|,
name|r2
decl|#
name|get
name|the
name|last
name|word
name|back
name|from
name|memory
decl|2
range|:
name|addw2
name|r2
decl_stmt|,
name|r0
decl|#
name|add
name|to
name|checksum
decl|..
name|adwc
name|$0
decl_stmt|,
name|r0
decl|#
name|get
name|the
name|carry
name|sobgtr
name|r3
decl_stmt|,3b			#
name|loop
decl|while
name|r3
decl|> 0
comment|/*  * We're ready to get the checksum.  */
name|bsbw
decl|5f
name|movab
name|_tudata
decl_stmt|,
name|r4
name|mfpr
name|$CSRD
decl_stmt|,
name|r5
name|movb
name|r5
decl_stmt|,12
argument_list|(
name|r4
argument_list|)
decl_stmt|#
name|get
name|first
argument_list|(
name|lower
argument_list|)
name|byte
name|bsbw
decl|5f
name|mfpr
name|$CSRD
decl_stmt|,
name|r5
name|movb
name|r5
decl_stmt|,13
argument_list|(
name|r4
argument_list|)
decl_stmt|# ..
name|and
name|second
name|movab
name|_tu
decl_stmt|,
name|r5
name|cmpw
decl|12
argument_list|(
name|r4
argument_list|)
decl_stmt|,
name|r0
decl|#
name|is
name|checksum
name|ok
decl|?
name|beql
decl|1f
name|movl
name|$14
decl_stmt|,16
argument_list|(
name|r5
argument_list|)
decl_stmt|#
name|tu
operator|.
name|tu_state
init|=
name|TUS_CHKERR
name|brb
literal|2f
operator|#
name|exit
literal|1
operator|:
name|movl
name|$11
decl_stmt|,16
argument_list|(
name|r5
argument_list|)
decl_stmt|#
name|tu
operator|.
name|tu_state
init|=
name|TUS_GET
literal|2
operator|:
name|mtpr
name|$0x40
decl_stmt|,
name|$CSRS
decl|#
name|enable
name|receiver
name|interrupts
name|rsb
decl|# continue
name|processing
name|in
name|turintr
comment|/*  * Loop until a new byte is ready from  * the tu58, make sure we don't loop forever  */
decl|5
range|:
name|movl
name|$5000
decl_stmt|,
name|r5
decl|#
name|loop
name|max
decl|5000
name|times
decl|1
range|:
name|mfpr
name|$CSRS
decl_stmt|,
name|r2
name|bbs
name|$7
decl_stmt|,
name|r2
decl_stmt|,1f
name|sobgtr
name|r5
decl_stmt|,1b
name|movab
name|_tu
decl_stmt|,
name|r5
name|movl
name|$13
decl_stmt|,16
argument_list|(
name|r5
argument_list|)
decl_stmt|# return
name|TUS_RCVERR
name|tstl
argument_list|(
name|sp
argument_list|)
decl|+			#
name|and
name|let
name|turintr
name|handle
name|it
decl|1
range|:
name|rsb
endif|#
directive|endif
comment|/*  * BI passive release things.  */
name|SCBVEC
argument_list|(
name|passiverel
argument_list|)
operator|:
name|rei
operator|#
name|well
name|that
name|was
name|useless
comment|/*  * Stray UNIBUS interrupt catch routines  */
operator|.
name|data
operator|.
name|align
literal|2
define|#
directive|define
name|PJ
value|PUSHR;jsb _Xustray
operator|.
name|globl
name|_catcher
name|_catcher
operator|:
name|PJ
decl_stmt|;
end_for

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
name|PJ
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|PJ
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|PJ
operator|.
name|globl
name|_cold
operator|.
name|globl
name|_br
operator|.
name|globl
name|_cvec
name|_cold
range|:
operator|.
name|long
literal|1
name|_br
operator|:
operator|.
name|long
literal|0
name|_cvec
operator|:
operator|.
name|long
literal|0
operator|.
name|text
name|SCBVEC
argument_list|(
name|ustray
argument_list|)
operator|:
name|blbc
name|_cold
decl_stmt|,1f
name|mfpr
name|$IPL
decl_stmt|,
name|r11
name|movl
name|r11
decl_stmt|,
name|_br
name|subl3
name|$_catcher
decl|+8
decl_stmt|,
argument_list|(
name|sp
argument_list|)
decl_stmt|+,
name|r10
name|ashl
name|$
decl|-1
decl_stmt|,
name|r10
decl_stmt|,
name|r10
name|movl
name|r10
decl_stmt|,
name|_cvec
name|POPR
name|rei
decl|1
range|:
name|subl3
name|$_catcher
operator|+
literal|8
decl_stmt|,
argument_list|(
name|sp
argument_list|)
decl_stmt|+,
name|r0
name|ashl
name|$
decl|-1
decl_stmt|,
name|r0
decl_stmt|,-
argument_list|(
name|sp
argument_list|)
name|mfpr
name|$IPL
decl_stmt|,-
argument_list|(
name|sp
argument_list|)
name|PRINTF
argument_list|(
literal|2
argument_list|,
literal|"uba?: stray intr ipl %x vec %o\n"
argument_list|)
name|POPR
name|rei
if|#
directive|if
name|VAX630
operator|||
name|VAX650
comment|/*  * Emulation OpCode jump table:  *	ONLY GOES FROM 0xf8 (-8) TO 0x3B (59)  */
define|#
directive|define
name|EMUTABLE
value|0x43
define|#
directive|define
name|NOEMULATE
value|.long noemulate
define|#
directive|define
name|EMULATE
parameter_list|(
name|a
parameter_list|)
value|.long _EM
comment|/**/
value|a
operator|.
name|globl
name|_emJUMPtable
name|_emJUMPtable
range|:
comment|/* f8 */
name|EMULATE
argument_list|(
name|ashp
argument_list|)
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|EMULATE
argument_list|(
name|cvtlp
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|NOEMULATE
comment|/* fc */
name|NOEMULATE
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|NOEMULATE
comment|/* 00 */
name|NOEMULATE
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|NOEMULATE
comment|/* 04 */
name|NOEMULATE
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_function_decl
name|NOEMULATE
comment|/* 08 */
name|EMULATE
parameter_list|(
name|cvtps
parameter_list|)
function_decl|;
end_function_decl

begin_expr_stmt
name|EMULATE
argument_list|(
name|cvtsp
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_macro
name|EMULATE
argument_list|(
argument|crc
argument_list|)
end_macro

begin_comment
comment|/* 0c */
end_comment

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|NOEMULATE
comment|/* 10 */
name|NOEMULATE
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|NOEMULATE
comment|/* 14 */
name|NOEMULATE
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|NOEMULATE
comment|/* 18 */
name|NOEMULATE
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|NOEMULATE
comment|/* 1c */
name|NOEMULATE
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_function_decl
name|NOEMULATE
comment|/* 20 */
name|EMULATE
parameter_list|(
name|addp4
parameter_list|)
function_decl|;
end_function_decl

begin_expr_stmt
name|EMULATE
argument_list|(
name|addp6
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|EMULATE
argument_list|(
name|subp4
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|EMULATE
argument_list|(
argument|subp6
argument_list|)
end_macro

begin_comment
comment|/* 24 */
end_comment

begin_expr_stmt
name|EMULATE
argument_list|(
name|cvtpt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|EMULATE
argument_list|(
name|mulp
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|EMULATE
argument_list|(
name|cvttp
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|EMULATE
argument_list|(
argument|divp
argument_list|)
end_macro

begin_comment
comment|/* 28 */
end_comment

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|EMULATE
argument_list|(
name|cmpc3
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|EMULATE
argument_list|(
name|scanc
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|EMULATE
argument_list|(
argument|spanc
argument_list|)
end_macro

begin_comment
comment|/* 2c */
end_comment

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|EMULATE
argument_list|(
name|cmpc5
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|EMULATE
argument_list|(
name|movtc
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|EMULATE
argument_list|(
argument|movtuc
argument_list|)
end_macro

begin_comment
comment|/* 30 */
end_comment

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|NOEMULATE
expr_stmt|;
end_expr_stmt

begin_function_decl
name|NOEMULATE
comment|/* 34 */
name|EMULATE
parameter_list|(
name|movp
parameter_list|)
function_decl|;
end_function_decl

begin_expr_stmt
name|EMULATE
argument_list|(
name|cmpp3
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|EMULATE
argument_list|(
name|cvtpl
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|EMULATE
argument_list|(
argument|cmpp4
argument_list|)
end_macro

begin_comment
comment|/* 38 */
end_comment

begin_expr_stmt
name|EMULATE
argument_list|(
name|editpc
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|EMULATE
argument_list|(
name|matchc
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|EMULATE
argument_list|(
name|locc
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|EMULATE
argument_list|(
argument|skpc
argument_list|)
end_macro

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Trap and fault vector routines  */
end_comment

begin_define
define|#
directive|define
name|TRAP
parameter_list|(
name|a
parameter_list|)
value|pushl $T_
comment|/**/
value|a; jbr alltraps
end_define

begin_comment
comment|/*  * Ast delivery (profiling and/or reschedule)  */
end_comment

begin_expr_stmt
name|SCBVEC
argument_list|(
name|astflt
argument_list|)
operator|:
name|pushl
name|$0
expr_stmt|;
end_expr_stmt

begin_macro
name|TRAP
argument_list|(
argument|ASTFLT
argument_list|)
end_macro

begin_expr_stmt
name|SCBVEC
argument_list|(
name|privinflt
argument_list|)
operator|:
name|pushl
name|$0
expr_stmt|;
end_expr_stmt

begin_macro
name|TRAP
argument_list|(
argument|PRIVINFLT
argument_list|)
end_macro

begin_expr_stmt
name|SCBVEC
argument_list|(
name|xfcflt
argument_list|)
operator|:
name|pushl
name|$0
expr_stmt|;
end_expr_stmt

begin_macro
name|TRAP
argument_list|(
argument|XFCFLT
argument_list|)
end_macro

begin_expr_stmt
name|SCBVEC
argument_list|(
name|resopflt
argument_list|)
operator|:
name|pushl
name|$0
expr_stmt|;
end_expr_stmt

begin_macro
name|TRAP
argument_list|(
argument|RESOPFLT
argument_list|)
end_macro

begin_expr_stmt
name|SCBVEC
argument_list|(
name|resadflt
argument_list|)
operator|:
name|pushl
name|$0
expr_stmt|;
end_expr_stmt

begin_macro
name|TRAP
argument_list|(
argument|RESADFLT
argument_list|)
end_macro

begin_expr_stmt
name|SCBVEC
argument_list|(
name|bptflt
argument_list|)
operator|:
name|pushl
name|$0
expr_stmt|;
end_expr_stmt

begin_macro
name|TRAP
argument_list|(
argument|BPTFLT
argument_list|)
end_macro

begin_expr_stmt
name|SCBVEC
argument_list|(
name|compatflt
argument_list|)
operator|:
name|TRAP
argument_list|(
name|COMPATFLT
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|SCBVEC
argument_list|(
name|kdbintr
argument_list|)
operator|:
name|pushl
name|$0
expr_stmt|;
end_expr_stmt

begin_macro
name|TRAP
argument_list|(
argument|KDBTRAP
argument_list|)
end_macro

begin_expr_stmt
name|SCBVEC
argument_list|(
name|tracep
argument_list|)
operator|:
name|pushl
name|$0
expr_stmt|;
end_expr_stmt

begin_macro
name|TRAP
argument_list|(
argument|TRCTRAP
argument_list|)
end_macro

begin_expr_stmt
name|SCBVEC
argument_list|(
name|arithtrap
argument_list|)
operator|:
name|TRAP
argument_list|(
argument|ARITHTRAP
argument_list|)
name|SCBVEC
argument_list|(
name|protflt
argument_list|)
operator|:
name|blbs
argument_list|(
name|sp
argument_list|)
operator|+
operator|,
name|segflt
name|TRAP
argument_list|(
argument|PROTFLT
argument_list|)
name|segflt
operator|:
name|TRAP
argument_list|(
argument|SEGFLT
argument_list|)
comment|/*  * The following is called with the stack set up as follows:  *  *	  (sp):	Opcode  *	 4(sp):	Instruction PC  *	 8(sp):	Operand 1  *	12(sp):	Operand 2  *	16(sp):	Operand 3  *	20(sp):	Operand 4  *	24(sp):	Operand 5  *	28(sp):	Operand 6  *	32(sp):	Operand 7 (unused)  *	36(sp):	Operand 8 (unused)  *	40(sp):	Return PC  *	44(sp):	Return PSL  *	48(sp): TOS before instruction  *  * Each individual routine is called with the stack set up as follows:  *  *	  (sp):	Return address of trap handler  *	 4(sp):	Opcode (will get return PSL)  *	 8(sp):	Instruction PC  *	12(sp):	Operand 1  *	16(sp):	Operand 2  *	20(sp):	Operand 3  *	24(sp):	Operand 4  *	28(sp):	Operand 5  *	32(sp):	Operand 6  *	36(sp):	saved register 11  *	40(sp):	saved register 10  *	44(sp):	Return PC  *	48(sp):	Return PSL  *	52(sp): TOS before instruction  */
name|SCBVEC
argument_list|(
name|emulate
argument_list|)
operator|:
if|#
directive|if
name|VAX630
operator|||
name|VAX650
name|movl
name|r11
operator|,
literal|32
operator|(
name|sp
operator|)
operator|#
name|save
specifier|register
name|r11
name|in
name|unused
name|operand
name|movl
name|r10
operator|,
literal|36
operator|(
name|sp
operator|)
operator|#
name|save
specifier|register
name|r10
name|in
name|unused
name|operand
name|cvtbl
argument_list|(
name|sp
argument_list|)
operator|,
name|r10
operator|#
name|get
name|opcode
name|addl2
name|$8
operator|,
name|r10
operator|#
name|shift
name|negative
name|opcodes
name|subl3
name|r10
operator|,
name|$EMUTABLE
operator|,
name|r11
operator|#
name|forget
name|it
end_expr_stmt

begin_if
if|if opcode is out of range 	bcs	noemulate 	movl	_emJUMPtable[r10]
operator|,
name|r10
operator|#
name|call
name|appropriate
name|emulation
name|routine
name|jsb
argument_list|(
name|r10
argument_list|)
operator|#
name|routines
name|put
end_if

begin_return
return|return
name|values
name|into
name|regs
literal|0
operator|-
literal|5
name|movl
literal|32
operator|(
name|sp
operator|)
operator|,
name|r11
operator|#
name|restore
specifier|register
name|r11
name|movl
literal|36
operator|(
name|sp
operator|)
operator|,
name|r10
operator|#
name|restore
specifier|register
name|r10
name|insv
argument_list|(
name|sp
argument_list|)
operator|,
name|$0
operator|,
name|$4
operator|,
literal|44
operator|(
name|sp
operator|)
operator|#
name|and
name|condition
name|codes
name|in
name|Opcode
name|spot
name|addl2
name|$40
operator|,
name|sp
operator|#
name|adjust
name|stack
end_return

begin_for
for|for return 	rei noemulate: 	addl2	$48
operator|,
name|sp
operator|#
name|adjust
name|stack
end_for

begin_for
for|for
endif|#
directive|endif
for|.word	0xffff			# "reserved instruction fault" SCBVEC
control|(
name|emulateFPD
control|)
block|:
operator|.
name|word
literal|0xffff
operator|#
literal|"reserved instruction fault"
name|SCBVEC
argument_list|(
name|transflt
argument_list|)
operator|:
name|bitl
name|$2
operator|,
operator|(
name|sp
operator|)
operator|+
name|bnequ
name|tableflt
name|jsb
name|Fastreclaim
operator|#
name|try
name|and
name|avoid
name|pagein
name|TRAP
argument_list|(
argument|PAGEFLT
argument_list|)
name|tableflt
operator|:
name|TRAP
argument_list|(
argument|TABLEFLT
argument_list|)
name|alltraps
operator|:
name|mfpr
name|$USP
operator|,
operator|-
operator|(
name|sp
operator|)
expr_stmt|;
end_for

begin_decl_stmt
name|calls
name|$0
decl_stmt|,
name|_trap
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|mtpr
argument_list|(
name|sp
argument_list|)
operator|+
operator|,
name|$USP
name|incl
name|_cnt
operator|+
name|V_TRAP
name|addl2
name|$8
operator|,
name|sp
operator|#
name|pop
name|type
operator|,
name|code
name|mtpr
name|$HIGH
operator|,
name|$IPL
operator|#
operator|#
name|dont
name|go
name|to
name|a
name|higher
name|IPL
argument_list|(
argument|GROT
argument_list|)
name|rei
name|SCBVEC
argument_list|(
name|syscall
argument_list|)
operator|:
name|pushl
name|$T_SYSCALL
name|mfpr
name|$USP
operator|,
operator|-
operator|(
name|sp
operator|)
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$0
decl_stmt|,
name|_syscall
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|mtpr
argument_list|(
name|sp
argument_list|)
operator|+
operator|,
name|$USP
name|incl
name|_cnt
operator|+
name|V_SYSCALL
name|addl2
name|$8
operator|,
name|sp
operator|#
name|pop
name|type
operator|,
name|code
name|mtpr
name|$HIGH
operator|,
name|$IPL
operator|#
operator|#
name|dont
name|go
name|to
name|a
name|higher
name|IPL
argument_list|(
argument|GROT
argument_list|)
name|rei
comment|/*  * System page table  * Mbmap and Usrptmap are enlarged by CLSIZE entries  * as they are managed by resource maps starting with index 1 or CLSIZE.  */
define|#
directive|define
name|vaddr
parameter_list|(
name|x
parameter_list|)
value|((((x)-_Sysmap)/4)*NBPG+0x80000000)
define|#
directive|define
name|SYSMAP
parameter_list|(
name|mname
parameter_list|,
name|vname
parameter_list|,
name|npte
parameter_list|)
define|\
value|_
comment|/**/
value|mname:	.globl	_
comment|/**/
value|mname;		\ 	.space	(npte)*4;				\ 	.globl	_
comment|/**/
value|vname;			\ 	.set	_
comment|/**/
value|vname,vaddr(_
comment|/**/
value|mname)
define|#
directive|define
name|ADDMAP
parameter_list|(
name|npte
parameter_list|)
value|.space	(npte)*4
operator|.
name|data
operator|.
name|align
literal|2
name|SYSMAP
argument_list|(
argument|Sysmap
argument_list|,
argument|Sysbase
argument_list|,
argument|SYSPTSIZE
argument_list|)
name|SYSMAP
argument_list|(
argument|Forkmap
argument_list|,
argument|forkutl
argument_list|,
argument|UPAGES
argument_list|)
name|SYSMAP
argument_list|(
argument|Xswapmap
argument_list|,
argument|xswaputl
argument_list|,
argument|UPAGES
argument_list|)
name|SYSMAP
argument_list|(
argument|Xswap2map
argument_list|,
argument|xswap2utl
argument_list|,
argument|UPAGES
argument_list|)
name|SYSMAP
argument_list|(
argument|Swapmap
argument_list|,
argument|swaputl
argument_list|,
argument|UPAGES
argument_list|)
name|SYSMAP
argument_list|(
argument|Pushmap
argument_list|,
argument|pushutl
argument_list|,
argument|UPAGES
argument_list|)
name|SYSMAP
argument_list|(
argument|Vfmap
argument_list|,
argument|vfutl
argument_list|,
argument|UPAGES
argument_list|)
name|SYSMAP
argument_list|(
argument|CMAP1
argument_list|,
argument|CADDR1
argument_list|,
literal|1
argument_list|)
name|SYSMAP
argument_list|(
argument|CMAP2
argument_list|,
argument|CADDR2
argument_list|,
literal|1
argument_list|)
name|SYSMAP
argument_list|(
argument|mmap
argument_list|,
argument|vmmap
argument_list|,
literal|1
argument_list|)
name|SYSMAP
argument_list|(
argument|alignmap
argument_list|,
argument|alignutl
argument_list|,
literal|1
argument_list|)
comment|/* XXX */
name|SYSMAP
argument_list|(
argument|msgbufmap
argument_list|,
argument|msgbuf
argument_list|,
argument|MSGBUFPTECNT
argument_list|)
name|SYSMAP
argument_list|(
argument|Mbmap
argument_list|,
argument|mbutl
argument_list|,
argument|NMBCLUSTERS*MCLBYTES/NBPG+CLSIZE
argument_list|)
ifdef|#
directive|ifdef
name|MFS
include|#
directive|include
file|"../ufs/mfsiom.h"
comment|/* 	 * Used by the mfs_doio() routine for physical I/O 	 */
name|SYSMAP
argument_list|(
argument|Mfsiomap
argument_list|,
argument|mfsiobuf
argument_list|,
argument|MFS_MAPREG
argument_list|)
endif|#
directive|endif
comment|/* MFS */
ifdef|#
directive|ifdef
name|NFS
include|#
directive|include
file|"../nfs/nfsiom.h"
comment|/* 	 * Used by the nfs_doio() routine for physical I/O 	 */
name|SYSMAP
argument_list|(
argument|Nfsiomap
argument_list|,
argument|nfsiobuf
argument_list|,
argument|NFS_MAPREG
argument_list|)
endif|#
directive|endif
comment|/* NFS */
comment|/* 	 * This is the map used by the kernel memory allocator. 	 * It is expanded as necessary by the special features 	 * that use it. 	 * 	 * XXX: NEED way to compute kmem size from maxusers, 	 * device complement 	 */
name|SYSMAP
argument_list|(
argument|kmempt
argument_list|,
argument|kmembase
argument_list|,
argument|NKMEMCLUSTERS*CLSIZE
argument_list|)
ifdef|#
directive|ifdef
name|SYSVSHM
name|ADDMAP
argument_list|(
argument|SHMMAXPGS
argument_list|)
endif|#
directive|endif
ifdef|#
directive|ifdef
name|GPROF
name|ADDMAP
argument_list|(
literal|600
argument|*CLSIZE
argument_list|)
endif|#
directive|endif
name|SYSMAP
argument_list|(
argument|ekmempt
argument_list|,
argument|kmemlimit
argument_list|,
literal|0
argument_list|)
name|SYSMAP
argument_list|(
argument|UMBAbeg
argument_list|,
argument|umbabeg
argument_list|,
literal|0
argument_list|)
name|SYSMAP
argument_list|(
argument|Nexmap
argument_list|,
argument|nexus
argument_list|,
literal|16
argument|*MAXNNEXUS
argument_list|)
ifdef|#
directive|ifdef
name|QBA
if|#
directive|if
operator|(
name|QBAPAGES
operator|+
name|UBAIOPAGES
operator|)
operator|>
operator|(
name|UBAPAGES
operator|+
name|UBAIOPAGES
operator|)
operator|*
name|NUBA
name|SYSMAP
argument_list|(
argument|UMEMmap
argument_list|,
argument|umem
argument_list|,
argument|(QBAPAGES+UBAIOPAGES)
argument_list|)
else|#
directive|else
name|SYSMAP
argument_list|(
argument|UMEMmap
argument_list|,
argument|umem
argument_list|,
argument|(UBAPAGES+UBAIOPAGES)*NUBA
argument_list|)
endif|#
directive|endif
else|#
directive|else
comment|/* QBA */
name|SYSMAP
argument_list|(
argument|UMEMmap
argument_list|,
argument|umem
argument_list|,
argument|(UBAPAGES+UBAIOPAGES)*NUBA
argument_list|)
endif|#
directive|endif
comment|/* QBA */
if|#
directive|if
name|VAX8600
name|SYSMAP
argument_list|(
argument|Ioamap
argument_list|,
argument|ioa
argument_list|,
argument|MAXNIOA*IOAMAPSIZ/NBPG
argument_list|)
endif|#
directive|endif
if|#
directive|if
name|VAX8200
operator|||
name|VAX630
name|SYSMAP
argument_list|(
name|Clockmap
argument_list|,
name|ka630clock
argument_list|,
literal|1
argument_list|)
endif|#
directive|endif
if|#
directive|if
name|VAX8200
comment|/* alas, the clocks on the 8200 and 630 are not quite identical */
comment|/* they could be shared for now, but this seemed cleaner */
operator|.
name|globl
name|_ka820clock
expr_stmt|;
end_expr_stmt

begin_expr_stmt
operator|.
name|set
name|_ka820clock
operator|,
name|_ka630clock
name|SYSMAP
argument_list|(
argument|Ka820map
argument_list|,
argument|ka820port
argument_list|,
literal|1
argument_list|)
name|SYSMAP
argument_list|(
argument|RX50map
argument_list|,
argument|rx50device
argument_list|,
literal|1
argument_list|)
ifdef|#
directive|ifdef
name|notyet
name|SYSMAP
argument_list|(
argument|BRAMmap
argument_list|,
argument|ka820bootram
argument_list|,
argument|KA820_BRPAGES
argument_list|)
name|SYSMAP
argument_list|(
argument|EEPROMmap
argument_list|,
argument|ka820eeprom
argument_list|,
argument|KA820_EEPAGES
argument_list|)
endif|#
directive|endif
endif|#
directive|endif
if|#
directive|if
name|VAX630
name|SYSMAP
argument_list|(
argument|Ka630map
argument_list|,
argument|ka630cpu
argument_list|,
literal|1
argument_list|)
endif|#
directive|endif
if|#
directive|if
name|VAX650
name|SYSMAP
argument_list|(
argument|KA650MERRmap
argument_list|,
argument|ka650merr
argument_list|,
literal|1
argument_list|)
name|SYSMAP
argument_list|(
argument|KA650CBDmap
argument_list|,
argument|ka650cbd
argument_list|,
literal|1
argument_list|)
name|SYSMAP
argument_list|(
argument|KA650SSCmap
argument_list|,
argument|ka650ssc
argument_list|,
literal|3
argument_list|)
name|SYSMAP
argument_list|(
argument|KA650IPCRmap
argument_list|,
argument|ka650ipcr
argument_list|,
literal|1
argument_list|)
name|SYSMAP
argument_list|(
argument|KA650CACHEmap
argument_list|,
argument|ka650cache
argument_list|,
argument|KA650_CACHESIZE/NBPG
argument_list|)
endif|#
directive|endif
ifdef|#
directive|ifdef
name|QBA
comment|/* 	 * qvss and qdss don't coexist - one map will suffice 	 * for either. qvss is 256K each and qdss is 64K each. 	 */
include|#
directive|include
file|"qv.h"
include|#
directive|include
file|"qd.h"
if|#
directive|if
name|NQV
operator|>
literal|0
operator|||
name|NQD
operator|>
literal|0
name|SYSMAP
argument_list|(
argument|QVmap
argument_list|,
argument|qvmem
argument_list|,
argument|((
literal|512
argument|*NQV)+(
literal|128
argument|*NQD))
argument_list|)
endif|#
directive|endif
endif|#
directive|endif
name|SYSMAP
argument_list|(
argument|UMBAend
argument_list|,
argument|umbaend
argument_list|,
literal|0
argument_list|)
name|SYSMAP
argument_list|(
argument|Usrptmap
argument_list|,
argument|usrpt
argument_list|,
argument|USRPTSIZE+CLSIZE
argument_list|)
name|eSysmap
operator|:
operator|.
name|globl
name|_Syssize
operator|.
name|set
name|_Syssize
operator|,
operator|(
name|eSysmap
operator|-
name|_Sysmap
operator|)
operator|/
literal|4
operator|.
name|text
comment|/*  * Initialization  *  * ipl 0x1f; mapen 0; scbb, pcbb, sbr, slr, isp, ksp not set  */
operator|.
name|data
operator|.
name|globl
name|_cpu
name|_cpu
operator|:
operator|.
name|long
literal|0
operator|.
name|text
operator|.
name|globl
name|start
name|start
operator|:
operator|.
name|word
literal|0
name|mtpr
name|$0
operator|,
name|$ICCS
comment|/* set system control block base and system page table params */
name|mtpr
name|$_scb
operator|-
literal|0x80000000
operator|,
name|$SCBB
name|mtpr
name|$_Sysmap
operator|-
literal|0x80000000
operator|,
name|$SBR
name|mtpr
name|$_Syssize
operator|,
name|$SLR
comment|/* double map the kernel into the virtual user addresses of phys mem */
name|mtpr
name|$_Sysmap
operator|,
name|$P0BR
name|mtpr
name|$_Syssize
operator|,
name|$P0LR
comment|/* set ISP and get cpu type */
name|movl
name|$_intstack
operator|+
name|NISP
operator|*
name|NBPG
operator|,
name|sp
name|mfpr
name|$SID
operator|,
name|r0
name|movab
name|_cpu
operator|,
name|r1
name|extzv
name|$24
operator|,
name|$8
operator|,
name|r0
operator|,
operator|(
name|r1
operator|)
comment|/* init RPB */
name|movab
name|_rpb
operator|,
name|r0
name|movl
name|r0
operator|,
operator|(
name|r0
operator|)
operator|+
operator|#
name|rp_selfref
name|movab
name|_doadump
operator|,
name|r1
name|movl
name|r1
operator|,
operator|(
name|r0
operator|)
operator|+
operator|#
name|rp_dumprout
name|movl
name|$0x1f
operator|,
name|r2
name|clrl
name|r3
literal|1
operator|:
name|addl2
argument_list|(
name|r1
argument_list|)
operator|+
operator|,
name|r3
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|sobgtr
name|r2
decl_stmt|,1b
name|movl
name|r3
decl_stmt|,
argument_list|(
name|r0
argument_list|)
decl_stmt|+			#
name|rp_chksum
comment|/* count up memory; _physmem contains limit */
name|clrl
name|r7
name|ashl
name|$PGSHIFT
decl_stmt|,
name|_physmem
decl_stmt|,
name|r8
name|decl
name|r8
decl|1
range|:
name|pushl
name|$4
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|pushl
name|r7
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|calls
name|$2
decl_stmt|,
name|_badaddr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|tstl
name|r0
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|bneq
literal|9f
name|acbl
name|r8
operator|,
name|$64
operator|*
literal|1024
operator|,
name|r7
operator|,
literal|1b
literal|9
operator|:
if|#
directive|if
name|VAX630
operator|||
name|VAX650
comment|/* reserve area at top of memory for processor specific use */
name|cmpb
name|_cpu
operator|,
name|$VAX_630
name|beql
literal|1f
name|cmpb
name|_cpu
operator|,
name|$VAX_650
name|bneq
literal|2f
name|subl2
name|$32768
operator|,
name|r7
operator|#
name|space
end_expr_stmt

begin_for
for|for Qbus map registers 	brb	2f 1: 	subl2   $4096
operator|,
name|r7
operator|#
name|space
end_for

begin_for
for|for console scratchpad 2:
endif|#
directive|endif
comment|/* clear memory from kernel bss and pages for proc 0 u. and page table */
for|movab	_edata
operator|,
name|r6
expr_stmt|;
end_for

begin_decl_stmt
name|bicl2
name|$SYSTEM
decl_stmt|,
name|r6
name|movab
name|_end
decl_stmt|,
name|r5
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bicl2
name|$SYSTEM
decl_stmt|,
name|r5
ifdef|#
directive|ifdef
name|KADB
name|subl2
name|$4
decl_stmt|,
name|r5
decl|1
range|:
name|clrl
argument_list|(
name|r6
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|acbl
name|r5
decl_stmt|,
name|$4
decl_stmt|,
name|r6
decl_stmt|,1b		#
name|clear
name|just
name|bss
name|addl2
name|$4
decl_stmt|,
name|r5
name|bbc
name|$6
decl_stmt|,
name|r11
decl_stmt|,0f			#
name|check
name|RB_KDB
name|bicl3
name|$SYSTEM
decl_stmt|,
name|r9
decl_stmt|,
name|r5
decl|#
name|skip
name|symbol
modifier|&
name|string
name|tables
name|bicl3
name|$SYSTEM
decl_stmt|,
name|r9
decl_stmt|,
name|r6
decl|#
name|r9
name|obtained
name|from
name|boot
endif|#
directive|endif
decl|0
range|:
name|bisl3
name|$SYSTEM
decl_stmt|,
name|r5
decl_stmt|,
name|r9
decl|#
name|convert
name|to
name|virtual
name|address
name|addl2
name|$NBPG
decl|-1
decl_stmt|,
name|r9
decl|#
name|roundup
name|to
name|next
name|page
name|addl2
name|$
argument_list|(
name|UPAGES
operator|*
name|NBPG
argument_list|)
decl|+
name|NBPG
decl|+
name|NBPG
decl_stmt|,
name|r5
decl|1
range|:
name|clrq
argument_list|(
name|r6
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|acbl
name|r5
decl_stmt|,
name|$8
decl_stmt|,
name|r6
decl_stmt|,1b
comment|/* trap() and syscall() save r0-r11 in the entry mask (per ../h/reg.h) */
comment|/* panic() is convenient place to save all for debugging */
name|bisw2
name|$0x0fff
decl_stmt|,
name|_trap
name|bisw2
name|$0x0fff
decl_stmt|,
name|_syscall
name|bisw2
name|$0x0fff
decl_stmt|,
name|_panic
name|calls
name|$0
decl_stmt|,
name|_fixctlrmask
comment|/* initialize system page table: uba vectors and int stack writeable */
name|clrl
name|r2
name|movab
name|eintstack
decl_stmt|,
name|r1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bbcc
name|$31
decl_stmt|,
name|r1
decl_stmt|,0f;
end_decl_stmt

begin_expr_stmt
literal|0
operator|:
name|ashl
name|$
operator|-
name|PGSHIFT
operator|,
name|r1
operator|,
name|r1
literal|1
operator|:
name|bisl3
name|$PG_V
operator||
name|PG_KW
operator|,
name|r2
operator|,
name|_Sysmap
index|[
name|r2
index|]
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|aoblss
name|r1
decl_stmt|,
name|r2
decl_stmt|,1b
comment|/*  * make rpb read-only as red zone for interrupt stack  * (scb(s) and UNIvec are write-protected later)  */
name|bicl2
name|$PG_PROT
decl_stmt|,
name|_rpbmap
name|bisl2
name|$PG_KR
decl_stmt|,
name|_rpbmap
comment|/* make kernel text space read-only */
name|movab
name|_etext
decl|+
name|NBPG
decl|-1
decl_stmt|,
name|r1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bbcc
name|$31
decl_stmt|,
name|r1
decl_stmt|,0f;
end_decl_stmt

begin_expr_stmt
literal|0
operator|:
name|ashl
name|$
operator|-
name|PGSHIFT
operator|,
name|r1
operator|,
name|r1
literal|1
operator|:
name|bisl3
name|$PG_V
operator||
name|PG_URKR
operator|,
name|r2
operator|,
name|_Sysmap
index|[
name|r2
index|]
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|aoblss
name|r1
decl_stmt|,
name|r2
decl_stmt|,1b
comment|/* make kernel data, bss, read-write */
name|bicl3
name|$SYSTEM
decl_stmt|,
name|r9
decl_stmt|,
name|r1
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|ashl
name|$
operator|-
name|PGSHIFT
operator|,
name|r1
operator|,
name|r1
literal|1
operator|:
name|bisl3
name|$PG_V
operator||
name|PG_KW
operator|,
name|r2
operator|,
name|_Sysmap
index|[
name|r2
index|]
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|aoblss
name|r1
decl_stmt|,
name|r2
decl_stmt|,1b
comment|/* now go to mapped mode */
name|mtpr
name|$0
decl_stmt|,
name|$TBIA
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|mtpr
name|$1
decl_stmt|,
name|$MAPEN
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|jmp
modifier|*
name|$0f
decl_stmt|;
end_decl_stmt

begin_expr_stmt
literal|0
operator|:
comment|/* init mem sizes */
name|ashl
name|$
operator|-
name|PGSHIFT
operator|,
name|r7
operator|,
name|_physmem
comment|/* setup context for proc[0] == Scheduler */
name|bicl3
name|$SYSTEM
operator||
operator|(
name|NBPG
operator|-
literal|1
operator|)
operator|,
name|r9
operator|,
name|r6
operator|#
name|make
name|phys
operator|,
name|page
name|boundary
comment|/* setup page table for proc[0] */
name|ashl
name|$
operator|-
name|PGSHIFT
operator|,
name|r6
operator|,
name|r3
operator|#
name|r3
operator|=
name|btoc
argument_list|(
argument|r6
argument_list|)
name|bisl3
name|$PG_V
operator||
name|PG_KW
operator|,
name|r3
operator|,
name|_Usrptmap
operator|#
name|init
name|first
name|upt
name|entry
name|incl
name|r3
name|movab
name|_usrpt
operator|,
name|r0
name|mtpr
name|r0
operator|,
name|$TBIS
comment|/* init p0br, p0lr */
name|mtpr
name|r0
operator|,
name|$P0BR
name|mtpr
name|$0
operator|,
name|$P0LR
comment|/* init p1br, p1lr */
name|movab
name|NBPG
argument_list|(
name|r0
argument_list|)
operator|,
name|r0
name|movl
name|$0x200000
operator|-
name|UPAGES
operator|,
name|r1
name|mtpr
name|r1
operator|,
name|$P1LR
name|mnegl
name|r1
operator|,
name|r1
name|moval
operator|-
literal|4
operator|*
name|UPAGES
argument_list|(
name|r0
argument_list|)
index|[
name|r1
index|]
operator|,
name|r2
name|mtpr
name|r2
operator|,
name|$P1BR
comment|/* setup mapping for UPAGES of _u */
name|movl
name|$UPAGES
operator|,
name|r2
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|movab
name|_u
operator|+
name|NBPG
operator|*
name|UPAGES
operator|,
name|r1
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|addl2
name|$UPAGES
decl_stmt|,
name|r3
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|jbr
literal|2f
literal|1
operator|:
name|decl
name|r3
name|moval
operator|-
name|NBPG
argument_list|(
name|r1
argument_list|)
operator|,
name|r1
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|bisl3
name|$PG_V
operator||
name|PG_URKW
operator|,
name|r3
operator|,
operator|-
operator|(
name|r0
operator|)
name|mtpr
name|r1
operator|,
name|$TBIS
literal|2
operator|:
name|sobgeq
name|r2
operator|,
literal|1b
comment|/* initialize (slightly) the pcb */
name|movab
name|UPAGES
operator|*
name|NBPG
argument_list|(
name|r1
argument_list|)
operator|,
name|PCB_KSP
argument_list|(
argument|r1
argument_list|)
name|mnegl
name|$1
operator|,
name|PCB_ESP
argument_list|(
argument|r1
argument_list|)
name|mnegl
name|$1
operator|,
name|PCB_SSP
argument_list|(
argument|r1
argument_list|)
name|movl
name|r1
operator|,
name|PCB_USP
argument_list|(
argument|r1
argument_list|)
name|mfpr
name|$P0BR
operator|,
name|PCB_P0BR
argument_list|(
argument|r1
argument_list|)
name|mfpr
name|$P0LR
operator|,
name|PCB_P0LR
argument_list|(
argument|r1
argument_list|)
name|movb
name|$4
operator|,
name|PCB_P0LR
operator|+
literal|3
operator|(
name|r1
operator|)
operator|#
name|disable
name|ast
name|mfpr
name|$P1BR
operator|,
name|PCB_P1BR
argument_list|(
argument|r1
argument_list|)
name|mfpr
name|$P1LR
operator|,
name|PCB_P1LR
argument_list|(
argument|r1
argument_list|)
name|movl
name|$CLSIZE
operator|,
name|PCB_SZPT
argument_list|(
name|r1
argument_list|)
operator|#
name|init
name|u
operator|.
name|u_pcb
operator|.
name|pcb_szpt
name|movl
name|r9
operator|,
name|PCB_R9
argument_list|(
argument|r1
argument_list|)
name|movl
name|r10
operator|,
name|PCB_R10
argument_list|(
argument|r1
argument_list|)
name|movl
name|r11
operator|,
name|PCB_R11
argument_list|(
argument|r1
argument_list|)
name|movab
literal|1f
operator|,
name|PCB_PC
argument_list|(
name|r1
argument_list|)
operator|#
name|initial
name|pc
name|clrl
name|PCB_PSL
argument_list|(
name|r1
argument_list|)
operator|#
name|mode
argument_list|(
name|k
argument_list|,
name|k
argument_list|)
operator|,
name|ipl
operator|=
literal|0
name|ashl
name|$PGSHIFT
operator|,
name|r3
operator|,
name|r3
name|mtpr
name|r3
operator|,
name|$PCBB
operator|#
name|first
name|pcbb
comment|/* set regs, p0br, p0lr, p1br, p1lr, astlvl, ksp and change to kernel mode */
name|ldpctx
name|rei
comment|/* put signal trampoline code in u. area */
literal|1
operator|:
name|movab
name|_u
operator|,
name|r0
name|movc3
name|$19
operator|,
name|sigcode
operator|,
name|PCB_SIGC
argument_list|(
argument|r0
argument_list|)
comment|/* save boot device in global _bootdev */
name|movl
name|r10
operator|,
name|_bootdev
comment|/* save reboot flags in global _boothowto */
name|movl
name|r11
operator|,
name|_boothowto
ifdef|#
directive|ifdef
name|KADB
comment|/* save end of symbol& string table in global _bootesym */
name|subl3
name|$NBPG
operator|-
literal|1
operator|,
name|r9
operator|,
name|_bootesym
endif|#
directive|endif
comment|/* calculate firstaddr, and call main() */
name|bicl3
name|$SYSTEM
operator|,
name|r9
operator|,
name|r0
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|ashl
name|$
operator|-
name|PGSHIFT
operator|,
name|r0
operator|,
operator|-
operator|(
name|sp
operator|)
name|addl2
name|$UPAGES
operator|+
literal|1
operator|,
operator|(
name|sp
operator|)
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|calls
name|$1
decl_stmt|,
name|_main
comment|/* proc[1] == /etc/init now running here; run icode */
name|pushl
name|$PSL_CURMOD
decl||
name|PSL_PRVMOD
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|pushl
name|$0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|rei
comment|/* signal trampoline code: it is known that this code takes exactly 19 bytes */
comment|/* in ../vax/pcb.h and in the movc3 above */
name|sigcode
range|:
name|calls
name|$4
decl_stmt|,8
argument_list|(
name|pc
argument_list|)
decl_stmt|#
name|params
name|pushed
name|by
name|sendsig
name|movl
name|sp
decl_stmt|,
name|ap
decl|#
name|calls
name|frame
name|built
name|by
name|sendsig
name|chmk
name|$SYS_sigreturn
decl|#
name|cleanup
name|mask
name|and
name|onsigstack
name|halt
decl|#
name|sigreturn
argument_list|()
name|does
name|not
decl|return! 	.
name|word
decl|0x3f		#
name|registers
decl|0-5
name|callg
argument_list|(
name|ap
argument_list|)
decl_stmt|,
modifier|*
decl_stmt|16
argument_list|(
name|ap
argument_list|)
decl_stmt|#
name|call
name|the
name|signal
name|handler
name|ret
decl|# return
name|to
name|code
name|above
operator|.
name|globl
name|_icode
operator|.
name|globl
name|_initflags
operator|.
name|globl
name|_szicode
comment|/*  * Icode is copied out to process 1 to exec /etc/init.  * If the exec fails, process 1 exits.  */
name|_icode
range|:
name|pushab
name|b
operator|`
name|argv
operator|-
name|l0
argument_list|(
argument|pc
argument_list|)
name|l0
operator|:
name|pushab
name|b
operator|`
name|init
operator|-
name|l1
argument_list|(
argument|pc
argument_list|)
name|l1
operator|:
name|pushl
name|$2
name|movl
name|sp
decl_stmt|,
name|ap
name|chmk
name|$SYS_execv
name|pushl
name|r0
name|chmk
name|$SYS_exit
name|init
range|:
operator|.
name|asciz
literal|"/sbin/init"
operator|.
name|align
literal|2
name|_initflags
operator|:
operator|.
name|long
literal|0
name|argv
operator|:
operator|.
name|long
name|init
operator|+
literal|6
operator|-
name|_icode
operator|.
name|long
name|_initflags
operator|-
name|_icode
operator|.
name|long
literal|0
name|_szicode
operator|:
operator|.
name|long
name|_szicode
operator|-
name|_icode
comment|/*  * Primitives  */
ifdef|#
directive|ifdef
name|GPROF
define|#
directive|define
name|ENTRY
parameter_list|(
name|name
parameter_list|,
name|regs
parameter_list|)
define|\
value|.globl _
comment|/**/
value|name; .align 1; _
comment|/**/
value|name: .word regs; jsb mcount
define|#
directive|define
name|JSBENTRY
parameter_list|(
name|name
parameter_list|,
name|regs
parameter_list|)
define|\
value|.globl _
comment|/**/
value|name; _
comment|/**/
value|name: \ 	movl fp,-(sp); movab -12(sp),fp; pushr $(regs); jsb mcount; \ 	popr $(regs); movl (sp)+,fp
else|#
directive|else
define|#
directive|define
name|ENTRY
parameter_list|(
name|name
parameter_list|,
name|regs
parameter_list|)
define|\
value|.globl _
comment|/**/
value|name; .align 1; _
comment|/**/
value|name: .word regs
define|#
directive|define
name|JSBENTRY
parameter_list|(
name|name
parameter_list|,
name|regs
parameter_list|)
define|\
value|.globl _
comment|/**/
value|name; _
comment|/**/
value|name:
endif|#
directive|endif
endif|GPROF
define|#
directive|define
name|R0
value|0x01
define|#
directive|define
name|R1
value|0x02
define|#
directive|define
name|R2
value|0x04
define|#
directive|define
name|R3
value|0x08
define|#
directive|define
name|R4
value|0x10
define|#
directive|define
name|R5
value|0x20
define|#
directive|define
name|R6
value|0x40
comment|/*  * badaddr(addr, len)  *	see if access addr with a len type instruction causes a machine check  *	len is length of access (1=byte, 2=short, 4=long)  */
operator|.
name|globl
name|_badaddr
name|_badaddr
operator|:
operator|.
name|word
literal|0
name|movl
name|$1
decl_stmt|,
name|r0
name|mfpr
name|$IPL
decl_stmt|,
name|r1
name|mtpr
name|$HIGH
decl_stmt|,
name|$IPL
name|movl
decl|4
argument_list|(
name|ap
argument_list|)
decl_stmt|,
name|r3
name|movl
decl|8
argument_list|(
name|ap
argument_list|)
decl_stmt|,
name|r4
name|movab
decl|2f
decl_stmt|,
name|nofault
decl|#
name|jump
name|to
decl|2f
name|on
name|machcheck
name|bbc
name|$0
decl_stmt|,
name|r4
decl_stmt|,1f;
end_decl_stmt

begin_expr_stmt
name|tstb
argument_list|(
name|r3
argument_list|)
literal|1
operator|:
name|bbc
name|$1
operator|,
name|r4
operator|,
literal|1f
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|tstw
argument_list|(
name|r3
argument_list|)
literal|1
operator|:
name|bbc
name|$2
operator|,
name|r4
operator|,
literal|1f
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|tstl
argument_list|(
name|r3
argument_list|)
literal|1
operator|:
name|clrl
name|r0
operator|#
name|made
name|it
name|w
operator|/
name|o
name|machine
name|checks
literal|2
operator|:
name|clrl
name|nofault
name|mtpr
name|r1
operator|,
name|$IPL
name|ret
comment|/*  * update profiling information for the user  * addupc(pc,&u.u_prof, ticks)  */
name|ENTRY
argument_list|(
argument|addupc
argument_list|,
literal|0
argument_list|)
name|movl
literal|8
operator|(
name|ap
operator|)
operator|,
name|r2
operator|#
operator|&
name|u
operator|.
name|u_prof
name|subl3
literal|8
operator|(
name|r2
operator|)
operator|,
literal|4
operator|(
name|ap
operator|)
operator|,
name|r0
operator|#
name|corrected
name|pc
name|blss
literal|9f
name|extzv
name|$1
operator|,
name|$31
operator|,
name|r0
operator|,
name|r0
operator|#
name|logical
name|right
name|shift
name|extzv
name|$1
operator|,
name|$31
operator|,
literal|12
operator|(
name|r2
operator|)
operator|,
name|r1
operator|#
name|ditto
end_expr_stmt

begin_for
for|for scale 	emul	r1
operator|,
name|r0
operator|,
name|$0
operator|,
name|r0
name|ashq
name|$
operator|-
literal|14
operator|,
name|r0
operator|,
name|r0
name|tstl
name|r1
name|bneq
literal|9f
name|bicl2
name|$1
operator|,
name|r0
name|cmpl
name|r0
operator|,
literal|4
operator|(
name|r2
operator|)
operator|#
name|length
name|bgequ
literal|9f
name|addl2
argument_list|(
name|r2
argument_list|)
operator|,
name|r0
operator|#
name|base
name|probew
name|$3
operator|,
name|$2
operator|,
operator|(
name|r0
operator|)
name|beql
literal|8f
name|addw2
literal|12
operator|(
name|ap
operator|)
operator|,
operator|(
name|r0
operator|)
literal|9
operator|:
name|ret
literal|8
operator|:
name|clrl
literal|12
operator|(
name|r2
operator|)
name|ret
comment|/*  * Copy a null terminated string from the user address space into  * the kernel address space.  *  * copyinstr(fromaddr, toaddr, maxlength,&lencopied)  */
name|ENTRY
argument_list|(
argument|copyinstr
argument_list|,
argument|R6
argument_list|)
name|movl
literal|12
operator|(
name|ap
operator|)
operator|,
name|r6
operator|#
name|r6
operator|=
name|max
name|length
name|jlss
literal|8f
name|movl
literal|4
operator|(
name|ap
operator|)
operator|,
name|r1
operator|#
name|r1
operator|=
name|user
name|address
name|bicl3
name|$
operator|~
operator|(
name|NBPG
operator|*
name|CLSIZE
operator|-
literal|1
operator|)
operator|,
name|r1
operator|,
name|r2
operator|#
name|r2
operator|=
name|bytes
name|on
name|first
name|page
name|subl3
name|r2
operator|,
name|$NBPG
operator|*
name|CLSIZE
operator|,
name|r2
name|movl
literal|8
operator|(
name|ap
operator|)
operator|,
name|r3
operator|#
name|r3
operator|=
name|kernel
name|address
literal|1
operator|:
name|cmpl
name|r6
operator|,
name|r2
operator|#
name|r2
operator|=
name|min
argument_list|(
argument|bytes on page
argument_list|,
argument|length left
argument_list|)
expr_stmt|;
end_for

begin_expr_stmt
name|jgeq
literal|2f
name|movl
name|r6
operator|,
name|r2
literal|2
operator|:
name|prober
name|$3
operator|,
name|r2
operator|,
operator|(
name|r1
operator|)
operator|#
name|bytes
name|accessible
condition|?
name|jeql
literal|8f
name|subl2
name|r2
operator|,
name|r6
operator|#
name|update
name|bytes
name|left
name|count
ifdef|#
directive|ifdef
name|NOSUBSINST
empty|# fake the locc instr. for processors that don't have it
name|movl
name|r2
operator|,
name|r0
literal|6
operator|:
name|tstb
argument_list|(
name|r1
argument_list|)
operator|+
name|jeql
literal|5f
name|sobgtr
name|r0
operator|,
literal|6b
name|jbr
literal|7f
literal|5
operator|:
name|decl
name|r1
name|jbr
literal|3f
literal|7
operator|:
else|#
directive|else
name|locc
name|$0
operator|,
name|r2
operator|,
operator|(
name|r1
operator|)
operator|#
name|null
name|byte
name|found
condition|?
name|jneq
literal|3f
endif|#
directive|endif
name|subl2
name|r2
operator|,
name|r1
operator|#
name|back
name|up
name|pointer
name|updated
name|by
operator|`
name|locc
literal|' 	movc3	r2,(r1),(r3)		# copy in next piece 	movl	$(NBPG*CLSIZE),r2	# check next page 	tstl	r6			# run out of space? 	jneq	1b 	movl	$ENOENT,r0		# set error code and return 	jbr	9f 3: 	tstl	16(ap)			# return length? 	beql	4f 	subl3	r6,12(ap),r6		# actual len = maxlen - unused pages 	subl2	r0,r6			#	- unused on this page 	addl3	$1,r6,*16(ap)		#	+ the null byte 4: 	subl2	r0,r2			# r2 = number of bytes to move 	subl2	r2,r1			# back up pointer updated by `locc'
name|incl
name|r2
operator|#
name|copy
name|null
name|byte
name|as
name|well
name|movc3
name|r2
operator|,
operator|(
name|r1
operator|)
operator|,
operator|(
name|r3
operator|)
operator|#
name|copy
name|in
name|last
name|piece
name|clrl
name|r0
operator|#
name|redundant
name|ret
literal|8
operator|:
name|movl
name|$EFAULT
operator|,
name|r0
literal|9
operator|:
name|tstl
literal|16
operator|(
name|ap
operator|)
name|beql
literal|1f
name|subl3
name|r6
operator|,
literal|12
operator|(
name|ap
operator|)
operator|,
operator|*
literal|16
operator|(
name|ap
operator|)
literal|1
operator|:
name|ret
comment|/*  * Copy a null terminated string from the kernel  * address space to the user address space.  *  * copyoutstr(fromaddr, toaddr, maxlength,&lencopied)  */
name|ENTRY
argument_list|(
argument|copyoutstr
argument_list|,
argument|R6
argument_list|)
name|movl
literal|12
operator|(
name|ap
operator|)
operator|,
name|r6
operator|#
name|r6
operator|=
name|max
name|length
name|jlss
literal|8b
name|movl
literal|4
operator|(
name|ap
operator|)
operator|,
name|r1
operator|#
name|r1
operator|=
name|kernel
name|address
name|movl
literal|8
operator|(
name|ap
operator|)
operator|,
name|r3
operator|#
name|r3
operator|=
name|user
name|address
name|bicl3
name|$
operator|~
operator|(
name|NBPG
operator|*
name|CLSIZE
operator|-
literal|1
operator|)
operator|,
name|r3
operator|,
name|r2
operator|#
name|r2
operator|=
name|bytes
name|on
name|first
name|page
name|subl3
name|r2
operator|,
name|$NBPG
operator|*
name|CLSIZE
operator|,
name|r2
literal|1
operator|:
name|cmpl
name|r6
operator|,
name|r2
operator|#
name|r2
operator|=
name|min
argument_list|(
argument|bytes on page
argument_list|,
argument|length left
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|jgeq
literal|2f
name|movl
name|r6
operator|,
name|r2
literal|2
operator|:
name|probew
name|$3
operator|,
name|r2
operator|,
operator|(
name|r3
operator|)
operator|#
name|bytes
name|accessible
condition|?
name|jeql
literal|8b
name|subl2
name|r2
operator|,
name|r6
operator|#
name|update
name|bytes
name|left
name|count
ifdef|#
directive|ifdef
name|NOSUBSINST
empty|# fake the locc instr. for processors that don't have it
name|movl
name|r2
operator|,
name|r0
literal|6
operator|:
name|tstb
argument_list|(
name|r1
argument_list|)
operator|+
name|jeql
literal|5f
name|sobgtr
name|r0
operator|,
literal|6b
name|jbr
literal|7f
literal|5
operator|:
name|decl
name|r1
name|jbr
literal|3b
literal|7
operator|:
else|#
directive|else
name|locc
name|$0
operator|,
name|r2
operator|,
operator|(
name|r1
operator|)
operator|#
name|null
name|byte
name|found
condition|?
name|jneq
literal|3b
endif|#
directive|endif
name|subl2
name|r2
operator|,
name|r1
operator|#
name|back
name|up
name|pointer
name|updated
name|by
operator|`
name|locc
literal|' 	movc3	r2,(r1),(r3)		# copy in next piece 	movl	$(NBPG*CLSIZE),r2	# check next page 	tstl	r6			# run out of space? 	jneq	1b 	movl	$ENOENT,r0		# set error code and return 	jbr	9b  /*  * Copy a null terminated string from one point to another in  * the kernel address space.  *  * copystr(fromaddr, toaddr, maxlength,&lencopied)  */ ENTRY(copystr, R6) 	movl	12(ap),r6		# r6 = max length 	jlss	8b 	movl	4(ap),r1		# r1 = src address 	movl	8(ap),r3		# r3 = dest address 1: 	movzwl	$65535,r2		# r2 = bytes in first chunk 	cmpl	r6,r2			# r2 = min(bytes in chunk, length left); 	jgeq	2f 	movl	r6,r2 2: 	subl2	r2,r6			# update bytes left count #ifdef NOSUBSINST 	# fake the locc instr. for processors that don'
name|t
name|have
name|it
name|movl
name|r2
operator|,
name|r0
literal|6
operator|:
name|tstb
argument_list|(
name|r1
argument_list|)
operator|+
name|jeql
literal|5f
name|sobgtr
name|r0
operator|,
literal|6b
name|jbr
literal|7f
literal|5
operator|:
name|decl
name|r1
name|jbr
literal|3b
literal|7
operator|:
else|#
directive|else
name|locc
name|$0
operator|,
name|r2
operator|,
operator|(
name|r1
operator|)
operator|#
name|null
name|byte
name|found
condition|?
name|jneq
literal|3b
endif|#
directive|endif
name|subl2
name|r2
operator|,
name|r1
operator|#
name|back
name|up
name|pointer
name|updated
name|by
operator|`
name|locc
literal|' 	movc3	r2,(r1),(r3)		# copy in next piece 	tstl	r6			# run out of space? 	jneq	1b 	movl	$ENOENT,r0		# set error code and return 	jbr	9b  /*   * Copy specified amount of data from user space into the kernel  * Copyin(from, to, len)  *	r1 == from (user source address)  *	r3 == to (kernel destination address)  *	r5 == length  */ 	.align	1 JSBENTRY(Copyin, R1|R3|R5) 	cmpl	r5,$(NBPG*CLSIZE)	# probing one page or less ? 	bgtru	1f			# no 	prober	$3,r5,(r1)		# bytes accessible ? 	beql	ersb			# no 	movc3	r5,(r1),(r3) /*	clrl	r0			# redundant */ 	rsb 1: 	blss	ersb			# negative length? 	pushl	r6			# r6 = length 	movl	r5,r6 	bicl3	$~(NBPG*CLSIZE-1),r1,r0	# r0 = bytes on first page 	subl3	r0,$(NBPG*CLSIZE),r0 	addl2	$(NBPG*CLSIZE),r0	# plus one additional full page 	jbr	2f  ciloop: 	movc3	r0,(r1),(r3) 	movl	$(2*NBPG*CLSIZE),r0	# next amount to move 2: 	cmpl	r0,r6 	bleq	3f 	movl	r6,r0 3: 	prober	$3,r0,(r1)		# bytes accessible ? 	beql	ersb1			# no 	subl2	r0,r6			# last move? 	bneq	ciloop			# no  	movc3	r0,(r1),(r3) /*	clrl	r0			# redundant */ 	movl	(sp)+,r6		# restore r6 	rsb  ersb1: 	movl	(sp)+,r6		# restore r6 ersb: 	movl	$EFAULT,r0 	rsb  /*   * Copy specified amount of data from kernel to the user space  * Copyout(from, to, len)  *	r1 == from (kernel source address)  *	r3 == to (user destination address)  *	r5 == length  */ 	.align	1 JSBENTRY(Copyout, R1|R3|R5) 	cmpl	r5,$(NBPG*CLSIZE)	# moving one page or less ? 	bgtru	1f			# no 	probew	$3,r5,(r3)		# bytes writeable? 	beql	ersb			# no 	movc3	r5,(r1),(r3) /*	clrl	r0			# redundant */ 	rsb 1: 	blss	ersb			# negative length? 	pushl	r6			# r6 = length 	movl	r5,r6 	bicl3	$~(NBPG*CLSIZE-1),r3,r0	# r0 = bytes on first page 	subl3	r0,$(NBPG*CLSIZE),r0 	addl2	$(NBPG*CLSIZE),r0	# plus one additional full page 	jbr	2f  coloop: 	movc3	r0,(r1),(r3) 	movl	$(2*NBPG*CLSIZE),r0	# next amount to move 2: 	cmpl	r0,r6 	bleq	3f 	movl	r6,r0 3: 	probew	$3,r0,(r3)		# bytes writeable? 	beql	ersb1			# no 	subl2	r0,r6			# last move? 	bneq	coloop			# no  	movc3	r0,(r1),(r3) /*	clrl	r0			# redundant */ 	movl	(sp)+,r6		# restore r6 	rsb  /*  * savectx is like setjmp but saves all registers.  * Called before swapping out the u. area, restored by resume()  * below.  */ #define PCLOC 16	/* location of pc in calls frame */ #define APLOC 8		/* location of ap,fp in calls frame */  ENTRY(savectx, 0) 	movl	4(ap),r0 	movq	r6,(r0)+ 	movq	r8,(r0)+ 	movq	r10,(r0)+ 	movq	APLOC(fp),(r0)+	# save ap, fp 	addl3	$8,ap,(r0)+	# save sp 	movl	PCLOC(fp),(r0)	# save pc 	clrl	r0 	ret  #ifdef KADB /*  * C library -- reset, setexit  *  *	reset(x)  * will generate a "return" from  * the last call to  *	setexit()  * by restoring r6 - r12, ap, fp  * and doing a return.  * The returned value is x; on the original  * call the returned value is 0.  */ ENTRY(setexit, 0) 	movab	setsav,r0 	movq	r6,(r0)+ 	movq	r8,(r0)+ 	movq	r10,(r0)+ 	movq	8(fp),(r0)+		# ap, fp 	movab	4(ap),(r0)+		# sp 	movl	16(fp),(r0)		# pc 	clrl	r0 	ret  ENTRY(reset, 0) 	movl	4(ap),r0	# returned value 	movab	setsav,r1 	movq	(r1)+,r6 	movq	(r1)+,r8 	movq	(r1)+,r10 	movq	(r1)+,r12 	movl	(r1)+,sp 	jmp 	*(r1)  	.data 	.align  2 setsav:	.space	10*4 	.text #endif  	.globl	_whichqs 	.globl	_qs 	.globl	_cnt  	.globl	_noproc 	.comm	_noproc,4 	.globl	_runrun 	.comm	_runrun,4  /*  * The following primitives use the fancy VAX instructions  * much like VMS does.  _whichqs tells which of the 32 queues _qs  * have processes in them.  Setrq puts processes into queues, Remrq  * removes them from queues.  The running process is on no queue,  * other processes are on a queue related to p->p_pri, divided by 4  * actually to shrink the 0-127 range of priorities into the 32 available  * queues.  */  /*  * Setrq(p), using fancy VAX instructions.  *  * Call should be made at splclock(), and p->p_stat should be SRUN  */ 	.align	1 JSBENTRY(Setrq, R0) 	tstl	P_RLINK(r0)		## firewall: p->p_rlink must be 0 	beql	set1			## 	pushab	set3			## 	calls	$1,_panic		## set1: 	movzbl	P_PRI(r0),r1		# put on queue which is p->p_pri / 4 	ashl	$-2,r1,r1 	movaq	_qs[r1],r2 	insque	(r0),*4(r2)		# at end of queue 	bbss	r1,_whichqs,set2	# mark queue non-empty set2: 	rsb  set3:	.asciz	"setrq"  /*  * Remrq(p), using fancy VAX instructions  *  * Call should be made at splclock().  */ 	.align	1 JSBENTRY(Remrq, R0) 	movzbl	P_PRI(r0),r1 	ashl	$-2,r1,r1 	bbsc	r1,_whichqs,rem1 	pushab	rem3			# it wasn'
name|t
name|recorded
name|to
name|be
name|on
name|its
name|q
name|calls
name|$1
operator|,
name|_panic
name|rem1
operator|:
name|remque
argument_list|(
name|r0
argument_list|)
operator|,
name|r2
name|beql
name|rem2
name|bbss
name|r1
operator|,
name|_whichqs
operator|,
name|rem2
name|rem2
operator|:
name|clrl
name|P_RLINK
argument_list|(
name|r0
argument_list|)
operator|#
operator|#
end_expr_stmt

begin_for
for|for firewall checking 	rsb  rem3:	.asciz	"remrq"
comment|/*  * Masterpaddr is the p->p_addr of the running process on the master  * processor.  When a multiprocessor system, the slave processors will have  * an array of slavepaddr's.  */
for|.globl	_masterpaddr 	.data _masterpaddr: 	.long	0  	.text sw0:	.asciz	"swtch"
comment|/*  * When no processes are on the runq, Swtch branches to idle  * to wait for something to come ready.  */
for|.globl	Idle Idle: idle: 	movl	$1
operator|,
name|_noproc
name|mtpr
name|$0
decl_stmt|,
name|$IPL
decl|#
name|must
name|allow
name|interrupts
name|here
decl|1
range|:
name|tstl
name|_whichqs
operator|#
name|look
end_for

begin_for
for|for non-empty queue 	bneq	sw1 	brb	1b  badsw:	pushab	sw0 	calls	$1
operator|,
name|_panic
comment|/*NOTREACHED*/
comment|/*  * Swtch(), using fancy VAX instructions  */
operator|.
name|align
literal|1
name|JSBENTRY
argument_list|(
argument|Swtch
argument_list|,
literal|0
argument_list|)
name|incl
name|_cnt
operator|+
name|V_SWTCH
name|sw1
operator|:
name|ffs
name|$0
operator|,
name|$32
operator|,
name|_whichqs
operator|,
name|r0
operator|#
name|look
end_for

begin_for
for|for non-empty queue 	beql	idle			# if none
operator|,
name|idle
name|mtpr
name|$0x18
decl_stmt|,
name|$IPL
decl|#
name|lock
name|out
name|all
name|so
name|_whichqs
decl|==
name|_qs
name|bbcc
name|r0
decl_stmt|,
name|_whichqs
decl_stmt|,
name|sw1
decl|#
name|proc
name|moved
name|via
name|interrupt
name|movaq
name|_qs
index|[
name|r0
index|]
decl_stmt|,
name|r1
name|remque
modifier|*
argument_list|(
name|r1
argument_list|)
decl_stmt|,
name|r2
decl|#
name|r2
init|=
name|p
operator|=
name|highest
name|pri
name|process
name|bvs
name|badsw
operator|#
name|make
name|sure
name|something
name|was
name|there
name|beql
name|sw2
name|insv
name|$1
decl_stmt|,
name|r0
decl_stmt|,
name|$1
decl_stmt|,
name|_whichqs
decl|#
name|still
name|more
name|procs
name|in
name|this
name|queue
name|sw2
range|:
name|clrl
name|_noproc
name|clrl
name|_runrun
ifdef|#
directive|ifdef
name|notdef
name|tstl
name|P_WCHAN
argument_list|(
name|r2
argument_list|)
operator|#
operator|#
name|firewalls
name|bneq
name|badsw
operator|#
operator|#
name|cmpb
name|P_STAT
argument_list|(
name|r2
argument_list|)
decl_stmt|,
name|$SRUN
decl|##
name|bneq
name|badsw
decl|##
endif|#
directive|endif
name|clrl
name|P_RLINK
argument_list|(
name|r2
argument_list|)
decl|##
name|movl
modifier|*
name|P_ADDR
argument_list|(
name|r2
argument_list|)
decl_stmt|,
name|r0
ifdef|#
directive|ifdef
name|notdef
name|cmpl
name|r0
decl_stmt|,
name|_masterpaddr
decl|#
name|resume
name|of
name|current
name|proc
name|is
name|easy
name|beql
name|res0
endif|#
directive|endif
name|movl
name|r0
decl_stmt|,
name|_masterpaddr
name|ashl
name|$PGSHIFT
decl_stmt|,
name|r0
decl_stmt|,
name|r0
decl|#
name|r0
init|=
name|pcbb
argument_list|(
argument|p
argument_list|)
comment|/* fall into... */
comment|/*  * Resume(pf)  */
name|JSBENTRY
argument_list|(
argument|Resume
argument_list|,
argument|R0
argument_list|)
name|mtpr
name|$HIGH
decl_stmt|,
name|$IPL
decl|#
name|no
name|interrupts
decl_stmt|,
name|please
name|movl
name|_CMAP2
decl_stmt|,
name|_u
decl|+
name|PCB_CMAP2
decl|#
name|yech
name|svpctx
name|mtpr
name|r0
decl_stmt|,
name|$PCBB
name|ldpctx
name|movl
name|_u
decl|+
name|PCB_CMAP2
decl_stmt|,
name|_CMAP2
decl|#
name|yech
name|mtpr
name|$_CADDR2
decl_stmt|,
name|$TBIS
name|res0
range|:
name|tstl
name|_u
operator|+
name|PCB_SSWAP
name|bneq
name|res1
name|rei
name|res1
operator|:
name|movl
name|_u
operator|+
name|PCB_SSWAP
decl_stmt|,
name|r0
decl|#
name|restore
name|alternate
name|saved
name|context
name|clrl
name|_u
decl|+
name|PCB_SSWAP
name|movq
argument_list|(
name|r0
argument_list|)
decl|+
decl_stmt|,
name|r6
decl|#
name|restore
name|r6
decl_stmt|,
name|r7
name|movq
argument_list|(
name|r0
argument_list|)
decl|+
decl_stmt|,
name|r8
decl|#
name|restore
name|r8
decl_stmt|,
name|r9
name|movq
argument_list|(
name|r0
argument_list|)
decl|+
decl_stmt|,
name|r10
decl|#
name|restore
name|r10
decl_stmt|,
name|r11
name|movq
argument_list|(
name|r0
argument_list|)
decl|+
decl_stmt|,
name|r12
decl|#
name|restore
name|ap
decl_stmt|,
name|fp
name|movl
argument_list|(
name|r0
argument_list|)
decl|+
decl_stmt|,
name|r1
decl|#
name|saved
name|sp
name|cmpl
name|r1
decl_stmt|,
name|sp
decl|#
name|must
name|be
name|a
name|pop
name|bgequ
decl|1f
name|pushab
decl|2f
name|calls
name|$1
decl_stmt|,
name|_panic
comment|/* NOTREACHED */
decl|1
range|:
name|movl
name|r1
decl_stmt|,
name|sp
decl|#
name|restore
name|sp
name|pushl
name|$PSL_PRVMOD
decl|# return
name|psl
name|pushl
argument_list|(
name|r0
argument_list|)
decl|#
name|address
name|to
decl|return
name|to
name|rei
decl|2
range|:
operator|.
name|asciz
literal|"ldctx"
comment|/*  * {fu,su},{byte,word}, all massaged by asm.sed to jsb's  */
operator|.
name|align
literal|1
name|JSBENTRY
argument_list|(
argument|Fuword
argument_list|,
argument|R0
argument_list|)
name|prober
name|$3
decl_stmt|,
name|$4
decl_stmt|,
argument_list|(
name|r0
argument_list|)
name|beql
name|fserr
name|movl
argument_list|(
name|r0
argument_list|)
decl_stmt|,
name|r0
name|rsb
name|fserr
range|:
name|mnegl
name|$1
decl_stmt|,
name|r0
name|rsb
operator|.
name|align
decl|1
name|JSBENTRY
argument_list|(
name|Fubyte
argument_list|,
name|R0
argument_list|)
name|prober
name|$3
decl_stmt|,
name|$1
decl_stmt|,
argument_list|(
name|r0
argument_list|)
name|beql
name|fserr
name|movzbl
argument_list|(
name|r0
argument_list|)
decl_stmt|,
name|r0
name|rsb
operator|.
name|align
decl|1
name|JSBENTRY
argument_list|(
name|Suword
argument_list|,
name|R0
operator||
name|R1
argument_list|)
name|probew
name|$3
decl_stmt|,
name|$4
decl_stmt|,
argument_list|(
name|r0
argument_list|)
name|beql
name|fserr
name|movl
name|r1
decl_stmt|,
argument_list|(
name|r0
argument_list|)
name|clrl
name|r0
name|rsb
operator|.
name|align
decl|1
name|JSBENTRY
argument_list|(
name|Subyte
argument_list|,
name|R0
operator||
name|R1
argument_list|)
name|probew
name|$3
decl_stmt|,
name|$1
decl_stmt|,
argument_list|(
name|r0
argument_list|)
name|beql
name|fserr
name|movb
name|r1
decl_stmt|,
argument_list|(
name|r0
argument_list|)
name|clrl
name|r0
name|rsb
comment|/*  * Copy 1 relocation unit (NBPG bytes)  * from user virtual address to physical address  */
name|ENTRY
argument_list|(
name|copyseg
argument_list|,
literal|0
argument_list|)
name|bisl3
name|$PG_V
decl||
name|PG_KW
decl_stmt|,8
argument_list|(
name|ap
argument_list|)
decl_stmt|,
name|_CMAP2
name|mtpr
name|$_CADDR2
decl_stmt|,
name|$TBIS
decl|#
name|invalidate
name|entry
decl|for
name|copy
name|movc3
name|$NBPG
decl_stmt|,
modifier|*
decl_stmt|4
argument_list|(
name|ap
argument_list|)
decl_stmt|,
name|_CADDR2
name|ret
comment|/*  * zero out physical memory  * specified in relocation units (NBPG bytes)  */
name|ENTRY
argument_list|(
name|clearseg
argument_list|,
literal|0
argument_list|)
name|bisl3
name|$PG_V
decl||
name|PG_KW
decl_stmt|,4
argument_list|(
name|ap
argument_list|)
decl_stmt|,
name|_CMAP1
name|mtpr
name|$_CADDR1
decl_stmt|,
name|$TBIS
name|movc5
name|$0
decl_stmt|,
argument_list|(
name|sp
argument_list|)
decl_stmt|,
name|$0
decl_stmt|,
name|$NBPG
decl_stmt|,
name|_CADDR1
name|ret
comment|/*  * Check address.  * Given virtual address, byte count, and rw flag  * returns 0 on no access.  */
name|ENTRY
argument_list|(
name|useracc
argument_list|,
literal|0
argument_list|)
name|movl
decl|4
argument_list|(
name|ap
argument_list|)
decl_stmt|,
name|r0
decl|#
name|get
name|va
name|movl
decl|8
argument_list|(
name|ap
argument_list|)
decl_stmt|,
name|r1
decl|#
name|count
name|tstl
decl|12
argument_list|(
name|ap
argument_list|)
decl|#
name|test
decl|for
name|read
name|access
decl|?
name|bneq
name|userar
decl|#
name|yes
name|cmpl
name|$NBPG
decl_stmt|,
name|r1
decl|#
name|can
name|we
decl|do
name|it
name|in
name|one
name|probe
decl|?
name|bgeq
name|uaw2
decl|#
name|yes
name|uaw1
range|:
name|probew
name|$3
decl_stmt|,
name|$NBPG
decl_stmt|,
argument_list|(
name|r0
argument_list|)
name|beql
name|uaerr
decl|#
name|no
name|access
name|addl2
name|$NBPG
decl_stmt|,
name|r0
name|acbl
name|$NBPG
decl|+1
decl_stmt|,
name|$
decl|-
name|NBPG
decl_stmt|,
name|r1
decl_stmt|,
name|uaw1
name|uaw2
range|:
name|probew
name|$3
decl_stmt|,
name|r1
decl_stmt|,
argument_list|(
name|r0
argument_list|)
name|beql
name|uaerr
name|movl
name|$1
decl_stmt|,
name|r0
name|ret
name|userar
range|:
name|cmpl
name|$NBPG
decl_stmt|,
name|r1
name|bgeq
name|uar2
name|uar1
range|:
name|prober
name|$3
decl_stmt|,
name|$NBPG
decl_stmt|,
argument_list|(
name|r0
argument_list|)
name|beql
name|uaerr
name|addl2
name|$NBPG
decl_stmt|,
name|r0
name|acbl
name|$NBPG
decl|+1
decl_stmt|,
name|$
decl|-
name|NBPG
decl_stmt|,
name|r1
decl_stmt|,
name|uar1
name|uar2
range|:
name|prober
name|$3
decl_stmt|,
name|r1
decl_stmt|,
argument_list|(
name|r0
argument_list|)
name|beql
name|uaerr
name|movl
name|$1
decl_stmt|,
name|r0
name|ret
name|uaerr
range|:
name|clrl
name|r0
name|ret
comment|/*  * kernacc - check for kernel access privileges  *  * We can't use the probe instruction directly because  * it ors together current and previous mode.  */
name|ENTRY
argument_list|(
argument|kernacc
argument_list|,
literal|0
argument_list|)
name|movl
literal|4
operator|(
name|ap
operator|)
decl_stmt|,
name|r0
decl|#
name|virtual
name|address
name|bbcc
name|$31
decl_stmt|,
name|r0
decl_stmt|,
name|kacc1
name|bbs
name|$30
decl_stmt|,
name|r0
decl_stmt|,
name|kacerr
name|mfpr
name|$SBR
decl_stmt|,
name|r2
decl|#
name|address
name|and
name|length
name|of
name|page
name|table
argument_list|(
name|system
argument_list|)
name|bbss
name|$31
decl_stmt|,
name|r2
decl_stmt|,0f;
end_for

begin_expr_stmt
literal|0
operator|:
name|mfpr
name|$SLR
operator|,
name|r3
name|brb
name|kacc2
name|kacc1
operator|:
name|bbsc
name|$30
operator|,
name|r0
operator|,
name|kacc3
name|mfpr
name|$P0BR
operator|,
name|r2
operator|#
name|user
name|P0
name|mfpr
name|$P0LR
operator|,
name|r3
name|brb
name|kacc2
name|kacc3
operator|:
name|mfpr
name|$P1BR
operator|,
name|r2
operator|#
name|user
name|P1
argument_list|(
argument|stack
argument_list|)
name|mfpr
name|$P1LR
operator|,
name|r3
name|kacc2
operator|:
name|addl3
literal|8
operator|(
name|ap
operator|)
operator|,
name|r0
operator|,
name|r1
operator|#
name|ending
name|virtual
name|address
name|addl2
name|$NBPG
operator|-
literal|1
operator|,
name|r1
name|ashl
name|$
operator|-
name|PGSHIFT
operator|,
name|r0
operator|,
name|r0
name|ashl
name|$
operator|-
name|PGSHIFT
operator|,
name|r1
operator|,
name|r1
name|bbs
name|$31
operator|,
literal|4
operator|(
name|ap
operator|)
operator|,
name|kacc6
name|bbc
name|$30
operator|,
literal|4
operator|(
name|ap
operator|)
operator|,
name|kacc6
name|cmpl
name|r0
operator|,
name|r3
operator|#
name|user
name|stack
name|blss
name|kacerr
operator|#
name|address
name|too
name|low
name|brb
name|kacc4
name|kacc6
operator|:
name|cmpl
name|r1
operator|,
name|r3
operator|#
name|compare
name|last
name|page
name|to
name|P0LR
name|or
name|SLR
name|bgtr
name|kacerr
operator|#
name|address
name|too
name|high
name|kacc4
operator|:
name|movl
argument_list|(
name|r2
argument_list|)
index|[
name|r0
index|]
operator|,
name|r3
name|bbc
name|$31
operator|,
literal|4
operator|(
name|ap
operator|)
operator|,
name|kacc4a
name|bbc
name|$31
operator|,
name|r3
operator|,
name|kacerr
operator|#
name|valid
name|bit
name|is
name|off
name|kacc4a
operator|:
name|cmpzv
name|$27
operator|,
name|$4
operator|,
name|r3
operator|,
name|$1
operator|#
name|check
name|protection
name|code
name|bleq
name|kacerr
operator|#
name|no
name|access
name|allowed
name|tstb
literal|12
operator|(
name|ap
operator|)
name|bneq
name|kacc5
operator|#
name|only
name|check
name|read
name|access
name|cmpzv
name|$27
operator|,
name|$2
operator|,
name|r3
operator|,
name|$3
operator|#
name|check
name|low
literal|2
name|bits
name|of
name|prot
name|code
name|beql
name|kacerr
operator|#
name|no
name|write
name|access
name|kacc5
operator|:
name|aoblss
name|r1
operator|,
name|r0
operator|,
name|kacc4
operator|#
name|next
name|page
name|movl
name|$1
operator|,
name|r0
operator|#
name|no
name|errors
name|ret
name|kacerr
operator|:
name|clrl
name|r0
operator|#
name|error
name|ret
comment|/*  * Extracted and unrolled most common case of pagein (hopefully):  *	resident and not on free list (reclaim of page is purely  *	for the purpose of simulating a reference bit)  *  * Built in constants:  *	CLSIZE of 2, any bit fields in pte's  */
operator|.
name|text
operator|.
name|globl
name|Fastreclaim
name|Fastreclaim
operator|:
name|PUSHR
ifdef|#
directive|ifdef
name|GPROF
name|movl
name|fp
operator|,
operator|-
operator|(
name|sp
operator|)
name|movab
literal|12
operator|(
name|sp
operator|)
operator|,
name|fp
name|jsb
name|mcount
name|movl
argument_list|(
name|sp
argument_list|)
operator|+
operator|,
name|fp
endif|#
directive|endif
endif|GPROF
name|extzv
name|$9
operator|,
name|$23
operator|,
literal|28
operator|(
name|sp
operator|)
operator|,
name|r3
operator|#
name|virtual
name|address
name|bicl2
name|$1
operator|,
name|r3
operator|#
name|v
operator|=
name|clbase
argument_list|(
name|btop
argument_list|(
name|virtaddr
argument_list|)
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|movl
name|_u
operator|+
name|U_PROCP
operator|,
name|r5
operator|#
name|p
operator|=
name|u
operator|.
name|u_procp
empty|# from vtopte(p, v) ...
name|movl
name|$1
operator|,
name|r2
operator|#
name|type
operator|=
name|CTEXT
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|cmpl
name|r3
decl_stmt|,
name|P_TSIZE
argument_list|(
name|r5
argument_list|)
name|jlssu
decl|1f			# if
argument_list|(
name|isatsv
argument_list|(
name|p
argument_list|,
name|v
argument_list|)
argument_list|)
block|{
name|addl3
name|P_TSIZE
argument_list|(
name|r5
argument_list|)
decl_stmt|,
name|P_DSIZE
argument_list|(
name|r5
argument_list|)
decl_stmt|,
name|r0
name|cmpl
name|r3
decl_stmt|,
name|r0
name|jgequ
decl|2f
name|clrl
name|r2
decl|#
name|type
init|=
operator|!
name|CTEXT
decl_stmt|;
literal|1
operator|:
name|ashl
name|$2
operator|,
name|r3
operator|,
name|r4
name|addl2
name|P_P0BR
argument_list|(
name|r5
argument_list|)
operator|,
name|r4
operator|#
name|tptopte
argument_list|(
name|p
argument_list|,
name|vtotp
argument_list|(
name|p
argument_list|,
name|v
argument_list|)
argument_list|)
expr_stmt|;
name|jbr
literal|3f
literal|2
operator|:
name|cvtwl
name|P_SZPT
argument_list|(
name|r5
argument_list|)
operator|,
name|r4
operator|#
block|}
end_decl_stmt

begin_else
else|else
operator|(
name|isassv
argument_list|(
name|p
argument_list|,
name|v
argument_list|)
operator|)
block|{
name|ashl
name|$7
block|,
name|r4
block|,
name|r4
name|subl2
name|$0x400000
block|,
name|r4
name|addl2
name|r3
block|,
name|r4
name|ashl
name|$2
block|,
name|r4
block|,
name|r4
name|addl2
name|P_P0BR
argument_list|(
name|r5
argument_list|)
block|,
name|r4
operator|#
name|sptopte
argument_list|(
name|p
argument_list|,
name|vtosp
argument_list|(
name|p
argument_list|,
name|v
argument_list|)
argument_list|)
block|;
name|clrl
name|r2
operator|#
name|type
operator|=
operator|!
name|CTEXT
block|;
literal|3
operator|:
operator|#
block|}
name|bitb
name|$0x82
operator|,
literal|3
operator|(
name|r4
operator|)
name|beql
literal|2f
operator|#
end_else

begin_if
if|if
condition|(
name|pte
operator|->
name|pg_v
operator|||
name|pte
operator|->
name|pg_fod
condition|)
name|POPR
expr_stmt|;
end_if

begin_expr_stmt
name|rsb
operator|#
name|let
name|pagein
name|handle
name|it
literal|2
operator|:
name|bicl3
name|$0xffe00000
operator|,
operator|(
name|r4
operator|)
operator|,
name|r0
name|jneq
literal|2f
operator|#
end_expr_stmt

begin_if
if|if
condition|(
name|pte
operator|->
name|pg_pfnum
operator|==
literal|0
condition|)
name|POPR
expr_stmt|;
end_if

begin_expr_stmt
name|rsb
operator|#
name|let
name|pagein
name|handle
name|it
literal|2
operator|:
name|subl2
name|_firstfree
operator|,
name|r0
name|ashl
name|$
operator|-
literal|1
operator|,
name|r0
operator|,
name|r0
name|incl
name|r0
operator|#
name|pgtocm
argument_list|(
argument|pte->pg_pfnum
argument_list|)
name|mull2
name|$SZ_CMAP
operator|,
name|r0
name|addl2
name|_cmap
operator|,
name|r0
operator|#
operator|&
name|cmap
index|[
name|pgtocm
argument_list|(
name|pte
operator|->
name|pg_pfnum
argument_list|)
index|]
name|tstl
name|r2
name|jeql
literal|2f
operator|#
end_expr_stmt

begin_if
if|if
condition|(
name|type
operator|==
name|CTEXT
operator|&&
name|jbc
name|$C_INTRANS
operator|,
operator|(
name|r0
operator|)
operator|,
literal|2f
operator|#
name|c_intrans
condition|)
name|POPR
expr_stmt|;
end_if

begin_expr_stmt
name|rsb
operator|#
name|let
name|pagein
name|handle
name|it
literal|2
operator|:
name|jbc
name|$C_FREE
operator|,
operator|(
name|r0
operator|)
operator|,
literal|2f
operator|#
end_expr_stmt

begin_if
if|if
condition|(
name|c_free
condition|)
name|POPR
expr_stmt|;
end_if

begin_expr_stmt
name|rsb
operator|#
name|let
name|pagein
name|handle
name|it
literal|2
operator|:
name|bisb2
name|$0x80
operator|,
literal|3
operator|(
name|r4
operator|)
operator|#
name|pte
operator|->
name|pg_v
operator|=
literal|1
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|jbc
name|$26
decl_stmt|,4
argument_list|(
name|r4
argument_list|)
decl_stmt|,2f		# if
argument_list|(
name|anycl
argument_list|(
argument|pte
argument_list|,
argument|pg_m
argument_list|)
name|bisb2
name|$0x04
argument_list|,
literal|3
operator|(
name|r4
operator|)
operator|#
name|pte
operator|->
name|pg_m
operator|=
literal|1
argument_list|;
literal|2
operator|:
name|bicw3
name|$0x7f
argument_list|,
literal|2
operator|(
name|r4
operator|)
argument_list|,
name|r0
name|bicw3
name|$0xff80
argument_list|,
literal|6
operator|(
name|r4
operator|)
argument_list|,
name|r1
name|bisw3
name|r0
argument_list|,
name|r1
argument_list|,
literal|6
operator|(
name|r4
operator|)
operator|#
name|distcl
argument_list|(
name|pte
argument_list|)
argument_list|;
name|ashl
name|$PGSHIFT
argument_list|,
name|r3
argument_list|,
name|r0
name|mtpr
name|r0
argument_list|,
name|$TBIS
name|addl2
name|$NBPG
argument_list|,
name|r0
name|mtpr
name|r0
argument_list|,
name|$TBIS
operator|#
name|tbiscl
argument_list|(
name|v
argument_list|)
argument_list|;
name|tstl
name|r2
name|jeql
literal|2f
operator|#
if|if
condition|(
name|type
operator|==
name|CTEXT
condition|)
name|movl
name|P_TEXTP
argument_list|(
name|r5
argument_list|)
decl_stmt|,
name|r0
name|movl
name|X_CADDR
argument_list|(
name|r0
argument_list|)
decl_stmt|,
name|r5
decl|# for
argument_list|(
name|p
operator|=
name|p
operator|->
name|p_textp
operator|->
name|x_caddr
argument_list|;
end_decl_stmt

begin_expr_stmt
name|p
expr_stmt|;
end_expr_stmt

begin_block
unit|)
block|{
name|jeql
literal|2f
name|ashl
name|$2
operator|,
name|r3
operator|,
name|r3
literal|3
operator|:
name|addl3
name|P_P0BR
argument_list|(
name|r5
argument_list|)
operator|,
name|r3
operator|,
name|r0
operator|#
name|tpte
operator|=
name|tptopte
argument_list|(
name|p
argument_list|,
name|tp
argument_list|)
expr_stmt|;
name|bisb2
name|$1
decl_stmt|,
name|P_FLAG
decl|+3
argument_list|(
name|r5
argument_list|)
decl|#
name|p
operator|->
name|p_flag
decl||=
name|SPTECHG
decl_stmt|;
name|movl
argument_list|(
name|r4
argument_list|)
operator|,
operator|(
name|r0
operator|)
operator|+
operator|#
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|CLSIZE
condition|;
name|i
operator|++
control|)
name|movl
literal|4
operator|(
name|r4
operator|)
operator|,
operator|(
name|r0
operator|)
operator|#
name|tpte
index|[
name|i
index|]
operator|=
name|pte
index|[
name|i
index|]
expr_stmt|;
name|movl
name|P_XLINK
argument_list|(
name|r5
argument_list|)
decl_stmt|,
name|r5
decl|#
name|p
init|=
name|p
operator|->
name|p_xlink
decl_stmt|;
name|jneq
literal|3b
operator|#
block|}
end_block

begin_expr_stmt
literal|2
operator|:
operator|#
name|collect
name|a
name|few
name|statistics
operator|...
name|incl
name|_u
operator|+
name|U_RU
operator|+
name|RU_MINFLT
operator|#
name|u
operator|.
name|u_ru
operator|.
name|ru_minflt
operator|++
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|moval
name|_cnt
decl_stmt|,
name|r0
name|incl
name|V_FAULTS
argument_list|(
name|r0
argument_list|)
decl|#
name|cnt
operator|.
name|v_faults
decl|++
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|incl
name|V_PGREC
argument_list|(
name|r0
argument_list|)
decl|#
name|cnt
operator|.
name|v_pgrec
decl|++
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|incl
name|V_FASTPGREC
argument_list|(
name|r0
argument_list|)
decl|#
name|cnt
operator|.
name|v_fastpgrec
decl|++
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|incl
name|V_TRAP
argument_list|(
name|r0
argument_list|)
decl|#
name|cnt
operator|.
name|v_trap
decl|++
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|POPR
name|addl2
name|$8
decl_stmt|,
name|sp
decl|#
name|pop
name|pc
decl_stmt|,
name|code
name|mtpr
name|$HIGH
decl_stmt|,
name|$IPL
decl|##
name|dont
name|go
name|to
name|a
name|higher
name|IPL
argument_list|(
name|GROT
argument_list|)
name|rei
operator|.
name|globl
name|_Xkdbintr0
operator|.
name|align
decl|2
name|_Xkdbintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|0
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_kdbintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xrkintr0
operator|.
name|align
decl|2
name|_Xrkintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|1
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_rkintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xtmintr0
operator|.
name|align
decl|2
name|_Xtmintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|2
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_tmintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xutintr0
operator|.
name|align
decl|2
name|_Xutintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|3
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_utintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xtmscpintr0
operator|.
name|align
decl|2
name|_Xtmscpintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|4
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_tmscpintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xupintr0
operator|.
name|align
decl|2
name|_Xupintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|5
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_upintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xudaintr0
operator|.
name|align
decl|2
name|_Xudaintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|6
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_udaintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xidcintr0
operator|.
name|align
decl|2
name|_Xidcintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|7
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_idcintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xrlintr0
operator|.
name|align
decl|2
name|_Xrlintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|8
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_rlintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdhrint0
operator|.
name|align
decl|2
name|_Xdhrint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|9
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dhrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdhxint0
operator|.
name|align
decl|2
name|_Xdhxint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|10
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dhxint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmintr0
operator|.
name|align
decl|2
name|_Xdmintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|11
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdhrint1
operator|.
name|align
decl|2
name|_Xdhrint1
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|12
operator|)
name|pushl
name|$1
name|calls
name|$1
decl_stmt|,
name|_dhrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdhxint1
operator|.
name|align
decl|2
name|_Xdhxint1
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|13
operator|)
name|pushl
name|$1
name|calls
name|$1
decl_stmt|,
name|_dhxint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdzrint0
operator|.
name|align
decl|2
name|_Xdzrint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|14
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dzrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdzxint0
operator|.
name|align
decl|2
name|_Xdzxint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|15
operator|)
name|movl
name|$0
decl_stmt|,
name|r0
name|jmp
name|dzdma
operator|.
name|globl
name|_Xdzrint1
operator|.
name|align
decl|2
name|_Xdzrint1
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|16
operator|)
name|pushl
name|$1
name|calls
name|$1
decl_stmt|,
name|_dzrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdzxint1
operator|.
name|align
decl|2
name|_Xdzxint1
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|17
operator|)
name|movl
name|$1
decl_stmt|,
name|r0
name|jmp
name|dzdma
operator|.
name|globl
name|_Xdzrint2
operator|.
name|align
decl|2
name|_Xdzrint2
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|18
operator|)
name|pushl
name|$2
name|calls
name|$1
decl_stmt|,
name|_dzrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdzxint2
operator|.
name|align
decl|2
name|_Xdzxint2
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|19
operator|)
name|movl
name|$2
decl_stmt|,
name|r0
name|jmp
name|dzdma
operator|.
name|globl
name|_Xdzrint3
operator|.
name|align
decl|2
name|_Xdzrint3
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|20
operator|)
name|pushl
name|$3
name|calls
name|$1
decl_stmt|,
name|_dzrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdzxint3
operator|.
name|align
decl|2
name|_Xdzxint3
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|21
operator|)
name|movl
name|$3
decl_stmt|,
name|r0
name|jmp
name|dzdma
operator|.
name|globl
name|_Xdzrint4
operator|.
name|align
decl|2
name|_Xdzrint4
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|22
operator|)
name|pushl
name|$4
name|calls
name|$1
decl_stmt|,
name|_dzrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdzxint4
operator|.
name|align
decl|2
name|_Xdzxint4
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|23
operator|)
name|movl
name|$4
decl_stmt|,
name|r0
name|jmp
name|dzdma
operator|.
name|globl
name|_Xdzrint5
operator|.
name|align
decl|2
name|_Xdzrint5
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|24
operator|)
name|pushl
name|$5
name|calls
name|$1
decl_stmt|,
name|_dzrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdzxint5
operator|.
name|align
decl|2
name|_Xdzxint5
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|25
operator|)
name|movl
name|$5
decl_stmt|,
name|r0
name|jmp
name|dzdma
operator|.
name|globl
name|_Xdzrint6
operator|.
name|align
decl|2
name|_Xdzrint6
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|26
operator|)
name|pushl
name|$6
name|calls
name|$1
decl_stmt|,
name|_dzrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdzxint6
operator|.
name|align
decl|2
name|_Xdzxint6
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|27
operator|)
name|movl
name|$6
decl_stmt|,
name|r0
name|jmp
name|dzdma
operator|.
name|globl
name|_Xdzrint7
operator|.
name|align
decl|2
name|_Xdzrint7
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|28
operator|)
name|pushl
name|$7
name|calls
name|$1
decl_stmt|,
name|_dzrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdzxint7
operator|.
name|align
decl|2
name|_Xdzxint7
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|29
operator|)
name|movl
name|$7
decl_stmt|,
name|r0
name|jmp
name|dzdma
operator|.
name|globl
name|_Xtsintr0
operator|.
name|align
decl|2
name|_Xtsintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|30
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_tsintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmfsrint0
operator|.
name|align
decl|2
name|_Xdmfsrint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|31
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmfsrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmfsxint0
operator|.
name|align
decl|2
name|_Xdmfsxint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|32
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmfsxint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmfdaint0
operator|.
name|align
decl|2
name|_Xdmfdaint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|33
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmfdaint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmfdbint0
operator|.
name|align
decl|2
name|_Xdmfdbint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|34
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmfdbint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmfrint0
operator|.
name|align
decl|2
name|_Xdmfrint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|35
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmfrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmfxint0
operator|.
name|align
decl|2
name|_Xdmfxint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|36
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmfxint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmflint0
operator|.
name|align
decl|2
name|_Xdmflint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|37
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmflint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmzrinta0
operator|.
name|align
decl|2
name|_Xdmzrinta0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|38
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmzrinta
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmzxinta0
operator|.
name|align
decl|2
name|_Xdmzxinta0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|39
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmzxinta
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmzrintb0
operator|.
name|align
decl|2
name|_Xdmzrintb0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|40
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmzrintb
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmzxintb0
operator|.
name|align
decl|2
name|_Xdmzxintb0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|41
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmzxintb
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmzrintc0
operator|.
name|align
decl|2
name|_Xdmzrintc0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|42
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmzrintc
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdmzxintc0
operator|.
name|align
decl|2
name|_Xdmzxintc0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|43
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dmzxintc
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdhurint0
operator|.
name|align
decl|2
name|_Xdhurint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|44
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dhurint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdhuxint0
operator|.
name|align
decl|2
name|_Xdhuxint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|45
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_dhuxint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xlpintr0
operator|.
name|align
decl|2
name|_Xlpintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|46
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_lpintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xqvkint0
operator|.
name|align
decl|2
name|_Xqvkint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|47
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_qvkint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xqvvint0
operator|.
name|align
decl|2
name|_Xqvvint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|48
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_qvvint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xqddint0
operator|.
name|align
decl|2
name|_Xqddint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|49
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_qddint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xqdaint0
operator|.
name|align
decl|2
name|_Xqdaint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|50
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_qdaint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xqdiint0
operator|.
name|align
decl|2
name|_Xqdiint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|51
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_qdiint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xecrint0
operator|.
name|align
decl|2
name|_Xecrint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|52
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_ecrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xeccollide0
operator|.
name|align
decl|2
name|_Xeccollide0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|53
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_eccollide
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xecxint0
operator|.
name|align
decl|2
name|_Xecxint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|54
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_ecxint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xdeintr0
operator|.
name|align
decl|2
name|_Xdeintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|55
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_deintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xilrint0
operator|.
name|align
decl|2
name|_Xilrint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|56
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_ilrint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xilcint0
operator|.
name|align
decl|2
name|_Xilcint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|57
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_ilcint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xexcdint0
operator|.
name|align
decl|2
name|_Xexcdint0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|58
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_excdint
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_Xqeintr0
operator|.
name|align
decl|2
name|_Xqeintr0
range|:
name|pushr
name|$0x3f
name|incl
name|_fltintrcnt
operator|+
operator|(
literal|4
operator|*
literal|59
operator|)
name|pushl
name|$0
name|calls
name|$1
decl_stmt|,
name|_qeintr
name|popr
name|$0x3f
name|incl
name|_cnt
decl|+
name|V_INTR
name|rei
operator|.
name|globl
name|_intrnames
operator|.
name|globl
name|_eintrnames
operator|.
name|data
name|_intrnames
range|:
operator|.
name|asciz
literal|"clock"
operator|.
name|asciz
literal|"cnr"
operator|.
name|asciz
literal|"cnx"
operator|.
name|asciz
literal|"tur"
operator|.
name|asciz
literal|"tux"
operator|.
name|asciz
literal|"mba0"
operator|.
name|asciz
literal|"mba1"
operator|.
name|asciz
literal|"mba2"
operator|.
name|asciz
literal|"mba3"
operator|.
name|asciz
literal|"uba0"
operator|.
name|asciz
literal|"uba1"
operator|.
name|asciz
literal|"uba2"
operator|.
name|asciz
literal|"uba3"
operator|.
name|asciz
literal|"kdb0"
operator|.
name|asciz
literal|"rk0"
operator|.
name|asciz
literal|"tm0"
operator|.
name|asciz
literal|"ut0"
operator|.
name|asciz
literal|"tmscp0"
operator|.
name|asciz
literal|"up0"
operator|.
name|asciz
literal|"uda0"
operator|.
name|asciz
literal|"idc0"
operator|.
name|asciz
literal|"rl0"
operator|.
name|asciz
literal|"dhr0"
operator|.
name|asciz
literal|"dhx0"
operator|.
name|asciz
literal|"dm0"
operator|.
name|asciz
literal|"dhr1"
operator|.
name|asciz
literal|"dhx1"
operator|.
name|asciz
literal|"dzr0"
operator|.
name|asciz
literal|"dzx0"
operator|.
name|asciz
literal|"dzr1"
operator|.
name|asciz
literal|"dzx1"
operator|.
name|asciz
literal|"dzr2"
operator|.
name|asciz
literal|"dzx2"
operator|.
name|asciz
literal|"dzr3"
operator|.
name|asciz
literal|"dzx3"
operator|.
name|asciz
literal|"dzr4"
operator|.
name|asciz
literal|"dzx4"
operator|.
name|asciz
literal|"dzr5"
operator|.
name|asciz
literal|"dzx5"
operator|.
name|asciz
literal|"dzr6"
operator|.
name|asciz
literal|"dzx6"
operator|.
name|asciz
literal|"dzr7"
operator|.
name|asciz
literal|"dzx7"
operator|.
name|asciz
literal|"ts0"
operator|.
name|asciz
literal|"dmfsr0"
operator|.
name|asciz
literal|"dmfsx0"
operator|.
name|asciz
literal|"dmfda0"
operator|.
name|asciz
literal|"dmfdb0"
operator|.
name|asciz
literal|"dmfr0"
operator|.
name|asciz
literal|"dmfx0"
operator|.
name|asciz
literal|"dmfl0"
operator|.
name|asciz
literal|"dmzra0"
operator|.
name|asciz
literal|"dmzxa0"
operator|.
name|asciz
literal|"dmzrb0"
operator|.
name|asciz
literal|"dmzxb0"
operator|.
name|asciz
literal|"dmzrc0"
operator|.
name|asciz
literal|"dmzxc0"
operator|.
name|asciz
literal|"dhur0"
operator|.
name|asciz
literal|"dhux0"
operator|.
name|asciz
literal|"lp0"
operator|.
name|asciz
literal|"qvk0"
operator|.
name|asciz
literal|"qvv0"
operator|.
name|asciz
literal|"qdd0"
operator|.
name|asciz
literal|"qda0"
operator|.
name|asciz
literal|"qdi0"
operator|.
name|asciz
literal|"ecr0"
operator|.
name|asciz
literal|"eccollide0"
operator|.
name|asciz
literal|"ecx0"
operator|.
name|asciz
literal|"de0"
operator|.
name|asciz
literal|"ilr0"
operator|.
name|asciz
literal|"ilc0"
operator|.
name|asciz
literal|"excd0"
operator|.
name|asciz
literal|"qe0"
name|_eintrnames
operator|:
operator|.
name|globl
name|_intrcnt
operator|.
name|globl
name|_eintrcnt
operator|.
name|align
literal|2
name|_intrcnt
operator|:
operator|.
name|space
literal|4
operator|*
literal|13
name|_fltintrcnt
operator|:
operator|.
name|space
literal|4
operator|*
literal|60
name|_eintrcnt
operator|:
operator|.
name|text
end_decl_stmt

end_unit

