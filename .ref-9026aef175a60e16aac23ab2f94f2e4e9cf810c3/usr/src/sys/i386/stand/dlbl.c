begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 1990 The Regents of the University of California.  * All rights reserved.  *  * This code is derived from software contributed to Berkeley by  * William Jolitz.  *  * %sccs.include.noredist.c%  *  *	@(#)dlbl.c	7.1 (Berkeley) %G%  */
end_comment

begin_include
include|#
directive|include
file|"../h/param.h"
end_include

begin_include
include|#
directive|include
file|"../h/inode.h"
end_include

begin_include
include|#
directive|include
file|"../h/fs.h"
end_include

begin_include
include|#
directive|include
file|"../h/dkbad.h"
end_include

begin_include
include|#
directive|include
file|"../h/disk.h"
end_include

begin_struct
struct|struct
name|bb
block|{
name|char
name|bufr
index|[
name|LABELOFFSET
index|]
decl_stmt|;
name|struct
name|disklabel
name|w
decl_stmt|;
block|}
name|xx
struct|,
name|yy
struct|;
end_struct

begin_decl_stmt
name|struct
name|disklabel
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|disklabel
name|wdsizes
index|[
literal|2
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|dkbad
name|dkbad
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|()
block|{
name|int
name|fi
decl_stmt|,
name|x
decl_stmt|;
name|xx
operator|.
name|bufr
index|[
literal|0
index|]
operator|=
literal|126
expr_stmt|;
name|xx
operator|.
name|bufr
index|[
name|LABELOFFSET
operator|-
literal|1
index|]
operator|=
literal|125
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_magic
operator|=
literal|0xabc
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_type
operator|=
literal|1
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_secsize
operator|=
literal|512
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_nsectors
operator|=
literal|17
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_ntracks
operator|=
literal|8
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_ncylinders
operator|=
literal|615
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_secpercyl
operator|=
literal|17
operator|*
literal|8
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_secperunit
operator|=
operator|(
literal|612
operator|-
literal|290
operator|)
operator|*
literal|17
operator|*
literal|8
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_precompcyl
operator|=
literal|616
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_partition
index|[
literal|0
index|]
operator|.
name|nblocks
operator|=
operator|(
literal|611
operator|-
literal|290
operator|)
operator|*
literal|17
operator|*
literal|8
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_partition
index|[
literal|0
index|]
operator|.
name|cyloff
operator|=
literal|290
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_partition
index|[
literal|1
index|]
operator|.
name|nblocks
operator|=
operator|(
literal|611
operator|-
literal|290
operator|)
operator|*
literal|17
operator|*
literal|8
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_partition
index|[
literal|1
index|]
operator|.
name|cyloff
operator|=
literal|290
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_partition
index|[
literal|2
index|]
operator|.
name|nblocks
operator|=
operator|(
literal|611
operator|-
literal|290
operator|)
operator|*
literal|17
operator|*
literal|8
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_partition
index|[
literal|2
index|]
operator|.
name|cyloff
operator|=
literal|290
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_name
index|[
literal|0
index|]
operator|=
literal|'a'
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_name
index|[
literal|1
index|]
operator|=
literal|'b'
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_name
index|[
literal|2
index|]
operator|=
literal|'c'
expr_stmt|;
name|xx
operator|.
name|w
operator|.
name|dk_name
index|[
literal|3
index|]
operator|=
literal|'\0'
expr_stmt|;
name|dlp
operator|=
operator|&
name|xx
operator|.
name|w
expr_stmt|;
name|fi
operator|=
name|open
argument_list|(
literal|"wd0a:"
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|wdsizes
index|[
literal|0
index|]
operator|=
operator|*
name|dlp
expr_stmt|;
name|lseek
argument_list|(
name|fi
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|write
argument_list|(
name|fi
argument_list|,
operator|&
name|xx
argument_list|,
literal|512
argument_list|)
expr_stmt|;
comment|/*for (x=0; x<17; x++) */
name|write
argument_list|(
name|fi
argument_list|,
operator|&
name|xx
argument_list|,
literal|512
argument_list|)
expr_stmt|;
comment|/*for (x=0; x<17; x++)*/
name|read
argument_list|(
name|fi
argument_list|,
operator|&
name|yy
argument_list|,
literal|512
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

