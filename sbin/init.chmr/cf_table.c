begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1993 Christoph M. Robitschko  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *      This product includes software developed by Christoph M. Robitschko  * 4. The name of the author may not be used to endorse or promote products  *    derived from this software withough specific prior written permission  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*  * cf_table.c  * The table of words that the configuration subsystem understands,  * along with local support functions.  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIGURE
end_ifdef

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<ttyent.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/signal.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<sys/resource.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_include
include|#
directive|include
file|"init.h"
end_include

begin_include
include|#
directive|include
file|"prototypes.h"
end_include

begin_include
include|#
directive|include
file|"cf_defs.h"
end_include

begin_comment
comment|/* Prototypes for static functions */
end_comment

begin_function_decl
specifier|static
name|int
name|conf_env
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|,
name|char
modifier|*
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|conf_include
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|,
name|char
modifier|*
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|conf_waittimes
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|,
name|char
modifier|*
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* static variables */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|rlimit
name|proclimits
index|[
name|RLIM_NLIMITS
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* extern variables, referenced inb Commands table */
end_comment

begin_decl_stmt
specifier|extern
name|int
name|startup_single
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|ttyent
name|RCent_auto
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|ttyent
name|RCent_fast
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|ttyent
name|Single_ent
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|retrytime
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|timeout_m2s_KILL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|timeout_m2s_TERM
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|checkstatus
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|checktime
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|__STDC__
end_ifdef

begin_define
define|#
directive|define
name|CURLIM
parameter_list|(
name|_lim_
parameter_list|)
value|&proclimits[RLIMIT_##_lim_].rlim_cur
end_define

begin_define
define|#
directive|define
name|MAXLIM
parameter_list|(
name|_lim_
parameter_list|)
value|&proclimits[RLIMIT_##_lim_].rlim_max
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|CURLIM
parameter_list|(
name|_lim_
parameter_list|)
value|&proclimits[RLIMIT_
comment|/**/
value|_lim_].rlim_cur
end_define

begin_define
define|#
directive|define
name|MAXLIM
parameter_list|(
name|_lim_
parameter_list|)
value|&proclimits[RLIMIT_
comment|/**/
value|_lim_].rlim_max
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * The table of all known words and actions  */
end_comment

begin_decl_stmt
specifier|const
name|struct
name|Command
name|Commands
index|[]
init|=
block|{
ifdef|#
directive|ifdef
name|DEBUG
block|{
literal|"debug_level"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LEVEL"
block|,
literal|1
block|,
name|T_INT
block|,
name|MAXVAL
block|,
operator|&
name|debug
block|,
block|{
literal|5
block|}
block|}
block|,
endif|#
directive|endif
block|{
literal|"startup_state"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"singleuser_mode"
block|,
literal|1
block|,
name|T_EX
block|,
literal|0
block|,
operator|&
name|startup_single
block|,
block|{
literal|1
block|}
block|}
block|,
block|{
literal|"multiuser_mode"
block|,
literal|1
block|,
name|T_EX
block|,
literal|0
block|,
operator|&
name|startup_single
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"setenv"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"VAR"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_STR
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"STRING"
block|,
literal|2
block|,
name|T_STR
block|,
name|CFUNC
block|,
name|conf_env
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"include"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"FILE"
block|,
literal|1
block|,
name|T_STR
block|,
name|CFUNC
block|,
name|conf_include
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"singleusershell"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"COMMAND"
block|,
literal|1
block|,
name|T_STR
block|,
literal|0
block|,
operator|&
name|Single_ent
operator|.
name|ty_getty
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"singleuserterminal"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"TYPE"
block|,
literal|1
block|,
name|T_STR
block|,
literal|0
block|,
operator|&
name|Single_ent
operator|.
name|ty_type
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"singleuserdevice"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"DEVICE"
block|,
literal|1
block|,
name|T_STR
block|,
literal|0
block|,
operator|&
name|Single_ent
operator|.
name|ty_name
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"autobootcommand"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"COMMAND"
block|,
literal|1
block|,
name|T_STR
block|,
literal|0
block|,
operator|&
name|RCent_auto
operator|.
name|ty_getty
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"fastbootcommand"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"COMMAND"
block|,
literal|1
block|,
name|T_STR
block|,
literal|0
block|,
operator|&
name|RCent_fast
operator|.
name|ty_getty
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"timeout"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"shutdown"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"sigterm"
block|,
literal|2
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"TIMEOUT"
block|,
literal|3
block|,
name|T_INT
block|,
name|MAXVAL
block|,
operator|&
name|timeout_m2s_TERM
block|,
block|{
literal|300
block|}
block|}
block|,
block|{
literal|"sigkill"
block|,
literal|2
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"TIMEOUT"
block|,
literal|3
block|,
name|T_INT
block|,
name|MAXVAL
block|,
operator|&
name|timeout_m2s_KILL
block|,
block|{
literal|300
block|}
block|}
block|,
block|{
literal|"error-retry"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"TIME"
block|,
literal|2
block|,
name|T_TIME
block|,
literal|0
block|,
operator|&
name|retrytime
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"respawn"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"checkstatus"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"yes"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
operator|&
name|checkstatus
block|,
block|{
literal|1
block|}
block|}
block|,
block|{
literal|"on"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
operator|&
name|checkstatus
block|,
block|{
literal|1
block|}
block|}
block|,
block|{
literal|"no"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
operator|&
name|checkstatus
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"off"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
operator|&
name|checkstatus
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"checktime"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"yes"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
operator|&
name|checktime
block|,
block|{
name|DEF_CHECKTIME
block|}
block|}
block|,
block|{
literal|"on"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
operator|&
name|checktime
block|,
block|{
name|DEF_CHECKTIME
block|}
block|}
block|,
block|{
literal|"no"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
operator|&
name|checktime
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"off"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
operator|&
name|checktime
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"TIMEOUT"
block|,
literal|2
block|,
name|T_TIME
block|,
name|MAXVAL
block|,
operator|&
name|checktime
block|,
block|{
literal|300
block|}
block|}
block|,
block|{
literal|"waittimes"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"delete_list"
block|,
literal|2
block|,
name|T_EX
block|,
name|CFUNC
block|,
name|conf_waittimes
block|,
block|{
literal|1
block|}
block|}
block|,
block|{
literal|"add_list"
block|,
literal|2
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"TIME"
block|,
literal|3
block|,
name|T_TIME
block|,
name|CFUNC
block|,
name|conf_waittimes
block|,
block|{
literal|2
block|}
block|}
block|,
block|{
literal|"limit"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"cputime"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|CPU
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_TIME
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|CPU
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"filesize"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|FSIZE
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|FSIZE
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"datasize"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|DATA
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|DATA
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"stacksize"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|STACK
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|STACK
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"coredumpsize"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|CORE
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|CORE
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"memoryuse"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|RSS
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|RSS
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"memorylocked"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|MEMLOCK
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|MEMLOCK
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"maxprocesses"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|NPROC
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_INT
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|NPROC
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"openfiles"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|OFILE
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_INT
block|,
literal|0
block|,
name|CURLIM
argument_list|(
name|OFILE
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"hardlimit"
block|,
literal|0
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"cputime"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|MAXLIM
argument_list|(
name|CPU
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_TIME
block|,
name|NRAISE
block|,
name|MAXLIM
argument_list|(
name|CPU
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"filesize"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|MAXLIM
argument_list|(
name|FSIZE
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
name|NRAISE
block|,
name|MAXLIM
argument_list|(
name|FSIZE
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"datasize"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|MAXLIM
argument_list|(
name|DATA
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
name|NRAISE
block|,
name|MAXLIM
argument_list|(
name|DATA
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"stacksize"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|MAXLIM
argument_list|(
name|STACK
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
name|NRAISE
block|,
name|MAXLIM
argument_list|(
name|STACK
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"coredumpsize"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|MAXLIM
argument_list|(
name|CORE
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
name|NRAISE
block|,
name|MAXLIM
argument_list|(
name|CORE
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"memoryuse"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|MAXLIM
argument_list|(
name|RSS
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
name|NRAISE
block|,
name|MAXLIM
argument_list|(
name|RSS
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"memorylocked"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|MAXLIM
argument_list|(
name|MEMLOCK
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_BYTE
block|,
name|NRAISE
block|,
name|MAXLIM
argument_list|(
name|MEMLOCK
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"maxprocesses"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|MAXLIM
argument_list|(
name|NPROC
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_INT
block|,
name|NRAISE
block|,
name|MAXLIM
argument_list|(
name|NPROC
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|,
block|{
literal|"openfiles"
block|,
literal|1
operator|+
name|SUB
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"unlimited"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|MAXLIM
argument_list|(
name|OFILE
argument_list|)
block|,
block|{
name|RLIM_INFINITY
block|}
block|}
block|,
block|{
literal|"default"
block|,
literal|2
block|,
name|T_EX
block|,
literal|0
block|,
name|NOVAR
block|}
block|,
block|{
literal|"LIMIT"
block|,
literal|2
block|,
name|T_INT
block|,
name|NRAISE
block|,
name|MAXLIM
argument_list|(
name|OFILE
argument_list|)
block|,
block|{
literal|0
block|}
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|int
name|NCommands
init|=
operator|(
sizeof|sizeof
argument_list|(
name|Commands
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
expr|struct
name|Command
argument_list|)
operator|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * INIT-specific functions for configuration  */
end_comment

begin_comment
comment|/*  * SETCONF  * called in each new process to set up configured things  */
end_comment

begin_function
name|void
name|setconf
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|f
decl_stmt|;
name|Debug
argument_list|(
literal|4
argument_list|,
literal|"Setting configuration"
argument_list|)
expr_stmt|;
for|for
control|(
name|f
operator|=
literal|0
init|;
name|f
operator|<
name|RLIM_NLIMITS
condition|;
name|f
operator|++
control|)
operator|(
name|void
operator|)
name|setrlimit
argument_list|(
name|f
argument_list|,
operator|&
name|proclimits
index|[
name|f
index|]
argument_list|)
expr_stmt|;
name|Debug
argument_list|(
literal|4
argument_list|,
literal|"Setting configuration completed"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * GETCONF  * prepare for configuration  * called once before configure().  */
end_comment

begin_function
name|void
name|getconf
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|f
decl_stmt|;
for|for
control|(
name|f
operator|=
literal|0
init|;
name|f
operator|<
name|RLIM_NLIMITS
condition|;
name|f
operator|++
control|)
operator|(
name|void
operator|)
name|getrlimit
argument_list|(
name|f
argument_list|,
operator|&
name|proclimits
index|[
name|f
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * CHECKCONF  * check configured things etc.  * called once after configure().  */
end_comment

begin_function
name|void
name|checkconf
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|f
decl_stmt|;
comment|/* Do not allow soft limits to be higher than the hard limits */
for|for
control|(
name|f
operator|=
literal|0
init|;
name|f
operator|<
name|RLIM_NLIMITS
condition|;
name|f
operator|++
control|)
if|if
condition|(
name|proclimits
index|[
name|f
index|]
operator|.
name|rlim_cur
operator|>
name|proclimits
index|[
name|f
index|]
operator|.
name|rlim_max
condition|)
name|proclimits
index|[
name|f
index|]
operator|.
name|rlim_cur
operator|=
name|proclimits
index|[
name|f
index|]
operator|.
name|rlim_max
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Support functions, referenced in Commands table  */
end_comment

begin_comment
comment|/* Set an environment variable from the configuration file */
end_comment

begin_function
specifier|static
name|int
name|conf_env
parameter_list|(
name|configfile
parameter_list|,
name|lineno
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|what
parameter_list|)
name|char
modifier|*
name|configfile
decl_stmt|;
name|int
name|lineno
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|int
name|what
decl_stmt|;
block|{
name|iputenv
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
name|argv
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Include another configuration file */
end_comment

begin_function
specifier|static
name|int
name|conf_include
parameter_list|(
name|configfile
parameter_list|,
name|lineno
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|what
parameter_list|)
name|char
modifier|*
name|configfile
decl_stmt|;
name|int
name|lineno
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|int
name|what
decl_stmt|;
block|{
name|configure
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Configure the times to wait before restarting a getty that has failed */
end_comment

begin_function
specifier|static
name|int
name|conf_waittimes
parameter_list|(
name|configfile
parameter_list|,
name|lineno
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|what
parameter_list|)
name|char
modifier|*
name|configfile
decl_stmt|;
name|int
name|lineno
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|int
name|what
decl_stmt|;
block|{
name|Debug
argument_list|(
literal|0
argument_list|,
literal|"conf_waittimes not yet implemented."
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

