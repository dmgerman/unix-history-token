begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright 2001 The Aerospace Corporation.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. The name of The Aerospace Corporation may not be used to endorse or  *    promote products derived from this software.  *  * THIS SOFTWARE IS PROVIDED BY THE AEROSPACE CORPORATION ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AEROSPACE CORPORATION BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_comment
comment|/*-  * Copyright (c) 1997, 1998, 2000 The NetBSD Foundation, Inc.  * All rights reserved.  *  * This code is derived from software contributed to The NetBSD Foundation  * by Jason R. Thorpe of the Numerical Aerospace Simulation Facility,  * NASA Ames Research Center.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *	This product includes software developed by the NetBSD  *	Foundation, Inc. and its contributors.  * 4. Neither the name of The NetBSD Foundation nor the names of its  *    contributors may be used to endorse or promote products derived  *    from this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS  * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED  * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  * POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/sysctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<net/ethernet.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_dl.h>
end_include

begin_include
include|#
directive|include
file|<net/if_types.h>
end_include

begin_include
include|#
directive|include
file|<net/if_media.h>
end_include

begin_include
include|#
directive|include
file|<net/route.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211_crypto.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211_ioctl.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<inttypes.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<stddef.h>
end_include

begin_comment
comment|/* NB: for offsetof */
end_comment

begin_include
include|#
directive|include
file|"ifconfig.h"
end_include

begin_define
define|#
directive|define
name|MAXCOL
value|78
end_define

begin_decl_stmt
specifier|static
name|int
name|col
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|spacer
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|LINE_INIT
parameter_list|(
name|char
name|c
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|LINE_BREAK
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|LINE_CHECK
parameter_list|(
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* XXX need max array size */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|int
name|htrates
index|[
literal|16
index|]
init|=
block|{
literal|13
block|,
comment|/* IFM_IEEE80211_MCS0 */
literal|26
block|,
comment|/* IFM_IEEE80211_MCS1 */
literal|39
block|,
comment|/* IFM_IEEE80211_MCS2 */
literal|52
block|,
comment|/* IFM_IEEE80211_MCS3 */
literal|78
block|,
comment|/* IFM_IEEE80211_MCS4 */
literal|104
block|,
comment|/* IFM_IEEE80211_MCS5 */
literal|117
block|,
comment|/* IFM_IEEE80211_MCS6 */
literal|130
block|,
comment|/* IFM_IEEE80211_MCS7 */
literal|26
block|,
comment|/* IFM_IEEE80211_MCS8 */
literal|52
block|,
comment|/* IFM_IEEE80211_MCS9 */
literal|78
block|,
comment|/* IFM_IEEE80211_MCS10 */
literal|104
block|,
comment|/* IFM_IEEE80211_MCS11 */
literal|156
block|,
comment|/* IFM_IEEE80211_MCS12 */
literal|208
block|,
comment|/* IFM_IEEE80211_MCS13 */
literal|234
block|,
comment|/* IFM_IEEE80211_MCS14 */
literal|260
block|,
comment|/* IFM_IEEE80211_MCS15 */
block|}
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|int
name|get80211
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|type
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
name|int
name|len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|get80211len
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|type
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
name|int
name|len
parameter_list|,
name|int
modifier|*
name|plen
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|get80211val
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|type
parameter_list|,
name|int
modifier|*
name|val
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|set80211
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|type
parameter_list|,
name|int
name|val
parameter_list|,
name|int
name|len
parameter_list|,
name|void
modifier|*
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|const
name|char
modifier|*
name|get_string
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
specifier|const
name|char
modifier|*
name|sep
parameter_list|,
name|u_int8_t
modifier|*
name|buf
parameter_list|,
name|int
modifier|*
name|lenp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_string
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|struct
name|ieee80211req_chaninfo
name|chaninfo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|ifmediareq
modifier|*
name|ifmr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|ieee80211_channel
name|curchan
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|gotcurchan
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|htconf
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|gothtconf
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|gethtconf
parameter_list|(
name|int
name|s
parameter_list|)
block|{
if|if
condition|(
name|gothtconf
condition|)
return|return;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_HTCONF
argument_list|,
operator|&
name|htconf
argument_list|)
operator|<
literal|0
condition|)
name|warn
argument_list|(
literal|"unable to get HT configuration information"
argument_list|)
expr_stmt|;
name|gothtconf
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Collect channel info from the kernel.  We use this (mostly)  * to handle mapping between frequency and IEEE channel number.  */
end_comment

begin_function
specifier|static
name|void
name|getchaninfo
parameter_list|(
name|int
name|s
parameter_list|)
block|{
if|if
condition|(
name|chaninfo
operator|.
name|ic_nchans
operator|!=
literal|0
condition|)
return|return;
if|if
condition|(
name|get80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_CHANINFO
argument_list|,
operator|&
name|chaninfo
argument_list|,
sizeof|sizeof
argument_list|(
name|chaninfo
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unable to get channel information"
argument_list|)
expr_stmt|;
name|ifmr
operator|=
name|ifmedia_getstate
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|gethtconf
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Given the channel at index i with attributes from,  * check if there is a channel with attributes to in  * the channel table.  With suitable attributes this  * allows the caller to look for promotion; e.g. from  * 11b> 11g.  */
end_comment

begin_function
specifier|static
name|int
name|canpromote
parameter_list|(
name|int
name|i
parameter_list|,
name|int
name|from
parameter_list|,
name|int
name|to
parameter_list|)
block|{
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|fc
init|=
operator|&
name|chaninfo
operator|.
name|ic_chans
index|[
name|i
index|]
decl_stmt|;
name|int
name|j
decl_stmt|;
if|if
condition|(
operator|(
name|fc
operator|->
name|ic_flags
operator|&
name|from
operator|)
operator|!=
name|from
condition|)
return|return
name|i
return|;
comment|/* NB: quick check exploiting ordering of chans w/ same frequency */
if|if
condition|(
name|i
operator|+
literal|1
operator|<
name|chaninfo
operator|.
name|ic_nchans
operator|&&
name|chaninfo
operator|.
name|ic_chans
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|ic_freq
operator|==
name|fc
operator|->
name|ic_freq
operator|&&
operator|(
name|chaninfo
operator|.
name|ic_chans
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|ic_flags
operator|&
name|to
operator|)
operator|==
name|to
condition|)
return|return
name|i
operator|+
literal|1
return|;
comment|/* brute force search in case channel list is not ordered */
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|chaninfo
operator|.
name|ic_nchans
condition|;
name|j
operator|++
control|)
block|{
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|tc
init|=
operator|&
name|chaninfo
operator|.
name|ic_chans
index|[
name|j
index|]
decl_stmt|;
if|if
condition|(
name|j
operator|!=
name|i
operator|&&
name|tc
operator|->
name|ic_freq
operator|==
name|fc
operator|->
name|ic_freq
operator|&&
operator|(
name|tc
operator|->
name|ic_flags
operator|&
name|to
operator|)
operator|==
name|to
condition|)
return|return
name|j
return|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_comment
comment|/*  * Handle channel promotion.  When a channel is specified with  * only a frequency we want to promote it to the ``best'' channel  * available.  The channel list has separate entries for 11b, 11g,  * 11a, and 11n[ga] channels so specifying a frequency w/o any  * attributes requires we upgrade, e.g. from 11b -> 11g.  This  * gets complicated when the channel is specified on the same  * command line with a media request that constrains the available  * channe list (e.g. mode 11a); we want to honor that to avoid  * confusing behaviour.  */
end_comment

begin_function
specifier|static
name|int
name|promote
parameter_list|(
name|int
name|i
parameter_list|)
block|{
comment|/* 	 * Query the current mode of the interface in case it's 	 * constrained (e.g. to 11a).  We must do this carefully 	 * as there may be a pending ifmedia request in which case 	 * asking the kernel will give us the wrong answer.  This 	 * is an unfortunate side-effect of the way ifconfig is 	 * structure for modularity (yech). 	 * 	 * NB: ifmr is actually setup in getchaninfo (above); we 	 *     assume it's called coincident with to this call so 	 *     we have a ``current setting''; otherwise we must pass 	 *     the socket descriptor down to here so we can make 	 *     the ifmedia_getstate call ourselves. 	 */
name|int
name|chanmode
init|=
name|ifmr
operator|!=
name|NULL
condition|?
name|IFM_MODE
argument_list|(
name|ifmr
operator|->
name|ifm_current
argument_list|)
else|:
name|IFM_AUTO
decl_stmt|;
comment|/* when ambiguous promote to ``best'' */
comment|/* NB: we abitrarily pick HT40+ over HT40- */
if|if
condition|(
name|chanmode
operator|!=
name|IFM_IEEE80211_11B
condition|)
name|i
operator|=
name|canpromote
argument_list|(
name|i
argument_list|,
name|IEEE80211_CHAN_B
argument_list|,
name|IEEE80211_CHAN_G
argument_list|)
expr_stmt|;
if|if
condition|(
name|chanmode
operator|!=
name|IFM_IEEE80211_11G
operator|&&
operator|(
name|htconf
operator|&
literal|1
operator|)
condition|)
block|{
name|i
operator|=
name|canpromote
argument_list|(
name|i
argument_list|,
name|IEEE80211_CHAN_G
argument_list|,
name|IEEE80211_CHAN_G
operator||
name|IEEE80211_CHAN_HT20
argument_list|)
expr_stmt|;
if|if
condition|(
name|htconf
operator|&
literal|2
condition|)
block|{
name|i
operator|=
name|canpromote
argument_list|(
name|i
argument_list|,
name|IEEE80211_CHAN_G
argument_list|,
name|IEEE80211_CHAN_G
operator||
name|IEEE80211_CHAN_HT40D
argument_list|)
expr_stmt|;
name|i
operator|=
name|canpromote
argument_list|(
name|i
argument_list|,
name|IEEE80211_CHAN_G
argument_list|,
name|IEEE80211_CHAN_G
operator||
name|IEEE80211_CHAN_HT40U
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|chanmode
operator|!=
name|IFM_IEEE80211_11A
operator|&&
operator|(
name|htconf
operator|&
literal|1
operator|)
condition|)
block|{
name|i
operator|=
name|canpromote
argument_list|(
name|i
argument_list|,
name|IEEE80211_CHAN_A
argument_list|,
name|IEEE80211_CHAN_A
operator||
name|IEEE80211_CHAN_HT20
argument_list|)
expr_stmt|;
if|if
condition|(
name|htconf
operator|&
literal|2
condition|)
block|{
name|i
operator|=
name|canpromote
argument_list|(
name|i
argument_list|,
name|IEEE80211_CHAN_A
argument_list|,
name|IEEE80211_CHAN_A
operator||
name|IEEE80211_CHAN_HT40D
argument_list|)
expr_stmt|;
name|i
operator|=
name|canpromote
argument_list|(
name|i
argument_list|,
name|IEEE80211_CHAN_A
argument_list|,
name|IEEE80211_CHAN_A
operator||
name|IEEE80211_CHAN_HT40U
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|i
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|mapfreq
parameter_list|(
name|struct
name|ieee80211_channel
modifier|*
name|chan
parameter_list|,
name|int
name|freq
parameter_list|,
name|int
name|flags
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|chaninfo
operator|.
name|ic_nchans
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|c
init|=
operator|&
name|chaninfo
operator|.
name|ic_chans
index|[
name|i
index|]
decl_stmt|;
if|if
condition|(
name|c
operator|->
name|ic_freq
operator|==
name|freq
operator|&&
operator|(
name|c
operator|->
name|ic_flags
operator|&
name|flags
operator|)
operator|==
name|flags
condition|)
block|{
if|if
condition|(
name|flags
operator|==
literal|0
condition|)
block|{
comment|/* when ambiguous promote to ``best'' */
name|c
operator|=
operator|&
name|chaninfo
operator|.
name|ic_chans
index|[
name|promote
argument_list|(
name|i
argument_list|)
index|]
expr_stmt|;
block|}
operator|*
name|chan
operator|=
operator|*
name|c
expr_stmt|;
return|return;
block|}
block|}
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown/undefined frequency %u/0x%x"
argument_list|,
name|freq
argument_list|,
name|flags
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|mapchan
parameter_list|(
name|struct
name|ieee80211_channel
modifier|*
name|chan
parameter_list|,
name|int
name|ieee
parameter_list|,
name|int
name|flags
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|chaninfo
operator|.
name|ic_nchans
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|c
init|=
operator|&
name|chaninfo
operator|.
name|ic_chans
index|[
name|i
index|]
decl_stmt|;
if|if
condition|(
name|c
operator|->
name|ic_ieee
operator|==
name|ieee
operator|&&
operator|(
name|c
operator|->
name|ic_flags
operator|&
name|flags
operator|)
operator|==
name|flags
condition|)
block|{
if|if
condition|(
name|flags
operator|==
literal|0
condition|)
block|{
comment|/* when ambiguous promote to ``best'' */
name|c
operator|=
operator|&
name|chaninfo
operator|.
name|ic_chans
index|[
name|promote
argument_list|(
name|i
argument_list|)
index|]
expr_stmt|;
block|}
operator|*
name|chan
operator|=
operator|*
name|c
expr_stmt|;
return|return;
block|}
block|}
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown/undefined channel number %d flags 0x%x"
argument_list|,
name|ieee
argument_list|,
name|flags
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|getcurchan
parameter_list|(
name|int
name|s
parameter_list|)
block|{
if|if
condition|(
name|gotcurchan
condition|)
return|return
operator|&
name|curchan
return|;
if|if
condition|(
name|get80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_CURCHAN
argument_list|,
operator|&
name|curchan
argument_list|,
sizeof|sizeof
argument_list|(
name|curchan
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
block|{
name|int
name|val
decl_stmt|;
comment|/* fall back to legacy ioctl */
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_CHANNEL
argument_list|,
operator|&
name|val
argument_list|)
operator|<
literal|0
condition|)
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"cannot figure out current channel"
argument_list|)
expr_stmt|;
name|getchaninfo
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|mapchan
argument_list|(
operator|&
name|curchan
argument_list|,
name|val
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|gotcurchan
operator|=
literal|1
expr_stmt|;
return|return
operator|&
name|curchan
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ieee80211_mhz2ieee
parameter_list|(
name|int
name|freq
parameter_list|,
name|int
name|flags
parameter_list|)
block|{
name|struct
name|ieee80211_channel
name|chan
decl_stmt|;
name|mapfreq
argument_list|(
operator|&
name|chan
argument_list|,
name|freq
argument_list|,
name|flags
argument_list|)
expr_stmt|;
return|return
name|chan
operator|.
name|ic_ieee
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|isanyarg
parameter_list|(
specifier|const
name|char
modifier|*
name|arg
parameter_list|)
block|{
return|return
operator|(
name|strncmp
argument_list|(
name|arg
argument_list|,
literal|"-"
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
operator|||
name|strncasecmp
argument_list|(
name|arg
argument_list|,
literal|"any"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
operator|||
name|strncasecmp
argument_list|(
name|arg
argument_list|,
literal|"off"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211ssid
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|int
name|ssid
decl_stmt|;
name|int
name|len
decl_stmt|;
name|u_int8_t
name|data
index|[
name|IEEE80211_NWID_LEN
index|]
decl_stmt|;
name|ssid
operator|=
literal|0
expr_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
literal|2
operator|&&
name|isdigit
argument_list|(
name|val
index|[
literal|0
index|]
argument_list|)
operator|&&
name|val
index|[
literal|1
index|]
operator|==
literal|':'
condition|)
block|{
name|ssid
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
operator|-
literal|1
expr_stmt|;
name|val
operator|+=
literal|2
expr_stmt|;
block|}
name|bzero
argument_list|(
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|len
operator|=
sizeof|sizeof
argument_list|(
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|get_string
argument_list|(
name|val
argument_list|,
name|NULL
argument_list|,
name|data
argument_list|,
operator|&
name|len
argument_list|)
operator|==
name|NULL
condition|)
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_SSID
argument_list|,
name|ssid
argument_list|,
name|len
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211stationname
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|int
name|len
decl_stmt|;
name|u_int8_t
name|data
index|[
literal|33
index|]
decl_stmt|;
name|bzero
argument_list|(
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|len
operator|=
sizeof|sizeof
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|get_string
argument_list|(
name|val
argument_list|,
name|NULL
argument_list|,
name|data
argument_list|,
operator|&
name|len
argument_list|)
expr_stmt|;
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_STATIONNAME
argument_list|,
literal|0
argument_list|,
name|len
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Parse a channel specification for attributes/flags.  * The syntax is:  *	freq/xx		channel width (5,10,20,40,40+,40-)  *	freq:mode	channel mode (a,b,g,h,n,t,s,d)  *  * These can be combined in either order; e.g. 2437:ng/40.  * Modes are case insensitive.  *  * The result is not validated here; it's assumed to be  * checked against the channel table fetched from the kernel.  */
end_comment

begin_function
specifier|static
name|int
name|getchannelflags
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|freq
parameter_list|)
block|{
define|#
directive|define
name|_CHAN_HT
value|0x80000000
specifier|const
name|char
modifier|*
name|cp
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|flags
operator|=
literal|0
expr_stmt|;
name|cp
operator|=
name|strchr
argument_list|(
name|val
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|cp
operator|!=
name|NULL
condition|)
block|{
for|for
control|(
name|cp
operator|++
init|;
name|isalpha
argument_list|(
operator|(
name|int
operator|)
operator|*
name|cp
argument_list|)
condition|;
name|cp
operator|++
control|)
block|{
comment|/* accept mixed case */
name|int
name|c
init|=
operator|*
name|cp
decl_stmt|;
if|if
condition|(
name|isupper
argument_list|(
name|c
argument_list|)
condition|)
name|c
operator|=
name|tolower
argument_list|(
name|c
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'a'
case|:
comment|/* 802.11a */
name|flags
operator||=
name|IEEE80211_CHAN_A
expr_stmt|;
break|break;
case|case
literal|'b'
case|:
comment|/* 802.11b */
name|flags
operator||=
name|IEEE80211_CHAN_B
expr_stmt|;
break|break;
case|case
literal|'g'
case|:
comment|/* 802.11g */
name|flags
operator||=
name|IEEE80211_CHAN_G
expr_stmt|;
break|break;
case|case
literal|'h'
case|:
comment|/* ht = 802.11n */
case|case
literal|'n'
case|:
comment|/* 802.11n */
name|flags
operator||=
name|_CHAN_HT
expr_stmt|;
comment|/* NB: private */
break|break;
case|case
literal|'d'
case|:
comment|/* dt = Atheros Dynamic Turbo */
name|flags
operator||=
name|IEEE80211_CHAN_TURBO
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
comment|/* ht, dt, st, t */
comment|/* dt and unadorned t specify Dynamic Turbo */
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
name|IEEE80211_CHAN_STURBO
operator||
name|_CHAN_HT
operator|)
operator|)
operator|==
literal|0
condition|)
name|flags
operator||=
name|IEEE80211_CHAN_TURBO
expr_stmt|;
break|break;
case|case
literal|'s'
case|:
comment|/* st = Atheros Static Turbo */
name|flags
operator||=
name|IEEE80211_CHAN_STURBO
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"%s: Invalid channel attribute %c\n"
argument_list|,
name|val
argument_list|,
operator|*
name|cp
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|cp
operator|=
name|strchr
argument_list|(
name|val
argument_list|,
literal|'/'
argument_list|)
expr_stmt|;
if|if
condition|(
name|cp
operator|!=
name|NULL
condition|)
block|{
name|char
modifier|*
name|ep
decl_stmt|;
name|u_long
name|cw
init|=
name|strtoul
argument_list|(
name|cp
operator|+
literal|1
argument_list|,
operator|&
name|ep
argument_list|,
literal|10
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|cw
condition|)
block|{
case|case
literal|5
case|:
name|flags
operator||=
name|IEEE80211_CHAN_QUARTER
expr_stmt|;
break|break;
case|case
literal|10
case|:
name|flags
operator||=
name|IEEE80211_CHAN_HALF
expr_stmt|;
break|break;
case|case
literal|20
case|:
comment|/* NB: this may be removed below */
name|flags
operator||=
name|IEEE80211_CHAN_HT20
expr_stmt|;
break|break;
case|case
literal|40
case|:
if|if
condition|(
name|ep
operator|!=
name|NULL
operator|&&
operator|*
name|ep
operator|==
literal|'+'
condition|)
name|flags
operator||=
name|IEEE80211_CHAN_HT40U
expr_stmt|;
elseif|else
if|if
condition|(
name|ep
operator|!=
name|NULL
operator|&&
operator|*
name|ep
operator|==
literal|'-'
condition|)
name|flags
operator||=
name|IEEE80211_CHAN_HT40D
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"%s: Invalid channel width\n"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* 	 * Cleanup specifications. 	 */
if|if
condition|(
operator|(
name|flags
operator|&
name|_CHAN_HT
operator|)
operator|==
literal|0
condition|)
block|{
comment|/* 		 * If user specified freq/20 or freq/40 quietly remove 		 * HT cw attributes depending on channel use.  To give 		 * an explicit 20/40 width for an HT channel you must 		 * indicate it is an HT channel since all HT channels 		 * are also usable for legacy operation; e.g. freq:n/40. 		 */
name|flags
operator|&=
operator|~
name|IEEE80211_CHAN_HT
expr_stmt|;
block|}
else|else
block|{
comment|/* 		 * Remove private indicator that this is an HT channel 		 * and if no explicit channel width has been given 		 * provide the default settings. 		 */
name|flags
operator|&=
operator|~
name|_CHAN_HT
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
name|IEEE80211_CHAN_HT
operator|)
operator|==
literal|0
condition|)
block|{
name|struct
name|ieee80211_channel
name|chan
decl_stmt|;
comment|/* 			 * Consult the channel list to see if we can use 			 * HT40+ or HT40- (if both the map routines choose). 			 */
if|if
condition|(
name|freq
operator|>
literal|255
condition|)
name|mapfreq
argument_list|(
operator|&
name|chan
argument_list|,
name|freq
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
name|mapchan
argument_list|(
operator|&
name|chan
argument_list|,
name|freq
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|flags
operator||=
operator|(
name|chan
operator|.
name|ic_flags
operator|&
name|IEEE80211_CHAN_HT
operator|)
expr_stmt|;
block|}
block|}
return|return
name|flags
return|;
undef|#
directive|undef
name|_CHAN_HT
block|}
end_function

begin_function
specifier|static
name|void
name|set80211channel
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|struct
name|ieee80211_channel
name|chan
decl_stmt|;
name|memset
argument_list|(
operator|&
name|chan
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|chan
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isanyarg
argument_list|(
name|val
argument_list|)
condition|)
block|{
name|int
name|v
decl_stmt|,
name|flags
decl_stmt|;
name|getchaninfo
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|v
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
expr_stmt|;
name|flags
operator|=
name|getchannelflags
argument_list|(
name|val
argument_list|,
name|v
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|255
condition|)
block|{
comment|/* treat as frequency */
name|mapfreq
argument_list|(
operator|&
name|chan
argument_list|,
name|v
argument_list|,
name|flags
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|mapchan
argument_list|(
operator|&
name|chan
argument_list|,
name|v
argument_list|,
name|flags
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|chan
operator|.
name|ic_freq
operator|=
name|IEEE80211_CHAN_ANY
expr_stmt|;
block|}
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_CURCHAN
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|chan
argument_list|)
argument_list|,
operator|&
name|chan
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211authmode
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|int
name|mode
decl_stmt|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"none"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_AUTH_NONE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"open"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_AUTH_OPEN
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"shared"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_AUTH_SHARED
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"8021x"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_AUTH_8021X
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"wpa"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_AUTH_WPA
expr_stmt|;
block|}
else|else
block|{
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown authmode"
argument_list|)
expr_stmt|;
block|}
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AUTHMODE
argument_list|,
name|mode
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211powersavemode
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|int
name|mode
decl_stmt|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"off"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_POWERSAVE_OFF
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_POWERSAVE_ON
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"cam"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_POWERSAVE_CAM
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"psp"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_POWERSAVE_PSP
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"psp-cam"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_POWERSAVE_PSP_CAM
expr_stmt|;
block|}
else|else
block|{
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown powersavemode"
argument_list|)
expr_stmt|;
block|}
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_POWERSAVE
argument_list|,
name|mode
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211powersave
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
if|if
condition|(
name|d
operator|==
literal|0
condition|)
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_POWERSAVE
argument_list|,
name|IEEE80211_POWERSAVE_OFF
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
else|else
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_POWERSAVE
argument_list|,
name|IEEE80211_POWERSAVE_ON
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211powersavesleep
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_POWERSAVESLEEP
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211wepmode
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|int
name|mode
decl_stmt|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"off"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_WEP_OFF
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_WEP_ON
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"mixed"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_WEP_MIXED
expr_stmt|;
block|}
else|else
block|{
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown wep mode"
argument_list|)
expr_stmt|;
block|}
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEP
argument_list|,
name|mode
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211wep
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEP
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|isundefarg
parameter_list|(
specifier|const
name|char
modifier|*
name|arg
parameter_list|)
block|{
return|return
operator|(
name|strcmp
argument_list|(
name|arg
argument_list|,
literal|"-"
argument_list|)
operator|==
literal|0
operator|||
name|strncasecmp
argument_list|(
name|arg
argument_list|,
literal|"undef"
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211weptxkey
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
if|if
condition|(
name|isundefarg
argument_list|(
name|val
argument_list|)
condition|)
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEPTXKEY
argument_list|,
name|IEEE80211_KEYIX_NONE
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
else|else
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEPTXKEY
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
operator|-
literal|1
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211wepkey
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|int
name|key
init|=
literal|0
decl_stmt|;
name|int
name|len
decl_stmt|;
name|u_int8_t
name|data
index|[
name|IEEE80211_KEYBUF_SIZE
index|]
decl_stmt|;
if|if
condition|(
name|isdigit
argument_list|(
name|val
index|[
literal|0
index|]
argument_list|)
operator|&&
name|val
index|[
literal|1
index|]
operator|==
literal|':'
condition|)
block|{
name|key
operator|=
name|atoi
argument_list|(
name|val
argument_list|)
operator|-
literal|1
expr_stmt|;
name|val
operator|+=
literal|2
expr_stmt|;
block|}
name|bzero
argument_list|(
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|len
operator|=
sizeof|sizeof
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|get_string
argument_list|(
name|val
argument_list|,
name|NULL
argument_list|,
name|data
argument_list|,
operator|&
name|len
argument_list|)
expr_stmt|;
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEPKEY
argument_list|,
name|key
argument_list|,
name|len
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * This function is purely a NetBSD compatability interface.  The NetBSD  * interface is too inflexible, but it's there so we'll support it since  * it's not all that hard.  */
end_comment

begin_function
specifier|static
name|void
name|set80211nwkey
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|int
name|txkey
decl_stmt|;
name|int
name|i
decl_stmt|,
name|len
decl_stmt|;
name|u_int8_t
name|data
index|[
name|IEEE80211_KEYBUF_SIZE
index|]
decl_stmt|;
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEP
argument_list|,
name|IEEE80211_WEP_ON
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|isdigit
argument_list|(
name|val
index|[
literal|0
index|]
argument_list|)
operator|&&
name|val
index|[
literal|1
index|]
operator|==
literal|':'
condition|)
block|{
name|txkey
operator|=
name|val
index|[
literal|0
index|]
operator|-
literal|'0'
operator|-
literal|1
expr_stmt|;
name|val
operator|+=
literal|2
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|bzero
argument_list|(
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|len
operator|=
sizeof|sizeof
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|val
operator|=
name|get_string
argument_list|(
name|val
argument_list|,
literal|","
argument_list|,
name|data
argument_list|,
operator|&
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|==
name|NULL
condition|)
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEPKEY
argument_list|,
name|i
argument_list|,
name|len
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|bzero
argument_list|(
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|len
operator|=
sizeof|sizeof
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|get_string
argument_list|(
name|val
argument_list|,
name|NULL
argument_list|,
name|data
argument_list|,
operator|&
name|len
argument_list|)
expr_stmt|;
name|txkey
operator|=
literal|0
expr_stmt|;
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEPKEY
argument_list|,
literal|0
argument_list|,
name|len
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|bzero
argument_list|(
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEPKEY
argument_list|,
name|i
argument_list|,
literal|0
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEPTXKEY
argument_list|,
name|txkey
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211rtsthreshold
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_RTSTHRESHOLD
argument_list|,
name|isundefarg
argument_list|(
name|val
argument_list|)
condition|?
name|IEEE80211_RTS_MAX
else|:
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211protmode
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|int
name|mode
decl_stmt|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"off"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_PROTMODE_OFF
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"cts"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_PROTMODE_CTS
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strncasecmp
argument_list|(
name|val
argument_list|,
literal|"rtscts"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_PROTMODE_RTSCTS
expr_stmt|;
block|}
else|else
block|{
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown protection mode"
argument_list|)
expr_stmt|;
block|}
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_PROTMODE
argument_list|,
name|mode
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211htprotmode
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|int
name|mode
decl_stmt|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"off"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_PROTMODE_OFF
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strncasecmp
argument_list|(
name|val
argument_list|,
literal|"rts"
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_PROTMODE_RTSCTS
expr_stmt|;
block|}
else|else
block|{
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown protection mode"
argument_list|)
expr_stmt|;
block|}
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_HTPROTMODE
argument_list|,
name|mode
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211txpower
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|double
name|v
init|=
name|atof
argument_list|(
name|val
argument_list|)
decl_stmt|;
name|int
name|txpow
decl_stmt|;
name|txpow
operator|=
call|(
name|int
call|)
argument_list|(
literal|2
operator|*
name|v
argument_list|)
expr_stmt|;
if|if
condition|(
name|txpow
operator|!=
literal|2
operator|*
name|v
condition|)
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"invalid tx power (must be .5 dBm units)"
argument_list|)
expr_stmt|;
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_TXPOWER
argument_list|,
name|txpow
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|IEEE80211_ROAMING_DEVICE
value|0
end_define

begin_define
define|#
directive|define
name|IEEE80211_ROAMING_AUTO
value|1
end_define

begin_define
define|#
directive|define
name|IEEE80211_ROAMING_MANUAL
value|2
end_define

begin_function
specifier|static
name|void
name|set80211roaming
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|int
name|mode
decl_stmt|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"device"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_ROAMING_DEVICE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"auto"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_ROAMING_AUTO
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|val
argument_list|,
literal|"manual"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mode
operator|=
name|IEEE80211_ROAMING_MANUAL
expr_stmt|;
block|}
else|else
block|{
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown roaming mode"
argument_list|)
expr_stmt|;
block|}
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAMING
argument_list|,
name|mode
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211wme
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211hidessid
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_HIDESSID
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211apbridge
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_APBRIDGE
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211fastframes
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_FF
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211dturbo
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_TURBOP
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211chanlist
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|struct
name|ieee80211req_chanlist
name|chanlist
decl_stmt|;
define|#
directive|define
name|MAXCHAN
value|(sizeof(chanlist.ic_channels)*NBBY)
name|char
modifier|*
name|temp
decl_stmt|,
modifier|*
name|cp
decl_stmt|,
modifier|*
name|tp
decl_stmt|;
name|temp
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|val
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|temp
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"malloc failed"
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|temp
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|chanlist
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|chanlist
argument_list|)
argument_list|)
expr_stmt|;
name|cp
operator|=
name|temp
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|int
name|first
decl_stmt|,
name|last
decl_stmt|,
name|f
decl_stmt|,
name|c
decl_stmt|;
name|tp
operator|=
name|strchr
argument_list|(
name|cp
argument_list|,
literal|','
argument_list|)
expr_stmt|;
if|if
condition|(
name|tp
operator|!=
name|NULL
condition|)
operator|*
name|tp
operator|++
operator|=
literal|'\0'
expr_stmt|;
switch|switch
condition|(
name|sscanf
argument_list|(
name|cp
argument_list|,
literal|"%u-%u"
argument_list|,
operator|&
name|first
argument_list|,
operator|&
name|last
argument_list|)
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|first
operator|>
name|MAXCHAN
condition|)
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"channel %u out of range, max %zu"
argument_list|,
name|first
argument_list|,
name|MAXCHAN
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|chanlist
operator|.
name|ic_channels
argument_list|,
name|first
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
if|if
condition|(
name|first
operator|>
name|MAXCHAN
condition|)
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"channel %u out of range, max %zu"
argument_list|,
name|first
argument_list|,
name|MAXCHAN
argument_list|)
expr_stmt|;
if|if
condition|(
name|last
operator|>
name|MAXCHAN
condition|)
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"channel %u out of range, max %zu"
argument_list|,
name|last
argument_list|,
name|MAXCHAN
argument_list|)
expr_stmt|;
if|if
condition|(
name|first
operator|>
name|last
condition|)
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"void channel range, %u> %u"
argument_list|,
name|first
argument_list|,
name|last
argument_list|)
expr_stmt|;
for|for
control|(
name|f
operator|=
name|first
init|;
name|f
operator|<=
name|last
condition|;
name|f
operator|++
control|)
name|setbit
argument_list|(
name|chanlist
operator|.
name|ic_channels
argument_list|,
name|f
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|tp
operator|==
name|NULL
condition|)
break|break;
name|c
operator|=
operator|*
name|tp
expr_stmt|;
while|while
condition|(
name|isspace
argument_list|(
name|c
argument_list|)
condition|)
name|tp
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|isdigit
argument_list|(
name|c
argument_list|)
condition|)
break|break;
name|cp
operator|=
name|tp
expr_stmt|;
block|}
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_CHANLIST
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|chanlist
argument_list|)
argument_list|,
operator|&
name|chanlist
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|MAXCHAN
block|}
end_function

begin_function
specifier|static
name|void
name|set80211bssid
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
if|if
condition|(
operator|!
name|isanyarg
argument_list|(
name|val
argument_list|)
condition|)
block|{
name|char
modifier|*
name|temp
decl_stmt|;
name|struct
name|sockaddr_dl
name|sdl
decl_stmt|;
name|temp
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|val
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
comment|/* ':' and '\0' */
if|if
condition|(
name|temp
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"malloc failed"
argument_list|)
expr_stmt|;
name|temp
index|[
literal|0
index|]
operator|=
literal|':'
expr_stmt|;
name|strcpy
argument_list|(
name|temp
operator|+
literal|1
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|sdl
operator|.
name|sdl_len
operator|=
sizeof|sizeof
argument_list|(
name|sdl
argument_list|)
expr_stmt|;
name|link_addr
argument_list|(
name|temp
argument_list|,
operator|&
name|sdl
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|temp
argument_list|)
expr_stmt|;
if|if
condition|(
name|sdl
operator|.
name|sdl_alen
operator|!=
name|IEEE80211_ADDR_LEN
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"malformed link-level address"
argument_list|)
expr_stmt|;
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BSSID
argument_list|,
literal|0
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|,
name|LLADDR
argument_list|(
operator|&
name|sdl
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|uint8_t
name|zerobssid
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|memset
argument_list|(
name|zerobssid
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|zerobssid
argument_list|)
argument_list|)
expr_stmt|;
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BSSID
argument_list|,
literal|0
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|,
name|zerobssid
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|getac
parameter_list|(
specifier|const
name|char
modifier|*
name|ac
parameter_list|)
block|{
if|if
condition|(
name|strcasecmp
argument_list|(
name|ac
argument_list|,
literal|"ac_be"
argument_list|)
operator|==
literal|0
operator|||
name|strcasecmp
argument_list|(
name|ac
argument_list|,
literal|"be"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|WME_AC_BE
return|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|ac
argument_list|,
literal|"ac_bk"
argument_list|)
operator|==
literal|0
operator|||
name|strcasecmp
argument_list|(
name|ac
argument_list|,
literal|"bk"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|WME_AC_BK
return|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|ac
argument_list|,
literal|"ac_vi"
argument_list|)
operator|==
literal|0
operator|||
name|strcasecmp
argument_list|(
name|ac
argument_list|,
literal|"vi"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|WME_AC_VI
return|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|ac
argument_list|,
literal|"ac_vo"
argument_list|)
operator|==
literal|0
operator|||
name|strcasecmp
argument_list|(
name|ac
argument_list|,
literal|"vo"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|WME_AC_VO
return|;
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown wme access class %s"
argument_list|,
name|ac
argument_list|)
expr_stmt|;
block|}
end_function

begin_expr_stmt
specifier|static
name|DECL_CMD_FUNC2
argument_list|(
argument|set80211cwmin
argument_list|,
argument|ac
argument_list|,
argument|val
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_CWMIN
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC2
argument_list|(
argument|set80211cwmax
argument_list|,
argument|ac
argument_list|,
argument|val
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_CWMAX
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC2
argument_list|(
argument|set80211aifs
argument_list|,
argument|ac
argument_list|,
argument|val
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_AIFS
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC2
argument_list|(
argument|set80211txoplimit
argument_list|,
argument|ac
argument_list|,
argument|val
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_TXOPLIMIT
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211acm
argument_list|,
argument|ac
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_ACM
argument_list|,
literal|1
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211noacm
argument_list|,
argument|ac
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_ACM
argument_list|,
literal|0
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211ackpolicy
argument_list|,
argument|ac
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_ACKPOLICY
argument_list|,
literal|1
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211noackpolicy
argument_list|,
argument|ac
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_ACKPOLICY
argument_list|,
literal|0
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC2
argument_list|(
argument|set80211bsscwmin
argument_list|,
argument|ac
argument_list|,
argument|val
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_CWMIN
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
operator||
name|IEEE80211_WMEPARAM_BSS
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC2
argument_list|(
argument|set80211bsscwmax
argument_list|,
argument|ac
argument_list|,
argument|val
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_CWMAX
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
operator||
name|IEEE80211_WMEPARAM_BSS
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC2
argument_list|(
argument|set80211bssaifs
argument_list|,
argument|ac
argument_list|,
argument|val
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_AIFS
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
operator||
name|IEEE80211_WMEPARAM_BSS
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC2
argument_list|(
argument|set80211bsstxoplimit
argument_list|,
argument|ac
argument_list|,
argument|val
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_TXOPLIMIT
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
name|getac
argument_list|(
name|ac
argument_list|)
operator||
name|IEEE80211_WMEPARAM_BSS
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211dtimperiod
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_DTIM_PERIOD
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211bintval
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BEACON_INTERVAL
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|void
name|set80211macmac
argument_list|(
argument|int s
argument_list|,
argument|int op
argument_list|,
argument|const char *val
argument_list|)
block|{
name|char
operator|*
name|temp
block|; 	struct
name|sockaddr_dl
name|sdl
block|;
name|temp
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|val
argument_list|)
operator|+
literal|2
argument_list|)
block|;
comment|/* ':' and '\0' */
if|if
condition|(
name|temp
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"malloc failed"
argument_list|)
expr_stmt|;
name|temp
index|[
literal|0
index|]
operator|=
literal|':'
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|strcpy
argument_list|(
name|temp
operator|+
literal|1
argument_list|,
name|val
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|sdl
operator|.
name|sdl_len
operator|=
sizeof|sizeof
argument_list|(
name|sdl
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|link_addr
argument_list|(
name|temp
argument_list|,
operator|&
name|sdl
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|free
argument_list|(
name|temp
argument_list|)
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|sdl
operator|.
name|sdl_alen
operator|!=
name|IEEE80211_ADDR_LEN
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"malformed link-level address"
argument_list|)
expr_stmt|;
end_if

begin_expr_stmt
name|set80211
argument_list|(
name|s
argument_list|,
name|op
argument_list|,
literal|0
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|,
name|LLADDR
argument_list|(
operator|&
name|sdl
argument_list|)
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
unit|}  static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211addmac
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
end_macro

begin_block
block|{
name|set80211macmac
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ADDMAC
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211delmac
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211macmac
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_DELMAC
argument_list|,
name|val
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211kickmac
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|char
operator|*
name|temp
block|; 	struct
name|sockaddr_dl
name|sdl
block|; 	struct
name|ieee80211req_mlme
name|mlme
block|;
name|temp
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|val
argument_list|)
operator|+
literal|2
argument_list|)
block|;
comment|/* ':' and '\0' */
if|if
condition|(
name|temp
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"malloc failed"
argument_list|)
expr_stmt|;
name|temp
index|[
literal|0
index|]
operator|=
literal|':'
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|strcpy
argument_list|(
name|temp
operator|+
literal|1
argument_list|,
name|val
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|sdl
operator|.
name|sdl_len
operator|=
sizeof|sizeof
argument_list|(
name|sdl
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|link_addr
argument_list|(
name|temp
argument_list|,
operator|&
name|sdl
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|free
argument_list|(
name|temp
argument_list|)
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|sdl
operator|.
name|sdl_alen
operator|!=
name|IEEE80211_ADDR_LEN
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"malformed link-level address"
argument_list|)
expr_stmt|;
end_if

begin_expr_stmt
name|memset
argument_list|(
operator|&
name|mlme
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|mlme
argument_list|)
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|mlme
operator|.
name|im_op
operator|=
name|IEEE80211_MLME_DEAUTH
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|mlme
operator|.
name|im_reason
operator|=
name|IEEE80211_REASON_AUTH_EXPIRE
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|memcpy
argument_list|(
name|mlme
operator|.
name|im_macaddr
argument_list|,
name|LLADDR
argument_list|(
operator|&
name|sdl
argument_list|)
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_MLME
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|mlme
argument_list|)
argument_list|,
operator|&
name|mlme
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
unit|}  static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211maccmd
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
end_macro

begin_block
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_MACCMD
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
specifier|static
name|void
name|set80211pureg
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_PUREG
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211bgscan
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BGSCAN
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_expr_stmt
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211bgscanidle
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BGSCAN_IDLE
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211bgscanintvl
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BGSCAN_INTERVAL
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211scanvalid
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_SCANVALID
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211roamrssi11a
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RSSI_11A
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211roamrssi11b
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RSSI_11B
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211roamrssi11g
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RSSI_11G
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211roamrate11a
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RATE_11A
argument_list|,
literal|2
operator|*
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211roamrate11b
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RATE_11B
argument_list|,
literal|2
operator|*
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211roamrate11g
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RATE_11G
argument_list|,
literal|2
operator|*
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211mcastrate
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_MCAST_RATE
argument_list|,
literal|2
operator|*
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211fragthreshold
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_FRAGTHRESHOLD
argument_list|,
name|isundefarg
argument_list|(
name|val
argument_list|)
operator|?
name|IEEE80211_FRAG_MAX
operator|:
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211bmissthreshold
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BMISSTHRESHOLD
argument_list|,
name|isundefarg
argument_list|(
name|val
argument_list|)
condition|?
name|IEEE80211_HWBMISS_MAX
else|:
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|void
name|set80211burst
argument_list|(
argument|const char *val
argument_list|,
argument|int d
argument_list|,
argument|int s
argument_list|,
argument|const struct afswtch *rafp
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BURST
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|void
name|set80211doth
argument_list|(
argument|const char *val
argument_list|,
argument|int d
argument_list|,
argument|int s
argument_list|,
argument|const struct afswtch *rafp
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_DOTH
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|void
name|set80211shortgi
argument_list|(
argument|const char *val
argument_list|,
argument|int d
argument_list|,
argument|int s
argument_list|,
argument|const struct afswtch *rafp
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_SHORTGI
argument_list|,
name|d
condition|?
operator|(
name|IEEE80211_HTCAP_SHORTGI20
operator||
name|IEEE80211_HTCAP_SHORTGI40
operator|)
else|:
literal|0
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|void
name|set80211ampdu
argument_list|(
argument|const char *val
argument_list|,
argument|int d
argument_list|,
argument|int s
argument_list|,
argument|const struct afswtch *rafp
argument_list|)
block|{
name|int
name|ampdu
block|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AMPDU
argument_list|,
operator|&
name|ampdu
argument_list|)
operator|<
literal|0
condition|)
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"cannot get AMPDU setting"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|d
operator|<
literal|0
condition|)
block|{
name|d
operator|=
operator|-
name|d
expr_stmt|;
name|ampdu
operator|&=
operator|~
name|d
expr_stmt|;
block|}
else|else
name|ampdu
operator||=
name|d
expr_stmt|;
end_if

begin_expr_stmt
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AMPDU
argument_list|,
name|ampdu
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
unit|}  static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211ampdulimit
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
end_macro

begin_block
block|{
name|int
name|v
decl_stmt|;
switch|switch
condition|(
name|atoi
argument_list|(
name|val
argument_list|)
condition|)
block|{
case|case
literal|8
case|:
case|case
literal|8
operator|*
literal|1024
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MAXRXAMPDU_8K
expr_stmt|;
break|break;
case|case
literal|16
case|:
case|case
literal|16
operator|*
literal|1024
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MAXRXAMPDU_16K
expr_stmt|;
break|break;
case|case
literal|32
case|:
case|case
literal|32
operator|*
literal|1024
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MAXRXAMPDU_32K
expr_stmt|;
break|break;
case|case
literal|64
case|:
case|case
literal|64
operator|*
literal|1024
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MAXRXAMPDU_64K
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"invalid A-MPDU limit %s"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AMPDU_LIMIT
argument_list|,
name|v
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211ampdudensity
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|int
name|v
block|;
if|if
condition|(
name|isanyarg
argument_list|(
name|val
argument_list|)
condition|)
name|v
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_NA
expr_stmt|;
else|else
switch|switch
condition|(
call|(
name|int
call|)
argument_list|(
name|atof
argument_list|(
name|val
argument_list|)
operator|*
literal|4
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_NA
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_025
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_05
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_1
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_2
expr_stmt|;
break|break;
case|case
literal|16
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_4
expr_stmt|;
break|break;
case|case
literal|32
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_8
expr_stmt|;
break|break;
case|case
literal|64
case|:
name|v
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_16
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"invalid A-MPDU density %s"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AMPDU_DENSITY
argument_list|,
name|v
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
end_expr_stmt

begin_function
unit|}  static
name|void
name|set80211amsdu
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
name|int
name|d
parameter_list|,
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|afswtch
modifier|*
name|rafp
parameter_list|)
block|{
name|int
name|amsdu
decl_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AMSDU
argument_list|,
operator|&
name|amsdu
argument_list|)
operator|<
literal|0
condition|)
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"cannot get AMSDU setting"
argument_list|)
expr_stmt|;
if|if
condition|(
name|d
operator|<
literal|0
condition|)
block|{
name|d
operator|=
operator|-
name|d
expr_stmt|;
name|amsdu
operator|&=
operator|~
name|d
expr_stmt|;
block|}
else|else
name|amsdu
operator||=
name|d
expr_stmt|;
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AMSDU
argument_list|,
name|amsdu
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_expr_stmt
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211amsdulimit
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AMSDU_LIMIT
argument_list|,
name|atoi
argument_list|(
name|val
argument_list|)
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|void
name|set80211puren
argument_list|(
argument|const char *val
argument_list|,
argument|int d
argument_list|,
argument|int s
argument_list|,
argument|const struct afswtch *rafp
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_PUREN
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|void
name|set80211htcompat
argument_list|(
argument|const char *val
argument_list|,
argument|int d
argument_list|,
argument|int s
argument_list|,
argument|const struct afswtch *rafp
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_HTCOMPAT
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|void
name|set80211htconf
argument_list|(
argument|const char *val
argument_list|,
argument|int d
argument_list|,
argument|int s
argument_list|,
argument|const struct afswtch *rafp
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_HTCONF
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|;
name|htconf
operator|=
name|d
block|; }
specifier|static
name|void
name|set80211inact
argument_list|(
argument|const char *val
argument_list|,
argument|int d
argument_list|,
argument|int s
argument_list|,
argument|const struct afswtch *rafp
argument_list|)
block|{
name|set80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_INACTIVITY
argument_list|,
name|d
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
block|; }
specifier|static
name|void
name|LINE_INIT
argument_list|(
argument|char c
argument_list|)
block|{
name|spacer
operator|=
name|c
block|;
if|if
condition|(
name|c
operator|==
literal|'\t'
condition|)
name|col
operator|=
literal|8
expr_stmt|;
else|else
name|col
operator|=
literal|1
expr_stmt|;
block|}
end_expr_stmt

begin_function
specifier|static
name|void
name|LINE_BREAK
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|spacer
operator|!=
literal|'\t'
condition|)
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|spacer
operator|=
literal|'\t'
expr_stmt|;
block|}
name|col
operator|=
literal|8
expr_stmt|;
comment|/* 8-col tab */
block|}
end_function

begin_function
specifier|static
name|void
name|LINE_CHECK
parameter_list|(
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|char
name|buf
index|[
literal|80
index|]
decl_stmt|;
name|va_list
name|ap
decl_stmt|;
name|int
name|n
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|n
operator|=
name|vsnprintf
argument_list|(
name|buf
operator|+
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
operator|-
literal|1
argument_list|,
name|fmt
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
name|col
operator|+=
literal|1
operator|+
name|n
expr_stmt|;
if|if
condition|(
name|col
operator|>
name|MAXCOL
condition|)
block|{
name|LINE_BREAK
argument_list|()
expr_stmt|;
name|col
operator|+=
name|n
expr_stmt|;
block|}
name|buf
index|[
literal|0
index|]
operator|=
name|spacer
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|spacer
operator|=
literal|' '
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|getmaxrate
parameter_list|(
specifier|const
name|uint8_t
name|rates
index|[
literal|15
index|]
parameter_list|,
name|uint8_t
name|nrates
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|maxrate
init|=
operator|-
literal|1
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nrates
condition|;
name|i
operator|++
control|)
block|{
name|int
name|rate
init|=
name|rates
index|[
name|i
index|]
operator|&
name|IEEE80211_RATE_VAL
decl_stmt|;
if|if
condition|(
name|rate
operator|>
name|maxrate
condition|)
name|maxrate
operator|=
name|rate
expr_stmt|;
block|}
return|return
name|maxrate
operator|/
literal|2
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|getcaps
parameter_list|(
name|int
name|capinfo
parameter_list|)
block|{
specifier|static
name|char
name|capstring
index|[
literal|32
index|]
decl_stmt|;
name|char
modifier|*
name|cp
init|=
name|capstring
decl_stmt|;
if|if
condition|(
name|capinfo
operator|&
name|IEEE80211_CAPINFO_ESS
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'E'
expr_stmt|;
if|if
condition|(
name|capinfo
operator|&
name|IEEE80211_CAPINFO_IBSS
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'I'
expr_stmt|;
if|if
condition|(
name|capinfo
operator|&
name|IEEE80211_CAPINFO_CF_POLLABLE
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'c'
expr_stmt|;
if|if
condition|(
name|capinfo
operator|&
name|IEEE80211_CAPINFO_CF_POLLREQ
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'C'
expr_stmt|;
if|if
condition|(
name|capinfo
operator|&
name|IEEE80211_CAPINFO_PRIVACY
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'P'
expr_stmt|;
if|if
condition|(
name|capinfo
operator|&
name|IEEE80211_CAPINFO_SHORT_PREAMBLE
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'S'
expr_stmt|;
if|if
condition|(
name|capinfo
operator|&
name|IEEE80211_CAPINFO_PBCC
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'B'
expr_stmt|;
if|if
condition|(
name|capinfo
operator|&
name|IEEE80211_CAPINFO_CHNL_AGILITY
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'A'
expr_stmt|;
if|if
condition|(
name|capinfo
operator|&
name|IEEE80211_CAPINFO_SHORT_SLOTTIME
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'s'
expr_stmt|;
if|if
condition|(
name|capinfo
operator|&
name|IEEE80211_CAPINFO_RSN
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'R'
expr_stmt|;
if|if
condition|(
name|capinfo
operator|&
name|IEEE80211_CAPINFO_DSSSOFDM
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'D'
expr_stmt|;
operator|*
name|cp
operator|=
literal|'\0'
expr_stmt|;
return|return
name|capstring
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|getflags
parameter_list|(
name|int
name|flags
parameter_list|)
block|{
comment|/* XXX need these publicly defined or similar */
define|#
directive|define
name|IEEE80211_NODE_AUTH
value|0x0001
comment|/* authorized for data */
define|#
directive|define
name|IEEE80211_NODE_QOS
value|0x0002
comment|/* QoS enabled */
define|#
directive|define
name|IEEE80211_NODE_ERP
value|0x0004
comment|/* ERP enabled */
define|#
directive|define
name|IEEE80211_NODE_PWR_MGT
value|0x0010
comment|/* power save mode enabled */
define|#
directive|define
name|IEEE80211_NODE_HT
value|0x0040
comment|/* HT enabled */
define|#
directive|define
name|IEEE80211_NODE_HTCOMPAT
value|0x0080
comment|/* HT setup w/ vendor OUI's */
define|#
directive|define
name|IEEE80211_NODE_WPS
value|0x0100
comment|/* WPS association */
define|#
directive|define
name|IEEE80211_NODE_TSN
value|0x0200
comment|/* TSN association */
specifier|static
name|char
name|flagstring
index|[
literal|32
index|]
decl_stmt|;
name|char
modifier|*
name|cp
init|=
name|flagstring
decl_stmt|;
if|if
condition|(
name|flags
operator|&
name|IEEE80211_NODE_AUTH
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'A'
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|IEEE80211_NODE_QOS
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'Q'
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|IEEE80211_NODE_ERP
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'E'
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|IEEE80211_NODE_PWR_MGT
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'P'
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|IEEE80211_NODE_HT
condition|)
block|{
operator|*
name|cp
operator|++
operator|=
literal|'H'
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|IEEE80211_NODE_HTCOMPAT
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'+'
expr_stmt|;
block|}
if|if
condition|(
name|flags
operator|&
name|IEEE80211_NODE_WPS
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'W'
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|IEEE80211_NODE_TSN
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'T'
expr_stmt|;
operator|*
name|cp
operator|=
literal|'\0'
expr_stmt|;
return|return
name|flagstring
return|;
undef|#
directive|undef
name|IEEE80211_NODE_TSN
undef|#
directive|undef
name|IEEE80211_NODE_WPS
undef|#
directive|undef
name|IEEE80211_NODE_HTCOMPAT
undef|#
directive|undef
name|IEEE80211_NODE_HT
undef|#
directive|undef
name|IEEE80211_NODE_AUTH
undef|#
directive|undef
name|IEEE80211_NODE_QOS
undef|#
directive|undef
name|IEEE80211_NODE_ERP
undef|#
directive|undef
name|IEEE80211_NODE_PWR_MGT
block|}
end_function

begin_function
specifier|static
name|void
name|printie
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|uint8_t
modifier|*
name|ie
parameter_list|,
name|size_t
name|ielen
parameter_list|,
name|int
name|maxlen
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
name|verbose
condition|)
block|{
name|maxlen
operator|-=
name|strlen
argument_list|(
name|tag
argument_list|)
operator|+
literal|2
expr_stmt|;
if|if
condition|(
literal|2
operator|*
name|ielen
operator|>
name|maxlen
condition|)
name|maxlen
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"<"
argument_list|)
expr_stmt|;
for|for
control|(
init|;
name|ielen
operator|>
literal|0
condition|;
name|ie
operator|++
operator|,
name|ielen
operator|--
control|)
block|{
if|if
condition|(
name|maxlen
operator|--
operator|<=
literal|0
condition|)
break|break;
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
name|ie
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ielen
operator|!=
literal|0
condition|)
name|printf
argument_list|(
literal|"-"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|">"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|LE_READ_2
parameter_list|(
name|p
parameter_list|)
define|\
value|((u_int16_t)					\ 	 ((((const u_int8_t *)(p))[0]      ) |		\ 	  (((const u_int8_t *)(p))[1]<<  8)))
end_define

begin_define
define|#
directive|define
name|LE_READ_4
parameter_list|(
name|p
parameter_list|)
define|\
value|((u_int32_t)					\ 	 ((((const u_int8_t *)(p))[0]      ) |		\ 	  (((const u_int8_t *)(p))[1]<<  8) |		\ 	  (((const u_int8_t *)(p))[2]<< 16) |		\ 	  (((const u_int8_t *)(p))[3]<< 24)))
end_define

begin_comment
comment|/*  * NB: The decoding routines assume a properly formatted ie  *     which should be safe as the kernel only retains them  *     if they parse ok.  */
end_comment

begin_function
specifier|static
name|void
name|printwmeparam
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|u_int8_t
modifier|*
name|ie
parameter_list|,
name|size_t
name|ielen
parameter_list|,
name|int
name|maxlen
parameter_list|)
block|{
define|#
directive|define
name|MS
parameter_list|(
name|_v
parameter_list|,
name|_f
parameter_list|)
value|(((_v)& _f)>> _f##_S)
specifier|static
specifier|const
name|char
modifier|*
name|acnames
index|[]
init|=
block|{
literal|"BE"
block|,
literal|"BK"
block|,
literal|"VO"
block|,
literal|"VI"
block|}
decl_stmt|;
specifier|const
name|struct
name|ieee80211_wme_param
modifier|*
name|wme
init|=
operator|(
specifier|const
expr|struct
name|ieee80211_wme_param
operator|*
operator|)
name|ie
decl_stmt|;
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|verbose
condition|)
return|return;
name|printf
argument_list|(
literal|"<qosinfo 0x%x"
argument_list|,
name|wme
operator|->
name|param_qosInfo
argument_list|)
expr_stmt|;
name|ie
operator|+=
name|offsetof
argument_list|(
expr|struct
name|ieee80211_wme_param
argument_list|,
name|params_acParams
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|WME_NUM_AC
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|struct
name|ieee80211_wme_acparams
modifier|*
name|ac
init|=
operator|&
name|wme
operator|->
name|params_acParams
index|[
name|i
index|]
decl_stmt|;
name|printf
argument_list|(
literal|" %s[%saifsn %u cwmin %u cwmax %u txop %u]"
argument_list|,
name|acnames
index|[
name|i
index|]
argument_list|,
name|MS
argument_list|(
name|ac
operator|->
name|acp_aci_aifsn
argument_list|,
name|WME_PARAM_ACM
argument_list|)
condition|?
literal|"acm "
else|:
literal|""
argument_list|,
name|MS
argument_list|(
name|ac
operator|->
name|acp_aci_aifsn
argument_list|,
name|WME_PARAM_AIFSN
argument_list|)
argument_list|,
name|MS
argument_list|(
name|ac
operator|->
name|acp_logcwminmax
argument_list|,
name|WME_PARAM_LOGCWMIN
argument_list|)
argument_list|,
name|MS
argument_list|(
name|ac
operator|->
name|acp_logcwminmax
argument_list|,
name|WME_PARAM_LOGCWMAX
argument_list|)
argument_list|,
name|LE_READ_2
argument_list|(
operator|&
name|ac
operator|->
name|acp_txop
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|">"
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|MS
block|}
end_function

begin_function
specifier|static
name|void
name|printwmeinfo
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|u_int8_t
modifier|*
name|ie
parameter_list|,
name|size_t
name|ielen
parameter_list|,
name|int
name|maxlen
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
name|verbose
condition|)
block|{
specifier|const
name|struct
name|ieee80211_wme_info
modifier|*
name|wme
init|=
operator|(
specifier|const
expr|struct
name|ieee80211_wme_info
operator|*
operator|)
name|ie
decl_stmt|;
name|printf
argument_list|(
literal|"<version 0x%x info 0x%x>"
argument_list|,
name|wme
operator|->
name|wme_version
argument_list|,
name|wme
operator|->
name|wme_info
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|printhtcap
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|u_int8_t
modifier|*
name|ie
parameter_list|,
name|size_t
name|ielen
parameter_list|,
name|int
name|maxlen
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
name|verbose
condition|)
block|{
specifier|const
name|struct
name|ieee80211_ie_htcap
modifier|*
name|htcap
init|=
operator|(
specifier|const
expr|struct
name|ieee80211_ie_htcap
operator|*
operator|)
name|ie
decl_stmt|;
specifier|const
name|char
modifier|*
name|sep
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|printf
argument_list|(
literal|"<cap 0x%x param 0x%x"
argument_list|,
name|LE_READ_2
argument_list|(
operator|&
name|htcap
operator|->
name|hc_cap
argument_list|)
argument_list|,
name|htcap
operator|->
name|hc_param
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" mcsset["
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|""
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IEEE80211_HTRATE_MAXSIZE
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|isset
argument_list|(
name|htcap
operator|->
name|hc_mcsset
argument_list|,
name|i
argument_list|)
condition|)
block|{
for|for
control|(
name|j
operator|=
name|i
operator|+
literal|1
init|;
name|j
operator|<
name|IEEE80211_HTRATE_MAXSIZE
condition|;
name|j
operator|++
control|)
if|if
condition|(
name|isclr
argument_list|(
name|htcap
operator|->
name|hc_mcsset
argument_list|,
name|j
argument_list|)
condition|)
break|break;
name|j
operator|--
expr_stmt|;
if|if
condition|(
name|i
operator|==
name|j
condition|)
name|printf
argument_list|(
literal|"%s%u"
argument_list|,
name|sep
argument_list|,
name|i
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%s%u-%u"
argument_list|,
name|sep
argument_list|,
name|i
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|i
operator|+=
name|j
operator|-
name|i
expr_stmt|;
name|sep
operator|=
literal|","
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"] extcap 0x%x txbf 0x%x antenna 0x%x>"
argument_list|,
name|LE_READ_2
argument_list|(
operator|&
name|htcap
operator|->
name|hc_extcap
argument_list|)
argument_list|,
name|LE_READ_4
argument_list|(
operator|&
name|htcap
operator|->
name|hc_txbf
argument_list|)
argument_list|,
name|htcap
operator|->
name|hc_antenna
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|printhtinfo
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|u_int8_t
modifier|*
name|ie
parameter_list|,
name|size_t
name|ielen
parameter_list|,
name|int
name|maxlen
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
name|verbose
condition|)
block|{
specifier|const
name|struct
name|ieee80211_ie_htinfo
modifier|*
name|htinfo
init|=
operator|(
specifier|const
expr|struct
name|ieee80211_ie_htinfo
operator|*
operator|)
name|ie
decl_stmt|;
specifier|const
name|char
modifier|*
name|sep
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|printf
argument_list|(
literal|"<ctl %u, %x,%x,%x,%x"
argument_list|,
name|htinfo
operator|->
name|hi_ctrlchannel
argument_list|,
name|htinfo
operator|->
name|hi_byte1
argument_list|,
name|htinfo
operator|->
name|hi_byte2
argument_list|,
name|htinfo
operator|->
name|hi_byte3
argument_list|,
name|LE_READ_2
argument_list|(
operator|&
name|htinfo
operator|->
name|hi_byte45
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" basicmcs["
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|""
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IEEE80211_HTRATE_MAXSIZE
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|isset
argument_list|(
name|htinfo
operator|->
name|hi_basicmcsset
argument_list|,
name|i
argument_list|)
condition|)
block|{
for|for
control|(
name|j
operator|=
name|i
operator|+
literal|1
init|;
name|j
operator|<
name|IEEE80211_HTRATE_MAXSIZE
condition|;
name|j
operator|++
control|)
if|if
condition|(
name|isclr
argument_list|(
name|htinfo
operator|->
name|hi_basicmcsset
argument_list|,
name|j
argument_list|)
condition|)
break|break;
name|j
operator|--
expr_stmt|;
if|if
condition|(
name|i
operator|==
name|j
condition|)
name|printf
argument_list|(
literal|"%s%u"
argument_list|,
name|sep
argument_list|,
name|i
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%s%u-%u"
argument_list|,
name|sep
argument_list|,
name|i
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|i
operator|+=
name|j
operator|-
name|i
expr_stmt|;
name|sep
operator|=
literal|","
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"]>"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|printathie
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|u_int8_t
modifier|*
name|ie
parameter_list|,
name|size_t
name|ielen
parameter_list|,
name|int
name|maxlen
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
name|verbose
condition|)
block|{
specifier|const
name|struct
name|ieee80211_ath_ie
modifier|*
name|ath
init|=
operator|(
specifier|const
expr|struct
name|ieee80211_ath_ie
operator|*
operator|)
name|ie
decl_stmt|;
name|printf
argument_list|(
literal|"<"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ath
operator|->
name|ath_capability
operator|&
name|ATHEROS_CAP_TURBO_PRIME
condition|)
name|printf
argument_list|(
literal|"DTURBO,"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ath
operator|->
name|ath_capability
operator|&
name|ATHEROS_CAP_COMPRESSION
condition|)
name|printf
argument_list|(
literal|"COMP,"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ath
operator|->
name|ath_capability
operator|&
name|ATHEROS_CAP_FAST_FRAME
condition|)
name|printf
argument_list|(
literal|"FF,"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ath
operator|->
name|ath_capability
operator|&
name|ATHEROS_CAP_XR
condition|)
name|printf
argument_list|(
literal|"XR,"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ath
operator|->
name|ath_capability
operator|&
name|ATHEROS_CAP_AR
condition|)
name|printf
argument_list|(
literal|"AR,"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ath
operator|->
name|ath_capability
operator|&
name|ATHEROS_CAP_BURST
condition|)
name|printf
argument_list|(
literal|"BURST,"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ath
operator|->
name|ath_capability
operator|&
name|ATHEROS_CAP_WME
condition|)
name|printf
argument_list|(
literal|"WME,"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ath
operator|->
name|ath_capability
operator|&
name|ATHEROS_CAP_BOOST
condition|)
name|printf
argument_list|(
literal|"BOOST,"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"0x%x>"
argument_list|,
name|LE_READ_2
argument_list|(
name|ath
operator|->
name|ath_defkeyix
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|wpa_cipher
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|sel
parameter_list|)
block|{
define|#
directive|define
name|WPA_SEL
parameter_list|(
name|x
parameter_list|)
value|(((x)<<24)|WPA_OUI)
name|u_int32_t
name|w
init|=
name|LE_READ_4
argument_list|(
name|sel
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|w
condition|)
block|{
case|case
name|WPA_SEL
argument_list|(
name|WPA_CSE_NULL
argument_list|)
case|:
return|return
literal|"NONE"
return|;
case|case
name|WPA_SEL
argument_list|(
name|WPA_CSE_WEP40
argument_list|)
case|:
return|return
literal|"WEP40"
return|;
case|case
name|WPA_SEL
argument_list|(
name|WPA_CSE_WEP104
argument_list|)
case|:
return|return
literal|"WEP104"
return|;
case|case
name|WPA_SEL
argument_list|(
name|WPA_CSE_TKIP
argument_list|)
case|:
return|return
literal|"TKIP"
return|;
case|case
name|WPA_SEL
argument_list|(
name|WPA_CSE_CCMP
argument_list|)
case|:
return|return
literal|"AES-CCMP"
return|;
block|}
return|return
literal|"?"
return|;
comment|/* NB: so 1<< is discarded */
undef|#
directive|undef
name|WPA_SEL
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|wpa_keymgmt
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|sel
parameter_list|)
block|{
define|#
directive|define
name|WPA_SEL
parameter_list|(
name|x
parameter_list|)
value|(((x)<<24)|WPA_OUI)
name|u_int32_t
name|w
init|=
name|LE_READ_4
argument_list|(
name|sel
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|w
condition|)
block|{
case|case
name|WPA_SEL
argument_list|(
name|WPA_ASE_8021X_UNSPEC
argument_list|)
case|:
return|return
literal|"8021X-UNSPEC"
return|;
case|case
name|WPA_SEL
argument_list|(
name|WPA_ASE_8021X_PSK
argument_list|)
case|:
return|return
literal|"8021X-PSK"
return|;
case|case
name|WPA_SEL
argument_list|(
name|WPA_ASE_NONE
argument_list|)
case|:
return|return
literal|"NONE"
return|;
block|}
return|return
literal|"?"
return|;
undef|#
directive|undef
name|WPA_SEL
block|}
end_function

begin_function
specifier|static
name|void
name|printwpaie
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|u_int8_t
modifier|*
name|ie
parameter_list|,
name|size_t
name|ielen
parameter_list|,
name|int
name|maxlen
parameter_list|)
block|{
name|u_int8_t
name|len
init|=
name|ie
index|[
literal|1
index|]
decl_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
name|verbose
condition|)
block|{
specifier|const
name|char
modifier|*
name|sep
decl_stmt|;
name|int
name|n
decl_stmt|;
name|ie
operator|+=
literal|6
operator|,
name|len
operator|-=
literal|4
expr_stmt|;
comment|/* NB: len is payload only */
name|printf
argument_list|(
literal|"<v%u"
argument_list|,
name|LE_READ_2
argument_list|(
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|2
operator|,
name|len
operator|-=
literal|2
expr_stmt|;
name|printf
argument_list|(
literal|" mc:%s"
argument_list|,
name|wpa_cipher
argument_list|(
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|4
operator|,
name|len
operator|-=
literal|4
expr_stmt|;
comment|/* unicast ciphers */
name|n
operator|=
name|LE_READ_2
argument_list|(
name|ie
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|2
operator|,
name|len
operator|-=
literal|2
expr_stmt|;
name|sep
operator|=
literal|" uc:"
expr_stmt|;
for|for
control|(
init|;
name|n
operator|>
literal|0
condition|;
name|n
operator|--
control|)
block|{
name|printf
argument_list|(
literal|"%s%s"
argument_list|,
name|sep
argument_list|,
name|wpa_cipher
argument_list|(
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|4
operator|,
name|len
operator|-=
literal|4
expr_stmt|;
name|sep
operator|=
literal|"+"
expr_stmt|;
block|}
comment|/* key management algorithms */
name|n
operator|=
name|LE_READ_2
argument_list|(
name|ie
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|2
operator|,
name|len
operator|-=
literal|2
expr_stmt|;
name|sep
operator|=
literal|" km:"
expr_stmt|;
for|for
control|(
init|;
name|n
operator|>
literal|0
condition|;
name|n
operator|--
control|)
block|{
name|printf
argument_list|(
literal|"%s%s"
argument_list|,
name|sep
argument_list|,
name|wpa_keymgmt
argument_list|(
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|4
operator|,
name|len
operator|-=
literal|4
expr_stmt|;
name|sep
operator|=
literal|"+"
expr_stmt|;
block|}
if|if
condition|(
name|len
operator|>
literal|2
condition|)
comment|/* optional capabilities */
name|printf
argument_list|(
literal|", caps 0x%x"
argument_list|,
name|LE_READ_2
argument_list|(
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|">"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|rsn_cipher
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|sel
parameter_list|)
block|{
define|#
directive|define
name|RSN_SEL
parameter_list|(
name|x
parameter_list|)
value|(((x)<<24)|RSN_OUI)
name|u_int32_t
name|w
init|=
name|LE_READ_4
argument_list|(
name|sel
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|w
condition|)
block|{
case|case
name|RSN_SEL
argument_list|(
name|RSN_CSE_NULL
argument_list|)
case|:
return|return
literal|"NONE"
return|;
case|case
name|RSN_SEL
argument_list|(
name|RSN_CSE_WEP40
argument_list|)
case|:
return|return
literal|"WEP40"
return|;
case|case
name|RSN_SEL
argument_list|(
name|RSN_CSE_WEP104
argument_list|)
case|:
return|return
literal|"WEP104"
return|;
case|case
name|RSN_SEL
argument_list|(
name|RSN_CSE_TKIP
argument_list|)
case|:
return|return
literal|"TKIP"
return|;
case|case
name|RSN_SEL
argument_list|(
name|RSN_CSE_CCMP
argument_list|)
case|:
return|return
literal|"AES-CCMP"
return|;
case|case
name|RSN_SEL
argument_list|(
name|RSN_CSE_WRAP
argument_list|)
case|:
return|return
literal|"AES-OCB"
return|;
block|}
return|return
literal|"?"
return|;
undef|#
directive|undef
name|WPA_SEL
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|rsn_keymgmt
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|sel
parameter_list|)
block|{
define|#
directive|define
name|RSN_SEL
parameter_list|(
name|x
parameter_list|)
value|(((x)<<24)|RSN_OUI)
name|u_int32_t
name|w
init|=
name|LE_READ_4
argument_list|(
name|sel
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|w
condition|)
block|{
case|case
name|RSN_SEL
argument_list|(
name|RSN_ASE_8021X_UNSPEC
argument_list|)
case|:
return|return
literal|"8021X-UNSPEC"
return|;
case|case
name|RSN_SEL
argument_list|(
name|RSN_ASE_8021X_PSK
argument_list|)
case|:
return|return
literal|"8021X-PSK"
return|;
case|case
name|RSN_SEL
argument_list|(
name|RSN_ASE_NONE
argument_list|)
case|:
return|return
literal|"NONE"
return|;
block|}
return|return
literal|"?"
return|;
undef|#
directive|undef
name|RSN_SEL
block|}
end_function

begin_function
specifier|static
name|void
name|printrsnie
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|u_int8_t
modifier|*
name|ie
parameter_list|,
name|size_t
name|ielen
parameter_list|,
name|int
name|maxlen
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
name|verbose
condition|)
block|{
specifier|const
name|char
modifier|*
name|sep
decl_stmt|;
name|int
name|n
decl_stmt|;
name|ie
operator|+=
literal|2
operator|,
name|ielen
operator|-=
literal|2
expr_stmt|;
name|printf
argument_list|(
literal|"<v%u"
argument_list|,
name|LE_READ_2
argument_list|(
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|2
operator|,
name|ielen
operator|-=
literal|2
expr_stmt|;
name|printf
argument_list|(
literal|" mc:%s"
argument_list|,
name|rsn_cipher
argument_list|(
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|4
operator|,
name|ielen
operator|-=
literal|4
expr_stmt|;
comment|/* unicast ciphers */
name|n
operator|=
name|LE_READ_2
argument_list|(
name|ie
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|2
operator|,
name|ielen
operator|-=
literal|2
expr_stmt|;
name|sep
operator|=
literal|" uc:"
expr_stmt|;
for|for
control|(
init|;
name|n
operator|>
literal|0
condition|;
name|n
operator|--
control|)
block|{
name|printf
argument_list|(
literal|"%s%s"
argument_list|,
name|sep
argument_list|,
name|rsn_cipher
argument_list|(
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|4
operator|,
name|ielen
operator|-=
literal|4
expr_stmt|;
name|sep
operator|=
literal|"+"
expr_stmt|;
block|}
comment|/* key management algorithms */
name|n
operator|=
name|LE_READ_2
argument_list|(
name|ie
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|2
operator|,
name|ielen
operator|-=
literal|2
expr_stmt|;
name|sep
operator|=
literal|" km:"
expr_stmt|;
for|for
control|(
init|;
name|n
operator|>
literal|0
condition|;
name|n
operator|--
control|)
block|{
name|printf
argument_list|(
literal|"%s%s"
argument_list|,
name|sep
argument_list|,
name|rsn_keymgmt
argument_list|(
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|ie
operator|+=
literal|4
operator|,
name|ielen
operator|-=
literal|4
expr_stmt|;
name|sep
operator|=
literal|"+"
expr_stmt|;
block|}
if|if
condition|(
name|ielen
operator|>
literal|2
condition|)
comment|/* optional capabilities */
name|printf
argument_list|(
literal|", caps 0x%x"
argument_list|,
name|LE_READ_2
argument_list|(
name|ie
argument_list|)
argument_list|)
expr_stmt|;
comment|/* XXXPMKID */
name|printf
argument_list|(
literal|">"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Copy the ssid string contents into buf, truncating to fit.  If the  * ssid is entirely printable then just copy intact.  Otherwise convert  * to hexadecimal.  If the result is truncated then replace the last  * three characters with "...".  */
end_comment

begin_function
specifier|static
name|int
name|copy_essid
parameter_list|(
name|char
name|buf
index|[]
parameter_list|,
name|size_t
name|bufsize
parameter_list|,
specifier|const
name|u_int8_t
modifier|*
name|essid
parameter_list|,
name|size_t
name|essid_len
parameter_list|)
block|{
specifier|const
name|u_int8_t
modifier|*
name|p
decl_stmt|;
name|size_t
name|maxlen
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|essid_len
operator|>
name|bufsize
condition|)
name|maxlen
operator|=
name|bufsize
expr_stmt|;
else|else
name|maxlen
operator|=
name|essid_len
expr_stmt|;
comment|/* determine printable or not */
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|p
operator|=
name|essid
init|;
name|i
operator|<
name|maxlen
condition|;
name|i
operator|++
operator|,
name|p
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|p
operator|<
literal|' '
operator|||
operator|*
name|p
operator|>
literal|0x7e
condition|)
break|break;
block|}
if|if
condition|(
name|i
operator|!=
name|maxlen
condition|)
block|{
comment|/* not printable, print as hex */
if|if
condition|(
name|bufsize
operator|<
literal|3
condition|)
return|return
literal|0
return|;
name|strlcpy
argument_list|(
name|buf
argument_list|,
literal|"0x"
argument_list|,
name|bufsize
argument_list|)
expr_stmt|;
name|bufsize
operator|-=
literal|2
expr_stmt|;
name|p
operator|=
name|essid
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|maxlen
operator|&&
name|bufsize
operator|>=
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|sprintf
argument_list|(
operator|&
name|buf
index|[
literal|2
operator|+
literal|2
operator|*
name|i
index|]
argument_list|,
literal|"%02x"
argument_list|,
name|p
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|bufsize
operator|-=
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|!=
name|essid_len
condition|)
name|memcpy
argument_list|(
operator|&
name|buf
index|[
literal|2
operator|+
literal|2
operator|*
name|i
operator|-
literal|3
index|]
argument_list|,
literal|"..."
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* printable, truncate as needed */
name|memcpy
argument_list|(
name|buf
argument_list|,
name|essid
argument_list|,
name|maxlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|maxlen
operator|!=
name|essid_len
condition|)
name|memcpy
argument_list|(
operator|&
name|buf
index|[
name|maxlen
operator|-
literal|3
index|]
argument_list|,
literal|"..."
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
return|return
name|maxlen
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|printssid
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|u_int8_t
modifier|*
name|ie
parameter_list|,
name|size_t
name|ielen
parameter_list|,
name|int
name|maxlen
parameter_list|)
block|{
name|char
name|ssid
index|[
literal|2
operator|*
name|IEEE80211_NWID_LEN
operator|+
literal|1
index|]
decl_stmt|;
name|printf
argument_list|(
literal|"%s<%.*s>"
argument_list|,
name|tag
argument_list|,
name|copy_essid
argument_list|(
name|ssid
argument_list|,
name|maxlen
argument_list|,
name|ie
operator|+
literal|2
argument_list|,
name|ie
index|[
literal|1
index|]
argument_list|)
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|printrates
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|u_int8_t
modifier|*
name|ie
parameter_list|,
name|size_t
name|ielen
parameter_list|,
name|int
name|maxlen
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|sep
decl_stmt|;
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|"<"
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|<
name|ielen
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%s%s%d"
argument_list|,
name|sep
argument_list|,
name|ie
index|[
name|i
index|]
operator|&
name|IEEE80211_RATE_BASIC
condition|?
literal|"B"
else|:
literal|""
argument_list|,
name|ie
index|[
name|i
index|]
operator|&
name|IEEE80211_RATE_VAL
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|","
expr_stmt|;
block|}
name|printf
argument_list|(
literal|">"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|printcountry
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|u_int8_t
modifier|*
name|ie
parameter_list|,
name|size_t
name|ielen
parameter_list|,
name|int
name|maxlen
parameter_list|)
block|{
specifier|const
name|struct
name|ieee80211_country_ie
modifier|*
name|cie
init|=
operator|(
specifier|const
expr|struct
name|ieee80211_country_ie
operator|*
operator|)
name|ie
decl_stmt|;
name|int
name|i
decl_stmt|,
name|nbands
decl_stmt|,
name|schan
decl_stmt|,
name|nchan
decl_stmt|;
name|printf
argument_list|(
literal|"%s<%c%c%c"
argument_list|,
name|tag
argument_list|,
name|cie
operator|->
name|cc
index|[
literal|0
index|]
argument_list|,
name|cie
operator|->
name|cc
index|[
literal|1
index|]
argument_list|,
name|cie
operator|->
name|cc
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|nbands
operator|=
operator|(
name|cie
operator|->
name|len
operator|-
literal|3
operator|)
operator|/
sizeof|sizeof
argument_list|(
name|cie
operator|->
name|band
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nbands
condition|;
name|i
operator|++
control|)
block|{
name|schan
operator|=
name|cie
operator|->
name|band
index|[
name|i
index|]
operator|.
name|schan
expr_stmt|;
name|nchan
operator|=
name|cie
operator|->
name|band
index|[
name|i
index|]
operator|.
name|nchan
expr_stmt|;
if|if
condition|(
name|nchan
operator|!=
literal|1
condition|)
name|printf
argument_list|(
literal|" %u-%u,%u"
argument_list|,
name|schan
argument_list|,
name|schan
operator|+
name|nchan
operator|-
literal|1
argument_list|,
name|cie
operator|->
name|band
index|[
name|i
index|]
operator|.
name|maxtxpwr
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" %u,%u"
argument_list|,
name|schan
argument_list|,
name|cie
operator|->
name|band
index|[
name|i
index|]
operator|.
name|maxtxpwr
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|">"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* unaligned little endian access */
end_comment

begin_define
define|#
directive|define
name|LE_READ_4
parameter_list|(
name|p
parameter_list|)
define|\
value|((u_int32_t)					\ 	 ((((const u_int8_t *)(p))[0]      ) |		\ 	  (((const u_int8_t *)(p))[1]<<  8) |		\ 	  (((const u_int8_t *)(p))[2]<< 16) |		\ 	  (((const u_int8_t *)(p))[3]<< 24)))
end_define

begin_function
specifier|static
name|int
name|__inline
name|iswpaoui
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|frm
parameter_list|)
block|{
return|return
name|frm
index|[
literal|1
index|]
operator|>
literal|3
operator|&&
name|LE_READ_4
argument_list|(
name|frm
operator|+
literal|2
argument_list|)
operator|==
operator|(
operator|(
name|WPA_OUI_TYPE
operator|<<
literal|24
operator|)
operator||
name|WPA_OUI
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|__inline
name|iswmeinfo
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|frm
parameter_list|)
block|{
return|return
name|frm
index|[
literal|1
index|]
operator|>
literal|5
operator|&&
name|LE_READ_4
argument_list|(
name|frm
operator|+
literal|2
argument_list|)
operator|==
operator|(
operator|(
name|WME_OUI_TYPE
operator|<<
literal|24
operator|)
operator||
name|WME_OUI
operator|)
operator|&&
name|frm
index|[
literal|6
index|]
operator|==
name|WME_INFO_OUI_SUBTYPE
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|__inline
name|iswmeparam
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|frm
parameter_list|)
block|{
return|return
name|frm
index|[
literal|1
index|]
operator|>
literal|5
operator|&&
name|LE_READ_4
argument_list|(
name|frm
operator|+
literal|2
argument_list|)
operator|==
operator|(
operator|(
name|WME_OUI_TYPE
operator|<<
literal|24
operator|)
operator||
name|WME_OUI
operator|)
operator|&&
name|frm
index|[
literal|6
index|]
operator|==
name|WME_PARAM_OUI_SUBTYPE
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|__inline
name|isatherosoui
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|frm
parameter_list|)
block|{
return|return
name|frm
index|[
literal|1
index|]
operator|>
literal|3
operator|&&
name|LE_READ_4
argument_list|(
name|frm
operator|+
literal|2
argument_list|)
operator|==
operator|(
operator|(
name|ATH_OUI_TYPE
operator|<<
literal|24
operator|)
operator||
name|ATH_OUI
operator|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|iename
parameter_list|(
name|int
name|elemid
parameter_list|)
block|{
switch|switch
condition|(
name|elemid
condition|)
block|{
case|case
name|IEEE80211_ELEMID_FHPARMS
case|:
return|return
literal|" FHPARMS"
return|;
case|case
name|IEEE80211_ELEMID_CFPARMS
case|:
return|return
literal|" CFPARMS"
return|;
case|case
name|IEEE80211_ELEMID_TIM
case|:
return|return
literal|" TIM"
return|;
case|case
name|IEEE80211_ELEMID_IBSSPARMS
case|:
return|return
literal|" IBSSPARMS"
return|;
case|case
name|IEEE80211_ELEMID_CHALLENGE
case|:
return|return
literal|" CHALLENGE"
return|;
case|case
name|IEEE80211_ELEMID_PWRCNSTR
case|:
return|return
literal|" PWRCNSTR"
return|;
case|case
name|IEEE80211_ELEMID_PWRCAP
case|:
return|return
literal|" PWRCAP"
return|;
case|case
name|IEEE80211_ELEMID_TPCREQ
case|:
return|return
literal|" TPCREQ"
return|;
case|case
name|IEEE80211_ELEMID_TPCREP
case|:
return|return
literal|" TPCREP"
return|;
case|case
name|IEEE80211_ELEMID_SUPPCHAN
case|:
return|return
literal|" SUPPCHAN"
return|;
case|case
name|IEEE80211_ELEMID_CHANSWITCHANN
case|:
return|return
literal|" CSA"
return|;
case|case
name|IEEE80211_ELEMID_MEASREQ
case|:
return|return
literal|" MEASREQ"
return|;
case|case
name|IEEE80211_ELEMID_MEASREP
case|:
return|return
literal|" MEASREP"
return|;
case|case
name|IEEE80211_ELEMID_QUIET
case|:
return|return
literal|" QUIET"
return|;
case|case
name|IEEE80211_ELEMID_IBSSDFS
case|:
return|return
literal|" IBSSDFS"
return|;
case|case
name|IEEE80211_ELEMID_TPC
case|:
return|return
literal|" TPC"
return|;
case|case
name|IEEE80211_ELEMID_CCKM
case|:
return|return
literal|" CCKM"
return|;
block|}
return|return
literal|" ???"
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|printies
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|vp
parameter_list|,
name|int
name|ielen
parameter_list|,
name|int
name|maxcols
parameter_list|)
block|{
while|while
condition|(
name|ielen
operator|>
literal|0
condition|)
block|{
switch|switch
condition|(
name|vp
index|[
literal|0
index|]
condition|)
block|{
case|case
name|IEEE80211_ELEMID_SSID
case|:
if|if
condition|(
name|verbose
condition|)
name|printssid
argument_list|(
literal|" SSID"
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_ELEMID_RATES
case|:
case|case
name|IEEE80211_ELEMID_XRATES
case|:
if|if
condition|(
name|verbose
condition|)
name|printrates
argument_list|(
name|vp
index|[
literal|0
index|]
operator|==
name|IEEE80211_ELEMID_RATES
condition|?
literal|" RATES"
else|:
literal|" XRATES"
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_ELEMID_DSPARMS
case|:
if|if
condition|(
name|verbose
condition|)
name|printf
argument_list|(
literal|" DSPARMS<%u>"
argument_list|,
name|vp
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_ELEMID_COUNTRY
case|:
if|if
condition|(
name|verbose
condition|)
name|printcountry
argument_list|(
literal|" COUNTRY"
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_ELEMID_ERP
case|:
if|if
condition|(
name|verbose
condition|)
name|printf
argument_list|(
literal|" ERP<0x%x>"
argument_list|,
name|vp
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_ELEMID_VENDOR
case|:
if|if
condition|(
name|iswpaoui
argument_list|(
name|vp
argument_list|)
condition|)
name|printwpaie
argument_list|(
literal|" WPA"
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|iswmeinfo
argument_list|(
name|vp
argument_list|)
condition|)
name|printwmeinfo
argument_list|(
literal|" WME"
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|iswmeparam
argument_list|(
name|vp
argument_list|)
condition|)
name|printwmeparam
argument_list|(
literal|" WME"
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|isatherosoui
argument_list|(
name|vp
argument_list|)
condition|)
name|printathie
argument_list|(
literal|" ATH"
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|printie
argument_list|(
literal|" VEN"
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_ELEMID_RSN
case|:
name|printrsnie
argument_list|(
literal|" RSN"
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_ELEMID_HTCAP
case|:
name|printhtcap
argument_list|(
literal|" HTCAP"
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_ELEMID_HTINFO
case|:
if|if
condition|(
name|verbose
condition|)
name|printhtinfo
argument_list|(
literal|" HTINFO"
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|verbose
condition|)
name|printie
argument_list|(
name|iename
argument_list|(
name|vp
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|vp
argument_list|,
literal|2
operator|+
name|vp
index|[
literal|1
index|]
argument_list|,
name|maxcols
argument_list|)
expr_stmt|;
break|break;
block|}
name|ielen
operator|-=
literal|2
operator|+
name|vp
index|[
literal|1
index|]
expr_stmt|;
name|vp
operator|+=
literal|2
operator|+
name|vp
index|[
literal|1
index|]
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|list_scan
parameter_list|(
name|int
name|s
parameter_list|)
block|{
name|uint8_t
name|buf
index|[
literal|24
operator|*
literal|1024
index|]
decl_stmt|;
name|char
name|ssid
index|[
name|IEEE80211_NWID_LEN
operator|+
literal|1
index|]
decl_stmt|;
specifier|const
name|uint8_t
modifier|*
name|cp
decl_stmt|;
name|int
name|len
decl_stmt|,
name|ssidmax
decl_stmt|;
if|if
condition|(
name|get80211len
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_SCAN_RESULTS
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
operator|&
name|len
argument_list|)
operator|<
literal|0
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unable to get scan results"
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_scan_result
argument_list|)
condition|)
return|return;
name|getchaninfo
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|ssidmax
operator|=
name|verbose
condition|?
name|IEEE80211_NWID_LEN
else|:
literal|14
expr_stmt|;
name|printf
argument_list|(
literal|"%-*.*s  %-17.17s  %4s %4s  %-7s  %3s %4s\n"
argument_list|,
name|ssidmax
argument_list|,
name|ssidmax
argument_list|,
literal|"SSID"
argument_list|,
literal|"BSSID"
argument_list|,
literal|"CHAN"
argument_list|,
literal|"RATE"
argument_list|,
literal|" S:N"
argument_list|,
literal|"INT"
argument_list|,
literal|"CAPS"
argument_list|)
expr_stmt|;
name|cp
operator|=
name|buf
expr_stmt|;
do|do
block|{
specifier|const
name|struct
name|ieee80211req_scan_result
modifier|*
name|sr
decl_stmt|;
specifier|const
name|uint8_t
modifier|*
name|vp
decl_stmt|;
name|sr
operator|=
operator|(
specifier|const
expr|struct
name|ieee80211req_scan_result
operator|*
operator|)
name|cp
expr_stmt|;
name|vp
operator|=
name|cp
operator|+
name|sr
operator|->
name|isr_ie_off
expr_stmt|;
name|printf
argument_list|(
literal|"%-*.*s  %s  %3d  %3dM %3d:%-3d  %3d %-4.4s"
argument_list|,
name|ssidmax
argument_list|,
name|copy_essid
argument_list|(
name|ssid
argument_list|,
name|ssidmax
argument_list|,
name|vp
argument_list|,
name|sr
operator|->
name|isr_ssid_len
argument_list|)
argument_list|,
name|ssid
argument_list|,
name|ether_ntoa
argument_list|(
operator|(
specifier|const
expr|struct
name|ether_addr
operator|*
operator|)
name|sr
operator|->
name|isr_bssid
argument_list|)
argument_list|,
name|ieee80211_mhz2ieee
argument_list|(
name|sr
operator|->
name|isr_freq
argument_list|,
name|sr
operator|->
name|isr_flags
argument_list|)
argument_list|,
name|getmaxrate
argument_list|(
name|sr
operator|->
name|isr_rates
argument_list|,
name|sr
operator|->
name|isr_nrates
argument_list|)
argument_list|,
operator|(
name|sr
operator|->
name|isr_rssi
operator|/
literal|2
operator|)
operator|+
name|sr
operator|->
name|isr_noise
argument_list|,
name|sr
operator|->
name|isr_noise
argument_list|,
name|sr
operator|->
name|isr_intval
argument_list|,
name|getcaps
argument_list|(
name|sr
operator|->
name|isr_capinfo
argument_list|)
argument_list|)
expr_stmt|;
name|printies
argument_list|(
name|vp
operator|+
name|sr
operator|->
name|isr_ssid_len
argument_list|,
name|sr
operator|->
name|isr_ie_len
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|cp
operator|+=
name|sr
operator|->
name|isr_len
operator|,
name|len
operator|-=
name|sr
operator|->
name|isr_len
expr_stmt|;
block|}
do|while
condition|(
name|len
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_scan_result
argument_list|)
condition|)
do|;
block|}
end_function

begin_include
include|#
directive|include
file|<net80211/ieee80211_freebsd.h>
end_include

begin_function
specifier|static
name|void
name|scan_and_wait
parameter_list|(
name|int
name|s
parameter_list|)
block|{
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
name|int
name|sroute
decl_stmt|;
name|sroute
operator|=
name|socket
argument_list|(
name|PF_ROUTE
argument_list|,
name|SOCK_RAW
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|sroute
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"socket(PF_ROUTE,SOCK_RAW)"
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|)
argument_list|)
expr_stmt|;
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_SCAN_REQ
expr_stmt|;
comment|/* NB: only root can trigger a scan so ignore errors */
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCS80211
argument_list|,
operator|&
name|ireq
argument_list|)
operator|>=
literal|0
condition|)
block|{
name|char
name|buf
index|[
literal|2048
index|]
decl_stmt|;
name|struct
name|if_announcemsghdr
modifier|*
name|ifan
decl_stmt|;
name|struct
name|rt_msghdr
modifier|*
name|rtm
decl_stmt|;
do|do
block|{
if|if
condition|(
name|read
argument_list|(
name|sroute
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"read(PF_ROUTE)"
argument_list|)
expr_stmt|;
break|break;
block|}
name|rtm
operator|=
operator|(
expr|struct
name|rt_msghdr
operator|*
operator|)
name|buf
expr_stmt|;
if|if
condition|(
name|rtm
operator|->
name|rtm_version
operator|!=
name|RTM_VERSION
condition|)
break|break;
name|ifan
operator|=
operator|(
expr|struct
name|if_announcemsghdr
operator|*
operator|)
name|rtm
expr_stmt|;
block|}
do|while
condition|(
name|rtm
operator|->
name|rtm_type
operator|!=
name|RTM_IEEE80211
operator|||
name|ifan
operator|->
name|ifan_what
operator|!=
name|RTM_IEEE80211_SCAN
condition|)
do|;
block|}
name|close
argument_list|(
name|sroute
argument_list|)
expr_stmt|;
block|}
end_function

begin_expr_stmt
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211scan
argument_list|,
argument|val
argument_list|,
argument|d
argument_list|)
block|{
name|scan_and_wait
argument_list|(
name|s
argument_list|)
block|;
name|list_scan
argument_list|(
name|s
argument_list|)
block|; }
specifier|static
expr|enum
name|ieee80211_opmode
name|get80211opmode
argument_list|(
argument|int s
argument_list|)
expr_stmt|;
end_expr_stmt

begin_function
specifier|static
name|int
name|gettxseq
parameter_list|(
specifier|const
name|struct
name|ieee80211req_sta_info
modifier|*
name|si
parameter_list|)
block|{
define|#
directive|define
name|IEEE80211_NODE_QOS
value|0x0002
comment|/* QoS enabled */
name|int
name|i
decl_stmt|,
name|txseq
decl_stmt|;
if|if
condition|(
operator|(
name|si
operator|->
name|isi_state
operator|&
name|IEEE80211_NODE_QOS
operator|)
operator|==
literal|0
condition|)
return|return
name|si
operator|->
name|isi_txseqs
index|[
literal|0
index|]
return|;
comment|/* XXX not right but usually what folks want */
name|txseq
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IEEE80211_TID_SIZE
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|si
operator|->
name|isi_txseqs
index|[
name|i
index|]
operator|>
name|txseq
condition|)
name|txseq
operator|=
name|si
operator|->
name|isi_txseqs
index|[
name|i
index|]
expr_stmt|;
return|return
name|txseq
return|;
undef|#
directive|undef
name|IEEE80211_NODE_QOS
block|}
end_function

begin_function
specifier|static
name|int
name|getrxseq
parameter_list|(
specifier|const
name|struct
name|ieee80211req_sta_info
modifier|*
name|si
parameter_list|)
block|{
define|#
directive|define
name|IEEE80211_NODE_QOS
value|0x0002
comment|/* QoS enabled */
name|int
name|i
decl_stmt|,
name|rxseq
decl_stmt|;
if|if
condition|(
operator|(
name|si
operator|->
name|isi_state
operator|&
name|IEEE80211_NODE_QOS
operator|)
operator|==
literal|0
condition|)
return|return
name|si
operator|->
name|isi_rxseqs
index|[
literal|0
index|]
return|;
comment|/* XXX not right but usually what folks want */
name|rxseq
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IEEE80211_TID_SIZE
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|si
operator|->
name|isi_rxseqs
index|[
name|i
index|]
operator|>
name|rxseq
condition|)
name|rxseq
operator|=
name|si
operator|->
name|isi_rxseqs
index|[
name|i
index|]
expr_stmt|;
return|return
name|rxseq
return|;
undef|#
directive|undef
name|IEEE80211_NODE_QOS
block|}
end_function

begin_function
specifier|static
name|int
name|gettxrate
parameter_list|(
name|int
name|txrate
parameter_list|,
name|int
name|chanflags
parameter_list|)
block|{
if|if
condition|(
name|txrate
operator|&
literal|0x80
condition|)
block|{
name|txrate
operator|=
name|htrates
index|[
name|txrate
operator|&
literal|0xf
index|]
expr_stmt|;
comment|/* NB: could bump this more based on short gi */
return|return
name|chanflags
operator|&
name|IEEE80211_CHAN_HT40
condition|?
name|txrate
else|:
name|txrate
operator|/
literal|2
return|;
block|}
else|else
return|return
operator|(
name|txrate
operator|&
name|IEEE80211_RATE_VAL
operator|)
operator|/
literal|2
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|list_stations
parameter_list|(
name|int
name|s
parameter_list|)
block|{
union|union
block|{
name|struct
name|ieee80211req_sta_req
name|req
decl_stmt|;
name|uint8_t
name|buf
index|[
literal|24
operator|*
literal|1024
index|]
decl_stmt|;
block|}
name|u
union|;
name|enum
name|ieee80211_opmode
name|opmode
init|=
name|get80211opmode
argument_list|(
name|s
argument_list|)
decl_stmt|;
specifier|const
name|uint8_t
modifier|*
name|cp
decl_stmt|;
name|int
name|len
decl_stmt|;
comment|/* broadcast address =>'s get all stations */
operator|(
name|void
operator|)
name|memset
argument_list|(
name|u
operator|.
name|req
operator|.
name|is_u
operator|.
name|macaddr
argument_list|,
literal|0xff
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|opmode
operator|==
name|IEEE80211_M_STA
condition|)
block|{
comment|/* 		 * Get information about the associated AP. 		 */
operator|(
name|void
operator|)
name|get80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BSSID
argument_list|,
name|u
operator|.
name|req
operator|.
name|is_u
operator|.
name|macaddr
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211len
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_STA_INFO
argument_list|,
operator|&
name|u
argument_list|,
sizeof|sizeof
argument_list|(
name|u
argument_list|)
argument_list|,
operator|&
name|len
argument_list|)
operator|<
literal|0
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unable to get station information"
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_sta_info
argument_list|)
condition|)
return|return;
name|getchaninfo
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%-17.17s %4s %4s %4s %4s %4s %6s %6s %4s %4s\n"
argument_list|,
literal|"ADDR"
argument_list|,
literal|"AID"
argument_list|,
literal|"CHAN"
argument_list|,
literal|"RATE"
argument_list|,
literal|"RSSI"
argument_list|,
literal|"IDLE"
argument_list|,
literal|"TXSEQ"
argument_list|,
literal|"RXSEQ"
argument_list|,
literal|"CAPS"
argument_list|,
literal|"FLAG"
argument_list|)
expr_stmt|;
name|cp
operator|=
operator|(
specifier|const
name|uint8_t
operator|*
operator|)
name|u
operator|.
name|req
operator|.
name|info
expr_stmt|;
do|do
block|{
specifier|const
name|struct
name|ieee80211req_sta_info
modifier|*
name|si
decl_stmt|;
name|si
operator|=
operator|(
specifier|const
expr|struct
name|ieee80211req_sta_info
operator|*
operator|)
name|cp
expr_stmt|;
if|if
condition|(
name|si
operator|->
name|isi_len
operator|<
sizeof|sizeof
argument_list|(
operator|*
name|si
argument_list|)
condition|)
break|break;
name|printf
argument_list|(
literal|"%s %4u %4d %3dM %3.1f %4d %6d %6d %-4.4s %-4.4s"
argument_list|,
name|ether_ntoa
argument_list|(
operator|(
specifier|const
expr|struct
name|ether_addr
operator|*
operator|)
name|si
operator|->
name|isi_macaddr
argument_list|)
argument_list|,
name|IEEE80211_AID
argument_list|(
name|si
operator|->
name|isi_associd
argument_list|)
argument_list|,
name|ieee80211_mhz2ieee
argument_list|(
name|si
operator|->
name|isi_freq
argument_list|,
name|si
operator|->
name|isi_flags
argument_list|)
argument_list|,
name|gettxrate
argument_list|(
name|si
operator|->
name|isi_txrate
argument_list|,
name|si
operator|->
name|isi_flags
argument_list|)
argument_list|,
name|si
operator|->
name|isi_rssi
operator|/
literal|2.
argument_list|,
name|si
operator|->
name|isi_inact
argument_list|,
name|gettxseq
argument_list|(
name|si
argument_list|)
argument_list|,
name|getrxseq
argument_list|(
name|si
argument_list|)
argument_list|,
name|getcaps
argument_list|(
name|si
operator|->
name|isi_capinfo
argument_list|)
argument_list|,
name|getflags
argument_list|(
name|si
operator|->
name|isi_state
argument_list|)
argument_list|)
expr_stmt|;
name|printies
argument_list|(
name|cp
operator|+
name|si
operator|->
name|isi_ie_off
argument_list|,
name|si
operator|->
name|isi_ie_len
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|cp
operator|+=
name|si
operator|->
name|isi_len
operator|,
name|len
operator|-=
name|si
operator|->
name|isi_len
expr_stmt|;
block|}
do|while
condition|(
name|len
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_sta_info
argument_list|)
condition|)
do|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|get_chaninfo
parameter_list|(
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|c
parameter_list|,
name|int
name|precise
parameter_list|,
name|char
name|buf
index|[]
parameter_list|,
name|size_t
name|bsize
parameter_list|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|IEEE80211_IS_CHAN_FHSS
argument_list|(
name|c
argument_list|)
condition|)
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" FHSS"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|IEEE80211_IS_CHAN_A
argument_list|(
name|c
argument_list|)
condition|)
block|{
if|if
condition|(
name|IEEE80211_IS_CHAN_HALF
argument_list|(
name|c
argument_list|)
condition|)
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" 11a/10Mhz"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|IEEE80211_IS_CHAN_QUARTER
argument_list|(
name|c
argument_list|)
condition|)
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" 11a/5Mhz"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
else|else
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" 11a"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|IEEE80211_IS_CHAN_ANYG
argument_list|(
name|c
argument_list|)
condition|)
block|{
if|if
condition|(
name|IEEE80211_IS_CHAN_HALF
argument_list|(
name|c
argument_list|)
condition|)
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" 11g/10Mhz"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|IEEE80211_IS_CHAN_QUARTER
argument_list|(
name|c
argument_list|)
condition|)
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" 11g/5Mhz"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
else|else
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" 11g"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IEEE80211_IS_CHAN_B
argument_list|(
name|c
argument_list|)
condition|)
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" 11b"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|IEEE80211_IS_CHAN_TURBO
argument_list|(
name|c
argument_list|)
condition|)
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" Turbo"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|precise
condition|)
block|{
if|if
condition|(
name|IEEE80211_IS_CHAN_HT20
argument_list|(
name|c
argument_list|)
condition|)
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" ht/20"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|IEEE80211_IS_CHAN_HT40D
argument_list|(
name|c
argument_list|)
condition|)
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" ht/40-"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|IEEE80211_IS_CHAN_HT40U
argument_list|(
name|c
argument_list|)
condition|)
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" ht/40+"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|IEEE80211_IS_CHAN_HT
argument_list|(
name|c
argument_list|)
condition|)
name|strlcat
argument_list|(
name|buf
argument_list|,
literal|" ht"
argument_list|,
name|bsize
argument_list|)
expr_stmt|;
block|}
return|return
name|buf
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_chaninfo
parameter_list|(
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|c
parameter_list|,
name|int
name|verb
parameter_list|)
block|{
name|char
name|buf
index|[
literal|14
index|]
decl_stmt|;
name|printf
argument_list|(
literal|"Channel %3u : %u%c Mhz%-14.14s"
argument_list|,
name|ieee80211_mhz2ieee
argument_list|(
name|c
operator|->
name|ic_freq
argument_list|,
name|c
operator|->
name|ic_flags
argument_list|)
argument_list|,
name|c
operator|->
name|ic_freq
argument_list|,
name|IEEE80211_IS_CHAN_PASSIVE
argument_list|(
name|c
argument_list|)
condition|?
literal|'*'
else|:
literal|' '
argument_list|,
name|get_chaninfo
argument_list|(
name|c
argument_list|,
name|verb
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_channels
parameter_list|(
name|int
name|s
parameter_list|,
specifier|const
name|struct
name|ieee80211req_chaninfo
modifier|*
name|chans
parameter_list|,
name|int
name|allchans
parameter_list|,
name|int
name|verb
parameter_list|)
block|{
name|struct
name|ieee80211req_chaninfo
name|achans
decl_stmt|;
name|uint8_t
name|reported
index|[
name|IEEE80211_CHAN_BYTES
index|]
decl_stmt|;
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|c
decl_stmt|;
name|int
name|i
decl_stmt|,
name|half
decl_stmt|;
name|memset
argument_list|(
operator|&
name|achans
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|achans
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|reported
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|reported
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|allchans
condition|)
block|{
name|struct
name|ieee80211req_chanlist
name|active
decl_stmt|;
if|if
condition|(
name|get80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_CHANLIST
argument_list|,
operator|&
name|active
argument_list|,
sizeof|sizeof
argument_list|(
name|active
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unable to get active channel list"
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|achans
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|achans
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|chans
operator|->
name|ic_nchans
condition|;
name|i
operator|++
control|)
block|{
name|c
operator|=
operator|&
name|chans
operator|->
name|ic_chans
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
operator|!
name|isset
argument_list|(
name|active
operator|.
name|ic_channels
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|)
condition|)
continue|continue;
comment|/* 			 * Suppress compatible duplicates unless 			 * verbose.  The kernel gives us it's 			 * complete channel list which has separate 			 * entries for 11g/11b and 11a/turbo. 			 */
if|if
condition|(
name|isset
argument_list|(
name|reported
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|)
operator|&&
operator|!
name|verb
condition|)
block|{
comment|/* XXX we assume duplicates are adjacent */
name|achans
operator|.
name|ic_chans
index|[
name|achans
operator|.
name|ic_nchans
operator|-
literal|1
index|]
operator|=
operator|*
name|c
expr_stmt|;
block|}
else|else
block|{
name|achans
operator|.
name|ic_chans
index|[
name|achans
operator|.
name|ic_nchans
operator|++
index|]
operator|=
operator|*
name|c
expr_stmt|;
name|setbit
argument_list|(
name|reported
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|chans
operator|->
name|ic_nchans
condition|;
name|i
operator|++
control|)
block|{
name|c
operator|=
operator|&
name|chans
operator|->
name|ic_chans
index|[
name|i
index|]
expr_stmt|;
comment|/* suppress duplicates as above */
if|if
condition|(
name|isset
argument_list|(
name|reported
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|)
operator|&&
operator|!
name|verb
condition|)
block|{
comment|/* XXX we assume duplicates are adjacent */
name|achans
operator|.
name|ic_chans
index|[
name|achans
operator|.
name|ic_nchans
operator|-
literal|1
index|]
operator|=
operator|*
name|c
expr_stmt|;
block|}
else|else
block|{
name|achans
operator|.
name|ic_chans
index|[
name|achans
operator|.
name|ic_nchans
operator|++
index|]
operator|=
operator|*
name|c
expr_stmt|;
name|setbit
argument_list|(
name|reported
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|half
operator|=
name|achans
operator|.
name|ic_nchans
operator|/
literal|2
expr_stmt|;
if|if
condition|(
name|achans
operator|.
name|ic_nchans
operator|%
literal|2
condition|)
name|half
operator|++
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|achans
operator|.
name|ic_nchans
operator|/
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|print_chaninfo
argument_list|(
operator|&
name|achans
operator|.
name|ic_chans
index|[
name|i
index|]
argument_list|,
name|verb
argument_list|)
expr_stmt|;
name|print_chaninfo
argument_list|(
operator|&
name|achans
operator|.
name|ic_chans
index|[
name|half
operator|+
name|i
index|]
argument_list|,
name|verb
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|achans
operator|.
name|ic_nchans
operator|%
literal|2
condition|)
block|{
name|print_chaninfo
argument_list|(
operator|&
name|achans
operator|.
name|ic_chans
index|[
name|i
index|]
argument_list|,
name|verb
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|list_channels
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|allchans
parameter_list|)
block|{
name|getchaninfo
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|print_channels
argument_list|(
name|s
argument_list|,
operator|&
name|chaninfo
argument_list|,
name|allchans
argument_list|,
name|verbose
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_txpow
parameter_list|(
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|c
parameter_list|)
block|{
name|printf
argument_list|(
literal|"Channel %3u : %u Mhz %3.1f reg %2d  "
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|,
name|c
operator|->
name|ic_freq
argument_list|,
name|c
operator|->
name|ic_maxpower
operator|/
literal|2.
argument_list|,
name|c
operator|->
name|ic_maxregpower
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_txpow_verbose
parameter_list|(
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|c
parameter_list|)
block|{
name|print_chaninfo
argument_list|(
name|c
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"min %4.1f dBm  max %3.1f dBm  reg %2d dBm"
argument_list|,
name|c
operator|->
name|ic_minpower
operator|/
literal|2.
argument_list|,
name|c
operator|->
name|ic_maxpower
operator|/
literal|2.
argument_list|,
name|c
operator|->
name|ic_maxregpower
argument_list|)
expr_stmt|;
comment|/* indicate where regulatory cap limits power use */
if|if
condition|(
name|c
operator|->
name|ic_maxpower
operator|>
literal|2
operator|*
name|c
operator|->
name|ic_maxregpower
condition|)
name|printf
argument_list|(
literal|"<"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|list_txpow
parameter_list|(
name|int
name|s
parameter_list|)
block|{
name|struct
name|ieee80211req_chaninfo
name|achans
decl_stmt|;
name|uint8_t
name|reported
index|[
name|IEEE80211_CHAN_BYTES
index|]
decl_stmt|;
name|struct
name|ieee80211_channel
modifier|*
name|c
decl_stmt|,
modifier|*
name|prev
decl_stmt|;
name|int
name|i
decl_stmt|,
name|half
decl_stmt|;
name|getchaninfo
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|achans
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|achans
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|reported
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|reported
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|chaninfo
operator|.
name|ic_nchans
condition|;
name|i
operator|++
control|)
block|{
name|c
operator|=
operator|&
name|chaninfo
operator|.
name|ic_chans
index|[
name|i
index|]
expr_stmt|;
comment|/* suppress duplicates as above */
if|if
condition|(
name|isset
argument_list|(
name|reported
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|)
operator|&&
operator|!
name|verbose
condition|)
block|{
comment|/* XXX we assume duplicates are adjacent */
name|prev
operator|=
operator|&
name|achans
operator|.
name|ic_chans
index|[
name|achans
operator|.
name|ic_nchans
operator|-
literal|1
index|]
expr_stmt|;
comment|/* display highest power on channel */
if|if
condition|(
name|c
operator|->
name|ic_maxpower
operator|>
name|prev
operator|->
name|ic_maxpower
condition|)
operator|*
name|prev
operator|=
operator|*
name|c
expr_stmt|;
block|}
else|else
block|{
name|achans
operator|.
name|ic_chans
index|[
name|achans
operator|.
name|ic_nchans
operator|++
index|]
operator|=
operator|*
name|c
expr_stmt|;
name|setbit
argument_list|(
name|reported
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|verbose
condition|)
block|{
name|half
operator|=
name|achans
operator|.
name|ic_nchans
operator|/
literal|2
expr_stmt|;
if|if
condition|(
name|achans
operator|.
name|ic_nchans
operator|%
literal|2
condition|)
name|half
operator|++
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|achans
operator|.
name|ic_nchans
operator|/
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|print_txpow
argument_list|(
operator|&
name|achans
operator|.
name|ic_chans
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|print_txpow
argument_list|(
operator|&
name|achans
operator|.
name|ic_chans
index|[
name|half
operator|+
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|achans
operator|.
name|ic_nchans
operator|%
literal|2
condition|)
block|{
name|print_txpow
argument_list|(
operator|&
name|achans
operator|.
name|ic_chans
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|achans
operator|.
name|ic_nchans
condition|;
name|i
operator|++
control|)
block|{
name|print_txpow_verbose
argument_list|(
operator|&
name|achans
operator|.
name|ic_chans
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|list_keys
parameter_list|(
name|int
name|s
parameter_list|)
block|{ }
end_function

begin_define
define|#
directive|define
name|IEEE80211_C_BITS
define|\
value|"\020\1WEP\2TKIP\3AES\4AES_CCM\6CKIP\7FF\10TURBOP\11IBSS\12PMGT\13HOSTAP\14AHDEMO" \ "\15SWRETRY\16TXPMGT\17SHSLOT\20SHPREAMBLE\21MONITOR\22TKIPMIC\30WPA1" \ "\31WPA2\32BURST\33WME\34WDS\36BGSCAN\37TXFRAG"
end_define

begin_function
specifier|static
name|void
name|list_capabilities
parameter_list|(
name|int
name|s
parameter_list|)
block|{
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
name|u_int32_t
name|caps
decl_stmt|;
operator|(
name|void
operator|)
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|)
argument_list|)
expr_stmt|;
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_DRIVER_CAPS
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|ireq
argument_list|)
operator|<
literal|0
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unable to get driver capabilities"
argument_list|)
expr_stmt|;
name|caps
operator|=
operator|(
operator|(
operator|(
name|u_int16_t
operator|)
name|ireq
operator|.
name|i_val
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|u_int16_t
operator|)
name|ireq
operator|.
name|i_len
operator|)
expr_stmt|;
name|printb
argument_list|(
name|name
argument_list|,
name|caps
argument_list|,
name|IEEE80211_C_BITS
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|get80211wme
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|param
parameter_list|,
name|int
name|ac
parameter_list|,
name|int
modifier|*
name|val
parameter_list|)
block|{
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
operator|(
name|void
operator|)
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|)
argument_list|)
expr_stmt|;
name|ireq
operator|.
name|i_type
operator|=
name|param
expr_stmt|;
name|ireq
operator|.
name|i_len
operator|=
name|ac
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|ireq
argument_list|)
operator|<
literal|0
condition|)
block|{
name|warn
argument_list|(
literal|"cannot get WME parameter %d, ac %d%s"
argument_list|,
name|param
argument_list|,
name|ac
operator|&
name|IEEE80211_WMEPARAM_VAL
argument_list|,
name|ac
operator|&
name|IEEE80211_WMEPARAM_BSS
condition|?
literal|" (BSS)"
else|:
literal|""
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
operator|*
name|val
operator|=
name|ireq
operator|.
name|i_val
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|list_wme
parameter_list|(
name|int
name|s
parameter_list|)
block|{
specifier|static
specifier|const
name|char
modifier|*
name|acnames
index|[]
init|=
block|{
literal|"AC_BE"
block|,
literal|"AC_BK"
block|,
literal|"AC_VI"
block|,
literal|"AC_VO"
block|}
decl_stmt|;
name|int
name|ac
decl_stmt|,
name|val
decl_stmt|;
for|for
control|(
name|ac
operator|=
name|WME_AC_BE
init|;
name|ac
operator|<=
name|WME_AC_VO
condition|;
name|ac
operator|++
control|)
block|{
name|again
label|:
if|if
condition|(
name|ac
operator|&
name|IEEE80211_WMEPARAM_BSS
condition|)
name|printf
argument_list|(
literal|"\t%s"
argument_list|,
literal|"     "
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\t%s"
argument_list|,
name|acnames
index|[
name|ac
index|]
argument_list|)
expr_stmt|;
comment|/* show WME BSS parameters */
if|if
condition|(
name|get80211wme
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_CWMIN
argument_list|,
name|ac
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|printf
argument_list|(
literal|" cwmin %2u"
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211wme
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_CWMAX
argument_list|,
name|ac
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|printf
argument_list|(
literal|" cwmax %2u"
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211wme
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_AIFS
argument_list|,
name|ac
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|printf
argument_list|(
literal|" aifs %2u"
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211wme
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_TXOPLIMIT
argument_list|,
name|ac
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|printf
argument_list|(
literal|" txopLimit %3u"
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211wme
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_ACM
argument_list|,
name|ac
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
condition|)
name|printf
argument_list|(
literal|" acm"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|printf
argument_list|(
literal|" -acm"
argument_list|)
expr_stmt|;
block|}
comment|/* !BSS only */
if|if
condition|(
operator|(
name|ac
operator|&
name|IEEE80211_WMEPARAM_BSS
operator|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|get80211wme
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME_ACKPOLICY
argument_list|,
name|ac
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|val
condition|)
name|printf
argument_list|(
literal|" -ack"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|printf
argument_list|(
literal|" ack"
argument_list|)
expr_stmt|;
block|}
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ac
operator|&
name|IEEE80211_WMEPARAM_BSS
operator|)
operator|==
literal|0
condition|)
block|{
name|ac
operator||=
name|IEEE80211_WMEPARAM_BSS
expr_stmt|;
goto|goto
name|again
goto|;
block|}
else|else
name|ac
operator|&=
operator|~
name|IEEE80211_WMEPARAM_BSS
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|printpolicy
parameter_list|(
name|int
name|policy
parameter_list|)
block|{
switch|switch
condition|(
name|policy
condition|)
block|{
case|case
name|IEEE80211_MACCMD_POLICY_OPEN
case|:
name|printf
argument_list|(
literal|"policy: open\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_MACCMD_POLICY_ALLOW
case|:
name|printf
argument_list|(
literal|"policy: allow\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_MACCMD_POLICY_DENY
case|:
name|printf
argument_list|(
literal|"policy: deny\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"policy: unknown (%u)\n"
argument_list|,
name|policy
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|list_mac
parameter_list|(
name|int
name|s
parameter_list|)
block|{
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
name|struct
name|ieee80211req_maclist
modifier|*
name|acllist
decl_stmt|;
name|int
name|i
decl_stmt|,
name|nacls
decl_stmt|,
name|policy
decl_stmt|,
name|len
decl_stmt|;
name|uint8_t
modifier|*
name|data
decl_stmt|;
name|char
name|c
decl_stmt|;
operator|(
name|void
operator|)
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|)
argument_list|)
expr_stmt|;
comment|/* XXX ?? */
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_MACCMD
expr_stmt|;
name|ireq
operator|.
name|i_val
operator|=
name|IEEE80211_MACCMD_POLICY
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|ireq
argument_list|)
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|errno
operator|==
name|EINVAL
condition|)
block|{
name|printf
argument_list|(
literal|"No acl policy loaded\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|err
argument_list|(
literal|1
argument_list|,
literal|"unable to get mac policy"
argument_list|)
expr_stmt|;
block|}
name|policy
operator|=
name|ireq
operator|.
name|i_val
expr_stmt|;
if|if
condition|(
name|policy
operator|==
name|IEEE80211_MACCMD_POLICY_OPEN
condition|)
block|{
name|c
operator|=
literal|'*'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|policy
operator|==
name|IEEE80211_MACCMD_POLICY_ALLOW
condition|)
block|{
name|c
operator|=
literal|'+'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|policy
operator|==
name|IEEE80211_MACCMD_POLICY_DENY
condition|)
block|{
name|c
operator|=
literal|'-'
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"policy: unknown (%u)\n"
argument_list|,
name|policy
argument_list|)
expr_stmt|;
name|c
operator|=
literal|'?'
expr_stmt|;
block|}
if|if
condition|(
name|verbose
operator|||
name|c
operator|==
literal|'?'
condition|)
name|printpolicy
argument_list|(
name|policy
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211len
argument_list|(
name|s
argument_list|,
name|IEEE80211_MACCMD_LIST
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
operator|&
name|len
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"unable to get mac acl list size"
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
block|{
comment|/* NB: no acls */
if|if
condition|(
operator|!
operator|(
name|verbose
operator|||
name|c
operator|==
literal|'?'
operator|)
condition|)
name|printpolicy
argument_list|(
name|policy
argument_list|)
expr_stmt|;
return|return;
block|}
name|data
operator|=
name|malloc
argument_list|(
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|data
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"out of memory for acl list"
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_MACCMD_LIST
argument_list|,
name|data
argument_list|,
name|len
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"unable to get mac acl list"
argument_list|)
expr_stmt|;
name|nacls
operator|=
name|len
operator|/
sizeof|sizeof
argument_list|(
operator|*
name|acllist
argument_list|)
expr_stmt|;
name|acllist
operator|=
operator|(
expr|struct
name|ieee80211req_maclist
operator|*
operator|)
name|data
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nacls
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%c%s\n"
argument_list|,
name|c
argument_list|,
name|ether_ntoa
argument_list|(
operator|(
specifier|const
expr|struct
name|ether_addr
operator|*
operator|)
name|acllist
index|[
name|i
index|]
operator|.
name|ml_macaddr
argument_list|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_expr_stmt
specifier|static
name|DECL_CMD_FUNC
argument_list|(
argument|set80211list
argument_list|,
argument|arg
argument_list|,
argument|d
argument_list|)
block|{
define|#
directive|define
name|iseq
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|(strncasecmp(a,b,sizeof(b)-1) == 0)
name|LINE_INIT
argument_list|(
literal|'\t'
argument_list|)
block|;
if|if
condition|(
name|iseq
argument_list|(
name|arg
argument_list|,
literal|"sta"
argument_list|)
condition|)
name|list_stations
argument_list|(
name|s
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|iseq
argument_list|(
name|arg
argument_list|,
literal|"scan"
argument_list|)
operator|||
name|iseq
argument_list|(
name|arg
argument_list|,
literal|"ap"
argument_list|)
condition|)
name|list_scan
argument_list|(
name|s
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|iseq
argument_list|(
name|arg
argument_list|,
literal|"chan"
argument_list|)
operator|||
name|iseq
argument_list|(
name|arg
argument_list|,
literal|"freq"
argument_list|)
condition|)
name|list_channels
argument_list|(
name|s
argument_list|,
literal|1
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|iseq
argument_list|(
name|arg
argument_list|,
literal|"active"
argument_list|)
condition|)
name|list_channels
argument_list|(
name|s
argument_list|,
literal|0
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|iseq
argument_list|(
name|arg
argument_list|,
literal|"keys"
argument_list|)
condition|)
name|list_keys
argument_list|(
name|s
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|iseq
argument_list|(
name|arg
argument_list|,
literal|"caps"
argument_list|)
condition|)
name|list_capabilities
argument_list|(
name|s
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|iseq
argument_list|(
name|arg
argument_list|,
literal|"wme"
argument_list|)
condition|)
name|list_wme
argument_list|(
name|s
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|iseq
argument_list|(
name|arg
argument_list|,
literal|"mac"
argument_list|)
condition|)
name|list_mac
argument_list|(
name|s
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|iseq
argument_list|(
name|arg
argument_list|,
literal|"txpow"
argument_list|)
condition|)
name|list_txpow
argument_list|(
name|s
argument_list|)
expr_stmt|;
else|else
name|errx
argument_list|(
literal|1
argument_list|,
literal|"Don't know how to list %s for %s"
argument_list|,
name|arg
argument_list|,
name|name
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|iseq
block|}
end_expr_stmt

begin_function
specifier|static
name|enum
name|ieee80211_opmode
name|get80211opmode
parameter_list|(
name|int
name|s
parameter_list|)
block|{
name|struct
name|ifmediareq
name|ifmr
decl_stmt|;
operator|(
name|void
operator|)
name|memset
argument_list|(
operator|&
name|ifmr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ifmr
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|ifmr
operator|.
name|ifm_name
argument_list|,
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|ifmr
operator|.
name|ifm_name
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCGIFMEDIA
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|ifmr
argument_list|)
operator|>=
literal|0
condition|)
block|{
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_ADHOC
condition|)
return|return
name|IEEE80211_M_IBSS
return|;
comment|/* XXX ahdemo */
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_HOSTAP
condition|)
return|return
name|IEEE80211_M_HOSTAP
return|;
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_MONITOR
condition|)
return|return
name|IEEE80211_M_MONITOR
return|;
block|}
return|return
name|IEEE80211_M_STA
return|;
block|}
end_function

begin_if
if|#
directive|if
literal|0
end_if

begin_endif
unit|static void printcipher(int s, struct ieee80211req *ireq, int keylenop) { 	switch (ireq->i_val) { 	case IEEE80211_CIPHER_WEP: 		ireq->i_type = keylenop; 		if (ioctl(s, SIOCG80211, ireq) != -1) 			printf("WEP-%s",  			    ireq->i_len<= 5 ? "40" : 			    ireq->i_len<= 13 ? "104" : "128"); 		else 			printf("WEP"); 		break; 	case IEEE80211_CIPHER_TKIP: 		printf("TKIP"); 		break; 	case IEEE80211_CIPHER_AES_OCB: 		printf("AES-OCB"); 		break; 	case IEEE80211_CIPHER_AES_CCM: 		printf("AES-CCM"); 		break; 	case IEEE80211_CIPHER_CKIP: 		printf("CKIP"); 		break; 	case IEEE80211_CIPHER_NONE: 		printf("NONE"); 		break; 	default: 		printf("UNKNOWN (0x%x)", ireq->i_val); 		break; 	} }
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|printkey
parameter_list|(
specifier|const
name|struct
name|ieee80211req_key
modifier|*
name|ik
parameter_list|)
block|{
specifier|static
specifier|const
name|uint8_t
name|zerodata
index|[
name|IEEE80211_KEYBUF_SIZE
index|]
decl_stmt|;
name|int
name|keylen
init|=
name|ik
operator|->
name|ik_keylen
decl_stmt|;
name|int
name|printcontents
decl_stmt|;
name|printcontents
operator|=
name|printkeys
operator|&&
operator|(
name|memcmp
argument_list|(
name|ik
operator|->
name|ik_keydata
argument_list|,
name|zerodata
argument_list|,
name|keylen
argument_list|)
operator|!=
literal|0
operator|||
name|verbose
operator|)
expr_stmt|;
if|if
condition|(
name|printcontents
condition|)
name|LINE_BREAK
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|ik
operator|->
name|ik_type
condition|)
block|{
case|case
name|IEEE80211_CIPHER_WEP
case|:
comment|/* compatibility */
name|LINE_CHECK
argument_list|(
literal|"wepkey %u:%s"
argument_list|,
name|ik
operator|->
name|ik_keyix
operator|+
literal|1
argument_list|,
name|keylen
operator|<=
literal|5
condition|?
literal|"40-bit"
else|:
name|keylen
operator|<=
literal|13
condition|?
literal|"104-bit"
else|:
literal|"128-bit"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_CIPHER_TKIP
case|:
if|if
condition|(
name|keylen
operator|>
literal|128
operator|/
literal|8
condition|)
name|keylen
operator|-=
literal|128
operator|/
literal|8
expr_stmt|;
comment|/* ignore MIC for now */
name|LINE_CHECK
argument_list|(
literal|"TKIP %u:%u-bit"
argument_list|,
name|ik
operator|->
name|ik_keyix
operator|+
literal|1
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_CIPHER_AES_OCB
case|:
name|LINE_CHECK
argument_list|(
literal|"AES-OCB %u:%u-bit"
argument_list|,
name|ik
operator|->
name|ik_keyix
operator|+
literal|1
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_CIPHER_AES_CCM
case|:
name|LINE_CHECK
argument_list|(
literal|"AES-CCM %u:%u-bit"
argument_list|,
name|ik
operator|->
name|ik_keyix
operator|+
literal|1
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_CIPHER_CKIP
case|:
name|LINE_CHECK
argument_list|(
literal|"CKIP %u:%u-bit"
argument_list|,
name|ik
operator|->
name|ik_keyix
operator|+
literal|1
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_CIPHER_NONE
case|:
name|LINE_CHECK
argument_list|(
literal|"NULL %u:%u-bit"
argument_list|,
name|ik
operator|->
name|ik_keyix
operator|+
literal|1
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
default|default:
name|LINE_CHECK
argument_list|(
literal|"UNKNOWN (0x%x) %u:%u-bit"
argument_list|,
name|ik
operator|->
name|ik_type
argument_list|,
name|ik
operator|->
name|ik_keyix
operator|+
literal|1
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|printcontents
condition|)
block|{
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"<"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|keylen
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%02x"
argument_list|,
name|ik
operator|->
name|ik_keydata
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|">"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ik
operator|->
name|ik_type
operator|!=
name|IEEE80211_CIPHER_WEP
operator|&&
operator|(
name|ik
operator|->
name|ik_keyrsc
operator|!=
literal|0
operator|||
name|verbose
operator|)
condition|)
name|printf
argument_list|(
literal|" rsc %ju"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|ik
operator|->
name|ik_keyrsc
argument_list|)
expr_stmt|;
if|if
condition|(
name|ik
operator|->
name|ik_type
operator|!=
name|IEEE80211_CIPHER_WEP
operator|&&
operator|(
name|ik
operator|->
name|ik_keytsc
operator|!=
literal|0
operator|||
name|verbose
operator|)
condition|)
name|printf
argument_list|(
literal|" tsc %ju"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|ik
operator|->
name|ik_keytsc
argument_list|)
expr_stmt|;
if|if
condition|(
name|ik
operator|->
name|ik_flags
operator|!=
literal|0
operator|&&
name|verbose
condition|)
block|{
specifier|const
name|char
modifier|*
name|sep
init|=
literal|" "
decl_stmt|;
if|if
condition|(
name|ik
operator|->
name|ik_flags
operator|&
name|IEEE80211_KEY_XMIT
condition|)
name|printf
argument_list|(
literal|"%stx"
argument_list|,
name|sep
argument_list|)
operator|,
name|sep
operator|=
literal|"+"
expr_stmt|;
if|if
condition|(
name|ik
operator|->
name|ik_flags
operator|&
name|IEEE80211_KEY_RECV
condition|)
name|printf
argument_list|(
literal|"%srx"
argument_list|,
name|sep
argument_list|)
operator|,
name|sep
operator|=
literal|"+"
expr_stmt|;
if|if
condition|(
name|ik
operator|->
name|ik_flags
operator|&
name|IEEE80211_KEY_DEFAULT
condition|)
name|printf
argument_list|(
literal|"%sdef"
argument_list|,
name|sep
argument_list|)
operator|,
name|sep
operator|=
literal|"+"
expr_stmt|;
block|}
name|LINE_BREAK
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|printrate
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
name|int
name|v
parameter_list|,
name|int
name|defrate
parameter_list|,
name|int
name|defmcs
parameter_list|)
block|{
if|if
condition|(
name|v
operator|==
literal|11
condition|)
name|LINE_CHECK
argument_list|(
literal|"%s 5.5"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|v
operator|&
literal|0x80
condition|)
block|{
if|if
condition|(
name|v
operator|!=
name|defmcs
condition|)
name|LINE_CHECK
argument_list|(
literal|"%s %d"
argument_list|,
name|tag
argument_list|,
name|v
operator|&
operator|~
literal|0x80
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|v
operator|!=
name|defrate
condition|)
name|LINE_CHECK
argument_list|(
literal|"%s %d"
argument_list|,
name|tag
argument_list|,
name|v
operator|/
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|getssid
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|ix
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|,
name|int
modifier|*
name|plen
parameter_list|)
block|{
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
operator|(
name|void
operator|)
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|)
argument_list|)
expr_stmt|;
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_SSID
expr_stmt|;
name|ireq
operator|.
name|i_val
operator|=
name|ix
expr_stmt|;
name|ireq
operator|.
name|i_data
operator|=
name|data
expr_stmt|;
name|ireq
operator|.
name|i_len
operator|=
name|len
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|ireq
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
operator|*
name|plen
operator|=
name|ireq
operator|.
name|i_len
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|printrssi
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
name|int
name|rssi
parameter_list|)
block|{
if|if
condition|(
name|rssi
operator|&
literal|1
condition|)
name|LINE_CHECK
argument_list|(
literal|"%s %u.5"
argument_list|,
name|tag
argument_list|,
name|rssi
operator|/
literal|2
argument_list|)
expr_stmt|;
else|else
name|LINE_CHECK
argument_list|(
literal|"%s %u"
argument_list|,
name|tag
argument_list|,
name|rssi
operator|/
literal|2
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ieee80211_status
parameter_list|(
name|int
name|s
parameter_list|)
block|{
specifier|static
specifier|const
name|uint8_t
name|zerobssid
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|enum
name|ieee80211_opmode
name|opmode
init|=
name|get80211opmode
argument_list|(
name|s
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|,
name|num
decl_stmt|,
name|wpa
decl_stmt|,
name|wme
decl_stmt|,
name|bgscan
decl_stmt|,
name|bgscaninterval
decl_stmt|,
name|val
decl_stmt|,
name|len
decl_stmt|,
name|wepmode
decl_stmt|;
name|uint8_t
name|data
index|[
literal|32
index|]
decl_stmt|;
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|c
decl_stmt|;
if|if
condition|(
name|getssid
argument_list|(
name|s
argument_list|,
operator|-
literal|1
argument_list|,
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|,
operator|&
name|len
argument_list|)
operator|<
literal|0
condition|)
block|{
comment|/* If we can't get the SSID, this isn't an 802.11 device. */
return|return;
block|}
comment|/* 	 * Invalidate cached state so printing status for multiple 	 * if's doesn't reuse the first interfaces' cached state. 	 */
name|gotcurchan
operator|=
literal|0
expr_stmt|;
name|gothtconf
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_NUMSSIDS
argument_list|,
operator|&
name|num
argument_list|)
operator|<
literal|0
condition|)
name|num
operator|=
literal|0
expr_stmt|;
name|printf
argument_list|(
literal|"\tssid "
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|>
literal|1
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|getssid
argument_list|(
name|s
argument_list|,
name|i
argument_list|,
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|,
operator|&
name|len
argument_list|)
operator|>=
literal|0
operator|&&
name|len
operator|>
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|" %d:"
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|data
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
name|print_string
argument_list|(
name|data
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|c
operator|=
name|getcurchan
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|->
name|ic_freq
operator|!=
name|IEEE80211_CHAN_ANY
condition|)
block|{
name|char
name|buf
index|[
literal|14
index|]
decl_stmt|;
name|printf
argument_list|(
literal|" channel %d (%u Mhz%s)"
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|,
name|c
operator|->
name|ic_freq
argument_list|,
name|get_chaninfo
argument_list|(
name|c
argument_list|,
literal|1
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|verbose
condition|)
name|printf
argument_list|(
literal|" channel UNDEF"
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BSSID
argument_list|,
name|data
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|>=
literal|0
operator|&&
operator|(
name|memcmp
argument_list|(
name|data
argument_list|,
name|zerobssid
argument_list|,
sizeof|sizeof
argument_list|(
name|zerobssid
argument_list|)
argument_list|)
operator|!=
literal|0
operator|||
name|verbose
operator|)
condition|)
name|printf
argument_list|(
literal|" bssid %s"
argument_list|,
name|ether_ntoa
argument_list|(
operator|(
expr|struct
name|ether_addr
operator|*
operator|)
name|data
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211len
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_STATIONNAME
argument_list|,
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|,
operator|&
name|len
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"\n\tstationname "
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|data
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
name|spacer
operator|=
literal|' '
expr_stmt|;
comment|/* force first break */
name|LINE_BREAK
argument_list|()
expr_stmt|;
name|wpa
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AUTHMODE
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_AUTH_NONE
case|:
name|LINE_CHECK
argument_list|(
literal|"authmode NONE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_AUTH_OPEN
case|:
name|LINE_CHECK
argument_list|(
literal|"authmode OPEN"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_AUTH_SHARED
case|:
name|LINE_CHECK
argument_list|(
literal|"authmode SHARED"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_AUTH_8021X
case|:
name|LINE_CHECK
argument_list|(
literal|"authmode 802.1x"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_AUTH_WPA
case|:
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WPA
argument_list|,
operator|&
name|wpa
argument_list|)
operator|<
literal|0
condition|)
name|wpa
operator|=
literal|1
expr_stmt|;
comment|/* default to WPA1 */
switch|switch
condition|(
name|wpa
condition|)
block|{
case|case
literal|2
case|:
name|LINE_CHECK
argument_list|(
literal|"authmode WPA2/802.11i"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|LINE_CHECK
argument_list|(
literal|"authmode WPA1+WPA2/802.11i"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|LINE_CHECK
argument_list|(
literal|"authmode WPA"
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|IEEE80211_AUTH_AUTO
case|:
name|LINE_CHECK
argument_list|(
literal|"authmode AUTO"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|LINE_CHECK
argument_list|(
literal|"authmode UNKNOWN (0x%x)"
argument_list|,
name|val
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|wpa
operator|||
name|verbose
condition|)
block|{
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_COUNTERMEASURES
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"countermeasures"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"-countermeasures"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEP
argument_list|,
operator|&
name|wepmode
argument_list|)
operator|!=
operator|-
literal|1
operator|&&
name|wepmode
operator|!=
name|IEEE80211_WEP_NOSUP
condition|)
block|{
name|int
name|firstkey
decl_stmt|;
switch|switch
condition|(
name|wepmode
condition|)
block|{
case|case
name|IEEE80211_WEP_OFF
case|:
name|LINE_CHECK
argument_list|(
literal|"privacy OFF"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_WEP_ON
case|:
name|LINE_CHECK
argument_list|(
literal|"privacy ON"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_WEP_MIXED
case|:
name|LINE_CHECK
argument_list|(
literal|"privacy MIXED"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|LINE_CHECK
argument_list|(
literal|"privacy UNKNOWN (0x%x)"
argument_list|,
name|wepmode
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* 		 * If we get here then we've got WEP support so we need 		 * to print WEP status. 		 */
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WEPTXKEY
argument_list|,
operator|&
name|val
argument_list|)
operator|<
literal|0
condition|)
block|{
name|warn
argument_list|(
literal|"WEP support, but no tx key!"
argument_list|)
expr_stmt|;
goto|goto
name|end
goto|;
block|}
if|if
condition|(
name|val
operator|!=
operator|-
literal|1
condition|)
name|LINE_CHECK
argument_list|(
literal|"deftxkey %d"
argument_list|,
name|val
operator|+
literal|1
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|wepmode
operator|!=
name|IEEE80211_WEP_OFF
operator|||
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"deftxkey UNDEF"
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_NUMWEPKEYS
argument_list|,
operator|&
name|num
argument_list|)
operator|<
literal|0
condition|)
block|{
name|warn
argument_list|(
literal|"WEP support, but no NUMWEPKEYS support!"
argument_list|)
expr_stmt|;
goto|goto
name|end
goto|;
block|}
name|firstkey
operator|=
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num
condition|;
name|i
operator|++
control|)
block|{
name|struct
name|ieee80211req_key
name|ik
decl_stmt|;
name|memset
argument_list|(
operator|&
name|ik
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ik
argument_list|)
argument_list|)
expr_stmt|;
name|ik
operator|.
name|ik_keyix
operator|=
name|i
expr_stmt|;
if|if
condition|(
name|get80211
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WPAKEY
argument_list|,
operator|&
name|ik
argument_list|,
sizeof|sizeof
argument_list|(
name|ik
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
block|{
name|warn
argument_list|(
literal|"WEP support, but can get keys!"
argument_list|)
expr_stmt|;
goto|goto
name|end
goto|;
block|}
if|if
condition|(
name|ik
operator|.
name|ik_keylen
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|verbose
condition|)
name|LINE_BREAK
argument_list|()
expr_stmt|;
name|printkey
argument_list|(
operator|&
name|ik
argument_list|)
expr_stmt|;
name|firstkey
operator|=
literal|0
expr_stmt|;
block|}
block|}
name|end
label|:
empty_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_POWERSAVE
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
operator|&&
name|val
operator|!=
name|IEEE80211_POWERSAVE_NOSUP
condition|)
block|{
if|if
condition|(
name|val
operator|!=
name|IEEE80211_POWERSAVE_OFF
operator|||
name|verbose
condition|)
block|{
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_POWERSAVE_OFF
case|:
name|LINE_CHECK
argument_list|(
literal|"powersavemode OFF"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_POWERSAVE_CAM
case|:
name|LINE_CHECK
argument_list|(
literal|"powersavemode CAM"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_POWERSAVE_PSP
case|:
name|LINE_CHECK
argument_list|(
literal|"powersavemode PSP"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_POWERSAVE_PSP_CAM
case|:
name|LINE_CHECK
argument_list|(
literal|"powersavemode PSP-CAM"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_POWERSAVESLEEP
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|LINE_CHECK
argument_list|(
literal|"powersavesleep %d"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_TXPOWER
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
operator|&
literal|1
condition|)
name|LINE_CHECK
argument_list|(
literal|"txpower %d.5"
argument_list|,
name|val
operator|/
literal|2
argument_list|)
expr_stmt|;
else|else
name|LINE_CHECK
argument_list|(
literal|"txpower %d"
argument_list|,
name|val
operator|/
literal|2
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|verbose
condition|)
block|{
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_TXPOWMAX
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|LINE_CHECK
argument_list|(
literal|"txpowmax %.1f"
argument_list|,
name|val
operator|/
literal|2.
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_RTSTHRESHOLD
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
operator|!=
name|IEEE80211_RTS_MAX
operator|||
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"rtsthreshold %d"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_FRAGTHRESHOLD
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
operator|!=
name|IEEE80211_FRAG_MAX
operator|||
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"fragthreshold %d"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|opmode
operator|==
name|IEEE80211_M_STA
operator|||
name|verbose
condition|)
block|{
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BMISSTHRESHOLD
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
operator|!=
name|IEEE80211_HWBMISS_MAX
operator|||
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"bmiss %d"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_MCAST_RATE
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|printrate
argument_list|(
literal|"mcastrate"
argument_list|,
name|val
argument_list|,
literal|2
operator|*
literal|1
argument_list|,
literal|0
comment|/*XXX*/
argument_list|)
expr_stmt|;
name|bgscaninterval
operator|=
operator|-
literal|1
expr_stmt|;
operator|(
name|void
operator|)
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BGSCAN_INTERVAL
argument_list|,
operator|&
name|bgscaninterval
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_SCANVALID
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
operator|!=
name|bgscaninterval
operator|||
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"scanvalid %u"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
name|bgscan
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BGSCAN
argument_list|,
operator|&
name|bgscan
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|bgscan
condition|)
name|LINE_CHECK
argument_list|(
literal|"bgscan"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"-bgscan"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bgscan
operator|||
name|verbose
condition|)
block|{
if|if
condition|(
name|bgscaninterval
operator|!=
operator|-
literal|1
condition|)
name|LINE_CHECK
argument_list|(
literal|"bgscanintvl %u"
argument_list|,
name|bgscaninterval
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BGSCAN_IDLE
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|LINE_CHECK
argument_list|(
literal|"bgscanidle %u"
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|IEEE80211_IS_CHAN_A
argument_list|(
name|c
argument_list|)
operator|||
name|verbose
condition|)
block|{
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RSSI_11A
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|printrssi
argument_list|(
literal|"roam:rssi11a"
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RATE_11A
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|printrate
argument_list|(
literal|"roam:rate11a"
argument_list|,
name|val
argument_list|,
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|IEEE80211_IS_CHAN_B
argument_list|(
name|c
argument_list|)
operator|||
name|verbose
condition|)
block|{
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RSSI_11B
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|printrssi
argument_list|(
literal|"roam:rssi11b"
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RATE_11B
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|printrate
argument_list|(
literal|"roam:rate11b"
argument_list|,
name|val
argument_list|,
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|IEEE80211_IS_CHAN_ANYG
argument_list|(
name|c
argument_list|)
operator|||
name|verbose
condition|)
block|{
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RSSI_11G
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|printrssi
argument_list|(
literal|"roam:rssi11g"
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAM_RATE_11G
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|printrate
argument_list|(
literal|"roam:rate11g"
argument_list|,
name|val
argument_list|,
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|IEEE80211_IS_CHAN_ANYG
argument_list|(
name|c
argument_list|)
operator|||
name|verbose
condition|)
block|{
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_PUREG
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"pureg"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"-pureg"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_PROTMODE
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_PROTMODE_OFF
case|:
name|LINE_CHECK
argument_list|(
literal|"protmode OFF"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_PROTMODE_CTS
case|:
name|LINE_CHECK
argument_list|(
literal|"protmode CTS"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_PROTMODE_RTSCTS
case|:
name|LINE_CHECK
argument_list|(
literal|"protmode RTSCTS"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|LINE_CHECK
argument_list|(
literal|"protmode UNKNOWN (0x%x)"
argument_list|,
name|val
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
if|if
condition|(
name|IEEE80211_IS_CHAN_HT
argument_list|(
name|c
argument_list|)
operator|||
name|verbose
condition|)
block|{
name|gethtconf
argument_list|(
name|s
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|htconf
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
case|case
literal|2
case|:
name|LINE_CHECK
argument_list|(
literal|"-ht"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|LINE_CHECK
argument_list|(
literal|"ht20"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"ht"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_HTCOMPAT
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"-htcompat"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"htcompat"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AMPDU
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
switch|switch
condition|(
name|val
condition|)
block|{
case|case
literal|0
case|:
name|LINE_CHECK
argument_list|(
literal|"-ampdu"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdutx -ampdurx"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|LINE_CHECK
argument_list|(
literal|"-ampdutx ampdurx"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"ampdu"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AMPDU_LIMIT
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_HTCAP_MAXRXAMPDU_8K
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdulimit 8k"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MAXRXAMPDU_16K
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdulimit 16k"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MAXRXAMPDU_32K
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdulimit 32k"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MAXRXAMPDU_64K
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdulimit 64k"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AMPDU_DENSITY
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_NA
case|:
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"ampdudensity -"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_025
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdudensity .25"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_05
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdudensity .5"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_1
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdudensity 1"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_2
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdudensity 2"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_4
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdudensity 4"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_8
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdudensity 8"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_16
case|:
name|LINE_CHECK
argument_list|(
literal|"ampdudensity 16"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_AMSDU
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
switch|switch
condition|(
name|val
condition|)
block|{
case|case
literal|0
case|:
name|LINE_CHECK
argument_list|(
literal|"-amsdu"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|LINE_CHECK
argument_list|(
literal|"amsdutx -amsdurx"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|LINE_CHECK
argument_list|(
literal|"-amsdutx amsdurx"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"amsdu"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
comment|/* XXX amsdu limit */
comment|/* XXX 20/40 */
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_SHORTGI
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"shortgi"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"-shortgi"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_HTPROTMODE
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
operator|==
name|IEEE80211_PROTMODE_OFF
condition|)
name|LINE_CHECK
argument_list|(
literal|"htprotmode OFF"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|val
operator|!=
name|IEEE80211_PROTMODE_RTSCTS
condition|)
name|LINE_CHECK
argument_list|(
literal|"htprotmode UNKNOWN (0x%x)"
argument_list|,
name|val
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"htprotmode RTSCTS"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_PUREN
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"puren"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"-puren"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_WME
argument_list|,
operator|&
name|wme
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|wme
condition|)
name|LINE_CHECK
argument_list|(
literal|"wme"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"-wme"
argument_list|)
expr_stmt|;
block|}
else|else
name|wme
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BURST
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"burst"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"-burst"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_FF
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"ff"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"-ff"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_TURBOP
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"dturbo"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"-dturbo"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|opmode
operator|==
name|IEEE80211_M_HOSTAP
condition|)
block|{
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_HIDESSID
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"hidessid"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"-hidessid"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_APBRIDGE
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"-apbridge"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"apbridge"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_DTIM_PERIOD
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|LINE_CHECK
argument_list|(
literal|"dtimperiod %u"
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_DOTH
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"-doth"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"doth"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_INACTIVITY
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|val
condition|)
name|LINE_CHECK
argument_list|(
literal|"-inact"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"inact"
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_ROAMING
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|val
operator|!=
name|IEEE80211_ROAMING_AUTO
operator|||
name|verbose
condition|)
block|{
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_ROAMING_DEVICE
case|:
name|LINE_CHECK
argument_list|(
literal|"roaming DEVICE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_ROAMING_AUTO
case|:
name|LINE_CHECK
argument_list|(
literal|"roaming AUTO"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_ROAMING_MANUAL
case|:
name|LINE_CHECK
argument_list|(
literal|"roaming MANUAL"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|LINE_CHECK
argument_list|(
literal|"roaming UNKNOWN (0x%x)"
argument_list|,
name|val
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
block|}
if|if
condition|(
name|get80211val
argument_list|(
name|s
argument_list|,
name|IEEE80211_IOC_BEACON_INTERVAL
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
comment|/* XXX default define not visible */
if|if
condition|(
name|val
operator|!=
literal|100
operator|||
name|verbose
condition|)
name|LINE_CHECK
argument_list|(
literal|"bintval %u"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|wme
operator|&&
name|verbose
condition|)
block|{
name|LINE_BREAK
argument_list|()
expr_stmt|;
name|list_wme
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
name|LINE_BREAK
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|get80211
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|type
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
operator|(
name|void
operator|)
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|)
argument_list|)
expr_stmt|;
name|ireq
operator|.
name|i_type
operator|=
name|type
expr_stmt|;
name|ireq
operator|.
name|i_data
operator|=
name|data
expr_stmt|;
name|ireq
operator|.
name|i_len
operator|=
name|len
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|ireq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|get80211len
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|type
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
name|int
name|len
parameter_list|,
name|int
modifier|*
name|plen
parameter_list|)
block|{
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
operator|(
name|void
operator|)
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|)
argument_list|)
expr_stmt|;
name|ireq
operator|.
name|i_type
operator|=
name|type
expr_stmt|;
name|ireq
operator|.
name|i_len
operator|=
name|len
expr_stmt|;
name|ireq
operator|.
name|i_data
operator|=
name|data
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|ireq
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
operator|*
name|plen
operator|=
name|ireq
operator|.
name|i_len
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|get80211val
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|type
parameter_list|,
name|int
modifier|*
name|val
parameter_list|)
block|{
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
operator|(
name|void
operator|)
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|)
argument_list|)
expr_stmt|;
name|ireq
operator|.
name|i_type
operator|=
name|type
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|ireq
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
operator|*
name|val
operator|=
name|ireq
operator|.
name|i_val
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|set80211
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|type
parameter_list|,
name|int
name|val
parameter_list|,
name|int
name|len
parameter_list|,
name|void
modifier|*
name|data
parameter_list|)
block|{
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
operator|(
name|void
operator|)
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|)
argument_list|)
expr_stmt|;
name|ireq
operator|.
name|i_type
operator|=
name|type
expr_stmt|;
name|ireq
operator|.
name|i_val
operator|=
name|val
expr_stmt|;
name|ireq
operator|.
name|i_len
operator|=
name|len
expr_stmt|;
name|ireq
operator|.
name|i_data
operator|=
name|data
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCS80211
argument_list|,
operator|&
name|ireq
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"SIOCS80211"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|get_string
parameter_list|(
specifier|const
name|char
modifier|*
name|val
parameter_list|,
specifier|const
name|char
modifier|*
name|sep
parameter_list|,
name|u_int8_t
modifier|*
name|buf
parameter_list|,
name|int
modifier|*
name|lenp
parameter_list|)
block|{
name|int
name|len
decl_stmt|;
name|int
name|hexstr
decl_stmt|;
name|u_int8_t
modifier|*
name|p
decl_stmt|;
name|len
operator|=
operator|*
name|lenp
expr_stmt|;
name|p
operator|=
name|buf
expr_stmt|;
name|hexstr
operator|=
operator|(
name|val
index|[
literal|0
index|]
operator|==
literal|'0'
operator|&&
name|tolower
argument_list|(
operator|(
name|u_char
operator|)
name|val
index|[
literal|1
index|]
argument_list|)
operator|==
literal|'x'
operator|)
expr_stmt|;
if|if
condition|(
name|hexstr
condition|)
name|val
operator|+=
literal|2
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|*
name|val
operator|==
literal|'\0'
condition|)
break|break;
if|if
condition|(
name|sep
operator|!=
name|NULL
operator|&&
name|strchr
argument_list|(
name|sep
argument_list|,
operator|*
name|val
argument_list|)
operator|!=
name|NULL
condition|)
block|{
name|val
operator|++
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|hexstr
condition|)
block|{
if|if
condition|(
operator|!
name|isxdigit
argument_list|(
operator|(
name|u_char
operator|)
name|val
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|warnx
argument_list|(
literal|"bad hexadecimal digits"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|!
name|isxdigit
argument_list|(
operator|(
name|u_char
operator|)
name|val
index|[
literal|1
index|]
argument_list|)
condition|)
block|{
name|warnx
argument_list|(
literal|"odd count hexadecimal digits"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
if|if
condition|(
name|p
operator|>=
name|buf
operator|+
name|len
condition|)
block|{
if|if
condition|(
name|hexstr
condition|)
name|warnx
argument_list|(
literal|"hexadecimal digits too long"
argument_list|)
expr_stmt|;
else|else
name|warnx
argument_list|(
literal|"string too long"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|hexstr
condition|)
block|{
define|#
directive|define
name|tohex
parameter_list|(
name|x
parameter_list|)
value|(isdigit(x) ? (x) - '0' : tolower(x) - 'a' + 10)
operator|*
name|p
operator|++
operator|=
operator|(
name|tohex
argument_list|(
operator|(
name|u_char
operator|)
name|val
index|[
literal|0
index|]
argument_list|)
operator|<<
literal|4
operator|)
operator||
name|tohex
argument_list|(
operator|(
name|u_char
operator|)
name|val
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|tohex
name|val
operator|+=
literal|2
expr_stmt|;
block|}
else|else
operator|*
name|p
operator|++
operator|=
operator|*
name|val
operator|++
expr_stmt|;
block|}
name|len
operator|=
name|p
operator|-
name|buf
expr_stmt|;
comment|/* The string "-" is treated as the empty string. */
if|if
condition|(
operator|!
name|hexstr
operator|&&
name|len
operator|==
literal|1
operator|&&
name|buf
index|[
literal|0
index|]
operator|==
literal|'-'
condition|)
block|{
name|len
operator|=
literal|0
expr_stmt|;
name|memset
argument_list|(
name|buf
argument_list|,
literal|0
argument_list|,
operator|*
name|lenp
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|len
operator|<
operator|*
name|lenp
condition|)
name|memset
argument_list|(
name|p
argument_list|,
literal|0
argument_list|,
operator|*
name|lenp
operator|-
name|len
argument_list|)
expr_stmt|;
operator|*
name|lenp
operator|=
name|len
expr_stmt|;
return|return
name|val
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_string
parameter_list|(
specifier|const
name|u_int8_t
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|int
name|hasspc
decl_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
name|hasspc
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|isprint
argument_list|(
name|buf
index|[
name|i
index|]
argument_list|)
operator|&&
name|buf
index|[
name|i
index|]
operator|!=
literal|'\0'
condition|)
break|break;
if|if
condition|(
name|isspace
argument_list|(
name|buf
index|[
name|i
index|]
argument_list|)
condition|)
name|hasspc
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|==
name|len
condition|)
block|{
if|if
condition|(
name|hasspc
operator|||
name|len
operator|==
literal|0
operator|||
name|buf
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
name|printf
argument_list|(
literal|"\"%.*s\""
argument_list|,
name|len
argument_list|,
name|buf
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%.*s"
argument_list|,
name|len
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"0x"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%02x"
argument_list|,
name|buf
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_decl_stmt
specifier|static
name|struct
name|cmd
name|ieee80211_cmds
index|[]
init|=
block|{
name|DEF_CMD_ARG
argument_list|(
literal|"ssid"
argument_list|,
name|set80211ssid
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"nwid"
argument_list|,
name|set80211ssid
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"stationname"
argument_list|,
name|set80211stationname
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"station"
argument_list|,
name|set80211stationname
argument_list|)
block|,
comment|/* BSD/OS */
name|DEF_CMD_ARG
argument_list|(
literal|"channel"
argument_list|,
name|set80211channel
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"authmode"
argument_list|,
name|set80211authmode
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"powersavemode"
argument_list|,
name|set80211powersavemode
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"powersave"
argument_list|,
literal|1
argument_list|,
name|set80211powersave
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-powersave"
argument_list|,
literal|0
argument_list|,
name|set80211powersave
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"powersavesleep"
argument_list|,
name|set80211powersavesleep
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"wepmode"
argument_list|,
name|set80211wepmode
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"wep"
argument_list|,
literal|1
argument_list|,
name|set80211wep
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-wep"
argument_list|,
literal|0
argument_list|,
name|set80211wep
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"deftxkey"
argument_list|,
name|set80211weptxkey
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"weptxkey"
argument_list|,
name|set80211weptxkey
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"wepkey"
argument_list|,
name|set80211wepkey
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"nwkey"
argument_list|,
name|set80211nwkey
argument_list|)
block|,
comment|/* NetBSD */
name|DEF_CMD
argument_list|(
literal|"-nwkey"
argument_list|,
literal|0
argument_list|,
name|set80211wep
argument_list|)
block|,
comment|/* NetBSD */
name|DEF_CMD_ARG
argument_list|(
literal|"rtsthreshold"
argument_list|,
name|set80211rtsthreshold
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"protmode"
argument_list|,
name|set80211protmode
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"txpower"
argument_list|,
name|set80211txpower
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"roaming"
argument_list|,
name|set80211roaming
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"wme"
argument_list|,
literal|1
argument_list|,
name|set80211wme
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-wme"
argument_list|,
literal|0
argument_list|,
name|set80211wme
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"hidessid"
argument_list|,
literal|1
argument_list|,
name|set80211hidessid
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-hidessid"
argument_list|,
literal|0
argument_list|,
name|set80211hidessid
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"apbridge"
argument_list|,
literal|1
argument_list|,
name|set80211apbridge
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-apbridge"
argument_list|,
literal|0
argument_list|,
name|set80211apbridge
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"chanlist"
argument_list|,
name|set80211chanlist
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"bssid"
argument_list|,
name|set80211bssid
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"ap"
argument_list|,
name|set80211bssid
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"scan"
argument_list|,
literal|0
argument_list|,
name|set80211scan
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"list"
argument_list|,
name|set80211list
argument_list|)
block|,
name|DEF_CMD_ARG2
argument_list|(
literal|"cwmin"
argument_list|,
name|set80211cwmin
argument_list|)
block|,
name|DEF_CMD_ARG2
argument_list|(
literal|"cwmax"
argument_list|,
name|set80211cwmax
argument_list|)
block|,
name|DEF_CMD_ARG2
argument_list|(
literal|"aifs"
argument_list|,
name|set80211aifs
argument_list|)
block|,
name|DEF_CMD_ARG2
argument_list|(
literal|"txoplimit"
argument_list|,
name|set80211txoplimit
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"acm"
argument_list|,
name|set80211acm
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"-acm"
argument_list|,
name|set80211noacm
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"ack"
argument_list|,
name|set80211ackpolicy
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"-ack"
argument_list|,
name|set80211noackpolicy
argument_list|)
block|,
name|DEF_CMD_ARG2
argument_list|(
literal|"bss:cwmin"
argument_list|,
name|set80211bsscwmin
argument_list|)
block|,
name|DEF_CMD_ARG2
argument_list|(
literal|"bss:cwmax"
argument_list|,
name|set80211bsscwmax
argument_list|)
block|,
name|DEF_CMD_ARG2
argument_list|(
literal|"bss:aifs"
argument_list|,
name|set80211bssaifs
argument_list|)
block|,
name|DEF_CMD_ARG2
argument_list|(
literal|"bss:txoplimit"
argument_list|,
name|set80211bsstxoplimit
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"dtimperiod"
argument_list|,
name|set80211dtimperiod
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"bintval"
argument_list|,
name|set80211bintval
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"mac:open"
argument_list|,
name|IEEE80211_MACCMD_POLICY_OPEN
argument_list|,
name|set80211maccmd
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"mac:allow"
argument_list|,
name|IEEE80211_MACCMD_POLICY_ALLOW
argument_list|,
name|set80211maccmd
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"mac:deny"
argument_list|,
name|IEEE80211_MACCMD_POLICY_DENY
argument_list|,
name|set80211maccmd
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"mac:flush"
argument_list|,
name|IEEE80211_MACCMD_FLUSH
argument_list|,
name|set80211maccmd
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"mac:detach"
argument_list|,
name|IEEE80211_MACCMD_DETACH
argument_list|,
name|set80211maccmd
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"mac:add"
argument_list|,
name|set80211addmac
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"mac:del"
argument_list|,
name|set80211delmac
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"mac:kick"
argument_list|,
name|set80211kickmac
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"pureg"
argument_list|,
literal|1
argument_list|,
name|set80211pureg
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-pureg"
argument_list|,
literal|0
argument_list|,
name|set80211pureg
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"ff"
argument_list|,
literal|1
argument_list|,
name|set80211fastframes
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-ff"
argument_list|,
literal|0
argument_list|,
name|set80211fastframes
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"dturbo"
argument_list|,
literal|1
argument_list|,
name|set80211dturbo
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-dturbo"
argument_list|,
literal|0
argument_list|,
name|set80211dturbo
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"bgscan"
argument_list|,
literal|1
argument_list|,
name|set80211bgscan
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-bgscan"
argument_list|,
literal|0
argument_list|,
name|set80211bgscan
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"bgscanidle"
argument_list|,
name|set80211bgscanidle
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"bgscanintvl"
argument_list|,
name|set80211bgscanintvl
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"scanvalid"
argument_list|,
name|set80211scanvalid
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"roam:rssi11a"
argument_list|,
name|set80211roamrssi11a
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"roam:rssi11b"
argument_list|,
name|set80211roamrssi11b
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"roam:rssi11g"
argument_list|,
name|set80211roamrssi11g
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"roam:rate11a"
argument_list|,
name|set80211roamrate11a
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"roam:rate11b"
argument_list|,
name|set80211roamrate11b
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"roam:rate11g"
argument_list|,
name|set80211roamrate11g
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"mcastrate"
argument_list|,
name|set80211mcastrate
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"fragthreshold"
argument_list|,
name|set80211fragthreshold
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"burst"
argument_list|,
literal|1
argument_list|,
name|set80211burst
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-burst"
argument_list|,
literal|0
argument_list|,
name|set80211burst
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"bmiss"
argument_list|,
name|set80211bmissthreshold
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"bmissthreshold"
argument_list|,
name|set80211bmissthreshold
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"shortgi"
argument_list|,
literal|1
argument_list|,
name|set80211shortgi
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-shortgi"
argument_list|,
literal|0
argument_list|,
name|set80211shortgi
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"ampdurx"
argument_list|,
literal|2
argument_list|,
name|set80211ampdu
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-ampdurx"
argument_list|,
operator|-
literal|2
argument_list|,
name|set80211ampdu
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"ampdutx"
argument_list|,
literal|1
argument_list|,
name|set80211ampdu
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-ampdutx"
argument_list|,
operator|-
literal|1
argument_list|,
name|set80211ampdu
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"ampdu"
argument_list|,
literal|3
argument_list|,
name|set80211ampdu
argument_list|)
block|,
comment|/* NB: tx+rx */
name|DEF_CMD
argument_list|(
literal|"-ampdu"
argument_list|,
operator|-
literal|3
argument_list|,
name|set80211ampdu
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"ampdulimit"
argument_list|,
name|set80211ampdulimit
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"ampdudensity"
argument_list|,
name|set80211ampdudensity
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"amsdurx"
argument_list|,
literal|2
argument_list|,
name|set80211amsdu
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-amsdurx"
argument_list|,
operator|-
literal|2
argument_list|,
name|set80211amsdu
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"amsdutx"
argument_list|,
literal|1
argument_list|,
name|set80211amsdu
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-amsdutx"
argument_list|,
operator|-
literal|1
argument_list|,
name|set80211amsdu
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"amsdu"
argument_list|,
literal|3
argument_list|,
name|set80211amsdu
argument_list|)
block|,
comment|/* NB: tx+rx */
name|DEF_CMD
argument_list|(
literal|"-amsdu"
argument_list|,
operator|-
literal|3
argument_list|,
name|set80211amsdu
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"amsdulimit"
argument_list|,
name|set80211amsdulimit
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"puren"
argument_list|,
literal|1
argument_list|,
name|set80211puren
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-puren"
argument_list|,
literal|0
argument_list|,
name|set80211puren
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"doth"
argument_list|,
literal|1
argument_list|,
name|set80211doth
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-doth"
argument_list|,
literal|0
argument_list|,
name|set80211doth
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"htcompat"
argument_list|,
literal|1
argument_list|,
name|set80211htcompat
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-htcompat"
argument_list|,
literal|0
argument_list|,
name|set80211htcompat
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"inact"
argument_list|,
literal|1
argument_list|,
name|set80211inact
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-inact"
argument_list|,
literal|0
argument_list|,
name|set80211inact
argument_list|)
block|,
name|DEF_CMD_ARG
argument_list|(
literal|"htprotmode"
argument_list|,
name|set80211htprotmode
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"ht20"
argument_list|,
literal|1
argument_list|,
name|set80211htconf
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"-ht20"
argument_list|,
literal|0
argument_list|,
name|set80211htconf
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"ht40"
argument_list|,
literal|3
argument_list|,
name|set80211htconf
argument_list|)
block|,
comment|/* NB: 20+40 */
name|DEF_CMD
argument_list|(
literal|"-ht40"
argument_list|,
literal|0
argument_list|,
name|set80211htconf
argument_list|)
block|,
name|DEF_CMD
argument_list|(
literal|"ht"
argument_list|,
literal|3
argument_list|,
name|set80211htconf
argument_list|)
block|,
comment|/* NB: 20+40 */
name|DEF_CMD
argument_list|(
literal|"-ht"
argument_list|,
literal|0
argument_list|,
name|set80211htconf
argument_list|)
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|afswtch
name|af_ieee80211
init|=
block|{
operator|.
name|af_name
operator|=
literal|"af_ieee80211"
block|,
operator|.
name|af_af
operator|=
name|AF_UNSPEC
block|,
operator|.
name|af_other_status
operator|=
name|ieee80211_status
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|__constructor
name|void
name|ieee80211_ctor
parameter_list|(
name|void
parameter_list|)
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a) / sizeof(a[0]))
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|N
argument_list|(
name|ieee80211_cmds
argument_list|)
condition|;
name|i
operator|++
control|)
name|cmd_register
argument_list|(
operator|&
name|ieee80211_cmds
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|af_register
argument_list|(
operator|&
name|af_ieee80211
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|N
block|}
end_function

end_unit

