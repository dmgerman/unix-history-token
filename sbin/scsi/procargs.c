begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Written By Julian ELischer  * Copyright julian Elischer 1993.  * Permission is granted to use or redistribute this file in any way as long  * as this notice remains. Julian Elischer does not guarantee that this file   * is totally correct for any given task and users of this file must   * accept responsibility for any damage that occurs from the application of this  * file.  *   * (julian@tfs.com julian@dialix.oz.au)  *  *	$Id$  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_decl_stmt
specifier|extern
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|debuglevel
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|inqflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|reprobe
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|dflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|bus
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|targ
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|lun
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|myname
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|procargs
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
name|char
modifier|*
modifier|*
name|envp
parameter_list|)
block|{
specifier|extern
name|char
modifier|*
name|optarg
decl_stmt|;
specifier|extern
name|int
name|optind
decl_stmt|;
name|int
name|fflag
decl_stmt|,
name|ch
decl_stmt|;
name|myname
operator|=
operator|*
name|argv
expr_stmt|;
name|fflag
operator|=
literal|0
expr_stmt|;
name|inqflag
operator|=
literal|0
expr_stmt|;
name|dflag
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|ch
operator|=
name|getopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"irf:d:b:t:l:"
argument_list|)
operator|)
operator|!=
name|EOF
condition|)
block|{
switch|switch
condition|(
name|ch
condition|)
block|{
case|case
literal|'r'
case|:
name|reprobe
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'i'
case|:
name|inqflag
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'f'
case|:
if|if
condition|(
operator|(
name|fd
operator|=
name|open
argument_list|(
name|optarg
argument_list|,
name|O_RDWR
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: unable to open device %s.\n"
argument_list|,
name|myname
argument_list|,
name|optarg
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|fflag
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'d'
case|:
name|debuglevel
operator|=
name|atoi
argument_list|(
name|optarg
argument_list|)
expr_stmt|;
name|dflag
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'b'
case|:
name|bus
operator|=
name|atoi
argument_list|(
name|optarg
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
name|targ
operator|=
name|atoi
argument_list|(
name|optarg
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'l'
case|:
name|lun
operator|=
name|atoi
argument_list|(
name|optarg
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'?'
case|:
default|default:
name|usage
argument_list|()
expr_stmt|;
block|}
block|}
name|argc
operator|-=
name|optind
expr_stmt|;
name|argv
operator|+=
name|optind
expr_stmt|;
if|if
condition|(
operator|!
name|fflag
condition|)
name|usage
argument_list|()
expr_stmt|;
block|}
end_function

begin_macro
name|usage
argument_list|()
end_macro

begin_block
block|{
name|printf
argument_list|(
literal|"usage: %s -f devicename [-d level] [-i] [-r [-b bus] "
literal|"[-t targ] [-l lun]]\n"
argument_list|,
name|myname
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"where r = reprobe, i = inquire, d = debug\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"If debugging is not compiled in the kernel, 'd' will have no effect\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

