begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2003 Vincent Jardin 6WIND  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*  * User configuration and display program  * --------------------------------------  *  * Routines for PROATM-155 and 25 specific subcommands  *  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<netatm/port.h>
end_include

begin_include
include|#
directive|include
file|<netatm/atm.h>
end_include

begin_include
include|#
directive|include
file|<netatm/atm_if.h>
end_include

begin_include
include|#
directive|include
file|<netatm/atm_sap.h>
end_include

begin_include
include|#
directive|include
file|<netatm/atm_sys.h>
end_include

begin_include
include|#
directive|include
file|<netatm/atm_ioctl.h>
end_include

begin_include
include|#
directive|include
file|<dev/proatm/proatm.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<libatm.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"atm.h"
end_include

begin_comment
comment|/*  * Local constants  */
end_comment

begin_define
define|#
directive|define
name|SHOW_PHY
value|1
end_define

begin_define
define|#
directive|define
name|SHOW_DEV
value|2
end_define

begin_define
define|#
directive|define
name|SHOW_ATM
value|4
end_define

begin_define
define|#
directive|define
name|SHOW_AAL0
value|8
end_define

begin_define
define|#
directive|define
name|SHOW_AAL4
value|16
end_define

begin_define
define|#
directive|define
name|SHOW_AAL5
value|32
end_define

begin_define
define|#
directive|define
name|SHOW_DRIVER
value|64
end_define

begin_function_decl
specifier|static
name|void
name|print_proatm_utp25
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_proatm_oc3
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_proatm_atm
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_proatm_aal0
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_proatm_aal4
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_proatm_aal5
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_proatm_driver
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_proatm_dev
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * Process show PROATM statistics command  *  * The statistics printed are vendor-specific, depending on the brand of  * the interface card.  *   * Command format:   *	atm show stats interface [<interface-name> [phy | dev | atm |  *		aal0 | aal4 | aal5 | driver]]  *  * Arguments:  *	intf	interface statistics are for  *	argc	number of remaining arguments to command  *	argv	pointer to remaining argument strings  *  * Returns:  *	none  *  */
end_comment

begin_function
name|void
name|show_proatm_stats
parameter_list|(
name|intf
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|)
name|char
modifier|*
name|intf
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|int
name|buf_len
decl_stmt|,
name|stats_type
decl_stmt|;
name|struct
name|air_cfg_rsp
modifier|*
name|cfg
decl_stmt|;
name|struct
name|air_vinfo_rsp
modifier|*
name|stats
decl_stmt|;
name|struct
name|atminfreq
name|air
decl_stmt|;
comment|/* 	 * Get statistics type qualifier 	 */
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
literal|"phy"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|stats_type
operator|=
name|SHOW_PHY
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
literal|"dev"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|stats_type
operator|=
name|SHOW_DEV
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
literal|"atm"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|stats_type
operator|=
name|SHOW_ATM
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
literal|"aal0"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|stats_type
operator|=
name|SHOW_AAL0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
literal|"aal4"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|stats_type
operator|=
name|SHOW_AAL4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
literal|"aal5"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|stats_type
operator|=
name|SHOW_AAL5
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
literal|"driver"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|stats_type
operator|=
name|SHOW_DRIVER
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: Illegal statistics type\n"
argument_list|,
name|prog
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|argc
operator|--
expr_stmt|;
name|argv
operator|++
expr_stmt|;
comment|/* 	 * Get adapter configuration from the kernel 	 */
name|bzero
argument_list|(
operator|&
name|air
argument_list|,
sizeof|sizeof
argument_list|(
name|air
argument_list|)
argument_list|)
expr_stmt|;
name|air
operator|.
name|air_opcode
operator|=
name|AIOCS_INF_CFG
expr_stmt|;
name|strcpy
argument_list|(
name|air
operator|.
name|air_cfg_intf
argument_list|,
name|intf
argument_list|)
expr_stmt|;
name|buf_len
operator|=
name|do_info_ioctl
argument_list|(
operator|&
name|air
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|air_cfg_rsp
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_len
operator|<
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: "
argument_list|,
name|prog
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|errno
condition|)
block|{
case|case
name|ENOPROTOOPT
case|:
case|case
name|EOPNOTSUPP
case|:
name|perror
argument_list|(
literal|"Internal error"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ENXIO
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s is not an ATM device\n"
argument_list|,
name|intf
argument_list|)
expr_stmt|;
break|break;
default|default:
name|perror
argument_list|(
literal|"ioctl (AIOCINFO)"
argument_list|)
expr_stmt|;
break|break;
block|}
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|cfg
operator|=
operator|(
expr|struct
name|air_cfg_rsp
operator|*
operator|)
name|air
operator|.
name|air_buf_addr
expr_stmt|;
comment|/* 	 * Get vendor-specific statistics from the kernel 	 */
name|bzero
argument_list|(
operator|&
name|air
argument_list|,
sizeof|sizeof
argument_list|(
name|air
argument_list|)
argument_list|)
expr_stmt|;
name|air
operator|.
name|air_opcode
operator|=
name|AIOCS_INF_VST
expr_stmt|;
name|strcpy
argument_list|(
name|air
operator|.
name|air_vinfo_intf
argument_list|,
name|intf
argument_list|)
expr_stmt|;
name|buf_len
operator|=
name|do_info_ioctl
argument_list|(
operator|&
name|air
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|air_vinfo_rsp
argument_list|)
operator|+
literal|1024
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf_len
operator|<
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: "
argument_list|,
name|prog
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|errno
condition|)
block|{
case|case
name|ENOPROTOOPT
case|:
case|case
name|EOPNOTSUPP
case|:
name|perror
argument_list|(
literal|"Internal error"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ENXIO
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s is not an ATM device\n"
argument_list|,
name|intf
argument_list|)
expr_stmt|;
break|break;
default|default:
name|perror
argument_list|(
literal|"ioctl (AIOCINFO)"
argument_list|)
expr_stmt|;
break|break;
block|}
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|stats
operator|=
operator|(
expr|struct
name|air_vinfo_rsp
operator|*
operator|)
name|air
operator|.
name|air_buf_addr
expr_stmt|;
comment|/* 	 * Print the statistics 	 */
if|if
condition|(
name|buf_len
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|air_vinfo_rsp
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|Proatm_stats
argument_list|)
condition|)
block|{
name|free
argument_list|(
name|stats
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|cfg
argument_list|)
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|stats_type
condition|)
block|{
case|case
name|SHOW_PHY
case|:
switch|switch
condition|(
name|cfg
operator|->
name|acp_media
condition|)
block|{
case|case
name|MEDIA_UTP25
case|:
name|print_proatm_utp25
argument_list|(
name|stats
argument_list|)
expr_stmt|;
break|break;
case|case
name|MEDIA_OC3C
case|:
name|print_proatm_oc3
argument_list|(
name|stats
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
break|break;
case|case
name|SHOW_DEV
case|:
name|print_proatm_dev
argument_list|(
name|stats
argument_list|)
expr_stmt|;
break|break;
case|case
name|SHOW_ATM
case|:
name|print_proatm_atm
argument_list|(
name|stats
argument_list|)
expr_stmt|;
break|break;
case|case
name|SHOW_AAL0
case|:
name|print_proatm_aal0
argument_list|(
name|stats
argument_list|)
expr_stmt|;
break|break;
case|case
name|SHOW_AAL4
case|:
name|print_proatm_aal4
argument_list|(
name|stats
argument_list|)
expr_stmt|;
break|break;
case|case
name|SHOW_AAL5
case|:
name|print_proatm_aal5
argument_list|(
name|stats
argument_list|)
expr_stmt|;
break|break;
case|case
name|SHOW_DRIVER
case|:
name|print_proatm_driver
argument_list|(
name|stats
argument_list|)
expr_stmt|;
break|break;
block|}
name|free
argument_list|(
name|stats
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|cfg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print PROATM-155 UTP 25.6 statistics  *   * Arguments:  *	vi	pointer to vendor-specific statistics to print  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_proatm_utp25
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
block|{
define|#
directive|define
name|UTP25_STATS_HDR
define|\
value|"%s UTP 25.6 Statistics\n\ Symbol        TX          RX       RX HEC\n\  Errs         Cells       Cells      Errs\n"
name|Proatm_stats
modifier|*
name|stats
decl_stmt|;
comment|/* 	 * Bump stats pointer past header info 	 */
name|stats
operator|=
operator|(
name|Proatm_stats
operator|*
operator|)
operator|(
operator|(
name|uintptr_t
operator|)
name|vi
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|air_vinfo_rsp
argument_list|)
operator|)
expr_stmt|;
comment|/* 	 * Print a header 	 */
name|printf
argument_list|(
name|UTP25_STATS_HDR
argument_list|,
name|get_adapter_name
argument_list|(
name|vi
operator|->
name|avsp_intf
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Print the UTP 25.6 info 	 */
name|printf
argument_list|(
literal|"%7ld  %10ld  %10ld  %7ld\n"
argument_list|,
name|stats
operator|->
name|proatm_st_utp25
operator|.
name|utp25_symbol_errors
argument_list|,
name|stats
operator|->
name|proatm_st_utp25
operator|.
name|utp25_tx_cells
argument_list|,
name|stats
operator|->
name|proatm_st_utp25
operator|.
name|utp25_rx_cells
argument_list|,
name|stats
operator|->
name|proatm_st_utp25
operator|.
name|utp25_rx_hec_errors
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print PROATM-155 OC-3c statistics  *   * Arguments:  *	vi	pointer to vendor-specific statistics to print  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_proatm_oc3
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
block|{
define|#
directive|define
name|OC3_STATS_HDR_1
define|\
value|"%s OC-3c Statistics\n\ Section     Path    Line      Line     Path     Corr   Uncorr\n\ BIP8        BIP8    BIP24     FEBE     FEBE     HCS    HCS      RX     TX\n\ Errs        Errs    Errs      Errs     Errs     Errs   Errs     Cells  Cells\n"
define|#
directive|define
name|OC3_STATS_HDR_2
define|\
value|"%s OC-3c Statistics\n\      RX          TX\n\      Cells       Cells\n"
name|Proatm_stats
modifier|*
name|stats
decl_stmt|;
comment|/* 	 * Bump stats pointer past header info 	 */
name|stats
operator|=
operator|(
name|Proatm_stats
operator|*
operator|)
operator|(
operator|(
name|uintptr_t
operator|)
name|vi
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|air_vinfo_rsp
argument_list|)
operator|)
expr_stmt|;
comment|/* 	 * Print a header 	 */
name|printf
argument_list|(
name|OC3_STATS_HDR_1
argument_list|,
name|get_adapter_name
argument_list|(
name|vi
operator|->
name|avsp_intf
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Print the OC-3c info 	 */
name|printf
argument_list|(
literal|"%7ld  %7ld  %7ld  %7ld  %7ld  %7ld  %7ld  %7ld  %7ld\n"
argument_list|,
name|stats
operator|->
name|proatm_st_oc3
operator|.
name|oc3_sect_bip8
argument_list|,
name|stats
operator|->
name|proatm_st_oc3
operator|.
name|oc3_path_bip8
argument_list|,
name|stats
operator|->
name|proatm_st_oc3
operator|.
name|oc3_line_bip24
argument_list|,
name|stats
operator|->
name|proatm_st_oc3
operator|.
name|oc3_line_febe
argument_list|,
name|stats
operator|->
name|proatm_st_oc3
operator|.
name|oc3_path_febe
argument_list|,
name|stats
operator|->
name|proatm_st_oc3
operator|.
name|oc3_hec_corr
argument_list|,
name|stats
operator|->
name|proatm_st_oc3
operator|.
name|oc3_hec_uncorr
argument_list|,
name|stats
operator|->
name|proatm_st_oc3
operator|.
name|oc3_rx_cells
argument_list|,
name|stats
operator|->
name|proatm_st_oc3
operator|.
name|oc3_tx_cells
argument_list|)
expr_stmt|;
comment|/* 	 * Print a header 	 */
name|printf
argument_list|(
name|OC3_STATS_HDR_2
argument_list|,
name|get_adapter_name
argument_list|(
name|vi
operator|->
name|avsp_intf
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Print the OC-3c info 	 */
name|printf
argument_list|(
literal|"%10ld  %10ld\n"
argument_list|,
name|stats
operator|->
name|proatm_st_oc3
operator|.
name|oc3_rx_cells
argument_list|,
name|stats
operator|->
name|proatm_st_oc3
operator|.
name|oc3_tx_cells
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print PROATM statistics  *   * Arguments:  *	vi	pointer to vendor-specific statistics to print  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_proatm_atm
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
block|{
define|#
directive|define
name|ATM_STATS_HDR
define|\
value|"%s ATM Layer Statistics\n\  Cells In    Cells Out\n"
name|Proatm_stats
modifier|*
name|stats
decl_stmt|;
comment|/* 	 * Bump stats pointer past header info 	 */
name|stats
operator|=
operator|(
name|Proatm_stats
operator|*
operator|)
operator|(
operator|(
name|uintptr_t
operator|)
name|vi
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|air_vinfo_rsp
argument_list|)
operator|)
expr_stmt|;
comment|/* 	 * Print a header 	 */
name|printf
argument_list|(
name|ATM_STATS_HDR
argument_list|,
name|get_adapter_name
argument_list|(
name|vi
operator|->
name|avsp_intf
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Print the ATM layer info 	 */
name|printf
argument_list|(
literal|"%10ld  %10ld\n"
argument_list|,
name|stats
operator|->
name|proatm_st_atm
operator|.
name|atm_rcvd
argument_list|,
name|stats
operator|->
name|proatm_st_atm
operator|.
name|atm_xmit
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print PROATM AAL 0 statistics  *   * Arguments:  *	vi	pointer to vendor-specific statistics to print  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_proatm_aal0
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
block|{
define|#
directive|define
name|AAL0_STATS_HDR
define|\
value|"%s AAL 0 Statistics\n\  Cells In    Cells Out  Cell Drops\n"
name|Proatm_stats
modifier|*
name|stats
decl_stmt|;
comment|/* 	 * Bump stats pointer past header info 	 */
name|stats
operator|=
operator|(
name|Proatm_stats
operator|*
operator|)
operator|(
operator|(
name|uintptr_t
operator|)
name|vi
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|air_vinfo_rsp
argument_list|)
operator|)
expr_stmt|;
comment|/* 	 * Print a header 	 */
name|printf
argument_list|(
name|AAL0_STATS_HDR
argument_list|,
name|get_adapter_name
argument_list|(
name|vi
operator|->
name|avsp_intf
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Print the AAL 0 info 	 */
name|printf
argument_list|(
literal|"%10ld  %10ld  %10ld\n"
argument_list|,
name|stats
operator|->
name|proatm_st_aal0
operator|.
name|aal0_rcvd
argument_list|,
name|stats
operator|->
name|proatm_st_aal0
operator|.
name|aal0_xmit
argument_list|,
name|stats
operator|->
name|proatm_st_aal0
operator|.
name|aal0_drops
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print PROATM AAL 4 statistics  *   * Arguments:  *	vi	pointer to vendor-specific statistics to print  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_proatm_aal4
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
block|{
define|#
directive|define
name|AAL4_STATS_HDR
define|\
value|"%s AAL 3/4 Statistics\n\                          Cells CS\n\                          CRC   Proto  Cell                          PDU   PDU\n\  Cells In    Cells Out   Errs  Errs   Drops    PDUs In   PDUs Out   Errs  Drops\n"
name|Proatm_stats
modifier|*
name|stats
decl_stmt|;
comment|/* 	 * Bump stats pointer past header info 	 */
name|stats
operator|=
operator|(
name|Proatm_stats
operator|*
operator|)
operator|(
operator|(
name|uintptr_t
operator|)
name|vi
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|air_vinfo_rsp
argument_list|)
operator|)
expr_stmt|;
comment|/* 	 * Print a header 	 */
name|printf
argument_list|(
name|AAL4_STATS_HDR
argument_list|,
name|get_adapter_name
argument_list|(
name|vi
operator|->
name|avsp_intf
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Print the AAL 4 info 	 */
name|printf
argument_list|(
literal|"%10ld  %10ld  %5ld  %5ld  %5ld  %9ld  %9ld  %5ld  %5ld\n"
argument_list|,
name|stats
operator|->
name|proatm_st_aal4
operator|.
name|aal4_rcvd
argument_list|,
name|stats
operator|->
name|proatm_st_aal4
operator|.
name|aal4_xmit
argument_list|,
name|stats
operator|->
name|proatm_st_aal4
operator|.
name|aal4_crc
argument_list|,
name|stats
operator|->
name|proatm_st_aal4
operator|.
name|aal4_sar_cs
argument_list|,
name|stats
operator|->
name|proatm_st_aal4
operator|.
name|aal4_drops
argument_list|,
name|stats
operator|->
name|proatm_st_aal4
operator|.
name|aal4_pdu_rcvd
argument_list|,
name|stats
operator|->
name|proatm_st_aal4
operator|.
name|aal4_pdu_xmit
argument_list|,
name|stats
operator|->
name|proatm_st_aal4
operator|.
name|aal4_pdu_errs
argument_list|,
name|stats
operator|->
name|proatm_st_aal4
operator|.
name|aal4_pdu_drops
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print PROATM AAL 5 statistics  *   * Arguments:  *	vi	pointer to vendor-specific statistics to print  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_proatm_aal5
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
block|{
define|#
directive|define
name|AAL5_STATS_HDR
define|\
value|"%s AAL 5 Statistics\n\                         Cells\n\                        CRC/Len Cell                         PDU CRC  PDU\n\  Cells In    Cells Out  Errs   Drops    PDUs In   PDUs Out   Errs    Drops\n"
name|Proatm_stats
modifier|*
name|stats
decl_stmt|;
comment|/* 	 * Bump stats pointer past header info 	 */
name|stats
operator|=
operator|(
name|Proatm_stats
operator|*
operator|)
operator|(
operator|(
name|uintptr_t
operator|)
name|vi
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|air_vinfo_rsp
argument_list|)
operator|)
expr_stmt|;
comment|/* 	 * Print a header 	 */
name|printf
argument_list|(
name|AAL5_STATS_HDR
argument_list|,
name|get_adapter_name
argument_list|(
name|vi
operator|->
name|avsp_intf
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Print the AAL 5 info 	 */
name|printf
argument_list|(
literal|"%10ld  %10ld  %5ld  %5ld  %9ld  %9ld  %5ld  %9ld\n"
argument_list|,
name|stats
operator|->
name|proatm_st_aal5
operator|.
name|aal5_rcvd
argument_list|,
name|stats
operator|->
name|proatm_st_aal5
operator|.
name|aal5_xmit
argument_list|,
name|stats
operator|->
name|proatm_st_aal5
operator|.
name|aal5_crc_len
argument_list|,
name|stats
operator|->
name|proatm_st_aal5
operator|.
name|aal5_drops
argument_list|,
name|stats
operator|->
name|proatm_st_aal5
operator|.
name|aal5_pdu_rcvd
argument_list|,
name|stats
operator|->
name|proatm_st_aal5
operator|.
name|aal5_pdu_xmit
argument_list|,
name|stats
operator|->
name|proatm_st_aal5
operator|.
name|aal5_pdu_crc
argument_list|,
name|stats
operator|->
name|proatm_st_aal5
operator|.
name|aal5_pdu_drops
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print Proatm device driver statistics  *   * Arguments:  *	vi	pointer to vendor-specific statistics to print  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_proatm_driver
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
block|{
define|#
directive|define
name|DRIVER_STATS_HDR_1
define|\
value|"%s Device Driver Statistics\n\  VCC   VCC  VCC    RX   RX    RX    RX  RX err   RX   RX   RX    RX   RX Raw\n\  max   bad  out    No   No    Err   Err  Range   No   Null Full  Raw    No\n\  PDU   rng of Bps  CX  Pkhdr  buf   len   In    Bufs  PDU  Queue NoRdy Bufs\n"
define|#
directive|define
name|DRIVER_STATS_HDR_2
define|\
value|"%s Device Driver Statistics\n\  TX               TX     TX       TX    TX     TX\n\ part         TX   Idle Closing   Free   CBR  BestEff\n\  PDU         TBD  VBR    VCC    Queues  Bps   Queue\n"
name|Proatm_stats
modifier|*
name|stats
decl_stmt|;
comment|/* 	 * Bump stats pointer past header info 	 */
name|stats
operator|=
operator|(
name|Proatm_stats
operator|*
operator|)
operator|(
operator|(
name|uintptr_t
operator|)
name|vi
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|air_vinfo_rsp
argument_list|)
operator|)
expr_stmt|;
comment|/* 	 * Print the RX header 	 */
name|printf
argument_list|(
name|DRIVER_STATS_HDR_1
argument_list|,
name|get_adapter_name
argument_list|(
name|vi
operator|->
name|avsp_intf
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Print the RX driver info 	 */
name|printf
argument_list|(
literal|"%4ld  %4ld  %4ld  %4ld  %4ld  %4ld  %4ld  %4ld  %4ld  %4ld  %4ld  %4ld  %4ld\n"
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_vc_maxpdu
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_vc_badrng
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_vc_outofbw
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_rv_nocx
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_rv_nopkthdr
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_rv_invchain
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_rv_toobigpdu
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_rv_novcc
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_rv_nobufs
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_rv_null
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_rv_intrq
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_rv_rnotrdy
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_rv_rnobufs
argument_list|)
expr_stmt|;
comment|/* 	 * Print the TX header 	 */
name|printf
argument_list|(
name|DRIVER_STATS_HDR_2
argument_list|,
name|get_adapter_name
argument_list|(
name|vi
operator|->
name|avsp_intf
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Print the TX driver info 	 */
name|printf
argument_list|(
literal|"%4ld  %10ld  %4ld  %6ld  %5ld  %4ld  %4ld\n"
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_xm_txicp
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_xm_ntbd
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_xm_idlevbr
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_xm_closing
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_xm_qufree
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_xm_cbrbw
argument_list|,
name|stats
operator|->
name|proatm_st_drv
operator|.
name|drv_xm_ubr0free
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print Proatm controler statistics  *   * Arguments:  *	vi	pointer to vendor-specific statistics to print  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_proatm_dev
parameter_list|(
name|struct
name|air_vinfo_rsp
modifier|*
name|vi
parameter_list|)
block|{
if|#
directive|if
literal|0
define|#
directive|define
name|DEVICE_STATS_HDR
define|\
value|"%s Controler Statistics\n\  Phys\n\  Sig\n\  PDU\n"
comment|/*           1         2         3         4         5         6         7 01234567890123456789012345678901234567890123456789012345678901234567890123456789 */
block|Proatm_stats	*stats;
comment|/* 	 * Bump stats pointer past header info 	 */
block|stats = (Proatm_stats *) 			((uintptr_t) vi + sizeof(struct air_vinfo_rsp));
comment|/* 	 * Print a header 	 */
block|printf(DEVICE_STATS_HDR, get_adapter_name(vi->avsp_intf));
comment|/* 	 * Print the driver info 	 */
block|printf("%s\n", 			stats->proatm_st_drv.drv_dv_phys ? "on" : "off");
else|#
directive|else
name|printf
argument_list|(
literal|"The controler statistics are not supported yet\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

end_unit

