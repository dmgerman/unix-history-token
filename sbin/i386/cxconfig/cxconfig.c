begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Cronyx-Sigma adapter configuration utility for Unix.  *  * Copyright (C) 1994 Cronyx Ltd.  * Author: Serge Vakulenko,<vak@zebub.msk.su>  *  * This software is distributed with NO WARRANTIES, not even the implied  * warranties for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  *  * Authors grant any other persons or organisations permission to use  * or modify this software as long as this message is kept with the software,  * all derivative works or modified versions.  *  * Version 1.9, Wed Oct  4 18:58:15 MSK 1995  *  * Usage:  *      cxconfig [-a]  *              -- print status of all channels  *      cxconfig [-a]<channel>  *              -- print status of the channel  *      cxconfig<channel><option>...  *              -- set channel options  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
init|=
literal|"$FreeBSD$"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<machine/cronyx.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_define
define|#
directive|define
name|NBRD
value|3
end_define

begin_define
define|#
directive|define
name|CXDEV
value|"/dev/cronyx"
end_define

begin_define
define|#
directive|define
name|atoi
parameter_list|(
name|a
parameter_list|)
value|strtol((a), (char**)0, 0)
end_define

begin_decl_stmt
name|cx_options_t
name|o
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|cx_stat_t
name|st
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|aflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|sflag
decl_stmt|;
end_decl_stmt

begin_function
name|char
modifier|*
name|symbol
parameter_list|(
name|unsigned
name|char
name|sym
parameter_list|)
block|{
specifier|static
name|char
name|buf
index|[
literal|40
index|]
decl_stmt|;
if|if
condition|(
name|sym
operator|<
literal|' '
condition|)
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"^%c"
argument_list|,
name|sym
operator|+
literal|0100
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|sym
operator|==
literal|'\\'
condition|)
name|strcat
argument_list|(
name|buf
argument_list|,
literal|"\\\\"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|sym
operator|<
literal|127
condition|)
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%c"
argument_list|,
name|sym
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"\\%03o"
argument_list|,
name|sym
argument_list|)
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
name|unsigned
name|char
name|atosym
parameter_list|(
name|char
modifier|*
name|s
parameter_list|)
block|{
if|if
condition|(
operator|*
name|s
operator|==
literal|'^'
condition|)
return|return
operator|(
operator|*
operator|++
name|s
operator|&
literal|037
operator|)
return|;
if|if
condition|(
operator|*
name|s
operator|==
literal|'\\'
condition|)
return|return
operator|(
name|strtol
argument_list|(
operator|++
name|s
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|)
operator|)
return|;
return|return
operator|(
operator|*
name|s
operator|)
return|;
block|}
end_function

begin_function
name|void
name|usage
parameter_list|()
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Cronyx-Sigma Adapter Configuration Utility, Version 1.0\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Copyright (C) 1994 Cronyx Ltd.\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"usage: cxconfig [-a] [<channel> [<option>...]]\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
name|chantype
parameter_list|(
name|int
name|type
parameter_list|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|T_NONE
case|:
return|return
operator|(
literal|"none"
operator|)
return|;
case|case
name|T_ASYNC
case|:
return|return
operator|(
literal|"RS-232"
operator|)
return|;
case|case
name|T_UNIV_RS232
case|:
return|return
operator|(
literal|"RS-232"
operator|)
return|;
case|case
name|T_UNIV_RS449
case|:
return|return
operator|(
literal|"RS-232/RS-449"
operator|)
return|;
case|case
name|T_UNIV_V35
case|:
return|return
operator|(
literal|"RS-232/V.35"
operator|)
return|;
case|case
name|T_SYNC_RS232
case|:
return|return
operator|(
literal|"RS-232"
operator|)
return|;
case|case
name|T_SYNC_V35
case|:
return|return
operator|(
literal|"V.35"
operator|)
return|;
case|case
name|T_SYNC_RS449
case|:
return|return
operator|(
literal|"RS-449"
operator|)
return|;
block|}
block|}
end_function

begin_function
name|char
modifier|*
name|chanmode
parameter_list|(
name|int
name|mode
parameter_list|)
block|{
switch|switch
condition|(
name|mode
condition|)
block|{
case|case
name|M_ASYNC
case|:
return|return
operator|(
literal|"Async"
operator|)
return|;
case|case
name|M_HDLC
case|:
return|return
operator|(
literal|"HDLC"
operator|)
return|;
case|case
name|M_BISYNC
case|:
return|return
operator|(
literal|"Bisync"
operator|)
return|;
case|case
name|M_X21
case|:
return|return
operator|(
literal|"X.21"
operator|)
return|;
default|default:
return|return
operator|(
literal|"???"
operator|)
return|;
block|}
block|}
end_function

begin_function
name|void
name|getchan
parameter_list|(
name|int
name|channel
parameter_list|)
block|{
name|int
name|s
init|=
name|open
argument_list|(
name|CXDEV
argument_list|,
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|s
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s"
argument_list|,
name|CXDEV
argument_list|)
expr_stmt|;
name|o
operator|.
name|board
operator|=
name|channel
operator|/
name|NCHAN
expr_stmt|;
name|o
operator|.
name|channel
operator|=
name|channel
operator|%
name|NCHAN
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|CXIOCGETMODE
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|o
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"CXIOCGETMODE"
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|.
name|type
operator|==
name|T_NONE
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"cx%d: channel %d not configured"
argument_list|,
name|o
operator|.
name|board
argument_list|,
name|o
operator|.
name|channel
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|printstats
parameter_list|(
name|int
name|channel
parameter_list|,
name|int
name|hflag
parameter_list|)
block|{
name|int
name|s
decl_stmt|,
name|res
decl_stmt|;
name|s
operator|=
name|open
argument_list|(
name|CXDEV
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s"
argument_list|,
name|CXDEV
argument_list|)
expr_stmt|;
name|st
operator|.
name|board
operator|=
name|channel
operator|/
name|NCHAN
expr_stmt|;
name|st
operator|.
name|channel
operator|=
name|channel
operator|%
name|NCHAN
expr_stmt|;
name|res
operator|=
name|ioctl
argument_list|(
name|s
argument_list|,
name|CXIOCGETSTAT
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|st
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|res
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|hflag
condition|)
name|printf
argument_list|(
literal|"Chan   Rintr   Tintr   Mintr   Ibytes   Ipkts   Ierrs   Obytes   Opkts   Oerrs\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"cx%-2d %7ld %7ld %7ld %8ld %7ld %7ld %8ld %7ld %7ld\n"
argument_list|,
name|channel
argument_list|,
name|st
operator|.
name|rintr
argument_list|,
name|st
operator|.
name|tintr
argument_list|,
name|st
operator|.
name|mintr
argument_list|,
name|st
operator|.
name|ibytes
argument_list|,
name|st
operator|.
name|ipkts
argument_list|,
name|st
operator|.
name|ierrs
argument_list|,
name|st
operator|.
name|obytes
argument_list|,
name|st
operator|.
name|opkts
argument_list|,
name|st
operator|.
name|oerrs
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
name|printallstats
parameter_list|()
block|{
name|int
name|b
decl_stmt|,
name|c
decl_stmt|;
name|printf
argument_list|(
literal|"Chan   Rintr   Tintr   Mintr   Ibytes   Ipkts   Ierrs   Obytes   Opkts   Oerrs\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|NBRD
condition|;
operator|++
name|b
control|)
for|for
control|(
name|c
operator|=
literal|0
init|;
name|c
operator|<
name|NCHAN
condition|;
operator|++
name|c
control|)
name|printstats
argument_list|(
name|b
operator|*
name|NCHAN
operator|+
name|c
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|setchan
parameter_list|(
name|int
name|channel
parameter_list|)
block|{
name|int
name|s
init|=
name|open
argument_list|(
name|CXDEV
argument_list|,
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|s
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s"
argument_list|,
name|CXDEV
argument_list|)
expr_stmt|;
name|o
operator|.
name|board
operator|=
name|channel
operator|/
name|NCHAN
expr_stmt|;
name|o
operator|.
name|channel
operator|=
name|channel
operator|%
name|NCHAN
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|CXIOCSETMODE
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|o
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"CXIOCSETMODE"
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|printopt
parameter_list|()
block|{
comment|/* Common channel options */
comment|/* channel option register 4 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"fifo=%d "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|cor4
operator|.
name|thr
argument_list|)
expr_stmt|;
comment|/* FIFO threshold */
name|printf
argument_list|(
literal|"%cctsdown "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|cor4
operator|.
name|cts_zd
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* detect 1 to 0 transition on the CTS */
name|printf
argument_list|(
literal|"%ccddown "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|cor4
operator|.
name|cd_zd
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* detect 1 to 0 transition on the CD */
name|printf
argument_list|(
literal|"%cdsrdown "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|cor4
operator|.
name|dsr_zd
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* detect 1 to 0 transition on the DSR */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* channel option register 5 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rfifo=%d "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|cor5
operator|.
name|rx_thr
argument_list|)
expr_stmt|;
comment|/* receive flow control FIFO threshold */
name|printf
argument_list|(
literal|"%cctsup "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|cor5
operator|.
name|cts_od
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* detect 0 to 1 transition on the CTS */
name|printf
argument_list|(
literal|"%ccdup "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|cor5
operator|.
name|cd_od
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* detect 0 to 1 transition on the CD */
name|printf
argument_list|(
literal|"%cdsrup "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|cor5
operator|.
name|dsr_od
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* detect 0 to 1 transition on the DSR */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* receive clock option register */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|rcor
operator|.
name|encod
operator|==
name|ENCOD_NRZ
condition|?
literal|"nrz"
else|:
comment|/* signal encoding */
name|o
operator|.
name|opt
operator|.
name|rcor
operator|.
name|encod
operator|==
name|ENCOD_NRZI
condition|?
literal|"nrzi"
else|:
name|o
operator|.
name|opt
operator|.
name|rcor
operator|.
name|encod
operator|==
name|ENCOD_MANCHESTER
condition|?
literal|"manchester"
else|:
literal|"???"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%cdpll "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|rcor
operator|.
name|dpll
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* DPLL enable */
comment|/* transmit clock option register */
name|printf
argument_list|(
literal|"%clloop "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|tcor
operator|.
name|llm
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* local loopback mode */
name|printf
argument_list|(
literal|"%cextclock "
argument_list|,
name|o
operator|.
name|opt
operator|.
name|tcor
operator|.
name|ext1x
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* external 1x clock mode */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|o
operator|.
name|mode
condition|)
block|{
case|case
name|M_ASYNC
case|:
comment|/* async mode options */
comment|/* channel option register 1 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"cs%d "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|charlen
operator|+
literal|1
argument_list|)
expr_stmt|;
comment|/* character length, 5..8 */
name|printf
argument_list|(
literal|"par%s "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|parity
condition|?
literal|"odd"
else|:
literal|"even"
argument_list|)
expr_stmt|;
comment|/* parity */
name|printf
argument_list|(
literal|"%cignpar "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|ignpar
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* ignore parity */
if|if
condition|(
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|parmode
operator|!=
name|PARM_NORMAL
condition|)
comment|/* parity mode */
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|parmode
operator|==
name|PARM_NOPAR
condition|?
literal|"nopar"
else|:
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|parmode
operator|==
name|PARM_FORCE
condition|?
literal|"forcepar"
else|:
literal|"???"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* channel option register 2 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%cdsr "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|dsrae
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* DSR automatic enable */
name|printf
argument_list|(
literal|"%ccts "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|ctsae
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* CTS automatic enable */
name|printf
argument_list|(
literal|"%crts "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|rtsao
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* RTS automatic output enable */
name|printf
argument_list|(
literal|"%crloop "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|rlm
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* remote loopback mode enable */
name|printf
argument_list|(
literal|"%cetc "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|etc
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* embedded transmitter cmd enable */
name|printf
argument_list|(
literal|"%cxon "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|ixon
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* in-band XON/XOFF enable */
name|printf
argument_list|(
literal|"%cxany "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|ixany
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* XON on any character */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* option register 3 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|stopb
operator|==
name|STOPB_1
condition|?
literal|"stopb1"
else|:
comment|/* stop bit length */
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|stopb
operator|==
name|STOPB_15
condition|?
literal|"stopb1.5"
else|:
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|stopb
operator|==
name|STOPB_2
condition|?
literal|"stopb2"
else|:
literal|"???"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%csdt "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|scde
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* special char detection enable */
name|printf
argument_list|(
literal|"%cflowct "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|flowct
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* flow control transparency mode */
name|printf
argument_list|(
literal|"%crdt "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|rngde
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* range detect enable */
name|printf
argument_list|(
literal|"%cexdt "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|escde
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* extended spec. char detect enable */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* channel option register 6 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|parerr
operator|==
name|PERR_INTR
condition|?
literal|"parintr"
else|:
comment|/* parity/framing error actions */
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|parerr
operator|==
name|PERR_NULL
condition|?
literal|"parnull"
else|:
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|parerr
operator|==
name|PERR_IGNORE
condition|?
literal|"parign"
else|:
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|parerr
operator|==
name|PERR_DISCARD
condition|?
literal|"pardisc"
else|:
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|parerr
operator|==
name|PERR_FFNULL
condition|?
literal|"parffnull"
else|:
literal|"???"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|brk
operator|==
name|BRK_INTR
condition|?
literal|"brkintr"
else|:
comment|/* action on break condition */
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|brk
operator|==
name|BRK_NULL
condition|?
literal|"brknull"
else|:
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|brk
operator|==
name|BRK_DISCARD
condition|?
literal|"brkdisc"
else|:
literal|"???"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%cinlcr "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|inlcr
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* translate NL to CR on input */
name|printf
argument_list|(
literal|"%cicrnl "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|icrnl
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* translate CR to NL on input */
name|printf
argument_list|(
literal|"%cigncr "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|igncr
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* discard CR on input */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* channel option register 7 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%cocrnl "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|ocrnl
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* translate CR to NL on output */
name|printf
argument_list|(
literal|"%conlcr "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|onlcr
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* translate NL to CR on output */
name|printf
argument_list|(
literal|"%cfcerr "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|fcerr
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* process flow ctl err chars enable */
name|printf
argument_list|(
literal|"%clnext "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|lnext
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* LNext option enable */
name|printf
argument_list|(
literal|"%cistrip "
argument_list|,
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|istrip
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* strip 8-bit on input */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"schr1=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|aopt
operator|.
name|schr1
argument_list|)
argument_list|)
expr_stmt|;
comment|/* special character register 1 (XON) */
name|printf
argument_list|(
literal|"schr2=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|aopt
operator|.
name|schr2
argument_list|)
argument_list|)
expr_stmt|;
comment|/* special character register 2 (XOFF) */
name|printf
argument_list|(
literal|"schr3=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|aopt
operator|.
name|schr3
argument_list|)
argument_list|)
expr_stmt|;
comment|/* special character register 3 */
name|printf
argument_list|(
literal|"schr4=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|aopt
operator|.
name|schr4
argument_list|)
argument_list|)
expr_stmt|;
comment|/* special character register 4 */
name|printf
argument_list|(
literal|"scrl=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|aopt
operator|.
name|scrl
argument_list|)
argument_list|)
expr_stmt|;
comment|/* special character range low */
name|printf
argument_list|(
literal|"scrh=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|aopt
operator|.
name|scrh
argument_list|)
argument_list|)
expr_stmt|;
comment|/* special character range high */
name|printf
argument_list|(
literal|"lnext=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|aopt
operator|.
name|lnxt
argument_list|)
argument_list|)
expr_stmt|;
comment|/* LNext character */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|M_HDLC
case|:
comment|/* hdlc mode options */
comment|/* hdlc channel option register 1 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"if%d "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|ifflags
argument_list|)
expr_stmt|;
comment|/* number of inter-frame flags sent */
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|admode
operator|==
name|ADMODE_NOADDR
condition|?
literal|"noaddr"
else|:
comment|/* addressing mode */
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|admode
operator|==
name|ADMODE_4_1
condition|?
literal|"addr1"
else|:
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|admode
operator|==
name|ADMODE_2_2
condition|?
literal|"addr2"
else|:
literal|"???"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%cclrdet "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|clrdet
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* clear detect for X.21 data transfer phase */
name|printf
argument_list|(
literal|"addrlen%d "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|aflo
operator|+
literal|1
argument_list|)
expr_stmt|;
comment|/* address field length option */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* hdlc channel option register 2 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%cdsr "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|dsrae
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* DSR automatic enable */
name|printf
argument_list|(
literal|"%ccts "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|ctsae
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* CTS automatic enable */
name|printf
argument_list|(
literal|"%crts "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|rtsao
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* RTS automatic output enable */
name|printf
argument_list|(
literal|"%ccrcinv "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|crcninv
condition|?
literal|'-'
else|:
literal|'+'
argument_list|)
expr_stmt|;
comment|/* CRC invertion option */
name|printf
argument_list|(
literal|"%cfcsapd "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|fcsapd
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* FCS append */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* hdlc channel option register 3 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"pad%d "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|padcnt
argument_list|)
expr_stmt|;
comment|/* pad character count */
name|printf
argument_list|(
literal|"idle%s "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|idle
condition|?
literal|"mark"
else|:
literal|"flag"
argument_list|)
expr_stmt|;
comment|/* idle mode */
name|printf
argument_list|(
literal|"%cfcs "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|nofcs
condition|?
literal|'-'
else|:
literal|'+'
argument_list|)
expr_stmt|;
comment|/* FCS disable */
name|printf
argument_list|(
literal|"fcs-%s "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|fcspre
condition|?
literal|"crc-16"
else|:
literal|"v.41"
argument_list|)
expr_stmt|;
comment|/* FCS preset */
name|printf
argument_list|(
literal|"syn=%s "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|syncpat
condition|?
literal|"0xAA"
else|:
literal|"0x00"
argument_list|)
expr_stmt|;
comment|/* send sync pattern */
name|printf
argument_list|(
literal|"%csyn "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|sndpad
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* send pad characters before flag enable */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rfar1=0x%02x "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|rfar1
argument_list|)
expr_stmt|;
comment|/* receive frame address register 1 */
name|printf
argument_list|(
literal|"rfar2=0x%02x "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|rfar2
argument_list|)
expr_stmt|;
comment|/* receive frame address register 2 */
name|printf
argument_list|(
literal|"rfar3=0x%02x "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|rfar3
argument_list|)
expr_stmt|;
comment|/* receive frame address register 3 */
name|printf
argument_list|(
literal|"rfar4=0x%02x "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|rfar4
argument_list|)
expr_stmt|;
comment|/* receive frame address register 4 */
name|printf
argument_list|(
literal|"crc-%s "
argument_list|,
name|o
operator|.
name|hopt
operator|.
name|cpsr
condition|?
literal|"16"
else|:
literal|"v.41"
argument_list|)
expr_stmt|;
comment|/* CRC polynomial select */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|M_BISYNC
case|:
comment|/* bisync mode options */
comment|/* channel option register 1 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"cs%d "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor1
operator|.
name|charlen
operator|+
literal|1
argument_list|)
expr_stmt|;
comment|/* character length, 5..8 */
name|printf
argument_list|(
literal|"par%s "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor1
operator|.
name|parity
condition|?
literal|"odd"
else|:
literal|"even"
argument_list|)
expr_stmt|;
comment|/* parity */
name|printf
argument_list|(
literal|"%cignpar "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor1
operator|.
name|ignpar
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* ignore parity */
if|if
condition|(
name|o
operator|.
name|bopt
operator|.
name|cor1
operator|.
name|parmode
operator|!=
name|PARM_NORMAL
condition|)
comment|/* parity mode */
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor1
operator|.
name|parmode
operator|==
name|PARM_NOPAR
condition|?
literal|"nopar"
else|:
name|o
operator|.
name|bopt
operator|.
name|cor1
operator|.
name|parmode
operator|==
name|PARM_FORCE
condition|?
literal|"forcepar"
else|:
literal|"???"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* channel option register 2 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"syn%d "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor2
operator|.
name|syns
operator|+
literal|2
argument_list|)
expr_stmt|;
comment|/* number of extra SYN chars before a frame */
name|printf
argument_list|(
literal|"%ccrcinv "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor2
operator|.
name|crcninv
condition|?
literal|'-'
else|:
literal|'+'
argument_list|)
expr_stmt|;
comment|/* CRC invertion option */
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor2
operator|.
name|ebcdic
condition|?
literal|"ebcdic"
else|:
literal|"ascii"
argument_list|)
expr_stmt|;
comment|/* use EBCDIC as char set (instead of ASCII) */
name|printf
argument_list|(
literal|"%cbccapd "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor2
operator|.
name|bcc
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* BCC append enable */
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor2
operator|.
name|lrc
condition|?
literal|"lrc"
else|:
literal|"crc-16"
argument_list|)
expr_stmt|;
comment|/* longitudinal redundancy check */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* channel option register 3 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"pad%d "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor3
operator|.
name|padcnt
argument_list|)
expr_stmt|;
comment|/* pad character count */
name|printf
argument_list|(
literal|"idle%s "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor3
operator|.
name|idle
condition|?
literal|"mark"
else|:
literal|"syn"
argument_list|)
expr_stmt|;
comment|/* idle mode */
name|printf
argument_list|(
literal|"%cfcs "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor3
operator|.
name|nofcs
condition|?
literal|'-'
else|:
literal|'+'
argument_list|)
expr_stmt|;
comment|/* FCS disable */
name|printf
argument_list|(
literal|"fcs-%s "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor3
operator|.
name|fcspre
condition|?
literal|"crc-16"
else|:
literal|"v.41"
argument_list|)
expr_stmt|;
comment|/* FCS preset */
name|printf
argument_list|(
literal|"syn=%s "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor3
operator|.
name|padpat
condition|?
literal|"0x55"
else|:
literal|"0xAA"
argument_list|)
expr_stmt|;
comment|/* send sync pattern */
name|printf
argument_list|(
literal|"%csyn "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cor3
operator|.
name|sndpad
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* send pad characters before flag enable */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* channel option register 6 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"specterm=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|bopt
operator|.
name|cor6
operator|.
name|specterm
argument_list|)
argument_list|)
expr_stmt|;
comment|/* special termination character */
name|printf
argument_list|(
literal|"crc-%s "
argument_list|,
name|o
operator|.
name|bopt
operator|.
name|cpsr
condition|?
literal|"16"
else|:
literal|"v.41"
argument_list|)
expr_stmt|;
comment|/* CRC polynomial select */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|M_X21
case|:
comment|/* x.21 mode options */
comment|/* channel option register 1 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"cs%d "
argument_list|,
name|o
operator|.
name|xopt
operator|.
name|cor1
operator|.
name|charlen
operator|+
literal|1
argument_list|)
expr_stmt|;
comment|/* character length, 5..8 */
name|printf
argument_list|(
literal|"par%s "
argument_list|,
name|o
operator|.
name|xopt
operator|.
name|cor1
operator|.
name|parity
condition|?
literal|"odd"
else|:
literal|"even"
argument_list|)
expr_stmt|;
comment|/* parity */
name|printf
argument_list|(
literal|"%cignpar "
argument_list|,
name|o
operator|.
name|xopt
operator|.
name|cor1
operator|.
name|ignpar
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* ignore parity */
if|if
condition|(
name|o
operator|.
name|xopt
operator|.
name|cor1
operator|.
name|parmode
operator|!=
name|PARM_NORMAL
condition|)
comment|/* parity mode */
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|o
operator|.
name|xopt
operator|.
name|cor1
operator|.
name|parmode
operator|==
name|PARM_NOPAR
condition|?
literal|"nopar"
else|:
name|o
operator|.
name|xopt
operator|.
name|cor1
operator|.
name|parmode
operator|==
name|PARM_FORCE
condition|?
literal|"forcepar"
else|:
literal|"???"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* channel option register 2 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%cetc "
argument_list|,
name|o
operator|.
name|xopt
operator|.
name|cor2
operator|.
name|etc
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* embedded transmitter cmd enable */
comment|/* channel option register 3 */
name|printf
argument_list|(
literal|"%csdt "
argument_list|,
name|o
operator|.
name|xopt
operator|.
name|cor3
operator|.
name|scde
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* special char detection enable */
name|printf
argument_list|(
literal|"%cstripsyn "
argument_list|,
name|o
operator|.
name|xopt
operator|.
name|cor3
operator|.
name|stripsyn
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* treat SYN chars as special condition */
name|printf
argument_list|(
literal|"%cssdt "
argument_list|,
name|o
operator|.
name|xopt
operator|.
name|cor3
operator|.
name|ssde
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
comment|/* steady state detect enable */
name|printf
argument_list|(
literal|"syn%c "
argument_list|,
name|o
operator|.
name|xopt
operator|.
name|cor3
operator|.
name|syn
condition|?
literal|'1'
else|:
literal|'2'
argument_list|)
expr_stmt|;
comment|/* the number of SYN chars on receive */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* channel option register 6 */
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"syn=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|xopt
operator|.
name|cor6
operator|.
name|synchar
argument_list|)
argument_list|)
expr_stmt|;
comment|/* syn character */
name|printf
argument_list|(
literal|"schr1=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|xopt
operator|.
name|schr1
argument_list|)
argument_list|)
expr_stmt|;
comment|/* special character register 1 */
name|printf
argument_list|(
literal|"schr2=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|xopt
operator|.
name|schr2
argument_list|)
argument_list|)
expr_stmt|;
comment|/* special character register 2 */
name|printf
argument_list|(
literal|"schr3=%s "
argument_list|,
name|symbol
argument_list|(
name|o
operator|.
name|xopt
operator|.
name|schr3
argument_list|)
argument_list|)
expr_stmt|;
comment|/* special character register 3 */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
name|void
name|printchan
parameter_list|(
name|int
name|channel
parameter_list|)
block|{
name|printf
argument_list|(
literal|"cx%d (%s) %s"
argument_list|,
name|channel
argument_list|,
name|chantype
argument_list|(
name|o
operator|.
name|type
argument_list|)
argument_list|,
name|chanmode
argument_list|(
name|o
operator|.
name|mode
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
operator|.
name|txbaud
operator|==
name|o
operator|.
name|rxbaud
condition|)
name|printf
argument_list|(
literal|" %d"
argument_list|,
name|o
operator|.
name|rxbaud
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" ospeed=%d ispeed=%d"
argument_list|,
name|o
operator|.
name|txbaud
argument_list|,
name|o
operator|.
name|rxbaud
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|o
operator|.
name|channel
operator|==
literal|0
operator|||
name|o
operator|.
name|channel
operator|==
literal|8
operator|)
operator|&&
operator|(
name|o
operator|.
name|type
operator|==
name|T_UNIV_V35
operator|||
name|o
operator|.
name|type
operator|==
name|T_UNIV_RS449
operator|)
condition|)
name|printf
argument_list|(
literal|" port=%s"
argument_list|,
name|o
operator|.
name|iftype
condition|?
operator|(
name|o
operator|.
name|type
operator|==
name|T_UNIV_V35
condition|?
literal|"v35"
else|:
literal|"rs449"
operator|)
else|:
literal|"rs232"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|o
operator|.
name|sopt
operator|.
name|ext
condition|?
literal|" ext"
else|:
name|o
operator|.
name|sopt
operator|.
name|cisco
condition|?
literal|" cisco"
else|:
literal|" ppp"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %ckeepalive"
argument_list|,
name|o
operator|.
name|sopt
operator|.
name|keepalive
condition|?
literal|'+'
else|:
literal|'-'
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %cautorts"
argument_list|,
name|o
operator|.
name|sopt
operator|.
name|norts
condition|?
literal|'-'
else|:
literal|'+'
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|o
operator|.
name|master
condition|)
name|printf
argument_list|(
literal|" master=%s"
argument_list|,
name|o
operator|.
name|master
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|aflag
condition|)
name|printopt
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|printall
parameter_list|()
block|{
name|struct
name|ifconf
name|ifc
decl_stmt|;
name|struct
name|ifreq
modifier|*
name|ifr
decl_stmt|;
name|char
name|buf
index|[
name|BUFSIZ
index|]
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
name|int
name|s
decl_stmt|,
name|c
decl_stmt|;
name|s
operator|=
name|socket
argument_list|(
name|AF_INET
argument_list|,
name|SOCK_DGRAM
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"socket"
argument_list|)
expr_stmt|;
name|ifc
operator|.
name|ifc_len
operator|=
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|ifc
operator|.
name|ifc_buf
operator|=
name|buf
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCGIFCONF
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|ifc
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"SIOCGIFCONF"
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|s
operator|=
name|open
argument_list|(
name|CXDEV
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s"
argument_list|,
name|CXDEV
argument_list|)
expr_stmt|;
name|ifr
operator|=
name|ifc
operator|.
name|ifc_req
expr_stmt|;
define|#
directive|define
name|max
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|((a)>(b) ? (a) : (b))
define|#
directive|define
name|size
parameter_list|(
name|p
parameter_list|)
value|max((p).sa_len, sizeof(p))
for|for
control|(
name|cp
operator|=
name|buf
init|;
name|cp
operator|<
name|buf
operator|+
name|ifc
operator|.
name|ifc_len
condition|;
name|cp
operator|+=
sizeof|sizeof
argument_list|(
name|ifr
operator|->
name|ifr_name
argument_list|)
operator|+
name|size
argument_list|(
name|ifr
operator|->
name|ifr_addr
argument_list|)
control|)
block|{
name|ifr
operator|=
operator|(
expr|struct
name|ifreq
operator|*
operator|)
name|cp
expr_stmt|;
if|if
condition|(
name|ifr
operator|->
name|ifr_addr
operator|.
name|sa_family
operator|!=
name|AF_LINK
condition|)
continue|continue;
if|if
condition|(
name|strncmp
argument_list|(
name|ifr
operator|->
name|ifr_name
argument_list|,
literal|"cx"
argument_list|,
literal|2
argument_list|)
operator|!=
literal|0
condition|)
continue|continue;
name|c
operator|=
name|atoi
argument_list|(
name|ifr
operator|->
name|ifr_name
operator|+
literal|2
argument_list|)
expr_stmt|;
name|o
operator|.
name|board
operator|=
name|c
operator|/
name|NCHAN
expr_stmt|;
name|o
operator|.
name|channel
operator|=
name|c
operator|%
name|NCHAN
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|CXIOCGETMODE
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|o
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"CXIOCGETMODE"
argument_list|)
expr_stmt|;
name|printchan
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|set_interface_type
parameter_list|(
name|char
modifier|*
name|type
parameter_list|)
block|{
if|if
condition|(
name|o
operator|.
name|channel
operator|!=
literal|0
operator|&&
name|o
operator|.
name|channel
operator|!=
literal|8
condition|)
block|{
name|printf
argument_list|(
literal|"interface option is applicable only for channels 0 and 8\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|o
operator|.
name|type
operator|!=
name|T_UNIV_V35
operator|&&
name|o
operator|.
name|type
operator|!=
name|T_UNIV_RS449
condition|)
block|{
name|printf
argument_list|(
literal|"interface option is applicable only for universal channels\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|type
argument_list|,
literal|"port=rs232"
argument_list|)
condition|)
name|o
operator|.
name|iftype
operator|=
literal|0
expr_stmt|;
else|else
name|o
operator|.
name|iftype
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
name|void
name|set_master
parameter_list|(
name|char
modifier|*
name|ifname
parameter_list|)
block|{
if|if
condition|(
name|o
operator|.
name|type
operator|==
name|T_ASYNC
condition|)
block|{
name|printf
argument_list|(
literal|"master option is not applicable for async channels\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|o
operator|.
name|master
argument_list|,
name|ifname
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|set_async_opt
parameter_list|(
name|char
modifier|*
name|opt
parameter_list|)
block|{
comment|/* channel option register 1 */
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"cs"
argument_list|,
literal|2
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|charlen
operator|=
name|atoi
argument_list|(
name|opt
operator|+
literal|2
argument_list|)
operator|-
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"parodd"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|parity
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"pareven"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|parity
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-ignpar"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|ignpar
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+ignpar"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|ignpar
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"nopar"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|parmode
operator|=
name|PARM_NOPAR
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"forcepar"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor1
operator|.
name|parmode
operator|=
name|PARM_FORCE
expr_stmt|;
comment|/* channel option register 2 */
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-dsr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|dsrae
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+dsr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|dsrae
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-cts"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|ctsae
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+cts"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|ctsae
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-rts"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|rtsao
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+rts"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|rtsao
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-rloop"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|rlm
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+rloop"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|rlm
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-etc"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|etc
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+etc"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|etc
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-ixon"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|ixon
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+ixon"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|ixon
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-ixany"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|ixany
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+ixany"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor2
operator|.
name|ixany
operator|=
literal|1
expr_stmt|;
comment|/* option register 3 */
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"stopb1"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|stopb
operator|=
name|STOPB_1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"stopb1.5"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|stopb
operator|=
name|STOPB_15
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"stopb2"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|stopb
operator|=
name|STOPB_2
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-sdt"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|scde
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+sdt"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|scde
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-flowct"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|flowct
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+flowct"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|flowct
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-rdt"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|rngde
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+rdt"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|rngde
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-exdt"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|escde
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+exdt"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor3
operator|.
name|escde
operator|=
literal|1
expr_stmt|;
comment|/* channel option register 6 */
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"parintr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|parerr
operator|=
name|PERR_INTR
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"parnull"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|parerr
operator|=
name|PERR_NULL
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"parign"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|parerr
operator|=
name|PERR_IGNORE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"pardisc"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|parerr
operator|=
name|PERR_DISCARD
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"parffnull"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|parerr
operator|=
name|PERR_FFNULL
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"brkintr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|brk
operator|=
name|BRK_INTR
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"brknull"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|brk
operator|=
name|BRK_NULL
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"brkdisc"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|brk
operator|=
name|BRK_DISCARD
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-inlcr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|inlcr
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+inlcr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|inlcr
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-icrnl"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|icrnl
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+icrnl"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|icrnl
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-igncr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|igncr
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+igncr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor6
operator|.
name|igncr
operator|=
literal|1
expr_stmt|;
comment|/* channel option register 7 */
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-ocrnl"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|ocrnl
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+ocrnl"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|ocrnl
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-onlcr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|onlcr
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+onlcr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|onlcr
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-fcerr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|fcerr
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+fcerr"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|fcerr
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-lnext"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|lnext
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+lnext"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|lnext
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-istrip"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|istrip
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+istrip"
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|cor7
operator|.
name|istrip
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"schr1="
argument_list|,
literal|6
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|schr1
operator|=
name|atosym
argument_list|(
name|opt
operator|+
literal|6
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"schr2="
argument_list|,
literal|6
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|schr2
operator|=
name|atosym
argument_list|(
name|opt
operator|+
literal|6
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"schr3="
argument_list|,
literal|6
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|schr3
operator|=
name|atosym
argument_list|(
name|opt
operator|+
literal|6
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"schr4="
argument_list|,
literal|6
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|schr4
operator|=
name|atosym
argument_list|(
name|opt
operator|+
literal|6
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"scrl="
argument_list|,
literal|5
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|scrl
operator|=
name|atosym
argument_list|(
name|opt
operator|+
literal|5
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"scrh="
argument_list|,
literal|5
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|scrh
operator|=
name|atosym
argument_list|(
name|opt
operator|+
literal|5
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"lnext="
argument_list|,
literal|6
argument_list|)
condition|)
name|o
operator|.
name|aopt
operator|.
name|lnxt
operator|=
name|atosym
argument_list|(
name|opt
operator|+
literal|6
argument_list|)
expr_stmt|;
else|else
name|usage
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|set_hdlc_opt
parameter_list|(
name|char
modifier|*
name|opt
parameter_list|)
block|{
comment|/* hdlc channel option register 1 */
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"if"
argument_list|,
literal|2
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|ifflags
operator|=
name|atoi
argument_list|(
name|opt
operator|+
literal|2
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"noaddr"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|admode
operator|=
name|ADMODE_NOADDR
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"addr1"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|admode
operator|=
name|ADMODE_4_1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"addr2"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|admode
operator|=
name|ADMODE_2_2
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-clrdet"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|clrdet
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+clrdet"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|clrdet
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"addrlen1"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|aflo
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"addrlen2"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor1
operator|.
name|aflo
operator|=
literal|1
expr_stmt|;
comment|/* hdlc channel option register 2 */
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-dsr"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|dsrae
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+dsr"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|dsrae
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-cts"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|ctsae
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+cts"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|ctsae
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-rts"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|rtsao
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+rts"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|rtsao
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-fcsapd"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|fcsapd
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+fcsapd"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|fcsapd
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-crcinv"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|crcninv
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+crcinv"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor2
operator|.
name|crcninv
operator|=
literal|0
expr_stmt|;
comment|/* hdlc channel option register 3 */
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"pad"
argument_list|,
literal|3
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|padcnt
operator|=
name|atoi
argument_list|(
name|opt
operator|+
literal|3
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"idlemark"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|idle
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"idleflag"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|idle
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-fcs"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|nofcs
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+fcs"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|nofcs
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"fcs-crc-16"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|fcspre
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"fcs-v.41"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|fcspre
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"syn=0xaa"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|syncpat
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"syn=0x00"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|syncpat
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"-syn"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|sndpad
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"+syn"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cor3
operator|.
name|sndpad
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"rfar1="
argument_list|,
literal|6
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|rfar1
operator|=
name|atoi
argument_list|(
name|opt
operator|+
literal|6
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"rfar2="
argument_list|,
literal|6
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|rfar2
operator|=
name|atoi
argument_list|(
name|opt
operator|+
literal|6
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"rfar3="
argument_list|,
literal|6
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|rfar3
operator|=
name|atoi
argument_list|(
name|opt
operator|+
literal|6
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
name|opt
argument_list|,
literal|"rfar4="
argument_list|,
literal|6
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|rfar4
operator|=
name|atoi
argument_list|(
name|opt
operator|+
literal|6
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"crc-16"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cpsr
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
name|opt
argument_list|,
literal|"crc-v.41"
argument_list|)
condition|)
name|o
operator|.
name|hopt
operator|.
name|cpsr
operator|=
literal|0
expr_stmt|;
else|else
name|usage
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|set_bisync_opt
parameter_list|(
name|char
modifier|*
name|opt
parameter_list|)
block|{
name|usage
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|set_x21_opt
parameter_list|(
name|char
modifier|*
name|opt
parameter_list|)
block|{
name|usage
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|int
name|channel
decl_stmt|;
for|for
control|(
operator|--
name|argc
operator|,
operator|++
name|argv
init|;
name|argc
operator|>
literal|0
operator|&&
operator|*
operator|*
name|argv
operator|==
literal|'-'
condition|;
operator|--
name|argc
operator|,
operator|++
name|argv
control|)
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-a"
argument_list|)
condition|)
operator|++
name|aflag
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-s"
argument_list|)
condition|)
operator|++
name|sflag
expr_stmt|;
else|else
name|usage
argument_list|()
expr_stmt|;
if|if
condition|(
name|argc
operator|<=
literal|0
condition|)
block|{
if|if
condition|(
name|sflag
condition|)
name|printallstats
argument_list|()
expr_stmt|;
else|else
name|printall
argument_list|()
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|argv
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|==
literal|'c'
operator|&&
name|argv
index|[
literal|0
index|]
index|[
literal|1
index|]
operator|==
literal|'x'
condition|)
operator|*
name|argv
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
operator|*
operator|*
name|argv
operator|<
literal|'0'
operator|||
operator|*
operator|*
name|argv
operator|>
literal|'9'
condition|)
name|usage
argument_list|()
expr_stmt|;
name|channel
operator|=
name|atoi
argument_list|(
operator|*
name|argv
argument_list|)
expr_stmt|;
operator|--
name|argc
operator|,
operator|++
name|argv
expr_stmt|;
if|if
condition|(
name|sflag
condition|)
block|{
if|if
condition|(
name|printstats
argument_list|(
name|channel
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
name|printf
argument_list|(
literal|"channel cx%d not available\n"
argument_list|,
name|channel
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|getchan
argument_list|(
name|channel
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|<=
literal|0
condition|)
block|{
name|printchan
argument_list|(
name|channel
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
for|for
control|(
init|;
name|argc
operator|>
literal|0
condition|;
operator|--
name|argc
operator|,
operator|++
name|argv
control|)
if|if
condition|(
operator|*
operator|*
name|argv
operator|==
literal|'('
condition|)
continue|continue;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"ispeed="
argument_list|,
literal|7
argument_list|)
condition|)
name|o
operator|.
name|rxbaud
operator|=
name|atoi
argument_list|(
operator|*
name|argv
operator|+
literal|7
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"ospeed="
argument_list|,
literal|7
argument_list|)
condition|)
name|o
operator|.
name|txbaud
operator|=
name|atoi
argument_list|(
operator|*
name|argv
operator|+
literal|7
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"async"
argument_list|)
condition|)
name|o
operator|.
name|mode
operator|=
name|M_ASYNC
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"hdlc"
argument_list|)
condition|)
name|o
operator|.
name|mode
operator|=
name|M_HDLC
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"bisync"
argument_list|)
operator|||
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"bsc"
argument_list|)
condition|)
name|o
operator|.
name|mode
operator|=
name|M_BISYNC
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"x.21"
argument_list|)
operator|||
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"x21"
argument_list|)
condition|)
name|o
operator|.
name|mode
operator|=
name|M_X21
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
operator|*
name|argv
operator|>=
literal|'0'
operator|&&
operator|*
operator|*
name|argv
operator|<=
literal|'9'
condition|)
name|o
operator|.
name|txbaud
operator|=
name|o
operator|.
name|rxbaud
operator|=
name|atoi
argument_list|(
operator|*
name|argv
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"cisco"
argument_list|)
condition|)
block|{
name|o
operator|.
name|sopt
operator|.
name|cisco
operator|=
literal|1
expr_stmt|;
name|o
operator|.
name|sopt
operator|.
name|ext
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"ppp"
argument_list|)
condition|)
block|{
name|o
operator|.
name|sopt
operator|.
name|cisco
operator|=
literal|0
expr_stmt|;
name|o
operator|.
name|sopt
operator|.
name|ext
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"ext"
argument_list|)
condition|)
name|o
operator|.
name|sopt
operator|.
name|ext
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"+keepalive"
argument_list|)
condition|)
name|o
operator|.
name|sopt
operator|.
name|keepalive
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-keepalive"
argument_list|)
condition|)
name|o
operator|.
name|sopt
operator|.
name|keepalive
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"+autorts"
argument_list|)
condition|)
name|o
operator|.
name|sopt
operator|.
name|norts
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-autorts"
argument_list|)
condition|)
name|o
operator|.
name|sopt
operator|.
name|norts
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"port=rs232"
argument_list|)
operator|||
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"port=rs449"
argument_list|)
operator|||
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"port=v35"
argument_list|)
condition|)
name|set_interface_type
argument_list|(
operator|*
name|argv
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"master="
argument_list|,
literal|7
argument_list|)
condition|)
name|set_master
argument_list|(
operator|*
name|argv
operator|+
literal|7
argument_list|)
expr_stmt|;
comment|/* 		 * Common channel options 		 */
comment|/* channel option register 4 */
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-ctsdown"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor4
operator|.
name|cts_zd
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"+ctsdown"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor4
operator|.
name|cts_zd
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-cddown"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor4
operator|.
name|cd_zd
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"+cddown"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor4
operator|.
name|cd_zd
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-dsrdown"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor4
operator|.
name|dsr_zd
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"+dsrdown"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor4
operator|.
name|dsr_zd
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"fifo="
argument_list|,
literal|5
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor4
operator|.
name|thr
operator|=
name|atoi
argument_list|(
operator|*
name|argv
operator|+
literal|5
argument_list|)
expr_stmt|;
comment|/* channel option register 5 */
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-ctsup"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor5
operator|.
name|cts_od
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"+ctsup"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor5
operator|.
name|cts_od
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-cdup"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor5
operator|.
name|cd_od
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"+cdup"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor5
operator|.
name|cd_od
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-dsrup"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor5
operator|.
name|dsr_od
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"+dsrup"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor5
operator|.
name|dsr_od
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strncasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"rfifo="
argument_list|,
literal|6
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|cor5
operator|.
name|rx_thr
operator|=
name|atoi
argument_list|(
operator|*
name|argv
operator|+
literal|6
argument_list|)
expr_stmt|;
comment|/* receive clock option register */
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"nrz"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|rcor
operator|.
name|encod
operator|=
name|ENCOD_NRZ
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"nrzi"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|rcor
operator|.
name|encod
operator|=
name|ENCOD_NRZI
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"manchester"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|rcor
operator|.
name|encod
operator|=
name|ENCOD_MANCHESTER
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-dpll"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|rcor
operator|.
name|dpll
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"+dpll"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|rcor
operator|.
name|dpll
operator|=
literal|1
expr_stmt|;
comment|/* transmit clock option register */
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-lloop"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|tcor
operator|.
name|llm
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"+lloop"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|tcor
operator|.
name|llm
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-extclock"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|tcor
operator|.
name|ext1x
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcasecmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"+extclock"
argument_list|)
condition|)
name|o
operator|.
name|opt
operator|.
name|tcor
operator|.
name|ext1x
operator|=
literal|1
expr_stmt|;
comment|/* 		 * Mode dependent channel options 		 */
else|else
switch|switch
condition|(
name|o
operator|.
name|mode
condition|)
block|{
case|case
name|M_ASYNC
case|:
name|set_async_opt
argument_list|(
operator|*
name|argv
argument_list|)
expr_stmt|;
break|break;
case|case
name|M_HDLC
case|:
name|set_hdlc_opt
argument_list|(
operator|*
name|argv
argument_list|)
expr_stmt|;
break|break;
case|case
name|M_BISYNC
case|:
name|set_bisync_opt
argument_list|(
operator|*
name|argv
argument_list|)
expr_stmt|;
break|break;
case|case
name|M_X21
case|:
name|set_x21_opt
argument_list|(
operator|*
name|argv
argument_list|)
expr_stmt|;
break|break;
block|}
name|setchan
argument_list|(
name|channel
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

end_unit

