begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1992, Brian Berliner and Jeff Polk  * Copyright (c) 1989-1992, Brian Berliner  *   * You may distribute under the terms of the GNU General Public License as  * specified in the README file that comes with the CVS 1.4 kit.  *   * The functions in this file provide an interface for performing   * operations directly on RCS files.   */
end_comment

begin_include
include|#
directive|include
file|"cvs.h"
end_include

begin_function
name|int
name|RCS_settag
parameter_list|(
name|path
parameter_list|,
name|tag
parameter_list|,
name|rev
parameter_list|)
specifier|const
name|char
modifier|*
name|path
decl_stmt|;
specifier|const
name|char
modifier|*
name|tag
decl_stmt|;
specifier|const
name|char
modifier|*
name|rev
decl_stmt|;
block|{
name|run_setup
argument_list|(
literal|"%s%s -q -N%s:%s"
argument_list|,
name|Rcsbin
argument_list|,
name|RCS
argument_list|,
name|tag
argument_list|,
name|rev
argument_list|)
expr_stmt|;
name|run_arg
argument_list|(
name|path
argument_list|)
expr_stmt|;
return|return
name|run_exec
argument_list|(
name|RUN_TTY
argument_list|,
name|RUN_TTY
argument_list|,
name|RUN_TTY
argument_list|,
name|RUN_NORMAL
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* NOERR is 1 to suppress errors--FIXME it would    be better to avoid the errors or some cleaner solution.  */
end_comment

begin_function
name|int
name|RCS_deltag
parameter_list|(
name|path
parameter_list|,
name|tag
parameter_list|,
name|noerr
parameter_list|)
specifier|const
name|char
modifier|*
name|path
decl_stmt|;
specifier|const
name|char
modifier|*
name|tag
decl_stmt|;
name|int
name|noerr
decl_stmt|;
block|{
name|run_setup
argument_list|(
literal|"%s%s -q -N%s"
argument_list|,
name|Rcsbin
argument_list|,
name|RCS
argument_list|,
name|tag
argument_list|)
expr_stmt|;
name|run_arg
argument_list|(
name|path
argument_list|)
expr_stmt|;
return|return
name|run_exec
argument_list|(
name|RUN_TTY
argument_list|,
name|RUN_TTY
argument_list|,
name|noerr
condition|?
name|DEVNULL
else|:
name|RUN_TTY
argument_list|,
name|RUN_NORMAL
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* set RCS branch to REV */
end_comment

begin_function
name|int
name|RCS_setbranch
parameter_list|(
name|path
parameter_list|,
name|rev
parameter_list|)
specifier|const
name|char
modifier|*
name|path
decl_stmt|;
specifier|const
name|char
modifier|*
name|rev
decl_stmt|;
block|{
name|run_setup
argument_list|(
literal|"%s%s -q -b%s"
argument_list|,
name|Rcsbin
argument_list|,
name|RCS
argument_list|,
name|rev
condition|?
name|rev
else|:
literal|""
argument_list|)
expr_stmt|;
name|run_arg
argument_list|(
name|path
argument_list|)
expr_stmt|;
return|return
name|run_exec
argument_list|(
name|RUN_TTY
argument_list|,
name|RUN_TTY
argument_list|,
name|RUN_TTY
argument_list|,
name|RUN_NORMAL
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Lock revision REV.  NOERR is 1 to suppress errors--FIXME it would    be better to avoid the errors or some cleaner solution.  */
end_comment

begin_function
name|int
name|RCS_lock
parameter_list|(
name|path
parameter_list|,
name|rev
parameter_list|,
name|noerr
parameter_list|)
specifier|const
name|char
modifier|*
name|path
decl_stmt|;
specifier|const
name|char
modifier|*
name|rev
decl_stmt|;
name|int
name|noerr
decl_stmt|;
block|{
name|run_setup
argument_list|(
literal|"%s%s -q -l%s"
argument_list|,
name|Rcsbin
argument_list|,
name|RCS
argument_list|,
name|rev
condition|?
name|rev
else|:
literal|""
argument_list|)
expr_stmt|;
name|run_arg
argument_list|(
name|path
argument_list|)
expr_stmt|;
return|return
name|run_exec
argument_list|(
name|RUN_TTY
argument_list|,
name|RUN_TTY
argument_list|,
name|noerr
condition|?
name|DEVNULL
else|:
name|RUN_TTY
argument_list|,
name|RUN_NORMAL
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Unlock revision REV.  NOERR is 1 to suppress errors--FIXME it would    be better to avoid the errors or some cleaner solution.  */
end_comment

begin_function
name|int
name|RCS_unlock
parameter_list|(
name|path
parameter_list|,
name|rev
parameter_list|,
name|noerr
parameter_list|)
specifier|const
name|char
modifier|*
name|path
decl_stmt|;
specifier|const
name|char
modifier|*
name|rev
decl_stmt|;
name|int
name|noerr
decl_stmt|;
block|{
name|run_setup
argument_list|(
literal|"%s%s -q -u%s"
argument_list|,
name|Rcsbin
argument_list|,
name|RCS
argument_list|,
name|rev
condition|?
name|rev
else|:
literal|""
argument_list|)
expr_stmt|;
name|run_arg
argument_list|(
name|path
argument_list|)
expr_stmt|;
return|return
name|run_exec
argument_list|(
name|RUN_TTY
argument_list|,
name|RUN_TTY
argument_list|,
name|noerr
condition|?
name|DEVNULL
else|:
name|RUN_TTY
argument_list|,
name|RUN_NORMAL
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Merge revisions REV1 and REV2. */
end_comment

begin_function
name|int
name|RCS_merge
parameter_list|(
name|path
parameter_list|,
name|options
parameter_list|,
name|rev1
parameter_list|,
name|rev2
parameter_list|)
specifier|const
name|char
modifier|*
name|path
decl_stmt|;
specifier|const
name|char
modifier|*
name|options
decl_stmt|;
specifier|const
name|char
modifier|*
name|rev1
decl_stmt|;
specifier|const
name|char
modifier|*
name|rev2
decl_stmt|;
block|{
name|int
name|status
decl_stmt|;
comment|/* XXX - Do merge by hand instead of using rcsmerge, due to -k handling */
name|run_setup
argument_list|(
literal|"%s%s %s -r%s -r%s %s"
argument_list|,
name|Rcsbin
argument_list|,
name|RCS_RCSMERGE
argument_list|,
name|options
argument_list|,
name|rev1
argument_list|,
name|rev2
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|status
operator|=
name|run_exec
argument_list|(
name|RUN_TTY
argument_list|,
name|RUN_TTY
argument_list|,
name|RUN_TTY
argument_list|,
name|RUN_NORMAL
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|HAVE_RCS5
if|if
condition|(
name|status
operator|==
literal|0
condition|)
block|{
comment|/* Run GREP to see if there appear to be conflicts in the file */
name|run_setup
argument_list|(
literal|"%s"
argument_list|,
name|GREP
argument_list|)
expr_stmt|;
name|run_arg
argument_list|(
name|RCS_MERGE_PAT
argument_list|)
expr_stmt|;
name|run_arg
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|status
operator|=
operator|(
name|run_exec
argument_list|(
name|RUN_TTY
argument_list|,
name|DEVNULL
argument_list|,
name|RUN_TTY
argument_list|,
name|RUN_NORMAL
argument_list|)
operator|==
literal|0
operator|)
expr_stmt|;
block|}
endif|#
directive|endif
return|return
name|status
return|;
block|}
end_function

end_unit

