begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Simple SPARC relocations for the benefit of self-relocation of ld.so  * avoiding the use of global variables (ie. reloc_bitshift[] et. al.).  * Only types supported are RELOC_32 and RELOC_RELATIVE.  *  * This *must* be a static function, so it is not called through a jmpslot.  */
end_comment

begin_function
specifier|static
name|void
name|md_relocate_simple
parameter_list|(
name|r
parameter_list|,
name|relocation
parameter_list|,
name|addr
parameter_list|)
name|struct
name|relocation_info
modifier|*
name|r
decl_stmt|;
name|long
name|relocation
decl_stmt|;
name|char
modifier|*
name|addr
decl_stmt|;
block|{
specifier|register
name|unsigned
name|long
name|mask
decl_stmt|;
specifier|register
name|unsigned
name|long
name|shift
decl_stmt|;
switch|switch
condition|(
name|r
operator|->
name|r_type
condition|)
block|{
case|case
name|RELOC_32
case|:
name|mask
operator|=
literal|0xffffffff
expr_stmt|;
name|shift
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|RELOC_RELATIVE
case|:
name|mask
operator|=
literal|0x003fffff
expr_stmt|;
name|shift
operator|=
literal|10
expr_stmt|;
break|break;
block|}
name|relocation
operator|+=
operator|(
operator|*
operator|(
name|long
operator|*
operator|)
name|addr
operator|&
name|mask
operator|)
operator|<<
name|shift
expr_stmt|;
name|relocation
operator|>>=
name|shift
expr_stmt|;
name|relocation
operator|&=
name|mask
expr_stmt|;
operator|*
operator|(
name|long
operator|*
operator|)
operator|(
name|addr
operator|)
operator|&=
operator|~
name|mask
expr_stmt|;
operator|*
operator|(
name|long
operator|*
operator|)
operator|(
name|addr
operator|)
operator||=
name|relocation
expr_stmt|;
block|}
end_function

end_unit

