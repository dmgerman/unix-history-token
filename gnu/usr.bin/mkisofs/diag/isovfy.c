begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * File isovfy.c - verify consistency of iso9660 filesystem.  *     Written by Eric Youngdale (1993).     Copyright 1993 Yggdrasil Computing, Incorporated     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2, or (at your option)    any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_decl_stmt
name|FILE
modifier|*
name|infile
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|PAGE
value|sizeof(buffer)
end_define

begin_define
define|#
directive|define
name|ISODCL
parameter_list|(
name|from
parameter_list|,
name|to
parameter_list|)
value|(to - from + 1)
end_define

begin_struct
struct|struct
name|iso_primary_descriptor
block|{
name|unsigned
name|char
name|type
index|[
name|ISODCL
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
index|]
decl_stmt|;
comment|/* 711 */
name|unsigned
name|char
name|id
index|[
name|ISODCL
argument_list|(
literal|2
argument_list|,
literal|6
argument_list|)
index|]
decl_stmt|;
name|unsigned
name|char
name|version
index|[
name|ISODCL
argument_list|(
literal|7
argument_list|,
literal|7
argument_list|)
index|]
decl_stmt|;
comment|/* 711 */
name|unsigned
name|char
name|unused1
index|[
name|ISODCL
argument_list|(
literal|8
argument_list|,
literal|8
argument_list|)
index|]
decl_stmt|;
name|unsigned
name|char
name|system_id
index|[
name|ISODCL
argument_list|(
literal|9
argument_list|,
literal|40
argument_list|)
index|]
decl_stmt|;
comment|/* aunsigned chars */
name|unsigned
name|char
name|volume_id
index|[
name|ISODCL
argument_list|(
literal|41
argument_list|,
literal|72
argument_list|)
index|]
decl_stmt|;
comment|/* dunsigned chars */
name|unsigned
name|char
name|unused2
index|[
name|ISODCL
argument_list|(
literal|73
argument_list|,
literal|80
argument_list|)
index|]
decl_stmt|;
name|unsigned
name|char
name|volume_space_size
index|[
name|ISODCL
argument_list|(
literal|81
argument_list|,
literal|88
argument_list|)
index|]
decl_stmt|;
comment|/* 733 */
name|unsigned
name|char
name|unused3
index|[
name|ISODCL
argument_list|(
literal|89
argument_list|,
literal|120
argument_list|)
index|]
decl_stmt|;
name|unsigned
name|char
name|volume_set_size
index|[
name|ISODCL
argument_list|(
literal|121
argument_list|,
literal|124
argument_list|)
index|]
decl_stmt|;
comment|/* 723 */
name|unsigned
name|char
name|volume_sequence_number
index|[
name|ISODCL
argument_list|(
literal|125
argument_list|,
literal|128
argument_list|)
index|]
decl_stmt|;
comment|/* 723 */
name|unsigned
name|char
name|logical_block_size
index|[
name|ISODCL
argument_list|(
literal|129
argument_list|,
literal|132
argument_list|)
index|]
decl_stmt|;
comment|/* 723 */
name|unsigned
name|char
name|path_table_size
index|[
name|ISODCL
argument_list|(
literal|133
argument_list|,
literal|140
argument_list|)
index|]
decl_stmt|;
comment|/* 733 */
name|unsigned
name|char
name|type_l_path_table
index|[
name|ISODCL
argument_list|(
literal|141
argument_list|,
literal|144
argument_list|)
index|]
decl_stmt|;
comment|/* 731 */
name|unsigned
name|char
name|opt_type_l_path_table
index|[
name|ISODCL
argument_list|(
literal|145
argument_list|,
literal|148
argument_list|)
index|]
decl_stmt|;
comment|/* 731 */
name|unsigned
name|char
name|type_m_path_table
index|[
name|ISODCL
argument_list|(
literal|149
argument_list|,
literal|152
argument_list|)
index|]
decl_stmt|;
comment|/* 732 */
name|unsigned
name|char
name|opt_type_m_path_table
index|[
name|ISODCL
argument_list|(
literal|153
argument_list|,
literal|156
argument_list|)
index|]
decl_stmt|;
comment|/* 732 */
name|unsigned
name|char
name|root_directory_record
index|[
name|ISODCL
argument_list|(
literal|157
argument_list|,
literal|190
argument_list|)
index|]
decl_stmt|;
comment|/* 9.1 */
name|unsigned
name|char
name|volume_set_id
index|[
name|ISODCL
argument_list|(
literal|191
argument_list|,
literal|318
argument_list|)
index|]
decl_stmt|;
comment|/* dunsigned chars */
name|unsigned
name|char
name|publisher_id
index|[
name|ISODCL
argument_list|(
literal|319
argument_list|,
literal|446
argument_list|)
index|]
decl_stmt|;
comment|/* achars */
name|unsigned
name|char
name|preparer_id
index|[
name|ISODCL
argument_list|(
literal|447
argument_list|,
literal|574
argument_list|)
index|]
decl_stmt|;
comment|/* achars */
name|unsigned
name|char
name|application_id
index|[
name|ISODCL
argument_list|(
literal|575
argument_list|,
literal|702
argument_list|)
index|]
decl_stmt|;
comment|/* achars */
name|unsigned
name|char
name|copyright_file_id
index|[
name|ISODCL
argument_list|(
literal|703
argument_list|,
literal|739
argument_list|)
index|]
decl_stmt|;
comment|/* 7.5 dchars */
name|unsigned
name|char
name|abstract_file_id
index|[
name|ISODCL
argument_list|(
literal|740
argument_list|,
literal|776
argument_list|)
index|]
decl_stmt|;
comment|/* 7.5 dchars */
name|unsigned
name|char
name|bibliographic_file_id
index|[
name|ISODCL
argument_list|(
literal|777
argument_list|,
literal|813
argument_list|)
index|]
decl_stmt|;
comment|/* 7.5 dchars */
name|unsigned
name|char
name|creation_date
index|[
name|ISODCL
argument_list|(
literal|814
argument_list|,
literal|830
argument_list|)
index|]
decl_stmt|;
comment|/* 8.4.26.1 */
name|unsigned
name|char
name|modification_date
index|[
name|ISODCL
argument_list|(
literal|831
argument_list|,
literal|847
argument_list|)
index|]
decl_stmt|;
comment|/* 8.4.26.1 */
name|unsigned
name|char
name|expiration_date
index|[
name|ISODCL
argument_list|(
literal|848
argument_list|,
literal|864
argument_list|)
index|]
decl_stmt|;
comment|/* 8.4.26.1 */
name|unsigned
name|char
name|effective_date
index|[
name|ISODCL
argument_list|(
literal|865
argument_list|,
literal|881
argument_list|)
index|]
decl_stmt|;
comment|/* 8.4.26.1 */
name|unsigned
name|char
name|file_structure_version
index|[
name|ISODCL
argument_list|(
literal|882
argument_list|,
literal|882
argument_list|)
index|]
decl_stmt|;
comment|/* 711 */
name|unsigned
name|char
name|unused4
index|[
name|ISODCL
argument_list|(
literal|883
argument_list|,
literal|883
argument_list|)
index|]
decl_stmt|;
name|unsigned
name|char
name|application_data
index|[
name|ISODCL
argument_list|(
literal|884
argument_list|,
literal|1395
argument_list|)
index|]
decl_stmt|;
name|unsigned
name|char
name|unused5
index|[
name|ISODCL
argument_list|(
literal|1396
argument_list|,
literal|2048
argument_list|)
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|iso_directory_record
block|{
name|unsigned
name|char
name|length
index|[
name|ISODCL
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
index|]
decl_stmt|;
comment|/* 711 */
name|unsigned
name|char
name|ext_attr_length
index|[
name|ISODCL
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
index|]
decl_stmt|;
comment|/* 711 */
name|unsigned
name|char
name|extent
index|[
name|ISODCL
argument_list|(
literal|3
argument_list|,
literal|10
argument_list|)
index|]
decl_stmt|;
comment|/* 733 */
name|unsigned
name|char
name|size
index|[
name|ISODCL
argument_list|(
literal|11
argument_list|,
literal|18
argument_list|)
index|]
decl_stmt|;
comment|/* 733 */
name|unsigned
name|char
name|date
index|[
name|ISODCL
argument_list|(
literal|19
argument_list|,
literal|25
argument_list|)
index|]
decl_stmt|;
comment|/* 7 by 711 */
name|unsigned
name|char
name|flags
index|[
name|ISODCL
argument_list|(
literal|26
argument_list|,
literal|26
argument_list|)
index|]
decl_stmt|;
name|unsigned
name|char
name|file_unit_size
index|[
name|ISODCL
argument_list|(
literal|27
argument_list|,
literal|27
argument_list|)
index|]
decl_stmt|;
comment|/* 711 */
name|unsigned
name|char
name|interleave
index|[
name|ISODCL
argument_list|(
literal|28
argument_list|,
literal|28
argument_list|)
index|]
decl_stmt|;
comment|/* 711 */
name|unsigned
name|char
name|volume_sequence_number
index|[
name|ISODCL
argument_list|(
literal|29
argument_list|,
literal|32
argument_list|)
index|]
decl_stmt|;
comment|/* 723 */
name|unsigned
name|char
name|name_len
index|[
name|ISODCL
argument_list|(
literal|33
argument_list|,
literal|33
argument_list|)
index|]
decl_stmt|;
comment|/* 711 */
name|unsigned
name|char
name|name
index|[
literal|38
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|isonum_721
parameter_list|(
name|char
modifier|*
name|p
parameter_list|)
block|{
return|return
operator|(
operator|(
name|p
index|[
literal|0
index|]
operator|&
literal|0xff
operator|)
operator||
operator|(
operator|(
name|p
index|[
literal|1
index|]
operator|&
literal|0xff
operator|)
operator|<<
literal|8
operator|)
operator|)
return|;
block|}
end_function

begin_function
name|int
name|isonum_731
parameter_list|(
name|char
modifier|*
name|p
parameter_list|)
block|{
return|return
operator|(
operator|(
name|p
index|[
literal|0
index|]
operator|&
literal|0xff
operator|)
operator||
operator|(
operator|(
name|p
index|[
literal|1
index|]
operator|&
literal|0xff
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
name|p
index|[
literal|2
index|]
operator|&
literal|0xff
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|p
index|[
literal|3
index|]
operator|&
literal|0xff
operator|)
operator|<<
literal|24
operator|)
operator|)
return|;
block|}
end_function

begin_function
name|int
name|isonum_722
parameter_list|(
name|char
modifier|*
name|p
parameter_list|)
block|{
return|return
operator|(
operator|(
name|p
index|[
literal|1
index|]
operator|&
literal|0xff
operator|)
operator||
operator|(
operator|(
name|p
index|[
literal|0
index|]
operator|&
literal|0xff
operator|)
operator|<<
literal|8
operator|)
operator|)
return|;
block|}
end_function

begin_function
name|int
name|isonum_732
parameter_list|(
name|char
modifier|*
name|p
parameter_list|)
block|{
return|return
operator|(
operator|(
name|p
index|[
literal|3
index|]
operator|&
literal|0xff
operator|)
operator||
operator|(
operator|(
name|p
index|[
literal|2
index|]
operator|&
literal|0xff
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
name|p
index|[
literal|1
index|]
operator|&
literal|0xff
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|p
index|[
literal|0
index|]
operator|&
literal|0xff
operator|)
operator|<<
literal|24
operator|)
operator|)
return|;
block|}
end_function

begin_function
name|int
name|isonum_733
parameter_list|(
name|char
modifier|*
name|p
parameter_list|)
block|{
return|return
operator|(
name|isonum_731
argument_list|(
name|p
argument_list|)
operator|)
return|;
block|}
end_function

begin_decl_stmt
name|char
name|lbuffer
index|[
literal|1024
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|iline
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|rr_goof
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|dump_rr
parameter_list|(
name|struct
name|iso_directory_record
modifier|*
name|idr
parameter_list|)
block|{
name|int
name|len
decl_stmt|;
name|char
modifier|*
name|pnt
decl_stmt|;
name|len
operator|=
name|idr
operator|->
name|length
index|[
literal|0
index|]
operator|&
literal|0xff
expr_stmt|;
name|len
operator|-=
operator|(
sizeof|sizeof
argument_list|(
expr|struct
name|iso_directory_record
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
name|idr
operator|->
name|name
argument_list|)
operator|)
expr_stmt|;
name|len
operator|-=
name|idr
operator|->
name|name_len
index|[
literal|0
index|]
expr_stmt|;
name|pnt
operator|=
operator|(
name|char
operator|*
operator|)
name|idr
expr_stmt|;
name|pnt
operator|+=
operator|(
sizeof|sizeof
argument_list|(
expr|struct
name|iso_directory_record
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
name|idr
operator|->
name|name
argument_list|)
operator|)
expr_stmt|;
name|pnt
operator|+=
name|idr
operator|->
name|name_len
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
operator|(
name|idr
operator|->
name|name_len
index|[
literal|0
index|]
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
block|{
name|pnt
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
empty_stmt|;
name|rr_goof
operator|=
literal|0
expr_stmt|;
name|parse_rr
argument_list|(
name|pnt
argument_list|,
name|len
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|rr_goof
return|;
block|}
end_function

begin_function
name|int
name|parse_rr
parameter_list|(
name|unsigned
name|char
modifier|*
name|pnt
parameter_list|,
name|int
name|len
parameter_list|,
name|int
name|cont_flag
parameter_list|)
block|{
name|int
name|slen
decl_stmt|;
name|int
name|ncount
decl_stmt|;
name|int
name|flag1
decl_stmt|,
name|flag2
decl_stmt|;
name|int
name|extent
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pnts
decl_stmt|;
name|int
name|cont_extent
decl_stmt|,
name|cont_offset
decl_stmt|,
name|cont_size
decl_stmt|;
name|char
name|symlink
index|[
literal|1024
index|]
decl_stmt|;
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|" RRlen=%d "
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|cont_extent
operator|=
name|cont_offset
operator|=
name|cont_size
operator|=
literal|0
expr_stmt|;
name|symlink
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|ncount
operator|=
literal|0
expr_stmt|;
name|flag1
operator|=
name|flag2
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|len
operator|>=
literal|4
condition|)
block|{
if|if
condition|(
name|ncount
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|","
argument_list|)
expr_stmt|;
else|else
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"["
argument_list|)
expr_stmt|;
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"%c%c"
argument_list|,
name|pnt
index|[
literal|0
index|]
argument_list|,
name|pnt
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|pnt
index|[
literal|0
index|]
operator|<
literal|'A'
operator|||
name|pnt
index|[
literal|0
index|]
operator|>
literal|'Z'
operator|||
name|pnt
index|[
literal|1
index|]
operator|<
literal|'A'
operator|||
name|pnt
index|[
literal|1
index|]
operator|>
literal|'Z'
condition|)
block|{
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"**BAD SUSP %d %d]"
argument_list|,
name|pnt
index|[
literal|0
index|]
argument_list|,
name|pnt
index|[
literal|1
index|]
argument_list|,
name|rr_goof
operator|++
argument_list|)
expr_stmt|;
return|return
name|flag2
return|;
block|}
empty_stmt|;
if|if
condition|(
name|pnt
index|[
literal|3
index|]
operator|!=
literal|1
condition|)
block|{
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"**BAD RRVERSION"
argument_list|,
name|rr_goof
operator|++
argument_list|)
expr_stmt|;
return|return
name|flag2
return|;
block|}
empty_stmt|;
name|ncount
operator|++
expr_stmt|;
if|if
condition|(
name|pnt
index|[
literal|0
index|]
operator|==
literal|'R'
operator|&&
name|pnt
index|[
literal|1
index|]
operator|==
literal|'R'
condition|)
name|flag1
operator|=
name|pnt
index|[
literal|4
index|]
operator|&
literal|0xff
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"PX"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|flag2
operator||=
literal|1
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"PN"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|flag2
operator||=
literal|2
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"SL"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|flag2
operator||=
literal|4
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"NM"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|flag2
operator||=
literal|8
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"CL"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|flag2
operator||=
literal|16
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"PL"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|flag2
operator||=
literal|32
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"RE"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|flag2
operator||=
literal|64
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"TF"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|flag2
operator||=
literal|128
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"CE"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|cont_extent
operator|=
name|isonum_733
argument_list|(
name|pnt
operator|+
literal|4
argument_list|)
expr_stmt|;
name|cont_offset
operator|=
name|isonum_733
argument_list|(
name|pnt
operator|+
literal|12
argument_list|)
expr_stmt|;
name|cont_size
operator|=
name|isonum_733
argument_list|(
name|pnt
operator|+
literal|20
argument_list|)
expr_stmt|;
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"=[%x,%x,%d]"
argument_list|,
name|cont_extent
argument_list|,
name|cont_offset
argument_list|,
name|cont_size
argument_list|)
expr_stmt|;
block|}
empty_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"PL"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
operator|||
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"CL"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|extent
operator|=
name|isonum_733
argument_list|(
name|pnt
operator|+
literal|4
argument_list|)
expr_stmt|;
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"=%x"
argument_list|,
name|extent
argument_list|)
expr_stmt|;
if|if
condition|(
name|extent
operator|==
literal|0
condition|)
name|rr_goof
operator|++
expr_stmt|;
block|}
empty_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|pnt
argument_list|,
literal|"SL"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|pnts
operator|=
name|pnt
operator|+
literal|5
expr_stmt|;
name|slen
operator|=
name|pnt
index|[
literal|2
index|]
operator|-
literal|5
expr_stmt|;
while|while
condition|(
name|slen
operator|>=
literal|1
condition|)
block|{
switch|switch
condition|(
name|pnts
index|[
literal|0
index|]
operator|&
literal|0xfe
condition|)
block|{
case|case
literal|0
case|:
name|strncat
argument_list|(
name|symlink
argument_list|,
name|pnts
operator|+
literal|2
argument_list|,
name|pnts
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|strcat
argument_list|(
name|symlink
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|strcat
argument_list|(
name|symlink
argument_list|,
literal|".."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|strcat
argument_list|(
name|symlink
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|16
case|:
name|strcat
argument_list|(
name|symlink
argument_list|,
literal|"/mnt"
argument_list|)
expr_stmt|;
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"Warning - mount point requested"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|32
case|:
name|strcat
argument_list|(
name|symlink
argument_list|,
literal|"kafka"
argument_list|)
expr_stmt|;
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"Warning - host_name requested"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"Reserved bit setting in symlink"
argument_list|,
name|rr_goof
operator|++
argument_list|)
expr_stmt|;
break|break;
block|}
empty_stmt|;
if|if
condition|(
operator|(
name|pnts
index|[
literal|0
index|]
operator|&
literal|0xfe
operator|)
operator|&&
name|pnts
index|[
literal|1
index|]
operator|!=
literal|0
condition|)
block|{
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"Incorrect length in symlink component"
argument_list|)
expr_stmt|;
block|}
empty_stmt|;
if|if
condition|(
operator|(
name|pnts
index|[
literal|0
index|]
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
name|strcat
argument_list|(
name|symlink
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
name|slen
operator|-=
operator|(
name|pnts
index|[
literal|1
index|]
operator|+
literal|2
operator|)
expr_stmt|;
name|pnts
operator|+=
operator|(
name|pnts
index|[
literal|1
index|]
operator|+
literal|2
operator|)
expr_stmt|;
block|}
empty_stmt|;
if|if
condition|(
name|symlink
index|[
literal|0
index|]
operator|!=
literal|0
condition|)
block|{
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"=%s"
argument_list|,
name|symlink
argument_list|)
expr_stmt|;
name|symlink
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
empty_stmt|;
name|len
operator|-=
name|pnt
index|[
literal|2
index|]
expr_stmt|;
name|pnt
operator|+=
name|pnt
index|[
literal|2
index|]
expr_stmt|;
if|if
condition|(
name|len
operator|<=
literal|3
operator|&&
name|cont_extent
condition|)
block|{
name|unsigned
name|char
name|sector
index|[
literal|2048
index|]
decl_stmt|;
name|lseek
argument_list|(
name|fileno
argument_list|(
name|infile
argument_list|)
argument_list|,
name|cont_extent
operator|<<
literal|11
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|fileno
argument_list|(
name|infile
argument_list|)
argument_list|,
name|sector
argument_list|,
sizeof|sizeof
argument_list|(
name|sector
argument_list|)
argument_list|)
expr_stmt|;
name|flag2
operator||=
name|parse_rr
argument_list|(
operator|&
name|sector
index|[
name|cont_offset
index|]
argument_list|,
name|cont_size
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
empty_stmt|;
block|}
empty_stmt|;
if|if
condition|(
name|ncount
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"]"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|cont_flag
operator|&&
name|flag1
operator|&&
name|flag1
operator|!=
name|flag2
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
name|lbuffer
operator|+
name|iline
argument_list|,
literal|"Flag %x != %x"
argument_list|,
name|flag1
argument_list|,
name|flag2
argument_list|,
name|rr_goof
operator|++
argument_list|)
expr_stmt|;
return|return
name|flag2
return|;
block|}
end_function

begin_decl_stmt
name|int
name|dir_count
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|dir_size_count
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ngoof
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_macro
name|check_tree
argument_list|(
argument|int file_addr
argument_list|,
argument|int file_size
argument_list|,
argument|int parent_addr
argument_list|)
end_macro

begin_block
block|{
name|unsigned
name|char
name|buffer
index|[
literal|2048
index|]
decl_stmt|;
name|unsigned
name|int
name|k
decl_stmt|;
name|int
name|rflag
decl_stmt|;
name|int
name|i
decl_stmt|,
name|i1
decl_stmt|,
name|j
decl_stmt|,
name|goof
decl_stmt|;
name|int
name|extent
decl_stmt|,
name|size
decl_stmt|;
name|int
name|line
decl_stmt|;
name|int
name|orig_file_addr
decl_stmt|,
name|parent_file_addr
decl_stmt|;
name|struct
name|iso_directory_record
modifier|*
name|idr
decl_stmt|;
name|i1
operator|=
literal|0
expr_stmt|;
name|orig_file_addr
operator|=
name|file_addr
operator|>>
literal|11
expr_stmt|;
comment|/* Actual extent of this directory */
name|parent_file_addr
operator|=
name|parent_addr
operator|>>
literal|11
expr_stmt|;
if|if
condition|(
operator|(
name|dir_count
operator|%
literal|100
operator|)
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"[%d %d]\n"
argument_list|,
name|dir_count
argument_list|,
name|dir_size_count
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|printf("Starting directory %d %d %d\n", file_addr, file_size, parent_addr);
endif|#
directive|endif
name|dir_count
operator|++
expr_stmt|;
name|dir_size_count
operator|+=
name|file_size
operator|>>
literal|11
expr_stmt|;
if|if
condition|(
name|file_size
operator|&
literal|0x3ff
condition|)
name|printf
argument_list|(
literal|"********Directory has unusual size\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
operator|(
name|file_size
operator|>>
literal|11
operator|)
condition|;
name|k
operator|++
control|)
block|{
name|lseek
argument_list|(
name|fileno
argument_list|(
name|infile
argument_list|)
argument_list|,
name|file_addr
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|fileno
argument_list|(
name|infile
argument_list|)
argument_list|,
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
literal|1
operator|==
literal|1
condition|)
block|{
name|goof
operator|=
name|iline
operator|=
literal|0
expr_stmt|;
name|idr
operator|=
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
operator|&
name|buffer
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|idr
operator|->
name|length
index|[
literal|0
index|]
operator|==
literal|0
condition|)
break|break;
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"%3d "
argument_list|,
name|idr
operator|->
name|length
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|extent
operator|=
name|isonum_733
argument_list|(
name|idr
operator|->
name|extent
argument_list|)
expr_stmt|;
name|size
operator|=
name|isonum_733
argument_list|(
name|idr
operator|->
name|size
argument_list|)
expr_stmt|;
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"%5x "
argument_list|,
name|extent
argument_list|)
expr_stmt|;
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"%8d "
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"%c"
argument_list|,
operator|(
name|idr
operator|->
name|flags
index|[
literal|0
index|]
operator|&
literal|2
operator|)
condition|?
literal|'*'
else|:
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|idr
operator|->
name|name_len
index|[
literal|0
index|]
operator|>
literal|33
operator|||
name|idr
operator|->
name|name_len
index|[
literal|0
index|]
operator|<
literal|0
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"File name length=(%d)"
argument_list|,
name|idr
operator|->
name|name_len
index|[
literal|0
index|]
argument_list|,
name|goof
operator|++
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|idr
operator|->
name|name_len
index|[
literal|0
index|]
operator|==
literal|1
operator|&&
name|idr
operator|->
name|name
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|".             "
argument_list|)
expr_stmt|;
name|rflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|orig_file_addr
operator|!=
operator|*
operator|(
operator|(
name|unsigned
name|int
operator|*
operator|)
name|idr
operator|->
name|extent
operator|)
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"***** Directory has null extent."
argument_list|,
name|goof
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|i1
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"***** . not  first entry."
argument_list|,
name|rr_goof
operator|++
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|idr
operator|->
name|name_len
index|[
literal|0
index|]
operator|==
literal|1
operator|&&
name|idr
operator|->
name|name
index|[
literal|0
index|]
operator|==
literal|1
condition|)
block|{
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"..            "
argument_list|)
expr_stmt|;
name|rflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|parent_file_addr
operator|!=
operator|*
operator|(
operator|(
name|unsigned
name|int
operator|*
operator|)
name|idr
operator|->
name|extent
operator|)
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"***** Directory has null extent."
argument_list|,
name|goof
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|i1
operator|!=
literal|1
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"***** .. not second entry."
argument_list|,
name|rr_goof
operator|++
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|i1
operator|<
literal|2
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|" Improper sorting."
argument_list|,
name|rr_goof
operator|++
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|idr
operator|->
name|name_len
index|[
literal|0
index|]
condition|;
name|j
operator|++
control|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"%c"
argument_list|,
name|idr
operator|->
name|name
index|[
name|j
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|14
operator|-
name|idr
operator|->
name|name_len
index|[
literal|0
index|]
condition|;
name|j
operator|++
control|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|rflag
operator|=
literal|1
expr_stmt|;
block|}
empty_stmt|;
if|if
condition|(
name|size
operator|&&
name|extent
operator|==
literal|0
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"****Extent==0, size != 0"
argument_list|,
name|goof
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|==
literal|0
operator|&&
name|extent
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"****Extent!=0, size == 0"
argument_list|,
name|goof
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|idr
operator|->
name|flags
index|[
literal|0
index|]
operator|&
literal|0xfd
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"Flags=(%x) "
argument_list|,
name|idr
operator|->
name|flags
index|[
literal|0
index|]
argument_list|,
name|goof
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|idr
operator|->
name|flags
index|[
literal|0
index|]
operator|&
literal|0xfd
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"Flags=(%x) "
argument_list|,
name|idr
operator|->
name|flags
index|[
literal|0
index|]
argument_list|,
name|goof
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|idr
operator|->
name|interleave
index|[
literal|0
index|]
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"Interleave=(%d) "
argument_list|,
name|idr
operator|->
name|interleave
index|[
literal|0
index|]
argument_list|,
name|goof
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|idr
operator|->
name|file_unit_size
index|[
literal|0
index|]
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"File unit size=(%d) "
argument_list|,
name|idr
operator|->
name|file_unit_size
index|[
literal|0
index|]
argument_list|,
name|goof
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|idr
operator|->
name|volume_sequence_number
index|[
literal|0
index|]
operator|!=
literal|1
condition|)
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"Volume sequence number=(%d) "
argument_list|,
name|idr
operator|->
name|volume_sequence_number
index|[
literal|0
index|]
argument_list|,
name|goof
operator|++
argument_list|)
expr_stmt|;
name|goof
operator|+=
name|dump_rr
argument_list|(
name|idr
argument_list|)
expr_stmt|;
name|iline
operator|+=
name|sprintf
argument_list|(
operator|&
name|lbuffer
index|[
name|iline
index|]
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|goof
condition|)
block|{
name|ngoof
operator|++
expr_stmt|;
name|lbuffer
index|[
name|iline
operator|++
index|]
operator|=
literal|0
expr_stmt|;
name|printf
argument_list|(
literal|"%x: %s"
argument_list|,
name|orig_file_addr
argument_list|,
name|lbuffer
argument_list|)
expr_stmt|;
block|}
empty_stmt|;
if|if
condition|(
name|rflag
operator|&&
operator|(
name|idr
operator|->
name|flags
index|[
literal|0
index|]
operator|&
literal|2
operator|)
condition|)
name|check_tree
argument_list|(
operator|(
operator|*
operator|(
operator|(
name|unsigned
name|int
operator|*
operator|)
name|idr
operator|->
name|extent
operator|)
operator|)
operator|<<
literal|11
argument_list|,
operator|*
operator|(
operator|(
name|unsigned
name|int
operator|*
operator|)
name|idr
operator|->
name|size
operator|)
argument_list|,
name|orig_file_addr
operator|<<
literal|11
argument_list|)
expr_stmt|;
name|i
operator|+=
name|buffer
index|[
name|i
index|]
expr_stmt|;
name|i1
operator|++
expr_stmt|;
if|if
condition|(
name|i
operator|>
literal|2048
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|iso_directory_record
argument_list|)
condition|)
break|break;
block|}
empty_stmt|;
name|file_addr
operator|+=
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
block|}
empty_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* This function simply dumps the contents of the path tables.  No    consistency checking takes place, although this would proably be a good    idea. */
end_comment

begin_struct
struct|struct
name|path_table_info
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|unsigned
name|int
name|extent
decl_stmt|;
name|unsigned
name|short
name|index
decl_stmt|;
name|unsigned
name|short
name|parent
decl_stmt|;
block|}
struct|;
end_struct

begin_macro
name|check_path_tables
argument_list|(
argument|int typel_extent
argument_list|,
argument|int typem_extent
argument_list|,
argument|int path_table_size
argument_list|)
end_macro

begin_block
block|{
name|int
name|file_addr
decl_stmt|;
name|int
name|count
decl_stmt|;
name|int
name|j
decl_stmt|;
name|char
modifier|*
name|pnt
decl_stmt|;
name|char
modifier|*
name|typel
decl_stmt|,
modifier|*
name|typem
decl_stmt|;
comment|/* Now read in the path tables */
name|typel
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|path_table_size
argument_list|)
expr_stmt|;
name|lseek
argument_list|(
name|fileno
argument_list|(
name|infile
argument_list|)
argument_list|,
name|typel_extent
operator|<<
literal|11
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|fileno
argument_list|(
name|infile
argument_list|)
argument_list|,
name|typel
argument_list|,
name|path_table_size
argument_list|)
expr_stmt|;
name|typem
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|path_table_size
argument_list|)
expr_stmt|;
name|lseek
argument_list|(
name|fileno
argument_list|(
name|infile
argument_list|)
argument_list|,
name|typem_extent
operator|<<
literal|11
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|fileno
argument_list|(
name|infile
argument_list|)
argument_list|,
name|typem
argument_list|,
name|path_table_size
argument_list|)
expr_stmt|;
name|j
operator|=
name|path_table_size
expr_stmt|;
name|pnt
operator|=
name|typel
expr_stmt|;
name|count
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|j
condition|)
block|{
name|int
name|namelen
decl_stmt|,
name|extent
decl_stmt|,
name|index
decl_stmt|;
name|char
name|name
index|[
literal|32
index|]
decl_stmt|;
name|namelen
operator|=
operator|*
name|pnt
operator|++
expr_stmt|;
name|pnt
operator|++
expr_stmt|;
name|extent
operator|=
name|isonum_731
argument_list|(
name|pnt
argument_list|)
expr_stmt|;
name|pnt
operator|+=
literal|4
expr_stmt|;
name|index
operator|=
name|isonum_721
argument_list|(
name|pnt
argument_list|)
expr_stmt|;
name|pnt
operator|+=
literal|2
expr_stmt|;
name|j
operator|-=
literal|8
operator|+
name|namelen
expr_stmt|;
name|memset
argument_list|(
name|name
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|name
argument_list|,
name|pnt
argument_list|,
name|namelen
argument_list|)
expr_stmt|;
name|pnt
operator|+=
name|namelen
expr_stmt|;
if|if
condition|(
name|j
operator|&
literal|1
condition|)
block|{
name|j
operator|--
expr_stmt|;
name|pnt
operator|++
expr_stmt|;
block|}
empty_stmt|;
name|printf
argument_list|(
literal|"%4.4d %4.4d %8.8x %s\n"
argument_list|,
name|count
operator|++
argument_list|,
name|index
argument_list|,
name|extent
argument_list|,
name|name
argument_list|)
expr_stmt|;
block|}
empty_stmt|;
name|j
operator|=
name|path_table_size
expr_stmt|;
name|pnt
operator|=
name|typem
expr_stmt|;
name|count
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|j
condition|)
block|{
name|int
name|namelen
decl_stmt|,
name|extent
decl_stmt|,
name|index
decl_stmt|;
name|char
name|name
index|[
literal|32
index|]
decl_stmt|;
name|namelen
operator|=
operator|*
name|pnt
operator|++
expr_stmt|;
name|pnt
operator|++
expr_stmt|;
name|extent
operator|=
name|isonum_732
argument_list|(
name|pnt
argument_list|)
expr_stmt|;
name|pnt
operator|+=
literal|4
expr_stmt|;
name|index
operator|=
name|isonum_722
argument_list|(
name|pnt
argument_list|)
expr_stmt|;
name|pnt
operator|+=
literal|2
expr_stmt|;
name|j
operator|-=
literal|8
operator|+
name|namelen
expr_stmt|;
name|memset
argument_list|(
name|name
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|name
argument_list|,
name|pnt
argument_list|,
name|namelen
argument_list|)
expr_stmt|;
name|pnt
operator|+=
name|namelen
expr_stmt|;
if|if
condition|(
name|j
operator|&
literal|1
condition|)
block|{
name|j
operator|--
expr_stmt|;
name|pnt
operator|++
expr_stmt|;
block|}
empty_stmt|;
name|printf
argument_list|(
literal|"%4.4d %4.4d %8.8x %s\n"
argument_list|,
name|count
operator|++
argument_list|,
name|index
argument_list|,
name|extent
argument_list|,
name|name
argument_list|)
expr_stmt|;
block|}
empty_stmt|;
block|}
end_block

begin_function
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|int
name|file_addr
decl_stmt|,
name|file_size
decl_stmt|;
name|char
name|c
decl_stmt|;
name|int
name|nbyte
decl_stmt|;
name|struct
name|iso_primary_descriptor
name|ipd
decl_stmt|;
name|struct
name|iso_directory_record
modifier|*
name|idr
decl_stmt|;
name|int
name|typel_extent
decl_stmt|,
name|typem_extent
decl_stmt|;
name|int
name|path_table_size
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
if|if
condition|(
name|argc
operator|<
literal|2
condition|)
return|return
literal|0
return|;
name|infile
operator|=
name|fopen
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"rb"
argument_list|)
expr_stmt|;
name|file_addr
operator|=
literal|16
operator|<<
literal|11
expr_stmt|;
name|lseek
argument_list|(
name|fileno
argument_list|(
name|infile
argument_list|)
argument_list|,
name|file_addr
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|fileno
argument_list|(
name|infile
argument_list|)
argument_list|,
operator|&
name|ipd
argument_list|,
sizeof|sizeof
argument_list|(
name|ipd
argument_list|)
argument_list|)
expr_stmt|;
name|idr
operator|=
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
operator|&
name|ipd
operator|.
name|root_directory_record
expr_stmt|;
name|file_addr
operator|=
name|isonum_733
argument_list|(
name|idr
operator|->
name|extent
argument_list|)
expr_stmt|;
name|file_size
operator|=
name|isonum_733
argument_list|(
name|idr
operator|->
name|size
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Root at extent %x, %d bytes\n"
argument_list|,
name|file_addr
argument_list|,
name|file_size
argument_list|)
expr_stmt|;
name|file_addr
operator|=
name|file_addr
operator|<<
literal|11
expr_stmt|;
name|check_tree
argument_list|(
name|file_addr
argument_list|,
name|file_size
argument_list|,
name|file_addr
argument_list|)
expr_stmt|;
name|typel_extent
operator|=
name|isonum_731
argument_list|(
name|ipd
operator|.
name|type_l_path_table
argument_list|)
expr_stmt|;
name|typem_extent
operator|=
name|isonum_732
argument_list|(
name|ipd
operator|.
name|type_m_path_table
argument_list|)
expr_stmt|;
name|path_table_size
operator|=
name|isonum_733
argument_list|(
name|ipd
operator|.
name|path_table_size
argument_list|)
expr_stmt|;
comment|/* Enable this to get the dump of the path tables */
if|#
directive|if
literal|0
block|check_path_tables(typel_extent, typem_extent, path_table_size);
endif|#
directive|endif
name|fclose
argument_list|(
name|infile
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ngoof
condition|)
name|printf
argument_list|(
literal|"No errors found\n"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

