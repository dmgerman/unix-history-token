begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*     YPS-0.2, NIS-Server for Linux     Copyright (C) 1994  Tobias Reber      This program is free software; you can redistribute it and/or modify     it under the terms of the GNU General Public License as published by     the Free Software Foundation; either version 2 of the License, or     (at your option) any later version.      This program is distributed in the hope that it will be useful,     but WITHOUT ANY WARRANTY; without even the implied warranty of     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the     GNU General Public License for more details.      You should have received a copy of the GNU General Public License     along with this program; if not, write to the Free Software     Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.      Modified for use with FreeBSD 2.x by Bill Paul (wpaul@ctr.columbia.edu)  	$Id$ */
end_comment

begin_comment
comment|/*  *	$Author: root $  *	$Log: yp_clnt.c,v $  * Revision 0.16  1994/01/02  22:48:22  root  * Added strict prototypes  *  * Revision 0.15  1994/01/02  20:09:39  root  * Added GPL notice  *  * Revision 0.14  1993/12/19  12:42:32  root  * *** empty log message ***  *  * Revision 0.13  1993/06/12  09:39:30  root  * Align with include-4.4  *  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<rpc/rpc.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|"yp.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|DEBUG
end_ifdef

begin_define
define|#
directive|define
name|PRINTF
parameter_list|(
name|x
parameter_list|)
value|printf x
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|PRINTF
parameter_list|(
name|x
parameter_list|)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|struct
name|timeval
name|TIMEOUT
init|=
block|{
literal|25
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
modifier|*
name|ypproc_null_2
parameter_list|(
name|int
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_NULL
argument_list|,
name|xdr_void
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|bool_t
modifier|*
name|ypproc_domain_2
parameter_list|(
name|domainname
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|bool_t
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_DOMAIN
argument_list|,
name|xdr_domainname
argument_list|,
name|argp
argument_list|,
name|xdr_bool
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|bool_t
modifier|*
name|ypproc_domain_nonack_2
parameter_list|(
name|domainname
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|bool_t
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_DOMAIN_NONACK
argument_list|,
name|xdr_domainname
argument_list|,
name|argp
argument_list|,
name|xdr_bool
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|ypresp_val
modifier|*
name|ypproc_match_2
parameter_list|(
name|ypreq_key
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|ypresp_val
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_MATCH
argument_list|,
name|__xdr_ypreq_key
argument_list|,
name|argp
argument_list|,
name|__xdr_ypresp_val
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|ypresp_key_val
modifier|*
name|ypproc_first_2
parameter_list|(
name|ypreq_key
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|ypresp_key_val
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_FIRST
argument_list|,
name|__xdr_ypreq_key
argument_list|,
name|argp
argument_list|,
name|__xdr_ypresp_key_val
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|ypresp_key_val
modifier|*
name|ypproc_next_2
parameter_list|(
name|ypreq_key
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|ypresp_key_val
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_NEXT
argument_list|,
name|__xdr_ypreq_key
argument_list|,
name|argp
argument_list|,
name|__xdr_ypresp_key_val
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|ypresp_xfr
modifier|*
name|ypproc_xfr_2
parameter_list|(
name|ypreq_xfr
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|ypresp_xfr
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_XFR
argument_list|,
name|__xdr_ypreq_xfr
argument_list|,
name|argp
argument_list|,
name|__xdr_ypresp_xfr
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|ypproc_clear_2
parameter_list|(
name|int
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_CLEAR
argument_list|,
name|xdr_void
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|ypresp_all
modifier|*
name|ypproc_all_2
parameter_list|(
name|ypreq_nokey
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|ypresp_all
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_ALL
argument_list|,
name|__xdr_ypreq_nokey
argument_list|,
name|argp
argument_list|,
name|__xdr_ypresp_all
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
name|PRINTF
argument_list|(
operator|(
literal|"ypproc_all_2 retuning NULL\n"
operator|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|PRINTF
argument_list|(
operator|(
literal|"ypproc_all_2 retuning non-NULL\n"
operator|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|ypresp_master
modifier|*
name|ypproc_master_2
parameter_list|(
name|ypreq_nokey
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|ypresp_master
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_MASTER
argument_list|,
name|__xdr_ypreq_nokey
argument_list|,
name|argp
argument_list|,
name|__xdr_ypresp_master
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|ypresp_order
modifier|*
name|ypproc_order_2
parameter_list|(
name|ypreq_nokey
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|ypresp_order
name|res
decl_stmt|;
name|PRINTF
argument_list|(
operator|(
literal|"ypproc_order_2()\n"
operator|)
argument_list|)
expr_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_ORDER
argument_list|,
name|__xdr_ypreq_nokey
argument_list|,
name|argp
argument_list|,
name|__xdr_ypresp_order
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
name|PRINTF
argument_list|(
operator|(
literal|"ypproc_order_2()\n"
operator|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|PRINTF
argument_list|(
operator|(
literal|"ypproc_order_2()\n"
operator|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|ypresp_maplist
modifier|*
name|ypproc_maplist_2
parameter_list|(
name|domainname
modifier|*
name|argp
parameter_list|,
name|CLIENT
modifier|*
name|clnt
parameter_list|)
block|{
specifier|static
name|ypresp_maplist
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|YPPROC_MAPLIST
argument_list|,
name|xdr_domainname
argument_list|,
name|argp
argument_list|,
name|__xdr_ypresp_maplist
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

end_unit

