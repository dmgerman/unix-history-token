begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* uuconv.c    Convert one type of UUCP configuration file to another.     Copyright (C) 1991, 1992, 1993, 1994, 1995 Ian Lance Taylor     This file is part of the Taylor UUCP package.     This program is free software; you can redistribute it and/or    modify it under the terms of the GNU General Public License as    published by the Free Software Foundation; either version 2 of the    License, or (at your option) any later version.     This program is distributed in the hope that it will be useful, but    WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.     The author of the program may be contacted at ian@airs.com or    c/o Cygnus Support, 48 Grove Street, Somerville, MA 02144.    */
end_comment

begin_include
include|#
directive|include
file|"uucnfi.h"
end_include

begin_if
if|#
directive|if
name|USE_RCS_ID
end_if

begin_decl_stmt
specifier|const
name|char
name|uuconv_rcsid
index|[]
init|=
literal|"$FreeBSD$"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"getopt.h"
end_include

begin_escape
end_escape

begin_comment
comment|/* Local functions.  */
end_comment

begin_decl_stmt
specifier|static
name|void
name|uvusage
name|P
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvhelp
name|P
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_time
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
expr|struct
name|uuconf_timespan
operator|*
name|qtime
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_string
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
specifier|const
name|char
operator|*
name|zarg
operator|,
specifier|const
name|char
operator|*
name|zcmd
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_size
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
expr|struct
name|uuconf_timespan
operator|*
name|qsize
operator|,
specifier|const
name|char
operator|*
name|zcmd
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_boolean
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
name|int
name|iarg
operator|,
specifier|const
name|char
operator|*
name|zcmd
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_string_array
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
name|char
operator|*
operator|*
name|pz
operator|,
specifier|const
name|char
operator|*
name|zcmd
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_chat_script
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
name|char
operator|*
operator|*
name|pz
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_chat
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
specifier|const
expr|struct
name|uuconf_chat
operator|*
name|qchat
operator|,
specifier|const
expr|struct
name|uuconf_chat
operator|*
name|qlast
operator|,
specifier|const
name|char
operator|*
name|zprefix
operator|,
name|boolean
name|fforce
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_proto_params
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
specifier|const
expr|struct
name|uuconf_proto_param
operator|*
name|qparam
operator|,
specifier|const
name|char
operator|*
name|zprefix
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_taylor_system
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
specifier|const
expr|struct
name|uuconf_system
operator|*
name|qsys
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_v2_system
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
specifier|const
expr|struct
name|uuconf_system
operator|*
name|qsys
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_hdb_system
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
specifier|const
expr|struct
name|uuconf_system
operator|*
name|qsys
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|boolean
name|fvperm_string_cmp
name|P
argument_list|(
operator|(
specifier|const
name|char
operator|*
name|z1
operator|,
specifier|const
name|char
operator|*
name|z2
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|boolean
name|fvperm_array_cmp
name|P
argument_list|(
operator|(
specifier|const
name|char
operator|*
operator|*
name|pz1
operator|,
specifier|const
name|char
operator|*
operator|*
name|pz2
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvadd_perm
name|P
argument_list|(
operator|(
expr|struct
name|shpermissions
operator|*
name|qadd
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_perms
name|P
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_perm_array
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
specifier|const
name|char
operator|*
operator|*
name|pz
operator|,
specifier|const
name|char
operator|*
name|zcmd
operator|,
name|size_t
operator|*
name|pccol
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_perm_boolean
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
name|int
name|f
operator|,
specifier|const
name|char
operator|*
name|zcmd
operator|,
name|size_t
operator|*
name|pccol
operator|,
name|boolean
name|fsendfiles
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_perm_rw_array
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
specifier|const
name|char
operator|*
operator|*
name|pz
operator|,
specifier|const
name|char
operator|*
name|zcmd
operator|,
name|size_t
operator|*
name|pccol
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_perm_string
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
specifier|const
name|char
operator|*
name|z
operator|,
specifier|const
name|char
operator|*
name|zcmd
operator|,
name|size_t
operator|*
name|pccol
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|ivwrite_taylor_port
name|P
argument_list|(
operator|(
expr|struct
name|uuconf_port
operator|*
name|qport
operator|,
name|pointer
name|pinfo
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|ivwrite_v2_port
name|P
argument_list|(
operator|(
expr|struct
name|uuconf_port
operator|*
name|qport
operator|,
name|pointer
name|pinfo
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|ivwrite_hdb_port
name|P
argument_list|(
operator|(
expr|struct
name|uuconf_port
operator|*
name|qport
operator|,
name|pointer
name|pinfo
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_taylor_port
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
expr|struct
name|uuconf_port
operator|*
name|qport
operator|,
specifier|const
name|char
operator|*
name|zprefix
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_taylor_dialer
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
expr|struct
name|uuconf_dialer
operator|*
name|qdialer
operator|,
specifier|const
name|char
operator|*
name|zprefix
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvwrite_hdb_dialer
name|P
argument_list|(
operator|(
name|FILE
operator|*
name|e
operator|,
expr|struct
name|uuconf_dialer
operator|*
name|qdialer
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|uvuuconf_error
name|P
argument_list|(
operator|(
name|pointer
name|puuconf
operator|,
name|int
name|iret
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_escape
end_escape

begin_comment
comment|/* The program name.  */
end_comment

begin_decl_stmt
specifier|const
name|char
modifier|*
name|zProgram
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* A list of Permissions entries built when writing out HDB system    information.  */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|shpermissions
modifier|*
name|qVperms
decl_stmt|;
end_decl_stmt

begin_escape
end_escape

begin_comment
comment|/* Type of configuration file.  */
end_comment

begin_enum
enum|enum
name|tconfig
block|{
name|CONFIG_TAYLOR
block|,
name|CONFIG_V2
block|,
name|CONFIG_HDB
block|}
enum|;
end_enum

begin_escape
end_escape

begin_comment
comment|/* Long getopt options.  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|option
name|asVlongopts
index|[]
init|=
block|{
block|{
literal|"input"
block|,
name|required_argument
block|,
name|NULL
block|,
literal|'i'
block|}
block|,
block|{
literal|"output"
block|,
name|required_argument
block|,
name|NULL
block|,
literal|'o'
block|}
block|,
block|{
literal|"program"
block|,
name|required_argument
block|,
name|NULL
block|,
literal|'p'
block|}
block|,
block|{
literal|"config"
block|,
name|required_argument
block|,
name|NULL
block|,
literal|'I'
block|}
block|,
block|{
literal|"debug"
block|,
name|required_argument
block|,
name|NULL
block|,
literal|'x'
block|}
block|,
block|{
literal|"version"
block|,
name|no_argument
block|,
name|NULL
block|,
literal|'v'
block|}
block|,
block|{
literal|"help"
block|,
name|no_argument
block|,
name|NULL
block|,
literal|1
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
comment|/* -I: The configuration file name.  */
specifier|const
name|char
modifier|*
name|zconfig
init|=
name|NULL
decl_stmt|;
comment|/* -i: Input type.  */
specifier|const
name|char
modifier|*
name|zinput
init|=
name|NULL
decl_stmt|;
comment|/* -o: Output type.  */
specifier|const
name|char
modifier|*
name|zoutput
init|=
name|NULL
decl_stmt|;
comment|/* -p: Program name.  */
specifier|const
name|char
modifier|*
name|zprogram
init|=
name|NULL
decl_stmt|;
name|int
name|iopt
decl_stmt|;
name|enum
name|tconfig
name|tinput
decl_stmt|,
name|toutput
decl_stmt|;
name|int
name|iret
decl_stmt|;
name|pointer
name|pinput
decl_stmt|;
name|zProgram
operator|=
name|argv
index|[
literal|0
index|]
expr_stmt|;
while|while
condition|(
operator|(
name|iopt
operator|=
name|getopt_long
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"i:I:o:p:vx:"
argument_list|,
name|asVlongopts
argument_list|,
operator|(
name|int
operator|*
operator|)
name|NULL
argument_list|)
operator|)
operator|!=
name|EOF
condition|)
block|{
switch|switch
condition|(
name|iopt
condition|)
block|{
case|case
literal|'i'
case|:
comment|/* Input type.  */
name|zinput
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'o'
case|:
comment|/* Output type.  */
name|zoutput
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'p'
case|:
comment|/* Program name.  */
name|zprogram
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'I'
case|:
comment|/* Set the configuration file name.  */
name|zconfig
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'x'
case|:
comment|/* Set the debugging level.  */
break|break;
case|case
literal|'v'
case|:
comment|/* Print version and exit.  */
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: Taylor UUCP %s, copyright (C) 1991, 92, 93, 94, 1995 Ian Lance Taylor\n"
argument_list|,
name|zProgram
argument_list|,
name|VERSION
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_SUCCESS
argument_list|)
expr_stmt|;
comment|/*NOTREACHED*/
case|case
literal|1
case|:
comment|/* --help.  */
name|uvhelp
argument_list|()
expr_stmt|;
name|exit
argument_list|(
name|EXIT_SUCCESS
argument_list|)
expr_stmt|;
comment|/*NOTREACHED*/
case|case
literal|0
case|:
comment|/* Long option found, and flag value set.  */
break|break;
default|default:
name|uvusage
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|optind
operator|!=
name|argc
operator|||
name|zinput
operator|==
name|NULL
operator|||
name|zoutput
operator|==
name|NULL
condition|)
name|uvusage
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|zinput
argument_list|,
literal|"taylor"
argument_list|)
operator|==
literal|0
condition|)
name|tinput
operator|=
name|CONFIG_TAYLOR
expr_stmt|;
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|zinput
argument_list|,
literal|"v2"
argument_list|)
operator|==
literal|0
condition|)
name|tinput
operator|=
name|CONFIG_V2
expr_stmt|;
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|zinput
argument_list|,
literal|"hdb"
argument_list|)
operator|==
literal|0
condition|)
name|tinput
operator|=
name|CONFIG_HDB
expr_stmt|;
else|else
block|{
name|uvusage
argument_list|()
expr_stmt|;
name|tinput
operator|=
name|CONFIG_TAYLOR
expr_stmt|;
block|}
if|if
condition|(
name|strcasecmp
argument_list|(
name|zoutput
argument_list|,
literal|"taylor"
argument_list|)
operator|==
literal|0
condition|)
name|toutput
operator|=
name|CONFIG_TAYLOR
expr_stmt|;
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|zoutput
argument_list|,
literal|"v2"
argument_list|)
operator|==
literal|0
condition|)
name|toutput
operator|=
name|CONFIG_V2
expr_stmt|;
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|zoutput
argument_list|,
literal|"hdb"
argument_list|)
operator|==
literal|0
condition|)
name|toutput
operator|=
name|CONFIG_HDB
expr_stmt|;
else|else
block|{
name|uvusage
argument_list|()
expr_stmt|;
name|toutput
operator|=
name|CONFIG_TAYLOR
expr_stmt|;
block|}
if|if
condition|(
name|tinput
operator|==
name|toutput
condition|)
name|uvusage
argument_list|()
expr_stmt|;
name|iret
operator|=
name|UUCONF_SUCCESS
expr_stmt|;
comment|/* Initialize the input.  */
name|pinput
operator|=
name|NULL
expr_stmt|;
switch|switch
condition|(
name|tinput
condition|)
block|{
case|case
name|CONFIG_TAYLOR
case|:
name|iret
operator|=
name|uuconf_taylor_init
argument_list|(
operator|&
name|pinput
argument_list|,
name|zprogram
argument_list|,
name|zconfig
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_V2
case|:
name|iret
operator|=
name|uuconf_v2_init
argument_list|(
operator|&
name|pinput
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_HDB
case|:
name|iret
operator|=
name|uuconf_hdb_init
argument_list|(
operator|&
name|pinput
argument_list|,
name|zprogram
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
block|{
name|uvuuconf_error
argument_list|(
name|pinput
argument_list|,
name|iret
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
block|{
name|char
modifier|*
modifier|*
name|pzsystems
decl_stmt|;
name|char
modifier|*
name|zsys
decl_stmt|;
name|char
name|abtaylor
index|[
sizeof|sizeof
name|ZCURDIR
operator|+
sizeof|sizeof
name|SYSFILE
operator|-
literal|1
index|]
decl_stmt|;
name|char
name|abv2
index|[
sizeof|sizeof
name|ZCURDIR
operator|+
sizeof|sizeof
name|V2_SYSTEMS
operator|-
literal|1
index|]
decl_stmt|;
name|char
name|abhdb
index|[
sizeof|sizeof
name|ZCURDIR
operator|+
sizeof|sizeof
name|HDB_SYSTEMS
operator|-
literal|1
index|]
decl_stmt|;
name|FILE
modifier|*
name|esys
decl_stmt|;
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
comment|/* Get the list of systems.  */
switch|switch
condition|(
name|tinput
condition|)
block|{
case|case
name|CONFIG_TAYLOR
case|:
name|iret
operator|=
name|uuconf_taylor_system_names
argument_list|(
name|pinput
argument_list|,
operator|&
name|pzsystems
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_V2
case|:
name|iret
operator|=
name|uuconf_v2_system_names
argument_list|(
name|pinput
argument_list|,
operator|&
name|pzsystems
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_HDB
case|:
name|iret
operator|=
name|uuconf_hdb_system_names
argument_list|(
name|pinput
argument_list|,
operator|&
name|pzsystems
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|uvuuconf_error
argument_list|(
name|pinput
argument_list|,
name|iret
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* Open the sys file for the output type.  */
switch|switch
condition|(
name|toutput
condition|)
block|{
default|default:
case|case
name|CONFIG_TAYLOR
case|:
name|sprintf
argument_list|(
name|abtaylor
argument_list|,
literal|"%s%s"
argument_list|,
name|ZCURDIR
argument_list|,
name|SYSFILE
argument_list|)
expr_stmt|;
name|zsys
operator|=
name|abtaylor
expr_stmt|;
break|break;
case|case
name|CONFIG_V2
case|:
name|sprintf
argument_list|(
name|abv2
argument_list|,
literal|"%s%s"
argument_list|,
name|ZCURDIR
argument_list|,
name|V2_SYSTEMS
argument_list|)
expr_stmt|;
name|zsys
operator|=
name|abv2
expr_stmt|;
break|break;
case|case
name|CONFIG_HDB
case|:
name|sprintf
argument_list|(
name|abhdb
argument_list|,
literal|"%s%s"
argument_list|,
name|ZCURDIR
argument_list|,
name|HDB_SYSTEMS
argument_list|)
expr_stmt|;
name|zsys
operator|=
name|abhdb
expr_stmt|;
break|break;
block|}
name|esys
operator|=
name|fopen
argument_list|(
name|zsys
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|esys
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"uuchk:%s: "
argument_list|,
name|zsys
argument_list|)
expr_stmt|;
name|perror
argument_list|(
literal|"fopen"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|esys
argument_list|,
literal|"# %s file automatically generated by uuconv.\n"
argument_list|,
name|zsys
argument_list|)
expr_stmt|;
comment|/* Read and write each system.  We cheat and call the internal 	   routines, so that we can easily detect default information and 	   not write it out.  This isn't necessary, but it makes the output 	   smaller and simpler.  */
for|for
control|(
name|pz
operator|=
name|pzsystems
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
block|{
name|struct
name|uuconf_system
name|ssys
decl_stmt|;
switch|switch
condition|(
name|tinput
condition|)
block|{
case|case
name|CONFIG_TAYLOR
case|:
name|iret
operator|=
name|_uuconf_itaylor_system_internal
argument_list|(
name|pinput
argument_list|,
operator|*
name|pz
argument_list|,
operator|&
name|ssys
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_V2
case|:
name|iret
operator|=
name|_uuconf_iv2_system_internal
argument_list|(
name|pinput
argument_list|,
operator|*
name|pz
argument_list|,
operator|&
name|ssys
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_HDB
case|:
name|iret
operator|=
name|_uuconf_ihdb_system_internal
argument_list|(
name|pinput
argument_list|,
operator|*
name|pz
argument_list|,
operator|&
name|ssys
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|uvuuconf_error
argument_list|(
name|pinput
argument_list|,
name|iret
argument_list|)
expr_stmt|;
else|else
block|{
switch|switch
condition|(
name|toutput
condition|)
block|{
case|case
name|CONFIG_TAYLOR
case|:
name|uvwrite_taylor_system
argument_list|(
name|esys
argument_list|,
operator|&
name|ssys
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_V2
case|:
name|uvwrite_v2_system
argument_list|(
name|esys
argument_list|,
operator|&
name|ssys
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_HDB
case|:
name|uvwrite_hdb_system
argument_list|(
name|esys
argument_list|,
operator|&
name|ssys
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|toutput
operator|!=
name|CONFIG_HDB
condition|)
operator|(
name|void
operator|)
name|uuconf_system_free
argument_list|(
name|pinput
argument_list|,
operator|&
name|ssys
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|toutput
operator|==
name|CONFIG_HDB
condition|)
name|uvwrite_perms
argument_list|()
expr_stmt|;
if|if
condition|(
name|ferror
argument_list|(
name|esys
argument_list|)
operator|||
name|fclose
argument_list|(
name|esys
argument_list|)
operator|==
name|EOF
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"uuchk:%s: error during output\n"
argument_list|,
name|zsys
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|{
comment|/* Open the port file for the output type.  */
name|char
modifier|*
name|zport
decl_stmt|;
name|char
name|abtaylor
index|[
sizeof|sizeof
name|ZCURDIR
operator|+
sizeof|sizeof
name|PORTFILE
operator|-
literal|1
index|]
decl_stmt|;
name|char
name|abv2
index|[
sizeof|sizeof
name|ZCURDIR
operator|+
sizeof|sizeof
name|V2_DEVICES
operator|-
literal|1
index|]
decl_stmt|;
name|char
name|abhdb
index|[
sizeof|sizeof
name|ZCURDIR
operator|+
sizeof|sizeof
name|HDB_DEVICES
operator|-
literal|1
index|]
decl_stmt|;
name|FILE
modifier|*
name|eport
decl_stmt|;
name|int
argument_list|(
argument|*piportfn
argument_list|)
name|P
argument_list|(
operator|(
expr|struct
name|uuconf_port
operator|*
operator|,
name|pointer
operator|)
argument_list|)
expr_stmt|;
name|struct
name|uuconf_port
name|sport
decl_stmt|;
switch|switch
condition|(
name|toutput
condition|)
block|{
default|default:
case|case
name|CONFIG_TAYLOR
case|:
name|sprintf
argument_list|(
name|abtaylor
argument_list|,
literal|"%s%s"
argument_list|,
name|ZCURDIR
argument_list|,
name|PORTFILE
argument_list|)
expr_stmt|;
name|zport
operator|=
name|abtaylor
expr_stmt|;
name|piportfn
operator|=
name|ivwrite_taylor_port
expr_stmt|;
break|break;
case|case
name|CONFIG_V2
case|:
name|sprintf
argument_list|(
name|abv2
argument_list|,
literal|"%s%s"
argument_list|,
name|ZCURDIR
argument_list|,
name|V2_DEVICES
argument_list|)
expr_stmt|;
name|zport
operator|=
name|abv2
expr_stmt|;
name|piportfn
operator|=
name|ivwrite_v2_port
expr_stmt|;
break|break;
case|case
name|CONFIG_HDB
case|:
name|sprintf
argument_list|(
name|abhdb
argument_list|,
literal|"%s%s"
argument_list|,
name|ZCURDIR
argument_list|,
name|HDB_DEVICES
argument_list|)
expr_stmt|;
name|zport
operator|=
name|abhdb
expr_stmt|;
name|piportfn
operator|=
name|ivwrite_hdb_port
expr_stmt|;
break|break;
block|}
name|eport
operator|=
name|fopen
argument_list|(
name|zport
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|eport
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"uuchk:%s: "
argument_list|,
name|zport
argument_list|)
expr_stmt|;
name|perror
argument_list|(
literal|"fopen"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|eport
argument_list|,
literal|"# %s file automatically generated by uuconv.\n"
argument_list|,
name|zport
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|tinput
condition|)
block|{
case|case
name|CONFIG_TAYLOR
case|:
name|iret
operator|=
name|uuconf_taylor_find_port
argument_list|(
name|pinput
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|)
name|NULL
argument_list|,
literal|0L
argument_list|,
literal|0L
argument_list|,
name|piportfn
argument_list|,
operator|(
name|pointer
operator|)
name|eport
argument_list|,
operator|&
name|sport
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_V2
case|:
name|iret
operator|=
name|uuconf_v2_find_port
argument_list|(
name|pinput
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|)
name|NULL
argument_list|,
literal|0L
argument_list|,
literal|0L
argument_list|,
name|piportfn
argument_list|,
operator|(
name|pointer
operator|)
name|eport
argument_list|,
operator|&
name|sport
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_HDB
case|:
name|iret
operator|=
name|uuconf_hdb_find_port
argument_list|(
name|pinput
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|)
name|NULL
argument_list|,
literal|0L
argument_list|,
literal|0L
argument_list|,
name|piportfn
argument_list|,
operator|(
name|pointer
operator|)
name|eport
argument_list|,
operator|&
name|sport
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|iret
operator|!=
name|UUCONF_NOT_FOUND
condition|)
name|uvuuconf_error
argument_list|(
name|pinput
argument_list|,
name|iret
argument_list|)
expr_stmt|;
if|if
condition|(
name|ferror
argument_list|(
name|eport
argument_list|)
operator|||
name|fclose
argument_list|(
name|eport
argument_list|)
operator|==
name|EOF
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"uuchk:%s: error during output\n"
argument_list|,
name|zport
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* V2 configuration files don't support dialers.  */
if|if
condition|(
name|tinput
operator|!=
name|CONFIG_V2
operator|&&
name|toutput
operator|!=
name|CONFIG_V2
condition|)
block|{
name|char
modifier|*
modifier|*
name|pzdialers
decl_stmt|;
name|char
modifier|*
name|zdialer
decl_stmt|;
name|char
name|abtaylor
index|[
sizeof|sizeof
name|ZCURDIR
operator|+
sizeof|sizeof
name|DIALFILE
operator|-
literal|1
index|]
decl_stmt|;
name|char
name|abhdb
index|[
sizeof|sizeof
name|ZCURDIR
operator|+
sizeof|sizeof
name|HDB_DIALERS
operator|-
literal|1
index|]
decl_stmt|;
name|FILE
modifier|*
name|edialer
decl_stmt|;
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
comment|/* Get the list of dialers.  */
switch|switch
condition|(
name|tinput
condition|)
block|{
default|default:
case|case
name|CONFIG_TAYLOR
case|:
name|iret
operator|=
name|uuconf_taylor_dialer_names
argument_list|(
name|pinput
argument_list|,
operator|&
name|pzdialers
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_HDB
case|:
name|iret
operator|=
name|uuconf_hdb_dialer_names
argument_list|(
name|pinput
argument_list|,
operator|&
name|pzdialers
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|uvuuconf_error
argument_list|(
name|pinput
argument_list|,
name|iret
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* Open the sys file for the output type.  */
switch|switch
condition|(
name|toutput
condition|)
block|{
default|default:
case|case
name|CONFIG_TAYLOR
case|:
name|sprintf
argument_list|(
name|abtaylor
argument_list|,
literal|"%s%s"
argument_list|,
name|ZCURDIR
argument_list|,
name|DIALFILE
argument_list|)
expr_stmt|;
name|zdialer
operator|=
name|abtaylor
expr_stmt|;
break|break;
case|case
name|CONFIG_HDB
case|:
name|sprintf
argument_list|(
name|abhdb
argument_list|,
literal|"%s%s"
argument_list|,
name|ZCURDIR
argument_list|,
name|HDB_DIALERS
argument_list|)
expr_stmt|;
name|zdialer
operator|=
name|abhdb
expr_stmt|;
break|break;
block|}
name|edialer
operator|=
name|fopen
argument_list|(
name|zdialer
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|edialer
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"uuchk:%s: "
argument_list|,
name|zdialer
argument_list|)
expr_stmt|;
name|perror
argument_list|(
literal|"fopen"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|edialer
argument_list|,
literal|"# %s file automatically generated by uuconv.\n"
argument_list|,
name|zdialer
argument_list|)
expr_stmt|;
comment|/* Read and write each dialer.  */
for|for
control|(
name|pz
operator|=
name|pzdialers
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
block|{
name|struct
name|uuconf_dialer
name|sdialer
decl_stmt|;
switch|switch
condition|(
name|tinput
condition|)
block|{
default|default:
case|case
name|CONFIG_TAYLOR
case|:
name|iret
operator|=
name|uuconf_taylor_dialer_info
argument_list|(
name|pinput
argument_list|,
operator|*
name|pz
argument_list|,
operator|&
name|sdialer
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_HDB
case|:
name|iret
operator|=
name|uuconf_hdb_dialer_info
argument_list|(
name|pinput
argument_list|,
operator|*
name|pz
argument_list|,
operator|&
name|sdialer
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|uvuuconf_error
argument_list|(
name|pinput
argument_list|,
name|iret
argument_list|)
expr_stmt|;
else|else
block|{
switch|switch
condition|(
name|toutput
condition|)
block|{
default|default:
case|case
name|CONFIG_TAYLOR
case|:
name|fprintf
argument_list|(
name|edialer
argument_list|,
literal|"# Start of dialer %s\n"
argument_list|,
name|sdialer
operator|.
name|uuconf_zname
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|edialer
argument_list|,
literal|"dialer %s\n"
argument_list|,
name|sdialer
operator|.
name|uuconf_zname
argument_list|)
expr_stmt|;
name|uvwrite_taylor_dialer
argument_list|(
name|edialer
argument_list|,
operator|&
name|sdialer
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONFIG_HDB
case|:
name|uvwrite_hdb_dialer
argument_list|(
name|edialer
argument_list|,
operator|&
name|sdialer
argument_list|)
expr_stmt|;
break|break;
block|}
operator|(
name|void
operator|)
name|uuconf_dialer_free
argument_list|(
name|pinput
argument_list|,
operator|&
name|sdialer
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|ferror
argument_list|(
name|edialer
argument_list|)
operator|||
name|fclose
argument_list|(
name|edialer
argument_list|)
operator|==
name|EOF
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"uuchk:%s: error during output\n"
argument_list|,
name|zdialer
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|exit
argument_list|(
name|EXIT_SUCCESS
argument_list|)
expr_stmt|;
comment|/* Avoid complaints about not returning.  */
return|return
literal|0
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Print out a usage message and die.  */
end_comment

begin_function
specifier|static
name|void
name|uvusage
parameter_list|()
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Usage: %s -i input-type -o output-type [-p program]\n"
argument_list|,
name|zProgram
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Use %s --help for help\n"
argument_list|,
name|zProgram
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Print a help message.  */
end_comment

begin_function
specifier|static
name|void
name|uvhelp
parameter_list|()
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Taylor UUCP %s, copyright (C) 1991, 92, 93, 94, 1995 Ian Lance Taylor\n"
argument_list|,
name|VERSION
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Converts UUCP configuration files from one format to another.\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Usage: %s -i input -o output [-p program] [-I file]\n"
argument_list|,
name|zProgram
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" -i,--input input: Set input type (one of taylor, v2, hdb)\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" -o,--output output: Set output type (one of taylor, v2, hdb)\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" -p,--program program: Program to convert (e.g., uucp or cu)\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" -I,--config file: Set Taylor UUCP configuration file to use\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" -v,--version: Print version and exit\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" --help: Print help and exit\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Write out a timespan.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_time
parameter_list|(
name|e
parameter_list|,
name|qtime
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
name|struct
name|uuconf_timespan
modifier|*
name|qtime
decl_stmt|;
block|{
if|if
condition|(
name|qtime
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"Never"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|qtime
operator|->
name|uuconf_istart
operator|==
literal|0
operator|&&
name|qtime
operator|->
name|uuconf_iend
operator|==
literal|7
operator|*
literal|24
operator|*
literal|60
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"Any"
argument_list|)
expr_stmt|;
return|return;
block|}
for|for
control|(
init|;
name|qtime
operator|!=
name|NULL
condition|;
name|qtime
operator|=
name|qtime
operator|->
name|uuconf_qnext
control|)
block|{
name|int
name|idaystart
decl_stmt|,
name|idayend
decl_stmt|;
name|int
name|ihourstart
decl_stmt|,
name|ihourend
decl_stmt|;
name|int
name|iminutestart
decl_stmt|,
name|iminuteend
decl_stmt|;
specifier|const
name|char
modifier|*
specifier|const
name|zdays
init|=
literal|"Su\0Mo\0Tu\0We\0Th\0Fr\0Sa"
decl_stmt|;
name|idaystart
operator|=
name|qtime
operator|->
name|uuconf_istart
operator|/
operator|(
literal|24
operator|*
literal|60
operator|)
expr_stmt|;
name|ihourstart
operator|=
operator|(
name|qtime
operator|->
name|uuconf_istart
operator|%
operator|(
literal|24
operator|*
literal|60
operator|)
operator|)
operator|/
literal|60
expr_stmt|;
name|iminutestart
operator|=
name|qtime
operator|->
name|uuconf_istart
operator|%
literal|60
expr_stmt|;
if|if
condition|(
name|qtime
operator|->
name|uuconf_iend
operator|>=
literal|7
operator|*
literal|24
operator|*
literal|60
condition|)
name|qtime
operator|->
name|uuconf_iend
operator|=
literal|7
operator|*
literal|24
operator|*
literal|60
operator|-
literal|1
expr_stmt|;
name|idayend
operator|=
name|qtime
operator|->
name|uuconf_iend
operator|/
operator|(
literal|24
operator|*
literal|60
operator|)
expr_stmt|;
name|ihourend
operator|=
operator|(
name|qtime
operator|->
name|uuconf_iend
operator|%
operator|(
literal|24
operator|*
literal|60
operator|)
operator|)
operator|/
literal|60
expr_stmt|;
name|iminuteend
operator|=
name|qtime
operator|->
name|uuconf_iend
operator|%
literal|60
expr_stmt|;
if|if
condition|(
name|ihourend
operator|==
literal|0
operator|&&
name|iminuteend
operator|==
literal|0
condition|)
operator|--
name|idayend
expr_stmt|;
if|if
condition|(
name|idaystart
operator|==
name|idayend
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s%02d%02d-%02d%02d"
argument_list|,
name|zdays
operator|+
name|idaystart
operator|*
literal|3
argument_list|,
name|ihourstart
argument_list|,
name|iminutestart
argument_list|,
name|ihourend
argument_list|,
name|iminuteend
argument_list|)
expr_stmt|;
else|else
block|{
name|int
name|i
decl_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s%02d%02d-0000"
argument_list|,
name|zdays
operator|+
name|idaystart
operator|*
literal|3
argument_list|,
name|ihourstart
argument_list|,
name|iminutestart
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|idaystart
operator|+
literal|1
init|;
name|i
operator|<
name|idayend
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|",%s"
argument_list|,
name|zdays
operator|+
name|i
operator|*
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|ihourend
operator|!=
literal|0
operator|||
name|iminuteend
operator|!=
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|",%s0000-%02d%02d"
argument_list|,
name|zdays
operator|+
name|idayend
operator|*
literal|3
argument_list|,
name|ihourend
argument_list|,
name|iminuteend
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|qtime
operator|->
name|uuconf_qnext
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|","
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Some subroutines used when writing out Taylor UUCP configuration    files.  */
end_comment

begin_comment
comment|/* Write a command with a string argument.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_string
parameter_list|(
name|e
parameter_list|,
name|zarg
parameter_list|,
name|zcmd
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
specifier|const
name|char
modifier|*
name|zarg
decl_stmt|;
specifier|const
name|char
modifier|*
name|zcmd
decl_stmt|;
block|{
if|if
condition|(
name|zarg
operator|!=
operator|(
specifier|const
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s %s\n"
argument_list|,
name|zcmd
argument_list|,
name|zarg
operator|==
name|NULL
condition|?
operator|(
specifier|const
name|char
operator|*
operator|)
literal|""
else|:
name|zarg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Write out a size restriction command.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_size
parameter_list|(
name|e
parameter_list|,
name|qtime
parameter_list|,
name|zcmd
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
name|struct
name|uuconf_timespan
modifier|*
name|qtime
decl_stmt|;
specifier|const
name|char
modifier|*
name|zcmd
decl_stmt|;
block|{
if|if
condition|(
name|qtime
operator|!=
operator|(
expr|struct
name|uuconf_timespan
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
for|for
control|(
init|;
name|qtime
operator|!=
name|NULL
condition|;
name|qtime
operator|=
name|qtime
operator|->
name|uuconf_qnext
control|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s %ld"
argument_list|,
name|zcmd
argument_list|,
name|qtime
operator|->
name|uuconf_ival
argument_list|)
expr_stmt|;
name|uvwrite_time
argument_list|(
name|e
argument_list|,
name|qtime
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/* Write out a boolean argument with a string command.  If the value    is less than zero, than it was uninitialized and we don't write    anything.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_boolean
parameter_list|(
name|e
parameter_list|,
name|fval
parameter_list|,
name|zcmd
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
name|int
name|fval
decl_stmt|;
specifier|const
name|char
modifier|*
name|zcmd
decl_stmt|;
block|{
if|if
condition|(
name|fval
operator|>=
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s %s\n"
argument_list|,
name|zcmd
argument_list|,
name|fval
operator|>
literal|0
condition|?
literal|"true"
else|:
literal|"false"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Write out a string array as a single command.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_string_array
parameter_list|(
name|e
parameter_list|,
name|pz
parameter_list|,
name|zcmd
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
specifier|const
name|char
modifier|*
name|zcmd
decl_stmt|;
block|{
if|if
condition|(
name|pz
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|zcmd
argument_list|)
expr_stmt|;
if|if
condition|(
name|pz
operator|!=
name|NULL
condition|)
for|for
control|(
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %s"
argument_list|,
operator|*
name|pz
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Write out a chat script.  Don't separate subsend/subexpect strings    by spaces.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_chat_script
parameter_list|(
name|e
parameter_list|,
name|pzarg
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
name|char
modifier|*
modifier|*
name|pzarg
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
if|if
condition|(
name|pzarg
operator|==
name|NULL
operator|||
name|pzarg
operator|==
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
return|return;
for|for
control|(
name|pz
operator|=
name|pzarg
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
block|{
if|if
condition|(
operator|(
operator|*
name|pz
operator|)
index|[
literal|0
index|]
operator|!=
literal|'-'
operator|&&
name|pz
operator|!=
name|pzarg
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
operator|*
name|pz
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Write out chat information.  If the qlast argument is not NULL,    then only values that are different from qlast should be written.    The fforce argument is used to get around a peculiar problem: if    the ``chat'' command is used with no arguments for a system, then    uuconf_pzchat will be NULL (not&_uuconf_unset) and the default    chat script will not be used.  We must distinguish this case from    the ``chat'' command not appearing at all for a port or dialer, in    which case the value will again be NULL.  In the former case we    must output a ``chat'' command, in the latter case we would prefer    not to.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_chat
parameter_list|(
name|e
parameter_list|,
name|q
parameter_list|,
name|qlast
parameter_list|,
name|zprefix
parameter_list|,
name|fforce
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
specifier|const
name|struct
name|uuconf_chat
modifier|*
name|q
decl_stmt|;
specifier|const
name|struct
name|uuconf_chat
modifier|*
name|qlast
decl_stmt|;
specifier|const
name|char
modifier|*
name|zprefix
decl_stmt|;
name|boolean
name|fforce
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
name|char
name|ab
index|[
literal|100
index|]
decl_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzchat
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
operator|(
name|qlast
operator|==
name|NULL
condition|?
operator|(
name|fforce
operator|||
name|q
operator|->
name|uuconf_pzchat
operator|!=
name|NULL
operator|)
else|:
name|qlast
operator|->
name|uuconf_pzchat
operator|!=
name|q
operator|->
name|uuconf_pzchat
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%schat "
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_chat_script
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_pzchat
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|q
operator|->
name|uuconf_pzprogram
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
operator|(
name|qlast
operator|==
name|NULL
condition|?
name|q
operator|->
name|uuconf_pzprogram
operator|!=
name|NULL
else|:
name|qlast
operator|->
name|uuconf_pzprogram
operator|!=
name|q
operator|->
name|uuconf_pzprogram
operator|)
condition|)
block|{
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%schat-program"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_pzprogram
argument_list|,
name|ab
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|q
operator|->
name|uuconf_ctimeout
operator|>=
literal|0
operator|&&
operator|(
name|qlast
operator|==
name|NULL
operator|||
name|qlast
operator|->
name|uuconf_ctimeout
operator|!=
name|q
operator|->
name|uuconf_ctimeout
operator|)
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%schat-timeout %d\n"
argument_list|,
name|zprefix
argument_list|,
name|q
operator|->
name|uuconf_ctimeout
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzfail
operator|!=
name|NULL
operator|&&
name|q
operator|->
name|uuconf_pzfail
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
operator|(
name|qlast
operator|==
name|NULL
operator|||
name|qlast
operator|->
name|uuconf_pzfail
operator|!=
name|q
operator|->
name|uuconf_pzfail
operator|)
condition|)
for|for
control|(
name|pz
operator|=
name|q
operator|->
name|uuconf_pzfail
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%schat-fail %s\n"
argument_list|,
name|zprefix
argument_list|,
operator|*
name|pz
argument_list|)
expr_stmt|;
if|if
condition|(
name|qlast
operator|==
name|NULL
operator|||
name|qlast
operator|->
name|uuconf_fstrip
operator|!=
name|q
operator|->
name|uuconf_fstrip
condition|)
block|{
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%schat-strip"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_fstrip
argument_list|,
name|ab
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Write out protocol parameters to a Taylor UUCP file.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_proto_params
parameter_list|(
name|e
parameter_list|,
name|qparams
parameter_list|,
name|zprefix
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
specifier|const
name|struct
name|uuconf_proto_param
modifier|*
name|qparams
decl_stmt|;
specifier|const
name|char
modifier|*
name|zprefix
decl_stmt|;
block|{
specifier|const
name|struct
name|uuconf_proto_param
modifier|*
name|qp
decl_stmt|;
if|if
condition|(
name|qparams
operator|==
name|NULL
operator|||
name|qparams
operator|==
operator|(
expr|struct
name|uuconf_proto_param
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
return|return;
for|for
control|(
name|qp
operator|=
name|qparams
init|;
name|qp
operator|->
name|uuconf_bproto
operator|!=
literal|'\0'
condition|;
name|qp
operator|++
control|)
block|{
specifier|const
name|struct
name|uuconf_proto_param_entry
modifier|*
name|qe
decl_stmt|;
for|for
control|(
name|qe
operator|=
name|qp
operator|->
name|uuconf_qentries
init|;
name|qe
operator|->
name|uuconf_cargs
operator|>
literal|0
condition|;
name|qe
operator|++
control|)
block|{
name|int
name|i
decl_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sprotocol-parameter %c"
argument_list|,
name|zprefix
argument_list|,
name|qp
operator|->
name|uuconf_bproto
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|qe
operator|->
name|uuconf_cargs
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %s"
argument_list|,
name|qe
operator|->
name|uuconf_pzargs
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Write out Taylor UUCP system information.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_taylor_system
parameter_list|(
name|e
parameter_list|,
name|q
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
specifier|const
name|struct
name|uuconf_system
modifier|*
name|q
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
specifier|const
name|struct
name|uuconf_system
modifier|*
name|qlast
decl_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"# Start of system %s\n"
argument_list|,
name|q
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"system %s\n"
argument_list|,
name|q
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzalias
operator|!=
name|NULL
operator|&&
name|q
operator|->
name|uuconf_pzalias
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
for|for
control|(
name|pz
operator|=
name|q
operator|->
name|uuconf_pzalias
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
name|uvwrite_string
argument_list|(
name|e
argument_list|,
operator|*
name|pz
argument_list|,
literal|"alias"
argument_list|)
expr_stmt|;
for|for
control|(
name|qlast
operator|=
name|NULL
init|;
name|q
operator|!=
name|NULL
condition|;
name|qlast
operator|=
name|q
operator|,
name|q
operator|=
name|q
operator|->
name|uuconf_qalternate
control|)
block|{
name|struct
name|uuconf_timespan
modifier|*
name|qtime
decl_stmt|;
if|if
condition|(
name|qlast
operator|!=
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"alternate"
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_zalternate
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_zalternate
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %s"
argument_list|,
name|q
operator|->
name|uuconf_zalternate
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
define|#
directive|define
name|CHANGED
parameter_list|(
name|x
parameter_list|)
value|(qlast == NULL || qlast->x != q->x)
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_qtimegrade
argument_list|)
operator|&&
operator|(
name|q
operator|->
name|uuconf_qtimegrade
operator|!=
operator|(
expr|struct
name|uuconf_timespan
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|)
condition|)
block|{
if|if
condition|(
name|q
operator|->
name|uuconf_qtimegrade
operator|==
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"time never\n"
argument_list|)
expr_stmt|;
else|else
block|{
for|for
control|(
name|qtime
operator|=
name|q
operator|->
name|uuconf_qtimegrade
init|;
name|qtime
operator|!=
name|NULL
condition|;
name|qtime
operator|=
name|qtime
operator|->
name|uuconf_qnext
control|)
block|{
if|if
condition|(
operator|(
name|char
operator|)
name|qtime
operator|->
name|uuconf_ival
operator|==
name|UUCONF_GRADE_LOW
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"time "
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"timegrade %c "
argument_list|,
operator|(
name|char
operator|)
name|qtime
operator|->
name|uuconf_ival
argument_list|)
expr_stmt|;
name|uvwrite_time
argument_list|(
name|e
argument_list|,
name|qtime
argument_list|)
expr_stmt|;
if|if
condition|(
name|qtime
operator|->
name|uuconf_cretry
operator|!=
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %d"
argument_list|,
name|qtime
operator|->
name|uuconf_cretry
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_qcalltimegrade
argument_list|)
operator|&&
operator|(
name|q
operator|->
name|uuconf_qcalltimegrade
operator|!=
operator|(
expr|struct
name|uuconf_timespan
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|)
condition|)
block|{
for|for
control|(
name|qtime
operator|=
name|q
operator|->
name|uuconf_qcalltimegrade
init|;
name|qtime
operator|!=
name|NULL
condition|;
name|qtime
operator|=
name|qtime
operator|->
name|uuconf_qnext
control|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"call-timegrade %c "
argument_list|,
operator|(
name|char
operator|)
name|qtime
operator|->
name|uuconf_ival
argument_list|)
expr_stmt|;
name|uvwrite_time
argument_list|(
name|e
argument_list|,
name|qtime
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_qcalledtimegrade
argument_list|)
operator|&&
operator|(
name|q
operator|->
name|uuconf_qcalledtimegrade
operator|!=
operator|(
expr|struct
name|uuconf_timespan
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|)
condition|)
block|{
for|for
control|(
name|qtime
operator|=
name|q
operator|->
name|uuconf_qcalledtimegrade
init|;
name|qtime
operator|!=
name|NULL
condition|;
name|qtime
operator|=
name|qtime
operator|->
name|uuconf_qnext
control|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"called-timegrade %c "
argument_list|,
operator|(
name|char
operator|)
name|qtime
operator|->
name|uuconf_ival
argument_list|)
expr_stmt|;
name|uvwrite_time
argument_list|(
name|e
argument_list|,
name|qtime
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_qcall_local_size
argument_list|)
condition|)
name|uvwrite_size
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_qcall_local_size
argument_list|,
literal|"call-local-size"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_qcall_remote_size
argument_list|)
condition|)
name|uvwrite_size
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_qcall_remote_size
argument_list|,
literal|"call-remote-size"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_qcalled_local_size
argument_list|)
condition|)
name|uvwrite_size
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_qcalled_local_size
argument_list|,
literal|"called-local-size"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_qcalled_remote_size
argument_list|)
condition|)
name|uvwrite_size
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_qcalled_remote_size
argument_list|,
literal|"called-remote-size"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_ibaud
argument_list|)
operator|||
name|CHANGED
argument_list|(
name|uuconf_ihighbaud
argument_list|)
condition|)
block|{
if|if
condition|(
name|q
operator|->
name|uuconf_ibaud
operator|>=
literal|0
condition|)
block|{
if|if
condition|(
name|q
operator|->
name|uuconf_ihighbaud
operator|>
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"baud-range %ld %ld\n"
argument_list|,
name|q
operator|->
name|uuconf_ibaud
argument_list|,
name|q
operator|->
name|uuconf_ihighbaud
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"baud %ld\n"
argument_list|,
name|q
operator|->
name|uuconf_ibaud
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_zport
argument_list|)
operator|||
name|CHANGED
argument_list|(
name|uuconf_qport
argument_list|)
condition|)
block|{
if|if
condition|(
name|q
operator|->
name|uuconf_zport
operator|!=
name|NULL
operator|&&
name|q
operator|->
name|uuconf_zport
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
name|uvwrite_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_zport
argument_list|,
literal|"port"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|q
operator|->
name|uuconf_qport
operator|!=
name|NULL
operator|&&
operator|(
name|q
operator|->
name|uuconf_qport
operator|!=
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|)
condition|)
name|uvwrite_taylor_port
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_qport
argument_list|,
literal|"port "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_zphone
argument_list|)
condition|)
block|{
specifier|const
name|char
modifier|*
name|zcmd
decl_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_qport
operator|!=
name|NULL
operator|&&
name|q
operator|->
name|uuconf_qport
operator|!=
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
operator|(
name|q
operator|->
name|uuconf_qport
operator|->
name|uuconf_ttype
operator|==
name|UUCONF_PORTTYPE_TCP
operator|||
name|q
operator|->
name|uuconf_qport
operator|->
name|uuconf_ttype
operator|==
name|UUCONF_PORTTYPE_TLI
operator|)
condition|)
name|zcmd
operator|=
literal|"address"
expr_stmt|;
else|else
name|zcmd
operator|=
literal|"phone"
expr_stmt|;
name|uvwrite_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_zphone
argument_list|,
name|zcmd
argument_list|)
expr_stmt|;
block|}
name|uvwrite_chat
argument_list|(
name|e
argument_list|,
operator|&
name|q
operator|->
name|uuconf_schat
argument_list|,
operator|(
name|qlast
operator|==
name|NULL
condition|?
operator|(
expr|struct
name|uuconf_chat
operator|*
operator|)
name|NULL
else|:
operator|&
name|qlast
operator|->
name|uuconf_schat
operator|)
argument_list|,
literal|""
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_zcall_login
argument_list|)
condition|)
name|uvwrite_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_zcall_login
argument_list|,
literal|"call-login"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_zcall_password
argument_list|)
condition|)
name|uvwrite_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_zcall_password
argument_list|,
literal|"call-password"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_zcalled_login
argument_list|)
condition|)
name|uvwrite_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_zcalled_login
argument_list|,
literal|"called-login"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_fcallback
argument_list|)
condition|)
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_fcallback
argument_list|,
literal|"callback"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_fsequence
argument_list|)
condition|)
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_fsequence
argument_list|,
literal|"sequence"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_zprotocols
argument_list|)
condition|)
name|uvwrite_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_zprotocols
argument_list|,
literal|"protocol"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_qproto_params
argument_list|)
condition|)
name|uvwrite_proto_params
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_qproto_params
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|uvwrite_chat
argument_list|(
name|e
argument_list|,
operator|&
name|q
operator|->
name|uuconf_scalled_chat
argument_list|,
operator|(
name|qlast
operator|==
name|NULL
condition|?
operator|(
expr|struct
name|uuconf_chat
operator|*
operator|)
name|NULL
else|:
operator|&
name|qlast
operator|->
name|uuconf_scalled_chat
operator|)
argument_list|,
literal|"called-"
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_zdebug
argument_list|)
condition|)
name|uvwrite_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_zdebug
argument_list|,
literal|"debug"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_zmax_remote_debug
argument_list|)
condition|)
name|uvwrite_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_zmax_remote_debug
argument_list|,
literal|"max-remote-debug"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|CHANGED
argument_list|(
name|uuconf_fsend_request
argument_list|)
operator|||
name|CHANGED
argument_list|(
name|uuconf_frec_request
argument_list|)
operator|)
operator|&&
operator|(
name|q
operator|->
name|uuconf_fsend_request
operator|>=
literal|0
operator|||
name|q
operator|->
name|uuconf_frec_request
operator|>=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|q
operator|->
name|uuconf_fsend_request
operator|>=
literal|0
operator|&&
operator|(
name|q
operator|->
name|uuconf_fsend_request
operator|>
literal|0
condition|?
name|q
operator|->
name|uuconf_frec_request
operator|>
literal|0
else|:
name|q
operator|->
name|uuconf_frec_request
operator|==
literal|0
operator|)
condition|)
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_fsend_request
argument_list|,
literal|"request"
argument_list|)
expr_stmt|;
else|else
block|{
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_fsend_request
argument_list|,
literal|"send-request"
argument_list|)
expr_stmt|;
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_frec_request
argument_list|,
literal|"receive-request"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|CHANGED
argument_list|(
name|uuconf_fcall_transfer
argument_list|)
operator|||
name|CHANGED
argument_list|(
name|uuconf_fcalled_transfer
argument_list|)
operator|)
operator|&&
operator|(
name|q
operator|->
name|uuconf_fcall_transfer
operator|>=
literal|0
operator|||
name|q
operator|->
name|uuconf_fcalled_transfer
operator|>=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|q
operator|->
name|uuconf_fcall_transfer
operator|>=
literal|0
operator|&&
operator|(
name|q
operator|->
name|uuconf_fcall_transfer
operator|>
literal|0
condition|?
name|q
operator|->
name|uuconf_fcalled_transfer
operator|>
literal|0
else|:
name|q
operator|->
name|uuconf_fcalled_transfer
operator|==
literal|0
operator|)
condition|)
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_fcall_transfer
argument_list|,
literal|"transfer"
argument_list|)
expr_stmt|;
else|else
block|{
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_fcall_transfer
argument_list|,
literal|"call-transfer"
argument_list|)
expr_stmt|;
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_fcalled_transfer
argument_list|,
literal|"called-transfer"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_pzlocal_send
argument_list|)
condition|)
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_pzlocal_send
argument_list|,
literal|"local-send"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_pzremote_send
argument_list|)
condition|)
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_pzremote_send
argument_list|,
literal|"remote-send"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_pzlocal_receive
argument_list|)
condition|)
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_pzlocal_receive
argument_list|,
literal|"local-receive"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_pzremote_receive
argument_list|)
condition|)
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_pzremote_receive
argument_list|,
literal|"remote-receive"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_pzpath
argument_list|)
condition|)
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_pzpath
argument_list|,
literal|"command-path"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_pzcmds
argument_list|)
condition|)
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_pzcmds
argument_list|,
literal|"commands"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_cfree_space
argument_list|)
operator|&&
name|q
operator|->
name|uuconf_cfree_space
operator|>=
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"free-space %ld\n"
argument_list|,
name|q
operator|->
name|uuconf_cfree_space
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_pzforward_from
argument_list|)
condition|)
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_pzforward_from
argument_list|,
literal|"forward-from"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_pzforward_to
argument_list|)
condition|)
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_pzforward_to
argument_list|,
literal|"forward-to"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_zpubdir
argument_list|)
condition|)
name|uvwrite_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_zpubdir
argument_list|,
literal|"pubdir"
argument_list|)
expr_stmt|;
if|if
condition|(
name|CHANGED
argument_list|(
name|uuconf_zlocalname
argument_list|)
condition|)
name|uvwrite_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_zlocalname
argument_list|,
literal|"myname"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Write out V2 system information.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_v2_system
parameter_list|(
name|e
parameter_list|,
name|q
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
specifier|const
name|struct
name|uuconf_system
modifier|*
name|q
decl_stmt|;
block|{
for|for
control|(
init|;
name|q
operator|!=
name|NULL
condition|;
name|q
operator|=
name|q
operator|->
name|uuconf_qalternate
control|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|q
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_qtimegrade
operator|!=
operator|(
expr|struct
name|uuconf_timespan
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|uvwrite_time
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_qtimegrade
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_zport
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|||
name|q
operator|->
name|uuconf_qport
operator|!=
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|struct
name|uuconf_port
modifier|*
name|qp
decl_stmt|;
name|boolean
name|ftcp
decl_stmt|;
name|qp
operator|=
name|q
operator|->
name|uuconf_qport
expr_stmt|;
name|ftcp
operator|=
operator|(
name|qp
operator|!=
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|qp
operator|!=
name|NULL
operator|&&
name|qp
operator|->
name|uuconf_ttype
operator|==
name|UUCONF_PORTTYPE_TCP
operator|)
expr_stmt|;
if|if
condition|(
name|ftcp
operator|||
operator|(
name|q
operator|->
name|uuconf_zport
operator|!=
name|NULL
operator|&&
name|q
operator|->
name|uuconf_zport
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|)
condition|)
block|{
if|if
condition|(
name|ftcp
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" TCP"
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %s"
argument_list|,
name|q
operator|->
name|uuconf_zport
argument_list|)
expr_stmt|;
if|if
condition|(
name|ftcp
operator|||
name|q
operator|->
name|uuconf_ibaud
operator|>=
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|ftcp
condition|)
block|{
specifier|const
name|char
modifier|*
name|zport
decl_stmt|;
name|zport
operator|=
name|qp
operator|->
name|uuconf_u
operator|.
name|uuconf_stcp
operator|.
name|uuconf_zport
expr_stmt|;
if|if
condition|(
name|zport
operator|==
name|NULL
condition|)
name|zport
operator|=
literal|"uucp"
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|zport
argument_list|)
expr_stmt|;
block|}
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%ld"
argument_list|,
name|q
operator|->
name|uuconf_ibaud
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_zphone
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_zphone
operator|!=
name|NULL
condition|)
block|{
name|char
modifier|*
modifier|*
name|pzc
decl_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %s"
argument_list|,
name|q
operator|->
name|uuconf_zphone
argument_list|)
expr_stmt|;
name|pzc
operator|=
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
expr_stmt|;
if|if
condition|(
name|pzc
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|pzc
operator|!=
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|uvwrite_chat_script
argument_list|(
name|e
argument_list|,
name|pzc
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
block|}
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* Here we should gather information to write out to USERFILE 	 and L.cmds, and perhaps some day we will.  It's much more 	 likely to happen if somebody else does it, though.  */
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Write out HDB system information.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_hdb_system
parameter_list|(
name|e
parameter_list|,
name|qsys
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
specifier|const
name|struct
name|uuconf_system
modifier|*
name|qsys
decl_stmt|;
block|{
specifier|const
name|struct
name|uuconf_system
modifier|*
name|q
decl_stmt|;
name|struct
name|shpermissions
name|sperm
decl_stmt|;
name|char
modifier|*
name|azmachine
index|[
literal|2
index|]
decl_stmt|;
name|char
modifier|*
name|azlogname
index|[
literal|2
index|]
decl_stmt|;
for|for
control|(
name|q
operator|=
name|qsys
init|;
name|q
operator|!=
name|NULL
condition|;
name|q
operator|=
name|q
operator|->
name|uuconf_qalternate
control|)
block|{
if|if
condition|(
name|q
operator|->
name|uuconf_fcall
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|q
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_qtimegrade
operator|!=
operator|(
expr|struct
name|uuconf_timespan
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
specifier|const
name|char
modifier|*
name|zport
decl_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|uvwrite_time
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|uuconf_qtimegrade
argument_list|)
expr_stmt|;
name|zport
operator|=
name|q
operator|->
name|uuconf_zport
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_qport
operator|!=
name|NULL
operator|&&
name|q
operator|->
name|uuconf_qport
operator|!=
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_qport
operator|->
name|uuconf_ttype
operator|==
name|UUCONF_PORTTYPE_TCP
condition|)
name|zport
operator|=
literal|"TCP"
expr_stmt|;
if|if
condition|(
name|zport
operator|!=
name|NULL
operator|&&
name|zport
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %s"
argument_list|,
name|zport
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_zprotocols
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_zprotocols
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|",%s"
argument_list|,
name|q
operator|->
name|uuconf_zprotocols
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_ibaud
operator|>=
literal|0
operator|||
name|q
operator|->
name|uuconf_zphone
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_ibaud
operator|<
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"Any"
argument_list|)
expr_stmt|;
else|else
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%ld"
argument_list|,
name|q
operator|->
name|uuconf_ibaud
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_ihighbaud
operator|>=
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"-%ld"
argument_list|,
name|q
operator|->
name|uuconf_ihighbaud
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|q
operator|->
name|uuconf_zphone
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_zphone
operator|!=
name|NULL
condition|)
block|{
name|char
modifier|*
modifier|*
name|pzc
decl_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %s"
argument_list|,
name|q
operator|->
name|uuconf_zphone
argument_list|)
expr_stmt|;
name|pzc
operator|=
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
expr_stmt|;
if|if
condition|(
name|pzc
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|pzc
operator|!=
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|uvwrite_chat_script
argument_list|(
name|e
argument_list|,
name|pzc
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* Build a Permissions entry for this system.  There will be only      one MACHINE entry for a given system.  */
for|for
control|(
name|q
operator|=
name|qsys
init|;
name|q
operator|!=
name|NULL
condition|;
name|q
operator|=
name|q
operator|->
name|uuconf_qalternate
control|)
if|if
condition|(
name|q
operator|->
name|uuconf_fcall
condition|)
break|break;
if|if
condition|(
name|q
operator|!=
name|NULL
condition|)
block|{
name|sperm
operator|.
name|qnext
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzlogname
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzmachine
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|frequest
operator|=
operator|-
literal|1
expr_stmt|;
name|sperm
operator|.
name|fsendfiles
operator|=
operator|-
literal|1
expr_stmt|;
name|sperm
operator|.
name|pzread
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzwrite
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|fcallback
operator|=
operator|-
literal|1
expr_stmt|;
name|sperm
operator|.
name|pzcommands
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzvalidate
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|zmyname
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|zpubdir
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzalias
operator|=
name|NULL
expr_stmt|;
name|azmachine
index|[
literal|0
index|]
operator|=
name|q
operator|->
name|uuconf_zname
expr_stmt|;
name|azmachine
index|[
literal|1
index|]
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzmachine
operator|=
name|azmachine
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_fsend_request
operator|>=
literal|0
condition|)
name|sperm
operator|.
name|frequest
operator|=
name|q
operator|->
name|uuconf_fsend_request
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzremote_send
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_pzremote_send
operator|!=
name|NULL
condition|)
name|sperm
operator|.
name|pzread
operator|=
name|q
operator|->
name|uuconf_pzremote_send
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzremote_receive
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_pzremote_receive
operator|!=
name|NULL
condition|)
name|sperm
operator|.
name|pzwrite
operator|=
name|q
operator|->
name|uuconf_pzremote_receive
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzcmds
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_pzcmds
operator|!=
name|NULL
condition|)
name|sperm
operator|.
name|pzcommands
operator|=
name|q
operator|->
name|uuconf_pzcmds
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_zlocalname
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_zlocalname
operator|!=
name|NULL
condition|)
name|sperm
operator|.
name|zmyname
operator|=
name|q
operator|->
name|uuconf_zlocalname
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_zpubdir
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_zpubdir
operator|!=
name|NULL
condition|)
name|sperm
operator|.
name|zpubdir
operator|=
name|q
operator|->
name|uuconf_zpubdir
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzalias
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_pzalias
operator|!=
name|NULL
condition|)
name|sperm
operator|.
name|pzalias
operator|=
name|q
operator|->
name|uuconf_pzalias
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_fcalled
operator|&&
name|q
operator|->
name|uuconf_zcalled_login
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_zcalled_login
operator|!=
name|NULL
condition|)
block|{
name|azlogname
index|[
literal|0
index|]
operator|=
name|q
operator|->
name|uuconf_zcalled_login
expr_stmt|;
name|azlogname
index|[
literal|1
index|]
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzlogname
operator|=
name|azlogname
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_fcalled_transfer
operator|>=
literal|0
condition|)
name|sperm
operator|.
name|fsendfiles
operator|=
name|q
operator|->
name|uuconf_fcalled_transfer
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_fcallback
operator|>=
literal|0
condition|)
name|sperm
operator|.
name|fcallback
operator|=
name|q
operator|->
name|uuconf_fcallback
expr_stmt|;
name|sperm
operator|.
name|pzvalidate
operator|=
name|azmachine
expr_stmt|;
block|}
name|uvadd_perm
argument_list|(
operator|&
name|sperm
argument_list|)
expr_stmt|;
block|}
comment|/* Now add a Permissions entry for each alternative that is not used      for calling out.  */
for|for
control|(
name|q
operator|=
name|qsys
init|;
name|q
operator|!=
name|NULL
condition|;
name|q
operator|=
name|q
operator|->
name|uuconf_qalternate
control|)
block|{
if|if
condition|(
operator|!
name|q
operator|->
name|uuconf_fcalled
operator|||
name|q
operator|->
name|uuconf_fcall
condition|)
continue|continue;
name|sperm
operator|.
name|qnext
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzlogname
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzmachine
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|frequest
operator|=
operator|-
literal|1
expr_stmt|;
name|sperm
operator|.
name|fsendfiles
operator|=
operator|-
literal|1
expr_stmt|;
name|sperm
operator|.
name|pzread
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzwrite
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|fcallback
operator|=
operator|-
literal|1
expr_stmt|;
name|sperm
operator|.
name|pzcommands
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzvalidate
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|zmyname
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|zpubdir
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzalias
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_zcalled_login
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_zcalled_login
operator|!=
name|NULL
condition|)
name|azlogname
index|[
literal|0
index|]
operator|=
name|q
operator|->
name|uuconf_zcalled_login
expr_stmt|;
else|else
name|azlogname
index|[
literal|0
index|]
operator|=
operator|(
name|char
operator|*
operator|)
literal|"OTHER"
expr_stmt|;
name|azlogname
index|[
literal|1
index|]
operator|=
name|NULL
expr_stmt|;
name|sperm
operator|.
name|pzlogname
operator|=
name|azlogname
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_fsend_request
operator|>=
literal|0
condition|)
name|sperm
operator|.
name|frequest
operator|=
name|q
operator|->
name|uuconf_fsend_request
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_fcalled_transfer
operator|>=
literal|0
condition|)
name|sperm
operator|.
name|fsendfiles
operator|=
name|q
operator|->
name|uuconf_fcalled_transfer
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzremote_send
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_pzremote_send
operator|!=
name|NULL
condition|)
name|sperm
operator|.
name|pzread
operator|=
name|q
operator|->
name|uuconf_pzremote_send
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzremote_receive
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_pzremote_receive
operator|!=
name|NULL
condition|)
name|sperm
operator|.
name|pzwrite
operator|=
name|q
operator|->
name|uuconf_pzremote_receive
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_fcallback
operator|>=
literal|0
condition|)
name|sperm
operator|.
name|fcallback
operator|=
name|q
operator|->
name|uuconf_fcallback
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_zlocalname
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_zlocalname
operator|!=
name|NULL
condition|)
name|sperm
operator|.
name|zmyname
operator|=
name|q
operator|->
name|uuconf_zlocalname
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_zpubdir
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|q
operator|->
name|uuconf_zpubdir
operator|!=
name|NULL
condition|)
name|sperm
operator|.
name|zpubdir
operator|=
name|q
operator|->
name|uuconf_zpubdir
expr_stmt|;
name|uvadd_perm
argument_list|(
operator|&
name|sperm
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Compare two strings from a Permissions entry, returning TRUE if    they are the same.  */
end_comment

begin_function
specifier|static
name|boolean
name|fvperm_string_cmp
parameter_list|(
name|z1
parameter_list|,
name|z2
parameter_list|)
specifier|const
name|char
modifier|*
name|z1
decl_stmt|;
specifier|const
name|char
modifier|*
name|z2
decl_stmt|;
block|{
if|if
condition|(
name|z1
operator|==
name|NULL
condition|)
return|return
name|z2
operator|==
name|NULL
return|;
if|if
condition|(
name|z2
operator|==
name|NULL
condition|)
return|return
name|FALSE
return|;
return|return
name|strcmp
argument_list|(
name|z1
argument_list|,
name|z2
argument_list|)
operator|==
literal|0
return|;
block|}
end_function

begin_comment
comment|/* Compare two arrays of strings from a Permissions entry, returning    TRUE if they are the same.  */
end_comment

begin_function
specifier|static
name|boolean
name|fvperm_array_cmp
parameter_list|(
name|pz1
parameter_list|,
name|pz2
parameter_list|)
specifier|const
name|char
modifier|*
modifier|*
name|pz1
decl_stmt|;
specifier|const
name|char
modifier|*
modifier|*
name|pz2
decl_stmt|;
block|{
if|if
condition|(
name|pz1
operator|==
name|NULL
condition|)
return|return
name|pz2
operator|==
name|NULL
return|;
if|if
condition|(
name|pz2
operator|==
name|NULL
condition|)
return|return
name|FALSE
return|;
for|for
control|(
init|;
operator|*
name|pz1
operator|!=
name|NULL
operator|&&
operator|*
name|pz2
operator|!=
name|NULL
condition|;
name|pz1
operator|++
operator|,
name|pz2
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
operator|*
name|pz1
argument_list|,
operator|*
name|pz2
argument_list|)
operator|!=
literal|0
condition|)
break|break;
return|return
operator|*
name|pz1
operator|==
name|NULL
operator|&&
operator|*
name|pz2
operator|==
name|NULL
return|;
block|}
end_function

begin_comment
comment|/* Add a Permissions entry to a global list, combining entries where    possible.  */
end_comment

begin_function
specifier|static
name|void
name|uvadd_perm
parameter_list|(
name|qadd
parameter_list|)
name|struct
name|shpermissions
modifier|*
name|qadd
decl_stmt|;
block|{
name|struct
name|shpermissions
modifier|*
name|qlook
decl_stmt|;
name|struct
name|shpermissions
modifier|*
name|qnew
decl_stmt|;
name|int
name|iret
decl_stmt|;
comment|/* If there's no information, don't bother to add this entry.  */
if|if
condition|(
name|qadd
operator|->
name|pzlogname
operator|==
name|NULL
operator|&&
name|qadd
operator|->
name|frequest
operator|<
literal|0
operator|&&
name|qadd
operator|->
name|fsendfiles
operator|<
literal|0
operator|&&
name|qadd
operator|->
name|pzread
operator|==
name|NULL
operator|&&
name|qadd
operator|->
name|pzwrite
operator|==
name|NULL
operator|&&
name|qadd
operator|->
name|fcallback
operator|<
literal|0
operator|&&
name|qadd
operator|->
name|pzcommands
operator|==
name|NULL
operator|&&
name|qadd
operator|->
name|pzvalidate
operator|==
name|NULL
operator|&&
name|qadd
operator|->
name|zmyname
operator|==
name|NULL
operator|&&
name|qadd
operator|->
name|zpubdir
operator|==
name|NULL
operator|&&
name|qadd
operator|->
name|pzalias
operator|==
name|NULL
condition|)
return|return;
for|for
control|(
name|qlook
operator|=
name|qVperms
init|;
name|qlook
operator|!=
name|NULL
condition|;
name|qlook
operator|=
name|qlook
operator|->
name|qnext
control|)
block|{
comment|/* See if we can merge qadd into qlook.  */
if|if
condition|(
name|qadd
operator|->
name|pzlogname
operator|==
name|NULL
condition|?
name|qlook
operator|->
name|pzlogname
operator|!=
name|NULL
else|:
name|qlook
operator|->
name|pzlogname
operator|==
name|NULL
condition|)
continue|continue;
if|if
condition|(
name|qadd
operator|->
name|pzmachine
operator|==
name|NULL
condition|?
name|qlook
operator|->
name|pzmachine
operator|!=
name|NULL
else|:
name|qlook
operator|->
name|pzmachine
operator|==
name|NULL
condition|)
continue|continue;
if|if
condition|(
name|qadd
operator|->
name|frequest
operator|!=
name|qlook
operator|->
name|frequest
operator|||
name|qadd
operator|->
name|fsendfiles
operator|!=
name|qlook
operator|->
name|fsendfiles
operator|||
name|qadd
operator|->
name|fcallback
operator|!=
name|qlook
operator|->
name|fcallback
condition|)
continue|continue;
if|if
condition|(
operator|!
name|fvperm_string_cmp
argument_list|(
name|qadd
operator|->
name|zmyname
argument_list|,
name|qlook
operator|->
name|zmyname
argument_list|)
operator|||
operator|!
name|fvperm_string_cmp
argument_list|(
name|qadd
operator|->
name|zpubdir
argument_list|,
name|qlook
operator|->
name|zpubdir
argument_list|)
condition|)
continue|continue;
if|if
condition|(
operator|!
name|fvperm_array_cmp
argument_list|(
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|qadd
operator|->
name|pzread
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|qlook
operator|->
name|pzread
argument_list|)
operator|||
operator|!
name|fvperm_array_cmp
argument_list|(
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|qadd
operator|->
name|pzwrite
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|qlook
operator|->
name|pzwrite
argument_list|)
operator|||
operator|!
name|fvperm_array_cmp
argument_list|(
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|qadd
operator|->
name|pzcommands
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|qlook
operator|->
name|pzcommands
argument_list|)
condition|)
continue|continue;
comment|/* Merge qadd into qlook.  */
if|if
condition|(
name|qadd
operator|->
name|pzmachine
operator|!=
name|NULL
condition|)
block|{
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|NULL
argument_list|,
name|qadd
operator|->
name|pzmachine
index|[
literal|0
index|]
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
operator|&
name|qlook
operator|->
name|pzmachine
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|uvuuconf_error
argument_list|(
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
name|iret
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|qadd
operator|->
name|pzlogname
operator|!=
name|NULL
condition|)
block|{
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|NULL
argument_list|,
name|qadd
operator|->
name|pzlogname
index|[
literal|0
index|]
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
operator|&
name|qlook
operator|->
name|pzlogname
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|uvuuconf_error
argument_list|(
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
name|iret
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|qadd
operator|->
name|pzalias
operator|!=
name|NULL
condition|)
block|{
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
for|for
control|(
name|pz
operator|=
name|qadd
operator|->
name|pzalias
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
block|{
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|NULL
argument_list|,
operator|*
name|pz
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
operator|&
name|qlook
operator|->
name|pzalias
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|uvuuconf_error
argument_list|(
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
name|iret
argument_list|)
expr_stmt|;
block|}
block|}
return|return;
block|}
comment|/* We must add qadd as a new entry on the list, which means we must      copy it into the heap.  */
name|qnew
operator|=
operator|(
expr|struct
name|shpermissions
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|shpermissions
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|qnew
operator|==
name|NULL
condition|)
name|uvuuconf_error
argument_list|(
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
name|UUCONF_MALLOC_FAILED
argument_list|)
expr_stmt|;
operator|*
name|qnew
operator|=
operator|*
name|qadd
expr_stmt|;
if|if
condition|(
name|qadd
operator|->
name|pzmachine
operator|!=
name|NULL
condition|)
block|{
name|qnew
operator|->
name|pzmachine
operator|=
name|NULL
expr_stmt|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|NULL
argument_list|,
name|qadd
operator|->
name|pzmachine
index|[
literal|0
index|]
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|qnew
operator|->
name|pzmachine
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|uvuuconf_error
argument_list|(
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
name|iret
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|qadd
operator|->
name|pzlogname
operator|!=
name|NULL
condition|)
block|{
name|qnew
operator|->
name|pzlogname
operator|=
name|NULL
expr_stmt|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|NULL
argument_list|,
name|qadd
operator|->
name|pzlogname
index|[
literal|0
index|]
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|qnew
operator|->
name|pzlogname
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|uvuuconf_error
argument_list|(
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
name|iret
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|qadd
operator|->
name|pzvalidate
operator|!=
name|NULL
condition|)
name|qnew
operator|->
name|pzvalidate
operator|=
name|qnew
operator|->
name|pzmachine
expr_stmt|;
name|qnew
operator|->
name|qnext
operator|=
name|qVperms
expr_stmt|;
name|qVperms
operator|=
name|qnew
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Write out the Permissions entries.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_perms
parameter_list|()
block|{
name|char
name|ab
index|[
sizeof|sizeof
name|ZCURDIR
operator|+
sizeof|sizeof
name|HDB_PERMISSIONS
operator|-
literal|1
index|]
decl_stmt|;
name|FILE
modifier|*
name|e
decl_stmt|;
name|struct
name|shpermissions
modifier|*
name|q
decl_stmt|;
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%s%s"
argument_list|,
name|ZCURDIR
argument_list|,
name|HDB_PERMISSIONS
argument_list|)
expr_stmt|;
name|e
operator|=
name|fopen
argument_list|(
name|ab
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|e
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"uuchk:%s: "
argument_list|,
name|ab
argument_list|)
expr_stmt|;
name|perror
argument_list|(
literal|"fopen"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"# Permissions file automatically generated by uuconv.\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|q
operator|=
name|qVperms
init|;
name|q
operator|!=
name|NULL
condition|;
name|q
operator|=
name|q
operator|->
name|qnext
control|)
block|{
name|size_t
name|ccol
decl_stmt|;
name|ccol
operator|=
literal|0
expr_stmt|;
name|uvwrite_perm_array
argument_list|(
name|e
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|q
operator|->
name|pzlogname
argument_list|,
literal|"LOGNAME"
argument_list|,
operator|&
name|ccol
argument_list|)
expr_stmt|;
name|uvwrite_perm_array
argument_list|(
name|e
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|q
operator|->
name|pzmachine
argument_list|,
literal|"MACHINE"
argument_list|,
operator|&
name|ccol
argument_list|)
expr_stmt|;
name|uvwrite_perm_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|frequest
argument_list|,
literal|"REQUEST"
argument_list|,
operator|&
name|ccol
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|uvwrite_perm_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|fsendfiles
argument_list|,
literal|"SENDFILES"
argument_list|,
operator|&
name|ccol
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|uvwrite_perm_rw_array
argument_list|(
name|e
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|q
operator|->
name|pzread
argument_list|,
literal|"READ"
argument_list|,
operator|&
name|ccol
argument_list|)
expr_stmt|;
name|uvwrite_perm_rw_array
argument_list|(
name|e
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|q
operator|->
name|pzwrite
argument_list|,
literal|"WRITE"
argument_list|,
operator|&
name|ccol
argument_list|)
expr_stmt|;
name|uvwrite_perm_boolean
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|fcallback
argument_list|,
literal|"CALLBACK"
argument_list|,
operator|&
name|ccol
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|uvwrite_perm_array
argument_list|(
name|e
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|q
operator|->
name|pzcommands
argument_list|,
literal|"COMMANDS"
argument_list|,
operator|&
name|ccol
argument_list|)
expr_stmt|;
name|uvwrite_perm_array
argument_list|(
name|e
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|q
operator|->
name|pzvalidate
argument_list|,
literal|"VALIDATE"
argument_list|,
operator|&
name|ccol
argument_list|)
expr_stmt|;
name|uvwrite_perm_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|zmyname
argument_list|,
literal|"MYNAME"
argument_list|,
operator|&
name|ccol
argument_list|)
expr_stmt|;
name|uvwrite_perm_string
argument_list|(
name|e
argument_list|,
name|q
operator|->
name|zpubdir
argument_list|,
literal|"PUBDIR"
argument_list|,
operator|&
name|ccol
argument_list|)
expr_stmt|;
name|uvwrite_perm_array
argument_list|(
name|e
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|q
operator|->
name|pzalias
argument_list|,
literal|"ALIAS"
argument_list|,
operator|&
name|ccol
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ferror
argument_list|(
name|e
argument_list|)
operator|||
name|fclose
argument_list|(
name|e
argument_list|)
operator|==
name|EOF
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"uuchk:%s: error during output\n"
argument_list|,
name|HDB_PERMISSIONS
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Write an array out to the Permissions file.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_perm_array
parameter_list|(
name|e
parameter_list|,
name|pzarg
parameter_list|,
name|zcmd
parameter_list|,
name|pccol
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
specifier|const
name|char
modifier|*
modifier|*
name|pzarg
decl_stmt|;
specifier|const
name|char
modifier|*
name|zcmd
decl_stmt|;
name|size_t
modifier|*
name|pccol
decl_stmt|;
block|{
name|size_t
name|c
decl_stmt|;
specifier|const
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
if|if
condition|(
name|pzarg
operator|==
name|NULL
condition|)
return|return;
name|c
operator|=
name|strlen
argument_list|(
name|zcmd
argument_list|)
operator|+
literal|1
expr_stmt|;
for|for
control|(
name|pz
operator|=
name|pzarg
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
name|c
operator|+=
name|strlen
argument_list|(
operator|*
name|pz
argument_list|)
operator|+
literal|1
expr_stmt|;
if|if
condition|(
operator|*
name|pccol
operator|>
literal|20
operator|&&
name|c
operator|+
operator|*
name|pccol
operator|>
literal|75
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" \\\n"
argument_list|)
expr_stmt|;
operator|*
name|pccol
operator|=
name|c
operator|-
literal|1
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|*
name|pccol
operator|!=
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
operator|*
name|pccol
operator|+=
name|c
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s="
argument_list|,
name|zcmd
argument_list|)
expr_stmt|;
for|for
control|(
name|pz
operator|=
name|pzarg
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
block|{
if|if
condition|(
name|pz
operator|!=
name|pzarg
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
operator|*
name|pz
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Write a boolean value out to the Permissions file.  This may be    either a yes/no boolean or a yes/call boolean (the latter is for    SENDFILES).  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_perm_boolean
parameter_list|(
name|e
parameter_list|,
name|f
parameter_list|,
name|zcmd
parameter_list|,
name|pccol
parameter_list|,
name|fsendfiles
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
name|int
name|f
decl_stmt|;
specifier|const
name|char
modifier|*
name|zcmd
decl_stmt|;
name|size_t
modifier|*
name|pccol
decl_stmt|;
name|boolean
name|fsendfiles
decl_stmt|;
block|{
specifier|const
name|char
modifier|*
name|az
index|[
literal|2
index|]
decl_stmt|;
if|if
condition|(
name|f
operator|<
literal|0
condition|)
return|return;
if|if
condition|(
name|f
condition|)
name|az
index|[
literal|0
index|]
operator|=
literal|"yes"
expr_stmt|;
else|else
name|az
index|[
literal|0
index|]
operator|=
name|fsendfiles
condition|?
literal|"call"
else|:
literal|"no"
expr_stmt|;
name|az
index|[
literal|1
index|]
operator|=
name|NULL
expr_stmt|;
name|uvwrite_perm_array
argument_list|(
name|e
argument_list|,
name|az
argument_list|,
name|zcmd
argument_list|,
name|pccol
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Write a set of READ or WRITE entries to the Permissions file.  We    have to separate out all entries that start with '!'.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_perm_rw_array
parameter_list|(
name|e
parameter_list|,
name|pzarg
parameter_list|,
name|zcmd
parameter_list|,
name|pccol
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
specifier|const
name|char
modifier|*
modifier|*
name|pzarg
decl_stmt|;
specifier|const
name|char
modifier|*
name|zcmd
decl_stmt|;
name|size_t
modifier|*
name|pccol
decl_stmt|;
block|{
name|size_t
name|c
decl_stmt|;
specifier|const
name|char
modifier|*
modifier|*
name|pz
decl_stmt|,
modifier|*
modifier|*
name|pzcopy
decl_stmt|,
modifier|*
modifier|*
name|pzset
decl_stmt|;
if|if
condition|(
name|pzarg
operator|==
name|NULL
condition|)
return|return;
name|c
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|pz
operator|=
name|pzarg
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
name|c
operator|++
expr_stmt|;
name|pzcopy
operator|=
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|malloc
argument_list|(
operator|(
name|c
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|pzcopy
operator|==
name|NULL
condition|)
name|uvuuconf_error
argument_list|(
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
name|UUCONF_MALLOC_FAILED
argument_list|)
expr_stmt|;
name|pzset
operator|=
name|pzcopy
expr_stmt|;
for|for
control|(
name|pz
operator|=
name|pzarg
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
if|if
condition|(
operator|(
operator|*
name|pz
operator|)
index|[
literal|0
index|]
operator|!=
literal|'!'
condition|)
operator|*
name|pzset
operator|++
operator|=
operator|*
name|pz
expr_stmt|;
operator|*
name|pzset
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|pzset
operator|!=
name|pzcopy
condition|)
name|uvwrite_perm_array
argument_list|(
name|e
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|pzcopy
argument_list|,
name|zcmd
argument_list|,
name|pccol
argument_list|)
expr_stmt|;
name|pzset
operator|=
name|pzcopy
expr_stmt|;
for|for
control|(
name|pz
operator|=
name|pzarg
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
if|if
condition|(
operator|(
operator|*
name|pz
operator|)
index|[
literal|0
index|]
operator|==
literal|'!'
condition|)
operator|*
name|pzset
operator|++
operator|=
operator|*
name|pz
expr_stmt|;
operator|*
name|pzset
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|pzset
operator|!=
name|pzcopy
condition|)
block|{
name|char
name|ab
index|[
literal|20
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"NO%s"
argument_list|,
name|zcmd
argument_list|)
expr_stmt|;
name|uvwrite_perm_array
argument_list|(
name|e
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|pzcopy
argument_list|,
name|ab
argument_list|,
name|pccol
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Write a string out to the Permissions file.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_perm_string
parameter_list|(
name|e
parameter_list|,
name|z
parameter_list|,
name|zcmd
parameter_list|,
name|pccol
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
specifier|const
name|char
modifier|*
name|z
decl_stmt|;
specifier|const
name|char
modifier|*
name|zcmd
decl_stmt|;
name|size_t
modifier|*
name|pccol
decl_stmt|;
block|{
specifier|const
name|char
modifier|*
name|az
index|[
literal|2
index|]
decl_stmt|;
if|if
condition|(
name|z
operator|==
name|NULL
condition|)
return|return;
name|az
index|[
literal|0
index|]
operator|=
name|z
expr_stmt|;
name|az
index|[
literal|1
index|]
operator|=
name|NULL
expr_stmt|;
name|uvwrite_perm_array
argument_list|(
name|e
argument_list|,
name|az
argument_list|,
name|zcmd
argument_list|,
name|pccol
argument_list|)
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Write out a Taylor UUCP port.  This is called via uuconf_find_port;    the pinfo argument is the port file.  */
end_comment

begin_function
specifier|static
name|int
name|ivwrite_taylor_port
parameter_list|(
name|qport
parameter_list|,
name|pinfo
parameter_list|)
name|struct
name|uuconf_port
modifier|*
name|qport
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|FILE
modifier|*
name|e
init|=
operator|(
name|FILE
operator|*
operator|)
name|pinfo
decl_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"port %s\n"
argument_list|,
name|qport
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
name|uvwrite_taylor_port
argument_list|(
name|e
argument_list|,
name|qport
argument_list|,
literal|""
argument_list|)
expr_stmt|;
comment|/* Return UUCONF_NOT_FOUND to force uuconf_find_port to keep looking      for ports.  */
return|return
name|UUCONF_NOT_FOUND
return|;
block|}
end_function

begin_comment
comment|/* Write a port out to a Taylor UUCP configuration file.  This doesn't    output the name, since it is called to output a specially defined    port in the sys file.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_taylor_port
parameter_list|(
name|e
parameter_list|,
name|qport
parameter_list|,
name|zprefix
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
name|struct
name|uuconf_port
modifier|*
name|qport
decl_stmt|;
specifier|const
name|char
modifier|*
name|zprefix
decl_stmt|;
block|{
specifier|const
name|char
modifier|*
name|ztype
decl_stmt|;
name|char
name|ab
index|[
literal|100
index|]
decl_stmt|;
switch|switch
condition|(
name|qport
operator|->
name|uuconf_ttype
condition|)
block|{
default|default:
case|case
name|UUCONF_PORTTYPE_UNKNOWN
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"uuconv: Bad port type\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
break|break;
case|case
name|UUCONF_PORTTYPE_STDIN
case|:
name|ztype
operator|=
literal|"stdin"
expr_stmt|;
break|break;
case|case
name|UUCONF_PORTTYPE_MODEM
case|:
name|ztype
operator|=
literal|"modem"
expr_stmt|;
break|break;
case|case
name|UUCONF_PORTTYPE_DIRECT
case|:
name|ztype
operator|=
literal|"direct"
expr_stmt|;
break|break;
case|case
name|UUCONF_PORTTYPE_TCP
case|:
name|ztype
operator|=
literal|"tcp"
expr_stmt|;
break|break;
case|case
name|UUCONF_PORTTYPE_TLI
case|:
name|ztype
operator|=
literal|"tli"
expr_stmt|;
break|break;
case|case
name|UUCONF_PORTTYPE_PIPE
case|:
name|ztype
operator|=
literal|"pipe"
expr_stmt|;
break|break;
block|}
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%stype %s\n"
argument_list|,
name|zprefix
argument_list|,
name|ztype
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_zprotocols
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sprotocol %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qport
operator|->
name|uuconf_zprotocols
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_qproto_params
operator|!=
name|NULL
condition|)
name|uvwrite_proto_params
argument_list|(
name|e
argument_list|,
name|qport
operator|->
name|uuconf_qproto_params
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|qport
operator|->
name|uuconf_ireliable
operator|&
name|UUCONF_RELIABLE_SPECIFIED
operator|)
operator|!=
literal|0
condition|)
block|{
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%sseven-bit"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
operator|(
operator|(
name|qport
operator|->
name|uuconf_ireliable
operator|&
name|UUCONF_RELIABLE_EIGHT
operator|)
operator|==
literal|0
operator|)
argument_list|,
name|ab
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%sreliable"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
operator|(
operator|(
name|qport
operator|->
name|uuconf_ireliable
operator|&
name|UUCONF_RELIABLE_RELIABLE
operator|)
operator|!=
literal|0
operator|)
argument_list|,
name|ab
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%shalf-duplex"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
operator|(
operator|(
name|qport
operator|->
name|uuconf_ireliable
operator|&
name|UUCONF_RELIABLE_FULLDUPLEX
operator|)
operator|==
literal|0
operator|)
argument_list|,
name|ab
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|qport
operator|->
name|uuconf_zlockname
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%slockname %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qport
operator|->
name|uuconf_zlockname
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|qport
operator|->
name|uuconf_ttype
condition|)
block|{
default|default:
break|break;
case|case
name|UUCONF_PORTTYPE_MODEM
case|:
block|{
name|struct
name|uuconf_modem_port
modifier|*
name|qm
decl_stmt|;
name|qm
operator|=
operator|&
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
expr_stmt|;
if|if
condition|(
name|qm
operator|->
name|uuconf_zdevice
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sdevice %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qm
operator|->
name|uuconf_zdevice
argument_list|)
expr_stmt|;
if|if
condition|(
name|qm
operator|->
name|uuconf_zdial_device
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sdial-device %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qm
operator|->
name|uuconf_zdial_device
argument_list|)
expr_stmt|;
if|if
condition|(
name|qm
operator|->
name|uuconf_ibaud
operator|!=
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sbaud %ld\n"
argument_list|,
name|zprefix
argument_list|,
name|qm
operator|->
name|uuconf_ibaud
argument_list|)
expr_stmt|;
if|if
condition|(
name|qm
operator|->
name|uuconf_ilowbaud
operator|!=
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sbaud-range %ld %ld\n"
argument_list|,
name|zprefix
argument_list|,
name|qm
operator|->
name|uuconf_ilowbaud
argument_list|,
name|qm
operator|->
name|uuconf_ihighbaud
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|qm
operator|->
name|uuconf_fcarrier
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%scarrier false\n"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|qm
operator|->
name|uuconf_fhardflow
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%shardflow false\n"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
if|if
condition|(
name|qm
operator|->
name|uuconf_pzdialer
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|qm
operator|->
name|uuconf_pzdialer
index|[
literal|1
index|]
operator|==
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sdialer %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qm
operator|->
name|uuconf_pzdialer
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
else|else
block|{
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%sdialer-sequence"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|qm
operator|->
name|uuconf_pzdialer
argument_list|,
name|ab
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|qm
operator|->
name|uuconf_qdialer
operator|!=
name|NULL
condition|)
block|{
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%sdialer "
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_taylor_dialer
argument_list|(
name|e
argument_list|,
name|qm
operator|->
name|uuconf_qdialer
argument_list|,
name|ab
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|UUCONF_PORTTYPE_DIRECT
case|:
block|{
name|struct
name|uuconf_direct_port
modifier|*
name|qd
decl_stmt|;
name|qd
operator|=
operator|&
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_sdirect
expr_stmt|;
if|if
condition|(
name|qd
operator|->
name|uuconf_zdevice
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sdevice %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qd
operator|->
name|uuconf_zdevice
argument_list|)
expr_stmt|;
if|if
condition|(
name|qd
operator|->
name|uuconf_ibaud
operator|!=
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sbaud %ld\n"
argument_list|,
name|zprefix
argument_list|,
name|qd
operator|->
name|uuconf_ibaud
argument_list|)
expr_stmt|;
if|if
condition|(
name|qd
operator|->
name|uuconf_fcarrier
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%scarrier true\n"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|qd
operator|->
name|uuconf_fhardflow
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%shardflow false\n"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|UUCONF_PORTTYPE_TCP
case|:
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_stcp
operator|.
name|uuconf_zport
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sservice %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_stcp
operator|.
name|uuconf_zport
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_stcp
operator|.
name|uuconf_pzdialer
operator|!=
name|NULL
condition|)
block|{
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%sdialer-sequence"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_stcp
operator|.
name|uuconf_pzdialer
argument_list|,
name|ab
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|UUCONF_PORTTYPE_TLI
case|:
block|{
name|struct
name|uuconf_tli_port
modifier|*
name|qt
decl_stmt|;
name|qt
operator|=
operator|&
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_stli
expr_stmt|;
if|if
condition|(
name|qt
operator|->
name|uuconf_zdevice
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sdevice %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qt
operator|->
name|uuconf_zdevice
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%sstream"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
name|qt
operator|->
name|uuconf_fstream
argument_list|,
name|ab
argument_list|)
expr_stmt|;
if|if
condition|(
name|qt
operator|->
name|uuconf_pzpush
operator|!=
name|NULL
condition|)
block|{
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%spush"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|qt
operator|->
name|uuconf_pzpush
argument_list|,
name|ab
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|qt
operator|->
name|uuconf_pzdialer
operator|!=
name|NULL
condition|)
block|{
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%sdialer-sequence"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|qt
operator|->
name|uuconf_pzdialer
argument_list|,
name|ab
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|qt
operator|->
name|uuconf_zservaddr
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sserver-address %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qt
operator|->
name|uuconf_zservaddr
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|UUCONF_PORTTYPE_PIPE
case|:
block|{
name|struct
name|uuconf_pipe_port
modifier|*
name|qp
decl_stmt|;
name|qp
operator|=
operator|&
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_spipe
expr_stmt|;
if|if
condition|(
name|qp
operator|->
name|uuconf_pzcmd
operator|!=
name|NULL
condition|)
block|{
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%scommad"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_string_array
argument_list|(
name|e
argument_list|,
name|qp
operator|->
name|uuconf_pzcmd
argument_list|,
name|ab
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Write out a port to the V2 L-devices file.  This is called via    uuconf_find_port.  */
end_comment

begin_function
specifier|static
name|int
name|ivwrite_v2_port
parameter_list|(
name|qport
parameter_list|,
name|pinfo
parameter_list|)
name|struct
name|uuconf_port
modifier|*
name|qport
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|FILE
modifier|*
name|e
init|=
operator|(
name|FILE
operator|*
operator|)
name|pinfo
decl_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_ttype
operator|==
name|UUCONF_PORTTYPE_DIRECT
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"DIR %s - %ld direct"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_sdirect
operator|.
name|uuconf_zdevice
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_sdirect
operator|.
name|uuconf_ibaud
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|qport
operator|->
name|uuconf_ttype
operator|==
name|UUCONF_PORTTYPE_MODEM
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s %s "
argument_list|,
name|qport
operator|->
name|uuconf_zname
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_zdevice
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_zdial_device
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_zdial_device
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"-"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_ilowbaud
operator|!=
literal|0L
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%ld-%ld"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_ilowbaud
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_ihighbaud
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_ibaud
operator|!=
literal|0L
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%ld"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_ibaud
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"Any"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_pzdialer
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %s"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_pzdialer
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"# Ignoring port %s with unsupported type"
argument_list|,
name|qport
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* Return UUCONF_NOT_FOUND to force uuconf_find_port to keep looking      for a port.  */
return|return
name|UUCONF_NOT_FOUND
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Write out a port to the HDB Devices file.  This is called via    uuconf_find_port.  */
end_comment

begin_function
specifier|static
name|int
name|ivwrite_hdb_port
parameter_list|(
name|qport
parameter_list|,
name|pinfo
parameter_list|)
name|struct
name|uuconf_port
modifier|*
name|qport
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|FILE
modifier|*
name|e
init|=
operator|(
name|FILE
operator|*
operator|)
name|pinfo
decl_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_ttype
operator|==
name|UUCONF_PORTTYPE_DIRECT
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"Direct"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_zprotocols
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|",%s"
argument_list|,
name|qport
operator|->
name|uuconf_zprotocols
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_sdirect
operator|.
name|uuconf_zdevice
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_sdirect
operator|.
name|uuconf_zdevice
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|qport
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" - %ld"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_sdirect
operator|.
name|uuconf_ibaud
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|qport
operator|->
name|uuconf_ttype
operator|==
name|UUCONF_PORTTYPE_MODEM
condition|)
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|qport
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_zprotocols
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|",%s"
argument_list|,
name|qport
operator|->
name|uuconf_zprotocols
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_zdevice
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_zdevice
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|qport
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_zdial_device
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_zdial_device
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"-"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_ilowbaud
operator|!=
literal|0L
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%ld-%ld"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_ilowbaud
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_ihighbaud
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_ibaud
operator|!=
literal|0L
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%ld"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_ibaud
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"Any"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_pzdialer
operator|!=
name|NULL
condition|)
block|{
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
for|for
control|(
name|pz
operator|=
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_pzdialer
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %s"
argument_list|,
operator|*
name|pz
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|qport
operator|->
name|uuconf_ttype
operator|==
name|UUCONF_PORTTYPE_TCP
condition|)
block|{
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"TCP"
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_zprotocols
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|",%s"
argument_list|,
name|qport
operator|->
name|uuconf_zprotocols
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_stcp
operator|.
name|uuconf_zport
operator|==
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"uucp"
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_stcp
operator|.
name|uuconf_zport
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" - -"
argument_list|)
expr_stmt|;
name|pz
operator|=
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_stcp
operator|.
name|uuconf_pzdialer
expr_stmt|;
if|if
condition|(
name|pz
operator|!=
name|NULL
condition|)
for|for
control|(
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %s"
argument_list|,
operator|*
name|pz
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|qport
operator|->
name|uuconf_ttype
operator|==
name|UUCONF_PORTTYPE_TLI
condition|)
block|{
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|qport
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_zprotocols
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|",%s"
argument_list|,
name|qport
operator|->
name|uuconf_zprotocols
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_stli
operator|.
name|uuconf_zdevice
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_smodem
operator|.
name|uuconf_zdevice
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"-"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" - -"
argument_list|)
expr_stmt|;
name|pz
operator|=
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_stli
operator|.
name|uuconf_pzdialer
expr_stmt|;
if|if
condition|(
name|pz
operator|==
name|NULL
operator|||
operator|*
name|pz
operator|==
name|NULL
operator|||
operator|(
name|strcmp
argument_list|(
operator|*
name|pz
argument_list|,
literal|"TLI"
argument_list|)
operator|!=
literal|0
operator|&&
name|strcmp
argument_list|(
operator|*
name|pz
argument_list|,
literal|"TLIS"
argument_list|)
operator|!=
literal|0
operator|)
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" TLI%s \\D"
argument_list|,
name|qport
operator|->
name|uuconf_u
operator|.
name|uuconf_stli
operator|.
name|uuconf_fstream
condition|?
literal|"S"
else|:
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|pz
operator|!=
name|NULL
condition|)
for|for
control|(
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" %s"
argument_list|,
operator|*
name|pz
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"# Ignoring port %s with unsupported type"
argument_list|,
name|qport
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* Return UUCONF_NOT_FOUND to force uuconf_find_port to keep looking      for a port.  */
return|return
name|UUCONF_NOT_FOUND
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Write a dialer out to a Taylor UUCP configuration file.  This    doesn't output the name, since it is called to output a specially    defined dialer in the sys or port file.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_taylor_dialer
parameter_list|(
name|e
parameter_list|,
name|qdialer
parameter_list|,
name|zprefix
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
name|struct
name|uuconf_dialer
modifier|*
name|qdialer
decl_stmt|;
specifier|const
name|char
modifier|*
name|zprefix
decl_stmt|;
block|{
name|char
name|ab
index|[
literal|100
index|]
decl_stmt|;
comment|/* Reset default values, so we don't output them unnecessarily.  */
if|if
condition|(
name|qdialer
operator|->
name|uuconf_schat
operator|.
name|uuconf_ctimeout
operator|==
literal|60
condition|)
name|qdialer
operator|->
name|uuconf_schat
operator|.
name|uuconf_ctimeout
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_schat
operator|.
name|uuconf_fstrip
condition|)
name|qdialer
operator|->
name|uuconf_schat
operator|.
name|uuconf_fstrip
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_scomplete
operator|.
name|uuconf_ctimeout
operator|==
literal|60
condition|)
name|qdialer
operator|->
name|uuconf_scomplete
operator|.
name|uuconf_ctimeout
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_scomplete
operator|.
name|uuconf_fstrip
condition|)
name|qdialer
operator|->
name|uuconf_scomplete
operator|.
name|uuconf_fstrip
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_sabort
operator|.
name|uuconf_ctimeout
operator|==
literal|60
condition|)
name|qdialer
operator|->
name|uuconf_sabort
operator|.
name|uuconf_ctimeout
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_sabort
operator|.
name|uuconf_fstrip
condition|)
name|qdialer
operator|->
name|uuconf_sabort
operator|.
name|uuconf_fstrip
operator|=
operator|-
literal|1
expr_stmt|;
name|uvwrite_chat
argument_list|(
name|e
argument_list|,
operator|&
name|qdialer
operator|->
name|uuconf_schat
argument_list|,
operator|(
expr|struct
name|uuconf_chat
operator|*
operator|)
name|NULL
argument_list|,
name|zprefix
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_zdialtone
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
name|qdialer
operator|->
name|uuconf_zdialtone
argument_list|,
literal|","
argument_list|)
operator|!=
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sdialtone %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qdialer
operator|->
name|uuconf_zdialtone
argument_list|)
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_zpause
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
name|qdialer
operator|->
name|uuconf_zpause
argument_list|,
literal|","
argument_list|)
operator|!=
literal|0
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%spause %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qdialer
operator|->
name|uuconf_zpause
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|qdialer
operator|->
name|uuconf_fcarrier
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%scarrier false\n"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_ccarrier_wait
operator|!=
literal|60
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%scarrier-wait %d\n"
argument_list|,
name|zprefix
argument_list|,
name|qdialer
operator|->
name|uuconf_ccarrier_wait
argument_list|)
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_fdtr_toggle
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%sdtr-toggle %s %s\n"
argument_list|,
name|zprefix
argument_list|,
name|qdialer
operator|->
name|uuconf_fdtr_toggle
condition|?
literal|"true"
else|:
literal|"false"
argument_list|,
name|qdialer
operator|->
name|uuconf_fdtr_toggle_wait
condition|?
literal|"true"
else|:
literal|"false"
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%scomplete-"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_chat
argument_list|(
name|e
argument_list|,
operator|&
name|qdialer
operator|->
name|uuconf_scomplete
argument_list|,
operator|(
expr|struct
name|uuconf_chat
operator|*
operator|)
name|NULL
argument_list|,
name|ab
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%sabort-"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_chat
argument_list|(
name|e
argument_list|,
operator|&
name|qdialer
operator|->
name|uuconf_sabort
argument_list|,
operator|(
expr|struct
name|uuconf_chat
operator|*
operator|)
name|NULL
argument_list|,
name|ab
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_qproto_params
operator|!=
name|NULL
condition|)
name|uvwrite_proto_params
argument_list|(
name|e
argument_list|,
name|qdialer
operator|->
name|uuconf_qproto_params
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|qdialer
operator|->
name|uuconf_ireliable
operator|&
name|UUCONF_RELIABLE_SPECIFIED
operator|)
operator|!=
literal|0
condition|)
block|{
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%sseven-bit"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
operator|(
operator|(
name|qdialer
operator|->
name|uuconf_ireliable
operator|&
name|UUCONF_RELIABLE_EIGHT
operator|)
operator|==
literal|0
operator|)
argument_list|,
name|ab
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%sreliable"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
operator|(
operator|(
name|qdialer
operator|->
name|uuconf_ireliable
operator|&
name|UUCONF_RELIABLE_RELIABLE
operator|)
operator|!=
literal|0
operator|)
argument_list|,
name|ab
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|ab
argument_list|,
literal|"%shalf-duplex"
argument_list|,
name|zprefix
argument_list|)
expr_stmt|;
name|uvwrite_boolean
argument_list|(
name|e
argument_list|,
operator|(
operator|(
name|qdialer
operator|->
name|uuconf_ireliable
operator|&
name|UUCONF_RELIABLE_FULLDUPLEX
operator|)
operator|==
literal|0
operator|)
argument_list|,
name|ab
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Write a dialer out to an HDB configuration file.  */
end_comment

begin_function
specifier|static
name|void
name|uvwrite_hdb_dialer
parameter_list|(
name|e
parameter_list|,
name|qdialer
parameter_list|)
name|FILE
modifier|*
name|e
decl_stmt|;
name|struct
name|uuconf_dialer
modifier|*
name|qdialer
decl_stmt|;
block|{
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"%s "
argument_list|,
name|qdialer
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_zdialtone
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"=%c"
argument_list|,
name|qdialer
operator|->
name|uuconf_zdialtone
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_zpause
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"-%c"
argument_list|,
name|qdialer
operator|->
name|uuconf_zpause
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|qdialer
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|qdialer
operator|->
name|uuconf_zdialtone
operator|==
name|NULL
operator|&&
name|qdialer
operator|->
name|uuconf_zpause
operator|==
name|NULL
condition|)
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\"\""
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|e
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|uvwrite_chat_script
argument_list|(
name|e
argument_list|,
name|qdialer
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|e
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Display a uuconf error and exit.  */
end_comment

begin_function
specifier|static
name|void
name|uvuuconf_error
parameter_list|(
name|puuconf
parameter_list|,
name|iret
parameter_list|)
name|pointer
name|puuconf
decl_stmt|;
name|int
name|iret
decl_stmt|;
block|{
name|char
name|ab
index|[
literal|512
index|]
decl_stmt|;
operator|(
name|void
operator|)
name|uuconf_error_string
argument_list|(
name|puuconf
argument_list|,
name|iret
argument_list|,
name|ab
argument_list|,
sizeof|sizeof
name|ab
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|iret
operator|&
name|UUCONF_ERROR_FILENAME
operator|)
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"uuconv: %s\n"
argument_list|,
name|ab
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"uuconv:%s\n"
argument_list|,
name|ab
argument_list|)
expr_stmt|;
if|if
condition|(
name|UUCONF_ERROR_VALUE
argument_list|(
name|iret
argument_list|)
operator|!=
name|UUCONF_FOPEN_FAILED
condition|)
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

