begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* syssub.c    System information subroutines.     Copyright (C) 1992, 1993, 1995 Ian Lance Taylor     This file is part of the Taylor UUCP uuconf library.     This library is free software; you can redistribute it and/or    modify it under the terms of the GNU Library General Public License    as published by the Free Software Foundation; either version 2 of    the License, or (at your option) any later version.     This library is distributed in the hope that it will be useful, but    WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    Library General Public License for more details.     You should have received a copy of the GNU Library General Public    License along with this library; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.     The author of the program may be contacted at ian@airs.com or    c/o Cygnus Support, 48 Grove Street, Somerville, MA 02144.    */
end_comment

begin_include
include|#
directive|include
file|"uucnfi.h"
end_include

begin_if
if|#
directive|if
name|USE_RCS_ID
end_if

begin_decl_stmt
specifier|const
name|char
name|_uuconf_syssub_rcsid
index|[]
init|=
literal|"$Id: syssub.c,v 1.4 1995/08/19 21:28:10 ache Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_escape
end_escape

begin_comment
comment|/* This macro operates on every string (char *) field in struct    uuconf_system.  */
end_comment

begin_define
define|#
directive|define
name|SYSTEM_STRINGS
parameter_list|(
name|OP
parameter_list|)
define|\
value|do \     { \       OP (uuconf_zname); \       OP (uuconf_zalternate); \       OP (uuconf_zdebug); \       OP (uuconf_zmax_remote_debug); \       OP (uuconf_zphone); \       OP (uuconf_zcall_login); \       OP (uuconf_zcall_password); \       OP (uuconf_zcalled_login); \       OP (uuconf_zprotocols); \       OP (uuconf_zpubdir); \       OP (uuconf_zlocalname); \     } \   while (0)
end_define

begin_comment
comment|/* This macro operates on every string array (char **) field in struct    uuconf_system.  */
end_comment

begin_define
define|#
directive|define
name|SYSTEM_STRING_ARRAYS
parameter_list|(
name|OP
parameter_list|)
define|\
value|do \     { \       OP (uuconf_pzalias); \       OP (uuconf_pzlocal_send); \       OP (uuconf_pzremote_send); \       OP (uuconf_pzlocal_receive); \       OP (uuconf_pzremote_receive); \       OP (uuconf_pzpath); \       OP (uuconf_pzcmds); \       OP (uuconf_pzforward_from); \       OP (uuconf_pzforward_to); \       OP (uuconf_schat.uuconf_pzchat); \       OP (uuconf_schat.uuconf_pzprogram); \       OP (uuconf_schat.uuconf_pzfail); \       OP (uuconf_scalled_chat.uuconf_pzchat); \       OP (uuconf_scalled_chat.uuconf_pzprogram); \       OP (uuconf_scalled_chat.uuconf_pzfail); \     } \   while (0)
end_define

begin_comment
comment|/* This macro operations on every timespan pointer (struct    uuconf_timespan *) in struct uuconf_system.  */
end_comment

begin_define
define|#
directive|define
name|SYSTEM_TIMESPANS
parameter_list|(
name|OP
parameter_list|)
define|\
value|do \     { \       OP (uuconf_qtimegrade); \       OP (uuconf_qcalltimegrade); \       OP (uuconf_qcalledtimegrade); \       OP (uuconf_qcall_local_size); \       OP (uuconf_qcall_remote_size); \       OP (uuconf_qcalled_local_size); \       OP (uuconf_qcalled_remote_size); \     } \   while (0)
end_define

begin_comment
comment|/* This macro operates on every boolean value (of type int, although    some type int are not boolean) field in uuconf_system.  */
end_comment

begin_define
define|#
directive|define
name|SYSTEM_BOOLEANS
parameter_list|(
name|OP
parameter_list|)
define|\
value|do \     { \       OP (uuconf_fcall); \       OP (uuconf_fcalled); \       OP (uuconf_fcallback); \       OP (uuconf_fsequence); \       OP (uuconf_fsend_request); \       OP (uuconf_frec_request); \       OP (uuconf_fcall_transfer); \       OP (uuconf_fcalled_transfer); \       OP (uuconf_schat.uuconf_fstrip); \       OP (uuconf_scalled_chat.uuconf_fstrip); \     } \   while (0)
end_define

begin_comment
comment|/* This macro operates on every generic integer (type int or long) in    uuconf_system.  */
end_comment

begin_define
define|#
directive|define
name|SYSTEM_INTEGERS
parameter_list|(
name|OP
parameter_list|)
define|\
value|do \     { \       OP (uuconf_cmax_retries); \       OP (uuconf_csuccess_wait); \       OP (uuconf_ibaud); \       OP (uuconf_ihighbaud); \       OP (uuconf_cfree_space); \       OP (uuconf_schat.uuconf_ctimeout); \       OP (uuconf_scalled_chat.uuconf_ctimeout); \     } \   while (0)
end_define

begin_comment
comment|/* There is no macro for uuconf_qalternate, uuconf_zport,    uuconf_qport, uuconf_qproto_params, or uuconf_palloc.  */
end_comment

begin_escape
end_escape

begin_comment
comment|/* Clear the contents of a struct uuconf_system.  */
end_comment

begin_function
name|void
name|_uuconf_uclear_system
parameter_list|(
name|q
parameter_list|)
name|struct
name|uuconf_system
modifier|*
name|q
decl_stmt|;
block|{
define|#
directive|define
name|CLEAR
parameter_list|(
name|x
parameter_list|)
value|q->x = (char *)&_uuconf_unset
name|SYSTEM_STRINGS
argument_list|(
name|CLEAR
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|CLEAR
define|#
directive|define
name|CLEAR
parameter_list|(
name|x
parameter_list|)
value|q->x = (char **)&_uuconf_unset
name|SYSTEM_STRING_ARRAYS
argument_list|(
name|CLEAR
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|CLEAR
define|#
directive|define
name|CLEAR
parameter_list|(
name|x
parameter_list|)
value|q->x = (struct uuconf_timespan *)&_uuconf_unset
name|SYSTEM_TIMESPANS
argument_list|(
name|CLEAR
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|CLEAR
define|#
directive|define
name|CLEAR
parameter_list|(
name|x
parameter_list|)
value|q->x = -1
name|SYSTEM_BOOLEANS
argument_list|(
name|CLEAR
argument_list|)
expr_stmt|;
name|SYSTEM_INTEGERS
argument_list|(
name|CLEAR
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|CLEAR
name|q
operator|->
name|uuconf_qalternate
operator|=
name|NULL
expr_stmt|;
name|q
operator|->
name|uuconf_zport
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
expr_stmt|;
name|q
operator|->
name|uuconf_qport
operator|=
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
expr_stmt|;
name|q
operator|->
name|uuconf_qproto_params
operator|=
operator|(
expr|struct
name|uuconf_proto_param
operator|*
operator|)
operator|&
name|_uuconf_unset
expr_stmt|;
name|q
operator|->
name|uuconf_palloc
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Default the contents of one struct uuconf_system to the contents of    another.  This default alternate by alternate.  Any additional    alternates in q default to the last alternate of qdefault.  If the    faddalternates arguments is TRUE, additional alternates or qdefault    are added to q; these alternates are copies of the first alternate    of q, and defaults are set from the additional alternates of    qdefault.  */
end_comment

begin_function
name|int
name|_uuconf_isystem_default
parameter_list|(
name|qglobal
parameter_list|,
name|qset
parameter_list|,
name|qdefault
parameter_list|,
name|faddalternates
parameter_list|)
name|struct
name|sglobal
modifier|*
name|qglobal
decl_stmt|;
name|struct
name|uuconf_system
modifier|*
name|qset
decl_stmt|;
name|struct
name|uuconf_system
modifier|*
name|qdefault
decl_stmt|;
name|boolean
name|faddalternates
decl_stmt|;
block|{
name|struct
name|uuconf_system
modifier|*
name|qalt
decl_stmt|;
if|if
condition|(
name|qset
operator|->
name|uuconf_palloc
operator|!=
name|qdefault
operator|->
name|uuconf_palloc
condition|)
name|qset
operator|->
name|uuconf_palloc
operator|=
name|_uuconf_pmalloc_block_merge
argument_list|(
name|qset
operator|->
name|uuconf_palloc
argument_list|,
name|qdefault
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
comment|/* If we are adding alternates from the default, make sure we have      at least as many alternates in qset as we do in qdefault.  Each      new alternate we create gets initialized to the first alternate      of the system.  */
if|if
condition|(
name|faddalternates
condition|)
block|{
name|struct
name|uuconf_system
modifier|*
modifier|*
name|pq
decl_stmt|,
modifier|*
name|qdef
decl_stmt|;
for|for
control|(
name|qdef
operator|=
name|qdefault
operator|,
name|pq
operator|=
operator|&
name|qset
init|;
name|qdef
operator|!=
name|NULL
condition|;
name|qdef
operator|=
name|qdef
operator|->
name|uuconf_qalternate
operator|,
name|pq
operator|=
operator|&
operator|(
operator|*
name|pq
operator|)
operator|->
name|uuconf_qalternate
control|)
block|{
if|if
condition|(
operator|*
name|pq
operator|==
name|NULL
condition|)
block|{
operator|*
name|pq
operator|=
operator|(
operator|(
expr|struct
name|uuconf_system
operator|*
operator|)
name|uuconf_malloc
argument_list|(
name|qset
operator|->
name|uuconf_palloc
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|uuconf_system
argument_list|)
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|pq
operator|==
name|NULL
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
return|return
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
return|;
block|}
operator|*
operator|*
name|pq
operator|=
operator|*
name|qset
expr_stmt|;
operator|(
operator|*
name|pq
operator|)
operator|->
name|uuconf_qalternate
operator|=
name|NULL
expr_stmt|;
block|}
block|}
block|}
for|for
control|(
name|qalt
operator|=
name|qset
init|;
name|qalt
operator|!=
name|NULL
condition|;
name|qalt
operator|=
name|qalt
operator|->
name|uuconf_qalternate
control|)
block|{
define|#
directive|define
name|DEFAULT
parameter_list|(
name|x
parameter_list|)
define|\
value|if (qalt->x == (char *)&_uuconf_unset) qalt->x = qdefault->x
name|SYSTEM_STRINGS
argument_list|(
name|DEFAULT
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|DEFAULT
define|#
directive|define
name|DEFAULT
parameter_list|(
name|x
parameter_list|)
define|\
value|if (qalt->x == (char **)&_uuconf_unset) qalt->x = qdefault->x
name|SYSTEM_STRING_ARRAYS
argument_list|(
name|DEFAULT
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|DEFAULT
define|#
directive|define
name|DEFAULT
parameter_list|(
name|x
parameter_list|)
define|\
value|if (qalt->x == (struct uuconf_timespan *)&_uuconf_unset) \     qalt->x = qdefault->x
name|SYSTEM_TIMESPANS
argument_list|(
name|DEFAULT
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|DEFAULT
define|#
directive|define
name|DEFAULT
parameter_list|(
name|x
parameter_list|)
value|if (qalt->x< 0) qalt->x = qdefault->x
name|SYSTEM_BOOLEANS
argument_list|(
name|DEFAULT
argument_list|)
expr_stmt|;
name|SYSTEM_INTEGERS
argument_list|(
name|DEFAULT
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|DEFAULT
comment|/* We only copy over zport if both zport and qport are NULL, 	 because otherwise a default zport would override a specific 	 qport.  */
if|if
condition|(
name|qalt
operator|->
name|uuconf_zport
operator|==
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|&&
name|qalt
operator|->
name|uuconf_qport
operator|==
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
name|qalt
operator|->
name|uuconf_zport
operator|=
name|qdefault
operator|->
name|uuconf_zport
expr_stmt|;
if|if
condition|(
name|qalt
operator|->
name|uuconf_qport
operator|==
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
name|qalt
operator|->
name|uuconf_qport
operator|=
name|qdefault
operator|->
name|uuconf_qport
expr_stmt|;
if|if
condition|(
name|qalt
operator|->
name|uuconf_qproto_params
operator|==
operator|(
expr|struct
name|uuconf_proto_param
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
name|qalt
operator|->
name|uuconf_qproto_params
operator|=
name|qdefault
operator|->
name|uuconf_qproto_params
expr_stmt|;
elseif|else
if|if
condition|(
name|qdefault
operator|->
name|uuconf_qproto_params
operator|!=
name|NULL
condition|)
block|{
name|int
name|cnew
decl_stmt|,
name|ca
decl_stmt|;
name|struct
name|uuconf_proto_param
modifier|*
name|qd
decl_stmt|,
modifier|*
name|qa
decl_stmt|;
comment|/* Merge in the default protocol parameters, so that a 	     system with 'g' protocol parameters won't lose the 	     default 'i' protocol parameters.  */
name|ca
operator|=
literal|0
expr_stmt|;
name|cnew
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|qd
operator|=
name|qdefault
operator|->
name|uuconf_qproto_params
init|;
name|qd
operator|->
name|uuconf_bproto
operator|!=
literal|'\0'
condition|;
name|qd
operator|++
control|)
block|{
name|int
name|c
decl_stmt|;
name|c
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|qa
operator|=
name|qalt
operator|->
name|uuconf_qproto_params
init|;
operator|(
name|qa
operator|->
name|uuconf_bproto
operator|!=
literal|'\0'
operator|&&
name|qa
operator|->
name|uuconf_bproto
operator|!=
name|qd
operator|->
name|uuconf_bproto
operator|)
condition|;
name|qa
operator|++
control|)
operator|++
name|c
expr_stmt|;
if|if
condition|(
name|qa
operator|->
name|uuconf_bproto
operator|==
literal|'\0'
condition|)
block|{
operator|++
name|cnew
expr_stmt|;
name|ca
operator|=
name|c
expr_stmt|;
block|}
block|}
if|if
condition|(
name|cnew
operator|>
literal|0
condition|)
block|{
name|struct
name|uuconf_proto_param
modifier|*
name|qnew
decl_stmt|;
name|qnew
operator|=
operator|(
operator|(
expr|struct
name|uuconf_proto_param
operator|*
operator|)
name|uuconf_malloc
argument_list|(
name|qset
operator|->
name|uuconf_palloc
argument_list|,
operator|(
operator|(
name|ca
operator|+
name|cnew
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|uuconf_proto_param
argument_list|)
operator|)
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|qnew
operator|==
name|NULL
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
return|return
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
return|;
block|}
name|memcpy
argument_list|(
operator|(
name|pointer
operator|)
name|qnew
argument_list|,
operator|(
name|pointer
operator|)
name|qalt
operator|->
name|uuconf_qproto_params
argument_list|,
name|ca
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|uuconf_proto_param
argument_list|)
argument_list|)
expr_stmt|;
name|cnew
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|qd
operator|=
name|qdefault
operator|->
name|uuconf_qproto_params
init|;
name|qd
operator|->
name|uuconf_bproto
operator|!=
literal|'\0'
condition|;
name|qd
operator|++
control|)
block|{
for|for
control|(
name|qa
operator|=
name|qalt
operator|->
name|uuconf_qproto_params
init|;
operator|(
name|qa
operator|->
name|uuconf_bproto
operator|!=
literal|'\0'
operator|&&
name|qa
operator|->
name|uuconf_bproto
operator|!=
name|qd
operator|->
name|uuconf_bproto
operator|)
condition|;
name|qa
operator|++
control|)
empty_stmt|;
if|if
condition|(
name|qa
operator|->
name|uuconf_bproto
operator|==
literal|'\0'
condition|)
block|{
name|qnew
index|[
name|ca
operator|+
name|cnew
index|]
operator|=
operator|*
name|qd
expr_stmt|;
operator|++
name|cnew
expr_stmt|;
block|}
block|}
name|qnew
index|[
name|ca
operator|+
name|cnew
index|]
operator|.
name|uuconf_bproto
operator|=
literal|'\0'
expr_stmt|;
name|uuconf_free
argument_list|(
name|qset
operator|->
name|uuconf_palloc
argument_list|,
name|qalt
operator|->
name|uuconf_qproto_params
argument_list|)
expr_stmt|;
name|qalt
operator|->
name|uuconf_qproto_params
operator|=
name|qnew
expr_stmt|;
block|}
block|}
if|if
condition|(
name|qdefault
operator|->
name|uuconf_qalternate
operator|!=
name|NULL
condition|)
name|qdefault
operator|=
name|qdefault
operator|->
name|uuconf_qalternate
expr_stmt|;
block|}
return|return
name|UUCONF_SUCCESS
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Put in the basic defaults.  This ensures that the fields are valid    on every uuconf_system structure.  */
end_comment

begin_function
name|int
name|_uuconf_isystem_basic_default
parameter_list|(
name|qglobal
parameter_list|,
name|q
parameter_list|)
name|struct
name|sglobal
modifier|*
name|qglobal
decl_stmt|;
specifier|register
name|struct
name|uuconf_system
modifier|*
name|q
decl_stmt|;
block|{
name|int
name|iret
decl_stmt|;
name|iret
operator|=
name|UUCONF_SUCCESS
expr_stmt|;
for|for
control|(
init|;
name|q
operator|!=
name|NULL
operator|&&
name|iret
operator|==
name|UUCONF_SUCCESS
condition|;
name|q
operator|=
name|q
operator|->
name|uuconf_qalternate
control|)
block|{
comment|/* The default of 26 allowable retries is traditional.  */
if|if
condition|(
name|q
operator|->
name|uuconf_cmax_retries
operator|<
literal|0
condition|)
name|q
operator|->
name|uuconf_cmax_retries
operator|=
literal|26
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
operator|==
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
operator|=
name|NULL
expr_stmt|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"\"\""
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"\\r\\c"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"ogin:"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"-BREAK"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"-ogin:"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"-BREAK"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"-ogin:"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"\\L"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"word:"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"\\P"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
block|}
if|if
condition|(
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_ctimeout
operator|<
literal|0
condition|)
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_ctimeout
operator|=
literal|10
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_fstrip
operator|<
literal|0
condition|)
name|q
operator|->
name|uuconf_schat
operator|.
name|uuconf_fstrip
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_scalled_chat
operator|.
name|uuconf_ctimeout
operator|<
literal|0
condition|)
name|q
operator|->
name|uuconf_scalled_chat
operator|.
name|uuconf_ctimeout
operator|=
literal|60
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_scalled_chat
operator|.
name|uuconf_fstrip
operator|<
literal|0
condition|)
name|q
operator|->
name|uuconf_scalled_chat
operator|.
name|uuconf_fstrip
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_fsend_request
operator|<
literal|0
condition|)
name|q
operator|->
name|uuconf_fsend_request
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_frec_request
operator|<
literal|0
condition|)
name|q
operator|->
name|uuconf_frec_request
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_fcall_transfer
operator|<
literal|0
condition|)
name|q
operator|->
name|uuconf_fcall_transfer
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_fcalled_transfer
operator|<
literal|0
condition|)
name|q
operator|->
name|uuconf_fcalled_transfer
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzlocal_send
operator|==
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|q
operator|->
name|uuconf_pzlocal_send
operator|=
name|NULL
expr_stmt|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ZROOTDIR
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_pzlocal_send
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
block|}
if|if
condition|(
name|q
operator|->
name|uuconf_pzremote_send
operator|==
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|q
operator|->
name|uuconf_pzremote_send
operator|=
name|NULL
expr_stmt|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"~"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_pzremote_send
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
block|}
if|if
condition|(
name|q
operator|->
name|uuconf_pzlocal_receive
operator|==
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|q
operator|->
name|uuconf_pzlocal_receive
operator|=
name|NULL
expr_stmt|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"~"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_pzlocal_receive
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
block|}
if|if
condition|(
name|q
operator|->
name|uuconf_pzremote_receive
operator|==
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|q
operator|->
name|uuconf_pzremote_receive
operator|=
name|NULL
expr_stmt|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
operator|(
name|char
operator|*
operator|)
literal|"~"
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|q
operator|->
name|uuconf_pzremote_receive
argument_list|,
name|q
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
block|}
if|if
condition|(
name|q
operator|->
name|uuconf_pzpath
operator|==
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|char
modifier|*
name|zdup
decl_stmt|;
name|char
modifier|*
modifier|*
name|pz
decl_stmt|;
name|size_t
name|csplit
decl_stmt|;
name|int
name|c
decl_stmt|;
name|zdup
operator|=
operator|(
name|char
operator|*
operator|)
name|uuconf_malloc
argument_list|(
name|q
operator|->
name|uuconf_palloc
argument_list|,
sizeof|sizeof
name|CMDPATH
argument_list|)
expr_stmt|;
if|if
condition|(
name|zdup
operator|==
name|NULL
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
return|return
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
return|;
block|}
name|memcpy
argument_list|(
operator|(
name|pointer
operator|)
name|zdup
argument_list|,
operator|(
name|pointer
operator|)
name|CMDPATH
argument_list|,
sizeof|sizeof
name|CMDPATH
argument_list|)
expr_stmt|;
name|pz
operator|=
name|NULL
expr_stmt|;
name|csplit
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|_uuconf_istrsplit
argument_list|(
name|zdup
argument_list|,
literal|'\0'
argument_list|,
operator|&
name|pz
argument_list|,
operator|&
name|csplit
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
return|return
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
return|;
block|}
name|q
operator|->
name|uuconf_pzpath
operator|=
operator|(
name|char
operator|*
operator|*
operator|)
name|uuconf_malloc
argument_list|(
name|q
operator|->
name|uuconf_palloc
argument_list|,
operator|(
operator|(
name|c
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzpath
operator|==
name|NULL
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
return|return
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
return|;
block|}
name|memcpy
argument_list|(
operator|(
name|pointer
operator|)
name|q
operator|->
name|uuconf_pzpath
argument_list|,
operator|(
name|pointer
operator|)
name|pz
argument_list|,
name|c
operator|*
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
argument_list|)
expr_stmt|;
name|q
operator|->
name|uuconf_pzpath
index|[
name|c
index|]
operator|=
name|NULL
expr_stmt|;
name|free
argument_list|(
operator|(
name|pointer
operator|)
name|pz
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|q
operator|->
name|uuconf_pzcmds
operator|==
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|q
operator|->
name|uuconf_pzcmds
operator|=
operator|(
operator|(
name|char
operator|*
operator|*
operator|)
name|uuconf_malloc
argument_list|(
name|q
operator|->
name|uuconf_palloc
argument_list|,
literal|3
operator|*
sizeof|sizeof
argument_list|(
specifier|const
name|char
operator|*
argument_list|)
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_pzcmds
operator|==
name|NULL
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
return|return
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
return|;
block|}
name|q
operator|->
name|uuconf_pzcmds
index|[
literal|0
index|]
operator|=
operator|(
name|char
operator|*
operator|)
literal|"rnews"
expr_stmt|;
name|q
operator|->
name|uuconf_pzcmds
index|[
literal|1
index|]
operator|=
operator|(
name|char
operator|*
operator|)
literal|"rmail"
expr_stmt|;
name|q
operator|->
name|uuconf_pzcmds
index|[
literal|2
index|]
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|q
operator|->
name|uuconf_cfree_space
operator|<
literal|0
condition|)
name|q
operator|->
name|uuconf_cfree_space
operator|=
name|DEFAULT_FREE_SPACE
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_zpubdir
operator|==
operator|(
specifier|const
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
name|q
operator|->
name|uuconf_zpubdir
operator|=
name|qglobal
operator|->
name|qprocess
operator|->
name|zpubdir
expr_stmt|;
define|#
directive|define
name|SET
parameter_list|(
name|x
parameter_list|)
value|if (q->x == (char *)&_uuconf_unset) q->x = NULL
name|SYSTEM_STRINGS
argument_list|(
name|SET
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|SET
define|#
directive|define
name|SET
parameter_list|(
name|x
parameter_list|)
value|if (q->x == (char **)&_uuconf_unset) q->x = NULL
name|SYSTEM_STRING_ARRAYS
argument_list|(
name|SET
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|SET
define|#
directive|define
name|SET
parameter_list|(
name|x
parameter_list|)
define|\
value|if (q->x == (struct uuconf_timespan *)&_uuconf_unset) q->x = NULL
name|SYSTEM_TIMESPANS
argument_list|(
name|SET
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|SET
define|#
directive|define
name|SET
parameter_list|(
name|x
parameter_list|)
value|if (q->x< 0) q->x = 0
name|SYSTEM_BOOLEANS
argument_list|(
name|SET
argument_list|)
expr_stmt|;
name|SYSTEM_INTEGERS
argument_list|(
name|SET
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|SET
if|if
condition|(
name|q
operator|->
name|uuconf_zport
operator|==
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
name|q
operator|->
name|uuconf_zport
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_qport
operator|==
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
name|q
operator|->
name|uuconf_qport
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|uuconf_qproto_params
operator|==
operator|(
expr|struct
name|uuconf_proto_param
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
name|q
operator|->
name|uuconf_qproto_params
operator|=
name|NULL
expr_stmt|;
block|}
return|return
name|iret
return|;
block|}
end_function

end_unit

