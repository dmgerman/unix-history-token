begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* tlocnm.c    Get the local name to use from the Taylor UUCP configuration files.     Copyright (C) 1992 Ian Lance Taylor     This file is part of the Taylor UUCP uuconf library.     This library is free software; you can redistribute it and/or    modify it under the terms of the GNU Library General Public License    as published by the Free Software Foundation; either version 2 of    the License, or (at your option) any later version.     This library is distributed in the hope that it will be useful, but    WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    Library General Public License for more details.     You should have received a copy of the GNU Library General Public    License along with this library; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.     The author of the program may be contacted at ian@airs.com or    c/o Cygnus Support, 48 Grove Street, Somerville, MA 02144.    */
end_comment

begin_include
include|#
directive|include
file|"uucnfi.h"
end_include

begin_if
if|#
directive|if
name|USE_RCS_ID
end_if

begin_decl_stmt
specifier|const
name|char
name|_uuconf_tlocnm_rcsid
index|[]
init|=
literal|"$FreeBSD$"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_escape
end_escape

begin_comment
comment|/* Get the local name to use, based on the login name, from the Taylor    UUCP configuration files.  This could probably be done in a    slightly more intelligent fashion, but no matter what it has to    read the systems files.  */
end_comment

begin_function
name|int
name|uuconf_taylor_login_localname
parameter_list|(
name|pglobal
parameter_list|,
name|zlogin
parameter_list|,
name|pzname
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
specifier|const
name|char
modifier|*
name|zlogin
decl_stmt|;
name|char
modifier|*
modifier|*
name|pzname
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|char
modifier|*
modifier|*
name|pznames
decl_stmt|,
modifier|*
modifier|*
name|pz
decl_stmt|;
name|int
name|iret
decl_stmt|;
if|if
condition|(
operator|!
name|qglobal
operator|->
name|qprocess
operator|->
name|fread_syslocs
condition|)
block|{
name|iret
operator|=
name|_uuconf_iread_locations
argument_list|(
name|qglobal
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
block|}
comment|/* As a simple optimization, if there is no "myname" command we can      simply return immediately.  */
if|if
condition|(
operator|!
name|qglobal
operator|->
name|qprocess
operator|->
name|fuses_myname
condition|)
block|{
operator|*
name|pzname
operator|=
name|NULL
expr_stmt|;
return|return
name|UUCONF_NOT_FOUND
return|;
block|}
name|iret
operator|=
name|uuconf_taylor_system_names
argument_list|(
name|pglobal
argument_list|,
operator|&
name|pznames
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
operator|*
name|pzname
operator|=
name|NULL
expr_stmt|;
name|iret
operator|=
name|UUCONF_NOT_FOUND
expr_stmt|;
for|for
control|(
name|pz
operator|=
name|pznames
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
block|{
name|struct
name|uuconf_system
name|ssys
decl_stmt|;
name|struct
name|uuconf_system
modifier|*
name|qsys
decl_stmt|;
name|iret
operator|=
name|uuconf_system_info
argument_list|(
name|pglobal
argument_list|,
operator|*
name|pz
argument_list|,
operator|&
name|ssys
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
break|break;
for|for
control|(
name|qsys
operator|=
operator|&
name|ssys
init|;
name|qsys
operator|!=
name|NULL
condition|;
name|qsys
operator|=
name|qsys
operator|->
name|uuconf_qalternate
control|)
block|{
if|if
condition|(
name|qsys
operator|->
name|uuconf_zlocalname
operator|!=
name|NULL
operator|&&
name|qsys
operator|->
name|uuconf_fcalled
operator|&&
name|qsys
operator|->
name|uuconf_zcalled_login
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
name|qsys
operator|->
name|uuconf_zcalled_login
argument_list|,
name|zlogin
argument_list|)
operator|==
literal|0
condition|)
block|{
operator|*
name|pzname
operator|=
name|strdup
argument_list|(
name|qsys
operator|->
name|uuconf_zlocalname
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|pzname
operator|!=
name|NULL
condition|)
name|iret
operator|=
name|UUCONF_SUCCESS
expr_stmt|;
else|else
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
name|iret
operator|=
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
expr_stmt|;
block|}
break|break;
block|}
block|}
operator|(
name|void
operator|)
name|uuconf_system_free
argument_list|(
name|pglobal
argument_list|,
operator|&
name|ssys
argument_list|)
expr_stmt|;
if|if
condition|(
name|qsys
operator|!=
name|NULL
condition|)
break|break;
name|iret
operator|=
name|UUCONF_NOT_FOUND
expr_stmt|;
block|}
for|for
control|(
name|pz
operator|=
name|pznames
init|;
operator|*
name|pz
operator|!=
name|NULL
condition|;
name|pz
operator|++
control|)
name|free
argument_list|(
operator|(
name|pointer
operator|)
operator|*
name|pz
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|pointer
operator|)
name|pznames
argument_list|)
expr_stmt|;
return|return
name|iret
return|;
block|}
end_function

end_unit

