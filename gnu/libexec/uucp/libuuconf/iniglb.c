begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* iniglb.c    Initialize the global information structure.     Copyright (C) 1992, 1994, 1995 Ian Lance Taylor     This file is part of the Taylor UUCP uuconf library.     This library is free software; you can redistribute it and/or    modify it under the terms of the GNU Library General Public License    as published by the Free Software Foundation; either version 2 of    the License, or (at your option) any later version.     This library is distributed in the hope that it will be useful, but    WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    Library General Public License for more details.     You should have received a copy of the GNU Library General Public    License along with this library; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.     The author of the program may be contacted at ian@airs.com or    c/o Cygnus Support, 48 Grove Street, Somerville, MA 02144.    */
end_comment

begin_include
include|#
directive|include
file|"uucnfi.h"
end_include

begin_if
if|#
directive|if
name|USE_RCS_ID
end_if

begin_decl_stmt
specifier|const
name|char
name|_uuconf_iniglb_rcsid
index|[]
init|=
literal|"$Id: iniglb.c,v 1.11 1995/06/28 14:38:23 ian Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_escape
end_escape

begin_comment
comment|/* Initialize the global information structure.  */
end_comment

begin_function
name|int
name|_uuconf_iinit_global
parameter_list|(
name|pqglobal
parameter_list|)
name|struct
name|sglobal
modifier|*
modifier|*
name|pqglobal
decl_stmt|;
block|{
name|pointer
name|pblock
decl_stmt|;
specifier|register
name|struct
name|sprocess
modifier|*
name|qprocess
decl_stmt|;
name|char
modifier|*
name|azargs
index|[
literal|3
index|]
decl_stmt|;
name|int
name|iret
decl_stmt|;
name|pblock
operator|=
name|uuconf_malloc_block
argument_list|()
expr_stmt|;
if|if
condition|(
name|pblock
operator|==
name|NULL
condition|)
return|return
name|UUCONF_MALLOC_FAILED
return|;
operator|*
name|pqglobal
operator|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|uuconf_malloc
argument_list|(
name|pblock
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|sglobal
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|pqglobal
operator|==
name|NULL
condition|)
block|{
name|uuconf_free_block
argument_list|(
name|pblock
argument_list|)
expr_stmt|;
return|return
name|UUCONF_MALLOC_FAILED
return|;
block|}
operator|(
operator|*
name|pqglobal
operator|)
operator|->
name|qprocess
operator|=
operator|(
operator|(
expr|struct
name|sprocess
operator|*
operator|)
name|uuconf_malloc
argument_list|(
name|pblock
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|sprocess
argument_list|)
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|pqglobal
operator|)
operator|->
name|qprocess
operator|==
name|NULL
condition|)
block|{
name|uuconf_free_block
argument_list|(
name|pblock
argument_list|)
expr_stmt|;
operator|*
name|pqglobal
operator|=
name|NULL
expr_stmt|;
return|return
name|UUCONF_MALLOC_FAILED
return|;
block|}
operator|(
operator|*
name|pqglobal
operator|)
operator|->
name|pblock
operator|=
name|pblock
expr_stmt|;
operator|(
operator|*
name|pqglobal
operator|)
operator|->
name|ierrno
operator|=
literal|0
expr_stmt|;
operator|(
operator|*
name|pqglobal
operator|)
operator|->
name|ilineno
operator|=
literal|0
expr_stmt|;
operator|(
operator|*
name|pqglobal
operator|)
operator|->
name|zfilename
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|=
operator|(
operator|*
name|pqglobal
operator|)
operator|->
name|qprocess
expr_stmt|;
name|qprocess
operator|->
name|zlocalname
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|zspooldir
operator|=
name|SPOOLDIR
expr_stmt|;
name|qprocess
operator|->
name|zpubdir
operator|=
name|PUBDIR
expr_stmt|;
ifdef|#
directive|ifdef
name|LOCKDIR
name|qprocess
operator|->
name|zlockdir
operator|=
name|LOCKDIR
expr_stmt|;
else|#
directive|else
name|qprocess
operator|->
name|zlockdir
operator|=
name|SPOOLDIR
expr_stmt|;
endif|#
directive|endif
name|qprocess
operator|->
name|zlogfile
operator|=
name|LOGFILE
expr_stmt|;
name|qprocess
operator|->
name|zstatsfile
operator|=
name|STATFILE
expr_stmt|;
name|qprocess
operator|->
name|zdebugfile
operator|=
name|DEBUGFILE
expr_stmt|;
name|qprocess
operator|->
name|zdebug
operator|=
literal|""
expr_stmt|;
name|qprocess
operator|->
name|fstrip_login
operator|=
name|TRUE
expr_stmt|;
name|qprocess
operator|->
name|fstrip_proto
operator|=
name|TRUE
expr_stmt|;
name|qprocess
operator|->
name|cmaxuuxqts
operator|=
literal|0
expr_stmt|;
name|qprocess
operator|->
name|zrunuuxqt
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|fv2
operator|=
name|TRUE
expr_stmt|;
name|qprocess
operator|->
name|fhdb
operator|=
name|TRUE
expr_stmt|;
name|qprocess
operator|->
name|pzdialcodefiles
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|pztimetables
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|zconfigfile
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|pzsysfiles
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|pzportfiles
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|pzdialfiles
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|pzpwdfiles
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|pzcallfiles
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|qunknown
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|fread_syslocs
operator|=
name|FALSE
expr_stmt|;
name|qprocess
operator|->
name|qsyslocs
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|qvalidate
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|fuses_myname
operator|=
name|FALSE
expr_stmt|;
name|qprocess
operator|->
name|zv2systems
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|zv2devices
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|zv2userfile
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|zv2cmds
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|pzhdb_systems
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|pzhdb_devices
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|pzhdb_dialers
operator|=
name|NULL
expr_stmt|;
name|qprocess
operator|->
name|fhdb_read_permissions
operator|=
name|FALSE
expr_stmt|;
name|qprocess
operator|->
name|qhdb_permissions
operator|=
name|NULL
expr_stmt|;
name|azargs
index|[
literal|0
index|]
operator|=
name|NULL
expr_stmt|;
name|azargs
index|[
literal|1
index|]
operator|=
operator|(
name|char
operator|*
operator|)
literal|"Evening"
expr_stmt|;
name|azargs
index|[
literal|2
index|]
operator|=
operator|(
name|char
operator|*
operator|)
literal|"Wk1705-0755,Sa,Su"
expr_stmt|;
name|iret
operator|=
name|_uuconf_itimetable
argument_list|(
operator|(
name|pointer
operator|)
operator|*
name|pqglobal
argument_list|,
literal|3
argument_list|,
name|azargs
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|UUCONF_ERROR_VALUE
argument_list|(
name|iret
argument_list|)
operator|==
name|UUCONF_SUCCESS
condition|)
block|{
name|azargs
index|[
literal|1
index|]
operator|=
operator|(
name|char
operator|*
operator|)
literal|"Night"
expr_stmt|;
name|azargs
index|[
literal|2
index|]
operator|=
operator|(
name|char
operator|*
operator|)
literal|"Wk2305-0755,Sa,Su2305-1655"
expr_stmt|;
name|iret
operator|=
name|_uuconf_itimetable
argument_list|(
operator|(
name|pointer
operator|)
operator|*
name|pqglobal
argument_list|,
literal|3
argument_list|,
name|azargs
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|UUCONF_ERROR_VALUE
argument_list|(
name|iret
argument_list|)
operator|==
name|UUCONF_SUCCESS
condition|)
block|{
name|azargs
index|[
literal|1
index|]
operator|=
operator|(
name|char
operator|*
operator|)
literal|"NonPeak"
expr_stmt|;
name|azargs
index|[
literal|2
index|]
operator|=
operator|(
name|char
operator|*
operator|)
literal|"Wk1805-0655,Sa,Su"
expr_stmt|;
name|iret
operator|=
name|_uuconf_itimetable
argument_list|(
operator|(
name|pointer
operator|)
operator|*
name|pqglobal
argument_list|,
literal|3
argument_list|,
name|azargs
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|UUCONF_ERROR_VALUE
argument_list|(
name|iret
argument_list|)
operator|!=
name|UUCONF_SUCCESS
condition|)
block|{
name|uuconf_free_block
argument_list|(
name|pblock
argument_list|)
expr_stmt|;
operator|*
name|pqglobal
operator|=
name|NULL
expr_stmt|;
comment|/* Strip off any special bits, since there's no global 	 structure.  */
return|return
name|UUCONF_ERROR_VALUE
argument_list|(
name|iret
argument_list|)
return|;
block|}
return|return
name|UUCONF_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/* Add a timetable.  This is also called by the Taylor UUCP    initialization code, as well as by the Taylor UUCP sys file code    (although the latter is obsolete).  There's no point in putting    this in a separate file, since everything must call    _uuconf_init_global.  There is a race condition here if this is    called by two different threads on a sys file command, but the sys    file command is obsolete anyhow.  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
name|int
name|_uuconf_itimetable
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|int
name|iret
decl_stmt|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|qglobal
operator|->
name|qprocess
operator|->
name|pztimetables
argument_list|,
name|qglobal
operator|->
name|pblock
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
operator||
name|UUCONF_CMDTABRET_EXIT
return|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|2
index|]
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|qglobal
operator|->
name|qprocess
operator|->
name|pztimetables
argument_list|,
name|qglobal
operator|->
name|pblock
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
operator||
name|UUCONF_CMDTABRET_EXIT
return|;
return|return
name|UUCONF_CMDTABRET_KEEP
return|;
block|}
end_function

end_unit

