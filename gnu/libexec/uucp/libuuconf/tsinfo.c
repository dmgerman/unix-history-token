begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* tsinfo.c    Get information about a system from the Taylor UUCP configuration files.     Copyright (C) 1992, 1993, 1995 Ian Lance Taylor     This file is part of the Taylor UUCP uuconf library.     This library is free software; you can redistribute it and/or    modify it under the terms of the GNU Library General Public License    as published by the Free Software Foundation; either version 2 of    the License, or (at your option) any later version.     This library is distributed in the hope that it will be useful, but    WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    Library General Public License for more details.     You should have received a copy of the GNU Library General Public    License along with this library; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.     The author of the program may be contacted at ian@airs.com or    c/o Cygnus Support, 48 Grove Street, Somerville, MA 02144.    */
end_comment

begin_include
include|#
directive|include
file|"uucnfi.h"
end_include

begin_if
if|#
directive|if
name|USE_RCS_ID
end_if

begin_decl_stmt
specifier|const
name|char
name|_uuconf_tsinfo_rcsid
index|[]
init|=
literal|"$FreeBSD$"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|SEEK_SET
end_ifndef

begin_define
define|#
directive|define
name|SEEK_SET
value|0
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_escape
end_escape

begin_decl_stmt
specifier|static
name|void
name|uiset_call
name|P
argument_list|(
operator|(
expr|struct
name|uuconf_system
operator|*
name|qsys
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|iisizecmp
name|P
argument_list|(
operator|(
name|long
name|i1
operator|,
name|long
name|i2
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Local functions needed to parse the system information file.  */
end_comment

begin_define
define|#
directive|define
name|CMDTABFN
parameter_list|(
name|z
parameter_list|)
define|\
value|static int z P((pointer, int, char **, pointer, pointer))
end_define

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iisystem
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iialias
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iialternate
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iidefault_alternates
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iitime
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iitimegrade
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iisize
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iibaud_range
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iiport
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iichat
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iidebug
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iicalled_login
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iiproto_param
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iirequest
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iitransfer
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iiforward
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|CMDTABFN
argument_list|(
name|iiunknown
argument_list|)
expr_stmt|;
end_expr_stmt

begin_undef
undef|#
directive|undef
name|CMDTABFN
end_undef

begin_escape
end_escape

begin_comment
comment|/* We have to pass a fair amount of information in and out of the    various system commands.  Using global variables would make the    code non-reentrant, so we instead pass a pointer to single    structure as the pinfo argument to the system commands.  */
end_comment

begin_struct
struct|struct
name|sinfo
block|{
comment|/* The system information we're building up.  */
name|struct
name|uuconf_system
modifier|*
name|qsys
decl_stmt|;
comment|/* Whether any alternates have been used.  */
name|boolean
name|falternates
decl_stmt|;
comment|/* A list of the previous alternates.  */
name|struct
name|uuconf_system
name|salternate
decl_stmt|;
comment|/* Whether to use extra alternates from the file wide defaults.  */
name|int
name|fdefault_alternates
decl_stmt|;
block|}
struct|;
end_struct

begin_escape
end_escape

begin_comment
comment|/* The command table for system commands.  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|cmdtab_offset
name|asIcmds
index|[]
init|=
block|{
block|{
literal|"system"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|2
block|,
operator|(
name|size_t
operator|)
operator|-
literal|1
block|,
name|iisystem
block|}
block|,
block|{
literal|"alias"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|2
block|,
operator|(
name|size_t
operator|)
operator|-
literal|1
block|,
name|iialias
block|}
block|,
block|{
literal|"alternate"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|0
block|,
operator|(
name|size_t
operator|)
operator|-
literal|1
block|,
name|iialternate
block|}
block|,
block|{
literal|"default-alternates"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|2
block|,
operator|(
name|size_t
operator|)
operator|-
literal|1
block|,
name|iidefault_alternates
block|}
block|,
block|{
literal|"time"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|0
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_qtimegrade
argument_list|)
block|,
name|iitime
block|}
block|,
block|{
literal|"timegrade"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|0
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_qtimegrade
argument_list|)
block|,
name|iitimegrade
block|}
block|,
block|{
literal|"max-retries"
block|,
name|UUCONF_CMDTABTYPE_INT
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_cmax_retries
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"success-wait"
block|,
name|UUCONF_CMDTABTYPE_INT
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_csuccess_wait
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"call-timegrade"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|3
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_qcalltimegrade
argument_list|)
block|,
name|iitimegrade
block|}
block|,
block|{
literal|"called-timegrade"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|3
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_qcalledtimegrade
argument_list|)
block|,
name|iitimegrade
block|}
block|,
block|{
literal|"call-local-size"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|3
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_qcall_local_size
argument_list|)
block|,
name|iisize
block|}
block|,
block|{
literal|"call-remote-size"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|3
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_qcall_remote_size
argument_list|)
block|,
name|iisize
block|}
block|,
block|{
literal|"called-local-size"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|3
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_qcalled_local_size
argument_list|)
block|,
name|iisize
block|}
block|,
block|{
literal|"called-remote-size"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|3
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_qcalled_remote_size
argument_list|)
block|,
name|iisize
block|}
block|,
block|{
literal|"timetable"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|3
block|,
operator|(
name|size_t
operator|)
operator|-
literal|1
block|,
name|_uuconf_itimetable
block|}
block|,
block|{
literal|"baud"
block|,
name|UUCONF_CMDTABTYPE_LONG
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_ibaud
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"speed"
block|,
name|UUCONF_CMDTABTYPE_LONG
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_ibaud
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"baud-range"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|3
block|,
literal|0
block|,
name|iibaud_range
block|}
block|,
block|{
literal|"speed-range"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|3
block|,
literal|0
block|,
name|iibaud_range
block|}
block|,
block|{
literal|"port"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|0
block|,
operator|(
name|size_t
operator|)
operator|-
literal|1
block|,
name|iiport
block|}
block|,
block|{
literal|"phone"
block|,
name|UUCONF_CMDTABTYPE_STRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_zphone
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"address"
block|,
name|UUCONF_CMDTABTYPE_STRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_zphone
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"chat"
block|,
name|UUCONF_CMDTABTYPE_PREFIX
operator||
literal|0
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_schat
argument_list|)
block|,
name|iichat
block|}
block|,
block|{
literal|"call-login"
block|,
name|UUCONF_CMDTABTYPE_STRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_zcall_login
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"call-password"
block|,
name|UUCONF_CMDTABTYPE_STRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_zcall_password
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"called-login"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|0
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_zcalled_login
argument_list|)
block|,
name|iicalled_login
block|}
block|,
block|{
literal|"callback"
block|,
name|UUCONF_CMDTABTYPE_BOOLEAN
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_fcallback
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"sequence"
block|,
name|UUCONF_CMDTABTYPE_BOOLEAN
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_fsequence
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"protocol"
block|,
name|UUCONF_CMDTABTYPE_STRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_zprotocols
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"protocol-parameter"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|0
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_qproto_params
argument_list|)
block|,
name|iiproto_param
block|}
block|,
block|{
literal|"called-chat"
block|,
name|UUCONF_CMDTABTYPE_PREFIX
operator||
literal|0
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_scalled_chat
argument_list|)
block|,
name|iichat
block|}
block|,
block|{
literal|"debug"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|0
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_zdebug
argument_list|)
block|,
name|iidebug
block|}
block|,
block|{
literal|"max-remote-debug"
block|,
name|UUCONF_CMDTABTYPE_STRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_zmax_remote_debug
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"send-request"
block|,
name|UUCONF_CMDTABTYPE_BOOLEAN
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_fsend_request
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"receive-request"
block|,
name|UUCONF_CMDTABTYPE_BOOLEAN
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_frec_request
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"request"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|2
block|,
operator|(
name|size_t
operator|)
operator|-
literal|1
block|,
name|iirequest
block|}
block|,
block|{
literal|"call-transfer"
block|,
name|UUCONF_CMDTABTYPE_BOOLEAN
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_fcall_transfer
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"called-transfer"
block|,
name|UUCONF_CMDTABTYPE_BOOLEAN
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_fcalled_transfer
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"transfer"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|2
block|,
operator|(
name|size_t
operator|)
operator|-
literal|1
block|,
name|iitransfer
block|}
block|,
block|{
literal|"local-send"
block|,
name|UUCONF_CMDTABTYPE_FULLSTRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_pzlocal_send
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"remote-send"
block|,
name|UUCONF_CMDTABTYPE_FULLSTRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_pzremote_send
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"local-receive"
block|,
name|UUCONF_CMDTABTYPE_FULLSTRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_pzlocal_receive
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"remote-receive"
block|,
name|UUCONF_CMDTABTYPE_FULLSTRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_pzremote_receive
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"command-path"
block|,
name|UUCONF_CMDTABTYPE_FULLSTRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_pzpath
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"commands"
block|,
name|UUCONF_CMDTABTYPE_FULLSTRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_pzcmds
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"free-space"
block|,
name|UUCONF_CMDTABTYPE_LONG
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_cfree_space
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"forward-from"
block|,
name|UUCONF_CMDTABTYPE_FULLSTRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_pzforward_from
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"forward-to"
block|,
name|UUCONF_CMDTABTYPE_FULLSTRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_pzforward_to
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"forward"
block|,
name|UUCONF_CMDTABTYPE_FN
operator||
literal|0
block|,
operator|(
name|size_t
operator|)
operator|-
literal|1
block|,
name|iiforward
block|}
block|,
block|{
literal|"pubdir"
block|,
name|UUCONF_CMDTABTYPE_STRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_zpubdir
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
literal|"myname"
block|,
name|UUCONF_CMDTABTYPE_STRING
block|,
name|offsetof
argument_list|(
expr|struct
name|uuconf_system
argument_list|,
name|uuconf_zlocalname
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|CSYSTEM_CMDS
value|(sizeof asIcmds / sizeof asIcmds[0])
end_define

begin_escape
end_escape

begin_comment
comment|/* Get information about the system zsystem from the Taylor UUCP    configuration files.  Sets *qsys.  This does not ensure that all    default information is set.  */
end_comment

begin_function
name|int
name|_uuconf_itaylor_system_internal
parameter_list|(
name|qglobal
parameter_list|,
name|zsystem
parameter_list|,
name|qsys
parameter_list|)
name|struct
name|sglobal
modifier|*
name|qglobal
decl_stmt|;
specifier|const
name|char
modifier|*
name|zsystem
decl_stmt|;
name|struct
name|uuconf_system
modifier|*
name|qsys
decl_stmt|;
block|{
name|int
name|iret
decl_stmt|;
name|struct
name|stsysloc
modifier|*
name|qloc
decl_stmt|;
name|struct
name|uuconf_cmdtab
name|as
index|[
name|CSYSTEM_CMDS
index|]
decl_stmt|;
name|struct
name|sinfo
name|si
decl_stmt|;
name|struct
name|uuconf_system
name|sdefaults
decl_stmt|;
if|if
condition|(
operator|!
name|qglobal
operator|->
name|qprocess
operator|->
name|fread_syslocs
condition|)
block|{
name|iret
operator|=
name|_uuconf_iread_locations
argument_list|(
name|qglobal
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
block|}
comment|/* Find the system in the list of locations.  */
for|for
control|(
name|qloc
operator|=
name|qglobal
operator|->
name|qprocess
operator|->
name|qsyslocs
init|;
name|qloc
operator|!=
name|NULL
condition|;
name|qloc
operator|=
name|qloc
operator|->
name|qnext
control|)
if|if
condition|(
name|qloc
operator|->
name|zname
index|[
literal|0
index|]
operator|==
name|zsystem
index|[
literal|0
index|]
operator|&&
name|strcmp
argument_list|(
name|qloc
operator|->
name|zname
argument_list|,
name|zsystem
argument_list|)
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
name|qloc
operator|==
name|NULL
condition|)
return|return
name|UUCONF_NOT_FOUND
return|;
comment|/* If this is an alias, then the real system is the next non-alias      in the list.  */
while|while
condition|(
name|qloc
operator|->
name|falias
condition|)
block|{
name|qloc
operator|=
name|qloc
operator|->
name|qnext
expr_stmt|;
if|if
condition|(
name|qloc
operator|==
name|NULL
condition|)
return|return
name|UUCONF_NOT_FOUND
return|;
block|}
name|_uuconf_ucmdtab_base
argument_list|(
name|asIcmds
argument_list|,
name|CSYSTEM_CMDS
argument_list|,
operator|(
name|char
operator|*
operator|)
name|qsys
argument_list|,
name|as
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|qloc
operator|->
name|e
argument_list|)
expr_stmt|;
comment|/* Read the file wide defaults from the start of the file.  */
name|_uuconf_uclear_system
argument_list|(
name|qsys
argument_list|)
expr_stmt|;
name|si
operator|.
name|qsys
operator|=
name|qsys
expr_stmt|;
name|si
operator|.
name|falternates
operator|=
name|FALSE
expr_stmt|;
name|si
operator|.
name|fdefault_alternates
operator|=
name|TRUE
expr_stmt|;
name|qsys
operator|->
name|uuconf_palloc
operator|=
name|uuconf_malloc_block
argument_list|()
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|uuconf_palloc
operator|==
name|NULL
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
return|return
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
return|;
block|}
name|iret
operator|=
name|uuconf_cmd_file
argument_list|(
operator|(
name|pointer
operator|)
name|qglobal
argument_list|,
name|qloc
operator|->
name|e
argument_list|,
name|as
argument_list|,
operator|(
name|pointer
operator|)
operator|&
name|si
argument_list|,
name|iiunknown
argument_list|,
name|UUCONF_CMDTABFLAG_BACKSLASH
argument_list|,
name|qsys
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
block|{
name|qglobal
operator|->
name|zfilename
operator|=
name|qloc
operator|->
name|zfile
expr_stmt|;
return|return
name|iret
operator||
name|UUCONF_ERROR_FILENAME
return|;
block|}
if|if
condition|(
operator|!
name|si
operator|.
name|falternates
condition|)
name|uiset_call
argument_list|(
name|qsys
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* Attach the final alternate.  */
name|iret
operator|=
name|iialternate
argument_list|(
operator|(
name|pointer
operator|)
name|qglobal
argument_list|,
literal|0
argument_list|,
operator|(
name|char
operator|*
operator|*
operator|)
name|NULL
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
operator|(
name|pointer
operator|)
operator|&
name|si
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
block|}
comment|/* Save off the defaults.  */
name|sdefaults
operator|=
operator|*
name|qsys
expr_stmt|;
comment|/* Advance to the information for the system we want.  */
if|if
condition|(
name|fseek
argument_list|(
name|qloc
operator|->
name|e
argument_list|,
name|qloc
operator|->
name|iloc
argument_list|,
name|SEEK_SET
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
name|qglobal
operator|->
name|zfilename
operator|=
name|qloc
operator|->
name|zfile
expr_stmt|;
return|return
operator|(
name|UUCONF_FSEEK_FAILED
operator||
name|UUCONF_ERROR_ERRNO
operator||
name|UUCONF_ERROR_FILENAME
operator|)
return|;
block|}
comment|/* Read in the system we want.  */
name|_uuconf_uclear_system
argument_list|(
name|qsys
argument_list|)
expr_stmt|;
name|qsys
operator|->
name|uuconf_zname
operator|=
operator|(
name|char
operator|*
operator|)
name|qloc
operator|->
name|zname
expr_stmt|;
name|qsys
operator|->
name|uuconf_palloc
operator|=
name|sdefaults
operator|.
name|uuconf_palloc
expr_stmt|;
name|si
operator|.
name|falternates
operator|=
name|FALSE
expr_stmt|;
name|iret
operator|=
name|uuconf_cmd_file
argument_list|(
name|qglobal
argument_list|,
name|qloc
operator|->
name|e
argument_list|,
name|as
argument_list|,
operator|(
name|pointer
operator|)
operator|&
name|si
argument_list|,
name|iiunknown
argument_list|,
name|UUCONF_CMDTABFLAG_BACKSLASH
argument_list|,
name|qsys
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
name|qglobal
operator|->
name|ilineno
operator|+=
name|qloc
operator|->
name|ilineno
expr_stmt|;
if|if
condition|(
name|iret
operator|==
name|UUCONF_SUCCESS
condition|)
block|{
if|if
condition|(
operator|!
name|si
operator|.
name|falternates
condition|)
name|uiset_call
argument_list|(
name|qsys
argument_list|)
expr_stmt|;
else|else
name|iret
operator|=
name|iialternate
argument_list|(
operator|(
name|pointer
operator|)
name|qglobal
argument_list|,
literal|0
argument_list|,
operator|(
name|char
operator|*
operator|*
operator|)
name|NULL
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
operator|(
name|pointer
operator|)
operator|&
name|si
argument_list|)
expr_stmt|;
block|}
comment|/* Merge in the defaults.  */
if|if
condition|(
name|iret
operator|==
name|UUCONF_SUCCESS
condition|)
name|iret
operator|=
name|_uuconf_isystem_default
argument_list|(
name|qglobal
argument_list|,
name|qsys
argument_list|,
operator|&
name|sdefaults
argument_list|,
name|si
operator|.
name|fdefault_alternates
argument_list|)
expr_stmt|;
comment|/* The first alternate is always available for calling in.  It is      always available for calling out if it has some way to choose a      port (this would normally be set by uiset_call anyhow, but it      won't be if all the port information comes from the defaults).  */
if|if
condition|(
name|iret
operator|==
name|UUCONF_SUCCESS
condition|)
block|{
name|qsys
operator|->
name|uuconf_fcalled
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|uuconf_zport
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|||
name|qsys
operator|->
name|uuconf_qport
operator|!=
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|||
name|qsys
operator|->
name|uuconf_ibaud
operator|>=
literal|0
operator|||
name|qsys
operator|->
name|uuconf_zphone
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
name|qsys
operator|->
name|uuconf_fcall
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
block|{
name|qglobal
operator|->
name|zfilename
operator|=
name|qloc
operator|->
name|zfile
expr_stmt|;
name|iret
operator||=
name|UUCONF_ERROR_FILENAME
expr_stmt|;
block|}
return|return
name|iret
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Set the fcall and fcalled field for the system.  This marks a    particular alternate for use when calling out or calling in.  This    is where we implement the semantics described in the documentation:    a change to a relevant field implies that the alternate is used.    If all the relevant fields are unchanged, the alternate is not    used.  */
end_comment

begin_function
specifier|static
name|void
name|uiset_call
parameter_list|(
name|qsys
parameter_list|)
name|struct
name|uuconf_system
modifier|*
name|qsys
decl_stmt|;
block|{
name|qsys
operator|->
name|uuconf_fcall
operator|=
operator|(
name|qsys
operator|->
name|uuconf_qtimegrade
operator|!=
operator|(
expr|struct
name|uuconf_timespan
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|||
name|qsys
operator|->
name|uuconf_zport
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|||
name|qsys
operator|->
name|uuconf_qport
operator|!=
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|||
name|qsys
operator|->
name|uuconf_ibaud
operator|>=
literal|0
operator|||
name|qsys
operator|->
name|uuconf_zphone
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|||
name|qsys
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzchat
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|||
name|qsys
operator|->
name|uuconf_schat
operator|.
name|uuconf_pzprogram
operator|!=
operator|(
name|char
operator|*
operator|*
operator|)
operator|&
name|_uuconf_unset
operator|)
expr_stmt|;
name|qsys
operator|->
name|uuconf_fcalled
operator|=
name|qsys
operator|->
name|uuconf_zcalled_login
operator|!=
operator|(
name|char
operator|*
operator|)
operator|&
name|_uuconf_unset
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle the "system" command.  Because we skip directly to the    system we want to read, a "system" command means we've reached the    end of it.  */
end_comment

begin_function
specifier|static
name|int
name|iisystem
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
return|return
name|UUCONF_CMDTABRET_EXIT
return|;
block|}
end_function

begin_comment
comment|/* Handle the "alias" command.  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|iialias
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
name|int
name|iret
decl_stmt|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_pzalias
argument_list|,
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|iret
operator||=
name|UUCONF_CMDTABRET_EXIT
expr_stmt|;
return|return
name|iret
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle the "alternate" command.  The information just read is in    sIhold.  If this is the first "alternate" command for this system,    we save off the current information in sIalternate.  Otherwise we    default this information to sIalternate, and then add it to the end    of the list of alternates in sIalternate.  */
end_comment

begin_function
specifier|static
name|int
name|iialternate
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
name|uiset_call
argument_list|(
name|qinfo
operator|->
name|qsys
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|qinfo
operator|->
name|falternates
condition|)
block|{
name|qinfo
operator|->
name|salternate
operator|=
operator|*
name|qinfo
operator|->
name|qsys
expr_stmt|;
name|qinfo
operator|->
name|falternates
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|int
name|iret
decl_stmt|;
name|struct
name|uuconf_system
modifier|*
name|qnew
decl_stmt|,
modifier|*
modifier|*
name|pq
decl_stmt|;
name|iret
operator|=
name|_uuconf_isystem_default
argument_list|(
name|qglobal
argument_list|,
name|qinfo
operator|->
name|qsys
argument_list|,
operator|&
name|qinfo
operator|->
name|salternate
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
operator||
name|UUCONF_CMDTABRET_EXIT
return|;
name|qnew
operator|=
operator|(
operator|(
expr|struct
name|uuconf_system
operator|*
operator|)
name|uuconf_malloc
argument_list|(
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_palloc
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|uuconf_system
argument_list|)
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|qnew
operator|==
name|NULL
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
empty_stmt|;
return|return
operator|(
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
operator||
name|UUCONF_CMDTABRET_EXIT
operator|)
return|;
block|}
operator|*
name|qnew
operator|=
operator|*
name|qinfo
operator|->
name|qsys
expr_stmt|;
for|for
control|(
name|pq
operator|=
operator|&
name|qinfo
operator|->
name|salternate
operator|.
name|uuconf_qalternate
init|;
operator|*
name|pq
operator|!=
name|NULL
condition|;
name|pq
operator|=
operator|&
operator|(
operator|*
name|pq
operator|)
operator|->
name|uuconf_qalternate
control|)
empty_stmt|;
operator|*
name|pq
operator|=
name|qnew
expr_stmt|;
block|}
comment|/* If this is the last alternate command, move the information back      to qinfo->qsys.  */
if|if
condition|(
name|argc
operator|==
literal|0
condition|)
operator|*
name|qinfo
operator|->
name|qsys
operator|=
name|qinfo
operator|->
name|salternate
expr_stmt|;
else|else
block|{
name|_uuconf_uclear_system
argument_list|(
name|qinfo
operator|->
name|qsys
argument_list|)
expr_stmt|;
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_zname
operator|=
name|qinfo
operator|->
name|salternate
operator|.
name|uuconf_zname
expr_stmt|;
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_palloc
operator|=
name|qinfo
operator|->
name|salternate
operator|.
name|uuconf_palloc
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|1
condition|)
block|{
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_zalternate
operator|=
name|argv
index|[
literal|1
index|]
expr_stmt|;
return|return
name|UUCONF_CMDTABRET_KEEP
return|;
block|}
block|}
return|return
name|UUCONF_CMDTABRET_CONTINUE
return|;
block|}
end_function

begin_comment
comment|/* Handle the "default-alternates" command.  This just takes a boolean    argument which is used to set the fdefault_alternates field of the    sinfo structure.  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|iidefault_alternates
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
return|return
name|_uuconf_iboolean
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|,
operator|&
name|qinfo
operator|->
name|fdefault_alternates
argument_list|)
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle the "time" command.  We do this by turning it into a    "timegrade" command with a grade of BGRADE_LOW.  The first argument    is a time string, and the optional second argument is the retry    time.  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|iitime
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|char
modifier|*
name|aznew
index|[
literal|4
index|]
decl_stmt|;
name|char
name|ab
index|[
literal|2
index|]
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|2
operator|&&
name|argc
operator|!=
literal|3
condition|)
return|return
name|UUCONF_SYNTAX_ERROR
operator||
name|UUCONF_CMDTABRET_EXIT
return|;
name|aznew
index|[
literal|0
index|]
operator|=
name|argv
index|[
literal|0
index|]
expr_stmt|;
name|ab
index|[
literal|0
index|]
operator|=
name|UUCONF_GRADE_LOW
expr_stmt|;
name|ab
index|[
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|aznew
index|[
literal|1
index|]
operator|=
name|ab
expr_stmt|;
name|aznew
index|[
literal|2
index|]
operator|=
name|argv
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|2
condition|)
name|aznew
index|[
literal|3
index|]
operator|=
name|argv
index|[
literal|2
index|]
expr_stmt|;
return|return
name|iitimegrade
argument_list|(
name|pglobal
argument_list|,
name|argc
operator|+
literal|1
argument_list|,
name|aznew
argument_list|,
name|pvar
argument_list|,
name|pinfo
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Handle the "timegrade" command by calling _uuconf_itime_parse with    appropriate ival (the work grade) and cretry (the retry time)    arguments.  */
end_comment

begin_function
specifier|static
name|int
name|iitimegrade
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|uuconf_timespan
modifier|*
modifier|*
name|pqspan
init|=
operator|(
expr|struct
name|uuconf_timespan
operator|*
operator|*
operator|)
name|pvar
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
name|int
name|cretry
decl_stmt|;
name|int
name|iret
decl_stmt|;
if|if
condition|(
name|argc
operator|<
literal|3
operator|||
name|argc
operator|>
literal|4
condition|)
return|return
name|UUCONF_SYNTAX_ERROR
operator||
name|UUCONF_CMDTABRET_EXIT
return|;
if|if
condition|(
name|argv
index|[
literal|1
index|]
index|[
literal|1
index|]
operator|!=
literal|'\0'
operator|||
operator|!
name|UUCONF_GRADE_LEGAL
argument_list|(
name|argv
index|[
literal|1
index|]
index|[
literal|0
index|]
argument_list|)
condition|)
return|return
name|UUCONF_SYNTAX_ERROR
operator||
name|UUCONF_CMDTABRET_EXIT
return|;
if|if
condition|(
name|argc
operator|==
literal|3
condition|)
name|cretry
operator|=
literal|0
expr_stmt|;
else|else
block|{
name|iret
operator|=
name|_uuconf_iint
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|3
index|]
argument_list|,
operator|(
name|pointer
operator|)
operator|&
name|cretry
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
block|}
name|iret
operator|=
name|_uuconf_itime_parse
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|2
index|]
argument_list|,
operator|(
name|long
operator|)
name|argv
index|[
literal|1
index|]
index|[
literal|0
index|]
argument_list|,
name|cretry
argument_list|,
name|_uuconf_itime_grade_cmp
argument_list|,
name|pqspan
argument_list|,
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|iret
operator||=
name|UUCONF_CMDTABRET_EXIT
expr_stmt|;
return|return
name|iret
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle the "baud-range" command, also known as "speed-range".  */
end_comment

begin_function
specifier|static
name|int
name|iibaud_range
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|uuconf_system
modifier|*
name|qsys
init|=
operator|(
expr|struct
name|uuconf_system
operator|*
operator|)
name|pvar
decl_stmt|;
name|int
name|iret
decl_stmt|;
name|iret
operator|=
name|_uuconf_iint
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|,
operator|(
name|pointer
operator|)
operator|&
name|qsys
operator|->
name|uuconf_ibaud
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
return|return
name|_uuconf_iint
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|2
index|]
argument_list|,
operator|(
name|pointer
operator|)
operator|&
name|qsys
operator|->
name|uuconf_ihighbaud
argument_list|,
name|FALSE
argument_list|)
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle one of the size commands ("call-local-size", etc.).  The    first argument is a number of bytes, and the second argument is a    time string.  The pvar argument points to the string array to which    we add this new string.  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|iisize
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|uuconf_timespan
modifier|*
modifier|*
name|pqspan
init|=
operator|(
expr|struct
name|uuconf_timespan
operator|*
operator|*
operator|)
name|pvar
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
name|long
name|ival
decl_stmt|;
name|int
name|iret
decl_stmt|;
name|iret
operator|=
name|_uuconf_iint
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|,
operator|(
name|pointer
operator|)
operator|&
name|ival
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
name|iret
operator|=
name|_uuconf_itime_parse
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|2
index|]
argument_list|,
name|ival
argument_list|,
literal|0
argument_list|,
name|iisizecmp
argument_list|,
name|pqspan
argument_list|,
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
name|iret
operator||=
name|UUCONF_CMDTABRET_EXIT
expr_stmt|;
return|return
name|iret
return|;
block|}
end_function

begin_comment
comment|/* A comparison function for sizes to pass to _uuconf_itime_parse.  */
end_comment

begin_function
specifier|static
name|int
name|iisizecmp
parameter_list|(
name|i1
parameter_list|,
name|i2
parameter_list|)
name|long
name|i1
decl_stmt|;
name|long
name|i2
decl_stmt|;
block|{
comment|/* We can't just return i1 - i2 because that would be a long.  */
if|if
condition|(
name|i1
operator|<
name|i2
condition|)
return|return
operator|-
literal|1
return|;
elseif|else
if|if
condition|(
name|i1
operator|==
name|i2
condition|)
return|return
literal|0
return|;
else|else
return|return
literal|1
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle the "port" command.  If there is one argument, this names a    port.  Otherwise, the remaining arguments form a command describing    the port.  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|iiport
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
if|if
condition|(
name|argc
operator|<
literal|2
condition|)
return|return
name|UUCONF_SYNTAX_ERROR
operator||
name|UUCONF_CMDTABRET_EXIT
return|;
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
condition|)
block|{
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_zport
operator|=
name|argv
index|[
literal|1
index|]
expr_stmt|;
return|return
name|UUCONF_CMDTABRET_KEEP
return|;
block|}
else|else
block|{
name|int
name|iret
decl_stmt|;
if|if
condition|(
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_qport
operator|==
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
block|{
name|struct
name|uuconf_port
modifier|*
name|qnew
decl_stmt|;
name|qnew
operator|=
operator|(
operator|(
expr|struct
name|uuconf_port
operator|*
operator|)
name|uuconf_malloc
argument_list|(
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_palloc
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|uuconf_port
argument_list|)
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|qnew
operator|==
name|NULL
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
return|return
operator|(
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
operator||
name|UUCONF_CMDTABRET_EXIT
operator|)
return|;
block|}
name|_uuconf_uclear_port
argument_list|(
name|qnew
argument_list|)
expr_stmt|;
if|if
condition|(
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_zname
operator|==
name|NULL
condition|)
name|qnew
operator|->
name|uuconf_zname
operator|=
operator|(
name|char
operator|*
operator|)
literal|"default system file port"
expr_stmt|;
else|else
block|{
name|char
modifier|*
name|zname
decl_stmt|;
name|size_t
name|clen
decl_stmt|;
name|clen
operator|=
name|strlen
argument_list|(
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_zname
argument_list|)
expr_stmt|;
name|zname
operator|=
operator|(
name|char
operator|*
operator|)
name|uuconf_malloc
argument_list|(
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_palloc
argument_list|,
name|clen
operator|+
sizeof|sizeof
expr|"system  port"
argument_list|)
expr_stmt|;
if|if
condition|(
name|zname
operator|==
name|NULL
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
return|return
operator|(
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
operator||
name|UUCONF_CMDTABRET_EXIT
operator|)
return|;
block|}
name|memcpy
argument_list|(
operator|(
name|pointer
operator|)
name|zname
argument_list|,
operator|(
name|pointer
operator|)
literal|"system "
argument_list|,
sizeof|sizeof
expr|"system "
operator|-
literal|1
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
call|(
name|pointer
call|)
argument_list|(
name|zname
operator|+
sizeof|sizeof
expr|"system "
operator|-
literal|1
argument_list|)
argument_list|,
operator|(
name|pointer
operator|)
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_zname
argument_list|,
name|clen
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
call|(
name|pointer
call|)
argument_list|(
name|zname
operator|+
sizeof|sizeof
expr|"system "
operator|-
literal|1
operator|+
name|clen
argument_list|)
argument_list|,
operator|(
name|pointer
operator|)
literal|" port"
argument_list|,
sizeof|sizeof
expr|" port"
argument_list|)
expr_stmt|;
name|qnew
operator|->
name|uuconf_zname
operator|=
name|zname
expr_stmt|;
block|}
name|qnew
operator|->
name|uuconf_palloc
operator|=
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_palloc
expr_stmt|;
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_qport
operator|=
name|qnew
expr_stmt|;
block|}
name|iret
operator|=
name|_uuconf_iport_cmd
argument_list|(
name|qglobal
argument_list|,
name|argc
operator|-
literal|1
argument_list|,
name|argv
operator|+
literal|1
argument_list|,
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_qport
argument_list|)
expr_stmt|;
if|if
condition|(
name|UUCONF_ERROR_VALUE
argument_list|(
name|iret
argument_list|)
operator|!=
name|UUCONF_SUCCESS
condition|)
name|iret
operator||=
name|UUCONF_CMDTABRET_EXIT
expr_stmt|;
return|return
name|iret
return|;
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle the "chat" and "called-chat" set of commands.  These just    hand off to the generic chat script function.  */
end_comment

begin_function
specifier|static
name|int
name|iichat
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
name|struct
name|uuconf_chat
modifier|*
name|qchat
init|=
operator|(
expr|struct
name|uuconf_chat
operator|*
operator|)
name|pvar
decl_stmt|;
name|int
name|iret
decl_stmt|;
name|iret
operator|=
name|_uuconf_ichat_cmd
argument_list|(
name|qglobal
argument_list|,
name|argc
argument_list|,
name|argv
argument_list|,
name|qchat
argument_list|,
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|UUCONF_ERROR_VALUE
argument_list|(
name|iret
argument_list|)
operator|!=
name|UUCONF_SUCCESS
condition|)
name|iret
operator||=
name|UUCONF_CMDTABRET_EXIT
expr_stmt|;
return|return
name|iret
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Local interface to the _uuconf_idebug_cmd function, which handles    the "debug" command.  */
end_comment

begin_function
specifier|static
name|int
name|iidebug
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
name|char
modifier|*
modifier|*
name|pzdebug
init|=
operator|(
name|char
operator|*
operator|*
operator|)
name|pvar
decl_stmt|;
return|return
name|_uuconf_idebug_cmd
argument_list|(
name|qglobal
argument_list|,
name|pzdebug
argument_list|,
name|argc
argument_list|,
name|argv
argument_list|,
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_palloc
argument_list|)
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle the "called-login" command.  This only needs to be in a    function because there can be additional arguments listing the    remote systems which are permitted to use this login name.  The    additional arguments are not actually handled here; they are    handled by uuconf_taylor_system_names, which already has to go    through all the system files.  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|iicalled_login
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|char
modifier|*
modifier|*
name|pz
init|=
operator|(
name|char
operator|*
operator|*
operator|)
name|pvar
decl_stmt|;
if|if
condition|(
name|argc
operator|<
literal|2
condition|)
return|return
name|UUCONF_SYNTAX_ERROR
operator||
name|UUCONF_CMDTABRET_EXIT
return|;
operator|*
name|pz
operator|=
name|argv
index|[
literal|1
index|]
expr_stmt|;
return|return
name|UUCONF_CMDTABRET_KEEP
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle the "protocol-parameter" command.  This just hands off to    the generic protocol parameter handler.  */
end_comment

begin_function
specifier|static
name|int
name|iiproto_param
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|uuconf_proto_param
modifier|*
modifier|*
name|pqparam
init|=
operator|(
expr|struct
name|uuconf_proto_param
operator|*
operator|*
operator|)
name|pvar
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
if|if
condition|(
operator|*
name|pqparam
operator|==
operator|(
expr|struct
name|uuconf_proto_param
operator|*
operator|)
operator|&
name|_uuconf_unset
condition|)
operator|*
name|pqparam
operator|=
name|NULL
expr_stmt|;
return|return
name|_uuconf_iadd_proto_param
argument_list|(
name|qglobal
argument_list|,
name|argc
operator|-
literal|1
argument_list|,
name|argv
operator|+
literal|1
argument_list|,
name|pqparam
argument_list|,
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_palloc
argument_list|)
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle the "request" command.  This is equivalent to specifying    both "call-request" and "called-request".  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|iirequest
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
name|int
name|iret
decl_stmt|;
name|iret
operator|=
name|_uuconf_iboolean
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|,
operator|&
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_fsend_request
argument_list|)
expr_stmt|;
if|if
condition|(
name|UUCONF_ERROR_VALUE
argument_list|(
name|iret
argument_list|)
operator|==
name|UUCONF_SUCCESS
condition|)
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_frec_request
operator|=
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_fsend_request
expr_stmt|;
return|return
name|iret
return|;
block|}
end_function

begin_comment
comment|/* Handle the "transfer" command.  This is equivalent to specifying    both "call-transfer" and "called-transfer".  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|iitransfer
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
name|int
name|iret
decl_stmt|;
name|iret
operator|=
name|_uuconf_iboolean
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|,
operator|&
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_fcall_transfer
argument_list|)
expr_stmt|;
if|if
condition|(
name|UUCONF_ERROR_VALUE
argument_list|(
name|iret
argument_list|)
operator|==
name|UUCONF_SUCCESS
condition|)
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_fcalled_transfer
operator|=
name|qinfo
operator|->
name|qsys
operator|->
name|uuconf_fcall_transfer
expr_stmt|;
return|return
name|iret
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle the "forward" command.  This is equivalent to specifying    both "forward-from" and "forward-to".  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|iiforward
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|sinfo
modifier|*
name|qinfo
init|=
operator|(
expr|struct
name|sinfo
operator|*
operator|)
name|pinfo
decl_stmt|;
name|struct
name|uuconf_system
modifier|*
name|qsys
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|iret
decl_stmt|;
name|qsys
operator|=
name|qinfo
operator|->
name|qsys
expr_stmt|;
name|qsys
operator|->
name|uuconf_pzforward_from
operator|=
name|NULL
expr_stmt|;
name|qsys
operator|->
name|uuconf_pzforward_to
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|argc
condition|;
name|i
operator|++
control|)
block|{
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
name|i
index|]
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|qsys
operator|->
name|uuconf_pzforward_to
argument_list|,
name|qsys
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
operator||
name|UUCONF_CMDTABRET_KEEP
operator||
name|UUCONF_CMDTABRET_EXIT
return|;
name|iret
operator|=
name|_uuconf_iadd_string
argument_list|(
name|qglobal
argument_list|,
name|argv
index|[
name|i
index|]
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
operator|&
name|qsys
operator|->
name|uuconf_pzforward_from
argument_list|,
name|qsys
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
operator||
name|UUCONF_CMDTABRET_KEEP
operator||
name|UUCONF_CMDTABRET_EXIT
return|;
block|}
return|return
name|UUCONF_CMDTABRET_KEEP
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Handle an unknown command.  This should probably be done more    intelligently.  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|iiunknown
parameter_list|(
name|pglobal
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|,
name|pvar
parameter_list|,
name|pinfo
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|pointer
name|pvar
decl_stmt|;
name|pointer
name|pinfo
decl_stmt|;
block|{
return|return
name|UUCONF_SYNTAX_ERROR
operator||
name|UUCONF_CMDTABRET_EXIT
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Return information for an unknown system.  It would be better to    put this in a different file, but it would require breaking several    functions out of this file.  Perhaps I will do it sometime.  */
end_comment

begin_function
name|int
name|uuconf_taylor_system_unknown
parameter_list|(
name|pglobal
parameter_list|,
name|qsys
parameter_list|)
name|pointer
name|pglobal
decl_stmt|;
name|struct
name|uuconf_system
modifier|*
name|qsys
decl_stmt|;
block|{
name|struct
name|sglobal
modifier|*
name|qglobal
init|=
operator|(
expr|struct
name|sglobal
operator|*
operator|)
name|pglobal
decl_stmt|;
name|struct
name|uuconf_cmdtab
name|as
index|[
name|CSYSTEM_CMDS
index|]
decl_stmt|;
name|struct
name|sinfo
name|si
decl_stmt|;
name|struct
name|sunknown
modifier|*
name|q
decl_stmt|;
name|int
name|iret
decl_stmt|;
if|if
condition|(
name|qglobal
operator|->
name|qprocess
operator|->
name|qunknown
operator|==
name|NULL
condition|)
return|return
name|UUCONF_NOT_FOUND
return|;
name|_uuconf_ucmdtab_base
argument_list|(
name|asIcmds
argument_list|,
name|CSYSTEM_CMDS
argument_list|,
operator|(
name|char
operator|*
operator|)
name|qsys
argument_list|,
name|as
argument_list|)
expr_stmt|;
name|_uuconf_uclear_system
argument_list|(
name|qsys
argument_list|)
expr_stmt|;
name|si
operator|.
name|qsys
operator|=
name|qsys
expr_stmt|;
name|si
operator|.
name|falternates
operator|=
name|FALSE
expr_stmt|;
name|si
operator|.
name|fdefault_alternates
operator|=
name|TRUE
expr_stmt|;
name|qsys
operator|->
name|uuconf_palloc
operator|=
name|uuconf_malloc_block
argument_list|()
expr_stmt|;
if|if
condition|(
name|qsys
operator|->
name|uuconf_palloc
operator|==
name|NULL
condition|)
block|{
name|qglobal
operator|->
name|ierrno
operator|=
name|errno
expr_stmt|;
return|return
name|UUCONF_MALLOC_FAILED
operator||
name|UUCONF_ERROR_ERRNO
return|;
block|}
for|for
control|(
name|q
operator|=
name|qglobal
operator|->
name|qprocess
operator|->
name|qunknown
init|;
name|q
operator|!=
name|NULL
condition|;
name|q
operator|=
name|q
operator|->
name|qnext
control|)
block|{
name|iret
operator|=
name|uuconf_cmd_args
argument_list|(
name|pglobal
argument_list|,
name|q
operator|->
name|cargs
argument_list|,
name|q
operator|->
name|pzargs
argument_list|,
name|as
argument_list|,
operator|(
name|pointer
operator|)
operator|&
name|si
argument_list|,
name|iiunknown
argument_list|,
name|UUCONF_CMDTABFLAG_BACKSLASH
argument_list|,
name|qsys
operator|->
name|uuconf_palloc
argument_list|)
expr_stmt|;
name|iret
operator|&=
operator|~
name|UUCONF_CMDTABRET_KEEP
expr_stmt|;
if|if
condition|(
name|UUCONF_ERROR_VALUE
argument_list|(
name|iret
argument_list|)
operator|!=
name|UUCONF_SUCCESS
condition|)
block|{
name|qglobal
operator|->
name|zfilename
operator|=
name|qglobal
operator|->
name|qprocess
operator|->
name|zconfigfile
expr_stmt|;
name|qglobal
operator|->
name|ilineno
operator|=
name|q
operator|->
name|ilineno
expr_stmt|;
return|return
operator|(
operator|(
name|iret
operator|&
operator|~
name|UUCONF_CMDTABRET_EXIT
operator|)
operator||
name|UUCONF_ERROR_FILENAME
operator||
name|UUCONF_ERROR_LINENO
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|iret
operator|&
name|UUCONF_CMDTABRET_EXIT
operator|)
operator|!=
literal|0
condition|)
break|break;
block|}
if|if
condition|(
operator|!
name|si
operator|.
name|falternates
condition|)
name|uiset_call
argument_list|(
name|qsys
argument_list|)
expr_stmt|;
else|else
block|{
name|iret
operator|=
name|iialternate
argument_list|(
name|pglobal
argument_list|,
literal|0
argument_list|,
operator|(
name|char
operator|*
operator|*
operator|)
name|NULL
argument_list|,
operator|(
name|pointer
operator|)
name|NULL
argument_list|,
operator|(
name|pointer
operator|)
operator|&
name|si
argument_list|)
expr_stmt|;
if|if
condition|(
name|iret
operator|!=
name|UUCONF_SUCCESS
condition|)
return|return
name|iret
return|;
block|}
comment|/* The first alternate is always available for calling in.  */
name|qsys
operator|->
name|uuconf_fcalled
operator|=
name|TRUE
expr_stmt|;
return|return
name|_uuconf_isystem_basic_default
argument_list|(
name|qglobal
argument_list|,
name|qsys
argument_list|)
return|;
block|}
end_function

end_unit

