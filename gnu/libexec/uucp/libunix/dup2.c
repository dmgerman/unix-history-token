begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* dup2.c    The Unix dup2 function, for systems which only have dup.     Copyright (C) 1985, 1986, 1987, 1988, 1990 Free Software Foundation, Inc.     This file is part of the Taylor UUCP package.     This program is free software; you can redistribute it and/or    modify it under the terms of the GNU General Public License as    published by the Free Software Foundation; either version 2 of the    License, or (at your option) any later version.     This program is distributed in the hope that it will be useful, but    WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.     The author of the program may be contacted at ian@airs.com or    c/o Cygnus Support, 48 Grove Street, Somerville, MA 02144.    */
end_comment

begin_include
include|#
directive|include
file|"uucp.h"
end_include

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_if
if|#
directive|if
name|HAVE_FCNTL_H
end_if

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_else
else|#
directive|else
end_else

begin_if
if|#
directive|if
name|HAVE_SYS_FILE_H
end_if

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* I basically took this from the emacs 18.57 distribution, although I    cleaned it up a bit and made it POSIX compliant.  */
end_comment

begin_function
name|int
name|dup2
parameter_list|(
name|oold
parameter_list|,
name|onew
parameter_list|)
name|int
name|oold
decl_stmt|;
name|int
name|onew
decl_stmt|;
block|{
if|if
condition|(
name|oold
operator|==
name|onew
condition|)
return|return
name|onew
return|;
operator|(
name|void
operator|)
name|close
argument_list|(
name|onew
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|F_DUPFD
return|return
name|fcntl
argument_list|(
name|oold
argument_list|,
name|F_DUPFD
argument_list|,
name|onew
argument_list|)
return|;
else|#
directive|else
block|{
name|int
name|onext
decl_stmt|,
name|oret
decl_stmt|,
name|isave
decl_stmt|;
name|onext
operator|=
name|dup
argument_list|(
name|oold
argument_list|)
expr_stmt|;
if|if
condition|(
name|onext
operator|==
name|onew
condition|)
return|return
name|onext
return|;
if|if
condition|(
name|onext
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
name|oret
operator|=
name|dup2
argument_list|(
name|oold
argument_list|,
name|onew
argument_list|)
expr_stmt|;
name|isave
operator|=
name|errno
expr_stmt|;
operator|(
name|void
operator|)
name|close
argument_list|(
name|onext
argument_list|)
expr_stmt|;
name|errno
operator|=
name|isave
expr_stmt|;
return|return
name|oret
return|;
block|}
endif|#
directive|endif
block|}
end_function

end_unit

