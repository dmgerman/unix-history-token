begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* rmdir.c    Remove a directory on a system which doesn't have the rmdir system    call.  This is only called by uupick, which is not setuid, so we    don't have to worry about the problems of invoking the setuid    /bin/rmdir program.  */
end_comment

begin_include
include|#
directive|include
file|"uucp.h"
end_include

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_function
name|int
name|rmdir
parameter_list|(
name|zdir
parameter_list|)
specifier|const
name|char
modifier|*
name|zdir
decl_stmt|;
block|{
specifier|const
name|char
modifier|*
name|azargs
index|[
literal|3
index|]
decl_stmt|;
name|int
name|aidescs
index|[
literal|3
index|]
decl_stmt|;
name|pid_t
name|ipid
decl_stmt|;
name|azargs
index|[
literal|0
index|]
operator|=
name|RMDIR_PROGRAM
expr_stmt|;
name|azargs
index|[
literal|1
index|]
operator|=
name|zdir
expr_stmt|;
name|azargs
index|[
literal|2
index|]
operator|=
name|NULL
expr_stmt|;
name|aidescs
index|[
literal|0
index|]
operator|=
name|SPAWN_NULL
expr_stmt|;
name|aidescs
index|[
literal|1
index|]
operator|=
name|SPAWN_NULL
expr_stmt|;
name|aidescs
index|[
literal|2
index|]
operator|=
name|SPAWN_NULL
expr_stmt|;
name|ipid
operator|=
name|ixsspawn
argument_list|(
name|azargs
argument_list|,
name|aidescs
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|)
name|NULL
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|)
name|NULL
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|)
name|NULL
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|ipid
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ixswait
argument_list|(
operator|(
name|unsigned
name|long
operator|)
name|ipid
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|)
name|NULL
argument_list|)
operator|!=
literal|0
condition|)
block|{
comment|/* Make up an errno value.  */
name|errno
operator|=
name|EBUSY
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

end_unit

