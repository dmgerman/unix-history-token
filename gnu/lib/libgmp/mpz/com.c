begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* mpz_com(mpz_ptr dst, mpz_ptr src) -- Assign the bit-complemented value of    SRC to DST.  Copyright (C) 1991, 1993, 1994, 1996 Free Software Foundation, Inc.  This file is part of the GNU MP Library.  The GNU MP Library is free software; you can redistribute it and/or modify it under the terms of the GNU Library General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.  The GNU MP Library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Library General Public License for more details.  You should have received a copy of the GNU Library General Public License along with the GNU MP Library; see the file COPYING.LIB.  If not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA. */
end_comment

begin_include
include|#
directive|include
file|"gmp.h"
end_include

begin_include
include|#
directive|include
file|"gmp-impl.h"
end_include

begin_function
name|void
if|#
directive|if
name|__STDC__
name|mpz_com
parameter_list|(
name|mpz_ptr
name|dst
parameter_list|,
name|mpz_srcptr
name|src
parameter_list|)
else|#
directive|else
function|mpz_com
parameter_list|(
name|dst
parameter_list|,
name|src
parameter_list|)
name|mpz_ptr
name|dst
decl_stmt|;
name|mpz_srcptr
name|src
decl_stmt|;
endif|#
directive|endif
block|{
name|mp_size_t
name|size
init|=
name|src
operator|->
name|_mp_size
decl_stmt|;
name|mp_srcptr
name|src_ptr
decl_stmt|;
name|mp_ptr
name|dst_ptr
decl_stmt|;
if|if
condition|(
name|size
operator|>=
literal|0
condition|)
block|{
comment|/* As with infinite precision: one's complement, two's complement. 	 But this can be simplified using the identity -x = ~x + 1. 	 So we're going to compute (~~x) + 1 = x + 1!  */
if|if
condition|(
name|dst
operator|->
name|_mp_alloc
operator|<
name|size
operator|+
literal|1
condition|)
name|_mpz_realloc
argument_list|(
name|dst
argument_list|,
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|src_ptr
operator|=
name|src
operator|->
name|_mp_d
expr_stmt|;
name|dst_ptr
operator|=
name|dst
operator|->
name|_mp_d
expr_stmt|;
if|if
condition|(
name|size
operator|==
literal|0
condition|)
block|{
comment|/* Special case, as mpn_add wants the first arg's size>= the 	     second arg's size.  */
name|dst_ptr
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|dst
operator|->
name|_mp_size
operator|=
operator|-
literal|1
expr_stmt|;
return|return;
block|}
block|{
name|mp_limb_t
name|cy
decl_stmt|;
name|cy
operator|=
name|mpn_add_1
argument_list|(
name|dst_ptr
argument_list|,
name|src_ptr
argument_list|,
name|size
argument_list|,
operator|(
name|mp_limb_t
operator|)
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|cy
condition|)
block|{
name|dst_ptr
index|[
name|size
index|]
operator|=
name|cy
expr_stmt|;
name|size
operator|++
expr_stmt|;
block|}
block|}
comment|/* Store a negative size, to indicate ones-extension.  */
name|dst
operator|->
name|_mp_size
operator|=
operator|-
name|size
expr_stmt|;
block|}
else|else
block|{
comment|/* As with infinite precision: two's complement, then one's complement. 	 But that can be simplified using the identity -x = ~(x - 1). 	 So we're going to compute ~~(x - 1) = x - 1!  */
name|size
operator|=
operator|-
name|size
expr_stmt|;
if|if
condition|(
name|dst
operator|->
name|_mp_alloc
operator|<
name|size
condition|)
name|_mpz_realloc
argument_list|(
name|dst
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|src_ptr
operator|=
name|src
operator|->
name|_mp_d
expr_stmt|;
name|dst_ptr
operator|=
name|dst
operator|->
name|_mp_d
expr_stmt|;
name|mpn_sub_1
argument_list|(
name|dst_ptr
argument_list|,
name|src_ptr
argument_list|,
name|size
argument_list|,
operator|(
name|mp_limb_t
operator|)
literal|1
argument_list|)
expr_stmt|;
name|size
operator|-=
name|dst_ptr
index|[
name|size
operator|-
literal|1
index|]
operator|==
literal|0
expr_stmt|;
comment|/* Store a positive size, to indicate zero-extension.  */
name|dst
operator|->
name|_mp_size
operator|=
name|size
expr_stmt|;
block|}
block|}
end_function

end_unit

