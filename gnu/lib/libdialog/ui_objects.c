begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Program:	objects.c  * Author:	Marc van Kempen  * Desc:	Implementation of UI-objects:  *		- String input fields  *		- List selection  *		- Buttons  *  * Copyright (c) 1995, Marc van Kempen  *  * All rights reserved.  *  * This software may be used, modified, copied, distributed, and  * sold, in both source and binary form provided that the above  * copyright and these terms are retained, verbatim, as the first  * lines of this file.  Under no circumstances is the author  * responsible for the proper functioning of this software, nor does  * the author assume any responsibility for damages incurred with  * its use.  *  */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<ncurses.h>
end_include

begin_include
include|#
directive|include
file|<dialog.h>
end_include

begin_include
include|#
directive|include
file|"dialog.priv.h"
end_include

begin_include
include|#
directive|include
file|"ui_objects.h"
end_include

begin_define
define|#
directive|define
name|ESC
value|27
end_define

begin_comment
comment|/***********************************************************************  *  * Obj routines  *  ***********************************************************************/
end_comment

begin_function
name|void
name|AddObj
parameter_list|(
name|ComposeObj
modifier|*
modifier|*
name|Obj
parameter_list|,
name|int
name|objtype
parameter_list|,
name|void
modifier|*
name|obj
parameter_list|)
comment|/*  * Desc: Add the object<obj> to the list of objects<Obj>  */
block|{
if|if
condition|(
operator|*
name|Obj
operator|==
name|NULL
condition|)
block|{
comment|/* Create the root object */
operator|*
name|Obj
operator|=
operator|(
name|ComposeObj
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|ComposeObj
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|Obj
condition|)
block|{
name|printf
argument_list|(
literal|"AddObj: Error malloc'ing ComposeObj\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
operator|(
operator|*
name|Obj
operator|)
operator|->
name|objtype
operator|=
name|objtype
expr_stmt|;
operator|(
operator|*
name|Obj
operator|)
operator|->
name|obj
operator|=
name|obj
expr_stmt|;
operator|(
operator|*
name|Obj
operator|)
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
operator|(
operator|*
name|Obj
operator|)
operator|->
name|prev
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
name|ComposeObj
modifier|*
name|o
init|=
operator|*
name|Obj
decl_stmt|;
comment|/* create the next object */
while|while
condition|(
name|o
operator|->
name|next
condition|)
name|o
operator|=
operator|(
name|ComposeObj
operator|*
operator|)
name|o
operator|->
name|next
expr_stmt|;
name|o
operator|->
name|next
operator|=
operator|(
expr|struct
name|ComposeObj
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|ComposeObj
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|o
operator|->
name|next
condition|)
block|{
name|printf
argument_list|(
literal|"AddObj: Error malloc'ing o->next\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|o
operator|->
name|next
operator|->
name|objtype
operator|=
name|objtype
expr_stmt|;
name|o
operator|->
name|next
operator|->
name|obj
operator|=
name|obj
expr_stmt|;
name|o
operator|->
name|next
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
name|o
operator|->
name|next
operator|->
name|prev
operator|=
name|o
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* AddObj() */
end_comment

begin_function
name|void
name|FreeObj
parameter_list|(
name|ComposeObj
modifier|*
name|Obj
parameter_list|)
comment|/*  * Desc: free the memory occupied by *Obj  */
block|{
name|ComposeObj
modifier|*
name|o
init|=
name|Obj
decl_stmt|;
name|o
operator|=
name|Obj
expr_stmt|;
while|while
condition|(
name|o
condition|)
block|{
name|o
operator|=
name|Obj
operator|->
name|next
expr_stmt|;
name|free
argument_list|(
name|Obj
argument_list|)
expr_stmt|;
name|Obj
operator|=
name|o
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* FreeObj() */
end_comment

begin_function
name|int
name|ReadObj
parameter_list|(
name|ComposeObj
modifier|*
name|Obj
parameter_list|)
comment|/*  * Desc: navigate through the different objects calling their  *	 respective navigation routines as necessary  * Pre:  Obj != NULL  */
block|{
name|ComposeObj
modifier|*
name|o
decl_stmt|;
name|ComposeObj
modifier|*
name|last
decl_stmt|;
comment|/* the last object in the list */
name|int
name|ret
decl_stmt|;
comment|/* the return value from the selection routine */
comment|/* find the last object in the list */
name|last
operator|=
name|Obj
expr_stmt|;
while|while
condition|(
name|last
operator|->
name|next
condition|)
name|last
operator|=
name|last
operator|->
name|next
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
name|o
operator|=
name|Obj
expr_stmt|;
while|while
condition|(
operator|(
name|ret
operator|!=
name|SEL_BUTTON
operator|)
operator|&&
operator|(
name|ret
operator|!=
name|SEL_ESC
operator|)
condition|)
block|{
switch|switch
condition|(
name|o
operator|->
name|objtype
condition|)
block|{
case|case
name|STRINGOBJ
case|:
name|ret
operator|=
name|SelectStringObj
argument_list|(
operator|(
name|StringObj
operator|*
operator|)
name|o
operator|->
name|obj
argument_list|)
expr_stmt|;
break|break;
case|case
name|LISTOBJ
case|:
name|ret
operator|=
name|SelectListObj
argument_list|(
operator|(
name|ListObj
operator|*
operator|)
name|o
operator|->
name|obj
argument_list|)
expr_stmt|;
break|break;
case|case
name|BUTTONOBJ
case|:
name|ret
operator|=
name|SelectButtonObj
argument_list|(
operator|(
name|ButtonObj
operator|*
operator|)
name|o
operator|->
name|obj
argument_list|)
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|ret
condition|)
block|{
case|case
name|KEY_DOWN
case|:
case|case
name|SEL_CR
case|:
case|case
name|SEL_TAB
case|:
comment|/* move to the next object in the list */
if|if
condition|(
name|o
operator|->
name|next
operator|!=
name|NULL
condition|)
block|{
name|o
operator|=
name|o
operator|->
name|next
expr_stmt|;
comment|/* next object */
block|}
else|else
block|{
name|o
operator|=
name|Obj
expr_stmt|;
comment|/* beginning of the list */
block|}
break|break;
case|case
name|KEY_UP
case|:
case|case
name|SEL_BACKTAB
case|:
comment|/* move to the previous object in the list */
if|if
condition|(
name|o
operator|->
name|prev
operator|!=
name|NULL
condition|)
block|{
name|o
operator|=
name|o
operator|->
name|prev
expr_stmt|;
comment|/* previous object */
block|}
else|else
block|{
name|o
operator|=
name|last
expr_stmt|;
comment|/* end of the list */
block|}
break|break;
case|case
name|KEY_F
argument_list|(
literal|1
argument_list|)
case|:
comment|/* display help_file */
case|case
literal|'?'
case|:
name|display_helpfile
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/* ReadObj() */
end_comment

begin_function
name|int
name|PollObj
parameter_list|(
name|ComposeObj
modifier|*
modifier|*
name|Obj
parameter_list|)
block|{
name|ComposeObj
modifier|*
name|last
decl_stmt|;
comment|/* the last object in the list */
name|ComposeObj
modifier|*
name|first
decl_stmt|;
comment|/* the first object in the list */
name|int
name|ret
decl_stmt|;
comment|/* the return value from the selection routine */
comment|/* find the last object in the list */
name|last
operator|=
operator|*
name|Obj
expr_stmt|;
while|while
condition|(
name|last
operator|->
name|next
condition|)
name|last
operator|=
name|last
operator|->
name|next
expr_stmt|;
comment|/* find the first object in the list */
name|first
operator|=
operator|*
name|Obj
expr_stmt|;
while|while
condition|(
name|first
operator|->
name|prev
condition|)
name|first
operator|=
name|first
operator|->
name|prev
expr_stmt|;
name|ret
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
operator|(
operator|*
name|Obj
operator|)
operator|->
name|objtype
condition|)
block|{
case|case
name|STRINGOBJ
case|:
name|ret
operator|=
name|SelectStringObj
argument_list|(
operator|(
name|StringObj
operator|*
operator|)
operator|(
operator|*
name|Obj
operator|)
operator|->
name|obj
argument_list|)
expr_stmt|;
break|break;
case|case
name|LISTOBJ
case|:
name|ret
operator|=
name|SelectListObj
argument_list|(
operator|(
name|ListObj
operator|*
operator|)
operator|(
operator|*
name|Obj
operator|)
operator|->
name|obj
argument_list|)
expr_stmt|;
break|break;
case|case
name|BUTTONOBJ
case|:
name|ret
operator|=
name|SelectButtonObj
argument_list|(
operator|(
name|ButtonObj
operator|*
operator|)
operator|(
operator|*
name|Obj
operator|)
operator|->
name|obj
argument_list|)
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|ret
condition|)
block|{
case|case
name|KEY_DOWN
case|:
case|case
name|SEL_CR
case|:
case|case
name|SEL_TAB
case|:
comment|/* move to the next object in the list */
if|if
condition|(
operator|(
operator|*
name|Obj
operator|)
operator|->
name|next
operator|!=
name|NULL
condition|)
block|{
operator|*
name|Obj
operator|=
operator|(
operator|*
name|Obj
operator|)
operator|->
name|next
expr_stmt|;
comment|/* next object */
block|}
else|else
block|{
operator|*
name|Obj
operator|=
name|first
expr_stmt|;
comment|/* beginning of the list */
block|}
break|break;
case|case
name|KEY_UP
case|:
case|case
name|SEL_BACKTAB
case|:
comment|/* move to the previous object in the list */
if|if
condition|(
operator|(
operator|*
name|Obj
operator|)
operator|->
name|prev
operator|!=
name|NULL
condition|)
block|{
operator|*
name|Obj
operator|=
operator|(
operator|*
name|Obj
operator|)
operator|->
name|prev
expr_stmt|;
comment|/* previous object */
block|}
else|else
block|{
operator|*
name|Obj
operator|=
name|last
expr_stmt|;
comment|/* end of the list */
block|}
break|break;
block|}
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_comment
comment|/* PollObj() */
end_comment

begin_function
name|void
name|DelObj
parameter_list|(
name|ComposeObj
modifier|*
name|Obj
parameter_list|)
comment|/*  * Desc: Free all objects  */
block|{
name|ComposeObj
modifier|*
name|o
decl_stmt|;
name|o
operator|=
name|Obj
expr_stmt|;
while|while
condition|(
name|Obj
operator|!=
name|NULL
condition|)
block|{
switch|switch
condition|(
name|Obj
operator|->
name|objtype
condition|)
block|{
case|case
name|STRINGOBJ
case|:
name|DelStringObj
argument_list|(
operator|(
name|StringObj
operator|*
operator|)
name|Obj
operator|->
name|obj
argument_list|)
expr_stmt|;
break|break;
case|case
name|LISTOBJ
case|:
name|DelListObj
argument_list|(
operator|(
name|ListObj
operator|*
operator|)
name|Obj
operator|->
name|obj
argument_list|)
expr_stmt|;
break|break;
case|case
name|BUTTONOBJ
case|:
name|DelButtonObj
argument_list|(
operator|(
name|ButtonObj
operator|*
operator|)
name|Obj
operator|->
name|obj
argument_list|)
expr_stmt|;
break|break;
block|}
name|Obj
operator|=
name|Obj
operator|->
name|next
expr_stmt|;
block|}
name|FreeObj
argument_list|(
name|o
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* DelObj() */
end_comment

begin_comment
comment|/***********************************************************************  *  * StringObj routines  *  ***********************************************************************/
end_comment

begin_function
specifier|static
name|void
name|outstr
parameter_list|(
name|WINDOW
modifier|*
name|win
parameter_list|,
name|char
modifier|*
name|str
parameter_list|,
name|int
name|attrs
parameter_list|)
block|{
if|if
condition|(
name|attrs
operator|&
name|DITEM_NO_ECHO
condition|)
block|{
name|char
modifier|*
name|cpy
decl_stmt|;
name|int
name|n
init|=
name|strlen
argument_list|(
name|str
argument_list|)
decl_stmt|;
name|cpy
operator|=
name|alloca
argument_list|(
name|n
operator|+
literal|1
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|cpy
argument_list|,
literal|'*'
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|cpy
index|[
name|n
index|]
operator|=
literal|'\0'
expr_stmt|;
name|waddstr
argument_list|(
name|win
argument_list|,
name|cpy
argument_list|)
expr_stmt|;
block|}
else|else
name|waddstr
argument_list|(
name|win
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|RefreshStringObj
parameter_list|(
name|StringObj
modifier|*
name|so
parameter_list|)
comment|/*  * Desc: redraw the object  */
block|{
name|char
name|tmp
index|[
literal|512
index|]
decl_stmt|;
name|wmove
argument_list|(
name|so
operator|->
name|win
argument_list|,
name|so
operator|->
name|y
argument_list|,
name|so
operator|->
name|x
operator|+
literal|1
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|so
operator|->
name|win
argument_list|,
name|dialog_attr
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|so
operator|->
name|win
argument_list|,
name|so
operator|->
name|title
argument_list|)
expr_stmt|;
name|draw_box
argument_list|(
name|so
operator|->
name|win
argument_list|,
name|so
operator|->
name|y
operator|+
literal|1
argument_list|,
name|so
operator|->
name|x
argument_list|,
literal|3
argument_list|,
name|so
operator|->
name|w
argument_list|,
name|dialog_attr
argument_list|,
name|border_attr
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|so
operator|->
name|win
argument_list|,
name|item_attr
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|so
operator|->
name|win
argument_list|,
name|so
operator|->
name|y
operator|+
literal|2
argument_list|,
name|so
operator|->
name|x
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|so
operator|->
name|s
argument_list|)
operator|>
name|so
operator|->
name|w
operator|-
literal|2
condition|)
block|{
name|strncpy
argument_list|(
name|tmp
argument_list|,
operator|(
name|char
operator|*
operator|)
name|so
operator|->
name|s
operator|+
name|strlen
argument_list|(
name|so
operator|->
name|s
argument_list|)
operator|-
name|so
operator|->
name|w
operator|+
literal|2
argument_list|,
name|so
operator|->
name|w
operator|-
literal|1
argument_list|)
expr_stmt|;
name|outstr
argument_list|(
name|so
operator|->
name|win
argument_list|,
name|tmp
argument_list|,
name|so
operator|->
name|attr_mask
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|outstr
argument_list|(
name|so
operator|->
name|win
argument_list|,
name|so
operator|->
name|s
argument_list|,
name|so
operator|->
name|attr_mask
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* RefreshStringObj() */
end_comment

begin_function
name|StringObj
modifier|*
name|NewStringObj
parameter_list|(
name|WINDOW
modifier|*
name|win
parameter_list|,
name|char
modifier|*
name|title
parameter_list|,
name|char
modifier|*
name|s
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|w
parameter_list|,
name|int
name|len
parameter_list|)
comment|/*  * Desc: Initialize a new stringobj and return a pointer to it.  *	 Draw the object on the screen at the specified coordinates  */
block|{
name|StringObj
modifier|*
name|so
decl_stmt|;
comment|/* Initialize a new object */
name|so
operator|=
operator|(
name|StringObj
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|StringObj
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|so
condition|)
block|{
name|printf
argument_list|(
literal|"NewStringObj: Error malloc'ing StringObj\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|so
operator|->
name|title
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|strlen
argument_list|(
name|title
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|so
operator|->
name|title
condition|)
block|{
name|printf
argument_list|(
literal|"NewStringObj: Error malloc'ing so->title\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|so
operator|->
name|title
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|so
operator|->
name|s
operator|=
name|s
expr_stmt|;
name|strcpy
argument_list|(
name|so
operator|->
name|s
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|so
operator|->
name|x
operator|=
name|x
expr_stmt|;
name|so
operator|->
name|y
operator|=
name|y
expr_stmt|;
name|so
operator|->
name|w
operator|=
name|w
expr_stmt|;
name|so
operator|->
name|len
operator|=
name|len
expr_stmt|;
name|so
operator|->
name|win
operator|=
name|win
expr_stmt|;
name|so
operator|->
name|attr_mask
operator|=
name|DialogInputAttrs
expr_stmt|;
comment|/* Grossly use a global to avoid changing API */
comment|/* Draw it on the screen */
name|RefreshStringObj
argument_list|(
name|so
argument_list|)
expr_stmt|;
return|return
operator|(
name|so
operator|)
return|;
block|}
end_function

begin_comment
comment|/* NewStringObj() */
end_comment

begin_function
name|int
name|SelectStringObj
parameter_list|(
name|StringObj
modifier|*
name|so
parameter_list|)
comment|/*  * Desc: get input using the info in<so>  */
block|{
name|int
name|key
decl_stmt|;
name|char
name|tmp
index|[
name|so
operator|->
name|len
operator|+
literal|1
index|]
decl_stmt|;
name|strcpy
argument_list|(
name|tmp
argument_list|,
name|so
operator|->
name|s
argument_list|)
expr_stmt|;
name|key
operator|=
name|line_edit
argument_list|(
name|so
operator|->
name|win
argument_list|,
name|so
operator|->
name|y
operator|+
literal|2
argument_list|,
name|so
operator|->
name|x
operator|+
literal|1
argument_list|,
name|so
operator|->
name|len
argument_list|,
name|so
operator|->
name|w
operator|-
literal|2
argument_list|,
name|inputbox_attr
argument_list|,
name|TRUE
argument_list|,
name|tmp
argument_list|,
name|so
operator|->
name|attr_mask
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|key
operator|==
literal|'\n'
operator|)
operator|||
operator|(
name|key
operator|==
literal|'\r'
operator|)
operator|||
operator|(
name|key
operator|==
literal|'\t'
operator|)
operator|||
name|key
operator|==
operator|(
name|KEY_BTAB
operator|)
condition|)
block|{
name|strcpy
argument_list|(
name|so
operator|->
name|s
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
name|RefreshStringObj
argument_list|(
name|so
argument_list|)
expr_stmt|;
if|if
condition|(
name|key
operator|==
name|ESC
condition|)
block|{
return|return
operator|(
name|SEL_ESC
operator|)
return|;
block|}
if|if
condition|(
name|key
operator|==
literal|'\t'
condition|)
block|{
return|return
operator|(
name|SEL_TAB
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|key
operator|==
name|KEY_BTAB
operator|)
operator|||
operator|(
name|key
operator|==
name|KEY_F
argument_list|(
literal|2
argument_list|)
operator|)
condition|)
block|{
return|return
operator|(
name|SEL_BACKTAB
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|key
operator|==
literal|'\n'
operator|)
operator|||
operator|(
name|key
operator|==
literal|'\r'
operator|)
condition|)
block|{
return|return
operator|(
name|SEL_CR
operator|)
return|;
block|}
return|return
operator|(
name|key
operator|)
return|;
block|}
end_function

begin_comment
comment|/* SelectStringObj() */
end_comment

begin_function
name|void
name|DelStringObj
parameter_list|(
name|StringObj
modifier|*
name|so
parameter_list|)
comment|/*  * Desc: Free the space occupied by<so>  */
block|{
name|free
argument_list|(
name|so
operator|->
name|title
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|so
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/***********************************************************************  *  * ListObj routines  *  ***********************************************************************/
end_comment

begin_function
name|void
name|DrawNames
parameter_list|(
name|ListObj
modifier|*
name|lo
parameter_list|)
comment|/*  * Desc: Just refresh the names, not the surrounding box and title  */
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|h
decl_stmt|,
name|x
decl_stmt|,
name|y
decl_stmt|;
name|char
name|tmp
index|[
name|MAXPATHLEN
index|]
decl_stmt|;
name|x
operator|=
name|lo
operator|->
name|x
operator|+
literal|1
expr_stmt|;
name|y
operator|=
name|lo
operator|->
name|y
operator|+
literal|2
expr_stmt|;
name|h
operator|=
name|lo
operator|->
name|h
operator|-
literal|2
expr_stmt|;
for|for
control|(
name|i
operator|=
name|lo
operator|->
name|scroll
init|;
name|i
operator|<
name|lo
operator|->
name|n
operator|&&
name|i
operator|<
name|lo
operator|->
name|scroll
operator|+
name|h
condition|;
name|i
operator|++
control|)
block|{
name|wmove
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|y
operator|+
name|i
operator|-
name|lo
operator|->
name|scroll
argument_list|,
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|lo
operator|->
name|seld
index|[
name|i
index|]
condition|)
block|{
name|wattrset
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|A_BOLD
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|wattrset
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|item_attr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|strlen
argument_list|(
name|lo
operator|->
name|name
index|[
name|i
index|]
argument_list|)
operator|>
name|lo
operator|->
name|w
operator|-
literal|2
condition|)
block|{
name|strncpy
argument_list|(
name|tmp
argument_list|,
name|lo
operator|->
name|name
index|[
name|i
index|]
argument_list|,
name|lo
operator|->
name|w
operator|-
literal|2
argument_list|)
expr_stmt|;
name|tmp
index|[
name|lo
operator|->
name|w
operator|-
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|lo
operator|->
name|name
index|[
name|i
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
name|strlen
argument_list|(
name|lo
operator|->
name|name
index|[
name|i
index|]
argument_list|)
init|;
name|j
operator|<
name|lo
operator|->
name|w
operator|-
literal|2
condition|;
name|j
operator|++
control|)
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
block|}
block|}
name|wattrset
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|item_attr
argument_list|)
expr_stmt|;
while|while
condition|(
name|i
operator|<
name|lo
operator|->
name|scroll
operator|+
name|h
condition|)
block|{
name|wmove
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|y
operator|+
name|i
operator|-
name|lo
operator|->
name|scroll
argument_list|,
name|x
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|lo
operator|->
name|w
operator|-
literal|2
condition|;
name|j
operator|++
control|)
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_comment
comment|/* DrawNames() */
end_comment

begin_function
name|void
name|RefreshListObj
parameter_list|(
name|ListObj
modifier|*
name|lo
parameter_list|)
comment|/*  * Desc: redraw the list object  */
block|{
name|char
name|perc
index|[
literal|7
index|]
decl_stmt|;
comment|/* setup the box */
name|wmove
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|lo
operator|->
name|y
argument_list|,
name|lo
operator|->
name|x
operator|+
literal|1
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|dialog_attr
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|lo
operator|->
name|title
argument_list|)
expr_stmt|;
name|draw_box
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|lo
operator|->
name|y
operator|+
literal|1
argument_list|,
name|lo
operator|->
name|x
argument_list|,
name|lo
operator|->
name|h
argument_list|,
name|lo
operator|->
name|w
argument_list|,
name|dialog_attr
argument_list|,
name|border_attr
argument_list|)
expr_stmt|;
comment|/* draw the names */
name|DrawNames
argument_list|(
name|lo
argument_list|)
expr_stmt|;
comment|/* Draw % indication */
name|sprintf
argument_list|(
name|perc
argument_list|,
literal|"(%3d%%)"
argument_list|,
name|MIN
argument_list|(
literal|100
argument_list|,
call|(
name|int
call|)
argument_list|(
literal|100
operator|*
operator|(
name|lo
operator|->
name|sel
operator|+
name|lo
operator|->
name|h
operator|-
literal|2
operator|)
operator|/
name|MAX
argument_list|(
literal|1
argument_list|,
name|lo
operator|->
name|n
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|lo
operator|->
name|y
operator|+
name|lo
operator|->
name|h
argument_list|,
name|lo
operator|->
name|x
operator|+
name|lo
operator|->
name|w
operator|-
literal|8
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|dialog_attr
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|perc
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* RefreshListObj() */
end_comment

begin_function
name|ListObj
modifier|*
name|NewListObj
parameter_list|(
name|WINDOW
modifier|*
name|win
parameter_list|,
name|char
modifier|*
name|title
parameter_list|,
name|char
modifier|*
modifier|*
name|list
parameter_list|,
name|char
modifier|*
name|listelt
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|h
parameter_list|,
name|int
name|w
parameter_list|,
name|int
name|n
parameter_list|)
comment|/*  * Desc: create a listobj, draw it on the screen and return a pointer to it.  */
block|{
name|ListObj
modifier|*
name|lo
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/* Initialize a new object */
name|lo
operator|=
operator|(
name|ListObj
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|ListObj
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|lo
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"NewListObj: Error malloc'ing ListObj\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|lo
operator|->
name|title
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|strlen
argument_list|(
name|title
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|lo
operator|->
name|title
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"NewListObj: Error malloc'ing lo->title\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|lo
operator|->
name|title
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|lo
operator|->
name|name
operator|=
name|list
expr_stmt|;
if|if
condition|(
name|n
operator|>
literal|0
condition|)
block|{
name|lo
operator|->
name|seld
operator|=
operator|(
name|int
operator|*
operator|)
name|malloc
argument_list|(
name|n
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|lo
operator|->
name|seld
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"NewListObj: Error malloc'ing lo->seld\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n
condition|;
name|i
operator|++
control|)
block|{
name|lo
operator|->
name|seld
index|[
name|i
index|]
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
else|else
block|{
name|lo
operator|->
name|seld
operator|=
name|NULL
expr_stmt|;
block|}
name|lo
operator|->
name|y
operator|=
name|y
expr_stmt|;
name|lo
operator|->
name|x
operator|=
name|x
expr_stmt|;
name|lo
operator|->
name|w
operator|=
name|w
expr_stmt|;
name|lo
operator|->
name|h
operator|=
name|h
expr_stmt|;
name|lo
operator|->
name|n
operator|=
name|n
expr_stmt|;
name|lo
operator|->
name|scroll
operator|=
literal|0
expr_stmt|;
name|lo
operator|->
name|sel
operator|=
literal|0
expr_stmt|;
name|lo
operator|->
name|elt
operator|=
name|listelt
expr_stmt|;
name|lo
operator|->
name|win
operator|=
name|win
expr_stmt|;
comment|/* Draw the object on the screen */
name|RefreshListObj
argument_list|(
name|lo
argument_list|)
expr_stmt|;
return|return
operator|(
name|lo
operator|)
return|;
block|}
end_function

begin_comment
comment|/* NewListObj() */
end_comment

begin_function
name|void
name|UpdateListObj
parameter_list|(
name|ListObj
modifier|*
name|lo
parameter_list|,
name|char
modifier|*
modifier|*
name|list
parameter_list|,
name|int
name|n
parameter_list|)
comment|/*  * Desc: Update the list in the listobject with the provided list  * Pre:  lo->name "has been freed"  *	 "(A i: 0<=i<lo->n: "lo->name[i] has been freed")"  */
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
name|lo
operator|->
name|seld
condition|)
block|{
name|free
argument_list|(
name|lo
operator|->
name|seld
argument_list|)
expr_stmt|;
block|}
comment|/* Rewrite the list in the object */
name|lo
operator|->
name|name
operator|=
name|list
expr_stmt|;
if|if
condition|(
name|n
operator|>
literal|0
condition|)
block|{
name|lo
operator|->
name|seld
operator|=
operator|(
name|int
operator|*
operator|)
name|malloc
argument_list|(
name|n
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|lo
operator|->
name|seld
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"UpdateListObj: Error malloc'ing lo->seld\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n
condition|;
name|i
operator|++
control|)
block|{
name|lo
operator|->
name|seld
index|[
name|i
index|]
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
else|else
block|{
name|lo
operator|->
name|seld
operator|=
name|NULL
expr_stmt|;
block|}
name|lo
operator|->
name|n
operator|=
name|n
expr_stmt|;
name|lo
operator|->
name|scroll
operator|=
literal|0
expr_stmt|;
name|lo
operator|->
name|sel
operator|=
literal|0
expr_stmt|;
comment|/* Draw the object on the screen */
name|RefreshListObj
argument_list|(
name|lo
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* UpdateListObj() */
end_comment

begin_function
name|int
name|SelectListObj
parameter_list|(
name|ListObj
modifier|*
name|lo
parameter_list|)
comment|/*  * Desc: get a listname (or listnames), TAB to move on, or ESC ESC to exit  * Pre:	 lo->n>= 1  */
block|{
name|int
name|key
decl_stmt|,
name|sel_x
decl_stmt|,
name|sel_y
decl_stmt|,
name|quit
decl_stmt|;
name|char
name|tmp
index|[
name|MAXPATHLEN
index|]
decl_stmt|;
name|char
name|perc
index|[
literal|4
index|]
decl_stmt|;
name|sel_x
operator|=
name|lo
operator|->
name|x
operator|+
literal|1
expr_stmt|;
name|sel_y
operator|=
name|lo
operator|->
name|y
operator|+
literal|2
operator|+
name|lo
operator|->
name|sel
operator|-
name|lo
operator|->
name|scroll
expr_stmt|;
if|if
condition|(
name|lo
operator|->
name|n
operator|==
literal|0
condition|)
return|return
operator|(
name|SEL_TAB
operator|)
return|;
name|keypad
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
comment|/* Draw current selection in inverse video */
name|wmove
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|sel_y
argument_list|,
name|sel_x
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|item_selected_attr
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|lo
operator|->
name|name
index|[
name|lo
operator|->
name|sel
index|]
argument_list|)
expr_stmt|;
name|key
operator|=
name|wgetch
argument_list|(
name|lo
operator|->
name|win
argument_list|)
expr_stmt|;
name|quit
operator|=
name|FALSE
expr_stmt|;
while|while
condition|(
operator|(
name|key
operator|!=
literal|'\t'
operator|)
operator|&&
operator|(
name|key
operator|!=
literal|'\n'
operator|)
operator|&&
operator|(
name|key
operator|!=
literal|'\r'
operator|)
operator|&&
operator|(
name|key
operator|!=
name|ESC
operator|)
operator|&&
operator|(
name|key
operator|!=
name|KEY_F
argument_list|(
literal|1
argument_list|)
operator|)
operator|&&
operator|(
name|key
operator|!=
literal|'?'
operator|)
operator|&&
operator|!
name|quit
condition|)
block|{
comment|/* first draw current item in normal video */
name|wmove
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|sel_y
argument_list|,
name|sel_x
argument_list|)
expr_stmt|;
if|if
condition|(
name|lo
operator|->
name|seld
index|[
name|lo
operator|->
name|sel
index|]
condition|)
block|{
name|wattrset
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|A_BOLD
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|wattrset
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|item_attr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|strlen
argument_list|(
name|lo
operator|->
name|name
index|[
name|lo
operator|->
name|sel
index|]
argument_list|)
operator|>
name|lo
operator|->
name|w
operator|-
literal|2
condition|)
block|{
name|strncpy
argument_list|(
name|tmp
argument_list|,
name|lo
operator|->
name|name
index|[
name|lo
operator|->
name|sel
index|]
argument_list|,
name|lo
operator|->
name|w
operator|-
literal|2
argument_list|)
expr_stmt|;
name|tmp
index|[
name|lo
operator|->
name|w
operator|-
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|lo
operator|->
name|name
index|[
name|lo
operator|->
name|sel
index|]
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|key
condition|)
block|{
case|case
name|KEY_DOWN
case|:
case|case
name|ctrl
argument_list|(
literal|'n'
argument_list|)
case|:
if|if
condition|(
name|sel_y
operator|<
name|lo
operator|->
name|y
operator|+
name|lo
operator|->
name|h
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|lo
operator|->
name|sel
operator|<
name|lo
operator|->
name|n
operator|-
literal|1
condition|)
block|{
name|sel_y
operator|++
expr_stmt|;
name|lo
operator|->
name|sel
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|lo
operator|->
name|sel
operator|<
name|lo
operator|->
name|n
operator|-
literal|1
condition|)
block|{
name|lo
operator|->
name|sel
operator|++
expr_stmt|;
name|lo
operator|->
name|scroll
operator|++
expr_stmt|;
name|DrawNames
argument_list|(
name|lo
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|lo
operator|->
name|win
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|KEY_UP
case|:
case|case
name|ctrl
argument_list|(
literal|'p'
argument_list|)
case|:
if|if
condition|(
name|sel_y
operator|>
name|lo
operator|->
name|y
operator|+
literal|2
condition|)
block|{
if|if
condition|(
name|lo
operator|->
name|sel
operator|>
literal|0
condition|)
block|{
name|sel_y
operator|--
expr_stmt|;
name|lo
operator|->
name|sel
operator|--
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|lo
operator|->
name|sel
operator|>
literal|0
condition|)
block|{
name|lo
operator|->
name|sel
operator|--
expr_stmt|;
name|lo
operator|->
name|scroll
operator|--
expr_stmt|;
name|DrawNames
argument_list|(
name|lo
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|lo
operator|->
name|win
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|KEY_HOME
case|:
case|case
name|ctrl
argument_list|(
literal|'a'
argument_list|)
case|:
name|lo
operator|->
name|sel
operator|=
literal|0
expr_stmt|;
name|lo
operator|->
name|scroll
operator|=
literal|0
expr_stmt|;
name|sel_y
operator|=
name|lo
operator|->
name|y
operator|+
literal|2
expr_stmt|;
name|DrawNames
argument_list|(
name|lo
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|lo
operator|->
name|win
argument_list|)
expr_stmt|;
break|break;
case|case
name|KEY_END
case|:
case|case
name|ctrl
argument_list|(
literal|'e'
argument_list|)
case|:
if|if
condition|(
name|lo
operator|->
name|n
operator|<
name|lo
operator|->
name|h
operator|-
literal|3
condition|)
block|{
name|lo
operator|->
name|sel
operator|=
name|lo
operator|->
name|n
operator|-
literal|1
expr_stmt|;
name|lo
operator|->
name|scroll
operator|=
literal|0
expr_stmt|;
name|sel_y
operator|=
name|lo
operator|->
name|y
operator|+
literal|2
operator|+
name|lo
operator|->
name|sel
operator|-
name|lo
operator|->
name|scroll
expr_stmt|;
block|}
else|else
block|{
comment|/* more than one page of list */
name|lo
operator|->
name|sel
operator|=
name|lo
operator|->
name|n
operator|-
literal|1
expr_stmt|;
name|lo
operator|->
name|scroll
operator|=
name|lo
operator|->
name|n
operator|-
literal|1
operator|-
operator|(
name|lo
operator|->
name|h
operator|-
literal|3
operator|)
expr_stmt|;
name|sel_y
operator|=
name|lo
operator|->
name|y
operator|+
literal|2
operator|+
name|lo
operator|->
name|sel
operator|-
name|lo
operator|->
name|scroll
expr_stmt|;
name|DrawNames
argument_list|(
name|lo
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|lo
operator|->
name|win
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|KEY_NPAGE
case|:
case|case
name|ctrl
argument_list|(
literal|'f'
argument_list|)
case|:
name|lo
operator|->
name|sel
operator|+=
name|lo
operator|->
name|h
operator|-
literal|2
expr_stmt|;
if|if
condition|(
name|lo
operator|->
name|sel
operator|>=
name|lo
operator|->
name|n
condition|)
name|lo
operator|->
name|sel
operator|=
name|lo
operator|->
name|n
operator|-
literal|1
expr_stmt|;
name|lo
operator|->
name|scroll
operator|+=
name|lo
operator|->
name|h
operator|-
literal|2
expr_stmt|;
if|if
condition|(
name|lo
operator|->
name|scroll
operator|>=
name|lo
operator|->
name|n
operator|-
literal|1
condition|)
name|lo
operator|->
name|scroll
operator|=
name|lo
operator|->
name|n
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|lo
operator|->
name|scroll
operator|<
literal|0
condition|)
name|lo
operator|->
name|scroll
operator|=
literal|0
expr_stmt|;
name|sel_y
operator|=
name|lo
operator|->
name|y
operator|+
literal|2
operator|+
name|lo
operator|->
name|sel
operator|-
name|lo
operator|->
name|scroll
expr_stmt|;
name|DrawNames
argument_list|(
name|lo
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|lo
operator|->
name|win
argument_list|)
expr_stmt|;
break|break;
case|case
name|KEY_PPAGE
case|:
case|case
name|ctrl
argument_list|(
literal|'b'
argument_list|)
case|:
name|lo
operator|->
name|sel
operator|-=
name|lo
operator|->
name|h
operator|-
literal|2
expr_stmt|;
if|if
condition|(
name|lo
operator|->
name|sel
operator|<
literal|0
condition|)
name|lo
operator|->
name|sel
operator|=
literal|0
expr_stmt|;
name|lo
operator|->
name|scroll
operator|-=
name|lo
operator|->
name|h
operator|-
literal|2
expr_stmt|;
if|if
condition|(
name|lo
operator|->
name|scroll
operator|<
literal|0
condition|)
name|lo
operator|->
name|scroll
operator|=
literal|0
expr_stmt|;
name|sel_y
operator|=
name|lo
operator|->
name|y
operator|+
literal|2
operator|+
name|lo
operator|->
name|sel
operator|-
name|lo
operator|->
name|scroll
expr_stmt|;
name|DrawNames
argument_list|(
name|lo
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|lo
operator|->
name|win
argument_list|)
expr_stmt|;
break|break;
default|default:
name|quit
operator|=
name|TRUE
expr_stmt|;
break|break;
block|}
comment|/* Draw % indication */
name|sprintf
argument_list|(
name|perc
argument_list|,
literal|"(%3d%%)"
argument_list|,
name|MIN
argument_list|(
literal|100
argument_list|,
call|(
name|int
call|)
argument_list|(
literal|100
operator|*
operator|(
name|lo
operator|->
name|sel
operator|+
name|lo
operator|->
name|h
operator|-
literal|2
operator|)
operator|/
name|MAX
argument_list|(
literal|1
argument_list|,
name|lo
operator|->
name|n
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|lo
operator|->
name|y
operator|+
name|lo
operator|->
name|h
argument_list|,
name|lo
operator|->
name|x
operator|+
name|lo
operator|->
name|w
operator|-
literal|8
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|dialog_attr
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|perc
argument_list|)
expr_stmt|;
comment|/* draw current item in inverse */
name|wmove
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|sel_y
argument_list|,
name|sel_x
argument_list|)
expr_stmt|;
name|wattrset
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|item_selected_attr
argument_list|)
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|lo
operator|->
name|name
index|[
name|lo
operator|->
name|sel
index|]
argument_list|)
operator|>
name|lo
operator|->
name|w
operator|-
literal|2
condition|)
block|{
comment|/* when printing in inverse video show the last characters in the */
comment|/* name that will fit in the window */
name|strncpy
argument_list|(
name|tmp
argument_list|,
name|lo
operator|->
name|name
index|[
name|lo
operator|->
name|sel
index|]
operator|+
name|strlen
argument_list|(
name|lo
operator|->
name|name
index|[
name|lo
operator|->
name|sel
index|]
argument_list|)
operator|-
operator|(
name|lo
operator|->
name|w
operator|-
literal|2
operator|)
argument_list|,
name|lo
operator|->
name|w
operator|-
literal|2
argument_list|)
expr_stmt|;
name|tmp
index|[
name|lo
operator|->
name|w
operator|-
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|waddstr
argument_list|(
name|lo
operator|->
name|win
argument_list|,
name|lo
operator|->
name|name
index|[
name|lo
operator|->
name|sel
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|quit
condition|)
name|key
operator|=
name|wgetch
argument_list|(
name|lo
operator|->
name|win
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|key
operator|==
name|ESC
condition|)
block|{
return|return
operator|(
name|SEL_ESC
operator|)
return|;
block|}
if|if
condition|(
name|key
operator|==
literal|'\t'
condition|)
block|{
return|return
operator|(
name|SEL_TAB
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|key
operator|==
name|KEY_BTAB
operator|)
operator|||
operator|(
name|key
operator|==
name|ctrl
argument_list|(
literal|'b'
argument_list|)
operator|)
condition|)
block|{
return|return
operator|(
name|SEL_BACKTAB
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|key
operator|==
literal|'\n'
operator|)
operator|||
operator|(
name|key
operator|==
literal|'\r'
operator|)
condition|)
block|{
name|strcpy
argument_list|(
name|lo
operator|->
name|elt
argument_list|,
name|lo
operator|->
name|name
index|[
name|lo
operator|->
name|sel
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
name|SEL_CR
operator|)
return|;
block|}
return|return
operator|(
name|key
operator|)
return|;
block|}
end_function

begin_comment
comment|/* SelectListObj() */
end_comment

begin_function
name|void
name|DelListObj
parameter_list|(
name|ListObj
modifier|*
name|lo
parameter_list|)
comment|/*  * Desc: Free the space occupied by the listobject  */
block|{
name|free
argument_list|(
name|lo
operator|->
name|title
argument_list|)
expr_stmt|;
if|if
condition|(
name|lo
operator|->
name|seld
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|lo
operator|->
name|seld
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|lo
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* DelListObj() */
end_comment

begin_function
name|void
name|MarkCurrentListObj
parameter_list|(
name|ListObj
modifier|*
name|lo
parameter_list|)
comment|/*  * Desc: mark the current item for the selection list  */
block|{
name|lo
operator|->
name|seld
index|[
name|lo
operator|->
name|sel
index|]
operator|=
operator|!
operator|(
name|lo
operator|->
name|seld
index|[
name|lo
operator|->
name|sel
index|]
operator|)
expr_stmt|;
name|DrawNames
argument_list|(
name|lo
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* MarkCurrentListObj() */
end_comment

begin_function
name|void
name|MarkAllListObj
parameter_list|(
name|ListObj
modifier|*
name|lo
parameter_list|)
comment|/*  * Desc: mark all items  */
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|lo
operator|->
name|n
condition|;
name|i
operator|++
control|)
block|{
name|lo
operator|->
name|seld
index|[
name|i
index|]
operator|=
name|TRUE
expr_stmt|;
block|}
name|DrawNames
argument_list|(
name|lo
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* MarkAllListObj() */
end_comment

begin_function
name|void
name|UnMarkAllListObj
parameter_list|(
name|ListObj
modifier|*
name|lo
parameter_list|)
comment|/*  * Desc: unmark all items  */
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|lo
operator|->
name|n
condition|;
name|i
operator|++
control|)
block|{
name|lo
operator|->
name|seld
index|[
name|i
index|]
operator|=
name|FALSE
expr_stmt|;
block|}
name|DrawNames
argument_list|(
name|lo
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* UnMarkAllListObj() */
end_comment

begin_comment
comment|/***********************************************************************  *  * ButtonObj routines  *  ***********************************************************************/
end_comment

begin_function
name|void
name|RefreshButtonObj
parameter_list|(
name|ButtonObj
modifier|*
name|bo
parameter_list|)
comment|/*  * Desc: redraw the button  */
block|{
name|draw_box
argument_list|(
name|bo
operator|->
name|win
argument_list|,
name|bo
operator|->
name|y
argument_list|,
name|bo
operator|->
name|x
argument_list|,
literal|3
argument_list|,
name|bo
operator|->
name|w
argument_list|,
name|dialog_attr
argument_list|,
name|border_attr
argument_list|)
expr_stmt|;
name|print_button
argument_list|(
name|bo
operator|->
name|win
argument_list|,
name|bo
operator|->
name|title
argument_list|,
name|bo
operator|->
name|y
operator|+
literal|1
argument_list|,
name|bo
operator|->
name|x
operator|+
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* RefreshButtonObj() */
end_comment

begin_function
name|ButtonObj
modifier|*
name|NewButtonObj
parameter_list|(
name|WINDOW
modifier|*
name|win
parameter_list|,
name|char
modifier|*
name|title
parameter_list|,
name|int
modifier|*
name|pushed
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|x
parameter_list|)
comment|/*  * Desc: Create a new button object  */
block|{
name|ButtonObj
modifier|*
name|bo
decl_stmt|;
name|bo
operator|=
operator|(
name|ButtonObj
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|ButtonObj
argument_list|)
argument_list|)
expr_stmt|;
name|bo
operator|->
name|win
operator|=
name|win
expr_stmt|;
name|bo
operator|->
name|title
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|strlen
argument_list|(
name|title
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|bo
operator|->
name|title
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|bo
operator|->
name|x
operator|=
name|x
expr_stmt|;
name|bo
operator|->
name|y
operator|=
name|y
expr_stmt|;
name|bo
operator|->
name|w
operator|=
name|strlen
argument_list|(
name|title
argument_list|)
operator|+
literal|6
expr_stmt|;
name|bo
operator|->
name|h
operator|=
literal|3
expr_stmt|;
name|bo
operator|->
name|pushed
operator|=
name|pushed
expr_stmt|;
name|RefreshButtonObj
argument_list|(
name|bo
argument_list|)
expr_stmt|;
return|return
operator|(
name|bo
operator|)
return|;
block|}
end_function

begin_comment
comment|/* NewButtonObj() */
end_comment

begin_function
name|int
name|SelectButtonObj
parameter_list|(
name|ButtonObj
modifier|*
name|bo
parameter_list|)
comment|/*  * Desc: Wait for buttonpresses or TAB's to move on, or ESC ESC  */
block|{
name|int
name|key
decl_stmt|;
name|print_button
argument_list|(
name|bo
operator|->
name|win
argument_list|,
name|bo
operator|->
name|title
argument_list|,
name|bo
operator|->
name|y
operator|+
literal|1
argument_list|,
name|bo
operator|->
name|x
operator|+
literal|2
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|bo
operator|->
name|win
argument_list|,
name|bo
operator|->
name|y
operator|+
literal|1
argument_list|,
name|bo
operator|->
name|x
operator|+
operator|(
name|bo
operator|->
name|w
operator|/
literal|2
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|key
operator|=
name|wgetch
argument_list|(
name|bo
operator|->
name|win
argument_list|)
expr_stmt|;
name|print_button
argument_list|(
name|bo
operator|->
name|win
argument_list|,
name|bo
operator|->
name|title
argument_list|,
name|bo
operator|->
name|y
operator|+
literal|1
argument_list|,
name|bo
operator|->
name|x
operator|+
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|key
condition|)
block|{
case|case
literal|'\t'
case|:
return|return
operator|(
name|SEL_TAB
operator|)
return|;
break|break;
case|case
name|KEY_BTAB
case|:
case|case
name|ctrl
argument_list|(
literal|'b'
argument_list|)
case|:
return|return
operator|(
name|SEL_BACKTAB
operator|)
return|;
case|case
literal|'\n'
case|:
case|case
literal|'\r'
case|:
operator|*
operator|(
name|bo
operator|->
name|pushed
operator|)
operator|=
name|TRUE
expr_stmt|;
return|return
operator|(
name|SEL_BUTTON
operator|)
return|;
break|break;
case|case
name|ESC
case|:
return|return
operator|(
name|SEL_ESC
operator|)
return|;
break|break;
default|default:
return|return
operator|(
name|key
operator|)
return|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/* SelectButtonObj() */
end_comment

begin_function
name|void
name|DelButtonObj
parameter_list|(
name|ButtonObj
modifier|*
name|bo
parameter_list|)
comment|/*  * Desc: Free the space occupied by<bo>  */
block|{
name|free
argument_list|(
name|bo
operator|->
name|title
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|bo
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* DelButtonObj() */
end_comment

end_unit

