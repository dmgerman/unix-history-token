begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_comment
comment|/* Trivial example of reading a gzip'ed file or gzip'ed standard input  * using stdio functions fread(), getc(), etc... fseek() is not supported.  * Modify according to your needs. You can easily construct the symmetric  * zwrite program.  *  * Usage: zread [file[.gz]]  * This programs assumes that gzip is somewhere in your path.  */
end_comment

begin_function
name|int
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|FILE
modifier|*
name|infile
decl_stmt|;
name|char
name|cmd
index|[
literal|256
index|]
decl_stmt|;
name|char
name|buf
index|[
name|BUFSIZ
index|]
decl_stmt|;
name|int
name|n
decl_stmt|;
if|if
condition|(
name|argc
operator|<
literal|1
operator|||
name|argc
operator|>
literal|2
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"usage: %s [file[.gz]]\n"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|cmd
argument_list|,
literal|"gzip -dc "
argument_list|)
expr_stmt|;
comment|/* use "gzip -c" for zwrite */
if|if
condition|(
name|argc
operator|==
literal|2
condition|)
block|{
name|strncat
argument_list|(
name|cmd
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|cmd
argument_list|)
operator|-
name|strlen
argument_list|(
name|cmd
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|infile
operator|=
name|popen
argument_list|(
name|cmd
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
comment|/* use "w" for zwrite */
if|if
condition|(
name|infile
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: popen('%s', 'r') failed\n"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|,
name|cmd
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* Read one byte using getc: */
name|n
operator|=
name|getc
argument_list|(
name|infile
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|==
name|EOF
condition|)
block|{
name|pclose
argument_list|(
name|infile
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|putchar
argument_list|(
name|n
argument_list|)
expr_stmt|;
comment|/* Read the rest using fread: */
for|for
control|(
init|;
condition|;
control|)
block|{
name|n
operator|=
name|fread
argument_list|(
name|buf
argument_list|,
literal|1
argument_list|,
name|BUFSIZ
argument_list|,
name|infile
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|<=
literal|0
condition|)
break|break;
name|fwrite
argument_list|(
name|buf
argument_list|,
literal|1
argument_list|,
name|n
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pclose
argument_list|(
name|infile
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: pclose failed\n"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
comment|/* just to make compiler happy */
block|}
end_function

end_unit

