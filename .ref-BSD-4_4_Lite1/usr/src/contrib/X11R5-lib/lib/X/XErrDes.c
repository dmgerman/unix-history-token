begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $XConsortium: XErrDes.c,v 11.46 92/07/23 19:17:33 rws Exp $  */
end_comment

begin_comment
comment|/*********************************************************** Copyright 1987, 1988 by Digital Equipment Corporation, Maynard, Massachusetts, and the Massachusetts Institute of Technology, Cambridge, Massachusetts.                          All Rights Reserved  Permission to use, copy, modify, and distribute this software and its  documentation for any purpose and without fee is hereby granted,  provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in  supporting documentation, and that the names of Digital or MIT not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.    DIGITAL DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL DIGITAL BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  ******************************************************************/
end_comment

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|<X11/Xos.h>
end_include

begin_include
include|#
directive|include
file|"Xresource.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|ERRORDB
end_ifndef

begin_define
define|#
directive|define
name|ERRORDB
value|"/usr/lib/X11/XErrorDB"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|__STDC__
end_if

begin_define
define|#
directive|define
name|Const
value|const
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|Const
end_define

begin_comment
comment|/**/
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * descriptions of errors in Section 4 of Protocol doc (pp. 350-351); more  * verbose descriptions are given in the error database  */
end_comment

begin_decl_stmt
specifier|static
name|Const
name|char
modifier|*
name|Const
name|_XErrorList
index|[]
init|=
block|{
comment|/* No error	*/
literal|"no error"
block|,
comment|/* BadRequest */
literal|"BadRequest"
block|,
comment|/* BadValue	*/
literal|"BadValue"
block|,
comment|/* BadWindow */
literal|"BadWindow"
block|,
comment|/* BadPixmap */
literal|"BadPixmap"
block|,
comment|/* BadAtom */
literal|"BadAtom"
block|,
comment|/* BadCursor */
literal|"BadCursor"
block|,
comment|/* BadFont */
literal|"BadFont"
block|,
comment|/* BadMatch	*/
literal|"BadMatch"
block|,
comment|/* BadDrawable */
literal|"BadDrawable"
block|,
comment|/* BadAccess */
literal|"BadAccess"
block|,
comment|/* BadAlloc	*/
literal|"BadAlloc"
block|,
comment|/* BadColor */
literal|"BadColor"
block|,
comment|/* BadGC */
literal|"BadGC"
block|,
comment|/* BadIDChoice */
literal|"BadIDChoice"
block|,
comment|/* BadName */
literal|"BadName"
block|,
comment|/* BadLength */
literal|"BadLength"
block|,
comment|/* BadImplementation */
literal|"BadImplementation"
block|, }
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|XGetErrorText
argument_list|(
name|dpy
argument_list|,
name|code
argument_list|,
name|buffer
argument_list|,
name|nbytes
argument_list|)
specifier|register
name|int
name|code
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|buffer
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nbytes
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
name|buf
index|[
literal|150
index|]
decl_stmt|;
specifier|register
name|_XExtension
modifier|*
name|ext
decl_stmt|;
name|_XExtension
modifier|*
name|bext
init|=
operator|(
name|_XExtension
operator|*
operator|)
name|NULL
decl_stmt|;
if|if
condition|(
name|nbytes
operator|==
literal|0
condition|)
return|return;
if|if
condition|(
name|code
operator|<=
name|BadImplementation
operator|&&
name|code
operator|>
literal|0
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%d"
argument_list|,
name|code
argument_list|)
expr_stmt|;
name|XGetErrorDatabaseText
argument_list|(
name|dpy
argument_list|,
literal|"XProtoError"
argument_list|,
name|buf
argument_list|,
name|_XErrorList
index|[
name|code
index|]
argument_list|,
name|buffer
argument_list|,
name|nbytes
argument_list|)
expr_stmt|;
block|}
else|else
name|buffer
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|ext
operator|=
name|dpy
operator|->
name|ext_procs
expr_stmt|;
while|while
condition|(
name|ext
condition|)
block|{
comment|/* call out to any extensions interested */
if|if
condition|(
name|ext
operator|->
name|error_string
operator|!=
name|NULL
condition|)
call|(
modifier|*
name|ext
operator|->
name|error_string
call|)
argument_list|(
name|dpy
argument_list|,
name|code
argument_list|,
operator|&
name|ext
operator|->
name|codes
argument_list|,
name|buffer
argument_list|,
name|nbytes
argument_list|)
expr_stmt|;
if|if
condition|(
name|ext
operator|->
name|codes
operator|.
name|first_error
operator|&&
name|ext
operator|->
name|codes
operator|.
name|first_error
operator|<
name|code
operator|&&
operator|(
operator|!
name|bext
operator|||
name|ext
operator|->
name|codes
operator|.
name|first_error
operator|>
name|bext
operator|->
name|codes
operator|.
name|first_error
operator|)
condition|)
name|bext
operator|=
name|ext
expr_stmt|;
name|ext
operator|=
name|ext
operator|->
name|next
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|buffer
index|[
literal|0
index|]
operator|&&
name|bext
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s.%d"
argument_list|,
name|bext
operator|->
name|name
argument_list|,
name|code
operator|-
name|bext
operator|->
name|codes
operator|.
name|first_error
argument_list|)
expr_stmt|;
name|XGetErrorDatabaseText
argument_list|(
name|dpy
argument_list|,
literal|"XProtoError"
argument_list|,
name|buf
argument_list|,
literal|""
argument_list|,
name|buffer
argument_list|,
name|nbytes
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|buffer
index|[
literal|0
index|]
condition|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%d"
argument_list|,
name|code
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_if
if|#
directive|if
name|NeedFunctionPrototypes
end_if

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|XGetErrorDatabaseText
argument_list|(
argument|Display *dpy
argument_list|,
argument|register _Xconst char *name
argument_list|,
argument|register _Xconst char *type
argument_list|,
argument|_Xconst char *defaultp
argument_list|,
argument|char *buffer
argument_list|,
argument|int nbytes
argument_list|)
end_macro

begin_else
else|#
directive|else
end_else

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|XGetErrorDatabaseText
argument_list|(
argument|dpy
argument_list|,
argument|name
argument_list|,
argument|type
argument_list|,
argument|defaultp
argument_list|,
argument|buffer
argument_list|,
argument|nbytes
argument_list|)
end_macro

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|name
decl_stmt|,
modifier|*
name|type
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|defaultp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|buffer
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nbytes
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_block
block|{
specifier|static
name|XrmDatabase
name|db
decl_stmt|;
specifier|static
name|int
name|initialized
init|=
name|False
decl_stmt|;
name|XrmString
name|type_str
decl_stmt|;
name|XrmValue
name|result
decl_stmt|;
name|char
name|temp
index|[
name|BUFSIZ
index|]
decl_stmt|;
if|if
condition|(
name|nbytes
operator|==
literal|0
condition|)
return|return;
if|if
condition|(
operator|!
name|initialized
condition|)
block|{
name|XrmInitialize
argument_list|()
expr_stmt|;
name|db
operator|=
name|XrmGetFileDatabase
argument_list|(
name|ERRORDB
argument_list|)
expr_stmt|;
name|initialized
operator|=
name|True
expr_stmt|;
block|}
if|if
condition|(
name|db
condition|)
block|{
name|sprintf
argument_list|(
name|temp
argument_list|,
literal|"%s.%s"
argument_list|,
name|name
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|XrmGetResource
argument_list|(
name|db
argument_list|,
name|temp
argument_list|,
literal|"ErrorType.ErrorNumber"
argument_list|,
operator|&
name|type_str
argument_list|,
operator|&
name|result
argument_list|)
expr_stmt|;
block|}
else|else
name|result
operator|.
name|addr
operator|=
operator|(
name|XPointer
operator|)
name|NULL
expr_stmt|;
if|if
condition|(
operator|!
name|result
operator|.
name|addr
condition|)
block|{
name|result
operator|.
name|addr
operator|=
operator|(
name|XPointer
operator|)
name|defaultp
expr_stmt|;
name|result
operator|.
name|size
operator|=
name|strlen
argument_list|(
name|defaultp
argument_list|)
operator|+
literal|1
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|buffer
argument_list|,
operator|(
name|char
operator|*
operator|)
name|result
operator|.
name|addr
argument_list|,
name|nbytes
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|.
name|size
operator|>
name|nbytes
condition|)
name|buffer
index|[
name|nbytes
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
end_block

end_unit

