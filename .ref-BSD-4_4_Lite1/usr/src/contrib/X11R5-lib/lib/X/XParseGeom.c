begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright 	Massachusetts Institute of Technology  1985, 1986, 1987 */
end_comment

begin_comment
comment|/* $XConsortium: XParseGeom.c,v 11.18 91/02/21 17:23:05 rws Exp $ */
end_comment

begin_comment
comment|/* Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty. */
end_comment

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|"Xutil.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|notdef
end_ifdef

begin_comment
comment|/*   *Returns pointer to first char ins search which is also in what, else NULL.  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|strscan
parameter_list|(
name|search
parameter_list|,
name|what
parameter_list|)
name|char
modifier|*
name|search
decl_stmt|,
decl|*
name|what
decl_stmt|;
end_function

begin_block
block|{
name|int
name|i
decl_stmt|,
name|len
init|=
name|strlen
argument_list|(
name|what
argument_list|)
decl_stmt|;
name|char
name|c
decl_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
operator|*
operator|(
name|search
operator|++
operator|)
operator|)
operator|!=
name|NULL
condition|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|c
operator|==
name|what
index|[
name|i
index|]
condition|)
return|return
operator|(
operator|--
name|search
operator|)
return|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  *    XParseGeometry parses strings of the form  *   "=<width>x<height>{+-}<xoffset>{+-}<yoffset>", where  *   width, height, xoffset, and yoffset are unsigned integers.  *   Example:  "=80x24+300-49"  *   The equal sign is optional.  *   It returns a bitmask that indicates which of the four values  *   were actually found in the string.  For each value found,  *   the corresponding argument is updated;  for each value  *   not found, the corresponding argument is left unchanged.   */
end_comment

begin_function
specifier|static
name|int
name|ReadInteger
parameter_list|(
name|string
parameter_list|,
name|NextString
parameter_list|)
specifier|register
name|char
modifier|*
name|string
decl_stmt|;
name|char
modifier|*
modifier|*
name|NextString
decl_stmt|;
block|{
specifier|register
name|int
name|Result
init|=
literal|0
decl_stmt|;
name|int
name|Sign
init|=
literal|1
decl_stmt|;
if|if
condition|(
operator|*
name|string
operator|==
literal|'+'
condition|)
name|string
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|string
operator|==
literal|'-'
condition|)
block|{
name|string
operator|++
expr_stmt|;
name|Sign
operator|=
operator|-
literal|1
expr_stmt|;
block|}
for|for
control|(
init|;
operator|(
operator|*
name|string
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|string
operator|<=
literal|'9'
operator|)
condition|;
name|string
operator|++
control|)
block|{
name|Result
operator|=
operator|(
name|Result
operator|*
literal|10
operator|)
operator|+
operator|(
operator|*
name|string
operator|-
literal|'0'
operator|)
expr_stmt|;
block|}
operator|*
name|NextString
operator|=
name|string
expr_stmt|;
if|if
condition|(
name|Sign
operator|>=
literal|0
condition|)
return|return
operator|(
name|Result
operator|)
return|;
else|else
return|return
operator|(
operator|-
name|Result
operator|)
return|;
block|}
end_function

begin_if
if|#
directive|if
name|NeedFunctionPrototypes
end_if

begin_function
name|int
name|XParseGeometry
parameter_list|(
name|_Xconst
name|char
modifier|*
name|string
parameter_list|,
name|int
modifier|*
name|x
parameter_list|,
name|int
modifier|*
name|y
parameter_list|,
name|unsigned
name|int
modifier|*
name|width
parameter_list|,
comment|/* RETURN */
name|unsigned
name|int
modifier|*
name|height
parameter_list|)
comment|/* RETURN */
else|#
directive|else
function|int XParseGeometry
parameter_list|(
name|string
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|width
parameter_list|,
name|height
parameter_list|)
name|char
modifier|*
name|string
decl_stmt|;
name|int
modifier|*
name|x
decl_stmt|,
decl|*
name|y
decl_stmt|;
end_function

begin_decl_stmt
name|unsigned
name|int
modifier|*
name|width
decl_stmt|,
modifier|*
name|height
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* RETURN */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_block
block|{
name|int
name|mask
init|=
name|NoValue
decl_stmt|;
specifier|register
name|char
modifier|*
name|strind
decl_stmt|;
name|unsigned
name|int
name|tempWidth
decl_stmt|,
name|tempHeight
decl_stmt|;
name|int
name|tempX
decl_stmt|,
name|tempY
decl_stmt|;
name|char
modifier|*
name|nextCharacter
decl_stmt|;
if|if
condition|(
operator|(
name|string
operator|==
name|NULL
operator|)
operator|||
operator|(
operator|*
name|string
operator|==
literal|'\0'
operator|)
condition|)
return|return
operator|(
name|mask
operator|)
return|;
if|if
condition|(
operator|*
name|string
operator|==
literal|'='
condition|)
name|string
operator|++
expr_stmt|;
comment|/* ignore possible '=' at beg of geometry spec */
name|strind
operator|=
operator|(
name|char
operator|*
operator|)
name|string
expr_stmt|;
if|if
condition|(
operator|*
name|strind
operator|!=
literal|'+'
operator|&&
operator|*
name|strind
operator|!=
literal|'-'
operator|&&
operator|*
name|strind
operator|!=
literal|'x'
condition|)
block|{
name|tempWidth
operator|=
name|ReadInteger
argument_list|(
name|strind
argument_list|,
operator|&
name|nextCharacter
argument_list|)
expr_stmt|;
if|if
condition|(
name|strind
operator|==
name|nextCharacter
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|strind
operator|=
name|nextCharacter
expr_stmt|;
name|mask
operator||=
name|WidthValue
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|strind
operator|==
literal|'x'
operator|||
operator|*
name|strind
operator|==
literal|'X'
condition|)
block|{
name|strind
operator|++
expr_stmt|;
name|tempHeight
operator|=
name|ReadInteger
argument_list|(
name|strind
argument_list|,
operator|&
name|nextCharacter
argument_list|)
expr_stmt|;
if|if
condition|(
name|strind
operator|==
name|nextCharacter
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|strind
operator|=
name|nextCharacter
expr_stmt|;
name|mask
operator||=
name|HeightValue
expr_stmt|;
block|}
if|if
condition|(
operator|(
operator|*
name|strind
operator|==
literal|'+'
operator|)
operator|||
operator|(
operator|*
name|strind
operator|==
literal|'-'
operator|)
condition|)
block|{
if|if
condition|(
operator|*
name|strind
operator|==
literal|'-'
condition|)
block|{
name|strind
operator|++
expr_stmt|;
name|tempX
operator|=
operator|-
name|ReadInteger
argument_list|(
name|strind
argument_list|,
operator|&
name|nextCharacter
argument_list|)
expr_stmt|;
if|if
condition|(
name|strind
operator|==
name|nextCharacter
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|strind
operator|=
name|nextCharacter
expr_stmt|;
name|mask
operator||=
name|XNegative
expr_stmt|;
block|}
else|else
block|{
name|strind
operator|++
expr_stmt|;
name|tempX
operator|=
name|ReadInteger
argument_list|(
name|strind
argument_list|,
operator|&
name|nextCharacter
argument_list|)
expr_stmt|;
if|if
condition|(
name|strind
operator|==
name|nextCharacter
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|strind
operator|=
name|nextCharacter
expr_stmt|;
block|}
name|mask
operator||=
name|XValue
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|strind
operator|==
literal|'+'
operator|)
operator|||
operator|(
operator|*
name|strind
operator|==
literal|'-'
operator|)
condition|)
block|{
if|if
condition|(
operator|*
name|strind
operator|==
literal|'-'
condition|)
block|{
name|strind
operator|++
expr_stmt|;
name|tempY
operator|=
operator|-
name|ReadInteger
argument_list|(
name|strind
argument_list|,
operator|&
name|nextCharacter
argument_list|)
expr_stmt|;
if|if
condition|(
name|strind
operator|==
name|nextCharacter
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|strind
operator|=
name|nextCharacter
expr_stmt|;
name|mask
operator||=
name|YNegative
expr_stmt|;
block|}
else|else
block|{
name|strind
operator|++
expr_stmt|;
name|tempY
operator|=
name|ReadInteger
argument_list|(
name|strind
argument_list|,
operator|&
name|nextCharacter
argument_list|)
expr_stmt|;
if|if
condition|(
name|strind
operator|==
name|nextCharacter
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|strind
operator|=
name|nextCharacter
expr_stmt|;
block|}
name|mask
operator||=
name|YValue
expr_stmt|;
block|}
block|}
comment|/* If strind isn't at the end of the string the it's an invalid 		geometry specification. */
if|if
condition|(
operator|*
name|strind
operator|!=
literal|'\0'
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|mask
operator|&
name|XValue
condition|)
operator|*
name|x
operator|=
name|tempX
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|YValue
condition|)
operator|*
name|y
operator|=
name|tempY
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|WidthValue
condition|)
operator|*
name|width
operator|=
name|tempWidth
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|HeightValue
condition|)
operator|*
name|height
operator|=
name|tempHeight
expr_stmt|;
return|return
operator|(
name|mask
operator|)
return|;
block|}
end_block

end_unit

