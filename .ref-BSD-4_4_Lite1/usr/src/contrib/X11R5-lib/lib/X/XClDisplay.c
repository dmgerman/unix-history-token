begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $XConsortium: XClDisplay.c,v 11.24 91/12/19 18:06:28 rws Exp $ */
end_comment

begin_comment
comment|/*  Copyright 1985, 1990 by the Massachusetts Institute of Technology  Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty.  */
end_comment

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_comment
comment|/*   * XCloseDisplay - XSync the connection to the X Server, close the connection,  * and free all associated storage.  Extension close procs should only free  * memory and must be careful about the types of requests they generate.  */
end_comment

begin_expr_stmt
name|XCloseDisplay
argument_list|(
name|dpy
argument_list|)
specifier|register
name|Display
operator|*
name|dpy
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|_XExtension
modifier|*
name|ext
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
specifier|extern
name|void
name|_XFreeQ
parameter_list|()
function_decl|;
if|if
condition|(
operator|!
operator|(
name|dpy
operator|->
name|flags
operator|&
name|XlibDisplayClosing
operator|)
condition|)
block|{
name|dpy
operator|->
name|flags
operator||=
name|XlibDisplayClosing
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|dpy
operator|->
name|nscreens
condition|;
name|i
operator|++
control|)
block|{
specifier|register
name|Screen
modifier|*
name|sp
init|=
operator|&
name|dpy
operator|->
name|screens
index|[
name|i
index|]
decl_stmt|;
name|XFreeGC
argument_list|(
name|dpy
argument_list|,
name|sp
operator|->
name|default_gc
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dpy
operator|->
name|cursor_font
operator|!=
name|None
condition|)
block|{
name|XUnloadFont
argument_list|(
name|dpy
argument_list|,
name|dpy
operator|->
name|cursor_font
argument_list|)
expr_stmt|;
block|}
name|ext
operator|=
name|dpy
operator|->
name|ext_procs
expr_stmt|;
while|while
condition|(
name|ext
condition|)
block|{
comment|/* call out to any extensions interested */
if|if
condition|(
name|ext
operator|->
name|close_display
operator|!=
name|NULL
condition|)
call|(
modifier|*
name|ext
operator|->
name|close_display
call|)
argument_list|(
name|dpy
argument_list|,
operator|&
name|ext
operator|->
name|codes
argument_list|)
expr_stmt|;
name|ext
operator|=
name|ext
operator|->
name|next
expr_stmt|;
block|}
name|XSync
argument_list|(
name|dpy
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* throw away pending input events */
block|}
name|_XDisconnectDisplay
argument_list|(
name|dpy
operator|->
name|fd
argument_list|)
expr_stmt|;
name|_XFreeDisplayStructure
argument_list|(
name|dpy
argument_list|)
expr_stmt|;
name|_XFreeQ
argument_list|()
expr_stmt|;
return|return;
block|}
end_block

end_unit

