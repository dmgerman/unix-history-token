begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $XConsortium: XPutImage.c,v 11.60 91/06/07 16:33:38 rws Exp $ */
end_comment

begin_comment
comment|/* Copyright    Massachusetts Institute of Technology    1986	*/
end_comment

begin_comment
comment|/* Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty. */
end_comment

begin_include
include|#
directive|include
file|<X11/Xlibint.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_if
if|#
directive|if
name|__STDC__
end_if

begin_define
define|#
directive|define
name|Const
value|const
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|Const
end_define

begin_comment
comment|/**/
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* assumes pad is a power of 2 */
end_comment

begin_define
define|#
directive|define
name|ROUNDUP
parameter_list|(
name|nbytes
parameter_list|,
name|pad
parameter_list|)
value|(((nbytes) + ((pad) - 1))& ~(long)((pad) - 1))
end_define

begin_decl_stmt
specifier|static
name|unsigned
name|char
name|Const
name|_reverse_byte
index|[
literal|0x100
index|]
init|=
block|{
literal|0x00
block|,
literal|0x80
block|,
literal|0x40
block|,
literal|0xc0
block|,
literal|0x20
block|,
literal|0xa0
block|,
literal|0x60
block|,
literal|0xe0
block|,
literal|0x10
block|,
literal|0x90
block|,
literal|0x50
block|,
literal|0xd0
block|,
literal|0x30
block|,
literal|0xb0
block|,
literal|0x70
block|,
literal|0xf0
block|,
literal|0x08
block|,
literal|0x88
block|,
literal|0x48
block|,
literal|0xc8
block|,
literal|0x28
block|,
literal|0xa8
block|,
literal|0x68
block|,
literal|0xe8
block|,
literal|0x18
block|,
literal|0x98
block|,
literal|0x58
block|,
literal|0xd8
block|,
literal|0x38
block|,
literal|0xb8
block|,
literal|0x78
block|,
literal|0xf8
block|,
literal|0x04
block|,
literal|0x84
block|,
literal|0x44
block|,
literal|0xc4
block|,
literal|0x24
block|,
literal|0xa4
block|,
literal|0x64
block|,
literal|0xe4
block|,
literal|0x14
block|,
literal|0x94
block|,
literal|0x54
block|,
literal|0xd4
block|,
literal|0x34
block|,
literal|0xb4
block|,
literal|0x74
block|,
literal|0xf4
block|,
literal|0x0c
block|,
literal|0x8c
block|,
literal|0x4c
block|,
literal|0xcc
block|,
literal|0x2c
block|,
literal|0xac
block|,
literal|0x6c
block|,
literal|0xec
block|,
literal|0x1c
block|,
literal|0x9c
block|,
literal|0x5c
block|,
literal|0xdc
block|,
literal|0x3c
block|,
literal|0xbc
block|,
literal|0x7c
block|,
literal|0xfc
block|,
literal|0x02
block|,
literal|0x82
block|,
literal|0x42
block|,
literal|0xc2
block|,
literal|0x22
block|,
literal|0xa2
block|,
literal|0x62
block|,
literal|0xe2
block|,
literal|0x12
block|,
literal|0x92
block|,
literal|0x52
block|,
literal|0xd2
block|,
literal|0x32
block|,
literal|0xb2
block|,
literal|0x72
block|,
literal|0xf2
block|,
literal|0x0a
block|,
literal|0x8a
block|,
literal|0x4a
block|,
literal|0xca
block|,
literal|0x2a
block|,
literal|0xaa
block|,
literal|0x6a
block|,
literal|0xea
block|,
literal|0x1a
block|,
literal|0x9a
block|,
literal|0x5a
block|,
literal|0xda
block|,
literal|0x3a
block|,
literal|0xba
block|,
literal|0x7a
block|,
literal|0xfa
block|,
literal|0x06
block|,
literal|0x86
block|,
literal|0x46
block|,
literal|0xc6
block|,
literal|0x26
block|,
literal|0xa6
block|,
literal|0x66
block|,
literal|0xe6
block|,
literal|0x16
block|,
literal|0x96
block|,
literal|0x56
block|,
literal|0xd6
block|,
literal|0x36
block|,
literal|0xb6
block|,
literal|0x76
block|,
literal|0xf6
block|,
literal|0x0e
block|,
literal|0x8e
block|,
literal|0x4e
block|,
literal|0xce
block|,
literal|0x2e
block|,
literal|0xae
block|,
literal|0x6e
block|,
literal|0xee
block|,
literal|0x1e
block|,
literal|0x9e
block|,
literal|0x5e
block|,
literal|0xde
block|,
literal|0x3e
block|,
literal|0xbe
block|,
literal|0x7e
block|,
literal|0xfe
block|,
literal|0x01
block|,
literal|0x81
block|,
literal|0x41
block|,
literal|0xc1
block|,
literal|0x21
block|,
literal|0xa1
block|,
literal|0x61
block|,
literal|0xe1
block|,
literal|0x11
block|,
literal|0x91
block|,
literal|0x51
block|,
literal|0xd1
block|,
literal|0x31
block|,
literal|0xb1
block|,
literal|0x71
block|,
literal|0xf1
block|,
literal|0x09
block|,
literal|0x89
block|,
literal|0x49
block|,
literal|0xc9
block|,
literal|0x29
block|,
literal|0xa9
block|,
literal|0x69
block|,
literal|0xe9
block|,
literal|0x19
block|,
literal|0x99
block|,
literal|0x59
block|,
literal|0xd9
block|,
literal|0x39
block|,
literal|0xb9
block|,
literal|0x79
block|,
literal|0xf9
block|,
literal|0x05
block|,
literal|0x85
block|,
literal|0x45
block|,
literal|0xc5
block|,
literal|0x25
block|,
literal|0xa5
block|,
literal|0x65
block|,
literal|0xe5
block|,
literal|0x15
block|,
literal|0x95
block|,
literal|0x55
block|,
literal|0xd5
block|,
literal|0x35
block|,
literal|0xb5
block|,
literal|0x75
block|,
literal|0xf5
block|,
literal|0x0d
block|,
literal|0x8d
block|,
literal|0x4d
block|,
literal|0xcd
block|,
literal|0x2d
block|,
literal|0xad
block|,
literal|0x6d
block|,
literal|0xed
block|,
literal|0x1d
block|,
literal|0x9d
block|,
literal|0x5d
block|,
literal|0xdd
block|,
literal|0x3d
block|,
literal|0xbd
block|,
literal|0x7d
block|,
literal|0xfd
block|,
literal|0x03
block|,
literal|0x83
block|,
literal|0x43
block|,
literal|0xc3
block|,
literal|0x23
block|,
literal|0xa3
block|,
literal|0x63
block|,
literal|0xe3
block|,
literal|0x13
block|,
literal|0x93
block|,
literal|0x53
block|,
literal|0xd3
block|,
literal|0x33
block|,
literal|0xb3
block|,
literal|0x73
block|,
literal|0xf3
block|,
literal|0x0b
block|,
literal|0x8b
block|,
literal|0x4b
block|,
literal|0xcb
block|,
literal|0x2b
block|,
literal|0xab
block|,
literal|0x6b
block|,
literal|0xeb
block|,
literal|0x1b
block|,
literal|0x9b
block|,
literal|0x5b
block|,
literal|0xdb
block|,
literal|0x3b
block|,
literal|0xbb
block|,
literal|0x7b
block|,
literal|0xfb
block|,
literal|0x07
block|,
literal|0x87
block|,
literal|0x47
block|,
literal|0xc7
block|,
literal|0x27
block|,
literal|0xa7
block|,
literal|0x67
block|,
literal|0xe7
block|,
literal|0x17
block|,
literal|0x97
block|,
literal|0x57
block|,
literal|0xd7
block|,
literal|0x37
block|,
literal|0xb7
block|,
literal|0x77
block|,
literal|0xf7
block|,
literal|0x0f
block|,
literal|0x8f
block|,
literal|0x4f
block|,
literal|0xcf
block|,
literal|0x2f
block|,
literal|0xaf
block|,
literal|0x6f
block|,
literal|0xef
block|,
literal|0x1f
block|,
literal|0x9f
block|,
literal|0x5f
block|,
literal|0xdf
block|,
literal|0x3f
block|,
literal|0xbf
block|,
literal|0x7f
block|,
literal|0xff
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|unsigned
name|char
name|Const
name|_reverse_nibs
index|[
literal|0x100
index|]
init|=
block|{
literal|0x00
block|,
literal|0x10
block|,
literal|0x20
block|,
literal|0x30
block|,
literal|0x40
block|,
literal|0x50
block|,
literal|0x60
block|,
literal|0x70
block|,
literal|0x80
block|,
literal|0x90
block|,
literal|0xa0
block|,
literal|0xb0
block|,
literal|0xc0
block|,
literal|0xd0
block|,
literal|0xe0
block|,
literal|0xf0
block|,
literal|0x01
block|,
literal|0x11
block|,
literal|0x21
block|,
literal|0x31
block|,
literal|0x41
block|,
literal|0x51
block|,
literal|0x61
block|,
literal|0x71
block|,
literal|0x81
block|,
literal|0x91
block|,
literal|0xa1
block|,
literal|0xb1
block|,
literal|0xc1
block|,
literal|0xd1
block|,
literal|0xe1
block|,
literal|0xf1
block|,
literal|0x02
block|,
literal|0x12
block|,
literal|0x22
block|,
literal|0x32
block|,
literal|0x42
block|,
literal|0x52
block|,
literal|0x62
block|,
literal|0x72
block|,
literal|0x82
block|,
literal|0x92
block|,
literal|0xa2
block|,
literal|0xb2
block|,
literal|0xc2
block|,
literal|0xd2
block|,
literal|0xe2
block|,
literal|0xf2
block|,
literal|0x03
block|,
literal|0x13
block|,
literal|0x23
block|,
literal|0x33
block|,
literal|0x43
block|,
literal|0x53
block|,
literal|0x63
block|,
literal|0x73
block|,
literal|0x83
block|,
literal|0x93
block|,
literal|0xa3
block|,
literal|0xb3
block|,
literal|0xc3
block|,
literal|0xd3
block|,
literal|0xe3
block|,
literal|0xf3
block|,
literal|0x04
block|,
literal|0x14
block|,
literal|0x24
block|,
literal|0x34
block|,
literal|0x44
block|,
literal|0x54
block|,
literal|0x64
block|,
literal|0x74
block|,
literal|0x84
block|,
literal|0x94
block|,
literal|0xa4
block|,
literal|0xb4
block|,
literal|0xc4
block|,
literal|0xd4
block|,
literal|0xe4
block|,
literal|0xf4
block|,
literal|0x05
block|,
literal|0x15
block|,
literal|0x25
block|,
literal|0x35
block|,
literal|0x45
block|,
literal|0x55
block|,
literal|0x65
block|,
literal|0x75
block|,
literal|0x85
block|,
literal|0x95
block|,
literal|0xa5
block|,
literal|0xb5
block|,
literal|0xc5
block|,
literal|0xd5
block|,
literal|0xe5
block|,
literal|0xf5
block|,
literal|0x06
block|,
literal|0x16
block|,
literal|0x26
block|,
literal|0x36
block|,
literal|0x46
block|,
literal|0x56
block|,
literal|0x66
block|,
literal|0x76
block|,
literal|0x86
block|,
literal|0x96
block|,
literal|0xa6
block|,
literal|0xb6
block|,
literal|0xc6
block|,
literal|0xd6
block|,
literal|0xe6
block|,
literal|0xf6
block|,
literal|0x07
block|,
literal|0x17
block|,
literal|0x27
block|,
literal|0x37
block|,
literal|0x47
block|,
literal|0x57
block|,
literal|0x67
block|,
literal|0x77
block|,
literal|0x87
block|,
literal|0x97
block|,
literal|0xa7
block|,
literal|0xb7
block|,
literal|0xc7
block|,
literal|0xd7
block|,
literal|0xe7
block|,
literal|0xf7
block|,
literal|0x08
block|,
literal|0x18
block|,
literal|0x28
block|,
literal|0x38
block|,
literal|0x48
block|,
literal|0x58
block|,
literal|0x68
block|,
literal|0x78
block|,
literal|0x88
block|,
literal|0x98
block|,
literal|0xa8
block|,
literal|0xb8
block|,
literal|0xc8
block|,
literal|0xd8
block|,
literal|0xe8
block|,
literal|0xf8
block|,
literal|0x09
block|,
literal|0x19
block|,
literal|0x29
block|,
literal|0x39
block|,
literal|0x49
block|,
literal|0x59
block|,
literal|0x69
block|,
literal|0x79
block|,
literal|0x89
block|,
literal|0x99
block|,
literal|0xa9
block|,
literal|0xb9
block|,
literal|0xc9
block|,
literal|0xd9
block|,
literal|0xe9
block|,
literal|0xf9
block|,
literal|0x0a
block|,
literal|0x1a
block|,
literal|0x2a
block|,
literal|0x3a
block|,
literal|0x4a
block|,
literal|0x5a
block|,
literal|0x6a
block|,
literal|0x7a
block|,
literal|0x8a
block|,
literal|0x9a
block|,
literal|0xaa
block|,
literal|0xba
block|,
literal|0xca
block|,
literal|0xda
block|,
literal|0xea
block|,
literal|0xfa
block|,
literal|0x0b
block|,
literal|0x1b
block|,
literal|0x2b
block|,
literal|0x3b
block|,
literal|0x4b
block|,
literal|0x5b
block|,
literal|0x6b
block|,
literal|0x7b
block|,
literal|0x8b
block|,
literal|0x9b
block|,
literal|0xab
block|,
literal|0xbb
block|,
literal|0xcb
block|,
literal|0xdb
block|,
literal|0xeb
block|,
literal|0xfb
block|,
literal|0x0c
block|,
literal|0x1c
block|,
literal|0x2c
block|,
literal|0x3c
block|,
literal|0x4c
block|,
literal|0x5c
block|,
literal|0x6c
block|,
literal|0x7c
block|,
literal|0x8c
block|,
literal|0x9c
block|,
literal|0xac
block|,
literal|0xbc
block|,
literal|0xcc
block|,
literal|0xdc
block|,
literal|0xec
block|,
literal|0xfc
block|,
literal|0x0d
block|,
literal|0x1d
block|,
literal|0x2d
block|,
literal|0x3d
block|,
literal|0x4d
block|,
literal|0x5d
block|,
literal|0x6d
block|,
literal|0x7d
block|,
literal|0x8d
block|,
literal|0x9d
block|,
literal|0xad
block|,
literal|0xbd
block|,
literal|0xcd
block|,
literal|0xdd
block|,
literal|0xed
block|,
literal|0xfd
block|,
literal|0x0e
block|,
literal|0x1e
block|,
literal|0x2e
block|,
literal|0x3e
block|,
literal|0x4e
block|,
literal|0x5e
block|,
literal|0x6e
block|,
literal|0x7e
block|,
literal|0x8e
block|,
literal|0x9e
block|,
literal|0xae
block|,
literal|0xbe
block|,
literal|0xce
block|,
literal|0xde
block|,
literal|0xee
block|,
literal|0xfe
block|,
literal|0x0f
block|,
literal|0x1f
block|,
literal|0x2f
block|,
literal|0x3f
block|,
literal|0x4f
block|,
literal|0x5f
block|,
literal|0x6f
block|,
literal|0x7f
block|,
literal|0x8f
block|,
literal|0x9f
block|,
literal|0xaf
block|,
literal|0xbf
block|,
literal|0xcf
block|,
literal|0xdf
block|,
literal|0xef
block|,
literal|0xff
block|}
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|_XReverse_Bytes
argument_list|(
name|bpt
argument_list|,
name|nb
argument_list|)
specifier|register
name|unsigned
name|char
operator|*
name|bpt
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|nb
decl_stmt|;
end_decl_stmt

begin_block
block|{
do|do
block|{
operator|*
name|bpt
operator|=
name|_reverse_byte
index|[
operator|*
name|bpt
index|]
expr_stmt|;
name|bpt
operator|++
expr_stmt|;
block|}
do|while
condition|(
operator|--
name|nb
operator|>
literal|0
condition|)
do|;
return|return;
block|}
end_block

begin_comment
comment|/* XXX the following functions are declared int instead of void because various  * compilers and lints complain about later intialization of SwapFunc and/or  * (swapfunc == NoSwap) when void is used.  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|NoSwap
parameter_list|(
name|src
parameter_list|,
name|dest
parameter_list|,
name|srclen
parameter_list|,
name|srcinc
parameter_list|,
name|destinc
parameter_list|,
name|height
parameter_list|,
name|half_order
parameter_list|)
specifier|register
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
decl|*
name|dest
decl_stmt|;
end_function

begin_decl_stmt
name|long
name|srclen
decl_stmt|,
name|srcinc
decl_stmt|,
name|destinc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|half_order
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|h
init|=
name|height
decl_stmt|;
if|if
condition|(
name|srcinc
operator|==
name|destinc
condition|)
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|src
argument_list|,
operator|(
name|char
operator|*
operator|)
name|dest
argument_list|,
call|(
name|int
call|)
argument_list|(
name|srcinc
operator|*
operator|(
name|h
operator|-
literal|1
operator|)
operator|+
name|srclen
argument_list|)
argument_list|)
expr_stmt|;
else|else
for|for
control|(
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|src
argument_list|,
operator|(
name|char
operator|*
operator|)
name|dest
argument_list|,
operator|(
name|int
operator|)
name|srclen
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
specifier|static
name|int
name|SwapTwoBytes
parameter_list|(
name|src
parameter_list|,
name|dest
parameter_list|,
name|srclen
parameter_list|,
name|srcinc
parameter_list|,
name|destinc
parameter_list|,
name|height
parameter_list|,
name|half_order
parameter_list|)
specifier|register
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
decl|*
name|dest
decl_stmt|;
end_function

begin_decl_stmt
name|long
name|srclen
decl_stmt|,
name|srcinc
decl_stmt|,
name|destinc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|half_order
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|length
init|=
name|ROUNDUP
argument_list|(
name|srclen
argument_list|,
literal|2
argument_list|)
decl_stmt|;
specifier|register
name|long
name|h
decl_stmt|,
name|n
decl_stmt|;
name|srcinc
operator|-=
name|length
expr_stmt|;
name|destinc
operator|-=
name|length
expr_stmt|;
for|for
control|(
name|h
operator|=
name|height
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
block|{
if|if
condition|(
operator|(
name|h
operator|==
literal|0
operator|)
operator|&&
operator|(
name|srclen
operator|!=
name|length
operator|)
condition|)
block|{
name|length
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|half_order
operator|==
name|MSBFirst
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|1
operator|)
expr_stmt|;
else|else
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|)
expr_stmt|;
block|}
for|for
control|(
name|n
operator|=
name|length
init|;
name|n
operator|>
literal|0
condition|;
name|n
operator|-=
literal|2
operator|,
name|src
operator|+=
literal|2
control|)
block|{
operator|*
name|dest
operator|++
operator|=
operator|*
operator|(
name|src
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
operator|*
name|src
expr_stmt|;
block|}
block|}
block|}
end_block

begin_function
specifier|static
name|int
name|SwapThreeBytes
parameter_list|(
name|src
parameter_list|,
name|dest
parameter_list|,
name|srclen
parameter_list|,
name|srcinc
parameter_list|,
name|destinc
parameter_list|,
name|height
parameter_list|,
name|byte_order
parameter_list|)
specifier|register
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
decl|*
name|dest
decl_stmt|;
end_function

begin_decl_stmt
name|long
name|srclen
decl_stmt|,
name|srcinc
decl_stmt|,
name|destinc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|byte_order
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|length
init|=
operator|(
operator|(
name|srclen
operator|+
literal|2
operator|)
operator|/
literal|3
operator|)
operator|*
literal|3
decl_stmt|;
specifier|register
name|long
name|h
decl_stmt|,
name|n
decl_stmt|;
name|srcinc
operator|-=
name|length
expr_stmt|;
name|destinc
operator|-=
name|length
expr_stmt|;
for|for
control|(
name|h
operator|=
name|height
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
block|{
if|if
condition|(
operator|(
name|h
operator|==
literal|0
operator|)
operator|&&
operator|(
name|srclen
operator|!=
name|length
operator|)
condition|)
block|{
name|length
operator|-=
literal|3
expr_stmt|;
if|if
condition|(
operator|(
name|srclen
operator|-
name|length
operator|)
operator|==
literal|2
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|byte_order
operator|==
name|MSBFirst
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|2
operator|)
expr_stmt|;
else|else
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|)
expr_stmt|;
block|}
for|for
control|(
name|n
operator|=
name|length
init|;
name|n
operator|>
literal|0
condition|;
name|n
operator|-=
literal|3
operator|,
name|src
operator|+=
literal|3
control|)
block|{
operator|*
name|dest
operator|++
operator|=
operator|*
operator|(
name|src
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
operator|*
operator|(
name|src
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
operator|*
name|src
expr_stmt|;
block|}
block|}
block|}
end_block

begin_function
specifier|static
name|int
name|SwapFourBytes
parameter_list|(
name|src
parameter_list|,
name|dest
parameter_list|,
name|srclen
parameter_list|,
name|srcinc
parameter_list|,
name|destinc
parameter_list|,
name|height
parameter_list|,
name|half_order
parameter_list|)
specifier|register
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
decl|*
name|dest
decl_stmt|;
end_function

begin_decl_stmt
name|long
name|srclen
decl_stmt|,
name|srcinc
decl_stmt|,
name|destinc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|half_order
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|length
init|=
name|ROUNDUP
argument_list|(
name|srclen
argument_list|,
literal|4
argument_list|)
decl_stmt|;
specifier|register
name|long
name|h
decl_stmt|,
name|n
decl_stmt|;
name|srcinc
operator|-=
name|length
expr_stmt|;
name|destinc
operator|-=
name|length
expr_stmt|;
for|for
control|(
name|h
operator|=
name|height
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
block|{
if|if
condition|(
operator|(
name|h
operator|==
literal|0
operator|)
operator|&&
operator|(
name|srclen
operator|!=
name|length
operator|)
condition|)
block|{
name|length
operator|-=
literal|4
expr_stmt|;
if|if
condition|(
name|half_order
operator|==
name|MSBFirst
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|3
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|half_order
operator|==
name|LSBFirst
operator|)
operator|&&
operator|(
operator|(
name|srclen
operator|-
name|length
operator|)
operator|==
literal|3
operator|)
operator|)
operator|||
operator|(
operator|(
name|half_order
operator|==
name|MSBFirst
operator|)
operator|&&
operator|(
name|srclen
operator|&
literal|2
operator|)
operator|)
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|half_order
operator|==
name|MSBFirst
operator|)
operator|&&
operator|(
operator|(
name|srclen
operator|-
name|length
operator|)
operator|==
literal|3
operator|)
operator|)
operator|||
operator|(
operator|(
name|half_order
operator|==
name|LSBFirst
operator|)
operator|&&
operator|(
name|srclen
operator|&
literal|2
operator|)
operator|)
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|half_order
operator|==
name|LSBFirst
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|)
expr_stmt|;
block|}
for|for
control|(
name|n
operator|=
name|length
init|;
name|n
operator|>
literal|0
condition|;
name|n
operator|-=
literal|4
operator|,
name|src
operator|+=
literal|4
control|)
block|{
operator|*
name|dest
operator|++
operator|=
operator|*
operator|(
name|src
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
operator|*
operator|(
name|src
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
operator|*
operator|(
name|src
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
operator|*
name|src
expr_stmt|;
block|}
block|}
block|}
end_block

begin_function
specifier|static
name|int
name|SwapWords
parameter_list|(
name|src
parameter_list|,
name|dest
parameter_list|,
name|srclen
parameter_list|,
name|srcinc
parameter_list|,
name|destinc
parameter_list|,
name|height
parameter_list|,
name|half_order
parameter_list|)
specifier|register
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
decl|*
name|dest
decl_stmt|;
end_function

begin_decl_stmt
name|long
name|srclen
decl_stmt|,
name|srcinc
decl_stmt|,
name|destinc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|half_order
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|length
init|=
name|ROUNDUP
argument_list|(
name|srclen
argument_list|,
literal|4
argument_list|)
decl_stmt|;
specifier|register
name|long
name|h
decl_stmt|,
name|n
decl_stmt|;
name|srcinc
operator|-=
name|length
expr_stmt|;
name|destinc
operator|-=
name|length
expr_stmt|;
for|for
control|(
name|h
operator|=
name|height
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
block|{
if|if
condition|(
operator|(
name|h
operator|==
literal|0
operator|)
operator|&&
operator|(
name|srclen
operator|!=
name|length
operator|)
condition|)
block|{
name|length
operator|-=
literal|4
expr_stmt|;
if|if
condition|(
name|half_order
operator|==
name|MSBFirst
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|3
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|half_order
operator|==
name|LSBFirst
operator|)
operator|&&
operator|(
operator|(
name|srclen
operator|-
name|length
operator|)
operator|==
literal|3
operator|)
operator|)
operator|||
operator|(
operator|(
name|half_order
operator|==
name|MSBFirst
operator|)
operator|&&
operator|(
name|srclen
operator|&
literal|2
operator|)
operator|)
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|half_order
operator|==
name|MSBFirst
operator|)
operator|&&
operator|(
operator|(
name|srclen
operator|-
name|length
operator|)
operator|==
literal|3
operator|)
operator|)
operator|||
operator|(
operator|(
name|half_order
operator|==
name|LSBFirst
operator|)
operator|&&
operator|(
name|srclen
operator|&
literal|2
operator|)
operator|)
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|half_order
operator|==
name|LSBFirst
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|src
operator|+
name|length
operator|)
expr_stmt|;
block|}
for|for
control|(
name|n
operator|=
name|length
init|;
name|n
operator|>
literal|0
condition|;
name|n
operator|-=
literal|4
operator|,
name|src
operator|+=
literal|2
control|)
block|{
operator|*
name|dest
operator|++
operator|=
operator|*
operator|(
name|src
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
operator|*
operator|(
name|src
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
block|}
block|}
block|}
end_block

begin_function
specifier|static
name|int
name|SwapNibbles
parameter_list|(
name|src
parameter_list|,
name|dest
parameter_list|,
name|srclen
parameter_list|,
name|srcinc
parameter_list|,
name|destinc
parameter_list|,
name|height
parameter_list|)
specifier|register
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
decl|*
name|dest
decl_stmt|;
end_function

begin_decl_stmt
name|long
name|srclen
decl_stmt|,
name|srcinc
decl_stmt|,
name|destinc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|long
name|h
decl_stmt|,
name|n
decl_stmt|;
specifier|register
name|Const
name|unsigned
name|char
modifier|*
name|rev
init|=
name|_reverse_nibs
decl_stmt|;
name|srcinc
operator|-=
name|srclen
expr_stmt|;
name|destinc
operator|-=
name|srclen
expr_stmt|;
for|for
control|(
name|h
operator|=
name|height
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
for|for
control|(
name|n
operator|=
name|srclen
init|;
operator|--
name|n
operator|>=
literal|0
condition|;
control|)
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
name|src
operator|++
index|]
expr_stmt|;
block|}
end_block

begin_function
specifier|static
name|int
name|ShiftNibblesLeft
parameter_list|(
name|src
parameter_list|,
name|dest
parameter_list|,
name|srclen
parameter_list|,
name|srcinc
parameter_list|,
name|destinc
parameter_list|,
name|height
parameter_list|,
name|nibble_order
parameter_list|)
specifier|register
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
decl|*
name|dest
decl_stmt|;
end_function

begin_decl_stmt
name|long
name|srclen
decl_stmt|,
name|srcinc
decl_stmt|,
name|destinc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nibble_order
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|long
name|h
decl_stmt|,
name|n
decl_stmt|;
specifier|register
name|unsigned
name|char
name|c1
decl_stmt|,
name|c2
decl_stmt|;
name|srcinc
operator|-=
name|srclen
expr_stmt|;
name|destinc
operator|-=
name|srclen
expr_stmt|;
if|if
condition|(
name|nibble_order
operator|==
name|MSBFirst
condition|)
block|{
for|for
control|(
name|h
operator|=
name|height
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
for|for
control|(
name|n
operator|=
name|srclen
init|;
operator|--
name|n
operator|>=
literal|0
condition|;
control|)
block|{
name|c1
operator|=
operator|*
name|src
operator|++
expr_stmt|;
name|c2
operator|=
operator|*
name|src
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
operator|(
operator|(
name|c1
operator|&
literal|0x0f
operator|)
operator|<<
literal|4
operator|)
operator||
operator|(
operator|(
name|c2
operator|&
operator|(
name|unsigned
operator|)
literal|0xf0
operator|)
operator|>>
literal|4
operator|)
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|h
operator|=
name|height
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
for|for
control|(
name|n
operator|=
name|srclen
init|;
operator|--
name|n
operator|>=
literal|0
condition|;
control|)
block|{
name|c1
operator|=
operator|*
name|src
operator|++
expr_stmt|;
name|c2
operator|=
operator|*
name|src
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
operator|(
operator|(
name|c2
operator|&
literal|0x0f
operator|)
operator|<<
literal|4
operator|)
operator||
operator|(
operator|(
name|c1
operator|&
operator|(
name|unsigned
operator|)
literal|0xf0
operator|)
operator|>>
literal|4
operator|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|int
name|SwapBits
parameter_list|(
name|src
parameter_list|,
name|dest
parameter_list|,
name|srclen
parameter_list|,
name|srcinc
parameter_list|,
name|destinc
parameter_list|,
name|height
parameter_list|,
name|half_order
parameter_list|)
specifier|register
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
decl|*
name|dest
decl_stmt|;
end_function

begin_decl_stmt
name|long
name|srclen
decl_stmt|,
name|srcinc
decl_stmt|,
name|destinc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|half_order
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|long
name|h
decl_stmt|,
name|n
decl_stmt|;
specifier|register
name|Const
name|unsigned
name|char
modifier|*
name|rev
init|=
name|_reverse_byte
decl_stmt|;
name|srcinc
operator|-=
name|srclen
expr_stmt|;
name|destinc
operator|-=
name|srclen
expr_stmt|;
for|for
control|(
name|h
operator|=
name|height
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
for|for
control|(
name|n
operator|=
name|srclen
init|;
operator|--
name|n
operator|>=
literal|0
condition|;
control|)
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
name|src
operator|++
index|]
expr_stmt|;
block|}
end_block

begin_function
specifier|static
name|int
name|SwapBitsAndTwoBytes
parameter_list|(
name|src
parameter_list|,
name|dest
parameter_list|,
name|srclen
parameter_list|,
name|srcinc
parameter_list|,
name|destinc
parameter_list|,
name|height
parameter_list|,
name|half_order
parameter_list|)
specifier|register
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
decl|*
name|dest
decl_stmt|;
end_function

begin_decl_stmt
name|long
name|srclen
decl_stmt|,
name|srcinc
decl_stmt|,
name|destinc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|length
init|=
name|ROUNDUP
argument_list|(
name|srclen
argument_list|,
literal|2
argument_list|)
decl_stmt|;
specifier|register
name|long
name|h
decl_stmt|,
name|n
decl_stmt|;
specifier|register
name|Const
name|unsigned
name|char
modifier|*
name|rev
init|=
name|_reverse_byte
decl_stmt|;
name|srcinc
operator|-=
name|length
expr_stmt|;
name|destinc
operator|-=
name|length
expr_stmt|;
for|for
control|(
name|h
operator|=
name|height
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
block|{
if|if
condition|(
operator|(
name|h
operator|==
literal|0
operator|)
operator|&&
operator|(
name|srclen
operator|!=
name|length
operator|)
condition|)
block|{
name|length
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|half_order
operator|==
name|MSBFirst
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|)
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|1
operator|)
index|]
expr_stmt|;
else|else
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|1
operator|)
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
name|length
operator|)
index|]
expr_stmt|;
block|}
for|for
control|(
name|n
operator|=
name|length
init|;
name|n
operator|>
literal|0
condition|;
name|n
operator|-=
literal|2
operator|,
name|src
operator|+=
literal|2
control|)
block|{
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
literal|1
operator|)
index|]
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
name|src
index|]
expr_stmt|;
block|}
block|}
block|}
end_block

begin_function
specifier|static
name|int
name|SwapBitsAndFourBytes
parameter_list|(
name|src
parameter_list|,
name|dest
parameter_list|,
name|srclen
parameter_list|,
name|srcinc
parameter_list|,
name|destinc
parameter_list|,
name|height
parameter_list|,
name|half_order
parameter_list|)
specifier|register
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
decl|*
name|dest
decl_stmt|;
end_function

begin_decl_stmt
name|long
name|srclen
decl_stmt|,
name|srcinc
decl_stmt|,
name|destinc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|half_order
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|length
init|=
name|ROUNDUP
argument_list|(
name|srclen
argument_list|,
literal|4
argument_list|)
decl_stmt|;
specifier|register
name|long
name|h
decl_stmt|,
name|n
decl_stmt|;
specifier|register
name|Const
name|unsigned
name|char
modifier|*
name|rev
init|=
name|_reverse_byte
decl_stmt|;
name|srcinc
operator|-=
name|length
expr_stmt|;
name|destinc
operator|-=
name|length
expr_stmt|;
for|for
control|(
name|h
operator|=
name|height
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
block|{
if|if
condition|(
operator|(
name|h
operator|==
literal|0
operator|)
operator|&&
operator|(
name|srclen
operator|!=
name|length
operator|)
condition|)
block|{
name|length
operator|-=
literal|4
expr_stmt|;
if|if
condition|(
name|half_order
operator|==
name|MSBFirst
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|)
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|3
operator|)
index|]
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|half_order
operator|==
name|LSBFirst
operator|)
operator|&&
operator|(
operator|(
name|srclen
operator|-
name|length
operator|)
operator|==
literal|3
operator|)
operator|)
operator|||
operator|(
operator|(
name|half_order
operator|==
name|MSBFirst
operator|)
operator|&&
operator|(
name|srclen
operator|&
literal|2
operator|)
operator|)
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|1
operator|)
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|2
operator|)
index|]
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|half_order
operator|==
name|MSBFirst
operator|)
operator|&&
operator|(
operator|(
name|srclen
operator|-
name|length
operator|)
operator|==
literal|3
operator|)
operator|)
operator|||
operator|(
operator|(
name|half_order
operator|==
name|LSBFirst
operator|)
operator|&&
operator|(
name|srclen
operator|&
literal|2
operator|)
operator|)
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|2
operator|)
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|1
operator|)
index|]
expr_stmt|;
if|if
condition|(
name|half_order
operator|==
name|LSBFirst
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|3
operator|)
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
name|length
operator|)
index|]
expr_stmt|;
block|}
for|for
control|(
name|n
operator|=
name|length
init|;
name|n
operator|>
literal|0
condition|;
name|n
operator|-=
literal|4
operator|,
name|src
operator|+=
literal|4
control|)
block|{
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
literal|3
operator|)
index|]
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
literal|2
operator|)
index|]
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
literal|1
operator|)
index|]
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
name|src
index|]
expr_stmt|;
block|}
block|}
block|}
end_block

begin_function
specifier|static
name|int
name|SwapBitsAndWords
parameter_list|(
name|src
parameter_list|,
name|dest
parameter_list|,
name|srclen
parameter_list|,
name|srcinc
parameter_list|,
name|destinc
parameter_list|,
name|height
parameter_list|,
name|half_order
parameter_list|)
specifier|register
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
decl|*
name|dest
decl_stmt|;
end_function

begin_decl_stmt
name|long
name|srclen
decl_stmt|,
name|srcinc
decl_stmt|,
name|destinc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|half_order
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|length
init|=
name|ROUNDUP
argument_list|(
name|srclen
argument_list|,
literal|4
argument_list|)
decl_stmt|;
specifier|register
name|long
name|h
decl_stmt|,
name|n
decl_stmt|;
specifier|register
name|Const
name|unsigned
name|char
modifier|*
name|rev
init|=
name|_reverse_byte
decl_stmt|;
name|srcinc
operator|-=
name|length
expr_stmt|;
name|destinc
operator|-=
name|length
expr_stmt|;
for|for
control|(
name|h
operator|=
name|height
init|;
operator|--
name|h
operator|>=
literal|0
condition|;
name|src
operator|+=
name|srcinc
operator|,
name|dest
operator|+=
name|destinc
control|)
block|{
if|if
condition|(
operator|(
name|h
operator|==
literal|0
operator|)
operator|&&
operator|(
name|srclen
operator|!=
name|length
operator|)
condition|)
block|{
name|length
operator|-=
literal|4
expr_stmt|;
if|if
condition|(
name|half_order
operator|==
name|MSBFirst
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|1
operator|)
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|3
operator|)
index|]
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|half_order
operator|==
name|LSBFirst
operator|)
operator|&&
operator|(
operator|(
name|srclen
operator|-
name|length
operator|)
operator|==
literal|3
operator|)
operator|)
operator|||
operator|(
operator|(
name|half_order
operator|==
name|MSBFirst
operator|)
operator|&&
operator|(
name|srclen
operator|&
literal|2
operator|)
operator|)
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|)
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|2
operator|)
index|]
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|half_order
operator|==
name|MSBFirst
operator|)
operator|&&
operator|(
operator|(
name|srclen
operator|-
name|length
operator|)
operator|==
literal|3
operator|)
operator|)
operator|||
operator|(
operator|(
name|half_order
operator|==
name|LSBFirst
operator|)
operator|&&
operator|(
name|srclen
operator|&
literal|2
operator|)
operator|)
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|3
operator|)
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
name|length
operator|+
literal|1
operator|)
index|]
expr_stmt|;
if|if
condition|(
name|half_order
operator|==
name|LSBFirst
condition|)
operator|*
operator|(
name|dest
operator|+
name|length
operator|+
literal|2
operator|)
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
name|length
operator|)
index|]
expr_stmt|;
block|}
for|for
control|(
name|n
operator|=
name|length
init|;
name|n
operator|>
literal|0
condition|;
name|n
operator|-=
literal|4
operator|,
name|src
operator|+=
literal|2
control|)
block|{
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
literal|2
operator|)
index|]
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
operator|(
name|src
operator|+
literal|3
operator|)
index|]
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
name|src
operator|++
index|]
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|rev
index|[
operator|*
name|src
operator|++
index|]
expr_stmt|;
block|}
block|}
block|}
end_block

begin_comment
comment|/*  The following table gives the bit ordering within bytes (when accessed sequentially) for a scanline containing 32 bits, with bits numbered 0 to 31, where bit 0 should be leftmost on the display.  For a given byte labelled A-B, A is for the most significant bit of the byte, and B is for the least significant bit.  legend: 	1   scanline-unit = 8 	2   scanline-unit = 16 	4   scanline-unit = 32 	M   byte-order = MostSignificant 	L   byte-order = LeastSignificant 	m   bit-order = MostSignificant 	l   bit-order = LeastSignificant   format	ordering  1Mm	00-07 08-15 16-23 24-31 2Mm	00-07 08-15 16-23 24-31 4Mm	00-07 08-15 16-23 24-31 1Ml	07-00 15-08 23-16 31-24 2Ml	15-08 07-00 31-24 23-16 4Ml	31-24 23-16 15-08 07-00 1Lm	00-07 08-15 16-23 24-31 2Lm	08-15 00-07 24-31 16-23 4Lm	24-31 16-23 08-15 00-07 1Ll	07-00 15-08 23-16 31-24 2Ll	07-00 15-08 23-16 31-24 4Ll	07-00 15-08 23-16 31-24   The following table gives the required conversion between any two formats.  It is based strictly on the table above.  If you believe one, you should believe the other.  legend: 	n   no changes 	s   reverse 8-bit units within 16-bit units 	l   reverse 8-bit units within 32-bit units 	w   reverse 16-bit units within 32-bit units 	R   reverse bits within 8-bit units 	S   s+R 	L   l+R 	W   w+R  */
end_comment

begin_expr_stmt
specifier|static
name|int
argument_list|(
operator|*
name|Const
argument_list|(
name|SwapFunction
index|[
literal|12
index|]
index|[
literal|12
index|]
argument_list|)
argument_list|)
argument_list|()
operator|=
block|{
define|#
directive|define
name|n
value|NoSwap,
define|#
directive|define
name|s
value|SwapTwoBytes,
define|#
directive|define
name|l
value|SwapFourBytes,
define|#
directive|define
name|w
value|SwapWords,
define|#
directive|define
name|R
value|SwapBits,
define|#
directive|define
name|S
value|SwapBitsAndTwoBytes,
define|#
directive|define
name|L
value|SwapBitsAndFourBytes,
define|#
directive|define
name|W
value|SwapBitsAndWords,
comment|/*         1Mm 2Mm 4Mm 1Ml 2Ml 4Ml 1Lm 2Lm 4Lm 1Ll 2Ll 4Ll   */
comment|/* 1Mm */
block|{
name|n
name|n
name|n
name|R
name|S
name|L
name|n
name|s
name|l
name|R
name|R
name|R
block|}
block|,
comment|/* 2Mm */
block|{
name|n
name|n
name|n
name|R
name|S
name|L
name|n
name|s
name|l
name|R
name|R
name|R
block|}
block|,
comment|/* 4Mm */
block|{
name|n
name|n
name|n
name|R
name|S
name|L
name|n
name|s
name|l
name|R
name|R
name|R
block|}
block|,
comment|/* 1Ml */
block|{
name|R
name|R
name|R
name|n
name|s
name|l
name|R
name|S
name|L
name|n
name|n
name|n
block|}
block|,
comment|/* 2Ml */
block|{
name|S
name|S
name|S
name|s
name|n
name|w
name|S
name|R
name|W
name|s
name|s
name|s
block|}
block|,
comment|/* 4Ml */
block|{
name|L
name|L
name|L
name|l
name|w
name|n
name|L
name|W
name|R
name|l
name|l
name|l
block|}
block|,
comment|/* 1Lm */
block|{
name|n
name|n
name|n
name|R
name|S
name|L
name|n
name|s
name|l
name|R
name|R
name|R
block|}
block|,
comment|/* 2Lm */
block|{
name|s
name|s
name|s
name|S
name|R
name|W
name|s
name|n
name|w
name|S
name|S
name|S
block|}
block|,
comment|/* 4Lm */
block|{
name|l
name|l
name|l
name|L
name|W
name|R
name|l
name|w
name|n
name|L
name|L
name|L
block|}
block|,
comment|/* 1Ll */
block|{
name|R
name|R
name|R
name|n
name|s
name|l
name|R
name|S
name|L
name|n
name|n
name|n
block|}
block|,
comment|/* 2Ll */
block|{
name|R
name|R
name|R
name|n
name|s
name|l
name|R
name|S
name|L
name|n
name|n
name|n
block|}
block|,
comment|/* 4Ll */
block|{
name|R
name|R
name|R
name|n
name|s
name|l
name|R
name|S
name|L
name|n
name|n
name|n
block|}
undef|#
directive|undef
name|n
undef|#
directive|undef
name|s
undef|#
directive|undef
name|l
undef|#
directive|undef
name|w
undef|#
directive|undef
name|R
undef|#
directive|undef
name|S
undef|#
directive|undef
name|L
undef|#
directive|undef
name|W
block|}
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* Of course, the table above is a lie.  We also need to factor in the  * order of the source data to cope with swapping half of a unit at the  * end of a scanline, since we are trying to avoid de-ref'ing off the  * end of the source.  *  * Defines whether the first half of a unit has the first half of the data  */
end_comment

begin_decl_stmt
specifier|static
name|int
name|Const
name|HalfOrder
index|[
literal|12
index|]
init|=
block|{
name|LSBFirst
block|,
comment|/* 1Mm */
name|LSBFirst
block|,
comment|/* 2Mm */
name|LSBFirst
block|,
comment|/* 4Mm */
name|LSBFirst
block|,
comment|/* 1Ml */
name|MSBFirst
block|,
comment|/* 2Ml */
name|MSBFirst
block|,
comment|/* 4Ml */
name|LSBFirst
block|,
comment|/* 1Lm */
name|MSBFirst
block|,
comment|/* 2Lm */
name|MSBFirst
block|,
comment|/* 4Lm */
name|LSBFirst
block|,
comment|/* 1Ll */
name|LSBFirst
block|,
comment|/* 2Ll */
name|LSBFirst
comment|/* 4Ll */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Finally, for SwapWords cases, the half order depends not just on the source  * but also on the destination scanline unit.  Use of this table changes some  * MSBFirsts to LSBFirsts that are "do not care" (because the function will be  * NoSwap or SwapBits) in addition to changing the desired ones.  */
end_comment

begin_decl_stmt
specifier|static
name|int
name|Const
name|HalfOrderWord
index|[
literal|12
index|]
init|=
block|{
name|MSBFirst
block|,
comment|/* 1Mm */
name|MSBFirst
block|,
comment|/* 2Mm */
name|MSBFirst
block|,
comment|/* 4Mm */
name|MSBFirst
block|,
comment|/* 1Ml */
name|MSBFirst
block|,
comment|/* 2Ml */
name|LSBFirst
block|,
comment|/* 4Ml */
name|MSBFirst
block|,
comment|/* 1Lm */
name|MSBFirst
block|,
comment|/* 2Lm */
name|LSBFirst
block|,
comment|/* 4Lm */
name|MSBFirst
block|,
comment|/* 1Ll */
name|MSBFirst
block|,
comment|/* 2Ll */
name|MSBFirst
comment|/* 4Ll */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * This macro creates a value from 0 to 11 suitable for indexing  * into the table above.  */
end_comment

begin_define
define|#
directive|define
name|ComposeIndex
parameter_list|(
name|bitmap_unit
parameter_list|,
name|bitmap_bit_order
parameter_list|,
name|byte_order
parameter_list|)
define|\
value|(((bitmap_unit == 32) ? 2 : ((bitmap_unit == 16) ? 1 : 0))	\ 		     + (((bitmap_bit_order == MSBFirst) ? 0 : 3)		\ 		     + ((byte_order == MSBFirst) ? 0 : 6)))
end_define

begin_comment
comment|/* Cancel a GetReq operation, before doing _XSend or Data */
end_comment

begin_if
if|#
directive|if
name|__STDC__
operator|&&
operator|!
operator|(
name|defined
argument_list|(
name|UNIXCPP
argument_list|)
operator|)
end_if

begin_define
define|#
directive|define
name|UnGetReq
parameter_list|(
name|name
parameter_list|)
define|\
value|dpy->bufptr -= SIZEOF(x##name##Req);\     dpy->request--
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|UnGetReq
parameter_list|(
name|name
parameter_list|)
define|\
value|dpy->bufptr -= SIZEOF(x
comment|/**/
value|name
comment|/**/
value|Req);\     dpy->request--
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|SendXYImage
parameter_list|(
name|dpy
parameter_list|,
name|req
parameter_list|,
name|image
parameter_list|,
name|req_xoffset
parameter_list|,
name|req_yoffset
parameter_list|)
specifier|register
name|Display
modifier|*
name|dpy
decl_stmt|;
specifier|register
name|xPutImageReq
modifier|*
name|req
decl_stmt|;
specifier|register
name|XImage
modifier|*
name|image
decl_stmt|;
name|int
name|req_xoffset
decl_stmt|,
name|req_yoffset
decl_stmt|;
block|{
specifier|register
name|int
name|j
decl_stmt|;
name|long
name|total_xoffset
decl_stmt|,
name|bytes_per_src
decl_stmt|,
name|bytes_per_dest
decl_stmt|,
name|length
decl_stmt|;
name|long
name|bytes_per_line
decl_stmt|,
name|bytes_per_src_plane
decl_stmt|,
name|bytes_per_dest_plane
decl_stmt|;
name|char
modifier|*
name|src
decl_stmt|,
modifier|*
name|dest
decl_stmt|,
modifier|*
name|buf
decl_stmt|;
name|char
modifier|*
name|extra
init|=
operator|(
name|char
operator|*
operator|)
name|NULL
decl_stmt|;
specifier|register
name|int
function_decl|(
modifier|*
name|swapfunc
function_decl|)
parameter_list|()
function_decl|;
name|int
name|half_order
decl_stmt|;
name|total_xoffset
operator|=
name|image
operator|->
name|xoffset
operator|+
name|req_xoffset
expr_stmt|;
name|req
operator|->
name|leftPad
operator|=
name|total_xoffset
operator|&
operator|(
name|dpy
operator|->
name|bitmap_unit
operator|-
literal|1
operator|)
expr_stmt|;
name|total_xoffset
operator|=
call|(
name|unsigned
call|)
argument_list|(
name|total_xoffset
operator|-
name|req
operator|->
name|leftPad
argument_list|)
operator|>>
literal|3
expr_stmt|;
comment|/* The protocol requires left-pad of zero on all ZPixmap, even      * though the 1-bit case is identical to bitmap format.  This is a      * bug in the protocol, caused because 1-bit ZPixmap was added late      * in the game.  Hairy shifting code compensation isn't worth it,      * just use XYPixmap format instead.      */
if|if
condition|(
operator|(
name|req
operator|->
name|leftPad
operator|!=
literal|0
operator|)
operator|&&
operator|(
name|req
operator|->
name|format
operator|==
name|ZPixmap
operator|)
condition|)
name|req
operator|->
name|format
operator|=
name|XYPixmap
expr_stmt|;
name|bytes_per_dest
operator|=
operator|(
name|unsigned
name|long
operator|)
name|ROUNDUP
argument_list|(
operator|(
name|long
operator|)
name|req
operator|->
name|width
operator|+
name|req
operator|->
name|leftPad
argument_list|,
name|dpy
operator|->
name|bitmap_pad
argument_list|)
operator|>>
literal|3
expr_stmt|;
name|bytes_per_dest_plane
operator|=
name|bytes_per_dest
operator|*
name|req
operator|->
name|height
expr_stmt|;
name|length
operator|=
name|bytes_per_dest_plane
operator|*
name|image
operator|->
name|depth
expr_stmt|;
name|req
operator|->
name|length
operator|+=
operator|(
name|length
operator|+
literal|3
operator|)
operator|>>
literal|2
expr_stmt|;
name|swapfunc
operator|=
name|SwapFunction
index|[
name|ComposeIndex
argument_list|(
name|image
operator|->
name|bitmap_unit
argument_list|,
name|image
operator|->
name|bitmap_bit_order
argument_list|,
name|image
operator|->
name|byte_order
argument_list|)
index|]
index|[
name|ComposeIndex
argument_list|(
name|dpy
operator|->
name|bitmap_unit
argument_list|,
name|dpy
operator|->
name|bitmap_bit_order
argument_list|,
name|dpy
operator|->
name|byte_order
argument_list|)
index|]
expr_stmt|;
name|half_order
operator|=
name|HalfOrder
index|[
name|ComposeIndex
argument_list|(
name|image
operator|->
name|bitmap_unit
argument_list|,
name|image
operator|->
name|bitmap_bit_order
argument_list|,
name|image
operator|->
name|byte_order
argument_list|)
index|]
expr_stmt|;
if|if
condition|(
name|half_order
operator|==
name|MSBFirst
condition|)
name|half_order
operator|=
name|HalfOrderWord
index|[
name|ComposeIndex
argument_list|(
name|dpy
operator|->
name|bitmap_unit
argument_list|,
name|dpy
operator|->
name|bitmap_bit_order
argument_list|,
name|dpy
operator|->
name|byte_order
argument_list|)
index|]
expr_stmt|;
name|src
operator|=
name|image
operator|->
name|data
operator|+
operator|(
name|image
operator|->
name|bytes_per_line
operator|*
name|req_yoffset
operator|)
operator|+
name|total_xoffset
expr_stmt|;
comment|/* when total_xoffset> 0, we have to worry about stepping off the      * end of image->data.      */
if|if
condition|(
operator|(
name|swapfunc
operator|==
name|NoSwap
operator|)
operator|&&
operator|(
name|image
operator|->
name|bytes_per_line
operator|==
name|bytes_per_dest
operator|)
operator|&&
operator|(
operator|(
operator|(
name|total_xoffset
operator|==
literal|0
operator|)
operator|&&
operator|(
operator|(
name|image
operator|->
name|depth
operator|==
literal|1
operator|)
operator|||
operator|(
name|image
operator|->
name|height
operator|==
name|req
operator|->
name|height
operator|)
operator|)
operator|)
operator|||
operator|(
operator|(
name|image
operator|->
name|depth
operator|==
literal|1
operator|)
operator|&&
operator|(
operator|(
name|req_yoffset
operator|+
name|req
operator|->
name|height
operator|)
operator|<
operator|(
name|unsigned
operator|)
name|image
operator|->
name|height
operator|)
operator|)
operator|)
condition|)
block|{
name|Data
argument_list|(
name|dpy
argument_list|,
name|src
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
block|}
name|length
operator|=
name|ROUNDUP
argument_list|(
name|length
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|dpy
operator|->
name|bufptr
operator|+
name|length
operator|)
operator|>
name|dpy
operator|->
name|bufmax
condition|)
block|{
if|if
condition|(
operator|(
name|buf
operator|=
name|_XAllocScratch
argument_list|(
name|dpy
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|length
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|UnGetReq
argument_list|(
name|PutImage
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
else|else
name|buf
operator|=
name|dpy
operator|->
name|bufptr
expr_stmt|;
name|bytes_per_src
operator|=
operator|(
name|req
operator|->
name|width
operator|+
name|req
operator|->
name|leftPad
operator|+
operator|(
name|unsigned
operator|)
literal|7
operator|)
operator|>>
literal|3
expr_stmt|;
name|bytes_per_line
operator|=
name|image
operator|->
name|bytes_per_line
expr_stmt|;
name|bytes_per_src_plane
operator|=
name|bytes_per_line
operator|*
name|image
operator|->
name|height
expr_stmt|;
name|total_xoffset
operator|&=
operator|(
name|image
operator|->
name|bitmap_unit
operator|-
literal|1
operator|)
operator|>>
literal|3
expr_stmt|;
if|if
condition|(
operator|(
name|total_xoffset
operator|>
literal|0
operator|)
operator|&&
operator|(
name|image
operator|->
name|byte_order
operator|!=
name|image
operator|->
name|bitmap_bit_order
operator|)
condition|)
block|{
name|char
modifier|*
name|temp
decl_stmt|;
name|long
name|bytes_per_temp_plane
decl_stmt|,
name|temp_length
decl_stmt|;
name|bytes_per_line
operator|=
name|bytes_per_src
operator|+
name|total_xoffset
expr_stmt|;
name|src
operator|-=
name|total_xoffset
expr_stmt|;
name|bytes_per_temp_plane
operator|=
name|bytes_per_line
operator|*
name|req
operator|->
name|height
expr_stmt|;
name|temp_length
operator|=
name|ROUNDUP
argument_list|(
name|bytes_per_temp_plane
operator|*
name|image
operator|->
name|depth
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|dpy
operator|->
name|bufptr
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|temp
operator|=
name|_XAllocScratch
argument_list|(
name|dpy
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|temp_length
argument_list|)
operator|)
condition|)
block|{
name|UnGetReq
argument_list|(
name|PutImage
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|extra
operator|=
name|temp
operator|=
name|Xmalloc
argument_list|(
operator|(
name|unsigned
operator|)
name|temp_length
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|UnGetReq
argument_list|(
name|PutImage
argument_list|)
expr_stmt|;
return|return;
block|}
name|swapfunc
operator|=
name|SwapFunction
index|[
name|ComposeIndex
argument_list|(
name|image
operator|->
name|bitmap_unit
argument_list|,
name|image
operator|->
name|bitmap_bit_order
argument_list|,
name|image
operator|->
name|byte_order
argument_list|)
index|]
index|[
name|ComposeIndex
argument_list|(
name|image
operator|->
name|bitmap_unit
argument_list|,
name|dpy
operator|->
name|byte_order
argument_list|,
name|dpy
operator|->
name|byte_order
argument_list|)
index|]
expr_stmt|;
for|for
control|(
name|dest
operator|=
name|temp
operator|,
name|j
operator|=
name|image
operator|->
name|depth
init|;
operator|--
name|j
operator|>=
literal|0
condition|;
name|src
operator|+=
name|bytes_per_src_plane
operator|,
name|dest
operator|+=
name|bytes_per_temp_plane
control|)
call|(
modifier|*
name|swapfunc
call|)
argument_list|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|src
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|dest
argument_list|,
name|bytes_per_line
argument_list|,
operator|(
name|long
operator|)
name|image
operator|->
name|bytes_per_line
argument_list|,
name|bytes_per_line
argument_list|,
name|req
operator|->
name|height
argument_list|,
name|half_order
argument_list|)
expr_stmt|;
name|swapfunc
operator|=
name|SwapFunction
index|[
name|ComposeIndex
argument_list|(
name|image
operator|->
name|bitmap_unit
argument_list|,
name|dpy
operator|->
name|byte_order
argument_list|,
name|dpy
operator|->
name|byte_order
argument_list|)
index|]
index|[
name|ComposeIndex
argument_list|(
name|dpy
operator|->
name|bitmap_unit
argument_list|,
name|dpy
operator|->
name|bitmap_bit_order
argument_list|,
name|dpy
operator|->
name|byte_order
argument_list|)
index|]
expr_stmt|;
name|half_order
operator|=
name|HalfOrder
index|[
name|ComposeIndex
argument_list|(
name|image
operator|->
name|bitmap_unit
argument_list|,
name|dpy
operator|->
name|byte_order
argument_list|,
name|dpy
operator|->
name|byte_order
argument_list|)
index|]
expr_stmt|;
name|src
operator|=
name|temp
operator|+
name|total_xoffset
expr_stmt|;
name|bytes_per_src_plane
operator|=
name|bytes_per_temp_plane
expr_stmt|;
block|}
for|for
control|(
name|dest
operator|=
name|buf
operator|,
name|j
operator|=
name|image
operator|->
name|depth
init|;
operator|--
name|j
operator|>=
literal|0
condition|;
name|src
operator|+=
name|bytes_per_src_plane
operator|,
name|dest
operator|+=
name|bytes_per_dest_plane
control|)
call|(
modifier|*
name|swapfunc
call|)
argument_list|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|src
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|dest
argument_list|,
name|bytes_per_src
argument_list|,
name|bytes_per_line
argument_list|,
name|bytes_per_dest
argument_list|,
name|req
operator|->
name|height
argument_list|,
name|half_order
argument_list|)
expr_stmt|;
if|if
condition|(
name|extra
condition|)
name|Xfree
argument_list|(
name|extra
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|dpy
operator|->
name|bufptr
condition|)
name|dpy
operator|->
name|bufptr
operator|+=
name|length
expr_stmt|;
else|else
name|_XSend
argument_list|(
name|dpy
argument_list|,
name|buf
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|SendZImage
parameter_list|(
name|dpy
parameter_list|,
name|req
parameter_list|,
name|image
parameter_list|,
name|req_xoffset
parameter_list|,
name|req_yoffset
parameter_list|,
name|dest_bits_per_pixel
parameter_list|,
name|dest_scanline_pad
parameter_list|)
specifier|register
name|Display
modifier|*
name|dpy
decl_stmt|;
specifier|register
name|xPutImageReq
modifier|*
name|req
decl_stmt|;
specifier|register
name|XImage
modifier|*
name|image
decl_stmt|;
name|int
name|req_xoffset
decl_stmt|,
name|req_yoffset
decl_stmt|,
name|dest_bits_per_pixel
decl_stmt|,
name|dest_scanline_pad
decl_stmt|;
block|{
name|long
name|bytes_per_src
decl_stmt|,
name|bytes_per_dest
decl_stmt|,
name|length
decl_stmt|;
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
modifier|*
name|dest
decl_stmt|;
name|unsigned
name|char
modifier|*
name|shifted_src
init|=
name|NULL
decl_stmt|;
name|req
operator|->
name|leftPad
operator|=
literal|0
expr_stmt|;
name|bytes_per_src
operator|=
name|ROUNDUP
argument_list|(
operator|(
name|long
operator|)
name|req
operator|->
name|width
operator|*
name|image
operator|->
name|bits_per_pixel
argument_list|,
literal|8
argument_list|)
operator|>>
literal|3
expr_stmt|;
name|bytes_per_dest
operator|=
name|ROUNDUP
argument_list|(
operator|(
name|long
operator|)
name|req
operator|->
name|width
operator|*
name|dest_bits_per_pixel
argument_list|,
name|dest_scanline_pad
argument_list|)
operator|>>
literal|3
expr_stmt|;
name|length
operator|=
name|bytes_per_dest
operator|*
name|req
operator|->
name|height
expr_stmt|;
name|req
operator|->
name|length
operator|+=
operator|(
name|length
operator|+
literal|3
operator|)
operator|>>
literal|2
expr_stmt|;
name|src
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|image
operator|->
name|data
operator|+
operator|(
name|req_yoffset
operator|*
name|image
operator|->
name|bytes_per_line
operator|)
operator|+
operator|(
operator|(
name|req_xoffset
operator|*
name|image
operator|->
name|bits_per_pixel
operator|)
operator|>>
literal|3
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|image
operator|->
name|bits_per_pixel
operator|==
literal|4
operator|)
operator|&&
operator|(
operator|(
name|unsigned
name|int
operator|)
name|req_xoffset
operator|&
literal|0x01
operator|)
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|shifted_src
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|Xmalloc
argument_list|(
call|(
name|unsigned
call|)
argument_list|(
name|req
operator|->
name|height
operator|*
name|image
operator|->
name|bytes_per_line
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|UnGetReq
argument_list|(
name|PutImage
argument_list|)
expr_stmt|;
return|return;
block|}
name|ShiftNibblesLeft
argument_list|(
name|src
argument_list|,
name|shifted_src
argument_list|,
name|bytes_per_src
argument_list|,
operator|(
name|long
operator|)
name|image
operator|->
name|bytes_per_line
argument_list|,
operator|(
name|long
operator|)
name|image
operator|->
name|bytes_per_line
argument_list|,
name|req
operator|->
name|height
argument_list|,
name|image
operator|->
name|byte_order
argument_list|)
expr_stmt|;
name|src
operator|=
name|shifted_src
expr_stmt|;
block|}
comment|/* when req_xoffset> 0, we have to worry about stepping off the      * end of image->data.      */
if|if
condition|(
operator|(
operator|(
name|image
operator|->
name|byte_order
operator|==
name|dpy
operator|->
name|byte_order
operator|)
operator|||
operator|(
name|image
operator|->
name|bits_per_pixel
operator|==
literal|8
operator|)
operator|)
operator|&&
operator|(
operator|(
name|long
operator|)
name|image
operator|->
name|bytes_per_line
operator|==
name|bytes_per_dest
operator|)
operator|&&
operator|(
operator|(
name|req_xoffset
operator|==
literal|0
operator|)
operator|||
operator|(
operator|(
name|req_yoffset
operator|+
name|req
operator|->
name|height
operator|)
operator|<
operator|(
name|unsigned
operator|)
name|image
operator|->
name|height
operator|)
operator|)
condition|)
block|{
name|Data
argument_list|(
name|dpy
argument_list|,
operator|(
name|char
operator|*
operator|)
name|src
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
name|shifted_src
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|shifted_src
argument_list|)
expr_stmt|;
return|return;
block|}
name|length
operator|=
name|ROUNDUP
argument_list|(
name|length
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|dpy
operator|->
name|bufptr
operator|+
name|length
operator|)
operator|<=
name|dpy
operator|->
name|bufmax
condition|)
name|dest
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|dpy
operator|->
name|bufptr
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|dest
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|_XAllocScratch
argument_list|(
name|dpy
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|length
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|shifted_src
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|shifted_src
argument_list|)
expr_stmt|;
name|UnGetReq
argument_list|(
name|PutImage
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|(
name|image
operator|->
name|byte_order
operator|==
name|dpy
operator|->
name|byte_order
operator|)
operator|||
operator|(
name|image
operator|->
name|bits_per_pixel
operator|==
literal|8
operator|)
condition|)
name|NoSwap
argument_list|(
name|src
argument_list|,
name|dest
argument_list|,
name|bytes_per_src
argument_list|,
operator|(
name|long
operator|)
name|image
operator|->
name|bytes_per_line
argument_list|,
name|bytes_per_dest
argument_list|,
name|req
operator|->
name|height
argument_list|,
name|image
operator|->
name|byte_order
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|image
operator|->
name|bits_per_pixel
operator|==
literal|32
condition|)
name|SwapFourBytes
argument_list|(
name|src
argument_list|,
name|dest
argument_list|,
name|bytes_per_src
argument_list|,
operator|(
name|long
operator|)
name|image
operator|->
name|bytes_per_line
argument_list|,
name|bytes_per_dest
argument_list|,
name|req
operator|->
name|height
argument_list|,
name|image
operator|->
name|byte_order
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|image
operator|->
name|bits_per_pixel
operator|==
literal|24
condition|)
name|SwapThreeBytes
argument_list|(
name|src
argument_list|,
name|dest
argument_list|,
name|bytes_per_src
argument_list|,
operator|(
name|long
operator|)
name|image
operator|->
name|bytes_per_line
argument_list|,
name|bytes_per_dest
argument_list|,
name|req
operator|->
name|height
argument_list|,
name|image
operator|->
name|byte_order
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|image
operator|->
name|bits_per_pixel
operator|==
literal|16
condition|)
name|SwapTwoBytes
argument_list|(
name|src
argument_list|,
name|dest
argument_list|,
name|bytes_per_src
argument_list|,
operator|(
name|long
operator|)
name|image
operator|->
name|bytes_per_line
argument_list|,
name|bytes_per_dest
argument_list|,
name|req
operator|->
name|height
argument_list|,
name|image
operator|->
name|byte_order
argument_list|)
expr_stmt|;
else|else
name|SwapNibbles
argument_list|(
name|src
argument_list|,
name|dest
argument_list|,
name|bytes_per_src
argument_list|,
operator|(
name|long
operator|)
name|image
operator|->
name|bytes_per_line
argument_list|,
name|bytes_per_dest
argument_list|,
name|req
operator|->
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|dest
operator|==
operator|(
name|unsigned
name|char
operator|*
operator|)
name|dpy
operator|->
name|bufptr
condition|)
name|dpy
operator|->
name|bufptr
operator|+=
name|length
expr_stmt|;
else|else
name|_XSend
argument_list|(
name|dpy
argument_list|,
operator|(
name|char
operator|*
operator|)
name|dest
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
name|shifted_src
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|shifted_src
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|PutImageRequest
parameter_list|(
name|dpy
parameter_list|,
name|d
parameter_list|,
name|gc
parameter_list|,
name|image
parameter_list|,
name|req_xoffset
parameter_list|,
name|req_yoffset
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|req_width
parameter_list|,
name|req_height
parameter_list|,
name|dest_bits_per_pixel
parameter_list|,
name|dest_scanline_pad
parameter_list|)
specifier|register
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Drawable
name|d
decl_stmt|;
name|GC
name|gc
decl_stmt|;
specifier|register
name|XImage
modifier|*
name|image
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|unsigned
name|int
name|req_width
decl_stmt|,
name|req_height
decl_stmt|;
name|int
name|req_xoffset
decl_stmt|,
name|req_yoffset
decl_stmt|,
name|dest_bits_per_pixel
decl_stmt|,
name|dest_scanline_pad
decl_stmt|;
block|{
specifier|register
name|xPutImageReq
modifier|*
name|req
decl_stmt|;
name|GetReq
argument_list|(
name|PutImage
argument_list|,
name|req
argument_list|)
expr_stmt|;
name|req
operator|->
name|drawable
operator|=
name|d
expr_stmt|;
name|req
operator|->
name|gc
operator|=
name|gc
operator|->
name|gid
expr_stmt|;
name|req
operator|->
name|dstX
operator|=
name|x
expr_stmt|;
name|req
operator|->
name|dstY
operator|=
name|y
expr_stmt|;
name|req
operator|->
name|width
operator|=
name|req_width
expr_stmt|;
name|req
operator|->
name|height
operator|=
name|req_height
expr_stmt|;
name|req
operator|->
name|depth
operator|=
name|image
operator|->
name|depth
expr_stmt|;
name|req
operator|->
name|format
operator|=
name|image
operator|->
name|format
expr_stmt|;
if|if
condition|(
operator|(
name|image
operator|->
name|depth
operator|==
literal|1
operator|)
operator|||
operator|(
name|image
operator|->
name|format
operator|!=
name|ZPixmap
operator|)
condition|)
name|SendXYImage
argument_list|(
name|dpy
argument_list|,
name|req
argument_list|,
name|image
argument_list|,
name|req_xoffset
argument_list|,
name|req_yoffset
argument_list|)
expr_stmt|;
else|else
name|SendZImage
argument_list|(
name|dpy
argument_list|,
name|req
argument_list|,
name|image
argument_list|,
name|req_xoffset
argument_list|,
name|req_yoffset
argument_list|,
name|dest_bits_per_pixel
argument_list|,
name|dest_scanline_pad
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|PutSubImage
parameter_list|(
name|dpy
parameter_list|,
name|d
parameter_list|,
name|gc
parameter_list|,
name|image
parameter_list|,
name|req_xoffset
parameter_list|,
name|req_yoffset
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|req_width
parameter_list|,
name|req_height
parameter_list|,
name|dest_bits_per_pixel
parameter_list|,
name|dest_scanline_pad
parameter_list|)
specifier|register
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Drawable
name|d
decl_stmt|;
name|GC
name|gc
decl_stmt|;
specifier|register
name|XImage
modifier|*
name|image
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|unsigned
name|int
name|req_width
decl_stmt|,
name|req_height
decl_stmt|;
name|int
name|req_xoffset
decl_stmt|,
name|req_yoffset
decl_stmt|,
name|dest_bits_per_pixel
decl_stmt|,
name|dest_scanline_pad
decl_stmt|;
block|{
name|int
name|left_pad
decl_stmt|,
name|BytesPerRow
decl_stmt|,
name|Available
decl_stmt|;
if|if
condition|(
operator|(
name|req_width
operator|==
literal|0
operator|)
operator|||
operator|(
name|req_height
operator|==
literal|0
operator|)
condition|)
return|return;
name|Available
operator|=
operator|(
operator|(
literal|65536
operator|<
name|dpy
operator|->
name|max_request_size
operator|)
condition|?
operator|(
literal|65536
operator|<<
literal|2
operator|)
else|:
operator|(
name|dpy
operator|->
name|max_request_size
operator|<<
literal|2
operator|)
operator|)
operator|-
name|SIZEOF
argument_list|(
name|xPutImageReq
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|image
operator|->
name|depth
operator|==
literal|1
operator|)
operator|||
operator|(
name|image
operator|->
name|format
operator|!=
name|ZPixmap
operator|)
condition|)
block|{
name|left_pad
operator|=
operator|(
name|image
operator|->
name|xoffset
operator|+
name|req_xoffset
operator|)
operator|&
operator|(
name|dpy
operator|->
name|bitmap_unit
operator|-
literal|1
operator|)
expr_stmt|;
name|BytesPerRow
operator|=
operator|(
name|ROUNDUP
argument_list|(
operator|(
name|long
operator|)
name|req_width
operator|+
name|left_pad
argument_list|,
name|dpy
operator|->
name|bitmap_pad
argument_list|)
operator|>>
literal|3
operator|)
operator|*
name|image
operator|->
name|depth
expr_stmt|;
block|}
else|else
block|{
name|left_pad
operator|=
literal|0
expr_stmt|;
name|BytesPerRow
operator|=
name|ROUNDUP
argument_list|(
operator|(
name|long
operator|)
name|req_width
operator|*
name|dest_bits_per_pixel
argument_list|,
name|dest_scanline_pad
argument_list|)
operator|>>
literal|3
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|BytesPerRow
operator|*
name|req_height
operator|)
operator|<=
name|Available
condition|)
block|{
name|PutImageRequest
argument_list|(
name|dpy
argument_list|,
name|d
argument_list|,
name|gc
argument_list|,
name|image
argument_list|,
name|req_xoffset
argument_list|,
name|req_yoffset
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|req_width
argument_list|,
name|req_height
argument_list|,
name|dest_bits_per_pixel
argument_list|,
name|dest_scanline_pad
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|req_height
operator|>
literal|1
condition|)
block|{
name|int
name|SubImageHeight
init|=
name|Available
operator|/
name|BytesPerRow
decl_stmt|;
if|if
condition|(
name|SubImageHeight
operator|==
literal|0
condition|)
name|SubImageHeight
operator|=
literal|1
expr_stmt|;
name|PutSubImage
argument_list|(
name|dpy
argument_list|,
name|d
argument_list|,
name|gc
argument_list|,
name|image
argument_list|,
name|req_xoffset
argument_list|,
name|req_yoffset
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|req_width
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|SubImageHeight
argument_list|,
name|dest_bits_per_pixel
argument_list|,
name|dest_scanline_pad
argument_list|)
expr_stmt|;
name|PutSubImage
argument_list|(
name|dpy
argument_list|,
name|d
argument_list|,
name|gc
argument_list|,
name|image
argument_list|,
name|req_xoffset
argument_list|,
name|req_yoffset
operator|+
name|SubImageHeight
argument_list|,
name|x
argument_list|,
name|y
operator|+
name|SubImageHeight
argument_list|,
name|req_width
argument_list|,
name|req_height
operator|-
name|SubImageHeight
argument_list|,
name|dest_bits_per_pixel
argument_list|,
name|dest_scanline_pad
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|int
name|SubImageWidth
init|=
operator|(
operator|(
operator|(
name|Available
operator|<<
literal|3
operator|)
operator|/
name|dest_scanline_pad
operator|)
operator|*
name|dest_scanline_pad
operator|)
operator|-
name|left_pad
decl_stmt|;
name|PutSubImage
argument_list|(
name|dpy
argument_list|,
name|d
argument_list|,
name|gc
argument_list|,
name|image
argument_list|,
name|req_xoffset
argument_list|,
name|req_yoffset
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|SubImageWidth
argument_list|,
literal|1
argument_list|,
name|dest_bits_per_pixel
argument_list|,
name|dest_scanline_pad
argument_list|)
expr_stmt|;
name|PutSubImage
argument_list|(
name|dpy
argument_list|,
name|d
argument_list|,
name|gc
argument_list|,
name|image
argument_list|,
name|req_xoffset
operator|+
name|SubImageWidth
argument_list|,
name|req_yoffset
argument_list|,
name|x
operator|+
name|SubImageWidth
argument_list|,
name|y
argument_list|,
name|req_width
operator|-
name|SubImageWidth
argument_list|,
literal|1
argument_list|,
name|dest_bits_per_pixel
argument_list|,
name|dest_scanline_pad
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_expr_stmt
name|XPutImage
argument_list|(
name|dpy
argument_list|,
name|d
argument_list|,
name|gc
argument_list|,
name|image
argument_list|,
name|req_xoffset
argument_list|,
name|req_yoffset
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|req_width
argument_list|,
name|req_height
argument_list|)
specifier|register
name|Display
operator|*
name|dpy
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|Drawable
name|d
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|GC
name|gc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|XImage
modifier|*
name|image
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|req_width
decl_stmt|,
name|req_height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|req_xoffset
decl_stmt|,
name|req_yoffset
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|width
init|=
name|req_width
decl_stmt|;
name|long
name|height
init|=
name|req_height
decl_stmt|;
name|int
name|dest_bits_per_pixel
decl_stmt|,
name|dest_scanline_pad
decl_stmt|;
if|if
condition|(
name|req_xoffset
operator|<
literal|0
condition|)
block|{
name|width
operator|+=
name|req_xoffset
expr_stmt|;
name|req_xoffset
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|req_yoffset
operator|<
literal|0
condition|)
block|{
name|height
operator|+=
name|req_yoffset
expr_stmt|;
name|req_yoffset
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|req_xoffset
operator|+
name|width
operator|)
operator|>
name|image
operator|->
name|width
condition|)
name|width
operator|=
name|image
operator|->
name|width
operator|-
name|req_xoffset
expr_stmt|;
if|if
condition|(
operator|(
name|req_yoffset
operator|+
name|height
operator|)
operator|>
name|image
operator|->
name|height
condition|)
name|height
operator|=
name|image
operator|->
name|height
operator|-
name|req_yoffset
expr_stmt|;
if|if
condition|(
operator|(
name|width
operator|<=
literal|0
operator|)
operator|||
operator|(
name|height
operator|<=
literal|0
operator|)
condition|)
return|return;
if|if
condition|(
operator|(
name|image
operator|->
name|depth
operator|==
literal|1
operator|)
operator|||
operator|(
name|image
operator|->
name|format
operator|!=
name|ZPixmap
operator|)
condition|)
block|{
name|dest_bits_per_pixel
operator|=
literal|1
expr_stmt|;
name|dest_scanline_pad
operator|=
name|dpy
operator|->
name|bitmap_pad
expr_stmt|;
block|}
else|else
block|{
specifier|register
name|int
name|n
decl_stmt|;
specifier|register
name|ScreenFormat
modifier|*
name|format
decl_stmt|;
name|dest_bits_per_pixel
operator|=
name|image
operator|->
name|bits_per_pixel
expr_stmt|;
name|dest_scanline_pad
operator|=
name|image
operator|->
name|bitmap_pad
expr_stmt|;
for|for
control|(
name|n
operator|=
name|dpy
operator|->
name|nformats
operator|,
name|format
operator|=
name|dpy
operator|->
name|pixmap_format
init|;
operator|--
name|n
operator|>=
literal|0
condition|;
name|format
operator|++
control|)
if|if
condition|(
name|format
operator|->
name|depth
operator|==
name|image
operator|->
name|depth
condition|)
block|{
name|dest_bits_per_pixel
operator|=
name|format
operator|->
name|bits_per_pixel
expr_stmt|;
name|dest_scanline_pad
operator|=
name|format
operator|->
name|scanline_pad
expr_stmt|;
block|}
if|if
condition|(
name|dest_bits_per_pixel
operator|!=
name|image
operator|->
name|bits_per_pixel
condition|)
block|{
name|XImage
name|img
decl_stmt|;
specifier|register
name|long
name|i
decl_stmt|,
name|j
decl_stmt|;
comment|/* XXX slow, but works */
name|img
operator|.
name|width
operator|=
name|width
expr_stmt|;
name|img
operator|.
name|height
operator|=
name|height
expr_stmt|;
name|img
operator|.
name|xoffset
operator|=
literal|0
expr_stmt|;
name|img
operator|.
name|format
operator|=
name|ZPixmap
expr_stmt|;
name|img
operator|.
name|byte_order
operator|=
name|dpy
operator|->
name|byte_order
expr_stmt|;
name|img
operator|.
name|bitmap_pad
operator|=
name|dest_scanline_pad
expr_stmt|;
name|img
operator|.
name|depth
operator|=
name|image
operator|->
name|depth
expr_stmt|;
name|img
operator|.
name|bits_per_pixel
operator|=
name|dest_bits_per_pixel
expr_stmt|;
name|img
operator|.
name|bytes_per_line
operator|=
name|ROUNDUP
argument_list|(
operator|(
name|dest_bits_per_pixel
operator|*
name|width
operator|)
argument_list|,
name|dest_scanline_pad
argument_list|)
operator|>>
literal|3
expr_stmt|;
name|img
operator|.
name|data
operator|=
name|Xmalloc
argument_list|(
call|(
name|unsigned
call|)
argument_list|(
name|img
operator|.
name|bytes_per_line
operator|*
name|height
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|img
operator|.
name|data
operator|==
name|NULL
condition|)
return|return;
name|_XInitImageFuncPtrs
argument_list|(
operator|&
name|img
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
name|height
init|;
operator|--
name|j
operator|>=
literal|0
condition|;
control|)
for|for
control|(
name|i
operator|=
name|width
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
name|XPutPixel
argument_list|(
operator|&
name|img
argument_list|,
name|i
argument_list|,
name|j
argument_list|,
name|XGetPixel
argument_list|(
name|image
argument_list|,
name|req_xoffset
operator|+
name|i
argument_list|,
name|req_yoffset
operator|+
name|j
argument_list|)
argument_list|)
expr_stmt|;
name|LockDisplay
argument_list|(
name|dpy
argument_list|)
expr_stmt|;
name|FlushGC
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|)
expr_stmt|;
name|PutSubImage
argument_list|(
name|dpy
argument_list|,
name|d
argument_list|,
name|gc
argument_list|,
operator|&
name|img
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|width
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|height
argument_list|,
name|dest_bits_per_pixel
argument_list|,
name|dest_scanline_pad
argument_list|)
expr_stmt|;
name|UnlockDisplay
argument_list|(
name|dpy
argument_list|)
expr_stmt|;
name|SyncHandle
argument_list|()
expr_stmt|;
name|Xfree
argument_list|(
name|img
operator|.
name|data
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|LockDisplay
argument_list|(
name|dpy
argument_list|)
expr_stmt|;
name|FlushGC
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|)
expr_stmt|;
name|PutSubImage
argument_list|(
name|dpy
argument_list|,
name|d
argument_list|,
name|gc
argument_list|,
name|image
argument_list|,
name|req_xoffset
argument_list|,
name|req_yoffset
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|width
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|height
argument_list|,
name|dest_bits_per_pixel
argument_list|,
name|dest_scanline_pad
argument_list|)
expr_stmt|;
name|UnlockDisplay
argument_list|(
name|dpy
argument_list|)
expr_stmt|;
name|SyncHandle
argument_list|()
expr_stmt|;
block|}
end_block

end_unit

