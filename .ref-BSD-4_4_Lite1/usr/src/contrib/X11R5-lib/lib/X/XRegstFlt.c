begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $XConsortium: XRegstFlt.c,v 1.11 91/06/05 09:17:42 rws Exp $  */
end_comment

begin_comment
comment|/*   * Copyright 1990, 1991 by OMRON Corporation   * Copyright 1991 by the Massachusetts Institute of Technology   *   * Permission to use, copy, modify, distribute, and sell this software and its   * documentation for any purpose is hereby granted without fee, provided that   * the above copyright notice appear in all copies and that both that   * copyright notice and this permission notice appear in supporting   * documentation, and that the names of OMRON and MIT not be used in   * advertising or publicity pertaining to distribution of the software without   * specific, written prior permission.  OMRON and MIT make no representations   * about the suitability of this software for any purpose.  It is provided   * "as is" without express or implied warranty.   *   * OMRON AND MIT DISCLAIM ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,   * INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO   * EVENT SHALL OMRON OR MIT BE LIABLE FOR ANY SPECIAL, INDIRECT OR   * CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE,   * DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER   * TORTUOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR   * PERFORMANCE OF THIS SOFTWARE.    *   *	Author:	Seiji Kuwari	OMRON Corporation   *				kuwa@omron.co.jp   *				kuwa%omron.co.jp@uunet.uu.net   */
end_comment

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|"Xlcint.h"
end_include

begin_function
specifier|static
name|void
name|_XFreeIMFilters
parameter_list|(
name|display
parameter_list|)
name|Display
modifier|*
name|display
decl_stmt|;
block|{
specifier|register
name|XFilterEventList
name|fl
decl_stmt|;
while|while
condition|(
name|fl
operator|=
name|display
operator|->
name|im_filters
condition|)
block|{
name|display
operator|->
name|im_filters
operator|=
name|fl
operator|->
name|next
expr_stmt|;
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|fl
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Register a filter with the filter machinery by event mask.  */
end_comment

begin_decl_stmt
name|void
name|_XRegisterFilterByMask
argument_list|(
name|display
argument_list|,
name|window
argument_list|,
name|event_mask
argument_list|,
name|filter
argument_list|,
name|client_data
argument_list|)
name|Display
modifier|*
name|display
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|window
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|long
name|event_mask
decl_stmt|;
end_decl_stmt

begin_function_decl
name|Bool
function_decl|(
modifier|*
name|filter
function_decl|)
parameter_list|(
if|#
directive|if
name|NeedNestedPrototypes
name|Display
modifier|*
parameter_list|,
name|Window
parameter_list|,
name|XEvent
modifier|*
parameter_list|,
name|XPointer
endif|#
directive|endif
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
name|XPointer
name|client_data
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XFilterEventRec
modifier|*
name|rec
decl_stmt|;
name|rec
operator|=
operator|(
name|XFilterEventList
operator|)
name|Xmalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|XFilterEventRec
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|rec
condition|)
return|return;
name|rec
operator|->
name|window
operator|=
name|window
expr_stmt|;
name|rec
operator|->
name|event_mask
operator|=
name|event_mask
expr_stmt|;
name|rec
operator|->
name|start_type
operator|=
literal|0
expr_stmt|;
name|rec
operator|->
name|end_type
operator|=
literal|0
expr_stmt|;
name|rec
operator|->
name|filter
operator|=
name|filter
expr_stmt|;
name|rec
operator|->
name|client_data
operator|=
name|client_data
expr_stmt|;
name|LockDisplay
argument_list|(
name|display
argument_list|)
expr_stmt|;
name|rec
operator|->
name|next
operator|=
name|display
operator|->
name|im_filters
expr_stmt|;
name|display
operator|->
name|im_filters
operator|=
name|rec
expr_stmt|;
name|display
operator|->
name|free_funcs
operator|->
name|im_filters
operator|=
name|_XFreeIMFilters
expr_stmt|;
name|UnlockDisplay
argument_list|(
name|display
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  * Register a filter with the filter machinery by type code.  */
end_comment

begin_decl_stmt
name|void
name|_XRegisterFilterByType
argument_list|(
name|display
argument_list|,
name|window
argument_list|,
name|start_type
argument_list|,
name|end_type
argument_list|,
name|filter
argument_list|,
name|client_data
argument_list|)
name|Display
modifier|*
name|display
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|window
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|start_type
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|end_type
decl_stmt|;
end_decl_stmt

begin_function_decl
name|Bool
function_decl|(
modifier|*
name|filter
function_decl|)
parameter_list|(
if|#
directive|if
name|NeedNestedPrototypes
name|Display
modifier|*
parameter_list|,
name|Window
parameter_list|,
name|XEvent
modifier|*
parameter_list|,
name|XPointer
endif|#
directive|endif
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
name|XPointer
name|client_data
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XFilterEventRec
modifier|*
name|rec
decl_stmt|;
name|rec
operator|=
operator|(
name|XFilterEventList
operator|)
name|Xmalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|XFilterEventRec
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|rec
condition|)
return|return;
name|rec
operator|->
name|window
operator|=
name|window
expr_stmt|;
name|rec
operator|->
name|event_mask
operator|=
literal|0
expr_stmt|;
name|rec
operator|->
name|start_type
operator|=
name|start_type
expr_stmt|;
name|rec
operator|->
name|end_type
operator|=
name|end_type
expr_stmt|;
name|rec
operator|->
name|filter
operator|=
name|filter
expr_stmt|;
name|rec
operator|->
name|client_data
operator|=
name|client_data
expr_stmt|;
name|LockDisplay
argument_list|(
name|display
argument_list|)
expr_stmt|;
name|rec
operator|->
name|next
operator|=
name|display
operator|->
name|im_filters
expr_stmt|;
name|display
operator|->
name|im_filters
operator|=
name|rec
expr_stmt|;
name|display
operator|->
name|free_funcs
operator|->
name|im_filters
operator|=
name|_XFreeIMFilters
expr_stmt|;
name|UnlockDisplay
argument_list|(
name|display
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|void
name|_XUnregisterFilter
argument_list|(
name|display
argument_list|,
name|window
argument_list|,
name|filter
argument_list|,
name|client_data
argument_list|)
name|Display
modifier|*
name|display
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|window
decl_stmt|;
end_decl_stmt

begin_function_decl
name|Bool
function_decl|(
modifier|*
name|filter
function_decl|)
parameter_list|(
if|#
directive|if
name|NeedNestedPrototypes
name|Display
modifier|*
parameter_list|,
name|Window
parameter_list|,
name|XEvent
modifier|*
parameter_list|,
name|XPointer
endif|#
directive|endif
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
name|XPointer
name|client_data
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|XFilterEventList
modifier|*
name|prev
decl_stmt|,
name|fl
decl_stmt|;
for|for
control|(
name|prev
operator|=
operator|&
name|display
operator|->
name|im_filters
init|;
name|fl
operator|=
operator|*
name|prev
condition|;
control|)
block|{
if|if
condition|(
name|fl
operator|->
name|window
operator|==
name|window
operator|&&
name|fl
operator|->
name|filter
operator|==
name|filter
operator|&&
name|fl
operator|->
name|client_data
operator|==
name|client_data
condition|)
block|{
operator|*
name|prev
operator|=
name|fl
operator|->
name|next
expr_stmt|;
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|fl
argument_list|)
expr_stmt|;
block|}
else|else
name|prev
operator|=
operator|&
name|fl
operator|->
name|next
expr_stmt|;
block|}
block|}
end_block

end_unit

