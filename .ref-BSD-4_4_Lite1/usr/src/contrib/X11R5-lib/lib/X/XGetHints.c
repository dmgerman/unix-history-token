begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $XConsortium: XGetHints.c,v 11.34 91/08/16 10:03:27 rws Exp $ */
end_comment

begin_comment
comment|/*********************************************************** Copyright 1987 by Digital Equipment Corporation, Maynard, Massachusetts, and the Massachusetts Institute of Technology, Cambridge, Massachusetts.                          All Rights Reserved  Permission to use, copy, modify, and distribute this software and its  documentation for any purpose and without fee is hereby granted,  provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in  supporting documentation, and that the names of Digital or MIT not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.    DIGITAL DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL DIGITAL BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  ******************************************************************/
end_comment

begin_include
include|#
directive|include
file|<X11/Xlibint.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xos.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xutil.h>
end_include

begin_include
include|#
directive|include
file|"Xatomtype.h"
end_include

begin_include
include|#
directive|include
file|<X11/Xatom.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_function
name|Status
name|XGetSizeHints
parameter_list|(
name|dpy
parameter_list|,
name|w
parameter_list|,
name|hints
parameter_list|,
name|property
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Window
name|w
decl_stmt|;
name|XSizeHints
modifier|*
name|hints
decl_stmt|;
name|Atom
name|property
decl_stmt|;
block|{
name|xPropSizeHints
modifier|*
name|prop
init|=
name|NULL
decl_stmt|;
name|Atom
name|actual_type
decl_stmt|;
name|int
name|actual_format
decl_stmt|;
name|unsigned
name|long
name|leftover
decl_stmt|;
name|unsigned
name|long
name|nitems
decl_stmt|;
if|if
condition|(
name|XGetWindowProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|property
argument_list|,
literal|0L
argument_list|,
operator|(
name|long
operator|)
name|OldNumPropSizeElements
argument_list|,
name|False
argument_list|,
name|XA_WM_SIZE_HINTS
argument_list|,
operator|&
name|actual_type
argument_list|,
operator|&
name|actual_format
argument_list|,
operator|&
name|nitems
argument_list|,
operator|&
name|leftover
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|*
operator|)
operator|&
name|prop
argument_list|)
operator|!=
name|Success
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
operator|(
name|actual_type
operator|!=
name|XA_WM_SIZE_HINTS
operator|)
operator|||
operator|(
name|nitems
operator|<
name|OldNumPropSizeElements
operator|)
operator|||
operator|(
name|actual_format
operator|!=
literal|32
operator|)
condition|)
block|{
if|if
condition|(
name|prop
operator|!=
name|NULL
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|prop
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|hints
operator|->
name|flags
operator|=
operator|(
name|prop
operator|->
name|flags
operator|&
operator|(
name|USPosition
operator||
name|USSize
operator||
name|PAllHints
operator|)
operator|)
expr_stmt|;
name|hints
operator|->
name|x
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|x
argument_list|)
expr_stmt|;
name|hints
operator|->
name|y
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|y
argument_list|)
expr_stmt|;
name|hints
operator|->
name|width
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|width
argument_list|)
expr_stmt|;
name|hints
operator|->
name|height
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|height
argument_list|)
expr_stmt|;
name|hints
operator|->
name|min_width
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|minWidth
argument_list|)
expr_stmt|;
name|hints
operator|->
name|min_height
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|minHeight
argument_list|)
expr_stmt|;
name|hints
operator|->
name|max_width
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|maxWidth
argument_list|)
expr_stmt|;
name|hints
operator|->
name|max_height
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|maxHeight
argument_list|)
expr_stmt|;
name|hints
operator|->
name|width_inc
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|widthInc
argument_list|)
expr_stmt|;
name|hints
operator|->
name|height_inc
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|heightInc
argument_list|)
expr_stmt|;
name|hints
operator|->
name|min_aspect
operator|.
name|x
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|minAspectX
argument_list|)
expr_stmt|;
name|hints
operator|->
name|min_aspect
operator|.
name|y
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|minAspectY
argument_list|)
expr_stmt|;
name|hints
operator|->
name|max_aspect
operator|.
name|x
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|maxAspectX
argument_list|)
expr_stmt|;
name|hints
operator|->
name|max_aspect
operator|.
name|y
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|maxAspectY
argument_list|)
expr_stmt|;
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|prop
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*   * must return a pointer to the hint, in malloc'd memory, or routine is not  * extensible; any use of the caller's memory would cause things to be stepped  * on.  */
end_comment

begin_function
name|XWMHints
modifier|*
name|XGetWMHints
parameter_list|(
name|dpy
parameter_list|,
name|w
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Window
name|w
decl_stmt|;
block|{
name|xPropWMHints
modifier|*
name|prop
init|=
name|NULL
decl_stmt|;
specifier|register
name|XWMHints
modifier|*
name|hints
decl_stmt|;
name|Atom
name|actual_type
decl_stmt|;
name|int
name|actual_format
decl_stmt|;
name|unsigned
name|long
name|leftover
decl_stmt|;
name|unsigned
name|long
name|nitems
decl_stmt|;
if|if
condition|(
name|XGetWindowProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|XA_WM_HINTS
argument_list|,
literal|0L
argument_list|,
operator|(
name|long
operator|)
name|NumPropWMHintsElements
argument_list|,
name|False
argument_list|,
name|XA_WM_HINTS
argument_list|,
operator|&
name|actual_type
argument_list|,
operator|&
name|actual_format
argument_list|,
operator|&
name|nitems
argument_list|,
operator|&
name|leftover
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|*
operator|)
operator|&
name|prop
argument_list|)
operator|!=
name|Success
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* If the property is undefined on the window, return null pointer. */
comment|/* pre-R3 bogusly truncated window_group, don't fail on them */
if|if
condition|(
operator|(
name|actual_type
operator|!=
name|XA_WM_HINTS
operator|)
operator|||
operator|(
name|nitems
operator|<
operator|(
name|NumPropWMHintsElements
operator|-
literal|1
operator|)
operator|)
operator|||
operator|(
name|actual_format
operator|!=
literal|32
operator|)
condition|)
block|{
if|if
condition|(
name|prop
operator|!=
name|NULL
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|prop
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/* static copies not allowed in library, due to reentrancy constraint*/
if|if
condition|(
name|hints
operator|=
operator|(
name|XWMHints
operator|*
operator|)
name|Xcalloc
argument_list|(
literal|1
argument_list|,
operator|(
name|unsigned
operator|)
sizeof|sizeof
argument_list|(
name|XWMHints
argument_list|)
argument_list|)
condition|)
block|{
name|hints
operator|->
name|flags
operator|=
name|prop
operator|->
name|flags
expr_stmt|;
name|hints
operator|->
name|input
operator|=
operator|(
name|prop
operator|->
name|input
condition|?
name|True
else|:
name|False
operator|)
expr_stmt|;
name|hints
operator|->
name|initial_state
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|initialState
argument_list|)
expr_stmt|;
name|hints
operator|->
name|icon_pixmap
operator|=
name|prop
operator|->
name|iconPixmap
expr_stmt|;
name|hints
operator|->
name|icon_window
operator|=
name|prop
operator|->
name|iconWindow
expr_stmt|;
name|hints
operator|->
name|icon_x
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|iconX
argument_list|)
expr_stmt|;
name|hints
operator|->
name|icon_y
operator|=
name|cvtINT32toInt
argument_list|(
name|prop
operator|->
name|iconY
argument_list|)
expr_stmt|;
name|hints
operator|->
name|icon_mask
operator|=
name|prop
operator|->
name|iconMask
expr_stmt|;
if|if
condition|(
name|nitems
operator|>=
name|NumPropWMHintsElements
condition|)
name|hints
operator|->
name|window_group
operator|=
name|prop
operator|->
name|windowGroup
expr_stmt|;
else|else
name|hints
operator|->
name|window_group
operator|=
literal|0
expr_stmt|;
block|}
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|prop
argument_list|)
expr_stmt|;
return|return
operator|(
name|hints
operator|)
return|;
block|}
end_function

begin_function
name|Status
name|XGetZoomHints
parameter_list|(
name|dpy
parameter_list|,
name|w
parameter_list|,
name|zhints
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Window
name|w
decl_stmt|;
name|XSizeHints
modifier|*
name|zhints
decl_stmt|;
block|{
return|return
operator|(
name|XGetSizeHints
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|zhints
argument_list|,
name|XA_WM_ZOOM_HINTS
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|Status
name|XGetNormalHints
parameter_list|(
name|dpy
parameter_list|,
name|w
parameter_list|,
name|hints
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Window
name|w
decl_stmt|;
name|XSizeHints
modifier|*
name|hints
decl_stmt|;
block|{
return|return
operator|(
name|XGetSizeHints
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|hints
argument_list|,
name|XA_WM_NORMAL_HINTS
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * XGetIconSizes reads the property   *	ICONSIZE_ATOM	type: ICONSIZE_ATOM format: 32  */
end_comment

begin_function
name|Status
name|XGetIconSizes
parameter_list|(
name|dpy
parameter_list|,
name|w
parameter_list|,
name|size_list
parameter_list|,
name|count
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Window
name|w
decl_stmt|;
comment|/* typically, root */
name|XIconSize
modifier|*
modifier|*
name|size_list
decl_stmt|;
comment|/* RETURN */
name|int
modifier|*
name|count
decl_stmt|;
comment|/* RETURN number of items on the list */
block|{
name|xPropIconSize
modifier|*
name|prop
init|=
name|NULL
decl_stmt|;
specifier|register
name|xPropIconSize
modifier|*
name|pp
decl_stmt|;
specifier|register
name|XIconSize
modifier|*
name|hp
decl_stmt|,
modifier|*
name|hints
decl_stmt|;
name|Atom
name|actual_type
decl_stmt|;
name|int
name|actual_format
decl_stmt|;
name|unsigned
name|long
name|leftover
decl_stmt|;
name|unsigned
name|long
name|nitems
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
name|XGetWindowProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|XA_WM_ICON_SIZE
argument_list|,
literal|0L
argument_list|,
literal|60L
argument_list|,
name|False
argument_list|,
name|XA_WM_ICON_SIZE
argument_list|,
operator|&
name|actual_type
argument_list|,
operator|&
name|actual_format
argument_list|,
operator|&
name|nitems
argument_list|,
operator|&
name|leftover
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|*
operator|)
operator|&
name|prop
argument_list|)
operator|!=
name|Success
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|pp
operator|=
name|prop
expr_stmt|;
if|if
condition|(
operator|(
name|actual_type
operator|!=
name|XA_WM_ICON_SIZE
operator|)
operator|||
operator|(
name|nitems
operator|<
name|NumPropIconSizeElements
operator|)
operator|||
operator|(
name|nitems
operator|%
name|NumPropIconSizeElements
operator|!=
literal|0
operator|)
operator|||
operator|(
name|actual_format
operator|!=
literal|32
operator|)
condition|)
block|{
if|if
condition|(
name|prop
operator|!=
name|NULL
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|prop
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* static copies not allowed in library, due to reentrancy constraint*/
name|nitems
operator|/=
name|NumPropIconSizeElements
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|hp
operator|=
name|hints
operator|=
operator|(
name|XIconSize
operator|*
operator|)
name|Xcalloc
argument_list|(
operator|(
name|unsigned
operator|)
name|nitems
argument_list|,
operator|(
name|unsigned
operator|)
sizeof|sizeof
argument_list|(
name|XIconSize
argument_list|)
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
name|prop
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|prop
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
comment|/* march down array putting things into native form */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nitems
condition|;
name|i
operator|++
control|)
block|{
name|hp
operator|->
name|min_width
operator|=
name|cvtINT32toInt
argument_list|(
name|pp
operator|->
name|minWidth
argument_list|)
expr_stmt|;
name|hp
operator|->
name|min_height
operator|=
name|cvtINT32toInt
argument_list|(
name|pp
operator|->
name|minHeight
argument_list|)
expr_stmt|;
name|hp
operator|->
name|max_width
operator|=
name|cvtINT32toInt
argument_list|(
name|pp
operator|->
name|maxWidth
argument_list|)
expr_stmt|;
name|hp
operator|->
name|max_height
operator|=
name|cvtINT32toInt
argument_list|(
name|pp
operator|->
name|maxHeight
argument_list|)
expr_stmt|;
name|hp
operator|->
name|width_inc
operator|=
name|cvtINT32toInt
argument_list|(
name|pp
operator|->
name|widthInc
argument_list|)
expr_stmt|;
name|hp
operator|->
name|height_inc
operator|=
name|cvtINT32toInt
argument_list|(
name|pp
operator|->
name|heightInc
argument_list|)
expr_stmt|;
name|hp
operator|+=
literal|1
expr_stmt|;
name|pp
operator|+=
literal|1
expr_stmt|;
block|}
operator|*
name|count
operator|=
name|nitems
expr_stmt|;
operator|*
name|size_list
operator|=
name|hints
expr_stmt|;
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|prop
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
name|Status
name|XGetCommand
parameter_list|(
name|dpy
parameter_list|,
name|w
parameter_list|,
name|argvp
parameter_list|,
name|argcp
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Window
name|w
decl_stmt|;
name|char
modifier|*
modifier|*
modifier|*
name|argvp
decl_stmt|;
name|int
modifier|*
name|argcp
decl_stmt|;
block|{
name|XTextProperty
name|tp
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
if|if
condition|(
operator|!
name|XGetTextProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
operator|&
name|tp
argument_list|,
name|XA_WM_COMMAND
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|tp
operator|.
name|encoding
operator|!=
name|XA_STRING
operator|||
name|tp
operator|.
name|format
operator|!=
literal|8
condition|)
block|{
if|if
condition|(
name|tp
operator|.
name|value
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tp
operator|.
name|value
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
comment|/*      * ignore final<NUL> if present since UNIX WM_COMMAND is nul-terminated      */
if|if
condition|(
name|tp
operator|.
name|nitems
operator|&&
operator|(
name|tp
operator|.
name|value
index|[
name|tp
operator|.
name|nitems
operator|-
literal|1
index|]
operator|==
literal|'\0'
operator|)
condition|)
name|tp
operator|.
name|nitems
operator|--
expr_stmt|;
comment|/*      * create a string list and return if successful      */
if|if
condition|(
operator|!
name|XTextPropertyToStringList
argument_list|(
operator|&
name|tp
argument_list|,
operator|&
name|argv
argument_list|,
operator|&
name|argc
argument_list|)
condition|)
block|{
if|if
condition|(
name|tp
operator|.
name|value
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tp
operator|.
name|value
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|tp
operator|.
name|value
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tp
operator|.
name|value
argument_list|)
expr_stmt|;
operator|*
name|argvp
operator|=
name|argv
expr_stmt|;
operator|*
name|argcp
operator|=
name|argc
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
name|Status
name|XGetTransientForHint
parameter_list|(
name|dpy
parameter_list|,
name|w
parameter_list|,
name|propWindow
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Window
name|w
decl_stmt|;
name|Window
modifier|*
name|propWindow
decl_stmt|;
block|{
name|Atom
name|actual_type
decl_stmt|;
name|int
name|actual_format
decl_stmt|;
name|unsigned
name|long
name|nitems
decl_stmt|;
name|unsigned
name|long
name|leftover
decl_stmt|;
name|Window
modifier|*
name|data
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|XGetWindowProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|XA_WM_TRANSIENT_FOR
argument_list|,
literal|0L
argument_list|,
literal|1L
argument_list|,
name|False
argument_list|,
name|XA_WINDOW
argument_list|,
operator|&
name|actual_type
argument_list|,
operator|&
name|actual_format
argument_list|,
operator|&
name|nitems
argument_list|,
operator|&
name|leftover
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|*
operator|)
operator|&
name|data
argument_list|)
operator|!=
name|Success
condition|)
block|{
operator|*
name|propWindow
operator|=
name|None
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|actual_type
operator|==
name|XA_WINDOW
operator|)
operator|&&
operator|(
name|actual_format
operator|==
literal|32
operator|)
operator|&&
operator|(
name|nitems
operator|!=
literal|0
operator|)
condition|)
block|{
operator|*
name|propWindow
operator|=
operator|*
name|data
expr_stmt|;
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
operator|*
name|propWindow
operator|=
name|None
expr_stmt|;
if|if
condition|(
name|data
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|Status
name|XGetClassHint
parameter_list|(
name|dpy
parameter_list|,
name|w
parameter_list|,
name|classhint
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Window
name|w
decl_stmt|;
name|XClassHint
modifier|*
name|classhint
decl_stmt|;
comment|/* RETURN */
block|{
name|int
name|len_name
decl_stmt|,
name|len_class
decl_stmt|;
name|Atom
name|actual_type
decl_stmt|;
name|int
name|actual_format
decl_stmt|;
name|unsigned
name|long
name|nitems
decl_stmt|;
name|unsigned
name|long
name|leftover
decl_stmt|;
name|unsigned
name|char
modifier|*
name|data
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|XGetWindowProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|XA_WM_CLASS
argument_list|,
literal|0L
argument_list|,
operator|(
name|long
operator|)
name|BUFSIZ
argument_list|,
name|False
argument_list|,
name|XA_STRING
argument_list|,
operator|&
name|actual_type
argument_list|,
operator|&
name|actual_format
argument_list|,
operator|&
name|nitems
argument_list|,
operator|&
name|leftover
argument_list|,
operator|&
name|data
argument_list|)
operator|!=
name|Success
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
operator|(
name|actual_type
operator|==
name|XA_STRING
operator|)
operator|&&
operator|(
name|actual_format
operator|==
literal|8
operator|)
condition|)
block|{
name|len_name
operator|=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|classhint
operator|->
name|res_name
operator|=
name|Xmalloc
argument_list|(
call|(
name|unsigned
call|)
argument_list|(
name|len_name
operator|+
literal|1
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|strcpy
argument_list|(
name|classhint
operator|->
name|res_name
argument_list|,
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|len_name
operator|==
name|nitems
condition|)
name|len_name
operator|--
expr_stmt|;
name|len_class
operator|=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|(
name|data
operator|+
name|len_name
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|classhint
operator|->
name|res_class
operator|=
name|Xmalloc
argument_list|(
call|(
name|unsigned
call|)
argument_list|(
name|len_class
operator|+
literal|1
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|Xfree
argument_list|(
name|classhint
operator|->
name|res_name
argument_list|)
expr_stmt|;
name|classhint
operator|->
name|res_name
operator|=
operator|(
name|char
operator|*
operator|)
name|NULL
expr_stmt|;
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|strcpy
argument_list|(
name|classhint
operator|->
name|res_class
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|(
name|data
operator|+
name|len_name
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|data
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

end_unit

