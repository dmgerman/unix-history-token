begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $XConsortium: XcmsProp.c,v 1.10 91/07/22 17:22:46 rws Exp $" */
end_comment

begin_comment
comment|/*  *  * Code and supporting documentation (c) Copyright 1990 1991 Tektronix, Inc.  * 	All Rights Reserved  *   * This file is a component of an X Window System-specific implementation  * of Xcms based on the TekColor Color Management System.  Permission is  * hereby granted to use, copy, modify, sell, and otherwise distribute this  * software and its documentation for any purpose and without fee, provided  * that this copyright, permission, and disclaimer notice is reproduced in  * all copies of this software and in supporting documentation.  TekColor  * is a trademark of Tektronix, Inc.  *   * Tektronix makes no representation about the suitability of this software  * for any purpose.  It is provided "as is" and with all faults.  *   * TEKTRONIX DISCLAIMS ALL WARRANTIES APPLICABLE TO THIS SOFTWARE,  * INCLUDING THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A  * PARTICULAR PURPOSE.  IN NO EVENT SHALL TEKTRONIX BE LIABLE FOR ANY  * SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER  * RESULTING FROM LOSS OF USE, DATA, OR PROFITS, WHETHER IN AN ACTION OF  * CONTRACT, NEGLIGENCE, OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN  * CONNECTION WITH THE USE OR THE PERFORMANCE OF THIS SOFTWARE.  *  *	NAME  *		XcmsProp.c  *  *	DESCRIPTION  *		This utility routines for manipulating properties.  *  */
end_comment

begin_include
include|#
directive|include
file|<X11/Xatom.h>
end_include

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|"Xcmsint.h"
end_include

begin_escape
end_escape

begin_comment
comment|/************************************************************************  *									*  *			API PRIVATE ROUTINES				*  *									*  ************************************************************************/
end_comment

begin_escape
end_escape

begin_comment
comment|/*  *	NAME  *		_XcmsGetElement -- get an element value from the property passed  *  *	SYNOPSIS  */
end_comment

begin_function
name|unsigned
name|long
name|_XcmsGetElement
parameter_list|(
name|format
parameter_list|,
name|pValue
parameter_list|,
name|pCount
parameter_list|)
name|int
name|format
decl_stmt|;
name|char
modifier|*
modifier|*
name|pValue
decl_stmt|;
name|unsigned
name|long
modifier|*
name|pCount
decl_stmt|;
comment|/*  *	DESCRIPTION  *	    Get the next element from the property and return it.  *	    Also increment the pointer the amount needed.  *  *	Returns  *	    unsigned long  */
block|{
name|unsigned
name|long
name|value
decl_stmt|;
switch|switch
condition|(
name|format
condition|)
block|{
case|case
literal|32
case|:
ifdef|#
directive|ifdef
name|WORD64
name|value
operator|=
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
operator|*
name|pValue
operator|)
operator|)
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<<
literal|24
operator|||
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
operator|*
name|pValue
operator|)
operator|)
index|[
literal|1
index|]
argument_list|)
operator|)
operator|<<
literal|16
operator|||
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
operator|*
name|pValue
operator|)
operator|)
index|[
literal|2
index|]
argument_list|)
operator|)
operator|<<
literal|8
operator|||
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
operator|*
name|pValue
operator|)
operator|)
index|[
literal|0
index|]
argument_list|)
operator|)
expr_stmt|;
else|#
directive|else
name|value
operator|=
operator|*
operator|(
operator|(
name|unsigned
name|long
operator|*
operator|)
operator|(
operator|*
name|pValue
operator|)
operator|)
expr_stmt|;
endif|#
directive|endif
operator|*
name|pValue
operator|+=
literal|4
expr_stmt|;
operator|*
name|pCount
operator|-=
literal|1
expr_stmt|;
break|break;
case|case
literal|16
case|:
ifdef|#
directive|ifdef
name|WORD64
name|value
operator|=
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
operator|*
name|pValue
operator|)
operator|)
index|[
literal|0
index|]
argument_list|)
operator|)
operator|<<
literal|8
operator|||
operator|(
call|(
name|unsigned
name|long
call|)
argument_list|(
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
operator|*
name|pValue
operator|)
operator|)
index|[
literal|1
index|]
argument_list|)
operator|)
expr_stmt|;
else|#
directive|else
name|value
operator|=
operator|*
operator|(
operator|(
name|unsigned
name|short
operator|*
operator|)
operator|(
operator|*
name|pValue
operator|)
operator|)
expr_stmt|;
endif|#
directive|endif
operator|*
name|pValue
operator|+=
literal|2
expr_stmt|;
operator|*
name|pCount
operator|-=
literal|1
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|value
operator|=
operator|*
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|(
operator|*
name|pValue
operator|)
operator|)
expr_stmt|;
operator|*
name|pValue
operator|+=
literal|1
expr_stmt|;
operator|*
name|pCount
operator|-=
literal|1
expr_stmt|;
break|break;
default|default:
name|value
operator|=
literal|0
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|value
operator|)
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/*  *	NAME  *		_XcmsGetProperty -- Determine the existance of a property  *  *	SYNOPSIS  */
end_comment

begin_function
name|int
name|_XcmsGetProperty
parameter_list|(
name|pDpy
parameter_list|,
name|w
parameter_list|,
name|property
parameter_list|,
name|pFormat
parameter_list|,
name|pNItems
parameter_list|,
name|pNBytes
parameter_list|,
name|pValue
parameter_list|)
name|Display
modifier|*
name|pDpy
decl_stmt|;
name|Window
name|w
decl_stmt|;
name|Atom
name|property
decl_stmt|;
name|int
modifier|*
name|pFormat
decl_stmt|;
name|unsigned
name|long
modifier|*
name|pNItems
decl_stmt|;
name|unsigned
name|long
modifier|*
name|pNBytes
decl_stmt|;
name|char
modifier|*
modifier|*
name|pValue
decl_stmt|;
comment|/*  *	DESCRIPTION  *  *	Returns  *	    0 if property does not exist.  *	    1 if property exists.  */
block|{
name|char
modifier|*
name|prop_ret
decl_stmt|;
name|int
name|format_ret
decl_stmt|;
name|long
name|len
init|=
literal|6516
decl_stmt|;
name|unsigned
name|long
name|nitems_ret
decl_stmt|,
name|after_ret
decl_stmt|;
name|Atom
name|atom_ret
decl_stmt|;
while|while
condition|(
name|XGetWindowProperty
argument_list|(
name|pDpy
argument_list|,
name|w
argument_list|,
name|property
argument_list|,
literal|0
argument_list|,
name|len
argument_list|,
name|False
argument_list|,
name|XA_INTEGER
argument_list|,
operator|&
name|atom_ret
argument_list|,
operator|&
name|format_ret
argument_list|,
operator|&
name|nitems_ret
argument_list|,
operator|&
name|after_ret
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|*
operator|)
operator|&
name|prop_ret
argument_list|)
condition|)
block|{
if|if
condition|(
name|after_ret
operator|>
literal|0
condition|)
block|{
name|len
operator|+=
name|nitems_ret
operator|*
operator|(
name|format_ret
operator|>>
literal|3
operator|)
expr_stmt|;
name|XFree
argument_list|(
name|prop_ret
argument_list|)
expr_stmt|;
block|}
else|else
block|{
break|break;
block|}
block|}
if|if
condition|(
name|format_ret
operator|==
literal|0
operator|||
name|nitems_ret
operator|==
literal|0
condition|)
block|{
comment|/* the property does not exist or is of an unexpected type */
return|return
operator|(
name|XcmsFailure
operator|)
return|;
block|}
operator|*
name|pFormat
operator|=
name|format_ret
expr_stmt|;
operator|*
name|pNItems
operator|=
name|nitems_ret
expr_stmt|;
operator|*
name|pNBytes
operator|=
name|nitems_ret
operator|*
operator|(
name|format_ret
operator|>>
literal|3
operator|)
expr_stmt|;
operator|*
name|pValue
operator|=
name|prop_ret
expr_stmt|;
return|return
operator|(
name|XcmsSuccess
operator|)
return|;
block|}
end_function

end_unit

