begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Xau - X Authorization Database Library  *  * $XConsortium: AuFileName.c,v 1.2 91/01/08 15:09:00 gildea Exp $  *  * Copyright 1988 Massachusetts Institute of Technology  *  * Permission to use, copy, modify, and distribute this software and its  * documentation for any purpose and without fee is hereby granted, provided  * that the above copyright notice appear in all copies and that both that  * copyright notice and this permission notice appear in supporting  * documentation, and that the name of M.I.T. not be used in advertising or  * publicity pertaining to distribution of the software without specific,  * written prior permission.  M.I.T. makes no representations about the  * suitability of this software for any purpose.  It is provided "as is"  * without express or implied warranty.  *  * Author:  Keith Packard, MIT X Consortium  */
end_comment

begin_include
include|#
directive|include
file|<X11/Xauth.h>
end_include

begin_function
name|char
modifier|*
name|XauFileName
parameter_list|()
block|{
name|char
modifier|*
name|name
decl_stmt|,
modifier|*
name|malloc
argument_list|()
decl_stmt|,
modifier|*
name|getenv
argument_list|()
decl_stmt|;
name|char
modifier|*
name|strcat
argument_list|()
decl_stmt|,
modifier|*
name|strcpy
argument_list|()
decl_stmt|;
specifier|static
name|char
modifier|*
name|buf
decl_stmt|;
specifier|static
name|int
name|bsize
decl_stmt|;
name|int
name|size
decl_stmt|;
if|if
condition|(
name|name
operator|=
name|getenv
argument_list|(
literal|"XAUTHORITY"
argument_list|)
condition|)
block|{
return|return
name|name
return|;
block|}
elseif|else
if|if
condition|(
name|name
operator|=
name|getenv
argument_list|(
literal|"HOME"
argument_list|)
condition|)
block|{
name|size
operator|=
name|strlen
argument_list|(
name|name
argument_list|)
operator|+
name|strlen
argument_list|(
literal|".Xauthority"
argument_list|)
operator|+
literal|2
expr_stmt|;
if|if
condition|(
name|size
operator|>
name|bsize
condition|)
block|{
if|if
condition|(
name|buf
condition|)
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|buf
operator|=
name|malloc
argument_list|(
operator|(
name|unsigned
operator|)
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|buf
condition|)
return|return
literal|0
return|;
name|bsize
operator|=
name|size
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|buf
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|buf
argument_list|,
literal|"/.Xauthority"
operator|+
operator|(
name|name
index|[
literal|1
index|]
operator|==
literal|'\0'
condition|?
literal|1
else|:
literal|0
operator|)
argument_list|)
expr_stmt|;
return|return
name|buf
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

end_unit

