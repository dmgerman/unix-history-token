begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* fmtdump.c - compile format file and dump out instructions */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|ident
index|[]
init|=
literal|"@(#)$Id: fmtdump.c,v 1.10 1992/11/04 00:42:31 jromine Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"../h/mh.h"
end_include

begin_include
include|#
directive|include
file|"../h/formatsbr.h"
end_include

begin_include
include|#
directive|include
file|"../h/fmtcompile.h"
end_include

begin_include
include|#
directive|include
file|"../h/scansbr.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|LOCALE
end_ifdef

begin_include
include|#
directive|include
file|<locale.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|struct
name|swit
name|switches
index|[]
init|=
block|{
define|#
directive|define
name|FORMSW
value|0
literal|"form formatfile"
block|,
literal|0
block|,
define|#
directive|define
name|FMTSW
value|1
literal|"format string"
block|,
literal|5
block|,
define|#
directive|define
name|HELPSW
value|2
literal|"help"
block|,
literal|4
block|,
name|NULL
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* for assignlabel */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|format
modifier|*
name|lvec
index|[
literal|128
index|]
decl_stmt|;
end_decl_stmt

begin_expr_stmt
specifier|static
name|lused
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|f_typestr
argument_list|()
decl_stmt|,
modifier|*
name|c_typestr
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|fmt_dump
argument_list|()
decl_stmt|,
name|dumpone
argument_list|()
decl_stmt|,
name|assignlabel
argument_list|()
decl_stmt|,
name|litputs
argument_list|()
decl_stmt|,
name|litputc
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|int
name|findlabel
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/*
comment|*/
end_comment

begin_comment
comment|/* ARGSUSED */
end_comment

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|int
name|ncomps
decl_stmt|;
name|char
modifier|*
name|cp
decl_stmt|,
modifier|*
name|form
init|=
name|NULL
decl_stmt|,
modifier|*
name|format
init|=
name|NULL
decl_stmt|,
name|buf
index|[
literal|100
index|]
decl_stmt|,
modifier|*
modifier|*
name|ap
decl_stmt|,
modifier|*
modifier|*
name|argp
decl_stmt|,
modifier|*
name|nfs
decl_stmt|,
modifier|*
name|arguments
index|[
name|MAXARGS
index|]
decl_stmt|;
name|struct
name|format
modifier|*
name|fmt
decl_stmt|;
ifdef|#
directive|ifdef
name|LOCALE
name|setlocale
argument_list|(
name|LC_ALL
argument_list|,
literal|""
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|invo_name
operator|=
name|r1bindex
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|'/'
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cp
operator|=
name|m_find
argument_list|(
name|invo_name
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|ap
operator|=
name|brkstring
argument_list|(
name|cp
operator|=
name|getcpy
argument_list|(
name|cp
argument_list|)
argument_list|,
literal|" "
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|ap
operator|=
name|copyip
argument_list|(
name|ap
argument_list|,
name|arguments
argument_list|)
expr_stmt|;
block|}
else|else
name|ap
operator|=
name|arguments
expr_stmt|;
operator|(
name|void
operator|)
name|copyip
argument_list|(
name|argv
operator|+
literal|1
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|argp
operator|=
name|arguments
expr_stmt|;
comment|/*
comment|*/
while|while
condition|(
name|cp
operator|=
operator|*
name|argp
operator|++
condition|)
block|{
if|if
condition|(
operator|*
name|cp
operator|==
literal|'-'
condition|)
switch|switch
condition|(
name|smatch
argument_list|(
operator|++
name|cp
argument_list|,
name|switches
argument_list|)
condition|)
block|{
case|case
name|AMBIGSW
case|:
name|ambigsw
argument_list|(
name|cp
argument_list|,
name|switches
argument_list|)
expr_stmt|;
name|done
argument_list|(
literal|1
argument_list|)
expr_stmt|;
case|case
name|UNKWNSW
case|:
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"-%s unknown"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
case|case
name|HELPSW
case|:
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s [switches]"
argument_list|,
name|invo_name
argument_list|)
expr_stmt|;
name|help
argument_list|(
name|buf
argument_list|,
name|switches
argument_list|)
expr_stmt|;
name|done
argument_list|(
literal|1
argument_list|)
expr_stmt|;
case|case
name|FORMSW
case|:
if|if
condition|(
operator|!
operator|(
name|form
operator|=
operator|*
name|argp
operator|++
operator|)
operator|||
operator|*
name|form
operator|==
literal|'-'
condition|)
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"missing argument to %s"
argument_list|,
name|argp
index|[
operator|-
literal|2
index|]
argument_list|)
expr_stmt|;
name|format
operator|=
name|NULL
expr_stmt|;
continue|continue;
case|case
name|FMTSW
case|:
if|if
condition|(
operator|!
operator|(
name|format
operator|=
operator|*
name|argp
operator|++
operator|)
operator|||
operator|*
name|format
operator|==
literal|'-'
condition|)
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"missing argument to %s"
argument_list|,
name|argp
index|[
operator|-
literal|2
index|]
argument_list|)
expr_stmt|;
name|form
operator|=
name|NULL
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|form
condition|)
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"only one form at a time!"
argument_list|)
expr_stmt|;
else|else
name|form
operator|=
name|cp
expr_stmt|;
block|}
name|nfs
operator|=
name|new_fs
argument_list|(
name|form
argument_list|,
name|format
argument_list|,
name|FORMAT
argument_list|)
expr_stmt|;
comment|/* must be before chdir() */
name|ncomps
operator|=
name|fmt_compile
argument_list|(
name|nfs
argument_list|,
operator|&
name|fmt
argument_list|)
expr_stmt|;
name|fmt_dump
argument_list|(
name|fmt
argument_list|)
expr_stmt|;
name|done
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|fmt_dump
parameter_list|(
name|fmth
parameter_list|)
specifier|register
name|struct
name|format
modifier|*
name|fmth
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
specifier|register
name|struct
name|format
modifier|*
name|fmt
decl_stmt|,
modifier|*
name|addr
decl_stmt|;
comment|/* Assign labels */
for|for
control|(
name|fmt
operator|=
name|fmth
init|;
name|fmt
condition|;
operator|++
name|fmt
control|)
block|{
name|i
operator|=
name|fmt
operator|->
name|f_type
expr_stmt|;
if|if
condition|(
name|i
operator|==
name|FT_IF_S
operator|||
name|i
operator|==
name|FT_IF_S_NULL
operator|||
name|i
operator|==
name|FT_IF_V_EQ
operator|||
name|i
operator|==
name|FT_IF_V_NE
operator|||
name|i
operator|==
name|FT_IF_V_GT
operator|||
name|i
operator|==
name|FT_IF_MATCH
operator|||
name|i
operator|==
name|FT_IF_AMATCH
operator|||
name|i
operator|==
name|FT_GOTO
condition|)
block|{
name|addr
operator|=
name|fmt
operator|+
name|fmt
operator|->
name|f_skip
expr_stmt|;
if|if
condition|(
name|findlabel
argument_list|(
name|addr
argument_list|)
operator|<
literal|0
condition|)
name|assignlabel
argument_list|(
name|addr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fmt
operator|->
name|f_type
operator|==
name|FT_DONE
operator|&&
name|fmt
operator|->
name|f_value
operator|==
literal|0
condition|)
break|break;
block|}
comment|/* Dump them out! */
for|for
control|(
name|fmt
operator|=
name|fmth
init|;
name|fmt
condition|;
operator|++
name|fmt
control|)
block|{
name|dumpone
argument_list|(
name|fmt
argument_list|)
expr_stmt|;
if|if
condition|(
name|fmt
operator|->
name|f_type
operator|==
name|FT_DONE
operator|&&
name|fmt
operator|->
name|f_value
operator|==
literal|0
condition|)
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|dumpone
parameter_list|(
name|fmt
parameter_list|)
specifier|register
name|struct
name|format
modifier|*
name|fmt
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|(
name|i
operator|=
name|findlabel
argument_list|(
name|fmt
argument_list|)
operator|)
operator|>=
literal|0
condition|)
name|printf
argument_list|(
literal|"L%d:"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\t'
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
name|f_typestr
argument_list|(
operator|(
name|int
operator|)
name|fmt
operator|->
name|f_type
argument_list|)
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|fmt
operator|->
name|f_type
condition|)
block|{
case|case
name|FT_COMP
case|:
case|case
name|FT_LS_COMP
case|:
case|case
name|FT_LV_COMPFLAG
case|:
case|case
name|FT_LV_COMP
case|:
name|printf
argument_list|(
literal|", comp "
argument_list|)
expr_stmt|;
name|litputs
argument_list|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_type
condition|)
name|printf
argument_list|(
literal|", c_type %s"
argument_list|,
name|c_typestr
argument_list|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_type
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_flags
condition|)
name|printf
argument_list|(
literal|", c_flags %d"
argument_list|,
name|fmt
operator|->
name|f_comp
operator|->
name|c_flags
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_LV_SEC
case|:
case|case
name|FT_LV_MIN
case|:
case|case
name|FT_LV_HOUR
case|:
case|case
name|FT_LV_MDAY
case|:
case|case
name|FT_LV_MON
case|:
case|case
name|FT_LS_MONTH
case|:
case|case
name|FT_LS_LMONTH
case|:
case|case
name|FT_LS_ZONE
case|:
case|case
name|FT_LV_YEAR
case|:
case|case
name|FT_LV_WDAY
case|:
case|case
name|FT_LS_DAY
case|:
case|case
name|FT_LS_WEEKDAY
case|:
case|case
name|FT_LV_YDAY
case|:
case|case
name|FT_LV_ZONE
case|:
case|case
name|FT_LV_CLOCK
case|:
case|case
name|FT_LV_RCLOCK
case|:
case|case
name|FT_LV_DAYF
case|:
case|case
name|FT_LV_ZONEF
case|:
case|case
name|FT_LV_DST
case|:
case|case
name|FT_LS_822DATE
case|:
case|case
name|FT_LS_PRETTY
case|:
case|case
name|FT_LOCALDATE
case|:
case|case
name|FT_GMTDATE
case|:
case|case
name|FT_PARSEDATE
case|:
name|printf
argument_list|(
literal|", c_name "
argument_list|)
expr_stmt|;
name|litputs
argument_list|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_type
condition|)
name|printf
argument_list|(
literal|", c_type %s"
argument_list|,
name|c_typestr
argument_list|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_type
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_flags
condition|)
name|printf
argument_list|(
literal|", c_flags %d"
argument_list|,
name|fmt
operator|->
name|f_comp
operator|->
name|c_flags
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_LS_ADDR
case|:
case|case
name|FT_LS_PERS
case|:
case|case
name|FT_LS_MBOX
case|:
case|case
name|FT_LS_HOST
case|:
case|case
name|FT_LS_PATH
case|:
case|case
name|FT_LS_GNAME
case|:
case|case
name|FT_LS_NOTE
case|:
case|case
name|FT_LS_822ADDR
case|:
case|case
name|FT_LV_HOSTTYPE
case|:
case|case
name|FT_LV_INGRPF
case|:
case|case
name|FT_LV_NOHOSTF
case|:
case|case
name|FT_LS_FRIENDLY
case|:
case|case
name|FT_PARSEADDR
case|:
case|case
name|FT_MYMBOX
case|:
name|printf
argument_list|(
literal|", c_name "
argument_list|)
expr_stmt|;
name|litputs
argument_list|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_type
condition|)
name|printf
argument_list|(
literal|", c_type %s"
argument_list|,
name|c_typestr
argument_list|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_type
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_flags
condition|)
name|printf
argument_list|(
literal|", c_flags %d"
argument_list|,
name|fmt
operator|->
name|f_comp
operator|->
name|c_flags
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_COMPF
case|:
name|printf
argument_list|(
literal|", width %d, fill '"
argument_list|,
name|fmt
operator|->
name|f_width
argument_list|)
expr_stmt|;
name|litputc
argument_list|(
name|fmt
operator|->
name|f_fill
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"' name "
argument_list|)
expr_stmt|;
name|litputs
argument_list|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_type
condition|)
name|printf
argument_list|(
literal|", c_type %s"
argument_list|,
name|c_typestr
argument_list|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_type
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|fmt
operator|->
name|f_comp
operator|->
name|c_flags
condition|)
name|printf
argument_list|(
literal|", c_flags %d"
argument_list|,
name|fmt
operator|->
name|f_comp
operator|->
name|c_flags
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_STRF
case|:
case|case
name|FT_NUMF
case|:
name|printf
argument_list|(
literal|", width %d, fill '"
argument_list|,
name|fmt
operator|->
name|f_width
argument_list|)
expr_stmt|;
name|litputc
argument_list|(
name|fmt
operator|->
name|f_fill
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\''
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_LIT
case|:
ifdef|#
directive|ifdef
name|FT_LIT_FORCE
case|case
name|FT_LIT_FORCE
case|:
endif|#
directive|endif
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|litputs
argument_list|(
name|fmt
operator|->
name|f_text
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_LITF
case|:
name|printf
argument_list|(
literal|", width %d, fill '"
argument_list|,
name|fmt
operator|->
name|f_width
argument_list|)
expr_stmt|;
name|litputc
argument_list|(
name|fmt
operator|->
name|f_fill
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"' "
argument_list|)
expr_stmt|;
name|litputs
argument_list|(
name|fmt
operator|->
name|f_text
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_CHAR
case|:
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\''
argument_list|)
expr_stmt|;
name|litputc
argument_list|(
name|fmt
operator|->
name|f_char
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\''
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_IF_S
case|:
case|case
name|FT_IF_S_NULL
case|:
case|case
name|FT_IF_MATCH
case|:
case|case
name|FT_IF_AMATCH
case|:
name|printf
argument_list|(
literal|" continue else goto"
argument_list|)
expr_stmt|;
case|case
name|FT_GOTO
case|:
name|i
operator|=
name|findlabel
argument_list|(
name|fmt
operator|+
name|fmt
operator|->
name|f_skip
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" L%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_IF_V_EQ
case|:
case|case
name|FT_IF_V_NE
case|:
case|case
name|FT_IF_V_GT
case|:
name|i
operator|=
name|findlabel
argument_list|(
name|fmt
operator|+
name|fmt
operator|->
name|f_skip
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %d continue else goto L%d"
argument_list|,
name|fmt
operator|->
name|f_value
argument_list|,
name|i
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_V_EQ
case|:
case|case
name|FT_V_NE
case|:
case|case
name|FT_V_GT
case|:
case|case
name|FT_LV_LIT
case|:
case|case
name|FT_LV_PLUS_L
case|:
case|case
name|FT_LV_MINUS_L
case|:
case|case
name|FT_LV_DIVIDE_L
case|:
case|case
name|FT_LV_MODULO_L
case|:
name|printf
argument_list|(
literal|" value %d"
argument_list|,
name|fmt
operator|->
name|f_value
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_LS_LIT
case|:
name|printf
argument_list|(
literal|" str "
argument_list|)
expr_stmt|;
name|litputs
argument_list|(
name|fmt
operator|->
name|f_text
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_LS_GETENV
case|:
name|printf
argument_list|(
literal|" getenv "
argument_list|)
expr_stmt|;
name|litputs
argument_list|(
name|fmt
operator|->
name|f_text
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_LS_TRIM
case|:
name|printf
argument_list|(
literal|", width %d"
argument_list|,
name|fmt
operator|->
name|f_width
argument_list|)
expr_stmt|;
break|break;
case|case
name|FT_LV_DAT
case|:
name|printf
argument_list|(
literal|", value dat[%d]"
argument_list|,
name|fmt
operator|->
name|f_value
argument_list|)
expr_stmt|;
break|break;
block|}
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|findlabel
parameter_list|(
name|addr
parameter_list|)
specifier|register
name|struct
name|format
modifier|*
name|addr
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|lused
condition|;
operator|++
name|i
control|)
if|if
condition|(
name|addr
operator|==
name|lvec
index|[
name|i
index|]
condition|)
return|return
operator|(
name|i
operator|)
return|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|assignlabel
parameter_list|(
name|addr
parameter_list|)
specifier|register
name|struct
name|format
modifier|*
name|addr
decl_stmt|;
block|{
name|lvec
index|[
name|lused
operator|++
index|]
operator|=
name|addr
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|f_typestr
parameter_list|(
name|t
parameter_list|)
name|int
name|t
decl_stmt|;
block|{
specifier|static
name|char
name|buf
index|[
literal|32
index|]
decl_stmt|;
switch|switch
condition|(
name|t
condition|)
block|{
case|case
name|FT_COMP
case|:
return|return
operator|(
literal|"COMP"
operator|)
return|;
case|case
name|FT_COMPF
case|:
return|return
operator|(
literal|"COMPF"
operator|)
return|;
case|case
name|FT_LIT
case|:
return|return
operator|(
literal|"LIT"
operator|)
return|;
case|case
name|FT_LITF
case|:
return|return
operator|(
literal|"LITF"
operator|)
return|;
ifdef|#
directive|ifdef
name|FT_LIT_FORCE
case|case
name|FT_LIT_FORCE
case|:
return|return
operator|(
literal|"LIT_FORCE"
operator|)
return|;
endif|#
directive|endif
case|case
name|FT_CHAR
case|:
return|return
operator|(
literal|"CHAR"
operator|)
return|;
case|case
name|FT_NUM
case|:
return|return
operator|(
literal|"NUM"
operator|)
return|;
case|case
name|FT_NUMF
case|:
return|return
operator|(
literal|"NUMF"
operator|)
return|;
case|case
name|FT_STR
case|:
return|return
operator|(
literal|"STR"
operator|)
return|;
case|case
name|FT_STRF
case|:
return|return
operator|(
literal|"STRF"
operator|)
return|;
case|case
name|FT_STRFW
case|:
return|return
operator|(
literal|"STRFW"
operator|)
return|;
case|case
name|FT_PUTADDR
case|:
return|return
operator|(
literal|"PUTADDR"
operator|)
return|;
case|case
name|FT_LS_COMP
case|:
return|return
operator|(
literal|"LS_COMP"
operator|)
return|;
case|case
name|FT_LS_LIT
case|:
return|return
operator|(
literal|"LS_LIT"
operator|)
return|;
case|case
name|FT_LS_GETENV
case|:
return|return
operator|(
literal|"LS_GETENV"
operator|)
return|;
case|case
name|FT_LS_TRIM
case|:
return|return
operator|(
literal|"LS_TRIM"
operator|)
return|;
case|case
name|FT_LV_COMP
case|:
return|return
operator|(
literal|"LV_COMP"
operator|)
return|;
case|case
name|FT_LV_COMPFLAG
case|:
return|return
operator|(
literal|"LV_COMPFLAG"
operator|)
return|;
case|case
name|FT_LV_LIT
case|:
return|return
operator|(
literal|"LV_LIT"
operator|)
return|;
case|case
name|FT_LV_DAT
case|:
return|return
operator|(
literal|"LV_DAT"
operator|)
return|;
case|case
name|FT_LV_STRLEN
case|:
return|return
operator|(
literal|"LV_STRLEN"
operator|)
return|;
case|case
name|FT_LV_PLUS_L
case|:
return|return
operator|(
literal|"LV_PLUS_L"
operator|)
return|;
case|case
name|FT_LV_MINUS_L
case|:
return|return
operator|(
literal|"LV_MINUS_L"
operator|)
return|;
case|case
name|FT_LV_DIVIDE_L
case|:
return|return
operator|(
literal|"LV_DIVIDE_L"
operator|)
return|;
case|case
name|FT_LV_MODULO_L
case|:
return|return
operator|(
literal|"LV_MODULO_L"
operator|)
return|;
case|case
name|FT_LV_CHAR_LEFT
case|:
return|return
operator|(
literal|"LV_CHAR_LEFT"
operator|)
return|;
case|case
name|FT_LS_MONTH
case|:
return|return
operator|(
literal|"LS_MONTH"
operator|)
return|;
case|case
name|FT_LS_LMONTH
case|:
return|return
operator|(
literal|"LS_LMONTH"
operator|)
return|;
case|case
name|FT_LS_ZONE
case|:
return|return
operator|(
literal|"LS_ZONE"
operator|)
return|;
case|case
name|FT_LS_DAY
case|:
return|return
operator|(
literal|"LS_DAY"
operator|)
return|;
case|case
name|FT_LS_WEEKDAY
case|:
return|return
operator|(
literal|"LS_WEEKDAY"
operator|)
return|;
case|case
name|FT_LS_822DATE
case|:
return|return
operator|(
literal|"LS_822DATE"
operator|)
return|;
case|case
name|FT_LS_PRETTY
case|:
return|return
operator|(
literal|"LS_PRETTY"
operator|)
return|;
case|case
name|FT_LV_SEC
case|:
return|return
operator|(
literal|"LV_SEC"
operator|)
return|;
case|case
name|FT_LV_MIN
case|:
return|return
operator|(
literal|"LV_MIN"
operator|)
return|;
case|case
name|FT_LV_HOUR
case|:
return|return
operator|(
literal|"LV_HOUR"
operator|)
return|;
case|case
name|FT_LV_MDAY
case|:
return|return
operator|(
literal|"LV_MDAY"
operator|)
return|;
case|case
name|FT_LV_MON
case|:
return|return
operator|(
literal|"LV_MON"
operator|)
return|;
case|case
name|FT_LV_YEAR
case|:
return|return
operator|(
literal|"LV_YEAR"
operator|)
return|;
case|case
name|FT_LV_YDAY
case|:
return|return
operator|(
literal|"LV_YDAY"
operator|)
return|;
case|case
name|FT_LV_WDAY
case|:
return|return
operator|(
literal|"LV_WDAY"
operator|)
return|;
case|case
name|FT_LV_ZONE
case|:
return|return
operator|(
literal|"LV_ZONE"
operator|)
return|;
case|case
name|FT_LV_CLOCK
case|:
return|return
operator|(
literal|"LV_CLOCK"
operator|)
return|;
case|case
name|FT_LV_RCLOCK
case|:
return|return
operator|(
literal|"LV_RCLOCK"
operator|)
return|;
case|case
name|FT_LV_DAYF
case|:
return|return
operator|(
literal|"LV_DAYF"
operator|)
return|;
case|case
name|FT_LV_DST
case|:
return|return
operator|(
literal|"LV_DST"
operator|)
return|;
case|case
name|FT_LV_ZONEF
case|:
return|return
operator|(
literal|"LV_ZONEF"
operator|)
return|;
case|case
name|FT_LS_ADDR
case|:
return|return
operator|(
literal|"LS_ADDR"
operator|)
return|;
case|case
name|FT_LS_PERS
case|:
return|return
operator|(
literal|"LS_PERS"
operator|)
return|;
case|case
name|FT_LS_MBOX
case|:
return|return
operator|(
literal|"LS_MBOX"
operator|)
return|;
case|case
name|FT_LS_HOST
case|:
return|return
operator|(
literal|"LS_HOST"
operator|)
return|;
case|case
name|FT_LS_PATH
case|:
return|return
operator|(
literal|"LS_PATH"
operator|)
return|;
case|case
name|FT_LS_GNAME
case|:
return|return
operator|(
literal|"LS_GNAME"
operator|)
return|;
case|case
name|FT_LS_NOTE
case|:
return|return
operator|(
literal|"LS_NOTE"
operator|)
return|;
case|case
name|FT_LS_822ADDR
case|:
return|return
operator|(
literal|"LS_822ADDR"
operator|)
return|;
case|case
name|FT_LS_FRIENDLY
case|:
return|return
operator|(
literal|"LS_FRIENDLY"
operator|)
return|;
case|case
name|FT_LV_HOSTTYPE
case|:
return|return
operator|(
literal|"LV_HOSTTYPE"
operator|)
return|;
case|case
name|FT_LV_INGRPF
case|:
return|return
operator|(
literal|"LV_INGRPF"
operator|)
return|;
case|case
name|FT_LV_NOHOSTF
case|:
return|return
operator|(
literal|"LV_NOHOSTF"
operator|)
return|;
case|case
name|FT_LOCALDATE
case|:
return|return
operator|(
literal|"LOCALDATE"
operator|)
return|;
case|case
name|FT_GMTDATE
case|:
return|return
operator|(
literal|"GMTDATE"
operator|)
return|;
case|case
name|FT_PARSEDATE
case|:
return|return
operator|(
literal|"PARSEDATE"
operator|)
return|;
case|case
name|FT_PARSEADDR
case|:
return|return
operator|(
literal|"PARSEADDR"
operator|)
return|;
case|case
name|FT_FORMATADDR
case|:
return|return
operator|(
literal|"FORMATADDR"
operator|)
return|;
case|case
name|FT_MYMBOX
case|:
return|return
operator|(
literal|"MYMBOX"
operator|)
return|;
ifdef|#
directive|ifdef
name|FT_ADDTOSEQ
case|case
name|FT_ADDTOSEQ
case|:
return|return
operator|(
literal|"ADDTOSEQ"
operator|)
return|;
endif|#
directive|endif
case|case
name|FT_SAVESTR
case|:
return|return
operator|(
literal|"SAVESTR"
operator|)
return|;
ifdef|#
directive|ifdef
name|FT_PAUSE
case|case
name|FT_PAUSE
case|:
return|return
operator|(
literal|"PAUSE"
operator|)
return|;
endif|#
directive|endif
case|case
name|FT_DONE
case|:
return|return
operator|(
literal|"DONE"
operator|)
return|;
case|case
name|FT_NOP
case|:
return|return
operator|(
literal|"NOP"
operator|)
return|;
case|case
name|FT_GOTO
case|:
return|return
operator|(
literal|"GOTO"
operator|)
return|;
case|case
name|FT_IF_S_NULL
case|:
return|return
operator|(
literal|"IF_S_NULL"
operator|)
return|;
case|case
name|FT_IF_S
case|:
return|return
operator|(
literal|"IF_S"
operator|)
return|;
case|case
name|FT_IF_V_EQ
case|:
return|return
operator|(
literal|"IF_V_EQ"
operator|)
return|;
case|case
name|FT_IF_V_NE
case|:
return|return
operator|(
literal|"IF_V_NE"
operator|)
return|;
case|case
name|FT_IF_V_GT
case|:
return|return
operator|(
literal|"IF_V_GT"
operator|)
return|;
case|case
name|FT_IF_MATCH
case|:
return|return
operator|(
literal|"IF_MATCH"
operator|)
return|;
case|case
name|FT_IF_AMATCH
case|:
return|return
operator|(
literal|"IF_AMATCH"
operator|)
return|;
case|case
name|FT_S_NULL
case|:
return|return
operator|(
literal|"S_NULL"
operator|)
return|;
case|case
name|FT_S_NONNULL
case|:
return|return
operator|(
literal|"S_NONNULL"
operator|)
return|;
case|case
name|FT_V_EQ
case|:
return|return
operator|(
literal|"V_EQ"
operator|)
return|;
case|case
name|FT_V_NE
case|:
return|return
operator|(
literal|"V_NE"
operator|)
return|;
case|case
name|FT_V_GT
case|:
return|return
operator|(
literal|"V_GT"
operator|)
return|;
case|case
name|FT_V_MATCH
case|:
return|return
operator|(
literal|"V_MATCH"
operator|)
return|;
case|case
name|FT_V_AMATCH
case|:
return|return
operator|(
literal|"V_AMATCH"
operator|)
return|;
default|default:
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"/* ??? #%d */"
argument_list|,
name|t
argument_list|)
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|FNORD
parameter_list|(
name|v
parameter_list|,
name|s
parameter_list|)
value|if (t& (v)) { \ 	if (i++> 0) \ 		strcat(buf, "|"); \ 	strcat(buf, s); }
end_define

begin_function
specifier|static
name|char
modifier|*
name|c_typestr
parameter_list|(
name|t
parameter_list|)
name|int
name|t
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|;
specifier|static
name|char
name|buf
index|[
literal|64
index|]
decl_stmt|;
name|buf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|t
operator|&
operator|~
operator|(
name|CT_ADDR
operator||
name|CT_DATE
operator||
name|CT_MYMBOX
operator||
name|CT_ADDRPARSE
operator|)
condition|)
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"0x%x "
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|buf
argument_list|,
literal|"<"
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
name|FNORD
argument_list|(
name|CT_ADDR
argument_list|,
literal|"ADDR"
argument_list|)
expr_stmt|;
name|FNORD
argument_list|(
name|CT_DATE
argument_list|,
literal|"DATE"
argument_list|)
expr_stmt|;
name|FNORD
argument_list|(
name|CT_MYMBOX
argument_list|,
literal|"MYMBOX"
argument_list|)
expr_stmt|;
name|FNORD
argument_list|(
name|CT_ADDRPARSE
argument_list|,
literal|"ADDRPARSE"
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|buf
argument_list|,
literal|">"
argument_list|)
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
undef|#
directive|undef
name|FNORD
block|}
end_function

begin_function
specifier|static
name|void
name|litputs
parameter_list|(
name|s
parameter_list|)
specifier|register
name|char
modifier|*
name|s
decl_stmt|;
block|{
if|if
condition|(
name|s
condition|)
block|{
name|putc
argument_list|(
literal|'"'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|s
condition|)
name|litputc
argument_list|(
operator|*
name|s
operator|++
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|'"'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
block|}
else|else
name|fputs
argument_list|(
literal|"<nil>"
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|litputc
parameter_list|(
name|c
parameter_list|)
name|char
name|c
decl_stmt|;
block|{
if|if
condition|(
name|c
operator|&
operator|~
literal|0177
condition|)
block|{
name|putc
argument_list|(
literal|'M'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|'-'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|c
operator|&=
literal|0177
expr_stmt|;
block|}
if|if
condition|(
name|c
operator|<
literal|0x20
operator|||
name|c
operator|==
literal|0177
condition|)
block|{
if|if
condition|(
name|c
operator|==
literal|'\b'
condition|)
block|{
name|putc
argument_list|(
literal|'\\'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|'b'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|c
operator|==
literal|'\f'
condition|)
block|{
name|putc
argument_list|(
literal|'\\'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|'f'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
block|{
name|putc
argument_list|(
literal|'\\'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|'n'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|c
operator|==
literal|'\r'
condition|)
block|{
name|putc
argument_list|(
literal|'\\'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|'r'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|c
operator|==
literal|'\t'
condition|)
block|{
name|putc
argument_list|(
literal|'\\'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|'t'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|putc
argument_list|(
literal|'^'
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|c
operator|^
literal|0x40
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
comment|/* DEL to ?, others to alpha */
block|}
block|}
else|else
name|putc
argument_list|(
name|c
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

