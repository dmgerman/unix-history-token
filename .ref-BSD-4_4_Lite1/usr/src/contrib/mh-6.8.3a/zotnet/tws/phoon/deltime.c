begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* deltime.c - subtract date/times  ver  date   who remarks --- ------- --- ------------------------------------------------------------- 01B 15nov86 JP  Modified to use twsubtract(). 01A 08nov86 JP  Written.  Copyright (C) 1986 by Jef Poskanzer.  Permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that this copyright notice appear in all copies and in all supporting documentation.  No representation is made about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty.  */
end_comment

begin_decl_stmt
specifier|static
name|char
name|copyright
index|[]
init|=
literal|"\nCopyright (C) 1986 by Jef Poskanzer.\n"
decl_stmt|;
end_decl_stmt

begin_include
include|#
directive|include
file|"tws.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_define
define|#
directive|define
name|SECSPERMINUTE
value|60
end_define

begin_define
define|#
directive|define
name|SECSPERHOUR
value|(60 * SECSPERMINUTE)
end_define

begin_define
define|#
directive|define
name|SECSPERDAY
value|(24 * SECSPERHOUR)
end_define

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|struct
name|tws
name|tws1
decl_stmt|,
name|tws2
decl_stmt|,
modifier|*
name|twp
decl_stmt|;
name|long
name|delta
decl_stmt|,
name|days
decl_stmt|,
name|hours
decl_stmt|,
name|minutes
decl_stmt|,
name|secs
decl_stmt|;
name|char
modifier|*
name|illdt
init|=
literal|"illegal date/time: %s\n"
decl_stmt|;
if|if
condition|(
name|argc
operator|==
literal|2
condition|)
block|{
name|twp
operator|=
name|dparsetime
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|twp
operator|==
name|NULL
operator|||
name|twp
operator|->
name|tw_flags
operator|&
name|TW_JUNK
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|illdt
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|twscopy
argument_list|(
operator|&
name|tws1
argument_list|,
name|twp
argument_list|)
expr_stmt|;
name|twscopy
argument_list|(
operator|&
name|tws2
argument_list|,
name|dtwstime
argument_list|( )
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|3
condition|)
block|{
name|twp
operator|=
name|dparsetime
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|twp
operator|==
name|NULL
operator|||
name|twp
operator|->
name|tw_flags
operator|&
name|TW_JUNK
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|illdt
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|twscopy
argument_list|(
operator|&
name|tws1
argument_list|,
name|twp
argument_list|)
expr_stmt|;
name|twp
operator|=
name|dparsetime
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|twp
operator|==
name|NULL
operator|||
name|twp
operator|->
name|tw_flags
operator|&
name|TW_JUNK
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|illdt
argument_list|,
name|argv
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|twscopy
argument_list|(
operator|&
name|tws2
argument_list|,
name|twp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"usage:  %s<time>  [<time2> ]\n"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|delta
operator|=
name|twsubtract
argument_list|(
operator|&
name|tws2
argument_list|,
operator|&
name|tws1
argument_list|)
expr_stmt|;
if|if
condition|(
name|delta
operator|<
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"-"
argument_list|)
expr_stmt|;
name|delta
operator|=
operator|-
name|delta
expr_stmt|;
block|}
name|days
operator|=
name|delta
operator|/
name|SECSPERDAY
expr_stmt|;
name|delta
operator|=
name|delta
operator|-
name|days
operator|*
name|SECSPERDAY
expr_stmt|;
name|hours
operator|=
name|delta
operator|/
name|SECSPERHOUR
expr_stmt|;
name|delta
operator|=
name|delta
operator|-
name|hours
operator|*
name|SECSPERHOUR
expr_stmt|;
name|minutes
operator|=
name|delta
operator|/
name|SECSPERMINUTE
expr_stmt|;
name|delta
operator|=
name|delta
operator|-
name|minutes
operator|*
name|SECSPERMINUTE
expr_stmt|;
name|secs
operator|=
name|delta
expr_stmt|;
name|printf
argument_list|(
literal|"%ld %2ld:%02ld:%02ld\n"
argument_list|,
name|days
argument_list|,
name|hours
argument_list|,
name|minutes
argument_list|,
name|secs
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

