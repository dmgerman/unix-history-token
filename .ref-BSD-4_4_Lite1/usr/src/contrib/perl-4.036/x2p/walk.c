begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $RCSfile: walk.c,v $$Revision: 4.0.1.3 $$Date: 92/06/08 17:33:46 $  *  *    Copyright (c) 1991, Larry Wall  *  *    You may distribute under the terms of either the GNU General Public  *    License or the Artistic License, as specified in the README file.  *  * $Log:	walk.c,v $  * Revision 4.0.1.3  92/06/08  17:33:46  lwall  * patch20: in a2p, simplified the filehandle model  * patch20: in a2p, made RS="" translate to $/ = "\n\n"  * patch20: in a2p, do {...} while ... was missing some reconstruction code  * patch20: in a2p, getline should allow variable to be array element  *   * Revision 4.0.1.2  91/11/05  19:25:09  lwall  * patch11: in a2p, split on whitespace produced extra null field  *   * Revision 4.0.1.1  91/06/07  12:22:04  lwall  * patch4: new copyright notice  * patch4: a2p didn't correctly implement -n switch  *   * Revision 4.0  91/03/20  01:58:36  lwall  * 4.0 baseline.  *   */
end_comment

begin_include
include|#
directive|include
file|"handy.h"
end_include

begin_include
include|#
directive|include
file|"EXTERN.h"
end_include

begin_include
include|#
directive|include
file|"util.h"
end_include

begin_include
include|#
directive|include
file|"a2p.h"
end_include

begin_decl_stmt
name|bool
name|exitval
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bool
name|realexit
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bool
name|saw_getline
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bool
name|subretnum
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bool
name|saw_FNR
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bool
name|saw_argv0
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|bool
name|saw_fh
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|maxtmp
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|lparen
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|rparen
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|limit
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|STR
modifier|*
name|subs
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|STR
modifier|*
name|curargs
init|=
name|Nullstr
decl_stmt|;
end_decl_stmt

begin_function
name|STR
modifier|*
name|walk
parameter_list|(
name|useval
parameter_list|,
name|level
parameter_list|,
name|node
parameter_list|,
name|numericptr
parameter_list|,
name|minprec
parameter_list|)
name|int
name|useval
decl_stmt|;
name|int
name|level
decl_stmt|;
specifier|register
name|int
name|node
decl_stmt|;
name|int
modifier|*
name|numericptr
decl_stmt|;
name|int
name|minprec
decl_stmt|;
comment|/* minimum precedence without parens */
block|{
specifier|register
name|int
name|len
decl_stmt|;
specifier|register
name|STR
modifier|*
name|str
decl_stmt|;
specifier|register
name|int
name|type
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|STR
modifier|*
name|tmpstr
decl_stmt|;
name|STR
modifier|*
name|tmp2str
decl_stmt|;
name|STR
modifier|*
name|tmp3str
decl_stmt|;
name|char
modifier|*
name|t
decl_stmt|;
name|char
modifier|*
name|d
decl_stmt|,
modifier|*
name|s
decl_stmt|;
name|int
name|numarg
decl_stmt|;
name|int
name|numeric
init|=
name|FALSE
decl_stmt|;
name|STR
modifier|*
name|fstr
decl_stmt|;
name|int
name|prec
init|=
name|P_MAX
decl_stmt|;
comment|/* assume no parens needed */
name|char
modifier|*
name|index
parameter_list|()
function_decl|;
if|if
condition|(
operator|!
name|node
condition|)
block|{
operator|*
name|numericptr
operator|=
literal|0
expr_stmt|;
return|return
name|str_make
argument_list|(
literal|""
argument_list|)
return|;
block|}
name|type
operator|=
name|ops
index|[
name|node
index|]
operator|.
name|ival
expr_stmt|;
name|len
operator|=
name|type
operator|>>
literal|8
expr_stmt|;
name|type
operator|&=
literal|255
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|OPROG
case|:
name|arymax
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|namelist
condition|)
block|{
while|while
condition|(
name|isalpha
argument_list|(
operator|*
name|namelist
argument_list|)
condition|)
block|{
for|for
control|(
name|d
operator|=
name|tokenbuf
operator|,
name|s
operator|=
name|namelist
init|;
name|isalpha
argument_list|(
operator|*
name|s
argument_list|)
operator|||
name|isdigit
argument_list|(
operator|*
name|s
argument_list|)
operator|||
operator|*
name|s
operator|==
literal|'_'
condition|;
operator|*
name|d
operator|++
operator|=
operator|*
name|s
operator|++
control|)
empty_stmt|;
operator|*
name|d
operator|=
literal|'\0'
expr_stmt|;
while|while
condition|(
operator|*
name|s
operator|&&
operator|!
name|isalpha
argument_list|(
operator|*
name|s
argument_list|)
condition|)
name|s
operator|++
expr_stmt|;
name|namelist
operator|=
name|s
expr_stmt|;
name|nameary
index|[
operator|++
name|arymax
index|]
operator|=
name|savestr
argument_list|(
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|maxfld
operator|<
name|arymax
condition|)
name|maxfld
operator|=
name|arymax
expr_stmt|;
name|opens
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|subs
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
name|do_split
operator|&&
name|need_entire
operator|&&
operator|!
name|absmaxfld
condition|)
name|split_to_array
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|do_split
operator|&&
name|split_to_array
condition|)
name|set_array_base
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|set_array_base
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"$[ = 1;\t\t\t# set array base to 1\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fswitch
operator|&&
operator|!
name|const_FS
condition|)
name|const_FS
operator|=
name|fswitch
expr_stmt|;
if|if
condition|(
name|saw_FS
operator|>
literal|1
operator|||
name|saw_RS
condition|)
name|const_FS
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|saw_ORS
operator|&&
name|need_entire
condition|)
name|do_chop
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|fswitch
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"$FS = '"
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
argument_list|(
literal|"*+?.[]()|^$\\"
argument_list|,
name|fswitch
argument_list|)
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"\\"
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"%c"
argument_list|,
name|fswitch
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"';\t\t# field separator from -F switch\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|saw_FS
operator|&&
operator|!
name|const_FS
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"$FS = ' ';\t\t# set field separator\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|saw_OFS
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"$, = ' ';\t\t# set output field separator\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|saw_ORS
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"$\\ = \"\\n\";\t\t# set output record separator\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|saw_argv0
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"$ARGV0 = $0;\t\t# remember what we ran as\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|str
operator|->
name|str_cur
operator|>
literal|20
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
condition|)
block|{
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"\n\n"
argument_list|)
expr_stmt|;
block|}
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
operator|+
literal|1
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|fstr
operator|->
name|str_ptr
condition|)
block|{
if|if
condition|(
name|saw_line_op
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"line: "
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"while (<>) {\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
operator|++
name|level
argument_list|)
expr_stmt|;
if|if
condition|(
name|saw_FS
operator|&&
operator|!
name|const_FS
condition|)
name|do_chop
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|do_chop
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"chop;\t# strip record separator\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|do_split
condition|)
name|emit_split
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|fixtab
argument_list|(
name|str
argument_list|,
operator|--
name|level
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"}\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|saw_FNR
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"continue {\n    $FNRbase = $. if eof;\n}\n"
argument_list|)
expr_stmt|;
block|}
else|else
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"while (<>) { }		# (no line actions)\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ops
index|[
name|node
operator|+
literal|4
index|]
operator|.
name|ival
condition|)
block|{
name|realexit
operator|=
name|TRUE
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|4
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|exitval
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"exit $ExitValue;\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|subs
operator|->
name|str_ptr
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|subs
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|saw_getline
condition|)
block|{
for|for
control|(
name|len
operator|=
literal|0
init|;
name|len
operator|<
literal|4
condition|;
name|len
operator|++
control|)
block|{
if|if
condition|(
name|saw_getline
operator|&
operator|(
literal|1
operator|<<
name|len
operator|)
condition|)
block|{
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"\nsub Getline%d {\n"
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|&
literal|2
condition|)
block|{
if|if
condition|(
name|do_fancy_opens
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"&Pick('',@_);\n"
argument_list|)
expr_stmt|;
else|else
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"    ($fh) = @_;\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|saw_FNR
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"    $FNRbase = $. if eof;\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|len
operator|&
literal|1
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"    local($_);\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|&
literal|2
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"    if ($getline_ok = (($_ =<$fh>) ne ''))"
argument_list|)
expr_stmt|;
else|else
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"    if ($getline_ok = (($_ =<>) ne ''))"
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" {\n"
argument_list|)
expr_stmt|;
name|level
operator|+=
literal|2
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|do_chop
condition|)
block|{
name|i
operator|++
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"chop;\t# strip record separator\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|do_split
operator|&&
operator|!
operator|(
name|len
operator|&
literal|1
operator|)
condition|)
block|{
name|i
operator|++
expr_stmt|;
name|emit_split
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|i
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|";\n"
argument_list|)
expr_stmt|;
name|fixtab
argument_list|(
name|str
argument_list|,
operator|--
name|level
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"}\n    $_;\n}\n"
argument_list|)
expr_stmt|;
operator|--
name|level
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|do_fancy_opens
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"\n\ sub Pick {\n\     local($mode,$name,$pipe) = @_;\n\     $fh = $name;\n\     open($name,$mode.$name.$pipe) unless $opened{$name}++;\n\ }\n\ "
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|OHUNKS
case|:
name|str
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|3
condition|)
block|{
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
block|}
else|else
block|{ 	}
break|break;
case|case
name|ORANGE
case|:
name|prec
operator|=
name|P_DOTDOT
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" .. "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPAT
case|:
goto|goto
name|def
goto|;
case|case
name|OREGEX
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
name|tmpstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
comment|/* translate \nnn to [\nnn] */
for|for
control|(
name|s
operator|=
name|tmpstr
operator|->
name|str_ptr
operator|,
name|d
operator|=
name|tokenbuf
init|;
operator|*
name|s
condition|;
name|s
operator|++
operator|,
name|d
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|s
operator|==
literal|'\\'
operator|&&
name|isdigit
argument_list|(
name|s
index|[
literal|1
index|]
argument_list|)
operator|&&
name|isdigit
argument_list|(
name|s
index|[
literal|2
index|]
argument_list|)
operator|&&
name|isdigit
argument_list|(
name|s
index|[
literal|3
index|]
argument_list|)
condition|)
block|{
operator|*
name|d
operator|++
operator|=
literal|'['
expr_stmt|;
operator|*
name|d
operator|++
operator|=
operator|*
name|s
operator|++
expr_stmt|;
operator|*
name|d
operator|++
operator|=
operator|*
name|s
operator|++
expr_stmt|;
operator|*
name|d
operator|++
operator|=
operator|*
name|s
operator|++
expr_stmt|;
operator|*
name|d
operator|++
operator|=
operator|*
name|s
expr_stmt|;
operator|*
name|d
operator|=
literal|']'
expr_stmt|;
block|}
else|else
operator|*
name|d
operator|=
operator|*
name|s
expr_stmt|;
block|}
operator|*
name|d
operator|=
literal|'\0'
expr_stmt|;
for|for
control|(
name|d
operator|=
name|tokenbuf
init|;
operator|*
name|d
condition|;
name|d
operator|++
control|)
operator|*
name|d
operator|+=
literal|128
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OHUNK
case|:
if|if
condition|(
name|len
operator|==
literal|1
condition|)
block|{
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|oper1
argument_list|(
name|OPRINT
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" if "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|";"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|tmpstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|tmpstr
operator|->
name|str_ptr
condition|)
block|{
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"if ("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|") {\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
operator|++
name|level
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|fixtab
argument_list|(
name|str
argument_list|,
operator|--
name|level
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"}\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|str
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|OPPAREN
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
name|useval
operator|!=
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPANDAND
case|:
name|prec
operator|=
name|P_ANDAND
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"&& "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPOROR
case|:
name|prec
operator|=
name|P_OROR
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" || "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPNOT
case|:
name|prec
operator|=
name|P_UNARY
expr_stmt|;
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"!"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OCOND
case|:
name|prec
operator|=
name|P_COND
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" ? "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" : "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OCPAREN
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
name|useval
operator|!=
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OCANDAND
case|:
name|prec
operator|=
name|P_ANDAND
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"&& "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OCOROR
case|:
name|prec
operator|=
name|P_OROR
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" || "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OCNOT
case|:
name|prec
operator|=
name|P_UNARY
expr_stmt|;
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"!"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|ORELOP
case|:
name|prec
operator|=
name|P_REL
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
name|tmpstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|tmp2str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
if|if
condition|(
operator|!
name|numeric
operator|||
operator|(
operator|!
name|numarg
operator|&&
operator|(
operator|*
name|tmp2str
operator|->
name|str_ptr
operator|==
literal|'"'
operator|||
operator|*
name|tmp2str
operator|->
name|str_ptr
operator|==
literal|'\''
operator|)
operator|)
condition|)
block|{
name|t
operator|=
name|tmpstr
operator|->
name|str_ptr
expr_stmt|;
if|if
condition|(
name|strEQ
argument_list|(
name|t
argument_list|,
literal|"=="
argument_list|)
condition|)
name|str_set
argument_list|(
name|tmpstr
argument_list|,
literal|"eq"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strEQ
argument_list|(
name|t
argument_list|,
literal|"!="
argument_list|)
condition|)
name|str_set
argument_list|(
name|tmpstr
argument_list|,
literal|"ne"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strEQ
argument_list|(
name|t
argument_list|,
literal|"<"
argument_list|)
condition|)
name|str_set
argument_list|(
name|tmpstr
argument_list|,
literal|"lt"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strEQ
argument_list|(
name|t
argument_list|,
literal|"<="
argument_list|)
condition|)
name|str_set
argument_list|(
name|tmpstr
argument_list|,
literal|"le"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strEQ
argument_list|(
name|t
argument_list|,
literal|">"
argument_list|)
condition|)
name|str_set
argument_list|(
name|tmpstr
argument_list|,
literal|"gt"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strEQ
argument_list|(
name|t
argument_list|,
literal|">="
argument_list|)
condition|)
name|str_set
argument_list|(
name|tmpstr
argument_list|,
literal|"ge"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|index
argument_list|(
name|tmpstr
operator|->
name|str_ptr
argument_list|,
literal|'\''
argument_list|)
operator|&&
operator|!
name|index
argument_list|(
name|tmpstr
operator|->
name|str_ptr
argument_list|,
literal|'"'
argument_list|)
operator|&&
operator|!
name|index
argument_list|(
name|tmp2str
operator|->
name|str_ptr
argument_list|,
literal|'\''
argument_list|)
operator|&&
operator|!
name|index
argument_list|(
name|tmp2str
operator|->
name|str_ptr
argument_list|,
literal|'"'
argument_list|)
condition|)
name|numeric
operator||=
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|numeric
operator|&
literal|2
condition|)
block|{
if|if
condition|(
name|numeric
operator|&
literal|1
condition|)
comment|/* numeric is very good guess */
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
else|else
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"\377"
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
block|}
else|else
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmp2str
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmp2str
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|ORPAREN
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
name|useval
operator|!=
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OMATCHOP
case|:
name|prec
operator|=
name|P_MATCH
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|tmpstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
name|strEQ
argument_list|(
name|tmpstr
operator|->
name|str_ptr
argument_list|,
literal|"~"
argument_list|)
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"=~"
argument_list|)
expr_stmt|;
else|else
block|{
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
block|}
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OMPAREN
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
name|useval
operator|!=
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OCONCAT
case|:
name|prec
operator|=
name|P_ADD
expr_stmt|;
name|type
operator|=
name|ops
index|[
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
index|]
operator|.
name|ival
operator|&
literal|255
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
operator|(
name|type
operator|!=
name|OCONCAT
operator|)
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" . "
argument_list|)
expr_stmt|;
name|type
operator|=
name|ops
index|[
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
index|]
operator|.
name|ival
operator|&
literal|255
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
operator|(
name|type
operator|!=
name|OCONCAT
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OASSIGN
case|:
name|prec
operator|=
name|P_ASSIGN
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|tmpstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
if|if
condition|(
name|str_len
argument_list|(
name|tmpstr
argument_list|)
operator|>
literal|1
condition|)
name|numeric
operator|=
literal|1
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
if|if
condition|(
name|strEQ
argument_list|(
name|str
operator|->
name|str_ptr
argument_list|,
literal|"$/ = ''"
argument_list|)
condition|)
name|str_set
argument_list|(
name|str
argument_list|,
literal|"$/ = \"\\n\\n\""
argument_list|)
expr_stmt|;
break|break;
case|case
name|OADD
case|:
name|prec
operator|=
name|P_ADD
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" + "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OSUBTRACT
case|:
name|prec
operator|=
name|P_ADD
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" - "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OMULT
case|:
name|prec
operator|=
name|P_MUL
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" * "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|ODIV
case|:
name|prec
operator|=
name|P_MUL
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" / "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OPOW
case|:
name|prec
operator|=
name|P_POW
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" ** "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OMOD
case|:
name|prec
operator|=
name|P_MUL
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" % "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OPOSTINCR
case|:
name|prec
operator|=
name|P_AUTO
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"++"
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OPOSTDECR
case|:
name|prec
operator|=
name|P_AUTO
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"--"
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OPREINCR
case|:
name|prec
operator|=
name|P_AUTO
expr_stmt|;
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"++"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OPREDECR
case|:
name|prec
operator|=
name|P_AUTO
expr_stmt|;
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"--"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OUMINUS
case|:
name|prec
operator|=
name|P_UNARY
expr_stmt|;
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"-"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OUPLUS
case|:
name|numeric
operator|=
literal|1
expr_stmt|;
goto|goto
name|def
goto|;
case|case
name|OPAREN
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
name|useval
operator|!=
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
break|break;
case|case
name|OGETLINE
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|useval
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
literal|0
condition|)
block|{
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|fstr
operator|->
name|str_ptr
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"$_"
argument_list|)
expr_stmt|;
name|len
operator|=
literal|2
expr_stmt|;
comment|/* a legal fiction */
block|}
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
block|}
else|else
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"$_"
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
literal|1
condition|)
block|{
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|do_fancy_opens
condition|)
block|{
name|t
operator|=
name|tmpstr
operator|->
name|str_ptr
expr_stmt|;
if|if
condition|(
operator|*
name|t
operator|==
literal|'"'
operator|||
operator|*
name|t
operator|==
literal|'\''
condition|)
name|t
operator|=
name|cpytill
argument_list|(
name|tokenbuf
argument_list|,
name|t
operator|+
literal|1
argument_list|,
operator|*
name|t
argument_list|)
expr_stmt|;
else|else
name|fatal
argument_list|(
literal|"Internal error: OGETLINE %s"
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|d
operator|=
name|savestr
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|s
operator|=
name|savestr
argument_list|(
name|tokenbuf
argument_list|)
expr_stmt|;
for|for
control|(
name|t
operator|=
name|tokenbuf
init|;
operator|*
name|t
condition|;
name|t
operator|++
control|)
block|{
operator|*
name|t
operator|&=
literal|127
expr_stmt|;
if|if
condition|(
name|islower
argument_list|(
operator|*
name|t
argument_list|)
condition|)
operator|*
name|t
operator|=
name|toupper
argument_list|(
operator|*
name|t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isalpha
argument_list|(
operator|*
name|t
argument_list|)
operator|&&
operator|!
name|isdigit
argument_list|(
operator|*
name|t
argument_list|)
condition|)
operator|*
name|t
operator|=
literal|'_'
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|index
argument_list|(
name|tokenbuf
argument_list|,
literal|'_'
argument_list|)
condition|)
name|strcpy
argument_list|(
name|t
argument_list|,
literal|"_FH"
argument_list|)
expr_stmt|;
name|tmp3str
operator|=
name|hfetch
argument_list|(
name|symtab
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tmp3str
condition|)
block|{
name|do_opens
operator|=
name|TRUE
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|"open("
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
name|d
index|[
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
name|tmpstr
operator|->
name|str_ptr
operator|+
literal|1
argument_list|)
expr_stmt|;
name|opens
operator|->
name|str_cur
operator|--
expr_stmt|;
if|if
condition|(
operator|*
name|fstr
operator|->
name|str_ptr
operator|==
literal|'|'
condition|)
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|"|"
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
name|d
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|fstr
operator|->
name|str_ptr
operator|==
literal|'|'
condition|)
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|") || die 'Cannot pipe from \""
argument_list|)
expr_stmt|;
else|else
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|") || die 'Cannot open file \""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|d
operator|==
literal|'"'
condition|)
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|"'.\""
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|d
operator|==
literal|'"'
condition|)
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|"\".'"
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|"\".';\n"
argument_list|)
expr_stmt|;
name|hstore
argument_list|(
name|symtab
argument_list|,
name|tokenbuf
argument_list|,
name|str_make
argument_list|(
literal|"x"
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|safefree
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|safefree
argument_list|(
name|d
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|tmpstr
argument_list|,
literal|"'"
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
literal|"'"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|fstr
operator|->
name|str_ptr
operator|==
literal|'|'
condition|)
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
literal|", '|'"
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
block|}
else|else
name|tmpstr
operator|=
name|str_make
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|" =&Getline%d(%s)"
argument_list|,
name|len
argument_list|,
name|tmpstr
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
if|if
condition|(
name|useval
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|",$getline_ok)"
argument_list|)
expr_stmt|;
name|saw_getline
operator||=
literal|1
operator|<<
name|len
expr_stmt|;
break|break;
case|case
name|OSPRINTF
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"sprintf("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSUBSTR
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"substr("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_COMMA
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_COMMA
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|3
condition|)
block|{
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_COMMA
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
block|}
else|else
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"999999"
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSTRING
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|cval
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSPLIT
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|limit
operator|=
literal|", 9999)"
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
name|useval
condition|)
name|str_set
argument_list|(
name|str
argument_list|,
literal|"(@"
argument_list|)
expr_stmt|;
else|else
name|str_set
argument_list|(
name|str
argument_list|,
literal|"@"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" = split("
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|3
condition|)
block|{
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_COMMA
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|str_len
argument_list|(
name|fstr
argument_list|)
operator|==
literal|3
operator|&&
operator|*
name|fstr
operator|->
name|str_ptr
operator|==
literal|'\''
condition|)
block|{
name|i
operator|=
name|fstr
operator|->
name|str_ptr
index|[
literal|1
index|]
operator|&
literal|127
expr_stmt|;
if|if
condition|(
name|index
argument_list|(
literal|"*+?.[]()|^$\\"
argument_list|,
name|i
argument_list|)
condition|)
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"/\\%c/"
argument_list|,
name|i
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|i
operator|==
literal|' '
condition|)
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"' '"
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"/%c/"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
else|else
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|const_FS
condition|)
block|{
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"/[%c\\n]/"
argument_list|,
name|const_FS
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|saw_FS
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"$FS"
argument_list|)
expr_stmt|;
else|else
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"' '"
argument_list|)
expr_stmt|;
name|limit
operator|=
literal|")"
expr_stmt|;
block|}
name|str_cat
argument_list|(
name|str
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_COMMA
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|limit
argument_list|)
expr_stmt|;
if|if
condition|(
name|useval
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OINDEX
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"index("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_COMMA
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_COMMA
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OMATCH
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|prec
operator|=
name|P_ANDAND
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MATCH
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" =~ "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MATCH
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"&& ($RLENGTH = length($&), $RSTART = length($`)+1)"
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OUSERDEF
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|subretnum
operator|=
name|FALSE
expr_stmt|;
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
operator|-
literal|1
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|curargs
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_sset
argument_list|(
name|curargs
argument_list|,
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|curargs
argument_list|,
literal|","
argument_list|)
expr_stmt|;
name|tmp2str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|5
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|curargs
argument_list|)
expr_stmt|;
name|curargs
operator|=
name|Nullstr
expr_stmt|;
name|level
operator|--
expr_stmt|;
name|subretnum
operator||=
name|numarg
expr_stmt|;
name|s
operator|=
name|Nullch
expr_stmt|;
name|t
operator|=
name|tmp2str
operator|->
name|str_ptr
expr_stmt|;
while|while
condition|(
name|t
operator|=
name|instr
argument_list|(
name|t
argument_list|,
literal|"return "
argument_list|)
condition|)
name|s
operator|=
name|t
operator|++
expr_stmt|;
if|if
condition|(
name|s
condition|)
block|{
name|i
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|t
operator|=
name|s
operator|+
literal|7
init|;
operator|*
name|t
condition|;
name|t
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|t
operator|==
literal|';'
operator|||
operator|*
name|t
operator|==
literal|'}'
condition|)
name|i
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|==
literal|1
condition|)
block|{
name|strcpy
argument_list|(
name|s
argument_list|,
name|s
operator|+
literal|7
argument_list|)
expr_stmt|;
name|tmp2str
operator|->
name|str_cur
operator|-=
literal|7
expr_stmt|;
block|}
block|}
name|str_set
argument_list|(
name|str
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"sub "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" {\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
operator|++
name|level
argument_list|)
expr_stmt|;
if|if
condition|(
name|fstr
operator|->
name|str_cur
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"local("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|") = @_;"
argument_list|)
expr_stmt|;
block|}
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|fixtab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|4
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|fixtab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmp2str
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmp2str
argument_list|)
expr_stmt|;
name|fixtab
argument_list|(
name|str
argument_list|,
operator|--
name|level
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"}\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|subs
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|tmp2str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|subretnum
condition|)
name|str_set
argument_list|(
name|tmp2str
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|hstore
argument_list|(
name|symtab
argument_list|,
name|tmpstr
operator|->
name|str_ptr
argument_list|,
name|tmp2str
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
break|break;
case|case
name|ORETURN
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
literal|0
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"return "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_UNI
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
if|if
condition|(
name|numarg
condition|)
name|subretnum
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"return"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OUSERFUN
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"&"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|tmpstr
operator|=
name|hfetch
argument_list|(
name|symtab
argument_list|,
name|str
operator|->
name|str_ptr
operator|+
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmpstr
operator|&&
name|tmpstr
operator|->
name|str_ptr
condition|)
name|numeric
operator||=
name|atoi
argument_list|(
name|tmpstr
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OGSUB
case|:
case|case
name|OSUB
case|:
if|if
condition|(
name|type
operator|==
name|OGSUB
condition|)
name|s
operator|=
literal|"g"
expr_stmt|;
else|else
name|s
operator|=
literal|""
expr_stmt|;
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|tmpstr
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|3
condition|)
block|{
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MATCH
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|strNE
argument_list|(
name|tmpstr
operator|->
name|str_ptr
argument_list|,
literal|"$_"
argument_list|)
condition|)
block|{
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
literal|" =~ s"
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
else|else
name|str_set
argument_list|(
name|tmpstr
argument_list|,
literal|"s"
argument_list|)
expr_stmt|;
block|}
else|else
name|str_set
argument_list|(
name|tmpstr
argument_list|,
literal|"s"
argument_list|)
expr_stmt|;
name|type
operator|=
name|ops
index|[
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
index|]
operator|.
name|ival
expr_stmt|;
name|len
operator|=
name|type
operator|>>
literal|8
expr_stmt|;
name|type
operator|&=
literal|255
expr_stmt|;
name|tmp3str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|OSTR
condition|)
block|{
name|tmp2str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
for|for
control|(
name|t
operator|=
name|tmp2str
operator|->
name|str_ptr
operator|,
name|d
operator|=
name|tokenbuf
init|;
operator|*
name|t
condition|;
name|d
operator|++
operator|,
name|t
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|t
operator|==
literal|'&'
condition|)
operator|*
name|d
operator|++
operator|=
literal|'$'
operator|+
literal|128
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|t
operator|==
literal|'$'
condition|)
operator|*
name|d
operator|++
operator|=
literal|'\\'
operator|+
literal|128
expr_stmt|;
operator|*
name|d
operator|=
operator|*
name|t
operator|+
literal|128
expr_stmt|;
block|}
operator|*
name|d
operator|=
literal|'\0'
expr_stmt|;
name|str_set
argument_list|(
name|tmp2str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|tmp2str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|tmp3str
argument_list|,
literal|"($s_ = '\"'.("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|tmp3str
argument_list|,
name|tmp2str
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmp3str
argument_list|,
literal|").'\"') =~ s/&/\\$&/g, "
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|tmp2str
argument_list|,
literal|"eval $s_"
argument_list|)
expr_stmt|;
name|s
operator|=
operator|(
operator|*
name|s
operator|==
literal|'g'
condition|?
literal|"ge"
else|:
literal|"e"
operator|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
name|type
operator|=
name|ops
index|[
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
index|]
operator|.
name|ival
expr_stmt|;
name|len
operator|=
name|type
operator|>>
literal|8
expr_stmt|;
name|type
operator|&=
literal|255
expr_stmt|;
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|OREGEX
condition|)
block|{
if|if
condition|(
name|useval
operator|&&
name|i
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmp3str
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmp2str
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|type
operator|==
name|OFLD
operator|&&
operator|!
name|split_to_array
operator|)
operator|||
operator|(
name|type
operator|==
name|OVAR
operator|&&
name|len
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|useval
operator|&&
name|i
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmp3str
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmp2str
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|i
operator|++
expr_stmt|;
if|if
condition|(
name|useval
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"$s = "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmp3str
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"/$s/"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmp2str
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|useval
operator|&&
name|i
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmp2str
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmp3str
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|ONUM
case|:
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OSTR
case|:
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|s
operator|=
literal|"'"
expr_stmt|;
for|for
control|(
name|t
operator|=
name|tmpstr
operator|->
name|str_ptr
operator|,
name|d
operator|=
name|tokenbuf
init|;
operator|*
name|t
condition|;
name|d
operator|++
operator|,
name|t
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|t
operator|==
literal|'\''
condition|)
name|s
operator|=
literal|"\""
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|t
operator|==
literal|'\\'
condition|)
block|{
name|s
operator|=
literal|"\""
expr_stmt|;
operator|*
name|d
operator|++
operator|=
operator|*
name|t
operator|++
operator|+
literal|128
expr_stmt|;
switch|switch
condition|(
operator|*
name|t
condition|)
block|{
case|case
literal|'\\'
case|:
case|case
literal|'"'
case|:
case|case
literal|'n'
case|:
case|case
literal|'t'
case|:
case|case
literal|'$'
case|:
break|break;
default|default:
comment|/* hide this from perl */
operator|*
name|d
operator|++
operator|=
literal|'\\'
operator|+
literal|128
expr_stmt|;
block|}
block|}
operator|*
name|d
operator|=
operator|*
name|t
operator|+
literal|128
expr_stmt|;
block|}
operator|*
name|d
operator|=
literal|'\0'
expr_stmt|;
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|s
argument_list|)
expr_stmt|;
break|break;
case|case
name|ODEFINED
case|:
name|prec
operator|=
name|P_UNI
expr_stmt|;
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"defined $"
argument_list|)
expr_stmt|;
goto|goto
name|addvar
goto|;
case|case
name|ODELETE
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"delete $"
argument_list|)
expr_stmt|;
goto|goto
name|addvar
goto|;
case|case
name|OSTAR
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"*"
argument_list|)
expr_stmt|;
goto|goto
name|addvar
goto|;
case|case
name|OVAR
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"$"
argument_list|)
expr_stmt|;
name|addvar
label|:
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|1
condition|)
block|{
name|tmp2str
operator|=
name|hfetch
argument_list|(
name|symtab
argument_list|,
name|tmpstr
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp2str
operator|&&
name|atoi
argument_list|(
name|tmp2str
operator|->
name|str_ptr
argument_list|)
condition|)
name|numeric
operator|=
literal|2
expr_stmt|;
if|if
condition|(
name|strEQ
argument_list|(
name|str
operator|->
name|str_ptr
argument_list|,
literal|"$FNR"
argument_list|)
condition|)
block|{
name|numeric
operator|=
literal|1
expr_stmt|;
name|saw_FNR
operator|++
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"($.-$FNRbase)"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strEQ
argument_list|(
name|str
operator|->
name|str_ptr
argument_list|,
literal|"$NR"
argument_list|)
condition|)
block|{
name|numeric
operator|=
literal|1
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"$."
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strEQ
argument_list|(
name|str
operator|->
name|str_ptr
argument_list|,
literal|"$NF"
argument_list|)
condition|)
block|{
name|numeric
operator|=
literal|1
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"$#Fld"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strEQ
argument_list|(
name|str
operator|->
name|str_ptr
argument_list|,
literal|"$0"
argument_list|)
condition|)
name|str_set
argument_list|(
name|str
argument_list|,
literal|"$_"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strEQ
argument_list|(
name|str
operator|->
name|str_ptr
argument_list|,
literal|"$ARGC"
argument_list|)
condition|)
name|str_set
argument_list|(
name|str
argument_list|,
literal|"($#ARGV+1)"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|NOTDEF
if|if
condition|(
name|curargs
condition|)
block|{
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$%s,"
argument_list|,
name|tmpstr
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
operator|???
if|if
condition|(
name|instr
argument_list|(
name|curargs
operator|->
name|str_ptr
argument_list|,
name|tokenbuf
argument_list|)
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"\377"
argument_list|)
expr_stmt|;
comment|/* can't translate yet */
block|}
endif|#
directive|endif
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
literal|"[]"
argument_list|)
expr_stmt|;
name|tmp2str
operator|=
name|hfetch
argument_list|(
name|symtab
argument_list|,
name|tmpstr
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp2str
operator|&&
name|atoi
argument_list|(
name|tmp2str
operator|->
name|str_ptr
argument_list|)
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"["
argument_list|)
expr_stmt|;
else|else
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"{"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
if|if
condition|(
name|strEQ
argument_list|(
name|str
operator|->
name|str_ptr
argument_list|,
literal|"$ARGV[0"
argument_list|)
condition|)
block|{
name|str_set
argument_list|(
name|str
argument_list|,
literal|"$ARGV0"
argument_list|)
expr_stmt|;
name|saw_argv0
operator|++
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|tmp2str
operator|&&
name|atoi
argument_list|(
name|tmp2str
operator|->
name|str_ptr
argument_list|)
condition|)
name|strcpy
argument_list|(
name|tokenbuf
argument_list|,
literal|"]"
argument_list|)
expr_stmt|;
else|else
name|strcpy
argument_list|(
name|tokenbuf
argument_list|,
literal|"}"
argument_list|)
expr_stmt|;
operator|*
name|tokenbuf
operator|+=
literal|128
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
block|}
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OFLD
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|split_to_array
condition|)
block|{
name|str_set
argument_list|(
name|str
argument_list|,
literal|"$Fld"
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"["
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"]"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|i
operator|=
name|atoi
argument_list|(
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<=
name|arymax
condition|)
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$%s"
argument_list|,
name|nameary
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$Fld%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|OVFLD
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"$Fld["
argument_list|)
expr_stmt|;
name|i
operator|=
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
expr_stmt|;
if|if
condition|(
operator|(
name|ops
index|[
name|i
index|]
operator|.
name|ival
operator|&
literal|255
operator|)
operator|==
name|OPAREN
condition|)
name|i
operator|=
name|ops
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|ival
expr_stmt|;
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|i
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"]"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OJUNK
case|:
goto|goto
name|def
goto|;
case|case
name|OSNEWLINE
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|";\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
break|break;
case|case
name|ONEWLINE
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSCOMMENT
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|";"
argument_list|)
expr_stmt|;
name|tmpstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
for|for
control|(
name|s
operator|=
name|tmpstr
operator|->
name|str_ptr
init|;
operator|*
name|s
operator|&&
operator|*
name|s
operator|!=
literal|'\n'
condition|;
name|s
operator|++
control|)
operator|*
name|s
operator|+=
literal|128
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
break|break;
case|case
name|OCOMMENT
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|tmpstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
for|for
control|(
name|s
operator|=
name|tmpstr
operator|->
name|str_ptr
init|;
operator|*
name|s
operator|&&
operator|*
name|s
operator|!=
literal|'\n'
condition|;
name|s
operator|++
control|)
operator|*
name|s
operator|+=
literal|128
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
break|break;
case|case
name|OCOMMA
case|:
name|prec
operator|=
name|P_COMMA
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSEMICOLON
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|";\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSTATES
case|:
name|str
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSTATE
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>=
literal|1
condition|)
block|{
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>=
literal|2
condition|)
block|{
name|tmpstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|tmpstr
operator|->
name|str_ptr
operator|==
literal|';'
condition|)
block|{
name|addsemi
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tmpstr
operator|->
name|str_ptr
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|OCLOSE
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"close("
argument_list|)
expr_stmt|;
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|do_fancy_opens
condition|)
block|{
name|t
operator|=
name|tmpstr
operator|->
name|str_ptr
expr_stmt|;
if|if
condition|(
operator|*
name|t
operator|==
literal|'"'
operator|||
operator|*
name|t
operator|==
literal|'\''
condition|)
name|t
operator|=
name|cpytill
argument_list|(
name|tokenbuf
argument_list|,
name|t
operator|+
literal|1
argument_list|,
operator|*
name|t
argument_list|)
expr_stmt|;
else|else
name|fatal
argument_list|(
literal|"Internal error: OCLOSE %s"
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|s
operator|=
name|savestr
argument_list|(
name|tokenbuf
argument_list|)
expr_stmt|;
for|for
control|(
name|t
operator|=
name|tokenbuf
init|;
operator|*
name|t
condition|;
name|t
operator|++
control|)
block|{
operator|*
name|t
operator|&=
literal|127
expr_stmt|;
if|if
condition|(
name|islower
argument_list|(
operator|*
name|t
argument_list|)
condition|)
operator|*
name|t
operator|=
name|toupper
argument_list|(
operator|*
name|t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isalpha
argument_list|(
operator|*
name|t
argument_list|)
operator|&&
operator|!
name|isdigit
argument_list|(
operator|*
name|t
argument_list|)
condition|)
operator|*
name|t
operator|=
literal|'_'
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|index
argument_list|(
name|tokenbuf
argument_list|,
literal|'_'
argument_list|)
condition|)
name|strcpy
argument_list|(
name|t
argument_list|,
literal|"_FH"
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|safefree
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"close "
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"delete $opened{%s}&& close(%s)"
argument_list|,
name|tmpstr
operator|->
name|str_ptr
argument_list|,
name|tmpstr
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|OPRINTF
case|:
case|case
name|OPRINT
case|:
name|lparen
operator|=
literal|""
expr_stmt|;
comment|/* set to parens if necessary */
name|rparen
operator|=
literal|""
expr_stmt|;
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|3
condition|)
block|{
comment|/* output redirection */
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|tmp2str
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|do_fancy_opens
condition|)
block|{
name|t
operator|=
name|tmpstr
operator|->
name|str_ptr
expr_stmt|;
if|if
condition|(
operator|*
name|t
operator|==
literal|'"'
operator|||
operator|*
name|t
operator|==
literal|'\''
condition|)
name|t
operator|=
name|cpytill
argument_list|(
name|tokenbuf
argument_list|,
name|t
operator|+
literal|1
argument_list|,
operator|*
name|t
argument_list|)
expr_stmt|;
else|else
name|fatal
argument_list|(
literal|"Internal error: OPRINT"
argument_list|)
expr_stmt|;
name|d
operator|=
name|savestr
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|s
operator|=
name|savestr
argument_list|(
name|tokenbuf
argument_list|)
expr_stmt|;
for|for
control|(
name|t
operator|=
name|tokenbuf
init|;
operator|*
name|t
condition|;
name|t
operator|++
control|)
block|{
operator|*
name|t
operator|&=
literal|127
expr_stmt|;
if|if
condition|(
name|islower
argument_list|(
operator|*
name|t
argument_list|)
condition|)
operator|*
name|t
operator|=
name|toupper
argument_list|(
operator|*
name|t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|isalpha
argument_list|(
operator|*
name|t
argument_list|)
operator|&&
operator|!
name|isdigit
argument_list|(
operator|*
name|t
argument_list|)
condition|)
operator|*
name|t
operator|=
literal|'_'
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|index
argument_list|(
name|tokenbuf
argument_list|,
literal|'_'
argument_list|)
condition|)
name|strcpy
argument_list|(
name|t
argument_list|,
literal|"_FH"
argument_list|)
expr_stmt|;
name|tmp3str
operator|=
name|hfetch
argument_list|(
name|symtab
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tmp3str
condition|)
block|{
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|"open("
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
name|d
index|[
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|opens
argument_list|,
name|tmp2str
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
name|tmpstr
operator|->
name|str_ptr
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|tmp2str
operator|->
name|str_ptr
operator|==
literal|'|'
condition|)
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|") || die 'Cannot pipe to \""
argument_list|)
expr_stmt|;
else|else
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|") || die 'Cannot create file \""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|d
operator|==
literal|'"'
condition|)
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|"'.\""
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|d
operator|==
literal|'"'
condition|)
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|"\".'"
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|opens
argument_list|,
literal|"\".';\n"
argument_list|)
expr_stmt|;
name|hstore
argument_list|(
name|symtab
argument_list|,
name|tokenbuf
argument_list|,
name|str_make
argument_list|(
literal|"x"
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmp2str
argument_list|)
expr_stmt|;
name|safefree
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|safefree
argument_list|(
name|d
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"&Pick('%s', %s)&&\n"
argument_list|,
name|tmp2str
operator|->
name|str_ptr
argument_list|,
name|tmpstr
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|tokenbuf
argument_list|,
literal|"$fh"
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmp2str
argument_list|)
expr_stmt|;
name|lparen
operator|=
literal|"("
expr_stmt|;
name|rparen
operator|=
literal|")"
expr_stmt|;
block|}
block|}
else|else
name|strcpy
argument_list|(
name|tokenbuf
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|lparen
argument_list|)
expr_stmt|;
comment|/* may be null */
if|if
condition|(
name|type
operator|==
name|OPRINTF
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"printf"
argument_list|)
expr_stmt|;
else|else
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"print"
argument_list|)
expr_stmt|;
name|saw_fh
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|3
operator|||
name|do_fancy_opens
condition|)
block|{
if|if
condition|(
operator|*
name|tokenbuf
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|saw_fh
operator|=
literal|1
expr_stmt|;
block|}
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
operator|+
operator|(
name|type
operator|==
name|OPRINT
operator|)
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|tmpstr
operator|->
name|str_ptr
operator|&&
name|lval_field
condition|)
block|{
name|t
operator|=
name|saw_OFS
condition|?
literal|"$,"
else|:
literal|"' '"
expr_stmt|;
if|if
condition|(
name|split_to_array
condition|)
block|{
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"join(%s,@Fld)"
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|maxfld
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|<=
name|arymax
condition|)
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$%s, "
argument_list|,
name|nameary
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$Fld%d, "
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|maxfld
operator|<=
name|arymax
condition|)
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$%s"
argument_list|,
name|nameary
index|[
name|maxfld
index|]
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$Fld%d"
argument_list|,
name|maxfld
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|*
name|tmpstr
operator|->
name|str_ptr
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|saw_fh
operator|&&
operator|*
name|tmpstr
operator|->
name|str_ptr
operator|==
literal|'('
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
else|else
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" $_"
argument_list|)
expr_stmt|;
block|}
name|str_cat
argument_list|(
name|str
argument_list|,
name|rparen
argument_list|)
expr_stmt|;
comment|/* may be null */
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|ORAND
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"rand(1)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSRAND
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"srand("
argument_list|)
expr_stmt|;
goto|goto
name|maybe0
goto|;
case|case
name|OATAN2
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"atan2("
argument_list|)
expr_stmt|;
goto|goto
name|maybe0
goto|;
case|case
name|OSIN
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"sin("
argument_list|)
expr_stmt|;
goto|goto
name|maybe0
goto|;
case|case
name|OCOS
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"cos("
argument_list|)
expr_stmt|;
goto|goto
name|maybe0
goto|;
case|case
name|OSYSTEM
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"system("
argument_list|)
expr_stmt|;
goto|goto
name|maybe0
goto|;
case|case
name|OLENGTH
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"length("
argument_list|)
expr_stmt|;
goto|goto
name|maybe0
goto|;
case|case
name|OLOG
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"log("
argument_list|)
expr_stmt|;
goto|goto
name|maybe0
goto|;
case|case
name|OEXP
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"exp("
argument_list|)
expr_stmt|;
goto|goto
name|maybe0
goto|;
case|case
name|OSQRT
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"sqrt("
argument_list|)
expr_stmt|;
goto|goto
name|maybe0
goto|;
case|case
name|OINT
case|:
name|str
operator|=
name|str_make
argument_list|(
literal|"int("
argument_list|)
expr_stmt|;
name|maybe0
label|:
name|numeric
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|len
operator|>
literal|0
condition|)
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
else|else
name|tmpstr
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
empty_stmt|;
if|if
condition|(
operator|!
name|tmpstr
operator|->
name|str_ptr
operator|||
operator|!
operator|*
name|tmpstr
operator|->
name|str_ptr
condition|)
block|{
if|if
condition|(
name|lval_field
condition|)
block|{
name|t
operator|=
name|saw_OFS
condition|?
literal|"$,"
else|:
literal|"' '"
expr_stmt|;
if|if
condition|(
name|split_to_array
condition|)
block|{
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"join(%s,@Fld)"
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"join(%s, "
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|maxfld
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|<=
name|arymax
condition|)
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$%s,"
argument_list|,
name|nameary
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$Fld%d,"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|maxfld
operator|<=
name|arymax
condition|)
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$%s)"
argument_list|,
name|nameary
index|[
name|maxfld
index|]
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$Fld%d)"
argument_list|,
name|maxfld
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
block|}
else|else
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
literal|"$_"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|strEQ
argument_list|(
name|tmpstr
operator|->
name|str_ptr
argument_list|,
literal|"$_"
argument_list|)
condition|)
block|{
if|if
condition|(
name|type
operator|==
name|OLENGTH
operator|&&
operator|!
name|do_chop
condition|)
block|{
name|str
operator|=
name|str_make
argument_list|(
literal|"(length("
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
literal|") - 1"
argument_list|)
expr_stmt|;
block|}
block|}
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OBREAK
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"last"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ONEXT
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"next line"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OEXIT
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|realexit
condition|)
block|{
name|prec
operator|=
name|P_UNI
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"exit"
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|1
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|exitval
operator|=
name|TRUE
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|prec
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|len
operator|==
literal|1
condition|)
block|{
name|str_set
argument_list|(
name|str
argument_list|,
literal|"$ExitValue = "
argument_list|)
expr_stmt|;
name|exitval
operator|=
name|TRUE
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_ASSIGN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"; "
argument_list|)
expr_stmt|;
block|}
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"last line"
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|OCONTINUE
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"next"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OREDIR
case|:
goto|goto
name|def
goto|;
case|case
name|OIF
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"if ("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|") "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|3
condition|)
block|{
name|i
operator|=
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
expr_stmt|;
if|if
condition|(
name|i
condition|)
block|{
if|if
condition|(
operator|(
name|ops
index|[
name|i
index|]
operator|.
name|ival
operator|&
literal|255
operator|)
operator|==
name|OBLOCK
condition|)
block|{
name|i
operator|=
name|ops
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|ival
expr_stmt|;
if|if
condition|(
name|i
condition|)
block|{
if|if
condition|(
operator|(
name|ops
index|[
name|i
index|]
operator|.
name|ival
operator|&
literal|255
operator|)
operator|!=
name|OIF
condition|)
name|i
operator|=
literal|0
expr_stmt|;
block|}
block|}
else|else
name|i
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|i
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"els"
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|i
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"else "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|OWHILE
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"while ("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|") "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|ODO
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"do "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
if|if
condition|(
name|str
operator|->
name|str_ptr
index|[
name|str
operator|->
name|str_cur
operator|-
literal|1
index|]
operator|==
literal|'\n'
condition|)
operator|--
name|str
operator|->
name|str_cur
expr_stmt|;
empty_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" while ("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|");"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OFOR
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"for ("
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|i
operator|=
name|numarg
expr_stmt|;
if|if
condition|(
name|i
condition|)
block|{
name|t
operator|=
name|s
operator|=
name|tmpstr
operator|->
name|str_ptr
expr_stmt|;
while|while
condition|(
name|isalpha
argument_list|(
operator|*
name|t
argument_list|)
operator|||
name|isdigit
argument_list|(
operator|*
name|t
argument_list|)
operator|||
operator|*
name|t
operator|==
literal|'$'
operator|||
operator|*
name|t
operator|==
literal|'_'
condition|)
name|t
operator|++
expr_stmt|;
name|i
operator|=
name|t
operator|-
name|s
expr_stmt|;
if|if
condition|(
name|i
operator|<
literal|2
condition|)
name|i
operator|=
literal|0
expr_stmt|;
block|}
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"; "
argument_list|)
expr_stmt|;
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|&&
operator|(
name|t
operator|=
name|index
argument_list|(
name|fstr
operator|->
name|str_ptr
argument_list|,
literal|0377
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
name|strnEQ
argument_list|(
name|fstr
operator|->
name|str_ptr
argument_list|,
name|s
argument_list|,
name|i
argument_list|)
condition|)
operator|*
name|t
operator|=
literal|' '
expr_stmt|;
block|}
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"; "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|") "
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|4
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OFORIN
case|:
name|tmpstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|d
operator|=
name|index
argument_list|(
name|tmpstr
operator|->
name|str_ptr
argument_list|,
literal|'$'
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|d
condition|)
name|fatal
argument_list|(
literal|"Illegal for loop: %s"
argument_list|,
name|tmpstr
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
name|s
operator|=
name|index
argument_list|(
name|d
argument_list|,
literal|'{'
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
condition|)
name|s
operator|=
name|index
argument_list|(
name|d
argument_list|,
literal|'['
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|s
condition|)
name|fatal
argument_list|(
literal|"Illegal for loop: %s"
argument_list|,
name|d
argument_list|)
expr_stmt|;
operator|*
name|s
operator|++
operator|=
literal|'\0'
expr_stmt|;
for|for
control|(
name|t
operator|=
name|s
init|;
name|i
operator|=
operator|*
name|t
condition|;
name|t
operator|++
control|)
block|{
name|i
operator|&=
literal|127
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|'}'
operator|||
name|i
operator|==
literal|']'
condition|)
break|break;
block|}
if|if
condition|(
operator|*
name|t
condition|)
operator|*
name|t
operator|=
literal|'\0'
expr_stmt|;
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
name|d
operator|+
literal|1
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"[]"
argument_list|)
expr_stmt|;
name|tmp2str
operator|=
name|hfetch
argument_list|(
name|symtab
argument_list|,
name|str
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp2str
operator|&&
name|atoi
argument_list|(
name|tmp2str
operator|->
name|str_ptr
argument_list|)
condition|)
block|{
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"foreach %s ($[ .. $#%s) "
argument_list|,
name|s
argument_list|,
name|d
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"foreach %s (keys %%%s) "
argument_list|,
name|s
argument_list|,
name|d
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
name|str_set
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
break|break;
case|case
name|OBLOCK
case|:
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_set
argument_list|(
name|str
argument_list|,
literal|"{"
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>=
literal|2
operator|&&
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
condition|)
block|{
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
block|}
name|fixtab
argument_list|(
name|str
argument_list|,
operator|++
name|level
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
name|addsemi
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|fixtab
argument_list|(
name|str
argument_list|,
operator|--
name|level
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"}\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>=
literal|3
condition|)
block|{
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|def
label|:
if|if
condition|(
name|len
condition|)
block|{
if|if
condition|(
name|len
operator|>
literal|5
condition|)
name|fatal
argument_list|(
literal|"Garbage length in walk"
argument_list|)
expr_stmt|;
name|str
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|<=
name|len
condition|;
name|i
operator|++
control|)
block|{
name|str_scat
argument_list|(
name|str
argument_list|,
name|fstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
name|i
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|fstr
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|str
operator|=
name|Nullstr
expr_stmt|;
block|}
break|break;
block|}
if|if
condition|(
operator|!
name|str
condition|)
name|str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|useval
operator|&&
name|prec
operator|<
name|minprec
condition|)
block|{
comment|/* need parens? */
name|fstr
operator|=
name|str_new
argument_list|(
name|str
operator|->
name|str_cur
operator|+
literal|2
argument_list|)
expr_stmt|;
name|str_nset
argument_list|(
name|fstr
argument_list|,
literal|"("
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|fstr
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|str_ncat
argument_list|(
name|fstr
argument_list|,
literal|")"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|str
operator|=
name|fstr
expr_stmt|;
block|}
operator|*
name|numericptr
operator|=
name|numeric
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUGGING
if|if
condition|(
name|debug
operator|&
literal|4
condition|)
block|{
name|printf
argument_list|(
literal|"%3d %5d %15s %d %4d "
argument_list|,
name|level
argument_list|,
name|node
argument_list|,
name|opname
index|[
name|type
index|]
argument_list|,
name|len
argument_list|,
name|str
operator|->
name|str_cur
argument_list|)
expr_stmt|;
for|for
control|(
name|t
operator|=
name|str
operator|->
name|str_ptr
init|;
operator|*
name|t
operator|&&
name|t
operator|-
name|str
operator|->
name|str_ptr
operator|<
literal|40
condition|;
name|t
operator|++
control|)
if|if
condition|(
operator|*
name|t
operator|==
literal|'\n'
condition|)
name|printf
argument_list|(
literal|"\\n"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|t
operator|==
literal|'\t'
condition|)
name|printf
argument_list|(
literal|"\\t"
argument_list|)
expr_stmt|;
else|else
name|putchar
argument_list|(
operator|*
name|t
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
return|return
name|str
return|;
block|}
end_function

begin_expr_stmt
name|tab
argument_list|(
name|str
argument_list|,
name|lvl
argument_list|)
specifier|register
name|STR
operator|*
name|str
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|lvl
decl_stmt|;
end_decl_stmt

begin_block
block|{
while|while
condition|(
name|lvl
operator|>
literal|1
condition|)
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
name|lvl
operator|-=
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|lvl
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"    "
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|fixtab
argument_list|(
name|str
argument_list|,
name|lvl
argument_list|)
specifier|register
name|STR
operator|*
name|str
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|lvl
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|s
decl_stmt|;
comment|/* strip trailing white space */
name|s
operator|=
name|str
operator|->
name|str_ptr
operator|+
name|str
operator|->
name|str_cur
operator|-
literal|1
expr_stmt|;
while|while
condition|(
name|s
operator|>=
name|str
operator|->
name|str_ptr
operator|&&
operator|(
operator|*
name|s
operator|==
literal|' '
operator|||
operator|*
name|s
operator|==
literal|'\t'
operator|||
operator|*
name|s
operator|==
literal|'\n'
operator|)
condition|)
name|s
operator|--
expr_stmt|;
name|s
index|[
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|str
operator|->
name|str_cur
operator|=
name|s
operator|+
literal|1
operator|-
name|str
operator|->
name|str_ptr
expr_stmt|;
if|if
condition|(
name|s
operator|>=
name|str
operator|->
name|str_ptr
operator|&&
operator|*
name|s
operator|!=
literal|'\n'
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|lvl
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|addsemi
argument_list|(
name|str
argument_list|)
specifier|register
name|STR
operator|*
name|str
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|s
decl_stmt|;
name|s
operator|=
name|str
operator|->
name|str_ptr
operator|+
name|str
operator|->
name|str_cur
operator|-
literal|1
expr_stmt|;
while|while
condition|(
name|s
operator|>=
name|str
operator|->
name|str_ptr
operator|&&
operator|(
operator|*
name|s
operator|==
literal|' '
operator|||
operator|*
name|s
operator|==
literal|'\t'
operator|||
operator|*
name|s
operator|==
literal|'\n'
operator|)
condition|)
name|s
operator|--
expr_stmt|;
if|if
condition|(
name|s
operator|>=
name|str
operator|->
name|str_ptr
operator|&&
operator|*
name|s
operator|!=
literal|';'
operator|&&
operator|*
name|s
operator|!=
literal|'}'
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|";"
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|emit_split
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
specifier|register
name|STR
operator|*
name|str
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
name|split_to_array
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"@Fld"
argument_list|)
expr_stmt|;
else|else
block|{
name|str_cat
argument_list|(
name|str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|maxfld
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|<=
name|arymax
condition|)
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$%s,"
argument_list|,
name|nameary
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$Fld%d,"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|maxfld
operator|<=
name|arymax
condition|)
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$%s)"
argument_list|,
name|nameary
index|[
name|maxfld
index|]
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|"$Fld%d)"
argument_list|,
name|maxfld
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|const_FS
condition|)
block|{
name|sprintf
argument_list|(
name|tokenbuf
argument_list|,
literal|" = split(/[%c\\n]/, $_, 9999);\n"
argument_list|,
name|const_FS
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|str
argument_list|,
name|tokenbuf
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|saw_FS
condition|)
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" = split($FS, $_, 9999);\n"
argument_list|)
expr_stmt|;
else|else
name|str_cat
argument_list|(
name|str
argument_list|,
literal|" = split(' ', $_, 9999);\n"
argument_list|)
expr_stmt|;
name|tab
argument_list|(
name|str
argument_list|,
name|level
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|prewalk
argument_list|(
argument|numit
argument_list|,
argument|level
argument_list|,
argument|node
argument_list|,
argument|numericptr
argument_list|)
end_macro

begin_decl_stmt
name|int
name|numit
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|int
name|node
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|numericptr
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|len
decl_stmt|;
specifier|register
name|int
name|type
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|char
modifier|*
name|t
decl_stmt|;
name|char
modifier|*
name|d
decl_stmt|,
modifier|*
name|s
decl_stmt|;
name|int
name|numarg
decl_stmt|;
name|int
name|numeric
init|=
name|FALSE
decl_stmt|;
name|STR
modifier|*
name|tmpstr
decl_stmt|;
name|STR
modifier|*
name|tmp2str
decl_stmt|;
if|if
condition|(
operator|!
name|node
condition|)
block|{
operator|*
name|numericptr
operator|=
literal|0
expr_stmt|;
return|return
literal|0
return|;
block|}
name|type
operator|=
name|ops
index|[
name|node
index|]
operator|.
name|ival
expr_stmt|;
name|len
operator|=
name|type
operator|>>
literal|8
expr_stmt|;
name|type
operator|&=
literal|255
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|OPROG
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
if|if
condition|(
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
condition|)
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
operator|++
name|level
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
operator|--
name|level
expr_stmt|;
if|if
condition|(
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
condition|)
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|4
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|OHUNKS
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|3
condition|)
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ORANGE
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPAT
case|:
goto|goto
name|def
goto|;
case|case
name|OREGEX
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OHUNK
case|:
if|if
condition|(
name|len
operator|==
literal|1
condition|)
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|i
operator|=
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
condition|)
block|{
operator|++
name|level
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
operator|--
name|level
expr_stmt|;
block|}
else|else
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|OPPAREN
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPANDAND
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPOROR
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPNOT
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OCPAREN
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
break|break;
case|case
name|OCANDAND
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OCOROR
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OCNOT
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|ORELOP
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|ORPAREN
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
break|break;
case|case
name|OMATCHOP
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OMPAREN
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
break|break;
case|case
name|OCONCAT
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OASSIGN
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
if|if
condition|(
name|numarg
operator|||
name|strlen
argument_list|(
name|ops
index|[
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
operator|+
literal|1
index|]
operator|.
name|cval
argument_list|)
operator|>
literal|1
condition|)
block|{
name|numericize
argument_list|(
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|numarg
condition|)
name|numericize
argument_list|(
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|)
expr_stmt|;
block|}
name|numeric
operator||=
name|numarg
expr_stmt|;
break|break;
case|case
name|OADD
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OSUBTRACT
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OMULT
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|ODIV
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OPOW
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OMOD
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OPOSTINCR
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OPOSTDECR
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OPREINCR
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OPREDECR
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OUMINUS
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OUPLUS
case|:
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OPAREN
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator||=
name|numarg
expr_stmt|;
break|break;
case|case
name|OGETLINE
case|:
break|break;
case|case
name|OSPRINTF
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSUBSTR
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|3
condition|)
block|{
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|OSTRING
case|:
break|break;
case|case
name|OSPLIT
case|:
name|numeric
operator|=
literal|1
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|3
condition|)
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OINDEX
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OMATCH
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OUSERDEF
case|:
name|subretnum
operator|=
name|FALSE
expr_stmt|;
operator|--
name|level
expr_stmt|;
name|tmpstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
operator|++
name|level
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|4
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|5
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
operator|--
name|level
expr_stmt|;
name|str_cat
argument_list|(
name|tmpstr
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|tmp2str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|subretnum
operator|||
name|numarg
condition|)
name|str_set
argument_list|(
name|tmp2str
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|hstore
argument_list|(
name|symtab
argument_list|,
name|tmpstr
operator|->
name|str_ptr
argument_list|,
name|tmp2str
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
break|break;
case|case
name|ORETURN
case|:
if|if
condition|(
name|len
operator|>
literal|0
condition|)
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
if|if
condition|(
name|numarg
condition|)
name|subretnum
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
name|OUSERFUN
case|:
name|tmp2str
operator|=
name|str_new
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|str_scat
argument_list|(
name|tmp2str
argument_list|,
name|tmpstr
operator|=
name|walk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
argument_list|)
expr_stmt|;
name|fixrargs
argument_list|(
name|tmpstr
operator|->
name|str_ptr
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
name|str_cat
argument_list|(
name|tmp2str
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|tmpstr
operator|=
name|hfetch
argument_list|(
name|symtab
argument_list|,
name|tmp2str
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmpstr
operator|&&
name|tmpstr
operator|->
name|str_ptr
condition|)
name|numeric
operator||=
name|atoi
argument_list|(
name|tmpstr
operator|->
name|str_ptr
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|str_free
argument_list|(
name|tmp2str
argument_list|)
expr_stmt|;
break|break;
case|case
name|OGSUB
case|:
case|case
name|OSUB
case|:
if|if
condition|(
name|len
operator|>=
literal|3
condition|)
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|ONUM
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|numeric
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|OSTR
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ODEFINED
case|:
case|case
name|ODELETE
case|:
case|case
name|OSTAR
case|:
case|case
name|OVAR
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|numit
condition|)
name|numericize
argument_list|(
name|node
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|OFLD
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OVFLD
case|:
name|i
operator|=
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|i
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OJUNK
case|:
goto|goto
name|def
goto|;
case|case
name|OSNEWLINE
case|:
break|break;
case|case
name|ONEWLINE
case|:
break|break;
case|case
name|OSCOMMENT
case|:
break|break;
case|case
name|OCOMMENT
case|:
break|break;
case|case
name|OCOMMA
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSEMICOLON
case|:
break|break;
case|case
name|OSTATES
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSTATE
case|:
if|if
condition|(
name|len
operator|>=
literal|1
condition|)
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>=
literal|2
condition|)
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|OCLOSE
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPRINTF
case|:
case|case
name|OPRINT
case|:
if|if
condition|(
name|len
operator|==
literal|3
condition|)
block|{
comment|/* output redirection */
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
name|prewalk
argument_list|(
literal|0
operator|+
operator|(
name|type
operator|==
name|OPRINT
operator|)
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ORAND
case|:
break|break;
case|case
name|OSRAND
case|:
goto|goto
name|maybe0
goto|;
case|case
name|OATAN2
case|:
goto|goto
name|maybe0
goto|;
case|case
name|OSIN
case|:
goto|goto
name|maybe0
goto|;
case|case
name|OCOS
case|:
goto|goto
name|maybe0
goto|;
case|case
name|OSYSTEM
case|:
goto|goto
name|maybe0
goto|;
case|case
name|OLENGTH
case|:
goto|goto
name|maybe0
goto|;
case|case
name|OLOG
case|:
goto|goto
name|maybe0
goto|;
case|case
name|OEXP
case|:
goto|goto
name|maybe0
goto|;
case|case
name|OSQRT
case|:
goto|goto
name|maybe0
goto|;
case|case
name|OINT
case|:
name|maybe0
label|:
name|numeric
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|len
operator|>
literal|0
condition|)
name|prewalk
argument_list|(
name|type
operator|!=
name|OLENGTH
operator|&&
name|type
operator|!=
name|OSYSTEM
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OBREAK
case|:
break|break;
case|case
name|ONEXT
case|:
break|break;
case|case
name|OEXIT
case|:
if|if
condition|(
name|len
operator|==
literal|1
condition|)
block|{
name|prewalk
argument_list|(
literal|1
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|OCONTINUE
case|:
break|break;
case|case
name|OREDIR
case|:
goto|goto
name|def
goto|;
case|case
name|OIF
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|==
literal|3
condition|)
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|OWHILE
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OFOR
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|3
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|4
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OFORIN
case|:
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
break|break;
case|case
name|OBLOCK
case|:
if|if
condition|(
name|len
operator|==
literal|2
condition|)
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|2
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
operator|++
name|level
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
operator|--
name|level
expr_stmt|;
break|break;
default|default:
name|def
label|:
if|if
condition|(
name|len
condition|)
block|{
if|if
condition|(
name|len
operator|>
literal|5
condition|)
name|fatal
argument_list|(
literal|"Garbage length in prewalk"
argument_list|)
expr_stmt|;
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|<=
name|len
condition|;
name|i
operator|++
control|)
block|{
name|prewalk
argument_list|(
literal|0
argument_list|,
name|level
argument_list|,
name|ops
index|[
name|node
operator|+
name|i
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
block|}
operator|*
name|numericptr
operator|=
name|numeric
expr_stmt|;
return|return
literal|1
return|;
block|}
end_block

begin_expr_stmt
name|numericize
argument_list|(
name|node
argument_list|)
specifier|register
name|int
name|node
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|int
name|len
decl_stmt|;
specifier|register
name|int
name|type
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|STR
modifier|*
name|tmpstr
decl_stmt|;
name|STR
modifier|*
name|tmp2str
decl_stmt|;
name|int
name|numarg
decl_stmt|;
name|type
operator|=
name|ops
index|[
name|node
index|]
operator|.
name|ival
expr_stmt|;
name|len
operator|=
name|type
operator|>>
literal|8
expr_stmt|;
name|type
operator|&=
literal|255
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|OVAR
operator|&&
name|len
operator|==
literal|1
condition|)
block|{
name|tmpstr
operator|=
name|walk
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|ops
index|[
name|node
operator|+
literal|1
index|]
operator|.
name|ival
argument_list|,
operator|&
name|numarg
argument_list|,
name|P_MIN
argument_list|)
expr_stmt|;
name|tmp2str
operator|=
name|str_make
argument_list|(
literal|"1"
argument_list|)
expr_stmt|;
name|hstore
argument_list|(
name|symtab
argument_list|,
name|tmpstr
operator|->
name|str_ptr
argument_list|,
name|tmp2str
argument_list|)
expr_stmt|;
block|}
block|}
end_block

end_unit

