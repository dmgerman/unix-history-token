begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*********************************************************** Copyright 1987 by Digital Equipment Corporation, Maynard, Massachusetts, and the Massachusetts Institute of Technology, Cambridge, Massachusetts.                          All Rights Reserved  Permission to use, copy, modify, and distribute this software and its  documentation for any purpose and without fee is hereby granted,  provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in  supporting documentation, and that the names of Digital or MIT not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.    DIGITAL DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL DIGITAL BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  ******************************************************************/
end_comment

begin_comment
comment|/* $XConsortium: mfbscrinit.c,v 5.12 90/09/24 10:19:29 rws Exp $ */
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"Xproto.h"
end_include

begin_comment
comment|/* for xColorItem */
end_comment

begin_include
include|#
directive|include
file|"Xmd.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"resource.h"
end_include

begin_include
include|#
directive|include
file|"colormap.h"
end_include

begin_include
include|#
directive|include
file|"mfb.h"
end_include

begin_include
include|#
directive|include
file|"mistruct.h"
end_include

begin_include
include|#
directive|include
file|"dix.h"
end_include

begin_include
include|#
directive|include
file|"mi.h"
end_include

begin_include
include|#
directive|include
file|"mibstore.h"
end_include

begin_include
include|#
directive|include
file|"servermd.h"
end_include

begin_function_decl
specifier|extern
name|RegionPtr
name|mfbPixmapToRegion
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|hpDoNothing
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|int
name|mfbWindowPrivateIndex
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|mfbGCPrivateIndex
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|unsigned
name|long
name|mfbGeneration
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|VisualRec
name|visual
init|=
block|{
comment|/* vid  class       bpRGB cmpE nplan rMask gMask bMask oRed oGreen oBlue */
literal|0
block|,
name|StaticGray
block|,
literal|1
block|,
literal|2
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|VisualID
name|VID
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|DepthRec
name|depth
init|=
block|{
comment|/* depth	numVid		vids */
literal|1
block|,
literal|1
block|,
operator|&
name|VID
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|miBSFuncRec
name|mfbBSFuncRec
init|=
block|{
name|mfbSaveAreas
block|,
name|mfbRestoreAreas
block|,
operator|(
name|void
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|0
block|,
operator|(
name|PixmapPtr
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|0
block|,
operator|(
name|PixmapPtr
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|0
block|, }
decl_stmt|;
end_decl_stmt

begin_function
name|Bool
name|mfbAllocatePrivates
parameter_list|(
name|pScreen
parameter_list|,
name|pWinIndex
parameter_list|,
name|pGCIndex
parameter_list|)
name|ScreenPtr
name|pScreen
decl_stmt|;
name|int
modifier|*
name|pWinIndex
decl_stmt|,
decl|*
name|pGCIndex
decl_stmt|;
end_function

begin_block
block|{
if|if
condition|(
name|mfbGeneration
operator|!=
name|serverGeneration
condition|)
block|{
name|mfbWindowPrivateIndex
operator|=
name|AllocateWindowPrivateIndex
argument_list|()
expr_stmt|;
name|mfbGCPrivateIndex
operator|=
name|AllocateGCPrivateIndex
argument_list|()
expr_stmt|;
name|visual
operator|.
name|vid
operator|=
name|FakeClientID
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|VID
operator|=
name|visual
operator|.
name|vid
expr_stmt|;
name|mfbGeneration
operator|=
name|serverGeneration
expr_stmt|;
block|}
if|if
condition|(
name|pWinIndex
condition|)
operator|*
name|pWinIndex
operator|=
name|mfbWindowPrivateIndex
expr_stmt|;
if|if
condition|(
name|pGCIndex
condition|)
operator|*
name|pGCIndex
operator|=
name|mfbGCPrivateIndex
expr_stmt|;
return|return
operator|(
name|AllocateWindowPrivate
argument_list|(
name|pScreen
argument_list|,
name|mfbWindowPrivateIndex
argument_list|,
sizeof|sizeof
argument_list|(
name|mfbPrivWin
argument_list|)
argument_list|)
operator|&&
name|AllocateGCPrivate
argument_list|(
name|pScreen
argument_list|,
name|mfbGCPrivateIndex
argument_list|,
sizeof|sizeof
argument_list|(
name|mfbPrivGC
argument_list|)
argument_list|)
operator|)
return|;
block|}
end_block

begin_function
name|Bool
name|hpmfbCloseScreen
parameter_list|(
name|index
parameter_list|,
name|pScreen
parameter_list|)
name|int
name|index
decl_stmt|;
name|ScreenPtr
name|pScreen
decl_stmt|;
block|{
operator|(
name|void
operator|)
name|xfree
argument_list|(
name|getPrivScreenPtr
argument_list|(
name|pScreen
argument_list|)
operator|->
name|pDrawable
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/* dts * (inch/dot) * (25.4 mm / inch) = mm */
end_comment

begin_function
name|Bool
name|hpmfbScreenInit
parameter_list|(
name|pScreen
parameter_list|,
name|pbits
parameter_list|,
name|xsize
parameter_list|,
name|ysize
parameter_list|,
name|dpix
parameter_list|,
name|dpiy
parameter_list|)
specifier|register
name|ScreenPtr
name|pScreen
decl_stmt|;
name|pointer
name|pbits
decl_stmt|;
comment|/* pointer to screen bitmap */
name|int
name|xsize
decl_stmt|,
name|ysize
decl_stmt|;
comment|/* in pixels */
name|int
name|dpix
decl_stmt|,
name|dpiy
decl_stmt|;
comment|/* dots per inch */
block|{
specifier|register
name|hpPrivScreenPtr
name|pPrivScreen
decl_stmt|;
if|if
condition|(
operator|!
name|mfbAllocatePrivates
argument_list|(
name|pScreen
argument_list|,
operator|(
name|int
operator|*
operator|)
name|NULL
argument_list|,
operator|(
name|int
operator|*
operator|)
name|NULL
argument_list|)
condition|)
return|return
name|FALSE
return|;
name|pScreen
operator|->
name|defColormap
operator|=
operator|(
name|Colormap
operator|)
name|FakeClientID
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|/* whitePixel, blackPixel */
name|pScreen
operator|->
name|QueryBestSize
operator|=
name|mfbQueryBestSize
expr_stmt|;
comment|/* SaveScreen */
name|pScreen
operator|->
name|GetImage
operator|=
name|mfbGetImage
expr_stmt|;
name|pScreen
operator|->
name|GetSpans
operator|=
name|mfbGetSpans
expr_stmt|;
name|pScreen
operator|->
name|CreateWindow
operator|=
name|mfbCreateWindow
expr_stmt|;
name|pScreen
operator|->
name|DestroyWindow
operator|=
name|mfbDestroyWindow
expr_stmt|;
name|pScreen
operator|->
name|PositionWindow
operator|=
name|mfbPositionWindow
expr_stmt|;
name|pScreen
operator|->
name|ChangeWindowAttributes
operator|=
name|mfbChangeWindowAttributes
expr_stmt|;
name|pScreen
operator|->
name|RealizeWindow
operator|=
name|mfbMapWindow
expr_stmt|;
name|pScreen
operator|->
name|UnrealizeWindow
operator|=
name|mfbUnmapWindow
expr_stmt|;
name|pScreen
operator|->
name|PaintWindowBackground
operator|=
name|mfbPaintWindow
expr_stmt|;
name|pScreen
operator|->
name|PaintWindowBorder
operator|=
name|mfbPaintWindow
expr_stmt|;
name|pScreen
operator|->
name|CopyWindow
operator|=
name|mfbCopyWindow
expr_stmt|;
name|pScreen
operator|->
name|CreatePixmap
operator|=
name|mfbCreatePixmap
expr_stmt|;
name|pScreen
operator|->
name|DestroyPixmap
operator|=
name|mfbDestroyPixmap
expr_stmt|;
name|pScreen
operator|->
name|RealizeFont
operator|=
name|mfbRealizeFont
expr_stmt|;
name|pScreen
operator|->
name|UnrealizeFont
operator|=
name|mfbUnrealizeFont
expr_stmt|;
name|pScreen
operator|->
name|CreateGC
operator|=
name|mfbCreateGC
expr_stmt|;
name|pScreen
operator|->
name|CreateColormap
operator|=
name|mfbCreateColormap
expr_stmt|;
name|pScreen
operator|->
name|DestroyColormap
operator|=
name|mfbDestroyColormap
expr_stmt|;
name|pScreen
operator|->
name|InstallColormap
operator|=
name|mfbInstallColormap
expr_stmt|;
name|pScreen
operator|->
name|UninstallColormap
operator|=
name|mfbUninstallColormap
expr_stmt|;
name|pScreen
operator|->
name|ListInstalledColormaps
operator|=
name|mfbListInstalledColormaps
expr_stmt|;
name|pScreen
operator|->
name|StoreColors
operator|=
name|NoopDDA
expr_stmt|;
name|pScreen
operator|->
name|ResolveColor
operator|=
name|mfbResolveColor
expr_stmt|;
name|pScreen
operator|->
name|BitmapToRegion
operator|=
name|mfbPixmapToRegion
expr_stmt|;
return|return
name|hpScreenInit
argument_list|(
name|pScreen
argument_list|,
name|pbits
argument_list|,
name|xsize
argument_list|,
name|ysize
argument_list|,
name|dpix
argument_list|,
name|dpiy
argument_list|,
comment|/*width,*/
literal|1
argument_list|,
literal|1
argument_list|,
operator|&
name|depth
argument_list|,
name|VID
argument_list|,
literal|1
argument_list|,
operator|&
name|visual
argument_list|,
operator|&
name|mfbBSFuncRec
argument_list|)
return|;
block|}
end_function

end_unit

