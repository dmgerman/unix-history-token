begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/************************************************************ Copyright 1989 by The Massachusetts Institute of Technology  Permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright no- tice appear in all copies and that both that copyright no- tice and this permission notice appear in supporting docu- mentation, and that the name of MIT not be used in advertising or publicity pertaining to distribution of the software without specific prior written permission. M.I.T. makes no representation about the suitability of this software for any purpose. It is provided "as is" without any express or implied warranty.  ********************************************************/
end_comment

begin_comment
comment|/* $XConsortium: cfbpolypnt.c,v 5.13 91/07/14 13:51:14 keith Exp $ */
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"gcstruct.h"
end_include

begin_include
include|#
directive|include
file|"windowstr.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"regionstr.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"cfb.h"
end_include

begin_include
include|#
directive|include
file|"cfbmskbits.h"
end_include

begin_define
define|#
directive|define
name|isClipped
parameter_list|(
name|c
parameter_list|,
name|ul
parameter_list|,
name|lr
parameter_list|)
value|((((c) - (ul)) | ((lr) - (c)))& ClipMask)
end_define

begin_define
define|#
directive|define
name|PointLoop
parameter_list|(
name|fill
parameter_list|)
value|{ \     for (nbox = REGION_NUM_RECTS(cclip), pbox = REGION_RECTS(cclip); \ 	 --nbox>= 0; \ 	 pbox++) \     { \ 	c1 = *((long *)&pbox->x1) - off; \ 	c2 = *((long *)&pbox->x2) - off - 0x00010001; \ 	for (ppt = (long *) pptInit, i = npt; --i>= 0;) \ 	{ \ 	    pt = *ppt++; \ 	    if (!isClipped(pt,c1,c2)) { \ 		fill \ 	    } \ 	} \     } \ }
end_define

begin_function
name|void
name|cfbPolyPoint
parameter_list|(
name|pDrawable
parameter_list|,
name|pGC
parameter_list|,
name|mode
parameter_list|,
name|npt
parameter_list|,
name|pptInit
parameter_list|)
name|DrawablePtr
name|pDrawable
decl_stmt|;
name|GCPtr
name|pGC
decl_stmt|;
name|int
name|mode
decl_stmt|;
name|int
name|npt
decl_stmt|;
name|xPoint
modifier|*
name|pptInit
decl_stmt|;
block|{
specifier|register
name|long
name|pt
decl_stmt|;
specifier|register
name|long
name|c1
decl_stmt|,
name|c2
decl_stmt|;
specifier|register
name|unsigned
name|long
name|ClipMask
init|=
literal|0x80008000
decl_stmt|;
specifier|register
name|unsigned
name|long
name|xor
decl_stmt|;
if|#
directive|if
name|PPW
operator|==
literal|4
specifier|register
name|unsigned
name|char
modifier|*
name|addrb
decl_stmt|;
specifier|register
name|int
name|nbwidth
decl_stmt|;
name|unsigned
name|char
modifier|*
name|addrbt
decl_stmt|;
else|#
directive|else
specifier|register
name|unsigned
name|long
modifier|*
name|addrl
decl_stmt|;
specifier|register
name|int
name|nlwidth
decl_stmt|;
name|unsigned
name|long
modifier|*
name|addrlt
decl_stmt|;
endif|#
directive|endif
specifier|register
name|long
modifier|*
name|ppt
decl_stmt|;
name|RegionPtr
name|cclip
decl_stmt|;
name|int
name|nbox
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|BoxPtr
name|pbox
decl_stmt|;
name|long
name|and
decl_stmt|;
name|int
name|rop
init|=
name|pGC
operator|->
name|alu
decl_stmt|;
name|int
name|off
decl_stmt|;
name|cfbPrivGCPtr
name|devPriv
decl_stmt|;
name|xPoint
modifier|*
name|pptPrev
decl_stmt|;
name|devPriv
operator|=
operator|(
name|cfbPrivGC
operator|*
operator|)
operator|(
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
expr_stmt|;
name|rop
operator|=
name|devPriv
operator|->
name|rop
expr_stmt|;
if|if
condition|(
name|rop
operator|==
name|GXnoop
condition|)
return|return;
name|cclip
operator|=
name|devPriv
operator|->
name|pCompositeClip
expr_stmt|;
name|xor
operator|=
name|devPriv
operator|->
name|xor
expr_stmt|;
if|if
condition|(
operator|(
name|mode
operator|==
name|CoordModePrevious
operator|)
operator|&&
operator|(
name|npt
operator|>
literal|1
operator|)
condition|)
block|{
for|for
control|(
name|pptPrev
operator|=
name|pptInit
operator|+
literal|1
operator|,
name|i
operator|=
name|npt
operator|-
literal|1
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
name|pptPrev
operator|++
control|)
block|{
name|pptPrev
operator|->
name|x
operator|+=
operator|(
name|pptPrev
operator|-
literal|1
operator|)
operator|->
name|x
expr_stmt|;
name|pptPrev
operator|->
name|y
operator|+=
operator|(
name|pptPrev
operator|-
literal|1
operator|)
operator|->
name|y
expr_stmt|;
block|}
block|}
name|off
operator|=
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
operator|&
name|pDrawable
operator|->
name|x
operator|)
expr_stmt|;
name|off
operator|-=
operator|(
name|off
operator|&
literal|0x8000
operator|)
operator|<<
literal|1
expr_stmt|;
name|SET_REGISTERS_FOR_WRITING
argument_list|(
name|pDrawable
operator|->
name|pScreen
argument_list|,
operator|~
literal|0
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
if|#
directive|if
name|PPW
operator|==
literal|4
name|cfbGetByteWidthAndPointer
argument_list|(
name|pDrawable
argument_list|,
name|nbwidth
argument_list|,
name|addrb
argument_list|)
expr_stmt|;
name|addrb
operator|=
name|addrb
operator|+
name|pDrawable
operator|->
name|y
operator|*
name|nbwidth
operator|+
name|pDrawable
operator|->
name|x
expr_stmt|;
if|if
condition|(
name|rop
operator|==
name|GXcopy
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|nbwidth
operator|&
operator|(
name|nbwidth
operator|-
literal|1
operator|)
operator|)
condition|)
block|{
name|nbwidth
operator|=
name|ffs
argument_list|(
name|nbwidth
argument_list|)
operator|-
literal|1
expr_stmt|;
name|PointLoop
argument_list|(
argument|*(addrb + (intToY(pt)<< nbwidth) + intToX(pt)) = xor;
argument_list|)
block|}
ifdef|#
directive|ifdef
name|sun
elseif|else
if|if
condition|(
name|nbwidth
operator|==
literal|1152
condition|)
block|{
specifier|register
name|int
name|y
decl_stmt|;
name|PointLoop
argument_list|(
argument|y = intToY(pt); *(addrb + (y<<
literal|10
argument|) + (y<<
literal|7
argument|) + intToX(pt)) = xor;
argument_list|)
block|}
endif|#
directive|endif
else|else
block|{
name|PointLoop
argument_list|(
argument|*(addrb + intToY(pt) * nbwidth + intToX(pt)) = xor;
argument_list|)
block|}
block|}
else|else
block|{
name|and
operator|=
name|devPriv
operator|->
name|and
expr_stmt|;
name|PointLoop
argument_list|(
argument|addrbt = addrb + intToY(pt) * nbwidth + intToX(pt); 		    *addrbt = DoRRop (*addrbt, and, xor);
argument_list|)
block|}
else|#
directive|else
name|cfbGetLongWidthAndPointer
argument_list|(
name|pDrawable
argument_list|,
name|nlwidth
argument_list|,
name|addrl
argument_list|)
expr_stmt|;
name|and
operator|=
name|devPriv
operator|->
name|and
expr_stmt|;
name|PointLoop
argument_list|(
argument|addrlt = addrl + intToY(pt) * nlwidth + intToX(pt); 		*addrlt = DoRRop (*addrlt, and, xor);
argument_list|)
endif|#
directive|endif
block|}
end_function

end_unit

