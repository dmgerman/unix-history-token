begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/************************************************************ Copyright 1989 by The Massachusetts Institute of Technology  Permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of MIT not be used in advertising or publicity pertaining to distribution of the software without specific prior written permission. M.I.T. makes no representation about the suitability of this software for any purpose. It is provided "as is" without any express or implied warranty.  ********************************************************/
end_comment

begin_comment
comment|/* $XConsortium: mfbfillarc.c,v 5.7 90/10/06 13:58:08 rws Exp $ */
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"Xprotostr.h"
end_include

begin_include
include|#
directive|include
file|"miscstruct.h"
end_include

begin_include
include|#
directive|include
file|"gcstruct.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"mfb.h"
end_include

begin_include
include|#
directive|include
file|"maskbits.h"
end_include

begin_include
include|#
directive|include
file|"mifillarc.h"
end_include

begin_function_decl
specifier|extern
name|void
name|miPolyFillArc
parameter_list|()
function_decl|;
end_function_decl

begin_function
specifier|static
name|void
name|mfbFillEllipseSolid
parameter_list|(
name|pDraw
parameter_list|,
name|arc
parameter_list|,
name|rop
parameter_list|)
name|DrawablePtr
name|pDraw
decl_stmt|;
name|xArc
modifier|*
name|arc
decl_stmt|;
specifier|register
name|int
name|rop
decl_stmt|;
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|e
decl_stmt|;
name|int
name|yk
decl_stmt|,
name|xk
decl_stmt|,
name|ym
decl_stmt|,
name|xm
decl_stmt|,
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|xorg
decl_stmt|,
name|yorg
decl_stmt|;
specifier|register
name|int
name|slw
decl_stmt|;
name|miFillArcRec
name|info
decl_stmt|;
name|int
modifier|*
name|addrlt
decl_stmt|,
modifier|*
name|addrlb
decl_stmt|;
specifier|register
name|int
modifier|*
name|addrl
decl_stmt|;
specifier|register
name|int
name|n
decl_stmt|;
name|int
name|nlwidth
decl_stmt|;
specifier|register
name|int
name|xpos
decl_stmt|;
name|int
name|startmask
decl_stmt|,
name|endmask
decl_stmt|,
name|nlmiddle
decl_stmt|;
if|if
condition|(
name|pDraw
operator|->
name|type
operator|==
name|DRAWABLE_WINDOW
condition|)
block|{
name|addrlt
operator|=
operator|(
name|int
operator|*
operator|)
name|getPrivScreenPtr
argument_list|(
name|pDraw
operator|->
name|pScreen
argument_list|)
operator|->
name|bits
expr_stmt|;
name|nlwidth
operator|=
operator|(
name|int
operator|)
name|getPrivScreenPtr
argument_list|(
name|pDraw
operator|->
name|pScreen
argument_list|)
operator|->
name|stride
operator|>>
literal|2
expr_stmt|;
block|}
else|else
block|{
name|addrlt
operator|=
operator|(
name|int
operator|*
operator|)
name|getPrivPixmapPtr
argument_list|(
name|pDraw
argument_list|)
operator|->
name|bits
expr_stmt|;
name|nlwidth
operator|=
operator|(
name|int
operator|)
name|getPrivPixmapPtr
argument_list|(
name|pDraw
argument_list|)
operator|->
name|stride
operator|>>
literal|2
expr_stmt|;
block|}
name|miFillArcSetup
argument_list|(
name|arc
argument_list|,
operator|&
name|info
argument_list|)
expr_stmt|;
name|MIFILLARCSETUP
argument_list|()
expr_stmt|;
name|xorg
operator|+=
name|pDraw
operator|->
name|x
expr_stmt|;
name|yorg
operator|+=
name|pDraw
operator|->
name|y
expr_stmt|;
name|addrlb
operator|=
name|addrlt
expr_stmt|;
name|addrlt
operator|+=
name|nlwidth
operator|*
operator|(
name|yorg
operator|-
name|y
operator|)
expr_stmt|;
name|addrlb
operator|+=
name|nlwidth
operator|*
operator|(
name|yorg
operator|+
name|y
operator|+
name|dy
operator|)
expr_stmt|;
while|while
condition|(
name|y
condition|)
block|{
name|addrlt
operator|+=
name|nlwidth
expr_stmt|;
name|addrlb
operator|-=
name|nlwidth
expr_stmt|;
name|MIFILLARCSTEP
argument_list|(
name|slw
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|slw
condition|)
continue|continue;
name|xpos
operator|=
name|xorg
operator|-
name|x
expr_stmt|;
name|addrl
operator|=
name|addrlt
operator|+
operator|(
name|xpos
operator|>>
literal|5
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|xpos
operator|&
literal|0x1f
operator|)
operator|+
name|slw
operator|)
operator|<
literal|32
condition|)
block|{
name|maskpartialbits
argument_list|(
name|xpos
argument_list|,
name|slw
argument_list|,
name|startmask
argument_list|)
expr_stmt|;
if|if
condition|(
name|rop
operator|==
name|RROP_BLACK
condition|)
operator|*
name|addrl
operator|&=
operator|~
name|startmask
expr_stmt|;
elseif|else
if|if
condition|(
name|rop
operator|==
name|RROP_WHITE
condition|)
operator|*
name|addrl
operator||=
name|startmask
expr_stmt|;
else|else
operator|*
name|addrl
operator|^=
name|startmask
expr_stmt|;
if|if
condition|(
name|miFillArcLower
argument_list|(
name|slw
argument_list|)
condition|)
block|{
name|addrl
operator|=
name|addrlb
operator|+
operator|(
name|xpos
operator|>>
literal|5
operator|)
expr_stmt|;
if|if
condition|(
name|rop
operator|==
name|RROP_BLACK
condition|)
operator|*
name|addrl
operator|&=
operator|~
name|startmask
expr_stmt|;
elseif|else
if|if
condition|(
name|rop
operator|==
name|RROP_WHITE
condition|)
operator|*
name|addrl
operator||=
name|startmask
expr_stmt|;
else|else
operator|*
name|addrl
operator|^=
name|startmask
expr_stmt|;
block|}
continue|continue;
block|}
name|maskbits
argument_list|(
name|xpos
argument_list|,
name|slw
argument_list|,
name|startmask
argument_list|,
name|endmask
argument_list|,
name|nlmiddle
argument_list|)
expr_stmt|;
if|if
condition|(
name|startmask
condition|)
block|{
if|if
condition|(
name|rop
operator|==
name|RROP_BLACK
condition|)
operator|*
name|addrl
operator|++
operator|&=
operator|~
name|startmask
expr_stmt|;
elseif|else
if|if
condition|(
name|rop
operator|==
name|RROP_WHITE
condition|)
operator|*
name|addrl
operator|++
operator||=
name|startmask
expr_stmt|;
else|else
operator|*
name|addrl
operator|++
operator|^=
name|startmask
expr_stmt|;
block|}
name|n
operator|=
name|nlmiddle
expr_stmt|;
if|if
condition|(
name|rop
operator|==
name|RROP_BLACK
condition|)
while|while
condition|(
name|n
operator|--
condition|)
operator|*
name|addrl
operator|++
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|rop
operator|==
name|RROP_WHITE
condition|)
while|while
condition|(
name|n
operator|--
condition|)
operator|*
name|addrl
operator|++
operator|=
operator|~
literal|0
expr_stmt|;
else|else
while|while
condition|(
name|n
operator|--
condition|)
operator|*
name|addrl
operator|++
operator|^=
operator|~
literal|0
expr_stmt|;
if|if
condition|(
name|endmask
condition|)
block|{
if|if
condition|(
name|rop
operator|==
name|RROP_BLACK
condition|)
operator|*
name|addrl
operator|&=
operator|~
name|endmask
expr_stmt|;
elseif|else
if|if
condition|(
name|rop
operator|==
name|RROP_WHITE
condition|)
operator|*
name|addrl
operator||=
name|endmask
expr_stmt|;
else|else
operator|*
name|addrl
operator|^=
name|endmask
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|miFillArcLower
argument_list|(
name|slw
argument_list|)
condition|)
continue|continue;
name|addrl
operator|=
name|addrlb
operator|+
operator|(
name|xpos
operator|>>
literal|5
operator|)
expr_stmt|;
if|if
condition|(
name|startmask
condition|)
block|{
if|if
condition|(
name|rop
operator|==
name|RROP_BLACK
condition|)
operator|*
name|addrl
operator|++
operator|&=
operator|~
name|startmask
expr_stmt|;
elseif|else
if|if
condition|(
name|rop
operator|==
name|RROP_WHITE
condition|)
operator|*
name|addrl
operator|++
operator||=
name|startmask
expr_stmt|;
else|else
operator|*
name|addrl
operator|++
operator|^=
name|startmask
expr_stmt|;
block|}
name|n
operator|=
name|nlmiddle
expr_stmt|;
if|if
condition|(
name|rop
operator|==
name|RROP_BLACK
condition|)
while|while
condition|(
name|n
operator|--
condition|)
operator|*
name|addrl
operator|++
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|rop
operator|==
name|RROP_WHITE
condition|)
while|while
condition|(
name|n
operator|--
condition|)
operator|*
name|addrl
operator|++
operator|=
operator|~
literal|0
expr_stmt|;
else|else
while|while
condition|(
name|n
operator|--
condition|)
operator|*
name|addrl
operator|++
operator|^=
operator|~
literal|0
expr_stmt|;
if|if
condition|(
name|endmask
condition|)
block|{
if|if
condition|(
name|rop
operator|==
name|RROP_BLACK
condition|)
operator|*
name|addrl
operator|&=
operator|~
name|endmask
expr_stmt|;
elseif|else
if|if
condition|(
name|rop
operator|==
name|RROP_WHITE
condition|)
operator|*
name|addrl
operator||=
name|endmask
expr_stmt|;
else|else
operator|*
name|addrl
operator|^=
name|endmask
expr_stmt|;
block|}
block|}
block|}
end_function

begin_define
define|#
directive|define
name|FILLSPAN
parameter_list|(
name|xl
parameter_list|,
name|xr
parameter_list|,
name|addr
parameter_list|)
define|\
value|if (xr>= xl) \     { \ 	width = xr - xl + 1; \ 	addrl = addr + (xl>> 5); \ 	if (((xl& 0x1f) + width)< 32) \ 	{ \ 	    maskpartialbits(xl, width, startmask); \ 	    if (rop == RROP_BLACK) \ 		*addrl&= ~startmask; \ 	    else if (rop == RROP_WHITE) \ 		*addrl |= startmask; \ 	    else \ 		*addrl ^= startmask; \ 	} \ 	else \ 	{ \ 	    maskbits(xl, width, startmask, endmask, nlmiddle); \ 	    if (startmask) \ 	    { \ 		if (rop == RROP_BLACK) \ 		    *addrl++&= ~startmask; \ 		else if (rop == RROP_WHITE) \ 		    *addrl++ |= startmask; \ 		else \ 		    *addrl++ ^= startmask; \ 	    } \ 	    n = nlmiddle; \ 	    if (rop == RROP_BLACK) \ 		while (n--) \ 		    *addrl++ = 0; \ 	    else if (rop == RROP_WHITE) \ 		while (n--) \ 		    *addrl++ = ~0; \ 	    else \ 		while (n--) \ 		    *addrl++ ^= ~0; \ 	    if (endmask) \ 	    { \ 		if (rop == RROP_BLACK) \ 		    *addrl&= ~endmask; \ 		else if (rop == RROP_WHITE) \ 		    *addrl |= endmask; \ 		else \ 		    *addrl ^= endmask; \ 	    } \ 	} \     }
end_define

begin_define
define|#
directive|define
name|FILLSLICESPANS
parameter_list|(
name|flip
parameter_list|,
name|addr
parameter_list|)
define|\
value|if (!flip) \     { \ 	FILLSPAN(xl, xr, addr); \     } \     else \     { \ 	xc = xorg - x; \ 	FILLSPAN(xc, xr, addr); \ 	xc += slw - 1; \ 	FILLSPAN(xl, xc, addr); \     }
end_define

begin_function
specifier|static
name|void
name|mfbFillArcSliceSolidCopy
parameter_list|(
name|pDraw
parameter_list|,
name|pGC
parameter_list|,
name|arc
parameter_list|,
name|rop
parameter_list|)
name|DrawablePtr
name|pDraw
decl_stmt|;
name|GCPtr
name|pGC
decl_stmt|;
name|xArc
modifier|*
name|arc
decl_stmt|;
specifier|register
name|int
name|rop
decl_stmt|;
block|{
specifier|register
name|int
modifier|*
name|addrl
decl_stmt|;
specifier|register
name|int
name|n
decl_stmt|;
name|int
name|yk
decl_stmt|,
name|xk
decl_stmt|,
name|ym
decl_stmt|,
name|xm
decl_stmt|,
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|xorg
decl_stmt|,
name|yorg
decl_stmt|,
name|slw
decl_stmt|;
specifier|register
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|e
decl_stmt|;
name|miFillArcRec
name|info
decl_stmt|;
name|miArcSliceRec
name|slice
decl_stmt|;
name|int
name|xl
decl_stmt|,
name|xr
decl_stmt|,
name|xc
decl_stmt|;
name|int
modifier|*
name|addrlt
decl_stmt|,
modifier|*
name|addrlb
decl_stmt|;
name|int
name|nlwidth
decl_stmt|;
name|int
name|width
decl_stmt|;
name|int
name|startmask
decl_stmt|,
name|endmask
decl_stmt|,
name|nlmiddle
decl_stmt|;
if|if
condition|(
name|pDraw
operator|->
name|type
operator|==
name|DRAWABLE_WINDOW
condition|)
block|{
name|addrlt
operator|=
operator|(
name|int
operator|*
operator|)
name|getPrivScreenPtr
argument_list|(
name|pDraw
operator|->
name|pScreen
argument_list|)
operator|->
name|bits
expr_stmt|;
name|nlwidth
operator|=
operator|(
name|int
operator|)
name|getPrivScreenPtr
argument_list|(
name|pDraw
operator|->
name|pScreen
argument_list|)
operator|->
name|stride
operator|>>
literal|2
expr_stmt|;
block|}
else|else
block|{
name|addrlt
operator|=
operator|(
name|int
operator|*
operator|)
name|getPrivPixmapPtr
argument_list|(
name|pDraw
argument_list|)
operator|->
name|bits
expr_stmt|;
name|nlwidth
operator|=
operator|(
name|int
operator|)
name|getPrivPixmapPtr
argument_list|(
name|pDraw
argument_list|)
operator|->
name|stride
operator|>>
literal|2
expr_stmt|;
block|}
name|miFillArcSetup
argument_list|(
name|arc
argument_list|,
operator|&
name|info
argument_list|)
expr_stmt|;
name|miFillArcSliceSetup
argument_list|(
name|arc
argument_list|,
operator|&
name|slice
argument_list|,
name|pGC
argument_list|)
expr_stmt|;
name|MIFILLARCSETUP
argument_list|()
expr_stmt|;
name|xorg
operator|+=
name|pDraw
operator|->
name|x
expr_stmt|;
name|yorg
operator|+=
name|pDraw
operator|->
name|y
expr_stmt|;
name|addrlb
operator|=
name|addrlt
expr_stmt|;
name|addrlt
operator|+=
name|nlwidth
operator|*
operator|(
name|yorg
operator|-
name|y
operator|)
expr_stmt|;
name|addrlb
operator|+=
name|nlwidth
operator|*
operator|(
name|yorg
operator|+
name|y
operator|+
name|dy
operator|)
expr_stmt|;
name|slice
operator|.
name|edge1
operator|.
name|x
operator|+=
name|pDraw
operator|->
name|x
expr_stmt|;
name|slice
operator|.
name|edge2
operator|.
name|x
operator|+=
name|pDraw
operator|->
name|x
expr_stmt|;
while|while
condition|(
name|y
operator|>
literal|0
condition|)
block|{
name|addrlt
operator|+=
name|nlwidth
expr_stmt|;
name|addrlb
operator|-=
name|nlwidth
expr_stmt|;
name|MIFILLARCSTEP
argument_list|(
name|slw
argument_list|)
expr_stmt|;
name|MIARCSLICESTEP
argument_list|(
name|slice
operator|.
name|edge1
argument_list|)
expr_stmt|;
name|MIARCSLICESTEP
argument_list|(
name|slice
operator|.
name|edge2
argument_list|)
expr_stmt|;
if|if
condition|(
name|miFillSliceUpper
argument_list|(
name|slice
argument_list|)
condition|)
block|{
name|MIARCSLICEUPPER
argument_list|(
name|xl
argument_list|,
name|xr
argument_list|,
name|slice
argument_list|,
name|slw
argument_list|)
expr_stmt|;
name|FILLSLICESPANS
argument_list|(
name|slice
operator|.
name|flip_top
argument_list|,
name|addrlt
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|miFillSliceLower
argument_list|(
name|slice
argument_list|)
condition|)
block|{
name|MIARCSLICELOWER
argument_list|(
name|xl
argument_list|,
name|xr
argument_list|,
name|slice
argument_list|,
name|slw
argument_list|)
expr_stmt|;
name|FILLSLICESPANS
argument_list|(
name|slice
operator|.
name|flip_bot
argument_list|,
name|addrlb
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
name|mfbPolyFillArcSolid
parameter_list|(
name|pDraw
parameter_list|,
name|pGC
parameter_list|,
name|narcs
parameter_list|,
name|parcs
parameter_list|)
specifier|register
name|DrawablePtr
name|pDraw
decl_stmt|;
name|GCPtr
name|pGC
decl_stmt|;
name|int
name|narcs
decl_stmt|;
name|xArc
modifier|*
name|parcs
decl_stmt|;
block|{
name|mfbPrivGC
modifier|*
name|priv
decl_stmt|;
specifier|register
name|xArc
modifier|*
name|arc
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|BoxRec
name|box
decl_stmt|;
name|RegionPtr
name|cclip
decl_stmt|;
name|int
name|rop
decl_stmt|;
name|priv
operator|=
operator|(
name|mfbPrivGC
operator|*
operator|)
name|pGC
operator|->
name|devPrivates
index|[
name|mfbGCPrivateIndex
index|]
operator|.
name|ptr
expr_stmt|;
name|rop
operator|=
name|priv
operator|->
name|rop
expr_stmt|;
if|if
condition|(
operator|(
name|rop
operator|==
name|RROP_NOP
operator|)
operator|||
operator|!
operator|(
name|pGC
operator|->
name|planemask
operator|&
literal|1
operator|)
condition|)
return|return;
name|cclip
operator|=
name|priv
operator|->
name|pCompositeClip
expr_stmt|;
for|for
control|(
name|arc
operator|=
name|parcs
operator|,
name|i
operator|=
name|narcs
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
name|arc
operator|++
control|)
block|{
if|if
condition|(
name|miFillArcEmpty
argument_list|(
name|arc
argument_list|)
condition|)
continue|continue;
if|if
condition|(
name|miCanFillArc
argument_list|(
name|arc
argument_list|)
condition|)
block|{
name|box
operator|.
name|x1
operator|=
name|arc
operator|->
name|x
operator|+
name|pDraw
operator|->
name|x
expr_stmt|;
name|box
operator|.
name|y1
operator|=
name|arc
operator|->
name|y
operator|+
name|pDraw
operator|->
name|y
expr_stmt|;
name|box
operator|.
name|x2
operator|=
name|box
operator|.
name|x1
operator|+
operator|(
name|int
operator|)
name|arc
operator|->
name|width
operator|+
literal|1
expr_stmt|;
name|box
operator|.
name|y2
operator|=
name|box
operator|.
name|y1
operator|+
operator|(
name|int
operator|)
name|arc
operator|->
name|height
operator|+
literal|1
expr_stmt|;
if|if
condition|(
call|(
modifier|*
name|pDraw
operator|->
name|pScreen
operator|->
name|RectIn
call|)
argument_list|(
name|cclip
argument_list|,
operator|&
name|box
argument_list|)
operator|==
name|rgnIN
condition|)
block|{
if|if
condition|(
operator|(
name|arc
operator|->
name|angle2
operator|>=
name|FULLCIRCLE
operator|)
operator|||
operator|(
name|arc
operator|->
name|angle2
operator|<=
operator|-
name|FULLCIRCLE
operator|)
condition|)
name|mfbFillEllipseSolid
argument_list|(
name|pDraw
argument_list|,
name|arc
argument_list|,
name|rop
argument_list|)
expr_stmt|;
else|else
name|mfbFillArcSliceSolidCopy
argument_list|(
name|pDraw
argument_list|,
name|pGC
argument_list|,
name|arc
argument_list|,
name|rop
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
name|miPolyFillArc
argument_list|(
name|pDraw
argument_list|,
name|pGC
argument_list|,
literal|1
argument_list|,
name|arc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

