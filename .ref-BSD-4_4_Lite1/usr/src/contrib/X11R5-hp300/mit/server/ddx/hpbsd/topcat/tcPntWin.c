begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*********************************************************** Copyright 1987 by Digital Equipment Corporation, Maynard, Massachusetts, and the Massachusetts Institute of Technology, Cambridge, Massachusetts.                          All Rights Reserved  Permission to use, copy, modify, and distribute this software and its  documentation for any purpose and without fee is hereby granted,  provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in  supporting documentation, and that the names of Digital or MIT not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.    DIGITAL DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL DIGITAL BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  ******************************************************************/
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"windowstr.h"
end_include

begin_include
include|#
directive|include
file|"regionstr.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"../cfb/cfb.h"
end_include

begin_include
include|#
directive|include
file|"../cfb/cfbmskbits.h"
end_include

begin_include
include|#
directive|include
file|"topcat.h"
end_include

begin_function_decl
specifier|extern
name|void
name|miPaintWindow
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|void
name|tcPaintWindow
parameter_list|(
name|pWin
parameter_list|,
name|pRegion
parameter_list|,
name|what
parameter_list|)
name|WindowPtr
name|pWin
decl_stmt|;
name|RegionPtr
name|pRegion
decl_stmt|;
name|int
name|what
decl_stmt|;
block|{
specifier|register
name|cfbPrivWin
modifier|*
name|pPrivWin
decl_stmt|;
name|pPrivWin
operator|=
operator|(
name|cfbPrivWin
operator|*
operator|)
operator|(
name|pWin
operator|->
name|devPrivates
index|[
name|cfbWindowPrivateIndex
index|]
operator|.
name|ptr
operator|)
expr_stmt|;
switch|switch
condition|(
name|what
condition|)
block|{
case|case
name|PW_BACKGROUND
case|:
switch|switch
condition|(
name|pWin
operator|->
name|backgroundState
condition|)
block|{
case|case
name|None
case|:
return|return;
case|case
name|ParentRelative
case|:
do|do
block|{
name|pWin
operator|=
name|pWin
operator|->
name|parent
expr_stmt|;
block|}
do|while
condition|(
name|pWin
operator|->
name|backgroundState
operator|==
name|ParentRelative
condition|)
do|;
call|(
modifier|*
name|pWin
operator|->
name|drawable
operator|.
name|pScreen
operator|->
name|PaintWindowBackground
call|)
argument_list|(
name|pWin
argument_list|,
name|pRegion
argument_list|,
name|what
argument_list|)
expr_stmt|;
return|return;
case|case
name|BackgroundPixmap
case|:
if|if
condition|(
name|pPrivWin
operator|->
name|fastBackground
condition|)
block|{
if|if
condition|(
name|pPrivWin
operator|->
name|pRotatedBackground
operator|->
name|devKind
operator|==
name|PIXMAP_FRAME_BUFFER
condition|)
name|tcFillBoxTile
argument_list|(
operator|(
name|DrawablePtr
operator|)
name|pWin
argument_list|,
operator|(
name|int
operator|)
name|REGION_NUM_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|REGION_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|pPrivWin
operator|->
name|pRotatedBackground
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|GXcopy
argument_list|,
operator|~
literal|0
argument_list|)
expr_stmt|;
else|else
name|cfbFillBoxTile32
argument_list|(
operator|(
name|DrawablePtr
operator|)
name|pWin
argument_list|,
operator|(
name|int
operator|)
name|REGION_NUM_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|REGION_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|pPrivWin
operator|->
name|pRotatedBackground
argument_list|)
expr_stmt|;
return|return;
block|}
elseif|else
if|if
condition|(
name|pWin
operator|->
name|background
operator|.
name|pixmap
operator|->
name|drawable
operator|.
name|width
operator|>
literal|32
condition|)
block|{
if|if
condition|(
name|pWin
operator|->
name|background
operator|.
name|pixmap
operator|->
name|devKind
operator|==
name|PIXMAP_FRAME_BUFFER
condition|)
name|tcFillBoxTile
argument_list|(
operator|(
name|DrawablePtr
operator|)
name|pWin
argument_list|,
operator|(
name|int
operator|)
name|REGION_NUM_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|REGION_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|pWin
operator|->
name|background
operator|.
name|pixmap
argument_list|,
operator|(
name|int
operator|)
name|pWin
operator|->
name|drawable
operator|.
name|x
argument_list|,
operator|(
name|int
operator|)
name|pWin
operator|->
name|drawable
operator|.
name|y
argument_list|,
name|GXcopy
argument_list|,
operator|~
literal|0
argument_list|)
expr_stmt|;
else|else
name|cfbFillBoxTileOdd
argument_list|(
operator|(
name|DrawablePtr
operator|)
name|pWin
argument_list|,
operator|(
name|int
operator|)
name|REGION_NUM_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|REGION_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|pWin
operator|->
name|background
operator|.
name|pixmap
argument_list|,
operator|(
name|int
operator|)
name|pWin
operator|->
name|drawable
operator|.
name|x
argument_list|,
operator|(
name|int
operator|)
name|pWin
operator|->
name|drawable
operator|.
name|y
argument_list|)
expr_stmt|;
return|return;
block|}
break|break;
case|case
name|BackgroundPixel
case|:
name|tcFillBoxSolid
argument_list|(
operator|(
name|DrawablePtr
operator|)
name|pWin
argument_list|,
operator|(
name|int
operator|)
name|REGION_NUM_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|REGION_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|pWin
operator|->
name|background
operator|.
name|pixel
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return;
block|}
break|break;
case|case
name|PW_BORDER
case|:
if|if
condition|(
name|pWin
operator|->
name|borderIsPixel
condition|)
block|{
name|tcFillBoxSolid
argument_list|(
operator|(
name|DrawablePtr
operator|)
name|pWin
argument_list|,
operator|(
name|int
operator|)
name|REGION_NUM_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|REGION_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|pWin
operator|->
name|border
operator|.
name|pixel
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return;
block|}
elseif|else
if|if
condition|(
name|pPrivWin
operator|->
name|fastBorder
condition|)
block|{
name|cfbFillBoxTile32
argument_list|(
operator|(
name|DrawablePtr
operator|)
name|pWin
argument_list|,
operator|(
name|int
operator|)
name|REGION_NUM_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|REGION_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|pPrivWin
operator|->
name|pRotatedBorder
argument_list|)
expr_stmt|;
return|return;
block|}
elseif|else
if|if
condition|(
name|pWin
operator|->
name|border
operator|.
name|pixmap
operator|->
name|drawable
operator|.
name|width
operator|>
literal|32
condition|)
block|{
name|cfbFillBoxTileOdd
argument_list|(
operator|(
name|DrawablePtr
operator|)
name|pWin
argument_list|,
operator|(
name|int
operator|)
name|REGION_NUM_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|REGION_RECTS
argument_list|(
name|pRegion
argument_list|)
argument_list|,
name|pWin
operator|->
name|border
operator|.
name|pixmap
argument_list|,
operator|(
name|int
operator|)
name|pWin
operator|->
name|drawable
operator|.
name|x
argument_list|,
operator|(
name|int
operator|)
name|pWin
operator|->
name|drawable
operator|.
name|y
argument_list|)
expr_stmt|;
return|return;
block|}
break|break;
block|}
name|miPaintWindow
argument_list|(
name|pWin
argument_list|,
name|pRegion
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

