begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * XFontName.c  *  * build/parse X Font name strings  */
end_comment

begin_include
include|#
directive|include
file|<X11/Xlib.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xos.h>
end_include

begin_include
include|#
directive|include
file|"XFontName.h"
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_function
specifier|static
name|char
modifier|*
name|extractStringField
parameter_list|(
name|name
parameter_list|,
name|buffer
parameter_list|,
name|size
parameter_list|,
name|attrp
parameter_list|,
name|bit
parameter_list|)
name|char
modifier|*
name|name
decl_stmt|;
name|char
modifier|*
name|buffer
decl_stmt|;
name|int
name|size
decl_stmt|;
name|unsigned
name|int
modifier|*
name|attrp
decl_stmt|;
name|unsigned
name|int
name|bit
decl_stmt|;
block|{
name|char
modifier|*
name|buf
init|=
name|buffer
decl_stmt|;
if|if
condition|(
operator|!
operator|*
name|name
condition|)
return|return
literal|0
return|;
while|while
condition|(
operator|*
name|name
operator|&&
operator|*
name|name
operator|!=
literal|'-'
operator|&&
name|size
operator|>
literal|0
condition|)
block|{
operator|*
name|buf
operator|++
operator|=
operator|*
name|name
operator|++
expr_stmt|;
operator|--
name|size
expr_stmt|;
block|}
if|if
condition|(
name|size
operator|<=
literal|0
condition|)
return|return
literal|0
return|;
operator|*
name|buf
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|buffer
index|[
literal|0
index|]
operator|!=
literal|'*'
operator|||
name|buffer
index|[
literal|1
index|]
operator|!=
literal|'\0'
condition|)
operator|*
name|attrp
operator||=
name|bit
expr_stmt|;
if|if
condition|(
operator|*
name|name
operator|==
literal|'-'
condition|)
return|return
name|name
operator|+
literal|1
return|;
return|return
name|name
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|extractUnsignedField
parameter_list|(
name|name
parameter_list|,
name|result
parameter_list|,
name|attrp
parameter_list|,
name|bit
parameter_list|)
name|char
modifier|*
name|name
decl_stmt|;
name|unsigned
name|int
modifier|*
name|result
decl_stmt|;
name|unsigned
name|int
modifier|*
name|attrp
decl_stmt|;
name|unsigned
name|int
name|bit
decl_stmt|;
block|{
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|;
name|char
modifier|*
name|c
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|name
operator|=
name|extractStringField
argument_list|(
name|name
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|attrp
argument_list|,
name|bit
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|name
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
operator|(
operator|*
name|attrp
operator|&
name|bit
operator|)
condition|)
return|return
name|name
return|;
name|i
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|c
operator|=
name|buf
init|;
operator|*
name|c
condition|;
name|c
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|isdigit
argument_list|(
operator|*
name|c
argument_list|)
condition|)
return|return
literal|0
return|;
name|i
operator|=
name|i
operator|*
literal|10
operator|+
operator|(
operator|*
name|c
operator|-
literal|'0'
operator|)
expr_stmt|;
block|}
operator|*
name|result
operator|=
name|i
expr_stmt|;
return|return
name|name
return|;
block|}
end_function

begin_function
name|Bool
name|XParseFontName
parameter_list|(
name|fontNameString
parameter_list|,
name|fontName
parameter_list|,
name|fontNameAttributes
parameter_list|)
name|XFontNameString
name|fontNameString
decl_stmt|;
name|XFontName
modifier|*
name|fontName
decl_stmt|;
name|unsigned
name|int
modifier|*
name|fontNameAttributes
decl_stmt|;
block|{
name|char
modifier|*
name|name
init|=
name|fontNameString
decl_stmt|;
name|XFontName
name|temp
decl_stmt|;
name|unsigned
name|int
name|attributes
init|=
literal|0
decl_stmt|;
define|#
directive|define
name|GetString
parameter_list|(
name|field
parameter_list|,
name|bit
parameter_list|)
define|\
value|if (!(name = extractStringField \ 		(name, temp.field, sizeof (temp.field),\&attributes, bit))) \ 		return False;
define|#
directive|define
name|GetUnsigned
parameter_list|(
name|field
parameter_list|,
name|bit
parameter_list|)
define|\
value|if (!(name = extractUnsignedField \ 		(name,&temp.field, \&attributes, bit))) \ 		return False;
name|GetString
argument_list|(
argument|Registry
argument_list|,
argument|FontNameRegistry
argument_list|)
name|GetString
argument_list|(
argument|Foundry
argument_list|,
argument|FontNameFoundry
argument_list|)
name|GetString
argument_list|(
argument|FamilyName
argument_list|,
argument|FontNameFamilyName
argument_list|)
name|GetString
argument_list|(
argument|WeightName
argument_list|,
argument|FontNameWeightName
argument_list|)
name|GetString
argument_list|(
argument|Slant
argument_list|,
argument|FontNameSlant
argument_list|)
name|GetString
argument_list|(
argument|SetwidthName
argument_list|,
argument|FontNameSetwidthName
argument_list|)
name|GetString
argument_list|(
argument|AddStyleName
argument_list|,
argument|FontNameAddStyleName
argument_list|)
name|GetUnsigned
argument_list|(
argument|PixelSize
argument_list|,
argument|FontNamePixelSize
argument_list|)
name|GetUnsigned
argument_list|(
argument|PointSize
argument_list|,
argument|FontNamePointSize
argument_list|)
name|GetUnsigned
argument_list|(
argument|ResolutionX
argument_list|,
argument|FontNameResolutionX
argument_list|)
name|GetUnsigned
argument_list|(
argument|ResolutionY
argument_list|,
argument|FontNameResolutionY
argument_list|)
name|GetString
argument_list|(
argument|Spacing
argument_list|,
argument|FontNameSpacing
argument_list|)
name|GetUnsigned
argument_list|(
argument|AverageWidth
argument_list|,
argument|FontNameAverageWidth
argument_list|)
name|GetString
argument_list|(
argument|CharSetRegistry
argument_list|,
argument|FontNameCharSetRegistry
argument_list|)
if|if
condition|(
operator|!
operator|*
name|name
condition|)
block|{
name|temp
operator|.
name|CharSetEncoding
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|attributes
operator||=
name|FontNameCharSetEncoding
expr_stmt|;
block|}
else|else
block|{
name|GetString
argument_list|(
argument|CharSetEncoding
argument_list|,
argument|FontNameCharSetEncoding
argument_list|)
block|}
operator|*
name|fontName
operator|=
name|temp
expr_stmt|;
operator|*
name|fontNameAttributes
operator|=
name|attributes
expr_stmt|;
return|return
name|True
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|utoa
parameter_list|(
name|u
parameter_list|,
name|s
parameter_list|,
name|size
parameter_list|)
name|unsigned
name|int
name|u
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|;
name|int
name|size
decl_stmt|;
block|{
name|char
modifier|*
name|t
decl_stmt|;
name|t
operator|=
name|s
operator|+
name|size
expr_stmt|;
operator|*
operator|--
name|t
operator|=
literal|'\0'
expr_stmt|;
do|do
operator|*
operator|--
name|t
operator|=
operator|(
name|u
operator|%
literal|10
operator|)
operator|+
literal|'0'
expr_stmt|;
do|while
condition|(
name|u
operator|/=
literal|10
condition|)
do|;
return|return
name|t
return|;
block|}
end_function

begin_function
name|Bool
name|XFormatFontName
parameter_list|(
name|fontName
parameter_list|,
name|fontNameAttributes
parameter_list|,
name|fontNameString
parameter_list|)
name|XFontName
modifier|*
name|fontName
decl_stmt|;
name|unsigned
name|int
name|fontNameAttributes
decl_stmt|;
name|XFontNameString
name|fontNameString
decl_stmt|;
block|{
name|XFontNameString
name|tmp
decl_stmt|;
name|char
modifier|*
name|name
init|=
name|tmp
decl_stmt|,
modifier|*
name|f
decl_stmt|;
name|int
name|left
init|=
sizeof|sizeof
argument_list|(
name|tmp
argument_list|)
operator|-
literal|1
decl_stmt|;
name|char
name|number
index|[
literal|32
index|]
decl_stmt|;
define|#
directive|define
name|PutString
parameter_list|(
name|field
parameter_list|,
name|bit
parameter_list|)
define|\
value|f = (fontNameAttributes& bit) ? \ 		fontName->field \ 		: "*"; \ 	if ((left -= strlen (f))< 0) \ 		return False; \ 	while (*f) \ 		if ((*name++ = *f++) == '-') \ 			return False;
define|#
directive|define
name|PutHyphen
parameter_list|()
define|\
value|if (--left< 0) \ 		return False; \ 	*name++ = '-';
define|#
directive|define
name|PutUnsigned
parameter_list|(
name|field
parameter_list|,
name|bit
parameter_list|)
define|\
value|f = (fontNameAttributes& bit) ? \ 		utoa (fontName->field, number, sizeof (number)) \ 		: "*"; \ 	if ((left -= strlen (f))< 0) \ 		return False; \ 	while (*f) \ 		*name++ = *f++;
name|PutString
argument_list|(
argument|Registry
argument_list|,
argument|FontNameRegistry
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutString
argument_list|(
argument|Foundry
argument_list|,
argument|FontNameFoundry
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutString
argument_list|(
argument|FamilyName
argument_list|,
argument|FontNameFamilyName
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutString
argument_list|(
argument|WeightName
argument_list|,
argument|FontNameWeightName
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutString
argument_list|(
argument|Slant
argument_list|,
argument|FontNameSlant
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutString
argument_list|(
argument|SetwidthName
argument_list|,
argument|FontNameSetwidthName
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutString
argument_list|(
argument|AddStyleName
argument_list|,
argument|FontNameAddStyleName
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutUnsigned
argument_list|(
argument|PixelSize
argument_list|,
argument|FontNamePixelSize
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutUnsigned
argument_list|(
argument|PointSize
argument_list|,
argument|FontNamePointSize
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutUnsigned
argument_list|(
argument|ResolutionX
argument_list|,
argument|FontNameResolutionX
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutUnsigned
argument_list|(
argument|ResolutionY
argument_list|,
argument|FontNameResolutionY
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutString
argument_list|(
argument|Spacing
argument_list|,
argument|FontNameSpacing
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutUnsigned
argument_list|(
argument|AverageWidth
argument_list|,
argument|FontNameAverageWidth
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutString
argument_list|(
argument|CharSetRegistry
argument_list|,
argument|FontNameCharSetRegistry
argument_list|)
name|PutHyphen
argument_list|()
expr_stmt|;
name|PutString
argument_list|(
name|CharSetEncoding
argument_list|,
name|FontNameCharSetEncoding
argument_list|)
operator|*
name|name
operator|=
literal|'\0'
expr_stmt|;
name|strcpy
argument_list|(
name|fontNameString
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
return|return
name|True
return|;
block|}
end_function

begin_function
name|Bool
name|XCompareFontName
parameter_list|(
name|name1
parameter_list|,
name|name2
parameter_list|,
name|fontNameAttributes
parameter_list|)
name|XFontName
modifier|*
name|name1
decl_stmt|,
decl|*
name|name2
decl_stmt|;
end_function

begin_decl_stmt
name|unsigned
name|int
name|fontNameAttributes
decl_stmt|;
end_decl_stmt

begin_block
block|{
define|#
directive|define
name|CompareString
parameter_list|(
name|field
parameter_list|,
name|bit
parameter_list|)
define|\
value|if (fontNameAttributes& bit) \ 		if (strcmp (name1->field, name2->field)) \ 			return False;
define|#
directive|define
name|CompareUnsigned
parameter_list|(
name|field
parameter_list|,
name|bit
parameter_list|)
define|\
value|if (fontNameAttributes& bit) \ 		if (name1->field != name2->field) \ 			return False;
name|CompareString
argument_list|(
argument|Registry
argument_list|,
argument|FontNameRegistry
argument_list|)
name|CompareString
argument_list|(
argument|Foundry
argument_list|,
argument|FontNameFoundry
argument_list|)
name|CompareString
argument_list|(
argument|FamilyName
argument_list|,
argument|FontNameFamilyName
argument_list|)
name|CompareString
argument_list|(
argument|WeightName
argument_list|,
argument|FontNameWeightName
argument_list|)
name|CompareString
argument_list|(
argument|Slant
argument_list|,
argument|FontNameSlant
argument_list|)
name|CompareString
argument_list|(
argument|SetwidthName
argument_list|,
argument|FontNameSetwidthName
argument_list|)
name|CompareString
argument_list|(
argument|AddStyleName
argument_list|,
argument|FontNameAddStyleName
argument_list|)
name|CompareUnsigned
argument_list|(
argument|PixelSize
argument_list|,
argument|FontNamePixelSize
argument_list|)
name|CompareUnsigned
argument_list|(
argument|PointSize
argument_list|,
argument|FontNamePointSize
argument_list|)
name|CompareUnsigned
argument_list|(
argument|ResolutionX
argument_list|,
argument|FontNameResolutionX
argument_list|)
name|CompareUnsigned
argument_list|(
argument|ResolutionY
argument_list|,
argument|FontNameResolutionY
argument_list|)
name|CompareString
argument_list|(
argument|Spacing
argument_list|,
argument|FontNameSpacing
argument_list|)
name|CompareUnsigned
argument_list|(
argument|AverageWidth
argument_list|,
argument|FontNameAverageWidth
argument_list|)
name|CompareString
argument_list|(
argument|CharSetRegistry
argument_list|,
argument|FontNameCharSetRegistry
argument_list|)
name|CompareString
argument_list|(
argument|CharSetEncoding
argument_list|,
argument|FontNameCharSetEncoding
argument_list|)
return|return
name|True
return|;
block|}
end_block

begin_macro
name|XCopyFontName
argument_list|(
argument|name1
argument_list|,
argument|name2
argument_list|,
argument|fontNameAttributes
argument_list|)
end_macro

begin_decl_stmt
name|XFontName
modifier|*
name|name1
decl_stmt|,
modifier|*
name|name2
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|int
name|fontNameAttributes
decl_stmt|;
end_decl_stmt

begin_block
block|{
define|#
directive|define
name|CopyString
parameter_list|(
name|field
parameter_list|,
name|bit
parameter_list|)
define|\
value|if (fontNameAttributes& bit) \ 		strcpy (name2->field, name1->field);
define|#
directive|define
name|CopyUnsigned
parameter_list|(
name|field
parameter_list|,
name|bit
parameter_list|)
define|\
value|if (fontNameAttributes& bit) \ 		name2->field = name1->field;
name|CopyString
argument_list|(
argument|Registry
argument_list|,
argument|FontNameRegistry
argument_list|)
name|CopyString
argument_list|(
argument|Foundry
argument_list|,
argument|FontNameFoundry
argument_list|)
name|CopyString
argument_list|(
argument|FamilyName
argument_list|,
argument|FontNameFamilyName
argument_list|)
name|CopyString
argument_list|(
argument|WeightName
argument_list|,
argument|FontNameWeightName
argument_list|)
name|CopyString
argument_list|(
argument|Slant
argument_list|,
argument|FontNameSlant
argument_list|)
name|CopyString
argument_list|(
argument|SetwidthName
argument_list|,
argument|FontNameSetwidthName
argument_list|)
name|CopyString
argument_list|(
argument|AddStyleName
argument_list|,
argument|FontNameAddStyleName
argument_list|)
name|CopyUnsigned
argument_list|(
argument|PixelSize
argument_list|,
argument|FontNamePixelSize
argument_list|)
name|CopyUnsigned
argument_list|(
argument|PointSize
argument_list|,
argument|FontNamePointSize
argument_list|)
name|CopyUnsigned
argument_list|(
argument|ResolutionX
argument_list|,
argument|FontNameResolutionX
argument_list|)
name|CopyUnsigned
argument_list|(
argument|ResolutionY
argument_list|,
argument|FontNameResolutionY
argument_list|)
name|CopyString
argument_list|(
argument|Spacing
argument_list|,
argument|FontNameSpacing
argument_list|)
name|CopyUnsigned
argument_list|(
argument|AverageWidth
argument_list|,
argument|FontNameAverageWidth
argument_list|)
name|CopyString
argument_list|(
argument|CharSetRegistry
argument_list|,
argument|FontNameCharSetRegistry
argument_list|)
name|CopyString
argument_list|(
argument|CharSetEncoding
argument_list|,
argument|FontNameCharSetEncoding
argument_list|)
return|return
name|True
return|;
block|}
end_block

end_unit

