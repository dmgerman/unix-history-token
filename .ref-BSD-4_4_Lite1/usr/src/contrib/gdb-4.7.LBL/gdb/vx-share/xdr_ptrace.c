begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* xdr_ptrace.c  - xdr routines for remote ptrace calls */
end_comment

begin_comment
comment|/*  Copyright 1984, 1985, 1986, 1987, 1988, 1989, 1992 Free Software Foundation, Inc.      This code was donated by Wind River Systems, Inc. */
end_comment

begin_comment
comment|/* modification history -------------------- 01b,25may91,maf  now uses counted bytes struct to transfer registers. 		 removed xdr_regs_ptr (), xdr_fp_status_ptr (), and 		   xdr_fpa_regs_ptr (). 01a,05jun90,llk  extracted from xdr_ptrace.h, version 01c. */
end_comment

begin_include
include|#
directive|include
file|"vxWorks.h"
end_include

begin_include
include|#
directive|include
file|<rpc/rpc.h>
end_include

begin_include
include|#
directive|include
file|"xdr_ptrace.h"
end_include

begin_define
define|#
directive|define
name|MAX_LEN
value|32000
end_define

begin_comment
comment|/******************************************************************** * * xdr_c_bytes - * * xdr routine for counted bytes   * */
end_comment

begin_function
name|bool_t
name|xdr_c_bytes
parameter_list|(
name|xdrs
parameter_list|,
name|objp
parameter_list|)
name|XDR
modifier|*
name|xdrs
decl_stmt|;
name|C_bytes
modifier|*
name|objp
decl_stmt|;
block|{
return|return
operator|(
name|xdr_bytes
argument_list|(
name|xdrs
argument_list|,
operator|&
name|objp
operator|->
name|bytes
argument_list|,
operator|(
name|u_int
operator|*
operator|)
operator|&
name|objp
operator|->
name|len
argument_list|,
name|MAX_LEN
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/* xdr_c_bytes */
end_comment

begin_comment
comment|/******************************************************************** * * xdr_c_bytes_ptr - * * xdr routine for counted bytes branch of ptrace_info * */
end_comment

begin_function
name|LOCAL
name|bool_t
name|xdr_c_bytes_ptr
parameter_list|(
name|xdrs
parameter_list|,
name|objp
parameter_list|)
name|XDR
modifier|*
name|xdrs
decl_stmt|;
name|C_bytes
modifier|*
modifier|*
name|objp
decl_stmt|;
block|{
return|return
operator|(
name|xdr_pointer
argument_list|(
name|xdrs
argument_list|,
operator|(
name|char
operator|*
operator|*
operator|)
name|objp
argument_list|,
sizeof|sizeof
argument_list|(
name|C_bytes
argument_list|)
argument_list|,
name|xdr_c_bytes
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/* xdr_c_bytes_ptr */
end_comment

begin_comment
comment|/******************************************************************** * * xdr_ptrace_info - * * xdr routine for discriminated union ptrace_info * */
end_comment

begin_function
name|bool_t
name|xdr_ptrace_info
parameter_list|(
name|xdrs
parameter_list|,
name|objp
parameter_list|)
name|XDR
modifier|*
name|xdrs
decl_stmt|;
name|Ptrace_info
modifier|*
name|objp
decl_stmt|;
block|{
specifier|static
name|struct
name|xdr_discrim
name|choices
index|[]
init|=
block|{
block|{
operator|(
name|int
operator|)
name|DATA
block|,
name|xdr_c_bytes_ptr
block|}
block|,
block|{
name|__dontcare__
block|,
name|NULL
block|}
block|}
decl_stmt|;
return|return
operator|(
name|xdr_union
argument_list|(
name|xdrs
argument_list|,
operator|(
name|enum_t
operator|*
operator|)
operator|&
name|objp
operator|->
name|ttype
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|objp
operator|->
name|more_data
argument_list|,
name|choices
argument_list|,
name|xdr_void
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/* xdr_ptrace_info */
end_comment

begin_comment
comment|/******************************************************************** * * xdr_rptrace -  * * xdr routine for remote ptrace data into server * */
end_comment

begin_function
name|bool_t
name|xdr_rptrace
parameter_list|(
name|xdrs
parameter_list|,
name|objp
parameter_list|)
name|XDR
modifier|*
name|xdrs
decl_stmt|;
name|Rptrace
modifier|*
name|objp
decl_stmt|;
block|{
if|if
condition|(
operator|!
name|xdr_int
argument_list|(
name|xdrs
argument_list|,
operator|&
name|objp
operator|->
name|pid
argument_list|)
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
if|if
condition|(
operator|!
name|xdr_int
argument_list|(
name|xdrs
argument_list|,
operator|&
name|objp
operator|->
name|data
argument_list|)
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
if|if
condition|(
operator|!
name|xdr_int
argument_list|(
name|xdrs
argument_list|,
operator|&
name|objp
operator|->
name|addr
argument_list|)
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
if|if
condition|(
operator|!
name|xdr_ptrace_info
argument_list|(
name|xdrs
argument_list|,
operator|&
name|objp
operator|->
name|info
argument_list|)
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_comment
comment|/* xdr_rptrace */
end_comment

begin_comment
comment|/******************************************************************** * * xdr_ptrace_return -  * * xdr routine for remote ptrace data returned by server * */
end_comment

begin_function
name|bool_t
name|xdr_ptrace_return
parameter_list|(
name|xdrs
parameter_list|,
name|objp
parameter_list|)
name|XDR
modifier|*
name|xdrs
decl_stmt|;
name|Ptrace_return
modifier|*
name|objp
decl_stmt|;
block|{
if|if
condition|(
operator|!
name|xdr_int
argument_list|(
name|xdrs
argument_list|,
operator|&
name|objp
operator|->
name|status
argument_list|)
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
if|if
condition|(
operator|!
name|xdr_int
argument_list|(
name|xdrs
argument_list|,
operator|&
name|objp
operator|->
name|errno
argument_list|)
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
if|if
condition|(
operator|!
name|xdr_ptrace_info
argument_list|(
name|xdrs
argument_list|,
operator|&
name|objp
operator|->
name|info
argument_list|)
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_comment
comment|/* xdr_ptrace_return */
end_comment

end_unit

