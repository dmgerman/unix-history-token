begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  When using the gcc 2.1 release marked 3/26, I have problems using fseek() and fwrite() together.  This program (which I typed from memory, so it may not be perfect) prints "2": */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_function
name|main
parameter_list|()
block|{
name|FILE
modifier|*
name|fp
init|=
name|fopen
argument_list|(
literal|"FOO"
argument_list|,
literal|"w+"
argument_list|)
decl_stmt|;
name|printf
argument_list|(
literal|"fseek:100:%d\n"
argument_list|,
name|fseek
argument_list|(
name|fp
argument_list|,
literal|100
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|fwrite
argument_list|(
literal|"a"
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"write 1:%d\n"
argument_list|,
name|ftell
argument_list|(
name|fp
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"fseek:200:%d\n"
argument_list|,
name|fseek
argument_list|(
name|fp
argument_list|,
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|fwrite
argument_list|(
literal|"a"
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"write 1:%d\n"
argument_list|,
name|ftell
argument_list|(
name|fp
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"fseek:100:%d\n"
argument_list|,
name|fseek
argument_list|(
name|fp
argument_list|,
literal|100
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"fgetc:%d\n"
argument_list|,
name|fgetc
argument_list|(
name|fp
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"fseek:150:%d\n"
argument_list|,
name|fseek
argument_list|(
name|fp
argument_list|,
literal|150
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"fgetc:%d\n"
argument_list|,
name|fgetc
argument_list|(
name|fp
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* The program does reasonable things when I use write() instead. I can give a more concise bug report later, if you need it.  BTW, thanks for the info on the binutils.   -Eric  */
end_comment

end_unit

