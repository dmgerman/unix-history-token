begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	srt0.c	1.6	87/04/02	*/
end_comment

begin_include
include|#
directive|include
file|"../machine/mtpr.h"
end_include

begin_define
define|#
directive|define
name|LOCORE
end_define

begin_comment
comment|/*  * Startup code for standalone system  */
end_comment

begin_expr_stmt
operator|.
name|globl
name|_end
operator|.
name|globl
name|_main
operator|.
name|globl
name|__rtt
operator|.
name|globl
name|_openfirst
operator|.
name|globl
name|_start
operator|.
name|globl
name|_boothowto
operator|.
name|globl
name|_bootdev
operator|.
name|set
name|HIGH
operator|,
literal|31
operator|#
name|mask
end_expr_stmt

begin_for
for|for total disable
ifndef|#
directive|ifndef
name|REL
for|.globl	_device_space _device_space:			# Tapemaster config block
operator|,
name|etc
operator|.
expr|.
name|space
literal|0x1000
operator|-
name|RELOC
operator|.
name|globl
name|_entry
name|_entry
operator|:
operator|.
name|word
literal|0x00
operator|#
literal|'call'
name|by
name|relsrt0
operator|.
endif|#
directive|endif
name|_start
operator|:
name|mtpr
name|$HIGH
operator|,
name|$IPL
operator|#
name|just
name|in
end_for

begin_case
case|case
ifdef|#
directive|ifdef
name|REL
name|movl
name|$BOOTRELOC
operator|,
name|sp
name|movl
name|$RELOC
decl_stmt|,
name|r0
comment|/* source address to copy from */
name|movl
name|$BOOTRELOC
decl_stmt|,
name|r1
comment|/* destination address */
name|movl
name|tdlen
decl_stmt|,
name|r2
comment|/* length to copy */
name|addl2
name|r2
decl_stmt|,
name|r0
name|addl2
name|r2
decl_stmt|,
name|r1
name|mvloop
range|:
name|decl
name|r0
name|decl
name|r1
name|movb
argument_list|(
name|r0
argument_list|)
decl_stmt|,
argument_list|(
name|r1
argument_list|)
name|decl
name|r2
name|bgeq
name|mvloop
comment|/*  * zero bss  */
name|movl
name|aedata
decl_stmt|,
name|r1
comment|/* destination address */
name|subl3
name|$_edata
decl_stmt|,
name|$_end
decl_stmt|,
name|r2
comment|/* length to zero */
name|zloop
range|:
name|movb
name|$0
decl_stmt|,
argument_list|(
name|r1
argument_list|)
name|incl
name|r1
name|decl
name|r2
name|bgeq
name|zloop
name|mtpr
name|$1
decl_stmt|,
name|$PACC
name|mtpr
name|$1
decl_stmt|,
name|$PADC
name|jmp
modifier|*
name|abegin
endif|#
directive|endif
name|begin
range|:
name|movl
name|fp
decl_stmt|,
name|ofp
name|movl
name|r11
decl_stmt|,
name|_boothowto
name|movl
name|r10
decl_stmt|,
name|_bootdev
name|movl
name|$1
decl_stmt|,
name|_openfirst
name|callf
name|$4
decl_stmt|,
name|_main
ifdef|#
directive|ifdef
name|REL
name|halt
endif|#
directive|endif
name|ret
name|__rtt
range|:
operator|.
name|word
literal|0x0
ifdef|#
directive|ifdef
name|REL
name|halt
endif|#
directive|endif
name|movl
name|ofp
decl_stmt|,
name|fp
name|ret
operator|.
name|data
name|abegin
range|:
operator|.
name|long
name|begin
ifdef|#
directive|ifdef
name|REL
name|aedata
case|:
end_case

begin_expr_stmt
operator|.
name|long
name|_edata
name|tdlen
operator|:
operator|.
name|long
name|_edata
operator|-
name|BOOTRELOC
endif|#
directive|endif
name|ofp
operator|:
operator|.
name|long
literal|0
name|_boothowto
operator|:
operator|.
name|long
literal|0
name|_bootdev
operator|:
operator|.
name|long
literal|0
end_expr_stmt

end_unit

