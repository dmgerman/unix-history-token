begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_decl_stmt
specifier|static
name|char
modifier|*
name|sccsid
init|=
literal|"@(#)tc.c	4.2 (Berkeley) 7/6/81"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Simulate typesetter on 4014 */
end_comment

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_define
define|#
directive|define
name|oput
parameter_list|(
name|c
parameter_list|)
value|if (pgskip==0) putchar(c); else (c);
end_define

begin_define
define|#
directive|define
name|MAXY
value|3071
end_define

begin_define
define|#
directive|define
name|US
value|037
end_define

begin_define
define|#
directive|define
name|GS
value|035
end_define

begin_define
define|#
directive|define
name|ESC
value|033
end_define

begin_define
define|#
directive|define
name|FF
value|014
end_define

begin_define
define|#
directive|define
name|DBL
value|0200
end_define

begin_decl_stmt
name|int
name|pl
init|=
literal|11
operator|*
literal|144
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|mpy
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|div
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|ap
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ch
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nonumb
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|psize
init|=
literal|10
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|dfact
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|esc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|escd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|verd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|esct
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|osize
init|=
literal|02
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|size
init|=
literal|02
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|rx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|xx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|yy
init|=
name|MAXY
operator|+
literal|62
operator|+
literal|48
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|leadtot
init|=
operator|-
literal|31
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ohy
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ohx
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|oxb
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|oly
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|olx
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|tflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|railmag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|lead
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|skip
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|pgskip
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ksize
init|=
literal|';'
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|mcase
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|stab
index|[]
init|=
block|{
literal|010
block|,
literal|0
block|,
literal|01
block|,
literal|07
block|,
literal|02
block|,
literal|03
block|,
literal|04
block|,
literal|05
block|,
literal|0211
block|,
literal|06
block|,
literal|0212
block|,
literal|0213
block|,
literal|0214
block|,
literal|0215
block|,
literal|0216
block|,
literal|0217
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|rtab
index|[]
init|=
block|{
literal|6
block|,
literal|7
block|,
literal|8
block|,
literal|9
block|,
literal|10
block|,
literal|11
block|,
literal|12
block|,
literal|14
block|,
literal|16
block|,
literal|18
block|,
literal|20
block|,
literal|22
block|,
literal|24
block|,
literal|28
block|,
literal|36
block|,
literal|18
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ktab
index|[]
init|=
block|{
literal|';'
block|,
literal|';'
block|,
literal|';'
block|,
literal|';'
block|,
literal|';'
block|,
literal|';'
block|,
literal|':'
block|,
literal|':'
block|,
literal|'9'
block|,
literal|'9'
block|,
literal|'9'
block|,
literal|'9'
block|,
literal|'8'
block|,
literal|'8'
block|,
literal|'8'
block|,
literal|'9'
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|first
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|alpha
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|asctab
index|[
literal|128
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|spectab
index|[
literal|128
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|erase
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_function_decl
name|int
function_decl|(
modifier|*
name|sigint
function_decl|)
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|int
function_decl|(
modifier|*
name|sigquit
function_decl|)
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
specifier|register
name|i
operator|,
name|j
expr_stmt|;
specifier|register
name|char
modifier|*
name|k
decl_stmt|;
extern|extern ex(
block|)
function|;
end_function

begin_while
while|while
condition|(
operator|(
operator|--
name|argc
operator|>
literal|0
operator|)
operator|&&
operator|(
operator|(
operator|++
name|argv
operator|)
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|==
literal|'-'
operator|)
condition|)
block|{
switch|switch
condition|(
name|argv
index|[
literal|0
index|]
index|[
literal|1
index|]
condition|)
block|{
case|case
literal|'p'
case|:
name|ap
operator|=
operator|&
name|argv
index|[
literal|0
index|]
index|[
literal|2
index|]
expr_stmt|;
name|dfact
operator|=
literal|72
expr_stmt|;
if|if
condition|(
name|i
operator|=
name|atoi
argument_list|()
condition|)
name|pl
operator|=
name|i
operator|/
literal|3
expr_stmt|;
continue|continue;
case|case
literal|'t'
case|:
name|tflag
operator|++
expr_stmt|;
continue|continue;
case|case
literal|'s'
case|:
name|ap
operator|=
operator|&
name|argv
index|[
literal|0
index|]
index|[
literal|2
index|]
expr_stmt|;
name|dfact
operator|=
literal|1
expr_stmt|;
name|pgskip
operator|=
name|atoi
argument_list|()
expr_stmt|;
continue|continue;
default|default:
name|dfact
operator|=
literal|1
expr_stmt|;
name|ap
operator|=
operator|&
name|argv
index|[
literal|0
index|]
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|i
operator|=
name|atoi
argument_list|()
condition|)
name|mpy
operator|=
name|i
expr_stmt|;
if|if
condition|(
name|i
operator|=
name|atoi
argument_list|()
condition|)
name|div
operator|=
name|i
expr_stmt|;
continue|continue;
block|}
block|}
end_while

begin_if
if|if
condition|(
name|argc
condition|)
block|{
if|if
condition|(
name|freopen
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"r"
argument_list|,
name|stdin
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"tc: cannot open %s\n"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_if

begin_expr_stmt
name|sigint
operator|=
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|ex
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|sigquit
operator|=
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
end_expr_stmt

begin_while
while|while
condition|(
operator|(
name|i
operator|=
name|getchar
argument_list|()
operator|)
operator|!=
name|EOF
condition|)
block|{
if|if
condition|(
operator|!
name|i
condition|)
continue|continue;
if|if
condition|(
name|i
operator|&
literal|0200
condition|)
block|{
name|esc
operator|+=
operator|(
operator|~
name|i
operator|)
operator|&
literal|0177
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|esc
condition|)
block|{
if|if
condition|(
name|escd
condition|)
name|esc
operator|=
operator|-
name|esc
expr_stmt|;
name|esct
operator|+=
name|esc
expr_stmt|;
name|xx
operator|+=
operator|(
name|esc
operator|*
name|mpy
operator|+
name|rx
operator|)
operator|/
name|div
expr_stmt|;
name|rx
operator|=
operator|(
name|esc
operator|*
name|mpy
operator|+
name|rx
operator|)
operator|%
name|div
expr_stmt|;
name|sendpt
argument_list|()
expr_stmt|;
name|esc
operator|=
literal|0
expr_stmt|;
block|}
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0100
case|:
comment|/*init*/
name|escd
operator|=
name|verd
operator|=
name|mcase
operator|=
name|railmag
operator|=
name|xx
operator|=
literal|0
expr_stmt|;
name|yy
operator|=
name|MAXY
operator|+
literal|48
expr_stmt|;
name|leadtot
operator|=
operator|-
literal|31
expr_stmt|;
name|ohy
operator|=
name|oxb
operator|=
name|oly
operator|=
name|ohx
operator|=
name|olx
operator|=
operator|-
literal|1
expr_stmt|;
name|oput
argument_list|(
name|US
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|first
operator|&&
operator|!
name|tflag
condition|)
name|kwait
argument_list|()
expr_stmt|;
if|if
condition|(
name|first
condition|)
block|{
name|first
operator|=
literal|0
expr_stmt|;
name|yy
operator|+=
literal|62
expr_stmt|;
block|}
name|init
argument_list|()
expr_stmt|;
continue|continue;
case|case
literal|0101
case|:
comment|/*lower rail*/
name|railmag
operator|&=
operator|~
literal|01
expr_stmt|;
continue|continue;
case|case
literal|0102
case|:
comment|/*upper rail*/
name|railmag
operator||=
literal|01
expr_stmt|;
continue|continue;
case|case
literal|0103
case|:
comment|/*upper mag*/
name|railmag
operator||=
literal|02
expr_stmt|;
continue|continue;
case|case
literal|0104
case|:
comment|/*lower mag*/
name|railmag
operator|&=
operator|~
literal|02
expr_stmt|;
continue|continue;
case|case
literal|0105
case|:
comment|/*lower case*/
name|mcase
operator|=
literal|0
expr_stmt|;
continue|continue;
case|case
literal|0106
case|:
comment|/*upper case*/
name|mcase
operator|=
literal|0100
expr_stmt|;
continue|continue;
case|case
literal|0107
case|:
comment|/*escape forward*/
name|escd
operator|=
literal|0
expr_stmt|;
continue|continue;
case|case
literal|0110
case|:
comment|/*escape backward*/
name|escd
operator|=
literal|1
expr_stmt|;
continue|continue;
case|case
literal|0111
case|:
comment|/*stop*/
continue|continue;
case|case
literal|0112
case|:
comment|/*lead forward*/
name|verd
operator|=
literal|0
expr_stmt|;
continue|continue;
case|case
literal|0113
case|:
comment|/*undefined*/
continue|continue;
case|case
literal|0114
case|:
comment|/*lead backward*/
name|verd
operator|=
literal|1
expr_stmt|;
continue|continue;
case|case
literal|0115
case|:
comment|/*undefined*/
case|case
literal|0116
case|:
case|case
literal|0117
case|:
continue|continue;
block|}
if|if
condition|(
operator|(
name|i
operator|&
literal|0340
operator|)
operator|==
literal|0140
condition|)
block|{
comment|/*leading*/
name|lead
operator|=
operator|(
operator|~
name|i
operator|)
operator|&
literal|037
expr_stmt|;
if|if
condition|(
name|verd
condition|)
name|lead
operator|=
operator|-
name|lead
expr_stmt|;
if|if
condition|(
operator|(
name|leadtot
operator|+=
name|lead
operator|)
operator|>
name|pl
condition|)
block|{
name|leadtot
operator|=
name|lead
expr_stmt|;
name|oput
argument_list|(
name|US
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tflag
condition|)
name|kwait
argument_list|()
expr_stmt|;
name|yy
operator|=
name|MAXY
expr_stmt|;
if|if
condition|(
name|pgskip
condition|)
operator|--
name|pgskip
expr_stmt|;
name|init
argument_list|()
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|skip
condition|)
continue|continue;
if|if
condition|(
operator|(
name|yy
operator|-=
operator|(
name|lead
operator|<<
literal|1
operator|)
operator|)
operator|<
literal|0
condition|)
block|{
name|skip
operator|++
expr_stmt|;
name|yy
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|sendpt
argument_list|()
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
operator|(
name|i
operator|&
literal|0360
operator|)
operator|==
literal|0120
condition|)
block|{
comment|/*size change*/
name|i
operator|&=
literal|017
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|i
operator|!=
operator|(
name|stab
index|[
name|j
index|]
operator|&
literal|017
operator|)
condition|;
name|j
operator|++
control|)
empty_stmt|;
name|osize
operator|=
name|size
expr_stmt|;
name|size
operator|=
name|stab
index|[
name|j
index|]
expr_stmt|;
name|psize
operator|=
name|rtab
index|[
name|j
index|]
expr_stmt|;
name|ksize
operator|=
name|ktab
index|[
name|j
index|]
expr_stmt|;
name|oput
argument_list|(
name|ESC
argument_list|)
expr_stmt|;
name|oput
argument_list|(
name|ksize
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|osize
operator|&
name|DBL
operator|)
operator|&&
operator|(
name|size
operator|&
name|DBL
operator|)
condition|)
name|i
operator|=
operator|-
literal|55
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|osize
operator|&
name|DBL
operator|)
operator|&&
operator|!
operator|(
name|size
operator|&
name|DBL
operator|)
condition|)
name|i
operator|=
literal|55
expr_stmt|;
if|if
condition|(
name|escd
condition|)
name|i
operator|=
operator|-
name|i
expr_stmt|;
name|esc
operator|+=
name|i
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|i
operator|&
literal|0300
condition|)
continue|continue;
name|i
operator|=
operator|(
name|i
operator|&
literal|077
operator|)
operator||
name|mcase
expr_stmt|;
if|if
condition|(
name|railmag
operator|!=
literal|03
condition|)
name|k
operator|=
name|asctab
index|[
name|i
index|]
expr_stmt|;
else|else
name|k
operator|=
name|spectab
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|alpha
condition|)
name|sendpt
argument_list|()
expr_stmt|;
if|if
condition|(
operator|*
name|k
operator|!=
literal|'\0'
condition|)
block|{
name|oput
argument_list|(
name|US
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|k
operator|&
literal|0377
condition|)
name|oput
argument_list|(
operator|*
name|k
operator|++
argument_list|)
expr_stmt|;
name|alpha
operator|++
expr_stmt|;
continue|continue;
block|}
else|else
block|{
if|if
condition|(
name|railmag
operator|!=
literal|03
condition|)
block|{
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0124
case|:
name|lig
argument_list|(
literal|"fi"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0125
case|:
name|lig
argument_list|(
literal|"fl"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0126
case|:
name|lig
argument_list|(
literal|"ff"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0130
case|:
name|lig
argument_list|(
literal|"ffl"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0131
case|:
name|lig
argument_list|(
literal|"ffi"
argument_list|)
expr_stmt|;
break|break;
default|default:
continue|continue;
block|}
block|}
continue|continue;
block|}
block|}
end_while

begin_expr_stmt
name|ex
argument_list|()
expr_stmt|;
end_expr_stmt

begin_expr_stmt
unit|} lig
operator|(
name|x
operator|)
name|char
operator|*
name|x
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|i
operator|,
name|j
expr_stmt|;
specifier|register
name|char
modifier|*
name|k
decl_stmt|;
name|j
operator|=
literal|0
expr_stmt|;
name|k
operator|=
name|x
expr_stmt|;
name|oput
argument_list|(
name|US
argument_list|)
expr_stmt|;
name|oput
argument_list|(
operator|*
name|k
operator|++
argument_list|)
expr_stmt|;
name|i
operator|=
name|psize
operator|*
literal|8
operator|*
name|mpy
operator|/
operator|(
name|div
operator|*
literal|6
operator|)
expr_stmt|;
comment|/* 8/36 em */
while|while
condition|(
operator|*
name|k
condition|)
block|{
name|xx
operator|+=
name|i
expr_stmt|;
name|j
operator|+=
name|i
expr_stmt|;
name|sendpt
argument_list|()
expr_stmt|;
name|oput
argument_list|(
name|US
argument_list|)
expr_stmt|;
name|oput
argument_list|(
operator|*
name|k
operator|++
argument_list|)
expr_stmt|;
block|}
name|xx
operator|-=
name|j
expr_stmt|;
name|sendpt
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|init
argument_list|()
end_macro

begin_block
block|{
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
name|erase
condition|)
block|{
name|oput
argument_list|(
name|ESC
argument_list|)
expr_stmt|;
name|oput
argument_list|(
name|FF
argument_list|)
expr_stmt|;
block|}
else|else
name|erase
operator|=
literal|1
expr_stmt|;
name|oput
argument_list|(
name|ESC
argument_list|)
expr_stmt|;
name|oput
argument_list|(
name|ksize
argument_list|)
expr_stmt|;
comment|/*delay about a second*/
comment|/* let the system do it... 	for(i = 960; i> 0; i--)oput(GS); */
name|skip
operator|=
literal|0
expr_stmt|;
name|sendpt
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|ex
argument_list|()
end_macro

begin_block
block|{
name|yy
operator|=
name|MAXY
expr_stmt|;
name|xx
operator|=
literal|0
expr_stmt|;
name|sendpt
argument_list|()
expr_stmt|;
name|oput
argument_list|(
name|ESC
argument_list|)
expr_stmt|;
name|oput
argument_list|(
literal|';'
argument_list|)
expr_stmt|;
name|oput
argument_list|(
name|US
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|kwait
argument_list|()
end_macro

begin_block
block|{
name|char
name|buf
index|[
literal|128
index|]
decl_stmt|;
name|char
modifier|*
name|bptr
decl_stmt|;
name|char
name|c
decl_stmt|;
if|if
condition|(
name|pgskip
condition|)
return|return;
name|next
label|:
name|bptr
operator|=
name|buf
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|readch
argument_list|()
operator|)
operator|&&
operator|(
name|c
operator|!=
literal|'\n'
operator|)
condition|)
operator|*
name|bptr
operator|++
operator|=
name|c
expr_stmt|;
operator|*
name|bptr
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|bptr
operator|!=
name|buf
condition|)
block|{
name|bptr
operator|=
name|buf
expr_stmt|;
if|if
condition|(
operator|*
name|bptr
operator|==
literal|'!'
condition|)
block|{
name|callunix
argument_list|(
operator|&
name|buf
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
literal|"!\n"
argument_list|,
name|stderr
argument_list|)
expr_stmt|;
goto|goto
name|next
goto|;
block|}
else|else
switch|switch
condition|(
operator|*
name|bptr
operator|++
condition|)
block|{
case|case
literal|'e'
case|:
name|erase
operator|=
literal|0
expr_stmt|;
goto|goto
name|next
goto|;
case|case
literal|'s'
case|:
name|ap
operator|=
operator|&
name|buf
index|[
literal|1
index|]
expr_stmt|;
name|dfact
operator|=
literal|1
expr_stmt|;
name|pgskip
operator|=
name|atoi
argument_list|()
operator|+
literal|1
expr_stmt|;
goto|goto
name|next
goto|;
default|default:
name|fputs
argument_list|(
literal|"?\n"
argument_list|,
name|stderr
argument_list|)
expr_stmt|;
goto|goto
name|next
goto|;
block|}
block|}
elseif|else
if|if
condition|(
name|c
operator|==
literal|0
condition|)
name|ex
argument_list|()
expr_stmt|;
else|else
return|return;
block|}
end_block

begin_macro
name|callunix
argument_list|(
argument|line
argument_list|)
end_macro

begin_decl_stmt
name|char
name|line
index|[]
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|rc
decl_stmt|,
name|status
decl_stmt|,
name|unixpid
decl_stmt|;
if|if
condition|(
operator|(
name|unixpid
operator|=
name|fork
argument_list|()
operator|)
operator|==
literal|0
condition|)
block|{
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|sigint
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|sigquit
argument_list|)
expr_stmt|;
name|close
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|dup
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|execl
argument_list|(
literal|"/bin/sh"
argument_list|,
literal|"-sh"
argument_list|,
literal|"-c"
argument_list|,
name|line
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|255
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|unixpid
operator|==
operator|-
literal|1
condition|)
return|return;
else|else
block|{
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|rc
operator|=
name|wait
argument_list|(
operator|&
name|status
argument_list|)
operator|)
operator|!=
name|unixpid
operator|&&
name|rc
operator|!=
operator|-
literal|1
condition|)
empty_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|ex
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|sigquit
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|readch
argument_list|()
end_macro

begin_block
block|{
name|char
name|c
decl_stmt|;
if|if
condition|(
name|read
argument_list|(
literal|2
argument_list|,
operator|&
name|c
argument_list|,
literal|1
argument_list|)
operator|<
literal|1
condition|)
name|c
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|c
operator|)
return|;
block|}
end_block

begin_macro
name|sendpt
argument_list|()
end_macro

begin_block
block|{
name|int
name|hy
decl_stmt|,
name|xb
decl_stmt|,
name|ly
decl_stmt|,
name|hx
decl_stmt|,
name|lx
decl_stmt|;
name|oput
argument_list|(
name|GS
argument_list|)
expr_stmt|;
name|hy
operator|=
operator|(
operator|(
name|yy
operator|>>
literal|7
operator|)
operator|&
literal|037
operator|)
expr_stmt|;
name|xb
operator|=
operator|(
operator|(
name|xx
operator|&
literal|03
operator|)
operator|+
operator|(
operator|(
name|yy
operator|<<
literal|2
operator|)
operator|&
literal|014
operator|)
operator|&
literal|017
operator|)
expr_stmt|;
name|ly
operator|=
operator|(
operator|(
name|yy
operator|>>
literal|2
operator|)
operator|&
literal|037
operator|)
expr_stmt|;
name|hx
operator|=
operator|(
operator|(
name|xx
operator|>>
literal|7
operator|)
operator|&
literal|037
operator|)
expr_stmt|;
name|lx
operator|=
operator|(
operator|(
name|xx
operator|>>
literal|2
operator|)
operator|&
literal|037
operator|)
expr_stmt|;
if|if
condition|(
name|hy
operator|!=
name|ohy
condition|)
name|oput
argument_list|(
name|hy
operator||
literal|040
argument_list|)
expr_stmt|;
if|if
condition|(
name|xb
operator|!=
name|oxb
condition|)
name|oput
argument_list|(
name|xb
operator||
literal|0140
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ly
operator|!=
name|oly
operator|)
operator|||
operator|(
name|hx
operator|!=
name|ohx
operator|)
operator|||
operator|(
name|xb
operator|!=
name|oxb
operator|)
condition|)
name|oput
argument_list|(
name|ly
operator||
literal|0140
argument_list|)
expr_stmt|;
if|if
condition|(
name|hx
operator|!=
name|ohx
condition|)
name|oput
argument_list|(
name|hx
operator||
literal|040
argument_list|)
expr_stmt|;
name|oput
argument_list|(
name|lx
operator||
literal|0100
argument_list|)
expr_stmt|;
name|ohy
operator|=
name|hy
expr_stmt|;
name|oxb
operator|=
name|xb
expr_stmt|;
name|oly
operator|=
name|ly
expr_stmt|;
name|ohx
operator|=
name|hx
expr_stmt|;
name|olx
operator|=
name|lx
expr_stmt|;
name|alpha
operator|=
literal|0
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|atoi
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|i
operator|,
name|j
operator|,
name|acc
expr_stmt|;
name|int
name|field
decl_stmt|,
name|digits
decl_stmt|;
name|long
name|dd
decl_stmt|;
name|long
name|tscale
parameter_list|()
function_decl|;
name|field
operator|=
name|digits
operator|=
name|acc
operator|=
literal|0
expr_stmt|;
name|a1
label|:
while|while
condition|(
operator|(
operator|(
name|j
operator|=
operator|(
name|i
operator|=
name|getch
argument_list|()
operator|)
operator|-
literal|'0'
operator|)
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|j
operator|<=
literal|9
operator|)
condition|)
block|{
name|field
operator|++
expr_stmt|;
name|digits
operator|++
expr_stmt|;
name|acc
operator|=
literal|10
operator|*
name|acc
operator|+
name|j
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|==
literal|'.'
condition|)
block|{
name|field
operator|++
expr_stmt|;
name|digits
operator|=
literal|0
expr_stmt|;
goto|goto
name|a1
goto|;
block|}
if|if
condition|(
operator|!
operator|(
name|ch
operator|=
name|i
operator|)
condition|)
name|ch
operator|=
literal|'x'
expr_stmt|;
name|dd
operator|=
name|tscale
argument_list|(
name|acc
argument_list|)
expr_stmt|;
name|acc
operator|=
name|dd
expr_stmt|;
if|if
condition|(
operator|(
name|field
operator|!=
name|digits
operator|)
operator|&&
operator|(
name|digits
operator|>
literal|0
operator|)
condition|)
block|{
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|digits
operator|--
condition|)
name|j
operator|*=
literal|10
expr_stmt|;
name|acc
operator|=
name|dd
operator|/
name|j
expr_stmt|;
block|}
name|nonumb
operator|=
operator|!
name|field
expr_stmt|;
name|ch
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|acc
operator|)
return|;
block|}
end_block

begin_function
name|long
name|tscale
parameter_list|(
name|n
parameter_list|)
name|int
name|n
decl_stmt|;
block|{
specifier|register
name|i
operator|,
name|j
expr_stmt|;
switch|switch
condition|(
name|i
operator|=
name|getch
argument_list|()
condition|)
block|{
case|case
literal|'u'
case|:
name|j
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'p'
case|:
comment|/*Points*/
name|j
operator|=
literal|6
expr_stmt|;
break|break;
case|case
literal|'i'
case|:
comment|/*Inches*/
name|j
operator|=
literal|432
expr_stmt|;
break|break;
case|case
literal|'c'
case|:
comment|/*Centimeters; should be 170.0787*/
name|j
operator|=
literal|170
expr_stmt|;
break|break;
case|case
literal|'P'
case|:
comment|/*Picas*/
name|j
operator|=
literal|72
expr_stmt|;
break|break;
default|default:
name|j
operator|=
name|dfact
expr_stmt|;
name|ch
operator|=
name|i
expr_stmt|;
block|}
return|return
operator|(
operator|(
name|long
operator|)
name|n
operator|*
name|j
operator|)
return|;
block|}
end_function

begin_macro
name|getch
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|i
expr_stmt|;
if|if
condition|(
name|ch
condition|)
block|{
name|i
operator|=
name|ch
expr_stmt|;
name|ch
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|i
operator|)
return|;
block|}
return|return
operator|(
operator|*
name|ap
operator|++
operator|)
return|;
block|}
end_block

begin_decl_stmt
name|char
modifier|*
name|asctab
index|[
literal|128
index|]
init|=
block|{
literal|"\0"
block|,
comment|/*blank*/
literal|"h"
block|,
comment|/*h*/
literal|"t"
block|,
comment|/*t*/
literal|"n"
block|,
comment|/*n*/
literal|"m"
block|,
comment|/*m*/
literal|"l"
block|,
comment|/*l*/
literal|"i"
block|,
comment|/*i*/
literal|"z"
block|,
comment|/*z*/
literal|"s"
block|,
comment|/*s*/
literal|"d"
block|,
comment|/*d*/
literal|"b"
block|,
comment|/*b*/
literal|"x"
block|,
comment|/*x*/
literal|"f"
block|,
comment|/*f*/
literal|"j"
block|,
comment|/*j*/
literal|"u"
block|,
comment|/*u*/
literal|"k"
block|,
comment|/*k*/
literal|"\0"
block|,
comment|/*blank*/
literal|"p"
block|,
comment|/*p*/
literal|"-"
block|,
comment|/*_ 3/4 em dash*/
literal|";"
block|,
comment|/*;*/
literal|"\0"
block|,
comment|/*blank*/
literal|"a"
block|,
comment|/*a*/
literal|"_"
block|,
comment|/*rule*/
literal|"c"
block|,
comment|/*c*/
literal|"`"
block|,
comment|/*` open*/
literal|"e"
block|,
comment|/*e*/
literal|"\'"
block|,
comment|/*' close*/
literal|"o"
block|,
comment|/*o*/
literal|"\0"
block|,
comment|/*1/4*/
literal|"r"
block|,
comment|/*r*/
literal|"\0"
block|,
comment|/*1/2*/
literal|"v"
block|,
comment|/*v*/
literal|"-"
block|,
comment|/*- hyphen*/
literal|"w"
block|,
comment|/*w*/
literal|"q"
block|,
comment|/*q*/
literal|"/"
block|,
comment|/*/*/
literal|"."
block|,
comment|/*.*/
literal|"g"
block|,
comment|/*g*/
literal|"\0"
block|,
comment|/*3/4*/
literal|","
block|,
comment|/*,*/
literal|"&"
block|,
comment|/*&*/
literal|"y"
block|,
comment|/*y*/
literal|"\0"
block|,
comment|/*blank*/
literal|"%"
block|,
comment|/*%*/
literal|"\0"
block|,
comment|/*blank*/
literal|"Q"
block|,
comment|/*Q*/
literal|"T"
block|,
comment|/*T*/
literal|"O"
block|,
comment|/*O*/
literal|"H"
block|,
comment|/*H*/
literal|"N"
block|,
comment|/*N*/
literal|"M"
block|,
comment|/*M*/
literal|"L"
block|,
comment|/*L*/
literal|"R"
block|,
comment|/*R*/
literal|"G"
block|,
comment|/*G*/
literal|"I"
block|,
comment|/*I*/
literal|"P"
block|,
comment|/*P*/
literal|"C"
block|,
comment|/*C*/
literal|"V"
block|,
comment|/*V*/
literal|"E"
block|,
comment|/*E*/
literal|"Z"
block|,
comment|/*Z*/
literal|"D"
block|,
comment|/*D*/
literal|"B"
block|,
comment|/*B*/
literal|"S"
block|,
comment|/*S*/
literal|"Y"
block|,
comment|/*Y*/
literal|"\0"
block|,
comment|/*blank*/
literal|"F"
block|,
comment|/*F*/
literal|"X"
block|,
comment|/*X*/
literal|"A"
block|,
comment|/*A*/
literal|"W"
block|,
comment|/*W*/
literal|"J"
block|,
comment|/*J*/
literal|"U"
block|,
comment|/*U*/
literal|"K"
block|,
comment|/*K*/
literal|"0"
block|,
comment|/*0*/
literal|"1"
block|,
comment|/*1*/
literal|"2"
block|,
comment|/*2*/
literal|"3"
block|,
comment|/*3*/
literal|"4"
block|,
comment|/*4*/
literal|"5"
block|,
comment|/*5*/
literal|"6"
block|,
comment|/*6*/
literal|"7"
block|,
comment|/*7*/
literal|"8"
block|,
comment|/*8*/
literal|"9"
block|,
comment|/*9*/
literal|"*"
block|,
comment|/***/
literal|"-"
block|,
comment|/*minus*/
literal|""
block|,
comment|/*fi*/
literal|""
block|,
comment|/*fl*/
literal|""
block|,
comment|/*ff*/
literal|"\033\016Z\bM\033\017"
block|,
comment|/*cent sign*/
literal|""
block|,
comment|/*ffl*/
literal|""
block|,
comment|/*ffi*/
literal|"("
block|,
comment|/*(*/
literal|")"
block|,
comment|/*)*/
literal|"["
block|,
comment|/*[*/
literal|"]"
block|,
comment|/*]*/
literal|"\033\016J\033\017"
block|,
comment|/*degree*/
literal|"\033\016M\b_\033\017"
block|,
comment|/*dagger*/
literal|"="
block|,
comment|/*=*/
literal|"\033\016O\b&\033\017"
block|,
comment|/*registered*/
literal|":"
block|,
comment|/*:*/
literal|"+"
block|,
comment|/*+*/
literal|"\0"
block|,
comment|/*blank*/
literal|"!"
block|,
comment|/*!*/
literal|"\033\016O\b~\033\017"
block|,
comment|/*bullet*/
literal|"?"
block|,
comment|/*?*/
literal|"\'"
block|,
comment|/*foot mark*/
literal|"|"
block|,
comment|/*|*/
literal|"\0"
block|,
comment|/*blank*/
literal|"\033\016O\b#\033\017"
block|,
comment|/*copyright*/
literal|"\033\016L\033\017"
block|,
comment|/*square*/
literal|"$"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*$*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|spectab
index|[
literal|128
index|]
init|=
block|{
literal|"\0"
block|,
comment|/*blank*/
literal|"\033\016(\bM\033\017"
block|,
comment|/*psi*/
literal|"\033\016o\b_\033\017"
block|,
comment|/*theta*/
literal|"v\b)"
block|,
comment|/*nu*/
literal|"\033\016V\b,\033\017"
block|,
comment|/*mu*/
literal|"\033\016)\b?\033\017"
block|,
comment|/*lambda*/
literal|"\033\016I\033\017"
block|,
comment|/*iota*/
literal|"S\b\033\016Z\033\017"
block|,
comment|/*zeta*/
literal|"o\b\'"
block|,
comment|/*sigma*/
literal|"o\b\033\0165\033\017"
block|,
comment|/*delta*/
literal|"\033\016b\033\017"
block|,
comment|/*beta*/
literal|"\033\016e\bc\033\017"
block|,
comment|/*xi*/
literal|"j\b\033\016C\033\017"
block|,
comment|/*eta*/
literal|"\033\016O\bM\033\017"
block|,
comment|/*phi*/
literal|"\033\016(\033\017"
block|,
comment|/*upsilon*/
literal|"\033\016k\033\017"
block|,
comment|/*kappa*/
literal|"\0"
block|,
comment|/*blank*/
literal|"T\b\033\016S\033\017"
block|,
comment|/*pi*/
literal|"@"
block|,
comment|/*at-sign*/
literal|"\033\016U\033\017"
block|,
comment|/*down arrow*/
literal|"\0"
block|,
comment|/*blank*/
literal|"\033\016A\033\017"
block|,
comment|/*alpha*/
literal|"|"
block|,
comment|/*or*/
literal|"l\b/"
block|,
comment|/*chi*/
literal|"\""
block|,
comment|/*"*/
literal|"\033\016E\033\017"
block|,
comment|/*epsilon*/
literal|"="
block|,
comment|/*=*/
literal|"\033\016O\033\017"
block|,
comment|/*omicron*/
literal|"\033\016[\033\017"
block|,
comment|/*left arrow*/
literal|"\033\016R\033\017"
block|,
comment|/*rho*/
literal|"\033\016Y\033\017"
block|,
comment|/*up arrow*/
literal|"\033\016N\033\017"
block|,
comment|/*tau*/
literal|"_"
block|,
comment|/*underrule*/
literal|"\\"
block|,
comment|/*\*/
literal|"I\b\033\016(\033\017"
block|,
comment|/*Psi*/
literal|"\033\016O\bJ\033\017"
block|,
comment|/*bell system sign*/
literal|"\033\016W\bX\033\017"
block|,
comment|/*infinity*/
literal|"`\b/"
block|,
comment|/*gamma*/
literal|"\033\016X\bF\033\017"
block|,
comment|/*improper superset*/
literal|"\033\016A\033\017"
block|,
comment|/*proportional to*/
literal|"\033\016\\\b]\033\017"
block|,
comment|/*right hand*/
literal|"\033\016W\033\017"
block|,
comment|/*omega*/
literal|"\0"
block|,
comment|/*blank*/
literal|"\033\016G\033\017"
block|,
comment|/*gradient*/
literal|"\0"
block|,
comment|/*blank*/
literal|"I\033\016\bO\033\017"
block|,
comment|/*Phi*/
literal|"O\b="
block|,
comment|/*Theta*/
literal|"O\b_"
block|,
comment|/*Omega*/
literal|"\033\016V\033\017"
block|,
comment|/*cup (union)*/
literal|"\033\016@\033\017"
block|,
comment|/*root en*/
literal|"s"
block|,
comment|/*terminal sigma*/
literal|"\033\016)\bK\033\017"
block|,
comment|/*Lambda*/
literal|"-"
block|,
comment|/*minus*/
literal|"\033\016S\bK\033\017"
block|,
comment|/*Gamma*/
literal|"\033\016i\033\017"
block|,
comment|/*integral sign*/
literal|"\033\016t\b'\033\017"
block|,
comment|/*Pi*/
literal|"\033\016Z\033\017"
block|,
comment|/*subset of*/
literal|"\033\016X\033\017"
block|,
comment|/*superset of*/
literal|"\033\016T\033\017"
block|,
comment|/*approximates*/
literal|"o\b`"
block|,
comment|/*partial derivative*/
literal|"\033\016H\033\017"
block|,
comment|/*Delta*/
literal|"\033\016I\b'\033\017"
block|,
comment|/*square root*/
literal|">\b\033\016F\b@\033\017"
block|,
comment|/*Sigma*/
literal|"\033\016T\bF\033\017"
block|,
comment|/*approx =*/
literal|"\0"
block|,
comment|/*blank*/
literal|">"
block|,
comment|/*>*/
literal|"\033\016_\bF\b@\033\017"
block|,
comment|/*Xi*/
literal|"<"
block|,
comment|/*<*/
literal|"/"
block|,
comment|/*slash (longer)*/
literal|"\033\016C\033\017"
block|,
comment|/*cap (intersection)*/
literal|"\033\016y\033\017"
block|,
comment|/*Upsilon*/
literal|"\033\016|\033\017"
block|,
comment|/*not*/
literal|"|"
block|,
comment|/*right ceiling (rt of ")*/
literal|"|"
block|,
comment|/*left top (of big curly)*/
literal|"|"
block|,
comment|/*bold vertical*/
literal|"|"
block|,
comment|/*left center of big curly bracket*/
literal|"|"
block|,
comment|/*left bottom*/
literal|"|"
block|,
comment|/*right top*/
literal|"|"
block|,
comment|/*right center of big curly bracket*/
literal|"|"
block|,
comment|/*right bot*/
literal|"|"
block|,
comment|/*right floor (rb of ")*/
literal|"|"
block|,
comment|/*left floor (left bot of big sq bract)*/
literal|"|"
block|,
comment|/*left ceiling (lt of ")*/
literal|"\033\016=\033\017"
block|,
comment|/*multiply*/
literal|"\033\016+\033\017"
block|,
comment|/*divide*/
literal|"+\b_"
block|,
comment|/*plus-minus*/
literal|"\033\016$\033\017"
block|,
comment|/*<=*/
literal|"\033\016^\033\017"
block|,
comment|/*>=*/
literal|"=\b_"
block|,
comment|/*identically equal*/
literal|"\033\016*\033\017"
block|,
comment|/*not equal*/
literal|"{"
block|,
comment|/*{*/
literal|"}"
block|,
comment|/*}*/
literal|"\'"
block|,
comment|/*' acute accent*/
literal|"`"
block|,
comment|/*` grave accent*/
literal|"^"
block|,
comment|/*^*/
literal|"#"
block|,
comment|/*sharp*/
literal|"\033\016|\b[\033\017"
block|,
comment|/*left hand*/
literal|"\033\016c\b_\033\017"
block|,
comment|/*member of*/
literal|"~"
block|,
comment|/*~*/
literal|"\033\016O\b/\033\017"
block|,
comment|/*empty set*/
literal|"\0"
block|,
comment|/*blank*/
literal|"\033\016%\bM\033\017"
block|,
comment|/*dbl dagger*/
literal|"|"
block|,
comment|/*box rule*/
literal|"*"
block|,
comment|/*asterisk*/
literal|"\033\016Z\bF\033\017"
block|,
comment|/*improper subset*/
literal|"\033\016O\033\017"
block|,
comment|/*circle*/
literal|"\0"
block|,
comment|/*blank*/
literal|"+"
block|,
comment|/*eqn plus*/
literal|"\033\016]\033\017"
block|,
comment|/*right arrow*/
literal|"g\b\033\016C\033\017"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*section mark*/
end_comment

end_unit

