begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"defs"
end_include

begin_decl_stmt
name|char
modifier|*
name|ops
index|[ ]
init|=
block|{
literal|""
block|,
literal|"+"
block|,
literal|"-"
block|,
literal|"*"
block|,
literal|"/"
block|,
literal|"**"
block|,
literal|".not. "
block|,
literal|" .and. "
block|,
literal|".andand."
block|,
literal|".oror."
block|,
literal|" .or. "
block|,
literal|" .eq. "
block|,
literal|" .lt. "
block|,
literal|" .gt. "
block|,
literal|" .le. "
block|,
literal|" .ge. "
block|,
literal|" .ne. "
block|,
literal|"("
block|,
literal|")"
block|,
literal|" = "
block|,
literal|", "
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|opprecs
index|[ ]
init|=
block|{
literal|0
block|,
literal|7
block|,
literal|7
block|,
literal|8
block|,
literal|8
block|,
literal|9
block|,
literal|5
block|,
literal|4
block|,
literal|4
block|,
literal|3
block|,
literal|3
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|10
block|,
literal|10
block|,
literal|1
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|qualops
index|[ ]
init|=
block|{
literal|""
block|,
literal|"->"
block|,
literal|"."
block|,
literal|" of "
block|,
literal|" sub "
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|classes
index|[ ]
init|=
block|{
literal|""
block|,
literal|"arg "
block|,
literal|"valarg "
block|,
literal|"static "
block|,
literal|"auto "
block|,
literal|"common "
block|,
literal|"mos "
block|,
literal|"external "
block|,
literal|"statement function "
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|precs
index|[ ]
init|=
block|{
literal|""
block|,
literal|"long "
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|types
index|[ ]
init|=
block|{
literal|""
block|,
literal|"integer "
block|,
literal|"real "
block|,
literal|"double precision "
block|,
literal|"logical "
block|,
literal|"complex "
block|,
literal|"char "
block|,
literal|"type "
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|ftntypes
index|[]
init|=
block|{
literal|"integer "
block|,
literal|"real "
block|,
literal|"logical "
block|,
literal|"complex "
block|,
literal|"double precision "
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|langs
index|[]
init|=
block|{
literal|"pfort"
block|,
literal|"ratfor"
block|,
literal|"efl"
block|}
decl_stmt|;
end_decl_stmt

begin_macro
name|propts
argument_list|()
end_macro

begin_block
block|{
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"Options: "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"%s "
argument_list|,
name|langs
index|[
name|langopt
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"%s "
argument_list|,
operator|(
name|dbgopt
condition|?
literal|"debug"
else|:
literal|"ndebug"
operator|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"%s "
argument_list|,
operator|(
name|dotsopt
condition|?
literal|"dotson"
else|:
literal|"dotsoff"
operator|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|prexpr
argument_list|(
argument|e
argument_list|)
end_macro

begin_decl_stmt
name|ptr
name|e
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|e
condition|)
name|prexp1
argument_list|(
name|e
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_escape
end_escape

begin_expr_stmt
name|prexp1
argument_list|(
name|e
argument_list|,
name|prec
argument_list|,
name|subt
argument_list|,
name|leftside
argument_list|)
specifier|register
name|ptr
name|e
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|prec
decl_stmt|,
name|subt
decl_stmt|,
name|leftside
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|ptr
name|p
decl_stmt|,
name|q
decl_stmt|;
name|int
name|prec1
decl_stmt|,
name|needpar
decl_stmt|;
name|needpar
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|e
operator|->
name|tag
condition|)
block|{
case|case
name|TERROR
case|:
break|break;
case|case
name|TCONST
case|:
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"%s"
argument_list|,
name|e
operator|->
name|leftp
argument_list|)
decl_stmt|;
if|if
condition|(
name|e
operator|->
name|rightp
condition|)
name|putzcon
argument_list|(
name|e
argument_list|)
expr_stmt|;
else|else
name|putconst
argument_list|(
name|e
operator|->
name|vtype
argument_list|,
name|e
operator|->
name|leftp
argument_list|)
expr_stmt|;
break|break;
case|case
name|TFTNBLOCK
case|:
name|putname
argument_list|(
name|e
argument_list|)
expr_stmt|;
break|break;
case|case
name|TNAME
case|:
if|if
condition|(
name|e
operator|->
name|sthead
operator|==
literal|0
condition|)
name|fatal
argument_list|(
literal|"name without entry"
argument_list|)
expr_stmt|;
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"%s"
argument_list|,
name|e
operator|->
name|sthead
operator|->
name|namep
argument_list|)
decl_stmt|;
name|putname
argument_list|(
name|e
argument_list|)
expr_stmt|;
if|if
condition|(
name|e
operator|->
name|vsubs
condition|)
name|prexp1
argument_list|(
name|e
operator|->
name|vsubs
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|TTEMP
case|:
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"(fakename %o)"
argument_list|,
name|e
argument_list|)
decl_stmt|;
name|putname
argument_list|(
name|e
argument_list|)
expr_stmt|;
break|break;
case|case
name|TLIST
case|:
if|if
condition|(
name|e
operator|->
name|leftp
operator|==
literal|0
condition|)
break|break;
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"( "
argument_list|)
decl_stmt|;
name|putic
argument_list|(
name|ICOP
argument_list|,
name|OPLPAR
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|e
operator|->
name|leftp
init|;
name|p
operator|!=
literal|0
condition|;
name|p
operator|=
name|p
operator|->
name|nextp
control|)
block|{
name|prexp1
argument_list|(
name|p
operator|->
name|datap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|->
name|nextp
condition|)
block|{
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|" , "
argument_list|)
decl_stmt|;
name|putic
argument_list|(
name|ICOP
argument_list|,
name|OPCOMMA
argument_list|)
expr_stmt|;
block|}
block|}
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|" )"
argument_list|)
decl_stmt|;
name|putic
argument_list|(
name|ICOP
argument_list|,
name|OPRPAR
argument_list|)
expr_stmt|;
break|break;
case|case
name|TSTFUNCT
case|:
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"statement function "
argument_list|)
expr_stmt|;
name|prexp1
argument_list|(
name|e
operator|->
name|leftp
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|" = "
argument_list|)
decl_stmt|;
name|putic
argument_list|(
name|ICOP
argument_list|,
name|OPEQUALS
argument_list|)
expr_stmt|;
name|prexp1
argument_list|(
name|e
operator|->
name|rightp
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|TAROP
case|:
if|if
condition|(
name|e
operator|->
name|subtype
operator|==
name|OPSTAR
operator|&&
name|e
operator|->
name|leftp
operator|->
name|tag
operator|!=
name|TCONST
operator|&&
name|e
operator|->
name|rightp
operator|->
name|tag
operator|==
name|TCONST
condition|)
block|{
name|q
operator|=
name|e
operator|->
name|leftp
expr_stmt|;
name|e
operator|->
name|leftp
operator|=
name|e
operator|->
name|rightp
expr_stmt|;
name|e
operator|->
name|rightp
operator|=
name|q
expr_stmt|;
block|}
case|case
name|TLOGOP
case|:
name|prec1
operator|=
name|opprecs
index|[
name|e
operator|->
name|subtype
index|]
expr_stmt|;
goto|goto
name|print
goto|;
case|case
name|TNOTOP
case|:
name|prec1
operator|=
literal|5
expr_stmt|;
if|if
condition|(
name|prec
operator|>
literal|1
condition|)
comment|/* force parens */
name|needpar
operator|=
literal|1
expr_stmt|;
goto|goto
name|print
goto|;
case|case
name|TNEGOP
case|:
if|if
condition|(
name|prec
operator|>
literal|1
condition|)
comment|/* force parens */
name|needpar
operator|=
literal|1
expr_stmt|;
name|prec1
operator|=
literal|8
expr_stmt|;
goto|goto
name|print
goto|;
case|case
name|TASGNOP
case|:
name|prec1
operator|=
literal|1
expr_stmt|;
goto|goto
name|print
goto|;
case|case
name|TRELOP
case|:
name|prec1
operator|=
literal|6
expr_stmt|;
goto|goto
name|print
goto|;
case|case
name|TCALL
case|:
name|prec1
operator|=
literal|10
expr_stmt|;
goto|goto
name|print
goto|;
case|case
name|TREPOP
case|:
name|prec1
operator|=
literal|2
expr_stmt|;
goto|goto
name|print
goto|;
name|print
label|:
if|if
condition|(
name|prec1
operator|<
name|prec
condition|)
name|needpar
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|prec1
operator|==
name|prec
condition|)
if|if
condition|(
name|e
operator|->
name|needpar
condition|)
name|needpar
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|subt
operator|==
name|e
operator|->
name|subtype
condition|)
name|needpar
operator||=
operator|!
operator|(
name|e
operator|->
name|tag
operator|==
name|TLOGOP
operator|||
name|leftside
operator|||
name|subt
operator|==
literal|0
operator|||
name|subt
operator|==
name|OPPLUS
operator|||
name|subt
operator|==
name|OPSTAR
operator|)
expr_stmt|;
else|else
name|needpar
operator||=
operator|!
operator|(
name|leftside
operator|||
name|subt
operator|==
name|OPPLUS
operator|||
name|subt
operator|==
name|OPSTAR
operator|)
expr_stmt|;
if|if
condition|(
name|needpar
condition|)
block|{
name|putic
argument_list|(
name|ICOP
argument_list|,
name|OPLPAR
argument_list|)
expr_stmt|;
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"("
argument_list|)
decl_stmt|;
block|}
if|if
condition|(
name|e
operator|->
name|rightp
operator|!=
literal|0
condition|)
block|{
name|prexp1
argument_list|(
name|e
operator|->
name|leftp
argument_list|,
name|prec1
argument_list|,
name|e
operator|->
name|subtype
argument_list|,
literal|1
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|e
operator|->
name|tag
condition|)
block|{
case|case
name|TASGNOP
case|:
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"="
argument_list|)
decl_stmt|;
name|putic
argument_list|(
name|ICOP
argument_list|,
name|OPEQUALS
argument_list|)
expr_stmt|;
if|if
condition|(
name|e
operator|->
name|subtype
operator|!=
literal|0
condition|)
name|prexp1
argument_list|(
name|e
operator|->
name|leftp
argument_list|,
name|prec1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
case|case
name|TAROP
case|:
case|case
name|TNEGOP
case|:
case|case
name|TLOGOP
case|:
case|case
name|TNOTOP
case|:
case|case
name|TRELOP
case|:
if|if
condition|(
name|e
operator|->
name|subtype
condition|)
block|{
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|" %s "
argument_list|,
name|ops
index|[
name|e
operator|->
name|subtype
index|]
argument_list|)
decl_stmt|;
name|putic
argument_list|(
name|ICOP
argument_list|,
name|e
operator|->
name|subtype
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|TCALL
case|:
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|" %s "
argument_list|,
name|qualops
index|[
name|e
operator|->
name|subtype
index|]
argument_list|)
decl_stmt|;
break|break;
case|case
name|TREPOP
case|:
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|"$"
argument_list|)
decl_stmt|;
break|break;
block|}
name|prexp1
argument_list|(
name|e
operator|->
name|rightp
argument_list|,
name|prec1
argument_list|,
name|e
operator|->
name|subtype
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* e->rightp == 0 */
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|" %s  "
argument_list|,
name|ops
index|[
name|e
operator|->
name|subtype
index|]
argument_list|)
decl_stmt|;
name|putic
argument_list|(
name|ICOP
argument_list|,
name|e
operator|->
name|subtype
argument_list|)
expr_stmt|;
name|prexp1
argument_list|(
name|e
operator|->
name|leftp
argument_list|,
name|prec1
argument_list|,
name|e
operator|->
name|subtype
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|needpar
condition|)
block|{
name|putic
argument_list|(
name|ICOP
argument_list|,
name|OPRPAR
argument_list|)
expr_stmt|;
name|TEST
name|fprintf
argument_list|(
name|diagfile
argument_list|,
literal|")"
argument_list|)
decl_stmt|;
block|}
break|break;
default|default:
name|badtag
argument_list|(
literal|"prexp1"
argument_list|,
name|e
operator|->
name|tag
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_block

end_unit

