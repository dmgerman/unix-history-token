begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)dc.c	4.5	(Berkeley)	9/28/87"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|not lint
end_endif

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|"dc.h"
end_include

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|init
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|)
expr_stmt|;
name|commnds
argument_list|()
expr_stmt|;
block|}
end_function

begin_macro
name|commnds
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|c
decl_stmt|;
specifier|register
name|struct
name|blk
modifier|*
name|p
decl_stmt|,
modifier|*
name|q
decl_stmt|;
name|long
name|l
decl_stmt|;
name|int
name|sign
decl_stmt|;
name|struct
name|blk
modifier|*
modifier|*
name|ptr
decl_stmt|,
modifier|*
name|s
decl_stmt|,
modifier|*
name|t
decl_stmt|;
name|struct
name|sym
modifier|*
name|sp
decl_stmt|;
name|int
name|sk
decl_stmt|,
name|sk1
decl_stmt|,
name|sk2
decl_stmt|;
name|int
name|n
decl_stmt|,
name|d
decl_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
operator|(
operator|(
name|c
operator|=
name|readc
argument_list|()
operator|)
operator|>=
literal|'0'
operator|&&
name|c
operator|<=
literal|'9'
operator|)
operator|||
operator|(
name|c
operator|>=
literal|'A'
operator|&&
name|c
operator|<=
literal|'F'
operator|)
operator|||
name|c
operator|==
literal|'.'
condition|)
block|{
name|unreadc
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|p
operator|=
name|readin
argument_list|()
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
block|}
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|' '
case|:
case|case
literal|'\n'
case|:
case|case
literal|0377
case|:
case|case
name|EOF
case|:
continue|continue;
case|case
literal|'Y'
case|:
name|sdump
argument_list|(
literal|"stk"
argument_list|,
operator|*
name|stkptr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"all %ld rel %ld headmor %ld\n"
argument_list|,
name|all
argument_list|,
name|rel
argument_list|,
name|headmor
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"nbytes %ld\n"
argument_list|,
name|nbytes
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'_'
case|:
name|p
operator|=
name|readin
argument_list|()
expr_stmt|;
name|savk
operator|=
name|sunputc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|chsign
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
name|savk
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'-'
case|:
name|subt
argument_list|()
expr_stmt|;
continue|continue;
case|case
literal|'+'
case|:
if|if
condition|(
name|eqk
argument_list|()
operator|!=
literal|0
condition|)
continue|continue;
name|binop
argument_list|(
literal|'+'
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'*'
case|:
name|arg1
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
name|arg2
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTYR
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
name|sk1
operator|=
name|sunputc
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
name|sk2
operator|=
name|sunputc
argument_list|(
name|arg2
argument_list|)
expr_stmt|;
name|binop
argument_list|(
literal|'*'
argument_list|)
expr_stmt|;
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|sunputc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|savk
operator|=
name|n
operator|=
name|sk1
operator|+
name|sk2
expr_stmt|;
if|if
condition|(
name|n
operator|>
name|k
operator|&&
name|n
operator|>
name|sk1
operator|&&
name|n
operator|>
name|sk2
condition|)
block|{
name|sk
operator|=
name|sk1
expr_stmt|;
if|if
condition|(
name|sk
operator|<
name|sk2
condition|)
name|sk
operator|=
name|sk2
expr_stmt|;
if|if
condition|(
name|sk
operator|<
name|k
condition|)
name|sk
operator|=
name|k
expr_stmt|;
name|p
operator|=
name|removc
argument_list|(
name|p
argument_list|,
name|n
operator|-
name|sk
argument_list|)
expr_stmt|;
name|savk
operator|=
name|sk
expr_stmt|;
block|}
name|sputc
argument_list|(
name|p
argument_list|,
name|savk
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'/'
case|:
name|casediv
label|:
if|if
condition|(
name|dscale
argument_list|()
operator|!=
literal|0
condition|)
continue|continue;
name|binop
argument_list|(
literal|'/'
argument_list|)
expr_stmt|;
if|if
condition|(
name|irem
operator|!=
literal|0
condition|)
name|release
argument_list|(
name|irem
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|rem
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'%'
case|:
if|if
condition|(
name|dscale
argument_list|()
operator|!=
literal|0
condition|)
continue|continue;
name|binop
argument_list|(
literal|'/'
argument_list|)
expr_stmt|;
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|irem
operator|==
literal|0
condition|)
block|{
name|sputc
argument_list|(
name|rem
argument_list|,
name|skr
operator|+
name|k
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|rem
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|p
operator|=
name|add0
argument_list|(
name|rem
argument_list|,
name|skd
operator|-
operator|(
name|skr
operator|+
name|k
operator|)
argument_list|)
expr_stmt|;
name|q
operator|=
name|add
argument_list|(
name|p
argument_list|,
name|irem
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|irem
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|q
argument_list|,
name|skd
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|q
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'v'
case|:
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
name|savk
operator|=
name|sunputc
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
block|{
name|sputc
argument_list|(
name|p
argument_list|,
name|savk
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
operator|(
name|c
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|error
argument_list|(
literal|"sqrt of neg number\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|k
operator|<
name|savk
condition|)
name|n
operator|=
name|savk
expr_stmt|;
else|else
block|{
name|n
operator|=
name|k
operator|*
literal|2
operator|-
name|savk
expr_stmt|;
name|savk
operator|=
name|k
expr_stmt|;
block|}
name|arg1
operator|=
name|add0
argument_list|(
name|p
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|arg2
operator|=
name|sqrt
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|arg2
argument_list|,
name|savk
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|arg2
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'^'
case|:
name|neg
operator|=
literal|0
expr_stmt|;
name|arg1
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
if|if
condition|(
name|sunputc
argument_list|(
name|arg1
argument_list|)
operator|!=
literal|0
condition|)
name|error
argument_list|(
literal|"exp not an integer\n"
argument_list|)
expr_stmt|;
name|arg2
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTYR
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfbeg
argument_list|(
name|arg1
argument_list|)
operator|==
literal|0
operator|&&
name|sbackc
argument_list|(
name|arg1
argument_list|)
operator|<
literal|0
condition|)
block|{
name|neg
operator|++
expr_stmt|;
name|chsign
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|length
argument_list|(
name|arg1
argument_list|)
operator|>=
literal|3
condition|)
block|{
name|error
argument_list|(
literal|"exp too big\n"
argument_list|)
expr_stmt|;
block|}
name|savk
operator|=
name|sunputc
argument_list|(
name|arg2
argument_list|)
expr_stmt|;
name|p
operator|=
name|exp
argument_list|(
name|arg2
argument_list|,
name|arg1
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|arg2
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
name|c
operator|=
name|sgetc
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfeof
argument_list|(
name|arg1
argument_list|)
operator|==
literal|0
condition|)
name|c
operator|=
name|sgetc
argument_list|(
name|arg1
argument_list|)
operator|*
literal|100
operator|+
name|c
expr_stmt|;
name|d
operator|=
name|c
operator|*
name|savk
expr_stmt|;
name|release
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
if|if
condition|(
name|neg
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|k
operator|>=
name|savk
condition|)
name|n
operator|=
name|k
expr_stmt|;
else|else
name|n
operator|=
name|savk
expr_stmt|;
if|if
condition|(
name|n
operator|<
name|d
condition|)
block|{
name|q
operator|=
name|removc
argument_list|(
name|p
argument_list|,
name|d
operator|-
name|n
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|q
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|q
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sputc
argument_list|(
name|p
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|sputc
argument_list|(
name|p
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|neg
operator|==
literal|0
condition|)
continue|continue;
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|q
operator|=
name|salloc
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|q
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|q
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
goto|goto
name|casediv
goto|;
case|case
literal|'z'
case|:
name|p
operator|=
name|salloc
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|n
operator|=
name|stkptr
operator|-
name|stkbeg
expr_stmt|;
if|if
condition|(
name|n
operator|>=
literal|100
condition|)
block|{
name|sputc
argument_list|(
name|p
argument_list|,
name|n
operator|/
literal|100
argument_list|)
expr_stmt|;
name|n
operator|%=
literal|100
expr_stmt|;
block|}
name|sputc
argument_list|(
name|p
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'Z'
case|:
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
name|n
operator|=
operator|(
name|length
argument_list|(
name|p
argument_list|)
operator|-
literal|1
operator|)
operator|<<
literal|1
expr_stmt|;
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfbeg
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|c
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|n
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|sfbeg
argument_list|(
name|p
argument_list|)
operator|==
literal|1
condition|)
name|n
operator|+=
literal|1
expr_stmt|;
else|else
block|{
if|if
condition|(
operator|(
name|c
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
operator|)
operator|==
literal|0
condition|)
name|n
operator|+=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|c
operator|>
literal|90
condition|)
name|n
operator|-=
literal|1
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|c
operator|<
literal|10
condition|)
name|n
operator|-=
literal|1
expr_stmt|;
block|}
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|q
operator|=
name|salloc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|>=
literal|100
condition|)
block|{
name|sputc
argument_list|(
name|q
argument_list|,
name|n
operator|%
literal|100
argument_list|)
expr_stmt|;
name|n
operator|/=
literal|100
expr_stmt|;
block|}
name|sputc
argument_list|(
name|q
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|q
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|q
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'i'
case|:
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
name|p
operator|=
name|scalint
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|inbas
argument_list|)
expr_stmt|;
name|inbas
operator|=
name|p
expr_stmt|;
continue|continue;
case|case
literal|'I'
case|:
name|p
operator|=
name|copy
argument_list|(
name|inbas
argument_list|,
name|length
argument_list|(
name|inbas
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'o'
case|:
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
name|p
operator|=
name|scalint
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|sign
operator|=
literal|0
expr_stmt|;
name|n
operator|=
name|length
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|q
operator|=
name|copy
argument_list|(
name|p
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|l
operator|=
name|c
operator|=
name|sbackc
argument_list|(
name|q
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|!=
literal|1
condition|)
block|{
if|if
condition|(
name|c
operator|<
literal|0
condition|)
block|{
name|sign
operator|=
literal|1
expr_stmt|;
name|chsign
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|n
operator|=
name|length
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|l
operator|=
name|c
operator|=
name|sbackc
argument_list|(
name|q
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|n
operator|!=
literal|1
condition|)
block|{
while|while
condition|(
name|sfbeg
argument_list|(
name|q
argument_list|)
operator|==
literal|0
condition|)
name|l
operator|=
name|l
operator|*
literal|100
operator|+
name|sbackc
argument_list|(
name|q
argument_list|)
expr_stmt|;
block|}
block|}
name|logo
operator|=
name|log2
argument_list|(
name|l
argument_list|)
expr_stmt|;
name|obase
operator|=
name|l
expr_stmt|;
name|release
argument_list|(
name|basptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|sign
operator|==
literal|1
condition|)
name|obase
operator|=
operator|-
name|l
expr_stmt|;
name|basptr
operator|=
name|p
expr_stmt|;
name|outdit
operator|=
name|bigot
expr_stmt|;
if|if
condition|(
name|n
operator|==
literal|1
operator|&&
name|sign
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|c
operator|<=
literal|16
condition|)
block|{
name|outdit
operator|=
name|hexot
expr_stmt|;
name|fw
operator|=
literal|1
expr_stmt|;
name|fw1
operator|=
literal|0
expr_stmt|;
name|ll
operator|=
literal|70
expr_stmt|;
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
name|n
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|sign
operator|==
literal|1
condition|)
name|n
operator|++
expr_stmt|;
name|p
operator|=
name|salloc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|t
operator|=
name|add
argument_list|(
name|p
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|n
operator|+=
name|length
argument_list|(
name|t
argument_list|)
operator|*
literal|2
expr_stmt|;
name|fsfile
argument_list|(
name|t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|sbackc
argument_list|(
name|t
argument_list|)
operator|)
operator|>
literal|9
condition|)
name|n
operator|++
expr_stmt|;
name|release
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|fw
operator|=
name|n
expr_stmt|;
name|fw1
operator|=
name|n
operator|-
literal|1
expr_stmt|;
name|ll
operator|=
literal|70
expr_stmt|;
if|if
condition|(
name|fw
operator|>=
name|ll
condition|)
continue|continue;
name|ll
operator|=
operator|(
literal|70
operator|/
name|fw
operator|)
operator|*
name|fw
expr_stmt|;
continue|continue;
case|case
literal|'O'
case|:
name|p
operator|=
name|copy
argument_list|(
name|basptr
argument_list|,
name|length
argument_list|(
name|basptr
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'['
case|:
name|n
operator|=
literal|0
expr_stmt|;
name|p
operator|=
name|salloc
argument_list|(
literal|0
argument_list|)
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
operator|(
name|c
operator|=
name|readc
argument_list|()
operator|)
operator|==
literal|']'
condition|)
block|{
if|if
condition|(
name|n
operator|==
literal|0
condition|)
break|break;
name|n
operator|--
expr_stmt|;
block|}
name|sputc
argument_list|(
name|p
argument_list|,
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'['
condition|)
name|n
operator|++
expr_stmt|;
block|}
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'k'
case|:
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
name|p
operator|=
name|scalint
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
argument_list|(
name|p
argument_list|)
operator|>
literal|1
condition|)
block|{
name|error
argument_list|(
literal|"scale too big\n"
argument_list|)
expr_stmt|;
block|}
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|k
operator|=
name|sfeof
argument_list|(
name|p
argument_list|)
condition|?
literal|0
else|:
name|sgetc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|scalptr
argument_list|)
expr_stmt|;
name|scalptr
operator|=
name|p
expr_stmt|;
continue|continue;
case|case
literal|'K'
case|:
name|p
operator|=
name|copy
argument_list|(
name|scalptr
argument_list|,
name|length
argument_list|(
name|scalptr
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'X'
case|:
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|n
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|p
operator|=
name|salloc
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'Q'
case|:
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
if|if
condition|(
name|length
argument_list|(
name|p
argument_list|)
operator|>
literal|2
condition|)
block|{
name|error
argument_list|(
literal|"Q?\n"
argument_list|)
expr_stmt|;
block|}
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|sgetc
argument_list|(
name|p
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|error
argument_list|(
literal|"neg Q\n"
argument_list|)
expr_stmt|;
block|}
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
while|while
condition|(
name|c
operator|--
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|readptr
operator|==
operator|&
name|readstk
index|[
literal|0
index|]
condition|)
block|{
name|error
argument_list|(
literal|"readstk?\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|readptr
operator|!=
literal|0
condition|)
name|release
argument_list|(
operator|*
name|readptr
argument_list|)
expr_stmt|;
name|readptr
operator|--
expr_stmt|;
block|}
continue|continue;
case|case
literal|'q'
case|:
if|if
condition|(
name|readptr
operator|<=
operator|&
name|readstk
index|[
literal|1
index|]
condition|)
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|readptr
operator|!=
literal|0
condition|)
name|release
argument_list|(
operator|*
name|readptr
argument_list|)
expr_stmt|;
name|readptr
operator|--
expr_stmt|;
if|if
condition|(
operator|*
name|readptr
operator|!=
literal|0
condition|)
name|release
argument_list|(
operator|*
name|readptr
argument_list|)
expr_stmt|;
name|readptr
operator|--
expr_stmt|;
continue|continue;
case|case
literal|'f'
case|:
if|if
condition|(
name|stkptr
operator|==
operator|&
name|stack
index|[
literal|0
index|]
condition|)
name|printf
argument_list|(
literal|"empty stack\n"
argument_list|)
expr_stmt|;
else|else
block|{
for|for
control|(
name|ptr
operator|=
name|stkptr
init|;
name|ptr
operator|>
operator|&
name|stack
index|[
literal|0
index|]
condition|;
control|)
block|{
name|print
argument_list|(
operator|*
name|ptr
operator|--
argument_list|)
expr_stmt|;
block|}
block|}
continue|continue;
case|case
literal|'p'
case|:
if|if
condition|(
name|stkptr
operator|==
operator|&
name|stack
index|[
literal|0
index|]
condition|)
name|printf
argument_list|(
literal|"empty stack\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|print
argument_list|(
operator|*
name|stkptr
argument_list|)
expr_stmt|;
block|}
continue|continue;
case|case
literal|'P'
case|:
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|p
operator|->
name|beg
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'d'
case|:
if|if
condition|(
name|stkptr
operator|==
operator|&
name|stack
index|[
literal|0
index|]
condition|)
block|{
name|printf
argument_list|(
literal|"empty stack\n"
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|q
operator|=
operator|*
name|stkptr
expr_stmt|;
name|n
operator|=
name|length
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|p
operator|=
name|copy
argument_list|(
operator|*
name|stkptr
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'c'
case|:
while|while
condition|(
name|stkerr
operator|==
literal|0
condition|)
block|{
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
if|if
condition|(
name|stkerr
operator|==
literal|0
condition|)
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
continue|continue;
case|case
literal|'S'
case|:
if|if
condition|(
name|stkptr
operator|==
operator|&
name|stack
index|[
literal|0
index|]
condition|)
block|{
name|error
argument_list|(
literal|"save: args\n"
argument_list|)
expr_stmt|;
block|}
name|c
operator|=
name|readc
argument_list|()
operator|&
literal|0377
expr_stmt|;
name|sptr
operator|=
name|stable
index|[
name|c
index|]
expr_stmt|;
name|sp
operator|=
name|stable
index|[
name|c
index|]
operator|=
name|sfree
expr_stmt|;
name|sfree
operator|=
name|sfree
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|sfree
operator|==
literal|0
condition|)
goto|goto
name|sempty
goto|;
name|sp
operator|->
name|next
operator|=
name|sptr
expr_stmt|;
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
if|if
condition|(
name|c
operator|>=
name|ARRAYST
condition|)
block|{
name|q
operator|=
name|copy
argument_list|(
name|p
argument_list|,
name|PTRSZ
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|PTRSZ
operator|-
literal|1
condition|;
name|n
operator|++
control|)
name|sputc
argument_list|(
name|q
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|p
operator|=
name|q
expr_stmt|;
block|}
name|sp
operator|->
name|val
operator|=
name|p
expr_stmt|;
continue|continue;
name|sempty
label|:
name|error
argument_list|(
literal|"symbol table overflow\n"
argument_list|)
expr_stmt|;
case|case
literal|'s'
case|:
if|if
condition|(
name|stkptr
operator|==
operator|&
name|stack
index|[
literal|0
index|]
condition|)
block|{
name|error
argument_list|(
literal|"save:args\n"
argument_list|)
expr_stmt|;
block|}
name|c
operator|=
name|readc
argument_list|()
operator|&
literal|0377
expr_stmt|;
name|sptr
operator|=
name|stable
index|[
name|c
index|]
expr_stmt|;
if|if
condition|(
name|sptr
operator|!=
literal|0
condition|)
block|{
name|p
operator|=
name|sptr
operator|->
name|val
expr_stmt|;
if|if
condition|(
name|c
operator|>=
name|ARRAYST
condition|)
block|{
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
name|release
argument_list|(
name|getwd
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sptr
operator|=
name|stable
index|[
name|c
index|]
operator|=
name|sfree
expr_stmt|;
name|sfree
operator|=
name|sfree
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|sfree
operator|==
literal|0
condition|)
goto|goto
name|sempty
goto|;
name|sptr
operator|->
name|next
operator|=
literal|0
expr_stmt|;
block|}
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|sptr
operator|->
name|val
operator|=
name|p
expr_stmt|;
continue|continue;
case|case
literal|'l'
case|:
name|load
argument_list|()
expr_stmt|;
continue|continue;
case|case
literal|'L'
case|:
name|c
operator|=
name|readc
argument_list|()
operator|&
literal|0377
expr_stmt|;
name|sptr
operator|=
name|stable
index|[
name|c
index|]
expr_stmt|;
if|if
condition|(
name|sptr
operator|==
literal|0
condition|)
block|{
name|error
argument_list|(
literal|"L?\n"
argument_list|)
expr_stmt|;
block|}
name|stable
index|[
name|c
index|]
operator|=
name|sptr
operator|->
name|next
expr_stmt|;
name|sptr
operator|->
name|next
operator|=
name|sfree
expr_stmt|;
name|sfree
operator|=
name|sptr
expr_stmt|;
name|p
operator|=
name|sptr
operator|->
name|val
expr_stmt|;
if|if
condition|(
name|c
operator|>=
name|ARRAYST
condition|)
block|{
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
block|{
name|q
operator|=
name|getwd
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|!=
literal|0
condition|)
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
block|}
block|}
name|pushp
argument_list|(
name|p
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|':'
case|:
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
name|q
operator|=
name|scalint
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|c
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|sfbeg
argument_list|(
name|q
argument_list|)
operator|==
literal|0
operator|)
operator|&&
operator|(
operator|(
name|c
operator|=
name|sbackc
argument_list|(
name|q
argument_list|)
operator|)
operator|<
literal|0
operator|)
condition|)
block|{
name|error
argument_list|(
literal|"neg index\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|length
argument_list|(
name|q
argument_list|)
operator|>
literal|2
condition|)
block|{
name|error
argument_list|(
literal|"index too big\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|sfbeg
argument_list|(
name|q
argument_list|)
operator|==
literal|0
condition|)
name|c
operator|=
name|c
operator|*
literal|100
operator|+
name|sbackc
argument_list|(
name|q
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|>=
name|MAXIND
condition|)
block|{
name|error
argument_list|(
literal|"index too big\n"
argument_list|)
expr_stmt|;
block|}
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|n
operator|=
name|readc
argument_list|()
operator|&
literal|0377
expr_stmt|;
name|sptr
operator|=
name|stable
index|[
name|n
index|]
expr_stmt|;
if|if
condition|(
name|sptr
operator|==
literal|0
condition|)
block|{
name|sptr
operator|=
name|stable
index|[
name|n
index|]
operator|=
name|sfree
expr_stmt|;
name|sfree
operator|=
name|sfree
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|sfree
operator|==
literal|0
condition|)
goto|goto
name|sempty
goto|;
name|sptr
operator|->
name|next
operator|=
literal|0
expr_stmt|;
name|p
operator|=
name|salloc
argument_list|(
operator|(
name|c
operator|+
name|PTRSZ
operator|)
operator|*
name|PTRSZ
argument_list|)
expr_stmt|;
name|zero
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|p
operator|=
name|sptr
operator|->
name|val
expr_stmt|;
if|if
condition|(
name|length
argument_list|(
name|p
argument_list|)
operator|-
name|PTRSZ
operator|<
name|c
operator|*
name|PTRSZ
condition|)
block|{
name|q
operator|=
name|copy
argument_list|(
name|p
argument_list|,
operator|(
name|c
operator|+
name|PTRSZ
operator|)
operator|*
name|PTRSZ
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|p
operator|=
name|q
expr_stmt|;
block|}
block|}
name|seekc
argument_list|(
name|p
argument_list|,
name|c
operator|*
name|PTRSZ
argument_list|)
expr_stmt|;
name|q
operator|=
name|lookwd
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|!=
name|NULL
condition|)
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|s
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
name|salterwd
argument_list|(
name|p
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|sptr
operator|->
name|val
operator|=
name|p
expr_stmt|;
continue|continue;
case|case
literal|';'
case|:
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
name|q
operator|=
name|scalint
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|c
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|sfbeg
argument_list|(
name|q
argument_list|)
operator|==
literal|0
operator|)
operator|&&
operator|(
operator|(
name|c
operator|=
name|sbackc
argument_list|(
name|q
argument_list|)
operator|)
operator|<
literal|0
operator|)
condition|)
block|{
name|error
argument_list|(
literal|"neg index\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|length
argument_list|(
name|q
argument_list|)
operator|>
literal|2
condition|)
block|{
name|error
argument_list|(
literal|"index too big\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|sfbeg
argument_list|(
name|q
argument_list|)
operator|==
literal|0
condition|)
name|c
operator|=
name|c
operator|*
literal|100
operator|+
name|sbackc
argument_list|(
name|q
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|>=
name|MAXIND
condition|)
block|{
name|error
argument_list|(
literal|"index too big\n"
argument_list|)
expr_stmt|;
block|}
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|n
operator|=
name|readc
argument_list|()
operator|&
literal|0377
expr_stmt|;
name|sptr
operator|=
name|stable
index|[
name|n
index|]
expr_stmt|;
if|if
condition|(
name|sptr
operator|!=
literal|0
condition|)
block|{
name|p
operator|=
name|sptr
operator|->
name|val
expr_stmt|;
if|if
condition|(
name|length
argument_list|(
name|p
argument_list|)
operator|-
name|PTRSZ
operator|>=
name|c
operator|*
name|PTRSZ
condition|)
block|{
name|seekc
argument_list|(
name|p
argument_list|,
name|c
operator|*
name|PTRSZ
argument_list|)
expr_stmt|;
name|s
operator|=
name|getwd
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|!=
literal|0
condition|)
block|{
name|q
operator|=
name|copy
argument_list|(
name|s
argument_list|,
name|length
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|q
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
block|}
name|q
operator|=
name|salloc
argument_list|(
name|PTRSZ
argument_list|)
expr_stmt|;
name|putwd
argument_list|(
name|q
argument_list|,
operator|(
expr|struct
name|blk
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|q
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'x'
case|:
name|execute
label|:
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTY
expr_stmt|;
if|if
condition|(
operator|(
name|readptr
operator|!=
operator|&
name|readstk
index|[
literal|0
index|]
operator|)
operator|&&
operator|(
operator|*
name|readptr
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
operator|(
operator|*
name|readptr
operator|)
operator|->
name|rd
operator|==
operator|(
operator|*
name|readptr
operator|)
operator|->
name|wt
condition|)
name|release
argument_list|(
operator|*
name|readptr
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|readptr
operator|++
operator|==
operator|&
name|readstk
index|[
name|RDSKSZ
index|]
condition|)
block|{
name|error
argument_list|(
literal|"nesting depth\n"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
name|readptr
operator|++
expr_stmt|;
operator|*
name|readptr
operator|=
name|p
expr_stmt|;
if|if
condition|(
name|p
operator|!=
literal|0
condition|)
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
operator|(
name|c
operator|=
name|readc
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
name|unreadc
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
continue|continue;
case|case
literal|'?'
case|:
if|if
condition|(
operator|++
name|readptr
operator|==
operator|&
name|readstk
index|[
name|RDSKSZ
index|]
condition|)
block|{
name|error
argument_list|(
literal|"nesting depth\n"
argument_list|)
expr_stmt|;
block|}
operator|*
name|readptr
operator|=
literal|0
expr_stmt|;
name|fsave
operator|=
name|curfile
expr_stmt|;
name|curfile
operator|=
name|stdin
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|readc
argument_list|()
operator|)
operator|==
literal|'!'
condition|)
name|command
argument_list|()
expr_stmt|;
name|p
operator|=
name|salloc
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
name|c
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|readc
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
block|{
name|sputc
argument_list|(
name|p
argument_list|,
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\\'
condition|)
name|sputc
argument_list|(
name|p
argument_list|,
name|readc
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|curfile
operator|=
name|fsave
expr_stmt|;
operator|*
name|readptr
operator|=
name|p
expr_stmt|;
continue|continue;
case|case
literal|'!'
case|:
if|if
condition|(
name|command
argument_list|()
operator|==
literal|1
condition|)
goto|goto
name|execute
goto|;
continue|continue;
case|case
literal|'<'
case|:
case|case
literal|'>'
case|:
case|case
literal|'='
case|:
if|if
condition|(
name|cond
argument_list|(
name|c
argument_list|)
operator|==
literal|1
condition|)
goto|goto
name|execute
goto|;
continue|continue;
default|default:
name|printf
argument_list|(
literal|"%o is unimplemented\n"
argument_list|,
name|c
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_function
name|struct
name|blk
modifier|*
name|div
parameter_list|(
name|ddivd
parameter_list|,
name|ddivr
parameter_list|)
name|struct
name|blk
modifier|*
name|ddivd
decl_stmt|,
decl|*
name|ddivr
decl_stmt|;
end_function

begin_block
block|{
name|int
name|divsign
decl_stmt|,
name|remsign
decl_stmt|,
name|offset
decl_stmt|,
name|divcarry
decl_stmt|;
name|int
name|carry
decl_stmt|,
name|dig
decl_stmt|,
name|magic
decl_stmt|,
name|d
decl_stmt|,
name|dd
decl_stmt|;
name|long
name|c
decl_stmt|,
name|td
decl_stmt|,
name|cc
decl_stmt|;
name|struct
name|blk
modifier|*
name|ps
decl_stmt|;
specifier|register
name|struct
name|blk
modifier|*
name|p
decl_stmt|,
modifier|*
name|divd
decl_stmt|,
modifier|*
name|divr
decl_stmt|;
name|rem
operator|=
literal|0
expr_stmt|;
name|p
operator|=
name|salloc
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
argument_list|(
name|ddivr
argument_list|)
operator|==
literal|0
condition|)
block|{
name|pushp
argument_list|(
name|ddivr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"divide by 0\n"
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|blk
operator|*
operator|)
literal|1
operator|)
return|;
block|}
name|divsign
operator|=
name|remsign
operator|=
literal|0
expr_stmt|;
name|divr
operator|=
name|ddivr
expr_stmt|;
name|fsfile
argument_list|(
name|divr
argument_list|)
expr_stmt|;
if|if
condition|(
name|sbackc
argument_list|(
name|divr
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|divr
operator|=
name|copy
argument_list|(
name|ddivr
argument_list|,
name|length
argument_list|(
name|ddivr
argument_list|)
argument_list|)
expr_stmt|;
name|chsign
argument_list|(
name|divr
argument_list|)
expr_stmt|;
name|divsign
operator|=
operator|~
name|divsign
expr_stmt|;
block|}
name|divd
operator|=
name|copy
argument_list|(
name|ddivd
argument_list|,
name|length
argument_list|(
name|ddivd
argument_list|)
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|divd
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfbeg
argument_list|(
name|divd
argument_list|)
operator|==
literal|0
operator|&&
name|sbackc
argument_list|(
name|divd
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|chsign
argument_list|(
name|divd
argument_list|)
expr_stmt|;
name|divsign
operator|=
operator|~
name|divsign
expr_stmt|;
name|remsign
operator|=
operator|~
name|remsign
expr_stmt|;
block|}
name|offset
operator|=
name|length
argument_list|(
name|divd
argument_list|)
operator|-
name|length
argument_list|(
name|divr
argument_list|)
expr_stmt|;
if|if
condition|(
name|offset
operator|<
literal|0
condition|)
goto|goto
name|ddone
goto|;
name|seekc
argument_list|(
name|p
argument_list|,
name|offset
operator|+
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|divd
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|magic
operator|=
literal|0
expr_stmt|;
name|fsfile
argument_list|(
name|divr
argument_list|)
expr_stmt|;
name|c
operator|=
name|sbackc
argument_list|(
name|divr
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|<
literal|10
condition|)
name|magic
operator|++
expr_stmt|;
name|c
operator|=
name|c
operator|*
literal|100
operator|+
operator|(
name|sfbeg
argument_list|(
name|divr
argument_list|)
condition|?
literal|0
else|:
name|sbackc
argument_list|(
name|divr
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|magic
operator|>
literal|0
condition|)
block|{
name|c
operator|=
operator|(
name|c
operator|*
literal|100
operator|+
operator|(
name|sfbeg
argument_list|(
name|divr
argument_list|)
condition|?
literal|0
else|:
name|sbackc
argument_list|(
name|divr
argument_list|)
operator|)
operator|)
operator|*
literal|2
expr_stmt|;
name|c
operator|/=
literal|25
expr_stmt|;
block|}
while|while
condition|(
name|offset
operator|>=
literal|0
condition|)
block|{
name|fsfile
argument_list|(
name|divd
argument_list|)
expr_stmt|;
name|td
operator|=
name|sbackc
argument_list|(
name|divd
argument_list|)
operator|*
literal|100
expr_stmt|;
name|dd
operator|=
name|sfbeg
argument_list|(
name|divd
argument_list|)
condition|?
literal|0
else|:
name|sbackc
argument_list|(
name|divd
argument_list|)
expr_stmt|;
name|td
operator|=
operator|(
name|td
operator|+
name|dd
operator|)
operator|*
literal|100
expr_stmt|;
name|dd
operator|=
name|sfbeg
argument_list|(
name|divd
argument_list|)
condition|?
literal|0
else|:
name|sbackc
argument_list|(
name|divd
argument_list|)
expr_stmt|;
name|td
operator|=
name|td
operator|+
name|dd
expr_stmt|;
name|cc
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|offset
operator|==
literal|0
condition|)
name|td
operator|+=
literal|1
expr_stmt|;
else|else
name|cc
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
name|magic
operator|!=
literal|0
condition|)
name|td
operator|=
name|td
operator|<<
literal|3
expr_stmt|;
name|dig
operator|=
name|td
operator|/
name|cc
expr_stmt|;
name|rewind
argument_list|(
name|divr
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|divxyz
argument_list|)
expr_stmt|;
name|carry
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|divr
argument_list|)
operator|==
literal|0
condition|)
block|{
name|d
operator|=
name|sgetc
argument_list|(
name|divr
argument_list|)
operator|*
name|dig
operator|+
name|carry
expr_stmt|;
name|carry
operator|=
name|d
operator|/
literal|100
expr_stmt|;
name|salterc
argument_list|(
name|divxyz
argument_list|,
name|d
operator|%
literal|100
argument_list|)
expr_stmt|;
block|}
name|salterc
argument_list|(
name|divxyz
argument_list|,
name|carry
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|divxyz
argument_list|)
expr_stmt|;
name|seekc
argument_list|(
name|divd
argument_list|,
name|offset
argument_list|)
expr_stmt|;
name|carry
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|divd
argument_list|)
operator|==
literal|0
condition|)
block|{
name|d
operator|=
name|slookc
argument_list|(
name|divd
argument_list|)
expr_stmt|;
name|d
operator|=
name|d
operator|-
operator|(
name|sfeof
argument_list|(
name|divxyz
argument_list|)
condition|?
literal|0
else|:
name|sgetc
argument_list|(
name|divxyz
argument_list|)
operator|)
operator|-
name|carry
expr_stmt|;
name|carry
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|d
operator|<
literal|0
condition|)
block|{
name|d
operator|+=
literal|100
expr_stmt|;
name|carry
operator|=
literal|1
expr_stmt|;
block|}
name|salterc
argument_list|(
name|divd
argument_list|,
name|d
argument_list|)
expr_stmt|;
block|}
name|divcarry
operator|=
name|carry
expr_stmt|;
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|salterc
argument_list|(
name|p
argument_list|,
name|dig
argument_list|)
expr_stmt|;
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
operator|--
name|offset
operator|>=
literal|0
condition|)
block|{
if|if
condition|(
name|d
operator|>
literal|0
condition|)
block|{
name|sbackc
argument_list|(
name|divd
argument_list|)
expr_stmt|;
name|dd
operator|=
name|sbackc
argument_list|(
name|divd
argument_list|)
expr_stmt|;
name|salterc
argument_list|(
name|divd
argument_list|,
name|dd
operator|+
literal|100
argument_list|)
expr_stmt|;
block|}
name|divd
operator|->
name|wt
operator|--
expr_stmt|;
block|}
block|}
if|if
condition|(
name|divcarry
operator|!=
literal|0
condition|)
block|{
name|salterc
argument_list|(
name|p
argument_list|,
name|dig
operator|-
literal|1
argument_list|)
expr_stmt|;
name|salterc
argument_list|(
name|divd
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|ps
operator|=
name|add
argument_list|(
name|divr
argument_list|,
name|divd
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|divd
argument_list|)
expr_stmt|;
name|divd
operator|=
name|ps
expr_stmt|;
block|}
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|divcarry
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
block|{
name|d
operator|=
name|slookc
argument_list|(
name|p
argument_list|)
operator|+
name|divcarry
expr_stmt|;
name|divcarry
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|d
operator|>=
literal|100
condition|)
block|{
name|d
operator|-=
literal|100
expr_stmt|;
name|divcarry
operator|=
literal|1
expr_stmt|;
block|}
name|salterc
argument_list|(
name|p
argument_list|,
name|d
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|divcarry
operator|!=
literal|0
condition|)
name|salterc
argument_list|(
name|p
argument_list|,
name|divcarry
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfbeg
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|sbackc
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
name|truncate
argument_list|(
name|p
argument_list|)
expr_stmt|;
else|else
break|break;
block|}
if|if
condition|(
name|divsign
operator|<
literal|0
condition|)
name|chsign
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|divd
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfbeg
argument_list|(
name|divd
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|sbackc
argument_list|(
name|divd
argument_list|)
operator|==
literal|0
condition|)
name|truncate
argument_list|(
name|divd
argument_list|)
expr_stmt|;
else|else
break|break;
block|}
name|ddone
label|:
if|if
condition|(
name|remsign
operator|<
literal|0
condition|)
name|chsign
argument_list|(
name|divd
argument_list|)
expr_stmt|;
if|if
condition|(
name|divr
operator|!=
name|ddivr
condition|)
name|release
argument_list|(
name|divr
argument_list|)
expr_stmt|;
name|rem
operator|=
name|divd
expr_stmt|;
return|return
operator|(
name|p
operator|)
return|;
block|}
end_block

begin_macro
name|dscale
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|struct
name|blk
modifier|*
name|dd
decl_stmt|,
modifier|*
name|dr
decl_stmt|;
specifier|register
name|struct
name|blk
modifier|*
name|r
decl_stmt|;
name|int
name|c
decl_stmt|;
name|dr
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTYS
expr_stmt|;
name|dd
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTYSR
argument_list|(
name|dr
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|skd
operator|=
name|sunputc
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|dr
argument_list|)
expr_stmt|;
name|skr
operator|=
name|sunputc
argument_list|(
name|dr
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfbeg
argument_list|(
name|dr
argument_list|)
operator|==
literal|1
operator|||
operator|(
name|sfbeg
argument_list|(
name|dr
argument_list|)
operator|==
literal|0
operator|&&
name|sbackc
argument_list|(
name|dr
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
name|sputc
argument_list|(
name|dr
argument_list|,
name|skr
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|dr
argument_list|)
expr_stmt|;
name|errorrt
argument_list|(
literal|"divide by 0\n"
argument_list|)
expr_stmt|;
block|}
name|c
operator|=
name|k
operator|-
name|skd
operator|+
name|skr
expr_stmt|;
if|if
condition|(
name|c
operator|<
literal|0
condition|)
name|r
operator|=
name|removr
argument_list|(
name|dd
argument_list|,
operator|-
name|c
argument_list|)
expr_stmt|;
else|else
block|{
name|r
operator|=
name|add0
argument_list|(
name|dd
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|irem
operator|=
literal|0
expr_stmt|;
block|}
name|arg1
operator|=
name|r
expr_stmt|;
name|arg2
operator|=
name|dr
expr_stmt|;
name|savk
operator|=
name|k
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_function
name|struct
name|blk
modifier|*
name|removr
parameter_list|(
name|p
parameter_list|,
name|n
parameter_list|)
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
block|{
name|int
name|nn
decl_stmt|;
specifier|register
name|struct
name|blk
modifier|*
name|q
decl_stmt|,
modifier|*
name|s
decl_stmt|,
modifier|*
name|r
decl_stmt|;
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|nn
operator|=
operator|(
name|n
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
name|q
operator|=
name|salloc
argument_list|(
name|nn
argument_list|)
expr_stmt|;
while|while
condition|(
name|n
operator|>
literal|1
condition|)
block|{
name|sputc
argument_list|(
name|q
argument_list|,
name|sgetc
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
name|n
operator|-=
literal|2
expr_stmt|;
block|}
name|r
operator|=
name|salloc
argument_list|(
literal|2
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
name|sputc
argument_list|(
name|r
argument_list|,
name|sgetc
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|==
literal|1
condition|)
block|{
name|s
operator|=
name|div
argument_list|(
name|r
argument_list|,
name|tenptr
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|rem
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfeof
argument_list|(
name|rem
argument_list|)
operator|==
literal|0
condition|)
name|sputc
argument_list|(
name|q
argument_list|,
name|sgetc
argument_list|(
name|rem
argument_list|)
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|rem
argument_list|)
expr_stmt|;
name|irem
operator|=
name|q
expr_stmt|;
return|return
operator|(
name|s
operator|)
return|;
block|}
name|irem
operator|=
name|q
expr_stmt|;
return|return
operator|(
name|r
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|blk
modifier|*
name|sqrt
parameter_list|(
name|p
parameter_list|)
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
block|{
name|struct
name|blk
modifier|*
name|t
decl_stmt|;
name|struct
name|blk
modifier|*
name|r
decl_stmt|,
modifier|*
name|q
decl_stmt|,
modifier|*
name|s
decl_stmt|;
name|int
name|c
decl_stmt|,
name|n
decl_stmt|,
name|nn
decl_stmt|;
name|n
operator|=
name|length
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|c
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|n
operator|&
literal|1
operator|)
operator|!=
literal|1
condition|)
name|c
operator|=
name|c
operator|*
literal|100
operator|+
operator|(
name|sfbeg
argument_list|(
name|p
argument_list|)
condition|?
literal|0
else|:
name|sbackc
argument_list|(
name|p
argument_list|)
operator|)
expr_stmt|;
name|n
operator|=
operator|(
name|n
operator|+
literal|1
operator|)
operator|>>
literal|1
expr_stmt|;
name|r
operator|=
name|salloc
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|zero
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|seekc
argument_list|(
name|r
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|nn
operator|=
literal|1
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|-=
name|nn
operator|)
operator|>=
literal|0
condition|)
name|nn
operator|+=
literal|2
expr_stmt|;
name|c
operator|=
operator|(
name|nn
operator|+
literal|1
operator|)
operator|>>
literal|1
expr_stmt|;
name|fsfile
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|sbackc
argument_list|(
name|r
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|>=
literal|100
condition|)
block|{
name|c
operator|-=
literal|100
expr_stmt|;
name|salterc
argument_list|(
name|r
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|r
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
name|salterc
argument_list|(
name|r
argument_list|,
name|c
argument_list|)
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|q
operator|=
name|div
argument_list|(
name|p
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|s
operator|=
name|add
argument_list|(
name|q
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|rem
argument_list|)
expr_stmt|;
name|q
operator|=
name|div
argument_list|(
name|s
argument_list|,
name|sqtemp
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|rem
argument_list|)
expr_stmt|;
name|s
operator|=
name|copy
argument_list|(
name|r
argument_list|,
name|length
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|chsign
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|t
operator|=
name|add
argument_list|(
name|s
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|nn
operator|=
name|sfbeg
argument_list|(
name|t
argument_list|)
condition|?
literal|0
else|:
name|sbackc
argument_list|(
name|t
argument_list|)
expr_stmt|;
if|if
condition|(
name|nn
operator|>=
literal|0
condition|)
break|break;
name|release
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|r
operator|=
name|q
expr_stmt|;
block|}
name|release
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
return|return
operator|(
name|r
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|blk
modifier|*
name|exp
parameter_list|(
name|base
parameter_list|,
name|ex
parameter_list|)
name|struct
name|blk
modifier|*
name|base
decl_stmt|,
decl|*
name|ex
decl_stmt|;
end_function

begin_block
block|{
specifier|register
name|struct
name|blk
modifier|*
name|r
decl_stmt|,
modifier|*
name|e
decl_stmt|,
modifier|*
name|p
decl_stmt|;
name|struct
name|blk
modifier|*
name|e1
decl_stmt|,
modifier|*
name|t
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
name|int
name|temp
decl_stmt|,
name|c
decl_stmt|,
name|n
decl_stmt|;
name|r
operator|=
name|salloc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|r
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|p
operator|=
name|copy
argument_list|(
name|base
argument_list|,
name|length
argument_list|(
name|base
argument_list|)
argument_list|)
expr_stmt|;
name|e
operator|=
name|copy
argument_list|(
name|ex
argument_list|,
name|length
argument_list|(
name|ex
argument_list|)
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|e
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfbeg
argument_list|(
name|e
argument_list|)
operator|!=
literal|0
condition|)
goto|goto
name|edone
goto|;
name|temp
operator|=
literal|0
expr_stmt|;
name|c
operator|=
name|sbackc
argument_list|(
name|e
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|<
literal|0
condition|)
block|{
name|temp
operator|++
expr_stmt|;
name|chsign
argument_list|(
name|e
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|length
argument_list|(
name|e
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|e1
operator|=
name|div
argument_list|(
name|e
argument_list|,
name|sqtemp
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|e
operator|=
name|e1
expr_stmt|;
name|n
operator|=
name|length
argument_list|(
name|rem
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|rem
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|!=
literal|0
condition|)
block|{
name|e1
operator|=
name|mult
argument_list|(
name|p
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|r
operator|=
name|e1
expr_stmt|;
block|}
name|t
operator|=
name|copy
argument_list|(
name|p
argument_list|,
name|length
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
name|cp
operator|=
name|mult
argument_list|(
name|p
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|p
operator|=
name|cp
expr_stmt|;
block|}
if|if
condition|(
name|temp
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|c
operator|=
name|length
argument_list|(
name|base
argument_list|)
operator|)
operator|==
literal|0
condition|)
block|{
goto|goto
name|edone
goto|;
block|}
if|if
condition|(
name|c
operator|>
literal|1
condition|)
name|create
argument_list|(
name|r
argument_list|)
expr_stmt|;
else|else
block|{
name|rewind
argument_list|(
name|base
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|sgetc
argument_list|(
name|base
argument_list|)
operator|)
operator|<=
literal|1
condition|)
block|{
name|create
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|r
argument_list|,
name|c
argument_list|)
expr_stmt|;
block|}
else|else
name|create
argument_list|(
name|r
argument_list|)
expr_stmt|;
block|}
block|}
name|edone
label|:
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|e
argument_list|)
expr_stmt|;
return|return
operator|(
name|r
operator|)
return|;
block|}
end_block

begin_macro
name|init
argument_list|(
argument|argc
argument_list|,
argument|argv
argument_list|)
end_macro

begin_decl_stmt
name|int
name|argc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|sym
modifier|*
name|sp
decl_stmt|;
if|if
condition|(
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
operator|!=
name|SIG_IGN
condition|)
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|onintr
argument_list|)
expr_stmt|;
name|setbuf
argument_list|(
name|stdout
argument_list|,
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
name|svargc
operator|=
operator|--
name|argc
expr_stmt|;
name|svargv
operator|=
name|argv
expr_stmt|;
while|while
condition|(
name|svargc
operator|>
literal|0
operator|&&
name|svargv
index|[
literal|1
index|]
index|[
literal|0
index|]
operator|==
literal|'-'
condition|)
block|{
switch|switch
condition|(
name|svargv
index|[
literal|1
index|]
index|[
literal|1
index|]
condition|)
block|{
default|default:
name|dbg
operator|=
literal|1
expr_stmt|;
block|}
name|svargc
operator|--
expr_stmt|;
name|svargv
operator|++
expr_stmt|;
block|}
name|ifile
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|svargc
operator|<=
literal|0
condition|)
name|curfile
operator|=
name|stdin
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|curfile
operator|=
name|fopen
argument_list|(
name|svargv
index|[
literal|1
index|]
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"can't open file %s\n"
argument_list|,
name|svargv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|scalptr
operator|=
name|salloc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|scalptr
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|basptr
operator|=
name|salloc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|basptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|obase
operator|=
literal|10
expr_stmt|;
name|log10
operator|=
name|log2
argument_list|(
literal|10L
argument_list|)
expr_stmt|;
name|ll
operator|=
literal|70
expr_stmt|;
name|fw
operator|=
literal|1
expr_stmt|;
name|fw1
operator|=
literal|0
expr_stmt|;
name|tenptr
operator|=
name|salloc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|tenptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|obase
operator|=
literal|10
expr_stmt|;
name|inbas
operator|=
name|salloc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|inbas
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|sqtemp
operator|=
name|salloc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|sqtemp
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|chptr
operator|=
name|salloc
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|strptr
operator|=
name|salloc
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|divxyz
operator|=
name|salloc
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|stkbeg
operator|=
name|stkptr
operator|=
operator|&
name|stack
index|[
literal|0
index|]
expr_stmt|;
name|stkend
operator|=
operator|&
name|stack
index|[
name|STKSZ
index|]
expr_stmt|;
name|stkerr
operator|=
literal|0
expr_stmt|;
name|readptr
operator|=
operator|&
name|readstk
index|[
literal|0
index|]
expr_stmt|;
name|k
operator|=
literal|0
expr_stmt|;
name|sp
operator|=
name|sptr
operator|=
operator|&
name|symlst
index|[
literal|0
index|]
expr_stmt|;
while|while
condition|(
name|sptr
operator|<
operator|&
name|symlst
index|[
name|TBLSZ
operator|-
literal|1
index|]
condition|)
block|{
name|sptr
operator|->
name|next
operator|=
operator|++
name|sp
expr_stmt|;
name|sptr
operator|++
expr_stmt|;
block|}
name|sptr
operator|->
name|next
operator|=
literal|0
expr_stmt|;
name|sfree
operator|=
operator|&
name|symlst
index|[
literal|0
index|]
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|onintr
argument_list|()
end_macro

begin_block
block|{
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|onintr
argument_list|)
expr_stmt|;
while|while
condition|(
name|readptr
operator|!=
operator|&
name|readstk
index|[
literal|0
index|]
condition|)
block|{
if|if
condition|(
operator|*
name|readptr
operator|!=
literal|0
condition|)
block|{
name|release
argument_list|(
operator|*
name|readptr
argument_list|)
expr_stmt|;
block|}
name|readptr
operator|--
expr_stmt|;
block|}
name|curfile
operator|=
name|stdin
expr_stmt|;
name|commnds
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|pushp
argument_list|(
argument|p
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|stkptr
operator|==
name|stkend
condition|)
block|{
name|printf
argument_list|(
literal|"out of stack space\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|stkerr
operator|=
literal|0
expr_stmt|;
operator|*
operator|++
name|stkptr
operator|=
name|p
expr_stmt|;
return|return;
block|}
end_block

begin_function
name|struct
name|blk
modifier|*
name|pop
parameter_list|()
block|{
if|if
condition|(
name|stkptr
operator|==
name|stack
condition|)
block|{
name|stkerr
operator|=
literal|1
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
return|return
operator|(
operator|*
name|stkptr
operator|--
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|blk
modifier|*
name|readin
parameter_list|()
block|{
specifier|register
name|struct
name|blk
modifier|*
name|p
decl_stmt|,
modifier|*
name|q
decl_stmt|;
name|int
name|dp
decl_stmt|,
name|dpct
decl_stmt|;
specifier|register
name|int
name|c
decl_stmt|;
name|dp
operator|=
name|dpct
operator|=
literal|0
expr_stmt|;
name|p
operator|=
name|salloc
argument_list|(
literal|0
argument_list|)
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|c
operator|=
name|readc
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'.'
case|:
if|if
condition|(
name|dp
operator|!=
literal|0
condition|)
block|{
name|unreadc
argument_list|(
name|c
argument_list|)
expr_stmt|;
break|break;
block|}
name|dp
operator|++
expr_stmt|;
continue|continue;
case|case
literal|'\\'
case|:
name|readc
argument_list|()
expr_stmt|;
continue|continue;
default|default:
if|if
condition|(
name|c
operator|>=
literal|'A'
operator|&&
name|c
operator|<=
literal|'F'
condition|)
name|c
operator|=
name|c
operator|-
literal|'A'
operator|+
literal|10
expr_stmt|;
elseif|else
if|if
condition|(
name|c
operator|>=
literal|'0'
operator|&&
name|c
operator|<=
literal|'9'
condition|)
name|c
operator|-=
literal|'0'
expr_stmt|;
else|else
goto|goto
name|gotnum
goto|;
if|if
condition|(
name|dp
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|dpct
operator|>=
literal|99
condition|)
continue|continue;
name|dpct
operator|++
expr_stmt|;
block|}
name|create
argument_list|(
name|chptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|!=
literal|0
condition|)
name|sputc
argument_list|(
name|chptr
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|q
operator|=
name|mult
argument_list|(
name|p
argument_list|,
name|inbas
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|p
operator|=
name|add
argument_list|(
name|chptr
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
block|}
block|}
name|gotnum
label|:
name|unreadc
argument_list|(
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|dp
operator|==
literal|0
condition|)
block|{
name|sputc
argument_list|(
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
operator|(
name|p
operator|)
return|;
block|}
else|else
block|{
name|q
operator|=
name|scale
argument_list|(
name|p
argument_list|,
name|dpct
argument_list|)
expr_stmt|;
return|return
operator|(
name|q
operator|)
return|;
block|}
block|}
end_function

begin_function
name|struct
name|blk
modifier|*
name|add0
parameter_list|(
name|p
parameter_list|,
name|ct
parameter_list|)
name|int
name|ct
decl_stmt|;
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
block|{
comment|/* returns pointer to struct with ct 0's& p */
specifier|register
name|struct
name|blk
modifier|*
name|q
decl_stmt|,
modifier|*
name|t
decl_stmt|;
name|q
operator|=
name|salloc
argument_list|(
name|length
argument_list|(
name|p
argument_list|)
operator|+
operator|(
name|ct
operator|+
literal|1
operator|)
operator|/
literal|2
argument_list|)
expr_stmt|;
while|while
condition|(
name|ct
operator|>
literal|1
condition|)
block|{
name|sputc
argument_list|(
name|q
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ct
operator|-=
literal|2
expr_stmt|;
block|}
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
block|{
name|sputc
argument_list|(
name|q
argument_list|,
name|sgetc
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|ct
operator|==
literal|1
condition|)
block|{
name|t
operator|=
name|mult
argument_list|(
name|tenptr
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
return|return
operator|(
name|t
operator|)
return|;
block|}
return|return
operator|(
name|q
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|blk
modifier|*
name|mult
parameter_list|(
name|p
parameter_list|,
name|q
parameter_list|)
name|struct
name|blk
modifier|*
name|p
decl_stmt|,
decl|*
name|q
decl_stmt|;
end_function

begin_block
block|{
specifier|register
name|struct
name|blk
modifier|*
name|mp
decl_stmt|,
modifier|*
name|mq
decl_stmt|,
modifier|*
name|mr
decl_stmt|;
name|int
name|sign
decl_stmt|,
name|offset
decl_stmt|,
name|carry
decl_stmt|;
name|int
name|cq
decl_stmt|,
name|cp
decl_stmt|,
name|mt
decl_stmt|,
name|mcr
decl_stmt|;
name|offset
operator|=
name|sign
operator|=
literal|0
expr_stmt|;
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|mp
operator|=
name|p
expr_stmt|;
if|if
condition|(
name|sfbeg
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|sbackc
argument_list|(
name|p
argument_list|)
operator|<
literal|0
condition|)
block|{
name|mp
operator|=
name|copy
argument_list|(
name|p
argument_list|,
name|length
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
name|chsign
argument_list|(
name|mp
argument_list|)
expr_stmt|;
name|sign
operator|=
operator|~
name|sign
expr_stmt|;
block|}
block|}
name|fsfile
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|mq
operator|=
name|q
expr_stmt|;
if|if
condition|(
name|sfbeg
argument_list|(
name|q
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|sbackc
argument_list|(
name|q
argument_list|)
operator|<
literal|0
condition|)
block|{
name|mq
operator|=
name|copy
argument_list|(
name|q
argument_list|,
name|length
argument_list|(
name|q
argument_list|)
argument_list|)
expr_stmt|;
name|chsign
argument_list|(
name|mq
argument_list|)
expr_stmt|;
name|sign
operator|=
operator|~
name|sign
expr_stmt|;
block|}
block|}
name|mr
operator|=
name|salloc
argument_list|(
name|length
argument_list|(
name|mp
argument_list|)
operator|+
name|length
argument_list|(
name|mq
argument_list|)
argument_list|)
expr_stmt|;
name|zero
argument_list|(
name|mr
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|mq
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|mq
argument_list|)
operator|==
literal|0
condition|)
block|{
name|cq
operator|=
name|sgetc
argument_list|(
name|mq
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|mp
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|mr
argument_list|)
expr_stmt|;
name|mr
operator|->
name|rd
operator|+=
name|offset
expr_stmt|;
name|carry
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|mp
argument_list|)
operator|==
literal|0
condition|)
block|{
name|cp
operator|=
name|sgetc
argument_list|(
name|mp
argument_list|)
expr_stmt|;
name|mcr
operator|=
name|sfeof
argument_list|(
name|mr
argument_list|)
condition|?
literal|0
else|:
name|slookc
argument_list|(
name|mr
argument_list|)
expr_stmt|;
name|mt
operator|=
name|cp
operator|*
name|cq
operator|+
name|carry
operator|+
name|mcr
expr_stmt|;
name|carry
operator|=
name|mt
operator|/
literal|100
expr_stmt|;
name|salterc
argument_list|(
name|mr
argument_list|,
name|mt
operator|%
literal|100
argument_list|)
expr_stmt|;
block|}
name|offset
operator|++
expr_stmt|;
if|if
condition|(
name|carry
operator|!=
literal|0
condition|)
block|{
name|mcr
operator|=
name|sfeof
argument_list|(
name|mr
argument_list|)
condition|?
literal|0
else|:
name|slookc
argument_list|(
name|mr
argument_list|)
expr_stmt|;
name|salterc
argument_list|(
name|mr
argument_list|,
name|mcr
operator|+
name|carry
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|sign
operator|<
literal|0
condition|)
block|{
name|chsign
argument_list|(
name|mr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|mp
operator|!=
name|p
condition|)
name|release
argument_list|(
name|mp
argument_list|)
expr_stmt|;
if|if
condition|(
name|mq
operator|!=
name|q
condition|)
name|release
argument_list|(
name|mq
argument_list|)
expr_stmt|;
return|return
operator|(
name|mr
operator|)
return|;
block|}
end_block

begin_macro
name|chsign
argument_list|(
argument|p
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|carry
decl_stmt|;
specifier|register
name|char
name|ct
decl_stmt|;
name|carry
operator|=
literal|0
expr_stmt|;
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
block|{
name|ct
operator|=
literal|100
operator|-
name|slookc
argument_list|(
name|p
argument_list|)
operator|-
name|carry
expr_stmt|;
name|carry
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|ct
operator|>=
literal|100
condition|)
block|{
name|ct
operator|-=
literal|100
expr_stmt|;
name|carry
operator|=
literal|0
expr_stmt|;
block|}
name|salterc
argument_list|(
name|p
argument_list|,
name|ct
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|carry
operator|!=
literal|0
condition|)
block|{
name|sputc
argument_list|(
name|p
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ct
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|ct
operator|==
literal|99
condition|)
block|{
name|truncate
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ct
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|ct
operator|==
literal|0
condition|)
name|truncate
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_block

begin_macro
name|readc
argument_list|()
end_macro

begin_block
block|{
name|loop
label|:
if|if
condition|(
operator|(
name|readptr
operator|!=
operator|&
name|readstk
index|[
literal|0
index|]
operator|)
operator|&&
operator|(
operator|*
name|readptr
operator|!=
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|sfeof
argument_list|(
operator|*
name|readptr
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
name|lastchar
operator|=
name|sgetc
argument_list|(
operator|*
name|readptr
argument_list|)
operator|)
return|;
name|release
argument_list|(
operator|*
name|readptr
argument_list|)
expr_stmt|;
name|readptr
operator|--
expr_stmt|;
goto|goto
name|loop
goto|;
block|}
name|lastchar
operator|=
name|getc
argument_list|(
name|curfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|lastchar
operator|!=
name|EOF
condition|)
return|return
operator|(
name|lastchar
operator|)
return|;
if|if
condition|(
name|readptr
operator|!=
operator|&
name|readptr
index|[
literal|0
index|]
condition|)
block|{
name|readptr
operator|--
expr_stmt|;
if|if
condition|(
operator|*
name|readptr
operator|==
literal|0
condition|)
name|curfile
operator|=
name|stdin
expr_stmt|;
goto|goto
name|loop
goto|;
block|}
if|if
condition|(
name|curfile
operator|!=
name|stdin
condition|)
block|{
name|fclose
argument_list|(
name|curfile
argument_list|)
expr_stmt|;
name|curfile
operator|=
name|stdin
expr_stmt|;
goto|goto
name|loop
goto|;
block|}
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|unreadc
argument_list|(
argument|c
argument_list|)
end_macro

begin_decl_stmt
name|char
name|c
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
operator|(
name|readptr
operator|!=
operator|&
name|readstk
index|[
literal|0
index|]
operator|)
operator|&&
operator|(
operator|*
name|readptr
operator|!=
literal|0
operator|)
condition|)
block|{
name|sungetc
argument_list|(
operator|*
name|readptr
argument_list|,
name|c
argument_list|)
expr_stmt|;
block|}
else|else
name|ungetc
argument_list|(
name|c
argument_list|,
name|curfile
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|binop
argument_list|(
argument|c
argument_list|)
end_macro

begin_decl_stmt
name|char
name|c
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|blk
modifier|*
name|r
decl_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'+'
case|:
name|r
operator|=
name|add
argument_list|(
name|arg1
argument_list|,
name|arg2
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'*'
case|:
name|r
operator|=
name|mult
argument_list|(
name|arg1
argument_list|,
name|arg2
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'/'
case|:
name|r
operator|=
name|div
argument_list|(
name|arg1
argument_list|,
name|arg2
argument_list|)
expr_stmt|;
break|break;
block|}
name|release
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|arg2
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|r
argument_list|,
name|savk
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|r
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|print
argument_list|(
argument|hptr
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|blk
modifier|*
name|hptr
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|sc
decl_stmt|;
specifier|register
name|struct
name|blk
modifier|*
name|p
decl_stmt|,
modifier|*
name|q
decl_stmt|,
modifier|*
name|dec
decl_stmt|;
name|int
name|dig
decl_stmt|,
name|dout
decl_stmt|,
name|ct
decl_stmt|;
name|rewind
argument_list|(
name|hptr
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|hptr
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|sgetc
argument_list|(
name|hptr
argument_list|)
operator|>
literal|99
condition|)
block|{
name|rewind
argument_list|(
name|hptr
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|hptr
argument_list|)
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|sgetc
argument_list|(
name|hptr
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|fsfile
argument_list|(
name|hptr
argument_list|)
expr_stmt|;
name|sc
operator|=
name|sbackc
argument_list|(
name|hptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfbeg
argument_list|(
name|hptr
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"0\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|count
operator|=
name|ll
expr_stmt|;
name|p
operator|=
name|copy
argument_list|(
name|hptr
argument_list|,
name|length
argument_list|(
name|hptr
argument_list|)
argument_list|)
expr_stmt|;
name|sunputc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|sbackc
argument_list|(
name|p
argument_list|)
operator|<
literal|0
condition|)
block|{
name|chsign
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OUTC
argument_list|(
literal|'-'
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|obase
operator|==
literal|0
operator|)
operator|||
operator|(
name|obase
operator|==
operator|-
literal|1
operator|)
condition|)
block|{
name|oneot
argument_list|(
name|p
argument_list|,
name|sc
argument_list|,
literal|'d'
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|obase
operator|==
literal|1
condition|)
block|{
name|oneot
argument_list|(
name|p
argument_list|,
name|sc
argument_list|,
literal|'1'
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|obase
operator|==
literal|10
condition|)
block|{
name|tenot
argument_list|(
name|p
argument_list|,
name|sc
argument_list|)
expr_stmt|;
return|return;
block|}
name|create
argument_list|(
name|strptr
argument_list|)
expr_stmt|;
name|dig
operator|=
name|log10
operator|*
name|sc
expr_stmt|;
name|dout
operator|=
operator|(
operator|(
name|dig
operator|/
literal|10
operator|)
operator|+
name|dig
operator|)
operator|/
name|logo
expr_stmt|;
name|dec
operator|=
name|getdec
argument_list|(
name|p
argument_list|,
name|sc
argument_list|)
expr_stmt|;
name|p
operator|=
name|removc
argument_list|(
name|p
argument_list|,
name|sc
argument_list|)
expr_stmt|;
while|while
condition|(
name|length
argument_list|(
name|p
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|q
operator|=
name|div
argument_list|(
name|p
argument_list|,
name|basptr
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|p
operator|=
name|q
expr_stmt|;
call|(
modifier|*
name|outdit
call|)
argument_list|(
name|rem
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|strptr
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfbeg
argument_list|(
name|strptr
argument_list|)
operator|==
literal|0
condition|)
name|OUTC
argument_list|(
name|sbackc
argument_list|(
name|strptr
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|sc
operator|==
literal|0
condition|)
block|{
name|release
argument_list|(
name|dec
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|create
argument_list|(
name|strptr
argument_list|)
expr_stmt|;
name|OUTC
argument_list|(
literal|'.'
argument_list|)
expr_stmt|;
name|ct
operator|=
literal|0
expr_stmt|;
do|do
block|{
name|q
operator|=
name|mult
argument_list|(
name|basptr
argument_list|,
name|dec
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|dec
argument_list|)
expr_stmt|;
name|dec
operator|=
name|getdec
argument_list|(
name|q
argument_list|,
name|sc
argument_list|)
expr_stmt|;
name|p
operator|=
name|removc
argument_list|(
name|q
argument_list|,
name|sc
argument_list|)
expr_stmt|;
call|(
modifier|*
name|outdit
call|)
argument_list|(
name|p
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
operator|++
name|ct
operator|<
name|dout
condition|)
do|;
name|release
argument_list|(
name|dec
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|strptr
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|strptr
argument_list|)
operator|==
literal|0
condition|)
name|OUTC
argument_list|(
name|sgetc
argument_list|(
name|strptr
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_function
name|struct
name|blk
modifier|*
name|getdec
parameter_list|(
name|p
parameter_list|,
name|sc
parameter_list|)
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
block|{
name|int
name|cc
decl_stmt|;
specifier|register
name|struct
name|blk
modifier|*
name|q
decl_stmt|,
modifier|*
name|t
decl_stmt|,
modifier|*
name|s
decl_stmt|;
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
argument_list|(
name|p
argument_list|)
operator|*
literal|2
operator|<
name|sc
condition|)
block|{
name|q
operator|=
name|copy
argument_list|(
name|p
argument_list|,
name|length
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|q
operator|)
return|;
block|}
name|q
operator|=
name|salloc
argument_list|(
name|length
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|sc
operator|>=
literal|1
condition|)
block|{
name|sputc
argument_list|(
name|q
argument_list|,
name|sgetc
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
name|sc
operator|-=
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|sc
operator|!=
literal|0
condition|)
block|{
name|t
operator|=
name|mult
argument_list|(
name|q
argument_list|,
name|tenptr
argument_list|)
expr_stmt|;
name|s
operator|=
name|salloc
argument_list|(
name|cc
operator|=
name|length
argument_list|(
name|q
argument_list|)
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|t
argument_list|)
expr_stmt|;
while|while
condition|(
name|cc
operator|--
operator|>
literal|0
condition|)
name|sputc
argument_list|(
name|s
argument_list|,
name|sgetc
argument_list|(
name|t
argument_list|)
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|s
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|t
operator|=
name|div
argument_list|(
name|s
argument_list|,
name|tenptr
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|rem
argument_list|)
expr_stmt|;
return|return
operator|(
name|t
operator|)
return|;
block|}
return|return
operator|(
name|q
operator|)
return|;
block|}
end_function

begin_macro
name|tenot
argument_list|(
argument|p
argument_list|,
argument|sc
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|c
decl_stmt|,
name|f
decl_stmt|;
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|f
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|sfbeg
argument_list|(
name|p
argument_list|)
operator|==
literal|0
operator|)
operator|&&
operator|(
operator|(
name|p
operator|->
name|rd
operator|-
name|p
operator|->
name|beg
operator|-
literal|1
operator|)
operator|*
literal|2
operator|>=
name|sc
operator|)
condition|)
block|{
name|c
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|<
literal|10
operator|)
operator|&&
operator|(
name|f
operator|==
literal|1
operator|)
condition|)
name|printf
argument_list|(
literal|"0%d"
argument_list|,
name|c
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%d"
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|f
operator|=
literal|1
expr_stmt|;
name|TEST2
expr_stmt|;
block|}
if|if
condition|(
name|sc
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|(
name|p
operator|->
name|rd
operator|-
name|p
operator|->
name|beg
operator|)
operator|*
literal|2
operator|>
name|sc
condition|)
block|{
name|c
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%d."
argument_list|,
name|c
operator|/
literal|10
argument_list|)
expr_stmt|;
name|TEST2
expr_stmt|;
name|OUTC
argument_list|(
name|c
operator|%
literal|10
operator|+
literal|'0'
argument_list|)
expr_stmt|;
name|sc
operator|--
expr_stmt|;
block|}
else|else
block|{
name|OUTC
argument_list|(
literal|'.'
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|sc
operator|>
operator|(
name|p
operator|->
name|rd
operator|-
name|p
operator|->
name|beg
operator|)
operator|*
literal|2
condition|)
block|{
while|while
condition|(
name|sc
operator|>
operator|(
name|p
operator|->
name|rd
operator|-
name|p
operator|->
name|beg
operator|)
operator|*
literal|2
condition|)
block|{
name|OUTC
argument_list|(
literal|'0'
argument_list|)
expr_stmt|;
name|sc
operator|--
expr_stmt|;
block|}
block|}
while|while
condition|(
name|sc
operator|>
literal|1
condition|)
block|{
name|c
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|<
literal|10
condition|)
name|printf
argument_list|(
literal|"0%d"
argument_list|,
name|c
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%d"
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|sc
operator|-=
literal|2
expr_stmt|;
name|TEST2
expr_stmt|;
block|}
if|if
condition|(
name|sc
operator|==
literal|1
condition|)
block|{
name|OUTC
argument_list|(
name|sbackc
argument_list|(
name|p
argument_list|)
operator|/
literal|10
operator|+
literal|'0'
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|oneot
argument_list|(
argument|p
argument_list|,
argument|sc
argument_list|,
argument|ch
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|ch
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|blk
modifier|*
name|q
decl_stmt|;
name|q
operator|=
name|removc
argument_list|(
name|p
argument_list|,
name|sc
argument_list|)
expr_stmt|;
name|create
argument_list|(
name|strptr
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|strptr
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
name|length
argument_list|(
name|q
argument_list|)
operator|>
literal|0
condition|)
block|{
name|p
operator|=
name|add
argument_list|(
name|strptr
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|q
operator|=
name|p
expr_stmt|;
name|OUTC
argument_list|(
name|ch
argument_list|)
expr_stmt|;
block|}
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|hexot
argument_list|(
argument|p
argument_list|,
argument|flg
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|c
decl_stmt|;
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfeof
argument_list|(
name|p
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|sputc
argument_list|(
name|strptr
argument_list|,
literal|'0'
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
return|return;
block|}
name|c
operator|=
name|sgetc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|>=
literal|16
condition|)
block|{
name|printf
argument_list|(
literal|"hex digit> 16"
argument_list|)
expr_stmt|;
return|return;
block|}
name|sputc
argument_list|(
name|strptr
argument_list|,
name|c
operator|<
literal|10
condition|?
name|c
operator|+
literal|'0'
else|:
name|c
operator|-
literal|10
operator|+
literal|'A'
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|bigot
argument_list|(
argument|p
argument_list|,
argument|flg
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|blk
modifier|*
name|t
decl_stmt|,
modifier|*
name|q
decl_stmt|;
specifier|register
name|int
name|l
decl_stmt|;
name|int
name|neg
decl_stmt|;
if|if
condition|(
name|flg
operator|==
literal|1
condition|)
name|t
operator|=
name|salloc
argument_list|(
literal|0
argument_list|)
expr_stmt|;
else|else
block|{
name|t
operator|=
name|strptr
expr_stmt|;
name|l
operator|=
name|length
argument_list|(
name|strptr
argument_list|)
operator|+
name|fw
operator|-
literal|1
expr_stmt|;
block|}
name|neg
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|length
argument_list|(
name|p
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|sbackc
argument_list|(
name|p
argument_list|)
operator|<
literal|0
condition|)
block|{
name|neg
operator|=
literal|1
expr_stmt|;
name|chsign
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|length
argument_list|(
name|p
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|q
operator|=
name|div
argument_list|(
name|p
argument_list|,
name|tenptr
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|p
operator|=
name|q
expr_stmt|;
name|rewind
argument_list|(
name|rem
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|t
argument_list|,
name|sfeof
argument_list|(
name|rem
argument_list|)
condition|?
literal|'0'
else|:
name|sgetc
argument_list|(
name|rem
argument_list|)
operator|+
literal|'0'
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|rem
argument_list|)
expr_stmt|;
block|}
block|}
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|flg
operator|==
literal|1
condition|)
block|{
name|l
operator|=
name|fw1
operator|-
name|length
argument_list|(
name|t
argument_list|)
expr_stmt|;
if|if
condition|(
name|neg
operator|!=
literal|0
condition|)
block|{
name|l
operator|--
expr_stmt|;
name|sputc
argument_list|(
name|strptr
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
block|}
name|fsfile
argument_list|(
name|t
argument_list|)
expr_stmt|;
while|while
condition|(
name|l
operator|--
operator|>
literal|0
condition|)
name|sputc
argument_list|(
name|strptr
argument_list|,
literal|'0'
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfbeg
argument_list|(
name|t
argument_list|)
operator|==
literal|0
condition|)
name|sputc
argument_list|(
name|strptr
argument_list|,
name|sbackc
argument_list|(
name|t
argument_list|)
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|t
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|l
operator|-=
name|length
argument_list|(
name|strptr
argument_list|)
expr_stmt|;
while|while
condition|(
name|l
operator|--
operator|>
literal|0
condition|)
name|sputc
argument_list|(
name|strptr
argument_list|,
literal|'0'
argument_list|)
expr_stmt|;
if|if
condition|(
name|neg
operator|!=
literal|0
condition|)
block|{
name|sunputc
argument_list|(
name|strptr
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|strptr
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
block|}
block|}
name|sputc
argument_list|(
name|strptr
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_function
name|struct
name|blk
modifier|*
name|add
parameter_list|(
name|a1
parameter_list|,
name|a2
parameter_list|)
name|struct
name|blk
modifier|*
name|a1
decl_stmt|,
decl|*
name|a2
decl_stmt|;
end_function

begin_block
block|{
specifier|register
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
specifier|register
name|int
name|carry
decl_stmt|,
name|n
decl_stmt|;
name|int
name|size
decl_stmt|;
name|int
name|c
decl_stmt|,
name|n1
decl_stmt|,
name|n2
decl_stmt|;
name|size
operator|=
name|length
argument_list|(
name|a1
argument_list|)
operator|>
name|length
argument_list|(
name|a2
argument_list|)
condition|?
name|length
argument_list|(
name|a1
argument_list|)
else|:
name|length
argument_list|(
name|a2
argument_list|)
expr_stmt|;
name|p
operator|=
name|salloc
argument_list|(
name|size
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|a1
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|a2
argument_list|)
expr_stmt|;
name|carry
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|--
name|size
operator|>=
literal|0
condition|)
block|{
name|n1
operator|=
name|sfeof
argument_list|(
name|a1
argument_list|)
condition|?
literal|0
else|:
name|sgetc
argument_list|(
name|a1
argument_list|)
expr_stmt|;
name|n2
operator|=
name|sfeof
argument_list|(
name|a2
argument_list|)
condition|?
literal|0
else|:
name|sgetc
argument_list|(
name|a2
argument_list|)
expr_stmt|;
name|n
operator|=
name|n1
operator|+
name|n2
operator|+
name|carry
expr_stmt|;
if|if
condition|(
name|n
operator|>=
literal|100
condition|)
block|{
name|carry
operator|=
literal|1
expr_stmt|;
name|n
operator|-=
literal|100
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|n
operator|<
literal|0
condition|)
block|{
name|carry
operator|=
operator|-
literal|1
expr_stmt|;
name|n
operator|+=
literal|100
expr_stmt|;
block|}
else|else
name|carry
operator|=
literal|0
expr_stmt|;
name|sputc
argument_list|(
name|p
argument_list|,
name|n
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|carry
operator|!=
literal|0
condition|)
name|sputc
argument_list|(
name|p
argument_list|,
name|carry
argument_list|)
expr_stmt|;
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfbeg
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
block|{
while|while
condition|(
name|sfbeg
argument_list|(
name|p
argument_list|)
operator|==
literal|0
operator|&&
operator|(
name|c
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
operator|)
operator|==
literal|0
condition|)
empty_stmt|;
if|if
condition|(
name|c
operator|!=
literal|0
condition|)
name|salterc
argument_list|(
name|p
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|truncate
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfbeg
argument_list|(
name|p
argument_list|)
operator|==
literal|0
operator|&&
name|sbackc
argument_list|(
name|p
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
while|while
condition|(
operator|(
name|c
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
operator|)
operator|==
literal|99
condition|)
block|{
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
break|break;
block|}
name|sgetc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|salterc
argument_list|(
name|p
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|truncate
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|p
operator|)
return|;
block|}
end_block

begin_macro
name|eqk
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|struct
name|blk
modifier|*
name|p
decl_stmt|,
modifier|*
name|q
decl_stmt|;
specifier|register
name|int
name|skp
decl_stmt|;
name|int
name|skq
decl_stmt|;
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTYS
expr_stmt|;
name|q
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTYSR
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|skp
operator|=
name|sunputc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|skq
operator|=
name|sunputc
argument_list|(
name|q
argument_list|)
expr_stmt|;
if|if
condition|(
name|skp
operator|==
name|skq
condition|)
block|{
name|arg1
operator|=
name|p
expr_stmt|;
name|arg2
operator|=
name|q
expr_stmt|;
name|savk
operator|=
name|skp
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|skp
operator|<
name|skq
condition|)
block|{
name|savk
operator|=
name|skq
expr_stmt|;
name|p
operator|=
name|add0
argument_list|(
name|p
argument_list|,
name|skq
operator|-
name|skp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|savk
operator|=
name|skp
expr_stmt|;
name|q
operator|=
name|add0
argument_list|(
name|q
argument_list|,
name|skp
operator|-
name|skq
argument_list|)
expr_stmt|;
block|}
name|arg1
operator|=
name|p
expr_stmt|;
name|arg2
operator|=
name|q
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_function
name|struct
name|blk
modifier|*
name|removc
parameter_list|(
name|p
parameter_list|,
name|n
parameter_list|)
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
block|{
specifier|register
name|struct
name|blk
modifier|*
name|q
decl_stmt|,
modifier|*
name|r
decl_stmt|;
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
while|while
condition|(
name|n
operator|>
literal|1
condition|)
block|{
name|sgetc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|n
operator|-=
literal|2
expr_stmt|;
block|}
name|q
operator|=
name|salloc
argument_list|(
literal|2
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
name|sputc
argument_list|(
name|q
argument_list|,
name|sgetc
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|==
literal|1
condition|)
block|{
name|r
operator|=
name|div
argument_list|(
name|q
argument_list|,
name|tenptr
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|rem
argument_list|)
expr_stmt|;
name|q
operator|=
name|r
expr_stmt|;
block|}
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
return|return
operator|(
name|q
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|blk
modifier|*
name|scalint
parameter_list|(
name|p
parameter_list|)
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
block|{
specifier|register
name|int
name|n
decl_stmt|;
name|n
operator|=
name|sunputc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|p
operator|=
name|removc
argument_list|(
name|p
argument_list|,
name|n
argument_list|)
expr_stmt|;
return|return
operator|(
name|p
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|blk
modifier|*
name|scale
parameter_list|(
name|p
parameter_list|,
name|n
parameter_list|)
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
block|{
specifier|register
name|struct
name|blk
modifier|*
name|q
decl_stmt|,
modifier|*
name|s
decl_stmt|,
modifier|*
name|t
decl_stmt|;
name|t
operator|=
name|add0
argument_list|(
name|p
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|q
operator|=
name|salloc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|q
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|s
operator|=
name|exp
argument_list|(
name|inbas
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|q
operator|=
name|div
argument_list|(
name|t
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|rem
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|q
argument_list|,
name|n
argument_list|)
expr_stmt|;
return|return
operator|(
name|q
operator|)
return|;
block|}
end_function

begin_macro
name|subt
argument_list|()
end_macro

begin_block
block|{
name|arg1
operator|=
name|pop
argument_list|()
expr_stmt|;
name|EMPTYS
expr_stmt|;
name|savk
operator|=
name|sunputc
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
name|chsign
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|arg1
argument_list|,
name|savk
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|arg1
argument_list|)
expr_stmt|;
if|if
condition|(
name|eqk
argument_list|()
operator|!=
literal|0
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|binop
argument_list|(
literal|'+'
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|command
argument_list|()
end_macro

begin_block
block|{
name|int
name|c
decl_stmt|;
name|char
name|line
index|[
literal|100
index|]
decl_stmt|,
modifier|*
name|sl
decl_stmt|;
specifier|register
argument_list|(
operator|*
name|savint
argument_list|)
argument_list|()
decl_stmt|,
name|pid
decl_stmt|,
name|rpid
decl_stmt|;
name|int
name|retcode
decl_stmt|;
switch|switch
condition|(
name|c
operator|=
name|readc
argument_list|()
condition|)
block|{
case|case
literal|'<'
case|:
return|return
operator|(
name|cond
argument_list|(
name|NL
argument_list|)
operator|)
return|;
case|case
literal|'>'
case|:
return|return
operator|(
name|cond
argument_list|(
name|NG
argument_list|)
operator|)
return|;
case|case
literal|'='
case|:
return|return
operator|(
name|cond
argument_list|(
name|NE
argument_list|)
operator|)
return|;
default|default:
name|sl
operator|=
name|line
expr_stmt|;
operator|*
name|sl
operator|++
operator|=
name|c
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|readc
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
operator|*
name|sl
operator|++
operator|=
name|c
expr_stmt|;
operator|*
name|sl
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|pid
operator|=
name|fork
argument_list|()
operator|)
operator|==
literal|0
condition|)
block|{
name|execl
argument_list|(
literal|"/bin/sh"
argument_list|,
literal|"sh"
argument_list|,
literal|"-c"
argument_list|,
name|line
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0100
argument_list|)
expr_stmt|;
block|}
name|savint
operator|=
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|rpid
operator|=
name|wait
argument_list|(
operator|&
name|retcode
argument_list|)
operator|)
operator|!=
name|pid
operator|&&
name|rpid
operator|!=
operator|-
literal|1
condition|)
empty_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|savint
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"!\n"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
end_block

begin_macro
name|cond
argument_list|(
argument|c
argument_list|)
end_macro

begin_decl_stmt
name|char
name|c
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
specifier|register
name|char
name|cc
decl_stmt|;
if|if
condition|(
name|subt
argument_list|()
operator|!=
literal|0
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|p
operator|=
name|pop
argument_list|()
expr_stmt|;
name|sunputc
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
block|{
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'<'
operator|||
name|c
operator|==
literal|'>'
operator|||
name|c
operator|==
name|NE
condition|)
block|{
name|readc
argument_list|()
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|load
argument_list|()
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
else|else
block|{
if|if
condition|(
name|c
operator|==
literal|'='
condition|)
block|{
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|readc
argument_list|()
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
if|if
condition|(
name|c
operator|==
name|NE
condition|)
block|{
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|load
argument_list|()
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
name|fsfile
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|cc
operator|=
name|sbackc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cc
operator|<
literal|0
operator|&&
operator|(
name|c
operator|==
literal|'<'
operator|||
name|c
operator|==
name|NG
operator|)
operator|)
operator|||
operator|(
name|cc
operator|>
literal|0
operator|)
operator|&&
operator|(
name|c
operator|==
literal|'>'
operator|||
name|c
operator|==
name|NL
operator|)
condition|)
block|{
name|readc
argument_list|()
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|load
argument_list|()
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_block

begin_macro
name|load
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|c
decl_stmt|;
specifier|register
name|struct
name|blk
modifier|*
name|p
decl_stmt|,
modifier|*
name|q
decl_stmt|;
name|struct
name|blk
modifier|*
name|t
decl_stmt|,
modifier|*
name|s
decl_stmt|;
name|c
operator|=
name|readc
argument_list|()
operator|&
literal|0377
expr_stmt|;
name|sptr
operator|=
name|stable
index|[
name|c
index|]
expr_stmt|;
if|if
condition|(
name|sptr
operator|!=
literal|0
condition|)
block|{
name|p
operator|=
name|sptr
operator|->
name|val
expr_stmt|;
if|if
condition|(
name|c
operator|>=
name|ARRAYST
condition|)
block|{
name|q
operator|=
name|salloc
argument_list|(
name|length
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
while|while
condition|(
name|sfeof
argument_list|(
name|p
argument_list|)
operator|==
literal|0
condition|)
block|{
name|s
operator|=
name|getwd
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|==
literal|0
condition|)
block|{
name|putwd
argument_list|(
name|q
argument_list|,
operator|(
expr|struct
name|blk
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|t
operator|=
name|copy
argument_list|(
name|s
argument_list|,
name|length
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
name|putwd
argument_list|(
name|q
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
block|}
name|pushp
argument_list|(
name|q
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|q
operator|=
name|copy
argument_list|(
name|p
argument_list|,
name|length
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|q
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|q
operator|=
name|salloc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|sputc
argument_list|(
name|q
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pushp
argument_list|(
name|q
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_block

begin_macro
name|log2
argument_list|(
argument|n
argument_list|)
end_macro

begin_decl_stmt
name|long
name|n
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
name|n
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|i
operator|=
literal|31
expr_stmt|;
if|if
condition|(
name|n
operator|<
literal|0
condition|)
return|return
operator|(
name|i
operator|)
return|;
while|while
condition|(
operator|(
name|n
operator|=
name|n
operator|<<
literal|1
operator|)
operator|>
literal|0
condition|)
name|i
operator|--
expr_stmt|;
return|return
operator|(
operator|--
name|i
operator|)
return|;
block|}
end_block

begin_function
name|struct
name|blk
modifier|*
name|salloc
parameter_list|(
name|size
parameter_list|)
name|int
name|size
decl_stmt|;
block|{
specifier|register
name|struct
name|blk
modifier|*
name|hdr
decl_stmt|;
specifier|register
name|char
modifier|*
name|ptr
decl_stmt|;
name|all
operator|++
expr_stmt|;
name|nbytes
operator|+=
name|size
expr_stmt|;
name|ptr
operator|=
name|malloc
argument_list|(
operator|(
name|unsigned
operator|)
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptr
operator|==
literal|0
condition|)
block|{
name|garbage
argument_list|(
literal|"salloc"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr
operator|=
name|malloc
argument_list|(
operator|(
name|unsigned
operator|)
name|size
argument_list|)
operator|)
operator|==
literal|0
condition|)
name|ospace
argument_list|(
literal|"salloc"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|hdr
operator|=
name|hfree
operator|)
operator|==
literal|0
condition|)
name|hdr
operator|=
name|morehd
argument_list|()
expr_stmt|;
name|hfree
operator|=
operator|(
expr|struct
name|blk
operator|*
operator|)
name|hdr
operator|->
name|rd
expr_stmt|;
name|hdr
operator|->
name|rd
operator|=
name|hdr
operator|->
name|wt
operator|=
name|hdr
operator|->
name|beg
operator|=
name|ptr
expr_stmt|;
name|hdr
operator|->
name|last
operator|=
name|ptr
operator|+
name|size
expr_stmt|;
return|return
operator|(
name|hdr
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|blk
modifier|*
name|morehd
parameter_list|()
block|{
specifier|register
name|struct
name|blk
modifier|*
name|h
decl_stmt|,
modifier|*
name|kk
decl_stmt|;
name|headmor
operator|++
expr_stmt|;
name|nbytes
operator|+=
name|HEADSZ
expr_stmt|;
name|hfree
operator|=
name|h
operator|=
operator|(
expr|struct
name|blk
operator|*
operator|)
name|malloc
argument_list|(
name|HEADSZ
argument_list|)
expr_stmt|;
if|if
condition|(
name|hfree
operator|==
literal|0
condition|)
block|{
name|garbage
argument_list|(
literal|"morehd"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|hfree
operator|=
name|h
operator|=
operator|(
expr|struct
name|blk
operator|*
operator|)
name|malloc
argument_list|(
name|HEADSZ
argument_list|)
operator|)
operator|==
literal|0
condition|)
name|ospace
argument_list|(
literal|"headers"
argument_list|)
expr_stmt|;
block|}
name|kk
operator|=
name|h
expr_stmt|;
while|while
condition|(
name|h
operator|<
name|hfree
operator|+
operator|(
name|HEADSZ
operator|/
name|BLK
operator|)
condition|)
operator|(
name|h
operator|++
operator|)
operator|->
name|rd
operator|=
operator|(
name|char
operator|*
operator|)
operator|++
name|kk
expr_stmt|;
operator|(
operator|--
name|h
operator|)
operator|->
name|rd
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|hfree
operator|)
return|;
block|}
end_function

begin_comment
comment|/* sunputc(hptr) struct blk *hptr; { 	hptr->wt--; 	hptr->rd = hptr->wt; 	return(*hptr->wt); } */
end_comment

begin_function
name|struct
name|blk
modifier|*
name|copy
parameter_list|(
name|hptr
parameter_list|,
name|size
parameter_list|)
name|struct
name|blk
modifier|*
name|hptr
decl_stmt|;
name|int
name|size
decl_stmt|;
block|{
specifier|register
name|struct
name|blk
modifier|*
name|hdr
decl_stmt|;
specifier|register
name|unsigned
name|sz
decl_stmt|;
specifier|register
name|char
modifier|*
name|ptr
decl_stmt|;
name|all
operator|++
expr_stmt|;
name|nbytes
operator|+=
name|size
expr_stmt|;
name|sz
operator|=
name|length
argument_list|(
name|hptr
argument_list|)
expr_stmt|;
name|ptr
operator|=
name|nalloc
argument_list|(
name|hptr
operator|->
name|beg
argument_list|,
operator|(
name|unsigned
operator|)
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptr
operator|==
literal|0
condition|)
block|{
name|garbage
argument_list|(
literal|"copy"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr
operator|=
name|nalloc
argument_list|(
name|hptr
operator|->
name|beg
argument_list|,
operator|(
name|unsigned
operator|)
name|size
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"copy size %d\n"
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|ospace
argument_list|(
literal|"copy"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|hdr
operator|=
name|hfree
operator|)
operator|==
literal|0
condition|)
name|hdr
operator|=
name|morehd
argument_list|()
expr_stmt|;
name|hfree
operator|=
operator|(
expr|struct
name|blk
operator|*
operator|)
name|hdr
operator|->
name|rd
expr_stmt|;
name|hdr
operator|->
name|rd
operator|=
name|hdr
operator|->
name|beg
operator|=
name|ptr
expr_stmt|;
name|hdr
operator|->
name|last
operator|=
name|ptr
operator|+
name|size
expr_stmt|;
name|hdr
operator|->
name|wt
operator|=
name|ptr
operator|+
name|sz
expr_stmt|;
name|ptr
operator|=
name|hdr
operator|->
name|wt
expr_stmt|;
while|while
condition|(
name|ptr
operator|<
name|hdr
operator|->
name|last
condition|)
operator|*
name|ptr
operator|++
operator|=
literal|'\0'
expr_stmt|;
return|return
operator|(
name|hdr
operator|)
return|;
block|}
end_function

begin_macro
name|sdump
argument_list|(
argument|s1
argument_list|,
argument|hptr
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|blk
modifier|*
name|hptr
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|printf
argument_list|(
literal|"%s %o rd %o wt %o beg %o last %o\n"
argument_list|,
name|s1
argument_list|,
name|hptr
argument_list|,
name|hptr
operator|->
name|rd
argument_list|,
name|hptr
operator|->
name|wt
argument_list|,
name|hptr
operator|->
name|beg
argument_list|,
name|hptr
operator|->
name|last
argument_list|)
expr_stmt|;
name|p
operator|=
name|hptr
operator|->
name|beg
expr_stmt|;
while|while
condition|(
name|p
operator|<
name|hptr
operator|->
name|wt
condition|)
name|printf
argument_list|(
literal|"%d "
argument_list|,
operator|*
name|p
operator|++
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|seekc
argument_list|(
argument|hptr
argument_list|,
argument|n
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|blk
modifier|*
name|hptr
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|nn
decl_stmt|,
modifier|*
name|p
decl_stmt|;
name|nn
operator|=
name|hptr
operator|->
name|beg
operator|+
name|n
expr_stmt|;
if|if
condition|(
name|nn
operator|>
name|hptr
operator|->
name|last
condition|)
block|{
name|nbytes
operator|+=
name|nn
operator|-
name|hptr
operator|->
name|last
expr_stmt|;
name|p
operator|=
name|realloc
argument_list|(
name|hptr
operator|->
name|beg
argument_list|,
operator|(
name|unsigned
operator|)
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|==
literal|0
condition|)
block|{
name|hptr
operator|->
name|beg
operator|=
name|realloc
argument_list|(
name|hptr
operator|->
name|beg
argument_list|,
call|(
name|unsigned
call|)
argument_list|(
name|hptr
operator|->
name|last
operator|-
name|hptr
operator|->
name|beg
argument_list|)
argument_list|)
expr_stmt|;
name|garbage
argument_list|(
literal|"seekc"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|realloc
argument_list|(
name|hptr
operator|->
name|beg
argument_list|,
operator|(
name|unsigned
operator|)
name|n
argument_list|)
operator|)
operator|==
literal|0
condition|)
name|ospace
argument_list|(
literal|"seekc"
argument_list|)
expr_stmt|;
block|}
name|hptr
operator|->
name|beg
operator|=
name|p
expr_stmt|;
name|hptr
operator|->
name|wt
operator|=
name|hptr
operator|->
name|last
operator|=
name|hptr
operator|->
name|rd
operator|=
name|p
operator|+
name|n
expr_stmt|;
return|return;
block|}
name|hptr
operator|->
name|rd
operator|=
name|nn
expr_stmt|;
if|if
condition|(
name|nn
operator|>
name|hptr
operator|->
name|wt
condition|)
name|hptr
operator|->
name|wt
operator|=
name|nn
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|salterwd
argument_list|(
argument|hptr
argument_list|,
argument|n
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|wblk
modifier|*
name|hptr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|blk
modifier|*
name|n
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|hptr
operator|->
name|rdw
operator|==
name|hptr
operator|->
name|lastw
condition|)
name|more
argument_list|(
name|hptr
argument_list|)
expr_stmt|;
operator|*
name|hptr
operator|->
name|rdw
operator|++
operator|=
name|n
expr_stmt|;
if|if
condition|(
name|hptr
operator|->
name|rdw
operator|>
name|hptr
operator|->
name|wtw
condition|)
name|hptr
operator|->
name|wtw
operator|=
name|hptr
operator|->
name|rdw
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|more
argument_list|(
argument|hptr
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|blk
modifier|*
name|hptr
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|unsigned
name|size
decl_stmt|;
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
if|if
condition|(
operator|(
name|size
operator|=
operator|(
name|hptr
operator|->
name|last
operator|-
name|hptr
operator|->
name|beg
operator|)
operator|*
literal|2
operator|)
operator|==
literal|0
condition|)
name|size
operator|=
literal|1
expr_stmt|;
name|nbytes
operator|+=
name|size
operator|/
literal|2
expr_stmt|;
name|p
operator|=
name|realloc
argument_list|(
name|hptr
operator|->
name|beg
argument_list|,
operator|(
name|unsigned
operator|)
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|==
literal|0
condition|)
block|{
name|hptr
operator|->
name|beg
operator|=
name|realloc
argument_list|(
name|hptr
operator|->
name|beg
argument_list|,
call|(
name|unsigned
call|)
argument_list|(
name|hptr
operator|->
name|last
operator|-
name|hptr
operator|->
name|beg
argument_list|)
argument_list|)
expr_stmt|;
name|garbage
argument_list|(
literal|"more"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|realloc
argument_list|(
name|hptr
operator|->
name|beg
argument_list|,
operator|(
name|unsigned
operator|)
name|size
argument_list|)
operator|)
operator|==
literal|0
condition|)
name|ospace
argument_list|(
literal|"more"
argument_list|)
expr_stmt|;
block|}
name|hptr
operator|->
name|rd
operator|=
name|hptr
operator|->
name|rd
operator|-
name|hptr
operator|->
name|beg
operator|+
name|p
expr_stmt|;
name|hptr
operator|->
name|wt
operator|=
name|hptr
operator|->
name|wt
operator|-
name|hptr
operator|->
name|beg
operator|+
name|p
expr_stmt|;
name|hptr
operator|->
name|beg
operator|=
name|p
expr_stmt|;
name|hptr
operator|->
name|last
operator|=
name|p
operator|+
name|size
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|ospace
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|printf
argument_list|(
literal|"out of space: %s\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"all %ld rel %ld headmor %ld\n"
argument_list|,
name|all
argument_list|,
name|rel
argument_list|,
name|headmor
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"nbytes %ld\n"
argument_list|,
name|nbytes
argument_list|)
expr_stmt|;
name|sdump
argument_list|(
literal|"stk"
argument_list|,
operator|*
name|stkptr
argument_list|)
expr_stmt|;
name|abort
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|garbage
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|;
name|struct
name|blk
modifier|*
name|p
decl_stmt|,
modifier|*
name|q
decl_stmt|;
name|struct
name|sym
modifier|*
name|tmps
decl_stmt|;
name|int
name|ct
decl_stmt|;
comment|/*	printf("got to garbage %s\n",s);	*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TBLSZ
condition|;
name|i
operator|++
control|)
block|{
name|tmps
operator|=
name|stable
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|tmps
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|i
operator|<
name|ARRAYST
condition|)
block|{
do|do
block|{
name|p
operator|=
name|tmps
operator|->
name|val
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
name|p
operator|->
name|beg
operator|&
literal|01
operator|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"string %o\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|sdump
argument_list|(
literal|"odd beg"
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
name|redef
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|tmps
operator|=
name|tmps
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|tmps
operator|!=
literal|0
condition|)
do|;
continue|continue;
block|}
else|else
block|{
do|do
block|{
name|p
operator|=
name|tmps
operator|->
name|val
expr_stmt|;
name|rewind
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ct
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|q
operator|=
name|getwd
argument_list|(
name|p
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|ct
operator|++
expr_stmt|;
if|if
condition|(
name|q
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
operator|(
operator|(
name|int
operator|)
name|q
operator|->
name|beg
operator|&
literal|01
operator|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"array %o elt %d odd\n"
argument_list|,
name|i
operator|-
name|ARRAYST
argument_list|,
name|ct
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"tmps %o p %o\n"
argument_list|,
name|tmps
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|sdump
argument_list|(
literal|"elt"
argument_list|,
name|q
argument_list|)
expr_stmt|;
block|}
name|redef
argument_list|(
name|q
argument_list|)
expr_stmt|;
block|}
block|}
name|tmps
operator|=
name|tmps
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|tmps
operator|!=
literal|0
condition|)
do|;
block|}
block|}
block|}
block|}
end_block

begin_macro
name|redef
argument_list|(
argument|p
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|offset
expr_stmt|;
specifier|register
name|char
modifier|*
name|newp
decl_stmt|;
if|if
condition|(
operator|(
name|int
operator|)
name|p
operator|->
name|beg
operator|&
literal|01
condition|)
block|{
name|printf
argument_list|(
literal|"odd ptr %o hdr %o\n"
argument_list|,
name|p
operator|->
name|beg
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|ospace
argument_list|(
literal|"redef-bad"
argument_list|)
expr_stmt|;
block|}
name|newp
operator|=
name|realloc
argument_list|(
name|p
operator|->
name|beg
argument_list|,
call|(
name|unsigned
call|)
argument_list|(
name|p
operator|->
name|last
operator|-
name|p
operator|->
name|beg
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|newp
operator|==
name|NULL
condition|)
name|ospace
argument_list|(
literal|"redef"
argument_list|)
expr_stmt|;
name|offset
operator|=
name|newp
operator|-
name|p
operator|->
name|beg
expr_stmt|;
name|p
operator|->
name|beg
operator|=
name|newp
expr_stmt|;
name|p
operator|->
name|rd
operator|+=
name|offset
expr_stmt|;
name|p
operator|->
name|wt
operator|+=
name|offset
expr_stmt|;
name|p
operator|->
name|last
operator|+=
name|offset
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|release
argument_list|(
name|p
argument_list|)
specifier|register
expr|struct
name|blk
operator|*
name|p
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|rel
operator|++
expr_stmt|;
name|nbytes
operator|-=
name|p
operator|->
name|last
operator|-
name|p
operator|->
name|beg
expr_stmt|;
name|p
operator|->
name|rd
operator|=
operator|(
name|char
operator|*
operator|)
name|hfree
expr_stmt|;
name|hfree
operator|=
name|p
expr_stmt|;
name|free
argument_list|(
name|p
operator|->
name|beg
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|struct
name|blk
modifier|*
name|getwd
parameter_list|(
name|p
parameter_list|)
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
block|{
specifier|register
name|struct
name|wblk
modifier|*
name|wp
decl_stmt|;
name|wp
operator|=
operator|(
expr|struct
name|wblk
operator|*
operator|)
name|p
expr_stmt|;
if|if
condition|(
name|wp
operator|->
name|rdw
operator|==
name|wp
operator|->
name|wtw
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
operator|*
name|wp
operator|->
name|rdw
operator|++
operator|)
return|;
block|}
end_function

begin_macro
name|putwd
argument_list|(
argument|p
argument_list|,
argument|c
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|blk
modifier|*
name|p
decl_stmt|,
modifier|*
name|c
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|wblk
modifier|*
name|wp
decl_stmt|;
name|wp
operator|=
operator|(
expr|struct
name|wblk
operator|*
operator|)
name|p
expr_stmt|;
if|if
condition|(
name|wp
operator|->
name|wtw
operator|==
name|wp
operator|->
name|lastw
condition|)
name|more
argument_list|(
name|p
argument_list|)
expr_stmt|;
operator|*
name|wp
operator|->
name|wtw
operator|++
operator|=
name|c
expr_stmt|;
block|}
end_block

begin_function
name|struct
name|blk
modifier|*
name|lookwd
parameter_list|(
name|p
parameter_list|)
name|struct
name|blk
modifier|*
name|p
decl_stmt|;
block|{
specifier|register
name|struct
name|wblk
modifier|*
name|wp
decl_stmt|;
name|wp
operator|=
operator|(
expr|struct
name|wblk
operator|*
operator|)
name|p
expr_stmt|;
if|if
condition|(
name|wp
operator|->
name|rdw
operator|==
name|wp
operator|->
name|wtw
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
operator|*
name|wp
operator|->
name|rdw
operator|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|nalloc
parameter_list|(
name|p
parameter_list|,
name|nbytes
parameter_list|)
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
name|unsigned
name|nbytes
decl_stmt|;
block|{
name|char
modifier|*
name|malloc
parameter_list|()
function_decl|;
specifier|register
name|char
modifier|*
name|q
decl_stmt|,
modifier|*
name|r
decl_stmt|;
name|q
operator|=
name|r
operator|=
name|malloc
argument_list|(
name|nbytes
argument_list|)
expr_stmt|;
if|if
condition|(
name|q
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
while|while
condition|(
name|nbytes
operator|--
condition|)
operator|*
name|q
operator|++
operator|=
operator|*
name|p
operator|++
expr_stmt|;
return|return
operator|(
name|r
operator|)
return|;
block|}
end_function

end_unit

