begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"wm.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_wmsubs_c
init|=
literal|"$Header: xnwm.c,v 10.6 86/11/19 19:31:32 jg Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|default_frame_width
value|5
end_define

begin_define
define|#
directive|define
name|default_mask
value|MetaMask
end_define

begin_define
define|#
directive|define
name|default_menu_font
value|"8x13"
end_define

begin_define
define|#
directive|define
name|default_size_font
value|"8x13"
end_define

begin_define
define|#
directive|define
name|default_icon_font
value|"8x13"
end_define

begin_define
define|#
directive|define
name|default_iconify_delta
value|5
end_define

begin_define
define|#
directive|define
name|default_menu_x
value|0
end_define

begin_define
define|#
directive|define
name|default_menu_y
value|0
end_define

begin_comment
comment|/* Default button assignments; the numbers are indices into the    menuOp array */
end_comment

begin_define
define|#
directive|define
name|default_left
value|0
end_define

begin_define
define|#
directive|define
name|default_middle
value|1
end_define

begin_define
define|#
directive|define
name|default_right
value|2
end_define

begin_define
define|#
directive|define
name|unassigned_button
value|-1
end_define

begin_define
define|#
directive|define
name|popup_button
value|-2
end_define

begin_comment
comment|/* Convert 0,1,2 into XRight(Middle,Left)Mask */
end_comment

begin_define
define|#
directive|define
name|Button
parameter_list|(
name|i
parameter_list|)
value|(1<< (8 + (i)))
end_define

begin_include
include|#
directive|include
file|"wm.cursor"
end_include

begin_include
include|#
directive|include
file|"buttons.raster"
end_include

begin_decl_stmt
name|Pixmap
name|buttonPixmap
index|[
literal|3
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|menu
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
name|int
function_decl|(
modifier|*
name|ptrToFunc
function_decl|)
parameter_list|()
function_decl|;
end_typedef

begin_decl_stmt
name|int
name|Raise
argument_list|()
decl_stmt|,
name|Lower
argument_list|()
decl_stmt|,
name|Move
argument_list|()
decl_stmt|,
name|Resize
argument_list|()
decl_stmt|,
name|IconifyOrDeIconify
argument_list|()
decl_stmt|,
name|Select
argument_list|()
decl_stmt|,
name|Circulate
argument_list|()
decl_stmt|,
name|Assign
argument_list|()
decl_stmt|,
name|Unassigned
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|label
index|[]
init|=
block|{
literal|"Select"
block|,
literal|"Raise"
block|,
literal|"Move"
block|,
literal|"(De)Iconify"
block|,
literal|"Lower"
block|,
literal|"Resize"
block|,
literal|"Circulate"
block|,
literal|"Assign"
block|,
literal|""
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|ptrToFunc
name|menuOp
index|[]
init|=
block|{
name|Select
block|,
name|Raise
block|,
name|Move
block|,
name|IconifyOrDeIconify
block|,
name|Lower
block|,
name|Resize
block|,
name|Circulate
block|,
name|Assign
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|needsWindow
index|[]
init|=
block|{
name|TRUE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|FALSE
block|,
name|TRUE
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|canDoToMenu
index|[]
init|=
block|{
name|FALSE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|FALSE
block|,
name|TRUE
block|,
name|FALSE
block|,
name|TRUE
block|,
name|TRUE
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* "item" needs an extra entry at the end */
end_comment

begin_decl_stmt
name|Window
name|item
index|[]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|buttonFunc
index|[
literal|3
index|]
init|=
block|{
name|default_right
block|,
name|default_middle
block|,
name|default_left
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|itemcount
decl_stmt|,
name|itemWidth
decl_stmt|,
name|itemHeight
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|menuWidth
decl_stmt|,
name|menuHeight
decl_stmt|,
name|menuX
decl_stmt|,
name|menuY
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|code
index|[]
init|=
literal|"srmilzc"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* button assignment codes for command line */
end_comment

begin_decl_stmt
name|int
name|skinny
init|=
name|FALSE
decl_stmt|,
name|twoRows
init|=
name|FALSE
decl_stmt|,
name|vertical
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|lastMenuOp
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|doingOp
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|savex
decl_stmt|,
name|savey
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Where and what the popup menu obscures */
end_comment

begin_decl_stmt
name|Pixmap
name|saveScreen
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Pixmap
name|menuImage
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* What the popup menu looks like */
end_comment

begin_decl_stmt
name|int
name|popupSaved
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* True if a popup image is saved */
end_comment

begin_decl_stmt
name|int
name|reverse
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* whether to reverse the normal colors */
end_comment

begin_decl_stmt
name|int
name|buttonGXfunc
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* function to put up the button picture */
end_comment

begin_function_decl
name|char
modifier|*
name|index
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|Window
name|w
decl_stmt|;
name|BEvent
name|button
decl_stmt|;
name|int
name|raisedMenu
init|=
name|FALSE
decl_stmt|;
name|SetUpEverything
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|)
expr_stmt|;
while|while
condition|(
name|TRUE
condition|)
block|{
name|GetButton
argument_list|(
operator|&
name|button
argument_list|)
expr_stmt|;
comment|/* If it's a ButtonReleased ignore; it's just left 	       over from some old click */
if|if
condition|(
name|button
operator|.
name|type
operator|==
name|ButtonReleased
condition|)
continue|continue;
name|InterpretLocatorW
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|w
argument_list|,
name|button
operator|.
name|location
argument_list|)
expr_stmt|;
comment|/* If in background, raise menu or move back if just raised. 	       If using popup windows, map the popup window.  Only do this 	       as long as the button is not bound to Select */
if|if
condition|(
name|w
operator|==
literal|0
operator|&&
name|NonSelect
argument_list|(
operator|&
name|button
argument_list|)
condition|)
block|{
if|if
condition|(
name|popup
condition|)
name|MapPopup
argument_list|(
name|button
operator|.
name|location
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|raisedMenu
condition|)
name|XMoveWindow
argument_list|(
name|menu
argument_list|,
name|menuX
argument_list|,
name|menuY
argument_list|)
expr_stmt|;
else|else
name|XRaiseWindow
argument_list|(
name|menu
argument_list|)
expr_stmt|;
name|raisedMenu
operator|=
name|TRUE
expr_stmt|;
block|}
continue|continue;
block|}
else|else
name|raisedMenu
operator|=
name|FALSE
expr_stmt|;
comment|/* If in menu, do appropriate function */
if|if
condition|(
name|w
operator|==
name|menu
condition|)
block|{
name|ProcessMenuFunction
argument_list|(
operator|&
name|button
argument_list|)
expr_stmt|;
if|if
condition|(
name|popup
condition|)
name|UnmapPopup
argument_list|()
expr_stmt|;
continue|continue;
block|}
comment|/* Otherwise do preassigned button function */
name|DoButtonFunc
argument_list|(
operator|&
name|button
argument_list|,
name|w
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_macro
name|SetUpEverything
argument_list|(
argument|argc
argument_list|,
argument|argv
argument_list|)
end_macro

begin_decl_stmt
name|int
name|argc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
modifier|*
name|mfname
init|=
name|default_menu_font
decl_stmt|;
comment|/* font to use */
name|char
modifier|*
name|sfname
init|=
name|default_size_font
decl_stmt|;
comment|/* font to use */
name|char
modifier|*
name|ifname
init|=
name|default_icon_font
decl_stmt|;
comment|/* font to use */
name|char
modifier|*
name|location
init|=
literal|""
decl_stmt|;
name|char
name|display
index|[
literal|256
index|]
decl_stmt|;
comment|/* display to use */
name|frameWidth
operator|=
name|default_frame_width
expr_stmt|;
name|mask
operator|=
name|default_mask
expr_stmt|;
name|iconifyDelta
operator|=
name|default_iconify_delta
expr_stmt|;
name|menuX
operator|=
name|menuY
operator|=
literal|0
expr_stmt|;
name|freeze
operator|=
name|TRUE
expr_stmt|;
name|popup
operator|=
name|FALSE
expr_stmt|;
name|reverse
operator|=
name|FALSE
expr_stmt|;
name|GetDefaults
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
operator|&
name|mfname
argument_list|,
operator|&
name|sfname
argument_list|,
operator|&
name|ifname
argument_list|,
operator|&
name|location
argument_list|)
expr_stmt|;
name|ProcessArgs
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
name|display
argument_list|,
operator|&
name|mfname
argument_list|,
operator|&
name|sfname
argument_list|,
operator|&
name|ifname
argument_list|,
operator|&
name|location
argument_list|)
expr_stmt|;
name|OpenDisplay
argument_list|(
name|display
argument_list|)
expr_stmt|;
name|StoreCursors
argument_list|()
expr_stmt|;
name|StorePixmaps
argument_list|()
expr_stmt|;
name|SetUpFonts
argument_list|(
name|mfname
argument_list|,
name|sfname
argument_list|,
name|ifname
argument_list|)
expr_stmt|;
name|SetUpMenu
argument_list|(
name|location
argument_list|)
expr_stmt|;
name|GrabButtons
argument_list|()
expr_stmt|;
name|InitializeWm
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|GetDefaults
argument_list|(
argument|progname
argument_list|,
argument|mfname
argument_list|,
argument|sfname
argument_list|,
argument|ifname
argument_list|,
argument|location
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|progname
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
modifier|*
name|mfname
decl_stmt|,
modifier|*
modifier|*
name|sfname
decl_stmt|,
modifier|*
modifier|*
name|ifname
decl_stmt|,
modifier|*
modifier|*
name|location
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|option
decl_stmt|;
name|int
name|newmask
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"MenuFont"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
operator|*
name|mfname
operator|=
name|option
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"SizeFont"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
operator|*
name|sfname
operator|=
name|option
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"IconFont"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
operator|*
name|ifname
operator|=
name|option
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"ReverseVideo"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|option
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
name|reverse
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"FrameWidth"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|frameWidth
operator|=
name|atoi
argument_list|(
name|option
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"IconifyDelta"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|iconifyDelta
operator|=
name|atoi
argument_list|(
name|option
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"MenuFormat"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|index
argument_list|(
name|option
argument_list|,
literal|'t'
argument_list|)
operator|!=
name|NULL
condition|)
name|skinny
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|index
argument_list|(
name|option
argument_list|,
literal|'2'
argument_list|)
operator|!=
name|NULL
condition|)
name|twoRows
operator|=
name|skinny
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|index
argument_list|(
name|option
argument_list|,
literal|'v'
argument_list|)
operator|!=
name|NULL
condition|)
name|vertical
operator|=
name|skinny
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"Freeze"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|option
argument_list|,
literal|"off"
argument_list|)
operator|==
literal|0
condition|)
name|freeze
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"KeyCombination"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|index
argument_list|(
name|option
argument_list|,
literal|'c'
argument_list|)
operator|!=
name|NULL
condition|)
name|newmask
operator||=
name|ControlMask
expr_stmt|;
if|if
condition|(
name|index
argument_list|(
name|option
argument_list|,
literal|'s'
argument_list|)
operator|!=
name|NULL
condition|)
name|newmask
operator||=
name|ShiftMask
expr_stmt|;
if|if
condition|(
name|index
argument_list|(
name|option
argument_list|,
literal|'m'
argument_list|)
operator|!=
name|NULL
condition|)
name|newmask
operator||=
name|MetaMask
expr_stmt|;
if|if
condition|(
name|index
argument_list|(
name|option
argument_list|,
literal|'l'
argument_list|)
operator|!=
name|NULL
condition|)
name|newmask
operator||=
name|ShiftLockMask
expr_stmt|;
if|if
condition|(
name|index
argument_list|(
name|option
argument_list|,
literal|'n'
argument_list|)
operator|!=
name|NULL
condition|)
name|mask
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|newmask
condition|)
name|mask
operator|=
name|newmask
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"LeftButton"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|AssignButton
argument_list|(
name|LeftButton
argument_list|,
name|option
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"MiddleButton"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|AssignButton
argument_list|(
name|MiddleButton
argument_list|,
name|option
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"RightButton"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|AssignButton
argument_list|(
name|RightButton
argument_list|,
name|option
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
name|progname
argument_list|,
literal|"Geometry"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
operator|*
name|location
operator|=
name|option
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|ProcessArgs
argument_list|(
argument|argc
argument_list|,
argument|argv
argument_list|,
argument|display
argument_list|,
argument|mfname
argument_list|,
argument|sfname
argument_list|,
argument|ifname
argument_list|,
argument|location
argument_list|)
end_macro

begin_decl_stmt
name|int
name|argc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|display
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
modifier|*
name|mfname
decl_stmt|,
modifier|*
modifier|*
name|sfname
decl_stmt|,
modifier|*
modifier|*
name|ifname
decl_stmt|,
modifier|*
modifier|*
name|location
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|,
name|newmask
init|=
literal|0
decl_stmt|,
name|none
init|=
name|FALSE
decl_stmt|;
specifier|register
name|char
modifier|*
name|arg
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|argc
condition|;
name|i
operator|++
control|)
block|{
name|arg
operator|=
name|argv
index|[
name|i
index|]
expr_stmt|;
switch|switch
condition|(
operator|*
name|arg
condition|)
block|{
case|case
literal|'\0'
case|:
continue|continue;
case|case
literal|'-'
case|:
name|arg
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|arg
operator|==
literal|'\0'
condition|)
name|mask
operator|=
literal|0
expr_stmt|;
else|else
block|{
name|newmask
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
operator|*
name|arg
condition|;
name|arg
operator|++
control|)
block|{
switch|switch
condition|(
operator|*
name|arg
condition|)
block|{
case|case
literal|'h'
case|:
name|Syntax
argument_list|()
expr_stmt|;
break|break;
case|case
literal|'c'
case|:
name|newmask
operator||=
name|ControlMask
expr_stmt|;
break|break;
case|case
literal|'s'
case|:
name|newmask
operator||=
name|ShiftMask
expr_stmt|;
break|break;
case|case
literal|'m'
case|:
name|newmask
operator||=
name|MetaMask
expr_stmt|;
break|break;
case|case
literal|'l'
case|:
name|newmask
operator||=
name|ShiftLockMask
expr_stmt|;
break|break;
case|case
literal|'n'
case|:
name|none
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
literal|'f'
case|:
name|freeze
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
literal|'r'
case|:
name|reverse
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
literal|'2'
case|:
name|twoRows
operator|=
name|skinny
operator|=
name|TRUE
expr_stmt|;
name|vertical
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
literal|'v'
case|:
name|vertical
operator|=
name|skinny
operator|=
name|TRUE
expr_stmt|;
name|twoRows
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
name|skinny
operator|=
name|TRUE
expr_stmt|;
name|vertical
operator|=
name|twoRows
operator|=
name|FALSE
expr_stmt|;
break|break;
default|default:
name|Syntax
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|newmask
condition|)
name|mask
operator|=
name|newmask
expr_stmt|;
if|if
condition|(
name|none
condition|)
name|mask
operator|=
literal|0
expr_stmt|;
block|}
break|break;
case|case
literal|'@'
case|:
name|frameWidth
operator|=
name|atoi
argument_list|(
name|arg
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|frameWidth
operator|<
literal|0
operator|||
name|frameWidth
operator|>
literal|100
condition|)
block|{
name|errno
operator|=
name|EDOM
expr_stmt|;
name|perror
argument_list|(
literal|"xnwm:"
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'%'
case|:
name|iconifyDelta
operator|=
name|atoi
argument_list|(
name|arg
operator|+
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'='
case|:
operator|*
name|location
operator|=
name|arg
operator|+
literal|1
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|arg
index|[
literal|1
index|]
operator|==
literal|'='
condition|)
block|{
switch|switch
condition|(
operator|*
name|arg
condition|)
block|{
case|case
literal|'l'
case|:
name|AssignButton
argument_list|(
name|LeftButton
argument_list|,
name|arg
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'m'
case|:
name|AssignButton
argument_list|(
name|MiddleButton
argument_list|,
name|arg
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'r'
case|:
name|AssignButton
argument_list|(
name|RightButton
argument_list|,
name|arg
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
default|default:
name|Syntax
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|arg
index|[
literal|0
index|]
operator|==
literal|'f'
operator|&&
name|arg
index|[
literal|2
index|]
operator|==
literal|'='
condition|)
block|{
switch|switch
condition|(
name|arg
index|[
literal|1
index|]
condition|)
block|{
case|case
literal|'m'
case|:
operator|*
name|mfname
operator|=
name|arg
operator|+
literal|3
expr_stmt|;
break|break;
case|case
literal|'s'
case|:
operator|*
name|sfname
operator|=
name|arg
operator|+
literal|3
expr_stmt|;
break|break;
case|case
literal|'i'
case|:
operator|*
name|ifname
operator|=
name|arg
operator|+
literal|3
expr_stmt|;
break|break;
default|default:
name|Syntax
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
else|else
name|strcpy
argument_list|(
name|display
argument_list|,
name|arg
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|buttonFunc
index|[
name|RightButton
index|]
operator|==
name|popup_button
operator|||
name|buttonFunc
index|[
name|MiddleButton
index|]
operator|==
name|popup_button
operator|||
name|buttonFunc
index|[
name|LeftButton
index|]
operator|==
name|popup_button
condition|)
block|{
name|popup
operator|=
name|vertical
operator|=
name|skinny
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|AssignButton
argument_list|(
argument|which
argument_list|,
argument|arg
argument_list|)
end_macro

begin_decl_stmt
name|int
name|which
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|arg
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
modifier|*
name|ch
decl_stmt|;
if|if
condition|(
name|arg
operator|==
literal|'\0'
condition|)
block|{
name|buttonFunc
index|[
name|which
index|]
operator|=
name|unassigned_button
expr_stmt|;
return|return;
block|}
elseif|else
if|if
condition|(
name|arg
operator|==
literal|'p'
condition|)
block|{
name|buttonFunc
index|[
name|which
index|]
operator|=
name|popup_button
expr_stmt|;
return|return;
block|}
name|ch
operator|=
name|index
argument_list|(
name|code
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|ch
operator|==
name|NULL
condition|)
block|{
name|errno
operator|=
name|EDOM
expr_stmt|;
name|perror
argument_list|(
literal|"xnwm:"
argument_list|)
expr_stmt|;
block|}
else|else
name|buttonFunc
index|[
name|which
index|]
operator|=
name|ch
operator|-
name|code
expr_stmt|;
block|}
end_block

begin_macro
name|Syntax
argument_list|()
end_macro

begin_block
block|{
name|puts
argument_list|(
literal|"Usage: xnwm {-csmln} {-f} {-r} {-2vt} {@[framewidth]}"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"       {%[iconifyDelta]} {=[{+-}xoff[{+-}yoff]]}"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"       {l={srmilzcp}} {m={srmilzcp}} {r={srmilzcp}}"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"       {fm=menu_font} {fs=size_font} {fi=icon_font}"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"       {[host]:vs}"
argument_list|)
expr_stmt|;
comment|/* whew */
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|OpenDisplay
argument_list|(
argument|display
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|display
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|WindowInfo
name|winfo
decl_stmt|;
if|if
condition|(
name|XOpenDisplay
argument_list|(
name|display
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: Can't open display '%s'\n"
argument_list|,
literal|"xnwm"
argument_list|,
name|XDisplayName
argument_list|(
name|display
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|QueryWindow
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|winfo
argument_list|)
expr_stmt|;
name|screen_height
operator|=
name|winfo
operator|.
name|height
expr_stmt|;
name|screen_width
operator|=
name|winfo
operator|.
name|width
expr_stmt|;
name|XSelectInput
argument_list|(
name|RootWindow
argument_list|,
name|ButtonPressed
operator||
name|ButtonReleased
operator||
name|UnmapWindow
operator||
name|FocusChange
argument_list|)
expr_stmt|;
if|if
condition|(
name|reverse
condition|)
block|{
name|bgColor
operator|=
name|BlackPixel
expr_stmt|;
name|bgPixmap
operator|=
name|BlackPixmap
expr_stmt|;
name|fgColor
operator|=
name|WhitePixel
expr_stmt|;
name|fgPixmap
operator|=
name|WhitePixmap
expr_stmt|;
name|buttonGXfunc
operator|=
name|GXor
expr_stmt|;
block|}
else|else
block|{
name|bgColor
operator|=
name|WhitePixel
expr_stmt|;
name|bgPixmap
operator|=
name|WhitePixmap
expr_stmt|;
name|fgColor
operator|=
name|BlackPixel
expr_stmt|;
name|fgPixmap
operator|=
name|BlackPixmap
expr_stmt|;
name|buttonGXfunc
operator|=
name|GXand
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|StoreCursors
argument_list|()
end_macro

begin_block
block|{
name|wmCursor
operator|=
name|XCreateCursor
argument_list|(
name|nwm_width
argument_list|,
name|nwm_height
argument_list|,
operator|(
name|caddr_t
operator|)
name|nwm_bits
argument_list|,
operator|(
name|caddr_t
operator|)
name|NULL
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|fgColor
argument_list|,
name|bgColor
argument_list|,
name|GXcopyInverted
argument_list|)
expr_stmt|;
if|if
condition|(
name|wmCursor
operator|==
name|NULL
condition|)
block|{
name|Error
argument_list|(
literal|"Couldn't store wmCursor in StoreCursors"
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|StorePixmaps
argument_list|()
end_macro

begin_block
block|{
specifier|static
name|short
name|gray_bits
index|[]
init|=
block|{
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|}
decl_stmt|;
name|buttonPixmap
index|[
name|RightButton
index|]
operator|=
name|MakePixmap
argument_list|(
name|button_width
argument_list|,
name|button_height
argument_list|,
operator|(
name|caddr_t
operator|)
name|rbutton_bits
argument_list|,
name|bgColor
argument_list|,
name|fgColor
argument_list|)
expr_stmt|;
name|buttonPixmap
index|[
name|MiddleButton
index|]
operator|=
name|MakePixmap
argument_list|(
name|button_width
argument_list|,
name|button_height
argument_list|,
operator|(
name|caddr_t
operator|)
name|mbutton_bits
argument_list|,
name|bgColor
argument_list|,
name|fgColor
argument_list|)
expr_stmt|;
name|buttonPixmap
index|[
name|LeftButton
index|]
operator|=
name|MakePixmap
argument_list|(
name|button_width
argument_list|,
name|button_height
argument_list|,
operator|(
name|caddr_t
operator|)
name|lbutton_bits
argument_list|,
name|bgColor
argument_list|,
name|fgColor
argument_list|)
expr_stmt|;
name|gray
operator|=
name|MakePixmap
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|,
operator|(
name|caddr_t
operator|)
name|gray_bits
argument_list|,
name|bgColor
argument_list|,
name|fgColor
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|Pixmap
name|MakePixmap
parameter_list|(
name|width
parameter_list|,
name|height
parameter_list|,
name|bits
parameter_list|,
name|fg
parameter_list|,
name|bg
parameter_list|)
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
name|caddr_t
name|bits
decl_stmt|;
name|int
name|fg
decl_stmt|,
name|bg
decl_stmt|;
block|{
name|Bitmap
name|b
decl_stmt|;
name|Pixmap
name|p
decl_stmt|;
name|b
operator|=
name|XStoreBitmap
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|bits
argument_list|)
expr_stmt|;
if|if
condition|(
name|b
operator|==
name|NULL
condition|)
name|Error
argument_list|(
literal|"Couldn't store bitmap in MakePixmap"
argument_list|)
expr_stmt|;
name|p
operator|=
name|XMakePixmap
argument_list|(
name|b
argument_list|,
name|fg
argument_list|,
name|bg
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|==
name|NULL
condition|)
name|Error
argument_list|(
literal|"Couldn't make pixmap in MakePixmap"
argument_list|)
expr_stmt|;
name|XFreeBitmap
argument_list|(
name|b
argument_list|)
expr_stmt|;
return|return
name|p
return|;
block|}
end_function

begin_macro
name|SetUpFonts
argument_list|(
argument|mfname
argument_list|,
argument|sfname
argument_list|,
argument|ifname
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|mfname
decl_stmt|,
modifier|*
name|sfname
decl_stmt|,
modifier|*
name|ifname
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|menufont
operator|=
name|XGetFont
argument_list|(
name|mfname
argument_list|)
expr_stmt|;
if|if
condition|(
name|menufont
operator|==
name|NULL
condition|)
name|Error
argument_list|(
literal|"Couldn't store menu font in SetUpFont"
argument_list|)
expr_stmt|;
name|sizefont
operator|=
name|XGetFont
argument_list|(
name|sfname
argument_list|)
expr_stmt|;
if|if
condition|(
name|sizefont
operator|==
name|NULL
condition|)
name|Error
argument_list|(
literal|"Couldn't store size font in SetUpFont"
argument_list|)
expr_stmt|;
name|iconfont
operator|=
name|XGetFont
argument_list|(
name|ifname
argument_list|)
expr_stmt|;
if|if
condition|(
name|iconfont
operator|==
name|NULL
condition|)
name|Error
argument_list|(
literal|"Couldn't store icon font in SetUpFont"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|SetUpMenu
argument_list|(
argument|location
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|location
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|i
init|=
literal|0
decl_stmt|;
name|int
name|width
init|=
literal|0
decl_stmt|,
name|textwidth
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|char
name|xSign
decl_stmt|,
name|ySign
decl_stmt|;
while|while
condition|(
name|label
index|[
name|i
index|]
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|textwidth
operator|=
name|XQueryWidth
argument_list|(
name|label
index|[
name|i
index|]
argument_list|,
name|menufont
argument_list|)
expr_stmt|;
if|if
condition|(
name|textwidth
operator|==
literal|0
condition|)
block|{
name|Error
argument_list|(
literal|"Couldn't query string width in SetUpMenu"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|textwidth
operator|>
name|width
condition|)
name|width
operator|=
name|textwidth
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
name|itemcount
operator|=
name|i
expr_stmt|;
if|if
condition|(
name|skinny
condition|)
block|{
name|itemWidth
operator|=
literal|1
operator|+
literal|3
operator|+
name|width
operator|+
literal|3
operator|+
name|button_width
operator|+
literal|3
operator|+
literal|1
expr_stmt|;
block|}
else|else
name|itemWidth
operator|=
name|screen_width
operator|/
name|itemcount
expr_stmt|;
name|itemHeight
operator|=
literal|20
expr_stmt|;
if|if
condition|(
name|vertical
condition|)
block|{
name|menuWidth
operator|=
name|itemWidth
expr_stmt|;
name|menuHeight
operator|=
name|itemcount
operator|*
name|itemHeight
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|twoRows
condition|)
block|{
name|menuWidth
operator|=
name|itemWidth
operator|*
operator|(
operator|(
name|itemcount
operator|+
literal|1
operator|)
operator|>>
literal|1
operator|)
expr_stmt|;
name|menuHeight
operator|=
name|itemHeight
operator|*
literal|2
expr_stmt|;
block|}
else|else
block|{
name|menuWidth
operator|=
name|itemWidth
operator|*
name|itemcount
expr_stmt|;
name|menuHeight
operator|=
name|itemHeight
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|popup
operator|&&
operator|*
name|location
operator|!=
literal|'\0'
condition|)
block|{
comment|/* Interpret the location string */
name|InterpLocation
argument_list|(
name|location
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|xSign
argument_list|,
operator|&
name|ySign
argument_list|)
expr_stmt|;
if|if
condition|(
name|xSign
operator|==
literal|'+'
condition|)
name|menuX
operator|=
name|x
expr_stmt|;
else|else
name|menuX
operator|=
name|screen_width
operator|-
name|x
operator|-
name|menuWidth
expr_stmt|;
if|if
condition|(
name|ySign
operator|==
literal|'+'
condition|)
name|menuY
operator|=
name|y
expr_stmt|;
else|else
name|menuY
operator|=
name|screen_height
operator|-
name|y
operator|-
name|menuHeight
expr_stmt|;
block|}
name|menu
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
name|menuX
argument_list|,
name|menuY
argument_list|,
name|menuWidth
argument_list|,
name|menuHeight
argument_list|,
literal|1
argument_list|,
name|fgPixmap
argument_list|,
name|bgPixmap
argument_list|)
expr_stmt|;
if|if
condition|(
name|menu
operator|==
name|NULL
condition|)
name|Error
argument_list|(
literal|"Couldn't open menu in SetUpMenu"
argument_list|)
expr_stmt|;
name|XStoreName
argument_list|(
name|menu
argument_list|,
literal|"xnwm menu"
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|menu
argument_list|,
name|wmCursor
argument_list|)
expr_stmt|;
if|if
condition|(
name|popup
condition|)
name|XSelectInput
argument_list|(
name|menu
argument_list|,
name|LeaveWindow
argument_list|)
expr_stmt|;
else|else
name|XSelectInput
argument_list|(
name|menu
argument_list|,
name|ExposeWindow
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|popup
condition|)
block|{
name|x
operator|=
name|y
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|itemcount
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|twoRows
operator|&&
name|i
operator|==
operator|(
name|itemcount
operator|+
literal|1
operator|)
operator|>>
literal|1
condition|)
block|{
name|y
operator|=
name|itemHeight
expr_stmt|;
name|x
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|item
index|[
name|i
index|]
operator|=
name|XCreateWindow
argument_list|(
name|menu
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|itemWidth
argument_list|,
name|itemHeight
argument_list|,
literal|1
argument_list|,
name|fgPixmap
argument_list|,
name|bgPixmap
argument_list|)
expr_stmt|;
if|if
condition|(
name|item
index|[
name|i
index|]
operator|==
name|NULL
condition|)
name|Error
argument_list|(
literal|"Couldn't open item in SetUpMenu"
argument_list|)
expr_stmt|;
if|if
condition|(
name|vertical
condition|)
name|y
operator|+=
name|itemHeight
expr_stmt|;
else|else
name|x
operator|+=
name|itemWidth
expr_stmt|;
block|}
name|XMapSubwindows
argument_list|(
name|menu
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|menu
argument_list|)
expr_stmt|;
block|}
name|menuWidth
operator|+=
literal|2
expr_stmt|;
comment|/* Consider the border in from now on */
name|menuHeight
operator|+=
literal|2
expr_stmt|;
comment|/* Don't draw anything; the expose event will cause that */
block|}
end_block

begin_expr_stmt
name|InterpLocation
argument_list|(
name|location
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|xSign
argument_list|,
name|ySign
argument_list|)
specifier|register
name|char
operator|*
name|location
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
modifier|*
name|x
decl_stmt|,
modifier|*
name|y
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|xSign
decl_stmt|,
modifier|*
name|ySign
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|*
name|xSign
operator|=
operator|*
name|location
expr_stmt|;
switch|switch
condition|(
operator|*
name|location
condition|)
block|{
case|case
literal|'+'
case|:
case|case
literal|'-'
case|:
name|location
operator|++
expr_stmt|;
operator|*
name|x
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|location
operator|>=
literal|'0'
operator|&&
operator|*
name|location
operator|<=
literal|'9'
condition|)
block|{
operator|*
name|x
operator|=
literal|10
operator|*
operator|*
name|x
operator|+
operator|(
operator|*
name|location
operator|++
operator|-
literal|'0'
operator|)
expr_stmt|;
block|}
break|break;
default|default:
name|Syntax
argument_list|()
expr_stmt|;
break|break;
block|}
operator|*
name|ySign
operator|=
operator|*
name|location
expr_stmt|;
switch|switch
condition|(
operator|*
name|location
condition|)
block|{
case|case
literal|'+'
case|:
case|case
literal|'-'
case|:
name|location
operator|++
expr_stmt|;
operator|*
name|y
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|location
operator|>=
literal|'0'
operator|&&
operator|*
name|location
operator|<=
literal|'9'
condition|)
block|{
operator|*
name|y
operator|=
literal|10
operator|*
operator|*
name|y
operator|+
operator|(
operator|*
name|location
operator|++
operator|-
literal|'0'
operator|)
expr_stmt|;
block|}
break|break;
default|default:
name|Syntax
argument_list|()
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|*
name|location
operator|!=
literal|'\0'
condition|)
name|Syntax
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|GrabButtons
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|buttonFunc
index|[
name|i
index|]
operator|!=
name|unassigned_button
condition|)
block|{
name|status
operator|=
name|XGrabButton
argument_list|(
name|RootWindow
argument_list|,
name|wmCursor
argument_list|,
name|mask
operator||
name|Button
argument_list|(
name|i
argument_list|)
argument_list|,
name|ButtonPressed
operator||
name|ButtonReleased
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|NULL
condition|)
block|{
name|Error
argument_list|(
literal|"Couldn't grab button in GrabButtons"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_block

begin_macro
name|ProcessMenuFunction
argument_list|(
argument|button
argument_list|)
end_macro

begin_decl_stmt
name|BEvent
modifier|*
name|button
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|Window
name|w
decl_stmt|;
specifier|register
name|int
name|i
init|=
literal|0
decl_stmt|;
name|InterpretLocatorW
argument_list|(
name|menu
argument_list|,
operator|&
name|w
argument_list|,
name|button
operator|->
name|location
argument_list|)
expr_stmt|;
while|while
condition|(
name|item
index|[
name|i
index|]
operator|!=
name|NULL
operator|&&
name|item
index|[
name|i
index|]
operator|!=
name|w
condition|)
name|i
operator|++
expr_stmt|;
if|if
condition|(
name|item
index|[
name|i
index|]
condition|)
block|{
name|InvertButton
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|DoOperation
argument_list|(
name|i
argument_list|,
name|button
operator|->
name|detail
argument_list|)
expr_stmt|;
name|DisplayButton
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|lastMenuOp
operator|=
name|i
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|DoOperation
argument_list|(
argument|i
argument_list|,
argument|which
argument_list|)
end_macro

begin_decl_stmt
name|int
name|i
decl_stmt|,
name|which
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|BEvent
name|newbutton
decl_stmt|;
name|Window
name|w
decl_stmt|;
name|WindowInfo
name|winfo
decl_stmt|;
comment|/* First wait for the upbutton; if it doesn't occur or 	   occurs in a different window abort */
name|GetButton
argument_list|(
operator|&
name|newbutton
argument_list|)
expr_stmt|;
name|InterpretLocatorW
argument_list|(
name|menu
argument_list|,
operator|&
name|w
argument_list|,
name|newbutton
operator|.
name|location
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|MatchUp
argument_list|(
name|newbutton
argument_list|,
name|which
argument_list|)
operator|||
name|w
operator|!=
name|item
index|[
name|i
index|]
condition|)
return|return;
name|doingOp
operator|=
name|TRUE
expr_stmt|;
comment|/* If the function needs a window, get one */
if|if
condition|(
name|needsWindow
index|[
name|i
index|]
condition|)
block|{
name|status
operator|=
name|XGrabMouse
argument_list|(
name|RootWindow
argument_list|,
name|wmCursor
argument_list|,
name|ButtonPressed
operator||
name|ButtonReleased
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|NULL
condition|)
name|Error
argument_list|(
literal|"Couldn't grab mouse in DoOperation"
argument_list|)
expr_stmt|;
name|GetButton
argument_list|(
operator|&
name|newbutton
argument_list|)
expr_stmt|;
comment|/* This should be the same button as was pushed to select 	       the function */
if|if
condition|(
operator|!
name|MatchDown
argument_list|(
name|newbutton
argument_list|,
name|which
argument_list|)
condition|)
block|{
name|XUngrabMouse
argument_list|()
expr_stmt|;
name|doingOp
operator|=
name|FALSE
expr_stmt|;
return|return;
block|}
name|InterpretLocatorW
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|w
argument_list|,
name|newbutton
operator|.
name|location
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|==
literal|0
condition|)
name|w
operator|=
name|RootWindow
expr_stmt|;
name|QueryWindow
argument_list|(
name|w
argument_list|,
operator|&
name|winfo
argument_list|)
expr_stmt|;
block|}
comment|/* Now call the appropriate function */
if|if
condition|(
name|canDoToMenu
index|[
name|i
index|]
operator|||
name|w
operator|!=
name|menu
condition|)
block|{
call|(
modifier|*
name|menuOp
index|[
name|i
index|]
call|)
argument_list|(
name|which
argument_list|,
name|newbutton
operator|.
name|location
argument_list|,
name|w
argument_list|,
operator|&
name|winfo
argument_list|)
expr_stmt|;
block|}
name|doingOp
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|needsWindow
index|[
name|i
index|]
condition|)
name|XUngrabMouse
argument_list|()
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Returns whether or not the button is bound to Select */
end_comment

begin_function
name|int
name|NonSelect
parameter_list|(
name|button
parameter_list|)
name|BEvent
modifier|*
name|button
decl_stmt|;
block|{
name|int
name|which
init|=
name|button
operator|->
name|detail
operator|&
literal|0xff
decl_stmt|;
comment|/* 0, 1, or 2 */
name|int
name|func
init|=
name|buttonFunc
index|[
name|which
index|]
decl_stmt|;
return|return
operator|(
name|func
operator|<
literal|0
operator|||
name|menuOp
index|[
name|func
index|]
operator|!=
name|Select
operator|)
return|;
block|}
end_function

begin_macro
name|DoButtonFunc
argument_list|(
argument|button
argument_list|,
argument|w
argument_list|)
end_macro

begin_decl_stmt
name|BEvent
modifier|*
name|button
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|which
init|=
name|button
operator|->
name|detail
operator|&
literal|0xff
decl_stmt|;
comment|/* 0, 1, or 2 */
specifier|register
name|int
name|func
init|=
name|buttonFunc
index|[
name|which
index|]
decl_stmt|;
name|WindowInfo
name|winfo
decl_stmt|;
if|if
condition|(
name|func
operator|==
name|unassigned_button
condition|)
block|{
name|Unassigned
argument_list|()
expr_stmt|;
return|return;
block|}
comment|/* popup_button signifies the button to map the popup window */
if|if
condition|(
name|func
operator|==
name|popup_button
condition|)
block|{
name|MapPopup
argument_list|(
name|button
operator|->
name|location
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|w
operator|==
literal|0
condition|)
name|w
operator|=
name|RootWindow
expr_stmt|;
if|if
condition|(
name|needsWindow
index|[
name|func
index|]
condition|)
block|{
name|status
operator|=
name|XGrabMouse
argument_list|(
name|RootWindow
argument_list|,
name|wmCursor
argument_list|,
name|ButtonPressed
operator||
name|ButtonReleased
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't grab mouse in DoButtonFunc"
argument_list|)
expr_stmt|;
name|QueryWindow
argument_list|(
name|w
argument_list|,
operator|&
name|winfo
argument_list|)
expr_stmt|;
block|}
name|InvertButton
argument_list|(
name|func
argument_list|)
expr_stmt|;
call|(
modifier|*
name|menuOp
index|[
name|func
index|]
call|)
argument_list|(
name|which
argument_list|,
name|button
operator|->
name|location
argument_list|,
name|w
argument_list|,
operator|&
name|winfo
argument_list|)
expr_stmt|;
name|DisplayButton
argument_list|(
name|func
argument_list|)
expr_stmt|;
if|if
condition|(
name|needsWindow
index|[
name|func
index|]
condition|)
name|XUngrabMouse
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|Unassigned
argument_list|()
end_macro

begin_block
block|{
name|XFeep
argument_list|(
literal|3
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|MapPopup
argument_list|(
argument|loc
argument_list|)
end_macro

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|Window
name|w
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
comment|/* If there's not a saved popup image, create the buttons */
if|if
condition|(
operator|!
name|popupSaved
condition|)
block|{
comment|/* Create the items */
name|XDestroySubwindows
argument_list|(
name|menu
argument_list|)
expr_stmt|;
comment|/* Get rid of old items */
name|x
operator|=
name|y
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|itemcount
condition|;
name|i
operator|++
control|)
block|{
name|item
index|[
name|i
index|]
operator|=
name|XCreateWindow
argument_list|(
name|menu
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|itemWidth
argument_list|,
name|itemHeight
argument_list|,
literal|1
argument_list|,
name|fgPixmap
argument_list|,
name|bgPixmap
argument_list|)
expr_stmt|;
if|if
condition|(
name|item
index|[
name|i
index|]
operator|==
name|NULL
condition|)
name|Error
argument_list|(
literal|"Couldn't open item in MapPopup"
argument_list|)
expr_stmt|;
name|y
operator|+=
name|itemHeight
expr_stmt|;
block|}
name|XMapSubwindows
argument_list|(
name|menu
argument_list|)
expr_stmt|;
block|}
name|InterpretLocatorXY
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|loc
argument_list|)
expr_stmt|;
name|x
operator|-=
name|menuWidth
operator|>>
literal|1
expr_stmt|;
if|if
condition|(
name|lastMenuOp
operator|==
operator|-
literal|1
condition|)
name|y
operator|-=
name|menuHeight
operator|>>
literal|1
expr_stmt|;
else|else
name|y
operator|-=
name|lastMenuOp
operator|*
operator|(
name|itemHeight
operator|+
literal|1
operator|)
operator|+
operator|(
name|itemHeight
operator|>>
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
condition|)
name|x
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|x
operator|+
name|menuWidth
operator|>
name|screen_width
condition|)
block|{
name|x
operator|=
name|screen_width
operator|-
name|menuWidth
expr_stmt|;
block|}
if|if
condition|(
name|y
operator|<
literal|0
condition|)
name|y
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|y
operator|+
name|menuHeight
operator|>
name|screen_height
condition|)
block|{
name|y
operator|=
name|screen_height
operator|-
name|menuHeight
expr_stmt|;
block|}
if|if
condition|(
name|freeze
condition|)
block|{
name|savex
operator|=
name|x
expr_stmt|;
name|savey
operator|=
name|y
expr_stmt|;
name|XGrabServer
argument_list|()
expr_stmt|;
name|saveScreen
operator|=
name|XPixmapSave
argument_list|(
name|RootWindow
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|menuWidth
argument_list|,
name|menuHeight
argument_list|)
expr_stmt|;
if|if
condition|(
name|saveScreen
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't save screen in MapPopup"
argument_list|)
expr_stmt|;
block|}
name|XMoveWindow
argument_list|(
name|menu
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|menu
argument_list|)
expr_stmt|;
if|if
condition|(
name|popupSaved
condition|)
block|{
name|XPixmapPut
argument_list|(
name|menu
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|menuWidth
operator|-
literal|2
argument_list|,
name|menuHeight
operator|-
literal|2
argument_list|,
name|menuImage
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|itemcount
condition|;
name|i
operator|++
control|)
name|DisplayButton
argument_list|(
name|i
argument_list|)
expr_stmt|;
empty_stmt|;
name|menuImage
operator|=
name|XPixmapSave
argument_list|(
name|menu
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|menuWidth
operator|-
literal|2
argument_list|,
name|menuHeight
operator|-
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|menuImage
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't save menu in MapPopup"
argument_list|)
expr_stmt|;
block|}
name|QueryMouse
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|w
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|!=
name|menu
condition|)
name|UnmapPopup
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|UnmapPopup
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|i
decl_stmt|;
if|if
condition|(
name|freeze
operator|&&
name|saveScreen
operator|!=
literal|0
condition|)
block|{
name|XUnmapTransparent
argument_list|(
name|menu
argument_list|)
expr_stmt|;
name|XPixmapPut
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|savex
argument_list|,
name|savey
argument_list|,
name|menuWidth
argument_list|,
name|menuHeight
argument_list|,
name|saveScreen
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|saveScreen
argument_list|)
expr_stmt|;
name|XUngrabServer
argument_list|()
expr_stmt|;
name|saveScreen
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|XUnmapWindow
argument_list|(
name|menu
argument_list|)
expr_stmt|;
comment|/* Now set things up so we don't have to map everything next time */
if|if
condition|(
operator|!
name|popupSaved
condition|)
block|{
if|if
condition|(
name|menuImage
operator|!=
literal|0
condition|)
block|{
name|XDestroySubwindows
argument_list|(
name|menu
argument_list|)
expr_stmt|;
comment|/* Get rid of old items */
name|x
operator|=
name|y
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|itemcount
condition|;
name|i
operator|++
control|)
block|{
name|item
index|[
name|i
index|]
operator|=
name|XCreateTransparency
argument_list|(
name|menu
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|itemWidth
argument_list|,
name|itemHeight
argument_list|)
expr_stmt|;
if|if
condition|(
name|item
index|[
name|i
index|]
operator|==
name|NULL
condition|)
block|{
name|Error
argument_list|(
literal|"Couldn't open item in UnmapPopup"
argument_list|)
expr_stmt|;
block|}
name|y
operator|+=
name|itemHeight
expr_stmt|;
block|}
name|XMapSubwindows
argument_list|(
name|menu
argument_list|)
expr_stmt|;
name|popupSaved
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
block|}
end_block

begin_comment
comment|/* Undo the popup menu caching.  We can't just test popupSaved, since    it gets set in UnmapPopup and we might be called in between */
end_comment

begin_macro
name|UnsavePopup
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|menuImage
operator|!=
literal|0
condition|)
block|{
name|XFreePixmap
argument_list|(
name|menuImage
argument_list|)
expr_stmt|;
name|menuImage
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|popupSaved
condition|)
name|popupSaved
operator|=
name|FALSE
expr_stmt|;
block|}
end_block

begin_macro
name|InvertButton
argument_list|(
argument|i
argument_list|)
end_macro

begin_decl_stmt
name|int
name|i
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|item
index|[
name|i
index|]
operator|==
literal|0
condition|)
return|return;
name|XPixFill
argument_list|(
name|item
index|[
name|i
index|]
argument_list|,
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|,
literal|0
argument_list|,
operator|(
name|Bitmap
operator|)
literal|0
argument_list|,
name|GXinvert
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DisplayButton
argument_list|(
argument|i
argument_list|)
end_macro

begin_decl_stmt
name|int
name|i
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|j
decl_stmt|;
if|if
condition|(
name|item
index|[
name|i
index|]
operator|==
literal|0
condition|)
return|return;
name|XPixSet
argument_list|(
name|item
index|[
name|i
index|]
argument_list|,
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|,
name|bgColor
argument_list|)
expr_stmt|;
name|XText
argument_list|(
name|item
index|[
name|i
index|]
argument_list|,
literal|3
argument_list|,
literal|3
argument_list|,
name|label
index|[
name|i
index|]
argument_list|,
name|strlen
argument_list|(
name|label
index|[
name|i
index|]
argument_list|)
argument_list|,
name|menufont
argument_list|,
name|fgColor
argument_list|,
name|bgColor
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|buttonFunc
index|[
name|j
index|]
operator|==
name|i
condition|)
block|{
name|XPixmapPut
argument_list|(
name|item
index|[
name|buttonFunc
index|[
name|j
index|]
index|]
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|itemWidth
operator|-
name|button_width
operator|-
literal|3
argument_list|,
literal|4
argument_list|,
name|button_width
argument_list|,
name|button_height
argument_list|,
name|buttonPixmap
index|[
name|j
index|]
argument_list|,
name|buttonGXfunc
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_macro
name|IconifyOrDeIconify
argument_list|(
argument|which
argument_list|,
argument|loc
argument_list|,
argument|w
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
name|which
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|w
operator|==
name|RootWindow
condition|)
return|return;
comment|/* If we're trying to iconify an icon deiconify instead */
if|if
condition|(
name|winfo
operator|->
name|type
operator|==
name|IsIcon
condition|)
name|Deiconify
argument_list|(
name|which
argument_list|,
name|loc
argument_list|,
name|w
argument_list|,
name|winfo
argument_list|)
expr_stmt|;
else|else
name|Iconify
argument_list|(
name|which
argument_list|,
name|loc
argument_list|,
name|w
argument_list|,
name|winfo
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* ARGSUSED */
end_comment

begin_macro
name|Assign
argument_list|(
argument|which
argument_list|,
argument|loc
argument_list|,
argument|w
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
name|which
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
name|int
name|choice
decl_stmt|,
name|cleared
init|=
name|FALSE
decl_stmt|;
name|BEvent
name|newbutton
decl_stmt|;
name|Window
name|neww
decl_stmt|;
comment|/* First make sure the new click was in the menu; if not 	   clear that button */
if|if
condition|(
name|w
operator|!=
name|menu
condition|)
return|return;
comment|/* Now get rid of the old function assigned this button. But, don't 	   deassign the popup window button! */
name|choice
operator|=
name|buttonFunc
index|[
name|which
index|]
expr_stmt|;
if|if
condition|(
name|choice
operator|==
name|popup_button
condition|)
return|return;
if|if
condition|(
name|popup
condition|)
name|UnsavePopup
argument_list|()
expr_stmt|;
comment|/* The saved popup menu is invalid */
if|if
condition|(
name|choice
operator|>=
literal|0
condition|)
block|{
name|XClear
argument_list|(
name|item
index|[
name|choice
index|]
argument_list|)
expr_stmt|;
name|buttonFunc
index|[
name|which
index|]
operator|=
name|unassigned_button
expr_stmt|;
name|DisplayButton
argument_list|(
name|choice
argument_list|)
expr_stmt|;
name|cleared
operator|=
name|TRUE
expr_stmt|;
block|}
comment|/* Now find out which subwindow we were in */
name|InterpretLocatorW
argument_list|(
name|menu
argument_list|,
operator|&
name|w
argument_list|,
name|loc
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|item
index|[
name|i
index|]
operator|!=
name|NULL
operator|&&
name|item
index|[
name|i
index|]
operator|!=
name|w
condition|;
name|i
operator|++
control|)
block|{}
comment|/* Can't assign Assign */
if|if
condition|(
name|menuOp
index|[
name|i
index|]
operator|==
name|NULL
operator|||
name|menuOp
index|[
name|i
index|]
operator|==
name|Assign
condition|)
block|{
if|if
condition|(
name|cleared
condition|)
name|XUngrabButton
argument_list|(
name|mask
operator||
name|Button
argument_list|(
name|which
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* Now wait for the release; if it doesn't occur abort */
name|GetButton
argument_list|(
operator|&
name|newbutton
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|MatchUp
argument_list|(
name|newbutton
argument_list|,
name|which
argument_list|)
condition|)
block|{
if|if
condition|(
name|cleared
condition|)
name|XUngrabButton
argument_list|(
name|mask
operator||
name|Button
argument_list|(
name|which
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|InterpretLocatorW
argument_list|(
name|menu
argument_list|,
operator|&
name|neww
argument_list|,
name|loc
argument_list|)
expr_stmt|;
if|if
condition|(
name|neww
operator|!=
name|w
condition|)
block|{
if|if
condition|(
name|cleared
condition|)
name|XUngrabButton
argument_list|(
name|mask
operator||
name|Button
argument_list|(
name|which
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* Now assign that function to the button */
name|buttonFunc
index|[
name|which
index|]
operator|=
name|i
expr_stmt|;
name|XPixmapPut
argument_list|(
name|item
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|itemWidth
operator|-
name|button_width
operator|-
literal|3
argument_list|,
literal|4
argument_list|,
name|button_width
argument_list|,
name|button_height
argument_list|,
name|buttonPixmap
index|[
name|which
index|]
argument_list|,
name|buttonGXfunc
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|cleared
condition|)
block|{
comment|/* New assignment */
name|status
operator|=
name|XGrabButton
argument_list|(
name|RootWindow
argument_list|,
name|wmCursor
argument_list|,
name|mask
operator||
name|Button
argument_list|(
name|which
argument_list|)
argument_list|,
name|ButtonPressed
operator||
name|ButtonReleased
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't grab button in Assign"
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/* Returns whether or not this is a real event */
end_comment

begin_function
name|int
name|GetEvent
parameter_list|(
name|event
parameter_list|)
name|XEvent
modifier|*
name|event
decl_stmt|;
block|{
name|XButtonEvent
modifier|*
name|be
init|=
operator|(
name|XButtonEvent
operator|*
operator|)
name|event
decl_stmt|;
name|XLeaveWindowEvent
modifier|*
name|lwe
init|=
operator|(
name|XLeaveWindowEvent
operator|*
operator|)
name|event
decl_stmt|;
name|XExposeEvent
modifier|*
name|ee
init|=
operator|(
name|XExposeEvent
operator|*
operator|)
name|event
decl_stmt|;
name|XUnmapEvent
modifier|*
name|ue
init|=
operator|(
name|XUnmapEvent
operator|*
operator|)
name|event
decl_stmt|;
name|XFocusChangeEvent
modifier|*
name|fce
init|=
operator|(
name|XFocusChangeEvent
operator|*
operator|)
name|event
decl_stmt|;
name|WindowInfo
name|winfo
decl_stmt|;
name|char
modifier|*
name|iconName
decl_stmt|;
name|XNextEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
comment|/* If it's in the base window, no trouble */
if|if
condition|(
name|event
operator|->
name|window
operator|==
name|RootWindow
condition|)
block|{
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|FocusChange
condition|)
block|{
if|if
condition|(
name|fce
operator|->
name|detail
operator|==
name|EnterWindow
operator|&&
name|fce
operator|->
name|subwindow
operator|==
literal|0
condition|)
block|{
name|FocusOn
argument_list|(
name|RootWindow
argument_list|)
expr_stmt|;
name|FrameFocus
argument_list|()
expr_stmt|;
block|}
return|return
name|FALSE
return|;
block|}
elseif|else
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|UnmapWindow
condition|)
block|{
name|FrameFocus
argument_list|()
expr_stmt|;
comment|/* The background has changed */
return|return
name|FALSE
return|;
block|}
name|be
operator|->
name|detail
operator|&=
literal|0xff
expr_stmt|;
comment|/* mask out state of shift keys */
return|return
name|TRUE
return|;
block|}
comment|/* Is it the menu window? */
if|if
condition|(
name|event
operator|->
name|window
operator|==
name|menu
condition|)
block|{
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|ExposeWindow
condition|)
block|{
if|if
condition|(
name|ee
operator|->
name|subwindow
operator|!=
literal|0
condition|)
name|RefreshMenu
argument_list|(
name|ee
operator|->
name|subwindow
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|LeaveWindow
condition|)
block|{
if|if
condition|(
name|lwe
operator|->
name|subwindow
operator|==
literal|0
operator|&&
operator|!
name|doingOp
condition|)
name|UnmapPopup
argument_list|()
expr_stmt|;
return|return
name|FALSE
return|;
block|}
block|}
comment|/* Let's see if it's in an icon */
name|QueryWindow
argument_list|(
name|event
operator|->
name|window
argument_list|,
operator|&
name|winfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|winfo
operator|.
name|type
operator|!=
name|IsIcon
condition|)
return|return
name|FALSE
return|;
comment|/* Nope -- nothing */
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|UnmapWindow
condition|)
return|return
name|FALSE
return|;
name|status
operator|=
name|XFetchName
argument_list|(
name|winfo
operator|.
name|assoc_wind
argument_list|,
operator|&
name|iconName
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't fetch name in GetButton"
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|ExposeWindow
condition|)
block|{
comment|/* Just refresh the icon */
name|XClear
argument_list|(
name|ee
operator|->
name|window
argument_list|)
expr_stmt|;
if|if
condition|(
name|iconName
operator|!=
name|NULL
operator|&&
name|iconName
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|XText
argument_list|(
name|ee
operator|->
name|window
argument_list|,
literal|4
argument_list|,
literal|4
argument_list|,
name|iconName
argument_list|,
name|strlen
argument_list|(
name|iconName
argument_list|)
argument_list|,
name|iconfont
argument_list|,
name|fgColor
argument_list|,
name|bgColor
argument_list|)
expr_stmt|;
block|}
block|}
else|else
name|EditIconName
argument_list|(
operator|(
name|XKeyPressedEvent
operator|*
operator|)
name|be
argument_list|,
name|iconName
argument_list|)
expr_stmt|;
if|if
condition|(
name|iconName
condition|)
name|free
argument_list|(
name|iconName
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_macro
name|GetButton
argument_list|(
argument|event
argument_list|)
end_macro

begin_decl_stmt
name|BEvent
modifier|*
name|event
decl_stmt|;
end_decl_stmt

begin_block
block|{
while|while
condition|(
operator|!
name|GetEvent
argument_list|(
name|event
argument_list|)
condition|)
empty_stmt|;
block|}
end_block

begin_macro
name|RefreshMenu
argument_list|(
argument|w
argument_list|)
end_macro

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|itemcount
operator|&&
name|item
index|[
name|i
index|]
operator|!=
name|w
condition|;
name|i
operator|++
control|)
block|{}
if|if
condition|(
name|i
operator|>=
name|itemcount
condition|)
return|return;
name|DisplayButton
argument_list|(
name|i
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Error
argument_list|(
argument|string
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|string
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nxmwm: %s"
argument_list|,
name|string
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"xwm"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Flush
argument_list|()
end_macro

begin_block
block|{
name|XFlush
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|Sync
argument_list|()
end_macro

begin_block
block|{
name|XSync
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

