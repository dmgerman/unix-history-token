begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<X/mit-copyright.h>
end_include

begin_comment
comment|/* Copyright    Massachusetts Institute of Technology    1984, 1985	*/
end_comment

begin_include
include|#
directive|include
file|"gedit.h"
end_include

begin_include
include|#
directive|include
file|<X/Xlib.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_gx_c
init|=
literal|"$Header: gx.c,v 10.7 86/11/19 19:20:37 jg Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_function_decl
name|char
modifier|*
name|index
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|short
name|crbits
index|[
literal|16
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|,
name|trw
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Font
name|font
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|forepix
decl_stmt|,
name|backpix
decl_stmt|,
name|invplanes
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|mousechanged
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|short
name|mousex
decl_stmt|,
name|mousey
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|short
name|wminx
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* lower left of display window */
end_comment

begin_decl_stmt
name|short
name|wminy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|short
name|wmaxx
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* upper right of display window */
end_comment

begin_decl_stmt
name|short
name|wmaxy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|short
name|chrwid
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|short
name|chrhgt
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* command dispatch per key */
end_comment

begin_decl_stmt
name|fptr
name|dispatch
index|[
literal|256
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* used to fill in dispatch upon initialization */
end_comment

begin_decl_stmt
name|int
name|mleft
argument_list|()
decl_stmt|,
name|newlabel
argument_list|()
decl_stmt|,
name|stop
argument_list|()
decl_stmt|,
name|delobj
argument_list|()
decl_stmt|,
name|editobj
argument_list|()
decl_stmt|,
name|mright
argument_list|()
decl_stmt|,
name|toggle
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|quit
argument_list|()
decl_stmt|,
name|instantiate
argument_list|()
decl_stmt|,
name|newline
argument_list|()
decl_stmt|,
name|redisplay
argument_list|()
decl_stmt|,
name|mdown
argument_list|()
decl_stmt|,
name|neworg
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|mup
argument_list|()
decl_stmt|,
name|rotateobj
argument_list|()
decl_stmt|,
name|selobj
argument_list|()
decl_stmt|,
name|multiplier
argument_list|()
decl_stmt|,
name|setwindow
argument_list|()
decl_stmt|,
name|scale
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|letgo
argument_list|()
decl_stmt|,
name|rescale
argument_list|()
decl_stmt|,
name|newin
argument_list|()
decl_stmt|,
name|newout
argument_list|()
decl_stmt|,
name|snap
argument_list|()
decl_stmt|,
name|curup
argument_list|()
decl_stmt|,
name|curdown
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|home
argument_list|()
decl_stmt|,
name|setcolor
argument_list|()
decl_stmt|,
name|lastgo
argument_list|()
decl_stmt|,
name|angle
argument_list|()
decl_stmt|,
name|Help
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|editlast
argument_list|()
decl_stmt|,
name|scaleup
argument_list|()
decl_stmt|,
name|scaledn
argument_list|()
decl_stmt|,
name|fixwindow
argument_list|()
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|icmd
block|{
name|char
modifier|*
name|keys
decl_stmt|;
name|fptr
name|func
decl_stmt|;
block|}
name|cmds
index|[]
init|=
block|{
literal|"["
block|,
name|scaleup
block|,
literal|"]"
block|,
name|scaledn
block|,
literal|"Aa\001"
block|,
name|angle
block|,
literal|"Bb\002Hh\010"
block|,
name|mleft
block|,
literal|"Cc"
block|,
name|newlabel
block|,
literal|"\003\021"
block|,
name|stop
block|,
literal|"Dd\004"
block|,
name|delobj
block|,
literal|"Ee\005"
block|,
name|editobj
block|,
literal|"Ff\006"
block|,
name|mright
block|,
literal|"Gg"
block|,
name|toggle
block|,
literal|"\007"
block|,
name|quit
block|,
literal|"Hh"
block|,
name|Help
block|,
literal|"Ii"
block|,
name|instantiate
block|,
literal|"Ll"
block|,
name|newline
block|,
literal|"Mm"
block|,
name|lastgo
block|,
literal|"\014"
block|,
name|redisplay
block|,
literal|"Nn\016"
block|,
name|mdown
block|,
literal|"\017"
block|,
name|neworg
block|,
literal|"Pp\020"
block|,
name|mup
block|,
literal|"Rr\022"
block|,
name|rotateobj
block|,
literal|"Ss\023"
block|,
name|selobj
block|,
literal|"Uu\025"
block|,
name|multiplier
block|,
literal|"Ww\027"
block|,
name|setwindow
block|,
literal|"Xx\030"
block|,
name|scale
block|,
literal|"Zz\032 "
block|,
name|letgo
block|,
literal|"^"
block|,
name|editlast
block|,
literal|"*"
block|,
name|rescale
block|,
literal|"<"
block|,
name|newin
block|,
literal|">"
block|,
name|newout
block|,
literal|"!"
block|,
name|snap
block|,
literal|"+"
block|,
name|curup
block|,
literal|"-"
block|,
name|curdown
block|,
literal|"@"
block|,
name|home
block|,
literal|"\031"
block|,
name|fixwindow
block|,
name|NULL
block|,
name|NULL
block|}
struct|;
end_struct

begin_comment
comment|/* see if there is input ready from the user */
end_comment

begin_macro
name|UserReady
argument_list|()
end_macro

begin_block
block|{
name|XEvent
name|ev
decl_stmt|;
name|int
name|n
decl_stmt|,
name|x
decl_stmt|,
name|y
decl_stmt|;
name|Window
name|sub
decl_stmt|;
while|while
condition|(
name|XPending
argument_list|()
condition|)
block|{
name|XPeekEvent
argument_list|(
operator|&
name|ev
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|ev
operator|.
name|type
condition|)
block|{
case|case
name|MouseMoved
case|:
name|mousechanged
operator|=
literal|1
expr_stmt|;
name|XNextEvent
argument_list|(
operator|&
name|ev
argument_list|)
expr_stmt|;
name|XUpdateMouse
argument_list|(
name|w
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|sub
argument_list|)
expr_stmt|;
name|mousex
operator|=
name|x
expr_stmt|;
name|mousey
operator|=
name|y
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
case|case
name|ButtonPressed
case|:
return|return
operator|(
literal|1
operator|)
return|;
case|case
name|KeyPressed
case|:
name|XLookupMapping
argument_list|(
operator|(
name|XKeyPressedEvent
operator|*
operator|)
operator|(
operator|&
name|ev
operator|)
argument_list|,
operator|&
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|==
literal|1
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|XNextEvent
argument_list|(
operator|&
name|ev
argument_list|)
expr_stmt|;
break|break;
case|case
name|ExposeRegion
case|:
case|case
name|ExposeWindow
case|:
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_comment
comment|/* get character from user */
end_comment

begin_macro
name|UserChar
argument_list|()
end_macro

begin_block
block|{
name|XEvent
name|ev
decl_stmt|;
name|int
name|n
decl_stmt|;
name|char
modifier|*
name|str
decl_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|XNextEvent
argument_list|(
operator|&
name|ev
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|ev
operator|.
name|type
condition|)
block|{
case|case
name|ButtonPressed
case|:
name|n
operator|=
operator|(
operator|(
name|XButtonPressedEvent
operator|*
operator|)
operator|(
operator|&
name|ev
operator|)
operator|)
operator|->
name|detail
operator|&
name|ValueMask
expr_stmt|;
switch|switch
condition|(
name|n
condition|)
block|{
case|case
name|LeftButton
case|:
return|return
operator|(
literal|'l'
operator|)
return|;
case|case
name|MiddleButton
case|:
return|return
operator|(
literal|'z'
operator|)
return|;
case|case
name|RightButton
case|:
return|return
operator|(
literal|'s'
operator|)
return|;
block|}
break|break;
case|case
name|KeyPressed
case|:
name|str
operator|=
name|XLookupMapping
argument_list|(
operator|(
name|XKeyPressedEvent
operator|*
operator|)
operator|(
operator|&
name|ev
operator|)
argument_list|,
operator|&
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|==
literal|1
condition|)
return|return
operator|(
operator|*
name|str
operator|)
return|;
break|break;
case|case
name|ExposeRegion
case|:
return|return
operator|(
literal|'\014'
operator|)
return|;
case|case
name|ExposeWindow
case|:
if|if
condition|(
operator|(
operator|(
name|XExposeWindowEvent
operator|*
operator|)
operator|(
operator|&
name|ev
operator|)
operator|)
operator|->
name|width
operator|==
name|wmaxx
operator|&&
operator|(
operator|(
name|XExposeWindowEvent
operator|*
operator|)
operator|(
operator|&
name|ev
operator|)
operator|)
operator|->
name|height
operator|==
name|wmaxy
condition|)
return|return
operator|(
literal|'\014'
operator|)
return|;
name|wmaxx
operator|=
operator|(
operator|(
name|XExposeWindowEvent
operator|*
operator|)
operator|(
operator|&
name|ev
operator|)
operator|)
operator|->
name|width
expr_stmt|;
name|wmaxy
operator|=
operator|(
operator|(
name|XExposeWindowEvent
operator|*
operator|)
operator|(
operator|&
name|ev
operator|)
operator|)
operator|->
name|height
expr_stmt|;
name|XChangeWindow
argument_list|(
name|trw
argument_list|,
name|wmaxx
argument_list|,
name|wmaxy
operator|-
operator|(
name|chrhgt
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
return|return
operator|(
literal|'\031'
operator|)
return|;
block|}
block|}
block|}
end_block

begin_comment
comment|/* display grid */
end_comment

begin_macro
name|drawgrid
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|incrx
argument_list|,
argument|incry
argument_list|)
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|;
name|Vertex
name|vert
index|[
literal|2
index|]
decl_stmt|;
if|if
condition|(
name|incrx
operator|<=
literal|16
condition|)
block|{
name|vert
index|[
literal|0
index|]
operator|.
name|x
operator|=
name|x
expr_stmt|;
name|vert
index|[
literal|0
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
name|vert
index|[
literal|1
index|]
operator|.
name|x
operator|=
name|wmaxx
expr_stmt|;
name|vert
index|[
literal|1
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|y
operator|>
literal|0
condition|)
block|{
name|vert
index|[
literal|0
index|]
operator|.
name|y
operator|=
name|y
expr_stmt|;
name|vert
index|[
literal|1
index|]
operator|.
name|y
operator|=
name|y
expr_stmt|;
name|XDrawDashed
argument_list|(
name|trw
argument_list|,
name|vert
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|forepix
argument_list|,
name|XMakePattern
argument_list|(
literal|1
argument_list|,
name|incrx
argument_list|,
literal|1
argument_list|)
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
name|y
operator|-=
name|incry
expr_stmt|;
block|}
name|XClearVertexFlag
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|incry
operator|<=
literal|16
condition|)
block|{
name|vert
index|[
literal|0
index|]
operator|.
name|y
operator|=
name|y
expr_stmt|;
name|vert
index|[
literal|0
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
name|vert
index|[
literal|1
index|]
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|vert
index|[
literal|1
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|x
operator|<
name|wmaxx
condition|)
block|{
name|vert
index|[
literal|0
index|]
operator|.
name|x
operator|=
name|x
expr_stmt|;
name|vert
index|[
literal|1
index|]
operator|.
name|x
operator|=
name|x
expr_stmt|;
name|XDrawDashed
argument_list|(
name|trw
argument_list|,
name|vert
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|forepix
argument_list|,
name|XMakePattern
argument_list|(
literal|1
argument_list|,
name|incry
argument_list|,
literal|1
argument_list|)
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
name|x
operator|+=
name|incrx
expr_stmt|;
block|}
name|XClearVertexFlag
argument_list|()
expr_stmt|;
block|}
else|else
block|{
while|while
condition|(
name|x
operator|<
name|wmaxx
condition|)
block|{
for|for
control|(
name|i
operator|=
name|y
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|-=
name|incry
control|)
block|{
name|XPixSet
argument_list|(
name|trw
argument_list|,
name|x
argument_list|,
name|i
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|forepix
argument_list|)
expr_stmt|;
block|}
name|x
operator|+=
name|incrx
expr_stmt|;
block|}
block|}
block|}
end_block

begin_comment
comment|/* set up display adaptor for 80x25 alpha color, release keyboard */
end_comment

begin_macro
name|gexit
argument_list|()
end_macro

begin_block
block|{ }
end_block

begin_macro
name|track
argument_list|()
end_macro

begin_block
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|int
name|code
init|=
literal|0
decl_stmt|;
name|mousechanged
operator|=
literal|0
expr_stmt|;
name|x
operator|=
name|mousex
operator|*
name|cur_state
operator|.
name|dscale
expr_stmt|;
name|y
operator|=
operator|(
name|wmaxy
operator|-
name|mousey
operator|)
operator|*
name|cur_state
operator|.
name|dscale
expr_stmt|;
name|x
operator|+=
name|cur_state
operator|.
name|worgx
expr_stmt|;
name|y
operator|+=
name|cur_state
operator|.
name|worgy
expr_stmt|;
if|if
condition|(
name|x
operator|!=
name|cur_state
operator|.
name|curx
operator|||
name|y
operator|!=
name|cur_state
operator|.
name|cury
condition|)
block|{
if|if
condition|(
name|x
operator|>=
name|cur_state
operator|.
name|wmaxx
condition|)
name|x
operator|=
name|cur_state
operator|.
name|wmaxx
operator|-
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|x
operator|<
name|cur_state
operator|.
name|worgx
condition|)
name|x
operator|=
name|cur_state
operator|.
name|worgx
expr_stmt|;
if|if
condition|(
name|y
operator|>=
name|cur_state
operator|.
name|wmaxy
condition|)
name|y
operator|=
name|cur_state
operator|.
name|wmaxy
operator|-
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|y
operator|<
name|cur_state
operator|.
name|worgy
condition|)
name|y
operator|=
name|cur_state
operator|.
name|worgy
expr_stmt|;
name|cur_state
operator|.
name|curx
operator|=
name|x
expr_stmt|;
name|cur_state
operator|.
name|cury
operator|=
name|y
expr_stmt|;
block|}
return|return
operator|(
name|code
operator|)
return|;
block|}
end_block

begin_macro
name|remouse
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|doit
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|x
operator|>=
name|cur_state
operator|.
name|wmaxx
operator|||
name|x
operator|<
name|cur_state
operator|.
name|worgx
operator|||
name|y
operator|>=
name|cur_state
operator|.
name|wmaxy
operator|||
name|y
operator|<
name|cur_state
operator|.
name|worgy
condition|)
block|{
name|cur_state
operator|.
name|curx
operator|=
name|x
expr_stmt|;
name|cur_state
operator|.
name|cury
operator|=
name|y
expr_stmt|;
return|return
operator|(
name|RECENTER
operator|)
return|;
block|}
if|if
condition|(
name|doit
operator|||
operator|(
name|x
operator|!=
name|cur_state
operator|.
name|curx
operator|||
name|y
operator|!=
name|cur_state
operator|.
name|cury
operator|)
condition|)
block|{
name|cur_state
operator|.
name|curx
operator|=
name|x
expr_stmt|;
name|cur_state
operator|.
name|cury
operator|=
name|y
expr_stmt|;
name|x
operator|-=
name|cur_state
operator|.
name|worgx
expr_stmt|;
name|y
operator|-=
name|cur_state
operator|.
name|worgy
expr_stmt|;
name|x
operator|/=
name|cur_state
operator|.
name|dscale
expr_stmt|;
name|y
operator|/=
name|cur_state
operator|.
name|dscale
expr_stmt|;
name|y
operator|=
name|wmaxy
operator|-
name|y
expr_stmt|;
if|if
condition|(
name|x
operator|!=
name|mousex
operator|||
name|y
operator|!=
name|mousey
condition|)
block|{
name|XCondWarpMouse
argument_list|(
name|w
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|mousex
argument_list|,
name|mousey
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/*			XWarpMouse(w, x, y);			*/
name|XFlush
argument_list|()
expr_stmt|;
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_comment
comment|/* set up display adaptor for graphics and initialize keyboard */
end_comment

begin_function
name|char
modifier|*
name|gentry
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|char
modifier|*
name|prog
decl_stmt|;
name|char
modifier|*
name|fname
init|=
name|NULL
decl_stmt|;
specifier|register
name|struct
name|icmd
modifier|*
name|p
decl_stmt|;
specifier|register
name|char
modifier|*
name|q
decl_stmt|;
name|WindowInfo
name|winfo
decl_stmt|;
name|FontInfo
name|finfo
decl_stmt|;
name|char
modifier|*
name|fore_color
decl_stmt|,
modifier|*
name|back_color
decl_stmt|,
modifier|*
name|brdr_color
decl_stmt|,
modifier|*
name|font_name
decl_stmt|;
name|char
modifier|*
name|geometry
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|display
init|=
name|NULL
decl_stmt|;
name|int
name|reverse
init|=
literal|0
decl_stmt|;
name|Color
name|cdef
decl_stmt|;
name|char
name|def
index|[
literal|32
index|]
decl_stmt|;
name|OpaqueFrame
name|frame
decl_stmt|;
comment|/* fill in command dispatch table */
for|for
control|(
name|p
operator|=
name|cmds
init|;
name|p
operator|->
name|keys
operator|!=
name|NULL
condition|;
name|p
operator|++
control|)
for|for
control|(
name|q
operator|=
name|p
operator|->
name|keys
init|;
operator|*
name|q
condition|;
name|q
operator|++
control|)
name|dispatch
index|[
operator|*
name|q
operator|&
literal|0xFF
index|]
operator|=
name|p
operator|->
name|func
expr_stmt|;
name|prog
operator|=
operator|*
name|argv
expr_stmt|;
if|if
condition|(
operator|(
name|q
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"ReverseVideo"
argument_list|)
operator|)
operator|&&
name|strcmp
argument_list|(
name|q
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
name|reverse
operator|=
literal|1
expr_stmt|;
name|frame
operator|.
name|bdrwidth
operator|=
literal|2
expr_stmt|;
if|if
condition|(
name|q
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"BorderWidth"
argument_list|)
condition|)
name|frame
operator|.
name|bdrwidth
operator|=
name|atoi
argument_list|(
name|q
argument_list|)
expr_stmt|;
name|fore_color
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"ForeGround"
argument_list|)
expr_stmt|;
name|back_color
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"BackGround"
argument_list|)
expr_stmt|;
name|brdr_color
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"Border"
argument_list|)
expr_stmt|;
name|font_name
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"BodyFont"
argument_list|)
expr_stmt|;
for|for
control|(
name|argv
operator|++
init|;
operator|--
name|argc
condition|;
name|argv
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-rv"
argument_list|)
condition|)
block|{
name|reverse
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-fg"
argument_list|)
operator|&&
name|argc
condition|)
block|{
name|argv
operator|++
expr_stmt|;
name|argc
operator|--
expr_stmt|;
name|fore_color
operator|=
operator|*
name|argv
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-bg"
argument_list|)
operator|&&
name|argc
condition|)
block|{
name|argv
operator|++
expr_stmt|;
name|argc
operator|--
expr_stmt|;
name|back_color
operator|=
operator|*
name|argv
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-bd"
argument_list|)
operator|&&
name|argc
condition|)
block|{
name|argv
operator|++
expr_stmt|;
name|argc
operator|--
expr_stmt|;
name|brdr_color
operator|=
operator|*
name|argv
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-fn"
argument_list|)
operator|&&
name|argc
condition|)
block|{
name|argv
operator|++
expr_stmt|;
name|argc
operator|--
expr_stmt|;
name|font_name
operator|=
operator|*
name|argv
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
operator|*
name|argv
operator|==
literal|'='
condition|)
block|{
name|geometry
operator|=
operator|*
name|argv
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|index
argument_list|(
operator|*
name|argv
argument_list|,
literal|':'
argument_list|)
condition|)
block|{
name|display
operator|=
operator|*
name|argv
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
operator|*
name|argv
operator|==
literal|'-'
operator|||
name|fname
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"usage: xgedit [-rv] [-fn<font>] [-fg<color>] [-bg<color>] [-bd<color>] [=<geometry>] [host:display] [file]\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fname
operator|=
operator|*
name|argv
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|XOpenDisplay
argument_list|(
name|display
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: Can't open display '%s'\n"
argument_list|,
name|prog
argument_list|,
name|XDisplayName
argument_list|(
name|display
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|reverse
condition|)
block|{
name|forepix
operator|=
name|WhitePixel
expr_stmt|;
name|backpix
operator|=
name|BlackPixel
expr_stmt|;
name|frame
operator|.
name|background
operator|=
name|BlackPixmap
expr_stmt|;
name|frame
operator|.
name|border
operator|=
name|WhitePixmap
expr_stmt|;
block|}
else|else
block|{
name|forepix
operator|=
name|BlackPixel
expr_stmt|;
name|backpix
operator|=
name|WhitePixel
expr_stmt|;
name|frame
operator|.
name|background
operator|=
name|WhitePixmap
expr_stmt|;
name|frame
operator|.
name|border
operator|=
name|BlackPixmap
expr_stmt|;
block|}
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|fore_color
operator|&&
name|XParseColor
argument_list|(
name|fore_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|forepix
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
if|if
condition|(
name|back_color
operator|&&
name|XParseColor
argument_list|(
name|back_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|frame
operator|.
name|background
operator|=
name|XMakeTile
argument_list|(
name|backpix
operator|=
name|cdef
operator|.
name|pixel
argument_list|)
expr_stmt|;
if|if
condition|(
name|brdr_color
operator|&&
name|XParseColor
argument_list|(
name|brdr_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|frame
operator|.
name|border
operator|=
name|XMakeTile
argument_list|(
name|cdef
operator|.
name|pixel
argument_list|)
expr_stmt|;
block|}
name|invplanes
operator|=
name|forepix
operator|^
name|backpix
expr_stmt|;
if|if
condition|(
name|font_name
operator|==
name|NULL
condition|)
name|font_name
operator|=
literal|"8x13"
expr_stmt|;
name|font
operator|=
name|XGetFont
argument_list|(
name|font_name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|font
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"no such font: %s\n"
argument_list|,
name|font_name
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|XQueryFont
argument_list|(
name|font
argument_list|,
operator|&
name|finfo
argument_list|)
expr_stmt|;
name|XQueryWindow
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|winfo
argument_list|)
expr_stmt|;
name|chrwid
operator|=
name|finfo
operator|.
name|width
expr_stmt|;
name|chrhgt
operator|=
name|finfo
operator|.
name|height
expr_stmt|;
name|frame
operator|.
name|x
operator|=
literal|1
expr_stmt|;
name|frame
operator|.
name|y
operator|=
literal|1
expr_stmt|;
name|frame
operator|.
name|width
operator|=
literal|80
operator|*
name|chrwid
expr_stmt|;
if|if
condition|(
name|frame
operator|.
name|width
operator|+
operator|(
name|frame
operator|.
name|bdrwidth
operator|<<
literal|1
operator|)
operator|>
name|winfo
operator|.
name|width
condition|)
name|frame
operator|.
name|width
operator|=
name|winfo
operator|.
name|width
operator|-
operator|(
name|frame
operator|.
name|bdrwidth
operator|<<
literal|1
operator|)
expr_stmt|;
name|frame
operator|.
name|height
operator|=
literal|25
operator|*
name|chrhgt
expr_stmt|;
if|if
condition|(
name|frame
operator|.
name|height
operator|+
operator|(
name|frame
operator|.
name|bdrwidth
operator|<<
literal|1
operator|)
operator|>
name|winfo
operator|.
name|height
condition|)
name|frame
operator|.
name|height
operator|=
name|winfo
operator|.
name|height
operator|-
operator|(
name|frame
operator|.
name|bdrwidth
operator|<<
literal|1
operator|)
expr_stmt|;
name|sprintf
argument_list|(
name|def
argument_list|,
literal|"=%dx%d+1+1"
argument_list|,
name|frame
operator|.
name|width
argument_list|,
name|frame
operator|.
name|height
argument_list|)
expr_stmt|;
name|wminx
operator|=
literal|0
expr_stmt|;
name|wminy
operator|=
literal|2
operator|*
name|chrhgt
expr_stmt|;
name|w
operator|=
name|XCreate
argument_list|(
name|prog
argument_list|,
name|prog
argument_list|,
name|geometry
argument_list|,
name|def
argument_list|,
operator|&
name|frame
argument_list|,
literal|5
operator|*
name|chrwid
argument_list|,
name|wminy
operator|+
literal|5
operator|*
name|chrhgt
argument_list|)
expr_stmt|;
name|wmaxx
operator|=
name|frame
operator|.
name|width
expr_stmt|;
name|wmaxy
operator|=
name|frame
operator|.
name|height
expr_stmt|;
name|trw
operator|=
name|XCreateTransparency
argument_list|(
name|w
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|wmaxx
argument_list|,
name|wmaxy
operator|-
operator|(
name|chrhgt
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|trw
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|w
argument_list|,
name|XCreateCursor
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|,
name|crbits
argument_list|,
name|crbits
argument_list|,
literal|7
argument_list|,
literal|7
argument_list|,
name|backpix
argument_list|,
name|forepix
argument_list|,
name|GXnoop
argument_list|)
argument_list|)
expr_stmt|;
name|XSetResizeHint
argument_list|(
name|w
argument_list|,
literal|1
argument_list|,
name|wminy
operator|+
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|w
argument_list|,
name|KeyPressed
operator||
name|ButtonPressed
operator||
name|MouseMoved
operator||
name|ExposeRegion
argument_list|)
expr_stmt|;
name|mousechanged
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|fname
operator|)
return|;
block|}
end_function

begin_macro
name|Beep
argument_list|()
end_macro

begin_block
block|{
name|XFeep
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* give status info on second to last line */
end_comment

begin_macro
name|banner
argument_list|()
end_macro

begin_block
block|{
name|char
name|temp
index|[
literal|100
index|]
decl_stmt|;
if|if
condition|(
name|cur_state
operator|.
name|curobj
operator|!=
name|NULL
condition|)
name|sprintf
argument_list|(
name|temp
argument_list|,
literal|"XGEDIT %d:%d    %c %s"
argument_list|,
name|cur_state
operator|.
name|mscale
argument_list|,
name|cur_state
operator|.
name|dscale
argument_list|,
name|cur_state
operator|.
name|curobj
operator|->
name|modified
condition|?
literal|'*'
else|:
literal|' '
argument_list|,
name|cur_state
operator|.
name|curobj
operator|->
name|name
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|temp
argument_list|,
literal|"XGEDIT %d:%d"
argument_list|,
name|cur_state
operator|.
name|mscale
argument_list|,
name|cur_state
operator|.
name|dscale
argument_list|)
expr_stmt|;
name|XPixSet
argument_list|(
name|w
argument_list|,
literal|0
argument_list|,
name|wmaxy
operator|-
operator|(
name|chrhgt
operator|<<
literal|1
operator|)
argument_list|,
name|wmaxx
argument_list|,
name|chrhgt
argument_list|,
name|backpix
argument_list|)
expr_stmt|;
name|disp_str
argument_list|(
name|temp
argument_list|,
literal|0
argument_list|,
name|chrhgt
argument_list|,
literal|1
argument_list|,
name|HIGHLIGHT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* display a string at the specified position, return lenth */
end_comment

begin_macro
name|disp_str
argument_list|(
argument|s
argument_list|,
argument|x
argument_list|,
argument|y
argument_list|,
argument|reverse
argument_list|,
argument|xorflag
argument_list|,
argument|info
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|len
decl_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|reverse
condition|)
name|XText
argument_list|(
name|info
condition|?
name|w
else|:
name|trw
argument_list|,
name|x
argument_list|,
name|wmaxy
operator|-
name|y
operator|-
name|chrhgt
argument_list|,
name|s
argument_list|,
name|len
argument_list|,
name|font
argument_list|,
name|backpix
argument_list|,
name|forepix
argument_list|)
expr_stmt|;
else|else
name|XTextMaskPad
argument_list|(
name|info
condition|?
name|w
else|:
name|trw
argument_list|,
name|x
argument_list|,
name|wmaxy
operator|-
name|y
operator|-
name|chrhgt
argument_list|,
name|s
argument_list|,
name|len
argument_list|,
name|font
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|forepix
argument_list|,
name|xorflag
condition|?
name|GXinvert
else|:
name|GXcopy
argument_list|,
name|xorflag
condition|?
name|invplanes
else|:
name|AllPlanes
argument_list|)
expr_stmt|;
return|return
operator|(
name|len
operator|)
return|;
block|}
end_block

begin_comment
comment|/* display a character at the specified position */
end_comment

begin_macro
name|disp_char
argument_list|(
argument|ch
argument_list|,
argument|x
argument_list|,
argument|y
argument_list|,
argument|reverse
argument_list|,
argument|xorflag
argument_list|,
argument|info
argument_list|)
end_macro

begin_block
block|{
name|char
name|c
init|=
name|ch
decl_stmt|;
if|if
condition|(
name|reverse
condition|)
name|XText
argument_list|(
name|info
condition|?
name|w
else|:
name|trw
argument_list|,
name|x
argument_list|,
name|wmaxy
operator|-
name|y
operator|-
name|chrhgt
argument_list|,
operator|&
name|c
argument_list|,
literal|1
argument_list|,
name|font
argument_list|,
name|backpix
argument_list|,
name|forepix
argument_list|)
expr_stmt|;
else|else
name|XTextMaskPad
argument_list|(
name|info
condition|?
name|w
else|:
name|trw
argument_list|,
name|x
argument_list|,
name|wmaxy
operator|-
name|y
operator|-
name|chrhgt
argument_list|,
operator|&
name|c
argument_list|,
literal|1
argument_list|,
name|font
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|forepix
argument_list|,
name|xorflag
condition|?
name|GXinvert
else|:
name|GXcopy
argument_list|,
name|xorflag
condition|?
name|invplanes
else|:
name|AllPlanes
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Update display, cursor */
end_comment

begin_macro
name|DpyUp
argument_list|(
argument|tflag
argument_list|)
end_macro

begin_block
block|{
name|XEvent
name|ev
decl_stmt|;
if|if
condition|(
name|tflag
condition|)
name|tcurxor
argument_list|()
expr_stmt|;
name|dcurxor
argument_list|()
expr_stmt|;
do|do
block|{
name|XPeekEvent
argument_list|(
operator|&
name|ev
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|UserReady
argument_list|()
operator|==
literal|0
condition|)
do|;
if|if
condition|(
name|tflag
condition|)
name|tcurxor
argument_list|()
expr_stmt|;
name|dcurxor
argument_list|()
expr_stmt|;
block|}
end_block

begin_comment
comment|/* xor the text cursor */
end_comment

begin_macro
name|tcurxor
argument_list|()
end_macro

begin_block
block|{
name|XPixFill
argument_list|(
name|w
argument_list|,
name|incol
operator|*
name|chrwid
argument_list|,
name|wmaxy
operator|-
name|chrhgt
argument_list|,
name|chrwid
argument_list|,
name|chrhgt
argument_list|,
name|forepix
argument_list|,
operator|(
name|Bitmap
operator|)
name|NULL
argument_list|,
name|GXinvert
argument_list|,
name|invplanes
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|clearprompt
argument_list|()
end_macro

begin_block
block|{
name|incol
operator|=
literal|0
expr_stmt|;
name|XPixSet
argument_list|(
name|w
argument_list|,
literal|0
argument_list|,
name|wmaxy
operator|-
name|chrhgt
argument_list|,
name|wmaxx
argument_list|,
name|chrhgt
argument_list|,
name|backpix
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|clearscreen
argument_list|()
end_macro

begin_block
block|{
name|XClear
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|banner
argument_list|()
expr_stmt|;
name|clearprompt
argument_list|()
expr_stmt|;
block|}
end_block

begin_decl_stmt
specifier|static
name|int
name|lastx
decl_stmt|,
name|lasty
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|lastflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|lastcnt
init|=
literal|1000
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* draw a vector from<FromX,FromY> to<ToX,ToY> */
end_comment

begin_macro
name|line
argument_list|(
argument|FromX
argument_list|,
argument|FromY
argument_list|,
argument|ToX
argument_list|,
argument|ToY
argument_list|,
argument|xorflag
argument_list|)
end_macro

begin_block
block|{
name|Vertex
name|vert
index|[
literal|2
index|]
decl_stmt|;
name|vert
index|[
literal|0
index|]
operator|.
name|x
operator|=
name|FromX
expr_stmt|;
name|vert
index|[
literal|0
index|]
operator|.
name|y
operator|=
name|wmaxy
operator|-
name|FromY
expr_stmt|;
name|vert
index|[
literal|0
index|]
operator|.
name|flags
operator|=
name|VertexDontDraw
expr_stmt|;
name|vert
index|[
literal|1
index|]
operator|.
name|x
operator|=
name|ToX
expr_stmt|;
name|vert
index|[
literal|1
index|]
operator|.
name|y
operator|=
name|wmaxy
operator|-
name|ToY
expr_stmt|;
name|vert
index|[
literal|1
index|]
operator|.
name|flags
operator|=
name|VertexDrawLastPoint
expr_stmt|;
if|if
condition|(
name|xorflag
operator|==
name|lastflag
operator|&&
name|lastcnt
operator|<
literal|250
operator|&&
operator|(
operator|(
name|FromX
operator|==
name|lastx
operator|&&
name|FromY
operator|==
name|lasty
operator|&&
name|XAppendVertex
argument_list|(
operator|&
name|vert
index|[
literal|1
index|]
argument_list|,
literal|1
argument_list|)
operator|>
literal|0
operator|)
operator|||
name|XAppendVertex
argument_list|(
name|vert
argument_list|,
literal|2
argument_list|)
operator|>
literal|0
operator|)
condition|)
block|{
name|lastx
operator|=
name|ToX
expr_stmt|;
name|lasty
operator|=
name|ToY
expr_stmt|;
name|lastcnt
operator|++
expr_stmt|;
return|return;
block|}
name|lastx
operator|=
name|ToX
expr_stmt|;
name|lasty
operator|=
name|ToY
expr_stmt|;
name|lastflag
operator|=
name|xorflag
expr_stmt|;
name|lastcnt
operator|=
literal|1
expr_stmt|;
name|XDraw
argument_list|(
name|trw
argument_list|,
name|vert
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|forepix
argument_list|,
name|xorflag
condition|?
name|GXinvert
else|:
name|GXcopy
argument_list|,
name|xorflag
condition|?
name|invplanes
else|:
name|AllPlanes
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

