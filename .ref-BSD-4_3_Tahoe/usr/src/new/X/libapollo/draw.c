begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_draw_c
init|=
literal|"$Header: draw.c,v 10.1 86/11/29 13:51:24 jg Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_comment
comment|/*      Copyright 1986 by the University of Utah      Permission to use, copy, modify, and distribute this     software and its documentation for any purpose and without     fee is hereby granted, provided that the above copyright     notice appear in all copies and that both that copyright     notice and this permission notice appear in supporting     documentation, and that the name of the University of Utah     not be used in advertising or publicity pertaining to      distribution of the software without specific, written      prior permission. The University of Utah makes no     representations about the suitability of this software for     any purpose.  It is provided "as is" without express or     implied warranty.      */
end_comment

begin_comment
comment|/* draw.c	Draw lines, curves, and polygons on the screen  *  *	DrawCurve	Draw a generalized line/polygon/combination  *  */
end_comment

begin_comment
comment|/*  *	ToDo:  *		Brush shapes  *              Patterned Curves  *		Curves  */
end_comment

begin_include
include|#
directive|include
file|"Xapollo.h"
end_include

begin_decl_stmt
name|status_$t
name|status
decl_stmt|;
end_decl_stmt

begin_expr_stmt
specifier|static
name|Draw_Solid
argument_list|(
argument|srcpix
argument_list|,
argument|xbase
argument_list|,
argument|ybase
argument_list|,
argument|op
argument_list|,
argument|vertcount
argument_list|,
argument|verts
argument_list|,
argument|clipcount
argument_list|,
argument|clips
argument_list|,
argument|zmask
argument_list|)
name|int
name|srcpix
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* Pixel value to write */
end_comment

begin_decl_stmt
name|int
name|xbase
decl_stmt|,
name|ybase
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Origin of curve */
end_comment

begin_decl_stmt
name|int
name|op
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Opcode */
end_comment

begin_decl_stmt
name|int
name|vertcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Length of Vertex array */
end_comment

begin_decl_stmt
name|Vertex
modifier|*
name|verts
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Vertices */
end_comment

begin_decl_stmt
name|int
name|clipcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Length of clip array */
end_comment

begin_decl_stmt
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* clipping rectangles */
end_comment

begin_decl_stmt
name|int
name|zmask
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|Vertex
modifier|*
name|v
init|=
name|verts
decl_stmt|;
name|char
modifier|*
name|kind
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|allmask
init|=
operator|-
literal|1
decl_stmt|;
name|gpr_$window_t
name|cwindow
decl_stmt|;
name|gpr_$set_draw_value
argument_list|(
operator|(
name|gpr_$pixel_value_t
operator|)
name|srcpix
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|set_zmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
name|set_op
argument_list|(
name|op
argument_list|)
expr_stmt|;
do|do
block|{
specifier|register
name|int
name|xp
decl_stmt|,
name|yp
decl_stmt|;
specifier|register
name|Vertex
modifier|*
name|v
init|=
name|verts
decl_stmt|;
specifier|register
name|int
name|vc
init|=
name|vertcount
decl_stmt|;
name|GetNextClip
argument_list|(
name|clips
argument_list|,
name|cwindow
argument_list|)
expr_stmt|;
name|CheckCursor
argument_list|(
name|cwindow
operator|.
name|x_coord
argument_list|,
name|cwindow
operator|.
name|y_coord
argument_list|,
name|cwindow
operator|.
name|x_size
argument_list|,
name|cwindow
operator|.
name|y_size
argument_list|)
expr_stmt|;
name|gpr_$set_clip_window
argument_list|(
name|cwindow
argument_list|,
name|status
argument_list|)
expr_stmt|;
do|do
block|{
if|if
condition|(
name|v
operator|->
name|flags
operator|&
name|VertexRelative
condition|)
block|{
name|xp
operator|+=
name|v
operator|->
name|x
expr_stmt|;
name|yp
operator|+=
name|v
operator|->
name|y
expr_stmt|;
block|}
else|else
block|{
name|xp
operator|=
name|v
operator|->
name|x
operator|+
name|xbase
expr_stmt|;
name|yp
operator|=
name|v
operator|->
name|y
operator|+
name|ybase
expr_stmt|;
block|}
comment|/* XXX - ignore VertexCurved for now */
comment|/* XXX - ignore VertexDrawLastPoint for now */
if|if
condition|(
name|v
operator|->
name|flags
operator|&
name|VertexDontDraw
condition|)
name|gpr_$move
argument_list|(
operator|(
name|short
operator|)
name|xp
argument_list|,
operator|(
name|short
operator|)
name|yp
argument_list|,
name|status
argument_list|)
expr_stmt|;
else|else
name|gpr_$line
argument_list|(
operator|(
name|short
operator|)
name|xp
argument_list|,
operator|(
name|short
operator|)
name|yp
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|v
operator|++
expr_stmt|;
block|}
do|while
condition|(
operator|--
name|vc
operator|>
literal|0
condition|)
do|;
block|}
do|while
condition|(
operator|--
name|clipcount
operator|>
literal|0
condition|)
do|;
name|RestoreCursor
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|DrawCurve
argument_list|(
argument|verts
argument_list|,
argument|vertcount
argument_list|,
argument|xbase
argument_list|,
argument|ybase
argument_list|,
argument|srcpix
argument_list|,
argument|altpix
argument_list|,
argument|mode
argument_list|,
argument|bwidth
argument_list|,
argument|bheight
argument_list|,
argument|pat
argument_list|,
argument|patlen
argument_list|,
argument|patmul
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|Vertex
modifier|*
name|verts
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|vertcount
decl_stmt|,
name|xbase
decl_stmt|,
name|ybase
decl_stmt|,
name|srcpix
decl_stmt|,
name|altpix
decl_stmt|,
name|mode
decl_stmt|,
name|bwidth
decl_stmt|,
name|bheight
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|pat
decl_stmt|,
name|patlen
decl_stmt|,
name|patmul
decl_stmt|,
name|clipcount
decl_stmt|,
name|zmask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|static
name|gpr_$line_pattern_t
name|pattern
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|int
name|op
init|=
name|func
decl_stmt|;
name|pattern
index|[
literal|0
index|]
operator|=
name|pat
expr_stmt|;
comment|/* must invert bits ? */
if|if
condition|(
name|mode
operator|==
name|DrawSolidLine
condition|)
name|patlen
operator|=
literal|0
expr_stmt|;
name|gpr_$set_line_pattern
argument_list|(
operator|(
name|short
operator|)
name|patmul
argument_list|,
name|pattern
argument_list|,
operator|(
name|short
operator|)
name|patlen
argument_list|,
name|status
argument_list|)
expr_stmt|;
if|if
condition|(
name|bwidth
operator|==
literal|1
operator|&&
name|bheight
operator|==
literal|1
condition|)
switch|switch
condition|(
name|mode
condition|)
block|{
case|case
name|DrawSolidLine
case|:
name|Draw_Solid
argument_list|(
name|srcpix
argument_list|,
name|xbase
argument_list|,
name|ybase
argument_list|,
name|op
argument_list|,
name|vertcount
argument_list|,
name|verts
argument_list|,
name|clipcount
argument_list|,
name|clips
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
break|break;
case|case
name|DrawDashedLine
case|:
name|Draw_Solid
argument_list|(
name|srcpix
argument_list|,
name|xbase
argument_list|,
name|ybase
argument_list|,
name|op
argument_list|,
name|vertcount
argument_list|,
name|verts
argument_list|,
name|clipcount
argument_list|,
name|clips
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
break|break;
case|case
name|DrawPatternedLine
case|:
name|Draw_Solid
argument_list|(
name|srcpix
argument_list|,
name|xbase
argument_list|,
name|ybase
argument_list|,
name|op
argument_list|,
name|vertcount
argument_list|,
name|verts
argument_list|,
name|clipcount
argument_list|,
name|clips
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
break|break;
block|}
else|else
switch|switch
condition|(
name|mode
condition|)
block|{
comment|/* XXX - ignores brush specification for now */
case|case
name|DrawSolidLine
case|:
name|Draw_Solid
argument_list|(
name|srcpix
argument_list|,
name|xbase
argument_list|,
name|ybase
argument_list|,
name|op
argument_list|,
name|vertcount
argument_list|,
name|verts
argument_list|,
name|clipcount
argument_list|,
name|clips
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
break|break;
case|case
name|DrawDashedLine
case|:
name|Draw_Solid
argument_list|(
name|srcpix
argument_list|,
name|xbase
argument_list|,
name|ybase
argument_list|,
name|op
argument_list|,
name|vertcount
argument_list|,
name|verts
argument_list|,
name|clipcount
argument_list|,
name|clips
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
break|break;
case|case
name|DrawPatternedLine
case|:
name|Draw_Solid
argument_list|(
name|srcpix
argument_list|,
name|xbase
argument_list|,
name|ybase
argument_list|,
name|op
argument_list|,
name|vertcount
argument_list|,
name|verts
argument_list|,
name|clipcount
argument_list|,
name|clips
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_block

end_unit

