begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_textutil_c
init|=
literal|"$Header: textutil.c,v 10.1 86/11/29 13:53:04 jg Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_comment
comment|/*      Copyright 1986 by the University of Utah      Permission to use, copy, modify, and distribute this     software and its documentation for any purpose and without     fee is hereby granted, provided that the above copyright     notice appear in all copies and that both that copyright     notice and this permission notice appear in supporting     documentation, and that the name of the University of Utah     not be used in advertising or publicity pertaining to      distribution of the software without specific, written      prior permission. The University of Utah makes no     representations about the suitability of this software for     any purpose.  It is provided "as is" without express or     implied warranty.      */
end_comment

begin_comment
comment|/* textutil.c	text related utility routines.  *  *	CopyText	Copy text to bitmap  *	TextWidth	Returns width of a piece of text in a font  *	CharWidth	Returns width of a character in a font  *  */
end_comment

begin_include
include|#
directive|include
file|"Xapollo.h"
end_include

begin_decl_stmt
name|status_$t
name|status
decl_stmt|;
end_decl_stmt

begin_macro
name|CopyText
argument_list|(
argument|string
argument_list|,
argument|strlen
argument_list|,
argument|font
argument_list|,
argument|bm
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|string
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|strlen
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|FONT
modifier|*
name|font
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|BITMAP
modifier|*
name|bm
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|FontPriv
modifier|*
name|fp
decl_stmt|;
name|fp
operator|=
operator|(
name|FontPriv
operator|*
operator|)
name|font
operator|->
name|data
expr_stmt|;
name|gpr_$set_text_font
argument_list|(
operator|(
name|short
operator|)
name|fp
operator|->
name|ap_font_id
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$set_bitmap
argument_list|(
name|bm
operator|->
name|data
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$text
argument_list|(
operator|*
name|string
argument_list|,
operator|(
name|short
operator|)
name|strlen
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$set_bitmap
argument_list|(
name|Screen
operator|.
name|bm
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Returns the width of a string in a font  * Works only for Apollo-type fonts  */
end_comment

begin_function
name|int
name|TextWidth
parameter_list|(
name|string
parameter_list|,
name|strlen
parameter_list|,
name|spacepad
parameter_list|,
name|font
parameter_list|)
specifier|register
name|char
modifier|*
name|string
decl_stmt|;
specifier|register
name|int
name|strlen
decl_stmt|;
name|int
name|spacepad
decl_stmt|;
specifier|register
name|FONT
modifier|*
name|font
decl_stmt|;
block|{
specifier|register
name|int
name|width
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|font
operator|->
name|fixed
condition|)
block|{
name|width
operator|=
name|strlen
operator|*
name|font
operator|->
name|avg_width
expr_stmt|;
if|if
condition|(
name|spacepad
condition|)
block|{
while|while
condition|(
operator|--
name|strlen
operator|>=
literal|0
condition|)
if|if
condition|(
operator|*
name|string
operator|++
operator|==
name|font
operator|->
name|space
condition|)
name|width
operator|+=
name|spacepad
expr_stmt|;
block|}
block|}
else|else
block|{
name|FontPriv
modifier|*
name|fp
decl_stmt|;
name|gpr_$offset_t
name|size
decl_stmt|;
name|fp
operator|=
operator|(
name|FontPriv
operator|*
operator|)
name|font
operator|->
name|data
expr_stmt|;
name|gpr_$set_text_font
argument_list|(
operator|(
name|short
operator|)
name|fp
operator|->
name|ap_font_id
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$inq_text_extent
argument_list|(
operator|*
name|string
argument_list|,
operator|(
name|short
operator|)
name|strlen
argument_list|,
name|size
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|width
operator|=
name|size
operator|.
name|x_size
expr_stmt|;
block|}
return|return
operator|(
name|width
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Returns width of a character in a font.  * Works only for Apollo-type fonts  */
end_comment

begin_function
name|int
name|CharWidth
parameter_list|(
name|c
parameter_list|,
name|font
parameter_list|)
specifier|register
name|unsigned
name|int
name|c
decl_stmt|;
specifier|register
name|FONT
modifier|*
name|font
decl_stmt|;
block|{
name|FontPriv
modifier|*
name|fp
decl_stmt|;
name|int
name|width
decl_stmt|;
if|if
condition|(
name|c
operator|<
name|font
operator|->
name|first
operator|||
name|c
operator|>
name|font
operator|->
name|last
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|fp
operator|=
operator|(
name|FontPriv
operator|*
operator|)
name|font
operator|->
name|data
expr_stmt|;
name|gpr_$inq_character_width
argument_list|(
operator|(
name|short
operator|)
name|fp
operator|->
name|ap_font_id
argument_list|,
name|c
argument_list|,
operator|(
name|short
operator|)
name|width
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|width
operator|)
return|;
block|}
end_function

end_unit

