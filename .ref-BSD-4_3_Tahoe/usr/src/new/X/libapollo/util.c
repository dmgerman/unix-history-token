begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_util_c
init|=
literal|"$Header: util.c,v 10.1 86/11/29 13:53:19 jg Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_comment
comment|/*      Copyright 1986 by the University of Utah      Permission to use, copy, modify, and distribute this     software and its documentation for any purpose and without     fee is hereby granted, provided that the above copyright     notice appear in all copies and that both that copyright     notice and this permission notice appear in supporting     documentation, and that the name of the University of Utah     not be used in advertising or publicity pertaining to      distribution of the software without specific, written      prior permission. The University of Utah makes no     representations about the suitability of this software for     any purpose.  It is provided "as is" without express or     implied warranty.      */
end_comment

begin_comment
comment|/* util.c		Various utilities  *  *	SoundBell	Generate audible bell  *	SetKeyClick	Control key click  *	SetAutoRepeat	Control auto repeat  *	SetLockLED	Control Lock LED  *	SetVideo	Disable/enable video  *	QueryShape	Determine shapes  *	ResolveColors	doesn't do much  *	StoreColors	sets the color map  */
end_comment

begin_comment
comment|/*  *	ToDo:  *		Implement SetVideo  */
end_comment

begin_include
include|#
directive|include
file|"Xapollo.h"
end_include

begin_include
include|#
directive|include
file|"/sys/ins/tone.ins.c"
end_include

begin_decl_stmt
specifier|extern
name|int
name|vsdev
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Sound bell, volume between 0 (quiet) and 7 (loud) */
end_comment

begin_macro
name|SoundBell
argument_list|(
argument|volume
argument_list|)
end_macro

begin_decl_stmt
name|int
name|volume
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|time_$clock_t
name|ToneTime
decl_stmt|;
name|ToneTime
operator|.
name|high
operator|=
literal|1
expr_stmt|;
name|ToneTime
operator|.
name|low
operator|=
literal|0
expr_stmt|;
name|tone_$time
argument_list|(
name|ToneTime
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_comment
comment|/* Set key click, volume between -1 (default), 0 (off) and 8 (loud) */
end_comment

begin_macro
name|SetKeyClick
argument_list|(
argument|volume
argument_list|)
end_macro

begin_decl_stmt
name|int
name|volume
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_comment
comment|/* Set autorepeat */
end_comment

begin_macro
name|SetAutoRepeat
argument_list|(
argument|onoff
argument_list|)
end_macro

begin_decl_stmt
name|int
name|onoff
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_function
name|int
name|SetVideo
parameter_list|(
name|onoff
parameter_list|)
name|int
name|onoff
decl_stmt|;
block|{
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_macro
name|QueryShape
argument_list|(
argument|shape
argument_list|,
argument|width
argument_list|,
argument|height
argument_list|)
end_macro

begin_decl_stmt
name|int
name|shape
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|short
modifier|*
name|width
decl_stmt|,
modifier|*
name|height
decl_stmt|;
end_decl_stmt

begin_block
block|{
switch|switch
condition|(
name|shape
condition|)
block|{
case|case
name|CursorShape
case|:
if|if
condition|(
operator|*
name|width
operator|>
literal|16
condition|)
operator|*
name|width
operator|=
literal|16
expr_stmt|;
if|if
condition|(
operator|*
name|height
operator|>
literal|16
condition|)
operator|*
name|height
operator|=
literal|16
expr_stmt|;
break|break;
case|case
name|TileShape
case|:
operator|*
name|width
operator|=
operator|*
name|height
operator|=
literal|32
expr_stmt|;
break|break;
block|}
block|}
end_block

begin_macro
name|SetLockLED
argument_list|(
argument|onoff
argument_list|)
end_macro

begin_decl_stmt
name|int
name|onoff
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|ResolveColor
argument_list|(
argument|red
argument_list|,
argument|green
argument_list|,
argument|blue
argument_list|)
end_macro

begin_decl_stmt
name|unsigned
name|short
modifier|*
name|red
decl_stmt|,
modifier|*
name|green
decl_stmt|,
modifier|*
name|blue
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|*
name|red
operator|&=
operator|~
literal|0377
expr_stmt|;
operator|*
name|green
operator|&=
operator|~
literal|0377
expr_stmt|;
operator|*
name|blue
operator|&=
operator|~
literal|0377
expr_stmt|;
block|}
end_block

begin_function
name|long
name|color_entry
parameter_list|(
name|red
parameter_list|,
name|green
parameter_list|,
name|blue
parameter_list|)
name|int
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|;
block|{
name|red
operator|=
name|red
operator|>>
literal|8
expr_stmt|;
name|green
operator|=
name|green
operator|>>
literal|8
expr_stmt|;
name|blue
operator|=
name|blue
operator|>>
literal|8
expr_stmt|;
return|return
operator|(
operator|(
name|red
operator|*
literal|65536
operator|)
operator|+
operator|(
name|green
operator|*
literal|256
operator|)
operator|+
name|blue
operator|)
return|;
block|}
end_function

begin_macro
name|StoreColors
argument_list|(
argument|count
argument_list|,
argument|entries
argument_list|)
end_macro

begin_decl_stmt
name|int
name|count
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|ColorDef
modifier|*
name|entries
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|gpr_$color_vector_t
name|values
decl_stmt|;
name|int
name|n
decl_stmt|;
name|status_$t
name|status
decl_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|count
condition|;
name|n
operator|++
control|)
block|{
name|values
index|[
literal|0
index|]
operator|=
name|color_entry
argument_list|(
name|entries
operator|->
name|red
argument_list|,
name|entries
operator|->
name|green
argument_list|,
name|entries
operator|->
name|blue
argument_list|)
expr_stmt|;
name|gpr_$set_color_map
argument_list|(
operator|(
name|gpr_$pixel_value_t
operator|)
name|entries
operator|->
name|pixel
argument_list|,
operator|(
name|short
operator|)
literal|1
argument_list|,
name|values
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|check_status
argument_list|(
name|status
argument_list|,
literal|"StoreColors: "
argument_list|)
expr_stmt|;
name|entries
operator|++
expr_stmt|;
block|}
block|}
end_block

begin_decl_stmt
specifier|extern
name|unsigned
name|char
name|InvertedPixelArray
index|[]
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|InvertPixelOrder
argument_list|(
name|p
argument_list|,
name|n
argument_list|)
specifier|register
name|unsigned
name|short
operator|*
name|p
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|n
decl_stmt|;
end_decl_stmt

begin_block
block|{
for|for
control|(
init|;
name|n
operator|--
condition|;
name|p
operator|++
control|)
operator|*
name|p
operator|=
call|(
name|unsigned
name|short
call|)
argument_list|(
operator|(
name|InvertedPixelArray
index|[
operator|*
name|p
operator|&
literal|0xFF
index|]
operator|<<
literal|8
operator|)
operator||
name|InvertedPixelArray
index|[
operator|*
name|p
operator|>>
literal|8
index|]
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

