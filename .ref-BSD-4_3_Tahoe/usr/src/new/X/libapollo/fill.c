begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_fill_c
init|=
literal|"$Header: fill.c,v 10.1 86/11/29 13:51:52 jg Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_comment
comment|/*      Copyright 1986 by the University of Utah      Permission to use, copy, modify, and distribute this     software and its documentation for any purpose and without     fee is hereby granted, provided that the above copyright     notice appear in all copies and that both that copyright     notice and this permission notice appear in supporting     documentation, and that the name of the University of Utah     not be used in advertising or publicity pertaining to      distribution of the software without specific, written      prior permission. The University of Utah makes no     representations about the suitability of this software for     any purpose.  It is provided "as is" without express or     implied warranty.      */
end_comment

begin_comment
comment|/* fill.c	Perform a simple raster operation a section of the screen  *  *	PixFill	Do a function on the screen  *  */
end_comment

begin_include
include|#
directive|include
file|"Xapollo.h"
end_include

begin_decl_stmt
specifier|extern
name|int
name|old_op
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|PixFill
argument_list|(
argument|srcpix
argument_list|,
argument|xymask
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|width
argument_list|,
argument|height
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|int
name|srcpix
decl_stmt|,
name|dstx
decl_stmt|,
name|dsty
decl_stmt|,
name|width
decl_stmt|,
name|height
decl_stmt|,
name|clipcount
decl_stmt|,
name|zmask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|BITMAP
modifier|*
name|xymask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|;
name|gpr_$window_t
name|window
decl_stmt|,
name|cwindow
decl_stmt|;
name|boolean
name|active
decl_stmt|;
name|status_$t
name|status
decl_stmt|;
name|gpr_$position_t
name|dest
decl_stmt|;
comment|/* Need to sort out the func/srcpix interactions here; the    following special case is for gemacs' curosr  */
if|if
condition|(
operator|(
name|func
operator|==
name|GXxor
operator|)
operator|&&
operator|(
name|srcpix
operator|==
literal|1
operator|)
condition|)
name|func
operator|=
literal|10
expr_stmt|;
if|if
condition|(
name|xymask
operator|==
name|NULL
condition|)
block|{
name|set_zmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
name|set_op
argument_list|(
name|func
argument_list|)
expr_stmt|;
name|window
operator|.
name|x_coord
operator|=
name|dstx
expr_stmt|;
name|window
operator|.
name|y_coord
operator|=
name|dsty
expr_stmt|;
name|window
operator|.
name|x_size
operator|=
name|width
expr_stmt|;
name|window
operator|.
name|y_size
operator|=
name|height
expr_stmt|;
do|do
block|{
name|GetNextClip
argument_list|(
name|clips
argument_list|,
name|cwindow
argument_list|)
expr_stmt|;
name|CheckCursor
argument_list|(
name|dstx
argument_list|,
name|dsty
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|gpr_$set_clip_window
argument_list|(
name|cwindow
argument_list|,
name|status
argument_list|)
expr_stmt|;
if|if
condition|(
name|func
operator|==
literal|3
condition|)
block|{
name|gpr_$set_fill_value
argument_list|(
operator|(
name|gpr_$pixel_value_t
operator|)
name|srcpix
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$rectangle
argument_list|(
name|window
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
else|else
comment|/* just blit screen to self */
block|{
name|dest
operator|.
name|x_coord
operator|=
name|dstx
expr_stmt|;
name|dest
operator|.
name|y_coord
operator|=
name|dsty
expr_stmt|;
name|gpr_$bit_blt
argument_list|(
name|Screen
operator|.
name|bm
argument_list|,
name|window
argument_list|,
operator|(
name|short
operator|)
literal|0
argument_list|,
name|dest
argument_list|,
operator|(
name|short
operator|)
literal|0
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
block|}
do|while
condition|(
operator|--
name|clipcount
operator|>
literal|0
condition|)
do|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"PixFill: op=%d, srcpix=%d, xymask=%d\n"
argument_list|,
name|func
argument_list|,
name|srcpix
argument_list|,
name|xymask
argument_list|)
expr_stmt|;
block|}
name|RestoreCursor
argument_list|()
expr_stmt|;
block|}
end_block

end_unit

