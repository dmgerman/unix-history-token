begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_text_c
init|=
literal|"$Header: text.c,v 10.1 86/11/29 13:52:56 jg Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_comment
comment|/*      Copyright 1986 by the University of Utah      Permission to use, copy, modify, and distribute this     software and its documentation for any purpose and without     fee is hereby granted, provided that the above copyright     notice appear in all copies and that both that copyright     notice and this permission notice appear in supporting     documentation, and that the name of the University of Utah     not be used in advertising or publicity pertaining to      distribution of the software without specific, written      prior permission. The University of Utah makes no     representations about the suitability of this software for     any purpose.  It is provided "as is" without express or     implied warranty.      */
end_comment

begin_comment
comment|/*  *	ToDo:  *		xymask's  */
end_comment

begin_include
include|#
directive|include
file|"Xapollo.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|stdin
end_ifndef

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|extern
name|boolean
name|borrow_flag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|old_op
decl_stmt|;
end_decl_stmt

begin_macro
name|PrintText
argument_list|(
argument|string
argument_list|,
argument|strlen
argument_list|,
argument|font
argument_list|,
argument|fore
argument_list|,
argument|back
argument_list|,
argument|charpad
argument_list|,
argument|spacepad
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|clipstart
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|unsigned
name|char
modifier|*
name|string
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|FONT
modifier|*
name|font
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|strlen
decl_stmt|,
name|fore
decl_stmt|,
name|back
decl_stmt|,
name|charpad
decl_stmt|,
name|spacepad
decl_stmt|,
name|dstx
decl_stmt|,
name|dsty
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|CLIP
modifier|*
name|clipstart
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|clipcount
decl_stmt|,
name|zmask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|op
decl_stmt|,
name|i
decl_stmt|;
specifier|extern
name|char
name|FBMap
index|[]
decl_stmt|;
specifier|register
name|w
operator|=
literal|0
expr_stmt|;
name|int
name|bsize
init|=
literal|0
decl_stmt|;
name|int
name|lheight
decl_stmt|;
name|int
name|sbot
decl_stmt|,
name|sright
decl_stmt|;
name|int
name|savestrlen
init|=
name|strlen
decl_stmt|;
name|unsigned
name|char
modifier|*
name|savestring
init|=
name|string
decl_stmt|;
name|gpr_$window_t
name|cwindow
decl_stmt|;
name|boolean
name|active
decl_stmt|;
name|status_$t
name|status
decl_stmt|;
name|FontPriv
modifier|*
name|fp
decl_stmt|;
specifier|static
name|int
name|old_fore
init|=
operator|-
literal|1
decl_stmt|,
name|old_back
init|=
operator|-
literal|1
decl_stmt|;
name|fp
operator|=
operator|(
name|FontPriv
operator|*
operator|)
name|font
operator|->
name|data
expr_stmt|;
comment|/* Do apollo-format fonts */
if|if
condition|(
name|fp
operator|->
name|ap_font
condition|)
block|{
name|int
name|lback
decl_stmt|,
name|lfore
decl_stmt|;
if|if
condition|(
operator|!
name|borrow_flag
condition|)
name|active
operator|=
name|gpr_$acquire_display
argument_list|(
name|status
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|charpad
operator|!=
literal|0
operator|)
operator|||
operator|(
name|spacepad
operator|!=
literal|0
operator|)
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"charpad=%d, spacepad=%d\n"
argument_list|,
name|charpad
argument_list|,
name|spacepad
argument_list|)
expr_stmt|;
comment|/* if window is inverted (and just using 0& 1 pixels, use inverted font */
name|gpr_$set_text_font
argument_list|(
operator|(
name|short
operator|)
name|fp
operator|->
name|ap_font_id
argument_list|,
name|status
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|back
operator|==
literal|1
operator|)
operator|&&
operator|(
name|fore
operator|==
literal|0
operator|)
condition|)
name|gpr_$set_text_font
argument_list|(
operator|(
name|short
operator|)
name|fp
operator|->
name|ap_font_id_inv
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|fore
operator|=
operator|(
name|fore
operator|==
literal|0
operator|)
condition|?
literal|1
else|:
name|fore
expr_stmt|;
name|back
operator|=
operator|(
name|back
operator|==
literal|1
operator|)
condition|?
literal|0
else|:
name|back
expr_stmt|;
if|if
condition|(
name|old_fore
operator|!=
name|fore
condition|)
block|{
name|old_fore
operator|=
name|fore
expr_stmt|;
name|gpr_$set_text_value
argument_list|(
operator|(
name|gpr_$pixel_value_t
operator|)
name|fore
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|old_back
operator|!=
name|back
condition|)
block|{
name|old_back
operator|=
name|back
expr_stmt|;
name|gpr_$set_text_background_value
argument_list|(
operator|(
name|gpr_$pixel_value_t
operator|)
name|back
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
name|set_zmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
name|set_op
argument_list|(
name|func
argument_list|)
expr_stmt|;
name|CheckCursor
argument_list|(
name|dstx
argument_list|,
name|dsty
argument_list|,
name|strlen
operator|*
name|fp
operator|->
name|maxwidth
argument_list|,
name|font
operator|->
name|height
argument_list|)
expr_stmt|;
name|dsty
operator|=
name|dsty
operator|+
name|font
operator|->
name|height
operator|-
literal|1
expr_stmt|;
do|do
block|{
name|GetNextClip
argument_list|(
name|clipstart
argument_list|,
name|cwindow
argument_list|)
expr_stmt|;
name|gpr_$set_clip_window
argument_list|(
name|cwindow
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$move
argument_list|(
operator|(
name|short
operator|)
name|dstx
argument_list|,
operator|(
name|short
operator|)
name|dsty
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$text
argument_list|(
operator|*
name|string
argument_list|,
operator|(
name|short
operator|)
name|strlen
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
operator|--
name|clipcount
condition|)
do|;
if|if
condition|(
operator|!
name|borrow_flag
condition|)
name|gpr_$release_display
argument_list|(
name|status
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* wasn't in apollo format, use internal format--this should be avoided! */
if|if
condition|(
name|fore
operator|&
literal|1
condition|)
name|func
operator|+=
literal|0x20
expr_stmt|;
if|if
condition|(
name|back
operator|&
literal|1
condition|)
name|func
operator|+=
literal|0x10
expr_stmt|;
name|func
operator|=
name|FBMap
index|[
name|func
index|]
expr_stmt|;
name|lheight
operator|=
name|font
operator|->
name|height
expr_stmt|;
name|sbot
operator|=
name|dsty
operator|+
name|lheight
expr_stmt|;
name|sright
operator|=
name|dstx
operator|+
name|w
expr_stmt|;
name|dsty
operator|-=
name|font
operator|->
name|base
expr_stmt|;
do|do
block|{
name|gpr_$window_t
name|window
decl_stmt|;
name|gpr_$position_t
name|dest
decl_stmt|;
name|int
name|w
decl_stmt|;
name|gpr_$set_raster_op
argument_list|(
operator|(
name|short
operator|)
literal|0
argument_list|,
operator|(
name|short
operator|)
name|func
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|old_op
operator|=
name|func
expr_stmt|;
name|GetNextClip
argument_list|(
name|clipstart
argument_list|,
name|cwindow
argument_list|)
expr_stmt|;
name|CheckCursor
argument_list|(
name|cwindow
operator|.
name|x_coord
argument_list|,
name|cwindow
operator|.
name|y_coord
argument_list|,
name|cwindow
operator|.
name|x_size
argument_list|,
name|cwindow
operator|.
name|y_size
argument_list|)
expr_stmt|;
name|gpr_$set_clip_window
argument_list|(
name|cwindow
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|window
operator|.
name|y_size
operator|=
name|lheight
expr_stmt|;
name|dest
operator|.
name|y_coord
operator|=
name|dsty
expr_stmt|;
name|dest
operator|.
name|x_coord
operator|=
name|dstx
expr_stmt|;
while|while
condition|(
name|strlen
operator|--
condition|)
block|{
name|window
operator|.
name|x_coord
operator|=
name|fp
operator|->
name|leftarray
index|[
operator|*
name|string
index|]
expr_stmt|;
name|w
operator|=
name|fp
operator|->
name|widths
index|[
operator|*
name|string
index|]
expr_stmt|;
name|window
operator|.
name|x_size
operator|=
name|w
expr_stmt|;
name|gpr_$bit_blt
argument_list|(
name|fp
operator|->
name|strike
operator|->
name|data
argument_list|,
name|window
argument_list|,
operator|(
name|short
operator|)
literal|0
argument_list|,
name|dest
argument_list|,
operator|(
name|short
operator|)
literal|0
argument_list|,
name|status
argument_list|)
expr_stmt|;
operator|++
name|string
expr_stmt|;
name|dest
operator|.
name|x_coord
operator|+=
name|w
expr_stmt|;
block|}
name|string
operator|=
name|savestring
expr_stmt|;
name|strlen
operator|=
name|savestrlen
expr_stmt|;
block|}
do|while
condition|(
operator|--
name|clipcount
operator|>
literal|0
condition|)
do|;
block|}
name|RestoreCursor
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|PrintTextMask
argument_list|(
argument|string
argument_list|,
argument|strlen
argument_list|,
argument|font
argument_list|,
argument|srcpix
argument_list|,
argument|charpad
argument_list|,
argument|spacepad
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|unsigned
name|char
modifier|*
name|string
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|FONT
modifier|*
name|font
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|strlen
decl_stmt|,
name|srcpix
decl_stmt|,
name|charpad
decl_stmt|,
name|spacepad
decl_stmt|,
name|dstx
decl_stmt|,
name|dsty
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|clipcount
decl_stmt|,
name|zmask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|cleft
decl_stmt|,
name|ctop
decl_stmt|,
name|cwidth
decl_stmt|,
name|cheight
decl_stmt|;
name|int
name|fore
decl_stmt|,
name|back
decl_stmt|;
specifier|extern
name|char
name|SSMap
index|[]
decl_stmt|;
comment|/* ( assume depth == 1) */
name|fore
operator|=
literal|1
expr_stmt|;
name|back
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|srcpix
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
block|{
name|fore
operator|=
literal|0
expr_stmt|;
name|back
operator|=
literal|1
expr_stmt|;
block|}
comment|/* Punt for now on masking */
name|PrintText
argument_list|(
name|string
argument_list|,
name|strlen
argument_list|,
name|font
argument_list|,
name|fore
argument_list|,
name|back
argument_list|,
name|charpad
argument_list|,
name|spacepad
argument_list|,
name|dstx
argument_list|,
name|dsty
argument_list|,
name|clips
argument_list|,
name|clipcount
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

