begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<X/mit-copyright.h>
end_include

begin_comment
comment|/* Copyright    Massachusetts Institute of Technology    1985	*/
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_dispatch_c
init|=
literal|"$Header: dispatch.c,v 10.16 86/04/11 23:18:55 newman Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<dbm.h>
end_include

begin_undef
undef|#
directive|undef
name|NULL
end_undef

begin_include
include|#
directive|include
file|"Xint.h"
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|"rgb.h"
end_include

begin_decl_stmt
specifier|extern
name|int
name|errno
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|RESOURCE
modifier|*
modifier|*
name|Resources
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|MaxResource
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|DEVICE
name|device
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|havemask
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|havestate
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|rr_counter
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|requestId
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|bufptr
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|bufcnt
index|[]
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|DUALTCP
end_ifdef

begin_decl_stmt
specifier|extern
name|int
name|swapped
index|[]
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|extern
name|WINDOW
modifier|*
name|rootwindow
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|CURSOR
modifier|*
name|rootcursor
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|CURSOR
modifier|*
name|cursor
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|short
name|blank_video
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|timeval
name|waittime
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|timeval
name|longtime
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|havergb
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|Xalloc
argument_list|()
decl_stmt|,
modifier|*
name|Read_segment
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
name|long
name|Add_resource
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|PIXMAP
modifier|*
name|Do_PixmapSave
argument_list|()
decl_stmt|,
modifier|*
name|StorePixmap
argument_list|()
decl_stmt|,
modifier|*
name|MakePixmap
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
name|FONT
modifier|*
name|Get_font
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|BITMAP
modifier|*
name|StoreBitmap
argument_list|()
decl_stmt|,
modifier|*
name|CharBitmap
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
name|CURSOR
modifier|*
name|Store_cursor
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|WINDOW
modifier|*
name|Unmap_window
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|u_char
name|Xstatus
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Holds error code */
end_comment

begin_decl_stmt
name|short
name|base_feep
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Base value for X_Feep */
end_comment

begin_comment
comment|/* The main read/dispatch loop */
end_comment

begin_macro
name|Dispatcher
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|XReq
modifier|*
name|req
decl_stmt|;
name|XRep
name|rep
decl_stmt|;
name|int
name|client
decl_stmt|;
specifier|register
name|RESOURCE
modifier|*
name|rptr
decl_stmt|,
modifier|*
modifier|*
name|res
decl_stmt|;
specifier|register
name|WINDOW
modifier|*
name|w
decl_stmt|;
specifier|register
name|int
name|n
decl_stmt|;
specifier|register
name|FONT
modifier|*
name|font
decl_stmt|;
name|char
modifier|*
name|data1
decl_stmt|,
modifier|*
name|data2
decl_stmt|;
name|PIXMAP
modifier|*
name|pix1
decl_stmt|,
modifier|*
name|pix2
decl_stmt|;
name|BITMAP
modifier|*
name|bit1
decl_stmt|,
modifier|*
name|bit2
decl_stmt|;
name|WINDOW
modifier|*
name|icon
decl_stmt|,
modifier|*
name|sw
decl_stmt|;
name|CURSOR
modifier|*
name|cur
decl_stmt|;
name|vsCursor
name|mcursor
decl_stmt|;
name|int
name|count
decl_stmt|;
name|datum
name|dbent
decl_stmt|;
name|RGB
name|color
decl_stmt|;
define|#
directive|define
name|ILLEGAL
parameter_list|(
name|rval
parameter_list|,
name|typ
parameter_list|)
value|(((n = RESIDX(rval))<= 0) || \ 			   (n>= MaxResource) || \ 			   (((rptr=res[n])->id) != rval) || \ 			   (rptr->type != typ))
define|#
directive|define
name|REPLY
value|Write (client, (caddr_t)&rep, sizeof (XRep))
name|rep
operator|.
name|code
operator|=
name|X_Reply
expr_stmt|;
comment|/* Just keep receiving a message and dispatching on it. */
while|while
condition|(
literal|1
condition|)
block|{
comment|/* If not exactly one ready, or have events, go receive/schedule */
if|if
condition|(
name|havestate
operator|!=
name|rr_counter
operator|||
name|device
operator|.
name|queue
operator|->
name|head
operator|!=
name|device
operator|.
name|queue
operator|->
name|tail
condition|)
name|Receive
argument_list|()
expr_stmt|;
name|client
operator|=
name|n
operator|=
name|rr_counter
expr_stmt|;
name|req
operator|=
operator|(
name|XReq
operator|*
operator|)
name|bufptr
index|[
name|n
index|]
expr_stmt|;
name|bufptr
index|[
name|n
index|]
operator|+=
sizeof|sizeof
argument_list|(
name|XReq
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|bufcnt
index|[
name|n
index|]
operator|-=
sizeof|sizeof
argument_list|(
name|XReq
argument_list|)
operator|)
operator|<
sizeof|sizeof
argument_list|(
name|XReq
argument_list|)
condition|)
block|{
name|bitclear
argument_list|(
name|havemask
argument_list|,
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|havestate
operator|<
literal|0
condition|)
name|havestate
operator|++
expr_stmt|;
else|else
name|havestate
operator|=
literal|0
expr_stmt|;
block|}
name|requestId
index|[
name|n
index|]
operator|++
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
name|Swap_request
argument_list|(
name|req
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|Xstatus
operator|=
literal|0
expr_stmt|;
name|res
operator|=
name|Resources
expr_stmt|;
comment|/* Check that the window pointer points to a real window */
if|if
condition|(
name|req
operator|->
name|code
operator|<
name|X_SetUp
condition|)
block|{
if|if ILLEGAL
condition|(
name|req
operator|->
name|windowId
operator|,
name|RT_WINDOW
condition|)
block|{
comment|/* get segment size */
switch|switch
condition|(
name|req
operator|->
name|code
condition|)
block|{
case|case
name|X_StoreName
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|)
operator|>
literal|0
condition|)
name|n
operator|=
name|BytePad
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_PixmapBitsPut
case|:
name|n
operator|=
name|Pix_size
argument_list|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|4
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_BitmapBitsPut
case|:
name|n
operator|=
name|Bit_size
argument_list|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_Text
case|:
case|case
name|X_TextMask
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|6
index|]
operator|)
operator|>
literal|0
condition|)
name|n
operator|=
name|BytePad
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_Draw
case|:
case|case
name|X_DrawFilled
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|*
sizeof|sizeof
argument_list|(
name|Vertex
argument_list|)
operator|)
operator|>
literal|0
condition|)
name|n
operator|=
name|WordPad
argument_list|(
name|n
argument_list|)
expr_stmt|;
break|break;
default|default:
name|n
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|n
operator|<=
literal|0
operator|||
name|Read_segment
argument_list|(
name|client
argument_list|,
name|n
argument_list|)
condition|)
block|{
name|Xstatus
operator|=
name|BadWindow
expr_stmt|;
name|Oops
argument_list|(
name|client
argument_list|,
name|req
argument_list|)
expr_stmt|;
block|}
continue|continue;
block|}
else|else
name|w
operator|=
operator|(
name|WINDOW
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
block|}
comment|/* Here we verify and convert resource id's to real resources, 	     * then call the appropriate routine (or do it inline). 	     * This makes the routine huge, but it minimizes the spread of 	     * protocol-specifics to other modules. 	     */
switch|switch
condition|(
name|req
operator|->
name|code
condition|)
block|{
case|case
name|X_CreateWindow
case|:
if|if
condition|(
name|req
operator|->
name|func
operator|==
literal|0
condition|)
name|pix1
operator|=
name|NULL
expr_stmt|;
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|2
index|]
operator|,
name|RT_PIXMAP
condition|)
block|{
name|Xstatus
operator|=
name|BadPixmap
expr_stmt|;
break|break;
block|}
else|else
name|pix1
operator|=
operator|(
name|PIXMAP
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|==
literal|0
condition|)
name|pix2
operator|=
name|NULL
expr_stmt|;
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|,
name|RT_PIXMAP
condition|)
block|{
name|Xstatus
operator|=
name|BadPixmap
expr_stmt|;
break|break;
block|}
else|else
name|pix2
operator|=
operator|(
name|PIXMAP
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|Create_window
argument_list|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|2
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|3
index|]
argument_list|,
operator|(
name|int
operator|)
name|req
operator|->
name|func
argument_list|,
name|pix1
argument_list|,
name|pix2
argument_list|,
name|IsOpaque
argument_list|,
name|w
argument_list|,
name|client
argument_list|)
expr_stmt|;
if|if
condition|(
name|Xstatus
condition|)
break|break;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
break|break;
case|case
name|X_CreateTransparency
case|:
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|Create_window
argument_list|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|2
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|,
operator|(
name|PIXMAP
operator|*
operator|)
name|NULL
argument_list|,
operator|(
name|PIXMAP
operator|*
operator|)
name|NULL
argument_list|,
name|IsTransparent
argument_list|,
name|w
argument_list|,
name|client
argument_list|)
expr_stmt|;
if|if
condition|(
name|Xstatus
condition|)
break|break;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
break|break;
case|case
name|X_DestroyWindow
case|:
if|if
condition|(
name|w
operator|!=
name|rootwindow
condition|)
block|{
name|Free_resource
argument_list|(
name|rptr
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
name|X_DestroySubwindows
case|:
if|if
condition|(
name|w
operator|->
name|first_child
condition|)
block|{
name|Remove_subwindows
argument_list|(
name|w
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
name|X_MapWindow
case|:
if|if FALSE
condition|(
name|w
operator|->
name|mapped
condition|)
block|{
name|Map_window
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
name|X_MapSubwindows
case|:
name|Map_subwindows
argument_list|(
name|w
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
break|break;
case|case
name|X_UnmapWindow
case|:
if|if
condition|(
name|w
operator|!=
name|rootwindow
condition|)
block|{
if|if TRUE
condition|(
name|w
operator|->
name|mapped
condition|)
block|{
name|Stash_simple
argument_list|(
name|w
argument_list|,
operator|(
name|long
operator|)
name|UnmapWindow
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Unmap_window
argument_list|(
name|w
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
block|}
name|w
operator|->
name|should_be_mapped
operator|=
literal|0
expr_stmt|;
block|}
break|break;
case|case
name|X_UnmapSubwindows
case|:
name|Unmap_subwindows
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
break|break;
case|case
name|X_UnmapTransparent
case|:
if|if
condition|(
name|w
operator|!=
name|rootwindow
condition|)
block|{
if|if TRUE
condition|(
name|w
operator|->
name|mapped
condition|)
block|{
name|Unmap_window
argument_list|(
name|w
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
block|}
name|w
operator|->
name|should_be_mapped
operator|=
literal|0
expr_stmt|;
block|}
break|break;
case|case
name|X_RaiseWindow
case|:
if|if
condition|(
name|w
operator|!=
name|rootwindow
condition|)
block|{
name|Raise_window
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
name|X_LowerWindow
case|:
if|if
condition|(
name|w
operator|!=
name|rootwindow
condition|)
block|{
name|Lower_window
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
name|X_CircWindowUp
case|:
name|Circulate_window_up
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
break|break;
case|case
name|X_MoveWindow
case|:
if|if
condition|(
name|w
operator|!=
name|rootwindow
condition|)
block|{
name|Move_window
argument_list|(
name|w
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
name|X_ChangeWindow
case|:
if|if
condition|(
name|w
operator|==
name|rootwindow
condition|)
break|break;
name|Change_window
argument_list|(
name|w
argument_list|,
name|w
operator|->
name|full
operator|.
name|left
operator|-
name|w
operator|->
name|bwidth
operator|-
operator|(
operator|(
name|w
operator|->
name|mapped
operator|)
condition|?
name|w
operator|->
name|parent
operator|->
name|full
operator|.
name|left
else|:
literal|0
operator|)
argument_list|,
name|w
operator|->
name|full
operator|.
name|top
operator|-
name|w
operator|->
name|bwidth
operator|-
operator|(
operator|(
name|w
operator|->
name|mapped
operator|)
condition|?
name|w
operator|->
name|parent
operator|->
name|full
operator|.
name|top
else|:
literal|0
operator|)
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
break|break;
case|case
name|X_ConfigureWindow
case|:
if|if
condition|(
name|w
operator|==
name|rootwindow
condition|)
break|break;
name|Change_window
argument_list|(
name|w
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|2
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|3
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
break|break;
case|case
name|X_ChangeBackground
case|:
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|==
literal|0
condition|)
name|Change_background
argument_list|(
name|w
argument_list|,
operator|(
name|PIXMAP
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_PIXMAP
condition|)
name|Xstatus
operator|=
name|BadPixmap
expr_stmt|;
else|else
name|Change_background
argument_list|(
name|w
argument_list|,
operator|(
name|PIXMAP
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_ChangeBorder
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_PIXMAP
condition|)
name|Xstatus
operator|=
name|BadPixmap
expr_stmt|;
else|else
name|Change_border
argument_list|(
name|w
argument_list|,
operator|(
name|PIXMAP
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_TileMode
case|:
if|if
condition|(
name|req
operator|->
name|func
operator|>
literal|1
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|w
operator|!=
name|rootwindow
condition|)
name|w
operator|->
name|tilemode
operator|=
name|req
operator|->
name|func
expr_stmt|;
break|break;
case|case
name|X_ClipMode
case|:
if|if
condition|(
name|req
operator|->
name|func
operator|<=
literal|1
condition|)
name|w
operator|->
name|clipmode
operator|=
name|req
operator|->
name|func
expr_stmt|;
else|else
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
break|break;
case|case
name|X_QueryWindow
case|:
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|=
name|w
operator|->
name|full
operator|.
name|bottom
operator|-
name|w
operator|->
name|full
operator|.
name|top
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|1
index|]
operator|=
name|w
operator|->
name|full
operator|.
name|right
operator|-
name|w
operator|->
name|full
operator|.
name|left
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|2
index|]
operator|=
name|w
operator|->
name|full
operator|.
name|left
operator|-
name|w
operator|->
name|bwidth
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|3
index|]
operator|=
name|w
operator|->
name|full
operator|.
name|top
operator|-
name|w
operator|->
name|bwidth
expr_stmt|;
if|if
condition|(
name|TRUE
argument_list|(
name|w
operator|->
name|mapped
argument_list|)
operator|&&
name|w
operator|->
name|parent
condition|)
block|{
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|2
index|]
operator|-=
name|w
operator|->
name|parent
operator|->
name|full
operator|.
name|left
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|3
index|]
operator|-=
name|w
operator|->
name|parent
operator|->
name|full
operator|.
name|top
expr_stmt|;
block|}
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|4
index|]
operator|=
name|w
operator|->
name|bwidth
expr_stmt|;
if|if
condition|(
name|TRUE
argument_list|(
name|w
operator|->
name|should_be_mapped
argument_list|)
operator|&&
name|FALSE
argument_list|(
name|w
operator|->
name|mapped
argument_list|)
condition|)
name|rep
operator|.
name|param
operator|.
name|b
index|[
literal|10
index|]
operator|=
name|IsInvisible
expr_stmt|;
else|else
name|rep
operator|.
name|param
operator|.
name|b
index|[
literal|10
index|]
operator|=
name|w
operator|->
name|mapped
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|b
index|[
literal|11
index|]
operator|=
name|w
operator|->
name|kind
expr_stmt|;
if|if
condition|(
name|w
operator|->
name|icon
condition|)
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|=
name|w
operator|->
name|icon
operator|->
name|rid
expr_stmt|;
else|else
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|4
index|]
operator|=
name|w
operator|->
name|mask
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|4
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
break|break;
case|case
name|X_StoreName
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|BytePad
argument_list|(
name|n
argument_list|)
argument_list|)
condition|)
block|{
if|if
condition|(
name|w
operator|->
name|name
condition|)
block|{
name|free
argument_list|(
name|w
operator|->
name|name
argument_list|)
expr_stmt|;
name|w
operator|->
name|name
operator|=
name|NULL
expr_stmt|;
block|}
name|w
operator|->
name|name
operator|=
name|Xalloc
argument_list|(
name|n
operator|+
literal|1
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|data1
argument_list|,
name|w
operator|->
name|name
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|w
operator|->
name|name
index|[
name|n
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
break|break;
case|case
name|X_FetchName
case|:
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|=
name|count
operator|=
name|w
operator|->
name|name
condition|?
name|strlen
argument_list|(
name|w
operator|->
name|name
argument_list|)
else|:
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
if|if
condition|(
name|n
operator|=
name|count
condition|)
name|Write
argument_list|(
name|client
argument_list|,
name|w
operator|->
name|name
argument_list|,
name|BytePad
argument_list|(
name|n
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_SetIconWindow
case|:
if|if
condition|(
name|w
operator|->
name|kind
operator|!=
name|IsOpaque
condition|)
name|Xstatus
operator|=
name|BadMatch
expr_stmt|;
elseif|else
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|icon
operator|=
name|w
operator|->
name|icon
condition|)
block|{
name|icon
operator|->
name|kind
operator|=
name|IsOpaque
expr_stmt|;
name|icon
operator|->
name|icon
operator|=
name|NULL
expr_stmt|;
name|w
operator|->
name|icon
operator|=
name|NULL
expr_stmt|;
block|}
block|}
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_WINDOW
condition|)
name|Xstatus
operator|=
name|BadWindow
expr_stmt|;
else|else
block|{
name|icon
operator|=
operator|(
name|WINDOW
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
if|if
condition|(
name|icon
operator|->
name|kind
operator|!=
name|IsOpaque
operator|||
name|icon
operator|==
name|w
operator|||
name|icon
operator|->
name|parent
operator|!=
name|w
operator|->
name|parent
condition|)
name|Xstatus
operator|=
name|BadMatch
expr_stmt|;
else|else
block|{
name|icon
operator|->
name|kind
operator|=
name|IsIcon
expr_stmt|;
name|icon
operator|->
name|icon
operator|=
name|w
expr_stmt|;
name|w
operator|->
name|icon
operator|=
name|icon
expr_stmt|;
block|}
block|}
break|break;
case|case
name|X_SetResizeHint
case|:
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|<
literal|0
operator|||
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
operator|<=
literal|0
operator|||
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|2
index|]
operator|<
literal|0
operator|||
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|3
index|]
operator|<=
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
else|else
block|{
name|w
operator|->
name|height0
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
expr_stmt|;
name|w
operator|->
name|heightinc
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
expr_stmt|;
name|w
operator|->
name|width0
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|2
index|]
expr_stmt|;
name|w
operator|->
name|widthinc
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|3
index|]
expr_stmt|;
block|}
break|break;
case|case
name|X_GetResizeHint
case|:
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|=
name|w
operator|->
name|height0
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|1
index|]
operator|=
name|w
operator|->
name|heightinc
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|2
index|]
operator|=
name|w
operator|->
name|width0
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|3
index|]
operator|=
name|w
operator|->
name|widthinc
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
break|break;
case|case
name|X_DefineCursor
case|:
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|w
operator|==
name|rootwindow
condition|)
name|Register_cursor
argument_list|(
name|w
argument_list|,
name|rootcursor
argument_list|)
expr_stmt|;
else|else
name|Unregister_cursor
argument_list|(
name|w
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_CURSOR
condition|)
name|Xstatus
operator|=
name|BadCursor
expr_stmt|;
else|else
name|Register_cursor
argument_list|(
name|w
argument_list|,
operator|(
name|CURSOR
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_SelectInput
case|:
name|Select_input
argument_list|(
name|w
argument_list|,
name|client
argument_list|,
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_GrabMouse
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_CURSOR
condition|)
name|Xstatus
operator|=
name|BadCursor
expr_stmt|;
else|else
block|{
name|Grab_mouse
argument_list|(
name|w
argument_list|,
operator|(
name|CURSOR
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|,
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|1
index|]
argument_list|,
name|client
argument_list|)
expr_stmt|;
if|if
condition|(
name|Xstatus
condition|)
break|break;
name|REPLY
expr_stmt|;
block|}
break|break;
case|case
name|X_GrabButton
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_CURSOR
condition|)
name|Xstatus
operator|=
name|BadCursor
expr_stmt|;
else|else
block|{
name|Grab_button
argument_list|(
name|w
argument_list|,
operator|(
name|CURSOR
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|,
name|req
operator|->
name|mask
argument_list|,
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|1
index|]
argument_list|,
name|client
argument_list|)
expr_stmt|;
if|if
condition|(
name|Xstatus
condition|)
break|break;
name|REPLY
expr_stmt|;
block|}
break|break;
case|case
name|X_QueryMouse
case|:
name|mcursor
operator|=
operator|*
name|device
operator|.
name|mouse
expr_stmt|;
name|Interpret_locator
argument_list|(
name|w
argument_list|,
name|mcursor
operator|.
name|x
operator|+
name|cursor
operator|->
name|xoff
argument_list|,
name|mcursor
operator|.
name|y
operator|+
name|cursor
operator|->
name|yoff
argument_list|,
operator|&
name|rep
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|4
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
break|break;
case|case
name|X_InterpretLocator
case|:
name|Interpret_locator
argument_list|(
name|w
argument_list|,
ifdef|#
directive|ifdef
name|vax
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
else|#
directive|else
ifdef|#
directive|ifdef
name|mc68000
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|,
else|#
directive|else
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|>>
literal|16
argument_list|,
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|&
literal|0xffff
argument_list|,
endif|#
directive|endif
endif|#
directive|endif
operator|&
name|rep
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
break|break;
case|case
name|X_WarpMouse
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|1
index|]
operator|,
name|RT_WINDOW
condition|)
name|Xstatus
operator|=
name|BadWindow
expr_stmt|;
else|else
name|Warp_mouse
argument_list|(
name|w
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|,
operator|(
name|WINDOW
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|,
operator|(
name|REGION
operator|*
operator|)
operator|&
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_FocusKeyboard
case|:
name|Focus_keyboard
argument_list|(
name|w
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_CircWindowDown
case|:
name|Circulate_window_down
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
break|break;
case|case
name|X_QueryTree
case|:
name|count
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|sw
operator|=
name|w
operator|->
name|first_child
init|;
name|sw
condition|;
name|sw
operator|=
name|sw
operator|->
name|next_sib
control|)
name|count
operator|++
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|w
operator|->
name|parent
condition|?
name|w
operator|->
name|parent
operator|->
name|rid
else|:
literal|0
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|1
index|]
operator|=
name|count
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
if|if
condition|(
name|n
operator|=
name|count
condition|)
block|{
name|data1
operator|=
name|Xalloc
argument_list|(
name|n
operator|<<
literal|2
argument_list|)
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|sw
operator|=
name|w
operator|->
name|first_child
init|;
name|sw
condition|;
name|sw
operator|=
name|sw
operator|->
name|next_sib
control|)
block|{
operator|(
operator|(
name|Window
operator|*
operator|)
name|data1
operator|)
index|[
name|n
index|]
operator|=
name|sw
operator|->
name|rid
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
name|Swap_longs
argument_list|(
operator|(
name|long
operator|*
operator|)
name|data1
argument_list|,
name|n
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|Write
argument_list|(
name|client
argument_list|,
name|data1
argument_list|,
name|n
operator|<<
literal|2
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|data1
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|X_Clear
case|:
name|Do_background
argument_list|(
name|w
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_PixFill
case|:
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|==
literal|0
condition|)
name|bit1
operator|=
name|NULL
expr_stmt|;
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|,
name|RT_BITMAP
condition|)
block|{
name|Xstatus
operator|=
name|BadBitmap
expr_stmt|;
break|break;
block|}
else|else
name|bit1
operator|=
operator|(
name|BITMAP
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
name|Do_PixFill
argument_list|(
name|w
argument_list|,
name|req
argument_list|,
name|bit1
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_TileFill
case|:
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|==
literal|0
condition|)
name|bit1
operator|=
name|NULL
expr_stmt|;
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|,
name|RT_BITMAP
condition|)
block|{
name|Xstatus
operator|=
name|BadBitmap
expr_stmt|;
break|break;
block|}
else|else
name|bit1
operator|=
operator|(
name|BITMAP
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|2
index|]
operator|,
name|RT_PIXMAP
condition|)
name|Xstatus
operator|=
name|BadPixmap
expr_stmt|;
else|else
name|Do_TileFill
argument_list|(
name|w
argument_list|,
name|req
argument_list|,
operator|(
name|PIXMAP
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|,
name|bit1
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_PixmapPut
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|2
index|]
operator|,
name|RT_PIXMAP
condition|)
name|Xstatus
operator|=
name|BadPixmap
expr_stmt|;
else|else
name|Do_PixmapPut
argument_list|(
name|w
argument_list|,
name|req
argument_list|,
operator|(
name|PIXMAP
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_PixmapBitsPut
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|Pix_size
argument_list|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|4
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|)
operator|)
operator|==
literal|0
operator|||
operator|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|n
argument_list|)
operator|)
operator|==
name|NULL
condition|)
break|break;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
operator|&&
operator|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|4
index|]
operator|==
name|XYFormat
operator|||
name|device
operator|.
name|planes
operator|>
literal|8
operator|)
condition|)
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data1
argument_list|,
name|n
operator|>>
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|==
literal|0
condition|)
name|bit1
operator|=
name|NULL
expr_stmt|;
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|,
name|RT_BITMAP
condition|)
block|{
name|Xstatus
operator|=
name|BadBitmap
expr_stmt|;
break|break;
block|}
else|else
name|bit1
operator|=
operator|(
name|BITMAP
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
name|Do_PixmapBitsPut
argument_list|(
name|w
argument_list|,
name|req
argument_list|,
name|data1
argument_list|,
name|bit1
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_BitmapBitsPut
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|Bit_size
argument_list|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|)
operator|)
operator|==
literal|0
operator|||
operator|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|n
argument_list|)
operator|)
operator|==
name|NULL
condition|)
break|break;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data1
argument_list|,
name|n
operator|>>
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|==
literal|0
condition|)
name|bit1
operator|=
name|NULL
expr_stmt|;
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|,
name|RT_BITMAP
condition|)
block|{
name|Xstatus
operator|=
name|BadBitmap
expr_stmt|;
break|break;
block|}
else|else
name|bit1
operator|=
operator|(
name|BITMAP
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
name|Do_BitmapBitsPut
argument_list|(
name|w
argument_list|,
name|req
argument_list|,
name|data1
argument_list|,
name|bit1
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_CopyArea
case|:
name|Do_CopyArea
argument_list|(
name|w
argument_list|,
name|req
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_Text
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|6
index|]
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|BytePad
argument_list|(
name|n
argument_list|)
argument_list|)
condition|)
block|{
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|1
index|]
operator|,
name|RT_FONT
condition|)
name|Xstatus
operator|=
name|BadFont
expr_stmt|;
elseif|else
if|if
condition|(
name|TRUE
argument_list|(
name|w
operator|->
name|unobscured
argument_list|)
operator|&&
name|w
operator|->
name|kind
operator|!=
name|IsTransparent
operator|&&
name|TRUE
argument_list|(
name|w
operator|->
name|mapped
argument_list|)
operator|&&
name|req
operator|->
name|func
operator|<
name|funclim
operator|&&
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|6
index|]
operator|>
literal|0
condition|)
comment|/* We special case this just to make it faster */
name|PrintText
argument_list|(
name|data1
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|6
index|]
argument_list|,
operator|(
name|FONT
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|,
operator|(
name|int
operator|)
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|4
index|]
argument_list|,
operator|(
name|int
operator|)
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|5
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|b
index|[
literal|14
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|b
index|[
literal|15
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|+
name|w
operator|->
name|full
operator|.
name|left
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
operator|+
name|w
operator|->
name|full
operator|.
name|top
argument_list|,
operator|&
name|w
operator|->
name|clip
argument_list|,
literal|1
argument_list|,
operator|(
name|int
operator|)
name|req
operator|->
name|func
argument_list|,
operator|(
name|int
operator|)
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
else|else
name|Do_Text
argument_list|(
name|w
argument_list|,
name|req
argument_list|,
name|data1
argument_list|,
operator|(
name|FONT
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|X_TextMask
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|6
index|]
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|BytePad
argument_list|(
name|n
argument_list|)
argument_list|)
condition|)
block|{
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|1
index|]
operator|,
name|RT_FONT
condition|)
name|Xstatus
operator|=
name|BadFont
expr_stmt|;
else|else
name|Do_TextMask
argument_list|(
name|w
argument_list|,
name|req
argument_list|,
name|data1
argument_list|,
operator|(
name|FONT
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|X_Line
case|:
name|Do_Line
argument_list|(
name|w
argument_list|,
name|req
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_Draw
case|:
if|if
condition|(
operator|(
name|n
operator|=
operator|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|*
sizeof|sizeof
argument_list|(
name|Vertex
argument_list|)
operator|)
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|WordPad
argument_list|(
name|n
argument_list|)
argument_list|)
condition|)
block|{
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data1
argument_list|,
name|n
operator|>>
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|Do_Draw
argument_list|(
name|w
argument_list|,
name|req
argument_list|,
operator|(
name|Vertex
operator|*
operator|)
name|data1
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|X_DrawFilled
case|:
if|if
condition|(
operator|(
name|n
operator|=
operator|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|*
sizeof|sizeof
argument_list|(
name|Vertex
argument_list|)
operator|)
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|WordPad
argument_list|(
name|n
argument_list|)
argument_list|)
condition|)
block|{
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|1
index|]
operator|==
literal|0
condition|)
name|pix1
operator|=
name|NULL
expr_stmt|;
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|1
index|]
operator|,
name|RT_PIXMAP
condition|)
block|{
name|Xstatus
operator|=
name|BadPixmap
expr_stmt|;
break|break;
block|}
else|else
name|pix1
operator|=
operator|(
name|PIXMAP
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data1
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|*
operator|(
sizeof|sizeof
argument_list|(
name|Vertex
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|short
argument_list|)
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|Do_DrawFilled
argument_list|(
name|w
argument_list|,
name|req
argument_list|,
operator|(
name|Vertex
operator|*
operator|)
name|data1
argument_list|,
name|pix1
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|X_PixmapSave
case|:
name|pix1
operator|=
name|Do_PixmapSave
argument_list|(
name|w
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|Xstatus
condition|)
break|break;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|Add_resource
argument_list|(
name|RT_PIXMAP
argument_list|,
name|client
argument_list|,
operator|(
name|caddr_t
operator|)
name|pix1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
break|break;
case|case
name|X_PixmapGet
case|:
name|Do_PixmapGet
argument_list|(
name|w
argument_list|,
name|req
argument_list|,
name|client
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_StippleFill
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|3
index|]
operator|,
name|RT_BITMAP
condition|)
block|{
name|Xstatus
operator|=
name|BadBitmap
expr_stmt|;
break|break;
block|}
else|else
name|bit1
operator|=
operator|(
name|BITMAP
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
name|Do_StippleFill
argument_list|(
name|w
argument_list|,
name|req
argument_list|,
name|bit1
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_SetUp
case|:
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|rootwindow
operator|->
name|rid
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|2
index|]
operator|=
name|X_PROTOCOL
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|3
index|]
operator|=
name|device
operator|.
name|id
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|4
index|]
operator|=
name|device
operator|.
name|planes
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|5
index|]
operator|=
name|device
operator|.
name|entries
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
break|break;
case|case
name|X_UngrabMouse
case|:
name|Ungrab_mouse
argument_list|(
name|client
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_UngrabButton
case|:
name|Ungrab_button
argument_list|(
name|req
operator|->
name|mask
argument_list|,
name|client
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_GetColor
case|:
if|if
condition|(
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|0
index|]
operator|=
name|Get_color
argument_list|(
name|client
argument_list|,
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|1
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|2
index|]
argument_list|)
condition|)
block|{
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
block|}
break|break;
case|case
name|X_GetColorCells
case|:
if|if
condition|(
name|req
operator|->
name|func
operator|>
literal|1
operator|||
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|<
literal|0
operator|||
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
operator|<
literal|0
condition|)
block|{
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
break|break;
block|}
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|0
index|]
operator|=
name|Get_cells
argument_list|(
name|client
argument_list|,
operator|(
name|int
operator|)
name|req
operator|->
name|func
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|,
operator|(
name|ushort
operator|*
operator|*
operator|)
operator|&
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|Xstatus
condition|)
block|{
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data1
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
if|if
condition|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
condition|)
block|{
name|Write
argument_list|(
name|client
argument_list|,
name|data1
argument_list|,
name|WordPad
argument_list|(
name|n
operator|<<
literal|1
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data1
argument_list|,
name|n
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
break|break;
case|case
name|X_FreeColors
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|WordPad
argument_list|(
name|n
operator|<<
literal|1
argument_list|)
argument_list|)
condition|)
block|{
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data1
argument_list|,
name|n
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|Free_colors
argument_list|(
name|client
argument_list|,
name|n
argument_list|,
operator|(
name|ushort
operator|*
operator|)
name|data1
argument_list|,
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|X_StoreColors
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|n
operator|*
sizeof|sizeof
argument_list|(
name|ColorDef
argument_list|)
argument_list|)
condition|)
block|{
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data1
argument_list|,
name|n
operator|*
operator|(
sizeof|sizeof
argument_list|(
name|ColorDef
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|short
argument_list|)
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|Store_colors
argument_list|(
name|n
argument_list|,
operator|(
name|ColorDef
operator|*
operator|)
name|data1
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|X_QueryColor
case|:
name|Query_color
argument_list|(
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|0
index|]
argument_list|,
name|rep
operator|.
name|param
operator|.
name|u
operator|+
literal|0
argument_list|,
name|rep
operator|.
name|param
operator|.
name|u
operator|+
literal|1
argument_list|,
name|rep
operator|.
name|param
operator|.
name|u
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|Xstatus
condition|)
block|{
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
block|}
break|break;
case|case
name|X_GetFont
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|)
operator|<=
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|BytePad
argument_list|(
name|n
argument_list|)
argument_list|)
condition|)
block|{
name|data2
operator|=
name|Xalloc
argument_list|(
name|n
operator|+
literal|1
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|data1
argument_list|,
name|data2
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|data2
index|[
name|n
index|]
operator|=
literal|'\0'
expr_stmt|;
name|font
operator|=
name|Get_font
argument_list|(
name|data2
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|data2
argument_list|)
expr_stmt|;
if|if
condition|(
name|Xstatus
condition|)
break|break;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|Add_resource
argument_list|(
name|RT_FONT
argument_list|,
name|client
argument_list|,
operator|(
name|caddr_t
operator|)
name|font
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
block|}
break|break;
case|case
name|X_FreeFont
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_FONT
condition|)
name|Xstatus
operator|=
name|BadFont
expr_stmt|;
else|else
name|Free_resource
argument_list|(
name|rptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_QueryFont
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_FONT
condition|)
name|Xstatus
operator|=
name|BadFont
expr_stmt|;
else|else
block|{
name|font
operator|=
operator|(
name|FONT
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|=
name|font
operator|->
name|height
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|1
index|]
operator|=
name|font
operator|->
name|avg_width
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|2
index|]
operator|=
name|font
operator|->
name|first
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|3
index|]
operator|=
name|font
operator|->
name|last
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|4
index|]
operator|=
name|font
operator|->
name|base
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|5
index|]
operator|=
name|font
operator|->
name|fixed
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
block|}
break|break;
case|case
name|X_CharWidths
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|2
index|]
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|BytePad
argument_list|(
name|n
argument_list|)
argument_list|)
condition|)
block|{
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_FONT
condition|)
name|Xstatus
operator|=
name|BadFont
expr_stmt|;
else|else
block|{
name|font
operator|=
operator|(
name|FONT
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|2
index|]
expr_stmt|;
name|data2
operator|=
name|Xalloc
argument_list|(
operator|(
name|int
operator|)
name|WordPad
argument_list|(
name|count
operator|=
name|n
operator|<<
literal|1
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
operator|--
name|n
operator|>=
literal|0
condition|)
operator|(
operator|(
name|short
operator|*
operator|)
name|data2
operator|)
index|[
name|n
index|]
operator|=
name|CharWidth
argument_list|(
operator|(
operator|(
name|u_char
operator|*
operator|)
name|data1
operator|)
index|[
name|n
index|]
argument_list|,
name|font
argument_list|)
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|count
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data2
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
name|Write
argument_list|(
name|client
argument_list|,
name|data2
argument_list|,
name|WordPad
argument_list|(
name|count
argument_list|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|data2
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|X_StringWidth
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|2
index|]
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|BytePad
argument_list|(
name|n
argument_list|)
argument_list|)
condition|)
block|{
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_FONT
condition|)
name|Xstatus
operator|=
name|BadFont
expr_stmt|;
else|else
block|{
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|=
name|TextWidth
argument_list|(
name|data1
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|,
operator|(
name|FONT
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
block|}
block|}
break|break;
case|case
name|X_FontWidths
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_FONT
condition|)
name|Xstatus
operator|=
name|BadFont
expr_stmt|;
else|else
block|{
name|font
operator|=
operator|(
name|FONT
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
name|n
operator|=
name|font
operator|->
name|last
operator|-
name|font
operator|->
name|first
operator|+
literal|1
expr_stmt|;
name|data1
operator|=
name|Xalloc
argument_list|(
operator|(
name|int
operator|)
name|WordPad
argument_list|(
name|count
operator|=
name|n
operator|<<
literal|1
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
operator|--
name|n
operator|>=
literal|0
condition|)
operator|(
operator|(
name|short
operator|*
operator|)
name|data1
operator|)
index|[
name|n
index|]
operator|=
name|CharWidth
argument_list|(
operator|(
name|unsigned
operator|)
name|font
operator|->
name|first
operator|+
name|n
argument_list|,
name|font
argument_list|)
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|count
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data1
argument_list|,
name|count
operator|>>
literal|1
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
name|Write
argument_list|(
name|client
argument_list|,
name|data1
argument_list|,
name|WordPad
argument_list|(
name|count
argument_list|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|data1
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|X_StoreBitmap
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|Bit_size
argument_list|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|)
operator|)
operator|>
literal|0
operator|&&
operator|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|n
argument_list|)
operator|)
condition|)
block|{
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data1
argument_list|,
name|n
operator|>>
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|bit1
operator|=
name|StoreBitmap
argument_list|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|bit1
operator|==
name|NULL
condition|)
name|Xstatus
operator|=
name|BadAlloc
expr_stmt|;
else|else
block|{
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|Add_resource
argument_list|(
name|RT_BITMAP
argument_list|,
name|client
argument_list|,
operator|(
name|caddr_t
operator|)
name|bit1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
block|}
block|}
break|break;
case|case
name|X_FreeBitmap
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_BITMAP
condition|)
name|Xstatus
operator|=
name|BadBitmap
expr_stmt|;
else|else
name|Free_resource
argument_list|(
name|rptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_CharBitmap
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_FONT
condition|)
name|Xstatus
operator|=
name|BadFont
expr_stmt|;
else|else
block|{
name|bit1
operator|=
name|CharBitmap
argument_list|(
operator|(
name|unsigned
operator|)
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|2
index|]
argument_list|,
operator|(
name|FONT
operator|*
operator|)
name|rptr
operator|->
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|bit1
condition|)
block|{
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|Add_resource
argument_list|(
name|RT_BITMAP
argument_list|,
name|client
argument_list|,
operator|(
name|caddr_t
operator|)
name|bit1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|errno
operator|==
name|ENOMEM
condition|)
name|Xstatus
operator|=
name|BadAlloc
expr_stmt|;
else|else
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
block|}
break|break;
case|case
name|X_StorePixmap
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|Pix_size
argument_list|(
operator|(
name|int
operator|)
name|req
operator|->
name|func
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|)
operator|)
operator|>
literal|0
operator|&&
operator|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|n
argument_list|)
operator|)
condition|)
block|{
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
operator|&&
operator|(
name|req
operator|->
name|func
operator|==
name|XYFormat
operator|||
name|device
operator|.
name|planes
operator|>
literal|8
operator|)
condition|)
name|Swap_shorts
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data1
argument_list|,
name|n
operator|>>
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pix1
operator|=
name|StorePixmap
argument_list|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|,
operator|(
name|int
operator|)
name|req
operator|->
name|func
argument_list|,
name|data1
argument_list|)
expr_stmt|;
if|if
condition|(
name|pix1
operator|==
name|NULL
condition|)
name|Xstatus
operator|=
name|BadAlloc
expr_stmt|;
else|else
block|{
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|Add_resource
argument_list|(
name|RT_PIXMAP
argument_list|,
name|client
argument_list|,
operator|(
name|caddr_t
operator|)
name|pix1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
block|}
block|}
break|break;
case|case
name|X_FreePixmap
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_PIXMAP
condition|)
name|Xstatus
operator|=
name|BadBitmap
expr_stmt|;
else|else
name|Free_resource
argument_list|(
name|rptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_MakePixmap
case|:
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
name|bit1
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|2
index|]
operator|>
name|WhitePixel
operator|&&
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|2
index|]
operator|>=
name|device
operator|.
name|entries
condition|)
block|{
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_BITMAP
condition|)
block|{
name|Xstatus
operator|=
name|BadBitmap
expr_stmt|;
break|break;
block|}
elseif|else
if|if
condition|(
operator|(
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|2
index|]
operator|>
name|WhitePixel
operator|&&
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|2
index|]
operator|>=
name|device
operator|.
name|entries
operator|)
operator|||
operator|(
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|3
index|]
operator|>
name|WhitePixel
operator|&&
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|3
index|]
operator|>=
name|device
operator|.
name|entries
operator|)
condition|)
block|{
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
break|break;
block|}
else|else
name|bit1
operator|=
operator|(
name|BITMAP
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
name|pix1
operator|=
name|MakePixmap
argument_list|(
name|bit1
argument_list|,
operator|(
name|int
operator|)
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|2
index|]
argument_list|,
operator|(
name|int
operator|)
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|pix1
operator|==
name|NULL
condition|)
name|Xstatus
operator|=
name|BadAlloc
expr_stmt|;
else|else
block|{
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|Add_resource
argument_list|(
name|RT_PIXMAP
argument_list|,
name|client
argument_list|,
operator|(
name|caddr_t
operator|)
name|pix1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
block|}
break|break;
case|case
name|X_QueryShape
case|:
if|if
condition|(
name|req
operator|->
name|func
operator|>
literal|2
operator|||
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|<=
literal|0
operator|||
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
operator|<=
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
else|else
block|{
name|QueryShape
argument_list|(
operator|(
name|int
operator|)
name|req
operator|->
name|func
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
operator|+
literal|1
argument_list|)
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|1
index|]
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
block|}
break|break;
case|case
name|X_StoreCursor
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_BITMAP
condition|)
block|{
name|Xstatus
operator|=
name|BadBitmap
expr_stmt|;
break|break;
block|}
name|bit1
operator|=
operator|(
name|BITMAP
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|2
index|]
operator|==
literal|0
condition|)
name|bit2
operator|=
name|NULL
expr_stmt|;
elseif|else
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|2
index|]
operator|,
name|RT_BITMAP
condition|)
block|{
name|Xstatus
operator|=
name|BadBitmap
expr_stmt|;
break|break;
block|}
else|else
name|bit2
operator|=
operator|(
name|BITMAP
operator|*
operator|)
name|rptr
operator|->
name|value
expr_stmt|;
name|cur
operator|=
name|Store_cursor
argument_list|(
name|bit1
argument_list|,
name|bit2
argument_list|,
operator|(
name|int
operator|)
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|2
index|]
argument_list|,
operator|(
name|int
operator|)
name|req
operator|->
name|param
operator|.
name|u
index|[
literal|3
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|6
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|7
index|]
argument_list|,
name|req
operator|->
name|func
argument_list|)
expr_stmt|;
if|if
condition|(
name|Xstatus
condition|)
break|break;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|Add_resource
argument_list|(
name|RT_CURSOR
argument_list|,
name|client
argument_list|,
operator|(
name|caddr_t
operator|)
name|cur
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
break|break;
case|case
name|X_FreeCursor
case|:
if|if ILLEGAL
condition|(
name|req
operator|->
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|,
name|RT_CURSOR
condition|)
name|Xstatus
operator|=
name|BadCursor
expr_stmt|;
else|else
name|Free_resource
argument_list|(
name|rptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_MouseControl
case|:
if|if
condition|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|<=
literal|0
operator|||
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
else|else
name|SetMouseCharacteristics
argument_list|(
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
argument_list|,
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_FeepControl
case|:
if|if
condition|(
name|req
operator|->
name|func
operator|>
literal|7
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
else|else
name|base_feep
operator|=
name|req
operator|->
name|func
expr_stmt|;
break|break;
case|case
name|X_Feep
case|:
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|n
operator|<
operator|-
literal|7
operator|||
name|n
operator|>
literal|7
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
else|else
block|{
name|n
operator|+=
name|base_feep
expr_stmt|;
if|if
condition|(
name|n
operator|<
literal|0
condition|)
name|n
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|n
operator|>
literal|7
condition|)
name|n
operator|=
literal|7
expr_stmt|;
name|SoundBell
argument_list|(
name|n
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|X_ShiftLock
case|:
if|if
condition|(
name|req
operator|->
name|func
operator|>
literal|1
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
else|else
name|Set_shiftlock
argument_list|(
operator|(
name|int
operator|)
name|req
operator|->
name|func
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_KeyClick
case|:
if|if
condition|(
name|req
operator|->
name|func
operator|>
literal|8
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
else|else
name|SetKeyClick
argument_list|(
operator|(
name|int
operator|)
name|req
operator|->
name|func
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_AutoRepeat
case|:
if|if
condition|(
name|req
operator|->
name|func
operator|>
literal|1
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
else|else
name|SetAutoRepeat
argument_list|(
operator|(
name|int
operator|)
name|req
operator|->
name|func
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_ScreenSaver
case|:
if|if
condition|(
name|req
operator|->
name|func
operator|>
literal|1
operator|||
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|<=
literal|0
operator|||
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
operator|<=
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
else|else
block|{
name|blank_video
operator|=
literal|1
operator|-
name|req
operator|->
name|func
expr_stmt|;
name|waittime
operator|.
name|tv_sec
operator|=
literal|60
operator|*
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
expr_stmt|;
name|longtime
operator|.
name|tv_sec
operator|=
literal|60
operator|*
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|1
index|]
expr_stmt|;
block|}
break|break;
case|case
name|X_StoreBytes
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|BytePad
argument_list|(
name|n
argument_list|)
argument_list|)
condition|)
name|Store_cut
argument_list|(
name|req
operator|->
name|func
argument_list|,
name|data1
argument_list|,
name|n
argument_list|)
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|X_AppendBytes
case|case
name|X_AppendBytes
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|BytePad
argument_list|(
name|n
argument_list|)
argument_list|)
condition|)
name|Append_to_cut
argument_list|(
name|req
operator|->
name|func
argument_list|,
name|data1
argument_list|,
name|n
argument_list|)
expr_stmt|;
break|break;
endif|#
directive|endif
endif|X_AppendBytes
case|case
name|X_FetchBytes
case|:
if|if
condition|(
operator|(
name|count
operator|=
name|Fetch_cut
argument_list|(
name|req
operator|->
name|func
argument_list|,
operator|&
name|data1
argument_list|)
operator|)
operator|>=
literal|0
condition|)
block|{
name|rep
operator|.
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|=
name|count
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
if|if
condition|(
name|n
operator|=
name|count
condition|)
name|Write
argument_list|(
name|client
argument_list|,
name|data1
argument_list|,
name|BytePad
argument_list|(
name|n
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|X_RotateCuts
case|:
name|Rotate_cuts
argument_list|(
name|req
operator|->
name|func
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_AddHost
case|:
name|Add_host
argument_list|(
name|client
argument_list|,
operator|(
name|short
operator|)
name|req
operator|->
name|func
argument_list|,
name|req
operator|->
name|param
operator|.
name|b
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_RemoveHost
case|:
name|Remove_host
argument_list|(
name|client
argument_list|,
operator|(
name|short
operator|)
name|req
operator|->
name|func
argument_list|,
name|req
operator|->
name|param
operator|.
name|b
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_GetHosts
case|:
if|if
condition|(
operator|(
name|count
operator|=
name|Get_hosts
argument_list|(
operator|(
name|short
operator|)
name|req
operator|->
name|func
argument_list|,
operator|&
name|data1
argument_list|)
operator|)
operator|<
literal|0
condition|)
break|break;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|count
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
if|if
condition|(
name|count
condition|)
block|{
name|Write
argument_list|(
name|client
argument_list|,
name|data1
argument_list|,
name|count
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|data1
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|X_GrabServer
case|:
name|Grab_server
argument_list|(
name|client
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_UngrabServer
case|:
name|Ungrab_server
argument_list|()
expr_stmt|;
break|break;
case|case
name|X_LookupColor
case|:
if|if
condition|(
operator|(
name|n
operator|=
name|req
operator|->
name|param
operator|.
name|s
index|[
literal|0
index|]
operator|)
operator|<
literal|0
condition|)
name|Xstatus
operator|=
name|BadValue
expr_stmt|;
elseif|else
if|if
condition|(
name|data1
operator|=
name|Read_segment
argument_list|(
name|client
argument_list|,
name|BytePad
argument_list|(
name|n
argument_list|)
argument_list|)
condition|)
block|{
if|if TRUE
condition|(
name|havergb
condition|)
block|{
name|dbent
operator|.
name|dptr
operator|=
name|data1
expr_stmt|;
name|dbent
operator|.
name|dsize
operator|=
name|n
expr_stmt|;
name|dbent
operator|=
name|fetch
argument_list|(
name|dbent
argument_list|)
expr_stmt|;
if|if
condition|(
name|dbent
operator|.
name|dptr
condition|)
block|{
name|bcopy
argument_list|(
name|dbent
operator|.
name|dptr
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|color
argument_list|,
sizeof|sizeof
argument_list|(
name|RGB
argument_list|)
argument_list|)
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|0
index|]
operator|=
name|color
operator|.
name|red
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|1
index|]
operator|=
name|color
operator|.
name|green
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|2
index|]
operator|=
name|color
operator|.
name|blue
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|3
index|]
operator|=
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|0
index|]
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|4
index|]
operator|=
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|1
index|]
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|5
index|]
operator|=
name|rep
operator|.
name|param
operator|.
name|u
index|[
literal|2
index|]
expr_stmt|;
name|ResolveColor
argument_list|(
name|rep
operator|.
name|param
operator|.
name|u
operator|+
literal|3
argument_list|,
name|rep
operator|.
name|param
operator|.
name|u
operator|+
literal|4
argument_list|,
name|rep
operator|.
name|param
operator|.
name|u
operator|+
literal|5
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
operator|&
name|rep
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|REPLY
expr_stmt|;
block|}
else|else
name|Xstatus
operator|=
name|BadColor
expr_stmt|;
block|}
else|else
name|Xstatus
operator|=
name|BadColor
expr_stmt|;
block|}
break|break;
default|default:
name|Xstatus
operator|=
name|BadRequest
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|Xstatus
condition|)
name|Oops
argument_list|(
name|client
argument_list|,
name|req
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_ifdef
ifdef|#
directive|ifdef
name|DUALTCP
end_ifdef

begin_comment
comment|/* Byte swap a request */
end_comment

begin_expr_stmt
name|Swap_request
argument_list|(
name|req
argument_list|)
specifier|register
name|XReq
operator|*
name|req
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|swaptype
name|n
decl_stmt|;
switch|switch
condition|(
name|req
operator|->
name|code
condition|)
block|{
case|case
name|X_CreateWindow
case|:
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_CreateTransparency
case|:
case|case
name|X_ConfigureWindow
case|:
case|case
name|X_SetResizeHint
case|:
case|case
name|X_PixmapSave
case|:
case|case
name|X_PixmapGet
case|:
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_DestroyWindow
case|:
case|case
name|X_DestroySubwindows
case|:
case|case
name|X_MapWindow
case|:
case|case
name|X_MapSubwindows
case|:
case|case
name|X_UnmapWindow
case|:
case|case
name|X_UnmapSubwindows
case|:
case|case
name|X_UnmapTransparent
case|:
case|case
name|X_RaiseWindow
case|:
case|case
name|X_LowerWindow
case|:
case|case
name|X_CircWindowUp
case|:
case|case
name|X_TileMode
case|:
case|case
name|X_ClipMode
case|:
case|case
name|X_QueryWindow
case|:
case|case
name|X_FetchName
case|:
case|case
name|X_GetResizeHint
case|:
case|case
name|X_QueryMouse
case|:
case|case
name|X_FocusKeyboard
case|:
case|case
name|X_CircWindowDown
case|:
case|case
name|X_QueryTree
case|:
case|case
name|X_Clear
case|:
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_MoveWindow
case|:
case|case
name|X_ChangeWindow
case|:
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_ChangeBackground
case|:
case|case
name|X_ChangeBorder
case|:
case|case
name|X_SetIconWindow
case|:
case|case
name|X_DefineCursor
case|:
case|case
name|X_SelectInput
case|:
case|case
name|X_InterpretLocator
case|:
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_StoreName
case|:
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_GrabMouse
case|:
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_GrabButton
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_WarpMouse
case|:
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|7
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_PixFill
case|:
case|case
name|X_PixmapBitsPut
case|:
case|case
name|X_StippleFill
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_TileFill
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_PixmapPut
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|7
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_BitmapBitsPut
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_CopyArea
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|7
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_Text
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|6
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_TextMask
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|6
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_Line
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|4
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_Draw
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|7
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_DrawFilled
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
operator|&
name|req
operator|->
name|windowId
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_UngrabButton
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_GetColor
case|:
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_GetColorCells
case|:
case|case
name|X_StoreBitmap
case|:
case|case
name|X_StorePixmap
case|:
case|case
name|X_QueryShape
case|:
case|case
name|X_MouseControl
case|:
case|case
name|X_ScreenSaver
case|:
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_FreeColors
case|:
name|swaps
argument_list|(
operator|&
name|req
operator|->
name|mask
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_StoreColors
case|:
case|case
name|X_QueryColor
case|:
case|case
name|X_GetFont
case|:
case|case
name|X_Feep
case|:
case|case
name|X_StoreBytes
case|:
case|case
name|X_LookupColor
case|:
name|pswaps
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_FreeFont
case|:
case|case
name|X_QueryFont
case|:
case|case
name|X_FontWidths
case|:
case|case
name|X_FreeBitmap
case|:
case|case
name|X_FreePixmap
case|:
case|case
name|X_FreeCursor
case|:
name|pswapl
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_CharWidths
case|:
case|case
name|X_StringWidth
case|:
case|case
name|X_CharBitmap
case|:
name|pswapl
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_MakePixmap
case|:
name|pswapl
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
break|break;
case|case
name|X_StoreCursor
case|:
name|pswapl
argument_list|(
name|req
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
name|req
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|pswaps
argument_list|(
name|req
argument_list|,
literal|7
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_block

begin_comment
comment|/* Byte swap a list of longs */
end_comment

begin_expr_stmt
name|Swap_longs
argument_list|(
name|list
argument_list|,
name|count
argument_list|)
specifier|register
name|long
operator|*
name|list
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|count
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|swaptype
name|n
decl_stmt|;
while|while
condition|(
name|count
operator|>=
literal|8
condition|)
block|{
name|swapl
argument_list|(
name|list
operator|+
literal|0
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
name|list
operator|+
literal|1
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
name|list
operator|+
literal|2
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
name|list
operator|+
literal|3
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
name|list
operator|+
literal|4
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
name|list
operator|+
literal|5
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
name|list
operator|+
literal|6
argument_list|)
expr_stmt|;
name|swapl
argument_list|(
name|list
operator|+
literal|7
argument_list|)
expr_stmt|;
name|list
operator|+=
literal|8
expr_stmt|;
name|count
operator|-=
literal|8
expr_stmt|;
block|}
while|while
condition|(
operator|--
name|count
operator|>=
literal|0
condition|)
block|{
name|swapl
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|list
operator|++
expr_stmt|;
block|}
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* Byte swap a list of shorts */
end_comment

begin_expr_stmt
name|Swap_shorts
argument_list|(
name|list
argument_list|,
name|count
argument_list|)
specifier|register
name|short
operator|*
name|list
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|count
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|swaptype
name|n
decl_stmt|;
while|while
condition|(
name|count
operator|>=
literal|16
condition|)
block|{
name|swaps
argument_list|(
name|list
operator|+
literal|0
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|1
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|2
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|3
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|4
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|5
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|6
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|7
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|8
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|9
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|10
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|11
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|12
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|13
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|14
argument_list|)
expr_stmt|;
name|swaps
argument_list|(
name|list
operator|+
literal|15
argument_list|)
expr_stmt|;
name|list
operator|+=
literal|16
expr_stmt|;
name|count
operator|-=
literal|16
expr_stmt|;
block|}
while|while
condition|(
operator|--
name|count
operator|>=
literal|0
condition|)
block|{
name|swaps
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|list
operator|++
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/* Send an Error back to the client. */
end_comment

begin_macro
name|Oops
argument_list|(
argument|client
argument_list|,
argument|req
argument_list|)
end_macro

begin_decl_stmt
name|int
name|client
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|XReq
modifier|*
name|req
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XRep
name|rep
decl_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
specifier|register
name|swaptype
name|n
decl_stmt|;
endif|#
directive|endif
name|rep
operator|.
name|code
operator|=
name|X_Error
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|0
index|]
operator|=
name|requestId
index|[
name|client
index|]
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|b
index|[
literal|4
index|]
operator|=
name|Xstatus
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|b
index|[
literal|5
index|]
operator|=
name|req
operator|->
name|code
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|b
index|[
literal|6
index|]
operator|=
name|req
operator|->
name|func
expr_stmt|;
name|rep
operator|.
name|param
operator|.
name|l
index|[
literal|2
index|]
operator|=
name|req
operator|->
name|windowId
expr_stmt|;
ifdef|#
directive|ifdef
name|DUALTCP
if|if
condition|(
name|swapped
index|[
name|client
index|]
condition|)
block|{
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pswapl
argument_list|(
operator|&
name|rep
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|Write
argument_list|(
name|client
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|rep
argument_list|,
sizeof|sizeof
argument_list|(
name|XRep
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

