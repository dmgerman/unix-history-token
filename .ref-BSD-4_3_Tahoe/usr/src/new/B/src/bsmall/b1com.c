begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (c) Stichting Mathematisch Centrum, Amsterdam, 1984. */
end_comment

begin_comment
comment|/* $Header: b1com.c,v 1.1 84/06/28 00:49:03 timo Exp $ */
end_comment

begin_comment
comment|/************************************************************************/
end_comment

begin_comment
comment|/* B compounds                                                          */
end_comment

begin_comment
comment|/* plus Hows Funs and other odd types that don't fit anywhere else      */
end_comment

begin_comment
comment|/*                                                                      */
end_comment

begin_comment
comment|/* A compound is modelled as a sequence of len values, its fields.      */
end_comment

begin_comment
comment|/*                                                                      */
end_comment

begin_comment
comment|/************************************************************************/
end_comment

begin_include
include|#
directive|include
file|"b.h"
end_include

begin_include
include|#
directive|include
file|"b1obj.h"
end_include

begin_function
name|Visible
name|value
modifier|*
name|field
parameter_list|(
name|v
parameter_list|,
name|k
parameter_list|)
name|value
name|v
decl_stmt|;
name|intlet
name|k
decl_stmt|;
block|{
comment|/* k in {0..size-1}; no copy */
return|return
operator|(
name|value
operator|*
operator|)
name|Field
argument_list|(
name|v
argument_list|,
name|k
argument_list|)
return|;
block|}
end_function

begin_function
name|Visible
name|Procedure
name|put_in_field
parameter_list|(
name|v
parameter_list|,
name|c
parameter_list|,
name|i
parameter_list|)
name|value
name|v
decl_stmt|,
decl|*
name|c
decl_stmt|;
end_function

begin_decl_stmt
name|intlet
name|i
decl_stmt|;
end_decl_stmt

begin_block
block|{
comment|/*Note that no copy of v is made: the caller must do this*/
operator|*
operator|(
name|Ats
argument_list|(
operator|*
name|c
argument_list|)
operator|+
name|i
operator|)
operator|=
name|v
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Other types */
end_comment

begin_function
name|Visible
name|loc
name|mk_simploc
parameter_list|(
name|id
parameter_list|,
name|en
parameter_list|)
name|basidf
name|id
decl_stmt|;
name|env
name|en
decl_stmt|;
block|{
name|loc
name|l
init|=
name|grab_sim
argument_list|()
decl_stmt|;
operator|(
operator|*
name|Ats
argument_list|(
name|l
argument_list|)
operator|)
operator|=
name|copy
argument_list|(
name|id
argument_list|)
expr_stmt|;
operator|(
operator|*
operator|(
name|Ats
argument_list|(
name|l
argument_list|)
operator|+
literal|1
operator|)
operator|)
operator|=
operator|(
name|value
operator|)
name|en
expr_stmt|;
return|return
name|l
return|;
block|}
end_function

begin_function
name|Visible
name|loc
name|mk_trimloc
parameter_list|(
name|R
parameter_list|,
name|B
parameter_list|,
name|C
parameter_list|)
name|loc
name|R
decl_stmt|;
name|intlet
name|B
decl_stmt|,
name|C
decl_stmt|;
block|{
name|loc
name|l
init|=
name|grab_tri
argument_list|()
decl_stmt|;
name|trimloc
modifier|*
name|ll
init|=
operator|(
name|trimloc
operator|*
operator|)
name|Ats
argument_list|(
name|l
argument_list|)
decl_stmt|;
name|ll
operator|->
name|R
operator|=
name|copy
argument_list|(
name|R
argument_list|)
expr_stmt|;
name|ll
operator|->
name|B
operator|=
name|B
expr_stmt|;
name|ll
operator|->
name|C
operator|=
name|C
expr_stmt|;
return|return
name|l
return|;
block|}
end_function

begin_function
name|Visible
name|loc
name|mk_tbseloc
parameter_list|(
name|R
parameter_list|,
name|K
parameter_list|)
name|loc
name|R
decl_stmt|;
name|value
name|K
decl_stmt|;
block|{
name|loc
name|l
init|=
name|grab_tse
argument_list|()
decl_stmt|;
name|tbseloc
modifier|*
name|ll
init|=
operator|(
name|tbseloc
operator|*
operator|)
name|Ats
argument_list|(
name|l
argument_list|)
decl_stmt|;
name|ll
operator|->
name|R
operator|=
name|copy
argument_list|(
name|R
argument_list|)
expr_stmt|;
name|ll
operator|->
name|K
operator|=
name|copy
argument_list|(
name|K
argument_list|)
expr_stmt|;
return|return
name|l
return|;
block|}
end_function

begin_function
name|Visible
name|fun
name|mk_fun
parameter_list|(
name|L
parameter_list|,
name|H
parameter_list|,
name|adic
parameter_list|,
name|def
parameter_list|,
name|fux
parameter_list|,
name|lux
parameter_list|,
name|reftab
parameter_list|,
name|filed
parameter_list|)
name|intlet
name|L
decl_stmt|,
name|H
decl_stmt|;
name|literal
name|adic
decl_stmt|,
name|def
decl_stmt|;
name|txptr
name|fux
decl_stmt|,
name|lux
decl_stmt|;
name|value
name|reftab
decl_stmt|;
name|bool
name|filed
decl_stmt|;
block|{
name|fun
name|f
init|=
name|grab_fun
argument_list|()
decl_stmt|;
name|funprd
modifier|*
name|ff
init|=
operator|(
name|funprd
operator|*
operator|)
name|Ats
argument_list|(
name|f
argument_list|)
decl_stmt|;
name|ff
operator|->
name|L
operator|=
name|L
expr_stmt|;
name|ff
operator|->
name|H
operator|=
name|H
expr_stmt|;
name|ff
operator|->
name|adic
operator|=
name|adic
expr_stmt|;
name|ff
operator|->
name|def
operator|=
name|def
expr_stmt|;
name|ff
operator|->
name|fux
operator|=
name|fux
expr_stmt|;
name|ff
operator|->
name|lux
operator|=
name|lux
expr_stmt|;
name|ff
operator|->
name|reftab
operator|=
name|reftab
expr_stmt|;
name|ff
operator|->
name|filed
operator|=
name|filed
expr_stmt|;
return|return
name|f
return|;
block|}
end_function

begin_function
name|Visible
name|prd
name|mk_prd
parameter_list|(
name|adic
parameter_list|,
name|def
parameter_list|,
name|fux
parameter_list|,
name|lux
parameter_list|,
name|reftab
parameter_list|,
name|filed
parameter_list|)
name|literal
name|adic
decl_stmt|,
name|def
decl_stmt|;
name|txptr
name|fux
decl_stmt|,
name|lux
decl_stmt|;
name|value
name|reftab
decl_stmt|;
name|bool
name|filed
decl_stmt|;
block|{
name|prd
name|p
init|=
name|grab_prd
argument_list|()
decl_stmt|;
name|funprd
modifier|*
name|pp
init|=
operator|(
name|funprd
operator|*
operator|)
name|Ats
argument_list|(
name|p
argument_list|)
decl_stmt|;
name|pp
operator|->
name|adic
operator|=
name|adic
expr_stmt|;
name|pp
operator|->
name|def
operator|=
name|def
expr_stmt|;
name|pp
operator|->
name|fux
operator|=
name|fux
expr_stmt|;
name|pp
operator|->
name|lux
operator|=
name|lux
expr_stmt|;
name|pp
operator|->
name|reftab
operator|=
name|reftab
expr_stmt|;
name|pp
operator|->
name|filed
operator|=
name|filed
expr_stmt|;
return|return
name|p
return|;
block|}
end_function

begin_function
name|Visible
name|value
name|mk_how
parameter_list|(
name|fux
parameter_list|,
name|lux
parameter_list|,
name|reftab
parameter_list|,
name|filed
parameter_list|)
name|txptr
name|fux
decl_stmt|,
name|lux
decl_stmt|;
name|value
name|reftab
decl_stmt|;
name|bool
name|filed
decl_stmt|;
block|{
name|value
name|h
init|=
name|grab_how
argument_list|()
decl_stmt|;
name|how
modifier|*
name|hh
init|=
operator|(
name|how
operator|*
operator|)
name|Ats
argument_list|(
name|h
argument_list|)
decl_stmt|;
name|hh
operator|->
name|fux
operator|=
name|fux
expr_stmt|;
name|hh
operator|->
name|lux
operator|=
name|lux
expr_stmt|;
name|hh
operator|->
name|reftab
operator|=
name|reftab
expr_stmt|;
name|hh
operator|->
name|filed
operator|=
name|filed
expr_stmt|;
return|return
name|h
return|;
block|}
end_function

begin_function
name|Visible
name|value
name|mk_ref
parameter_list|(
name|rp
parameter_list|,
name|rlino
parameter_list|)
name|txptr
name|rp
decl_stmt|;
name|intlet
name|rlino
decl_stmt|;
block|{
name|value
name|r
init|=
name|grab_ref
argument_list|()
decl_stmt|;
operator|(
operator|(
name|ref
operator|*
operator|)
name|Ats
argument_list|(
name|r
argument_list|)
operator|)
operator|->
name|rp
operator|=
name|rp
expr_stmt|;
operator|(
operator|(
name|ref
operator|*
operator|)
name|Ats
argument_list|(
name|r
argument_list|)
operator|)
operator|->
name|rlino
operator|=
name|rlino
expr_stmt|;
return|return
name|r
return|;
block|}
end_function

begin_function
name|Visible
name|value
name|mk_per
parameter_list|(
name|v
parameter_list|)
name|value
name|v
decl_stmt|;
block|{
name|value
name|p
init|=
name|grab_per
argument_list|()
decl_stmt|;
operator|*
name|Ats
argument_list|(
name|p
argument_list|)
operator|=
name|copy
argument_list|(
name|v
argument_list|)
expr_stmt|;
return|return
name|p
return|;
block|}
end_function

end_unit

