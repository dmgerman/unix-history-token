begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (c) Stichting Mathematisch Centrum, Amsterdam, 1985. */
end_comment

begin_comment
comment|/*   $Header: b2cmd.c,v 1.4 85/08/22 16:54:17 timo Exp $ */
end_comment

begin_include
include|#
directive|include
file|"b.h"
end_include

begin_include
include|#
directive|include
file|"b0fea.h"
end_include

begin_include
include|#
directive|include
file|"b1obj.h"
end_include

begin_include
include|#
directive|include
file|"b2par.h"
end_include

begin_include
include|#
directive|include
file|"b2key.h"
end_include

begin_include
include|#
directive|include
file|"b2syn.h"
end_include

begin_include
include|#
directive|include
file|"b2nod.h"
end_include

begin_include
include|#
directive|include
file|"b3env.h"
end_include

begin_include
include|#
directive|include
file|"b3err.h"
end_include

begin_include
include|#
directive|include
file|"b3ext.h"
end_include

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/*		command_suite						*/
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function_decl
name|Forward
name|parsetree
name|cmd_seq
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|Visible
name|parsetree
name|cmd_suite
parameter_list|(
name|cil
parameter_list|,
name|first
parameter_list|)
name|intlet
name|cil
decl_stmt|;
name|bool
name|first
decl_stmt|;
block|{
if|if
condition|(
name|ateol
argument_list|()
condition|)
return|return
name|cmd_seq
argument_list|(
name|cil
argument_list|,
name|first
argument_list|)
return|;
else|else
block|{
name|parsetree
name|v
decl_stmt|;
name|value
name|c
decl_stmt|;
name|intlet
name|l
init|=
name|lino
decl_stmt|;
name|suite_command
argument_list|(
operator|&
name|v
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
return|return
name|node5
argument_list|(
name|SUITE
argument_list|,
name|mk_integer
argument_list|(
name|l
argument_list|)
argument_list|,
name|v
argument_list|,
name|c
argument_list|,
name|NilTree
argument_list|)
return|;
block|}
block|}
end_function

begin_function
name|Hidden
name|parsetree
name|cmd_seq
parameter_list|(
name|cil
parameter_list|,
name|first
parameter_list|)
name|intlet
name|cil
decl_stmt|;
name|bool
name|first
decl_stmt|;
block|{
name|value
name|c
decl_stmt|;
name|intlet
name|level
decl_stmt|,
name|l
decl_stmt|;
name|level
operator|=
name|ilev
argument_list|()
expr_stmt|;
name|l
operator|=
name|lino
expr_stmt|;
if|if
condition|(
name|is_comment
argument_list|(
operator|&
name|c
argument_list|)
condition|)
return|return
name|node5
argument_list|(
name|SUITE
argument_list|,
name|mk_integer
argument_list|(
name|l
argument_list|)
argument_list|,
name|NilTree
argument_list|,
name|c
argument_list|,
name|cmd_seq
argument_list|(
name|cil
argument_list|,
name|first
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|(
name|level
operator|==
name|cil
operator|&&
operator|!
name|first
operator|)
operator|||
operator|(
name|level
operator|>
name|cil
operator|&&
name|first
operator|)
condition|)
block|{
name|parsetree
name|v
decl_stmt|;
name|findceol
argument_list|()
expr_stmt|;
name|suite_command
argument_list|(
operator|&
name|v
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
return|return
name|node5
argument_list|(
name|SUITE
argument_list|,
name|mk_integer
argument_list|(
name|l
argument_list|)
argument_list|,
name|v
argument_list|,
name|c
argument_list|,
name|cmd_seq
argument_list|(
name|level
argument_list|,
name|No
argument_list|)
argument_list|)
return|;
block|}
name|veli
argument_list|()
expr_stmt|;
return|return
name|NilTree
return|;
block|}
end_function

begin_function
name|Visible
name|Procedure
name|suite_command
parameter_list|(
name|v
parameter_list|,
name|c
parameter_list|)
name|parsetree
modifier|*
name|v
decl_stmt|;
name|value
modifier|*
name|c
decl_stmt|;
block|{
operator|*
name|v
operator|=
name|NilTree
expr_stmt|;
operator|*
name|c
operator|=
name|Vnil
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|control_command
argument_list|(
name|v
argument_list|)
operator|||
name|simple_command
argument_list|(
name|v
argument_list|,
name|c
argument_list|)
operator|)
condition|)
name|parerr
argument_list|(
name|MESS
argument_list|(
literal|2000
argument_list|,
literal|"no command where expected"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/*		is_comment, tail_line					*/
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function
name|Visible
name|bool
name|is_comment
parameter_list|(
name|v
parameter_list|)
name|value
modifier|*
name|v
decl_stmt|;
block|{
name|txptr
name|tx0
init|=
name|tx
decl_stmt|;
name|skipsp
argument_list|(
operator|&
name|tx
argument_list|)
expr_stmt|;
if|if
condition|(
name|comment_sign
argument_list|()
condition|)
block|{
while|while
condition|(
name|Space
argument_list|(
name|Char
argument_list|(
name|tx0
operator|-
literal|1
argument_list|)
argument_list|)
condition|)
name|tx0
operator|--
expr_stmt|;
while|while
condition|(
operator|!
name|Eol
argument_list|(
name|tx
argument_list|)
condition|)
name|tx
operator|++
expr_stmt|;
operator|*
name|v
operator|=
name|cr_text
argument_list|(
name|tx0
argument_list|,
name|tx
argument_list|)
expr_stmt|;
return|return
name|Yes
return|;
block|}
name|tx
operator|=
name|tx0
expr_stmt|;
return|return
name|No
return|;
block|}
end_function

begin_function
name|Visible
name|value
name|tail_line
parameter_list|()
block|{
name|value
name|v
decl_stmt|;
if|if
condition|(
name|is_comment
argument_list|(
operator|&
name|v
argument_list|)
condition|)
return|return
name|v
return|;
if|if
condition|(
operator|!
name|ateol
argument_list|()
condition|)
name|parerr
argument_list|(
name|MESS
argument_list|(
literal|2001
argument_list|,
literal|"something unexpected following this line"
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Vnil
return|;
block|}
end_function

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/*		simple_command						*/
end_comment

begin_comment
comment|/*									*/
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_decl_stmt
name|Forward
name|bool
name|bas_com
argument_list|()
decl_stmt|,
name|term_com
argument_list|()
decl_stmt|,
name|udr_com
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function
name|Visible
name|bool
name|simple_command
parameter_list|(
name|v
parameter_list|,
name|c
parameter_list|)
name|parsetree
modifier|*
name|v
decl_stmt|;
name|value
modifier|*
name|c
decl_stmt|;
block|{
return|return
name|bas_com
argument_list|(
name|v
argument_list|)
operator|||
name|term_com
argument_list|(
name|v
argument_list|)
operator|||
name|udr_com
argument_list|(
name|v
argument_list|)
condition|?
operator|(
operator|*
name|c
operator|=
name|tail_line
argument_list|()
operator|,
name|Yes
operator|)
else|:
name|No
return|;
block|}
end_function

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/*		basic_command						*/
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function_decl
name|Forward
name|value
name|cr_newlines
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|Hidden
name|bool
name|bas_com
parameter_list|(
name|v
parameter_list|)
name|parsetree
modifier|*
name|v
decl_stmt|;
block|{
name|txptr
name|ftx
decl_stmt|,
name|ttx
decl_stmt|;
name|parsetree
name|e
decl_stmt|,
name|t
decl_stmt|;
if|if
condition|(
name|check_keyword
argument_list|()
condition|)
block|{
operator|*
name|v
operator|=
name|node2
argument_list|(
name|CHECK
argument_list|,
name|test
argument_list|(
name|ceol
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|choose_keyword
argument_list|()
condition|)
block|{
name|req
argument_list|(
name|K_FROM_choose
argument_list|,
name|ceol
argument_list|,
operator|&
name|ftx
argument_list|,
operator|&
name|ttx
argument_list|)
expr_stmt|;
name|t
operator|=
name|targ
argument_list|(
name|ftx
argument_list|)
expr_stmt|;
name|tx
operator|=
name|ttx
expr_stmt|;
operator|*
name|v
operator|=
name|node3
argument_list|(
name|CHOOSE
argument_list|,
name|t
argument_list|,
name|expr
argument_list|(
name|ceol
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|delete_keyword
argument_list|()
condition|)
block|{
operator|*
name|v
operator|=
name|node2
argument_list|(
name|DELETE
argument_list|,
name|targ
argument_list|(
name|ceol
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|draw_keyword
argument_list|()
condition|)
block|{
operator|*
name|v
operator|=
name|node2
argument_list|(
name|DRAW
argument_list|,
name|targ
argument_list|(
name|ceol
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|insert_keyword
argument_list|()
condition|)
block|{
name|req
argument_list|(
name|K_IN_insert
argument_list|,
name|ceol
argument_list|,
operator|&
name|ftx
argument_list|,
operator|&
name|ttx
argument_list|)
expr_stmt|;
name|e
operator|=
name|expr
argument_list|(
name|ftx
argument_list|)
expr_stmt|;
name|tx
operator|=
name|ttx
expr_stmt|;
operator|*
name|v
operator|=
name|node3
argument_list|(
name|INSERT
argument_list|,
name|e
argument_list|,
name|targ
argument_list|(
name|ceol
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|put_keyword
argument_list|()
condition|)
block|{
name|req
argument_list|(
name|K_IN_put
argument_list|,
name|ceol
argument_list|,
operator|&
name|ftx
argument_list|,
operator|&
name|ttx
argument_list|)
expr_stmt|;
name|e
operator|=
name|expr
argument_list|(
name|ftx
argument_list|)
expr_stmt|;
name|tx
operator|=
name|ttx
expr_stmt|;
operator|*
name|v
operator|=
name|node3
argument_list|(
name|PUT
argument_list|,
name|e
argument_list|,
name|targ
argument_list|(
name|ceol
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|read_keyword
argument_list|()
condition|)
block|{
if|if
condition|(
name|find
argument_list|(
name|K_RAW
argument_list|,
name|ceol
argument_list|,
operator|&
name|ftx
argument_list|,
operator|&
name|ttx
argument_list|)
condition|)
block|{
operator|*
name|v
operator|=
name|node2
argument_list|(
name|READ_RAW
argument_list|,
name|targ
argument_list|(
name|ftx
argument_list|)
argument_list|)
expr_stmt|;
name|tx
operator|=
name|ttx
expr_stmt|;
name|upto
argument_list|(
name|ceol
argument_list|,
name|K_RAW
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|req
argument_list|(
name|K_EG
argument_list|,
name|ceol
argument_list|,
operator|&
name|ftx
argument_list|,
operator|&
name|ttx
argument_list|)
expr_stmt|;
name|t
operator|=
name|targ
argument_list|(
name|ftx
argument_list|)
expr_stmt|;
name|tx
operator|=
name|ttx
expr_stmt|;
operator|*
name|v
operator|=
name|node3
argument_list|(
name|READ
argument_list|,
name|t
argument_list|,
name|expr
argument_list|(
name|ceol
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|remove_keyword
argument_list|()
condition|)
block|{
name|req
argument_list|(
name|K_FROM_remove
argument_list|,
name|ceol
argument_list|,
operator|&
name|ftx
argument_list|,
operator|&
name|ttx
argument_list|)
expr_stmt|;
name|e
operator|=
name|expr
argument_list|(
name|ftx
argument_list|)
expr_stmt|;
name|tx
operator|=
name|ttx
expr_stmt|;
operator|*
name|v
operator|=
name|node3
argument_list|(
name|REMOVE
argument_list|,
name|e
argument_list|,
name|targ
argument_list|(
name|ceol
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|setrandom_keyword
argument_list|()
condition|)
block|{
operator|*
name|v
operator|=
name|node2
argument_list|(
name|SET_RANDOM
argument_list|,
name|expr
argument_list|(
name|ceol
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|write_keyword
argument_list|()
condition|)
block|{
name|intlet
name|b_cnt
init|=
literal|0
decl_stmt|,
name|a_cnt
init|=
literal|0
decl_stmt|;
name|skipsp
argument_list|(
operator|&
name|tx
argument_list|)
expr_stmt|;
if|if
condition|(
name|Ceol
argument_list|(
name|tx
argument_list|)
condition|)
name|parerr
argument_list|(
name|MESS
argument_list|(
literal|2002
argument_list|,
literal|"no parameter where expected"
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|nwl_sign
argument_list|()
condition|)
block|{
name|b_cnt
operator|++
expr_stmt|;
name|skipsp
argument_list|(
operator|&
name|tx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Ceol
argument_list|(
name|tx
argument_list|)
condition|)
name|e
operator|=
name|NilTree
expr_stmt|;
else|else
block|{
name|ftx
operator|=
name|ceol
expr_stmt|;
while|while
condition|(
name|Space
argument_list|(
name|Char
argument_list|(
name|ftx
operator|-
literal|1
argument_list|)
argument_list|)
operator|||
name|Char
argument_list|(
name|ftx
operator|-
literal|1
argument_list|)
operator|==
literal|'/'
condition|)
if|if
condition|(
name|Char
argument_list|(
operator|--
name|ftx
argument_list|)
operator|==
literal|'/'
condition|)
name|a_cnt
operator|++
expr_stmt|;
name|skipsp
argument_list|(
operator|&
name|tx
argument_list|)
expr_stmt|;
name|e
operator|=
name|ftx
operator|>
name|tx
condition|?
name|expr
argument_list|(
name|ftx
argument_list|)
else|:
name|NilTree
expr_stmt|;
block|}
operator|*
name|v
operator|=
name|node4
argument_list|(
name|WRITE
argument_list|,
name|cr_newlines
argument_list|(
name|b_cnt
argument_list|)
argument_list|,
name|e
argument_list|,
name|cr_newlines
argument_list|(
name|a_cnt
argument_list|)
argument_list|)
expr_stmt|;
name|tx
operator|=
name|ceol
expr_stmt|;
block|}
else|else
return|return
name|No
return|;
return|return
name|Yes
return|;
block|}
end_function

begin_function
name|Hidden
name|value
name|cr_newlines
parameter_list|(
name|cnt
parameter_list|)
name|intlet
name|cnt
decl_stmt|;
block|{
name|value
name|v
decl_stmt|,
name|t
init|=
name|mk_text
argument_list|(
literal|"/"
argument_list|)
decl_stmt|,
name|n
init|=
name|mk_integer
argument_list|(
name|cnt
argument_list|)
decl_stmt|;
name|v
operator|=
name|repeat
argument_list|(
name|t
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|n
argument_list|)
expr_stmt|;
return|return
name|v
return|;
block|}
end_function

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/*		terminating_command					*/
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function
name|Visible
name|bool
name|term_com
parameter_list|(
name|v
parameter_list|)
name|parsetree
modifier|*
name|v
decl_stmt|;
block|{
if|if
condition|(
name|fail_keyword
argument_list|()
condition|)
block|{
name|upto
argument_list|(
name|ceol
argument_list|,
name|K_FAIL
argument_list|)
expr_stmt|;
operator|*
name|v
operator|=
name|node1
argument_list|(
name|FAIL
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|quit_keyword
argument_list|()
condition|)
block|{
name|upto
argument_list|(
name|ceol
argument_list|,
name|K_QUIT
argument_list|)
expr_stmt|;
operator|*
name|v
operator|=
name|node1
argument_list|(
name|QUIT
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|return_keyword
argument_list|()
condition|)
operator|*
name|v
operator|=
name|node2
argument_list|(
name|RETURN
argument_list|,
name|expr
argument_list|(
name|ceol
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|report_keyword
argument_list|()
condition|)
operator|*
name|v
operator|=
name|node2
argument_list|(
name|REPORT
argument_list|,
name|test
argument_list|(
name|ceol
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|succeed_keyword
argument_list|()
condition|)
block|{
name|upto
argument_list|(
name|ceol
argument_list|,
name|K_SUCCEED
argument_list|)
expr_stmt|;
operator|*
name|v
operator|=
name|node1
argument_list|(
name|SUCCEED
argument_list|)
expr_stmt|;
block|}
else|else
return|return
name|No
return|;
return|return
name|Yes
return|;
block|}
end_function

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/*		user_defined_command; refined_command			*/
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function_decl
name|Forward
name|value
name|hu_actuals
parameter_list|()
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|EXT_COMMAND
end_ifdef

begin_function_decl
name|Forward
name|bool
name|extended_command
parameter_list|()
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|Hidden
name|bool
name|udr_com
parameter_list|(
name|v
parameter_list|)
name|parsetree
modifier|*
name|v
decl_stmt|;
block|{
name|value
name|w
decl_stmt|;
if|if
condition|(
name|is_keyword
argument_list|(
operator|&
name|w
argument_list|)
condition|)
block|{
ifdef|#
directive|ifdef
name|EXT_COMMAND
if|if
condition|(
name|extended_command
argument_list|(
name|w
argument_list|,
name|v
argument_list|)
condition|)
return|return
name|Yes
return|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|in
argument_list|(
name|w
argument_list|,
name|kwlist
argument_list|)
condition|)
block|{
operator|*
name|v
operator|=
name|node4
argument_list|(
name|USER_COMMAND
argument_list|,
name|copy
argument_list|(
name|w
argument_list|)
argument_list|,
name|hu_actuals
argument_list|(
name|ceol
argument_list|,
name|w
argument_list|)
argument_list|,
name|Vnil
argument_list|)
expr_stmt|;
return|return
name|Yes
return|;
block|}
name|release
argument_list|(
name|w
argument_list|)
expr_stmt|;
block|}
return|return
name|No
return|;
block|}
end_function

begin_function
name|Hidden
name|value
name|hu_actuals
parameter_list|(
name|q
parameter_list|,
name|kw
parameter_list|)
name|txptr
name|q
decl_stmt|;
name|value
name|kw
decl_stmt|;
block|{
name|parsetree
name|e
decl_stmt|;
name|value
name|v
decl_stmt|,
name|w
decl_stmt|;
name|txptr
name|ftx
decl_stmt|;
name|skipsp
argument_list|(
operator|&
name|tx
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|findkw
argument_list|(
name|q
argument_list|,
operator|&
name|ftx
argument_list|)
condition|)
name|ftx
operator|=
name|q
expr_stmt|;
name|e
operator|=
name|Text
argument_list|(
name|ftx
argument_list|)
condition|?
name|expr
argument_list|(
name|ftx
argument_list|)
else|:
name|NilTree
expr_stmt|;
name|v
operator|=
name|Text
argument_list|(
name|q
argument_list|)
condition|?
name|hu_actuals
argument_list|(
name|q
argument_list|,
name|keyword
argument_list|()
argument_list|)
else|:
name|Vnil
expr_stmt|;
name|w
operator|=
name|node5
argument_list|(
name|ACTUAL
argument_list|,
name|kw
argument_list|,
name|e
argument_list|,
name|v
argument_list|,
name|Vnil
argument_list|)
expr_stmt|;
return|return
name|w
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|EXT_COMMAND
end_ifdef

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/*		extended_command					*/
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function
name|Hidden
name|bool
name|extended_command
parameter_list|(
name|w
parameter_list|,
name|v
parameter_list|)
name|value
name|w
decl_stmt|,
decl|*
name|v
decl_stmt|;
end_function

begin_block
block|{
name|string
name|name
decl_stmt|,
name|arg
decl_stmt|;
name|ext
modifier|*
name|e
decl_stmt|;
name|int
name|i
decl_stmt|;
name|value
name|args
index|[
name|MAXEARGS
index|]
decl_stmt|,
name|a
decl_stmt|;
name|txptr
name|ftx
decl_stmt|,
name|ttx
decl_stmt|;
specifier|extern
name|bool
name|extcmds
decl_stmt|;
comment|/* Flag set in main by -E option */
if|if
condition|(
operator|!
name|extcmds
condition|)
return|return
name|No
return|;
name|name
operator|=
name|strval
argument_list|(
name|w
argument_list|)
expr_stmt|;
for|for
control|(
name|e
operator|=
name|extensions
init|;
name|e
operator|->
name|e_name
operator|!=
literal|0
condition|;
operator|++
name|e
control|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|e
operator|->
name|e_name
argument_list|,
name|name
argument_list|)
operator|==
literal|0
condition|)
break|break;
block|}
if|if
condition|(
name|e
operator|->
name|e_name
operator|==
literal|0
condition|)
return|return
name|No
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXEARGS
operator|&&
operator|(
name|arg
operator|=
name|e
operator|->
name|e_args
index|[
name|i
index|]
operator|)
operator|!=
literal|0
condition|;
operator|++
name|i
control|)
block|{
if|if
condition|(
name|arg
index|[
literal|1
index|]
operator|!=
literal|'\0'
condition|)
name|req
argument_list|(
name|arg
operator|+
literal|1
argument_list|,
name|ceol
argument_list|,
operator|&
name|ftx
argument_list|,
operator|&
name|ttx
argument_list|)
expr_stmt|;
else|else
name|ftx
operator|=
name|ceol
expr_stmt|;
switch|switch
condition|(
name|arg
index|[
literal|0
index|]
condition|)
block|{
case|case
literal|'e'
case|:
name|args
index|[
name|i
index|]
operator|=
name|expr
argument_list|(
name|ftx
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
name|args
index|[
name|i
index|]
operator|=
name|targ
argument_list|(
name|ftx
argument_list|)
expr_stmt|;
break|break;
default|default:
name|psyserr
argument_list|(
name|MESS
argument_list|(
literal|2003
argument_list|,
literal|"bad entry in extended_command table"
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|arg
index|[
literal|1
index|]
operator|!=
literal|'\0'
condition|)
name|tx
operator|=
name|ttx
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|==
literal|0
condition|)
name|arg
operator|=
name|e
operator|->
name|e_name
expr_stmt|;
else|else
block|{
name|arg
operator|=
name|e
operator|->
name|e_args
index|[
name|i
operator|-
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|arg
index|[
literal|1
index|]
operator|!=
literal|'\0'
condition|)
operator|++
name|arg
expr_stmt|;
else|else
switch|switch
condition|(
name|arg
index|[
literal|0
index|]
condition|)
block|{
case|case
literal|'e'
case|:
name|arg
operator|=
literal|"expression"
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
name|arg
operator|=
literal|"target"
expr_stmt|;
break|break;
block|}
block|}
name|upto
argument_list|(
name|ceol
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
name|a
operator|=
name|Vnil
expr_stmt|;
else|else
block|{
name|a
operator|=
name|mk_compound
argument_list|(
name|i
argument_list|)
expr_stmt|;
while|while
condition|(
operator|--
name|i
operator|>=
literal|0
condition|)
operator|*
name|Field
argument_list|(
name|a
argument_list|,
name|i
argument_list|)
operator|=
name|args
index|[
name|i
index|]
expr_stmt|;
block|}
operator|*
name|v
operator|=
name|node3
argument_list|(
name|EXTENDED_COMMAND
argument_list|,
name|w
argument_list|,
name|a
argument_list|)
expr_stmt|;
return|return
name|Yes
return|;
block|}
end_block

begin_endif
endif|#
directive|endif
endif|EXT_COMMAND
end_endif

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/*		control_command						*/
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function_decl
name|Forward
name|parsetree
name|alt_suite
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|Visible
name|bool
name|control_command
parameter_list|(
name|v
parameter_list|)
name|parsetree
modifier|*
name|v
decl_stmt|;
block|{
name|parsetree
name|e
decl_stmt|,
name|t
decl_stmt|;
name|value
name|c
decl_stmt|;
name|txptr
name|ftx
decl_stmt|,
name|ttx
decl_stmt|,
name|utx
decl_stmt|,
name|vtx
decl_stmt|;
name|skipsp
argument_list|(
operator|&
name|tx
argument_list|)
expr_stmt|;
if|if
condition|(
name|if_keyword
argument_list|()
condition|)
block|{
name|req
argument_list|(
literal|":"
argument_list|,
name|ceol
argument_list|,
operator|&
name|utx
argument_list|,
operator|&
name|vtx
argument_list|)
expr_stmt|;
name|t
operator|=
name|test
argument_list|(
name|utx
argument_list|)
expr_stmt|;
name|tx
operator|=
name|vtx
expr_stmt|;
if|if
condition|(
operator|!
name|is_comment
argument_list|(
operator|&
name|c
argument_list|)
condition|)
name|c
operator|=
name|Vnil
expr_stmt|;
operator|*
name|v
operator|=
name|node4
argument_list|(
name|IF
argument_list|,
name|t
argument_list|,
name|c
argument_list|,
name|cmd_suite
argument_list|(
name|cur_ilev
argument_list|,
name|Yes
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|select_keyword
argument_list|()
condition|)
block|{
name|need
argument_list|(
literal|":"
argument_list|)
expr_stmt|;
name|c
operator|=
name|tail_line
argument_list|()
expr_stmt|;
operator|*
name|v
operator|=
name|node3
argument_list|(
name|SELECT
argument_list|,
name|c
argument_list|,
name|alt_suite
argument_list|()
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|while_keyword
argument_list|()
condition|)
block|{
name|req
argument_list|(
literal|":"
argument_list|,
name|ceol
argument_list|,
operator|&
name|utx
argument_list|,
operator|&
name|vtx
argument_list|)
expr_stmt|;
name|t
operator|=
name|test
argument_list|(
name|utx
argument_list|)
expr_stmt|;
name|tx
operator|=
name|vtx
expr_stmt|;
if|if
condition|(
operator|!
name|is_comment
argument_list|(
operator|&
name|c
argument_list|)
condition|)
name|c
operator|=
name|Vnil
expr_stmt|;
operator|*
name|v
operator|=
name|node4
argument_list|(
name|WHILE
argument_list|,
name|t
argument_list|,
name|c
argument_list|,
name|cmd_suite
argument_list|(
name|cur_ilev
argument_list|,
name|Yes
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|for_keyword
argument_list|()
condition|)
block|{
name|req
argument_list|(
literal|":"
argument_list|,
name|ceol
argument_list|,
operator|&
name|utx
argument_list|,
operator|&
name|vtx
argument_list|)
expr_stmt|;
name|req
argument_list|(
name|K_IN_for
argument_list|,
name|ceol
argument_list|,
operator|&
name|ftx
argument_list|,
operator|&
name|ttx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ttx
operator|>
name|utx
condition|)
block|{
name|parerr
argument_list|(
name|MESS
argument_list|(
literal|2004
argument_list|,
literal|"IN after colon"
argument_list|)
argument_list|)
expr_stmt|;
name|ftx
operator|=
name|utx
operator|=
name|tx
expr_stmt|;
name|ttx
operator|=
name|vtx
operator|=
name|ceol
expr_stmt|;
block|}
name|idf_cntxt
operator|=
name|In_ranger
expr_stmt|;
name|t
operator|=
name|idf
argument_list|(
name|ftx
argument_list|)
expr_stmt|;
name|tx
operator|=
name|ttx
expr_stmt|;
name|e
operator|=
name|expr
argument_list|(
name|utx
argument_list|)
expr_stmt|;
name|tx
operator|=
name|vtx
expr_stmt|;
if|if
condition|(
operator|!
name|is_comment
argument_list|(
operator|&
name|c
argument_list|)
condition|)
name|c
operator|=
name|Vnil
expr_stmt|;
operator|*
name|v
operator|=
name|node5
argument_list|(
name|FOR
argument_list|,
name|t
argument_list|,
name|e
argument_list|,
name|c
argument_list|,
name|cmd_suite
argument_list|(
name|cur_ilev
argument_list|,
name|Yes
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
return|return
name|No
return|;
return|return
name|Yes
return|;
block|}
end_function

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/*		alternative_suite					*/
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function_decl
name|Forward
name|parsetree
name|alt_seq
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|Hidden
name|parsetree
name|alt_suite
parameter_list|()
block|{
name|parsetree
name|v
decl_stmt|;
name|bool
name|empty
init|=
name|Yes
decl_stmt|;
name|v
operator|=
name|alt_seq
argument_list|(
operator|&
name|empty
argument_list|,
name|cur_ilev
argument_list|,
name|Yes
argument_list|,
name|No
argument_list|)
expr_stmt|;
if|if
condition|(
name|empty
condition|)
name|parerr
argument_list|(
name|MESS
argument_list|(
literal|2005
argument_list|,
literal|"no alternative suite where expected"
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|v
return|;
block|}
end_function

begin_function
name|Hidden
name|parsetree
name|alt_seq
parameter_list|(
name|empty
parameter_list|,
name|cil
parameter_list|,
name|first
parameter_list|,
name|else_encountered
parameter_list|)
name|bool
modifier|*
name|empty
decl_stmt|,
name|first
decl_stmt|,
name|else_encountered
decl_stmt|;
name|intlet
name|cil
decl_stmt|;
block|{
name|value
name|c
decl_stmt|;
name|intlet
name|level
decl_stmt|,
name|l
decl_stmt|;
name|level
operator|=
name|ilev
argument_list|()
expr_stmt|;
name|l
operator|=
name|lino
expr_stmt|;
if|if
condition|(
name|is_comment
argument_list|(
operator|&
name|c
argument_list|)
condition|)
return|return
name|node6
argument_list|(
name|TEST_SUITE
argument_list|,
name|mk_integer
argument_list|(
name|l
argument_list|)
argument_list|,
name|NilTree
argument_list|,
name|c
argument_list|,
name|NilTree
argument_list|,
name|alt_seq
argument_list|(
name|empty
argument_list|,
name|cil
argument_list|,
name|first
argument_list|,
name|else_encountered
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|(
name|level
operator|==
name|cil
operator|&&
operator|!
name|first
operator|)
operator|||
operator|(
name|level
operator|>
name|cil
operator|&&
name|first
operator|)
condition|)
block|{
name|parsetree
name|v
decl_stmt|,
name|s
decl_stmt|;
name|txptr
name|ftx
decl_stmt|,
name|ttx
decl_stmt|;
if|if
condition|(
name|else_encountered
condition|)
name|parerr
argument_list|(
name|MESS
argument_list|(
literal|2006
argument_list|,
literal|"after ELSE no more alternatives allowed"
argument_list|)
argument_list|)
expr_stmt|;
name|findceol
argument_list|()
expr_stmt|;
name|req
argument_list|(
literal|":"
argument_list|,
name|ceol
argument_list|,
operator|&
name|ftx
argument_list|,
operator|&
name|ttx
argument_list|)
expr_stmt|;
operator|*
name|empty
operator|=
name|No
expr_stmt|;
if|if
condition|(
name|else_keyword
argument_list|()
condition|)
block|{
name|upto
argument_list|(
name|ftx
argument_list|,
name|K_ELSE
argument_list|)
expr_stmt|;
name|tx
operator|=
name|ttx
expr_stmt|;
if|if
condition|(
operator|!
name|is_comment
argument_list|(
operator|&
name|c
argument_list|)
condition|)
name|c
operator|=
name|Vnil
expr_stmt|;
name|s
operator|=
name|cmd_suite
argument_list|(
name|level
argument_list|,
name|Yes
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|alt_seq
argument_list|(
name|empty
argument_list|,
name|level
argument_list|,
name|No
argument_list|,
name|Yes
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|node4
argument_list|(
name|ELSE
argument_list|,
name|mk_integer
argument_list|(
name|l
argument_list|)
argument_list|,
name|c
argument_list|,
name|s
argument_list|)
return|;
block|}
name|v
operator|=
name|test
argument_list|(
name|ftx
argument_list|)
expr_stmt|;
name|tx
operator|=
name|ttx
expr_stmt|;
if|if
condition|(
operator|!
name|is_comment
argument_list|(
operator|&
name|c
argument_list|)
condition|)
name|c
operator|=
name|Vnil
expr_stmt|;
name|s
operator|=
name|cmd_suite
argument_list|(
name|level
argument_list|,
name|Yes
argument_list|)
expr_stmt|;
return|return
name|node6
argument_list|(
name|TEST_SUITE
argument_list|,
name|mk_integer
argument_list|(
name|l
argument_list|)
argument_list|,
name|v
argument_list|,
name|c
argument_list|,
name|s
argument_list|,
name|alt_seq
argument_list|(
name|empty
argument_list|,
name|level
argument_list|,
name|No
argument_list|,
name|else_encountered
argument_list|)
argument_list|)
return|;
block|}
name|veli
argument_list|()
expr_stmt|;
return|return
name|NilTree
return|;
block|}
end_function

end_unit

