begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|//===-- JITMemoryManager.h - Interface JIT uses to Allocate Mem -*- C++ -*-===//
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//                     The LLVM Compiler Infrastructure
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// This file is distributed under the University of Illinois Open Source
end_comment

begin_comment
comment|// License. See LICENSE.TXT for details.
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//===----------------------------------------------------------------------===//
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// This file defines the JITMemoryManagerInterface
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|//===----------------------------------------------------------------------===//
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|LLVM_EXECUTION_ENGINE_JIT_MEMMANAGER_H
end_ifndef

begin_define
define|#
directive|define
name|LLVM_EXECUTION_ENGINE_JIT_MEMMANAGER_H
end_define

begin_include
include|#
directive|include
file|"llvm/Support/DataTypes.h"
end_include

begin_decl_stmt
name|namespace
name|llvm
block|{
name|class
name|Function
decl_stmt|;
comment|/// JITMemoryManager - This interface is used by the JIT to allocate and manage
comment|/// memory for the code generated by the JIT.  This can be reimplemented by
comment|/// clients that have a strong desire to control how the layout of JIT'd memory
comment|/// works.
name|class
name|JITMemoryManager
block|{
name|protected
label|:
name|bool
name|HasGOT
decl_stmt|;
name|bool
name|SizeRequired
decl_stmt|;
name|public
label|:
name|JITMemoryManager
argument_list|()
operator|:
name|HasGOT
argument_list|(
name|false
argument_list|)
operator|,
name|SizeRequired
argument_list|(
argument|false
argument_list|)
block|{}
name|virtual
operator|~
name|JITMemoryManager
argument_list|()
expr_stmt|;
comment|/// CreateDefaultMemManager - This is used to create the default
comment|/// JIT Memory Manager if the client does not provide one to the JIT.
specifier|static
name|JITMemoryManager
modifier|*
name|CreateDefaultMemManager
parameter_list|()
function_decl|;
comment|/// setMemoryWritable - When code generation is in progress,
comment|/// the code pages may need permissions changed.
name|virtual
name|void
name|setMemoryWritable
parameter_list|(
name|void
parameter_list|)
init|=
literal|0
function_decl|;
comment|/// setMemoryExecutable - When code generation is done and we're ready to
comment|/// start execution, the code pages may need permissions changed.
name|virtual
name|void
name|setMemoryExecutable
parameter_list|(
name|void
parameter_list|)
init|=
literal|0
function_decl|;
comment|//===--------------------------------------------------------------------===//
comment|// Global Offset Table Management
comment|//===--------------------------------------------------------------------===//
comment|/// AllocateGOT - If the current table requires a Global Offset Table, this
comment|/// method is invoked to allocate it.  This method is required to set HasGOT
comment|/// to true.
name|virtual
name|void
name|AllocateGOT
parameter_list|()
init|=
literal|0
function_decl|;
comment|/// isManagingGOT - Return true if the AllocateGOT method is called.
comment|///
name|bool
name|isManagingGOT
argument_list|()
specifier|const
block|{
return|return
name|HasGOT
return|;
block|}
comment|/// getGOTBase - If this is managing a Global Offset Table, this method should
comment|/// return a pointer to its base.
name|virtual
name|uint8_t
operator|*
name|getGOTBase
argument_list|()
specifier|const
operator|=
literal|0
expr_stmt|;
comment|/// SetDlsymTable - If the JIT must be able to relocate stubs after they have
comment|/// been emitted, potentially because they are being copied to a process
comment|/// where external symbols live at different addresses than in the JITing
comment|///  process, allocate a table with sufficient information to do so.
name|virtual
name|void
name|SetDlsymTable
parameter_list|(
name|void
modifier|*
name|ptr
parameter_list|)
init|=
literal|0
function_decl|;
comment|/// getDlsymTable - If this is managing a table of entries so that stubs to
comment|/// external symbols can be later relocated, this method should return a
comment|/// pointer to it.
name|virtual
name|void
operator|*
name|getDlsymTable
argument_list|()
specifier|const
operator|=
literal|0
expr_stmt|;
comment|/// NeedsExactSize - If the memory manager requires to know the size of the
comment|/// objects to be emitted
name|bool
name|NeedsExactSize
argument_list|()
specifier|const
block|{
return|return
name|SizeRequired
return|;
block|}
comment|//===--------------------------------------------------------------------===//
comment|// Main Allocation Functions
comment|//===--------------------------------------------------------------------===//
comment|/// startFunctionBody - When we start JITing a function, the JIT calls this
comment|/// method to allocate a block of free RWX memory, which returns a pointer to
comment|/// it.  The JIT doesn't know ahead of time how much space it will need to
comment|/// emit the function, so it doesn't pass in the size.  Instead, this method
comment|/// is required to pass back a "valid size".  The JIT will be careful to not
comment|/// write more than the returned ActualSize bytes of memory.
name|virtual
name|uint8_t
modifier|*
name|startFunctionBody
parameter_list|(
specifier|const
name|Function
modifier|*
name|F
parameter_list|,
name|uintptr_t
modifier|&
name|ActualSize
parameter_list|)
init|=
literal|0
function_decl|;
comment|/// allocateStub - This method is called by the JIT to allocate space for a
comment|/// function stub (used to handle limited branch displacements) while it is
comment|/// JIT compiling a function.  For example, if foo calls bar, and if bar
comment|/// either needs to be lazily compiled or is a native function that exists too
comment|/// far away from the call site to work, this method will be used to make a
comment|/// thunk for it.  The stub should be "close" to the current function body,
comment|/// but should not be included in the 'actualsize' returned by
comment|/// startFunctionBody.
name|virtual
name|uint8_t
modifier|*
name|allocateStub
parameter_list|(
specifier|const
name|GlobalValue
modifier|*
name|F
parameter_list|,
name|unsigned
name|StubSize
parameter_list|,
name|unsigned
name|Alignment
parameter_list|)
init|=
literal|0
function_decl|;
comment|/// endFunctionBody - This method is called when the JIT is done codegen'ing
comment|/// the specified function.  At this point we know the size of the JIT
comment|/// compiled function.  This passes in FunctionStart (which was returned by
comment|/// the startFunctionBody method) and FunctionEnd which is a pointer to the
comment|/// actual end of the function.  This method should mark the space allocated
comment|/// and remember where it is in case the client wants to deallocate it.
name|virtual
name|void
name|endFunctionBody
parameter_list|(
specifier|const
name|Function
modifier|*
name|F
parameter_list|,
name|uint8_t
modifier|*
name|FunctionStart
parameter_list|,
name|uint8_t
modifier|*
name|FunctionEnd
parameter_list|)
init|=
literal|0
function_decl|;
comment|/// allocateSpace - Allocate a memory block of the given size.
name|virtual
name|uint8_t
modifier|*
name|allocateSpace
parameter_list|(
name|intptr_t
name|Size
parameter_list|,
name|unsigned
name|Alignment
parameter_list|)
init|=
literal|0
function_decl|;
comment|/// deallocateMemForFunction - Free JIT memory for the specified function.
comment|/// This is never called when the JIT is currently emitting a function.
name|virtual
name|void
name|deallocateMemForFunction
parameter_list|(
specifier|const
name|Function
modifier|*
name|F
parameter_list|)
init|=
literal|0
function_decl|;
comment|/// startExceptionTable - When we finished JITing the function, if exception
comment|/// handling is set, we emit the exception table.
name|virtual
name|uint8_t
modifier|*
name|startExceptionTable
parameter_list|(
specifier|const
name|Function
modifier|*
name|F
parameter_list|,
name|uintptr_t
modifier|&
name|ActualSize
parameter_list|)
init|=
literal|0
function_decl|;
comment|/// endExceptionTable - This method is called when the JIT is done emitting
comment|/// the exception table.
name|virtual
name|void
name|endExceptionTable
parameter_list|(
specifier|const
name|Function
modifier|*
name|F
parameter_list|,
name|uint8_t
modifier|*
name|TableStart
parameter_list|,
name|uint8_t
modifier|*
name|TableEnd
parameter_list|,
name|uint8_t
modifier|*
name|FrameRegister
parameter_list|)
init|=
literal|0
function_decl|;
block|}
empty_stmt|;
block|}
end_decl_stmt

begin_comment
comment|// end namespace llvm.
end_comment

begin_endif
endif|#
directive|endif
end_endif

end_unit

