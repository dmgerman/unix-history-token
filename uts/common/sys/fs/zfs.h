begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * CDDL HEADER START  *  * The contents of this file are subject to the terms of the  * Common Development and Distribution License (the "License").  * You may not use this file except in compliance with the License.  *  * You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE  * or http://www.opensolaris.org/os/licensing.  * See the License for the specific language governing permissions  * and limitations under the License.  *  * When distributing Covered Code, include this CDDL HEADER in each  * file and include the License file at usr/src/OPENSOLARIS.LICENSE.  * If applicable, add the following below this CDDL HEADER, with the  * fields enclosed by brackets "[]" replaced with your own identifying  * information: Portions Copyright [yyyy] [name of copyright owner]  *  * CDDL HEADER END  */
end_comment

begin_comment
comment|/*  * Copyright (c) 2005, 2010, Oracle and/or its affiliates. All rights reserved.  * Copyright (c) 2011, 2014 by Delphix. All rights reserved.  * Copyright 2011 Nexenta Systems, Inc.  All rights reserved.  * Copyright (c) 2013, Joyent, Inc. All rights reserved.  * Copyright (c) 2014 Integros [integros.com]  */
end_comment

begin_comment
comment|/* Portions Copyright 2010 Robert Milkowski */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|_SYS_FS_ZFS_H
end_ifndef

begin_define
define|#
directive|define
name|_SYS_FS_ZFS_H
end_define

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|__cplusplus
end_ifdef

begin_extern
extern|extern
literal|"C"
block|{
endif|#
directive|endif
comment|/*  * Types and constants shared between userland and the kernel.  */
comment|/*  * Each dataset can be one of the following types.  These constants can be  * combined into masks that can be passed to various functions.  */
typedef|typedef
enum|enum
block|{
name|ZFS_TYPE_FILESYSTEM
init|=
operator|(
literal|1
operator|<<
literal|0
operator|)
block|,
name|ZFS_TYPE_SNAPSHOT
init|=
operator|(
literal|1
operator|<<
literal|1
operator|)
block|,
name|ZFS_TYPE_VOLUME
init|=
operator|(
literal|1
operator|<<
literal|2
operator|)
block|,
name|ZFS_TYPE_POOL
init|=
operator|(
literal|1
operator|<<
literal|3
operator|)
block|,
name|ZFS_TYPE_BOOKMARK
init|=
operator|(
literal|1
operator|<<
literal|4
operator|)
block|}
name|zfs_type_t
typedef|;
comment|/*  * NB: lzc_dataset_type should be updated whenever a new objset type is added,  * if it represents a real type of a dataset that can be created from userland.  */
typedef|typedef
enum|enum
name|dmu_objset_type
block|{
name|DMU_OST_NONE
block|,
name|DMU_OST_META
block|,
name|DMU_OST_ZFS
block|,
name|DMU_OST_ZVOL
block|,
name|DMU_OST_OTHER
block|,
comment|/* For testing only! */
name|DMU_OST_ANY
block|,
comment|/* Be careful! */
name|DMU_OST_NUMTYPES
block|}
name|dmu_objset_type_t
typedef|;
define|#
directive|define
name|ZFS_TYPE_DATASET
define|\
value|(ZFS_TYPE_FILESYSTEM | ZFS_TYPE_VOLUME | ZFS_TYPE_SNAPSHOT)
comment|/*  * All of these include the terminating NUL byte.  */
define|#
directive|define
name|ZAP_MAXNAMELEN
value|256
define|#
directive|define
name|ZAP_MAXVALUELEN
value|(1024 * 8)
define|#
directive|define
name|ZAP_OLDMAXVALUELEN
value|1024
define|#
directive|define
name|ZFS_MAX_DATASET_NAME_LEN
value|256
comment|/*  * Dataset properties are identified by these constants and must be added to  * the end of this list to ensure that external consumers are not affected  * by the change. If you make any changes to this list, be sure to update  * the property table in usr/src/common/zfs/zfs_prop.c.  */
typedef|typedef
enum|enum
block|{
name|ZFS_PROP_TYPE
block|,
name|ZFS_PROP_CREATION
block|,
name|ZFS_PROP_USED
block|,
name|ZFS_PROP_AVAILABLE
block|,
name|ZFS_PROP_REFERENCED
block|,
name|ZFS_PROP_COMPRESSRATIO
block|,
name|ZFS_PROP_MOUNTED
block|,
name|ZFS_PROP_ORIGIN
block|,
name|ZFS_PROP_QUOTA
block|,
name|ZFS_PROP_RESERVATION
block|,
name|ZFS_PROP_VOLSIZE
block|,
name|ZFS_PROP_VOLBLOCKSIZE
block|,
name|ZFS_PROP_RECORDSIZE
block|,
name|ZFS_PROP_MOUNTPOINT
block|,
name|ZFS_PROP_SHARENFS
block|,
name|ZFS_PROP_CHECKSUM
block|,
name|ZFS_PROP_COMPRESSION
block|,
name|ZFS_PROP_ATIME
block|,
name|ZFS_PROP_DEVICES
block|,
name|ZFS_PROP_EXEC
block|,
name|ZFS_PROP_SETUID
block|,
name|ZFS_PROP_READONLY
block|,
name|ZFS_PROP_ZONED
block|,
name|ZFS_PROP_SNAPDIR
block|,
name|ZFS_PROP_ACLMODE
block|,
name|ZFS_PROP_ACLINHERIT
block|,
name|ZFS_PROP_CREATETXG
block|,
comment|/* not exposed to the user */
name|ZFS_PROP_NAME
block|,
comment|/* not exposed to the user */
name|ZFS_PROP_CANMOUNT
block|,
name|ZFS_PROP_ISCSIOPTIONS
block|,
comment|/* not exposed to the user */
name|ZFS_PROP_XATTR
block|,
name|ZFS_PROP_NUMCLONES
block|,
comment|/* not exposed to the user */
name|ZFS_PROP_COPIES
block|,
name|ZFS_PROP_VERSION
block|,
name|ZFS_PROP_UTF8ONLY
block|,
name|ZFS_PROP_NORMALIZE
block|,
name|ZFS_PROP_CASE
block|,
name|ZFS_PROP_VSCAN
block|,
name|ZFS_PROP_NBMAND
block|,
name|ZFS_PROP_SHARESMB
block|,
name|ZFS_PROP_REFQUOTA
block|,
name|ZFS_PROP_REFRESERVATION
block|,
name|ZFS_PROP_GUID
block|,
name|ZFS_PROP_PRIMARYCACHE
block|,
name|ZFS_PROP_SECONDARYCACHE
block|,
name|ZFS_PROP_USEDSNAP
block|,
name|ZFS_PROP_USEDDS
block|,
name|ZFS_PROP_USEDCHILD
block|,
name|ZFS_PROP_USEDREFRESERV
block|,
name|ZFS_PROP_USERACCOUNTING
block|,
comment|/* not exposed to the user */
name|ZFS_PROP_STMF_SHAREINFO
block|,
comment|/* not exposed to the user */
name|ZFS_PROP_DEFER_DESTROY
block|,
name|ZFS_PROP_USERREFS
block|,
name|ZFS_PROP_LOGBIAS
block|,
name|ZFS_PROP_UNIQUE
block|,
comment|/* not exposed to the user */
name|ZFS_PROP_OBJSETID
block|,
comment|/* not exposed to the user */
name|ZFS_PROP_DEDUP
block|,
name|ZFS_PROP_MLSLABEL
block|,
name|ZFS_PROP_SYNC
block|,
name|ZFS_PROP_REFRATIO
block|,
name|ZFS_PROP_WRITTEN
block|,
name|ZFS_PROP_CLONES
block|,
name|ZFS_PROP_LOGICALUSED
block|,
name|ZFS_PROP_LOGICALREFERENCED
block|,
name|ZFS_PROP_INCONSISTENT
block|,
comment|/* not exposed to the user */
name|ZFS_PROP_FILESYSTEM_LIMIT
block|,
name|ZFS_PROP_SNAPSHOT_LIMIT
block|,
name|ZFS_PROP_FILESYSTEM_COUNT
block|,
name|ZFS_PROP_SNAPSHOT_COUNT
block|,
name|ZFS_PROP_REDUNDANT_METADATA
block|,
name|ZFS_PROP_PREV_SNAP
block|,
name|ZFS_PROP_RECEIVE_RESUME_TOKEN
block|,
name|ZFS_NUM_PROPS
block|}
name|zfs_prop_t
typedef|;
typedef|typedef
enum|enum
block|{
name|ZFS_PROP_USERUSED
block|,
name|ZFS_PROP_USERQUOTA
block|,
name|ZFS_PROP_GROUPUSED
block|,
name|ZFS_PROP_GROUPQUOTA
block|,
name|ZFS_NUM_USERQUOTA_PROPS
block|}
name|zfs_userquota_prop_t
typedef|;
specifier|extern
specifier|const
name|char
modifier|*
name|zfs_userquota_prop_prefixes
index|[
name|ZFS_NUM_USERQUOTA_PROPS
index|]
decl_stmt|;
comment|/*  * Pool properties are identified by these constants and must be added to the  * end of this list to ensure that external consumers are not affected  * by the change. If you make any changes to this list, be sure to update  * the property table in usr/src/common/zfs/zpool_prop.c.  */
typedef|typedef
enum|enum
block|{
name|ZPOOL_PROP_NAME
block|,
name|ZPOOL_PROP_SIZE
block|,
name|ZPOOL_PROP_CAPACITY
block|,
name|ZPOOL_PROP_ALTROOT
block|,
name|ZPOOL_PROP_HEALTH
block|,
name|ZPOOL_PROP_GUID
block|,
name|ZPOOL_PROP_VERSION
block|,
name|ZPOOL_PROP_BOOTFS
block|,
name|ZPOOL_PROP_DELEGATION
block|,
name|ZPOOL_PROP_AUTOREPLACE
block|,
name|ZPOOL_PROP_CACHEFILE
block|,
name|ZPOOL_PROP_FAILUREMODE
block|,
name|ZPOOL_PROP_LISTSNAPS
block|,
name|ZPOOL_PROP_AUTOEXPAND
block|,
name|ZPOOL_PROP_DEDUPDITTO
block|,
name|ZPOOL_PROP_DEDUPRATIO
block|,
name|ZPOOL_PROP_FREE
block|,
name|ZPOOL_PROP_ALLOCATED
block|,
name|ZPOOL_PROP_READONLY
block|,
name|ZPOOL_PROP_COMMENT
block|,
name|ZPOOL_PROP_EXPANDSZ
block|,
name|ZPOOL_PROP_FREEING
block|,
name|ZPOOL_PROP_FRAGMENTATION
block|,
name|ZPOOL_PROP_LEAKED
block|,
name|ZPOOL_PROP_MAXBLOCKSIZE
block|,
name|ZPOOL_PROP_BOOTSIZE
block|,
name|ZPOOL_NUM_PROPS
block|}
name|zpool_prop_t
typedef|;
comment|/* Small enough to not hog a whole line of printout in zpool(1M). */
define|#
directive|define
name|ZPROP_MAX_COMMENT
value|32
define|#
directive|define
name|ZPROP_CONT
value|-2
define|#
directive|define
name|ZPROP_INVAL
value|-1
define|#
directive|define
name|ZPROP_VALUE
value|"value"
define|#
directive|define
name|ZPROP_SOURCE
value|"source"
typedef|typedef
enum|enum
block|{
name|ZPROP_SRC_NONE
init|=
literal|0x1
block|,
name|ZPROP_SRC_DEFAULT
init|=
literal|0x2
block|,
name|ZPROP_SRC_TEMPORARY
init|=
literal|0x4
block|,
name|ZPROP_SRC_LOCAL
init|=
literal|0x8
block|,
name|ZPROP_SRC_INHERITED
init|=
literal|0x10
block|,
name|ZPROP_SRC_RECEIVED
init|=
literal|0x20
block|}
name|zprop_source_t
typedef|;
define|#
directive|define
name|ZPROP_SRC_ALL
value|0x3f
define|#
directive|define
name|ZPROP_SOURCE_VAL_RECVD
value|"$recvd"
define|#
directive|define
name|ZPROP_N_MORE_ERRORS
value|"N_MORE_ERRORS"
comment|/*  * Dataset flag implemented as a special entry in the props zap object  * indicating that the dataset has received properties on or after  * SPA_VERSION_RECVD_PROPS. The first such receive blows away local properties  * just as it did in earlier versions, and thereafter, local properties are  * preserved.  */
define|#
directive|define
name|ZPROP_HAS_RECVD
value|"$hasrecvd"
typedef|typedef
enum|enum
block|{
name|ZPROP_ERR_NOCLEAR
init|=
literal|0x1
block|,
comment|/* failure to clear existing props */
name|ZPROP_ERR_NORESTORE
init|=
literal|0x2
comment|/* failure to restore props on error */
block|}
name|zprop_errflags_t
typedef|;
typedef|typedef
name|int
function_decl|(
modifier|*
name|zprop_func
function_decl|)
parameter_list|(
name|int
parameter_list|,
name|void
modifier|*
parameter_list|)
function_decl|;
comment|/*  * Properties to be set on the root file system of a new pool  * are stuffed into their own nvlist, which is then included in  * the properties nvlist with the pool properties.  */
define|#
directive|define
name|ZPOOL_ROOTFS_PROPS
value|"root-props-nvl"
comment|/*  * Dataset property functions shared between libzfs and kernel.  */
specifier|const
name|char
modifier|*
name|zfs_prop_default_string
parameter_list|(
name|zfs_prop_t
parameter_list|)
function_decl|;
name|uint64_t
name|zfs_prop_default_numeric
parameter_list|(
name|zfs_prop_t
parameter_list|)
function_decl|;
name|boolean_t
name|zfs_prop_readonly
parameter_list|(
name|zfs_prop_t
parameter_list|)
function_decl|;
name|boolean_t
name|zfs_prop_inheritable
parameter_list|(
name|zfs_prop_t
parameter_list|)
function_decl|;
name|boolean_t
name|zfs_prop_setonce
parameter_list|(
name|zfs_prop_t
parameter_list|)
function_decl|;
specifier|const
name|char
modifier|*
name|zfs_prop_to_name
parameter_list|(
name|zfs_prop_t
parameter_list|)
function_decl|;
name|zfs_prop_t
name|zfs_name_to_prop
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
name|boolean_t
name|zfs_prop_user
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
name|boolean_t
name|zfs_prop_userquota
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
name|boolean_t
name|zfs_prop_written
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
name|int
name|zfs_prop_index_to_string
parameter_list|(
name|zfs_prop_t
parameter_list|,
name|uint64_t
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
parameter_list|)
function_decl|;
name|int
name|zfs_prop_string_to_index
parameter_list|(
name|zfs_prop_t
parameter_list|,
specifier|const
name|char
modifier|*
parameter_list|,
name|uint64_t
modifier|*
parameter_list|)
function_decl|;
name|uint64_t
name|zfs_prop_random_value
parameter_list|(
name|zfs_prop_t
parameter_list|,
name|uint64_t
name|seed
parameter_list|)
function_decl|;
name|boolean_t
name|zfs_prop_valid_for_type
parameter_list|(
name|int
parameter_list|,
name|zfs_type_t
parameter_list|)
function_decl|;
comment|/*  * Pool property functions shared between libzfs and kernel.  */
name|zpool_prop_t
name|zpool_name_to_prop
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
specifier|const
name|char
modifier|*
name|zpool_prop_to_name
parameter_list|(
name|zpool_prop_t
parameter_list|)
function_decl|;
specifier|const
name|char
modifier|*
name|zpool_prop_default_string
parameter_list|(
name|zpool_prop_t
parameter_list|)
function_decl|;
name|uint64_t
name|zpool_prop_default_numeric
parameter_list|(
name|zpool_prop_t
parameter_list|)
function_decl|;
name|boolean_t
name|zpool_prop_readonly
parameter_list|(
name|zpool_prop_t
parameter_list|)
function_decl|;
name|boolean_t
name|zpool_prop_feature
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
name|boolean_t
name|zpool_prop_unsupported
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|)
function_decl|;
name|int
name|zpool_prop_index_to_string
parameter_list|(
name|zpool_prop_t
parameter_list|,
name|uint64_t
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
parameter_list|)
function_decl|;
name|int
name|zpool_prop_string_to_index
parameter_list|(
name|zpool_prop_t
parameter_list|,
specifier|const
name|char
modifier|*
parameter_list|,
name|uint64_t
modifier|*
parameter_list|)
function_decl|;
name|uint64_t
name|zpool_prop_random_value
parameter_list|(
name|zpool_prop_t
parameter_list|,
name|uint64_t
name|seed
parameter_list|)
function_decl|;
comment|/*  * Definitions for the Delegation.  */
typedef|typedef
enum|enum
block|{
name|ZFS_DELEG_WHO_UNKNOWN
init|=
literal|0
block|,
name|ZFS_DELEG_USER
init|=
literal|'u'
block|,
name|ZFS_DELEG_USER_SETS
init|=
literal|'U'
block|,
name|ZFS_DELEG_GROUP
init|=
literal|'g'
block|,
name|ZFS_DELEG_GROUP_SETS
init|=
literal|'G'
block|,
name|ZFS_DELEG_EVERYONE
init|=
literal|'e'
block|,
name|ZFS_DELEG_EVERYONE_SETS
init|=
literal|'E'
block|,
name|ZFS_DELEG_CREATE
init|=
literal|'c'
block|,
name|ZFS_DELEG_CREATE_SETS
init|=
literal|'C'
block|,
name|ZFS_DELEG_NAMED_SET
init|=
literal|'s'
block|,
name|ZFS_DELEG_NAMED_SET_SETS
init|=
literal|'S'
block|}
name|zfs_deleg_who_type_t
typedef|;
typedef|typedef
enum|enum
block|{
name|ZFS_DELEG_NONE
init|=
literal|0
block|,
name|ZFS_DELEG_PERM_LOCAL
init|=
literal|1
block|,
name|ZFS_DELEG_PERM_DESCENDENT
init|=
literal|2
block|,
name|ZFS_DELEG_PERM_LOCALDESCENDENT
init|=
literal|3
block|,
name|ZFS_DELEG_PERM_CREATE
init|=
literal|4
block|}
name|zfs_deleg_inherit_t
typedef|;
define|#
directive|define
name|ZFS_DELEG_PERM_UID
value|"uid"
define|#
directive|define
name|ZFS_DELEG_PERM_GID
value|"gid"
define|#
directive|define
name|ZFS_DELEG_PERM_GROUPS
value|"groups"
define|#
directive|define
name|ZFS_MLSLABEL_DEFAULT
value|"none"
define|#
directive|define
name|ZFS_SMB_ACL_SRC
value|"src"
define|#
directive|define
name|ZFS_SMB_ACL_TARGET
value|"target"
typedef|typedef
enum|enum
block|{
name|ZFS_CANMOUNT_OFF
init|=
literal|0
block|,
name|ZFS_CANMOUNT_ON
init|=
literal|1
block|,
name|ZFS_CANMOUNT_NOAUTO
init|=
literal|2
block|}
name|zfs_canmount_type_t
typedef|;
typedef|typedef
enum|enum
block|{
name|ZFS_LOGBIAS_LATENCY
init|=
literal|0
block|,
name|ZFS_LOGBIAS_THROUGHPUT
init|=
literal|1
block|}
name|zfs_logbias_op_t
typedef|;
typedef|typedef
enum|enum
name|zfs_share_op
block|{
name|ZFS_SHARE_NFS
init|=
literal|0
block|,
name|ZFS_UNSHARE_NFS
init|=
literal|1
block|,
name|ZFS_SHARE_SMB
init|=
literal|2
block|,
name|ZFS_UNSHARE_SMB
init|=
literal|3
block|}
name|zfs_share_op_t
typedef|;
typedef|typedef
enum|enum
name|zfs_smb_acl_op
block|{
name|ZFS_SMB_ACL_ADD
block|,
name|ZFS_SMB_ACL_REMOVE
block|,
name|ZFS_SMB_ACL_RENAME
block|,
name|ZFS_SMB_ACL_PURGE
block|}
name|zfs_smb_acl_op_t
typedef|;
typedef|typedef
enum|enum
name|zfs_cache_type
block|{
name|ZFS_CACHE_NONE
init|=
literal|0
block|,
name|ZFS_CACHE_METADATA
init|=
literal|1
block|,
name|ZFS_CACHE_ALL
init|=
literal|2
block|}
name|zfs_cache_type_t
typedef|;
typedef|typedef
enum|enum
block|{
name|ZFS_SYNC_STANDARD
init|=
literal|0
block|,
name|ZFS_SYNC_ALWAYS
init|=
literal|1
block|,
name|ZFS_SYNC_DISABLED
init|=
literal|2
block|}
name|zfs_sync_type_t
typedef|;
typedef|typedef
enum|enum
block|{
name|ZFS_REDUNDANT_METADATA_ALL
block|,
name|ZFS_REDUNDANT_METADATA_MOST
block|}
name|zfs_redundant_metadata_type_t
typedef|;
comment|/*  * On-disk version number.  */
define|#
directive|define
name|SPA_VERSION_1
value|1ULL
define|#
directive|define
name|SPA_VERSION_2
value|2ULL
define|#
directive|define
name|SPA_VERSION_3
value|3ULL
define|#
directive|define
name|SPA_VERSION_4
value|4ULL
define|#
directive|define
name|SPA_VERSION_5
value|5ULL
define|#
directive|define
name|SPA_VERSION_6
value|6ULL
define|#
directive|define
name|SPA_VERSION_7
value|7ULL
define|#
directive|define
name|SPA_VERSION_8
value|8ULL
define|#
directive|define
name|SPA_VERSION_9
value|9ULL
define|#
directive|define
name|SPA_VERSION_10
value|10ULL
define|#
directive|define
name|SPA_VERSION_11
value|11ULL
define|#
directive|define
name|SPA_VERSION_12
value|12ULL
define|#
directive|define
name|SPA_VERSION_13
value|13ULL
define|#
directive|define
name|SPA_VERSION_14
value|14ULL
define|#
directive|define
name|SPA_VERSION_15
value|15ULL
define|#
directive|define
name|SPA_VERSION_16
value|16ULL
define|#
directive|define
name|SPA_VERSION_17
value|17ULL
define|#
directive|define
name|SPA_VERSION_18
value|18ULL
define|#
directive|define
name|SPA_VERSION_19
value|19ULL
define|#
directive|define
name|SPA_VERSION_20
value|20ULL
define|#
directive|define
name|SPA_VERSION_21
value|21ULL
define|#
directive|define
name|SPA_VERSION_22
value|22ULL
define|#
directive|define
name|SPA_VERSION_23
value|23ULL
define|#
directive|define
name|SPA_VERSION_24
value|24ULL
define|#
directive|define
name|SPA_VERSION_25
value|25ULL
define|#
directive|define
name|SPA_VERSION_26
value|26ULL
define|#
directive|define
name|SPA_VERSION_27
value|27ULL
define|#
directive|define
name|SPA_VERSION_28
value|28ULL
define|#
directive|define
name|SPA_VERSION_5000
value|5000ULL
comment|/*  * When bumping up SPA_VERSION, make sure GRUB ZFS understands the on-disk  * format change. Go to usr/src/grub/grub-0.97/stage2/{zfs-include/, fsys_zfs*},  * and do the appropriate changes.  Also bump the version number in  * usr/src/grub/capability.  */
define|#
directive|define
name|SPA_VERSION
value|SPA_VERSION_5000
define|#
directive|define
name|SPA_VERSION_STRING
value|"5000"
comment|/*  * Symbolic names for the changes that caused a SPA_VERSION switch.  * Used in the code when checking for presence or absence of a feature.  * Feel free to define multiple symbolic names for each version if there  * were multiple changes to on-disk structures during that version.  *  * NOTE: When checking the current SPA_VERSION in your code, be sure  *       to use spa_version() since it reports the version of the  *       last synced uberblock.  Checking the in-flight version can  *       be dangerous in some cases.  */
define|#
directive|define
name|SPA_VERSION_INITIAL
value|SPA_VERSION_1
define|#
directive|define
name|SPA_VERSION_DITTO_BLOCKS
value|SPA_VERSION_2
define|#
directive|define
name|SPA_VERSION_SPARES
value|SPA_VERSION_3
define|#
directive|define
name|SPA_VERSION_RAIDZ2
value|SPA_VERSION_3
define|#
directive|define
name|SPA_VERSION_BPOBJ_ACCOUNT
value|SPA_VERSION_3
define|#
directive|define
name|SPA_VERSION_RAIDZ_DEFLATE
value|SPA_VERSION_3
define|#
directive|define
name|SPA_VERSION_DNODE_BYTES
value|SPA_VERSION_3
define|#
directive|define
name|SPA_VERSION_ZPOOL_HISTORY
value|SPA_VERSION_4
define|#
directive|define
name|SPA_VERSION_GZIP_COMPRESSION
value|SPA_VERSION_5
define|#
directive|define
name|SPA_VERSION_BOOTFS
value|SPA_VERSION_6
define|#
directive|define
name|SPA_VERSION_SLOGS
value|SPA_VERSION_7
define|#
directive|define
name|SPA_VERSION_DELEGATED_PERMS
value|SPA_VERSION_8
define|#
directive|define
name|SPA_VERSION_FUID
value|SPA_VERSION_9
define|#
directive|define
name|SPA_VERSION_REFRESERVATION
value|SPA_VERSION_9
define|#
directive|define
name|SPA_VERSION_REFQUOTA
value|SPA_VERSION_9
define|#
directive|define
name|SPA_VERSION_UNIQUE_ACCURATE
value|SPA_VERSION_9
define|#
directive|define
name|SPA_VERSION_L2CACHE
value|SPA_VERSION_10
define|#
directive|define
name|SPA_VERSION_NEXT_CLONES
value|SPA_VERSION_11
define|#
directive|define
name|SPA_VERSION_ORIGIN
value|SPA_VERSION_11
define|#
directive|define
name|SPA_VERSION_DSL_SCRUB
value|SPA_VERSION_11
define|#
directive|define
name|SPA_VERSION_SNAP_PROPS
value|SPA_VERSION_12
define|#
directive|define
name|SPA_VERSION_USED_BREAKDOWN
value|SPA_VERSION_13
define|#
directive|define
name|SPA_VERSION_PASSTHROUGH_X
value|SPA_VERSION_14
define|#
directive|define
name|SPA_VERSION_USERSPACE
value|SPA_VERSION_15
define|#
directive|define
name|SPA_VERSION_STMF_PROP
value|SPA_VERSION_16
define|#
directive|define
name|SPA_VERSION_RAIDZ3
value|SPA_VERSION_17
define|#
directive|define
name|SPA_VERSION_USERREFS
value|SPA_VERSION_18
define|#
directive|define
name|SPA_VERSION_HOLES
value|SPA_VERSION_19
define|#
directive|define
name|SPA_VERSION_ZLE_COMPRESSION
value|SPA_VERSION_20
define|#
directive|define
name|SPA_VERSION_DEDUP
value|SPA_VERSION_21
define|#
directive|define
name|SPA_VERSION_RECVD_PROPS
value|SPA_VERSION_22
define|#
directive|define
name|SPA_VERSION_SLIM_ZIL
value|SPA_VERSION_23
define|#
directive|define
name|SPA_VERSION_SA
value|SPA_VERSION_24
define|#
directive|define
name|SPA_VERSION_SCAN
value|SPA_VERSION_25
define|#
directive|define
name|SPA_VERSION_DIR_CLONES
value|SPA_VERSION_26
define|#
directive|define
name|SPA_VERSION_DEADLISTS
value|SPA_VERSION_26
define|#
directive|define
name|SPA_VERSION_FAST_SNAP
value|SPA_VERSION_27
define|#
directive|define
name|SPA_VERSION_MULTI_REPLACE
value|SPA_VERSION_28
define|#
directive|define
name|SPA_VERSION_BEFORE_FEATURES
value|SPA_VERSION_28
define|#
directive|define
name|SPA_VERSION_FEATURES
value|SPA_VERSION_5000
define|#
directive|define
name|SPA_VERSION_IS_SUPPORTED
parameter_list|(
name|v
parameter_list|)
define|\
value|(((v)>= SPA_VERSION_INITIAL&& (v)<= SPA_VERSION_BEFORE_FEATURES) || \ 	((v)>= SPA_VERSION_FEATURES&& (v)<= SPA_VERSION))
comment|/*  * ZPL version - rev'd whenever an incompatible on-disk format change  * occurs.  This is independent of SPA/DMU/ZAP versioning.  You must  * also update the version_table[] and help message in zfs_prop.c.  *  * When changing, be sure to teach GRUB how to read the new format!  * See usr/src/grub/grub-0.97/stage2/{zfs-include/,fsys_zfs*}  */
define|#
directive|define
name|ZPL_VERSION_1
value|1ULL
define|#
directive|define
name|ZPL_VERSION_2
value|2ULL
define|#
directive|define
name|ZPL_VERSION_3
value|3ULL
define|#
directive|define
name|ZPL_VERSION_4
value|4ULL
define|#
directive|define
name|ZPL_VERSION_5
value|5ULL
define|#
directive|define
name|ZPL_VERSION
value|ZPL_VERSION_5
define|#
directive|define
name|ZPL_VERSION_STRING
value|"5"
define|#
directive|define
name|ZPL_VERSION_INITIAL
value|ZPL_VERSION_1
define|#
directive|define
name|ZPL_VERSION_DIRENT_TYPE
value|ZPL_VERSION_2
define|#
directive|define
name|ZPL_VERSION_FUID
value|ZPL_VERSION_3
define|#
directive|define
name|ZPL_VERSION_NORMALIZATION
value|ZPL_VERSION_3
define|#
directive|define
name|ZPL_VERSION_SYSATTR
value|ZPL_VERSION_3
define|#
directive|define
name|ZPL_VERSION_USERSPACE
value|ZPL_VERSION_4
define|#
directive|define
name|ZPL_VERSION_SA
value|ZPL_VERSION_5
comment|/* Rewind request information */
define|#
directive|define
name|ZPOOL_NO_REWIND
value|1
comment|/* No policy - default behavior */
define|#
directive|define
name|ZPOOL_NEVER_REWIND
value|2
comment|/* Do not search for best txg or rewind */
define|#
directive|define
name|ZPOOL_TRY_REWIND
value|4
comment|/* Search for best txg, but do not rewind */
define|#
directive|define
name|ZPOOL_DO_REWIND
value|8
comment|/* Rewind to best txg w/in deferred frees */
define|#
directive|define
name|ZPOOL_EXTREME_REWIND
value|16
comment|/* Allow extreme measures to find best txg */
define|#
directive|define
name|ZPOOL_REWIND_MASK
value|28
comment|/* All the possible rewind bits */
define|#
directive|define
name|ZPOOL_REWIND_POLICIES
value|31
comment|/* All the possible policy bits */
typedef|typedef
struct|struct
name|zpool_rewind_policy
block|{
name|uint32_t
name|zrp_request
decl_stmt|;
comment|/* rewind behavior requested */
name|uint64_t
name|zrp_maxmeta
decl_stmt|;
comment|/* max acceptable meta-data errors */
name|uint64_t
name|zrp_maxdata
decl_stmt|;
comment|/* max acceptable data errors */
name|uint64_t
name|zrp_txg
decl_stmt|;
comment|/* specific txg to load */
block|}
name|zpool_rewind_policy_t
typedef|;
comment|/*  * The following are configuration names used in the nvlist describing a pool's  * configuration.  */
define|#
directive|define
name|ZPOOL_CONFIG_VERSION
value|"version"
define|#
directive|define
name|ZPOOL_CONFIG_POOL_NAME
value|"name"
define|#
directive|define
name|ZPOOL_CONFIG_POOL_STATE
value|"state"
define|#
directive|define
name|ZPOOL_CONFIG_POOL_TXG
value|"txg"
define|#
directive|define
name|ZPOOL_CONFIG_POOL_GUID
value|"pool_guid"
define|#
directive|define
name|ZPOOL_CONFIG_CREATE_TXG
value|"create_txg"
define|#
directive|define
name|ZPOOL_CONFIG_TOP_GUID
value|"top_guid"
define|#
directive|define
name|ZPOOL_CONFIG_VDEV_TREE
value|"vdev_tree"
define|#
directive|define
name|ZPOOL_CONFIG_TYPE
value|"type"
define|#
directive|define
name|ZPOOL_CONFIG_CHILDREN
value|"children"
define|#
directive|define
name|ZPOOL_CONFIG_ID
value|"id"
define|#
directive|define
name|ZPOOL_CONFIG_GUID
value|"guid"
define|#
directive|define
name|ZPOOL_CONFIG_PATH
value|"path"
define|#
directive|define
name|ZPOOL_CONFIG_DEVID
value|"devid"
define|#
directive|define
name|ZPOOL_CONFIG_METASLAB_ARRAY
value|"metaslab_array"
define|#
directive|define
name|ZPOOL_CONFIG_METASLAB_SHIFT
value|"metaslab_shift"
define|#
directive|define
name|ZPOOL_CONFIG_ASHIFT
value|"ashift"
define|#
directive|define
name|ZPOOL_CONFIG_ASIZE
value|"asize"
define|#
directive|define
name|ZPOOL_CONFIG_DTL
value|"DTL"
define|#
directive|define
name|ZPOOL_CONFIG_SCAN_STATS
value|"scan_stats"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_VDEV_STATS
value|"vdev_stats"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_WHOLE_DISK
value|"whole_disk"
define|#
directive|define
name|ZPOOL_CONFIG_ERRCOUNT
value|"error_count"
define|#
directive|define
name|ZPOOL_CONFIG_NOT_PRESENT
value|"not_present"
define|#
directive|define
name|ZPOOL_CONFIG_SPARES
value|"spares"
define|#
directive|define
name|ZPOOL_CONFIG_IS_SPARE
value|"is_spare"
define|#
directive|define
name|ZPOOL_CONFIG_NPARITY
value|"nparity"
define|#
directive|define
name|ZPOOL_CONFIG_HOSTID
value|"hostid"
define|#
directive|define
name|ZPOOL_CONFIG_HOSTNAME
value|"hostname"
define|#
directive|define
name|ZPOOL_CONFIG_LOADED_TIME
value|"initial_load_time"
define|#
directive|define
name|ZPOOL_CONFIG_UNSPARE
value|"unspare"
define|#
directive|define
name|ZPOOL_CONFIG_PHYS_PATH
value|"phys_path"
define|#
directive|define
name|ZPOOL_CONFIG_IS_LOG
value|"is_log"
define|#
directive|define
name|ZPOOL_CONFIG_L2CACHE
value|"l2cache"
define|#
directive|define
name|ZPOOL_CONFIG_HOLE_ARRAY
value|"hole_array"
define|#
directive|define
name|ZPOOL_CONFIG_VDEV_CHILDREN
value|"vdev_children"
define|#
directive|define
name|ZPOOL_CONFIG_IS_HOLE
value|"is_hole"
define|#
directive|define
name|ZPOOL_CONFIG_DDT_HISTOGRAM
value|"ddt_histogram"
define|#
directive|define
name|ZPOOL_CONFIG_DDT_OBJ_STATS
value|"ddt_object_stats"
define|#
directive|define
name|ZPOOL_CONFIG_DDT_STATS
value|"ddt_stats"
define|#
directive|define
name|ZPOOL_CONFIG_SPLIT
value|"splitcfg"
define|#
directive|define
name|ZPOOL_CONFIG_ORIG_GUID
value|"orig_guid"
define|#
directive|define
name|ZPOOL_CONFIG_SPLIT_GUID
value|"split_guid"
define|#
directive|define
name|ZPOOL_CONFIG_SPLIT_LIST
value|"guid_list"
define|#
directive|define
name|ZPOOL_CONFIG_REMOVING
value|"removing"
define|#
directive|define
name|ZPOOL_CONFIG_RESILVER_TXG
value|"resilver_txg"
define|#
directive|define
name|ZPOOL_CONFIG_COMMENT
value|"comment"
define|#
directive|define
name|ZPOOL_CONFIG_SUSPENDED
value|"suspended"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_TIMESTAMP
value|"timestamp"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_BOOTFS
value|"bootfs"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_MISSING_DEVICES
value|"missing_vdevs"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_LOAD_INFO
value|"load_info"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_REWIND_INFO
value|"rewind_info"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_UNSUP_FEAT
value|"unsup_feat"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_ENABLED_FEAT
value|"enabled_feat"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_CAN_RDONLY
value|"can_rdonly"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_FEATURES_FOR_READ
value|"features_for_read"
define|#
directive|define
name|ZPOOL_CONFIG_FEATURE_STATS
value|"feature_stats"
comment|/* not stored on disk */
define|#
directive|define
name|ZPOOL_CONFIG_VDEV_TOP_ZAP
value|"com.delphix:vdev_zap_top"
define|#
directive|define
name|ZPOOL_CONFIG_VDEV_LEAF_ZAP
value|"com.delphix:vdev_zap_leaf"
define|#
directive|define
name|ZPOOL_CONFIG_HAS_PER_VDEV_ZAPS
value|"com.delphix:has_per_vdev_zaps"
comment|/*  * The persistent vdev state is stored as separate values rather than a single  * 'vdev_state' entry.  This is because a device can be in multiple states, such  * as offline and degraded.  */
define|#
directive|define
name|ZPOOL_CONFIG_OFFLINE
value|"offline"
define|#
directive|define
name|ZPOOL_CONFIG_FAULTED
value|"faulted"
define|#
directive|define
name|ZPOOL_CONFIG_DEGRADED
value|"degraded"
define|#
directive|define
name|ZPOOL_CONFIG_REMOVED
value|"removed"
define|#
directive|define
name|ZPOOL_CONFIG_FRU
value|"fru"
define|#
directive|define
name|ZPOOL_CONFIG_AUX_STATE
value|"aux_state"
comment|/* Rewind policy parameters */
define|#
directive|define
name|ZPOOL_REWIND_POLICY
value|"rewind-policy"
define|#
directive|define
name|ZPOOL_REWIND_REQUEST
value|"rewind-request"
define|#
directive|define
name|ZPOOL_REWIND_REQUEST_TXG
value|"rewind-request-txg"
define|#
directive|define
name|ZPOOL_REWIND_META_THRESH
value|"rewind-meta-thresh"
define|#
directive|define
name|ZPOOL_REWIND_DATA_THRESH
value|"rewind-data-thresh"
comment|/* Rewind data discovered */
define|#
directive|define
name|ZPOOL_CONFIG_LOAD_TIME
value|"rewind_txg_ts"
define|#
directive|define
name|ZPOOL_CONFIG_LOAD_DATA_ERRORS
value|"verify_data_errors"
define|#
directive|define
name|ZPOOL_CONFIG_REWIND_TIME
value|"seconds_of_rewind"
define|#
directive|define
name|VDEV_TYPE_ROOT
value|"root"
define|#
directive|define
name|VDEV_TYPE_MIRROR
value|"mirror"
define|#
directive|define
name|VDEV_TYPE_REPLACING
value|"replacing"
define|#
directive|define
name|VDEV_TYPE_RAIDZ
value|"raidz"
define|#
directive|define
name|VDEV_TYPE_DISK
value|"disk"
define|#
directive|define
name|VDEV_TYPE_FILE
value|"file"
define|#
directive|define
name|VDEV_TYPE_MISSING
value|"missing"
define|#
directive|define
name|VDEV_TYPE_HOLE
value|"hole"
define|#
directive|define
name|VDEV_TYPE_SPARE
value|"spare"
define|#
directive|define
name|VDEV_TYPE_LOG
value|"log"
define|#
directive|define
name|VDEV_TYPE_L2CACHE
value|"l2cache"
comment|/*  * This is needed in userland to report the minimum necessary device size.  *  * Note that the zfs test suite uses 64MB vdevs.  */
define|#
directive|define
name|SPA_MINDEVSIZE
value|(64ULL<< 20)
comment|/*  * Set if the fragmentation has not yet been calculated. This can happen  * because the space maps have not been upgraded or the histogram feature  * is not enabled.  */
define|#
directive|define
name|ZFS_FRAG_INVALID
value|UINT64_MAX
comment|/*  * The location of the pool configuration repository, shared between kernel and  * userland.  */
define|#
directive|define
name|ZPOOL_CACHE
value|"/etc/zfs/zpool.cache"
comment|/*  * vdev states are ordered from least to most healthy.  * A vdev that's CANT_OPEN or below is considered unusable.  */
typedef|typedef
enum|enum
name|vdev_state
block|{
name|VDEV_STATE_UNKNOWN
init|=
literal|0
block|,
comment|/* Uninitialized vdev			*/
name|VDEV_STATE_CLOSED
block|,
comment|/* Not currently open			*/
name|VDEV_STATE_OFFLINE
block|,
comment|/* Not allowed to open			*/
name|VDEV_STATE_REMOVED
block|,
comment|/* Explicitly removed from system	*/
name|VDEV_STATE_CANT_OPEN
block|,
comment|/* Tried to open, but failed		*/
name|VDEV_STATE_FAULTED
block|,
comment|/* External request to fault device	*/
name|VDEV_STATE_DEGRADED
block|,
comment|/* Replicated vdev with unhealthy kids	*/
name|VDEV_STATE_HEALTHY
comment|/* Presumed good			*/
block|}
name|vdev_state_t
typedef|;
define|#
directive|define
name|VDEV_STATE_ONLINE
value|VDEV_STATE_HEALTHY
comment|/*  * vdev aux states.  When a vdev is in the CANT_OPEN state, the aux field  * of the vdev stats structure uses these constants to distinguish why.  */
typedef|typedef
enum|enum
name|vdev_aux
block|{
name|VDEV_AUX_NONE
block|,
comment|/* no error				*/
name|VDEV_AUX_OPEN_FAILED
block|,
comment|/* ldi_open_*() or vn_open() failed	*/
name|VDEV_AUX_CORRUPT_DATA
block|,
comment|/* bad label or disk contents		*/
name|VDEV_AUX_NO_REPLICAS
block|,
comment|/* insufficient number of replicas	*/
name|VDEV_AUX_BAD_GUID_SUM
block|,
comment|/* vdev guid sum doesn't match		*/
name|VDEV_AUX_TOO_SMALL
block|,
comment|/* vdev size is too small		*/
name|VDEV_AUX_BAD_LABEL
block|,
comment|/* the label is OK but invalid		*/
name|VDEV_AUX_VERSION_NEWER
block|,
comment|/* on-disk version is too new		*/
name|VDEV_AUX_VERSION_OLDER
block|,
comment|/* on-disk version is too old		*/
name|VDEV_AUX_UNSUP_FEAT
block|,
comment|/* unsupported features			*/
name|VDEV_AUX_SPARED
block|,
comment|/* hot spare used in another pool	*/
name|VDEV_AUX_ERR_EXCEEDED
block|,
comment|/* too many errors			*/
name|VDEV_AUX_IO_FAILURE
block|,
comment|/* experienced I/O failure		*/
name|VDEV_AUX_BAD_LOG
block|,
comment|/* cannot read log chain(s)		*/
name|VDEV_AUX_EXTERNAL
block|,
comment|/* external diagnosis			*/
name|VDEV_AUX_SPLIT_POOL
comment|/* vdev was split off into another pool	*/
block|}
name|vdev_aux_t
typedef|;
comment|/*  * pool state.  The following states are written to disk as part of the normal  * SPA lifecycle: ACTIVE, EXPORTED, DESTROYED, SPARE, L2CACHE.  The remaining  * states are software abstractions used at various levels to communicate  * pool state.  */
typedef|typedef
enum|enum
name|pool_state
block|{
name|POOL_STATE_ACTIVE
init|=
literal|0
block|,
comment|/* In active use		*/
name|POOL_STATE_EXPORTED
block|,
comment|/* Explicitly exported		*/
name|POOL_STATE_DESTROYED
block|,
comment|/* Explicitly destroyed		*/
name|POOL_STATE_SPARE
block|,
comment|/* Reserved for hot spare use	*/
name|POOL_STATE_L2CACHE
block|,
comment|/* Level 2 ARC device		*/
name|POOL_STATE_UNINITIALIZED
block|,
comment|/* Internal spa_t state		*/
name|POOL_STATE_UNAVAIL
block|,
comment|/* Internal libzfs state	*/
name|POOL_STATE_POTENTIALLY_ACTIVE
comment|/* Internal libzfs state	*/
block|}
name|pool_state_t
typedef|;
comment|/*  * Scan Functions.  */
typedef|typedef
enum|enum
name|pool_scan_func
block|{
name|POOL_SCAN_NONE
block|,
name|POOL_SCAN_SCRUB
block|,
name|POOL_SCAN_RESILVER
block|,
name|POOL_SCAN_FUNCS
block|}
name|pool_scan_func_t
typedef|;
comment|/*  * ZIO types.  Needed to interpret vdev statistics below.  */
typedef|typedef
enum|enum
name|zio_type
block|{
name|ZIO_TYPE_NULL
init|=
literal|0
block|,
name|ZIO_TYPE_READ
block|,
name|ZIO_TYPE_WRITE
block|,
name|ZIO_TYPE_FREE
block|,
name|ZIO_TYPE_CLAIM
block|,
name|ZIO_TYPE_IOCTL
block|,
name|ZIO_TYPES
block|}
name|zio_type_t
typedef|;
comment|/*  * Pool statistics.  Note: all fields should be 64-bit because this  * is passed between kernel and userland as an nvlist uint64 array.  */
typedef|typedef
struct|struct
name|pool_scan_stat
block|{
comment|/* values stored on disk */
name|uint64_t
name|pss_func
decl_stmt|;
comment|/* pool_scan_func_t */
name|uint64_t
name|pss_state
decl_stmt|;
comment|/* dsl_scan_state_t */
name|uint64_t
name|pss_start_time
decl_stmt|;
comment|/* scan start time */
name|uint64_t
name|pss_end_time
decl_stmt|;
comment|/* scan end time */
name|uint64_t
name|pss_to_examine
decl_stmt|;
comment|/* total bytes to scan */
name|uint64_t
name|pss_examined
decl_stmt|;
comment|/* total examined bytes	*/
name|uint64_t
name|pss_to_process
decl_stmt|;
comment|/* total bytes to process */
name|uint64_t
name|pss_processed
decl_stmt|;
comment|/* total processed bytes */
name|uint64_t
name|pss_errors
decl_stmt|;
comment|/* scan errors	*/
comment|/* values not stored on disk */
name|uint64_t
name|pss_pass_exam
decl_stmt|;
comment|/* examined bytes per scan pass */
name|uint64_t
name|pss_pass_start
decl_stmt|;
comment|/* start time of a scan pass */
block|}
name|pool_scan_stat_t
typedef|;
typedef|typedef
enum|enum
name|dsl_scan_state
block|{
name|DSS_NONE
block|,
name|DSS_SCANNING
block|,
name|DSS_FINISHED
block|,
name|DSS_CANCELED
block|,
name|DSS_NUM_STATES
block|}
name|dsl_scan_state_t
typedef|;
comment|/*  * Vdev statistics.  Note: all fields should be 64-bit because this  * is passed between kernel and userland as an nvlist uint64 array.  */
typedef|typedef
struct|struct
name|vdev_stat
block|{
name|hrtime_t
name|vs_timestamp
decl_stmt|;
comment|/* time since vdev load	*/
name|uint64_t
name|vs_state
decl_stmt|;
comment|/* vdev state		*/
name|uint64_t
name|vs_aux
decl_stmt|;
comment|/* see vdev_aux_t	*/
name|uint64_t
name|vs_alloc
decl_stmt|;
comment|/* space allocated	*/
name|uint64_t
name|vs_space
decl_stmt|;
comment|/* total capacity	*/
name|uint64_t
name|vs_dspace
decl_stmt|;
comment|/* deflated capacity	*/
name|uint64_t
name|vs_rsize
decl_stmt|;
comment|/* replaceable dev size */
name|uint64_t
name|vs_esize
decl_stmt|;
comment|/* expandable dev size */
name|uint64_t
name|vs_ops
index|[
name|ZIO_TYPES
index|]
decl_stmt|;
comment|/* operation count	*/
name|uint64_t
name|vs_bytes
index|[
name|ZIO_TYPES
index|]
decl_stmt|;
comment|/* bytes read/written	*/
name|uint64_t
name|vs_read_errors
decl_stmt|;
comment|/* read errors		*/
name|uint64_t
name|vs_write_errors
decl_stmt|;
comment|/* write errors		*/
name|uint64_t
name|vs_checksum_errors
decl_stmt|;
comment|/* checksum errors	*/
name|uint64_t
name|vs_self_healed
decl_stmt|;
comment|/* self-healed bytes	*/
name|uint64_t
name|vs_scan_removing
decl_stmt|;
comment|/* removing?	*/
name|uint64_t
name|vs_scan_processed
decl_stmt|;
comment|/* scan processed bytes	*/
name|uint64_t
name|vs_fragmentation
decl_stmt|;
comment|/* device fragmentation */
block|}
name|vdev_stat_t
typedef|;
comment|/*  * DDT statistics.  Note: all fields should be 64-bit because this  * is passed between kernel and userland as an nvlist uint64 array.  */
typedef|typedef
struct|struct
name|ddt_object
block|{
name|uint64_t
name|ddo_count
decl_stmt|;
comment|/* number of elments in ddt 	*/
name|uint64_t
name|ddo_dspace
decl_stmt|;
comment|/* size of ddt on disk		*/
name|uint64_t
name|ddo_mspace
decl_stmt|;
comment|/* size of ddt in-core		*/
block|}
name|ddt_object_t
typedef|;
typedef|typedef
struct|struct
name|ddt_stat
block|{
name|uint64_t
name|dds_blocks
decl_stmt|;
comment|/* blocks			*/
name|uint64_t
name|dds_lsize
decl_stmt|;
comment|/* logical size			*/
name|uint64_t
name|dds_psize
decl_stmt|;
comment|/* physical size		*/
name|uint64_t
name|dds_dsize
decl_stmt|;
comment|/* deflated allocated size	*/
name|uint64_t
name|dds_ref_blocks
decl_stmt|;
comment|/* referenced blocks		*/
name|uint64_t
name|dds_ref_lsize
decl_stmt|;
comment|/* referenced lsize * refcnt	*/
name|uint64_t
name|dds_ref_psize
decl_stmt|;
comment|/* referenced psize * refcnt	*/
name|uint64_t
name|dds_ref_dsize
decl_stmt|;
comment|/* referenced dsize * refcnt	*/
block|}
name|ddt_stat_t
typedef|;
typedef|typedef
struct|struct
name|ddt_histogram
block|{
name|ddt_stat_t
name|ddh_stat
index|[
literal|64
index|]
decl_stmt|;
comment|/* power-of-two histogram buckets */
block|}
name|ddt_histogram_t
typedef|;
define|#
directive|define
name|ZVOL_DRIVER
value|"zvol"
define|#
directive|define
name|ZFS_DRIVER
value|"zfs"
define|#
directive|define
name|ZFS_DEV
value|"/dev/zfs"
define|#
directive|define
name|ZFS_DISK_ROOT
value|"/dev/dsk"
define|#
directive|define
name|ZFS_DISK_ROOTD
value|ZFS_DISK_ROOT "/"
define|#
directive|define
name|ZFS_RDISK_ROOT
value|"/dev/rdsk"
define|#
directive|define
name|ZFS_RDISK_ROOTD
value|ZFS_RDISK_ROOT "/"
comment|/* general zvol path */
define|#
directive|define
name|ZVOL_DIR
value|"/dev/zvol"
comment|/* expansion */
define|#
directive|define
name|ZVOL_PSEUDO_DEV
value|"/devices/pseudo/zfs@0:"
comment|/* for dump and swap */
define|#
directive|define
name|ZVOL_FULL_DEV_DIR
value|ZVOL_DIR "/dsk/"
define|#
directive|define
name|ZVOL_FULL_RDEV_DIR
value|ZVOL_DIR "/rdsk/"
define|#
directive|define
name|ZVOL_PROP_NAME
value|"name"
define|#
directive|define
name|ZVOL_DEFAULT_BLOCKSIZE
value|8192
comment|/*  * /dev/zfs ioctl numbers.  */
typedef|typedef
enum|enum
name|zfs_ioc
block|{
name|ZFS_IOC_FIRST
init|=
operator|(
literal|'Z'
operator|<<
literal|8
operator|)
block|,
name|ZFS_IOC
init|=
name|ZFS_IOC_FIRST
block|,
name|ZFS_IOC_POOL_CREATE
init|=
name|ZFS_IOC_FIRST
block|,
name|ZFS_IOC_POOL_DESTROY
block|,
name|ZFS_IOC_POOL_IMPORT
block|,
name|ZFS_IOC_POOL_EXPORT
block|,
name|ZFS_IOC_POOL_CONFIGS
block|,
name|ZFS_IOC_POOL_STATS
block|,
name|ZFS_IOC_POOL_TRYIMPORT
block|,
name|ZFS_IOC_POOL_SCAN
block|,
name|ZFS_IOC_POOL_FREEZE
block|,
name|ZFS_IOC_POOL_UPGRADE
block|,
name|ZFS_IOC_POOL_GET_HISTORY
block|,
name|ZFS_IOC_VDEV_ADD
block|,
name|ZFS_IOC_VDEV_REMOVE
block|,
name|ZFS_IOC_VDEV_SET_STATE
block|,
name|ZFS_IOC_VDEV_ATTACH
block|,
name|ZFS_IOC_VDEV_DETACH
block|,
name|ZFS_IOC_VDEV_SETPATH
block|,
name|ZFS_IOC_VDEV_SETFRU
block|,
name|ZFS_IOC_OBJSET_STATS
block|,
name|ZFS_IOC_OBJSET_ZPLPROPS
block|,
name|ZFS_IOC_DATASET_LIST_NEXT
block|,
name|ZFS_IOC_SNAPSHOT_LIST_NEXT
block|,
name|ZFS_IOC_SET_PROP
block|,
name|ZFS_IOC_CREATE
block|,
name|ZFS_IOC_DESTROY
block|,
name|ZFS_IOC_ROLLBACK
block|,
name|ZFS_IOC_RENAME
block|,
name|ZFS_IOC_RECV
block|,
name|ZFS_IOC_SEND
block|,
name|ZFS_IOC_INJECT_FAULT
block|,
name|ZFS_IOC_CLEAR_FAULT
block|,
name|ZFS_IOC_INJECT_LIST_NEXT
block|,
name|ZFS_IOC_ERROR_LOG
block|,
name|ZFS_IOC_CLEAR
block|,
name|ZFS_IOC_PROMOTE
block|,
name|ZFS_IOC_SNAPSHOT
block|,
name|ZFS_IOC_DSOBJ_TO_DSNAME
block|,
name|ZFS_IOC_OBJ_TO_PATH
block|,
name|ZFS_IOC_POOL_SET_PROPS
block|,
name|ZFS_IOC_POOL_GET_PROPS
block|,
name|ZFS_IOC_SET_FSACL
block|,
name|ZFS_IOC_GET_FSACL
block|,
name|ZFS_IOC_SHARE
block|,
name|ZFS_IOC_INHERIT_PROP
block|,
name|ZFS_IOC_SMB_ACL
block|,
name|ZFS_IOC_USERSPACE_ONE
block|,
name|ZFS_IOC_USERSPACE_MANY
block|,
name|ZFS_IOC_USERSPACE_UPGRADE
block|,
name|ZFS_IOC_HOLD
block|,
name|ZFS_IOC_RELEASE
block|,
name|ZFS_IOC_GET_HOLDS
block|,
name|ZFS_IOC_OBJSET_RECVD_PROPS
block|,
name|ZFS_IOC_VDEV_SPLIT
block|,
name|ZFS_IOC_NEXT_OBJ
block|,
name|ZFS_IOC_DIFF
block|,
name|ZFS_IOC_TMP_SNAPSHOT
block|,
name|ZFS_IOC_OBJ_TO_STATS
block|,
name|ZFS_IOC_SPACE_WRITTEN
block|,
name|ZFS_IOC_SPACE_SNAPS
block|,
name|ZFS_IOC_DESTROY_SNAPS
block|,
name|ZFS_IOC_POOL_REGUID
block|,
name|ZFS_IOC_POOL_REOPEN
block|,
name|ZFS_IOC_SEND_PROGRESS
block|,
name|ZFS_IOC_LOG_HISTORY
block|,
name|ZFS_IOC_SEND_NEW
block|,
name|ZFS_IOC_SEND_SPACE
block|,
name|ZFS_IOC_CLONE
block|,
name|ZFS_IOC_BOOKMARK
block|,
name|ZFS_IOC_GET_BOOKMARKS
block|,
name|ZFS_IOC_DESTROY_BOOKMARKS
block|,
name|ZFS_IOC_LAST
block|}
name|zfs_ioc_t
typedef|;
comment|/*  * Internal SPA load state.  Used by FMA diagnosis engine.  */
typedef|typedef
enum|enum
block|{
name|SPA_LOAD_NONE
block|,
comment|/* no load in progress	*/
name|SPA_LOAD_OPEN
block|,
comment|/* normal open		*/
name|SPA_LOAD_IMPORT
block|,
comment|/* import in progress	*/
name|SPA_LOAD_TRYIMPORT
block|,
comment|/* tryimport in progress */
name|SPA_LOAD_RECOVER
block|,
comment|/* recovery requested	*/
name|SPA_LOAD_ERROR
block|,
comment|/* load failed		*/
name|SPA_LOAD_CREATE
comment|/* creation in progress */
block|}
name|spa_load_state_t
typedef|;
comment|/*  * Bookmark name values.  */
define|#
directive|define
name|ZPOOL_ERR_LIST
value|"error list"
define|#
directive|define
name|ZPOOL_ERR_DATASET
value|"dataset"
define|#
directive|define
name|ZPOOL_ERR_OBJECT
value|"object"
define|#
directive|define
name|HIS_MAX_RECORD_LEN
value|(MAXPATHLEN + MAXPATHLEN + 1)
comment|/*  * The following are names used in the nvlist describing  * the pool's history log.  */
define|#
directive|define
name|ZPOOL_HIST_RECORD
value|"history record"
define|#
directive|define
name|ZPOOL_HIST_TIME
value|"history time"
define|#
directive|define
name|ZPOOL_HIST_CMD
value|"history command"
define|#
directive|define
name|ZPOOL_HIST_WHO
value|"history who"
define|#
directive|define
name|ZPOOL_HIST_ZONE
value|"history zone"
define|#
directive|define
name|ZPOOL_HIST_HOST
value|"history hostname"
define|#
directive|define
name|ZPOOL_HIST_TXG
value|"history txg"
define|#
directive|define
name|ZPOOL_HIST_INT_EVENT
value|"history internal event"
define|#
directive|define
name|ZPOOL_HIST_INT_STR
value|"history internal str"
define|#
directive|define
name|ZPOOL_HIST_INT_NAME
value|"internal_name"
define|#
directive|define
name|ZPOOL_HIST_IOCTL
value|"ioctl"
define|#
directive|define
name|ZPOOL_HIST_INPUT_NVL
value|"in_nvl"
define|#
directive|define
name|ZPOOL_HIST_OUTPUT_NVL
value|"out_nvl"
define|#
directive|define
name|ZPOOL_HIST_DSNAME
value|"dsname"
define|#
directive|define
name|ZPOOL_HIST_DSID
value|"dsid"
comment|/*  * Flags for ZFS_IOC_VDEV_SET_STATE  */
define|#
directive|define
name|ZFS_ONLINE_CHECKREMOVE
value|0x1
define|#
directive|define
name|ZFS_ONLINE_UNSPARE
value|0x2
define|#
directive|define
name|ZFS_ONLINE_FORCEFAULT
value|0x4
define|#
directive|define
name|ZFS_ONLINE_EXPAND
value|0x8
define|#
directive|define
name|ZFS_OFFLINE_TEMPORARY
value|0x1
comment|/*  * Flags for ZFS_IOC_POOL_IMPORT  */
define|#
directive|define
name|ZFS_IMPORT_NORMAL
value|0x0
define|#
directive|define
name|ZFS_IMPORT_VERBATIM
value|0x1
define|#
directive|define
name|ZFS_IMPORT_ANY_HOST
value|0x2
define|#
directive|define
name|ZFS_IMPORT_MISSING_LOG
value|0x4
define|#
directive|define
name|ZFS_IMPORT_ONLY
value|0x8
comment|/*  * Sysevent payload members.  ZFS will generate the following sysevents with the  * given payloads:  *  *	ESC_ZFS_RESILVER_START  *	ESC_ZFS_RESILVER_END  *	ESC_ZFS_POOL_DESTROY  *	ESC_ZFS_POOL_REGUID  *  *		ZFS_EV_POOL_NAME	DATA_TYPE_STRING  *		ZFS_EV_POOL_GUID	DATA_TYPE_UINT64  *  *	ESC_ZFS_VDEV_REMOVE  *	ESC_ZFS_VDEV_CLEAR  *	ESC_ZFS_VDEV_CHECK  *  *		ZFS_EV_POOL_NAME	DATA_TYPE_STRING  *		ZFS_EV_POOL_GUID	DATA_TYPE_UINT64  *		ZFS_EV_VDEV_PATH	DATA_TYPE_STRING	(optional)  *		ZFS_EV_VDEV_GUID	DATA_TYPE_UINT64  */
define|#
directive|define
name|ZFS_EV_POOL_NAME
value|"pool_name"
define|#
directive|define
name|ZFS_EV_POOL_GUID
value|"pool_guid"
define|#
directive|define
name|ZFS_EV_VDEV_PATH
value|"vdev_path"
define|#
directive|define
name|ZFS_EV_VDEV_GUID
value|"vdev_guid"
ifdef|#
directive|ifdef
name|__cplusplus
block|}
end_extern

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* _SYS_FS_ZFS_H */
end_comment

end_unit

