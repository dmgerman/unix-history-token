begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/**************************************************************** Copyright 1990, 1993 by AT&T Bell Laboratories and Bellcore.  Permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright notice appear in all copies and that both that the copyright notice and this permission notice and warranty disclaimer appear in supporting documentation, and that the names of AT&T Bell Laboratories or Bellcore or any of their entities not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  AT&T and Bellcore disclaim all warranties with regard to this software, including all implied warranties of merchantability and fitness.  In no event shall AT&T or Bellcore be liable for any special, indirect or consequential damages or any damages whatsoever resulting from loss of use, data or profits, whether in an action of contract, negligence or other tortious action, arising out of or in connection with the use or performance of this software. ****************************************************************/
end_comment

begin_include
include|#
directive|include
file|"stdio.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|KR_headers
end_ifndef

begin_include
include|#
directive|include
file|"stdlib.h"
end_include

begin_include
include|#
directive|include
file|"fcntl.h"
end_include

begin_comment
comment|/* for declaration of open, O_RDONLY */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|MSDOS
end_ifdef

begin_include
include|#
directive|include
file|"io.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|O_RDONLY
end_ifndef

begin_define
define|#
directive|define
name|O_RDONLY
value|0
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|O_BINARY
end_ifndef

begin_define
define|#
directive|define
name|O_BINARY
value|O_RDONLY
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|char
modifier|*
name|progname
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|ignore_cr
decl_stmt|;
end_decl_stmt

begin_function
name|void
ifdef|#
directive|ifdef
name|KR_headers
name|usage
parameter_list|(
name|rc
parameter_list|)
else|#
directive|else
function|usage
parameter_list|(
name|int
name|rc
parameter_list|)
endif|#
directive|endif
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"usage: %s [-r] [file [file...]]\n\ 	option -r ignores carriage return characters\n"
argument_list|,
name|progname
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|rc
argument_list|)
expr_stmt|;
block|}
end_function

begin_typedef
typedef|typedef
name|unsigned
name|char
name|Uchar
typedef|;
end_typedef

begin_function
name|long
ifdef|#
directive|ifdef
name|KR_headers
name|sum32
parameter_list|(
name|sum
parameter_list|,
name|x
parameter_list|,
name|n
parameter_list|)
specifier|register
name|long
name|sum
decl_stmt|;
specifier|register
name|Uchar
modifier|*
name|x
decl_stmt|;
name|int
name|n
decl_stmt|;
else|#
directive|else
function|sum32
parameter_list|(
specifier|register
name|long
name|sum
parameter_list|,
specifier|register
name|Uchar
modifier|*
name|x
parameter_list|,
name|int
name|n
parameter_list|)
endif|#
directive|endif
block|{
specifier|register
name|Uchar
modifier|*
name|xe
decl_stmt|;
specifier|static
name|long
name|crc_table
index|[
literal|256
index|]
init|=
block|{
literal|0
block|,
literal|151466134
block|,
literal|302932268
block|,
literal|453595578
block|,
operator|-
literal|9583591
block|,
operator|-
literal|160762737
block|,
operator|-
literal|312236747
block|,
operator|-
literal|463170141
block|,
operator|-
literal|19167182
block|,
operator|-
literal|136529756
block|,
operator|-
literal|321525474
block|,
operator|-
literal|439166584
block|,
literal|28724267
block|,
literal|145849533
block|,
literal|330837255
block|,
literal|448732561
block|,
operator|-
literal|38334364
block|,
operator|-
literal|189783822
block|,
operator|-
literal|273059512
block|,
operator|-
literal|423738914
block|,
literal|47895677
block|,
literal|199091435
block|,
literal|282375505
block|,
literal|433292743
block|,
literal|57448534
block|,
literal|174827712
block|,
literal|291699066
block|,
literal|409324012
block|,
operator|-
literal|67019697
block|,
operator|-
literal|184128295
block|,
operator|-
literal|300991133
block|,
operator|-
literal|418902539
block|,
operator|-
literal|76668728
block|,
operator|-
literal|227995554
block|,
operator|-
literal|379567644
block|,
operator|-
literal|530091662
block|,
literal|67364049
block|,
literal|218420295
block|,
literal|369985021
block|,
literal|520795499
block|,
literal|95791354
block|,
literal|213031020
block|,
literal|398182870
block|,
literal|515701056
block|,
operator|-
literal|86479645
block|,
operator|-
literal|203465611
block|,
operator|-
literal|388624945
block|,
operator|-
literal|506380967
block|,
literal|114897068
block|,
literal|266207290
block|,
literal|349655424
block|,
literal|500195606
block|,
operator|-
literal|105581387
block|,
operator|-
literal|256654301
block|,
operator|-
literal|340093543
block|,
operator|-
literal|490887921
block|,
operator|-
literal|134039394
block|,
operator|-
literal|251295736
block|,
operator|-
literal|368256590
block|,
operator|-
literal|485758684
block|,
literal|124746887
block|,
literal|241716241
block|,
literal|358686123
block|,
literal|476458301
block|,
operator|-
literal|153337456
block|,
operator|-
literal|2395898
block|,
operator|-
literal|455991108
block|,
operator|-
literal|304803798
block|,
literal|162629001
block|,
literal|11973919
block|,
literal|465560741
block|,
literal|314102835
block|,
literal|134728098
block|,
literal|16841012
block|,
literal|436840590
block|,
literal|319723544
block|,
operator|-
literal|144044613
block|,
operator|-
literal|26395347
block|,
operator|-
literal|446403433
block|,
operator|-
literal|329032703
block|,
literal|191582708
block|,
literal|40657250
block|,
literal|426062040
block|,
literal|274858062
block|,
operator|-
literal|200894995
block|,
operator|-
literal|50223749
block|,
operator|-
literal|435620671
block|,
operator|-
literal|284179369
block|,
operator|-
literal|172959290
block|,
operator|-
literal|55056048
block|,
operator|-
literal|406931222
block|,
operator|-
literal|289830788
block|,
literal|182263263
block|,
literal|64630089
block|,
literal|416513267
block|,
literal|299125861
block|,
literal|229794136
block|,
literal|78991822
block|,
literal|532414580
block|,
literal|381366498
block|,
operator|-
literal|220224191
block|,
operator|-
literal|69691945
block|,
operator|-
literal|523123603
block|,
operator|-
literal|371788549
block|,
operator|-
literal|211162774
block|,
operator|-
literal|93398532
block|,
operator|-
literal|513308602
block|,
operator|-
literal|396314416
block|,
literal|201600371
block|,
literal|84090341
block|,
literal|503991391
block|,
literal|386759881
block|,
operator|-
literal|268078788
block|,
operator|-
literal|117292630
block|,
operator|-
literal|502591472
block|,
operator|-
literal|351526778
block|,
literal|258520357
block|,
literal|107972019
block|,
literal|493278217
block|,
literal|341959839
block|,
literal|249493774
block|,
literal|131713432
block|,
literal|483432482
block|,
literal|366454964
block|,
operator|-
literal|239911657
block|,
operator|-
literal|122417791
block|,
operator|-
literal|474129349
block|,
operator|-
literal|356881235
block|,
operator|-
literal|306674912
block|,
operator|-
literal|457198666
block|,
operator|-
literal|4791796
block|,
operator|-
literal|156118374
block|,
literal|315967289
block|,
literal|466778031
block|,
literal|14362133
block|,
literal|165418627
block|,
literal|325258002
block|,
literal|442776452
block|,
literal|23947838
block|,
literal|141187752
block|,
operator|-
literal|334573813
block|,
operator|-
literal|452329571
block|,
operator|-
literal|33509849
block|,
operator|-
literal|150495567
block|,
literal|269456196
block|,
literal|419996626
block|,
literal|33682024
block|,
literal|184992510
block|,
operator|-
literal|278767779
block|,
operator|-
literal|429561909
block|,
operator|-
literal|43239823
block|,
operator|-
literal|194312473
block|,
operator|-
literal|288089226
block|,
operator|-
literal|405591072
block|,
operator|-
literal|52790694
block|,
operator|-
literal|170046772
block|,
literal|297394031
block|,
literal|415166457
block|,
literal|62373443
block|,
literal|179343061
block|,
literal|383165416
block|,
literal|533828478
block|,
literal|81314500
block|,
literal|232780370
block|,
operator|-
literal|373594127
block|,
operator|-
literal|524527769
block|,
operator|-
literal|72022307
block|,
operator|-
literal|223201717
block|,
operator|-
literal|401789990
block|,
operator|-
literal|519431348
block|,
operator|-
literal|100447498
block|,
operator|-
literal|217810336
block|,
literal|392228803
block|,
literal|510123861
block|,
literal|91131631
block|,
literal|208256633
block|,
operator|-
literal|345918580
block|,
operator|-
literal|496598246
block|,
operator|-
literal|110112096
block|,
operator|-
literal|261561802
block|,
literal|336361365
block|,
literal|487278339
block|,
literal|100800185
block|,
literal|251995695
block|,
literal|364526526
block|,
literal|482151208
block|,
literal|129260178
block|,
literal|246639108
block|,
operator|-
literal|354943065
block|,
operator|-
literal|472854735
block|,
operator|-
literal|119955829
block|,
operator|-
literal|237064675
block|,
literal|459588272
block|,
literal|308539942
block|,
literal|157983644
block|,
literal|7181066
block|,
operator|-
literal|469170519
block|,
operator|-
literal|317835713
block|,
operator|-
literal|167286907
block|,
operator|-
literal|16754925
block|,
operator|-
literal|440448382
block|,
operator|-
literal|323454444
block|,
operator|-
literal|139383890
block|,
operator|-
literal|21619912
block|,
literal|450006683
block|,
literal|332774925
block|,
literal|148697015
block|,
literal|31186721
block|,
operator|-
literal|422325548
block|,
operator|-
literal|271261118
block|,
operator|-
literal|186797064
block|,
operator|-
literal|36011154
block|,
literal|431888077
block|,
literal|280569435
block|,
literal|196114401
block|,
literal|45565815
block|,
literal|403200742
block|,
literal|286222960
block|,
literal|168180682
block|,
literal|50400092
block|,
operator|-
literal|412770561
block|,
operator|-
literal|295522711
block|,
operator|-
literal|177471533
block|,
operator|-
literal|59977915
block|,
operator|-
literal|536157576
block|,
operator|-
literal|384970002
block|,
operator|-
literal|234585260
block|,
operator|-
literal|83643454
block|,
literal|526853729
block|,
literal|375396087
block|,
literal|225003341
block|,
literal|74348507
block|,
literal|517040714
block|,
literal|399923932
block|,
literal|215944038
block|,
literal|98057200
block|,
operator|-
literal|507728301
block|,
operator|-
literal|390357307
block|,
operator|-
literal|206385281
block|,
operator|-
literal|88735767
block|,
literal|498987548
block|,
literal|347783818
block|,
literal|263426864
block|,
literal|112501670
block|,
operator|-
literal|489671163
block|,
operator|-
literal|338229613
block|,
operator|-
literal|253864151
block|,
operator|-
literal|103192641
block|,
operator|-
literal|479823314
block|,
operator|-
literal|362722632
block|,
operator|-
literal|244835582
block|,
operator|-
literal|126932076
block|,
literal|470531639
block|,
literal|353144481
block|,
literal|235265819
block|,
literal|117632909
block|}
decl_stmt|;
name|xe
operator|=
name|x
operator|+
name|n
expr_stmt|;
while|while
condition|(
name|x
operator|<
name|xe
condition|)
name|sum
operator|=
name|crc_table
index|[
operator|(
name|sum
operator|^
operator|*
name|x
operator|++
operator|)
operator|&
literal|0xff
index|]
operator|^
operator|(
name|sum
operator|>>
literal|8
operator|&
literal|0xffffff
operator|)
expr_stmt|;
return|return
name|sum
return|;
block|}
end_function

begin_function
name|int
ifdef|#
directive|ifdef
name|KR_headers
name|cr_purge
parameter_list|(
name|buf
parameter_list|,
name|n
parameter_list|)
name|Uchar
modifier|*
name|buf
decl_stmt|;
name|int
name|n
decl_stmt|;
else|#
directive|else
function|cr_purge
parameter_list|(
name|Uchar
modifier|*
name|buf
parameter_list|,
name|int
name|n
parameter_list|)
endif|#
directive|endif
block|{
specifier|register
name|Uchar
modifier|*
name|b
decl_stmt|,
modifier|*
name|b1
decl_stmt|,
modifier|*
name|be
decl_stmt|;
name|b
operator|=
name|buf
expr_stmt|;
name|be
operator|=
name|b
operator|+
name|n
expr_stmt|;
while|while
condition|(
name|b
operator|<
name|be
condition|)
if|if
condition|(
operator|*
name|b
operator|++
operator|==
literal|'\r'
condition|)
block|{
name|b1
operator|=
name|b
operator|-
literal|1
expr_stmt|;
while|while
condition|(
name|b
operator|<
name|be
condition|)
if|if
condition|(
operator|(
operator|*
name|b1
operator|=
operator|*
name|b
operator|++
operator|)
operator|!=
literal|'\r'
condition|)
name|b1
operator|++
expr_stmt|;
return|return
name|b1
operator|-
name|buf
return|;
block|}
return|return
name|n
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|Uchar
name|Buf
index|[
literal|16
operator|*
literal|1024
index|]
decl_stmt|;
end_decl_stmt

begin_function
name|void
ifdef|#
directive|ifdef
name|KR_headers
name|process
parameter_list|(
name|s
parameter_list|,
name|x
parameter_list|)
name|char
modifier|*
name|s
decl_stmt|;
name|int
name|x
decl_stmt|;
else|#
directive|else
function|process
parameter_list|(
name|char
modifier|*
name|s
parameter_list|,
name|int
name|x
parameter_list|)
endif|#
directive|endif
block|{
specifier|register
name|int
name|n
decl_stmt|;
name|long
name|fsize
decl_stmt|,
name|sum
decl_stmt|;
name|sum
operator|=
literal|0
expr_stmt|;
name|fsize
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|n
operator|=
name|read
argument_list|(
name|x
argument_list|,
operator|(
name|char
operator|*
operator|)
name|Buf
argument_list|,
sizeof|sizeof
argument_list|(
name|Buf
argument_list|)
argument_list|)
operator|)
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|ignore_cr
condition|)
name|n
operator|=
name|cr_purge
argument_list|(
name|Buf
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|fsize
operator|+=
name|n
expr_stmt|;
name|sum
operator|=
name|sum32
argument_list|(
name|sum
argument_list|,
name|Buf
argument_list|,
name|n
argument_list|)
expr_stmt|;
block|}
name|sum
operator|&=
literal|0xffffffff
expr_stmt|;
if|if
condition|(
name|n
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"%s\t%lx\t%ld\n"
argument_list|,
name|s
argument_list|,
name|sum
operator|&
literal|0xffffffff
argument_list|,
name|fsize
argument_list|)
expr_stmt|;
else|else
block|{
name|perror
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
name|close
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|KR_headers
end_ifdef

begin_expr_stmt
expr|main
operator|(
name|argc
operator|,
name|argv
operator|)
name|char
operator|*
operator|*
name|argv
expr_stmt|;
end_expr_stmt

begin_else
else|#
directive|else
end_else

begin_function
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
endif|#
directive|endif
block|{
name|int
name|x
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|;
specifier|static
name|int
name|rc
decl_stmt|;
name|progname
operator|=
operator|*
name|argv
expr_stmt|;
name|s
operator|=
operator|*
operator|++
name|argv
expr_stmt|;
if|if
condition|(
name|s
operator|&&
operator|*
name|s
operator|==
literal|'-'
condition|)
block|{
switch|switch
condition|(
name|s
index|[
literal|1
index|]
condition|)
block|{
case|case
literal|'?'
case|:
name|usage
argument_list|(
literal|0
argument_list|)
expr_stmt|;
case|case
literal|'r'
case|:
name|ignore_cr
operator|=
literal|1
expr_stmt|;
case|case
literal|'-'
case|:
break|break;
default|default:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"invalid option %s\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|usage
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|s
operator|=
operator|*
operator|++
name|argv
expr_stmt|;
block|}
if|if
condition|(
name|s
condition|)
do|do
block|{
name|x
operator|=
name|open
argument_list|(
name|s
argument_list|,
name|O_RDONLY
operator||
name|O_BINARY
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: can't open %s\n"
argument_list|,
name|progname
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|rc
operator||=
literal|1
expr_stmt|;
block|}
else|else
name|process
argument_list|(
name|s
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|s
operator|=
operator|*
operator|++
name|argv
condition|)
do|;
else|else
block|{
name|process
argument_list|(
literal|"/dev/stdin"
argument_list|,
name|fileno
argument_list|(
name|stdin
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|rc
return|;
block|}
end_function

end_unit

