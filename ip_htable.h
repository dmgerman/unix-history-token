begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|__IP_HTABLE_H__
end_ifndef

begin_define
define|#
directive|define
name|__IP_HTABLE_H__
end_define

begin_include
include|#
directive|include
file|"netinet/ip_lookup.h"
end_include

begin_typedef
typedef|typedef
struct|struct
name|iphtent_s
block|{
name|struct
name|iphtent_s
modifier|*
name|ipe_next
decl_stmt|,
modifier|*
modifier|*
name|ipe_pnext
decl_stmt|;
name|struct
name|iphtent_s
modifier|*
name|ipe_hnext
decl_stmt|,
modifier|*
modifier|*
name|ipe_phnext
decl_stmt|;
name|struct
name|iphtent_s
modifier|*
name|ipe_dnext
decl_stmt|,
modifier|*
modifier|*
name|ipe_pdnext
decl_stmt|;
name|struct
name|iphtable_s
modifier|*
name|ipe_owner
decl_stmt|;
name|void
modifier|*
name|ipe_ptr
decl_stmt|;
name|i6addr_t
name|ipe_addr
decl_stmt|;
name|i6addr_t
name|ipe_mask
decl_stmt|;
name|U_QUAD_T
name|ipe_hits
decl_stmt|;
name|U_QUAD_T
name|ipe_bytes
decl_stmt|;
name|u_long
name|ipe_die
decl_stmt|;
name|int
name|ipe_uid
decl_stmt|;
name|int
name|ipe_ref
decl_stmt|;
name|int
name|ipe_unit
decl_stmt|;
name|char
name|ipe_family
decl_stmt|;
name|char
name|ipe_xxx
index|[
literal|3
index|]
decl_stmt|;
union|union
block|{
name|char
name|ipeu_char
index|[
literal|16
index|]
decl_stmt|;
name|u_long
name|ipeu_long
decl_stmt|;
name|u_int
name|ipeu_int
decl_stmt|;
block|}
name|ipe_un
union|;
block|}
name|iphtent_t
typedef|;
end_typedef

begin_define
define|#
directive|define
name|ipe_value
value|ipe_un.ipeu_int
end_define

begin_define
define|#
directive|define
name|ipe_group
value|ipe_un.ipeu_char
end_define

begin_define
define|#
directive|define
name|IPE_V4_HASH_FN
parameter_list|(
name|a
parameter_list|,
name|m
parameter_list|,
name|s
parameter_list|)
value|((((m) ^ (a)) - 1 - ((a)>> 8)) % (s))
end_define

begin_define
define|#
directive|define
name|IPE_V6_HASH_FN
parameter_list|(
name|a
parameter_list|,
name|m
parameter_list|,
name|s
parameter_list|)
value|(((((m)[0] ^ (a)[0]) - ((a)[0]>> 8)) + \ 				  (((m)[1]& (a)[1]) - ((a)[1]>> 8)) + \ 				  (((m)[2]& (a)[2]) - ((a)[2]>> 8)) + \ 				  (((m)[3]& (a)[3]) - ((a)[3]>> 8))) % (s))
end_define

begin_typedef
typedef|typedef
struct|struct
name|iphtable_s
block|{
name|ipfrwlock_t
name|iph_rwlock
decl_stmt|;
name|struct
name|iphtable_s
modifier|*
name|iph_next
decl_stmt|,
modifier|*
modifier|*
name|iph_pnext
decl_stmt|;
name|struct
name|iphtent_s
modifier|*
modifier|*
name|iph_table
decl_stmt|;
name|struct
name|iphtent_s
modifier|*
name|iph_list
decl_stmt|;
name|struct
name|iphtent_s
modifier|*
modifier|*
name|iph_tail
decl_stmt|;
ifdef|#
directive|ifdef
name|USE_INET6
name|ipf_v6_masktab_t
name|iph_v6_masks
decl_stmt|;
endif|#
directive|endif
name|ipf_v4_masktab_t
name|iph_v4_masks
decl_stmt|;
name|size_t
name|iph_size
decl_stmt|;
comment|/* size of hash table */
name|u_long
name|iph_seed
decl_stmt|;
comment|/* hashing seed */
name|u_32_t
name|iph_flags
decl_stmt|;
name|u_int
name|iph_unit
decl_stmt|;
comment|/* IPL_LOG* */
name|u_int
name|iph_ref
decl_stmt|;
name|u_int
name|iph_type
decl_stmt|;
comment|/* lookup or group map  - IPHASH_* */
name|u_int
name|iph_maskset
index|[
literal|4
index|]
decl_stmt|;
comment|/* netmasks in use */
name|char
name|iph_name
index|[
name|FR_GROUPLEN
index|]
decl_stmt|;
comment|/* hash table number */
block|}
name|iphtable_t
typedef|;
end_typedef

begin_comment
comment|/* iph_type */
end_comment

begin_define
define|#
directive|define
name|IPHASH_LOOKUP
value|0
end_define

begin_define
define|#
directive|define
name|IPHASH_GROUPMAP
value|1
end_define

begin_define
define|#
directive|define
name|IPHASH_DELETE
value|2
end_define

begin_define
define|#
directive|define
name|IPHASH_ANON
value|0x80000000
end_define

begin_typedef
typedef|typedef
struct|struct
name|iphtstat_s
block|{
name|iphtable_t
modifier|*
name|iphs_tables
decl_stmt|;
name|u_long
name|iphs_numtables
decl_stmt|;
name|u_long
name|iphs_numnodes
decl_stmt|;
name|u_long
name|iphs_nomem
decl_stmt|;
name|u_long
name|iphs_pad
index|[
literal|16
index|]
decl_stmt|;
block|}
name|iphtstat_t
typedef|;
end_typedef

begin_decl_stmt
specifier|extern
name|void
modifier|*
name|ipf_iphmfindgroup
name|__P
argument_list|(
operator|(
name|ipf_main_softc_t
operator|*
operator|,
name|void
operator|*
operator|,
name|void
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|iphtable_t
modifier|*
name|ipf_htable_find
name|__P
argument_list|(
operator|(
name|void
operator|*
operator|,
name|int
operator|,
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|ipf_lookup_t
name|ipf_htable_backend
decl_stmt|;
end_decl_stmt

begin_ifndef
ifndef|#
directive|ifndef
name|_KERNEL
end_ifndef

begin_decl_stmt
specifier|extern
name|void
name|ipf_htable_dump
name|__P
argument_list|(
operator|(
name|ipf_main_softc_t
operator|*
operator|,
name|void
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* __IP_HTABLE_H__ */
end_comment

end_unit

