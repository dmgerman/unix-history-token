begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*   * ldns-notify.c - ldns-notify(8)  *   * Copyright (c) 2001-2008, NLnet Labs, All right reserved  *  * See LICENSE for the license  *  * send a notify packet to a server  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_comment
comment|/* ldns */
end_comment

begin_include
include|#
directive|include
file|<ldns/ldns.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_NETDB_H
end_ifdef

begin_include
include|#
directive|include
file|<netdb.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_decl_stmt
specifier|static
name|int
name|verbose
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|max_num_retry
init|=
literal|15
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* times to try */
end_comment

begin_function
specifier|static
name|void
name|usage
parameter_list|(
name|void
parameter_list|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"usage: ldns-notify [other options] -z zone<servers>\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Ldns notify utility\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" Supported options:\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-z zone\t\tThe zone\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-s version\tSOA version number to include\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-y key:data\tTSIG sign the query\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-p port\t\tport to use to send to\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-v\t\tPrint version information\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-d\t\tPrint verbose debug information\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-r num\t\tmax number of retries (%d)\n"
argument_list|,
name|max_num_retry
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-h\t\tPrint this help information\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Report bugs to<ldns-team@nlnetlabs.nl>\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|version
parameter_list|(
name|void
parameter_list|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s version %s\n"
argument_list|,
name|PACKAGE_NAME
argument_list|,
name|PACKAGE_VERSION
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Written by NLnet Labs.\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Copyright (C) 2001-2008 NLnet Labs.  This is free software.\n"
literal|"There is NO warranty; not even for MERCHANTABILITY or FITNESS\n"
literal|"FOR A PARTICULAR PURPOSE.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|notify_host
parameter_list|(
name|int
name|s
parameter_list|,
name|struct
name|addrinfo
modifier|*
name|res
parameter_list|,
name|uint8_t
modifier|*
name|wire
parameter_list|,
name|size_t
name|wiresize
parameter_list|,
specifier|const
name|char
modifier|*
name|addrstr
parameter_list|)
block|{
name|int
name|timeout_retry
init|=
literal|5
decl_stmt|;
comment|/* seconds */
name|int
name|num_retry
init|=
name|max_num_retry
decl_stmt|;
ifndef|#
directive|ifndef
name|S_SPLINT_S
name|fd_set
name|rfds
decl_stmt|;
endif|#
directive|endif
name|struct
name|timeval
name|tv
decl_stmt|;
name|int
name|retval
init|=
literal|0
decl_stmt|;
name|ssize_t
name|received
init|=
literal|0
decl_stmt|;
name|int
name|got_ack
init|=
literal|0
decl_stmt|;
name|socklen_t
name|addrlen
init|=
literal|0
decl_stmt|;
name|uint8_t
name|replybuf
index|[
literal|2048
index|]
decl_stmt|;
name|ldns_status
name|status
decl_stmt|;
name|ldns_pkt
modifier|*
name|pkt
init|=
name|NULL
decl_stmt|;
while|while
condition|(
operator|!
name|got_ack
condition|)
block|{
comment|/* send it */
if|if
condition|(
name|sendto
argument_list|(
name|s
argument_list|,
operator|(
name|void
operator|*
operator|)
name|wire
argument_list|,
name|wiresize
argument_list|,
literal|0
argument_list|,
name|res
operator|->
name|ai_addr
argument_list|,
name|res
operator|->
name|ai_addrlen
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"warning: send to %s failed: %s\n"
argument_list|,
name|addrstr
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|USE_WINSOCK
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
else|#
directive|else
name|closesocket
argument_list|(
name|s
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return;
block|}
comment|/* wait for ACK packet */
ifndef|#
directive|ifndef
name|S_SPLINT_S
name|FD_ZERO
argument_list|(
operator|&
name|rfds
argument_list|)
expr_stmt|;
name|FD_SET
argument_list|(
name|s
argument_list|,
operator|&
name|rfds
argument_list|)
expr_stmt|;
name|tv
operator|.
name|tv_sec
operator|=
name|timeout_retry
expr_stmt|;
comment|/* seconds */
endif|#
directive|endif
name|tv
operator|.
name|tv_usec
operator|=
literal|0
expr_stmt|;
comment|/* microseconds */
name|retval
operator|=
name|select
argument_list|(
name|s
operator|+
literal|1
argument_list|,
operator|&
name|rfds
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
operator|&
name|tv
argument_list|)
expr_stmt|;
if|if
condition|(
name|retval
operator|==
operator|-
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"error waiting for reply from %s: %s\n"
argument_list|,
name|addrstr
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|USE_WINSOCK
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
else|#
directive|else
name|closesocket
argument_list|(
name|s
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return;
block|}
if|if
condition|(
name|retval
operator|==
literal|0
condition|)
block|{
name|num_retry
operator|--
expr_stmt|;
if|if
condition|(
name|num_retry
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"error: failed to send notify to %s.\n"
argument_list|,
name|addrstr
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"timeout (%d s) expired, retry notify to %s.\n"
argument_list|,
name|timeout_retry
argument_list|,
name|addrstr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|retval
operator|==
literal|1
condition|)
block|{
name|got_ack
operator|=
literal|1
expr_stmt|;
block|}
block|}
comment|/* got reply */
name|addrlen
operator|=
name|res
operator|->
name|ai_addrlen
expr_stmt|;
name|received
operator|=
name|recvfrom
argument_list|(
name|s
argument_list|,
operator|(
name|void
operator|*
operator|)
name|replybuf
argument_list|,
sizeof|sizeof
argument_list|(
name|replybuf
argument_list|)
argument_list|,
literal|0
argument_list|,
name|res
operator|->
name|ai_addr
argument_list|,
operator|&
name|addrlen
argument_list|)
expr_stmt|;
name|res
operator|->
name|ai_addrlen
operator|=
name|addrlen
expr_stmt|;
ifndef|#
directive|ifndef
name|USE_WINSOCK
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
else|#
directive|else
name|closesocket
argument_list|(
name|s
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|received
operator|==
operator|-
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"recv %s failed: %s\n"
argument_list|,
name|addrstr
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* check reply */
name|status
operator|=
name|ldns_wire2pkt
argument_list|(
operator|&
name|pkt
argument_list|,
name|replybuf
argument_list|,
operator|(
name|size_t
operator|)
name|received
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ssize_t
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"Could not parse reply packet: %s\n"
argument_list|,
name|ldns_get_errorstr_by_id
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|verbose
operator|>
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"hexdump of reply: "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|received
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|(
name|unsigned
operator|)
name|replybuf
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|verbose
condition|)
block|{
name|ssize_t
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"# reply from %s:\n"
argument_list|,
name|addrstr
argument_list|)
expr_stmt|;
name|ldns_pkt_print
argument_list|(
name|stdout
argument_list|,
name|pkt
argument_list|)
expr_stmt|;
if|if
condition|(
name|verbose
operator|>
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"hexdump of reply: "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|received
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|(
name|unsigned
operator|)
name|replybuf
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
name|ldns_pkt_free
argument_list|(
name|pkt
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|int
name|c
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/* LDNS types */
name|ldns_pkt
modifier|*
name|notify
decl_stmt|;
name|ldns_rr
modifier|*
name|question
decl_stmt|;
name|ldns_resolver
modifier|*
name|res
decl_stmt|;
name|ldns_rdf
modifier|*
name|ldns_zone_name
init|=
name|NULL
decl_stmt|;
name|ldns_status
name|status
decl_stmt|;
specifier|const
name|char
modifier|*
name|zone_name
init|=
name|NULL
decl_stmt|;
name|int
name|include_soa
init|=
literal|0
decl_stmt|;
name|uint32_t
name|soa_version
init|=
literal|0
decl_stmt|;
name|ldns_tsig_credentials
name|tsig_cred
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|int
name|do_hexdump
init|=
literal|1
decl_stmt|;
name|uint8_t
modifier|*
name|wire
init|=
name|NULL
decl_stmt|;
name|size_t
name|wiresize
init|=
literal|0
decl_stmt|;
specifier|const
name|char
modifier|*
name|port
init|=
literal|"53"
decl_stmt|;
name|srandom
argument_list|(
name|time
argument_list|(
name|NULL
argument_list|)
operator|^
name|getpid
argument_list|()
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"vhdp:r:s:y:z:"
argument_list|)
operator|)
operator|!=
operator|-
literal|1
condition|)
block|{
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'d'
case|:
name|verbose
operator|++
expr_stmt|;
break|break;
case|case
literal|'p'
case|:
name|port
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'r'
case|:
name|max_num_retry
operator|=
name|atoi
argument_list|(
name|optarg
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'s'
case|:
name|include_soa
operator|=
literal|1
expr_stmt|;
name|soa_version
operator|=
operator|(
name|uint32_t
operator|)
name|atoi
argument_list|(
name|optarg
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'y'
case|:
name|tsig_cred
operator|.
name|algorithm
operator|=
operator|(
name|char
operator|*
operator|)
literal|"hmac-md5.sig-alg.reg.int."
expr_stmt|;
name|tsig_cred
operator|.
name|keyname
operator|=
name|optarg
expr_stmt|;
name|tsig_cred
operator|.
name|keydata
operator|=
name|strchr
argument_list|(
name|optarg
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
operator|*
name|tsig_cred
operator|.
name|keydata
operator|=
literal|'\0'
expr_stmt|;
name|tsig_cred
operator|.
name|keydata
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"Sign with %s : %s\n"
argument_list|,
name|tsig_cred
operator|.
name|keyname
argument_list|,
name|tsig_cred
operator|.
name|keydata
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'z'
case|:
name|zone_name
operator|=
name|optarg
expr_stmt|;
name|ldns_zone_name
operator|=
name|ldns_dname_new_frm_str
argument_list|(
name|zone_name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ldns_zone_name
condition|)
block|{
name|printf
argument_list|(
literal|"cannot parse zone name: %s\n"
argument_list|,
name|zone_name
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'v'
case|:
name|version
argument_list|()
expr_stmt|;
case|case
literal|'h'
case|:
case|case
literal|'?'
case|:
default|default:
name|usage
argument_list|()
expr_stmt|;
block|}
block|}
name|argc
operator|-=
name|optind
expr_stmt|;
name|argv
operator|+=
name|optind
expr_stmt|;
if|if
condition|(
name|argc
operator|==
literal|0
operator|||
name|zone_name
operator|==
name|NULL
condition|)
block|{
name|usage
argument_list|()
expr_stmt|;
block|}
name|notify
operator|=
name|ldns_pkt_new
argument_list|()
expr_stmt|;
name|question
operator|=
name|ldns_rr_new
argument_list|()
expr_stmt|;
name|res
operator|=
name|ldns_resolver_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|notify
operator|||
operator|!
name|question
operator|||
operator|!
name|res
condition|)
block|{
comment|/* bail out */
name|printf
argument_list|(
literal|"error: cannot create ldns types\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* create the rr for inside the pkt */
name|ldns_rr_set_class
argument_list|(
name|question
argument_list|,
name|LDNS_RR_CLASS_IN
argument_list|)
expr_stmt|;
name|ldns_rr_set_owner
argument_list|(
name|question
argument_list|,
name|ldns_zone_name
argument_list|)
expr_stmt|;
name|ldns_rr_set_type
argument_list|(
name|question
argument_list|,
name|LDNS_RR_TYPE_SOA
argument_list|)
expr_stmt|;
name|ldns_pkt_set_opcode
argument_list|(
name|notify
argument_list|,
name|LDNS_PACKET_NOTIFY
argument_list|)
expr_stmt|;
name|ldns_pkt_push_rr
argument_list|(
name|notify
argument_list|,
name|LDNS_SECTION_QUESTION
argument_list|,
name|question
argument_list|)
expr_stmt|;
name|ldns_pkt_set_aa
argument_list|(
name|notify
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|ldns_pkt_set_id
argument_list|(
name|notify
argument_list|,
name|random
argument_list|()
operator|&
literal|0xffff
argument_list|)
expr_stmt|;
if|if
condition|(
name|include_soa
condition|)
block|{
name|char
name|buf
index|[
literal|10240
index|]
decl_stmt|;
name|ldns_rr
modifier|*
name|soa_rr
init|=
name|NULL
decl_stmt|;
name|ldns_rdf
modifier|*
name|prev
init|=
name|NULL
decl_stmt|;
name|snprintf
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%s 3600 IN SOA . . %u 0 0 0 0"
argument_list|,
name|zone_name
argument_list|,
operator|(
name|unsigned
operator|)
name|soa_version
argument_list|)
expr_stmt|;
comment|/*printf("Adding soa %s\n", buf);*/
name|status
operator|=
name|ldns_rr_new_frm_str
argument_list|(
operator|&
name|soa_rr
argument_list|,
name|buf
argument_list|,
literal|3600
argument_list|,
name|NULL
argument_list|,
operator|&
name|prev
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|printf
argument_list|(
literal|"Error adding SOA version: %s\n"
argument_list|,
name|ldns_get_errorstr_by_id
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|ldns_pkt_push_rr
argument_list|(
name|notify
argument_list|,
name|LDNS_SECTION_ANSWER
argument_list|,
name|soa_rr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|tsig_cred
operator|.
name|keyname
condition|)
block|{
ifdef|#
directive|ifdef
name|HAVE_SSL
name|status
operator|=
name|ldns_pkt_tsig_sign
argument_list|(
name|notify
argument_list|,
name|tsig_cred
operator|.
name|keyname
argument_list|,
name|tsig_cred
operator|.
name|keydata
argument_list|,
literal|300
argument_list|,
name|tsig_cred
operator|.
name|algorithm
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|printf
argument_list|(
literal|"Error TSIG sign query: %s\n"
argument_list|,
name|ldns_get_errorstr_by_id
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Warning: TSIG needs OpenSSL support, which has not been compiled in, TSIG skipped\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
if|if
condition|(
name|verbose
condition|)
block|{
name|printf
argument_list|(
literal|"# Sending packet:\n"
argument_list|)
expr_stmt|;
name|ldns_pkt_print
argument_list|(
name|stdout
argument_list|,
name|notify
argument_list|)
expr_stmt|;
block|}
name|status
operator|=
name|ldns_pkt2wire
argument_list|(
operator|&
name|wire
argument_list|,
name|notify
argument_list|,
operator|&
name|wiresize
argument_list|)
expr_stmt|;
if|if
condition|(
name|wiresize
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Error converting notify packet to hex.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|do_hexdump
operator|&&
name|verbose
operator|>
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"Hexdump of notify packet:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|int
operator|)
name|wiresize
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|(
name|unsigned
operator|)
name|wire
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|argc
condition|;
name|i
operator|++
control|)
block|{
name|struct
name|addrinfo
name|hints
decl_stmt|,
modifier|*
name|res0
decl_stmt|,
modifier|*
name|res
decl_stmt|;
name|int
name|error
decl_stmt|;
name|int
name|default_family
init|=
name|AF_INET
decl_stmt|;
if|if
condition|(
name|verbose
condition|)
name|printf
argument_list|(
literal|"# sending to %s\n"
argument_list|,
name|argv
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|hints
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|hints
argument_list|)
argument_list|)
expr_stmt|;
name|hints
operator|.
name|ai_family
operator|=
name|default_family
expr_stmt|;
name|hints
operator|.
name|ai_socktype
operator|=
name|SOCK_DGRAM
expr_stmt|;
name|hints
operator|.
name|ai_protocol
operator|=
name|IPPROTO_UDP
expr_stmt|;
name|error
operator|=
name|getaddrinfo
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
name|port
argument_list|,
operator|&
name|hints
argument_list|,
operator|&
name|res0
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
block|{
name|printf
argument_list|(
literal|"skipping bad address: %s: %s\n"
argument_list|,
name|argv
index|[
name|i
index|]
argument_list|,
name|gai_strerror
argument_list|(
name|error
argument_list|)
argument_list|)
expr_stmt|;
continue|continue;
block|}
for|for
control|(
name|res
operator|=
name|res0
init|;
name|res
condition|;
name|res
operator|=
name|res
operator|->
name|ai_next
control|)
block|{
name|int
name|s
init|=
name|socket
argument_list|(
name|res
operator|->
name|ai_family
argument_list|,
name|res
operator|->
name|ai_socktype
argument_list|,
name|res
operator|->
name|ai_protocol
argument_list|)
decl_stmt|;
if|if
condition|(
name|s
operator|==
operator|-
literal|1
condition|)
continue|continue;
comment|/* send the notify */
name|notify_host
argument_list|(
name|s
argument_list|,
name|res
argument_list|,
name|wire
argument_list|,
name|wiresize
argument_list|,
name|argv
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|freeaddrinfo
argument_list|(
name|res0
argument_list|)
expr_stmt|;
block|}
name|ldns_pkt_free
argument_list|(
name|notify
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|wire
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

