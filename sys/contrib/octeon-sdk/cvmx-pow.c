begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/***********************license start***************  * Copyright (c) 2003-2010  Cavium Networks (support@cavium.com). All rights  * reserved.  *  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions are  * met:  *  *   * Redistributions of source code must retain the above copyright  *     notice, this list of conditions and the following disclaimer.  *  *   * Redistributions in binary form must reproduce the above  *     copyright notice, this list of conditions and the following  *     disclaimer in the documentation and/or other materials provided  *     with the distribution.   *   * Neither the name of Cavium Networks nor the names of  *     its contributors may be used to endorse or promote products  *     derived from this software without specific prior written  *     permission.   * This Software, including technical data, may be subject to U.S. export  control  * laws, including the U.S. Export Administration Act and its  associated  * regulations, and may be subject to export or import  regulations in other  * countries.   * TO THE MAXIMUM EXTENT PERMITTED BY LAW, THE SOFTWARE IS PROVIDED "AS IS"  * AND WITH ALL FAULTS AND CAVIUM  NETWORKS MAKES NO PROMISES, REPRESENTATIONS OR  * WARRANTIES, EITHER EXPRESS, IMPLIED, STATUTORY, OR OTHERWISE, WITH RESPECT TO  * THE SOFTWARE, INCLUDING ITS CONDITION, ITS CONFORMITY TO ANY REPRESENTATION OR  * DESCRIPTION, OR THE EXISTENCE OF ANY LATENT OR PATENT DEFECTS, AND CAVIUM  * SPECIFICALLY DISCLAIMS ALL IMPLIED (IF ANY) WARRANTIES OF TITLE,  * MERCHANTABILITY, NONINFRINGEMENT, FITNESS FOR A PARTICULAR PURPOSE, LACK OF  * VIRUSES, ACCURACY OR COMPLETENESS, QUIET ENJOYMENT, QUIET POSSESSION OR  * CORRESPONDENCE TO DESCRIPTION. THE ENTIRE  RISK ARISING OUT OF USE OR  * PERFORMANCE OF THE SOFTWARE LIES WITH YOU.  ***********************license end**************************************/
end_comment

begin_comment
comment|/**  * @file  *  * Interface to the hardware Packet Order / Work unit.  *  *<hr>$Revision: 29727 $<hr>  */
end_comment

begin_include
include|#
directive|include
file|"cvmx.h"
end_include

begin_include
include|#
directive|include
file|"cvmx-pow.h"
end_include

begin_comment
comment|/**  * @INTERNAL  * This structure stores the internal POW state captured by  * cvmx_pow_capture(). It is purposely not exposed to the user  * since the format may change without notice.  */
end_comment

begin_typedef
typedef|typedef
struct|struct
block|{
name|cvmx_pow_tag_load_resp_t
name|sstatus
index|[
literal|16
index|]
index|[
literal|8
index|]
decl_stmt|;
name|cvmx_pow_tag_load_resp_t
name|smemload
index|[
literal|2048
index|]
index|[
literal|3
index|]
decl_stmt|;
name|cvmx_pow_tag_load_resp_t
name|sindexload
index|[
literal|16
index|]
index|[
literal|4
index|]
decl_stmt|;
block|}
name|__cvmx_pow_dump_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
block|{
name|CVMX_POW_LIST_UNKNOWN
init|=
literal|0
block|,
name|CVMX_POW_LIST_FREE
init|=
literal|1
block|,
name|CVMX_POW_LIST_INPUT
init|=
literal|2
block|,
name|CVMX_POW_LIST_CORE
init|=
name|CVMX_POW_LIST_INPUT
operator|+
literal|8
block|,
name|CVMX_POW_LIST_DESCHED
init|=
name|CVMX_POW_LIST_CORE
operator|+
literal|16
block|,
name|CVMX_POW_LIST_NOSCHED
init|=
name|CVMX_POW_LIST_DESCHED
operator|+
literal|16
block|, }
name|__cvmx_pow_list_types_t
typedef|;
end_typedef

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|__cvmx_pow_list_names
index|[]
init|=
block|{
literal|"Unknown"
block|,
literal|"Free List"
block|,
literal|"Queue 0"
block|,
literal|"Queue 1"
block|,
literal|"Queue 2"
block|,
literal|"Queue 3"
block|,
literal|"Queue 4"
block|,
literal|"Queue 5"
block|,
literal|"Queue 6"
block|,
literal|"Queue 7"
block|,
literal|"Core 0"
block|,
literal|"Core 1"
block|,
literal|"Core 2"
block|,
literal|"Core 3"
block|,
literal|"Core 4"
block|,
literal|"Core 5"
block|,
literal|"Core 6"
block|,
literal|"Core 7"
block|,
literal|"Core 8"
block|,
literal|"Core 9"
block|,
literal|"Core 10"
block|,
literal|"Core 11"
block|,
literal|"Core 12"
block|,
literal|"Core 13"
block|,
literal|"Core 14"
block|,
literal|"Core 15"
block|,
literal|"Desched 0"
block|,
literal|"Desched 1"
block|,
literal|"Desched 2"
block|,
literal|"Desched 3"
block|,
literal|"Desched 4"
block|,
literal|"Desched 5"
block|,
literal|"Desched 6"
block|,
literal|"Desched 7"
block|,
literal|"Desched 8"
block|,
literal|"Desched 9"
block|,
literal|"Desched 10"
block|,
literal|"Desched 11"
block|,
literal|"Desched 12"
block|,
literal|"Desched 13"
block|,
literal|"Desched 14"
block|,
literal|"Desched 15"
block|,
literal|"Nosched 0"
block|,
literal|"Nosched 1"
block|,
literal|"Nosched 2"
block|,
literal|"Nosched 3"
block|,
literal|"Nosched 4"
block|,
literal|"Nosched 5"
block|,
literal|"Nosched 6"
block|,
literal|"Nosched 7"
block|,
literal|"Nosched 8"
block|,
literal|"Nosched 9"
block|,
literal|"Nosched 10"
block|,
literal|"Nosched 11"
block|,
literal|"Nosched 12"
block|,
literal|"Nosched 13"
block|,
literal|"Nosched 14"
block|,
literal|"Nosched 15"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/**  * Return the number of POW entries supported by this chip  *  * @return Number of POW entries  */
end_comment

begin_function
name|int
name|cvmx_pow_get_num_entries
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|OCTEON_IS_MODEL
argument_list|(
name|OCTEON_CN30XX
argument_list|)
condition|)
return|return
literal|64
return|;
elseif|else
if|if
condition|(
name|OCTEON_IS_MODEL
argument_list|(
name|OCTEON_CN31XX
argument_list|)
operator|||
name|OCTEON_IS_MODEL
argument_list|(
name|OCTEON_CN50XX
argument_list|)
condition|)
return|return
literal|256
return|;
elseif|else
if|if
condition|(
name|OCTEON_IS_MODEL
argument_list|(
name|OCTEON_CN52XX
argument_list|)
condition|)
return|return
literal|512
return|;
elseif|else
if|if
condition|(
name|OCTEON_IS_MODEL
argument_list|(
name|OCTEON_CN63XX
argument_list|)
condition|)
return|return
literal|1024
return|;
else|else
return|return
literal|2048
return|;
block|}
end_function

begin_comment
comment|/**  * Store the current POW internal state into the supplied  * buffer. It is recommended that you pass a buffer of at least  * 128KB. The format of the capture may change based on SDK  * version and Octeon chip.  *  * @param buffer Buffer to store capture into  * @param buffer_size  *               The size of the supplied buffer  *  * @return Zero on sucess, negative on failure  */
end_comment

begin_function
name|int
name|cvmx_pow_capture
parameter_list|(
name|void
modifier|*
name|buffer
parameter_list|,
name|int
name|buffer_size
parameter_list|)
block|{
name|__cvmx_pow_dump_t
modifier|*
name|dump
init|=
operator|(
name|__cvmx_pow_dump_t
operator|*
operator|)
name|buffer
decl_stmt|;
name|int
name|num_cores
decl_stmt|;
name|int
name|num_pow_entries
init|=
name|cvmx_pow_get_num_entries
argument_list|()
decl_stmt|;
name|int
name|core
decl_stmt|;
name|int
name|index
decl_stmt|;
name|int
name|bits
decl_stmt|;
if|if
condition|(
name|buffer_size
operator|<
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|__cvmx_pow_dump_t
argument_list|)
condition|)
block|{
name|cvmx_dprintf
argument_list|(
literal|"cvmx_pow_capture: Buffer too small\n"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|num_cores
operator|=
name|cvmx_octeon_num_cores
argument_list|()
expr_stmt|;
comment|/* Read all core related state */
for|for
control|(
name|core
operator|=
literal|0
init|;
name|core
operator|<
name|num_cores
condition|;
name|core
operator|++
control|)
block|{
name|cvmx_pow_load_addr_t
name|load_addr
decl_stmt|;
name|load_addr
operator|.
name|u64
operator|=
literal|0
expr_stmt|;
name|load_addr
operator|.
name|sstatus
operator|.
name|mem_region
operator|=
name|CVMX_IO_SEG
expr_stmt|;
name|load_addr
operator|.
name|sstatus
operator|.
name|is_io
operator|=
literal|1
expr_stmt|;
name|load_addr
operator|.
name|sstatus
operator|.
name|did
operator|=
name|CVMX_OCT_DID_TAG_TAG1
expr_stmt|;
name|load_addr
operator|.
name|sstatus
operator|.
name|coreid
operator|=
name|core
expr_stmt|;
for|for
control|(
name|bits
operator|=
literal|0
init|;
name|bits
operator|<
literal|8
condition|;
name|bits
operator|++
control|)
block|{
name|load_addr
operator|.
name|sstatus
operator|.
name|get_rev
operator|=
operator|(
name|bits
operator|&
literal|1
operator|)
operator|!=
literal|0
expr_stmt|;
name|load_addr
operator|.
name|sstatus
operator|.
name|get_cur
operator|=
operator|(
name|bits
operator|&
literal|2
operator|)
operator|!=
literal|0
expr_stmt|;
name|load_addr
operator|.
name|sstatus
operator|.
name|get_wqp
operator|=
operator|(
name|bits
operator|&
literal|4
operator|)
operator|!=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|load_addr
operator|.
name|sstatus
operator|.
name|get_cur
operator|==
literal|0
operator|)
operator|&&
name|load_addr
operator|.
name|sstatus
operator|.
name|get_rev
condition|)
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bits
index|]
operator|.
name|u64
operator|=
operator|-
literal|1
expr_stmt|;
else|else
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bits
index|]
operator|.
name|u64
operator|=
name|cvmx_read_csr
argument_list|(
name|load_addr
operator|.
name|u64
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* Read all internal POW entries */
for|for
control|(
name|index
operator|=
literal|0
init|;
name|index
operator|<
name|num_pow_entries
condition|;
name|index
operator|++
control|)
block|{
name|cvmx_pow_load_addr_t
name|load_addr
decl_stmt|;
name|load_addr
operator|.
name|u64
operator|=
literal|0
expr_stmt|;
name|load_addr
operator|.
name|smemload
operator|.
name|mem_region
operator|=
name|CVMX_IO_SEG
expr_stmt|;
name|load_addr
operator|.
name|smemload
operator|.
name|is_io
operator|=
literal|1
expr_stmt|;
name|load_addr
operator|.
name|smemload
operator|.
name|did
operator|=
name|CVMX_OCT_DID_TAG_TAG2
expr_stmt|;
name|load_addr
operator|.
name|smemload
operator|.
name|index
operator|=
name|index
expr_stmt|;
for|for
control|(
name|bits
operator|=
literal|0
init|;
name|bits
operator|<
literal|3
condition|;
name|bits
operator|++
control|)
block|{
name|load_addr
operator|.
name|smemload
operator|.
name|get_des
operator|=
operator|(
name|bits
operator|&
literal|1
operator|)
operator|!=
literal|0
expr_stmt|;
name|load_addr
operator|.
name|smemload
operator|.
name|get_wqp
operator|=
operator|(
name|bits
operator|&
literal|2
operator|)
operator|!=
literal|0
expr_stmt|;
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
name|bits
index|]
operator|.
name|u64
operator|=
name|cvmx_read_csr
argument_list|(
name|load_addr
operator|.
name|u64
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* Read all group and queue pointers */
for|for
control|(
name|index
operator|=
literal|0
init|;
name|index
operator|<
literal|16
condition|;
name|index
operator|++
control|)
block|{
name|cvmx_pow_load_addr_t
name|load_addr
decl_stmt|;
name|load_addr
operator|.
name|u64
operator|=
literal|0
expr_stmt|;
name|load_addr
operator|.
name|sindexload
operator|.
name|mem_region
operator|=
name|CVMX_IO_SEG
expr_stmt|;
name|load_addr
operator|.
name|sindexload
operator|.
name|is_io
operator|=
literal|1
expr_stmt|;
name|load_addr
operator|.
name|sindexload
operator|.
name|did
operator|=
name|CVMX_OCT_DID_TAG_TAG3
expr_stmt|;
name|load_addr
operator|.
name|sindexload
operator|.
name|qosgrp
operator|=
name|index
expr_stmt|;
for|for
control|(
name|bits
operator|=
literal|0
init|;
name|bits
operator|<
literal|4
condition|;
name|bits
operator|++
control|)
block|{
name|load_addr
operator|.
name|sindexload
operator|.
name|get_rmt
operator|=
operator|(
name|bits
operator|&
literal|1
operator|)
operator|!=
literal|0
expr_stmt|;
name|load_addr
operator|.
name|sindexload
operator|.
name|get_des_get_tail
operator|=
operator|(
name|bits
operator|&
literal|2
operator|)
operator|!=
literal|0
expr_stmt|;
comment|/* The first pass only has 8 valid index values */
if|if
condition|(
operator|(
name|load_addr
operator|.
name|sindexload
operator|.
name|get_rmt
operator|==
literal|0
operator|)
operator|&&
operator|(
name|load_addr
operator|.
name|sindexload
operator|.
name|get_des_get_tail
operator|==
literal|0
operator|)
operator|&&
operator|(
name|index
operator|>=
literal|8
operator|)
condition|)
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
name|bits
index|]
operator|.
name|u64
operator|=
operator|-
literal|1
expr_stmt|;
else|else
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
name|bits
index|]
operator|.
name|u64
operator|=
name|cvmx_read_csr
argument_list|(
name|load_addr
operator|.
name|u64
argument_list|)
expr_stmt|;
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/**  * Function to display a POW internal queue to the user  *  * @param name       User visible name for the queue  * @param name_param Parameter for printf in creating the name  * @param valid      Set if the queue contains any elements  * @param has_one    Set if the queue contains exactly one element  * @param head       The head pointer  * @param tail       The tail pointer  */
end_comment

begin_function
specifier|static
name|void
name|__cvmx_pow_display_list
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|int
name|name_param
parameter_list|,
name|int
name|valid
parameter_list|,
name|int
name|has_one
parameter_list|,
name|uint64_t
name|head
parameter_list|,
name|uint64_t
name|tail
parameter_list|)
block|{
name|printf
argument_list|(
name|name
argument_list|,
name|name_param
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|": "
argument_list|)
expr_stmt|;
if|if
condition|(
name|valid
condition|)
block|{
if|if
condition|(
name|has_one
condition|)
name|printf
argument_list|(
literal|"One element index=%llu(0x%llx)\n"
argument_list|,
name|CAST64
argument_list|(
name|head
argument_list|)
argument_list|,
name|CAST64
argument_list|(
name|head
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"Multiple elements head=%llu(0x%llx) tail=%llu(0x%llx)\n"
argument_list|,
name|CAST64
argument_list|(
name|head
argument_list|)
argument_list|,
name|CAST64
argument_list|(
name|head
argument_list|)
argument_list|,
name|CAST64
argument_list|(
name|tail
argument_list|)
argument_list|,
name|CAST64
argument_list|(
name|tail
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"Empty\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * Mark which list a POW entry is on. Print a warning message if the  * entry is already on a list. This happens if the POW changed while  * the capture was running.  *  * @param entry_num  Entry number to mark  * @param entry_type List type  * @param entry_list Array to store marks  *  * @return Zero on success, negative if already on a list  */
end_comment

begin_function
specifier|static
name|int
name|__cvmx_pow_entry_mark_list
parameter_list|(
name|int
name|entry_num
parameter_list|,
name|__cvmx_pow_list_types_t
name|entry_type
parameter_list|,
name|uint8_t
name|entry_list
index|[]
parameter_list|)
block|{
if|if
condition|(
name|entry_list
index|[
name|entry_num
index|]
operator|==
literal|0
condition|)
block|{
name|entry_list
index|[
name|entry_num
index|]
operator|=
name|entry_type
expr_stmt|;
return|return
literal|0
return|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"\nWARNING: Entry %d already on list %s, but we tried to add it to %s\n"
argument_list|,
name|entry_num
argument_list|,
name|__cvmx_pow_list_names
index|[
name|entry_list
index|[
name|entry_num
index|]
index|]
argument_list|,
name|__cvmx_pow_list_names
index|[
name|entry_type
index|]
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
end_function

begin_comment
comment|/**  * Display a list and mark all elements on the list as belonging to  * the list.  *  * @param entry_type Type of the list to display and mark  * @param dump       POW capture data  * @param entry_list Array to store marks in  * @param valid      Set if the queue contains any elements  * @param has_one    Set if the queue contains exactly one element  * @param head       The head pointer  * @param tail       The tail pointer  */
end_comment

begin_function
specifier|static
name|void
name|__cvmx_pow_display_list_and_walk
parameter_list|(
name|__cvmx_pow_list_types_t
name|entry_type
parameter_list|,
name|__cvmx_pow_dump_t
modifier|*
name|dump
parameter_list|,
name|uint8_t
name|entry_list
index|[]
parameter_list|,
name|int
name|valid
parameter_list|,
name|int
name|has_one
parameter_list|,
name|uint64_t
name|head
parameter_list|,
name|uint64_t
name|tail
parameter_list|)
block|{
name|__cvmx_pow_display_list
argument_list|(
name|__cvmx_pow_list_names
index|[
name|entry_type
index|]
argument_list|,
literal|0
argument_list|,
name|valid
argument_list|,
name|has_one
argument_list|,
name|head
argument_list|,
name|tail
argument_list|)
expr_stmt|;
if|if
condition|(
name|valid
condition|)
block|{
if|if
condition|(
name|has_one
condition|)
name|__cvmx_pow_entry_mark_list
argument_list|(
name|head
argument_list|,
name|entry_type
argument_list|,
name|entry_list
argument_list|)
expr_stmt|;
else|else
block|{
while|while
condition|(
name|head
operator|!=
name|tail
condition|)
block|{
if|if
condition|(
name|__cvmx_pow_entry_mark_list
argument_list|(
name|head
argument_list|,
name|entry_type
argument_list|,
name|entry_list
argument_list|)
condition|)
break|break;
name|head
operator|=
name|dump
operator|->
name|smemload
index|[
name|head
index|]
index|[
literal|0
index|]
operator|.
name|s_smemload0
operator|.
name|next_index
expr_stmt|;
block|}
name|__cvmx_pow_entry_mark_list
argument_list|(
name|tail
argument_list|,
name|entry_type
argument_list|,
name|entry_list
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/**  * Dump a POW capture to the console in a human readable format.  *  * @param buffer POW capture from cvmx_pow_capture()  * @param buffer_size  *               Size of the buffer  */
end_comment

begin_function
name|void
name|cvmx_pow_display
parameter_list|(
name|void
modifier|*
name|buffer
parameter_list|,
name|int
name|buffer_size
parameter_list|)
block|{
name|__cvmx_pow_dump_t
modifier|*
name|dump
init|=
operator|(
name|__cvmx_pow_dump_t
operator|*
operator|)
name|buffer
decl_stmt|;
name|int
name|num_pow_entries
init|=
name|cvmx_pow_get_num_entries
argument_list|()
decl_stmt|;
name|int
name|num_cores
decl_stmt|;
name|int
name|core
decl_stmt|;
name|int
name|index
decl_stmt|;
name|uint8_t
name|entry_list
index|[
literal|2048
index|]
decl_stmt|;
if|if
condition|(
name|buffer_size
operator|<
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|__cvmx_pow_dump_t
argument_list|)
condition|)
block|{
name|cvmx_dprintf
argument_list|(
literal|"cvmx_pow_dump: Buffer too small\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|memset
argument_list|(
name|entry_list
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|entry_list
argument_list|)
argument_list|)
expr_stmt|;
name|num_cores
operator|=
name|cvmx_octeon_num_cores
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"POW Display Start\n"
argument_list|)
expr_stmt|;
comment|/* Print the free list info */
name|__cvmx_pow_display_list_and_walk
argument_list|(
name|CVMX_POW_LIST_FREE
argument_list|,
name|dump
argument_list|,
name|entry_list
argument_list|,
name|dump
operator|->
name|sindexload
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|.
name|sindexload0
operator|.
name|free_val
argument_list|,
name|dump
operator|->
name|sindexload
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|.
name|sindexload0
operator|.
name|free_one
argument_list|,
name|dump
operator|->
name|sindexload
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|.
name|sindexload0
operator|.
name|free_head
argument_list|,
name|dump
operator|->
name|sindexload
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|.
name|sindexload0
operator|.
name|free_tail
argument_list|)
expr_stmt|;
comment|/* Print the core state */
for|for
control|(
name|core
operator|=
literal|0
init|;
name|core
operator|<
name|num_cores
condition|;
name|core
operator|++
control|)
block|{
specifier|const
name|int
name|bit_rev
init|=
literal|1
decl_stmt|;
specifier|const
name|int
name|bit_cur
init|=
literal|2
decl_stmt|;
specifier|const
name|int
name|bit_wqp
init|=
literal|4
decl_stmt|;
name|printf
argument_list|(
literal|"Core %d State:  tag=%s,0x%08x"
argument_list|,
name|core
argument_list|,
name|OCT_TAG_TYPE_STRING
argument_list|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_cur
index|]
operator|.
name|s_sstatus2
operator|.
name|tag_type
argument_list|)
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_cur
index|]
operator|.
name|s_sstatus2
operator|.
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_cur
index|]
operator|.
name|s_sstatus2
operator|.
name|tag_type
operator|!=
name|CVMX_POW_TAG_TYPE_NULL_NULL
condition|)
block|{
name|__cvmx_pow_entry_mark_list
argument_list|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_cur
index|]
operator|.
name|s_sstatus2
operator|.
name|index
argument_list|,
name|CVMX_POW_LIST_CORE
operator|+
name|core
argument_list|,
name|entry_list
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" grp=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_cur
index|]
operator|.
name|s_sstatus2
operator|.
name|grp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" wqp=0x%016llx"
argument_list|,
name|CAST64
argument_list|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_cur
operator||
name|bit_wqp
index|]
operator|.
name|s_sstatus4
operator|.
name|wqp
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" index=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_cur
index|]
operator|.
name|s_sstatus2
operator|.
name|index
argument_list|)
expr_stmt|;
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_cur
index|]
operator|.
name|s_sstatus2
operator|.
name|head
condition|)
name|printf
argument_list|(
literal|" head"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" prev=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_cur
operator||
name|bit_rev
index|]
operator|.
name|s_sstatus3
operator|.
name|revlink_index
argument_list|)
expr_stmt|;
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_cur
index|]
operator|.
name|s_sstatus2
operator|.
name|tail
condition|)
name|printf
argument_list|(
literal|" tail"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" next=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_cur
index|]
operator|.
name|s_sstatus2
operator|.
name|link_index
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_switch
condition|)
block|{
name|printf
argument_list|(
literal|" pend_switch=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_switch
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" pend_switch_full=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_switch_full
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" pend_switch_null=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_switch_null
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_desched
condition|)
block|{
name|printf
argument_list|(
literal|" pend_desched=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_desched
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" pend_desched_switch=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_desched_switch
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" pend_nosched=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_nosched
argument_list|)
expr_stmt|;
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_desched_switch
condition|)
name|printf
argument_list|(
literal|" pend_grp=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_grp
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_new_work
condition|)
block|{
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_new_work_wait
condition|)
name|printf
argument_list|(
literal|" (Waiting for work)"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" (Getting work)"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_null_rd
condition|)
name|printf
argument_list|(
literal|" pend_null_rd=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_null_rd
argument_list|)
expr_stmt|;
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_nosched_clr
condition|)
block|{
name|printf
argument_list|(
literal|" pend_nosched_clr=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_nosched_clr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" pend_index=%d"
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_index
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_switch
operator|||
operator|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_desched
operator|&&
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_desched_switch
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|" pending tag=%s,0x%08x"
argument_list|,
name|OCT_TAG_TYPE_STRING
argument_list|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_type
argument_list|)
argument_list|,
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_tag
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
literal|0
index|]
operator|.
name|s_sstatus0
operator|.
name|pend_nosched_clr
condition|)
name|printf
argument_list|(
literal|" pend_wqp=0x%016llx\n"
argument_list|,
name|CAST64
argument_list|(
name|dump
operator|->
name|sstatus
index|[
name|core
index|]
index|[
name|bit_wqp
index|]
operator|.
name|s_sstatus1
operator|.
name|pend_wqp
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
comment|/* Print out the state of the nosched list and the 16 deschedule lists. */
name|__cvmx_pow_display_list_and_walk
argument_list|(
name|CVMX_POW_LIST_NOSCHED
argument_list|,
name|dump
argument_list|,
name|entry_list
argument_list|,
name|dump
operator|->
name|sindexload
index|[
literal|0
index|]
index|[
literal|2
index|]
operator|.
name|sindexload1
operator|.
name|nosched_val
argument_list|,
name|dump
operator|->
name|sindexload
index|[
literal|0
index|]
index|[
literal|2
index|]
operator|.
name|sindexload1
operator|.
name|nosched_one
argument_list|,
name|dump
operator|->
name|sindexload
index|[
literal|0
index|]
index|[
literal|2
index|]
operator|.
name|sindexload1
operator|.
name|nosched_head
argument_list|,
name|dump
operator|->
name|sindexload
index|[
literal|0
index|]
index|[
literal|2
index|]
operator|.
name|sindexload1
operator|.
name|nosched_tail
argument_list|)
expr_stmt|;
for|for
control|(
name|index
operator|=
literal|0
init|;
name|index
operator|<
literal|16
condition|;
name|index
operator|++
control|)
block|{
name|__cvmx_pow_display_list_and_walk
argument_list|(
name|CVMX_POW_LIST_DESCHED
operator|+
name|index
argument_list|,
name|dump
argument_list|,
name|entry_list
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|2
index|]
operator|.
name|sindexload1
operator|.
name|des_val
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|2
index|]
operator|.
name|sindexload1
operator|.
name|des_one
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|2
index|]
operator|.
name|sindexload1
operator|.
name|des_head
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|2
index|]
operator|.
name|sindexload1
operator|.
name|des_tail
argument_list|)
expr_stmt|;
block|}
comment|/* Print out the state of the 8 internal input queues */
for|for
control|(
name|index
operator|=
literal|0
init|;
name|index
operator|<
literal|8
condition|;
name|index
operator|++
control|)
block|{
name|__cvmx_pow_display_list_and_walk
argument_list|(
name|CVMX_POW_LIST_INPUT
operator|+
name|index
argument_list|,
name|dump
argument_list|,
name|entry_list
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|0
index|]
operator|.
name|sindexload0
operator|.
name|loc_val
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|0
index|]
operator|.
name|sindexload0
operator|.
name|loc_one
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|0
index|]
operator|.
name|sindexload0
operator|.
name|loc_head
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|0
index|]
operator|.
name|sindexload0
operator|.
name|loc_tail
argument_list|)
expr_stmt|;
block|}
comment|/* Print out the state of the 16 memory queues */
for|for
control|(
name|index
operator|=
literal|0
init|;
name|index
operator|<
literal|8
condition|;
name|index
operator|++
control|)
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
if|if
condition|(
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|1
index|]
operator|.
name|sindexload2
operator|.
name|rmt_is_head
condition|)
name|name
operator|=
literal|"Queue %da Memory (is head)"
expr_stmt|;
else|else
name|name
operator|=
literal|"Queue %da Memory"
expr_stmt|;
name|__cvmx_pow_display_list
argument_list|(
name|name
argument_list|,
name|index
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|1
index|]
operator|.
name|sindexload2
operator|.
name|rmt_val
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|1
index|]
operator|.
name|sindexload2
operator|.
name|rmt_one
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|1
index|]
operator|.
name|sindexload2
operator|.
name|rmt_head
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
index|]
index|[
literal|3
index|]
operator|.
name|sindexload3
operator|.
name|rmt_tail
argument_list|)
expr_stmt|;
if|if
condition|(
name|dump
operator|->
name|sindexload
index|[
name|index
operator|+
literal|8
index|]
index|[
literal|1
index|]
operator|.
name|sindexload2
operator|.
name|rmt_is_head
condition|)
name|name
operator|=
literal|"Queue %db Memory (is head)"
expr_stmt|;
else|else
name|name
operator|=
literal|"Queue %db Memory"
expr_stmt|;
name|__cvmx_pow_display_list
argument_list|(
name|name
argument_list|,
name|index
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
operator|+
literal|8
index|]
index|[
literal|1
index|]
operator|.
name|sindexload2
operator|.
name|rmt_val
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
operator|+
literal|8
index|]
index|[
literal|1
index|]
operator|.
name|sindexload2
operator|.
name|rmt_one
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
operator|+
literal|8
index|]
index|[
literal|1
index|]
operator|.
name|sindexload2
operator|.
name|rmt_head
argument_list|,
name|dump
operator|->
name|sindexload
index|[
name|index
operator|+
literal|8
index|]
index|[
literal|3
index|]
operator|.
name|sindexload3
operator|.
name|rmt_tail
argument_list|)
expr_stmt|;
block|}
comment|/* Print out each of the internal POW entries. Each entry has a tag, group,         wqe, and possibly a next pointer. The next pointer is only valid if this         entry isn't make as a tail */
for|for
control|(
name|index
operator|=
literal|0
init|;
name|index
operator|<
name|num_pow_entries
condition|;
name|index
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"Entry %d(%-10s): tag=%s,0x%08x grp=%d wqp=0x%016llx"
argument_list|,
name|index
argument_list|,
name|__cvmx_pow_list_names
index|[
name|entry_list
index|[
name|index
index|]
index|]
argument_list|,
name|OCT_TAG_TYPE_STRING
argument_list|(
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
literal|0
index|]
operator|.
name|s_smemload0
operator|.
name|tag_type
argument_list|)
argument_list|,
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
literal|0
index|]
operator|.
name|s_smemload0
operator|.
name|tag
argument_list|,
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
literal|0
index|]
operator|.
name|s_smemload0
operator|.
name|grp
argument_list|,
name|CAST64
argument_list|(
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
literal|2
index|]
operator|.
name|s_smemload1
operator|.
name|wqp
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
literal|0
index|]
operator|.
name|s_smemload0
operator|.
name|tail
condition|)
name|printf
argument_list|(
literal|" tail"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" next=%d"
argument_list|,
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
literal|0
index|]
operator|.
name|s_smemload0
operator|.
name|next_index
argument_list|)
expr_stmt|;
if|if
condition|(
name|entry_list
index|[
name|index
index|]
operator|>=
name|CVMX_POW_LIST_DESCHED
condition|)
block|{
name|printf
argument_list|(
literal|" prev=%d"
argument_list|,
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
literal|1
index|]
operator|.
name|s_smemload2
operator|.
name|fwd_index
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" nosched=%d"
argument_list|,
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
literal|1
index|]
operator|.
name|s_smemload2
operator|.
name|nosched
argument_list|)
expr_stmt|;
if|if
condition|(
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
literal|1
index|]
operator|.
name|s_smemload2
operator|.
name|pend_switch
condition|)
block|{
name|printf
argument_list|(
literal|" pending tag=%s,0x%08x"
argument_list|,
name|OCT_TAG_TYPE_STRING
argument_list|(
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
literal|1
index|]
operator|.
name|s_smemload2
operator|.
name|pend_type
argument_list|)
argument_list|,
name|dump
operator|->
name|smemload
index|[
name|index
index|]
index|[
literal|1
index|]
operator|.
name|s_smemload2
operator|.
name|pend_tag
argument_list|)
expr_stmt|;
block|}
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"POW Display End\n"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

