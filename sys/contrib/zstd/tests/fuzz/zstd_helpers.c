begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2016-present, Facebook, Inc.  * All rights reserved.  *  * This source code is licensed under both the BSD-style license (found in the  * LICENSE file in the root directory of this source tree) and the GPLv2 (found  * in the COPYING file in the root directory of this source tree).  */
end_comment

begin_define
define|#
directive|define
name|ZSTD_STATIC_LINKING_ONLY
end_define

begin_include
include|#
directive|include
file|"zstd_helpers.h"
end_include

begin_include
include|#
directive|include
file|"fuzz_helpers.h"
end_include

begin_include
include|#
directive|include
file|"zstd.h"
end_include

begin_function
specifier|static
name|void
name|set
parameter_list|(
name|ZSTD_CCtx
modifier|*
name|cctx
parameter_list|,
name|ZSTD_cParameter
name|param
parameter_list|,
name|unsigned
name|value
parameter_list|)
block|{
name|FUZZ_ZASSERT
argument_list|(
name|ZSTD_CCtx_setParameter
argument_list|(
name|cctx
argument_list|,
name|param
argument_list|,
name|value
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|setRand
parameter_list|(
name|ZSTD_CCtx
modifier|*
name|cctx
parameter_list|,
name|ZSTD_cParameter
name|param
parameter_list|,
name|unsigned
name|min
parameter_list|,
name|unsigned
name|max
parameter_list|,
name|uint32_t
modifier|*
name|state
parameter_list|)
block|{
name|unsigned
specifier|const
name|value
init|=
name|FUZZ_rand32
argument_list|(
name|state
argument_list|,
name|min
argument_list|,
name|max
argument_list|)
decl_stmt|;
name|set
argument_list|(
name|cctx
argument_list|,
name|param
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|ZSTD_compressionParameters
name|FUZZ_randomCParams
parameter_list|(
name|size_t
name|srcSize
parameter_list|,
name|uint32_t
modifier|*
name|state
parameter_list|)
block|{
comment|/* Select compression parameters */
name|ZSTD_compressionParameters
name|cParams
decl_stmt|;
name|cParams
operator|.
name|windowLog
operator|=
name|FUZZ_rand32
argument_list|(
name|state
argument_list|,
name|ZSTD_WINDOWLOG_MIN
argument_list|,
literal|15
argument_list|)
expr_stmt|;
name|cParams
operator|.
name|hashLog
operator|=
name|FUZZ_rand32
argument_list|(
name|state
argument_list|,
name|ZSTD_HASHLOG_MIN
argument_list|,
literal|15
argument_list|)
expr_stmt|;
name|cParams
operator|.
name|chainLog
operator|=
name|FUZZ_rand32
argument_list|(
name|state
argument_list|,
name|ZSTD_CHAINLOG_MIN
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|cParams
operator|.
name|searchLog
operator|=
name|FUZZ_rand32
argument_list|(
name|state
argument_list|,
name|ZSTD_SEARCHLOG_MIN
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|cParams
operator|.
name|searchLength
operator|=
name|FUZZ_rand32
argument_list|(
name|state
argument_list|,
name|ZSTD_SEARCHLENGTH_MIN
argument_list|,
name|ZSTD_SEARCHLENGTH_MAX
argument_list|)
expr_stmt|;
name|cParams
operator|.
name|targetLength
operator|=
name|FUZZ_rand32
argument_list|(
name|state
argument_list|,
name|ZSTD_TARGETLENGTH_MIN
argument_list|,
name|ZSTD_TARGETLENGTH_MAX
argument_list|)
expr_stmt|;
name|cParams
operator|.
name|strategy
operator|=
name|FUZZ_rand32
argument_list|(
name|state
argument_list|,
name|ZSTD_fast
argument_list|,
name|ZSTD_btultra
argument_list|)
expr_stmt|;
return|return
name|ZSTD_adjustCParams
argument_list|(
name|cParams
argument_list|,
name|srcSize
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
name|ZSTD_frameParameters
name|FUZZ_randomFParams
parameter_list|(
name|uint32_t
modifier|*
name|state
parameter_list|)
block|{
comment|/* Select frame parameters */
name|ZSTD_frameParameters
name|fParams
decl_stmt|;
name|fParams
operator|.
name|contentSizeFlag
operator|=
name|FUZZ_rand32
argument_list|(
name|state
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|fParams
operator|.
name|checksumFlag
operator|=
name|FUZZ_rand32
argument_list|(
name|state
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|fParams
operator|.
name|noDictIDFlag
operator|=
name|FUZZ_rand32
argument_list|(
name|state
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
return|return
name|fParams
return|;
block|}
end_function

begin_function
name|ZSTD_parameters
name|FUZZ_randomParams
parameter_list|(
name|size_t
name|srcSize
parameter_list|,
name|uint32_t
modifier|*
name|state
parameter_list|)
block|{
name|ZSTD_parameters
name|params
decl_stmt|;
name|params
operator|.
name|cParams
operator|=
name|FUZZ_randomCParams
argument_list|(
name|srcSize
argument_list|,
name|state
argument_list|)
expr_stmt|;
name|params
operator|.
name|fParams
operator|=
name|FUZZ_randomFParams
argument_list|(
name|state
argument_list|)
expr_stmt|;
return|return
name|params
return|;
block|}
end_function

begin_function
name|void
name|FUZZ_setRandomParameters
parameter_list|(
name|ZSTD_CCtx
modifier|*
name|cctx
parameter_list|,
name|size_t
name|srcSize
parameter_list|,
name|uint32_t
modifier|*
name|state
parameter_list|)
block|{
name|ZSTD_compressionParameters
name|cParams
init|=
name|FUZZ_randomCParams
argument_list|(
name|srcSize
argument_list|,
name|state
argument_list|)
decl_stmt|;
name|set
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_windowLog
argument_list|,
name|cParams
operator|.
name|windowLog
argument_list|)
expr_stmt|;
name|set
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_hashLog
argument_list|,
name|cParams
operator|.
name|hashLog
argument_list|)
expr_stmt|;
name|set
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_chainLog
argument_list|,
name|cParams
operator|.
name|chainLog
argument_list|)
expr_stmt|;
name|set
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_searchLog
argument_list|,
name|cParams
operator|.
name|searchLog
argument_list|)
expr_stmt|;
name|set
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_minMatch
argument_list|,
name|cParams
operator|.
name|searchLength
argument_list|)
expr_stmt|;
name|set
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_targetLength
argument_list|,
name|cParams
operator|.
name|targetLength
argument_list|)
expr_stmt|;
name|set
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_compressionStrategy
argument_list|,
name|cParams
operator|.
name|strategy
argument_list|)
expr_stmt|;
comment|/* Select frame parameters */
name|setRand
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_contentSizeFlag
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|state
argument_list|)
expr_stmt|;
name|setRand
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_checksumFlag
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|state
argument_list|)
expr_stmt|;
name|setRand
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_dictIDFlag
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|state
argument_list|)
expr_stmt|;
comment|/* Select long distance matchig parameters */
name|setRand
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_enableLongDistanceMatching
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|state
argument_list|)
expr_stmt|;
name|setRand
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_ldmHashLog
argument_list|,
name|ZSTD_HASHLOG_MIN
argument_list|,
literal|16
argument_list|,
name|state
argument_list|)
expr_stmt|;
name|setRand
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_ldmMinMatch
argument_list|,
name|ZSTD_LDM_MINMATCH_MIN
argument_list|,
name|ZSTD_LDM_MINMATCH_MAX
argument_list|,
name|state
argument_list|)
expr_stmt|;
name|setRand
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_ldmBucketSizeLog
argument_list|,
literal|0
argument_list|,
name|ZSTD_LDM_BUCKETSIZELOG_MAX
argument_list|,
name|state
argument_list|)
expr_stmt|;
name|setRand
argument_list|(
name|cctx
argument_list|,
name|ZSTD_p_ldmHashEveryLog
argument_list|,
literal|0
argument_list|,
name|ZSTD_WINDOWLOG_MAX
operator|-
name|ZSTD_HASHLOG_MIN
argument_list|,
name|state
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

