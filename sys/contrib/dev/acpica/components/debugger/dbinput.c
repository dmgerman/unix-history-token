begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*******************************************************************************  *  * Module Name: dbinput - user front-end to the AML debugger  *  ******************************************************************************/
end_comment

begin_comment
comment|/*  * Copyright (C) 2000 - 2014, Intel Corp.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions, and the following disclaimer,  *    without modification.  * 2. Redistributions in binary form must reproduce at minimum a disclaimer  *    substantially similar to the "NO WARRANTY" disclaimer below  *    ("Disclaimer") and any redistribution must be conditioned upon  *    including a substantially similar Disclaimer requirement for further  *    binary redistribution.  * 3. Neither the names of the above-listed copyright holders nor the names  *    of any contributors may be used to endorse or promote products derived  *    from this software without specific prior written permission.  *  * Alternatively, this software may be distributed under the terms of the  * GNU General Public License ("GPL") version 2 as published by the Free  * Software Foundation.  *  * NO WARRANTY  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR  * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT  * HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,  * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING  * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  * POSSIBILITY OF SUCH DAMAGES.  */
end_comment

begin_include
include|#
directive|include
file|<contrib/dev/acpica/include/acpi.h>
end_include

begin_include
include|#
directive|include
file|<contrib/dev/acpica/include/accommon.h>
end_include

begin_include
include|#
directive|include
file|<contrib/dev/acpica/include/acdebug.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|ACPI_DEBUGGER
end_ifdef

begin_define
define|#
directive|define
name|_COMPONENT
value|ACPI_CA_DEBUGGER
end_define

begin_macro
name|ACPI_MODULE_NAME
argument_list|(
literal|"dbinput"
argument_list|)
end_macro

begin_comment
comment|/* Local prototypes */
end_comment

begin_function_decl
specifier|static
name|UINT32
name|AcpiDbGetLine
parameter_list|(
name|char
modifier|*
name|InputBuffer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|UINT32
name|AcpiDbMatchCommand
parameter_list|(
name|char
modifier|*
name|UserCommand
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|AcpiDbSingleThread
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|AcpiDbDisplayCommandInfo
parameter_list|(
name|char
modifier|*
name|Command
parameter_list|,
name|BOOLEAN
name|DisplayAll
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|AcpiDbDisplayHelp
parameter_list|(
name|char
modifier|*
name|Command
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|BOOLEAN
name|AcpiDbMatchCommandHelp
parameter_list|(
name|char
modifier|*
name|Command
parameter_list|,
specifier|const
name|ACPI_DB_COMMAND_HELP
modifier|*
name|Help
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * Top-level debugger commands.  *  * This list of commands must match the string table below it  */
end_comment

begin_enum
enum|enum
name|AcpiExDebuggerCommands
block|{
name|CMD_NOT_FOUND
init|=
literal|0
block|,
name|CMD_NULL
block|,
name|CMD_ALLOCATIONS
block|,
name|CMD_ARGS
block|,
name|CMD_ARGUMENTS
block|,
name|CMD_BREAKPOINT
block|,
name|CMD_BUSINFO
block|,
name|CMD_CALL
block|,
name|CMD_CLOSE
block|,
name|CMD_DEBUG
block|,
name|CMD_DISASSEMBLE
block|,
name|CMD_DISASM
block|,
name|CMD_DUMP
block|,
name|CMD_ENABLEACPI
block|,
name|CMD_EVALUATE
block|,
name|CMD_EVENT
block|,
name|CMD_EXECUTE
block|,
name|CMD_EXIT
block|,
name|CMD_FIND
block|,
name|CMD_GO
block|,
name|CMD_GPE
block|,
name|CMD_GPES
block|,
name|CMD_HANDLERS
block|,
name|CMD_HELP
block|,
name|CMD_HELP2
block|,
name|CMD_HISTORY
block|,
name|CMD_HISTORY_EXE
block|,
name|CMD_HISTORY_LAST
block|,
name|CMD_INFORMATION
block|,
name|CMD_INTEGRITY
block|,
name|CMD_INTO
block|,
name|CMD_LEVEL
block|,
name|CMD_LIST
block|,
name|CMD_LOAD
block|,
name|CMD_LOCALS
block|,
name|CMD_LOCKS
block|,
name|CMD_METHODS
block|,
name|CMD_NAMESPACE
block|,
name|CMD_NOTIFY
block|,
name|CMD_OBJECTS
block|,
name|CMD_OPEN
block|,
name|CMD_OSI
block|,
name|CMD_OWNER
block|,
name|CMD_PATHS
block|,
name|CMD_PREDEFINED
block|,
name|CMD_PREFIX
block|,
name|CMD_QUIT
block|,
name|CMD_REFERENCES
block|,
name|CMD_RESOURCES
block|,
name|CMD_RESULTS
block|,
name|CMD_SCI
block|,
name|CMD_SET
block|,
name|CMD_SLEEP
block|,
name|CMD_STATS
block|,
name|CMD_STOP
block|,
name|CMD_TABLES
block|,
name|CMD_TEMPLATE
block|,
name|CMD_TERMINATE
block|,
name|CMD_TEST
block|,
name|CMD_THREADS
block|,
name|CMD_TRACE
block|,
name|CMD_TREE
block|,
name|CMD_TYPE
block|,
name|CMD_UNLOAD
block|}
enum|;
end_enum

begin_define
define|#
directive|define
name|CMD_FIRST_VALID
value|2
end_define

begin_comment
comment|/* Second parameter is the required argument count */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|ACPI_DB_COMMAND_INFO
name|AcpiGbl_DbCommands
index|[]
init|=
block|{
block|{
literal|"<NOT FOUND>"
block|,
literal|0
block|}
block|,
block|{
literal|"<NULL>"
block|,
literal|0
block|}
block|,
block|{
literal|"ALLOCATIONS"
block|,
literal|0
block|}
block|,
block|{
literal|"ARGS"
block|,
literal|0
block|}
block|,
block|{
literal|"ARGUMENTS"
block|,
literal|0
block|}
block|,
block|{
literal|"BREAKPOINT"
block|,
literal|1
block|}
block|,
block|{
literal|"BUSINFO"
block|,
literal|0
block|}
block|,
block|{
literal|"CALL"
block|,
literal|0
block|}
block|,
block|{
literal|"CLOSE"
block|,
literal|0
block|}
block|,
block|{
literal|"DEBUG"
block|,
literal|1
block|}
block|,
block|{
literal|"DISASSEMBLE"
block|,
literal|1
block|}
block|,
block|{
literal|"DISASM"
block|,
literal|1
block|}
block|,
block|{
literal|"DUMP"
block|,
literal|1
block|}
block|,
block|{
literal|"ENABLEACPI"
block|,
literal|0
block|}
block|,
block|{
literal|"EVALUATE"
block|,
literal|1
block|}
block|,
block|{
literal|"EVENT"
block|,
literal|1
block|}
block|,
block|{
literal|"EXECUTE"
block|,
literal|1
block|}
block|,
block|{
literal|"EXIT"
block|,
literal|0
block|}
block|,
block|{
literal|"FIND"
block|,
literal|1
block|}
block|,
block|{
literal|"GO"
block|,
literal|0
block|}
block|,
block|{
literal|"GPE"
block|,
literal|1
block|}
block|,
block|{
literal|"GPES"
block|,
literal|0
block|}
block|,
block|{
literal|"HANDLERS"
block|,
literal|0
block|}
block|,
block|{
literal|"HELP"
block|,
literal|0
block|}
block|,
block|{
literal|"?"
block|,
literal|0
block|}
block|,
block|{
literal|"HISTORY"
block|,
literal|0
block|}
block|,
block|{
literal|"!"
block|,
literal|1
block|}
block|,
block|{
literal|"!!"
block|,
literal|0
block|}
block|,
block|{
literal|"INFORMATION"
block|,
literal|0
block|}
block|,
block|{
literal|"INTEGRITY"
block|,
literal|0
block|}
block|,
block|{
literal|"INTO"
block|,
literal|0
block|}
block|,
block|{
literal|"LEVEL"
block|,
literal|0
block|}
block|,
block|{
literal|"LIST"
block|,
literal|0
block|}
block|,
block|{
literal|"LOAD"
block|,
literal|1
block|}
block|,
block|{
literal|"LOCALS"
block|,
literal|0
block|}
block|,
block|{
literal|"LOCKS"
block|,
literal|0
block|}
block|,
block|{
literal|"METHODS"
block|,
literal|0
block|}
block|,
block|{
literal|"NAMESPACE"
block|,
literal|0
block|}
block|,
block|{
literal|"NOTIFY"
block|,
literal|2
block|}
block|,
block|{
literal|"OBJECTS"
block|,
literal|1
block|}
block|,
block|{
literal|"OPEN"
block|,
literal|1
block|}
block|,
block|{
literal|"OSI"
block|,
literal|0
block|}
block|,
block|{
literal|"OWNER"
block|,
literal|1
block|}
block|,
block|{
literal|"PATHS"
block|,
literal|0
block|}
block|,
block|{
literal|"PREDEFINED"
block|,
literal|0
block|}
block|,
block|{
literal|"PREFIX"
block|,
literal|0
block|}
block|,
block|{
literal|"QUIT"
block|,
literal|0
block|}
block|,
block|{
literal|"REFERENCES"
block|,
literal|1
block|}
block|,
block|{
literal|"RESOURCES"
block|,
literal|0
block|}
block|,
block|{
literal|"RESULTS"
block|,
literal|0
block|}
block|,
block|{
literal|"SCI"
block|,
literal|0
block|}
block|,
block|{
literal|"SET"
block|,
literal|3
block|}
block|,
block|{
literal|"SLEEP"
block|,
literal|0
block|}
block|,
block|{
literal|"STATS"
block|,
literal|1
block|}
block|,
block|{
literal|"STOP"
block|,
literal|0
block|}
block|,
block|{
literal|"TABLES"
block|,
literal|0
block|}
block|,
block|{
literal|"TEMPLATE"
block|,
literal|1
block|}
block|,
block|{
literal|"TERMINATE"
block|,
literal|0
block|}
block|,
block|{
literal|"TEST"
block|,
literal|1
block|}
block|,
block|{
literal|"THREADS"
block|,
literal|3
block|}
block|,
block|{
literal|"TRACE"
block|,
literal|1
block|}
block|,
block|{
literal|"TREE"
block|,
literal|0
block|}
block|,
block|{
literal|"TYPE"
block|,
literal|1
block|}
block|,
block|{
literal|"UNLOAD"
block|,
literal|1
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Help for all debugger commands. First argument is the number of lines  * of help to output for the command.  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|ACPI_DB_COMMAND_HELP
name|AcpiGbl_DbCommandHelp
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"\nGeneral-Purpose Commands:"
block|,
literal|"\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Allocations"
block|,
literal|"Display list of current memory allocations\n"
block|}
block|,
block|{
literal|2
block|,
literal|"  Dump<Address>|<Namepath>"
block|,
literal|"\n"
block|}
block|,
block|{
literal|0
block|,
literal|"       [Byte|Word|Dword|Qword]"
block|,
literal|"Display ACPI objects or memory\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  EnableAcpi"
block|,
literal|"Enable ACPI (hardware) mode\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Handlers"
block|,
literal|"Info about global handlers\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Help [Command]"
block|,
literal|"This help screen or individual command\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  History"
block|,
literal|"Display command history buffer\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Level<DebugLevel>] [console]"
block|,
literal|"Get/Set debug level for file or console\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Locks"
block|,
literal|"Current status of internal mutexes\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Osi [Install|Remove<name>]"
block|,
literal|"Display or modify global _OSI list\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Quit or Exit"
block|,
literal|"Exit this command\n"
block|}
block|,
block|{
literal|8
block|,
literal|"  Stats<SubCommand>"
block|,
literal|"Display namespace and memory statistics\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     Allocations"
block|,
literal|"Display list of current memory allocations\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     Memory"
block|,
literal|"Dump internal memory lists\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     Misc"
block|,
literal|"Namespace search and mutex stats\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     Objects"
block|,
literal|"Summary of namespace objects\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     Sizes"
block|,
literal|"Sizes for each of the internal objects\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     Stack"
block|,
literal|"Display CPU stack usage\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     Tables"
block|,
literal|"Info about current ACPI table(s)\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Tables"
block|,
literal|"Display info about loaded ACPI tables\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Unload<Namepath>"
block|,
literal|"Unload an ACPI table via namespace object\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  !<CommandNumber>"
block|,
literal|"Execute command from history buffer\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  !!"
block|,
literal|"Execute last command again\n"
block|}
block|,
block|{
literal|0
block|,
literal|"\nNamespace Access Commands:"
block|,
literal|"\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Businfo"
block|,
literal|"Display system bus info\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Disassemble<Method>"
block|,
literal|"Disassemble a control method\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Find<AcpiName> (? is wildcard)"
block|,
literal|"Find ACPI name(s) with wildcards\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Integrity"
block|,
literal|"Validate namespace integrity\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Methods"
block|,
literal|"Display list of loaded control methods\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Namespace [Object] [Depth]"
block|,
literal|"Display loaded namespace tree/subtree\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Notify<Object><Value>"
block|,
literal|"Send a notification on Object\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Objects<ObjectType>"
block|,
literal|"Display all objects of the given type\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Owner<OwnerId> [Depth]"
block|,
literal|"Display loaded namespace by object owner\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Paths"
block|,
literal|"Display full pathnames of namespace objects\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Predefined"
block|,
literal|"Check all predefined names\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Prefix [<NamePath>]"
block|,
literal|"Set or Get current execution prefix\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  References<Addr>"
block|,
literal|"Find all references to object at addr\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Resources [DeviceName]"
block|,
literal|"Display Device resources (no arg = all devices)\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Set N<NamedObject><Value>"
block|,
literal|"Set value for named integer\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Template<Object>"
block|,
literal|"Format/dump a Buffer/ResourceTemplate\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Terminate"
block|,
literal|"Delete namespace and all internal objects\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Type<Object>"
block|,
literal|"Display object type\n"
block|}
block|,
block|{
literal|0
block|,
literal|"\nControl Method Execution Commands:"
block|,
literal|"\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Arguments (or Args)"
block|,
literal|"Display method arguments\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Breakpoint<AmlOffset>"
block|,
literal|"Set an AML execution breakpoint\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Call"
block|,
literal|"Run to next control method invocation\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Debug<Namepath> [Arguments]"
block|,
literal|"Single Step a control method\n"
block|}
block|,
block|{
literal|6
block|,
literal|"  Evaluate"
block|,
literal|"Synonym for Execute\n"
block|}
block|,
block|{
literal|5
block|,
literal|"  Execute<Namepath> [Arguments]"
block|,
literal|"Execute control method\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     Hex Integer"
block|,
literal|"Integer method argument\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     \"Ascii String\""
block|,
literal|"String method argument\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     (Hex Byte List)"
block|,
literal|"Buffer method argument\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     [Package Element List]"
block|,
literal|"Package method argument\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Go"
block|,
literal|"Allow method to run to completion\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Information"
block|,
literal|"Display info about the current method\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Into"
block|,
literal|"Step into (not over) a method call\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  List [# of Aml Opcodes]"
block|,
literal|"Display method ASL statements\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Locals"
block|,
literal|"Display method local variables\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Results"
block|,
literal|"Display method result stack\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Set<A|L><#><Value>"
block|,
literal|"Set method data (Arguments/Locals)\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Stop"
block|,
literal|"Terminate control method\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Thread<Threads><Loops><NamePath>"
block|,
literal|"Spawn threads to execute method(s)\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Trace<method name>"
block|,
literal|"Trace method execution\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Tree"
block|,
literal|"Display control method calling tree\n"
block|}
block|,
block|{
literal|1
block|,
literal|"<Enter>"
block|,
literal|"Single step next AML opcode (over calls)\n"
block|}
block|,
block|{
literal|0
block|,
literal|"\nHardware Related Commands:"
block|,
literal|"\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Event<F|G><Value>"
block|,
literal|"Generate AcpiEvent (Fixed/GPE)\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Gpe<GpeNum> [GpeBlockDevice]"
block|,
literal|"Simulate a GPE\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Gpes"
block|,
literal|"Display info on all GPEs\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Sci"
block|,
literal|"Generate an SCI\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Sleep [SleepState]"
block|,
literal|"Simulate sleep/wake sequence(s) (0-5)\n"
block|}
block|,
block|{
literal|0
block|,
literal|"\nFile I/O Commands:"
block|,
literal|"\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Close"
block|,
literal|"Close debug output file\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Load<Input Filename>"
block|,
literal|"Load ACPI table from a file\n"
block|}
block|,
block|{
literal|1
block|,
literal|"  Open<Output Filename>"
block|,
literal|"Open a file for debug output\n"
block|}
block|,
block|{
literal|0
block|,
literal|"\nDebug Test Commands:"
block|,
literal|"\n"
block|}
block|,
block|{
literal|3
block|,
literal|"  Test<TestName>"
block|,
literal|"Invoke a debug test\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     Objects"
block|,
literal|"Read/write/compare all namespace data objects\n"
block|}
block|,
block|{
literal|1
block|,
literal|"     Predefined"
block|,
literal|"Execute all ACPI predefined names (_STA, etc.)\n"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbMatchCommandHelp  *  * PARAMETERS:  Command             - Command string to match  *              Help                - Help table entry to attempt match  *  * RETURN:      TRUE if command matched, FALSE otherwise  *  * DESCRIPTION: Attempt to match a command in the help table in order to  *              print help information for a single command.  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|BOOLEAN
name|AcpiDbMatchCommandHelp
parameter_list|(
name|char
modifier|*
name|Command
parameter_list|,
specifier|const
name|ACPI_DB_COMMAND_HELP
modifier|*
name|Help
parameter_list|)
block|{
name|char
modifier|*
name|Invocation
init|=
name|Help
operator|->
name|Invocation
decl_stmt|;
name|UINT32
name|LineCount
decl_stmt|;
comment|/* Valid commands in the help table begin with a couple of spaces */
if|if
condition|(
operator|*
name|Invocation
operator|!=
literal|' '
condition|)
block|{
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
while|while
condition|(
operator|*
name|Invocation
operator|==
literal|' '
condition|)
block|{
name|Invocation
operator|++
expr_stmt|;
block|}
comment|/* Match command name (full command or substring) */
while|while
condition|(
operator|(
operator|*
name|Command
operator|)
operator|&&
operator|(
operator|*
name|Invocation
operator|)
operator|&&
operator|(
operator|*
name|Invocation
operator|!=
literal|' '
operator|)
condition|)
block|{
if|if
condition|(
name|ACPI_TOLOWER
argument_list|(
operator|*
name|Command
argument_list|)
operator|!=
name|ACPI_TOLOWER
argument_list|(
operator|*
name|Invocation
argument_list|)
condition|)
block|{
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
name|Invocation
operator|++
expr_stmt|;
name|Command
operator|++
expr_stmt|;
block|}
comment|/* Print the appropriate number of help lines */
name|LineCount
operator|=
name|Help
operator|->
name|LineCount
expr_stmt|;
while|while
condition|(
name|LineCount
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%-38s : %s"
argument_list|,
name|Help
operator|->
name|Invocation
argument_list|,
name|Help
operator|->
name|Description
argument_list|)
expr_stmt|;
name|Help
operator|++
expr_stmt|;
name|LineCount
operator|--
expr_stmt|;
block|}
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbDisplayCommandInfo  *  * PARAMETERS:  Command             - Command string to match  *              DisplayAll          - Display all matching commands, or just  *                                    the first one (substring match)  *  * RETURN:      None  *  * DESCRIPTION: Display help information for a Debugger command.  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|AcpiDbDisplayCommandInfo
parameter_list|(
name|char
modifier|*
name|Command
parameter_list|,
name|BOOLEAN
name|DisplayAll
parameter_list|)
block|{
specifier|const
name|ACPI_DB_COMMAND_HELP
modifier|*
name|Next
decl_stmt|;
name|BOOLEAN
name|Matched
decl_stmt|;
name|Next
operator|=
name|AcpiGbl_DbCommandHelp
expr_stmt|;
while|while
condition|(
name|Next
operator|->
name|Invocation
condition|)
block|{
name|Matched
operator|=
name|AcpiDbMatchCommandHelp
argument_list|(
name|Command
argument_list|,
name|Next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|DisplayAll
operator|&&
name|Matched
condition|)
block|{
return|return;
block|}
name|Next
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbDisplayHelp  *  * PARAMETERS:  Command             - Optional command string to display help.  *                                    if not specified, all debugger command  *                                    help strings are displayed  *  * RETURN:      None  *  * DESCRIPTION: Display help for a single debugger command, or all of them.  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|AcpiDbDisplayHelp
parameter_list|(
name|char
modifier|*
name|Command
parameter_list|)
block|{
specifier|const
name|ACPI_DB_COMMAND_HELP
modifier|*
name|Next
init|=
name|AcpiGbl_DbCommandHelp
decl_stmt|;
if|if
condition|(
operator|!
name|Command
condition|)
block|{
comment|/* No argument to help, display help for all commands */
while|while
condition|(
name|Next
operator|->
name|Invocation
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%-38s%s"
argument_list|,
name|Next
operator|->
name|Invocation
argument_list|,
name|Next
operator|->
name|Description
argument_list|)
expr_stmt|;
name|Next
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* Display help for all commands that match the subtring */
name|AcpiDbDisplayCommandInfo
argument_list|(
name|Command
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbGetNextToken  *  * PARAMETERS:  String          - Command buffer  *              Next            - Return value, end of next token  *  * RETURN:      Pointer to the start of the next token.  *  * DESCRIPTION: Command line parsing. Get the next token on the command line  *  ******************************************************************************/
end_comment

begin_function
name|char
modifier|*
name|AcpiDbGetNextToken
parameter_list|(
name|char
modifier|*
name|String
parameter_list|,
name|char
modifier|*
modifier|*
name|Next
parameter_list|,
name|ACPI_OBJECT_TYPE
modifier|*
name|ReturnType
parameter_list|)
block|{
name|char
modifier|*
name|Start
decl_stmt|;
name|UINT32
name|Depth
decl_stmt|;
name|ACPI_OBJECT_TYPE
name|Type
init|=
name|ACPI_TYPE_INTEGER
decl_stmt|;
comment|/* At end of buffer? */
if|if
condition|(
operator|!
name|String
operator|||
operator|!
operator|(
operator|*
name|String
operator|)
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/* Remove any spaces at the beginning */
if|if
condition|(
operator|*
name|String
operator|==
literal|' '
condition|)
block|{
while|while
condition|(
operator|*
name|String
operator|&&
operator|(
operator|*
name|String
operator|==
literal|' '
operator|)
condition|)
block|{
name|String
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
operator|*
name|String
operator|)
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
block|}
switch|switch
condition|(
operator|*
name|String
condition|)
block|{
case|case
literal|'"'
case|:
comment|/* This is a quoted string, scan until closing quote */
name|String
operator|++
expr_stmt|;
name|Start
operator|=
name|String
expr_stmt|;
name|Type
operator|=
name|ACPI_TYPE_STRING
expr_stmt|;
comment|/* Find end of string */
while|while
condition|(
operator|*
name|String
operator|&&
operator|(
operator|*
name|String
operator|!=
literal|'"'
operator|)
condition|)
block|{
name|String
operator|++
expr_stmt|;
block|}
break|break;
case|case
literal|'('
case|:
comment|/* This is the start of a buffer, scan until closing paren */
name|String
operator|++
expr_stmt|;
name|Start
operator|=
name|String
expr_stmt|;
name|Type
operator|=
name|ACPI_TYPE_BUFFER
expr_stmt|;
comment|/* Find end of buffer */
while|while
condition|(
operator|*
name|String
operator|&&
operator|(
operator|*
name|String
operator|!=
literal|')'
operator|)
condition|)
block|{
name|String
operator|++
expr_stmt|;
block|}
break|break;
case|case
literal|'['
case|:
comment|/* This is the start of a package, scan until closing bracket */
name|String
operator|++
expr_stmt|;
name|Depth
operator|=
literal|1
expr_stmt|;
name|Start
operator|=
name|String
expr_stmt|;
name|Type
operator|=
name|ACPI_TYPE_PACKAGE
expr_stmt|;
comment|/* Find end of package (closing bracket) */
while|while
condition|(
operator|*
name|String
condition|)
block|{
comment|/* Handle String package elements */
if|if
condition|(
operator|*
name|String
operator|==
literal|'"'
condition|)
block|{
comment|/* Find end of string */
name|String
operator|++
expr_stmt|;
while|while
condition|(
operator|*
name|String
operator|&&
operator|(
operator|*
name|String
operator|!=
literal|'"'
operator|)
condition|)
block|{
name|String
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
operator|*
name|String
operator|)
condition|)
block|{
break|break;
block|}
block|}
elseif|else
if|if
condition|(
operator|*
name|String
operator|==
literal|'['
condition|)
block|{
name|Depth
operator|++
expr_stmt|;
comment|/* A nested package declaration */
block|}
elseif|else
if|if
condition|(
operator|*
name|String
operator|==
literal|']'
condition|)
block|{
name|Depth
operator|--
expr_stmt|;
if|if
condition|(
name|Depth
operator|==
literal|0
condition|)
comment|/* Found final package closing bracket */
block|{
break|break;
block|}
block|}
name|String
operator|++
expr_stmt|;
block|}
break|break;
default|default:
name|Start
operator|=
name|String
expr_stmt|;
comment|/* Find end of token */
while|while
condition|(
operator|*
name|String
operator|&&
operator|(
operator|*
name|String
operator|!=
literal|' '
operator|)
condition|)
block|{
name|String
operator|++
expr_stmt|;
block|}
break|break;
block|}
if|if
condition|(
operator|!
operator|(
operator|*
name|String
operator|)
condition|)
block|{
operator|*
name|Next
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
operator|*
name|String
operator|=
literal|0
expr_stmt|;
operator|*
name|Next
operator|=
name|String
operator|+
literal|1
expr_stmt|;
block|}
operator|*
name|ReturnType
operator|=
name|Type
expr_stmt|;
return|return
operator|(
name|Start
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbGetLine  *  * PARAMETERS:  InputBuffer         - Command line buffer  *  * RETURN:      Count of arguments to the command  *  * DESCRIPTION: Get the next command line from the user. Gets entire line  *              up to the next newline  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|UINT32
name|AcpiDbGetLine
parameter_list|(
name|char
modifier|*
name|InputBuffer
parameter_list|)
block|{
name|UINT32
name|i
decl_stmt|;
name|UINT32
name|Count
decl_stmt|;
name|char
modifier|*
name|Next
decl_stmt|;
name|char
modifier|*
name|This
decl_stmt|;
if|if
condition|(
name|AcpiUtSafeStrcpy
argument_list|(
name|AcpiGbl_DbParsedBuf
argument_list|,
sizeof|sizeof
argument_list|(
name|AcpiGbl_DbParsedBuf
argument_list|)
argument_list|,
name|InputBuffer
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Buffer overflow while parsing input line (max %u characters)\n"
argument_list|,
sizeof|sizeof
argument_list|(
name|AcpiGbl_DbParsedBuf
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|This
operator|=
name|AcpiGbl_DbParsedBuf
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ACPI_DEBUGGER_MAX_ARGS
condition|;
name|i
operator|++
control|)
block|{
name|AcpiGbl_DbArgs
index|[
name|i
index|]
operator|=
name|AcpiDbGetNextToken
argument_list|(
name|This
argument_list|,
operator|&
name|Next
argument_list|,
operator|&
name|AcpiGbl_DbArgTypes
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|AcpiGbl_DbArgs
index|[
name|i
index|]
condition|)
block|{
break|break;
block|}
name|This
operator|=
name|Next
expr_stmt|;
block|}
comment|/* Uppercase the actual command */
if|if
condition|(
name|AcpiGbl_DbArgs
index|[
literal|0
index|]
condition|)
block|{
name|AcpiUtStrupr
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
name|Count
operator|=
name|i
expr_stmt|;
if|if
condition|(
name|Count
condition|)
block|{
name|Count
operator|--
expr_stmt|;
comment|/* Number of args only */
block|}
return|return
operator|(
name|Count
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbMatchCommand  *  * PARAMETERS:  UserCommand             - User command line  *  * RETURN:      Index into command array, -1 if not found  *  * DESCRIPTION: Search command array for a command match  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|UINT32
name|AcpiDbMatchCommand
parameter_list|(
name|char
modifier|*
name|UserCommand
parameter_list|)
block|{
name|UINT32
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|UserCommand
operator|||
name|UserCommand
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|CMD_NULL
operator|)
return|;
block|}
for|for
control|(
name|i
operator|=
name|CMD_FIRST_VALID
init|;
name|AcpiGbl_DbCommands
index|[
name|i
index|]
operator|.
name|Name
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ACPI_STRSTR
argument_list|(
name|AcpiGbl_DbCommands
index|[
name|i
index|]
operator|.
name|Name
argument_list|,
name|UserCommand
argument_list|)
operator|==
name|AcpiGbl_DbCommands
index|[
name|i
index|]
operator|.
name|Name
condition|)
block|{
return|return
operator|(
name|i
operator|)
return|;
block|}
block|}
comment|/* Command not recognized */
return|return
operator|(
name|CMD_NOT_FOUND
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbCommandDispatch  *  * PARAMETERS:  InputBuffer         - Command line buffer  *              WalkState           - Current walk  *              Op                  - Current (executing) parse op  *  * RETURN:      Status  *  * DESCRIPTION: Command dispatcher.  *  ******************************************************************************/
end_comment

begin_function
name|ACPI_STATUS
name|AcpiDbCommandDispatch
parameter_list|(
name|char
modifier|*
name|InputBuffer
parameter_list|,
name|ACPI_WALK_STATE
modifier|*
name|WalkState
parameter_list|,
name|ACPI_PARSE_OBJECT
modifier|*
name|Op
parameter_list|)
block|{
name|UINT32
name|Temp
decl_stmt|;
name|UINT32
name|CommandIndex
decl_stmt|;
name|UINT32
name|ParamCount
decl_stmt|;
name|char
modifier|*
name|CommandLine
decl_stmt|;
name|ACPI_STATUS
name|Status
init|=
name|AE_CTRL_TRUE
decl_stmt|;
comment|/* If AcpiTerminate has been called, terminate this thread */
if|if
condition|(
name|AcpiGbl_DbTerminateThreads
condition|)
block|{
return|return
operator|(
name|AE_CTRL_TERMINATE
operator|)
return|;
block|}
comment|/* Add all commands that come here to the history buffer */
name|AcpiDbAddToHistory
argument_list|(
name|InputBuffer
argument_list|)
expr_stmt|;
name|ParamCount
operator|=
name|AcpiDbGetLine
argument_list|(
name|InputBuffer
argument_list|)
expr_stmt|;
name|CommandIndex
operator|=
name|AcpiDbMatchCommand
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|Temp
operator|=
literal|0
expr_stmt|;
comment|/* Verify that we have the minimum number of params */
if|if
condition|(
name|ParamCount
operator|<
name|AcpiGbl_DbCommands
index|[
name|CommandIndex
index|]
operator|.
name|MinArgs
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%u parameters entered, [%s] requires %u parameters\n"
argument_list|,
name|ParamCount
argument_list|,
name|AcpiGbl_DbCommands
index|[
name|CommandIndex
index|]
operator|.
name|Name
argument_list|,
name|AcpiGbl_DbCommands
index|[
name|CommandIndex
index|]
operator|.
name|MinArgs
argument_list|)
expr_stmt|;
name|AcpiDbDisplayCommandInfo
argument_list|(
name|AcpiGbl_DbCommands
index|[
name|CommandIndex
index|]
operator|.
name|Name
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
operator|(
name|AE_CTRL_TRUE
operator|)
return|;
block|}
comment|/* Decode and dispatch the command */
switch|switch
condition|(
name|CommandIndex
condition|)
block|{
case|case
name|CMD_NULL
case|:
if|if
condition|(
name|Op
condition|)
block|{
return|return
operator|(
name|AE_OK
operator|)
return|;
block|}
break|break;
case|case
name|CMD_ALLOCATIONS
case|:
ifdef|#
directive|ifdef
name|ACPI_DBG_TRACK_ALLOCATIONS
name|AcpiUtDumpAllocations
argument_list|(
operator|(
name|UINT32
operator|)
operator|-
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
endif|#
directive|endif
break|break;
case|case
name|CMD_ARGS
case|:
case|case
name|CMD_ARGUMENTS
case|:
name|AcpiDbDisplayArguments
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_BREAKPOINT
case|:
name|AcpiDbSetMethodBreakpoint
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|WalkState
argument_list|,
name|Op
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_BUSINFO
case|:
name|AcpiDbGetBusInfo
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_CALL
case|:
name|AcpiDbSetMethodCallBreakpoint
argument_list|(
name|Op
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AE_OK
expr_stmt|;
break|break;
case|case
name|CMD_CLOSE
case|:
name|AcpiDbCloseDebugFile
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_DEBUG
case|:
name|AcpiDbExecute
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
operator|&
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|,
operator|&
name|AcpiGbl_DbArgTypes
index|[
literal|2
index|]
argument_list|,
name|EX_SINGLE_STEP
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_DISASSEMBLE
case|:
case|case
name|CMD_DISASM
case|:
operator|(
name|void
operator|)
name|AcpiDbDisassembleMethod
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_DUMP
case|:
name|AcpiDbDecodeAndDisplayObject
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_ENABLEACPI
case|:
if|#
directive|if
operator|(
operator|!
name|ACPI_REDUCED_HARDWARE
operator|)
name|Status
operator|=
name|AcpiEnable
argument_list|()
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"AcpiEnable failed (Status=%X)\n"
argument_list|,
name|Status
argument_list|)
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
block|}
endif|#
directive|endif
comment|/* !ACPI_REDUCED_HARDWARE */
break|break;
case|case
name|CMD_EVENT
case|:
name|AcpiOsPrintf
argument_list|(
literal|"Event command not implemented\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_EVALUATE
case|:
case|case
name|CMD_EXECUTE
case|:
name|AcpiDbExecute
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
operator|&
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|,
operator|&
name|AcpiGbl_DbArgTypes
index|[
literal|2
index|]
argument_list|,
name|EX_NO_SINGLE_STEP
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_FIND
case|:
name|Status
operator|=
name|AcpiDbFindNameInNamespace
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_GO
case|:
name|AcpiGbl_CmSingleStep
operator|=
name|FALSE
expr_stmt|;
return|return
operator|(
name|AE_OK
operator|)
return|;
case|case
name|CMD_GPE
case|:
name|AcpiDbGenerateGpe
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_GPES
case|:
name|AcpiDbDisplayGpes
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_HANDLERS
case|:
name|AcpiDbDisplayHandlers
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_HELP
case|:
case|case
name|CMD_HELP2
case|:
name|AcpiDbDisplayHelp
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_HISTORY
case|:
name|AcpiDbDisplayHistory
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_HISTORY_EXE
case|:
comment|/* ! command */
name|CommandLine
operator|=
name|AcpiDbGetFromHistory
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|CommandLine
condition|)
block|{
return|return
operator|(
name|AE_CTRL_TRUE
operator|)
return|;
block|}
name|Status
operator|=
name|AcpiDbCommandDispatch
argument_list|(
name|CommandLine
argument_list|,
name|WalkState
argument_list|,
name|Op
argument_list|)
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
case|case
name|CMD_HISTORY_LAST
case|:
comment|/* !! command */
name|CommandLine
operator|=
name|AcpiDbGetFromHistory
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|CommandLine
condition|)
block|{
return|return
operator|(
name|AE_CTRL_TRUE
operator|)
return|;
block|}
name|Status
operator|=
name|AcpiDbCommandDispatch
argument_list|(
name|CommandLine
argument_list|,
name|WalkState
argument_list|,
name|Op
argument_list|)
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
case|case
name|CMD_INFORMATION
case|:
name|AcpiDbDisplayMethodInfo
argument_list|(
name|Op
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_INTEGRITY
case|:
name|AcpiDbCheckIntegrity
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_INTO
case|:
if|if
condition|(
name|Op
condition|)
block|{
name|AcpiGbl_CmSingleStep
operator|=
name|TRUE
expr_stmt|;
return|return
operator|(
name|AE_OK
operator|)
return|;
block|}
break|break;
case|case
name|CMD_LEVEL
case|:
if|if
condition|(
name|ParamCount
operator|==
literal|0
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Current debug level for file output is:    %8.8lX\n"
argument_list|,
name|AcpiGbl_DbDebugLevel
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Current debug level for console output is: %8.8lX\n"
argument_list|,
name|AcpiGbl_DbConsoleDebugLevel
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ParamCount
operator|==
literal|2
condition|)
block|{
name|Temp
operator|=
name|AcpiGbl_DbConsoleDebugLevel
expr_stmt|;
name|AcpiGbl_DbConsoleDebugLevel
operator|=
name|ACPI_STRTOUL
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|NULL
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Debug Level for console output was %8.8lX, now %8.8lX\n"
argument_list|,
name|Temp
argument_list|,
name|AcpiGbl_DbConsoleDebugLevel
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|Temp
operator|=
name|AcpiGbl_DbDebugLevel
expr_stmt|;
name|AcpiGbl_DbDebugLevel
operator|=
name|ACPI_STRTOUL
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|NULL
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Debug Level for file output was %8.8lX, now %8.8lX\n"
argument_list|,
name|Temp
argument_list|,
name|AcpiGbl_DbDebugLevel
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|CMD_LIST
case|:
name|AcpiDbDisassembleAml
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|Op
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_LOAD
case|:
name|Status
operator|=
name|AcpiDbGetTableFromFile
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_LOCKS
case|:
name|AcpiDbDisplayLocks
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_LOCALS
case|:
name|AcpiDbDisplayLocals
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_METHODS
case|:
name|Status
operator|=
name|AcpiDbDisplayObjects
argument_list|(
literal|"METHOD"
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_NAMESPACE
case|:
name|AcpiDbDumpNamespace
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_NOTIFY
case|:
name|Temp
operator|=
name|ACPI_STRTOUL
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AcpiDbSendNotify
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|Temp
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_OBJECTS
case|:
name|AcpiUtStrupr
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDbDisplayObjects
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_OPEN
case|:
name|AcpiDbOpenDebugFile
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_OSI
case|:
name|AcpiDbDisplayInterfaces
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_OWNER
case|:
name|AcpiDbDumpNamespaceByOwner
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_PATHS
case|:
name|AcpiDbDumpNamespacePaths
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_PREDEFINED
case|:
name|AcpiDbCheckPredefinedNames
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_PREFIX
case|:
name|AcpiDbSetScope
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_REFERENCES
case|:
name|AcpiDbFindReferences
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_RESOURCES
case|:
name|AcpiDbDisplayResources
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_RESULTS
case|:
name|AcpiDbDisplayResults
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_SCI
case|:
name|AcpiDbGenerateSci
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_SET
case|:
name|AcpiDbSetMethodData
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_SLEEP
case|:
name|Status
operator|=
name|AcpiDbSleep
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_STATS
case|:
name|Status
operator|=
name|AcpiDbDisplayStatistics
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_STOP
case|:
return|return
operator|(
name|AE_NOT_IMPLEMENTED
operator|)
return|;
case|case
name|CMD_TABLES
case|:
name|AcpiDbDisplayTableInfo
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_TEMPLATE
case|:
name|AcpiDbDisplayTemplate
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_TERMINATE
case|:
name|AcpiDbSetOutputDestination
argument_list|(
name|ACPI_DB_REDIRECTABLE_OUTPUT
argument_list|)
expr_stmt|;
name|AcpiUtSubsystemShutdown
argument_list|()
expr_stmt|;
comment|/*          * TBD: [Restructure] Need some way to re-initialize without          * re-creating the semaphores!          */
comment|/*  AcpiInitialize (NULL);  */
break|break;
case|case
name|CMD_TEST
case|:
name|AcpiDbExecuteTest
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_THREADS
case|:
name|AcpiDbCreateExecutionThreads
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_TRACE
case|:
operator|(
name|void
operator|)
name|AcpiDebugTrace
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_TREE
case|:
name|AcpiDbDisplayCallingTree
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_TYPE
case|:
name|AcpiDbDisplayObjectType
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_UNLOAD
case|:
name|AcpiDbUnloadAcpiTable
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_EXIT
case|:
case|case
name|CMD_QUIT
case|:
if|if
condition|(
name|Op
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Method execution terminated\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|AE_CTRL_TERMINATE
operator|)
return|;
block|}
if|if
condition|(
operator|!
name|AcpiGbl_DbOutputToFile
condition|)
block|{
name|AcpiDbgLevel
operator|=
name|ACPI_DEBUG_DEFAULT
expr_stmt|;
block|}
name|AcpiDbCloseDebugFile
argument_list|()
expr_stmt|;
name|AcpiGbl_DbTerminateThreads
operator|=
name|TRUE
expr_stmt|;
return|return
operator|(
name|AE_CTRL_TERMINATE
operator|)
return|;
case|case
name|CMD_NOT_FOUND
case|:
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"%s: unknown command\n"
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
name|AE_CTRL_TRUE
operator|)
return|;
block|}
if|if
condition|(
name|ACPI_SUCCESS
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|Status
operator|=
name|AE_CTRL_TRUE
expr_stmt|;
block|}
return|return
operator|(
name|Status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbExecuteThread  *  * PARAMETERS:  Context         - Not used  *  * RETURN:      None  *  * DESCRIPTION: Debugger execute thread. Waits for a command line, then  *              simply dispatches it.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|ACPI_SYSTEM_XFACE
name|AcpiDbExecuteThread
parameter_list|(
name|void
modifier|*
name|Context
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
init|=
name|AE_OK
decl_stmt|;
name|ACPI_STATUS
name|MStatus
decl_stmt|;
while|while
condition|(
name|Status
operator|!=
name|AE_CTRL_TERMINATE
condition|)
block|{
name|AcpiGbl_MethodExecuting
operator|=
name|FALSE
expr_stmt|;
name|AcpiGbl_StepToNextCall
operator|=
name|FALSE
expr_stmt|;
name|MStatus
operator|=
name|AcpiUtAcquireMutex
argument_list|(
name|ACPI_MTX_DEBUG_CMD_READY
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|MStatus
argument_list|)
condition|)
block|{
return|return;
block|}
name|Status
operator|=
name|AcpiDbCommandDispatch
argument_list|(
name|AcpiGbl_DbLineBuf
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|MStatus
operator|=
name|AcpiUtReleaseMutex
argument_list|(
name|ACPI_MTX_DEBUG_CMD_COMPLETE
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|MStatus
argument_list|)
condition|)
block|{
return|return;
block|}
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbSingleThread  *  * PARAMETERS:  None  *  * RETURN:      None  *  * DESCRIPTION: Debugger execute thread. Waits for a command line, then  *              simply dispatches it.  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|AcpiDbSingleThread
parameter_list|(
name|void
parameter_list|)
block|{
name|AcpiGbl_MethodExecuting
operator|=
name|FALSE
expr_stmt|;
name|AcpiGbl_StepToNextCall
operator|=
name|FALSE
expr_stmt|;
operator|(
name|void
operator|)
name|AcpiDbCommandDispatch
argument_list|(
name|AcpiGbl_DbLineBuf
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbUserCommands  *  * PARAMETERS:  Prompt              - User prompt (depends on mode)  *              Op                  - Current executing parse op  *  * RETURN:      None  *  * DESCRIPTION: Command line execution for the AML debugger. Commands are  *              matched and dispatched here.  *  ******************************************************************************/
end_comment

begin_function
name|ACPI_STATUS
name|AcpiDbUserCommands
parameter_list|(
name|char
name|Prompt
parameter_list|,
name|ACPI_PARSE_OBJECT
modifier|*
name|Op
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
init|=
name|AE_OK
decl_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* TBD: [Restructure] Need a separate command line buffer for step mode */
while|while
condition|(
operator|!
name|AcpiGbl_DbTerminateThreads
condition|)
block|{
comment|/* Force output to console until a command is entered */
name|AcpiDbSetOutputDestination
argument_list|(
name|ACPI_DB_CONSOLE_OUTPUT
argument_list|)
expr_stmt|;
comment|/* Different prompt if method is executing */
if|if
condition|(
operator|!
name|AcpiGbl_MethodExecuting
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%1c "
argument_list|,
name|ACPI_DEBUGGER_COMMAND_PROMPT
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%1c "
argument_list|,
name|ACPI_DEBUGGER_EXECUTE_PROMPT
argument_list|)
expr_stmt|;
block|}
comment|/* Get the user input line */
name|Status
operator|=
name|AcpiOsGetLine
argument_list|(
name|AcpiGbl_DbLineBuf
argument_list|,
name|ACPI_DB_LINE_BUFFER_SIZE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|ACPI_EXCEPTION
argument_list|(
operator|(
name|AE_INFO
operator|,
name|Status
operator|,
literal|"While parsing command line"
operator|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
block|}
comment|/* Check for single or multithreaded debug */
if|if
condition|(
name|AcpiGbl_DebuggerConfiguration
operator|&
name|DEBUGGER_MULTI_THREADED
condition|)
block|{
comment|/*              * Signal the debug thread that we have a command to execute,              * and wait for the command to complete.              */
name|Status
operator|=
name|AcpiUtReleaseMutex
argument_list|(
name|ACPI_MTX_DEBUG_CMD_READY
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return
operator|(
name|Status
operator|)
return|;
block|}
name|Status
operator|=
name|AcpiUtAcquireMutex
argument_list|(
name|ACPI_MTX_DEBUG_CMD_COMPLETE
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return
operator|(
name|Status
operator|)
return|;
block|}
block|}
else|else
block|{
comment|/* Just call to the command line interpreter */
name|AcpiDbSingleThread
argument_list|()
expr_stmt|;
block|}
block|}
comment|/*      * Only this thread (the original thread) should actually terminate the      * subsystem, because all the semaphores are deleted during termination      */
name|Status
operator|=
name|AcpiTerminate
argument_list|()
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ACPI_DEBUGGER */
end_comment

end_unit

