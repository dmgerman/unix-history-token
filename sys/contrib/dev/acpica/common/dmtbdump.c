begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************************************************  *  * Module Name: dmtbdump - Dump ACPI data tables that contain no AML code  *  *****************************************************************************/
end_comment

begin_comment
comment|/*  * Copyright (C) 2000 - 2015, Intel Corp.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions, and the following disclaimer,  *    without modification.  * 2. Redistributions in binary form must reproduce at minimum a disclaimer  *    substantially similar to the "NO WARRANTY" disclaimer below  *    ("Disclaimer") and any redistribution must be conditioned upon  *    including a substantially similar Disclaimer requirement for further  *    binary redistribution.  * 3. Neither the names of the above-listed copyright holders nor the names  *    of any contributors may be used to endorse or promote products derived  *    from this software without specific prior written permission.  *  * Alternatively, this software may be distributed under the terms of the  * GNU General Public License ("GPL") version 2 as published by the Free  * Software Foundation.  *  * NO WARRANTY  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR  * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT  * HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,  * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING  * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  * POSSIBILITY OF SUCH DAMAGES.  */
end_comment

begin_include
include|#
directive|include
file|<contrib/dev/acpica/include/acpi.h>
end_include

begin_include
include|#
directive|include
file|<contrib/dev/acpica/include/accommon.h>
end_include

begin_include
include|#
directive|include
file|<contrib/dev/acpica/include/acdisasm.h>
end_include

begin_include
include|#
directive|include
file|<contrib/dev/acpica/include/actables.h>
end_include

begin_comment
comment|/* This module used for application-level code only */
end_comment

begin_define
define|#
directive|define
name|_COMPONENT
value|ACPI_CA_DISASSEMBLER
end_define

begin_macro
name|ACPI_MODULE_NAME
argument_list|(
literal|"dmtbdump"
argument_list|)
end_macro

begin_comment
comment|/* Local prototypes */
end_comment

begin_function_decl
specifier|static
name|void
name|AcpiDmValidateFadtLength
parameter_list|(
name|UINT32
name|Revision
parameter_list|,
name|UINT32
name|Length
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpBuffer  *  * PARAMETERS:  Table               - ACPI Table or subtable  *              BufferOffset        - Offset of buffer from Table above  *              Length              - Length of the buffer  *              AbsoluteOffset      - Offset of buffer in the main ACPI table  *              Header              - Name of the buffer field (printed on the  *                                    first line only.)  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of an arbitrary length data buffer (in the  *              disassembler output format.)  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpBuffer
parameter_list|(
name|void
modifier|*
name|Table
parameter_list|,
name|UINT32
name|BufferOffset
parameter_list|,
name|UINT32
name|Length
parameter_list|,
name|UINT32
name|AbsoluteOffset
parameter_list|,
name|char
modifier|*
name|Header
parameter_list|)
block|{
name|UINT8
modifier|*
name|Buffer
decl_stmt|;
name|UINT32
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|Length
condition|)
block|{
return|return;
block|}
name|Buffer
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|UINT8
argument_list|,
name|Table
argument_list|)
operator|+
name|BufferOffset
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|i
operator|<
name|Length
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|i
operator|%
literal|16
operator|)
condition|)
block|{
comment|/* Insert a backslash - line continuation character */
if|if
condition|(
name|Length
operator|>
literal|16
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\\\n    "
argument_list|)
expr_stmt|;
block|}
block|}
name|AcpiOsPrintf
argument_list|(
literal|"%.02X "
argument_list|,
operator|*
name|Buffer
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
name|Buffer
operator|++
expr_stmt|;
name|AbsoluteOffset
operator|++
expr_stmt|;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpUnicode  *  * PARAMETERS:  Table               - ACPI Table or subtable  *              BufferOffset        - Offset of buffer from Table above  *              ByteLength          - Length of the buffer  *  * RETURN:      None  *  * DESCRIPTION: Validate and dump the contents of a buffer that contains  *              unicode data. The output is a standard ASCII string. If it  *              appears that the data is not unicode, the buffer is dumped  *              as hex characters.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpUnicode
parameter_list|(
name|void
modifier|*
name|Table
parameter_list|,
name|UINT32
name|BufferOffset
parameter_list|,
name|UINT32
name|ByteLength
parameter_list|)
block|{
name|UINT8
modifier|*
name|Buffer
decl_stmt|;
name|UINT32
name|Length
decl_stmt|;
name|UINT32
name|i
decl_stmt|;
name|Buffer
operator|=
operator|(
operator|(
name|UINT8
operator|*
operator|)
name|Table
operator|)
operator|+
name|BufferOffset
expr_stmt|;
name|Length
operator|=
name|ByteLength
operator|-
literal|2
expr_stmt|;
comment|/* Last two bytes are the null terminator */
comment|/* Ensure all low bytes are entirely printable ASCII */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Length
condition|;
name|i
operator|+=
literal|2
control|)
block|{
if|if
condition|(
operator|!
name|isprint
argument_list|(
name|Buffer
index|[
name|i
index|]
argument_list|)
condition|)
block|{
goto|goto
name|DumpRawBuffer
goto|;
block|}
block|}
comment|/* Ensure all high bytes are zero */
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|Length
condition|;
name|i
operator|+=
literal|2
control|)
block|{
if|if
condition|(
name|Buffer
index|[
name|i
index|]
condition|)
block|{
goto|goto
name|DumpRawBuffer
goto|;
block|}
block|}
comment|/* Dump the buffer as a normal string */
name|AcpiOsPrintf
argument_list|(
literal|"\""
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Length
condition|;
name|i
operator|+=
literal|2
control|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%c"
argument_list|,
name|Buffer
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\"\n"
argument_list|)
expr_stmt|;
return|return;
name|DumpRawBuffer
label|:
name|AcpiDmDumpBuffer
argument_list|(
name|Table
argument_list|,
name|BufferOffset
argument_list|,
name|ByteLength
argument_list|,
name|BufferOffset
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpRsdp  *  * PARAMETERS:  Table               - A RSDP  *  * RETURN:      Length of the table (there is not always a length field,  *              use revision or length if available (ACPI 2.0+))  *  * DESCRIPTION: Format the contents of a RSDP  *  ******************************************************************************/
end_comment

begin_function
name|UINT32
name|AcpiDmDumpRsdp
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_TABLE_RSDP
modifier|*
name|Rsdp
init|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_TABLE_RSDP
argument_list|,
name|Table
argument_list|)
decl_stmt|;
name|UINT32
name|Length
init|=
sizeof|sizeof
argument_list|(
name|ACPI_RSDP_COMMON
argument_list|)
decl_stmt|;
name|UINT8
name|Checksum
decl_stmt|;
comment|/* Dump the common ACPI 1.0 portion */
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoRsdp1
argument_list|)
expr_stmt|;
comment|/* Validate the first checksum */
name|Checksum
operator|=
name|AcpiDmGenerateChecksum
argument_list|(
name|Rsdp
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_RSDP_COMMON
argument_list|)
argument_list|,
name|Rsdp
operator|->
name|Checksum
argument_list|)
expr_stmt|;
if|if
condition|(
name|Checksum
operator|!=
name|Rsdp
operator|->
name|Checksum
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"/* Incorrect Checksum above, should be 0x%2.2X */\n"
argument_list|,
name|Checksum
argument_list|)
expr_stmt|;
block|}
comment|/* The RSDP for ACPI 2.0+ contains more data and has a Length field */
if|if
condition|(
name|Rsdp
operator|->
name|Revision
operator|>
literal|0
condition|)
block|{
name|Length
operator|=
name|Rsdp
operator|->
name|Length
expr_stmt|;
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoRsdp2
argument_list|)
expr_stmt|;
comment|/* Validate the extended checksum over entire RSDP */
name|Checksum
operator|=
name|AcpiDmGenerateChecksum
argument_list|(
name|Rsdp
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_RSDP
argument_list|)
argument_list|,
name|Rsdp
operator|->
name|ExtendedChecksum
argument_list|)
expr_stmt|;
if|if
condition|(
name|Checksum
operator|!=
name|Rsdp
operator|->
name|ExtendedChecksum
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"/* Incorrect Extended Checksum above, should be 0x%2.2X */\n"
argument_list|,
name|Checksum
argument_list|)
expr_stmt|;
block|}
block|}
return|return
operator|(
name|Length
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpRsdt  *  * PARAMETERS:  Table               - A RSDT  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a RSDT  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpRsdt
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|UINT32
modifier|*
name|Array
decl_stmt|;
name|UINT32
name|Entries
decl_stmt|;
name|UINT32
name|Offset
decl_stmt|;
name|UINT32
name|i
decl_stmt|;
comment|/* Point to start of table pointer array */
name|Array
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_TABLE_RSDT
argument_list|,
name|Table
argument_list|)
operator|->
name|TableOffsetEntry
expr_stmt|;
name|Offset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_HEADER
argument_list|)
expr_stmt|;
comment|/* RSDT uses 32-bit pointers */
name|Entries
operator|=
operator|(
name|Table
operator|->
name|Length
operator|-
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_HEADER
argument_list|)
operator|)
operator|/
sizeof|sizeof
argument_list|(
name|UINT32
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Entries
condition|;
name|i
operator|++
control|)
block|{
name|AcpiDmLineHeader2
argument_list|(
name|Offset
argument_list|,
sizeof|sizeof
argument_list|(
name|UINT32
argument_list|)
argument_list|,
literal|"ACPI Table Address"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"%8.8X\n"
argument_list|,
name|Array
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|UINT32
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpXsdt  *  * PARAMETERS:  Table               - A XSDT  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a XSDT  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpXsdt
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|UINT64
modifier|*
name|Array
decl_stmt|;
name|UINT32
name|Entries
decl_stmt|;
name|UINT32
name|Offset
decl_stmt|;
name|UINT32
name|i
decl_stmt|;
comment|/* Point to start of table pointer array */
name|Array
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_TABLE_XSDT
argument_list|,
name|Table
argument_list|)
operator|->
name|TableOffsetEntry
expr_stmt|;
name|Offset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_HEADER
argument_list|)
expr_stmt|;
comment|/* XSDT uses 64-bit pointers */
name|Entries
operator|=
operator|(
name|Table
operator|->
name|Length
operator|-
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_HEADER
argument_list|)
operator|)
operator|/
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Entries
condition|;
name|i
operator|++
control|)
block|{
name|AcpiDmLineHeader2
argument_list|(
name|Offset
argument_list|,
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
argument_list|,
literal|"ACPI Table Address"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"%8.8X%8.8X\n"
argument_list|,
name|ACPI_FORMAT_UINT64
argument_list|(
name|Array
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpFadt  *  * PARAMETERS:  Table               - A FADT  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a FADT  *  * NOTE:        We cannot depend on the FADT version to indicate the actual  *              contents of the FADT because of BIOS bugs. The table length  *              is the only reliable indicator.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpFadt
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
comment|/* Always dump the minimum FADT revision 1 fields (ACPI 1.0) */
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoFadt1
argument_list|)
expr_stmt|;
comment|/* Check for FADT revision 2 fields (ACPI 1.0B MS extensions) */
if|if
condition|(
operator|(
name|Table
operator|->
name|Length
operator|>
name|ACPI_FADT_V1_SIZE
operator|)
operator|&&
operator|(
name|Table
operator|->
name|Length
operator|<=
name|ACPI_FADT_V2_SIZE
operator|)
condition|)
block|{
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoFadt2
argument_list|)
expr_stmt|;
block|}
comment|/* Check for FADT revision 3/4 fields and up (ACPI 2.0+ extended data) */
elseif|else
if|if
condition|(
name|Table
operator|->
name|Length
operator|>
name|ACPI_FADT_V2_SIZE
condition|)
block|{
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoFadt3
argument_list|)
expr_stmt|;
comment|/* Check for FADT revision 5 fields and up (ACPI 5.0+) */
if|if
condition|(
name|Table
operator|->
name|Length
operator|>
name|ACPI_FADT_V3_SIZE
condition|)
block|{
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoFadt5
argument_list|)
expr_stmt|;
block|}
comment|/* Check for FADT revision 6 fields and up (ACPI 6.0+) */
if|if
condition|(
name|Table
operator|->
name|Length
operator|>
name|ACPI_FADT_V3_SIZE
condition|)
block|{
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoFadt6
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* Validate various fields in the FADT, including length */
name|AcpiTbCreateLocalFadt
argument_list|(
name|Table
argument_list|,
name|Table
operator|->
name|Length
argument_list|)
expr_stmt|;
comment|/* Validate FADT length against the revision */
name|AcpiDmValidateFadtLength
argument_list|(
name|Table
operator|->
name|Revision
argument_list|,
name|Table
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmValidateFadtLength  *  * PARAMETERS:  Revision            - FADT revision (Header->Revision)  *              Length              - FADT length (Header->Length  *  * RETURN:      None  *  * DESCRIPTION: Check the FADT revision against the expected table length for  *              that revision. Issue a warning if the length is not what was  *              expected. This seems to be such a common BIOS bug that the  *              FADT revision has been rendered virtually meaningless.  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|AcpiDmValidateFadtLength
parameter_list|(
name|UINT32
name|Revision
parameter_list|,
name|UINT32
name|Length
parameter_list|)
block|{
name|UINT32
name|ExpectedLength
decl_stmt|;
switch|switch
condition|(
name|Revision
condition|)
block|{
case|case
literal|0
case|:
name|AcpiOsPrintf
argument_list|(
literal|"// ACPI Warning: Invalid FADT revision: 0\n"
argument_list|)
expr_stmt|;
return|return;
case|case
literal|1
case|:
name|ExpectedLength
operator|=
name|ACPI_FADT_V1_SIZE
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|ExpectedLength
operator|=
name|ACPI_FADT_V2_SIZE
expr_stmt|;
break|break;
case|case
literal|3
case|:
case|case
literal|4
case|:
name|ExpectedLength
operator|=
name|ACPI_FADT_V3_SIZE
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|ExpectedLength
operator|=
name|ACPI_FADT_V5_SIZE
expr_stmt|;
break|break;
default|default:
return|return;
block|}
if|if
condition|(
name|Length
operator|==
name|ExpectedLength
condition|)
block|{
return|return;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n// ACPI Warning: FADT revision %X does not match length: found %X expected %X\n"
argument_list|,
name|Revision
argument_list|,
name|Length
argument_list|,
name|ExpectedLength
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpAsf  *  * PARAMETERS:  Table               - A ASF table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a ASF table  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpAsf
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_HEADER
argument_list|)
decl_stmt|;
name|ACPI_ASF_INFO
modifier|*
name|SubTable
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|DataInfoTable
init|=
name|NULL
decl_stmt|;
name|UINT8
modifier|*
name|DataTable
init|=
name|NULL
decl_stmt|;
name|UINT32
name|DataCount
init|=
literal|0
decl_stmt|;
name|UINT32
name|DataLength
init|=
literal|0
decl_stmt|;
name|UINT32
name|DataOffset
init|=
literal|0
decl_stmt|;
name|UINT32
name|i
decl_stmt|;
name|UINT8
name|Type
decl_stmt|;
comment|/* No main table, only subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_ASF_INFO
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Header
operator|.
name|Length
argument_list|,
name|AcpiDmTableInfoAsfHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* The actual type is the lower 7 bits of Type */
name|Type
operator|=
call|(
name|UINT8
call|)
argument_list|(
name|SubTable
operator|->
name|Header
operator|.
name|Type
operator|&
literal|0x7F
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|Type
condition|)
block|{
case|case
name|ACPI_ASF_TYPE_INFO
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoAsf0
expr_stmt|;
break|break;
case|case
name|ACPI_ASF_TYPE_ALERT
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoAsf1
expr_stmt|;
name|DataInfoTable
operator|=
name|AcpiDmTableInfoAsf1a
expr_stmt|;
name|DataTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|UINT8
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_ASF_ALERT
argument_list|)
argument_list|)
expr_stmt|;
name|DataCount
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_ASF_ALERT
argument_list|,
name|SubTable
argument_list|)
operator|->
name|Alerts
expr_stmt|;
name|DataLength
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_ASF_ALERT
argument_list|,
name|SubTable
argument_list|)
operator|->
name|DataLength
expr_stmt|;
name|DataOffset
operator|=
name|Offset
operator|+
sizeof|sizeof
argument_list|(
name|ACPI_ASF_ALERT
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_ASF_TYPE_CONTROL
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoAsf2
expr_stmt|;
name|DataInfoTable
operator|=
name|AcpiDmTableInfoAsf2a
expr_stmt|;
name|DataTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|UINT8
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_ASF_REMOTE
argument_list|)
argument_list|)
expr_stmt|;
name|DataCount
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_ASF_REMOTE
argument_list|,
name|SubTable
argument_list|)
operator|->
name|Controls
expr_stmt|;
name|DataLength
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_ASF_REMOTE
argument_list|,
name|SubTable
argument_list|)
operator|->
name|DataLength
expr_stmt|;
name|DataOffset
operator|=
name|Offset
operator|+
sizeof|sizeof
argument_list|(
name|ACPI_ASF_REMOTE
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_ASF_TYPE_BOOT
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoAsf3
expr_stmt|;
break|break;
case|case
name|ACPI_ASF_TYPE_ADDRESS
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoAsf4
expr_stmt|;
name|DataTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|UINT8
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_ASF_ADDRESS
argument_list|)
argument_list|)
expr_stmt|;
name|DataLength
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_ASF_ADDRESS
argument_list|,
name|SubTable
argument_list|)
operator|->
name|Devices
expr_stmt|;
name|DataOffset
operator|=
name|Offset
operator|+
sizeof|sizeof
argument_list|(
name|ACPI_ASF_ADDRESS
argument_list|)
expr_stmt|;
break|break;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown ASF subtable type 0x%X\n"
argument_list|,
name|SubTable
operator|->
name|Header
operator|.
name|Type
argument_list|)
expr_stmt|;
return|return;
block|}
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Header
operator|.
name|Length
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Dump variable-length extra data */
switch|switch
condition|(
name|Type
condition|)
block|{
case|case
name|ACPI_ASF_TYPE_ALERT
case|:
case|case
name|ACPI_ASF_TYPE_CONTROL
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|DataCount
condition|;
name|i
operator|++
control|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|DataOffset
argument_list|,
name|DataTable
argument_list|,
name|DataLength
argument_list|,
name|DataInfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|DataTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|UINT8
argument_list|,
name|DataTable
argument_list|,
name|DataLength
argument_list|)
expr_stmt|;
name|DataOffset
operator|+=
name|DataLength
expr_stmt|;
block|}
break|break;
case|case
name|ACPI_ASF_TYPE_ADDRESS
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|DataLength
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|i
operator|%
literal|16
operator|)
condition|)
block|{
name|AcpiDmLineHeader
argument_list|(
name|DataOffset
argument_list|,
literal|1
argument_list|,
literal|"Addresses"
argument_list|)
expr_stmt|;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"%2.2X "
argument_list|,
operator|*
name|DataTable
argument_list|)
expr_stmt|;
name|DataTable
operator|++
expr_stmt|;
name|DataOffset
operator|++
expr_stmt|;
if|if
condition|(
name|DataOffset
operator|>
name|Table
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"**** ACPI table terminates in the middle of a data structure! (ASF! table)\n"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* Point to next subtable */
if|if
condition|(
operator|!
name|SubTable
operator|->
name|Header
operator|.
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Invalid zero subtable header length\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|Offset
operator|+=
name|SubTable
operator|->
name|Header
operator|.
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_ASF_INFO
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Header
operator|.
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpCpep  *  * PARAMETERS:  Table               - A CPEP table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a CPEP. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpCpep
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_CPEP_POLLING
modifier|*
name|SubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_CPEP
argument_list|)
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoCpep
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_CPEP_POLLING
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Header
operator|.
name|Length
argument_list|,
name|AcpiDmTableInfoCpep0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Header
operator|.
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_CPEP_POLLING
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Header
operator|.
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpCsrt  *  * PARAMETERS:  Table               - A CSRT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a CSRT. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpCsrt
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_CSRT_GROUP
modifier|*
name|SubTable
decl_stmt|;
name|ACPI_CSRT_SHARED_INFO
modifier|*
name|SharedInfoTable
decl_stmt|;
name|ACPI_CSRT_DESCRIPTOR
modifier|*
name|SubSubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_CSRT
argument_list|)
decl_stmt|;
name|UINT32
name|SubOffset
decl_stmt|;
name|UINT32
name|SubSubOffset
decl_stmt|;
name|UINT32
name|InfoLength
decl_stmt|;
comment|/* The main table only contains the ACPI header, thus already handled */
comment|/* Subtables (Resource Groups) */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_CSRT_GROUP
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Resource group subtable */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoCsrt0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Shared info subtable (One per resource group) */
name|SubOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_CSRT_GROUP
argument_list|)
expr_stmt|;
name|SharedInfoTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_CSRT_SHARED_INFO
argument_list|,
name|Table
argument_list|,
name|Offset
operator|+
name|SubOffset
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
operator|+
name|SubOffset
argument_list|,
name|SharedInfoTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_CSRT_SHARED_INFO
argument_list|)
argument_list|,
name|AcpiDmTableInfoCsrt1
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|SubOffset
operator|+=
name|SubTable
operator|->
name|SharedInfoLength
expr_stmt|;
comment|/* Sub-Subtables (Resource Descriptors) */
name|SubSubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_CSRT_DESCRIPTOR
argument_list|,
name|Table
argument_list|,
name|Offset
operator|+
name|SubOffset
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|SubOffset
operator|<
name|SubTable
operator|->
name|Length
operator|)
operator|&&
operator|(
operator|(
name|Offset
operator|+
name|SubOffset
operator|)
operator|<
name|Table
operator|->
name|Length
operator|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
operator|+
name|SubOffset
argument_list|,
name|SubSubTable
argument_list|,
name|SubSubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoCsrt2
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|SubSubOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_CSRT_DESCRIPTOR
argument_list|)
expr_stmt|;
comment|/* Resource-specific info buffer */
name|InfoLength
operator|=
name|SubSubTable
operator|->
name|Length
operator|-
name|SubSubOffset
expr_stmt|;
if|if
condition|(
name|InfoLength
condition|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
operator|+
name|SubOffset
operator|+
name|SubSubOffset
argument_list|,
name|Table
argument_list|,
name|InfoLength
argument_list|,
name|AcpiDmTableInfoCsrt2a
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|SubSubOffset
operator|+=
name|InfoLength
expr_stmt|;
block|}
comment|/* Point to next sub-subtable */
name|SubOffset
operator|+=
name|SubSubTable
operator|->
name|Length
expr_stmt|;
name|SubSubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_CSRT_DESCRIPTOR
argument_list|,
name|SubSubTable
argument_list|,
name|SubSubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_CSRT_GROUP
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpDbg2  *  * PARAMETERS:  Table               - A DBG2 table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a DBG2. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpDbg2
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_DBG2_DEVICE
modifier|*
name|SubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_DBG2
argument_list|)
decl_stmt|;
name|UINT32
name|i
decl_stmt|;
name|UINT32
name|ArrayOffset
decl_stmt|;
name|UINT32
name|AbsoluteOffset
decl_stmt|;
name|UINT8
modifier|*
name|Array
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoDbg2
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_DBG2_DEVICE
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoDbg2Device
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Dump the BaseAddress array */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SubTable
operator|->
name|RegisterCount
condition|;
name|i
operator|++
control|)
block|{
name|ArrayOffset
operator|=
name|SubTable
operator|->
name|BaseAddressOffset
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|ACPI_GENERIC_ADDRESS
argument_list|)
operator|*
name|i
operator|)
expr_stmt|;
name|AbsoluteOffset
operator|=
name|Offset
operator|+
name|ArrayOffset
expr_stmt|;
name|Array
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|SubTable
operator|+
name|ArrayOffset
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|AbsoluteOffset
argument_list|,
name|Array
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoDbg2Addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
block|}
comment|/* Dump the AddressSize array */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SubTable
operator|->
name|RegisterCount
condition|;
name|i
operator|++
control|)
block|{
name|ArrayOffset
operator|=
name|SubTable
operator|->
name|AddressSizeOffset
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|UINT32
argument_list|)
operator|*
name|i
operator|)
expr_stmt|;
name|AbsoluteOffset
operator|=
name|Offset
operator|+
name|ArrayOffset
expr_stmt|;
name|Array
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|SubTable
operator|+
name|ArrayOffset
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|AbsoluteOffset
argument_list|,
name|Array
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoDbg2Size
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
block|}
comment|/* Dump the Namestring (required) */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|ArrayOffset
operator|=
name|SubTable
operator|->
name|NamepathOffset
expr_stmt|;
name|AbsoluteOffset
operator|=
name|Offset
operator|+
name|ArrayOffset
expr_stmt|;
name|Array
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|SubTable
operator|+
name|ArrayOffset
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|AbsoluteOffset
argument_list|,
name|Array
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoDbg2Name
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Dump the OemData (optional) */
if|if
condition|(
name|SubTable
operator|->
name|OemDataOffset
condition|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
operator|+
name|SubTable
operator|->
name|OemDataOffset
argument_list|,
name|Table
argument_list|,
name|SubTable
operator|->
name|OemDataLength
argument_list|,
name|AcpiDmTableInfoDbg2OemData
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
block|}
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_DBG2_DEVICE
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpDmar  *  * PARAMETERS:  Table               - A DMAR table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a DMAR. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpDmar
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_DMAR_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_DMAR
argument_list|)
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
name|ACPI_DMAR_DEVICE_SCOPE
modifier|*
name|ScopeTable
decl_stmt|;
name|UINT32
name|ScopeOffset
decl_stmt|;
name|UINT8
modifier|*
name|PciPath
decl_stmt|;
name|UINT32
name|PathOffset
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoDmar
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_DMAR_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoDmarHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|SubTable
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_DMAR_TYPE_HARDWARE_UNIT
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoDmar0
expr_stmt|;
name|ScopeOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_DMAR_HARDWARE_UNIT
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_DMAR_TYPE_RESERVED_MEMORY
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoDmar1
expr_stmt|;
name|ScopeOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_DMAR_RESERVED_MEMORY
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_DMAR_TYPE_ROOT_ATS
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoDmar2
expr_stmt|;
name|ScopeOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_DMAR_ATSR
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_DMAR_TYPE_HARDWARE_AFFINITY
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoDmar3
expr_stmt|;
name|ScopeOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_DMAR_RHSA
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_DMAR_TYPE_NAMESPACE
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoDmar4
expr_stmt|;
name|ScopeOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_DMAR_ANDD
argument_list|)
expr_stmt|;
break|break;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown DMAR subtable type 0x%X\n\n"
argument_list|,
name|SubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
return|return;
block|}
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/*          * Dump the optional device scope entries          */
if|if
condition|(
operator|(
name|SubTable
operator|->
name|Type
operator|==
name|ACPI_DMAR_TYPE_HARDWARE_AFFINITY
operator|)
operator|||
operator|(
name|SubTable
operator|->
name|Type
operator|==
name|ACPI_DMAR_TYPE_NAMESPACE
operator|)
condition|)
block|{
comment|/* These types do not support device scopes */
goto|goto
name|NextSubtable
goto|;
block|}
name|ScopeTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_DMAR_DEVICE_SCOPE
argument_list|,
name|SubTable
argument_list|,
name|ScopeOffset
argument_list|)
expr_stmt|;
while|while
condition|(
name|ScopeOffset
operator|<
name|SubTable
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
operator|+
name|ScopeOffset
argument_list|,
name|ScopeTable
argument_list|,
name|ScopeTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoDmarScope
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* Dump the PCI Path entries for this device scope */
name|PathOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_DMAR_DEVICE_SCOPE
argument_list|)
expr_stmt|;
comment|/* Path entries start at this offset */
name|PciPath
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|UINT8
argument_list|,
name|ScopeTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_DMAR_DEVICE_SCOPE
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|PathOffset
operator|<
name|ScopeTable
operator|->
name|Length
condition|)
block|{
name|AcpiDmLineHeader
argument_list|(
operator|(
name|PathOffset
operator|+
name|ScopeOffset
operator|+
name|Offset
operator|)
argument_list|,
literal|2
argument_list|,
literal|"PCI Path"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"%2.2X,%2.2X\n"
argument_list|,
name|PciPath
index|[
literal|0
index|]
argument_list|,
name|PciPath
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
comment|/* Point to next PCI Path entry */
name|PathOffset
operator|+=
literal|2
expr_stmt|;
name|PciPath
operator|+=
literal|2
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
comment|/* Point to next device scope entry */
name|ScopeOffset
operator|+=
name|ScopeTable
operator|->
name|Length
expr_stmt|;
name|ScopeTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_DMAR_DEVICE_SCOPE
argument_list|,
name|ScopeTable
argument_list|,
name|ScopeTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
name|NextSubtable
label|:
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_DMAR_HEADER
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpDrtm  *  * PARAMETERS:  Table               - A DRTM table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a DRTM.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpDrtm
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
decl_stmt|;
name|ACPI_DRTM_VTABLE_LIST
modifier|*
name|DrtmVtl
decl_stmt|;
name|ACPI_DRTM_RESOURCE_LIST
modifier|*
name|DrtmRl
decl_stmt|;
name|ACPI_DRTM_DPS_ID
modifier|*
name|DrtmDps
decl_stmt|;
name|UINT32
name|Count
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoDrtm
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|Offset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_DRTM
argument_list|)
expr_stmt|;
comment|/* Sub-tables */
comment|/* Dump ValidatedTable length */
name|DrtmVtl
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_DRTM_VTABLE_LIST
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|DrtmVtl
argument_list|,
name|ACPI_OFFSET
argument_list|(
name|ACPI_DRTM_VTABLE_LIST
argument_list|,
name|ValidatedTables
argument_list|)
argument_list|,
name|AcpiDmTableInfoDrtm0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|Offset
operator|+=
name|ACPI_OFFSET
argument_list|(
name|ACPI_DRTM_VTABLE_LIST
argument_list|,
name|ValidatedTables
argument_list|)
expr_stmt|;
comment|/* Dump Validated table addresses */
name|Count
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|Offset
operator|<
name|Table
operator|->
name|Length
operator|)
operator|&&
operator|(
name|DrtmVtl
operator|->
name|ValidatedTableCount
operator|>
name|Count
operator|)
condition|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|ACPI_ADD_PTR
argument_list|(
name|void
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
argument_list|,
name|AcpiDmTableInfoDrtm0a
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
expr_stmt|;
name|Count
operator|++
expr_stmt|;
block|}
comment|/* Dump ResourceList length */
name|DrtmRl
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_DRTM_RESOURCE_LIST
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|DrtmRl
argument_list|,
name|ACPI_OFFSET
argument_list|(
name|ACPI_DRTM_RESOURCE_LIST
argument_list|,
name|Resources
argument_list|)
argument_list|,
name|AcpiDmTableInfoDrtm1
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|Offset
operator|+=
name|ACPI_OFFSET
argument_list|(
name|ACPI_DRTM_RESOURCE_LIST
argument_list|,
name|Resources
argument_list|)
expr_stmt|;
comment|/* Dump the Resource List */
name|Count
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|Offset
operator|<
name|Table
operator|->
name|Length
operator|)
operator|&&
operator|(
name|DrtmRl
operator|->
name|ResourceCount
operator|>
name|Count
operator|)
condition|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|ACPI_ADD_PTR
argument_list|(
name|void
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_DRTM_RESOURCE
argument_list|)
argument_list|,
name|AcpiDmTableInfoDrtm1a
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_DRTM_RESOURCE
argument_list|)
expr_stmt|;
name|Count
operator|++
expr_stmt|;
block|}
comment|/* Dump DPS */
name|DrtmDps
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_DRTM_DPS_ID
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|DrtmDps
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_DRTM_DPS_ID
argument_list|)
argument_list|,
name|AcpiDmTableInfoDrtm2
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpEinj  *  * PARAMETERS:  Table               - A EINJ table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a EINJ. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpEinj
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_WHEA_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_EINJ
argument_list|)
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoEinj
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_WHEA_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_WHEA_HEADER
argument_list|)
argument_list|,
name|AcpiDmTableInfoEinj0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to next subtable (each subtable is of fixed length) */
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_WHEA_HEADER
argument_list|)
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_WHEA_HEADER
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_WHEA_HEADER
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpErst  *  * PARAMETERS:  Table               - A ERST table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a ERST. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpErst
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_WHEA_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_ERST
argument_list|)
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoErst
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_WHEA_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_WHEA_HEADER
argument_list|)
argument_list|,
name|AcpiDmTableInfoErst0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to next subtable (each subtable is of fixed length) */
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_WHEA_HEADER
argument_list|)
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_WHEA_HEADER
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_WHEA_HEADER
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpFpdt  *  * PARAMETERS:  Table               - A FPDT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a FPDT. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpFpdt
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_FPDT_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_FPDT
argument_list|)
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
comment|/* There is no main table (other than the standard ACPI header) */
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_FPDT_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoFpdtHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
switch|switch
condition|(
name|SubTable
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_FPDT_TYPE_BOOT
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoFpdt0
expr_stmt|;
break|break;
case|case
name|ACPI_FPDT_TYPE_S3PERF
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoFpdt1
expr_stmt|;
break|break;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown FPDT subtable type 0x%X\n\n"
argument_list|,
name|SubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
comment|/* Attempt to continue */
if|if
condition|(
operator|!
name|SubTable
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Invalid zero length subtable\n"
argument_list|)
expr_stmt|;
return|return;
block|}
goto|goto
name|NextSubTable
goto|;
block|}
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|NextSubTable
label|:
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_FPDT_HEADER
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpGtdt  *  * PARAMETERS:  Table               - A GTDT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a GTDT. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpGtdt
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_GTDT_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_GTDT
argument_list|)
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
name|UINT32
name|SubTableLength
decl_stmt|;
name|UINT32
name|GtCount
decl_stmt|;
name|ACPI_GTDT_TIMER_ENTRY
modifier|*
name|GtxTable
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoGtdt
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_GTDT_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoGtdtHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|GtCount
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|SubTable
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_GTDT_TYPE_TIMER_BLOCK
case|:
name|SubTableLength
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_GTDT_TIMER_BLOCK
argument_list|)
expr_stmt|;
name|GtCount
operator|=
operator|(
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_GTDT_TIMER_BLOCK
argument_list|,
name|SubTable
argument_list|)
operator|)
operator|->
name|TimerCount
expr_stmt|;
name|InfoTable
operator|=
name|AcpiDmTableInfoGtdt0
expr_stmt|;
break|break;
case|case
name|ACPI_GTDT_TYPE_WATCHDOG
case|:
name|SubTableLength
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_GTDT_WATCHDOG
argument_list|)
expr_stmt|;
name|InfoTable
operator|=
name|AcpiDmTableInfoGtdt1
expr_stmt|;
break|break;
default|default:
comment|/* Cannot continue on unknown type - no length */
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown GTDT subtable type 0x%X\n"
argument_list|,
name|SubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
return|return;
block|}
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to end of current subtable (each subtable above is of fixed length) */
name|Offset
operator|+=
name|SubTableLength
expr_stmt|;
comment|/* If there are any Gt Timer Blocks from above, dump them now */
if|if
condition|(
name|GtCount
condition|)
block|{
name|GtxTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_GTDT_TIMER_ENTRY
argument_list|,
name|SubTable
argument_list|,
name|SubTableLength
argument_list|)
expr_stmt|;
name|SubTableLength
operator|+=
name|GtCount
operator|*
sizeof|sizeof
argument_list|(
name|ACPI_GTDT_TIMER_ENTRY
argument_list|)
expr_stmt|;
while|while
condition|(
name|GtCount
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|GtxTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_GTDT_TIMER_ENTRY
argument_list|)
argument_list|,
name|AcpiDmTableInfoGtdt0a
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_GTDT_TIMER_ENTRY
argument_list|)
expr_stmt|;
name|GtxTable
operator|++
expr_stmt|;
name|GtCount
operator|--
expr_stmt|;
block|}
block|}
comment|/* Point to next subtable */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_GTDT_HEADER
argument_list|,
name|SubTable
argument_list|,
name|SubTableLength
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpHest  *  * PARAMETERS:  Table               - A HEST table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a HEST. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpHest
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_HEST_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_HEST
argument_list|)
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
name|UINT32
name|SubTableLength
decl_stmt|;
name|UINT32
name|BankCount
decl_stmt|;
name|ACPI_HEST_IA_ERROR_BANK
modifier|*
name|BankTable
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoHest
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_HEST_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
name|BankCount
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|SubTable
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_HEST_TYPE_IA32_CHECK
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoHest0
expr_stmt|;
name|SubTableLength
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_HEST_IA_MACHINE_CHECK
argument_list|)
expr_stmt|;
name|BankCount
operator|=
operator|(
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_HEST_IA_MACHINE_CHECK
argument_list|,
name|SubTable
argument_list|)
operator|)
operator|->
name|NumHardwareBanks
expr_stmt|;
break|break;
case|case
name|ACPI_HEST_TYPE_IA32_CORRECTED_CHECK
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoHest1
expr_stmt|;
name|SubTableLength
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_HEST_IA_CORRECTED
argument_list|)
expr_stmt|;
name|BankCount
operator|=
operator|(
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_HEST_IA_CORRECTED
argument_list|,
name|SubTable
argument_list|)
operator|)
operator|->
name|NumHardwareBanks
expr_stmt|;
break|break;
case|case
name|ACPI_HEST_TYPE_IA32_NMI
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoHest2
expr_stmt|;
name|SubTableLength
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_HEST_IA_NMI
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_HEST_TYPE_AER_ROOT_PORT
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoHest6
expr_stmt|;
name|SubTableLength
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_HEST_AER_ROOT
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_HEST_TYPE_AER_ENDPOINT
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoHest7
expr_stmt|;
name|SubTableLength
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_HEST_AER
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_HEST_TYPE_AER_BRIDGE
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoHest8
expr_stmt|;
name|SubTableLength
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_HEST_AER_BRIDGE
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_HEST_TYPE_GENERIC_ERROR
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoHest9
expr_stmt|;
name|SubTableLength
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_HEST_GENERIC
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* Cannot continue on unknown type - no length */
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown HEST subtable type 0x%X\n"
argument_list|,
name|SubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
return|return;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTableLength
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to end of current subtable (each subtable above is of fixed length) */
name|Offset
operator|+=
name|SubTableLength
expr_stmt|;
comment|/* If there are any (fixed-length) Error Banks from above, dump them now */
if|if
condition|(
name|BankCount
condition|)
block|{
name|BankTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_HEST_IA_ERROR_BANK
argument_list|,
name|SubTable
argument_list|,
name|SubTableLength
argument_list|)
expr_stmt|;
name|SubTableLength
operator|+=
name|BankCount
operator|*
sizeof|sizeof
argument_list|(
name|ACPI_HEST_IA_ERROR_BANK
argument_list|)
expr_stmt|;
while|while
condition|(
name|BankCount
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|BankTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_HEST_IA_ERROR_BANK
argument_list|)
argument_list|,
name|AcpiDmTableInfoHestBank
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_HEST_IA_ERROR_BANK
argument_list|)
expr_stmt|;
name|BankTable
operator|++
expr_stmt|;
name|BankCount
operator|--
expr_stmt|;
block|}
block|}
comment|/* Point to next subtable */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_HEST_HEADER
argument_list|,
name|SubTable
argument_list|,
name|SubTableLength
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpIort  *  * PARAMETERS:  Table               - A IORT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a IORT  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpIort
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_TABLE_IORT
modifier|*
name|Iort
decl_stmt|;
name|ACPI_IORT_NODE
modifier|*
name|IortNode
decl_stmt|;
name|ACPI_IORT_ITS_GROUP
modifier|*
name|IortItsGroup
init|=
name|NULL
decl_stmt|;
name|ACPI_IORT_SMMU
modifier|*
name|IortSmmu
init|=
name|NULL
decl_stmt|;
name|UINT32
name|Offset
decl_stmt|;
name|UINT32
name|NodeOffset
decl_stmt|;
name|UINT32
name|Length
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
name|char
modifier|*
name|String
decl_stmt|;
name|UINT32
name|i
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoIort
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|Iort
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_TABLE_IORT
argument_list|,
name|Table
argument_list|)
expr_stmt|;
name|Offset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_IORT
argument_list|)
expr_stmt|;
comment|/* Dump the OptionalPadding (optional) */
if|if
condition|(
name|Iort
operator|->
name|NodeOffset
operator|>
name|Offset
condition|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|Table
argument_list|,
name|Iort
operator|->
name|NodeOffset
operator|-
name|Offset
argument_list|,
name|AcpiDmTableInfoIortPad
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
block|}
name|Offset
operator|=
name|Iort
operator|->
name|NodeOffset
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|IortNode
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IORT_NODE
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Length
operator|=
name|ACPI_OFFSET
argument_list|(
name|ACPI_IORT_NODE
argument_list|,
name|NodeData
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|IortNode
argument_list|,
name|Length
argument_list|,
name|AcpiDmTableInfoIortHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|NodeOffset
operator|=
name|Length
expr_stmt|;
switch|switch
condition|(
name|IortNode
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_IORT_NODE_ITS_GROUP
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoIort0
expr_stmt|;
name|Length
operator|=
name|ACPI_OFFSET
argument_list|(
name|ACPI_IORT_ITS_GROUP
argument_list|,
name|Identifiers
argument_list|)
expr_stmt|;
name|IortItsGroup
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IORT_ITS_GROUP
argument_list|,
name|IortNode
argument_list|,
name|NodeOffset
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_IORT_NODE_NAMED_COMPONENT
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoIort1
expr_stmt|;
name|Length
operator|=
name|ACPI_OFFSET
argument_list|(
name|ACPI_IORT_NAMED_COMPONENT
argument_list|,
name|DeviceName
argument_list|)
expr_stmt|;
name|String
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|char
argument_list|,
name|IortNode
argument_list|,
name|NodeOffset
operator|+
name|Length
argument_list|)
expr_stmt|;
name|Length
operator|+=
name|strlen
argument_list|(
name|String
argument_list|)
operator|+
literal|1
expr_stmt|;
break|break;
case|case
name|ACPI_IORT_NODE_PCI_ROOT_COMPLEX
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoIort2
expr_stmt|;
name|Length
operator|=
name|IortNode
operator|->
name|Length
operator|-
name|NodeOffset
expr_stmt|;
break|break;
case|case
name|ACPI_IORT_NODE_SMMU
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoIort3
expr_stmt|;
name|Length
operator|=
name|ACPI_OFFSET
argument_list|(
name|ACPI_IORT_SMMU
argument_list|,
name|Interrupts
argument_list|)
expr_stmt|;
name|IortSmmu
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IORT_SMMU
argument_list|,
name|IortNode
argument_list|,
name|NodeOffset
argument_list|)
expr_stmt|;
break|break;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown IORT node type 0x%X\n"
argument_list|,
name|IortNode
operator|->
name|Type
argument_list|)
expr_stmt|;
comment|/* Attempt to continue */
if|if
condition|(
operator|!
name|IortNode
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Invalid zero length IORT node\n"
argument_list|)
expr_stmt|;
return|return;
block|}
goto|goto
name|NextSubTable
goto|;
block|}
comment|/* Dump the node subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
operator|+
name|NodeOffset
argument_list|,
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IORT_NODE
argument_list|,
name|IortNode
argument_list|,
name|NodeOffset
argument_list|)
argument_list|,
name|Length
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|NodeOffset
operator|+=
name|Length
expr_stmt|;
comment|/* Dump the node specific data */
switch|switch
condition|(
name|IortNode
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_IORT_NODE_ITS_GROUP
case|:
comment|/* Validate IortItsGroup to avoid compiler warnings */
if|if
condition|(
name|IortItsGroup
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IortItsGroup
operator|->
name|ItsCount
condition|;
name|i
operator|++
control|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
operator|+
name|NodeOffset
argument_list|,
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IORT_NODE
argument_list|,
name|IortNode
argument_list|,
name|NodeOffset
argument_list|)
argument_list|,
literal|4
argument_list|,
name|AcpiDmTableInfoIort0a
argument_list|)
expr_stmt|;
name|NodeOffset
operator|+=
literal|4
expr_stmt|;
block|}
block|}
break|break;
case|case
name|ACPI_IORT_NODE_NAMED_COMPONENT
case|:
comment|/* Dump the Padding (optional) */
if|if
condition|(
name|IortNode
operator|->
name|Length
operator|>
name|NodeOffset
condition|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
operator|+
name|NodeOffset
argument_list|,
name|Table
argument_list|,
name|IortNode
operator|->
name|Length
operator|-
name|NodeOffset
argument_list|,
name|AcpiDmTableInfoIort1a
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
block|}
break|break;
case|case
name|ACPI_IORT_NODE_SMMU
case|:
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* Validate IortSmmu to avoid compiler warnings */
if|if
condition|(
name|IortSmmu
condition|)
block|{
name|Length
operator|=
literal|2
operator|*
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
expr_stmt|;
name|NodeOffset
operator|=
name|IortSmmu
operator|->
name|GlobalInterruptOffset
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
operator|+
name|NodeOffset
argument_list|,
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IORT_NODE
argument_list|,
name|IortNode
argument_list|,
name|NodeOffset
argument_list|)
argument_list|,
name|Length
argument_list|,
name|AcpiDmTableInfoIort3a
argument_list|)
expr_stmt|;
name|NodeOffset
operator|=
name|IortSmmu
operator|->
name|ContextInterruptOffset
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IortSmmu
operator|->
name|ContextInterruptCount
condition|;
name|i
operator|++
control|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
operator|+
name|NodeOffset
argument_list|,
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IORT_NODE
argument_list|,
name|IortNode
argument_list|,
name|NodeOffset
argument_list|)
argument_list|,
literal|8
argument_list|,
name|AcpiDmTableInfoIort3b
argument_list|)
expr_stmt|;
name|NodeOffset
operator|+=
literal|8
expr_stmt|;
block|}
name|NodeOffset
operator|=
name|IortSmmu
operator|->
name|PmuInterruptOffset
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IortSmmu
operator|->
name|PmuInterruptCount
condition|;
name|i
operator|++
control|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
operator|+
name|NodeOffset
argument_list|,
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IORT_NODE
argument_list|,
name|IortNode
argument_list|,
name|NodeOffset
argument_list|)
argument_list|,
literal|8
argument_list|,
name|AcpiDmTableInfoIort3c
argument_list|)
expr_stmt|;
name|NodeOffset
operator|+=
literal|8
expr_stmt|;
block|}
block|}
break|break;
default|default:
break|break;
block|}
comment|/* Dump the ID mappings */
name|NodeOffset
operator|=
name|IortNode
operator|->
name|MappingOffset
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IortNode
operator|->
name|MappingCount
condition|;
name|i
operator|++
control|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Length
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_IORT_ID_MAPPING
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
operator|+
name|NodeOffset
argument_list|,
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IORT_NODE
argument_list|,
name|IortNode
argument_list|,
name|NodeOffset
argument_list|)
argument_list|,
name|Length
argument_list|,
name|AcpiDmTableInfoIortMap
argument_list|)
expr_stmt|;
name|NodeOffset
operator|+=
name|Length
expr_stmt|;
block|}
name|NextSubTable
label|:
comment|/* Point to next node subtable */
name|Offset
operator|+=
name|IortNode
operator|->
name|Length
expr_stmt|;
name|IortNode
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IORT_NODE
argument_list|,
name|IortNode
argument_list|,
name|IortNode
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpIvrs  *  * PARAMETERS:  Table               - A IVRS table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a IVRS  *  ******************************************************************************/
end_comment

begin_decl_stmt
specifier|static
name|UINT8
name|EntrySizes
index|[]
init|=
block|{
literal|4
block|,
literal|8
block|,
literal|16
block|,
literal|32
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|AcpiDmDumpIvrs
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_IVRS
argument_list|)
decl_stmt|;
name|UINT32
name|EntryOffset
decl_stmt|;
name|UINT32
name|EntryLength
decl_stmt|;
name|UINT32
name|EntryType
decl_stmt|;
name|ACPI_IVRS_DE_HEADER
modifier|*
name|DeviceEntry
decl_stmt|;
name|ACPI_IVRS_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoIvrs
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IVRS_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoIvrsHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
switch|switch
condition|(
name|SubTable
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_IVRS_TYPE_HARDWARE
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoIvrs0
expr_stmt|;
break|break;
case|case
name|ACPI_IVRS_TYPE_MEMORY1
case|:
case|case
name|ACPI_IVRS_TYPE_MEMORY2
case|:
case|case
name|ACPI_IVRS_TYPE_MEMORY3
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoIvrs1
expr_stmt|;
break|break;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown IVRS subtable type 0x%X\n"
argument_list|,
name|SubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
comment|/* Attempt to continue */
if|if
condition|(
operator|!
name|SubTable
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Invalid zero length subtable\n"
argument_list|)
expr_stmt|;
return|return;
block|}
goto|goto
name|NextSubTable
goto|;
block|}
comment|/* Dump the subtable */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* The hardware subtable can contain multiple device entries */
if|if
condition|(
name|SubTable
operator|->
name|Type
operator|==
name|ACPI_IVRS_TYPE_HARDWARE
condition|)
block|{
name|EntryOffset
operator|=
name|Offset
operator|+
sizeof|sizeof
argument_list|(
name|ACPI_IVRS_HARDWARE
argument_list|)
expr_stmt|;
name|DeviceEntry
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IVRS_DE_HEADER
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_IVRS_HARDWARE
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|EntryOffset
operator|<
operator|(
name|Offset
operator|+
name|SubTable
operator|->
name|Length
operator|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/*                  * Upper 2 bits of Type encode the length of the device entry                  *                  * 00 = 4 byte                  * 01 = 8 byte                  * 10 = 16 byte - currently no entries defined                  * 11 = 32 byte - currently no entries defined                  */
name|EntryType
operator|=
name|DeviceEntry
operator|->
name|Type
expr_stmt|;
name|EntryLength
operator|=
name|EntrySizes
index|[
name|EntryType
operator|>>
literal|6
index|]
expr_stmt|;
switch|switch
condition|(
name|EntryType
condition|)
block|{
comment|/* 4-byte device entries */
case|case
name|ACPI_IVRS_TYPE_PAD4
case|:
case|case
name|ACPI_IVRS_TYPE_ALL
case|:
case|case
name|ACPI_IVRS_TYPE_SELECT
case|:
case|case
name|ACPI_IVRS_TYPE_START
case|:
case|case
name|ACPI_IVRS_TYPE_END
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoIvrs4
expr_stmt|;
break|break;
comment|/* 8-byte entries, type A */
case|case
name|ACPI_IVRS_TYPE_ALIAS_SELECT
case|:
case|case
name|ACPI_IVRS_TYPE_ALIAS_START
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoIvrs8a
expr_stmt|;
break|break;
comment|/* 8-byte entries, type B */
case|case
name|ACPI_IVRS_TYPE_PAD8
case|:
case|case
name|ACPI_IVRS_TYPE_EXT_SELECT
case|:
case|case
name|ACPI_IVRS_TYPE_EXT_START
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoIvrs8b
expr_stmt|;
break|break;
comment|/* 8-byte entries, type C */
case|case
name|ACPI_IVRS_TYPE_SPECIAL
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoIvrs8c
expr_stmt|;
break|break;
default|default:
name|InfoTable
operator|=
name|AcpiDmTableInfoIvrs4
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown IVRS device entry type/length: "
literal|"0x%.2X/0x%X at offset 0x%.4X: (header below)\n"
argument_list|,
name|EntryType
argument_list|,
name|EntryLength
argument_list|,
name|EntryOffset
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* Dump the Device Entry */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|EntryOffset
argument_list|,
name|DeviceEntry
argument_list|,
name|EntryLength
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
name|EntryOffset
operator|+=
name|EntryLength
expr_stmt|;
name|DeviceEntry
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IVRS_DE_HEADER
argument_list|,
name|DeviceEntry
argument_list|,
name|EntryLength
argument_list|)
expr_stmt|;
block|}
block|}
name|NextSubTable
label|:
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_IVRS_HEADER
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpLpit  *  * PARAMETERS:  Table               - A LPIT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a LPIT. This table type consists  *              of an open-ended number of subtables. Note: There are no  *              entries in the main table. An LPIT consists of the table  *              header and then subtables only.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpLpit
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_LPIT_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_LPIT
argument_list|)
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
name|UINT32
name|SubTableLength
decl_stmt|;
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_LPIT_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_LPIT_HEADER
argument_list|)
argument_list|,
name|AcpiDmTableInfoLpitHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
switch|switch
condition|(
name|SubTable
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_LPIT_TYPE_NATIVE_CSTATE
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoLpit0
expr_stmt|;
name|SubTableLength
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_LPIT_NATIVE
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* Cannot continue on unknown type - no length */
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown LPIT subtable type 0x%X\n"
argument_list|,
name|SubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
return|return;
block|}
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTableLength
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTableLength
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_LPIT_HEADER
argument_list|,
name|SubTable
argument_list|,
name|SubTableLength
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpMadt  *  * PARAMETERS:  Table               - A MADT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a MADT. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpMadt
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_SUBTABLE_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_MADT
argument_list|)
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoMadt
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_SUBTABLE_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoMadtHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
switch|switch
condition|(
name|SubTable
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_MADT_TYPE_LOCAL_APIC
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt0
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_IO_APIC
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt1
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_INTERRUPT_OVERRIDE
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt2
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_NMI_SOURCE
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt3
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_LOCAL_APIC_NMI
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt4
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_LOCAL_APIC_OVERRIDE
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt5
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_IO_SAPIC
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt6
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_LOCAL_SAPIC
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt7
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_INTERRUPT_SOURCE
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt8
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_LOCAL_X2APIC
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt9
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_LOCAL_X2APIC_NMI
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt10
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_GENERIC_INTERRUPT
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt11
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_GENERIC_DISTRIBUTOR
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt12
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_GENERIC_MSI_FRAME
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt13
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_GENERIC_REDISTRIBUTOR
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt14
expr_stmt|;
break|break;
case|case
name|ACPI_MADT_TYPE_GENERIC_TRANSLATOR
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoMadt15
expr_stmt|;
break|break;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown MADT subtable type 0x%X\n\n"
argument_list|,
name|SubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
comment|/* Attempt to continue */
if|if
condition|(
operator|!
name|SubTable
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Invalid zero length subtable\n"
argument_list|)
expr_stmt|;
return|return;
block|}
goto|goto
name|NextSubTable
goto|;
block|}
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|NextSubTable
label|:
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_SUBTABLE_HEADER
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpMcfg  *  * PARAMETERS:  Table               - A MCFG Table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a MCFG table  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpMcfg
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_MCFG
argument_list|)
decl_stmt|;
name|ACPI_MCFG_ALLOCATION
modifier|*
name|SubTable
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoMcfg
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_MCFG_ALLOCATION
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
if|if
condition|(
name|Offset
operator|+
sizeof|sizeof
argument_list|(
name|ACPI_MCFG_ALLOCATION
argument_list|)
operator|>
name|Table
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Warning: there are %u invalid trailing bytes\n"
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MCFG_ALLOCATION
argument_list|)
operator|-
operator|(
name|Offset
operator|-
name|Table
operator|->
name|Length
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MCFG_ALLOCATION
argument_list|)
argument_list|,
name|AcpiDmTableInfoMcfg0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to next subtable (each subtable is of fixed length) */
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_MCFG_ALLOCATION
argument_list|)
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_MCFG_ALLOCATION
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MCFG_ALLOCATION
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpMpst  *  * PARAMETERS:  Table               - A MPST Table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a MPST table  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpMpst
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_MPST
argument_list|)
decl_stmt|;
name|ACPI_MPST_POWER_NODE
modifier|*
name|SubTable0
decl_stmt|;
name|ACPI_MPST_POWER_STATE
modifier|*
name|SubTable0A
decl_stmt|;
name|ACPI_MPST_COMPONENT
modifier|*
name|SubTable0B
decl_stmt|;
name|ACPI_MPST_DATA_HDR
modifier|*
name|SubTable1
decl_stmt|;
name|ACPI_MPST_POWER_DATA
modifier|*
name|SubTable2
decl_stmt|;
name|UINT16
name|SubtableCount
decl_stmt|;
name|UINT32
name|PowerStateCount
decl_stmt|;
name|UINT32
name|ComponentCount
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoMpst
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtable: Memory Power Node(s) */
name|SubtableCount
operator|=
operator|(
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_TABLE_MPST
argument_list|,
name|Table
argument_list|)
operator|)
operator|->
name|PowerNodeCount
expr_stmt|;
name|SubTable0
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_MPST_POWER_NODE
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|Offset
operator|<
name|Table
operator|->
name|Length
operator|)
operator|&&
name|SubtableCount
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable0
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MPST_POWER_NODE
argument_list|)
argument_list|,
name|AcpiDmTableInfoMpst0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Extract the sub-subtable counts */
name|PowerStateCount
operator|=
name|SubTable0
operator|->
name|NumPowerStates
expr_stmt|;
name|ComponentCount
operator|=
name|SubTable0
operator|->
name|NumPhysicalComponents
expr_stmt|;
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_MPST_POWER_NODE
argument_list|)
expr_stmt|;
comment|/* Sub-subtables - Memory Power State Structure(s) */
name|SubTable0A
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_MPST_POWER_STATE
argument_list|,
name|SubTable0
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MPST_POWER_NODE
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|PowerStateCount
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable0A
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MPST_POWER_STATE
argument_list|)
argument_list|,
name|AcpiDmTableInfoMpst0A
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|SubTable0A
operator|++
expr_stmt|;
name|PowerStateCount
operator|--
expr_stmt|;
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_MPST_POWER_STATE
argument_list|)
expr_stmt|;
block|}
comment|/* Sub-subtables - Physical Component ID Structure(s) */
name|SubTable0B
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_MPST_COMPONENT
argument_list|,
name|SubTable0A
argument_list|)
expr_stmt|;
if|if
condition|(
name|ComponentCount
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|ComponentCount
condition|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable0B
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MPST_COMPONENT
argument_list|)
argument_list|,
name|AcpiDmTableInfoMpst0B
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|SubTable0B
operator|++
expr_stmt|;
name|ComponentCount
operator|--
expr_stmt|;
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_MPST_COMPONENT
argument_list|)
expr_stmt|;
block|}
comment|/* Point to next Memory Power Node subtable */
name|SubtableCount
operator|--
expr_stmt|;
name|SubTable0
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_MPST_POWER_NODE
argument_list|,
name|SubTable0
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MPST_POWER_NODE
argument_list|)
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|ACPI_MPST_POWER_STATE
argument_list|)
operator|*
name|SubTable0
operator|->
name|NumPowerStates
operator|)
operator|+
operator|(
sizeof|sizeof
argument_list|(
name|ACPI_MPST_COMPONENT
argument_list|)
operator|*
name|SubTable0
operator|->
name|NumPhysicalComponents
operator|)
argument_list|)
expr_stmt|;
block|}
comment|/* Subtable: Count of Memory Power State Characteristic structures */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|SubTable1
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_MPST_DATA_HDR
argument_list|,
name|SubTable0
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable1
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MPST_DATA_HDR
argument_list|)
argument_list|,
name|AcpiDmTableInfoMpst1
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|SubtableCount
operator|=
name|SubTable1
operator|->
name|CharacteristicsCount
expr_stmt|;
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_MPST_DATA_HDR
argument_list|)
expr_stmt|;
comment|/* Subtable: Memory Power State Characteristics structure(s) */
name|SubTable2
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_MPST_POWER_DATA
argument_list|,
name|SubTable1
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MPST_DATA_HDR
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|Offset
operator|<
name|Table
operator|->
name|Length
operator|)
operator|&&
name|SubtableCount
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable2
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MPST_POWER_DATA
argument_list|)
argument_list|,
name|AcpiDmTableInfoMpst2
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|SubTable2
operator|++
expr_stmt|;
name|SubtableCount
operator|--
expr_stmt|;
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_MPST_POWER_DATA
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpMsct  *  * PARAMETERS:  Table               - A MSCT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a MSCT  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpMsct
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_MSCT
argument_list|)
decl_stmt|;
name|ACPI_MSCT_PROXIMITY
modifier|*
name|SubTable
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoMsct
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_MSCT_PROXIMITY
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MSCT_PROXIMITY
argument_list|)
argument_list|,
name|AcpiDmTableInfoMsct0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to next subtable */
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_MSCT_PROXIMITY
argument_list|)
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_MSCT_PROXIMITY
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MSCT_PROXIMITY
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpMtmr  *  * PARAMETERS:  Table               - A MTMR table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a MTMR  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpMtmr
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_MTMR
argument_list|)
decl_stmt|;
name|ACPI_MTMR_ENTRY
modifier|*
name|SubTable
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoMtmr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_MTMR_ENTRY
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MTMR_ENTRY
argument_list|)
argument_list|,
name|AcpiDmTableInfoMtmr0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to next subtable */
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_MTMR_ENTRY
argument_list|)
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_MTMR_ENTRY
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_MTMR_ENTRY
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpNfit  *  * PARAMETERS:  Table               - A NFIT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of an NFIT.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpNfit
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_NFIT
argument_list|)
decl_stmt|;
name|UINT32
name|FieldOffset
init|=
literal|0
decl_stmt|;
name|UINT32
name|Length
decl_stmt|;
name|ACPI_NFIT_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
name|ACPI_NFIT_INTERLEAVE
modifier|*
name|Interleave
init|=
name|NULL
decl_stmt|;
name|ACPI_NFIT_SMBIOS
modifier|*
name|SmbiosInfo
init|=
name|NULL
decl_stmt|;
name|ACPI_NFIT_FLUSH_ADDRESS
modifier|*
name|Hint
init|=
name|NULL
decl_stmt|;
name|UINT32
name|i
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoNfit
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_NFIT_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* NFIT subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoNfitHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
switch|switch
condition|(
name|SubTable
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_NFIT_TYPE_SYSTEM_ADDRESS
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoNfit0
expr_stmt|;
break|break;
case|case
name|ACPI_NFIT_TYPE_MEMORY_MAP
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoNfit1
expr_stmt|;
break|break;
case|case
name|ACPI_NFIT_TYPE_INTERLEAVE
case|:
comment|/* Has a variable number of 32-bit values at the end */
name|InfoTable
operator|=
name|AcpiDmTableInfoNfit2
expr_stmt|;
name|Interleave
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_NFIT_INTERLEAVE
argument_list|,
name|SubTable
argument_list|)
expr_stmt|;
name|FieldOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_NFIT_INTERLEAVE
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACPI_NFIT_TYPE_SMBIOS
case|:
name|SmbiosInfo
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_NFIT_SMBIOS
argument_list|,
name|SubTable
argument_list|)
expr_stmt|;
name|InfoTable
operator|=
name|AcpiDmTableInfoNfit3
expr_stmt|;
break|break;
case|case
name|ACPI_NFIT_TYPE_CONTROL_REGION
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoNfit4
expr_stmt|;
break|break;
case|case
name|ACPI_NFIT_TYPE_DATA_REGION
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoNfit5
expr_stmt|;
break|break;
case|case
name|ACPI_NFIT_TYPE_FLUSH_ADDRESS
case|:
comment|/* Has a variable number of 64-bit addresses at the end */
name|InfoTable
operator|=
name|AcpiDmTableInfoNfit6
expr_stmt|;
name|Hint
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_NFIT_FLUSH_ADDRESS
argument_list|,
name|SubTable
argument_list|)
expr_stmt|;
name|FieldOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_NFIT_FLUSH_ADDRESS
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
expr_stmt|;
break|break;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown NFIT subtable type 0x%X\n"
argument_list|,
name|SubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
comment|/* Attempt to continue */
if|if
condition|(
operator|!
name|SubTable
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Invalid zero length subtable\n"
argument_list|)
expr_stmt|;
return|return;
block|}
goto|goto
name|NextSubTable
goto|;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Per-subtable variable-length fields */
switch|switch
condition|(
name|SubTable
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_NFIT_TYPE_INTERLEAVE
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Interleave
operator|->
name|LineCount
condition|;
name|i
operator|++
control|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
operator|+
name|FieldOffset
argument_list|,
operator|&
name|Interleave
operator|->
name|LineOffset
index|[
name|i
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|UINT32
argument_list|)
argument_list|,
name|AcpiDmTableInfoNfit2a
argument_list|)
expr_stmt|;
name|FieldOffset
operator|+=
sizeof|sizeof
argument_list|(
name|UINT32
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ACPI_NFIT_TYPE_SMBIOS
case|:
name|Length
operator|=
name|SubTable
operator|->
name|Length
operator|-
sizeof|sizeof
argument_list|(
name|ACPI_NFIT_SMBIOS
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|UINT8
argument_list|)
expr_stmt|;
if|if
condition|(
name|Length
condition|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_NFIT_SMBIOS
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
name|UINT8
argument_list|)
argument_list|,
name|SmbiosInfo
argument_list|,
name|Length
argument_list|,
name|AcpiDmTableInfoNfit3a
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
block|}
break|break;
case|case
name|ACPI_NFIT_TYPE_FLUSH_ADDRESS
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Hint
operator|->
name|HintCount
condition|;
name|i
operator|++
control|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
operator|+
name|FieldOffset
argument_list|,
operator|&
name|Hint
operator|->
name|HintAddress
index|[
name|i
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
argument_list|,
name|AcpiDmTableInfoNfit6a
argument_list|)
expr_stmt|;
name|FieldOffset
operator|+=
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
name|NextSubTable
label|:
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_NFIT_HEADER
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpPcct  *  * PARAMETERS:  Table               - A PCCT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a PCCT. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpPcct
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_PCCT_SUBSPACE
modifier|*
name|SubTable
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_PCCT
argument_list|)
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoPcct
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_PCCT_SUBSPACE
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Header
operator|.
name|Length
argument_list|,
name|AcpiDmTableInfoPcctHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
switch|switch
condition|(
name|SubTable
operator|->
name|Header
operator|.
name|Type
condition|)
block|{
case|case
name|ACPI_PCCT_TYPE_GENERIC_SUBSPACE
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoPcct0
expr_stmt|;
break|break;
case|case
name|ACPI_PCCT_TYPE_HW_REDUCED_SUBSPACE
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoPcct1
expr_stmt|;
break|break;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unexpected or unknown PCCT subtable type 0x%X\n\n"
argument_list|,
name|SubTable
operator|->
name|Header
operator|.
name|Type
argument_list|)
expr_stmt|;
return|return;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Header
operator|.
name|Length
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Header
operator|.
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_PCCT_SUBSPACE
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Header
operator|.
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpPmtt  *  * PARAMETERS:  Table               - A PMTT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a PMTT. This table type consists  *              of an open-ended number of subtables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpPmtt
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_PMTT_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|ACPI_PMTT_HEADER
modifier|*
name|MemSubTable
decl_stmt|;
name|ACPI_PMTT_HEADER
modifier|*
name|DimmSubTable
decl_stmt|;
name|ACPI_PMTT_DOMAIN
modifier|*
name|DomainArray
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_PMTT
argument_list|)
decl_stmt|;
name|UINT32
name|MemOffset
decl_stmt|;
name|UINT32
name|DimmOffset
decl_stmt|;
name|UINT32
name|DomainOffset
decl_stmt|;
name|UINT32
name|DomainCount
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoPmtt
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_PMTT_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoPmttHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Only Socket subtables are expected at this level */
if|if
condition|(
name|SubTable
operator|->
name|Type
operator|!=
name|ACPI_PMTT_TYPE_SOCKET
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unexpected or unknown PMTT subtable type 0x%X\n\n"
argument_list|,
name|SubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* Dump the fixed-length portion of the subtable */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoPmtt0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Walk the memory controller subtables */
name|MemOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_PMTT_SOCKET
argument_list|)
expr_stmt|;
name|MemSubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_PMTT_HEADER
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_PMTT_SOCKET
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
operator|(
name|Offset
operator|+
name|MemOffset
operator|)
operator|<
name|Table
operator|->
name|Length
operator|)
operator|&&
operator|(
name|MemOffset
operator|<
name|SubTable
operator|->
name|Length
operator|)
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
operator|+
name|MemOffset
argument_list|,
name|MemSubTable
argument_list|,
name|MemSubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoPmttHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Only memory controller subtables are expected at this level */
if|if
condition|(
name|MemSubTable
operator|->
name|Type
operator|!=
name|ACPI_PMTT_TYPE_CONTROLLER
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unexpected or unknown PMTT subtable type 0x%X\n\n"
argument_list|,
name|MemSubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* Dump the fixed-length portion of the controller subtable */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
operator|+
name|MemOffset
argument_list|,
name|MemSubTable
argument_list|,
name|MemSubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoPmtt1
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Walk the variable count of proximity domains */
name|DomainCount
operator|=
operator|(
operator|(
name|ACPI_PMTT_CONTROLLER
operator|*
operator|)
name|MemSubTable
operator|)
operator|->
name|DomainCount
expr_stmt|;
name|DomainOffset
operator|=
sizeof|sizeof
argument_list|(
name|ACPI_PMTT_CONTROLLER
argument_list|)
expr_stmt|;
name|DomainArray
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_PMTT_DOMAIN
argument_list|,
name|MemSubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_PMTT_CONTROLLER
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
operator|(
name|Offset
operator|+
name|MemOffset
operator|+
name|DomainOffset
operator|)
operator|<
name|Table
operator|->
name|Length
operator|)
operator|&&
operator|(
operator|(
name|MemOffset
operator|+
name|DomainOffset
operator|)
operator|<
name|SubTable
operator|->
name|Length
operator|)
operator|&&
name|DomainCount
condition|)
block|{
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
operator|+
name|MemOffset
operator|+
name|DomainOffset
argument_list|,
name|DomainArray
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_PMTT_DOMAIN
argument_list|)
argument_list|,
name|AcpiDmTableInfoPmtt1a
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|DomainOffset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_PMTT_DOMAIN
argument_list|)
expr_stmt|;
name|DomainArray
operator|++
expr_stmt|;
name|DomainCount
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|DomainCount
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n**** DomainCount exceeds subtable length\n\n"
argument_list|)
expr_stmt|;
block|}
comment|/* Walk the physical component (DIMM) subtables */
name|DimmOffset
operator|=
name|DomainOffset
expr_stmt|;
name|DimmSubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_PMTT_HEADER
argument_list|,
name|MemSubTable
argument_list|,
name|DomainOffset
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
operator|(
name|Offset
operator|+
name|MemOffset
operator|+
name|DimmOffset
operator|)
operator|<
name|Table
operator|->
name|Length
operator|)
operator|&&
operator|(
name|DimmOffset
operator|<
name|MemSubTable
operator|->
name|Length
operator|)
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
operator|+
name|MemOffset
operator|+
name|DimmOffset
argument_list|,
name|DimmSubTable
argument_list|,
name|DimmSubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoPmttHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Only DIMM subtables are expected at this level */
if|if
condition|(
name|DimmSubTable
operator|->
name|Type
operator|!=
name|ACPI_PMTT_TYPE_DIMM
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unexpected or unknown PMTT subtable type 0x%X\n\n"
argument_list|,
name|DimmSubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* Dump the fixed-length DIMM subtable */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
name|Offset
operator|+
name|MemOffset
operator|+
name|DimmOffset
argument_list|,
name|DimmSubTable
argument_list|,
name|DimmSubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoPmtt2
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to next DIMM subtable */
name|DimmOffset
operator|+=
name|DimmSubTable
operator|->
name|Length
expr_stmt|;
name|DimmSubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_PMTT_HEADER
argument_list|,
name|DimmSubTable
argument_list|,
name|DimmSubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
comment|/* Point to next Controller subtable */
name|MemOffset
operator|+=
name|MemSubTable
operator|->
name|Length
expr_stmt|;
name|MemSubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_PMTT_HEADER
argument_list|,
name|MemSubTable
argument_list|,
name|MemSubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
comment|/* Point to next Socket subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_PMTT_HEADER
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpS3pt  *  * PARAMETERS:  Table               - A S3PT table  *  * RETURN:      Length of the table  *  * DESCRIPTION: Format the contents of a S3PT  *  ******************************************************************************/
end_comment

begin_function
name|UINT32
name|AcpiDmDumpS3pt
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Tables
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_S3PT
argument_list|)
decl_stmt|;
name|ACPI_S3PT_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
name|ACPI_TABLE_S3PT
modifier|*
name|S3ptTable
init|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_TABLE_S3PT
argument_list|,
name|Tables
argument_list|)
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Offset
argument_list|,
literal|0
argument_list|,
name|S3ptTable
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoS3pt
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return
literal|0
return|;
block|}
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_S3PT_HEADER
argument_list|,
name|S3ptTable
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|S3ptTable
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|S3ptTable
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoS3ptHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return
literal|0
return|;
block|}
switch|switch
condition|(
name|SubTable
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_S3PT_TYPE_RESUME
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoS3pt0
expr_stmt|;
break|break;
case|case
name|ACPI_S3PT_TYPE_SUSPEND
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoS3pt1
expr_stmt|;
break|break;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown S3PT subtable type 0x%X\n"
argument_list|,
name|SubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
comment|/* Attempt to continue */
if|if
condition|(
operator|!
name|SubTable
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Invalid zero length subtable\n"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
goto|goto
name|NextSubTable
goto|;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|S3ptTable
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return
literal|0
return|;
block|}
name|NextSubTable
label|:
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_S3PT_HEADER
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|S3ptTable
operator|->
name|Length
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpSlic  *  * PARAMETERS:  Table               - A SLIC table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a SLIC  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpSlic
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_HEADER
argument_list|)
argument_list|,
name|Table
argument_list|,
name|Table
operator|->
name|Length
operator|-
sizeof|sizeof
argument_list|(
operator|*
name|Table
argument_list|)
argument_list|,
name|AcpiDmTableInfoSlic
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpSlit  *  * PARAMETERS:  Table               - An SLIT  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a SLIT  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpSlit
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
decl_stmt|;
name|UINT8
modifier|*
name|Row
decl_stmt|;
name|UINT32
name|Localities
decl_stmt|;
name|UINT32
name|i
decl_stmt|;
name|UINT32
name|j
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoSlit
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Display the Locality NxN Matrix */
name|Localities
operator|=
operator|(
name|UINT32
operator|)
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_TABLE_SLIT
argument_list|,
name|Table
argument_list|)
operator|->
name|LocalityCount
expr_stmt|;
name|Offset
operator|=
name|ACPI_OFFSET
argument_list|(
name|ACPI_TABLE_SLIT
argument_list|,
name|Entry
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|Row
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_TABLE_SLIT
argument_list|,
name|Table
argument_list|)
operator|->
name|Entry
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Localities
condition|;
name|i
operator|++
control|)
block|{
comment|/* Display one row of the matrix */
name|AcpiDmLineHeader2
argument_list|(
name|Offset
argument_list|,
name|Localities
argument_list|,
literal|"Locality"
argument_list|,
name|i
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|Localities
condition|;
name|j
operator|++
control|)
block|{
comment|/* Check for beyond EOT */
if|if
condition|(
name|Offset
operator|>=
name|Table
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Not enough room in table for all localities\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"%2.2X"
argument_list|,
name|Row
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|Offset
operator|++
expr_stmt|;
comment|/* Display up to 16 bytes per output row */
if|if
condition|(
operator|(
name|j
operator|+
literal|1
operator|)
operator|<
name|Localities
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|&&
operator|(
operator|(
operator|(
name|j
operator|+
literal|1
operator|)
operator|%
literal|16
operator|)
operator|==
literal|0
operator|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"\\\n"
argument_list|)
expr_stmt|;
comment|/* With line continuation char */
name|AcpiDmLineHeader
argument_list|(
name|Offset
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
block|}
comment|/* Point to next row */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Row
operator|+=
name|Localities
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpSrat  *  * PARAMETERS:  Table               - A SRAT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a SRAT  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpSrat
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_SRAT
argument_list|)
decl_stmt|;
name|ACPI_SUBTABLE_HEADER
modifier|*
name|SubTable
decl_stmt|;
name|ACPI_DMTABLE_INFO
modifier|*
name|InfoTable
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoSrat
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_SUBTABLE_HEADER
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|AcpiDmTableInfoSratHdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
switch|switch
condition|(
name|SubTable
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_SRAT_TYPE_CPU_AFFINITY
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoSrat0
expr_stmt|;
break|break;
case|case
name|ACPI_SRAT_TYPE_MEMORY_AFFINITY
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoSrat1
expr_stmt|;
break|break;
case|case
name|ACPI_SRAT_TYPE_X2APIC_CPU_AFFINITY
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoSrat2
expr_stmt|;
break|break;
case|case
name|ACPI_SRAT_TYPE_GICC_AFFINITY
case|:
name|InfoTable
operator|=
name|AcpiDmTableInfoSrat3
expr_stmt|;
break|break;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"\n**** Unknown SRAT subtable type 0x%X\n"
argument_list|,
name|SubTable
operator|->
name|Type
argument_list|)
expr_stmt|;
comment|/* Attempt to continue */
if|if
condition|(
operator|!
name|SubTable
operator|->
name|Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Invalid zero length subtable\n"
argument_list|)
expr_stmt|;
return|return;
block|}
goto|goto
name|NextSubTable
goto|;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|,
name|InfoTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
name|NextSubTable
label|:
comment|/* Point to next subtable */
name|Offset
operator|+=
name|SubTable
operator|->
name|Length
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_SUBTABLE_HEADER
argument_list|,
name|SubTable
argument_list|,
name|SubTable
operator|->
name|Length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpStao  *  * PARAMETERS:  Table               - A STAO table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a STAO. This is a variable-length  *              table that contains an open-ended number of ASCII strings  *              at the end of the table.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpStao
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|char
modifier|*
name|Namepath
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT32
name|StringLength
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_STAO
argument_list|)
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoStao
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* The rest of the table consists of Namepath strings */
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
name|Namepath
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|char
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
name|StringLength
operator|=
name|strlen
argument_list|(
name|Namepath
argument_list|)
operator|+
literal|1
expr_stmt|;
name|AcpiDmLineHeader
argument_list|(
name|Offset
argument_list|,
name|StringLength
argument_list|,
literal|"Namestring"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"\"%s\"\n"
argument_list|,
name|Namepath
argument_list|)
expr_stmt|;
comment|/* Point to next namepath */
name|Offset
operator|+=
name|StringLength
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpVrtc  *  * PARAMETERS:  Table               - A VRTC table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a VRTC  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpVrtc
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_VRTC
argument_list|)
decl_stmt|;
name|ACPI_VRTC_ENTRY
modifier|*
name|SubTable
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoVrtc
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_VRTC_ENTRY
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_VRTC_ENTRY
argument_list|)
argument_list|,
name|AcpiDmTableInfoVrtc0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to next subtable */
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_VRTC_ENTRY
argument_list|)
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_VRTC_ENTRY
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_VRTC_ENTRY
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpWdat  *  * PARAMETERS:  Table               - A WDAT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a WDAT  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpWdat
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT32
name|Offset
init|=
sizeof|sizeof
argument_list|(
name|ACPI_TABLE_WDAT
argument_list|)
decl_stmt|;
name|ACPI_WDAT_ENTRY
modifier|*
name|SubTable
decl_stmt|;
comment|/* Main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoWdat
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Subtables */
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_WDAT_ENTRY
argument_list|,
name|Table
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
while|while
condition|(
name|Offset
operator|<
name|Table
operator|->
name|Length
condition|)
block|{
comment|/* Common subtable header */
name|AcpiOsPrintf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
name|Offset
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_WDAT_ENTRY
argument_list|)
argument_list|,
name|AcpiDmTableInfoWdat0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Point to next subtable */
name|Offset
operator|+=
sizeof|sizeof
argument_list|(
name|ACPI_WDAT_ENTRY
argument_list|)
expr_stmt|;
name|SubTable
operator|=
name|ACPI_ADD_PTR
argument_list|(
name|ACPI_WDAT_ENTRY
argument_list|,
name|SubTable
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_WDAT_ENTRY
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmDumpWpbt  *  * PARAMETERS:  Table               - A WPBT table  *  * RETURN:      None  *  * DESCRIPTION: Format the contents of a WPBT. This table type consists  *              of an open-ended arguments buffer at the end of the table.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDmDumpWpbt
parameter_list|(
name|ACPI_TABLE_HEADER
modifier|*
name|Table
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_TABLE_WPBT
modifier|*
name|SubTable
decl_stmt|;
name|UINT32
name|Length
init|=
name|Table
operator|->
name|Length
decl_stmt|;
name|UINT16
name|ArgumentsLength
decl_stmt|;
comment|/* Dump the main table */
name|Status
operator|=
name|AcpiDmDumpTable
argument_list|(
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
literal|0
argument_list|,
name|AcpiDmTableInfoWpbt
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Extract the arguments buffer length from the main table */
name|SubTable
operator|=
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_TABLE_WPBT
argument_list|,
name|Table
argument_list|)
expr_stmt|;
name|ArgumentsLength
operator|=
name|SubTable
operator|->
name|ArgumentsLength
expr_stmt|;
comment|/* Dump the arguments buffer */
name|AcpiDmDumpTable
argument_list|(
name|Table
operator|->
name|Length
argument_list|,
literal|0
argument_list|,
name|Table
argument_list|,
name|ArgumentsLength
argument_list|,
name|AcpiDmTableInfoWpbt0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
block|}
end_function

end_unit

