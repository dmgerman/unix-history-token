begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2013 Qualcomm Atheros, Inc.  *  * Permission to use, copy, modify, and/or distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH  * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY  * AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,  * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM  * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR  * OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR  * PERFORMANCE OF THIS SOFTWARE.  */
end_comment

begin_include
include|#
directive|include
file|"opt_ah.h"
end_include

begin_include
include|#
directive|include
file|"ah.h"
end_include

begin_include
include|#
directive|include
file|"ah_desc.h"
end_include

begin_include
include|#
directive|include
file|"ah_internal.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300reg.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300desc.h"
end_include

begin_comment
comment|/*  * Get the RXDP.  */
end_comment

begin_function
name|u_int32_t
name|ar9300_get_rx_dp
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ath
parameter_list|,
name|HAL_RX_QUEUE
name|qtype
parameter_list|)
block|{
if|if
condition|(
name|qtype
operator|==
name|HAL_RX_QUEUE_HP
condition|)
block|{
return|return
name|OS_REG_READ
argument_list|(
name|ath
argument_list|,
name|AR_HP_RXDP
argument_list|)
return|;
block|}
else|else
block|{
return|return
name|OS_REG_READ
argument_list|(
name|ath
argument_list|,
name|AR_LP_RXDP
argument_list|)
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * Set the rx_dp.  */
end_comment

begin_function
name|void
name|ar9300_set_rx_dp
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int32_t
name|rxdp
parameter_list|,
name|HAL_RX_QUEUE
name|qtype
parameter_list|)
block|{
name|HALASSERT
argument_list|(
operator|(
name|qtype
operator|==
name|HAL_RX_QUEUE_HP
operator|)
operator|||
operator|(
name|qtype
operator|==
name|HAL_RX_QUEUE_LP
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|qtype
operator|==
name|HAL_RX_QUEUE_HP
condition|)
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_HP_RXDP
argument_list|,
name|rxdp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_LP_RXDP
argument_list|,
name|rxdp
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Set Receive Enable bits.  */
end_comment

begin_function
name|void
name|ar9300_enable_receive
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_CR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Set the RX abort bit.  */
end_comment

begin_function
name|HAL_BOOL
name|ar9300_set_rx_abort
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_BOOL
name|set
parameter_list|)
block|{
if|if
condition|(
name|set
condition|)
block|{
comment|/* Set the force_rx_abort bit */
name|OS_REG_SET_BIT
argument_list|(
name|ah
argument_list|,
name|AR_DIAG_SW
argument_list|,
operator|(
name|AR_DIAG_RX_DIS
operator||
name|AR_DIAG_RX_ABORT
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|AH9300
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_reset_reason
operator|==
name|HAL_RESET_BBPANIC
condition|)
block|{
comment|/* depending upon the BB panic status, rx state may not return to 0,              * so skipping the wait for BB panic reset */
name|OS_REG_CLR_BIT
argument_list|(
name|ah
argument_list|,
name|AR_DIAG_SW
argument_list|,
operator|(
name|AR_DIAG_RX_DIS
operator||
name|AR_DIAG_RX_ABORT
operator|)
argument_list|)
expr_stmt|;
return|return
name|AH_FALSE
return|;
block|}
else|else
block|{
name|HAL_BOOL
name|okay
decl_stmt|;
name|okay
operator|=
name|ath_hal_wait
argument_list|(
name|ah
argument_list|,
name|AR_OBS_BUS_1
argument_list|,
name|AR_OBS_BUS_1_RX_STATE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Wait for Rx state to return to 0 */
if|if
condition|(
operator|!
name|okay
condition|)
block|{
comment|/* abort: chip rx failed to go idle in 10 ms */
name|OS_REG_CLR_BIT
argument_list|(
name|ah
argument_list|,
name|AR_DIAG_SW
argument_list|,
operator|(
name|AR_DIAG_RX_DIS
operator||
name|AR_DIAG_RX_ABORT
operator|)
argument_list|)
expr_stmt|;
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RX
argument_list|,
literal|"%s: rx failed to go idle in 10 ms RXSM=0x%x\n"
argument_list|,
name|__func__
argument_list|,
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_OBS_BUS_1
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|AH_FALSE
return|;
comment|/* failure */
block|}
block|}
block|}
else|else
block|{
name|OS_REG_CLR_BIT
argument_list|(
name|ah
argument_list|,
name|AR_DIAG_SW
argument_list|,
operator|(
name|AR_DIAG_RX_DIS
operator||
name|AR_DIAG_RX_ABORT
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
name|AH_TRUE
return|;
comment|/* success */
block|}
end_function

begin_comment
comment|/*  * Stop Receive at the DMA engine  */
end_comment

begin_function
name|HAL_BOOL
name|ar9300_stop_dma_receive
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int
name|timeout
parameter_list|)
block|{
name|int
name|wait
decl_stmt|;
name|HAL_BOOL
name|status
decl_stmt|,
name|okay
decl_stmt|;
name|u_int32_t
name|org_value
decl_stmt|;
define|#
directive|define
name|AH_RX_STOP_DMA_TIMEOUT
value|10000
comment|/* usec */
define|#
directive|define
name|AH_TIME_QUANTUM
value|100
comment|/* usec */
name|OS_MARK
argument_list|(
name|ah
argument_list|,
name|AH_MARK_RX_CTL
argument_list|,
name|AH_MARK_RX_CTL_DMA_STOP
argument_list|)
expr_stmt|;
if|if
condition|(
name|timeout
operator|==
literal|0
condition|)
block|{
name|timeout
operator|=
name|AH_RX_STOP_DMA_TIMEOUT
expr_stmt|;
block|}
name|org_value
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_MACMISC
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_MACMISC
argument_list|,
operator|(
operator|(
name|AR_MACMISC_DMA_OBS_LINE_8
operator|<<
name|AR_MACMISC_DMA_OBS_S
operator|)
operator||
operator|(
name|AR_MACMISC_MISC_OBS_BUS_1
operator|<<
name|AR_MACMISC_MISC_OBS_BUS_MSB_S
operator|)
operator|)
argument_list|)
expr_stmt|;
name|okay
operator|=
name|ath_hal_wait
argument_list|(
name|ah
argument_list|,
name|AR_DMADBG_7
argument_list|,
name|AR_DMADBG_RX_STATE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* wait for Rx DMA state machine to become idle */
if|if
condition|(
operator|!
name|okay
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RX
argument_list|,
literal|"reg AR_DMADBG_7 is not 0, instead 0x%08x\n"
argument_list|,
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_DMADBG_7
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* Set receive disable bit */
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_CR
argument_list|,
name|AR_CR_RXD
argument_list|)
expr_stmt|;
comment|/* Wait for rx enable bit to go low */
for|for
control|(
name|wait
operator|=
name|timeout
operator|/
name|AH_TIME_QUANTUM
init|;
name|wait
operator|!=
literal|0
condition|;
name|wait
operator|--
control|)
block|{
if|if
condition|(
operator|(
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_CR
argument_list|)
operator|&
name|AR_CR_RXE
operator|)
operator|==
literal|0
condition|)
block|{
break|break;
block|}
name|OS_DELAY
argument_list|(
name|AH_TIME_QUANTUM
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|wait
operator|==
literal|0
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RX
argument_list|,
literal|"%s: dma failed to stop in %d ms\n"
literal|"AR_CR=0x%08x\nAR_DIAG_SW=0x%08x\n"
argument_list|,
name|__func__
argument_list|,
name|timeout
operator|/
literal|1000
argument_list|,
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_CR
argument_list|)
argument_list|,
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_DIAG_SW
argument_list|)
argument_list|)
expr_stmt|;
name|status
operator|=
name|AH_FALSE
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|AH_TRUE
expr_stmt|;
block|}
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_MACMISC
argument_list|,
name|org_value
argument_list|)
expr_stmt|;
name|OS_MARK
argument_list|(
name|ah
argument_list|,
name|AH_MARK_RX_CTL
argument_list|,
name|status
condition|?
name|AH_MARK_RX_CTL_DMA_STOP_OK
else|:
name|AH_MARK_RX_CTL_DMA_STOP_ERR
argument_list|)
expr_stmt|;
return|return
name|status
return|;
undef|#
directive|undef
name|AH_RX_STOP_DMA_TIMEOUT
undef|#
directive|undef
name|AH_TIME_QUANTUM
block|}
end_function

begin_comment
comment|/*  * Start Transmit at the PCU engine (unpause receive)  */
end_comment

begin_function
name|void
name|ar9300_start_pcu_receive
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_BOOL
name|is_scanning
parameter_list|)
block|{
name|ar9300_enable_mib_counters
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|ar9300_ani_reset
argument_list|(
name|ah
argument_list|,
name|is_scanning
argument_list|)
expr_stmt|;
comment|/* Clear RX_DIS and RX_ABORT after enabling phy errors in ani_reset */
name|OS_REG_CLR_BIT
argument_list|(
name|ah
argument_list|,
name|AR_DIAG_SW
argument_list|,
operator|(
name|AR_DIAG_RX_DIS
operator||
name|AR_DIAG_RX_ABORT
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Stop Transmit at the PCU engine (pause receive)  */
end_comment

begin_function
name|void
name|ar9300_stop_pcu_receive
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|OS_REG_SET_BIT
argument_list|(
name|ah
argument_list|,
name|AR_DIAG_SW
argument_list|,
name|AR_DIAG_RX_DIS
argument_list|)
expr_stmt|;
name|ar9300_disable_mib_counters
argument_list|(
name|ah
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Set multicast filter 0 (lower 32-bits)  *               filter 1 (upper 32-bits)  */
end_comment

begin_function
name|void
name|ar9300_set_multicast_filter
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int32_t
name|filter0
parameter_list|,
name|u_int32_t
name|filter1
parameter_list|)
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_MCAST_FIL0
argument_list|,
name|filter0
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_MCAST_FIL1
argument_list|,
name|filter1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Get the receive filter.  */
end_comment

begin_function
name|u_int32_t
name|ar9300_get_rx_filter
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|u_int32_t
name|bits
init|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_RX_FILTER
argument_list|)
decl_stmt|;
name|u_int32_t
name|phybits
init|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_PHY_ERR
argument_list|)
decl_stmt|;
if|if
condition|(
name|phybits
operator|&
name|AR_PHY_ERR_RADAR
condition|)
block|{
name|bits
operator||=
name|HAL_RX_FILTER_PHYRADAR
expr_stmt|;
block|}
if|if
condition|(
name|phybits
operator|&
operator|(
name|AR_PHY_ERR_OFDM_TIMING
operator||
name|AR_PHY_ERR_CCK_TIMING
operator|)
condition|)
block|{
name|bits
operator||=
name|HAL_RX_FILTER_PHYERR
expr_stmt|;
block|}
return|return
name|bits
return|;
block|}
end_function

begin_comment
comment|/*  * Set the receive filter.  */
end_comment

begin_function
name|void
name|ar9300_set_rx_filter
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int32_t
name|bits
parameter_list|)
block|{
name|u_int32_t
name|phybits
decl_stmt|;
if|if
condition|(
name|AR_SREV_SCORPION
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* Enable Rx for 4 address frames */
name|bits
operator||=
name|AR_RX_4ADDRESS
expr_stmt|;
block|}
if|if
condition|(
name|AR_SREV_JUPITER
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* HW fix for rx hang and corruption. */
name|bits
operator||=
name|AR_RX_CONTROL_WRAPPER
expr_stmt|;
block|}
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_RX_FILTER
argument_list|,
name|bits
operator||
name|AR_RX_UNCOM_BA_BAR
operator||
name|AR_RX_COMPR_BAR
argument_list|)
expr_stmt|;
name|phybits
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|bits
operator|&
name|HAL_RX_FILTER_PHYRADAR
condition|)
block|{
name|phybits
operator||=
name|AR_PHY_ERR_RADAR
expr_stmt|;
block|}
if|if
condition|(
name|bits
operator|&
name|HAL_RX_FILTER_PHYERR
condition|)
block|{
name|phybits
operator||=
name|AR_PHY_ERR_OFDM_TIMING
operator||
name|AR_PHY_ERR_CCK_TIMING
expr_stmt|;
block|}
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_PHY_ERR
argument_list|,
name|phybits
argument_list|)
expr_stmt|;
if|if
condition|(
name|phybits
condition|)
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_RXCFG
argument_list|,
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_RXCFG
argument_list|)
operator||
name|AR_RXCFG_ZLFDMA
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_RXCFG
argument_list|,
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_RXCFG
argument_list|)
operator|&
operator|~
name|AR_RXCFG_ZLFDMA
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Select to pass PLCP headr or EVM data.  */
end_comment

begin_function
name|HAL_BOOL
name|ar9300_set_rx_sel_evm
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_BOOL
name|sel_evm
parameter_list|,
name|HAL_BOOL
name|just_query
parameter_list|)
block|{
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|HAL_BOOL
name|old_value
init|=
name|ahp
operator|->
name|ah_get_plcp_hdr
operator|==
literal|0
decl_stmt|;
if|if
condition|(
name|just_query
condition|)
block|{
return|return
name|old_value
return|;
block|}
if|if
condition|(
name|sel_evm
condition|)
block|{
name|OS_REG_SET_BIT
argument_list|(
name|ah
argument_list|,
name|AR_PCU_MISC
argument_list|,
name|AR_PCU_SEL_EVM
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OS_REG_CLR_BIT
argument_list|(
name|ah
argument_list|,
name|AR_PCU_MISC
argument_list|,
name|AR_PCU_SEL_EVM
argument_list|)
expr_stmt|;
block|}
name|ahp
operator|->
name|ah_get_plcp_hdr
operator|=
operator|!
name|sel_evm
expr_stmt|;
return|return
name|old_value
return|;
block|}
end_function

begin_function
name|void
name|ar9300_promisc_mode
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_BOOL
name|enable
parameter_list|)
block|{
name|u_int32_t
name|reg_val
init|=
literal|0
decl_stmt|;
name|reg_val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_RX_FILTER
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
block|{
name|reg_val
operator||=
name|AR_RX_PROM
expr_stmt|;
block|}
else|else
block|{
comment|/*Disable promisc mode */
name|reg_val
operator|&=
operator|~
name|AR_RX_PROM
expr_stmt|;
block|}
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_RX_FILTER
argument_list|,
name|reg_val
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_read_pktlog_reg
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int32_t
modifier|*
name|rxfilter_val
parameter_list|,
name|u_int32_t
modifier|*
name|rxcfg_val
parameter_list|,
name|u_int32_t
modifier|*
name|phy_err_mask_val
parameter_list|,
name|u_int32_t
modifier|*
name|mac_pcu_phy_err_regval
parameter_list|)
block|{
operator|*
name|rxfilter_val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_RX_FILTER
argument_list|)
expr_stmt|;
operator|*
name|rxcfg_val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_RXCFG
argument_list|)
expr_stmt|;
operator|*
name|phy_err_mask_val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_PHY_ERR
argument_list|)
expr_stmt|;
operator|*
name|mac_pcu_phy_err_regval
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
literal|0x8338
argument_list|)
expr_stmt|;
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"%s[%d] rxfilter_val 0x%08x , rxcfg_val 0x%08x, "
literal|"phy_err_mask_val 0x%08x mac_pcu_phy_err_regval 0x%08x\n"
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
operator|*
name|rxfilter_val
argument_list|,
operator|*
name|rxcfg_val
argument_list|,
operator|*
name|phy_err_mask_val
argument_list|,
operator|*
name|mac_pcu_phy_err_regval
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_write_pktlog_reg
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_BOOL
name|enable
parameter_list|,
name|u_int32_t
name|rxfilter_val
parameter_list|,
name|u_int32_t
name|rxcfg_val
parameter_list|,
name|u_int32_t
name|phy_err_mask_val
parameter_list|,
name|u_int32_t
name|mac_pcu_phy_err_reg_val
parameter_list|)
block|{
if|if
condition|(
name|AR_SREV_JUPITER
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* HW fix for rx hang and corruption. */
name|rxfilter_val
operator||=
name|AR_RX_CONTROL_WRAPPER
expr_stmt|;
block|}
if|if
condition|(
name|enable
condition|)
block|{
comment|/* Enable pktlog phyerr setting */
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_RX_FILTER
argument_list|,
literal|0xffff
operator||
name|AR_RX_COMPR_BAR
operator||
name|rxfilter_val
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_PHY_ERR
argument_list|,
literal|0xFFFFFFFF
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_RXCFG
argument_list|,
name|rxcfg_val
operator||
name|AR_RXCFG_ZLFDMA
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_PHY_ERR_MASK_REG
argument_list|,
name|mac_pcu_phy_err_reg_val
operator||
literal|0xFF
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* Disable phyerr and Restore regs */
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_RX_FILTER
argument_list|,
name|rxfilter_val
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_PHY_ERR
argument_list|,
name|phy_err_mask_val
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_RXCFG
argument_list|,
name|rxcfg_val
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_PHY_ERR_MASK_REG
argument_list|,
name|mac_pcu_phy_err_reg_val
argument_list|)
expr_stmt|;
block|}
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"%s[%d] ena %d rxfilter_val 0x%08x , rxcfg_val 0x%08x, "
literal|"phy_err_mask_val 0x%08x mac_pcu_phy_err_regval 0x%08x\n"
argument_list|,
name|__func__
argument_list|,
name|__LINE__
argument_list|,
name|enable
argument_list|,
name|rxfilter_val
argument_list|,
name|rxcfg_val
argument_list|,
name|phy_err_mask_val
argument_list|,
name|mac_pcu_phy_err_reg_val
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

