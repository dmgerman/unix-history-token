begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2013 Qualcomm Atheros, Inc.  *  * Permission to use, copy, modify, and/or distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH  * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY  * AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,  * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM  * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR  * OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR  * PERFORMANCE OF THIS SOFTWARE.  */
end_comment

begin_include
include|#
directive|include
file|"opt_ah.h"
end_include

begin_include
include|#
directive|include
file|"ah.h"
end_include

begin_include
include|#
directive|include
file|"ah_desc.h"
end_include

begin_include
include|#
directive|include
file|"ah_internal.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300desc.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300reg.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300phy.h"
end_include

begin_include
include|#
directive|include
file|"ah_devid.h"
end_include

begin_if
if|#
directive|if
name|AH_BYTE_ORDER
operator|==
name|AH_BIG_ENDIAN
end_if

begin_function_decl
specifier|static
name|void
name|ar9300_swap_tx_desc
parameter_list|(
name|void
modifier|*
name|ds
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|ar9300_tx_req_intr_desc
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_INTERRUPT
argument_list|,
literal|"%s:Desc Interrupt not supported\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|u_int16_t
name|ar9300_calc_ptr_chk_sum
parameter_list|(
name|struct
name|ar9300_txc
modifier|*
name|ads
parameter_list|)
block|{
name|u_int
name|checksum
decl_stmt|;
name|u_int16_t
name|ptrchecksum
decl_stmt|;
comment|/* checksum = __bswap32(ads->ds_info) + ads->ds_link */
name|checksum
operator|=
name|ads
operator|->
name|ds_info
operator|+
name|ads
operator|->
name|ds_link
operator|+
name|ads
operator|->
name|ds_data0
operator|+
name|ads
operator|->
name|ds_ctl3
operator|+
name|ads
operator|->
name|ds_data1
operator|+
name|ads
operator|->
name|ds_ctl5
operator|+
name|ads
operator|->
name|ds_data2
operator|+
name|ads
operator|->
name|ds_ctl7
operator|+
name|ads
operator|->
name|ds_data3
operator|+
name|ads
operator|->
name|ds_ctl9
expr_stmt|;
name|ptrchecksum
operator|=
operator|(
operator|(
name|checksum
operator|&
literal|0xffff
operator|)
operator|+
operator|(
name|checksum
operator|>>
literal|16
operator|)
operator|)
operator|&
name|AR_tx_ptr_chk_sum
expr_stmt|;
return|return
name|ptrchecksum
return|;
block|}
end_function

begin_function
name|HAL_BOOL
name|ar9300_fill_tx_desc
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|,
name|HAL_DMA_ADDR
modifier|*
name|buf_addr
parameter_list|,
name|u_int32_t
modifier|*
name|seg_len
parameter_list|,
name|u_int
name|desc_id
parameter_list|,
name|u_int
name|qcu
parameter_list|,
name|HAL_KEY_TYPE
name|key_type
parameter_list|,
name|HAL_BOOL
name|first_seg
parameter_list|,
name|HAL_BOOL
name|last_seg
parameter_list|,
specifier|const
name|void
modifier|*
name|ds0
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|short
name|desclen
decl_stmt|;
comment|/* Fill TXC info field */
name|desclen
operator|=
operator|(
name|AR_SREV_JUPITER
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
operator|)
condition|?
literal|0x18
else|:
literal|0x17
expr_stmt|;
name|ads
operator|->
name|ds_info
operator|=
name|TXC_INFO
argument_list|(
name|qcu
argument_list|,
name|desclen
argument_list|)
expr_stmt|;
comment|/* Set the buffer addresses */
name|ads
operator|->
name|ds_data0
operator|=
name|buf_addr
index|[
literal|0
index|]
expr_stmt|;
name|ads
operator|->
name|ds_data1
operator|=
name|buf_addr
index|[
literal|1
index|]
expr_stmt|;
name|ads
operator|->
name|ds_data2
operator|=
name|buf_addr
index|[
literal|2
index|]
expr_stmt|;
name|ads
operator|->
name|ds_data3
operator|=
name|buf_addr
index|[
literal|3
index|]
expr_stmt|;
comment|/* Set the buffer lengths */
name|ads
operator|->
name|ds_ctl3
operator|=
operator|(
name|seg_len
index|[
literal|0
index|]
operator|<<
name|AR_buf_len_S
operator|)
operator|&
name|AR_buf_len
expr_stmt|;
name|ads
operator|->
name|ds_ctl5
operator|=
operator|(
name|seg_len
index|[
literal|1
index|]
operator|<<
name|AR_buf_len_S
operator|)
operator|&
name|AR_buf_len
expr_stmt|;
name|ads
operator|->
name|ds_ctl7
operator|=
operator|(
name|seg_len
index|[
literal|2
index|]
operator|<<
name|AR_buf_len_S
operator|)
operator|&
name|AR_buf_len
expr_stmt|;
name|ads
operator|->
name|ds_ctl9
operator|=
operator|(
name|seg_len
index|[
literal|3
index|]
operator|<<
name|AR_buf_len_S
operator|)
operator|&
name|AR_buf_len
expr_stmt|;
comment|/* Fill in pointer checksum and descriptor id */
name|ads
operator|->
name|ds_ctl10
operator|=
operator|(
name|desc_id
operator|<<
name|AR_tx_desc_id_S
operator|)
operator||
name|ar9300_calc_ptr_chk_sum
argument_list|(
name|ads
argument_list|)
expr_stmt|;
if|if
condition|(
name|first_seg
condition|)
block|{
comment|/*          * First descriptor, don't clobber xmit control data          * setup by ar9300_set_11n_tx_desc.          *          * Note: AR_encr_type is already setup in the first descriptor by          *       set_11n_tx_desc().          */
name|ads
operator|->
name|ds_ctl12
operator||=
operator|(
name|last_seg
condition|?
literal|0
else|:
name|AR_tx_more
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|last_seg
condition|)
block|{
comment|/* !first_seg&& last_seg */
comment|/*          * Last descriptor in a multi-descriptor frame,          * copy the multi-rate transmit parameters from          * the first frame for processing on completion.          */
name|ads
operator|->
name|ds_ctl11
operator|=
literal|0
expr_stmt|;
name|ads
operator|->
name|ds_ctl12
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|AH_NEED_DESC_SWAP
name|ads
operator|->
name|ds_ctl13
operator|=
name|__bswap32
argument_list|(
name|AR9300TXC_CONST
argument_list|(
name|ds0
argument_list|)
operator|->
name|ds_ctl13
argument_list|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl14
operator|=
name|__bswap32
argument_list|(
name|AR9300TXC_CONST
argument_list|(
name|ds0
argument_list|)
operator|->
name|ds_ctl14
argument_list|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl17
operator|=
name|__bswap32
argument_list|(
name|SM
argument_list|(
name|key_type
argument_list|,
name|AR_encr_type
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|ads
operator|->
name|ds_ctl13
operator|=
name|AR9300TXC_CONST
argument_list|(
name|ds0
argument_list|)
operator|->
name|ds_ctl13
expr_stmt|;
name|ads
operator|->
name|ds_ctl14
operator|=
name|AR9300TXC_CONST
argument_list|(
name|ds0
argument_list|)
operator|->
name|ds_ctl14
expr_stmt|;
name|ads
operator|->
name|ds_ctl17
operator|=
name|SM
argument_list|(
name|key_type
argument_list|,
name|AR_encr_type
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
comment|/* !first_seg&& !last_seg */
comment|/*          * XXX Intermediate descriptor in a multi-descriptor frame.          */
name|ads
operator|->
name|ds_ctl11
operator|=
literal|0
expr_stmt|;
name|ads
operator|->
name|ds_ctl12
operator|=
name|AR_tx_more
expr_stmt|;
name|ads
operator|->
name|ds_ctl13
operator|=
literal|0
expr_stmt|;
name|ads
operator|->
name|ds_ctl14
operator|=
literal|0
expr_stmt|;
name|ads
operator|->
name|ds_ctl17
operator|=
name|SM
argument_list|(
name|key_type
argument_list|,
name|AR_encr_type
argument_list|)
expr_stmt|;
block|}
comment|/* Only relevant for Jupiter/Aphrodite */
name|ads
operator|->
name|ds_ctl23
operator|=
literal|0
expr_stmt|;
return|return
name|AH_TRUE
return|;
block|}
end_function

begin_function
name|void
name|ar9300_set_desc_link
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|,
name|u_int32_t
name|link
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|ds_link
operator|=
name|link
expr_stmt|;
comment|/* TODO - checksum is calculated twice for subframes      * Once in filldesc and again when linked. Need to fix.      */
comment|/* Fill in pointer checksum.  Preserve descriptor id */
name|ads
operator|->
name|ds_ctl10
operator|&=
operator|~
name|AR_tx_ptr_chk_sum
expr_stmt|;
name|ads
operator|->
name|ds_ctl10
operator||=
name|ar9300_calc_ptr_chk_sum
argument_list|(
name|ads
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_get_desc_link_ptr
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|,
name|u_int32_t
modifier|*
modifier|*
name|link
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
operator|*
name|link
operator|=
operator|&
name|ads
operator|->
name|ds_link
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_clear_tx_desc_status
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|)
block|{
name|struct
name|ar9300_txs
modifier|*
name|ads
init|=
name|AR9300TXS
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|status1
operator|=
name|ads
operator|->
name|status2
operator|=
literal|0
expr_stmt|;
name|ads
operator|->
name|status3
operator|=
name|ads
operator|->
name|status4
operator|=
literal|0
expr_stmt|;
name|ads
operator|->
name|status5
operator|=
name|ads
operator|->
name|status6
operator|=
literal|0
expr_stmt|;
name|ads
operator|->
name|status7
operator|=
name|ads
operator|->
name|status8
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|ATH_SWRETRY
end_ifdef

begin_function
name|void
name|ar9300_clear_dest_mask
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|ds_ctl11
operator||=
name|AR_clr_dest_mask
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|AH_BYTE_ORDER
operator|==
name|AH_BIG_ENDIAN
end_if

begin_comment
comment|/* XXX what words need swapping */
end_comment

begin_comment
comment|/* Swap transmit descriptor */
end_comment

begin_function
specifier|static
name|__inline
name|void
name|ar9300_swap_tx_desc
parameter_list|(
name|void
modifier|*
name|dsp
parameter_list|)
block|{
name|struct
name|ar9300_txs
modifier|*
name|ds
init|=
operator|(
expr|struct
name|ar9300_txs
operator|*
operator|)
name|dsp
decl_stmt|;
name|ds
operator|->
name|ds_info
operator|=
name|__bswap32
argument_list|(
name|ds
operator|->
name|ds_info
argument_list|)
expr_stmt|;
name|ds
operator|->
name|status1
operator|=
name|__bswap32
argument_list|(
name|ds
operator|->
name|status1
argument_list|)
expr_stmt|;
name|ds
operator|->
name|status2
operator|=
name|__bswap32
argument_list|(
name|ds
operator|->
name|status2
argument_list|)
expr_stmt|;
name|ds
operator|->
name|status3
operator|=
name|__bswap32
argument_list|(
name|ds
operator|->
name|status3
argument_list|)
expr_stmt|;
name|ds
operator|->
name|status4
operator|=
name|__bswap32
argument_list|(
name|ds
operator|->
name|status4
argument_list|)
expr_stmt|;
name|ds
operator|->
name|status5
operator|=
name|__bswap32
argument_list|(
name|ds
operator|->
name|status5
argument_list|)
expr_stmt|;
name|ds
operator|->
name|status6
operator|=
name|__bswap32
argument_list|(
name|ds
operator|->
name|status6
argument_list|)
expr_stmt|;
name|ds
operator|->
name|status7
operator|=
name|__bswap32
argument_list|(
name|ds
operator|->
name|status7
argument_list|)
expr_stmt|;
name|ds
operator|->
name|status8
operator|=
name|__bswap32
argument_list|(
name|ds
operator|->
name|status8
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Extract the transmit rate code.  */
end_comment

begin_function
name|void
name|ar9300_get_tx_rate_code
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|,
name|struct
name|ath_tx_status
modifier|*
name|ts
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|ts
operator|->
name|ts_finaltsi
condition|)
block|{
case|case
literal|0
case|:
name|ts
operator|->
name|ts_rate
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl14
argument_list|,
name|AR_xmit_rate0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|ts
operator|->
name|ts_rate
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl14
argument_list|,
name|AR_xmit_rate1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|ts
operator|->
name|ts_rate
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl14
argument_list|,
name|AR_xmit_rate2
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|ts
operator|->
name|ts_rate
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl14
argument_list|,
name|AR_xmit_rate3
argument_list|)
expr_stmt|;
break|break;
block|}
name|ar9300_set_selfgenrate_limit
argument_list|(
name|ah
argument_list|,
name|ts
operator|->
name|ts_rate
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Get TX Status descriptor contents.  */
end_comment

begin_function
name|void
name|ar9300_get_raw_tx_desc
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int32_t
modifier|*
name|txstatus
parameter_list|)
block|{
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|struct
name|ar9300_txs
modifier|*
name|ads
decl_stmt|;
name|ads
operator|=
operator|&
name|ahp
operator|->
name|ts_ring
index|[
name|ahp
operator|->
name|ts_tail
index|]
expr_stmt|;
name|OS_MEMCPY
argument_list|(
name|txstatus
argument_list|,
name|ads
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ar9300_txs
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Processing of HW TX descriptor.  */
end_comment

begin_function
name|HAL_STATUS
name|ar9300_proc_tx_desc
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|txstatus
parameter_list|)
block|{
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|struct
name|ar9300_txs
modifier|*
name|ads
decl_stmt|;
name|struct
name|ath_tx_status
modifier|*
name|ts
init|=
operator|(
expr|struct
name|ath_tx_status
operator|*
operator|)
name|txstatus
decl_stmt|;
name|u_int32_t
name|dsinfo
decl_stmt|;
name|ads
operator|=
operator|&
name|ahp
operator|->
name|ts_ring
index|[
name|ahp
operator|->
name|ts_tail
index|]
expr_stmt|;
if|if
condition|(
operator|(
name|ads
operator|->
name|status8
operator|&
name|AR_tx_done
operator|)
operator|==
literal|0
condition|)
block|{
return|return
name|HAL_EINPROGRESS
return|;
block|}
comment|/*      * Sanity check      */
if|#
directive|if
literal|0
block|ath_hal_printf(ah,         "CHH: tail=%d\n", ahp->ts_tail);     ath_hal_printf(ah,         "CHH: ds_info 0x%x 0x%08x 0x%08x 0x%08x 0x%08x 0x%08x 0x%08x 0x%08x 0x%08x\n",         ads->ds_info,         ads->status1,         ads->status2,         ads->status3,         ads->status4,         ads->status5,         ads->status6,         ads->status7,         ads->status8);
endif|#
directive|endif
comment|/* Increment the tail to point to the next status element. */
name|ahp
operator|->
name|ts_tail
operator|=
operator|(
name|ahp
operator|->
name|ts_tail
operator|+
literal|1
operator|)
operator|&
operator|(
name|ahp
operator|->
name|ts_size
operator|-
literal|1
operator|)
expr_stmt|;
comment|/*     ** For big endian systems, ds_info is not swapped as the other     ** registers are.  Ensure we use the bswap32 version (which is     ** defined to "nothing" in little endian systems     */
name|dsinfo
operator|=
name|ads
operator|->
name|ds_info
expr_stmt|;
if|if
condition|(
operator|(
name|MS
argument_list|(
name|dsinfo
argument_list|,
name|AR_desc_id
argument_list|)
operator|!=
name|ATHEROS_VENDOR_ID
operator|)
operator|||
operator|(
name|MS
argument_list|(
name|dsinfo
argument_list|,
name|AR_tx_rx_desc
argument_list|)
operator|!=
literal|1
operator|)
condition|)
block|{
name|HALDEBUG
argument_list|(
name|AH_NULL
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"%s: Tx Descriptor error %x\n"
argument_list|,
name|__func__
argument_list|,
name|dsinfo
argument_list|)
expr_stmt|;
name|HALASSERT
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|/* Zero out the status for reuse */
name|OS_MEMZERO
argument_list|(
name|ads
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ar9300_txs
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|HAL_EIO
return|;
block|}
comment|/* Update software copies of the HW status */
name|ts
operator|->
name|ts_queue_id
operator|=
name|MS
argument_list|(
name|dsinfo
argument_list|,
name|AR_tx_qcu_num
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_desc_id
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status1
argument_list|,
name|AR_tx_desc_id
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_seqnum
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status8
argument_list|,
name|AR_seq_num
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_tstamp
operator|=
name|ads
operator|->
name|status4
expr_stmt|;
name|ts
operator|->
name|ts_status
operator|=
literal|0
expr_stmt|;
name|ts
operator|->
name|ts_flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|ads
operator|->
name|status3
operator|&
name|AR_excessive_retries
condition|)
block|{
name|ts
operator|->
name|ts_status
operator||=
name|HAL_TXERR_XRETRY
expr_stmt|;
block|}
if|if
condition|(
name|ads
operator|->
name|status3
operator|&
name|AR_filtered
condition|)
block|{
name|ts
operator|->
name|ts_status
operator||=
name|HAL_TXERR_FILT
expr_stmt|;
block|}
if|if
condition|(
name|ads
operator|->
name|status3
operator|&
name|AR_fifounderrun
condition|)
block|{
name|ts
operator|->
name|ts_status
operator||=
name|HAL_TXERR_FIFO
expr_stmt|;
name|ar9300_update_tx_trig_level
argument_list|(
name|ah
argument_list|,
name|AH_TRUE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ads
operator|->
name|status8
operator|&
name|AR_tx_op_exceeded
condition|)
block|{
name|ts
operator|->
name|ts_status
operator||=
name|HAL_TXERR_XTXOP
expr_stmt|;
block|}
if|if
condition|(
name|ads
operator|->
name|status3
operator|&
name|AR_tx_timer_expired
condition|)
block|{
name|ts
operator|->
name|ts_status
operator||=
name|HAL_TXERR_TIMER_EXPIRED
expr_stmt|;
block|}
if|if
condition|(
name|ads
operator|->
name|status3
operator|&
name|AR_desc_cfg_err
condition|)
block|{
name|ts
operator|->
name|ts_flags
operator||=
name|HAL_TX_DESC_CFG_ERR
expr_stmt|;
block|}
if|if
condition|(
name|ads
operator|->
name|status3
operator|&
name|AR_tx_data_underrun
condition|)
block|{
name|ts
operator|->
name|ts_flags
operator||=
name|HAL_TX_DATA_UNDERRUN
expr_stmt|;
name|ar9300_update_tx_trig_level
argument_list|(
name|ah
argument_list|,
name|AH_TRUE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ads
operator|->
name|status3
operator|&
name|AR_tx_delim_underrun
condition|)
block|{
name|ts
operator|->
name|ts_flags
operator||=
name|HAL_TX_DELIM_UNDERRUN
expr_stmt|;
name|ar9300_update_tx_trig_level
argument_list|(
name|ah
argument_list|,
name|AH_TRUE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ads
operator|->
name|status2
operator|&
name|AR_tx_ba_status
condition|)
block|{
name|ts
operator|->
name|ts_flags
operator||=
name|HAL_TX_BA
expr_stmt|;
name|ts
operator|->
name|ts_ba_low
operator|=
name|ads
operator|->
name|status5
expr_stmt|;
name|ts
operator|->
name|ts_ba_high
operator|=
name|ads
operator|->
name|status6
expr_stmt|;
block|}
comment|/*      * Extract the transmit rate.      */
name|ts
operator|->
name|ts_finaltsi
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status8
argument_list|,
name|AR_final_tx_idx
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_rssi
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status7
argument_list|,
name|AR_tx_rssi_combined
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_rssi_ctl
index|[
literal|0
index|]
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status2
argument_list|,
name|AR_tx_rssi_ant00
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_rssi_ctl
index|[
literal|1
index|]
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status2
argument_list|,
name|AR_tx_rssi_ant01
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_rssi_ctl
index|[
literal|2
index|]
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status2
argument_list|,
name|AR_tx_rssi_ant02
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_rssi_ext
index|[
literal|0
index|]
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status7
argument_list|,
name|AR_tx_rssi_ant10
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_rssi_ext
index|[
literal|1
index|]
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status7
argument_list|,
name|AR_tx_rssi_ant11
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_rssi_ext
index|[
literal|2
index|]
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status7
argument_list|,
name|AR_tx_rssi_ant12
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_shortretry
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status3
argument_list|,
name|AR_rts_fail_cnt
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_longretry
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status3
argument_list|,
name|AR_data_fail_cnt
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_virtcol
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status3
argument_list|,
name|AR_virt_retry_cnt
argument_list|)
expr_stmt|;
name|ts
operator|->
name|ts_antenna
operator|=
literal|0
expr_stmt|;
comment|/* extract TID from block ack */
name|ts
operator|->
name|ts_tid
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|status8
argument_list|,
name|AR_tx_tid
argument_list|)
expr_stmt|;
comment|/* Zero out the status for reuse */
name|OS_MEMZERO
argument_list|(
name|ads
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ar9300_txs
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|HAL_OK
return|;
block|}
end_function

begin_comment
comment|/*  * Calculate air time of a transmit packet  * if comp_wastedt is 1, calculate air time only for failed subframes  * this is required for VOW_DCS ( dynamic channel selection )  */
end_comment

begin_function
name|u_int32_t
name|ar9300_calc_tx_airtime
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|,
name|struct
name|ath_tx_status
modifier|*
name|ts
parameter_list|,
name|HAL_BOOL
name|comp_wastedt
parameter_list|,
name|u_int8_t
name|nbad
parameter_list|,
name|u_int8_t
name|nframes
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|int
name|finalindex_tries
decl_stmt|;
name|u_int32_t
name|airtime
decl_stmt|,
name|lastrate_dur
decl_stmt|;
comment|/*      * Number of attempts made on the final index      * Note: If no BA was recv, then the data_fail_cnt is the number of tries      * made on the final index.  If BA was recv, then add 1 to account for the      * successful attempt.      */
if|if
condition|(
operator|!
name|comp_wastedt
condition|)
block|{
name|finalindex_tries
operator|=
name|ts
operator|->
name|ts_longretry
operator|+
operator|(
name|ts
operator|->
name|ts_flags
operator|&
name|HAL_TX_BA
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
block|}
else|else
block|{
name|finalindex_tries
operator|=
name|ts
operator|->
name|ts_longretry
expr_stmt|;
block|}
comment|/*      * Calculate time of transmit on air for packet including retries      * at different rates.      */
switch|switch
condition|(
name|ts
operator|->
name|ts_finaltsi
condition|)
block|{
case|case
literal|0
case|:
name|lastrate_dur
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl15
argument_list|,
name|AR_packet_dur0
argument_list|)
expr_stmt|;
name|airtime
operator|=
operator|(
name|lastrate_dur
operator|*
name|finalindex_tries
operator|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|lastrate_dur
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl15
argument_list|,
name|AR_packet_dur1
argument_list|)
expr_stmt|;
name|airtime
operator|=
operator|(
name|lastrate_dur
operator|*
name|finalindex_tries
operator|)
operator|+
operator|(
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl13
argument_list|,
name|AR_xmit_data_tries0
argument_list|)
operator|*
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl15
argument_list|,
name|AR_packet_dur0
argument_list|)
operator|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|lastrate_dur
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl16
argument_list|,
name|AR_packet_dur2
argument_list|)
expr_stmt|;
name|airtime
operator|=
operator|(
name|lastrate_dur
operator|*
name|finalindex_tries
operator|)
operator|+
operator|(
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl13
argument_list|,
name|AR_xmit_data_tries1
argument_list|)
operator|*
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl15
argument_list|,
name|AR_packet_dur1
argument_list|)
operator|)
operator|+
operator|(
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl13
argument_list|,
name|AR_xmit_data_tries0
argument_list|)
operator|*
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl15
argument_list|,
name|AR_packet_dur0
argument_list|)
operator|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|lastrate_dur
operator|=
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl16
argument_list|,
name|AR_packet_dur3
argument_list|)
expr_stmt|;
name|airtime
operator|=
operator|(
name|lastrate_dur
operator|*
name|finalindex_tries
operator|)
operator|+
operator|(
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl13
argument_list|,
name|AR_xmit_data_tries2
argument_list|)
operator|*
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl16
argument_list|,
name|AR_packet_dur2
argument_list|)
operator|)
operator|+
operator|(
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl13
argument_list|,
name|AR_xmit_data_tries1
argument_list|)
operator|*
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl15
argument_list|,
name|AR_packet_dur1
argument_list|)
operator|)
operator|+
operator|(
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl13
argument_list|,
name|AR_xmit_data_tries0
argument_list|)
operator|*
name|MS
argument_list|(
name|ads
operator|->
name|ds_ctl15
argument_list|,
name|AR_packet_dur0
argument_list|)
operator|)
expr_stmt|;
break|break;
default|default:
name|HALASSERT
argument_list|(
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|comp_wastedt
operator|&&
operator|(
name|ts
operator|->
name|ts_flags
operator|&
name|HAL_TX_BA
operator|)
condition|)
block|{
name|airtime
operator|+=
name|nbad
condition|?
operator|(
operator|(
name|lastrate_dur
operator|*
name|nbad
operator|)
operator|/
name|nframes
operator|)
else|:
literal|0
expr_stmt|;
block|}
return|return
name|airtime
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|AH_PRIVATE_DIAG
end_ifdef

begin_function
name|void
name|ar9300__cont_tx_mode
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|,
name|int
name|mode
parameter_list|)
block|{
if|#
directive|if
literal|0
block|static int qnum = 0;     int i;     unsigned int qbits, val, val1, val2;     int prefetch;     struct ar9300_txs *ads = AR9300TXS(ds);      if (mode == 10) {         return;     }      if (mode == 7) {
comment|/* print status from the cont tx desc */
block|if (ads) {             val1 = ads->ds_txstatus1;             val2 = ads->ds_txstatus2;             HALDEBUG(ah, HAL_DEBUG_TXDESC, "s0(%x) s1(%x)\n",                                        (unsigned)val1, (unsigned)val2);         }         HALDEBUG(ah, HAL_DEBUG_TXDESC, "txe(%x) txd(%x)\n",                                    OS_REG_READ(ah, AR_Q_TXE),                                    OS_REG_READ(ah, AR_Q_TXD)                 );         for (i = 0; i< HAL_NUM_TX_QUEUES; i++) {             val = OS_REG_READ(ah, AR_QTXDP(i));             val2 = OS_REG_READ(ah, AR_QSTS(i))& AR_Q_STS_PEND_FR_CNT;             HALDEBUG(ah, HAL_DEBUG_TXDESC, "[%d] %x %d\n", i, val, val2);         }         return;     }     if (mode == 8) {
comment|/* set TXE for qnum */
block|OS_REG_WRITE(ah, AR_Q_TXE, 1<< qnum);         return;     }     if (mode == 9) {         prefetch = (int)ds;         return;     }      if (mode>= 1) {
comment|/* initiate cont tx operation */
comment|/* Disable AGC to A2 */
block|qnum = (int) ds;          OS_REG_WRITE(ah, AR_PHY_TEST,             (OS_REG_READ(ah, AR_PHY_TEST) | PHY_AGC_CLR) );          OS_REG_WRITE(ah, 0x9864, OS_REG_READ(ah, 0x9864) | 0x7f000);         OS_REG_WRITE(ah, 0x9924, OS_REG_READ(ah, 0x9924) | 0x7f00fe);         OS_REG_WRITE(ah, AR_DIAG_SW,             (OS_REG_READ(ah, AR_DIAG_SW) |              (AR_DIAG_FORCE_RX_CLEAR + AR_DIAG_IGNORE_VIRT_CS)) );           OS_REG_WRITE(ah, AR_CR, AR_CR_RXD);
comment|/* set receive disable */
block|if (mode == 3 || mode == 4) {             int txcfg;              if (mode == 3) {                 OS_REG_WRITE(ah, AR_DLCL_IFS(qnum), 0);                 OS_REG_WRITE(ah, AR_DRETRY_LIMIT(qnum), 0xffffffff);                 OS_REG_WRITE(ah, AR_D_GBL_IFS_SIFS, 100);                 OS_REG_WRITE(ah, AR_D_GBL_IFS_EIFS, 100);                 OS_REG_WRITE(ah, AR_TIME_OUT, 2);                 OS_REG_WRITE(ah, AR_D_GBL_IFS_SLOT, 100);             }              OS_REG_WRITE(ah, AR_DRETRY_LIMIT(qnum), 0xffffffff);
comment|/* enable prefetch on qnum */
block|OS_REG_WRITE(ah, AR_D_FPCTL, 0x10 | qnum);             txcfg = 5 | (6<< AR_FTRIG_S);             OS_REG_WRITE(ah, AR_TXCFG, txcfg);              OS_REG_WRITE(ah, AR_QMISC(qnum),
comment|/* set QCU modes */
block|AR_Q_MISC_DCU_EARLY_TERM_REQ                          + AR_Q_MISC_FSP_ASAP                          + AR_Q_MISC_CBR_INCR_DIS1                          + AR_Q_MISC_CBR_INCR_DIS0                         );
comment|/* stop tx dma all all except qnum */
block|qbits = 0x3ff;             qbits&= ~(1<< qnum);             for (i = 0; i< 10; i++) {                 if (i == qnum) {                     continue;                 }                 OS_REG_WRITE(ah, AR_Q_TXD, 1<< i);             }              OS_REG_WRITE(ah, AR_Q_TXD, qbits);
comment|/* clear and freeze MIB counters */
block|OS_REG_WRITE(ah, AR_MIBC, AR_MIBC_CMC);             OS_REG_WRITE(ah, AR_MIBC, AR_MIBC_FMC);              OS_REG_WRITE(ah, AR_DMISC(qnum),                          (AR_D_MISC_ARB_LOCKOUT_CNTRL_GLOBAL<<                           AR_D_MISC_ARB_LOCKOUT_CNTRL_S)                          + (AR_D_MISC_ARB_LOCKOUT_IGNORE)                          + (AR_D_MISC_POST_FR_BKOFF_DIS)                          + (AR_D_MISC_VIR_COL_HANDLING_IGNORE<<                             AR_D_MISC_VIR_COL_HANDLING_S));              for (i = 0; i< HAL_NUM_TX_QUEUES + 2; i++) {
comment|/* disconnect QCUs */
block|if (i == qnum) {                     continue;                 }                 OS_REG_WRITE(ah, AR_DQCUMASK(i), 0);             }         }     }     if (mode == 0) {         OS_REG_WRITE(ah, AR_PHY_TEST,             (OS_REG_READ(ah, AR_PHY_TEST)& ~PHY_AGC_CLR));         OS_REG_WRITE(ah, AR_DIAG_SW,             (OS_REG_READ(ah, AR_DIAG_SW)&              ~(AR_DIAG_FORCE_RX_CLEAR + AR_DIAG_IGNORE_VIRT_CS)));     }
endif|#
directive|endif
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|ar9300_set_paprd_tx_desc
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|,
name|int
name|chain_num
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|ds_ctl12
operator||=
name|SM
argument_list|(
operator|(
literal|1
operator|<<
name|chain_num
operator|)
argument_list|,
name|AR_paprd_chain_mask
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|HAL_STATUS
name|ar9300_is_tx_done
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|struct
name|ar9300_txs
modifier|*
name|ads
decl_stmt|;
name|ads
operator|=
operator|&
name|ahp
operator|->
name|ts_ring
index|[
name|ahp
operator|->
name|ts_tail
index|]
expr_stmt|;
if|if
condition|(
name|ads
operator|->
name|status8
operator|&
name|AR_tx_done
condition|)
block|{
return|return
name|HAL_OK
return|;
block|}
return|return
name|HAL_EINPROGRESS
return|;
block|}
end_function

begin_function
name|void
name|ar9300_set_11n_tx_desc
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|,
name|u_int
name|pkt_len
parameter_list|,
name|HAL_PKT_TYPE
name|type
parameter_list|,
name|u_int
name|tx_power
parameter_list|,
name|u_int
name|key_ix
parameter_list|,
name|HAL_KEY_TYPE
name|key_type
parameter_list|,
name|u_int
name|flags
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|HALASSERT
argument_list|(
name|is_valid_pkt_type
argument_list|(
name|type
argument_list|)
argument_list|)
expr_stmt|;
name|HALASSERT
argument_list|(
name|is_valid_key_type
argument_list|(
name|key_type
argument_list|)
argument_list|)
expr_stmt|;
name|tx_power
operator|+=
name|ahp
operator|->
name|ah_tx_power_index_offset
expr_stmt|;
if|if
condition|(
name|tx_power
operator|>
literal|63
condition|)
block|{
name|tx_power
operator|=
literal|63
expr_stmt|;
block|}
name|ads
operator|->
name|ds_ctl11
operator|=
operator|(
name|pkt_len
operator|&
name|AR_frame_len
operator|)
operator||
operator|(
name|flags
operator|&
name|HAL_TXDESC_VMF
condition|?
name|AR_virt_more_frag
else|:
literal|0
operator|)
operator||
name|SM
argument_list|(
name|tx_power
argument_list|,
name|AR_xmit_power0
argument_list|)
operator||
operator|(
name|flags
operator|&
name|HAL_TXDESC_VEOL
condition|?
name|AR_veol
else|:
literal|0
operator|)
operator||
operator|(
name|flags
operator|&
name|HAL_TXDESC_CLRDMASK
condition|?
name|AR_clr_dest_mask
else|:
literal|0
operator|)
operator||
operator|(
name|key_ix
operator|!=
name|HAL_TXKEYIX_INVALID
condition|?
name|AR_dest_idx_valid
else|:
literal|0
operator|)
operator||
operator|(
name|flags
operator|&
name|HAL_TXDESC_LOWRXCHAIN
condition|?
name|AR_low_rx_chain
else|:
literal|0
operator|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl12
operator|=
operator|(
name|key_ix
operator|!=
name|HAL_TXKEYIX_INVALID
condition|?
name|SM
argument_list|(
name|key_ix
argument_list|,
name|AR_dest_idx
argument_list|)
else|:
literal|0
operator|)
operator||
name|SM
argument_list|(
name|type
argument_list|,
name|AR_frame_type
argument_list|)
operator||
operator|(
name|flags
operator|&
name|HAL_TXDESC_NOACK
condition|?
name|AR_no_ack
else|:
literal|0
operator|)
operator||
operator|(
name|flags
operator|&
name|HAL_TXDESC_EXT_ONLY
condition|?
name|AR_ext_only
else|:
literal|0
operator|)
operator||
operator|(
name|flags
operator|&
name|HAL_TXDESC_EXT_AND_CTL
condition|?
name|AR_ext_and_ctl
else|:
literal|0
operator|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl17
operator|=
name|SM
argument_list|(
name|key_type
argument_list|,
name|AR_encr_type
argument_list|)
operator||
operator|(
name|flags
operator|&
name|HAL_TXDESC_LDPC
condition|?
name|AR_ldpc
else|:
literal|0
operator|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl18
operator|=
literal|0
expr_stmt|;
name|ads
operator|->
name|ds_ctl19
operator|=
name|AR_not_sounding
expr_stmt|;
comment|/* set not sounding for normal frame */
comment|/*      * Clear Ness1/2/3 (Number of Extension Spatial Streams) fields.      * Ness0 is cleared in ctl19.  See EV66059 (BB panic).      */
name|ads
operator|->
name|ds_ctl20
operator|=
literal|0
expr_stmt|;
name|ads
operator|->
name|ds_ctl21
operator|=
literal|0
expr_stmt|;
name|ads
operator|->
name|ds_ctl22
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_set_rx_chainmask
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|int
name|rxchainmask
parameter_list|)
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_PHY_RX_CHAINMASK
argument_list|,
name|rxchainmask
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_update_loc_ctl_reg
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|int
name|pos_bit
parameter_list|)
block|{
name|u_int32_t
name|reg_val
decl_stmt|;
name|reg_val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_LOC_CTL_REG
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos_bit
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|reg_val
operator|&
name|AR_LOC_CTL_REG_FS
operator|)
condition|)
block|{
comment|/* set fast timestamp bit in the regiter */
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_LOC_CTL_REG
argument_list|,
operator|(
name|reg_val
operator||
name|AR_LOC_CTL_REG_FS
operator|)
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_LOC_TIMER_REG
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_LOC_CTL_REG
argument_list|,
operator|(
name|reg_val
operator|&
operator|~
name|AR_LOC_CTL_REG_FS
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_if
if|#
directive|if
literal|0
end_if

begin_define
define|#
directive|define
name|HT_RC_2_MCS
parameter_list|(
name|_rc
parameter_list|)
value|((_rc)& 0x0f)
end_define

begin_comment
unit|static const u_int8_t ba_duration_delta[] = {     24,
comment|/*  0: BPSK       */
end_comment

begin_comment
unit|12,
comment|/*  1: QPSK 1/2   */
end_comment

begin_comment
unit|12,
comment|/*  2: QPSK 3/4   */
end_comment

begin_comment
unit|4,
comment|/*  3: 16-QAM 1/2 */
end_comment

begin_comment
unit|4,
comment|/*  4: 16-QAM 3/4 */
end_comment

begin_comment
unit|4,
comment|/*  5: 64-QAM 2/3 */
end_comment

begin_comment
unit|4,
comment|/*  6: 64-QAM 3/4 */
end_comment

begin_comment
unit|4,
comment|/*  7: 64-QAM 5/6 */
end_comment

begin_comment
unit|24,
comment|/*  8: BPSK       */
end_comment

begin_comment
unit|12,
comment|/*  9: QPSK 1/2   */
end_comment

begin_comment
unit|12,
comment|/* 10: QPSK 3/4   */
end_comment

begin_comment
unit|4,
comment|/* 11: 16-QAM 1/2 */
end_comment

begin_comment
unit|4,
comment|/* 12: 16-QAM 3/4 */
end_comment

begin_comment
unit|4,
comment|/* 13: 64-QAM 2/3 */
end_comment

begin_comment
unit|4,
comment|/* 14: 64-QAM 3/4 */
end_comment

begin_comment
unit|4,
comment|/* 15: 64-QAM 5/6 */
end_comment

begin_endif
unit|};
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|u_int8_t
name|ar9300_get_tx_mode
parameter_list|(
name|u_int
name|rate_flags
parameter_list|)
block|{
comment|/* Check whether STBC is enabled if TxBF is not enabled */
if|if
condition|(
name|rate_flags
operator|&
name|HAL_RATESERIES_STBC
condition|)
block|{
return|return
name|AR9300_STBC_MODE
return|;
block|}
return|return
name|AR9300_DEF_MODE
return|;
block|}
end_function

begin_function
name|void
name|ar9300_set_11n_rate_scenario
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|,
name|void
modifier|*
name|lastds
parameter_list|,
name|u_int
name|dur_update_en
parameter_list|,
name|u_int
name|rts_cts_rate
parameter_list|,
name|u_int
name|rts_cts_duration
parameter_list|,
name|HAL_11N_RATE_SERIES
name|series
index|[]
parameter_list|,
name|u_int
name|nseries
parameter_list|,
name|u_int
name|flags
parameter_list|,
name|u_int32_t
name|smart_antenna
parameter_list|)
block|{
name|struct
name|ath_hal_private
modifier|*
name|ap
init|=
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|struct
name|ar9300_txc
modifier|*
name|last_ads
init|=
name|AR9300TXC
argument_list|(
name|lastds
argument_list|)
decl_stmt|;
name|u_int32_t
name|ds_ctl11
decl_stmt|;
name|u_int8_t
name|ant
decl_stmt|,
name|cal_pkt
init|=
literal|0
decl_stmt|;
name|u_int
name|mode
decl_stmt|,
name|tx_mode
init|=
name|AR9300_DEF_MODE
decl_stmt|;
name|HALASSERT
argument_list|(
name|nseries
operator|==
literal|4
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|nseries
expr_stmt|;
operator|(
name|void
operator|)
name|rts_cts_duration
expr_stmt|;
comment|/* use H/W to calculate RTSCTSDuration */
name|ds_ctl11
operator|=
name|ads
operator|->
name|ds_ctl11
expr_stmt|;
comment|/*      * Rate control settings override      */
if|if
condition|(
name|flags
operator|&
operator|(
name|HAL_TXDESC_RTSENA
operator||
name|HAL_TXDESC_CTSENA
operator|)
condition|)
block|{
if|if
condition|(
name|flags
operator|&
name|HAL_TXDESC_RTSENA
condition|)
block|{
name|ds_ctl11
operator|&=
operator|~
name|AR_cts_enable
expr_stmt|;
name|ds_ctl11
operator||=
name|AR_rts_enable
expr_stmt|;
block|}
else|else
block|{
name|ds_ctl11
operator|&=
operator|~
name|AR_rts_enable
expr_stmt|;
name|ds_ctl11
operator||=
name|AR_cts_enable
expr_stmt|;
block|}
block|}
else|else
block|{
name|ds_ctl11
operator|=
operator|(
name|ds_ctl11
operator|&
operator|~
operator|(
name|AR_rts_enable
operator||
name|AR_cts_enable
operator|)
operator|)
expr_stmt|;
block|}
name|mode
operator|=
name|ath_hal_get_curmode
argument_list|(
name|ah
argument_list|,
name|ap
operator|->
name|ah_curchan
argument_list|)
expr_stmt|;
name|cal_pkt
operator|=
operator|(
name|ads
operator|->
name|ds_ctl12
operator|&
name|AR_paprd_chain_mask
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
if|if
condition|(
name|ah
operator|->
name|ah_config
operator|.
name|ath_hal_desc_tpc
condition|)
block|{
name|int16_t
name|txpower
decl_stmt|;
if|if
condition|(
operator|!
name|cal_pkt
condition|)
block|{
comment|/* Series 0 TxPower */
name|tx_mode
operator|=
name|ar9300_get_tx_mode
argument_list|(
name|series
index|[
literal|0
index|]
operator|.
name|RateFlags
argument_list|)
expr_stmt|;
name|txpower
operator|=
name|ar9300_get_rate_txpower
argument_list|(
name|ah
argument_list|,
name|mode
argument_list|,
name|series
index|[
literal|0
index|]
operator|.
name|RateIndex
argument_list|,
name|series
index|[
literal|0
index|]
operator|.
name|ChSel
argument_list|,
name|tx_mode
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|txpower
operator|=
name|AH9300
argument_list|(
name|ah
argument_list|)
operator|->
name|paprd_training_power
expr_stmt|;
block|}
name|ds_ctl11
operator|&=
operator|~
name|AR_xmit_power0
expr_stmt|;
name|ds_ctl11
operator||=
name|set_11n_tx_power
argument_list|(
literal|0
argument_list|,
name|AH_MIN
argument_list|(
name|txpower
argument_list|,
name|series
index|[
literal|0
index|]
operator|.
name|tx_power_cap
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|ads
operator|->
name|ds_ctl11
operator|=
name|ds_ctl11
expr_stmt|;
name|ads
operator|->
name|ds_ctl13
operator|=
name|set_11n_tries
argument_list|(
name|series
argument_list|,
literal|0
argument_list|)
operator||
name|set_11n_tries
argument_list|(
name|series
argument_list|,
literal|1
argument_list|)
operator||
name|set_11n_tries
argument_list|(
name|series
argument_list|,
literal|2
argument_list|)
operator||
name|set_11n_tries
argument_list|(
name|series
argument_list|,
literal|3
argument_list|)
operator||
operator|(
name|dur_update_en
condition|?
name|AR_dur_update_ena
else|:
literal|0
operator|)
operator||
name|SM
argument_list|(
literal|0
argument_list|,
name|AR_burst_dur
argument_list|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl14
operator|=
name|set_11n_rate
argument_list|(
name|series
argument_list|,
literal|0
argument_list|)
operator||
name|set_11n_rate
argument_list|(
name|series
argument_list|,
literal|1
argument_list|)
operator||
name|set_11n_rate
argument_list|(
name|series
argument_list|,
literal|2
argument_list|)
operator||
name|set_11n_rate
argument_list|(
name|series
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl15
operator|=
name|set_11n_pkt_dur_rts_cts
argument_list|(
name|series
argument_list|,
literal|0
argument_list|)
operator||
name|set_11n_pkt_dur_rts_cts
argument_list|(
name|series
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl16
operator|=
name|set_11n_pkt_dur_rts_cts
argument_list|(
name|series
argument_list|,
literal|2
argument_list|)
operator||
name|set_11n_pkt_dur_rts_cts
argument_list|(
name|series
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl18
operator|=
name|set_11n_rate_flags
argument_list|(
name|series
argument_list|,
literal|0
argument_list|)
operator||
name|set_11n_rate_flags
argument_list|(
name|series
argument_list|,
literal|1
argument_list|)
operator||
name|set_11n_rate_flags
argument_list|(
name|series
argument_list|,
literal|2
argument_list|)
operator||
name|set_11n_rate_flags
argument_list|(
name|series
argument_list|,
literal|3
argument_list|)
operator||
name|SM
argument_list|(
name|rts_cts_rate
argument_list|,
name|AR_rts_cts_rate
argument_list|)
expr_stmt|;
comment|/* set not sounding for normal frame */
name|ads
operator|->
name|ds_ctl19
operator|=
name|AR_not_sounding
expr_stmt|;
if|if
condition|(
name|ah
operator|->
name|ah_config
operator|.
name|ath_hal_desc_tpc
condition|)
block|{
name|int16_t
name|txpower
decl_stmt|;
if|if
condition|(
operator|!
name|cal_pkt
condition|)
block|{
comment|/* Series 1 TxPower */
name|tx_mode
operator|=
name|ar9300_get_tx_mode
argument_list|(
name|series
index|[
literal|1
index|]
operator|.
name|RateFlags
argument_list|)
expr_stmt|;
name|txpower
operator|=
name|ar9300_get_rate_txpower
argument_list|(
name|ah
argument_list|,
name|mode
argument_list|,
name|series
index|[
literal|1
index|]
operator|.
name|RateIndex
argument_list|,
name|series
index|[
literal|1
index|]
operator|.
name|ChSel
argument_list|,
name|tx_mode
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|txpower
operator|=
name|AH9300
argument_list|(
name|ah
argument_list|)
operator|->
name|paprd_training_power
expr_stmt|;
block|}
name|ads
operator|->
name|ds_ctl20
operator||=
name|set_11n_tx_power
argument_list|(
literal|1
argument_list|,
name|AH_MIN
argument_list|(
name|txpower
argument_list|,
name|series
index|[
literal|1
index|]
operator|.
name|tx_power_cap
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Series 2 TxPower */
if|if
condition|(
operator|!
name|cal_pkt
condition|)
block|{
name|tx_mode
operator|=
name|ar9300_get_tx_mode
argument_list|(
name|series
index|[
literal|2
index|]
operator|.
name|RateFlags
argument_list|)
expr_stmt|;
name|txpower
operator|=
name|ar9300_get_rate_txpower
argument_list|(
name|ah
argument_list|,
name|mode
argument_list|,
name|series
index|[
literal|2
index|]
operator|.
name|RateIndex
argument_list|,
name|series
index|[
literal|2
index|]
operator|.
name|ChSel
argument_list|,
name|tx_mode
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|txpower
operator|=
name|AH9300
argument_list|(
name|ah
argument_list|)
operator|->
name|paprd_training_power
expr_stmt|;
block|}
name|ads
operator|->
name|ds_ctl21
operator||=
name|set_11n_tx_power
argument_list|(
literal|2
argument_list|,
name|AH_MIN
argument_list|(
name|txpower
argument_list|,
name|series
index|[
literal|2
index|]
operator|.
name|tx_power_cap
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Series 3 TxPower */
if|if
condition|(
operator|!
name|cal_pkt
condition|)
block|{
name|tx_mode
operator|=
name|ar9300_get_tx_mode
argument_list|(
name|series
index|[
literal|3
index|]
operator|.
name|RateFlags
argument_list|)
expr_stmt|;
name|txpower
operator|=
name|ar9300_get_rate_txpower
argument_list|(
name|ah
argument_list|,
name|mode
argument_list|,
name|series
index|[
literal|3
index|]
operator|.
name|RateIndex
argument_list|,
name|series
index|[
literal|3
index|]
operator|.
name|ChSel
argument_list|,
name|tx_mode
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|txpower
operator|=
name|AH9300
argument_list|(
name|ah
argument_list|)
operator|->
name|paprd_training_power
expr_stmt|;
block|}
name|ads
operator|->
name|ds_ctl22
operator||=
name|set_11n_tx_power
argument_list|(
literal|3
argument_list|,
name|AH_MIN
argument_list|(
name|txpower
argument_list|,
name|series
index|[
literal|3
index|]
operator|.
name|tx_power_cap
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|smart_antenna
operator|!=
literal|0xffffffff
condition|)
block|{
comment|/* TX DESC dword 19 to 23 are used for smart antenna configuaration          * ctl19 for rate series 0 ... ctrl22 for series 3          * bits[2:0] used to configure smart anntenna          */
name|ant
operator|=
operator|(
name|smart_antenna
operator|&
literal|0x000000ff
operator|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl19
operator||=
name|ant
expr_stmt|;
comment|/* rateseries 0 */
name|ant
operator|=
operator|(
name|smart_antenna
operator|&
literal|0x0000ff00
operator|)
operator|>>
literal|8
expr_stmt|;
name|ads
operator|->
name|ds_ctl20
operator||=
name|ant
expr_stmt|;
comment|/* rateseries 1 */
name|ant
operator|=
operator|(
name|smart_antenna
operator|&
literal|0x00ff0000
operator|)
operator|>>
literal|16
expr_stmt|;
name|ads
operator|->
name|ds_ctl21
operator||=
name|ant
expr_stmt|;
comment|/* rateseries 2 */
name|ant
operator|=
operator|(
name|smart_antenna
operator|&
literal|0xff000000
operator|)
operator|>>
literal|24
expr_stmt|;
name|ads
operator|->
name|ds_ctl22
operator||=
name|ant
expr_stmt|;
comment|/* rateseries 3 */
block|}
ifdef|#
directive|ifdef
name|AH_NEED_DESC_SWAP
name|last_ads
operator|->
name|ds_ctl13
operator|=
name|__bswap32
argument_list|(
name|ads
operator|->
name|ds_ctl13
argument_list|)
expr_stmt|;
name|last_ads
operator|->
name|ds_ctl14
operator|=
name|__bswap32
argument_list|(
name|ads
operator|->
name|ds_ctl14
argument_list|)
expr_stmt|;
else|#
directive|else
name|last_ads
operator|->
name|ds_ctl13
operator|=
name|ads
operator|->
name|ds_ctl13
expr_stmt|;
name|last_ads
operator|->
name|ds_ctl14
operator|=
name|ads
operator|->
name|ds_ctl14
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|ar9300_set_11n_aggr_first
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|struct
name|ath_desc
modifier|*
name|ds
parameter_list|,
name|u_int
name|aggr_len
parameter_list|,
name|u_int
name|num_delims
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|ds_ctl12
operator||=
operator|(
name|AR_is_aggr
operator||
name|AR_more_aggr
operator|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl17
operator|&=
operator|~
name|AR_aggr_len
expr_stmt|;
name|ads
operator|->
name|ds_ctl17
operator|&=
operator|~
name|AR_pad_delim
expr_stmt|;
comment|/* XXX should use a stack variable! */
name|ads
operator|->
name|ds_ctl17
operator||=
name|SM
argument_list|(
name|aggr_len
argument_list|,
name|AR_aggr_len
argument_list|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl17
operator||=
name|SM
argument_list|(
name|num_delims
argument_list|,
name|AR_pad_delim
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_set_11n_aggr_middle
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|struct
name|ath_desc
modifier|*
name|ds
parameter_list|,
name|u_int
name|num_delims
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|unsigned
name|int
name|ctl17
decl_stmt|;
name|ads
operator|->
name|ds_ctl12
operator||=
operator|(
name|AR_is_aggr
operator||
name|AR_more_aggr
operator|)
expr_stmt|;
comment|/*      * We use a stack variable to manipulate ctl6 to reduce uncached      * read modify, modfiy, write.      */
name|ctl17
operator|=
name|ads
operator|->
name|ds_ctl17
expr_stmt|;
name|ctl17
operator|&=
operator|~
name|AR_pad_delim
expr_stmt|;
name|ctl17
operator||=
name|SM
argument_list|(
name|num_delims
argument_list|,
name|AR_pad_delim
argument_list|)
expr_stmt|;
name|ads
operator|->
name|ds_ctl17
operator|=
name|ctl17
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_set_11n_aggr_last
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|struct
name|ath_desc
modifier|*
name|ds
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|ds_ctl12
operator||=
name|AR_is_aggr
expr_stmt|;
name|ads
operator|->
name|ds_ctl12
operator|&=
operator|~
name|AR_more_aggr
expr_stmt|;
name|ads
operator|->
name|ds_ctl17
operator|&=
operator|~
name|AR_pad_delim
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_clr_11n_aggr
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|struct
name|ath_desc
modifier|*
name|ds
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|ds_ctl12
operator|&=
operator|(
operator|~
name|AR_is_aggr
operator|&
operator|~
name|AR_more_aggr
operator|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_set_11n_burst_duration
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|struct
name|ath_desc
modifier|*
name|ds
parameter_list|,
name|u_int
name|burst_duration
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|ds_ctl13
operator|&=
operator|~
name|AR_burst_dur
expr_stmt|;
name|ads
operator|->
name|ds_ctl13
operator||=
name|SM
argument_list|(
name|burst_duration
argument_list|,
name|AR_burst_dur
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_set_11n_rifs_burst_middle
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|ds_ctl12
operator||=
name|AR_more_rifs
operator||
name|AR_no_ack
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_set_11n_rifs_burst_last
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|ds_ctl12
operator|&=
operator|(
operator|~
name|AR_more_aggr
operator|&
operator|~
name|AR_more_rifs
operator|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_clr_11n_rifs_burst
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|ds_ctl12
operator|&=
operator|(
operator|~
name|AR_more_rifs
operator|&
operator|~
name|AR_no_ack
operator|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_set_11n_aggr_rifs_burst
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|ds
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
name|ads
operator|->
name|ds_ctl12
operator||=
name|AR_no_ack
expr_stmt|;
name|ads
operator|->
name|ds_ctl12
operator|&=
operator|~
name|AR_more_rifs
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_set_11n_virtual_more_frag
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|struct
name|ath_desc
modifier|*
name|ds
parameter_list|,
name|u_int
name|vmf
parameter_list|)
block|{
name|struct
name|ar9300_txc
modifier|*
name|ads
init|=
name|AR9300TXC
argument_list|(
name|ds
argument_list|)
decl_stmt|;
if|if
condition|(
name|vmf
condition|)
block|{
name|ads
operator|->
name|ds_ctl11
operator||=
name|AR_virt_more_frag
expr_stmt|;
block|}
else|else
block|{
name|ads
operator|->
name|ds_ctl11
operator|&=
operator|~
name|AR_virt_more_frag
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|ar9300_get_desc_info
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_DESC_INFO
modifier|*
name|desc_info
parameter_list|)
block|{
name|desc_info
operator|->
name|txctl_numwords
operator|=
name|TXCTL_NUMWORDS
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|desc_info
operator|->
name|txctl_offset
operator|=
name|TXCTL_OFFSET
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|desc_info
operator|->
name|txstatus_numwords
operator|=
name|TXSTATUS_NUMWORDS
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|desc_info
operator|->
name|txstatus_offset
operator|=
name|TXSTATUS_OFFSET
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|desc_info
operator|->
name|rxctl_numwords
operator|=
name|RXCTL_NUMWORDS
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|desc_info
operator|->
name|rxctl_offset
operator|=
name|RXCTL_OFFSET
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|desc_info
operator|->
name|rxstatus_numwords
operator|=
name|RXSTATUS_NUMWORDS
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|desc_info
operator|->
name|rxstatus_offset
operator|=
name|RXSTATUS_OFFSET
argument_list|(
name|ah
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

