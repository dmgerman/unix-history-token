begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************************************************   Â© 1995-2003, 2004, 2005-2011 Freescale Semiconductor, Inc.  All rights reserved.   This is proprietary source code of Freescale Semiconductor Inc.,  and its use is subject to the NetComm Device Drivers EULA.  The copyright notice above does not evidence any actual or intended  publication of such source code.   ALTERNATIVELY, redistribution and use in source and binary forms, with  or without modification, are permitted provided that the following  conditions are met:      * Redistributions of source code must retain the above copyright        notice, this list of conditions and the following disclaimer.      * Redistributions in binary form must reproduce the above copyright        notice, this list of conditions and the following disclaimer in the        documentation and/or other materials provided with the distribution.      * Neither the name of Freescale Semiconductor nor the        names of its contributors may be used to endorse or promote products        derived from this software without specific prior written permission.   THIS SOFTWARE IS PROVIDED BY Freescale Semiconductor ``AS IS'' AND ANY  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE  DISCLAIMED. IN NO EVENT SHALL Freescale Semiconductor BE LIABLE FOR ANY  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  *    **************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************  @File          bm.c   @Description   BM */
end_comment

begin_comment
comment|/***************************************************************************/
end_comment

begin_include
include|#
directive|include
file|"error_ext.h"
end_include

begin_include
include|#
directive|include
file|"std_ext.h"
end_include

begin_include
include|#
directive|include
file|"string_ext.h"
end_include

begin_include
include|#
directive|include
file|"sprint_ext.h"
end_include

begin_include
include|#
directive|include
file|"debug_ext.h"
end_include

begin_include
include|#
directive|include
file|"mm_ext.h"
end_include

begin_include
include|#
directive|include
file|"bm.h"
end_include

begin_function_decl
name|t_Error
name|BM_ConfigException
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|e_BmExceptions
name|exception
parameter_list|,
name|bool
name|enable
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/****************************************/
end_comment

begin_comment
comment|/*       static functions               */
end_comment

begin_comment
comment|/****************************************/
end_comment

begin_decl_stmt
specifier|static
specifier|volatile
name|bool
name|blockingFlag
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|BmIpcMsgCompletionCB
parameter_list|(
name|t_Handle
name|h_Module
parameter_list|,
name|uint8_t
modifier|*
name|p_Msg
parameter_list|,
name|uint8_t
modifier|*
name|p_Reply
parameter_list|,
name|uint32_t
name|replyLength
parameter_list|,
name|t_Error
name|status
parameter_list|)
block|{
name|SANITY_CHECK_RETURN
argument_list|(
name|h_Module
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DISABLE_SANITY_CHECKS
name|UNUSED
argument_list|(
name|h_Module
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DISABLE_SANITY_CHECKS */
name|UNUSED
argument_list|(
name|p_Msg
argument_list|)
expr_stmt|;
name|UNUSED
argument_list|(
name|p_Reply
argument_list|)
expr_stmt|;
name|UNUSED
argument_list|(
name|replyLength
argument_list|)
expr_stmt|;
name|UNUSED
argument_list|(
name|status
argument_list|)
expr_stmt|;
name|blockingFlag
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|BmHandleIpcMsgCB
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|uint8_t
modifier|*
name|p_Msg
parameter_list|,
name|uint32_t
name|msgLength
parameter_list|,
name|uint8_t
modifier|*
name|p_Reply
parameter_list|,
name|uint32_t
modifier|*
name|p_ReplyLength
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|t_BmIpcMsg
modifier|*
name|p_IpcMsg
init|=
operator|(
name|t_BmIpcMsg
operator|*
operator|)
name|p_Msg
decl_stmt|;
name|t_BmIpcReply
modifier|*
name|p_IpcReply
init|=
operator|(
name|t_BmIpcReply
operator|*
operator|)
name|p_Reply
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
operator|(
name|msgLength
operator|>=
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|)
argument_list|,
name|E_INVALID_VALUE
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DISABLE_SANITY_CHECKS
name|UNUSED
argument_list|(
name|msgLength
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DISABLE_SANITY_CHECKS */
name|ASSERT_COND
argument_list|(
name|p_IpcMsg
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_IpcReply
argument_list|,
literal|0
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
operator|*
name|BM_IPC_MAX_REPLY_SIZE
operator|)
argument_list|)
expr_stmt|;
operator|*
name|p_ReplyLength
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|p_IpcMsg
operator|->
name|msgId
condition|)
block|{
case|case
operator|(
name|BM_MASTER_IS_ALIVE
operator|)
case|:
operator|*
operator|(
name|uint8_t
operator|*
operator|)
name|p_IpcReply
operator|->
name|replyBody
operator|=
literal|1
expr_stmt|;
operator|*
name|p_ReplyLength
operator|=
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|BM_SET_POOL_THRESH
operator|)
case|:
block|{
name|t_Error
name|err
decl_stmt|;
name|t_BmIpcPoolThreshParams
name|ipcPoolThresh
decl_stmt|;
name|memcpy
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|ipcPoolThresh
argument_list|,
name|p_IpcMsg
operator|->
name|msgBody
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcPoolThreshParams
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|BmSetPoolThresholds
argument_list|(
name|p_Bm
argument_list|,
name|ipcPoolThresh
operator|.
name|bpid
argument_list|,
name|ipcPoolThresh
operator|.
name|thresholds
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
operator|(
name|BM_UNSET_POOL_THRESH
operator|)
case|:
block|{
name|t_Error
name|err
decl_stmt|;
name|t_BmIpcPoolThreshParams
name|ipcPoolThresh
decl_stmt|;
name|memcpy
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|ipcPoolThresh
argument_list|,
name|p_IpcMsg
operator|->
name|msgBody
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcPoolThreshParams
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|BmUnSetPoolThresholds
argument_list|(
name|p_Bm
argument_list|,
name|ipcPoolThresh
operator|.
name|bpid
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
operator|(
name|BM_GET_COUNTER
operator|)
case|:
block|{
name|t_BmIpcGetCounter
name|ipcCounter
decl_stmt|;
name|uint32_t
name|count
decl_stmt|;
name|memcpy
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|ipcCounter
argument_list|,
name|p_IpcMsg
operator|->
name|msgBody
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcGetCounter
argument_list|)
argument_list|)
expr_stmt|;
name|count
operator|=
name|BmGetCounter
argument_list|(
name|p_Bm
argument_list|,
operator|(
name|e_BmInterModuleCounters
operator|)
name|ipcCounter
operator|.
name|enumId
argument_list|,
name|ipcCounter
operator|.
name|bpid
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|p_IpcReply
operator|->
name|replyBody
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|count
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|p_ReplyLength
operator|=
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
operator|(
name|BM_GET_REVISION
operator|)
case|:
block|{
name|t_BmRevisionInfo
name|revInfo
decl_stmt|;
name|t_BmIpcRevisionInfo
name|ipcRevInfo
decl_stmt|;
name|p_IpcReply
operator|->
name|error
operator|=
operator|(
name|uint32_t
operator|)
name|BmGetRevision
argument_list|(
name|h_Bm
argument_list|,
operator|&
name|revInfo
argument_list|)
expr_stmt|;
name|ipcRevInfo
operator|.
name|majorRev
operator|=
name|revInfo
operator|.
name|majorRev
expr_stmt|;
name|ipcRevInfo
operator|.
name|minorRev
operator|=
name|revInfo
operator|.
name|minorRev
expr_stmt|;
name|memcpy
argument_list|(
name|p_IpcReply
operator|->
name|replyBody
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|ipcRevInfo
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcRevisionInfo
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|p_ReplyLength
operator|=
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|t_BmIpcRevisionInfo
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
operator|(
name|BM_FORCE_BPID
operator|)
case|:
block|{
name|t_BmIpcBpidParams
name|ipcBpid
decl_stmt|;
name|uint32_t
name|tmp
decl_stmt|;
name|memcpy
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|ipcBpid
argument_list|,
name|p_IpcMsg
operator|->
name|msgBody
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcBpidParams
argument_list|)
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|BmBpidGet
argument_list|(
name|p_Bm
argument_list|,
name|TRUE
argument_list|,
name|ipcBpid
operator|.
name|bpid
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|p_IpcReply
operator|->
name|replyBody
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|tmp
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|p_ReplyLength
operator|=
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
operator|(
name|BM_PUT_BPID
operator|)
case|:
block|{
name|t_Error
name|err
decl_stmt|;
name|t_BmIpcBpidParams
name|ipcBpid
decl_stmt|;
name|memcpy
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|ipcBpid
argument_list|,
name|p_IpcMsg
operator|->
name|msgBody
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcBpidParams
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|BmBpidPut
argument_list|(
name|p_Bm
argument_list|,
name|ipcBpid
operator|.
name|bpid
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
operator|*
name|p_ReplyLength
operator|=
literal|0
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_INVALID_SELECTION
argument_list|,
operator|(
literal|"command not found!!!"
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|CheckBmParameters
parameter_list|(
name|t_Bm
modifier|*
name|p_Bm
parameter_list|)
block|{
if|if
condition|(
operator|(
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|partBpidBase
operator|+
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|partNumOfPools
operator|)
operator|>
name|BM_MAX_NUM_OF_POOLS
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"partBpidBase+partNumOfPools out of range!!!"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|guestId
operator|==
name|NCSW_MASTER_ID
condition|)
block|{
if|if
condition|(
operator|!
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|totalNumOfBuffers
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"totalNumOfBuffers must be larger than '0'!!!"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|totalNumOfBuffers
operator|>
operator|(
literal|128
operator|*
name|MEGABYTE
operator|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"totalNumOfBuffers must be equal or smaller than 128M!!!"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_Bm
operator|->
name|f_Exception
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"Exceptions callback not provided"
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|__inline__
name|uint32_t
name|GenerateThresh
parameter_list|(
name|uint32_t
name|val
parameter_list|,
name|int
name|roundup
parameter_list|)
block|{
name|uint32_t
name|e
init|=
literal|0
decl_stmt|;
comment|/* co-efficient, exponent */
name|uint32_t
name|oddbit
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|val
operator|>
literal|0xff
condition|)
block|{
name|oddbit
operator|=
name|val
operator|&
literal|1
expr_stmt|;
name|val
operator|>>=
literal|1
expr_stmt|;
name|e
operator|++
expr_stmt|;
if|if
condition|(
name|roundup
operator|&&
name|oddbit
condition|)
name|val
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|val
operator||
operator|(
name|e
operator|<<
literal|8
operator|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|BmSetPool
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|uint8_t
name|bpid
parameter_list|,
name|uint32_t
name|swdet
parameter_list|,
name|uint32_t
name|swdxt
parameter_list|,
name|uint32_t
name|hwdet
parameter_list|,
name|uint32_t
name|hwdxt
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|bpid
operator|<
name|BM_MAX_NUM_OF_POOLS
argument_list|,
name|E_INVALID_VALUE
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|swdet
index|[
name|bpid
index|]
argument_list|,
name|GenerateThresh
argument_list|(
name|swdet
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|swdxt
index|[
name|bpid
index|]
argument_list|,
name|GenerateThresh
argument_list|(
name|swdxt
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|hwdet
index|[
name|bpid
index|]
argument_list|,
name|GenerateThresh
argument_list|(
name|hwdet
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|hwdxt
index|[
name|bpid
index|]
argument_list|,
name|GenerateThresh
argument_list|(
name|hwdxt
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_comment
comment|/****************************************/
end_comment

begin_comment
comment|/*       Inter-Module functions        */
end_comment

begin_comment
comment|/****************************************/
end_comment

begin_function
name|t_Error
name|BmSetPoolThresholds
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|uint8_t
name|bpid
parameter_list|,
specifier|const
name|uint32_t
modifier|*
name|thresholds
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|bpid
operator|<
name|BM_MAX_NUM_OF_POOLS
argument_list|,
name|E_INVALID_VALUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|guestId
operator|==
name|NCSW_MASTER_ID
condition|)
block|{
return|return
name|BmSetPool
argument_list|(
name|h_Bm
argument_list|,
name|bpid
argument_list|,
name|thresholds
index|[
literal|0
index|]
argument_list|,
name|thresholds
index|[
literal|1
index|]
argument_list|,
name|thresholds
index|[
literal|2
index|]
argument_list|,
name|thresholds
index|[
literal|3
index|]
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|p_Bm
operator|->
name|h_Session
condition|)
block|{
name|t_BmIpcMsg
name|msg
decl_stmt|;
name|t_BmIpcPoolThreshParams
name|ipcPoolThresh
decl_stmt|;
name|t_Error
name|errCode
init|=
name|E_OK
decl_stmt|;
name|memset
argument_list|(
operator|&
name|msg
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcMsg
argument_list|)
argument_list|)
expr_stmt|;
name|ipcPoolThresh
operator|.
name|bpid
operator|=
name|bpid
expr_stmt|;
name|memcpy
argument_list|(
name|ipcPoolThresh
operator|.
name|thresholds
argument_list|,
name|thresholds
argument_list|,
sizeof|sizeof
argument_list|(
name|uintptr_t
argument_list|)
operator|*
name|MAX_DEPLETION_THRESHOLDS
argument_list|)
expr_stmt|;
name|msg
operator|.
name|msgId
operator|=
name|BM_SET_POOL_THRESH
expr_stmt|;
name|memcpy
argument_list|(
name|msg
operator|.
name|msgBody
argument_list|,
operator|&
name|ipcPoolThresh
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcPoolThreshParams
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|errCode
operator|=
name|XX_IpcSendMessage
argument_list|(
name|p_Bm
operator|->
name|h_Session
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|msg
argument_list|,
sizeof|sizeof
argument_list|(
name|msg
operator|.
name|msgId
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|t_BmIpcPoolThreshParams
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|errCode
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
else|else
name|RETURN_ERROR
argument_list|(
name|WARNING
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"IPC"
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|t_Error
name|BmUnSetPoolThresholds
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|uint8_t
name|bpid
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|bpid
operator|<
name|BM_MAX_NUM_OF_POOLS
argument_list|,
name|E_INVALID_VALUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|guestId
operator|==
name|NCSW_MASTER_ID
condition|)
block|{
return|return
name|BmSetPool
argument_list|(
name|h_Bm
argument_list|,
name|bpid
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|p_Bm
operator|->
name|h_Session
condition|)
block|{
name|t_BmIpcMsg
name|msg
decl_stmt|;
name|t_BmIpcPoolThreshParams
name|ipcPoolThresh
decl_stmt|;
name|t_Error
name|errCode
init|=
name|E_OK
decl_stmt|;
name|memset
argument_list|(
operator|&
name|msg
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcMsg
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ipcPoolThresh
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcPoolThreshParams
argument_list|)
argument_list|)
expr_stmt|;
name|ipcPoolThresh
operator|.
name|bpid
operator|=
name|bpid
expr_stmt|;
name|msg
operator|.
name|msgId
operator|=
name|BM_UNSET_POOL_THRESH
expr_stmt|;
name|memcpy
argument_list|(
name|msg
operator|.
name|msgBody
argument_list|,
operator|&
name|ipcPoolThresh
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcPoolThreshParams
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|errCode
operator|=
name|XX_IpcSendMessage
argument_list|(
name|p_Bm
operator|->
name|h_Session
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|msg
argument_list|,
sizeof|sizeof
argument_list|(
name|msg
operator|.
name|msgId
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|t_BmIpcPoolThreshParams
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|errCode
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
else|else
name|RETURN_ERROR
argument_list|(
name|WARNING
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"IPC"
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint32_t
name|BmGetCounter
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|e_BmInterModuleCounters
name|counter
parameter_list|,
name|uint8_t
name|bpid
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|bpid
operator|<
name|BM_MAX_NUM_OF_POOLS
argument_list|,
name|E_INVALID_VALUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
operator|(
operator|(
operator|(
name|p_Bm
operator|->
name|guestId
operator|==
name|NCSW_MASTER_ID
operator|)
operator|&&
name|p_Bm
operator|->
name|p_BmRegs
operator|)
operator|||
operator|(
name|p_Bm
operator|->
name|guestId
operator|!=
name|NCSW_MASTER_ID
operator|)
operator|)
argument_list|,
name|E_INVALID_STATE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p_Bm
operator|->
name|guestId
operator|==
name|NCSW_MASTER_ID
operator|)
operator|||
operator|(
operator|!
name|p_Bm
operator|->
name|h_Session
operator|&&
name|p_Bm
operator|->
name|p_BmRegs
operator|)
condition|)
block|{
switch|switch
condition|(
name|counter
condition|)
block|{
case|case
operator|(
name|e_BM_IM_COUNTERS_POOL_CONTENT
operator|)
case|:
return|return
name|GET_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|content
index|[
name|bpid
index|]
argument_list|)
return|;
case|case
operator|(
name|e_BM_IM_COUNTERS_POOL_SW_DEPLETION
operator|)
case|:
return|return
name|GET_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|sdcnt
index|[
name|bpid
index|]
argument_list|)
return|;
case|case
operator|(
name|e_BM_IM_COUNTERS_POOL_HW_DEPLETION
operator|)
case|:
return|return
name|GET_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|hdcnt
index|[
name|bpid
index|]
argument_list|)
return|;
case|case
operator|(
name|e_BM_IM_COUNTERS_FBPR
operator|)
case|:
return|return
name|GET_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|fbpr_fpc
argument_list|)
return|;
default|default:
break|break;
block|}
comment|/* should never get here */
name|ASSERT_COND
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|p_Bm
operator|->
name|h_Session
condition|)
block|{
name|t_BmIpcMsg
name|msg
decl_stmt|;
name|t_BmIpcReply
name|reply
decl_stmt|;
name|t_BmIpcGetCounter
name|ipcCounter
decl_stmt|;
name|uint32_t
name|replyLength
decl_stmt|;
name|uint32_t
name|count
decl_stmt|;
name|t_Error
name|errCode
init|=
name|E_OK
decl_stmt|;
name|memset
argument_list|(
operator|&
name|msg
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcMsg
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|reply
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcReply
argument_list|)
argument_list|)
expr_stmt|;
name|ipcCounter
operator|.
name|bpid
operator|=
name|bpid
expr_stmt|;
name|ipcCounter
operator|.
name|enumId
operator|=
operator|(
name|uint32_t
operator|)
name|counter
expr_stmt|;
name|msg
operator|.
name|msgId
operator|=
name|BM_GET_COUNTER
expr_stmt|;
name|memcpy
argument_list|(
name|msg
operator|.
name|msgBody
argument_list|,
operator|&
name|ipcCounter
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcGetCounter
argument_list|)
argument_list|)
expr_stmt|;
name|replyLength
operator|=
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|errCode
operator|=
name|XX_IpcSendMessage
argument_list|(
name|p_Bm
operator|->
name|h_Session
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|msg
argument_list|,
sizeof|sizeof
argument_list|(
name|msg
operator|.
name|msgId
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|t_BmIpcGetCounter
argument_list|)
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|reply
argument_list|,
operator|&
name|replyLength
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|errCode
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
if|if
condition|(
name|replyLength
operator|!=
operator|(
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|)
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"IPC reply length mismatch"
operator|)
argument_list|)
expr_stmt|;
name|errCode
operator|=
name|E_INVALID_VALUE
expr_stmt|;
block|}
if|if
condition|(
name|errCode
operator|==
name|E_OK
condition|)
block|{
name|memcpy
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|count
argument_list|,
name|reply
operator|.
name|replyBody
argument_list|,
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|count
return|;
block|}
block|}
else|else
name|REPORT_ERROR
argument_list|(
name|WARNING
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"In 'guest', either IPC or 'baseAddress' is required!"
operator|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|t_Error
name|BmGetRevision
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|t_BmRevisionInfo
modifier|*
name|p_BmRevisionInfo
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|uint32_t
name|tmpReg
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_BmRevisionInfo
argument_list|,
name|E_NULL_POINTER
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
operator|(
operator|(
operator|(
name|p_Bm
operator|->
name|guestId
operator|==
name|NCSW_MASTER_ID
operator|)
operator|&&
name|p_Bm
operator|->
name|p_BmRegs
operator|)
operator|||
operator|(
name|p_Bm
operator|->
name|guestId
operator|!=
name|NCSW_MASTER_ID
operator|)
operator|)
argument_list|,
name|E_INVALID_STATE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p_Bm
operator|->
name|guestId
operator|==
name|NCSW_MASTER_ID
operator|)
operator|||
operator|(
operator|!
name|p_Bm
operator|->
name|h_Session
operator|&&
name|p_Bm
operator|->
name|p_BmRegs
operator|)
condition|)
block|{
comment|/* read revision register 1 */
name|tmpReg
operator|=
name|GET_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|ip_rev_1
argument_list|)
expr_stmt|;
name|p_BmRevisionInfo
operator|->
name|majorRev
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmpReg
operator|&
name|REV1_MAJOR_MASK
operator|)
operator|>>
name|REV1_MAJOR_SHIFT
argument_list|)
expr_stmt|;
name|p_BmRevisionInfo
operator|->
name|minorRev
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmpReg
operator|&
name|REV1_MINOR_MASK
operator|)
operator|>>
name|REV1_MINOR_SHIFT
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|p_Bm
operator|->
name|h_Session
condition|)
block|{
name|t_BmIpcMsg
name|msg
decl_stmt|;
name|t_BmIpcReply
name|reply
decl_stmt|;
name|t_BmIpcRevisionInfo
name|ipcRevInfo
decl_stmt|;
name|uint32_t
name|replyLength
decl_stmt|;
name|t_Error
name|errCode
init|=
name|E_OK
decl_stmt|;
name|memset
argument_list|(
operator|&
name|msg
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcMsg
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|reply
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcReply
argument_list|)
argument_list|)
expr_stmt|;
name|msg
operator|.
name|msgId
operator|=
name|BM_GET_REVISION
expr_stmt|;
name|replyLength
operator|=
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|t_BmIpcRevisionInfo
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|errCode
operator|=
name|XX_IpcSendMessage
argument_list|(
name|p_Bm
operator|->
name|h_Session
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|msg
argument_list|,
sizeof|sizeof
argument_list|(
name|msg
operator|.
name|msgId
argument_list|)
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|reply
argument_list|,
operator|&
name|replyLength
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|errCode
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
if|if
condition|(
name|replyLength
operator|!=
operator|(
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|t_BmIpcRevisionInfo
argument_list|)
operator|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"IPC reply length mismatch"
operator|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|ipcRevInfo
argument_list|,
name|reply
operator|.
name|replyBody
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcRevisionInfo
argument_list|)
argument_list|)
expr_stmt|;
name|p_BmRevisionInfo
operator|->
name|majorRev
operator|=
name|ipcRevInfo
operator|.
name|majorRev
expr_stmt|;
name|p_BmRevisionInfo
operator|->
name|minorRev
operator|=
name|ipcRevInfo
operator|.
name|minorRev
expr_stmt|;
return|return
call|(
name|t_Error
call|)
argument_list|(
name|reply
operator|.
name|error
argument_list|)
return|;
block|}
else|else
name|RETURN_ERROR
argument_list|(
name|WARNING
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"In 'guest', either IPC or 'baseAddress' is required!"
operator|)
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|FreeInitResources
parameter_list|(
name|t_Bm
modifier|*
name|p_Bm
parameter_list|)
block|{
if|if
condition|(
name|p_Bm
operator|->
name|p_FbprBase
condition|)
name|XX_FreeSmart
argument_list|(
name|p_Bm
operator|->
name|p_FbprBase
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|h_Session
condition|)
name|XX_IpcFreeSession
argument_list|(
name|p_Bm
operator|->
name|h_Session
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|h_BpidMm
condition|)
name|MM_Free
argument_list|(
name|p_Bm
operator|->
name|h_BpidMm
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/****************************************/
end_comment

begin_comment
comment|/*       API Init unit functions        */
end_comment

begin_comment
comment|/****************************************/
end_comment

begin_function
name|t_Handle
name|BM_Config
parameter_list|(
name|t_BmParam
modifier|*
name|p_BmParam
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|p_BmParam
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|p_Bm
operator|=
operator|(
name|t_Bm
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_Bm
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_Bm
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"BM obj!!!"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|memset
argument_list|(
name|p_Bm
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_Bm
argument_list|)
argument_list|)
expr_stmt|;
name|p_Bm
operator|->
name|p_BmDriverParams
operator|=
operator|(
name|t_BmDriverParams
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_BmDriverParams
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_Bm
operator|->
name|p_BmDriverParams
condition|)
block|{
name|XX_Free
argument_list|(
name|p_Bm
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"Bm driver parameters"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|memset
argument_list|(
name|p_Bm
operator|->
name|p_BmDriverParams
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmDriverParams
argument_list|)
argument_list|)
expr_stmt|;
name|p_Bm
operator|->
name|guestId
operator|=
name|p_BmParam
operator|->
name|guestId
expr_stmt|;
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|partNumOfPools
operator|=
name|p_BmParam
operator|->
name|partNumOfPools
expr_stmt|;
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|partBpidBase
operator|=
name|p_BmParam
operator|->
name|partBpidBase
expr_stmt|;
name|p_Bm
operator|->
name|p_BmRegs
operator|=
operator|(
name|t_BmRegs
operator|*
operator|)
name|UINT_TO_PTR
argument_list|(
name|p_BmParam
operator|->
name|baseAddress
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|guestId
operator|==
name|NCSW_MASTER_ID
condition|)
block|{
name|p_Bm
operator|->
name|exceptions
operator|=
name|DEFAULT_exceptions
expr_stmt|;
name|p_Bm
operator|->
name|f_Exception
operator|=
name|p_BmParam
operator|->
name|f_Exception
expr_stmt|;
name|p_Bm
operator|->
name|h_App
operator|=
name|p_BmParam
operator|->
name|h_App
expr_stmt|;
name|p_Bm
operator|->
name|errIrq
operator|=
name|p_BmParam
operator|->
name|errIrq
expr_stmt|;
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|totalNumOfBuffers
operator|=
name|p_BmParam
operator|->
name|totalNumOfBuffers
expr_stmt|;
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|fbprMemPartitionId
operator|=
name|p_BmParam
operator|->
name|fbprMemPartitionId
expr_stmt|;
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|fbprThreshold
operator|=
name|DEFAULT_fbprThreshold
expr_stmt|;
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|liodn
operator|=
name|p_BmParam
operator|->
name|liodn
expr_stmt|;
block|}
comment|/* build the BM partition IPC address */
name|memset
argument_list|(
name|p_Bm
operator|->
name|moduleName
argument_list|,
literal|0
argument_list|,
name|MODULE_NAME_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|Sprint
argument_list|(
name|p_Bm
operator|->
name|moduleName
argument_list|,
literal|"BM_0_%d"
argument_list|,
name|p_Bm
operator|->
name|guestId
argument_list|)
operator|!=
operator|(
name|p_Bm
operator|->
name|guestId
operator|<
literal|10
condition|?
literal|6
else|:
literal|7
operator|)
condition|)
block|{
name|XX_Free
argument_list|(
name|p_Bm
operator|->
name|p_BmDriverParams
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_Bm
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"Sprint failed"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|p_Bm
return|;
block|}
end_function

begin_function
name|t_Error
name|BM_Init
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
operator|->
name|p_BmDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|CHECK_INIT_PARAMETERS
argument_list|(
name|p_Bm
argument_list|,
name|CheckBmParameters
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|partNumOfPools
condition|)
if|if
condition|(
name|MM_Init
argument_list|(
operator|&
name|p_Bm
operator|->
name|h_BpidMm
argument_list|,
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|partBpidBase
argument_list|,
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|partNumOfPools
argument_list|)
operator|!=
name|E_OK
condition|)
block|{
name|FreeInitResources
argument_list|(
name|p_Bm
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
operator|(
literal|"BM-BPIDS-MEM partition!!!"
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|p_Bm
operator|->
name|guestId
operator|==
name|NCSW_MASTER_ID
condition|)
block|{
name|uint64_t
name|phyAddr
decl_stmt|;
name|t_BmRevisionInfo
name|revInfo
decl_stmt|;
name|uint32_t
name|dsSize
decl_stmt|,
name|exp
decl_stmt|;
name|BmGetRevision
argument_list|(
name|p_Bm
argument_list|,
operator|&
name|revInfo
argument_list|)
expr_stmt|;
name|DBG
argument_list|(
name|TRACE
argument_list|,
operator|(
literal|"Bman ver:%02x,%02x"
operator|,
name|revInfo
operator|.
name|majorRev
operator|,
name|revInfo
operator|.
name|minorRev
operator|)
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|liodnr
argument_list|,
operator|(
name|uint16_t
operator|)
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|liodn
argument_list|)
expr_stmt|;
comment|/* FBPR memory */
name|dsSize
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|totalNumOfBuffers
operator|*
operator|(
name|FBPR_ENTRY_SIZE
operator|/
literal|8
operator|)
argument_list|)
expr_stmt|;
name|LOG2
argument_list|(
name|dsSize
argument_list|,
name|exp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|POWER_OF_2
argument_list|(
name|dsSize
argument_list|)
condition|)
operator|(
name|exp
operator|++
operator|)
expr_stmt|;
name|dsSize
operator|=
call|(
name|uint32_t
call|)
argument_list|(
literal|1
operator|<<
name|exp
argument_list|)
expr_stmt|;
if|if
condition|(
name|dsSize
operator|<
operator|(
literal|4
operator|*
name|KILOBYTE
operator|)
condition|)
block|{
name|dsSize
operator|=
operator|(
literal|4
operator|*
name|KILOBYTE
operator|)
expr_stmt|;
name|LOG2
argument_list|(
name|dsSize
argument_list|,
name|exp
argument_list|)
expr_stmt|;
block|}
name|p_Bm
operator|->
name|p_FbprBase
operator|=
name|XX_MallocSmart
argument_list|(
name|dsSize
argument_list|,
operator|(
name|int
operator|)
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|fbprMemPartitionId
argument_list|,
name|dsSize
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_Bm
operator|->
name|p_FbprBase
condition|)
block|{
name|FreeInitResources
argument_list|(
name|p_Bm
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"FBPR obj!!!"
operator|)
argument_list|)
expr_stmt|;
block|}
name|phyAddr
operator|=
name|XX_VirtToPhys
argument_list|(
name|p_Bm
operator|->
name|p_FbprBase
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|fbpr_bare
argument_list|,
operator|(
call|(
name|uint32_t
call|)
argument_list|(
name|phyAddr
operator|>>
literal|32
argument_list|)
operator|&
literal|0xffff
operator|)
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|fbpr_bar
argument_list|,
operator|(
name|uint32_t
operator|)
name|phyAddr
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|fbpr_ar
argument_list|,
operator|(
name|exp
operator|-
literal|1
operator|)
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|fbpr_fp_lwit
argument_list|,
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|fbprThreshold
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|err_isr
argument_list|,
name|p_Bm
operator|->
name|exceptions
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|err_ier
argument_list|,
name|p_Bm
operator|->
name|exceptions
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|err_isdr
argument_list|,
literal|0x0
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|errIrq
operator|!=
name|NO_IRQ
condition|)
block|{
name|XX_SetIntr
argument_list|(
name|p_Bm
operator|->
name|errIrq
argument_list|,
name|BM_ErrorIsr
argument_list|,
name|p_Bm
argument_list|)
expr_stmt|;
name|XX_EnableIntr
argument_list|(
name|p_Bm
operator|->
name|errIrq
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|err
operator|=
name|XX_IpcRegisterMsgHandler
argument_list|(
name|p_Bm
operator|->
name|moduleName
argument_list|,
name|BmHandleIpcMsgCB
argument_list|,
name|p_Bm
argument_list|,
name|BM_IPC_MAX_REPLY_SIZE
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
block|{
name|FreeInitResources
argument_list|(
name|p_Bm
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
block|}
else|else
comment|/* guest mode */
block|{
name|char
name|masterModuleName
index|[
name|MODULE_NAME_SIZE
index|]
decl_stmt|;
name|memset
argument_list|(
name|masterModuleName
argument_list|,
literal|0
argument_list|,
name|MODULE_NAME_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|Sprint
argument_list|(
name|masterModuleName
argument_list|,
literal|"BM_0_%d"
argument_list|,
name|NCSW_MASTER_ID
argument_list|)
operator|!=
operator|(
name|NCSW_MASTER_ID
operator|<
literal|10
condition|?
literal|6
else|:
literal|7
operator|)
condition|)
block|{
name|FreeInitResources
argument_list|(
name|p_Bm
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"Sprint failed"
operator|)
argument_list|)
expr_stmt|;
block|}
name|p_Bm
operator|->
name|h_Session
operator|=
name|XX_IpcInitSession
argument_list|(
name|masterModuleName
argument_list|,
name|p_Bm
operator|->
name|moduleName
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|h_Session
condition|)
block|{
name|t_BmIpcMsg
name|msg
decl_stmt|;
name|uint8_t
name|isMasterAlive
init|=
literal|0
decl_stmt|;
name|t_BmIpcReply
name|reply
decl_stmt|;
name|uint32_t
name|replyLength
decl_stmt|;
name|memset
argument_list|(
operator|&
name|msg
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcMsg
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|reply
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_BmIpcReply
argument_list|)
argument_list|)
expr_stmt|;
name|msg
operator|.
name|msgId
operator|=
name|BM_MASTER_IS_ALIVE
expr_stmt|;
name|replyLength
operator|=
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
expr_stmt|;
do|do
block|{
name|blockingFlag
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|XX_IpcSendMessage
argument_list|(
name|p_Bm
operator|->
name|h_Session
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|msg
argument_list|,
sizeof|sizeof
argument_list|(
name|msg
operator|.
name|msgId
argument_list|)
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|reply
argument_list|,
operator|&
name|replyLength
argument_list|,
name|BmIpcMsgCompletionCB
argument_list|,
name|p_Bm
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
while|while
condition|(
name|blockingFlag
condition|)
empty_stmt|;
if|if
condition|(
name|replyLength
operator|!=
operator|(
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
operator|)
condition|)
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"IPC reply length mismatch"
operator|)
argument_list|)
expr_stmt|;
name|isMasterAlive
operator|=
operator|*
operator|(
name|uint8_t
operator|*
operator|)
operator|(
name|reply
operator|.
name|replyBody
operator|)
expr_stmt|;
block|}
do|while
condition|(
operator|!
name|isMasterAlive
condition|)
do|;
block|}
block|}
name|XX_Free
argument_list|(
name|p_Bm
operator|->
name|p_BmDriverParams
argument_list|)
expr_stmt|;
name|p_Bm
operator|->
name|p_BmDriverParams
operator|=
name|NULL
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|BM_Free
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
if|if
condition|(
operator|!
name|p_Bm
condition|)
return|return
name|ERROR_CODE
argument_list|(
name|E_INVALID_HANDLE
argument_list|)
return|;
if|if
condition|(
name|p_Bm
operator|->
name|guestId
operator|==
name|NCSW_MASTER_ID
condition|)
block|{
name|XX_IpcUnregisterMsgHandler
argument_list|(
name|p_Bm
operator|->
name|moduleName
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|errIrq
operator|!=
name|NO_IRQ
condition|)
block|{
name|XX_DisableIntr
argument_list|(
name|p_Bm
operator|->
name|errIrq
argument_list|)
expr_stmt|;
name|XX_FreeIntr
argument_list|(
name|p_Bm
operator|->
name|errIrq
argument_list|)
expr_stmt|;
block|}
block|}
name|FreeInitResources
argument_list|(
name|p_Bm
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|p_BmDriverParams
condition|)
name|XX_Free
argument_list|(
name|p_Bm
operator|->
name|p_BmDriverParams
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_Bm
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|BM_ConfigException
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|e_BmExceptions
name|exception
parameter_list|,
name|bool
name|enable
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|uint32_t
name|bitMask
init|=
literal|0
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
operator|->
name|p_BmDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|GET_EXCEPTION_FLAG
argument_list|(
name|bitMask
argument_list|,
name|exception
argument_list|)
expr_stmt|;
if|if
condition|(
name|bitMask
condition|)
block|{
if|if
condition|(
name|enable
condition|)
name|p_Bm
operator|->
name|exceptions
operator||=
name|bitMask
expr_stmt|;
else|else
name|p_Bm
operator|->
name|exceptions
operator|&=
operator|~
name|bitMask
expr_stmt|;
block|}
else|else
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"Undefined exception"
operator|)
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|BM_ConfigFbprThreshold
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|uint32_t
name|threshold
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
operator|->
name|p_BmDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_Bm
operator|->
name|p_BmDriverParams
operator|->
name|fbprThreshold
operator|=
name|threshold
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|void
name|BM_ErrorIsr
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|uint32_t
name|tmpReg
decl_stmt|;
name|SANITY_CHECK_RETURN
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|guestId
operator|!=
name|NCSW_MASTER_ID
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|WARNING
argument_list|,
name|E_INVALID_OPERATION
argument_list|,
operator|(
literal|"Master Only"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|tmpReg
operator|=
name|GET_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|err_isr
argument_list|)
expr_stmt|;
name|tmpReg
operator|&=
name|GET_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|err_ier
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|err_isr
argument_list|,
name|tmpReg
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmpReg
operator|&
name|BM_EX_INVALID_COMMAND
condition|)
name|p_Bm
operator|->
name|f_Exception
argument_list|(
name|p_Bm
operator|->
name|h_App
argument_list|,
name|e_BM_EX_INVALID_COMMAND
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmpReg
operator|&
name|BM_EX_FBPR_THRESHOLD
condition|)
name|p_Bm
operator|->
name|f_Exception
argument_list|(
name|p_Bm
operator|->
name|h_App
argument_list|,
name|e_BM_EX_FBPR_THRESHOLD
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmpReg
operator|&
name|BM_EX_MULTI_ECC
condition|)
name|p_Bm
operator|->
name|f_Exception
argument_list|(
name|p_Bm
operator|->
name|h_App
argument_list|,
name|e_BM_EX_MULTI_ECC
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmpReg
operator|&
name|BM_EX_SINGLE_ECC
condition|)
name|p_Bm
operator|->
name|f_Exception
argument_list|(
name|p_Bm
operator|->
name|h_App
argument_list|,
name|e_BM_EX_SINGLE_ECC
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint32_t
name|BM_GetCounter
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|e_BmCounters
name|counter
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
operator|!
name|p_Bm
operator|->
name|p_BmDriverParams
argument_list|,
name|E_INVALID_STATE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|counter
condition|)
block|{
case|case
operator|(
name|e_BM_COUNTERS_FBPR
operator|)
case|:
return|return
name|BmGetCounter
argument_list|(
name|p_Bm
argument_list|,
name|e_BM_IM_COUNTERS_FBPR
argument_list|,
literal|0
argument_list|)
return|;
default|default:
break|break;
block|}
comment|/* should never get here */
name|ASSERT_COND
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|t_Error
name|BM_SetException
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|e_BmExceptions
name|exception
parameter_list|,
name|bool
name|enable
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|uint32_t
name|tmpReg
decl_stmt|,
name|bitMask
init|=
literal|0
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|guestId
operator|!=
name|NCSW_MASTER_ID
condition|)
name|RETURN_ERROR
argument_list|(
name|WARNING
argument_list|,
name|E_INVALID_OPERATION
argument_list|,
operator|(
literal|"Master Only"
operator|)
argument_list|)
expr_stmt|;
name|BM_ConfigException
argument_list|(
name|p_Bm
argument_list|,
name|exception
argument_list|,
name|enable
argument_list|)
expr_stmt|;
name|tmpReg
operator|=
name|GET_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|err_ier
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmpReg
operator||=
name|bitMask
expr_stmt|;
else|else
name|tmpReg
operator|&=
operator|~
name|bitMask
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
operator|->
name|err_ier
argument_list|,
name|tmpReg
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|BM_GetRevision
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|,
name|t_BmRevisionInfo
modifier|*
name|p_BmRevisionInfo
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_BmRevisionInfo
argument_list|,
name|E_NULL_POINTER
argument_list|)
expr_stmt|;
return|return
name|BmGetRevision
argument_list|(
name|p_Bm
argument_list|,
name|p_BmRevisionInfo
argument_list|)
return|;
block|}
end_function

begin_if
if|#
directive|if
operator|(
name|defined
argument_list|(
name|DEBUG_ERRORS
argument_list|)
operator|&&
operator|(
name|DEBUG_ERRORS
operator|>
literal|0
operator|)
operator|)
end_if

begin_function
name|t_Error
name|BM_DumpRegs
parameter_list|(
name|t_Handle
name|h_Bm
parameter_list|)
block|{
name|t_Bm
modifier|*
name|p_Bm
init|=
operator|(
name|t_Bm
operator|*
operator|)
name|h_Bm
decl_stmt|;
name|DECLARE_DUMP
expr_stmt|;
if|if
condition|(
name|p_Bm
operator|->
name|guestId
operator|!=
name|NCSW_MASTER_ID
condition|)
name|RETURN_ERROR
argument_list|(
name|WARNING
argument_list|,
name|E_INVALID_OPERATION
argument_list|,
operator|(
literal|"Master Only"
operator|)
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_Bm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
operator|!
name|p_Bm
operator|->
name|p_BmDriverParams
argument_list|,
name|E_INVALID_STATE
argument_list|)
expr_stmt|;
name|DUMP_SUBTITLE
argument_list|(
operator|(
literal|"\n"
operator|)
argument_list|)
expr_stmt|;
name|DUMP_TITLE
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
operator|(
literal|"BmRegs Regs"
operator|)
argument_list|)
expr_stmt|;
name|DUMP_ARR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|swdet
argument_list|)
expr_stmt|;
name|DUMP_ARR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|hwdet
argument_list|)
expr_stmt|;
name|DUMP_ARR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|swdxt
argument_list|)
expr_stmt|;
name|DUMP_ARR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|hwdxt
argument_list|)
expr_stmt|;
name|DUMP_ARR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|sdcnt
argument_list|)
expr_stmt|;
name|DUMP_ARR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|hdcnt
argument_list|)
expr_stmt|;
name|DUMP_ARR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|content
argument_list|)
expr_stmt|;
name|DUMP_ARR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|hdptr
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|fbpr_fpc
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|fbpr_fp_lwit
argument_list|)
expr_stmt|;
name|DUMP_ARR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|cmd_pm_cfg
argument_list|)
expr_stmt|;
name|DUMP_ARR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|fl_pm_cfg
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|ecsr
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|ecir
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|eadr
argument_list|)
expr_stmt|;
name|DUMP_ARR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|edata
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|sbet
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|efcr
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|efar
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|sbec0
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|sbec1
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|ip_rev_1
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|ip_rev_2
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|fbpr_bare
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|fbpr_bar
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|fbpr_ar
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|srcidr
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|liodnr
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|err_isr
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|err_ier
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|err_isdr
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|err_iir
argument_list|)
expr_stmt|;
name|DUMP_VAR
argument_list|(
name|p_Bm
operator|->
name|p_BmRegs
argument_list|,
name|err_ifr
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* (defined(DEBUG_ERRORS)&& ... */
end_comment

end_unit

