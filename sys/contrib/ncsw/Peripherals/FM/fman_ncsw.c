begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright 2008-2012 Freescale Semiconductor Inc.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions are met:  *     * Redistributions of source code must retain the above copyright  *       notice, this list of conditions and the following disclaimer.  *     * Redistributions in binary form must reproduce the above copyright  *       notice, this list of conditions and the following disclaimer in the  *       documentation and/or other materials provided with the distribution.  *     * Neither the name of Freescale Semiconductor nor the  *       names of its contributors may be used to endorse or promote products  *       derived from this software without specific prior written permission.  *  *  * ALTERNATIVELY, this software may be distributed under the terms of the  * GNU General Public License ("GPL") as published by the Free Software  * Foundation, either version 2 of that License or (at your option) any  * later version.  *  * THIS SOFTWARE IS PROVIDED BY Freescale Semiconductor ``AS IS'' AND ANY  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE  * DISCLAIMED. IN NO EVENT SHALL Freescale Semiconductor BE LIABLE FOR ANY  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<linux/math64.h>
end_include

begin_include
include|#
directive|include
file|"fsl_fman.h"
end_include

begin_include
include|#
directive|include
file|"dpaa_integration_ext.h"
end_include

begin_function
name|uint32_t
name|fman_get_bmi_err_event
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|)
block|{
name|uint32_t
name|event
decl_stmt|,
name|mask
decl_stmt|,
name|force
decl_stmt|;
name|event
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_ievr
argument_list|)
expr_stmt|;
name|mask
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_ier
argument_list|)
expr_stmt|;
name|event
operator|&=
name|mask
expr_stmt|;
comment|/* clear the forced events */
name|force
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_ifr
argument_list|)
expr_stmt|;
if|if
condition|(
name|force
operator|&
name|event
condition|)
name|iowrite32be
argument_list|(
name|force
operator|&
operator|~
name|event
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_ifr
argument_list|)
expr_stmt|;
comment|/* clear the acknowledged events */
name|iowrite32be
argument_list|(
name|event
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_ievr
argument_list|)
expr_stmt|;
return|return
name|event
return|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_qmi_err_event
parameter_list|(
name|struct
name|fman_qmi_regs
modifier|*
name|qmi_rg
parameter_list|)
block|{
name|uint32_t
name|event
decl_stmt|,
name|mask
decl_stmt|,
name|force
decl_stmt|;
name|event
operator|=
name|ioread32be
argument_list|(
operator|&
name|qmi_rg
operator|->
name|fmqm_eie
argument_list|)
expr_stmt|;
name|mask
operator|=
name|ioread32be
argument_list|(
operator|&
name|qmi_rg
operator|->
name|fmqm_eien
argument_list|)
expr_stmt|;
name|event
operator|&=
name|mask
expr_stmt|;
comment|/* clear the forced events */
name|force
operator|=
name|ioread32be
argument_list|(
operator|&
name|qmi_rg
operator|->
name|fmqm_eif
argument_list|)
expr_stmt|;
if|if
condition|(
name|force
operator|&
name|event
condition|)
name|iowrite32be
argument_list|(
name|force
operator|&
operator|~
name|event
argument_list|,
operator|&
name|qmi_rg
operator|->
name|fmqm_eif
argument_list|)
expr_stmt|;
comment|/* clear the acknowledged events */
name|iowrite32be
argument_list|(
name|event
argument_list|,
operator|&
name|qmi_rg
operator|->
name|fmqm_eie
argument_list|)
expr_stmt|;
return|return
name|event
return|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_dma_com_id
parameter_list|(
name|struct
name|fman_dma_regs
modifier|*
name|dma_rg
parameter_list|)
block|{
return|return
name|ioread32be
argument_list|(
operator|&
name|dma_rg
operator|->
name|fmdmtcid
argument_list|)
return|;
block|}
end_function

begin_function
name|uint64_t
name|fman_get_dma_addr
parameter_list|(
name|struct
name|fman_dma_regs
modifier|*
name|dma_rg
parameter_list|)
block|{
name|uint64_t
name|addr
decl_stmt|;
name|addr
operator|=
operator|(
name|uint64_t
operator|)
name|ioread32be
argument_list|(
operator|&
name|dma_rg
operator|->
name|fmdmtal
argument_list|)
expr_stmt|;
name|addr
operator||=
operator|(
call|(
name|uint64_t
call|)
argument_list|(
name|ioread32be
argument_list|(
operator|&
name|dma_rg
operator|->
name|fmdmtah
argument_list|)
argument_list|)
operator|<<
literal|32
operator|)
expr_stmt|;
return|return
name|addr
return|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_dma_err_event
parameter_list|(
name|struct
name|fman_dma_regs
modifier|*
name|dma_rg
parameter_list|)
block|{
name|uint32_t
name|status
decl_stmt|,
name|mask
decl_stmt|;
name|status
operator|=
name|ioread32be
argument_list|(
operator|&
name|dma_rg
operator|->
name|fmdmsr
argument_list|)
expr_stmt|;
name|mask
operator|=
name|ioread32be
argument_list|(
operator|&
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
expr_stmt|;
comment|/* clear DMA_STATUS_BUS_ERR if mask has no DMA_MODE_BER */
if|if
condition|(
operator|(
name|mask
operator|&
name|DMA_MODE_BER
operator|)
operator|!=
name|DMA_MODE_BER
condition|)
name|status
operator|&=
operator|~
name|DMA_STATUS_BUS_ERR
expr_stmt|;
comment|/* clear relevant bits if mask has no DMA_MODE_ECC */
if|if
condition|(
operator|(
name|mask
operator|&
name|DMA_MODE_ECC
operator|)
operator|!=
name|DMA_MODE_ECC
condition|)
name|status
operator|&=
operator|~
operator|(
name|DMA_STATUS_FM_SPDAT_ECC
operator||
name|DMA_STATUS_READ_ECC
operator||
name|DMA_STATUS_SYSTEM_WRITE_ECC
operator||
name|DMA_STATUS_FM_WRITE_ECC
operator|)
expr_stmt|;
comment|/* clear set events */
name|iowrite32be
argument_list|(
name|status
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmsr
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_fpm_err_event
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
name|uint32_t
name|event
decl_stmt|;
name|event
operator|=
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fmfp_ee
argument_list|)
expr_stmt|;
comment|/* clear the all occurred events */
name|iowrite32be
argument_list|(
name|event
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_ee
argument_list|)
expr_stmt|;
return|return
name|event
return|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_muram_err_event
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
name|uint32_t
name|event
decl_stmt|,
name|mask
decl_stmt|;
name|event
operator|=
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
name|mask
operator|=
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fm_rie
argument_list|)
expr_stmt|;
comment|/* clear MURAM event bit (do not clear IRAM event) */
name|iowrite32be
argument_list|(
name|event
operator|&
operator|~
name|FPM_RAM_IRAM_ECC
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|FPM_MURAM_ECC_ERR_EX_EN
operator|)
condition|)
return|return
name|event
return|;
else|else
return|return
literal|0
return|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_iram_err_event
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
name|uint32_t
name|event
decl_stmt|,
name|mask
decl_stmt|;
name|event
operator|=
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
name|mask
operator|=
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fm_rie
argument_list|)
expr_stmt|;
comment|/* clear IRAM event bit (do not clear MURAM event) */
name|iowrite32be
argument_list|(
name|event
operator|&
operator|~
name|FPM_RAM_MURAM_ECC
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|FPM_IRAM_ECC_ERR_EX_EN
operator|)
condition|)
return|return
name|event
return|;
else|else
return|return
literal|0
return|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_qmi_event
parameter_list|(
name|struct
name|fman_qmi_regs
modifier|*
name|qmi_rg
parameter_list|)
block|{
name|uint32_t
name|event
decl_stmt|,
name|mask
decl_stmt|,
name|force
decl_stmt|;
name|event
operator|=
name|ioread32be
argument_list|(
operator|&
name|qmi_rg
operator|->
name|fmqm_ie
argument_list|)
expr_stmt|;
name|mask
operator|=
name|ioread32be
argument_list|(
operator|&
name|qmi_rg
operator|->
name|fmqm_ien
argument_list|)
expr_stmt|;
name|event
operator|&=
name|mask
expr_stmt|;
comment|/* clear the forced events */
name|force
operator|=
name|ioread32be
argument_list|(
operator|&
name|qmi_rg
operator|->
name|fmqm_if
argument_list|)
expr_stmt|;
if|if
condition|(
name|force
operator|&
name|event
condition|)
name|iowrite32be
argument_list|(
name|force
operator|&
operator|~
name|event
argument_list|,
operator|&
name|qmi_rg
operator|->
name|fmqm_if
argument_list|)
expr_stmt|;
comment|/* clear the acknowledged events */
name|iowrite32be
argument_list|(
name|event
argument_list|,
operator|&
name|qmi_rg
operator|->
name|fmqm_ie
argument_list|)
expr_stmt|;
return|return
name|event
return|;
block|}
end_function

begin_function
name|void
name|fman_enable_time_stamp
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|,
name|uint8_t
name|count1ubit
parameter_list|,
name|uint16_t
name|fm_clk_freq
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|uint64_t
name|frac
decl_stmt|;
name|uint32_t
name|intgr
decl_stmt|;
name|uint32_t
name|ts_freq
init|=
call|(
name|uint32_t
call|)
argument_list|(
literal|1
operator|<<
name|count1ubit
argument_list|)
decl_stmt|;
comment|/* in Mhz */
comment|/* configure timestamp so that bit 8 will count 1 microsecond 	 * Find effective count rate at TIMESTAMP least significant bits: 	 * Effective_Count_Rate = 1MHz x 2^8 = 256MHz 	 * Find frequency ratio between effective count rate and the clock: 	 * Effective_Count_Rate / CLK e.g. for 600 MHz clock: 	 * 256/600 = 0.4266666... */
name|intgr
operator|=
name|ts_freq
operator|/
name|fm_clk_freq
expr_stmt|;
comment|/* we multiply by 2^16 to keep the fraction of the division 	 * we do not div back, since we write this value as a fraction 	 * see spec */
name|frac
operator|=
operator|(
operator|(
name|uint64_t
operator|)
name|ts_freq
operator|<<
literal|16
operator|)
operator|-
operator|(
operator|(
name|uint64_t
operator|)
name|intgr
operator|<<
literal|16
operator|)
operator|*
name|fm_clk_freq
expr_stmt|;
comment|/* we check remainder of the division in order to round up if not int */
if|if
condition|(
name|do_div
argument_list|(
name|frac
argument_list|,
name|fm_clk_freq
argument_list|)
condition|)
name|frac
operator|++
expr_stmt|;
name|tmp
operator|=
operator|(
name|intgr
operator|<<
name|FPM_TS_INT_SHIFT
operator|)
operator||
operator|(
name|uint16_t
operator|)
name|frac
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_tsc2
argument_list|)
expr_stmt|;
comment|/* enable timestamp with original clock */
name|iowrite32be
argument_list|(
name|FPM_TS_CTL_EN
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_tsc1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_fpm_error_interrupts
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
return|return
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fm_epi
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|fman_set_erratum_10gmac_a004_wa
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
name|int
name|timeout
init|=
literal|100
decl_stmt|;
name|iowrite32be
argument_list|(
literal|0x40000000
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_extc
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fmfp_extc
argument_list|)
operator|&
literal|0x40000000
operator|)
operator|&&
operator|--
name|timeout
condition|)
name|DELAY
argument_list|(
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|timeout
condition|)
return|return
operator|-
name|EBUSY
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|fman_set_ctrl_intr
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|,
name|uint8_t
name|event_reg_id
parameter_list|,
name|uint32_t
name|enable_events
parameter_list|)
block|{
name|iowrite32be
argument_list|(
name|enable_events
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_cee
index|[
name|event_reg_id
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_ctrl_intr
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|,
name|uint8_t
name|event_reg_id
parameter_list|)
block|{
return|return
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fmfp_cee
index|[
name|event_reg_id
index|]
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|fman_set_num_of_riscs_per_port
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|,
name|uint8_t
name|num_fman_ctrls
parameter_list|,
name|uint32_t
name|or_fman_ctrl
parameter_list|)
block|{
name|uint32_t
name|tmp
init|=
literal|0
decl_stmt|;
name|tmp
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|port_id
operator|<<
name|FPM_PORT_FM_CTL_PORTID_SHIFT
argument_list|)
expr_stmt|;
comment|/*TODO - maybe to put CTL# according to another criteria*/
if|if
condition|(
name|num_fman_ctrls
operator|==
literal|2
condition|)
name|tmp
operator|=
name|FPM_PRT_FM_CTL2
operator||
name|FPM_PRT_FM_CTL1
expr_stmt|;
comment|/* order restoration */
name|tmp
operator||=
operator|(
name|or_fman_ctrl
operator|<<
name|FPM_PRC_ORA_FM_CTL_SEL_SHIFT
operator|)
operator||
name|or_fman_ctrl
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_prc
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_set_order_restoration_per_port
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|,
name|bool
name|independent_mode
parameter_list|,
name|bool
name|is_rx_port
parameter_list|)
block|{
name|uint32_t
name|tmp
init|=
literal|0
decl_stmt|;
name|tmp
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|port_id
operator|<<
name|FPM_PORT_FM_CTL_PORTID_SHIFT
argument_list|)
expr_stmt|;
if|if
condition|(
name|independent_mode
condition|)
block|{
if|if
condition|(
name|is_rx_port
condition|)
name|tmp
operator||=
operator|(
name|FPM_PRT_FM_CTL1
operator|<<
name|FPM_PRC_ORA_FM_CTL_SEL_SHIFT
operator|)
operator||
name|FPM_PRT_FM_CTL1
expr_stmt|;
else|else
name|tmp
operator||=
operator|(
name|FPM_PRT_FM_CTL2
operator|<<
name|FPM_PRC_ORA_FM_CTL_SEL_SHIFT
operator|)
operator||
name|FPM_PRT_FM_CTL2
expr_stmt|;
block|}
else|else
block|{
name|tmp
operator||=
operator|(
name|FPM_PRT_FM_CTL2
operator||
name|FPM_PRT_FM_CTL1
operator|)
expr_stmt|;
comment|/* order restoration */
if|if
condition|(
name|port_id
operator|%
literal|2
condition|)
name|tmp
operator||=
operator|(
name|FPM_PRT_FM_CTL1
operator|<<
name|FPM_PRC_ORA_FM_CTL_SEL_SHIFT
operator|)
expr_stmt|;
else|else
name|tmp
operator||=
operator|(
name|FPM_PRT_FM_CTL2
operator|<<
name|FPM_PRC_ORA_FM_CTL_SEL_SHIFT
operator|)
expr_stmt|;
block|}
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_prc
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint8_t
name|fman_get_qmi_deq_th
parameter_list|(
name|struct
name|fman_qmi_regs
modifier|*
name|qmi_rg
parameter_list|)
block|{
return|return
operator|(
name|uint8_t
operator|)
name|ioread32be
argument_list|(
operator|&
name|qmi_rg
operator|->
name|fmqm_gc
argument_list|)
return|;
block|}
end_function

begin_function
name|uint8_t
name|fman_get_qmi_enq_th
parameter_list|(
name|struct
name|fman_qmi_regs
modifier|*
name|qmi_rg
parameter_list|)
block|{
return|return
call|(
name|uint8_t
call|)
argument_list|(
name|ioread32be
argument_list|(
operator|&
name|qmi_rg
operator|->
name|fmqm_gc
argument_list|)
operator|>>
literal|8
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|fman_set_qmi_enq_th
parameter_list|(
name|struct
name|fman_qmi_regs
modifier|*
name|qmi_rg
parameter_list|,
name|uint8_t
name|val
parameter_list|)
block|{
name|uint32_t
name|tmp_reg
decl_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|qmi_rg
operator|->
name|fmqm_gc
argument_list|)
expr_stmt|;
name|tmp_reg
operator|&=
operator|~
name|QMI_CFG_ENQ_MASK
expr_stmt|;
name|tmp_reg
operator||=
operator|(
operator|(
name|uint32_t
operator|)
name|val
operator|<<
literal|8
operator|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|qmi_rg
operator|->
name|fmqm_gc
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_set_qmi_deq_th
parameter_list|(
name|struct
name|fman_qmi_regs
modifier|*
name|qmi_rg
parameter_list|,
name|uint8_t
name|val
parameter_list|)
block|{
name|uint32_t
name|tmp_reg
decl_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|qmi_rg
operator|->
name|fmqm_gc
argument_list|)
expr_stmt|;
name|tmp_reg
operator|&=
operator|~
name|QMI_CFG_DEQ_MASK
expr_stmt|;
name|tmp_reg
operator||=
operator|(
name|uint32_t
operator|)
name|val
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|qmi_rg
operator|->
name|fmqm_gc
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_qmi_disable_dispatch_limit
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
name|iowrite32be
argument_list|(
literal|0
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_mxd
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_set_liodn_per_port
parameter_list|(
name|struct
name|fman_rg
modifier|*
name|fman_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|,
name|uint16_t
name|liodn_base
parameter_list|,
name|uint16_t
name|liodn_ofst
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
if|if
condition|(
operator|(
name|port_id
operator|>
literal|63
operator|)
operator|||
operator|(
name|port_id
operator|<
literal|1
operator|)
condition|)
return|return;
comment|/* set LIODN base for this port */
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmplr
index|[
name|port_id
operator|/
literal|2
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|port_id
operator|%
literal|2
condition|)
block|{
name|tmp
operator|&=
operator|~
name|FM_LIODN_BASE_MASK
expr_stmt|;
name|tmp
operator||=
operator|(
name|uint32_t
operator|)
name|liodn_base
expr_stmt|;
block|}
else|else
block|{
name|tmp
operator|&=
operator|~
operator|(
name|FM_LIODN_BASE_MASK
operator|<<
name|DMA_LIODN_SHIFT
operator|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|uint32_t
operator|)
name|liodn_base
operator|<<
name|DMA_LIODN_SHIFT
expr_stmt|;
block|}
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmplr
index|[
name|port_id
operator|/
literal|2
index|]
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
operator|(
name|uint32_t
operator|)
name|liodn_ofst
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_spliodn
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|bool
name|fman_is_port_stalled
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|)
block|{
return|return
operator|(
name|bool
operator|)
operator|!
operator|!
operator|(
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fmfp_ps
index|[
name|port_id
index|]
argument_list|)
operator|&
name|FPM_PS_STALLED
operator|)
return|;
block|}
end_function

begin_function
name|void
name|fman_resume_stalled_port
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|tmp
operator|=
call|(
name|uint32_t
call|)
argument_list|(
operator|(
name|port_id
operator|<<
name|FPM_PORT_FM_CTL_PORTID_SHIFT
operator|)
operator||
name|FPM_PRC_REALSE_STALLED
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_prc
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|fman_reset_mac
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|,
name|uint8_t
name|mac_id
parameter_list|,
name|bool
name|is_10g
parameter_list|)
block|{
name|uint32_t
name|msk
decl_stmt|,
name|timeout
init|=
literal|100
decl_stmt|;
comment|/* Get the relevant bit mask */
if|if
condition|(
name|is_10g
condition|)
block|{
switch|switch
condition|(
name|mac_id
condition|)
block|{
case|case
operator|(
literal|0
operator|)
case|:
name|msk
operator|=
name|FPM_RSTC_10G0_RESET
expr_stmt|;
break|break;
case|case
operator|(
literal|1
operator|)
case|:
name|msk
operator|=
name|FPM_RSTC_10G1_RESET
expr_stmt|;
break|break;
default|default:
return|return
operator|-
name|EINVAL
return|;
block|}
block|}
else|else
block|{
switch|switch
condition|(
name|mac_id
condition|)
block|{
case|case
operator|(
literal|0
operator|)
case|:
name|msk
operator|=
name|FPM_RSTC_1G0_RESET
expr_stmt|;
break|break;
case|case
operator|(
literal|1
operator|)
case|:
name|msk
operator|=
name|FPM_RSTC_1G1_RESET
expr_stmt|;
break|break;
case|case
operator|(
literal|2
operator|)
case|:
name|msk
operator|=
name|FPM_RSTC_1G2_RESET
expr_stmt|;
break|break;
case|case
operator|(
literal|3
operator|)
case|:
name|msk
operator|=
name|FPM_RSTC_1G3_RESET
expr_stmt|;
break|break;
case|case
operator|(
literal|4
operator|)
case|:
name|msk
operator|=
name|FPM_RSTC_1G4_RESET
expr_stmt|;
break|break;
case|case
operator|(
literal|5
operator|)
case|:
name|msk
operator|=
name|FPM_RSTC_1G5_RESET
expr_stmt|;
break|break;
case|case
operator|(
literal|6
operator|)
case|:
name|msk
operator|=
name|FPM_RSTC_1G6_RESET
expr_stmt|;
break|break;
case|case
operator|(
literal|7
operator|)
case|:
name|msk
operator|=
name|FPM_RSTC_1G7_RESET
expr_stmt|;
break|break;
default|default:
return|return
operator|-
name|EINVAL
return|;
block|}
block|}
comment|/* reset */
name|iowrite32be
argument_list|(
name|msk
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fm_rstc
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fm_rstc
argument_list|)
operator|&
name|msk
operator|)
operator|&&
operator|--
name|timeout
condition|)
name|DELAY
argument_list|(
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|timeout
condition|)
return|return
operator|-
name|EBUSY
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|uint16_t
name|fman_get_size_of_fifo
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|)
block|{
name|uint32_t
name|tmp_reg
decl_stmt|;
if|if
condition|(
operator|(
name|port_id
operator|>
literal|63
operator|)
operator|||
operator|(
name|port_id
operator|<
literal|1
operator|)
condition|)
return|return
literal|0
return|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_pfs
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
call|(
name|uint16_t
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|BMI_FIFO_SIZE_MASK
operator|)
operator|+
literal|1
argument_list|)
return|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_total_fifo_size
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|)
block|{
name|uint32_t
name|reg
decl_stmt|,
name|res
decl_stmt|;
name|reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_cfg1
argument_list|)
expr_stmt|;
name|res
operator|=
operator|(
name|reg
operator|>>
name|BMI_CFG1_FIFO_SIZE_SHIFT
operator|)
operator|&
literal|0x3ff
expr_stmt|;
return|return
name|res
operator|*
name|FMAN_BMI_FIFO_UNITS
return|;
block|}
end_function

begin_function
name|uint16_t
name|fman_get_size_of_extra_fifo
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|)
block|{
name|uint32_t
name|tmp_reg
decl_stmt|;
if|if
condition|(
operator|(
name|port_id
operator|>
literal|63
operator|)
operator|||
operator|(
name|port_id
operator|<
literal|1
operator|)
condition|)
return|return
literal|0
return|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_pfs
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
call|(
name|uint16_t
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|BMI_EXTRA_FIFO_SIZE_MASK
operator|)
operator|>>
name|BMI_EXTRA_FIFO_SIZE_SHIFT
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|fman_set_size_of_fifo
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|,
name|uint32_t
name|sz_fifo
parameter_list|,
name|uint32_t
name|extra_sz_fifo
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
if|if
condition|(
operator|(
name|port_id
operator|>
literal|63
operator|)
operator|||
operator|(
name|port_id
operator|<
literal|1
operator|)
condition|)
return|return;
comment|/* calculate reg */
name|tmp
operator|=
call|(
name|uint32_t
call|)
argument_list|(
operator|(
name|sz_fifo
operator|/
name|FMAN_BMI_FIFO_UNITS
operator|-
literal|1
operator|)
operator||
operator|(
operator|(
name|extra_sz_fifo
operator|/
name|FMAN_BMI_FIFO_UNITS
operator|)
operator|<<
name|BMI_EXTRA_FIFO_SIZE_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_pfs
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint8_t
name|fman_get_num_of_tasks
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
if|if
condition|(
operator|(
name|port_id
operator|>
literal|63
operator|)
operator|||
operator|(
name|port_id
operator|<
literal|1
operator|)
condition|)
return|return
literal|0
return|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_pp
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
call|(
name|uint8_t
call|)
argument_list|(
operator|(
operator|(
name|tmp
operator|&
name|BMI_NUM_OF_TASKS_MASK
operator|)
operator|>>
name|BMI_NUM_OF_TASKS_SHIFT
operator|)
operator|+
literal|1
argument_list|)
return|;
block|}
end_function

begin_function
name|uint8_t
name|fman_get_num_extra_tasks
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
if|if
condition|(
operator|(
name|port_id
operator|>
literal|63
operator|)
operator|||
operator|(
name|port_id
operator|<
literal|1
operator|)
condition|)
return|return
literal|0
return|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_pp
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp
operator|&
name|BMI_NUM_OF_EXTRA_TASKS_MASK
operator|)
operator|>>
name|BMI_EXTRA_NUM_OF_TASKS_SHIFT
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|fman_set_num_of_tasks
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|,
name|uint8_t
name|num_tasks
parameter_list|,
name|uint8_t
name|num_extra_tasks
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
if|if
condition|(
operator|(
name|port_id
operator|>
literal|63
operator|)
operator|||
operator|(
name|port_id
operator|<
literal|1
operator|)
condition|)
return|return;
comment|/* calculate reg */
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_pp
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
operator|&
operator|~
operator|(
name|BMI_NUM_OF_TASKS_MASK
operator||
name|BMI_NUM_OF_EXTRA_TASKS_MASK
operator|)
expr_stmt|;
name|tmp
operator||=
call|(
name|uint32_t
call|)
argument_list|(
operator|(
operator|(
name|num_tasks
operator|-
literal|1
operator|)
operator|<<
name|BMI_NUM_OF_TASKS_SHIFT
operator|)
operator||
operator|(
name|num_extra_tasks
operator|<<
name|BMI_EXTRA_NUM_OF_TASKS_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_pp
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint8_t
name|fman_get_num_of_dmas
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
if|if
condition|(
operator|(
name|port_id
operator|>
literal|63
operator|)
operator|||
operator|(
name|port_id
operator|<
literal|1
operator|)
condition|)
return|return
literal|0
return|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_pp
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
call|(
name|uint8_t
call|)
argument_list|(
operator|(
operator|(
name|tmp
operator|&
name|BMI_NUM_OF_DMAS_MASK
operator|)
operator|>>
name|BMI_NUM_OF_DMAS_SHIFT
operator|)
operator|+
literal|1
argument_list|)
return|;
block|}
end_function

begin_function
name|uint8_t
name|fman_get_num_extra_dmas
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
if|if
condition|(
operator|(
name|port_id
operator|>
literal|63
operator|)
operator|||
operator|(
name|port_id
operator|<
literal|1
operator|)
condition|)
return|return
literal|0
return|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_pp
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp
operator|&
name|BMI_NUM_OF_EXTRA_DMAS_MASK
operator|)
operator|>>
name|BMI_EXTRA_NUM_OF_DMAS_SHIFT
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|fman_set_num_of_open_dmas
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|,
name|uint8_t
name|num_open_dmas
parameter_list|,
name|uint8_t
name|num_extra_open_dmas
parameter_list|,
name|uint8_t
name|total_num_dmas
parameter_list|)
block|{
name|uint32_t
name|tmp
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|port_id
operator|>
literal|63
operator|)
operator|||
operator|(
name|port_id
operator|<
literal|1
operator|)
condition|)
return|return;
comment|/* calculate reg */
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_pp
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
operator|&
operator|~
operator|(
name|BMI_NUM_OF_DMAS_MASK
operator||
name|BMI_NUM_OF_EXTRA_DMAS_MASK
operator|)
expr_stmt|;
name|tmp
operator||=
call|(
name|uint32_t
call|)
argument_list|(
operator|(
operator|(
name|num_open_dmas
operator|-
literal|1
operator|)
operator|<<
name|BMI_NUM_OF_DMAS_SHIFT
operator|)
operator||
operator|(
name|num_extra_open_dmas
operator|<<
name|BMI_EXTRA_NUM_OF_DMAS_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_pp
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
comment|/* update total num of DMA's with committed number of open DMAS, 	 * and max uncommitted pool. */
if|if
condition|(
name|total_num_dmas
condition|)
block|{
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_cfg2
argument_list|)
operator|&
operator|~
name|BMI_CFG2_DMAS_MASK
expr_stmt|;
name|tmp
operator||=
call|(
name|uint32_t
call|)
argument_list|(
name|total_num_dmas
operator|-
literal|1
argument_list|)
operator|<<
name|BMI_CFG2_DMAS_SHIFT
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_cfg2
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|fman_set_vsp_window
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|uint8_t
name|port_id
parameter_list|,
name|uint8_t
name|base_storage_profile
parameter_list|,
name|uint8_t
name|log2_num_of_profiles
parameter_list|)
block|{
name|uint32_t
name|tmp
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|port_id
operator|>
literal|63
operator|)
operator|||
operator|(
name|port_id
operator|<
literal|1
operator|)
condition|)
return|return;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|bmi_rg
operator|->
name|fmbm_spliodn
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
name|tmp
operator||=
call|(
name|uint32_t
call|)
argument_list|(
operator|(
name|uint32_t
operator|)
name|base_storage_profile
operator|&
literal|0x3f
argument_list|)
operator|<<
literal|16
expr_stmt|;
name|tmp
operator||=
operator|(
name|uint32_t
operator|)
name|log2_num_of_profiles
operator|<<
literal|28
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_spliodn
index|[
name|port_id
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_set_congestion_group_pfc_priority
parameter_list|(
name|uint32_t
modifier|*
name|cpg_rg
parameter_list|,
name|uint32_t
name|congestion_group_id
parameter_list|,
name|uint8_t
name|priority_bit_map
parameter_list|,
name|uint32_t
name|reg_num
parameter_list|)
block|{
name|uint32_t
name|offset
decl_stmt|,
name|tmp
init|=
literal|0
decl_stmt|;
name|offset
operator|=
operator|(
name|congestion_group_id
operator|%
literal|4
operator|)
operator|*
literal|8
expr_stmt|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|cpg_rg
index|[
name|reg_num
index|]
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
operator|(
literal|0xFF
operator|<<
name|offset
operator|)
expr_stmt|;
name|tmp
operator||=
operator|(
name|uint32_t
operator|)
name|priority_bit_map
operator|<<
name|offset
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|cpg_rg
index|[
name|reg_num
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****************************************************************************/
end_comment

begin_comment
comment|/*                      API Init unit functions                              */
end_comment

begin_comment
comment|/*****************************************************************************/
end_comment

begin_function
name|void
name|fman_defconfig
parameter_list|(
name|struct
name|fman_cfg
modifier|*
name|cfg
parameter_list|,
name|bool
name|is_master
parameter_list|)
block|{
name|memset
argument_list|(
name|cfg
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|fman_cfg
argument_list|)
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|catastrophic_err
operator|=
name|DEFAULT_CATASTROPHIC_ERR
expr_stmt|;
name|cfg
operator|->
name|dma_err
operator|=
name|DEFAULT_DMA_ERR
expr_stmt|;
name|cfg
operator|->
name|halt_on_external_activ
operator|=
name|DEFAULT_HALT_ON_EXTERNAL_ACTIVATION
expr_stmt|;
name|cfg
operator|->
name|halt_on_unrecov_ecc_err
operator|=
name|DEFAULT_HALT_ON_UNRECOVERABLE_ECC_ERROR
expr_stmt|;
name|cfg
operator|->
name|en_iram_test_mode
operator|=
name|FALSE
expr_stmt|;
name|cfg
operator|->
name|en_muram_test_mode
operator|=
name|FALSE
expr_stmt|;
name|cfg
operator|->
name|external_ecc_rams_enable
operator|=
name|DEFAULT_EXTERNAL_ECC_RAMS_ENABLE
expr_stmt|;
if|if
condition|(
operator|!
name|is_master
condition|)
return|return;
name|cfg
operator|->
name|dma_aid_override
operator|=
name|DEFAULT_AID_OVERRIDE
expr_stmt|;
name|cfg
operator|->
name|dma_aid_mode
operator|=
name|DEFAULT_AID_MODE
expr_stmt|;
name|cfg
operator|->
name|dma_comm_qtsh_clr_emer
operator|=
name|DEFAULT_DMA_COMM_Q_LOW
expr_stmt|;
name|cfg
operator|->
name|dma_comm_qtsh_asrt_emer
operator|=
name|DEFAULT_DMA_COMM_Q_HIGH
expr_stmt|;
name|cfg
operator|->
name|dma_cache_override
operator|=
name|DEFAULT_CACHE_OVERRIDE
expr_stmt|;
name|cfg
operator|->
name|dma_cam_num_of_entries
operator|=
name|DEFAULT_DMA_CAM_NUM_OF_ENTRIES
expr_stmt|;
name|cfg
operator|->
name|dma_dbg_cnt_mode
operator|=
name|DEFAULT_DMA_DBG_CNT_MODE
expr_stmt|;
name|cfg
operator|->
name|dma_en_emergency
operator|=
name|DEFAULT_DMA_EN_EMERGENCY
expr_stmt|;
name|cfg
operator|->
name|dma_sos_emergency
operator|=
name|DEFAULT_DMA_SOS_EMERGENCY
expr_stmt|;
name|cfg
operator|->
name|dma_watchdog
operator|=
name|DEFAULT_DMA_WATCHDOG
expr_stmt|;
name|cfg
operator|->
name|dma_en_emergency_smoother
operator|=
name|DEFAULT_DMA_EN_EMERGENCY_SMOOTHER
expr_stmt|;
name|cfg
operator|->
name|dma_emergency_switch_counter
operator|=
name|DEFAULT_DMA_EMERGENCY_SWITCH_COUNTER
expr_stmt|;
name|cfg
operator|->
name|disp_limit_tsh
operator|=
name|DEFAULT_DISP_LIMIT
expr_stmt|;
name|cfg
operator|->
name|prs_disp_tsh
operator|=
name|DEFAULT_PRS_DISP_TH
expr_stmt|;
name|cfg
operator|->
name|plcr_disp_tsh
operator|=
name|DEFAULT_PLCR_DISP_TH
expr_stmt|;
name|cfg
operator|->
name|kg_disp_tsh
operator|=
name|DEFAULT_KG_DISP_TH
expr_stmt|;
name|cfg
operator|->
name|bmi_disp_tsh
operator|=
name|DEFAULT_BMI_DISP_TH
expr_stmt|;
name|cfg
operator|->
name|qmi_enq_disp_tsh
operator|=
name|DEFAULT_QMI_ENQ_DISP_TH
expr_stmt|;
name|cfg
operator|->
name|qmi_deq_disp_tsh
operator|=
name|DEFAULT_QMI_DEQ_DISP_TH
expr_stmt|;
name|cfg
operator|->
name|fm_ctl1_disp_tsh
operator|=
name|DEFAULT_FM_CTL1_DISP_TH
expr_stmt|;
name|cfg
operator|->
name|fm_ctl2_disp_tsh
operator|=
name|DEFAULT_FM_CTL2_DISP_TH
expr_stmt|;
name|cfg
operator|->
name|pedantic_dma
operator|=
name|FALSE
expr_stmt|;
name|cfg
operator|->
name|tnum_aging_period
operator|=
name|DEFAULT_TNUM_AGING_PERIOD
expr_stmt|;
name|cfg
operator|->
name|dma_stop_on_bus_error
operator|=
name|FALSE
expr_stmt|;
name|cfg
operator|->
name|qmi_deq_option_support
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_regconfig
parameter_list|(
name|struct
name|fman_rg
modifier|*
name|fman_rg
parameter_list|,
name|struct
name|fman_cfg
modifier|*
name|cfg
parameter_list|)
block|{
name|uint32_t
name|tmp_reg
decl_stmt|;
comment|/* read the values from the registers as they are initialized by the HW with      * the required values.      */
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_cfg1
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|total_fifo_size
operator|=
operator|(
operator|(
operator|(
name|tmp_reg
operator|&
name|BMI_TOTAL_FIFO_SIZE_MASK
operator|)
operator|>>
name|BMI_CFG1_FIFO_SIZE_SHIFT
operator|)
operator|+
literal|1
operator|)
operator|*
name|FMAN_BMI_FIFO_UNITS
expr_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_cfg2
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|total_num_of_tasks
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
operator|(
name|tmp_reg
operator|&
name|BMI_TOTAL_NUM_OF_TASKS_MASK
operator|)
operator|>>
name|BMI_CFG2_TASKS_SHIFT
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmtr
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|dma_comm_qtsh_asrt_emer
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|tmp_reg
operator|>>
name|DMA_THRESH_COMMQ_SHIFT
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmhy
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|dma_comm_qtsh_clr_emer
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|tmp_reg
operator|>>
name|DMA_THRESH_COMMQ_SHIFT
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|dma_cache_override
operator|=
operator|(
expr|enum
name|fman_dma_cache_override
operator|)
operator|(
operator|(
name|tmp_reg
operator|&
name|DMA_MODE_CACHE_OR_MASK
operator|)
operator|>>
name|DMA_MODE_CACHE_OR_SHIFT
operator|)
expr_stmt|;
name|cfg
operator|->
name|dma_cam_num_of_entries
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
operator|(
operator|(
name|tmp_reg
operator|&
name|DMA_MODE_CEN_MASK
operator|)
operator|>>
name|DMA_MODE_CEN_SHIFT
operator|)
operator|+
literal|1
operator|)
operator|*
name|DMA_CAM_UNITS
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|dma_aid_override
operator|=
call|(
name|bool
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|DMA_MODE_AID_OR
operator|)
condition|?
name|TRUE
else|:
name|FALSE
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|dma_dbg_cnt_mode
operator|=
operator|(
expr|enum
name|fman_dma_dbg_cnt_mode
operator|)
operator|(
operator|(
name|tmp_reg
operator|&
name|DMA_MODE_DBG_MASK
operator|)
operator|>>
name|DMA_MODE_DBG_SHIFT
operator|)
expr_stmt|;
name|cfg
operator|->
name|dma_en_emergency
operator|=
call|(
name|bool
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|DMA_MODE_EB
operator|)
condition|?
name|TRUE
else|:
name|FALSE
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fmfp_mxd
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|disp_limit_tsh
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|FPM_DISP_LIMIT_MASK
operator|)
operator|>>
name|FPM_DISP_LIMIT_SHIFT
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fmfp_dist1
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|prs_disp_tsh
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|FPM_THR1_PRS_MASK
operator|)
operator|>>
name|FPM_THR1_PRS_SHIFT
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|plcr_disp_tsh
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|FPM_THR1_KG_MASK
operator|)
operator|>>
name|FPM_THR1_KG_SHIFT
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|kg_disp_tsh
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|FPM_THR1_PLCR_MASK
operator|)
operator|>>
name|FPM_THR1_PLCR_SHIFT
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|bmi_disp_tsh
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|FPM_THR1_BMI_MASK
operator|)
operator|>>
name|FPM_THR1_BMI_SHIFT
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fmfp_dist2
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|qmi_enq_disp_tsh
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|FPM_THR2_QMI_ENQ_MASK
operator|)
operator|>>
name|FPM_THR2_QMI_ENQ_SHIFT
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|qmi_deq_disp_tsh
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|FPM_THR2_QMI_DEQ_MASK
operator|)
operator|>>
name|FPM_THR2_QMI_DEQ_SHIFT
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|fm_ctl1_disp_tsh
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|FPM_THR2_FM_CTL1_MASK
operator|)
operator|>>
name|FPM_THR2_FM_CTL1_SHIFT
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|fm_ctl2_disp_tsh
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|FPM_THR2_FM_CTL2_MASK
operator|)
operator|>>
name|FPM_THR2_FM_CTL2_SHIFT
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmsetr
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|dma_sos_emergency
operator|=
name|tmp_reg
expr_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmwcr
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|dma_watchdog
operator|=
name|tmp_reg
operator|/
name|cfg
operator|->
name|clk_freq
expr_stmt|;
name|tmp_reg
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmemsr
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|dma_en_emergency_smoother
operator|=
call|(
name|bool
call|)
argument_list|(
operator|(
name|tmp_reg
operator|&
name|DMA_EMSR_EMSTR_MASK
operator|)
condition|?
name|TRUE
else|:
name|FALSE
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|dma_emergency_switch_counter
operator|=
operator|(
name|tmp_reg
operator|&
name|DMA_EMSR_EMSTR_MASK
operator|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_reset
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
name|iowrite32be
argument_list|(
name|FPM_RSTC_FM_RESET
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fm_rstc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**************************************************************************/
end_comment

begin_comment
comment|/**  @Function      FM_Init   @Description   Initializes the FM module   @Param[in]     h_Fm - FM module descriptor   @Return        E_OK on success; Error code otherwise. */
end_comment

begin_comment
comment|/***************************************************************************/
end_comment

begin_function
name|int
name|fman_dma_init
parameter_list|(
name|struct
name|fman_dma_regs
modifier|*
name|dma_rg
parameter_list|,
name|struct
name|fman_cfg
modifier|*
name|cfg
parameter_list|)
block|{
name|uint32_t
name|tmp_reg
decl_stmt|;
comment|/**********************/
comment|/* Init DMA Registers */
comment|/**********************/
comment|/* clear status reg events */
comment|/* oren - check!!!  */
name|tmp_reg
operator|=
operator|(
name|DMA_STATUS_BUS_ERR
operator||
name|DMA_STATUS_READ_ECC
operator||
name|DMA_STATUS_SYSTEM_WRITE_ECC
operator||
name|DMA_STATUS_FM_WRITE_ECC
operator|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|ioread32be
argument_list|(
operator|&
name|dma_rg
operator|->
name|fmdmsr
argument_list|)
operator||
name|tmp_reg
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmsr
argument_list|)
expr_stmt|;
comment|/* configure mode register */
name|tmp_reg
operator|=
literal|0
expr_stmt|;
name|tmp_reg
operator||=
name|cfg
operator|->
name|dma_cache_override
operator|<<
name|DMA_MODE_CACHE_OR_SHIFT
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|dma_aid_override
condition|)
name|tmp_reg
operator||=
name|DMA_MODE_AID_OR
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_DMA_BUS_ERROR
condition|)
name|tmp_reg
operator||=
name|DMA_MODE_BER
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_DMA_SYSTEM_WRITE_ECC
operator|)
operator||
operator|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_DMA_READ_ECC
operator|)
operator||
operator|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_DMA_FM_WRITE_ECC
operator|)
condition|)
name|tmp_reg
operator||=
name|DMA_MODE_ECC
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|dma_stop_on_bus_error
condition|)
name|tmp_reg
operator||=
name|DMA_MODE_SBER
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|dma_axi_dbg_num_of_beats
condition|)
name|tmp_reg
operator||=
call|(
name|uint32_t
call|)
argument_list|(
name|DMA_MODE_AXI_DBG_MASK
operator|&
operator|(
operator|(
name|cfg
operator|->
name|dma_axi_dbg_num_of_beats
operator|-
literal|1
operator|)
operator|<<
name|DMA_MODE_AXI_DBG_SHIFT
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|dma_en_emergency
condition|)
block|{
name|tmp_reg
operator||=
name|cfg
operator|->
name|dma_emergency_bus_select
expr_stmt|;
name|tmp_reg
operator||=
name|cfg
operator|->
name|dma_emergency_level
operator|<<
name|DMA_MODE_EMER_LVL_SHIFT
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|dma_en_emergency_smoother
condition|)
name|iowrite32be
argument_list|(
name|cfg
operator|->
name|dma_emergency_switch_counter
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmemsr
argument_list|)
expr_stmt|;
block|}
name|tmp_reg
operator||=
operator|(
operator|(
name|cfg
operator|->
name|dma_cam_num_of_entries
operator|/
name|DMA_CAM_UNITS
operator|)
operator|-
literal|1
operator|)
operator|<<
name|DMA_MODE_CEN_SHIFT
expr_stmt|;
name|tmp_reg
operator||=
name|DMA_MODE_SECURE_PROT
expr_stmt|;
name|tmp_reg
operator||=
name|cfg
operator|->
name|dma_dbg_cnt_mode
operator|<<
name|DMA_MODE_DBG_SHIFT
expr_stmt|;
name|tmp_reg
operator||=
name|cfg
operator|->
name|dma_aid_mode
operator|<<
name|DMA_MODE_AID_MODE_SHIFT
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|pedantic_dma
condition|)
name|tmp_reg
operator||=
name|DMA_MODE_EMER_READ
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
expr_stmt|;
comment|/* configure thresholds register */
name|tmp_reg
operator|=
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|dma_comm_qtsh_asrt_emer
operator|<<
name|DMA_THRESH_COMMQ_SHIFT
operator|)
operator||
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|dma_read_buf_tsh_asrt_emer
operator|<<
name|DMA_THRESH_READ_INT_BUF_SHIFT
operator|)
operator||
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|dma_write_buf_tsh_asrt_emer
operator|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmtr
argument_list|)
expr_stmt|;
comment|/* configure hysteresis register */
name|tmp_reg
operator|=
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|dma_comm_qtsh_clr_emer
operator|<<
name|DMA_THRESH_COMMQ_SHIFT
operator|)
operator||
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|dma_read_buf_tsh_clr_emer
operator|<<
name|DMA_THRESH_READ_INT_BUF_SHIFT
operator|)
operator||
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|dma_write_buf_tsh_clr_emer
operator|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmhy
argument_list|)
expr_stmt|;
comment|/* configure emergency threshold */
name|iowrite32be
argument_list|(
name|cfg
operator|->
name|dma_sos_emergency
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmsetr
argument_list|)
expr_stmt|;
comment|/* configure Watchdog */
name|iowrite32be
argument_list|(
operator|(
name|cfg
operator|->
name|dma_watchdog
operator|*
name|cfg
operator|->
name|clk_freq
operator|)
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmwcr
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|cfg
operator|->
name|cam_base_addr
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmebcr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|fman_fpm_init
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|,
name|struct
name|fman_cfg
modifier|*
name|cfg
parameter_list|)
block|{
name|uint32_t
name|tmp_reg
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/**********************/
comment|/* Init FPM Registers */
comment|/**********************/
name|tmp_reg
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|cfg
operator|->
name|disp_limit_tsh
operator|<<
name|FPM_DISP_LIMIT_SHIFT
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_mxd
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
operator|(
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|prs_disp_tsh
operator|<<
name|FPM_THR1_PRS_SHIFT
operator|)
operator||
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|kg_disp_tsh
operator|<<
name|FPM_THR1_KG_SHIFT
operator|)
operator||
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|plcr_disp_tsh
operator|<<
name|FPM_THR1_PLCR_SHIFT
operator|)
operator||
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|bmi_disp_tsh
operator|<<
name|FPM_THR1_BMI_SHIFT
operator|)
operator|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_dist1
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
operator|(
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|qmi_enq_disp_tsh
operator|<<
name|FPM_THR2_QMI_ENQ_SHIFT
operator|)
operator||
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|qmi_deq_disp_tsh
operator|<<
name|FPM_THR2_QMI_DEQ_SHIFT
operator|)
operator||
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|fm_ctl1_disp_tsh
operator|<<
name|FPM_THR2_FM_CTL1_SHIFT
operator|)
operator||
operator|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|fm_ctl2_disp_tsh
operator|<<
name|FPM_THR2_FM_CTL2_SHIFT
operator|)
operator|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_dist2
argument_list|)
expr_stmt|;
comment|/* define exceptions and error behavior */
name|tmp_reg
operator|=
literal|0
expr_stmt|;
comment|/* Clear events */
name|tmp_reg
operator||=
operator|(
name|FPM_EV_MASK_STALL
operator||
name|FPM_EV_MASK_DOUBLE_ECC
operator||
name|FPM_EV_MASK_SINGLE_ECC
operator|)
expr_stmt|;
comment|/* enable interrupts */
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_FPM_STALL_ON_TASKS
condition|)
name|tmp_reg
operator||=
name|FPM_EV_MASK_STALL_EN
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_FPM_SINGLE_ECC
condition|)
name|tmp_reg
operator||=
name|FPM_EV_MASK_SINGLE_ECC_EN
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_FPM_DOUBLE_ECC
condition|)
name|tmp_reg
operator||=
name|FPM_EV_MASK_DOUBLE_ECC_EN
expr_stmt|;
name|tmp_reg
operator||=
operator|(
name|cfg
operator|->
name|catastrophic_err
operator|<<
name|FPM_EV_MASK_CAT_ERR_SHIFT
operator|)
expr_stmt|;
name|tmp_reg
operator||=
operator|(
name|cfg
operator|->
name|dma_err
operator|<<
name|FPM_EV_MASK_DMA_ERR_SHIFT
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|cfg
operator|->
name|halt_on_external_activ
condition|)
name|tmp_reg
operator||=
name|FPM_EV_MASK_EXTERNAL_HALT
expr_stmt|;
if|if
condition|(
operator|!
name|cfg
operator|->
name|halt_on_unrecov_ecc_err
condition|)
name|tmp_reg
operator||=
name|FPM_EV_MASK_ECC_ERR_HALT
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_ee
argument_list|)
expr_stmt|;
comment|/* clear all fmCtls event registers */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|cfg
operator|->
name|num_of_fman_ctrl_evnt_regs
condition|;
name|i
operator|++
control|)
name|iowrite32be
argument_list|(
literal|0xFFFFFFFF
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_cev
index|[
name|i
index|]
argument_list|)
expr_stmt|;
comment|/* RAM ECC -  enable and clear events*/
comment|/* first we need to clear all parser memory, 	 * as it is uninitialized and may cause ECC errors */
comment|/* event bits */
name|tmp_reg
operator|=
operator|(
name|FPM_RAM_MURAM_ECC
operator||
name|FPM_RAM_IRAM_ECC
operator|)
expr_stmt|;
comment|/* Rams enable not effected by RCR bit, but by a COP configuration */
if|if
condition|(
name|cfg
operator|->
name|external_ecc_rams_enable
condition|)
name|tmp_reg
operator||=
name|FPM_RAM_RAMS_ECC_EN_SRC_SEL
expr_stmt|;
comment|/* enable test mode */
if|if
condition|(
name|cfg
operator|->
name|en_muram_test_mode
condition|)
name|tmp_reg
operator||=
name|FPM_RAM_MURAM_TEST_ECC
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|en_iram_test_mode
condition|)
name|tmp_reg
operator||=
name|FPM_RAM_IRAM_TEST_ECC
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_IRAM_ECC
condition|)
block|{
name|tmp_reg
operator||=
name|FPM_IRAM_ECC_ERR_EX_EN
expr_stmt|;
name|fman_enable_rams_ecc
argument_list|(
name|fpm_rg
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_NURAM_ECC
condition|)
block|{
name|tmp_reg
operator||=
name|FPM_MURAM_ECC_ERR_EX_EN
expr_stmt|;
name|fman_enable_rams_ecc
argument_list|(
name|fpm_rg
argument_list|)
expr_stmt|;
block|}
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fm_rie
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|fman_bmi_init
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|struct
name|fman_cfg
modifier|*
name|cfg
parameter_list|)
block|{
name|uint32_t
name|tmp_reg
decl_stmt|;
comment|/**********************/
comment|/* Init BMI Registers */
comment|/**********************/
comment|/* define common resources */
name|tmp_reg
operator|=
name|cfg
operator|->
name|fifo_base_addr
expr_stmt|;
name|tmp_reg
operator|=
name|tmp_reg
operator|/
name|BMI_FIFO_ALIGN
expr_stmt|;
name|tmp_reg
operator||=
operator|(
operator|(
name|cfg
operator|->
name|total_fifo_size
operator|/
name|FMAN_BMI_FIFO_UNITS
operator|-
literal|1
operator|)
operator|<<
name|BMI_CFG1_FIFO_SIZE_SHIFT
operator|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_cfg1
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
operator|(
call|(
name|uint32_t
call|)
argument_list|(
name|cfg
operator|->
name|total_num_of_tasks
operator|-
literal|1
argument_list|)
operator|<<
name|BMI_CFG2_TASKS_SHIFT
operator|)
expr_stmt|;
comment|/* num of DMA's will be dynamically updated when each port is set */
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_cfg2
argument_list|)
expr_stmt|;
comment|/* define unmaskable exceptions, enable and clear events */
name|tmp_reg
operator|=
literal|0
expr_stmt|;
name|iowrite32be
argument_list|(
name|BMI_ERR_INTR_EN_LIST_RAM_ECC
operator||
name|BMI_ERR_INTR_EN_STORAGE_PROFILE_ECC
operator||
name|BMI_ERR_INTR_EN_STATISTICS_RAM_ECC
operator||
name|BMI_ERR_INTR_EN_DISPATCH_RAM_ECC
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_ievr
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_BMI_LIST_RAM_ECC
condition|)
name|tmp_reg
operator||=
name|BMI_ERR_INTR_EN_LIST_RAM_ECC
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_BMI_PIPELINE_ECC
condition|)
name|tmp_reg
operator||=
name|BMI_ERR_INTR_EN_STORAGE_PROFILE_ECC
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_BMI_STATISTICS_RAM_ECC
condition|)
name|tmp_reg
operator||=
name|BMI_ERR_INTR_EN_STATISTICS_RAM_ECC
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_BMI_DISPATCH_RAM_ECC
condition|)
name|tmp_reg
operator||=
name|BMI_ERR_INTR_EN_DISPATCH_RAM_ECC
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_ier
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|fman_qmi_init
parameter_list|(
name|struct
name|fman_qmi_regs
modifier|*
name|qmi_rg
parameter_list|,
name|struct
name|fman_cfg
modifier|*
name|cfg
parameter_list|)
block|{
name|uint32_t
name|tmp_reg
decl_stmt|;
name|uint16_t
name|period_in_fm_clocks
decl_stmt|;
name|uint8_t
name|remainder
decl_stmt|;
comment|/**********************/
comment|/* Init QMI Registers */
comment|/**********************/
comment|/* Clear error interrupt events */
name|iowrite32be
argument_list|(
name|QMI_ERR_INTR_EN_DOUBLE_ECC
operator||
name|QMI_ERR_INTR_EN_DEQ_FROM_DEF
argument_list|,
operator|&
name|qmi_rg
operator|->
name|fmqm_eie
argument_list|)
expr_stmt|;
name|tmp_reg
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_QMI_DEQ_FROM_UNKNOWN_PORTID
condition|)
name|tmp_reg
operator||=
name|QMI_ERR_INTR_EN_DEQ_FROM_DEF
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_QMI_DOUBLE_ECC
condition|)
name|tmp_reg
operator||=
name|QMI_ERR_INTR_EN_DOUBLE_ECC
expr_stmt|;
comment|/* enable events */
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|qmi_rg
operator|->
name|fmqm_eien
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|tnum_aging_period
condition|)
block|{
comment|/* tnum_aging_period is in units of usec, p_FmClockFreq in Mhz */
name|period_in_fm_clocks
operator|=
call|(
name|uint16_t
call|)
argument_list|(
name|cfg
operator|->
name|tnum_aging_period
operator|*
name|cfg
operator|->
name|clk_freq
argument_list|)
expr_stmt|;
comment|/* period_in_fm_clocks must be a 64 multiply */
name|remainder
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|period_in_fm_clocks
operator|%
literal|64
argument_list|)
expr_stmt|;
if|if
condition|(
name|remainder
condition|)
name|tmp_reg
operator|=
call|(
name|uint32_t
call|)
argument_list|(
operator|(
name|period_in_fm_clocks
operator|/
literal|64
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
else|else
block|{
name|tmp_reg
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|period_in_fm_clocks
operator|/
literal|64
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tmp_reg
condition|)
name|tmp_reg
operator|=
literal|1
expr_stmt|;
block|}
name|tmp_reg
operator|<<=
name|QMI_TAPC_TAP
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|qmi_rg
operator|->
name|fmqm_tapc
argument_list|)
expr_stmt|;
block|}
name|tmp_reg
operator|=
literal|0
expr_stmt|;
comment|/* Clear interrupt events */
name|iowrite32be
argument_list|(
name|QMI_INTR_EN_SINGLE_ECC
argument_list|,
operator|&
name|qmi_rg
operator|->
name|fmqm_ie
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|exceptions
operator|&
name|FMAN_EX_QMI_SINGLE_ECC
condition|)
name|tmp_reg
operator||=
name|QMI_INTR_EN_SINGLE_ECC
expr_stmt|;
comment|/* enable events */
name|iowrite32be
argument_list|(
name|tmp_reg
argument_list|,
operator|&
name|qmi_rg
operator|->
name|fmqm_ien
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|fman_enable
parameter_list|(
name|struct
name|fman_rg
modifier|*
name|fman_rg
parameter_list|,
name|struct
name|fman_cfg
modifier|*
name|cfg
parameter_list|)
block|{
name|uint32_t
name|cfg_reg
init|=
literal|0
decl_stmt|;
comment|/**********************/
comment|/* Enable all modules */
comment|/**********************/
comment|/* clear& enable global counters  - calculate reg and save for later, 	because it's the same reg for QMI enable */
name|cfg_reg
operator|=
name|QMI_CFG_EN_COUNTERS
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|qmi_deq_option_support
condition|)
name|cfg_reg
operator||=
call|(
name|uint32_t
call|)
argument_list|(
operator|(
operator|(
name|cfg
operator|->
name|qmi_def_tnums_thresh
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|qmi_def_tnums_thresh
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|BMI_INIT_START
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_init
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|cfg_reg
operator||
name|QMI_CFG_ENQ_EN
operator||
name|QMI_CFG_DEQ_EN
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_gc
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|fman_free_resources
parameter_list|(
name|struct
name|fman_rg
modifier|*
name|fman_rg
parameter_list|)
block|{
comment|/* disable BMI and QMI */
name|iowrite32be
argument_list|(
literal|0
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_init
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
literal|0
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_gc
argument_list|)
expr_stmt|;
comment|/* release BMI resources */
name|iowrite32be
argument_list|(
literal|0
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_cfg2
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
literal|0
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_cfg1
argument_list|)
expr_stmt|;
comment|/* disable ECC */
name|iowrite32be
argument_list|(
literal|0
argument_list|,
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/****************************************************/
end_comment

begin_comment
comment|/*       API Run-time Control uint functions        */
end_comment

begin_comment
comment|/****************************************************/
end_comment

begin_function
name|uint32_t
name|fman_get_normal_pending
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
return|return
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fm_npi
argument_list|)
return|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_controller_event
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|,
name|uint8_t
name|reg_id
parameter_list|)
block|{
name|uint32_t
name|event
decl_stmt|;
name|event
operator|=
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fmfp_fcev
index|[
name|reg_id
index|]
argument_list|)
operator|&
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fmfp_cee
index|[
name|reg_id
index|]
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|event
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_cev
index|[
name|reg_id
index|]
argument_list|)
expr_stmt|;
return|return
name|event
return|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_error_pending
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
return|return
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fm_epi
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|fman_set_ports_bandwidth
parameter_list|(
name|struct
name|fman_bmi_regs
modifier|*
name|bmi_rg
parameter_list|,
name|uint8_t
modifier|*
name|weights
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|uint8_t
name|shift
decl_stmt|;
name|uint32_t
name|tmp
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|weights
index|[
name|i
index|]
operator|>
literal|1
condition|)
block|{
comment|/* no need to write 1 since it is 0 */
comment|/* Add this port to tmp_reg */
comment|/* (each 8 ports result in one register)*/
name|shift
operator|=
call|(
name|uint8_t
call|)
argument_list|(
literal|32
operator|-
literal|4
operator|*
operator|(
operator|(
name|i
operator|%
literal|8
operator|)
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|tmp
operator||=
operator|(
operator|(
name|weights
index|[
name|i
index|]
operator|-
literal|1
operator|)
operator|<<
name|shift
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|%
literal|8
operator|==
literal|7
condition|)
block|{
comment|/* last in this set */
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|bmi_rg
operator|->
name|fmbm_arb
index|[
name|i
operator|/
literal|8
index|]
argument_list|)
expr_stmt|;
name|tmp
operator|=
literal|0
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
name|fman_enable_rams_ecc
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp
operator|&
name|FPM_RAM_RAMS_ECC_EN_SRC_SEL
condition|)
name|iowrite32be
argument_list|(
name|tmp
operator||
name|FPM_RAM_IRAM_ECC_EN
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
else|else
name|iowrite32be
argument_list|(
name|tmp
operator||
name|FPM_RAM_RAMS_ECC_EN
operator||
name|FPM_RAM_IRAM_ECC_EN
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_disable_rams_ecc
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp
operator|&
name|FPM_RAM_RAMS_ECC_EN_SRC_SEL
condition|)
name|iowrite32be
argument_list|(
name|tmp
operator|&
operator|~
name|FPM_RAM_IRAM_ECC_EN
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
else|else
name|iowrite32be
argument_list|(
name|tmp
operator|&
operator|~
operator|(
name|FPM_RAM_RAMS_ECC_EN
operator||
name|FPM_RAM_IRAM_ECC_EN
operator|)
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fm_rcr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|fman_set_exception
parameter_list|(
name|struct
name|fman_rg
modifier|*
name|fman_rg
parameter_list|,
name|enum
name|fman_exceptions
name|exception
parameter_list|,
name|bool
name|enable
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
switch|switch
condition|(
name|exception
condition|)
block|{
case|case
operator|(
name|E_FMAN_EX_DMA_BUS_ERROR
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|DMA_MODE_BER
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|DMA_MODE_BER
expr_stmt|;
comment|/* disable bus error */
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_DMA_READ_ECC
operator|)
case|:
case|case
operator|(
name|E_FMAN_EX_DMA_SYSTEM_WRITE_ECC
operator|)
case|:
case|case
operator|(
name|E_FMAN_EX_DMA_FM_WRITE_ECC
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|DMA_MODE_ECC
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|DMA_MODE_ECC
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_FPM_STALL_ON_TASKS
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fmfp_ee
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|FPM_EV_MASK_STALL_EN
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|FPM_EV_MASK_STALL_EN
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fmfp_ee
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_FPM_SINGLE_ECC
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fmfp_ee
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|FPM_EV_MASK_SINGLE_ECC_EN
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|FPM_EV_MASK_SINGLE_ECC_EN
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fmfp_ee
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_FPM_DOUBLE_ECC
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fmfp_ee
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|FPM_EV_MASK_DOUBLE_ECC_EN
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|FPM_EV_MASK_DOUBLE_ECC_EN
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fmfp_ee
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_QMI_SINGLE_ECC
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_ien
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|QMI_INTR_EN_SINGLE_ECC
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|QMI_INTR_EN_SINGLE_ECC
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_ien
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_QMI_DOUBLE_ECC
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_eien
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|QMI_ERR_INTR_EN_DOUBLE_ECC
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|QMI_ERR_INTR_EN_DOUBLE_ECC
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_eien
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_QMI_DEQ_FROM_UNKNOWN_PORTID
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_eien
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|QMI_ERR_INTR_EN_DEQ_FROM_DEF
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|QMI_ERR_INTR_EN_DEQ_FROM_DEF
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_eien
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_BMI_LIST_RAM_ECC
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ier
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|BMI_ERR_INTR_EN_LIST_RAM_ECC
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|BMI_ERR_INTR_EN_LIST_RAM_ECC
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ier
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_BMI_STORAGE_PROFILE_ECC
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ier
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|BMI_ERR_INTR_EN_STORAGE_PROFILE_ECC
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|BMI_ERR_INTR_EN_STORAGE_PROFILE_ECC
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ier
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_BMI_STATISTICS_RAM_ECC
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ier
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|BMI_ERR_INTR_EN_STATISTICS_RAM_ECC
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|BMI_ERR_INTR_EN_STATISTICS_RAM_ECC
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ier
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_BMI_DISPATCH_RAM_ECC
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ier
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|tmp
operator||=
name|BMI_ERR_INTR_EN_DISPATCH_RAM_ECC
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|BMI_ERR_INTR_EN_DISPATCH_RAM_ECC
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ier
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_IRAM_ECC
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fm_rie
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
block|{
comment|/* enable ECC if not enabled */
name|fman_enable_rams_ecc
argument_list|(
name|fman_rg
operator|->
name|fpm_rg
argument_list|)
expr_stmt|;
comment|/* enable ECC interrupts */
name|tmp
operator||=
name|FPM_IRAM_ECC_ERR_EX_EN
expr_stmt|;
block|}
else|else
block|{
comment|/* ECC mechanism may be disabled, 			 * depending on driver status  */
name|fman_disable_rams_ecc
argument_list|(
name|fman_rg
operator|->
name|fpm_rg
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
name|FPM_IRAM_ECC_ERR_EX_EN
expr_stmt|;
block|}
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fm_rie
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_EX_MURAM_ECC
operator|)
case|:
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fm_rie
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
block|{
comment|/* enable ECC if not enabled */
name|fman_enable_rams_ecc
argument_list|(
name|fman_rg
operator|->
name|fpm_rg
argument_list|)
expr_stmt|;
comment|/* enable ECC interrupts */
name|tmp
operator||=
name|FPM_MURAM_ECC_ERR_EX_EN
expr_stmt|;
block|}
else|else
block|{
comment|/* ECC mechanism may be disabled, 			 * depending on driver status  */
name|fman_disable_rams_ecc
argument_list|(
name|fman_rg
operator|->
name|fpm_rg
argument_list|)
expr_stmt|;
name|tmp
operator|&=
operator|~
name|FPM_MURAM_ECC_ERR_EX_EN
expr_stmt|;
block|}
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fman_rg
operator|->
name|fpm_rg
operator|->
name|fm_rie
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|-
name|EINVAL
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|fman_get_revision
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|,
name|uint8_t
modifier|*
name|major
parameter_list|,
name|uint8_t
modifier|*
name|minor
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fm_ip_rev_1
argument_list|)
expr_stmt|;
operator|*
name|major
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp
operator|&
name|FPM_REV1_MAJOR_MASK
operator|)
operator|>>
name|FPM_REV1_MAJOR_SHIFT
argument_list|)
expr_stmt|;
operator|*
name|minor
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|tmp
operator|&
name|FPM_REV1_MINOR_MASK
operator|)
operator|>>
name|FPM_REV1_MINOR_SHIFT
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_counter
parameter_list|(
name|struct
name|fman_rg
modifier|*
name|fman_rg
parameter_list|,
name|enum
name|fman_counters
name|reg_name
parameter_list|)
block|{
name|uint32_t
name|ret_val
decl_stmt|;
switch|switch
condition|(
name|reg_name
condition|)
block|{
case|case
operator|(
name|E_FMAN_COUNTERS_ENQ_TOTAL_FRAME
operator|)
case|:
name|ret_val
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_etfc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_TOTAL_FRAME
operator|)
case|:
name|ret_val
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dtfc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_0
operator|)
case|:
name|ret_val
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dc0
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_1
operator|)
case|:
name|ret_val
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dc1
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_2
operator|)
case|:
name|ret_val
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dc2
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_3
operator|)
case|:
name|ret_val
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dc3
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_FROM_DEFAULT
operator|)
case|:
name|ret_val
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dfdc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_FROM_CONTEXT
operator|)
case|:
name|ret_val
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dfcc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_FROM_FD
operator|)
case|:
name|ret_val
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dffc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_CONFIRM
operator|)
case|:
name|ret_val
operator|=
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dcc
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ret_val
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|ret_val
return|;
block|}
end_function

begin_function
name|int
name|fman_modify_counter
parameter_list|(
name|struct
name|fman_rg
modifier|*
name|fman_rg
parameter_list|,
name|enum
name|fman_counters
name|reg_name
parameter_list|,
name|uint32_t
name|val
parameter_list|)
block|{
comment|/* When applicable (when there is an 'enable counters' bit, 	 * check that counters are enabled */
switch|switch
condition|(
name|reg_name
condition|)
block|{
case|case
operator|(
name|E_FMAN_COUNTERS_ENQ_TOTAL_FRAME
operator|)
case|:
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_TOTAL_FRAME
operator|)
case|:
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_0
operator|)
case|:
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_1
operator|)
case|:
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_2
operator|)
case|:
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_3
operator|)
case|:
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_FROM_DEFAULT
operator|)
case|:
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_FROM_CONTEXT
operator|)
case|:
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_FROM_FD
operator|)
case|:
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_CONFIRM
operator|)
case|:
if|if
condition|(
operator|!
operator|(
name|ioread32be
argument_list|(
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_gc
argument_list|)
operator|&
name|QMI_CFG_EN_COUNTERS
operator|)
condition|)
return|return
operator|-
name|EINVAL
return|;
break|break;
default|default:
break|break;
block|}
comment|/* Set counter */
switch|switch
condition|(
name|reg_name
condition|)
block|{
case|case
operator|(
name|E_FMAN_COUNTERS_ENQ_TOTAL_FRAME
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_etfc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_TOTAL_FRAME
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dtfc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_0
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dc0
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_1
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dc1
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_2
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dc2
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_3
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dc3
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_FROM_DEFAULT
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dfdc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_FROM_CONTEXT
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dfcc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_FROM_FD
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dffc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_DEQ_CONFIRM
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_dcc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_SEMAPHOR_ENTRY_FULL_REJECT
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmsefrc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_SEMAPHOR_QUEUE_FULL_REJECT
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmsqfrc
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|E_FMAN_COUNTERS_SEMAPHOR_SYNC_REJECT
operator|)
case|:
name|iowrite32be
argument_list|(
name|val
argument_list|,
operator|&
name|fman_rg
operator|->
name|dma_rg
operator|->
name|fmdmssrc
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|fman_set_dma_emergency
parameter_list|(
name|struct
name|fman_dma_regs
modifier|*
name|dma_rg
parameter_list|,
name|bool
name|is_write
parameter_list|,
name|bool
name|enable
parameter_list|)
block|{
name|uint32_t
name|msk
decl_stmt|;
name|msk
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|is_write
condition|?
name|DMA_MODE_EMER_WRITE
else|:
name|DMA_MODE_EMER_READ
argument_list|)
expr_stmt|;
if|if
condition|(
name|enable
condition|)
name|iowrite32be
argument_list|(
name|ioread32be
argument_list|(
operator|&
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
operator||
name|msk
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
expr_stmt|;
else|else
comment|/* disable */
name|iowrite32be
argument_list|(
name|ioread32be
argument_list|(
operator|&
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
operator|&
operator|~
name|msk
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_set_dma_ext_bus_pri
parameter_list|(
name|struct
name|fman_dma_regs
modifier|*
name|dma_rg
parameter_list|,
name|uint32_t
name|pri
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
operator||
operator|(
name|pri
operator|<<
name|DMA_MODE_BUS_PRI_SHIFT
operator|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|dma_rg
operator|->
name|fmdmmr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint32_t
name|fman_get_dma_status
parameter_list|(
name|struct
name|fman_dma_regs
modifier|*
name|dma_rg
parameter_list|)
block|{
return|return
name|ioread32be
argument_list|(
operator|&
name|dma_rg
operator|->
name|fmdmsr
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|fman_force_intr
parameter_list|(
name|struct
name|fman_rg
modifier|*
name|fman_rg
parameter_list|,
name|enum
name|fman_exceptions
name|exception
parameter_list|)
block|{
switch|switch
condition|(
name|exception
condition|)
block|{
case|case
name|E_FMAN_EX_QMI_DEQ_FROM_UNKNOWN_PORTID
case|:
name|iowrite32be
argument_list|(
name|QMI_ERR_INTR_EN_DEQ_FROM_DEF
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_eif
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_FMAN_EX_QMI_SINGLE_ECC
case|:
name|iowrite32be
argument_list|(
name|QMI_INTR_EN_SINGLE_ECC
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_if
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_FMAN_EX_QMI_DOUBLE_ECC
case|:
name|iowrite32be
argument_list|(
name|QMI_ERR_INTR_EN_DOUBLE_ECC
argument_list|,
operator|&
name|fman_rg
operator|->
name|qmi_rg
operator|->
name|fmqm_eif
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_FMAN_EX_BMI_LIST_RAM_ECC
case|:
name|iowrite32be
argument_list|(
name|BMI_ERR_INTR_EN_LIST_RAM_ECC
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ifr
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_FMAN_EX_BMI_STORAGE_PROFILE_ECC
case|:
name|iowrite32be
argument_list|(
name|BMI_ERR_INTR_EN_STORAGE_PROFILE_ECC
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ifr
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_FMAN_EX_BMI_STATISTICS_RAM_ECC
case|:
name|iowrite32be
argument_list|(
name|BMI_ERR_INTR_EN_STATISTICS_RAM_ECC
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ifr
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_FMAN_EX_BMI_DISPATCH_RAM_ECC
case|:
name|iowrite32be
argument_list|(
name|BMI_ERR_INTR_EN_DISPATCH_RAM_ECC
argument_list|,
operator|&
name|fman_rg
operator|->
name|bmi_rg
operator|->
name|fmbm_ifr
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
name|bool
name|fman_is_qmi_halt_not_busy_state
parameter_list|(
name|struct
name|fman_qmi_regs
modifier|*
name|qmi_rg
parameter_list|)
block|{
return|return
operator|(
name|bool
operator|)
operator|!
operator|!
operator|(
name|ioread32be
argument_list|(
operator|&
name|qmi_rg
operator|->
name|fmqm_gs
argument_list|)
operator|&
name|QMI_GS_HALT_NOT_BUSY
operator|)
return|;
block|}
end_function

begin_function
name|void
name|fman_resume
parameter_list|(
name|struct
name|fman_fpm_regs
modifier|*
name|fpm_rg
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|fpm_rg
operator|->
name|fmfp_ee
argument_list|)
expr_stmt|;
comment|/* clear tmp_reg event bits in order not to clear standing events */
name|tmp
operator|&=
operator|~
operator|(
name|FPM_EV_MASK_DOUBLE_ECC
operator||
name|FPM_EV_MASK_STALL
operator||
name|FPM_EV_MASK_SINGLE_ECC
operator|)
expr_stmt|;
name|tmp
operator||=
name|FPM_EV_MASK_RELEASE_FM
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|fpm_rg
operator|->
name|fmfp_ee
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

