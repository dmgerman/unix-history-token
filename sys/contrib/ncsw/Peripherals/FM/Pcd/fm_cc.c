begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (c) 2008-2011 Freescale Semiconductor, Inc.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions are met:  *     * Redistributions of source code must retain the above copyright  *       notice, this list of conditions and the following disclaimer.  *     * Redistributions in binary form must reproduce the above copyright  *       notice, this list of conditions and the following disclaimer in the  *       documentation and/or other materials provided with the distribution.  *     * Neither the name of Freescale Semiconductor nor the  *       names of its contributors may be used to endorse or promote products  *       derived from this software without specific prior written permission.  *  *  * ALTERNATIVELY, this software may be distributed under the terms of the  * GNU General Public License ("GPL") as published by the Free Software  * Foundation, either version 2 of that License or (at your option) any  * later version.  *  * THIS SOFTWARE IS PROVIDED BY Freescale Semiconductor ``AS IS'' AND ANY  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE  * DISCLAIMED. IN NO EVENT SHALL Freescale Semiconductor BE LIABLE FOR ANY  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/******************************************************************************  @File          fm_cc.c   @Description   FM CC ... */
end_comment

begin_comment
comment|/***************************************************************************/
end_comment

begin_include
include|#
directive|include
file|"std_ext.h"
end_include

begin_include
include|#
directive|include
file|"error_ext.h"
end_include

begin_include
include|#
directive|include
file|"string_ext.h"
end_include

begin_include
include|#
directive|include
file|"debug_ext.h"
end_include

begin_include
include|#
directive|include
file|"fm_pcd_ext.h"
end_include

begin_include
include|#
directive|include
file|"fm_muram_ext.h"
end_include

begin_include
include|#
directive|include
file|"fm_common.h"
end_include

begin_include
include|#
directive|include
file|"fm_hc.h"
end_include

begin_include
include|#
directive|include
file|"fm_cc.h"
end_include

begin_if
if|#
directive|if
name|defined
argument_list|(
name|FM_CAPWAP_SUPPORT
argument_list|)
end_if

begin_define
define|#
directive|define
name|FM_PCD_CC_MANIP
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* defined(FM_CAPWAP_SUPPORT) || ... */
end_comment

begin_function
name|t_Handle
name|FmPcdCcTreeGetSavedManipParams
parameter_list|(
name|t_Handle
name|h_FmTree
parameter_list|,
name|uint8_t
name|manipIndx
parameter_list|)
block|{
name|t_FmPcdCcTree
modifier|*
name|p_FmPcdCcTree
init|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_FmTree
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcTree
argument_list|)
expr_stmt|;
return|return
name|p_FmPcdCcTree
operator|->
name|fmPcdCcSavedManipParams
index|[
name|manipIndx
index|]
return|;
block|}
end_function

begin_function
name|void
name|FmPcdCcTreeSetSavedManipParams
parameter_list|(
name|t_Handle
name|h_FmTree
parameter_list|,
name|t_Handle
name|h_SavedManipParams
parameter_list|,
name|uint8_t
name|manipIndx
parameter_list|)
block|{
name|t_FmPcdCcTree
modifier|*
name|p_FmPcdCcTree
init|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_FmTree
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcTree
argument_list|)
expr_stmt|;
name|p_FmPcdCcTree
operator|->
name|fmPcdCcSavedManipParams
index|[
name|manipIndx
index|]
operator|=
name|h_SavedManipParams
expr_stmt|;
block|}
end_function

begin_function
name|uint8_t
name|FmPcdCcGetParseCode
parameter_list|(
name|t_Handle
name|h_CcNode
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_CcNode
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
return|return
name|p_FmPcdCcNode
operator|->
name|parseCode
return|;
block|}
end_function

begin_function
name|uint8_t
name|FmPcdCcGetOffset
parameter_list|(
name|t_Handle
name|h_CcNode
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_CcNode
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
return|return
name|p_FmPcdCcNode
operator|->
name|offset
return|;
block|}
end_function

begin_function
name|uint16_t
name|FmPcdCcGetNumOfKeys
parameter_list|(
name|t_Handle
name|h_CcNode
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_CcNode
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
return|return
name|p_FmPcdCcNode
operator|->
name|numOfKeys
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|EnqueueNodeInfoToRelevantLst
parameter_list|(
name|t_List
modifier|*
name|p_List
parameter_list|,
name|t_CcNodeInformation
modifier|*
name|p_CcInfo
parameter_list|)
block|{
name|t_CcNodeInformation
modifier|*
name|p_CcInformation
decl_stmt|;
name|uint32_t
name|intFlags
decl_stmt|;
name|p_CcInformation
operator|=
operator|(
name|t_CcNodeInformation
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_CcInformation
condition|)
block|{
name|memset
argument_list|(
name|p_CcInformation
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|p_CcInformation
argument_list|,
name|p_CcInfo
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|INIT_LIST
argument_list|(
operator|&
name|p_CcInformation
operator|->
name|node
argument_list|)
expr_stmt|;
name|intFlags
operator|=
name|XX_DisableAllIntr
argument_list|()
expr_stmt|;
name|LIST_AddToTail
argument_list|(
operator|&
name|p_CcInformation
operator|->
name|node
argument_list|,
name|p_List
argument_list|)
expr_stmt|;
name|XX_RestoreAllIntr
argument_list|(
name|intFlags
argument_list|)
expr_stmt|;
block|}
else|else
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"CC Node Information"
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|t_CcNodeInformation
modifier|*
name|FindNodeInfoInReleventLst
parameter_list|(
name|t_List
modifier|*
name|p_List
parameter_list|,
name|t_Handle
name|h_Info
parameter_list|)
block|{
name|t_CcNodeInformation
modifier|*
name|p_CcInformation
decl_stmt|;
name|t_List
modifier|*
name|p_Pos
decl_stmt|;
name|uint32_t
name|intFlags
decl_stmt|;
name|intFlags
operator|=
name|XX_DisableAllIntr
argument_list|()
expr_stmt|;
for|for
control|(
name|p_Pos
operator|=
name|NCSW_LIST_FIRST
argument_list|(
name|p_List
argument_list|)
init|;
name|p_Pos
operator|!=
operator|(
name|p_List
operator|)
condition|;
name|p_Pos
operator|=
name|NCSW_LIST_NEXT
argument_list|(
name|p_Pos
argument_list|)
control|)
block|{
name|p_CcInformation
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|p_Pos
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcInformation
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_CcInformation
operator|->
name|h_CcNode
operator|==
name|h_Info
condition|)
block|{
name|XX_RestoreAllIntr
argument_list|(
name|intFlags
argument_list|)
expr_stmt|;
return|return
name|p_CcInformation
return|;
block|}
block|}
name|XX_RestoreAllIntr
argument_list|(
name|intFlags
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|DequeueNodeInfoFromRelevantLst
parameter_list|(
name|t_List
modifier|*
name|p_List
parameter_list|,
name|t_Handle
name|h_Info
parameter_list|)
block|{
name|t_CcNodeInformation
modifier|*
name|p_CcInformation
init|=
name|NULL
decl_stmt|;
name|uint32_t
name|intFlags
decl_stmt|;
name|t_List
modifier|*
name|p_Pos
decl_stmt|;
name|intFlags
operator|=
name|XX_DisableAllIntr
argument_list|()
expr_stmt|;
if|if
condition|(
name|LIST_IsEmpty
argument_list|(
name|p_List
argument_list|)
condition|)
block|{
name|XX_RestoreAllIntr
argument_list|(
name|intFlags
argument_list|)
expr_stmt|;
return|return;
block|}
for|for
control|(
name|p_Pos
operator|=
name|NCSW_LIST_FIRST
argument_list|(
name|p_List
argument_list|)
init|;
name|p_Pos
operator|!=
operator|(
name|p_List
operator|)
condition|;
name|p_Pos
operator|=
name|NCSW_LIST_NEXT
argument_list|(
name|p_Pos
argument_list|)
control|)
block|{
name|p_CcInformation
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|p_Pos
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcInformation
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_CcInformation
operator|->
name|h_CcNode
operator|==
name|h_Info
condition|)
break|break;
block|}
if|if
condition|(
name|p_CcInformation
condition|)
name|LIST_DelAndInit
argument_list|(
operator|&
name|p_CcInformation
operator|->
name|node
argument_list|)
expr_stmt|;
name|XX_RestoreAllIntr
argument_list|(
name|intFlags
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|FmPcdCcSetRequiredAction
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|uint32_t
name|requiredAction
parameter_list|,
name|t_FmPcdCcNextEngineAndRequiredActionParams
modifier|*
name|p_CcNextEngineParamsTmp
parameter_list|,
name|t_Handle
name|h_AdTmp
parameter_list|,
name|uint16_t
name|numOfEntries
parameter_list|,
name|t_Handle
name|h_Tree
parameter_list|)
block|{
name|t_AdOfTypeResult
modifier|*
name|p_AdTmp
init|=
operator|(
name|t_AdOfTypeResult
operator|*
operator|)
name|h_AdTmp
decl_stmt|;
name|uint32_t
name|tmpReg32
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|uint16_t
name|tmp
init|=
literal|0
decl_stmt|;
name|uint16_t
name|profileId
decl_stmt|;
name|uint8_t
name|relativeSchemeId
decl_stmt|,
name|physicalSchemeId
decl_stmt|;
name|t_CcNodeInformation
name|ccNodeInfo
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numOfEntries
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
literal|0
condition|)
name|h_AdTmp
operator|=
name|PTR_MOVE
argument_list|(
name|h_AdTmp
argument_list|,
name|i
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
else|else
name|h_AdTmp
operator|=
name|PTR_MOVE
argument_list|(
name|h_AdTmp
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|shadowAction
operator|&
name|requiredAction
condition|)
continue|continue;
switch|switch
condition|(
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
condition|)
block|{
case|case
operator|(
name|e_FM_PCD_CC
operator|)
case|:
if|if
condition|(
name|requiredAction
condition|)
block|{
name|p_FmPcdCcNode
operator|=
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|shadowAction
operator|==
name|requiredAction
condition|)
break|break;
if|if
condition|(
operator|(
name|requiredAction
operator|&
name|UPDATE_CC_WITH_TREE
operator|)
operator|&&
operator|!
operator|(
name|p_FmPcdCcNode
operator|->
name|shadowAction
operator|&
name|UPDATE_CC_WITH_TREE
operator|)
condition|)
block|{
name|ASSERT_COND
argument_list|(
name|LIST_NumOfObjs
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreesLst
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|shadowAction
operator|&
name|UPDATE_CC_WITH_DELETE_TREE
condition|)
name|p_FmPcdCcNode
operator|->
name|shadowAction
operator|&=
operator|~
name|UPDATE_CC_WITH_DELETE_TREE
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ccNodeInfo
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|ccNodeInfo
operator|.
name|h_CcNode
operator|=
name|h_Tree
expr_stmt|;
name|EnqueueNodeInfoToRelevantLst
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreesLst
argument_list|,
operator|&
name|ccNodeInfo
argument_list|)
expr_stmt|;
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|shadowAction
operator||=
name|UPDATE_CC_WITH_TREE
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|requiredAction
operator|&
name|UPDATE_CC_WITH_DELETE_TREE
operator|)
operator|&&
operator|!
operator|(
name|p_FmPcdCcNode
operator|->
name|shadowAction
operator|&
name|UPDATE_CC_WITH_DELETE_TREE
operator|)
condition|)
block|{
name|ASSERT_COND
argument_list|(
name|LIST_NumOfObjs
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreesLst
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|shadowAction
operator|&
name|UPDATE_CC_WITH_TREE
condition|)
name|p_FmPcdCcNode
operator|->
name|shadowAction
operator|&=
operator|~
name|UPDATE_CC_WITH_TREE
expr_stmt|;
name|DequeueNodeInfoFromRelevantLst
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreesLst
argument_list|,
name|h_Tree
argument_list|)
expr_stmt|;
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|shadowAction
operator||=
name|UPDATE_CC_WITH_DELETE_TREE
expr_stmt|;
block|}
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|p_FmPcdCcNode
operator|->
name|numOfKeys
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|!=
name|e_FM_PCD_INVALID
condition|)
name|tmp
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
argument_list|)
expr_stmt|;
else|else
name|tmp
operator|=
name|p_FmPcdCcNode
operator|->
name|numOfKeys
expr_stmt|;
name|err
operator|=
name|FmPcdCcSetRequiredAction
argument_list|(
name|h_FmPcd
argument_list|,
name|requiredAction
argument_list|,
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
argument_list|,
name|p_FmPcdCcNode
operator|->
name|h_AdTable
argument_list|,
name|tmp
argument_list|,
name|h_Tree
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
return|return
name|err
return|;
name|p_FmPcdCcNode
operator|->
name|shadowAction
operator||=
name|requiredAction
expr_stmt|;
block|}
break|break;
case|case
operator|(
name|e_FM_PCD_KG
operator|)
case|:
if|if
condition|(
operator|(
name|requiredAction
operator|&
name|UPDATE_NIA_ENQ_WITHOUT_DMA
operator|)
operator|&&
operator|!
operator|(
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|shadowAction
operator|&
name|UPDATE_NIA_ENQ_WITHOUT_DMA
operator|)
condition|)
block|{
name|physicalSchemeId
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|PTR_TO_UINT
argument_list|(
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|kgParams
operator|.
name|h_DirectScheme
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|relativeSchemeId
operator|=
name|FmPcdKgGetRelativeSchemeId
argument_list|(
name|h_FmPcd
argument_list|,
name|physicalSchemeId
argument_list|)
expr_stmt|;
if|if
condition|(
name|relativeSchemeId
operator|==
name|FM_PCD_KG_NUM_OF_SCHEMES
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_IN_RANGE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|FmPcdKgIsSchemeValidSw
argument_list|(
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"Invalid direct scheme."
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|KgIsSchemeAlwaysDirect
argument_list|(
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"For this action scheme has to be direct."
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|FmPcdKgCcGetSetParams
argument_list|(
name|h_FmPcd
argument_list|,
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|kgParams
operator|.
name|h_DirectScheme
argument_list|,
name|requiredAction
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|shadowAction
operator||=
name|requiredAction
expr_stmt|;
block|}
break|break;
case|case
operator|(
name|e_FM_PCD_PLCR
operator|)
case|:
if|if
condition|(
operator|(
name|requiredAction
operator|&
name|UPDATE_NIA_ENQ_WITHOUT_DMA
operator|)
operator|&&
operator|!
operator|(
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|shadowAction
operator|&
name|UPDATE_NIA_ENQ_WITHOUT_DMA
operator|)
condition|)
block|{
if|if
condition|(
operator|!
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|plcrParams
operator|.
name|overrideParams
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"In this intialization only overrideFqid can be intiizliaes"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|plcrParams
operator|.
name|sharedProfile
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"In this intialization only overrideFqid can be intiizliaes"
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|FmPcdPlcrGetAbsoluteProfileId
argument_list|(
name|h_FmPcd
argument_list|,
name|e_FM_PCD_PLCR_SHARED
argument_list|,
name|NULL
argument_list|,
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|plcrParams
operator|.
name|newRelativeProfileId
argument_list|,
operator|&
name|profileId
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|err
operator|=
name|FmPcdPlcrCcGetSetParams
argument_list|(
name|h_FmPcd
argument_list|,
name|profileId
argument_list|,
name|requiredAction
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|shadowAction
operator||=
name|requiredAction
expr_stmt|;
block|}
break|break;
case|case
operator|(
name|e_FM_PCD_DONE
operator|)
case|:
if|if
condition|(
operator|(
name|requiredAction
operator|&
name|UPDATE_NIA_ENQ_WITHOUT_DMA
operator|)
operator|&&
operator|!
operator|(
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|shadowAction
operator|&
name|UPDATE_NIA_ENQ_WITHOUT_DMA
operator|)
condition|)
block|{
name|tmpReg32
operator|=
name|GET_UINT32
argument_list|(
name|p_AdTmp
operator|->
name|nia
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|tmpReg32
operator|&
operator|(
name|NIA_ENG_BMI
operator||
name|NIA_BMI_AC_ENQ_FRAME
operator|)
operator|)
operator|!=
operator|(
name|NIA_ENG_BMI
operator||
name|NIA_BMI_AC_ENQ_FRAME
operator|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"Next engine was previosely assigned not as PCD_DONE"
operator|)
argument_list|)
expr_stmt|;
name|tmpReg32
operator||=
name|NIA_BMI_AC_ENQ_FRAME_WITHOUT_DMA
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_AdTmp
operator|->
name|nia
argument_list|,
name|tmpReg32
argument_list|)
expr_stmt|;
name|p_CcNextEngineParamsTmp
index|[
name|i
index|]
operator|.
name|shadowAction
operator||=
name|requiredAction
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|CcUpdateParam
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPort
parameter_list|,
name|t_FmPcdCcNextEngineAndRequiredActionParams
modifier|*
name|p_CcNextEngineParams
parameter_list|,
name|uint16_t
name|numOfEntries
parameter_list|,
name|t_Handle
name|h_Ad
parameter_list|,
name|bool
name|validate
parameter_list|,
name|uint16_t
name|level
parameter_list|,
name|t_Handle
name|h_FmTree
parameter_list|,
name|bool
name|modify
parameter_list|)
block|{
name|t_CcNodeInformation
modifier|*
name|p_CcNodeInfo
decl_stmt|;
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|uint16_t
name|tmp
init|=
literal|0
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|level
operator|++
expr_stmt|;
if|if
condition|(
name|numOfEntries
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numOfEntries
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
literal|0
condition|)
name|h_Ad
operator|=
name|PTR_MOVE
argument_list|(
name|h_Ad
argument_list|,
name|i
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
else|else
name|h_Ad
operator|=
name|PTR_MOVE
argument_list|(
name|h_Ad
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_CcNextEngineParams
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
block|{
name|p_FmPcdCcNode
operator|=
name|p_CcNextEngineParams
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|p_CcNodeInfo
operator|=
name|FindNodeInfoInReleventLst
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreesLst
argument_list|,
name|h_FmTree
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcNodeInfo
argument_list|)
expr_stmt|;
name|p_CcNodeInfo
operator|->
name|index
operator|=
name|level
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_CcNextEngineParams
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
condition|)
block|{
name|err
operator|=
name|FmPcdManipUpdate
argument_list|(
name|h_FmPcd
argument_list|,
name|h_FmPort
argument_list|,
name|p_CcNextEngineParams
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
argument_list|,
name|h_Ad
argument_list|,
name|validate
argument_list|,
name|p_CcNodeInfo
operator|->
name|index
argument_list|,
name|h_FmTree
argument_list|,
name|modify
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|p_FmPcdCcNode
operator|->
name|numOfKeys
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|!=
name|e_FM_PCD_INVALID
condition|)
name|tmp
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
argument_list|)
expr_stmt|;
else|else
name|tmp
operator|=
name|p_FmPcdCcNode
operator|->
name|numOfKeys
expr_stmt|;
name|err
operator|=
name|CcUpdateParam
argument_list|(
name|h_FmPcd
argument_list|,
name|h_FmPort
argument_list|,
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
argument_list|,
name|tmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|h_AdTable
argument_list|,
name|validate
argument_list|,
name|level
argument_list|,
name|h_FmTree
argument_list|,
name|modify
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
else|else
block|{
if|if
condition|(
name|p_CcNextEngineParams
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
condition|)
block|{
name|err
operator|=
name|FmPcdManipUpdate
argument_list|(
name|h_FmPcd
argument_list|,
name|h_FmPort
argument_list|,
name|p_CcNextEngineParams
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
argument_list|,
name|h_Ad
argument_list|,
name|validate
argument_list|,
name|level
argument_list|,
name|h_FmTree
argument_list|,
name|modify
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
block|}
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|bool
name|IsNodeInModifiedState
parameter_list|(
name|t_Handle
name|h_CcNode
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_CcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_CcNode
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcNode
argument_list|)
expr_stmt|;
return|return
name|p_CcNode
operator|->
name|modifiedState
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|UpdateNodeWithModifiedState
parameter_list|(
name|t_Handle
name|h_CcNode
parameter_list|,
name|bool
name|modifiedState
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_CcNode
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|modifiedState
operator|=
name|modifiedState
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|ccPrivateInfo_t
name|IcDefineCode
parameter_list|(
name|t_FmPcdCcNodeParams
modifier|*
name|p_CcNodeParam
parameter_list|)
block|{
switch|switch
condition|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|action
condition|)
block|{
case|case
operator|(
name|e_FM_PCD_ACTION_EXACT_MATCH
operator|)
case|:
switch|switch
condition|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|src
condition|)
block|{
case|case
operator|(
name|e_FM_PCD_EXTRACT_FROM_KEY
operator|)
case|:
return|return
name|CC_PRIVATE_INFO_IC_KEY_EXACT_MATCH
return|;
case|case
operator|(
name|e_FM_PCD_EXTRACT_FROM_HASH
operator|)
case|:
return|return
name|CC_PRIVATE_INFO_IC_HASH_EXACT_MATCH
return|;
default|default:
return|return
name|CC_PRIVATE_INFO_NONE
return|;
block|}
case|case
operator|(
name|e_FM_PCD_ACTION_INDEXED_LOOKUP
operator|)
case|:
switch|switch
condition|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|src
condition|)
block|{
case|case
operator|(
name|e_FM_PCD_EXTRACT_FROM_HASH
operator|)
case|:
return|return
name|CC_PRIVATE_INFO_IC_HASH_INDEX_LOOKUP
return|;
case|case
operator|(
name|e_FM_PCD_EXTRACT_FROM_FLOW_ID
operator|)
case|:
return|return
name|CC_PRIVATE_INFO_IC_DEQ_FQID_INDEX_LOOKUP
return|;
default|default:
return|return
name|CC_PRIVATE_INFO_NONE
return|;
block|}
default|default:
break|break;
block|}
return|return
name|CC_PRIVATE_INFO_NONE
return|;
block|}
end_function

begin_function
specifier|static
name|t_CcNodeInformation
modifier|*
name|DequeueAdditionalInfoFromRelevantLst
parameter_list|(
name|t_List
modifier|*
name|p_List
parameter_list|)
block|{
name|t_CcNodeInformation
modifier|*
name|p_CcNodeInfo
init|=
name|NULL
decl_stmt|;
name|uint32_t
name|intFlags
decl_stmt|;
name|intFlags
operator|=
name|XX_DisableAllIntr
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|LIST_IsEmpty
argument_list|(
name|p_List
argument_list|)
condition|)
block|{
name|p_CcNodeInfo
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|p_List
operator|->
name|p_Next
argument_list|)
expr_stmt|;
name|LIST_DelAndInit
argument_list|(
operator|&
name|p_CcNodeInfo
operator|->
name|node
argument_list|)
expr_stmt|;
block|}
name|XX_RestoreAllIntr
argument_list|(
name|intFlags
argument_list|)
expr_stmt|;
return|return
name|p_CcNodeInfo
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|ReleaseLst
parameter_list|(
name|t_List
modifier|*
name|p_List
parameter_list|)
block|{
name|t_CcNodeInformation
modifier|*
name|p_CcNodeInfo
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|LIST_IsEmpty
argument_list|(
name|p_List
argument_list|)
condition|)
block|{
name|p_CcNodeInfo
operator|=
name|DequeueAdditionalInfoFromRelevantLst
argument_list|(
name|p_List
argument_list|)
expr_stmt|;
while|while
condition|(
name|p_CcNodeInfo
condition|)
block|{
name|XX_Free
argument_list|(
name|p_CcNodeInfo
argument_list|)
expr_stmt|;
name|p_CcNodeInfo
operator|=
name|DequeueAdditionalInfoFromRelevantLst
argument_list|(
name|p_List
argument_list|)
expr_stmt|;
block|}
block|}
name|LIST_DelAndInit
argument_list|(
name|p_List
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|FmPcdCcTreeReleaseLock
parameter_list|(
name|t_Handle
name|h_FmPcdCcTree
parameter_list|)
block|{
name|RELEASE_LOCK
argument_list|(
operator|(
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_FmPcdCcTree
operator|)
operator|->
name|lock
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|FmPcdCcNodeTreeReleaseLock
parameter_list|(
name|t_List
modifier|*
name|p_List
parameter_list|)
block|{
name|t_List
modifier|*
name|p_Pos
decl_stmt|;
name|t_CcNodeInformation
modifier|*
name|p_CcNodeInfo
decl_stmt|;
name|t_Handle
name|h_FmPcdCcTree
decl_stmt|;
name|LIST_FOR_EACH
argument_list|(
argument|p_Pos
argument_list|,
argument|p_List
argument_list|)
block|{
name|p_CcNodeInfo
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|p_Pos
argument_list|)
expr_stmt|;
name|h_FmPcdCcTree
operator|=
name|p_CcNodeInfo
operator|->
name|h_CcNode
expr_stmt|;
name|FmPcdCcTreeReleaseLock
argument_list|(
name|h_FmPcdCcTree
argument_list|)
expr_stmt|;
block|}
name|ReleaseLst
argument_list|(
name|p_List
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|DeleteNode
parameter_list|(
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|)
block|{
if|if
condition|(
name|p_FmPcdCcNode
condition|)
block|{
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
condition|)
block|{
name|XX_Free
argument_list|(
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|h_KeysMatchTable
condition|)
block|{
name|FM_MURAM_FreeMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
argument_list|)
argument_list|,
name|p_FmPcdCcNode
operator|->
name|h_KeysMatchTable
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|h_KeysMatchTable
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|h_AdTable
condition|)
block|{
name|FM_MURAM_FreeMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
argument_list|)
argument_list|,
name|p_FmPcdCcNode
operator|->
name|h_AdTable
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|h_AdTable
operator|=
name|NULL
expr_stmt|;
block|}
name|ReleaseLst
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccPrevNodesLst
argument_list|)
expr_stmt|;
name|ReleaseLst
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreeIdLst
argument_list|)
expr_stmt|;
name|ReleaseLst
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreesLst
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|DeleteTree
parameter_list|(
name|t_FmPcdCcTree
modifier|*
name|p_FmPcdTree
parameter_list|,
name|t_FmPcd
modifier|*
name|p_FmPcd
parameter_list|)
block|{
if|if
condition|(
name|p_FmPcdTree
condition|)
block|{
if|if
condition|(
name|p_FmPcdTree
operator|->
name|ccTreeBaseAddr
condition|)
block|{
name|FM_MURAM_FreeMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
name|p_FmPcd
argument_list|)
argument_list|,
name|UINT_TO_PTR
argument_list|(
name|p_FmPcdTree
operator|->
name|ccTreeBaseAddr
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmPcdTree
operator|->
name|ccTreeBaseAddr
operator|=
literal|0
expr_stmt|;
block|}
name|ReleaseLst
argument_list|(
operator|&
name|p_FmPcdTree
operator|->
name|fmPortsLst
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_FmPcdTree
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|UpdateNodeOwner
parameter_list|(
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|,
name|bool
name|add
parameter_list|)
block|{
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|add
condition|)
name|p_FmPcdCcNode
operator|->
name|owners
operator|++
expr_stmt|;
else|else
block|{
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcNode
operator|->
name|owners
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|owners
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|GetCcExtractKeySize
parameter_list|(
name|uint8_t
name|parseCodeRealSize
parameter_list|,
name|uint8_t
modifier|*
name|parseCodeCcSize
parameter_list|)
block|{
if|if
condition|(
operator|(
name|parseCodeRealSize
operator|>
literal|0
operator|)
operator|&&
operator|(
name|parseCodeRealSize
operator|<
literal|2
operator|)
condition|)
operator|*
name|parseCodeCcSize
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|parseCodeRealSize
operator|==
literal|2
condition|)
operator|*
name|parseCodeCcSize
operator|=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|parseCodeRealSize
operator|>
literal|2
operator|)
operator|&&
operator|(
name|parseCodeRealSize
operator|<=
literal|4
operator|)
condition|)
operator|*
name|parseCodeCcSize
operator|=
literal|4
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|parseCodeRealSize
operator|>
literal|4
operator|)
operator|&&
operator|(
name|parseCodeRealSize
operator|<=
literal|8
operator|)
condition|)
operator|*
name|parseCodeCcSize
operator|=
literal|8
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|parseCodeRealSize
operator|>
literal|8
operator|)
operator|&&
operator|(
name|parseCodeRealSize
operator|<=
literal|16
operator|)
condition|)
operator|*
name|parseCodeCcSize
operator|=
literal|16
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|parseCodeRealSize
operator|>
literal|16
operator|)
operator|&&
operator|(
name|parseCodeRealSize
operator|<=
literal|24
operator|)
condition|)
operator|*
name|parseCodeCcSize
operator|=
literal|24
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|parseCodeRealSize
operator|>
literal|24
operator|)
operator|&&
operator|(
name|parseCodeRealSize
operator|<=
literal|32
operator|)
condition|)
operator|*
name|parseCodeCcSize
operator|=
literal|32
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|parseCodeRealSize
operator|>
literal|32
operator|)
operator|&&
operator|(
name|parseCodeRealSize
operator|<=
literal|40
operator|)
condition|)
operator|*
name|parseCodeCcSize
operator|=
literal|40
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|parseCodeRealSize
operator|>
literal|40
operator|)
operator|&&
operator|(
name|parseCodeRealSize
operator|<=
literal|48
operator|)
condition|)
operator|*
name|parseCodeCcSize
operator|=
literal|48
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|parseCodeRealSize
operator|>
literal|48
operator|)
operator|&&
operator|(
name|parseCodeRealSize
operator|<=
literal|56
operator|)
condition|)
operator|*
name|parseCodeCcSize
operator|=
literal|56
expr_stmt|;
else|else
operator|*
name|parseCodeCcSize
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|GetSizeHeaderField
parameter_list|(
name|e_NetHeaderType
name|hdr
parameter_list|,
name|t_FmPcdFields
name|field
parameter_list|,
name|uint8_t
modifier|*
name|parseCodeRealSize
parameter_list|)
block|{
switch|switch
condition|(
name|hdr
condition|)
block|{
case|case
operator|(
name|HEADER_TYPE_ETH
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|eth
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_ETH_DA
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|6
expr_stmt|;
break|break;
case|case
operator|(
name|NET_HEADER_FIELD_ETH_SA
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|6
expr_stmt|;
break|break;
case|case
operator|(
name|NET_HEADER_FIELD_ETH_TYPE
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|2
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported1"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|parseCodeRealSize
operator|=
name|CC_SIZE_ILLEGAL
expr_stmt|;
break|break;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_PPPoE
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|pppoe
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_PPPoE_PID
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|2
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported1"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|parseCodeRealSize
operator|=
name|CC_SIZE_ILLEGAL
expr_stmt|;
break|break;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_VLAN
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|vlan
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_VLAN_TCI
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|2
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported2"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|parseCodeRealSize
operator|=
name|CC_SIZE_ILLEGAL
expr_stmt|;
break|break;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_MPLS
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|mpls
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_MPLS_LABEL_STACK
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|4
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported3"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|parseCodeRealSize
operator|=
name|CC_SIZE_ILLEGAL
expr_stmt|;
break|break;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_IPv4
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|ipv4
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_DST_IP
operator|)
case|:
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_SRC_IP
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|4
expr_stmt|;
break|break;
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_TOS
operator|)
case|:
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_PROTO
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|1
expr_stmt|;
break|break;
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_DST_IP
operator||
name|NET_HEADER_FIELD_IPv4_SRC_IP
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|8
expr_stmt|;
break|break;
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_TTL
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|1
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported4"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|parseCodeRealSize
operator|=
name|CC_SIZE_ILLEGAL
expr_stmt|;
break|break;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_IPv6
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|ipv6
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_IPv6_VER
operator||
name|NET_HEADER_FIELD_IPv6_FL
operator||
name|NET_HEADER_FIELD_IPv6_TC
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|4
expr_stmt|;
break|break;
case|case
operator|(
name|NET_HEADER_FIELD_IPv6_NEXT_HDR
operator|)
case|:
case|case
operator|(
name|NET_HEADER_FIELD_IPv6_HOP_LIMIT
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|1
expr_stmt|;
break|break;
case|case
operator|(
name|NET_HEADER_FIELD_IPv6_DST_IP
operator|)
case|:
case|case
operator|(
name|NET_HEADER_FIELD_IPv6_SRC_IP
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|16
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported5"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|parseCodeRealSize
operator|=
name|CC_SIZE_ILLEGAL
expr_stmt|;
break|break;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_GRE
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|gre
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_GRE_TYPE
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|2
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported6"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|parseCodeRealSize
operator|=
name|CC_SIZE_ILLEGAL
expr_stmt|;
break|break;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_MINENCAP
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|minencap
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_MINENCAP_TYPE
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|1
expr_stmt|;
break|break;
case|case
operator|(
name|NET_HEADER_FIELD_MINENCAP_DST_IP
operator|)
case|:
case|case
operator|(
name|NET_HEADER_FIELD_MINENCAP_SRC_IP
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|4
expr_stmt|;
break|break;
case|case
operator|(
name|NET_HEADER_FIELD_MINENCAP_SRC_IP
operator||
name|NET_HEADER_FIELD_MINENCAP_DST_IP
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|8
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported7"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|parseCodeRealSize
operator|=
name|CC_SIZE_ILLEGAL
expr_stmt|;
break|break;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_TCP
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|tcp
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_TCP_PORT_SRC
operator|)
case|:
case|case
operator|(
name|NET_HEADER_FIELD_TCP_PORT_DST
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|2
expr_stmt|;
break|break;
case|case
operator|(
name|NET_HEADER_FIELD_TCP_PORT_SRC
operator||
name|NET_HEADER_FIELD_TCP_PORT_DST
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|4
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported8"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|parseCodeRealSize
operator|=
name|CC_SIZE_ILLEGAL
expr_stmt|;
break|break;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_UDP
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|udp
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_UDP_PORT_SRC
operator|)
case|:
case|case
operator|(
name|NET_HEADER_FIELD_UDP_PORT_DST
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|2
expr_stmt|;
break|break;
case|case
operator|(
name|NET_HEADER_FIELD_UDP_PORT_SRC
operator||
name|NET_HEADER_FIELD_UDP_PORT_DST
operator|)
case|:
operator|*
name|parseCodeRealSize
operator|=
literal|4
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported9"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|parseCodeRealSize
operator|=
name|CC_SIZE_ILLEGAL
expr_stmt|;
break|break;
block|}
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported10"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|parseCodeRealSize
operator|=
name|CC_SIZE_ILLEGAL
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|t_Error
name|ValidateNextEngineParams
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_FmPcdCcNextEngineParams
modifier|*
name|p_FmPcdCcNextEngineParams
parameter_list|)
block|{
name|uint16_t
name|absoluteProfileId
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|uint8_t
name|relativeSchemeId
decl_stmt|;
switch|switch
condition|(
name|p_FmPcdCcNextEngineParams
operator|->
name|nextEngine
condition|)
block|{
case|case
operator|(
name|e_FM_PCD_INVALID
operator|)
case|:
name|err
operator|=
name|E_NOT_SUPPORTED
expr_stmt|;
break|break;
case|case
operator|(
name|e_FM_PCD_DONE
operator|)
case|:
if|if
condition|(
name|p_FmPcdCcNextEngineParams
operator|->
name|params
operator|.
name|enqueueParams
operator|.
name|action
operator|==
name|e_FM_PCD_ENQ_FRAME
condition|)
block|{
if|if
condition|(
name|p_FmPcdCcNextEngineParams
operator|->
name|params
operator|.
name|enqueueParams
operator|.
name|overrideFqid
operator|&&
operator|!
name|p_FmPcdCcNextEngineParams
operator|->
name|params
operator|.
name|enqueueParams
operator|.
name|newFqid
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"not defined fqid for control flow for BMI next engine "
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNextEngineParams
operator|->
name|params
operator|.
name|enqueueParams
operator|.
name|newFqid
operator|&
operator|~
literal|0x00FFFFFF
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"fqidForCtrlFlow must be between 1 and 2^24-1"
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
operator|(
name|e_FM_PCD_KG
operator|)
case|:
name|relativeSchemeId
operator|=
name|FmPcdKgGetRelativeSchemeId
argument_list|(
name|h_FmPcd
argument_list|,
call|(
name|uint8_t
call|)
argument_list|(
name|PTR_TO_UINT
argument_list|(
name|p_FmPcdCcNextEngineParams
operator|->
name|params
operator|.
name|kgParams
operator|.
name|h_DirectScheme
argument_list|)
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|relativeSchemeId
operator|==
name|FM_PCD_KG_NUM_OF_SCHEMES
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_IN_RANGE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|FmPcdKgIsSchemeValidSw
argument_list|(
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"not valid schemeIndex in KG next engine param"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|KgIsSchemeAlwaysDirect
argument_list|(
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"CC Node may point only to a scheme that is always direct."
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|e_FM_PCD_PLCR
operator|)
case|:
if|if
condition|(
name|p_FmPcdCcNextEngineParams
operator|->
name|params
operator|.
name|plcrParams
operator|.
name|overrideParams
condition|)
block|{
comment|/* if private policer profile, it may be uninitialized yet, therefor no checks are done at this stage */
if|if
condition|(
name|p_FmPcdCcNextEngineParams
operator|->
name|params
operator|.
name|plcrParams
operator|.
name|sharedProfile
condition|)
block|{
name|err
operator|=
name|FmPcdPlcrGetAbsoluteProfileId
argument_list|(
name|h_FmPcd
argument_list|,
name|e_FM_PCD_PLCR_SHARED
argument_list|,
name|NULL
argument_list|,
name|p_FmPcdCcNextEngineParams
operator|->
name|params
operator|.
name|plcrParams
operator|.
name|newRelativeProfileId
argument_list|,
operator|&
name|absoluteProfileId
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
literal|"Shared profile offset is out of range"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|FmPcdPlcrIsProfileValid
argument_list|(
name|h_FmPcd
argument_list|,
name|absoluteProfileId
argument_list|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"Invalid profile"
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{                 }
comment|/* TODO - add check according to the revision of the chip.                 if(!p_FmPcdCcNextEngineParams->params.plcrParams.newFqid ||                    (p_FmPcdCcNextEngineParams->params.plcrParams.newFqid& ~0x00FFFFFF))                     RETURN_ERROR(MAJOR, E_INVALID_STATE, ("newFqid  must be between 1 and 2^24-1"));                 */
block|}
break|break;
case|case
operator|(
name|e_FM_PCD_CC
operator|)
case|:
if|if
condition|(
operator|!
name|p_FmPcdCcNextEngineParams
operator|->
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NULL_POINTER
argument_list|,
operator|(
literal|"handler to next Node is NULL"
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"Next engine is not correct"
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
name|err
return|;
block|}
end_function

begin_function
specifier|static
name|uint8_t
name|GetGenParseCode
parameter_list|(
name|e_FmPcdExtractFrom
name|src
parameter_list|,
name|uint32_t
name|offset
parameter_list|,
name|bool
name|glblMask
parameter_list|,
name|uint8_t
modifier|*
name|parseArrayOffset
parameter_list|,
name|bool
name|fromIc
parameter_list|,
name|ccPrivateInfo_t
name|icCode
parameter_list|)
block|{
if|if
condition|(
operator|!
name|fromIc
condition|)
block|{
switch|switch
condition|(
name|src
condition|)
block|{
case|case
operator|(
name|e_FM_PCD_EXTRACT_FROM_FRAME_START
operator|)
case|:
if|if
condition|(
name|glblMask
condition|)
return|return
name|CC_PC_GENERIC_WITH_MASK
return|;
else|else
return|return
name|CC_PC_GENERIC_WITHOUT_MASK
return|;
case|case
operator|(
name|e_FM_PCD_EXTRACT_FROM_CURR_END_OF_PARSE
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_NEXT_HEADER_OFFSET
expr_stmt|;
if|if
condition|(
name|offset
condition|)
return|return
name|CC_PR_OFFSET
return|;
else|else
return|return
name|CC_PR_WITHOUT_OFFSET
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"Illegal 'extract from' src"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
block|}
else|else
block|{
switch|switch
condition|(
name|icCode
condition|)
block|{
case|case
operator|(
name|CC_PRIVATE_INFO_IC_KEY_EXACT_MATCH
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
literal|0x50
expr_stmt|;
return|return
name|CC_PC_GENERIC_IC_GMASK
return|;
case|case
operator|(
name|CC_PRIVATE_INFO_IC_HASH_EXACT_MATCH
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
literal|0x48
expr_stmt|;
return|return
name|CC_PC_GENERIC_IC_GMASK
return|;
case|case
operator|(
name|CC_PRIVATE_INFO_IC_HASH_INDEX_LOOKUP
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
literal|0x48
expr_stmt|;
return|return
name|CC_PC_GENERIC_IC_HASH_INDEXED
return|;
case|case
operator|(
name|CC_PRIVATE_INFO_IC_DEQ_FQID_INDEX_LOOKUP
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
literal|0x16
expr_stmt|;
return|return
name|CC_PC_GENERIC_IC_HASH_INDEXED
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"Illegal 'extract from' src"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
return|return
name|CC_PC_ILLEGAL
return|;
block|}
end_function

begin_function
specifier|static
name|uint8_t
name|GetFullFieldParseCode
parameter_list|(
name|e_NetHeaderType
name|hdr
parameter_list|,
name|e_FmPcdHdrIndex
name|index
parameter_list|,
name|t_FmPcdFields
name|field
parameter_list|)
block|{
switch|switch
condition|(
name|hdr
condition|)
block|{
case|case
operator|(
name|HEADER_TYPE_NONE
operator|)
case|:
name|ASSERT_COND
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
case|case
operator|(
name|HEADER_TYPE_ETH
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|eth
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_ETH_DA
operator|)
case|:
return|return
name|CC_PC_FF_MACDST
return|;
case|case
operator|(
name|NET_HEADER_FIELD_ETH_SA
operator|)
case|:
return|return
name|CC_PC_FF_MACSRC
return|;
case|case
operator|(
name|NET_HEADER_FIELD_ETH_TYPE
operator|)
case|:
return|return
name|CC_PC_FF_ETYPE
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
case|case
operator|(
name|HEADER_TYPE_VLAN
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|vlan
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_VLAN_TCI
operator|)
case|:
if|if
condition|(
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
return|return
name|CC_PC_FF_TCI1
return|;
if|if
condition|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_LAST
condition|)
return|return
name|CC_PC_FF_TCI2
return|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
case|case
operator|(
name|HEADER_TYPE_MPLS
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|mpls
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_MPLS_LABEL_STACK
operator|)
case|:
if|if
condition|(
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
return|return
name|CC_PC_FF_MPLS1
return|;
if|if
condition|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_LAST
condition|)
return|return
name|CC_PC_FF_MPLS_LAST
return|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal MPLS index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
case|case
operator|(
name|HEADER_TYPE_IPv4
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|ipv4
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_DST_IP
operator|)
case|:
if|if
condition|(
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
return|return
name|CC_PC_FF_IPV4DST1
return|;
if|if
condition|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_2
condition|)
return|return
name|CC_PC_FF_IPV4DST2
return|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal IPv4 index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_TOS
operator|)
case|:
if|if
condition|(
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
return|return
name|CC_PC_FF_IPV4IPTOS_TC1
return|;
if|if
condition|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_2
condition|)
return|return
name|CC_PC_FF_IPV4IPTOS_TC2
return|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal IPv4 index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_PROTO
operator|)
case|:
if|if
condition|(
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
return|return
name|CC_PC_FF_IPV4PTYPE1
return|;
if|if
condition|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_2
condition|)
return|return
name|CC_PC_FF_IPV4PTYPE2
return|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal IPv4 index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_SRC_IP
operator|)
case|:
if|if
condition|(
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
return|return
name|CC_PC_FF_IPV4SRC1
return|;
if|if
condition|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_2
condition|)
return|return
name|CC_PC_FF_IPV4SRC2
return|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal IPv4 index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_SRC_IP
operator||
name|NET_HEADER_FIELD_IPv4_DST_IP
operator|)
case|:
if|if
condition|(
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
return|return
name|CC_PC_FF_IPV4SRC1_IPV4DST1
return|;
if|if
condition|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_2
condition|)
return|return
name|CC_PC_FF_IPV4SRC2_IPV4DST2
return|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal IPv4 index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
case|case
operator|(
name|NET_HEADER_FIELD_IPv4_TTL
operator|)
case|:
return|return
name|CC_PC_FF_IPV4TTL
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
case|case
operator|(
name|HEADER_TYPE_IPv6
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|ipv6
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_IPv6_VER
operator||
name|NET_HEADER_FIELD_IPv6_FL
operator||
name|NET_HEADER_FIELD_IPv6_TC
operator|)
case|:
if|if
condition|(
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
return|return
name|CC_PC_FF_IPTOS_IPV6TC1_IPV6FLOW1
return|;
if|if
condition|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_2
condition|)
return|return
name|CC_PC_FF_IPTOS_IPV6TC2_IPV6FLOW2
return|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal IPv6 index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
case|case
operator|(
name|NET_HEADER_FIELD_IPv6_NEXT_HDR
operator|)
case|:
if|if
condition|(
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
return|return
name|CC_PC_FF_IPV6PTYPE1
return|;
if|if
condition|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_2
condition|)
return|return
name|CC_PC_FF_IPV6PTYPE2
return|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal IPv6 index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
case|case
operator|(
name|NET_HEADER_FIELD_IPv6_DST_IP
operator|)
case|:
if|if
condition|(
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
return|return
name|CC_PC_FF_IPV6DST1
return|;
if|if
condition|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_2
condition|)
return|return
name|CC_PC_FF_IPV6DST2
return|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal IPv6 index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
case|case
operator|(
name|NET_HEADER_FIELD_IPv6_SRC_IP
operator|)
case|:
if|if
condition|(
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
return|return
name|CC_PC_FF_IPV6SRC1
return|;
if|if
condition|(
name|index
operator|==
name|e_FM_PCD_HDR_INDEX_2
condition|)
return|return
name|CC_PC_FF_IPV6SRC2
return|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal IPv6 index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
case|case
operator|(
name|NET_HEADER_FIELD_IPv6_HOP_LIMIT
operator|)
case|:
return|return
name|CC_PC_FF_IPV6HOP_LIMIT
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
case|case
operator|(
name|HEADER_TYPE_GRE
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|gre
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_GRE_TYPE
operator|)
case|:
return|return
name|CC_PC_FF_GREPTYPE
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
case|case
operator|(
name|HEADER_TYPE_MINENCAP
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|minencap
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_MINENCAP_TYPE
operator|)
case|:
return|return
name|CC_PC_FF_MINENCAP_PTYPE
return|;
case|case
operator|(
name|NET_HEADER_FIELD_MINENCAP_DST_IP
operator|)
case|:
return|return
name|CC_PC_FF_MINENCAP_IPDST
return|;
case|case
operator|(
name|NET_HEADER_FIELD_MINENCAP_SRC_IP
operator|)
case|:
return|return
name|CC_PC_FF_MINENCAP_IPSRC
return|;
case|case
operator|(
name|NET_HEADER_FIELD_MINENCAP_SRC_IP
operator||
name|NET_HEADER_FIELD_MINENCAP_DST_IP
operator|)
case|:
return|return
name|CC_PC_FF_MINENCAP_IPSRC_IPDST
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
case|case
operator|(
name|HEADER_TYPE_TCP
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|tcp
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_TCP_PORT_SRC
operator|)
case|:
return|return
name|CC_PC_FF_L4PSRC
return|;
case|case
operator|(
name|NET_HEADER_FIELD_TCP_PORT_DST
operator|)
case|:
return|return
name|CC_PC_FF_L4PDST
return|;
case|case
operator|(
name|NET_HEADER_FIELD_TCP_PORT_DST
operator||
name|NET_HEADER_FIELD_TCP_PORT_SRC
operator|)
case|:
return|return
name|CC_PC_FF_L4PSRC_L4PDST
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
case|case
operator|(
name|HEADER_TYPE_PPPoE
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|pppoe
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_PPPoE_PID
operator|)
case|:
return|return
name|CC_PC_FF_PPPPID
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
case|case
operator|(
name|HEADER_TYPE_UDP
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|udp
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_UDP_PORT_SRC
operator|)
case|:
return|return
name|CC_PC_FF_L4PSRC
return|;
case|case
operator|(
name|NET_HEADER_FIELD_UDP_PORT_DST
operator|)
case|:
return|return
name|CC_PC_FF_L4PDST
return|;
case|case
operator|(
name|NET_HEADER_FIELD_UDP_PORT_DST
operator||
name|NET_HEADER_FIELD_UDP_PORT_SRC
operator|)
case|:
return|return
name|CC_PC_FF_L4PSRC_L4PDST
return|;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|uint8_t
name|GetPrParseCode
parameter_list|(
name|e_NetHeaderType
name|hdr
parameter_list|,
name|e_FmPcdHdrIndex
name|hdrIndex
parameter_list|,
name|uint32_t
name|offset
parameter_list|,
name|bool
name|glblMask
parameter_list|,
name|uint8_t
modifier|*
name|parseArrayOffset
parameter_list|)
block|{
name|bool
name|offsetRelevant
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
name|offset
condition|)
name|offsetRelevant
operator|=
name|TRUE
expr_stmt|;
switch|switch
condition|(
name|hdr
condition|)
block|{
case|case
operator|(
name|HEADER_TYPE_NONE
operator|)
case|:
name|ASSERT_COND
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
case|case
operator|(
name|HEADER_TYPE_ETH
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
operator|(
name|uint8_t
operator|)
name|CC_PC_PR_ETH_OFFSET
expr_stmt|;
break|break;
case|case
operator|(
name|HEADER_TYPE_USER_DEFINED_SHIM1
operator|)
case|:
if|if
condition|(
name|offset
operator|||
name|glblMask
condition|)
operator|*
name|parseArrayOffset
operator|=
operator|(
name|uint8_t
operator|)
name|CC_PC_PR_USER_DEFINED_SHIM1_OFFSET
expr_stmt|;
else|else
return|return
name|CC_PC_PR_SHIM1
return|;
break|break;
case|case
operator|(
name|HEADER_TYPE_USER_DEFINED_SHIM2
operator|)
case|:
if|if
condition|(
name|offset
operator|||
name|glblMask
condition|)
operator|*
name|parseArrayOffset
operator|=
operator|(
name|uint8_t
operator|)
name|CC_PC_PR_USER_DEFINED_SHIM2_OFFSET
expr_stmt|;
else|else
return|return
name|CC_PC_PR_SHIM2
return|;
break|break;
case|case
operator|(
name|HEADER_TYPE_LLC_SNAP
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_USER_LLC_SNAP_OFFSET
expr_stmt|;
break|break;
case|case
operator|(
name|HEADER_TYPE_PPPoE
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_PPPOE_OFFSET
expr_stmt|;
break|break;
case|case
operator|(
name|HEADER_TYPE_MPLS
operator|)
case|:
if|if
condition|(
operator|(
name|hdrIndex
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|hdrIndex
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_MPLS1_OFFSET
expr_stmt|;
elseif|else
if|if
condition|(
name|hdrIndex
operator|==
name|e_FM_PCD_HDR_INDEX_LAST
condition|)
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_MPLS_LAST_OFFSET
expr_stmt|;
else|else
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal MPLS header index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_IPv4
operator|)
case|:
case|case
operator|(
name|HEADER_TYPE_IPv6
operator|)
case|:
if|if
condition|(
operator|(
name|hdrIndex
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|hdrIndex
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_IP1_OFFSET
expr_stmt|;
elseif|else
if|if
condition|(
name|hdrIndex
operator|==
name|e_FM_PCD_HDR_INDEX_2
condition|)
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_IP_LAST_OFFSET
expr_stmt|;
else|else
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal IP header index"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_MINENCAP
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_MINENC_OFFSET
expr_stmt|;
break|break;
case|case
operator|(
name|HEADER_TYPE_GRE
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_GRE_OFFSET
expr_stmt|;
break|break;
case|case
operator|(
name|HEADER_TYPE_TCP
operator|)
case|:
case|case
operator|(
name|HEADER_TYPE_UDP
operator|)
case|:
case|case
operator|(
name|HEADER_TYPE_IPSEC_AH
operator|)
case|:
case|case
operator|(
name|HEADER_TYPE_IPSEC_ESP
operator|)
case|:
case|case
operator|(
name|HEADER_TYPE_DCCP
operator|)
case|:
case|case
operator|(
name|HEADER_TYPE_SCTP
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_L4_OFFSET
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal IP header for this type of operation"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
if|if
condition|(
name|offsetRelevant
condition|)
return|return
name|CC_PR_OFFSET
return|;
else|else
return|return
name|CC_PR_WITHOUT_OFFSET
return|;
block|}
end_function

begin_function
specifier|static
name|uint8_t
name|GetFieldParseCode
parameter_list|(
name|e_NetHeaderType
name|hdr
parameter_list|,
name|t_FmPcdFields
name|field
parameter_list|,
name|uint32_t
name|offset
parameter_list|,
name|uint8_t
modifier|*
name|parseArrayOffset
parameter_list|,
name|e_FmPcdHdrIndex
name|hdrIndex
parameter_list|)
block|{
name|bool
name|offsetRelevant
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
name|offset
condition|)
name|offsetRelevant
operator|=
name|TRUE
expr_stmt|;
switch|switch
condition|(
name|hdr
condition|)
block|{
case|case
operator|(
name|HEADER_TYPE_NONE
operator|)
case|:
name|ASSERT_COND
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
case|case
operator|(
name|HEADER_TYPE_ETH
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|eth
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_ETH_TYPE
operator|)
case|:
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_ETYPE_LAST_OFFSET
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
break|break;
case|case
operator|(
name|HEADER_TYPE_VLAN
operator|)
case|:
switch|switch
condition|(
name|field
operator|.
name|vlan
condition|)
block|{
case|case
operator|(
name|NET_HEADER_FIELD_VLAN_TCI
operator|)
case|:
if|if
condition|(
operator|(
name|hdrIndex
operator|==
name|e_FM_PCD_HDR_INDEX_NONE
operator|)
operator|||
operator|(
name|hdrIndex
operator|==
name|e_FM_PCD_HDR_INDEX_1
operator|)
condition|)
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_VLAN1_OFFSET
expr_stmt|;
elseif|else
if|if
condition|(
name|hdrIndex
operator|==
name|e_FM_PCD_HDR_INDEX_LAST
condition|)
operator|*
name|parseArrayOffset
operator|=
name|CC_PC_PR_VLAN2_OFFSET
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Extraction not supported"
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"Illegal header "
operator|)
argument_list|)
expr_stmt|;
return|return
name|CC_PC_ILLEGAL
return|;
block|}
if|if
condition|(
name|offsetRelevant
condition|)
return|return
name|CC_PR_OFFSET
return|;
else|else
return|return
name|CC_PR_WITHOUT_OFFSET
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|FillAdOfTypeResult
parameter_list|(
name|t_Handle
name|p_Ad
parameter_list|,
name|t_FmPcd
modifier|*
name|p_FmPcd
parameter_list|,
name|t_FmPcdCcNextEngineParams
modifier|*
name|p_CcNextEngineParams
parameter_list|)
block|{
name|t_AdOfTypeResult
modifier|*
name|p_AdResult
init|=
operator|(
name|t_AdOfTypeResult
operator|*
operator|)
name|p_Ad
decl_stmt|;
name|uint32_t
name|tmp
init|=
literal|0
decl_stmt|,
name|tmpNia
init|=
literal|0
decl_stmt|;
name|uint16_t
name|profileId
decl_stmt|;
name|t_Handle
name|p_AdNewPtr
init|=
name|NULL
decl_stmt|;
name|p_AdNewPtr
operator|=
name|p_AdResult
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|h_Manip
condition|)
name|FmPcdManipUpdateAdResultForCc
argument_list|(
name|p_CcNextEngineParams
operator|->
name|h_Manip
argument_list|,
name|p_Ad
argument_list|,
operator|&
name|p_AdNewPtr
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
if|if
condition|(
name|p_AdNewPtr
condition|)
block|{
switch|switch
condition|(
name|p_CcNextEngineParams
operator|->
name|nextEngine
condition|)
block|{
case|case
operator|(
name|e_FM_PCD_DONE
operator|)
case|:
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|enqueueParams
operator|.
name|action
operator|==
name|e_FM_PCD_ENQ_FRAME
condition|)
block|{
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|enqueueParams
operator|.
name|overrideFqid
condition|)
block|{
name|tmp
operator|=
name|FM_PCD_AD_RESULT_CONTRL_FLOW_TYPE
expr_stmt|;
name|tmp
operator||=
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|enqueueParams
operator|.
name|newFqid
expr_stmt|;
block|}
else|else
block|{
name|tmp
operator|=
name|FM_PCD_AD_RESULT_DATA_FLOW_TYPE
expr_stmt|;
name|tmp
operator||=
name|FM_PCD_AD_RESULT_PLCR_DIS
expr_stmt|;
block|}
block|}
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|enqueueParams
operator|.
name|action
operator|==
name|e_FM_PCD_DROP_FRAME
condition|)
name|tmpNia
operator||=
operator|(
name|NIA_ENG_BMI
operator||
name|NIA_BMI_AC_DISCARD
operator|)
expr_stmt|;
else|else
name|tmpNia
operator||=
operator|(
name|NIA_ENG_BMI
operator||
name|NIA_BMI_AC_ENQ_FRAME
operator|)
expr_stmt|;
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|enqueueParams
operator|.
name|statisticsEn
condition|)
name|tmpNia
operator||=
name|FM_PCD_AD_RESULT_EXTENDED_MODE
operator||
name|FM_PCD_AD_RESULT_STATISTICS_EN
expr_stmt|;
break|break;
case|case
operator|(
name|e_FM_PCD_KG
operator|)
case|:
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|kgParams
operator|.
name|overrideFqid
condition|)
block|{
name|tmp
operator|=
name|FM_PCD_AD_RESULT_CONTRL_FLOW_TYPE
expr_stmt|;
name|tmp
operator||=
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|kgParams
operator|.
name|newFqid
expr_stmt|;
block|}
else|else
block|{
name|tmp
operator|=
name|FM_PCD_AD_RESULT_DATA_FLOW_TYPE
expr_stmt|;
name|tmp
operator||=
name|FM_PCD_AD_RESULT_PLCR_DIS
expr_stmt|;
block|}
name|tmpNia
operator|=
name|NIA_KG_DIRECT
expr_stmt|;
name|tmpNia
operator||=
name|NIA_ENG_KG
expr_stmt|;
name|tmpNia
operator||=
call|(
name|uint8_t
call|)
argument_list|(
name|PTR_TO_UINT
argument_list|(
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|kgParams
operator|.
name|h_DirectScheme
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|kgParams
operator|.
name|statisticsEn
condition|)
name|tmpNia
operator||=
name|FM_PCD_AD_RESULT_EXTENDED_MODE
operator||
name|FM_PCD_AD_RESULT_STATISTICS_EN
expr_stmt|;
break|break;
case|case
operator|(
name|e_FM_PCD_PLCR
operator|)
case|:
name|tmp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|plcrParams
operator|.
name|overrideParams
condition|)
block|{
name|tmp
operator|=
name|FM_PCD_AD_RESULT_CONTRL_FLOW_TYPE
expr_stmt|;
comment|/* if private policer profile, it may be uninitialized yet, therefor no checks are done at this stage */
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|plcrParams
operator|.
name|sharedProfile
condition|)
block|{
name|tmpNia
operator||=
name|NIA_PLCR_ABSOLUTE
expr_stmt|;
name|FmPcdPlcrGetAbsoluteProfileId
argument_list|(
operator|(
name|t_Handle
operator|)
name|p_FmPcd
argument_list|,
name|e_FM_PCD_PLCR_SHARED
argument_list|,
name|NULL
argument_list|,
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|plcrParams
operator|.
name|newRelativeProfileId
argument_list|,
operator|&
name|profileId
argument_list|)
expr_stmt|;
block|}
else|else
name|profileId
operator|=
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|plcrParams
operator|.
name|newRelativeProfileId
expr_stmt|;
name|tmp
operator||=
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|plcrParams
operator|.
name|newFqid
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_AdResult
operator|->
name|plcrProfile
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
operator|(
name|uint32_t
operator|)
name|profileId
operator|<<
name|FM_PCD_AD_PROFILEID_FOR_CNTRL_SHIFT
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
name|tmp
operator|=
name|FM_PCD_AD_RESULT_DATA_FLOW_TYPE
expr_stmt|;
name|tmpNia
operator||=
name|NIA_ENG_PLCR
operator||
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|plcrParams
operator|.
name|newRelativeProfileId
expr_stmt|;
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|kgParams
operator|.
name|statisticsEn
condition|)
name|tmpNia
operator||=
name|FM_PCD_AD_RESULT_EXTENDED_MODE
operator||
name|FM_PCD_AD_RESULT_STATISTICS_EN
expr_stmt|;
break|break;
default|default:
return|return;
block|}
name|WRITE_UINT32
argument_list|(
name|p_AdResult
operator|->
name|fqid
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|h_Manip
condition|)
block|{
name|tmp
operator|=
name|GET_UINT32
argument_list|(
name|p_AdResult
operator|->
name|plcrProfile
argument_list|)
expr_stmt|;
name|tmp
operator||=
call|(
name|uint32_t
call|)
argument_list|(
name|XX_VirtToPhys
argument_list|(
name|p_AdNewPtr
argument_list|)
operator|-
operator|(
name|p_FmPcd
operator|->
name|physicalMuramBase
operator|)
argument_list|)
operator|>>
literal|4
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_AdResult
operator|->
name|plcrProfile
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|tmpNia
operator||=
name|FM_PCD_AD_RESULT_EXTENDED_MODE
expr_stmt|;
name|tmpNia
operator||=
name|FM_PCD_AD_RESULT_NADEN
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|WRITE_UINT32
argument_list|(
name|p_AdResult
operator|->
name|nia
argument_list|,
name|tmpNia
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|FillAdOfTypeContLookup
parameter_list|(
name|t_Handle
name|p_Ad
parameter_list|,
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|p_FmPcdCcNode
parameter_list|,
name|t_Handle
name|h_Manip
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_Node
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|p_FmPcdCcNode
decl_stmt|;
name|t_AdOfTypeContLookup
modifier|*
name|p_AdContLookup
init|=
operator|(
name|t_AdOfTypeContLookup
operator|*
operator|)
name|p_Ad
decl_stmt|;
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|uint32_t
name|tmpReg32
decl_stmt|;
name|t_Handle
name|p_AdNewPtr
init|=
name|NULL
decl_stmt|;
name|p_AdNewPtr
operator|=
name|p_AdContLookup
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|h_Manip
condition|)
name|FmPcdManipUpdateAdContLookupForCc
argument_list|(
name|h_Manip
argument_list|,
name|p_Ad
argument_list|,
operator|&
name|p_AdNewPtr
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
operator|(
name|XX_VirtToPhys
argument_list|(
name|p_Node
operator|->
name|h_AdTable
argument_list|)
operator|-
name|p_FmPcd
operator|->
name|physicalMuramBase
operator|)
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|UNUSED
argument_list|(
name|h_Manip
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
if|if
condition|(
name|p_AdNewPtr
condition|)
block|{
name|tmpReg32
operator|=
literal|0
expr_stmt|;
name|tmpReg32
operator||=
name|FM_PCD_AD_CONT_LOOKUP_TYPE
expr_stmt|;
name|tmpReg32
operator||=
name|p_Node
operator|->
name|sizeOfExtraction
condition|?
operator|(
operator|(
name|p_Node
operator|->
name|sizeOfExtraction
operator|-
literal|1
operator|)
operator|<<
literal|24
operator|)
else|:
literal|0
expr_stmt|;
name|tmpReg32
operator||=
call|(
name|uint32_t
call|)
argument_list|(
name|XX_VirtToPhys
argument_list|(
name|p_Node
operator|->
name|h_AdTable
argument_list|)
operator|-
name|p_FmPcd
operator|->
name|physicalMuramBase
argument_list|)
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_AdContLookup
operator|->
name|ccAdBase
argument_list|,
name|tmpReg32
argument_list|)
expr_stmt|;
name|tmpReg32
operator|=
literal|0
expr_stmt|;
name|tmpReg32
operator||=
name|p_Node
operator|->
name|numOfKeys
operator|<<
literal|24
expr_stmt|;
name|tmpReg32
operator||=
operator|(
name|p_Node
operator|->
name|lclMask
condition|?
name|FM_PCD_AD_CONT_LOOKUP_LCL_MASK
else|:
literal|0
operator|)
expr_stmt|;
name|tmpReg32
operator||=
name|p_Node
operator|->
name|h_KeysMatchTable
condition|?
call|(
name|uint32_t
call|)
argument_list|(
name|XX_VirtToPhys
argument_list|(
name|p_Node
operator|->
name|h_KeysMatchTable
argument_list|)
operator|-
name|p_FmPcd
operator|->
name|physicalMuramBase
argument_list|)
else|:
literal|0
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_AdContLookup
operator|->
name|matchTblPtr
argument_list|,
name|tmpReg32
argument_list|)
expr_stmt|;
name|tmpReg32
operator|=
literal|0
expr_stmt|;
name|tmpReg32
operator||=
name|p_Node
operator|->
name|prsArrayOffset
operator|<<
literal|24
expr_stmt|;
name|tmpReg32
operator||=
name|p_Node
operator|->
name|offset
operator|<<
literal|16
expr_stmt|;
name|tmpReg32
operator||=
name|p_Node
operator|->
name|parseCode
expr_stmt|;
name|WRITE_UINT32
argument_list|(
name|p_AdContLookup
operator|->
name|pcAndOffsets
argument_list|,
name|tmpReg32
argument_list|)
expr_stmt|;
name|Mem2IOCpy32
argument_list|(
operator|(
name|void
operator|*
operator|)
operator|&
name|p_AdContLookup
operator|->
name|gmask
argument_list|,
name|p_Node
operator|->
name|p_GlblMask
argument_list|,
name|CC_GLBL_MASK_SIZE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|NextStepAd
parameter_list|(
name|t_Handle
name|p_Ad
parameter_list|,
name|t_FmPcdCcNextEngineParams
modifier|*
name|p_FmPcdCcNextEngineParams
parameter_list|,
name|t_FmPcd
modifier|*
name|p_FmPcd
parameter_list|)
block|{
switch|switch
condition|(
name|p_FmPcdCcNextEngineParams
operator|->
name|nextEngine
condition|)
block|{
case|case
operator|(
name|e_FM_PCD_KG
operator|)
case|:
case|case
operator|(
name|e_FM_PCD_PLCR
operator|)
case|:
case|case
operator|(
name|e_FM_PCD_DONE
operator|)
case|:
name|FillAdOfTypeResult
argument_list|(
name|p_Ad
argument_list|,
name|p_FmPcd
argument_list|,
name|p_FmPcdCcNextEngineParams
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|e_FM_PCD_CC
operator|)
case|:
name|FillAdOfTypeContLookup
argument_list|(
argument|p_Ad
argument_list|,
argument|p_FmPcd
argument_list|,
argument|p_FmPcdCcNextEngineParams->params.ccParams.h_CcNode
argument_list|,
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
argument|p_FmPcdCcNextEngineParams->h_Manip
else|#
directive|else
argument|NULL
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
argument_list|)
empty_stmt|;
name|UpdateNodeOwner
argument_list|(
name|p_FmPcdCcNextEngineParams
operator|->
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|ReleaseNewNodeCommonPart
parameter_list|(
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_AdditionalInfo
parameter_list|)
block|{
if|if
condition|(
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
condition|)
name|FM_MURAM_FreeMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
operator|(
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
operator|(
name|p_AdditionalInfo
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|h_FmPcd
argument_list|)
argument_list|,
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableNew
condition|)
name|FM_MURAM_FreeMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
operator|(
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
operator|(
name|p_AdditionalInfo
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|h_FmPcd
argument_list|)
argument_list|,
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableNew
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|UpdateGblMask
parameter_list|(
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|,
name|uint8_t
name|keySize
parameter_list|,
name|uint8_t
modifier|*
name|p_Mask
parameter_list|)
block|{
if|if
condition|(
name|p_Mask
operator|&&
operator|!
name|p_FmPcdCcNode
operator|->
name|glblMaskUpdated
operator|&&
operator|(
name|keySize
operator|<=
literal|4
operator|)
operator|&&
operator|!
name|p_FmPcdCcNode
operator|->
name|lclMask
condition|)
block|{
name|memcpy
argument_list|(
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|,
name|p_Mask
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
operator|)
operator|*
name|keySize
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|glblMaskUpdated
operator|=
name|TRUE
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|glblMaskSize
operator|=
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|p_Mask
operator|&&
operator|(
name|keySize
operator|<=
literal|4
operator|)
operator|&&
operator|!
name|p_FmPcdCcNode
operator|->
name|lclMask
condition|)
block|{
if|if
condition|(
name|memcmp
argument_list|(
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|,
name|p_Mask
argument_list|,
name|keySize
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|p_FmPcdCcNode
operator|->
name|lclMask
operator|=
name|TRUE
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|glblMaskSize
operator|=
literal|0
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|!
name|p_Mask
operator|&&
operator|(
name|p_FmPcdCcNode
operator|->
name|glblMaskUpdated
operator|)
operator|&&
operator|(
name|keySize
operator|<=
literal|4
operator|)
condition|)
block|{
name|uint32_t
name|tmpMask
init|=
literal|0xffffffff
decl_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|,
operator|&
name|tmpMask
argument_list|,
literal|4
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|p_FmPcdCcNode
operator|->
name|lclMask
operator|=
name|TRUE
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|glblMaskSize
operator|=
literal|0
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|p_Mask
condition|)
block|{
name|p_FmPcdCcNode
operator|->
name|lclMask
operator|=
name|TRUE
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|glblMaskSize
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|BuildNewNodeCommonPart
parameter_list|(
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|,
name|int
modifier|*
name|size
parameter_list|,
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_AdditionalInfo
parameter_list|)
block|{
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
operator|=
operator|(
name|t_Handle
operator|)
name|FM_MURAM_AllocMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
argument_list|)
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
operator|(
name|p_AdditionalInfo
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
argument_list|,
name|FM_PCD_CC_AD_TABLE_ALIGN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"No memory in MURAM for AD table "
operator|)
argument_list|)
expr_stmt|;
name|IOMemSet32
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
argument_list|,
literal|0
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
operator|(
name|p_AdditionalInfo
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|lclMask
condition|)
operator|*
name|size
operator|=
literal|2
operator|*
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
expr_stmt|;
else|else
operator|*
name|size
operator|=
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
expr_stmt|;
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableNew
operator|=
operator|(
name|t_Handle
operator|)
name|FM_MURAM_AllocMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
argument_list|)
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
operator|*
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
operator|*
operator|(
name|p_AdditionalInfo
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
argument_list|)
argument_list|,
name|FM_PCD_CC_KEYS_MATCH_TABLE_ALIGN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableNew
condition|)
block|{
name|FM_MURAM_FreeMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
argument_list|)
argument_list|,
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
argument_list|)
expr_stmt|;
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
operator|=
name|NULL
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"No memory in MURAM for KEY MATCH table"
operator|)
argument_list|)
expr_stmt|;
block|}
name|IOMemSet32
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableNew
argument_list|,
literal|0
argument_list|,
operator|*
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
operator|*
operator|(
name|p_AdditionalInfo
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|p_AdditionalInfo
operator|->
name|p_AdTableOld
operator|=
name|p_FmPcdCcNode
operator|->
name|h_AdTable
expr_stmt|;
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableOld
operator|=
name|p_FmPcdCcNode
operator|->
name|h_KeysMatchTable
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|BuildNewNodeAddOrMdfyKeyAndNextEngine
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|t_FmPcdCcKeyParams
modifier|*
name|p_KeyParams
parameter_list|,
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_AdditionalInfo
parameter_list|,
name|bool
name|add
parameter_list|)
block|{
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_Handle
name|p_AdTableNewTmp
decl_stmt|,
name|p_KeysMatchTableNewTmp
decl_stmt|;
name|t_Handle
name|p_KeysMatchTableOldTmp
decl_stmt|,
name|p_AdTableOldTmp
decl_stmt|;
name|int
name|size
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|,
name|j
init|=
literal|0
decl_stmt|;
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|uint32_t
name|requiredAction
init|=
literal|0
decl_stmt|;
name|bool
name|prvLclMask
decl_stmt|;
name|t_CcNodeInformation
modifier|*
name|p_CcNodeInformation
decl_stmt|;
name|t_List
modifier|*
name|p_Pos
decl_stmt|;
comment|/*check that new NIA is legal*/
name|err
operator|=
name|ValidateNextEngineParams
argument_list|(
name|h_FmPcd
argument_list|,
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|prvLclMask
operator|=
name|p_FmPcdCcNode
operator|->
name|lclMask
expr_stmt|;
comment|/*check that new key is not require update of localMask*/
name|err
operator|=
name|UpdateGblMask
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|,
name|p_KeyParams
operator|->
name|p_Mask
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
comment|/*update internal data structure for next engine per index (index - key)*/
name|memcpy
argument_list|(
operator|&
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
argument_list|,
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineParams
argument_list|)
argument_list|)
expr_stmt|;
comment|/*update numOfKeys*/
if|if
condition|(
name|add
condition|)
name|p_AdditionalInfo
operator|->
name|numOfKeys
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
argument_list|)
expr_stmt|;
else|else
name|p_AdditionalInfo
operator|->
name|numOfKeys
operator|=
operator|(
name|uint8_t
operator|)
name|p_FmPcdCcNode
operator|->
name|numOfKeys
expr_stmt|;
comment|/*function which build in the memory new KeyTbl, AdTbl*/
name|err
operator|=
name|BuildNewNodeCommonPart
argument_list|(
name|p_FmPcdCcNode
argument_list|,
operator|&
name|size
argument_list|,
name|p_AdditionalInfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
comment|/*check that manip is legal and what requiredAction is necessary for this manip*/
if|if
condition|(
name|p_KeyParams
operator|->
name|ccNextEngineParams
operator|.
name|h_Manip
condition|)
block|{
name|err
operator|=
name|FmPcdManipCheckParamsForCcNextEgine
argument_list|(
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|,
operator|&
name|requiredAction
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|requiredAction
operator|=
name|requiredAction
expr_stmt|;
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|requiredAction
operator||=
name|UPDATE_CC_WITH_TREE
expr_stmt|;
comment|/*update new Ad and new Key Table according to new requirement*/
name|i
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|p_AdditionalInfo
operator|->
name|numOfKeys
condition|;
name|j
operator|++
control|)
block|{
name|p_AdTableNewTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
argument_list|,
name|j
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|==
name|keyIndex
condition|)
block|{
name|NextStepAd
argument_list|(
name|p_AdTableNewTmp
argument_list|,
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
name|p_KeysMatchTableNewTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableNew
argument_list|,
name|j
operator|*
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
name|Mem2IOCpy32
argument_list|(
operator|(
name|void
operator|*
operator|)
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_KeyParams
operator|->
name|p_Key
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|lclMask
condition|)
block|{
if|if
condition|(
name|p_KeyParams
operator|->
name|p_Mask
condition|)
name|Mem2IOCpy32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
name|p_KeyParams
operator|->
name|p_Mask
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
operator|>
literal|4
condition|)
name|IOMemSet32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
literal|0xff
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
else|else
name|Mem2IOCpy32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|add
condition|)
name|i
operator|++
expr_stmt|;
block|}
else|else
block|{
name|p_AdTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableOld
argument_list|,
name|i
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|IO2IOCpy32
argument_list|(
name|p_AdTableNewTmp
argument_list|,
name|p_AdTableOldTmp
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|p_KeysMatchTableNewTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableNew
argument_list|,
name|j
operator|*
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
name|p_KeysMatchTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableOld
argument_list|,
name|i
operator|*
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|lclMask
condition|)
block|{
if|if
condition|(
name|prvLclMask
condition|)
name|IO2IOCpy32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableOldTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
expr_stmt|;
else|else
block|{
name|p_KeysMatchTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_KeysMatchTable
argument_list|,
name|i
operator|*
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
operator|>
literal|4
condition|)
name|IOMemSet32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
literal|0xff
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
else|else
name|IO2IOCpy32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
block|}
block|}
name|IO2IOCpy32
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_KeysMatchTableOldTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
block|}
name|p_AdTableNewTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
argument_list|,
name|j
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|p_AdTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableOld
argument_list|,
name|i
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|IO2IOCpy32
argument_list|(
name|p_AdTableNewTmp
argument_list|,
name|p_AdTableOldTmp
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|LIST_IsEmpty
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreesLst
argument_list|)
condition|)
block|{
name|LIST_FOR_EACH
argument_list|(
argument|p_Pos
argument_list|,
argument|&p_FmPcdCcNode->ccTreesLst
argument_list|)
block|{
name|p_CcNodeInformation
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|p_Pos
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcNodeInformation
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
comment|/*update the manipulation which has to be updated from parameters of the port*/
comment|/*it's has to be updated with restrictions defined in the function*/
name|err
operator|=
name|FmPcdCcSetRequiredAction
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
argument_list|,
name|p_FmPcdCcNode
operator|->
name|shadowAction
operator||
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|requiredAction
argument_list|,
operator|&
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
argument_list|,
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
argument_list|,
name|keyIndex
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
argument_list|,
literal|1
argument_list|,
name|p_CcNodeInformation
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|CcUpdateParam
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
argument_list|,
name|NULL
argument_list|,
operator|&
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
argument_list|,
literal|1
argument_list|,
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
argument_list|,
name|keyIndex
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
argument_list|,
name|TRUE
argument_list|,
name|p_CcNodeInformation
operator|->
name|index
argument_list|,
name|p_CcNodeInformation
operator|->
name|h_CcNode
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|lclMask
condition|)
name|memset
argument_list|(
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|,
literal|0xff
argument_list|,
name|CC_GLBL_MASK_SIZE
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_KeyParams
operator|->
name|ccNextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
name|p_AdditionalInfo
operator|->
name|h_NodeForAdd
operator|=
name|p_KeyParams
operator|->
name|ccNextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
if|if
condition|(
operator|!
name|add
condition|)
block|{
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
name|p_AdditionalInfo
operator|->
name|h_NodeForRmv
operator|=
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
condition|)
name|p_AdditionalInfo
operator|->
name|h_ManipForRmv
operator|=
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
expr_stmt|;
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|BuildNewNodeRemoveKey
parameter_list|(
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_AdditionalInfo
parameter_list|)
block|{
name|int
name|i
init|=
literal|0
decl_stmt|,
name|j
init|=
literal|0
decl_stmt|;
name|t_Handle
name|p_AdTableNewTmp
decl_stmt|,
name|p_KeysMatchTableNewTmp
decl_stmt|;
name|t_Handle
name|p_KeysMatchTableOldTmp
decl_stmt|,
name|p_AdTableOldTmp
decl_stmt|;
name|int
name|size
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
comment|/*save new numOfKeys*/
name|p_AdditionalInfo
operator|->
name|numOfKeys
operator|=
call|(
name|uint16_t
call|)
argument_list|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/*function which allocates in the memory new KeyTbl, AdTbl*/
name|err
operator|=
name|BuildNewNodeCommonPart
argument_list|(
name|p_FmPcdCcNode
argument_list|,
operator|&
name|size
argument_list|,
name|p_AdditionalInfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
comment|/*update new Ad and new Key Table according to new requirement*/
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|;
name|i
operator|++
operator|,
name|j
operator|++
control|)
block|{
if|if
condition|(
name|j
operator|==
name|keyIndex
condition|)
block|{
name|p_AdTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableOld
argument_list|,
name|j
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|j
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|j
operator|==
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|)
break|break;
name|p_AdTableNewTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
argument_list|,
name|i
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|p_AdTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableOld
argument_list|,
name|j
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|IO2IOCpy32
argument_list|(
name|p_AdTableNewTmp
argument_list|,
name|p_AdTableOldTmp
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|p_KeysMatchTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableOld
argument_list|,
name|j
operator|*
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
name|p_KeysMatchTableNewTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableNew
argument_list|,
name|i
operator|*
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
name|IO2IOCpy32
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_KeysMatchTableOldTmp
argument_list|,
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|p_AdTableNewTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
argument_list|,
name|i
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|p_AdTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableOld
argument_list|,
name|j
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|IO2IOCpy32
argument_list|(
name|p_AdTableNewTmp
argument_list|,
name|p_AdTableOldTmp
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
name|p_AdditionalInfo
operator|->
name|h_NodeForRmv
operator|=
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
condition|)
name|p_AdditionalInfo
operator|->
name|h_ManipForRmv
operator|=
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
expr_stmt|;
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|BuildNewNodeModifyKey
parameter_list|(
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|uint8_t
modifier|*
name|p_Key
parameter_list|,
name|uint8_t
modifier|*
name|p_Mask
parameter_list|,
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_AdditionalInfo
parameter_list|)
block|{
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_Handle
name|p_AdTableNewTmp
decl_stmt|,
name|p_KeysMatchTableNewTmp
decl_stmt|;
name|t_Handle
name|p_KeysMatchTableOldTmp
decl_stmt|,
name|p_AdTableOldTmp
decl_stmt|;
name|int
name|size
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|,
name|j
init|=
literal|0
decl_stmt|;
name|bool
name|prvLclMask
decl_stmt|;
name|p_AdditionalInfo
operator|->
name|numOfKeys
operator|=
name|p_FmPcdCcNode
operator|->
name|numOfKeys
expr_stmt|;
name|prvLclMask
operator|=
name|p_FmPcdCcNode
operator|->
name|lclMask
expr_stmt|;
comment|/*check that new key is not require update of localMask*/
name|err
operator|=
name|UpdateGblMask
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
argument_list|,
name|p_Mask
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
comment|/*function which build in the memory new KeyTbl, AdTbl*/
name|err
operator|=
name|BuildNewNodeCommonPart
argument_list|(
name|p_FmPcdCcNode
argument_list|,
operator|&
name|size
argument_list|,
name|p_AdditionalInfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
comment|/*fill the New AdTable and New KeyTable*/
for|for
control|(
name|j
operator|=
literal|0
operator|,
name|i
operator|=
literal|0
init|;
name|j
operator|<
name|p_AdditionalInfo
operator|->
name|numOfKeys
condition|;
name|j
operator|++
operator|,
name|i
operator|++
control|)
block|{
name|p_AdTableNewTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
argument_list|,
name|j
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|p_AdTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableOld
argument_list|,
name|i
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|IO2IOCpy32
argument_list|(
name|p_AdTableNewTmp
argument_list|,
name|p_AdTableOldTmp
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|==
name|keyIndex
condition|)
block|{
name|p_KeysMatchTableNewTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableNew
argument_list|,
name|j
operator|*
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
name|Mem2IOCpy32
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_Key
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|lclMask
condition|)
block|{
if|if
condition|(
name|p_Mask
condition|)
name|Mem2IOCpy32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
name|p_Mask
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
operator|>
literal|4
condition|)
name|IOMemSet32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
literal|0xff
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
else|else
name|Mem2IOCpy32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|p_KeysMatchTableNewTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_KeysMatchTableNew
argument_list|,
name|j
operator|*
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
name|p_KeysMatchTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_KeysMatchTable
argument_list|,
name|i
operator|*
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|lclMask
condition|)
block|{
if|if
condition|(
name|prvLclMask
condition|)
name|IO2IOCpy32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableOldTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
else|else
block|{
name|p_KeysMatchTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_KeysMatchTable
argument_list|,
name|i
operator|*
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
operator|>
literal|4
condition|)
name|IOMemSet32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
literal|0xff
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
else|else
name|IO2IOCpy32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|,
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
argument_list|)
expr_stmt|;
block|}
block|}
name|IO2IOCpy32
argument_list|(
operator|(
name|void
operator|*
operator|)
name|p_KeysMatchTableNewTmp
argument_list|,
name|p_KeysMatchTableOldTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
expr_stmt|;
block|}
block|}
name|p_AdTableNewTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdditionalInfo
operator|->
name|p_AdTableNew
argument_list|,
name|j
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|p_AdTableOldTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_AdTable
argument_list|,
name|i
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|IO2IOCpy32
argument_list|(
name|p_AdTableNewTmp
argument_list|,
name|p_AdTableOldTmp
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|BuildNewNodeModifyNextEngine
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPcdCcNodeOrTree
parameter_list|,
name|uint16_t
name|keyIndex
parameter_list|,
name|t_FmPcdCcNextEngineParams
modifier|*
name|p_CcNextEngineParams
parameter_list|,
name|t_List
modifier|*
name|h_OldLst
parameter_list|,
name|t_List
modifier|*
name|h_NewLst
parameter_list|,
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_AdditionalInfo
parameter_list|)
block|{
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|uint32_t
name|requiredAction
init|=
literal|0
decl_stmt|;
name|t_List
modifier|*
name|p_Pos
decl_stmt|;
name|t_CcNodeInformation
modifier|*
name|p_CcNodeInformation
decl_stmt|,
name|ccNodeInfo
decl_stmt|;
name|t_Handle
name|p_Ad
decl_stmt|;
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode1
init|=
name|NULL
decl_stmt|;
name|t_FmPcdCcTree
modifier|*
name|p_FmPcdCcTree
init|=
name|NULL
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcNextEngineParams
argument_list|)
expr_stmt|;
comment|/*check that new NIA is legal*/
name|err
operator|=
name|ValidateNextEngineParams
argument_list|(
name|h_FmPcd
argument_list|,
name|p_CcNextEngineParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
comment|/*update internal data structure for next engine per index (index - key)*/
name|memcpy
argument_list|(
operator|&
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
argument_list|,
name|p_CcNextEngineParams
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineParams
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
comment|/*check that manip is legal and what requiredAction is necessary for this manip*/
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|h_Manip
condition|)
block|{
name|err
operator|=
name|FmPcdManipCheckParamsForCcNextEgine
argument_list|(
name|p_CcNextEngineParams
argument_list|,
operator|&
name|requiredAction
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
if|if
condition|(
operator|!
name|p_AdditionalInfo
operator|->
name|tree
condition|)
block|{
name|p_FmPcdCcNode1
operator|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_FmPcdCcNodeOrTree
expr_stmt|;
name|p_Ad
operator|=
name|p_FmPcdCcNode1
operator|->
name|h_AdTable
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode1
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
name|p_AdditionalInfo
operator|->
name|h_NodeForRmv
operator|=
name|p_FmPcdCcNode1
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_FmPcdCcNode1
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
condition|)
name|p_AdditionalInfo
operator|->
name|h_ManipForRmv
operator|=
name|p_FmPcdCcNode1
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
expr_stmt|;
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
block|}
else|else
block|{
name|p_FmPcdCcTree
operator|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_FmPcdCcNodeOrTree
expr_stmt|;
name|p_Ad
operator|=
name|UINT_TO_PTR
argument_list|(
name|p_FmPcdCcTree
operator|->
name|ccTreeBaseAddr
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
name|p_AdditionalInfo
operator|->
name|h_NodeForRmv
operator|=
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
condition|)
name|p_AdditionalInfo
operator|->
name|h_ManipForRmv
operator|=
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
expr_stmt|;
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
block|}
name|ASSERT_COND
argument_list|(
name|p_Ad
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ccNodeInfo
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|ccNodeInfo
operator|.
name|h_CcNode
operator|=
name|PTR_MOVE
argument_list|(
name|p_Ad
argument_list|,
name|keyIndex
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|EnqueueNodeInfoToRelevantLst
argument_list|(
name|h_OldLst
argument_list|,
operator|&
name|ccNodeInfo
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ccNodeInfo
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|p_Ad
operator|=
operator|(
name|t_Handle
operator|)
name|FM_MURAM_AllocMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
name|h_FmPcd
argument_list|)
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|,
name|FM_PCD_CC_AD_TABLE_ALIGN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_Ad
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"Memory allocation in MURAM FAILED"
operator|)
argument_list|)
expr_stmt|;
name|IOMemSet32
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
name|p_Ad
argument_list|,
literal|0
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_CcNextEngineParams
condition|)
name|NextStepAd
argument_list|(
name|p_Ad
argument_list|,
name|p_CcNextEngineParams
argument_list|,
name|h_FmPcd
argument_list|)
expr_stmt|;
name|ccNodeInfo
operator|.
name|h_CcNode
operator|=
name|p_Ad
expr_stmt|;
name|EnqueueNodeInfoToRelevantLst
argument_list|(
name|h_NewLst
argument_list|,
operator|&
name|ccNodeInfo
argument_list|)
expr_stmt|;
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|requiredAction
operator|=
name|requiredAction
expr_stmt|;
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|requiredAction
operator||=
name|UPDATE_CC_WITH_TREE
expr_stmt|;
if|if
condition|(
operator|!
name|p_AdditionalInfo
operator|->
name|tree
condition|)
block|{
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcNode1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|LIST_IsEmpty
argument_list|(
operator|&
name|p_FmPcdCcNode1
operator|->
name|ccTreesLst
argument_list|)
condition|)
block|{
name|LIST_FOR_EACH
argument_list|(
argument|p_Pos
argument_list|,
argument|&p_FmPcdCcNode1->ccTreesLst
argument_list|)
block|{
name|p_CcNodeInformation
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|p_Pos
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcNodeInformation
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
comment|/*update the manipulation which has to be updated from parameters of the port*/
comment|/*it's has to be updated with restrictions defined in the function*/
name|err
operator|=
name|FmPcdCcSetRequiredAction
argument_list|(
name|p_FmPcdCcNode1
operator|->
name|h_FmPcd
argument_list|,
name|p_FmPcdCcNode1
operator|->
name|shadowAction
operator||
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|requiredAction
argument_list|,
operator|&
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
argument_list|,
name|p_Ad
argument_list|,
literal|1
argument_list|,
name|p_CcNodeInformation
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|CcUpdateParam
argument_list|(
name|p_FmPcdCcNode1
operator|->
name|h_FmPcd
argument_list|,
name|NULL
argument_list|,
operator|&
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
argument_list|,
literal|1
argument_list|,
name|p_Ad
argument_list|,
name|TRUE
argument_list|,
name|p_CcNodeInformation
operator|->
name|index
argument_list|,
name|p_CcNodeInformation
operator|->
name|h_CcNode
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcTree
argument_list|)
expr_stmt|;
name|err
operator|=
name|FmPcdCcSetRequiredAction
argument_list|(
name|h_FmPcd
argument_list|,
name|p_FmPcdCcTree
operator|->
name|requiredAction
operator||
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|requiredAction
argument_list|,
operator|&
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
argument_list|,
name|p_Ad
argument_list|,
literal|1
argument_list|,
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcTree
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|CcUpdateParam
argument_list|(
name|h_FmPcd
argument_list|,
name|NULL
argument_list|,
operator|&
name|p_AdditionalInfo
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
argument_list|,
literal|1
argument_list|,
name|p_Ad
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcTree
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|p_CcNextEngineParams
operator|->
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
name|p_AdditionalInfo
operator|->
name|h_NodeForAdd
operator|=
name|p_CcNextEngineParams
operator|->
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|t_Handle
name|BuildNewAd
parameter_list|(
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_FmPcdModifyCcKeyAdditionalParams
parameter_list|,
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|,
name|t_FmPcdCcNextEngineParams
modifier|*
name|p_FmPcdCcNextEngineParams
parameter_list|)
block|{
name|t_Handle
name|p_Ad
decl_stmt|;
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNodeTmp
decl_stmt|;
name|p_Ad
operator|=
operator|(
name|t_Handle
operator|)
name|FM_MURAM_AllocMem
argument_list|(
operator|(
operator|(
name|t_FmPcd
operator|*
operator|)
operator|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
operator|)
operator|)
operator|->
name|h_FmMuram
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|,
name|FM_PCD_CC_AD_TABLE_ALIGN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_Ad
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"MURAM for AD"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|IOMemSet32
argument_list|(
name|p_Ad
argument_list|,
literal|0
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNode
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmPcdCcNodeTmp
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"p_FmPcdCcNodeTmp"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|memset
argument_list|(
name|p_FmPcdCcNodeTmp
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNode
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|numOfKeys
operator|=
name|p_FmPcdModifyCcKeyAdditionalParams
operator|->
name|numOfKeys
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|h_KeysMatchTable
operator|=
name|p_FmPcdModifyCcKeyAdditionalParams
operator|->
name|p_KeysMatchTableNew
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|h_AdTable
operator|=
name|p_FmPcdModifyCcKeyAdditionalParams
operator|->
name|p_AdTableNew
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|lclMask
operator|=
name|p_FmPcdCcNode
operator|->
name|lclMask
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|parseCode
operator|=
name|p_FmPcdCcNode
operator|->
name|parseCode
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|offset
operator|=
name|p_FmPcdCcNode
operator|->
name|offset
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|prsArrayOffset
operator|=
name|p_FmPcdCcNode
operator|->
name|prsArrayOffset
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|ctrlFlow
operator|=
name|p_FmPcdCcNode
operator|->
name|ctrlFlow
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|ccKeySizeAccExtraction
operator|=
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|sizeOfExtraction
operator|=
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|glblMaskSize
operator|=
name|p_FmPcdCcNode
operator|->
name|glblMaskSize
expr_stmt|;
name|p_FmPcdCcNodeTmp
operator|->
name|p_GlblMask
operator|=
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNextEngineParams
operator|->
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
name|FillAdOfTypeContLookup
argument_list|(
argument|p_Ad
argument_list|,
argument|p_FmPcdCcNode->h_FmPcd
argument_list|,
argument|p_FmPcdCcNodeTmp
argument_list|,
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
argument|p_FmPcdCcNextEngineParams->h_Manip
else|#
directive|else
argument|NULL
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
argument_list|)
empty_stmt|;
name|XX_Free
argument_list|(
name|p_FmPcdCcNodeTmp
argument_list|)
expr_stmt|;
return|return
name|p_Ad
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|UpdateAdPtrOfNodesWhichPointsOnCrntMdfNode
parameter_list|(
name|t_FmPcdCcNode
modifier|*
name|p_CrntMdfNode
parameter_list|,
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_FmPcdModifyCcKeyAdditionalParams
parameter_list|,
name|t_List
modifier|*
name|h_OldLst
parameter_list|,
name|t_List
modifier|*
name|h_NewLst
parameter_list|)
block|{
name|t_CcNodeInformation
modifier|*
name|p_CcNodeInformation
decl_stmt|;
name|t_FmPcdCcNode
modifier|*
name|p_NodePtrOnCurrentMdfNode
init|=
name|NULL
decl_stmt|;
name|t_List
modifier|*
name|p_Pos
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|t_Handle
name|p_AdTablePtOnCrntCurrentMdfNode
decl_stmt|,
name|p_AdTableNewModified
decl_stmt|;
name|t_CcNodeInformation
name|ccNodeInfo
decl_stmt|;
name|LIST_FOR_EACH
argument_list|(
argument|p_Pos
argument_list|,
argument|&p_CrntMdfNode->ccPrevNodesLst
argument_list|)
block|{
name|p_CcNodeInformation
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|p_Pos
argument_list|)
expr_stmt|;
name|p_NodePtrOnCurrentMdfNode
operator|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|p_CcNodeInformation
operator|->
name|h_CcNode
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_NodePtrOnCurrentMdfNode
argument_list|)
expr_stmt|;
comment|/*search in the prev node which exact index points on this current modified node for getting AD */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_NodePtrOnCurrentMdfNode
operator|->
name|numOfKeys
operator|+
literal|1
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_NodePtrOnCurrentMdfNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
block|{
if|if
condition|(
name|p_NodePtrOnCurrentMdfNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
operator|==
operator|(
name|t_Handle
operator|)
name|p_CrntMdfNode
condition|)
block|{
name|p_AdTablePtOnCrntCurrentMdfNode
operator|=
name|PTR_MOVE
argument_list|(
name|p_NodePtrOnCurrentMdfNode
operator|->
name|h_AdTable
argument_list|,
name|i
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ccNodeInfo
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|ccNodeInfo
operator|.
name|h_CcNode
operator|=
name|p_AdTablePtOnCrntCurrentMdfNode
expr_stmt|;
name|EnqueueNodeInfoToRelevantLst
argument_list|(
name|h_OldLst
argument_list|,
operator|&
name|ccNodeInfo
argument_list|)
expr_stmt|;
name|p_AdTableNewModified
operator|=
name|BuildNewAd
argument_list|(
name|p_FmPcdModifyCcKeyAdditionalParams
argument_list|,
name|p_CrntMdfNode
argument_list|,
operator|&
name|p_NodePtrOnCurrentMdfNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ccNodeInfo
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|ccNodeInfo
operator|.
name|h_CcNode
operator|=
name|p_AdTableNewModified
expr_stmt|;
name|EnqueueNodeInfoToRelevantLst
argument_list|(
name|h_NewLst
argument_list|,
operator|&
name|ccNodeInfo
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|ASSERT_COND
argument_list|(
name|i
operator|!=
name|p_NodePtrOnCurrentMdfNode
operator|->
name|numOfKeys
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|UpdateAdPtrOfTreesWhichPointsOnCrntMdfNode
parameter_list|(
name|t_FmPcdCcNode
modifier|*
name|p_CrntMdfNode
parameter_list|,
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_FmPcdModifyCcKeyAdditionalParams
parameter_list|,
name|t_List
modifier|*
name|h_OldLst
parameter_list|,
name|t_List
modifier|*
name|h_NewLst
parameter_list|)
block|{
name|t_CcNodeInformation
modifier|*
name|p_CcNodeInformation
decl_stmt|;
name|t_FmPcdCcTree
modifier|*
name|p_TreePtrOnCurrentMdfNode
init|=
name|NULL
decl_stmt|;
name|t_List
modifier|*
name|p_Pos
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|t_Handle
name|p_AdTableTmp
decl_stmt|,
name|p_AdTableTmp1
decl_stmt|;
name|t_CcNodeInformation
name|ccNodeInfo
decl_stmt|;
name|LIST_FOR_EACH
argument_list|(
argument|p_Pos
argument_list|,
argument|&p_CrntMdfNode->ccTreeIdLst
argument_list|)
block|{
name|p_CcNodeInformation
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|p_Pos
argument_list|)
expr_stmt|;
name|p_TreePtrOnCurrentMdfNode
operator|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|p_CcNodeInformation
operator|->
name|h_CcNode
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_TreePtrOnCurrentMdfNode
argument_list|)
expr_stmt|;
comment|/*search in the trees which exact index points on this current modified node for getting AD         */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_TreePtrOnCurrentMdfNode
operator|->
name|numOfEntries
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_TreePtrOnCurrentMdfNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
block|{
if|if
condition|(
name|p_TreePtrOnCurrentMdfNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
operator|==
operator|(
name|t_Handle
operator|)
name|p_CrntMdfNode
condition|)
block|{
name|p_AdTableTmp
operator|=
name|UINT_TO_PTR
argument_list|(
name|p_TreePtrOnCurrentMdfNode
operator|->
name|ccTreeBaseAddr
operator|+
name|i
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ccNodeInfo
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|ccNodeInfo
operator|.
name|h_CcNode
operator|=
name|p_AdTableTmp
expr_stmt|;
name|EnqueueNodeInfoToRelevantLst
argument_list|(
name|h_OldLst
argument_list|,
operator|&
name|ccNodeInfo
argument_list|)
expr_stmt|;
name|p_AdTableTmp1
operator|=
name|BuildNewAd
argument_list|(
name|p_FmPcdModifyCcKeyAdditionalParams
argument_list|,
name|p_CrntMdfNode
argument_list|,
operator|&
name|p_TreePtrOnCurrentMdfNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ccNodeInfo
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|ccNodeInfo
operator|.
name|h_CcNode
operator|=
name|p_AdTableTmp1
expr_stmt|;
name|EnqueueNodeInfoToRelevantLst
argument_list|(
name|h_NewLst
argument_list|,
operator|&
name|ccNodeInfo
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|ASSERT_COND
argument_list|(
name|i
operator|==
name|p_TreePtrOnCurrentMdfNode
operator|->
name|numOfEntries
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|t_Error
name|ModifyKeyCommonPart1
parameter_list|(
name|t_Handle
name|h_FmPcdCcNodeOrTree
parameter_list|,
name|uint16_t
name|keyIndex
parameter_list|,
name|t_Handle
modifier|*
name|h_Params
parameter_list|,
name|e_ModifyState
name|modifyState
parameter_list|,
name|bool
name|check
parameter_list|,
name|bool
name|tree
parameter_list|)
block|{
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_FmPcdModifyCcKeyAdditionalParams
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|,
name|j
init|=
literal|0
decl_stmt|;
name|bool
name|wasUpdate
init|=
name|FALSE
decl_stmt|;
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
name|NULL
decl_stmt|;
name|t_FmPcdCcTree
modifier|*
name|p_FmPcdCcTree
decl_stmt|;
name|uint16_t
name|numOfKeys
decl_stmt|;
name|t_FmPcdCcNextEngineAndRequiredActionParams
modifier|*
name|p_nextEngineAndRequiredAction
init|=
name|NULL
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcdCcNodeOrTree
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_nextEngineAndRequiredAction
operator|=
name|XX_Malloc
argument_list|(
name|FM_PCD_MAX_NUM_OF_KEYS
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|p_nextEngineAndRequiredAction
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_nextEngineAndRequiredAction
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"failed to allocate memory for p_nextEngineAndRequiredAction"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_nextEngineAndRequiredAction
argument_list|,
literal|0
argument_list|,
name|FM_PCD_MAX_NUM_OF_KEYS
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|p_nextEngineAndRequiredAction
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tree
condition|)
block|{
name|p_FmPcdCcNode
operator|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_FmPcdCcNodeOrTree
expr_stmt|;
name|numOfKeys
operator|=
name|p_FmPcdCcNode
operator|->
name|numOfKeys
expr_stmt|;
comment|/*node has to be pointed by another node or tree*/
if|if
condition|(
operator|!
name|LIST_NumOfObjs
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccPrevNodesLst
argument_list|)
operator|&&
operator|!
name|LIST_NumOfObjs
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreeIdLst
argument_list|)
condition|)
block|{
name|XX_Free
argument_list|(
name|p_nextEngineAndRequiredAction
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"node has to be pointed by node or tree"
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|LIST_NumOfObjs
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreesLst
argument_list|)
operator|||
operator|(
name|LIST_NumOfObjs
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreesLst
argument_list|)
operator|!=
literal|1
operator|)
condition|)
block|{
name|XX_Free
argument_list|(
name|p_nextEngineAndRequiredAction
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"node has to be belonging to some tree and only to one tree"
operator|)
argument_list|)
expr_stmt|;
block|}
name|memcpy
argument_list|(
name|p_nextEngineAndRequiredAction
argument_list|,
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
argument_list|,
name|FM_PCD_MAX_NUM_OF_KEYS
operator|*
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineAndRequiredActionParams
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|check
condition|)
block|{
if|if
condition|(
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|==
name|CC_PC_FF_IPV4TTL
operator|)
operator|||
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|==
name|CC_PC_FF_IPV6HOP_LIMIT
operator|)
operator|||
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|==
name|CC_PC_GENERIC_IC_HASH_INDEXED
operator|)
condition|)
block|{
name|XX_Free
argument_list|(
name|p_nextEngineAndRequiredAction
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"nodeId of CC_PC_FF_IPV4TTL or CC_PC_FF_IPV6HOP_LIMIT can not be used for addKey, removeKey, modifyKey"
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|p_FmPcdCcTree
operator|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_FmPcdCcNodeOrTree
expr_stmt|;
name|numOfKeys
operator|=
name|p_FmPcdCcTree
operator|->
name|numOfEntries
expr_stmt|;
name|memcpy
argument_list|(
name|p_nextEngineAndRequiredAction
argument_list|,
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
argument_list|,
name|FM_PCD_MAX_NUM_OF_KEYS
operator|*
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineAndRequiredActionParams
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|p_FmPcdModifyCcKeyAdditionalParams
operator|=
operator|(
name|t_FmPcdModifyCcKeyAdditionalParams
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_FmPcdModifyCcKeyAdditionalParams
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmPcdModifyCcKeyAdditionalParams
condition|)
block|{
name|XX_Free
argument_list|(
name|p_nextEngineAndRequiredAction
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"Allocation of internal data structure FAILED"
operator|)
argument_list|)
expr_stmt|;
block|}
name|memset
argument_list|(
name|p_FmPcdModifyCcKeyAdditionalParams
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdModifyCcKeyAdditionalParams
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmPcdModifyCcKeyAdditionalParams
operator|->
name|h_CurrentNode
operator|=
name|h_FmPcdCcNodeOrTree
expr_stmt|;
name|p_FmPcdModifyCcKeyAdditionalParams
operator|->
name|keyIndex
operator|=
name|keyIndex
expr_stmt|;
while|while
condition|(
name|i
operator|<
name|numOfKeys
condition|)
block|{
if|if
condition|(
operator|(
name|j
operator|==
name|keyIndex
operator|)
operator|&&
operator|!
name|wasUpdate
condition|)
block|{
if|if
condition|(
name|modifyState
operator|==
name|e_MODIFY_STATE_ADD
condition|)
name|j
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|modifyState
operator|==
name|e_MODIFY_STATE_REMOVE
condition|)
name|i
operator|++
expr_stmt|;
name|wasUpdate
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|memcpy
argument_list|(
operator|&
name|p_FmPcdModifyCcKeyAdditionalParams
operator|->
name|nextEngineAndRequiredAction
index|[
name|j
index|]
argument_list|,
operator|&
name|p_nextEngineAndRequiredAction
index|[
name|i
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineAndRequiredActionParams
argument_list|)
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
name|j
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
name|keyIndex
operator|==
name|numOfKeys
condition|)
block|{
if|if
condition|(
name|modifyState
operator|==
name|e_MODIFY_STATE_ADD
condition|)
name|j
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|modifyState
operator|==
name|e_MODIFY_STATE_REMOVE
condition|)
name|i
operator|++
expr_stmt|;
block|}
name|memcpy
argument_list|(
operator|&
name|p_FmPcdModifyCcKeyAdditionalParams
operator|->
name|nextEngineAndRequiredAction
index|[
name|j
index|]
argument_list|,
operator|&
name|p_nextEngineAndRequiredAction
index|[
name|numOfKeys
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineAndRequiredActionParams
argument_list|)
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_nextEngineAndRequiredAction
argument_list|)
expr_stmt|;
operator|*
name|h_Params
operator|=
name|p_FmPcdModifyCcKeyAdditionalParams
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|UpdatePtrWhichPointOnCrntMdfNode
parameter_list|(
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|,
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_FmPcdModifyCcKeyAdditionalParams
parameter_list|,
name|t_List
modifier|*
name|h_OldLst
parameter_list|,
name|t_List
modifier|*
name|h_NewLst
parameter_list|)
block|{
if|if
condition|(
operator|!
name|LIST_IsEmpty
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccPrevNodesLst
argument_list|)
condition|)
name|UpdateAdPtrOfNodesWhichPointsOnCrntMdfNode
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|p_FmPcdModifyCcKeyAdditionalParams
argument_list|,
name|h_OldLst
argument_list|,
name|h_NewLst
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|LIST_IsEmpty
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreeIdLst
argument_list|)
condition|)
name|UpdateAdPtrOfTreesWhichPointsOnCrntMdfNode
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|p_FmPcdModifyCcKeyAdditionalParams
argument_list|,
name|h_OldLst
argument_list|,
name|h_NewLst
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|FmPcdCcUpdateTreeOwner
parameter_list|(
name|t_FmPcdCcTree
modifier|*
name|p_FmPcdCcTree
parameter_list|,
name|bool
name|add
parameter_list|)
block|{
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcTree
argument_list|)
expr_stmt|;
if|if
condition|(
name|add
condition|)
name|p_FmPcdCcTree
operator|->
name|owners
operator|++
expr_stmt|;
else|else
block|{
name|ASSERT_COND
argument_list|(
name|p_FmPcdCcTree
operator|->
name|owners
argument_list|)
expr_stmt|;
name|p_FmPcdCcTree
operator|->
name|owners
operator|--
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
end_ifdef

begin_function
specifier|static
name|t_Error
name|CheckAndSetManipParamsWithCcNodeParams
parameter_list|(
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|)
block|{
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
condition|)
block|{
name|err
operator|=
name|FmPcdManipCheckParamsWithCcNodeParams
argument_list|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
argument_list|,
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
block|}
block|}
return|return
name|err
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* FM_PCD_CC_MANIP */
end_comment

begin_function
specifier|static
name|t_Error
name|CcUpdateParams
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPort
parameter_list|,
name|t_Handle
name|h_FmTree
parameter_list|,
name|bool
name|validate
parameter_list|)
block|{
name|t_FmPcdCcTree
modifier|*
name|p_CcTree
init|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_FmTree
decl_stmt|;
return|return
name|CcUpdateParam
argument_list|(
name|h_FmPcd
argument_list|,
name|h_FmPort
argument_list|,
name|p_CcTree
operator|->
name|nextEngineAndRequiredAction
argument_list|,
name|p_CcTree
operator|->
name|numOfEntries
argument_list|,
name|UINT_TO_PTR
argument_list|(
name|p_CcTree
operator|->
name|ccTreeBaseAddr
argument_list|)
argument_list|,
name|validate
argument_list|,
literal|0
argument_list|,
name|h_FmTree
argument_list|,
name|FALSE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|CheckParams
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_FmPcdCcNodeParams
modifier|*
name|p_CcNodeParam
parameter_list|,
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|,
name|bool
modifier|*
name|isKeyTblAlloc
parameter_list|)
block|{
name|int
name|tmp
init|=
literal|0
decl_stmt|;
name|t_FmPcdCcKeyParams
modifier|*
name|p_KeyParams
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|uint32_t
name|requiredAction
init|=
literal|0
decl_stmt|;
name|err
operator|=
name|ValidateNextEngineParams
argument_list|(
name|h_FmPcd
argument_list|,
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|ccNextEngineParamsForMiss
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
literal|"For this node MissNextEngineParams are not valid"
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|ccNextEngineParamsForMiss
operator|.
name|h_Manip
condition|)
block|{
name|err
operator|=
name|FmPcdManipCheckParamsForCcNextEgine
argument_list|(
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|ccNextEngineParamsForMiss
argument_list|,
operator|&
name|requiredAction
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|memcpy
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|p_FmPcdCcNode
operator|->
name|numOfKeys
index|]
operator|.
name|nextEngineParams
argument_list|,
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|ccNextEngineParamsForMiss
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineParams
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|p_FmPcdCcNode
operator|->
name|numOfKeys
index|]
operator|.
name|requiredAction
operator|=
name|requiredAction
expr_stmt|;
for|for
control|(
name|tmp
operator|=
literal|0
init|;
name|tmp
operator|<
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|;
name|tmp
operator|++
control|)
block|{
name|p_KeyParams
operator|=
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|keyParams
index|[
name|tmp
index|]
expr_stmt|;
if|if
condition|(
operator|!
name|p_KeyParams
operator|->
name|p_Key
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"p_Key is not initialized"
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|ValidateNextEngineParams
argument_list|(
name|h_FmPcd
argument_list|,
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|UpdateGblMask
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|keySize
argument_list|,
name|p_KeyParams
operator|->
name|p_Mask
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_KeyParams
operator|->
name|ccNextEngineParams
operator|.
name|h_Manip
condition|)
block|{
name|err
operator|=
name|FmPcdManipCheckParamsForCcNextEgine
argument_list|(
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|,
operator|&
name|requiredAction
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|memcpy
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
argument_list|,
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineParams
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|requiredAction
operator|=
name|requiredAction
expr_stmt|;
block|}
operator|*
name|isKeyTblAlloc
operator|=
name|TRUE
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|Ipv4TtlOrIpv6HopLimiCheckParams
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_FmPcdCcNodeParams
modifier|*
name|p_CcNodeParam
parameter_list|,
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|,
name|bool
modifier|*
name|isKeyTblAlloc
parameter_list|)
block|{
name|int
name|tmp
init|=
literal|0
decl_stmt|;
name|t_FmPcdCcKeyParams
modifier|*
name|p_KeyParams
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|uint8_t
name|key
init|=
literal|0x01
decl_stmt|;
name|uint32_t
name|requiredAction
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|!=
literal|1
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"for IPV4TTL and IPV6_HOP_LIMIT has to be only 1 key - TTL = 1, otherwise it's Miss"
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|ValidateNextEngineParams
argument_list|(
name|h_FmPcd
argument_list|,
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|ccNextEngineParamsForMiss
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
literal|"For this node MissNextEngineParams are not valid"
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|ccNextEngineParamsForMiss
operator|.
name|h_Manip
condition|)
block|{
name|err
operator|=
name|FmPcdManipCheckParamsForCcNextEgine
argument_list|(
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|ccNextEngineParamsForMiss
argument_list|,
operator|&
name|requiredAction
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|memcpy
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|p_FmPcdCcNode
operator|->
name|numOfKeys
index|]
operator|.
name|nextEngineParams
argument_list|,
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|ccNextEngineParamsForMiss
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineParams
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|p_FmPcdCcNode
operator|->
name|numOfKeys
index|]
operator|.
name|requiredAction
operator|=
name|requiredAction
expr_stmt|;
for|for
control|(
name|tmp
operator|=
literal|0
init|;
name|tmp
operator|<
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|;
name|tmp
operator|++
control|)
block|{
name|p_KeyParams
operator|=
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|keyParams
index|[
name|tmp
index|]
expr_stmt|;
if|if
condition|(
name|p_KeyParams
operator|->
name|p_Mask
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"If node of the type IPV4_TTL or IPV6_HOP_LIMIT p_Mask can not be initialized"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|p_KeyParams
operator|->
name|p_Key
argument_list|,
operator|&
name|key
argument_list|,
literal|1
argument_list|)
operator|!=
literal|0
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"If node of the type IPV4_TTL or IPV6_HOP_LIMIT p_Key has to be 1"
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|ValidateNextEngineParams
argument_list|(
name|h_FmPcd
argument_list|,
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_KeyParams
operator|->
name|ccNextEngineParams
operator|.
name|h_Manip
condition|)
block|{
name|err
operator|=
name|FmPcdManipCheckParamsForCcNextEgine
argument_list|(
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|,
operator|&
name|requiredAction
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|memcpy
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|nextEngineParams
argument_list|,
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineParams
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|requiredAction
operator|=
name|requiredAction
expr_stmt|;
block|}
operator|*
name|isKeyTblAlloc
operator|=
name|FALSE
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|IcHashIndexedCheckParams
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_FmPcdCcNodeParams
modifier|*
name|p_CcNodeParam
parameter_list|,
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
parameter_list|,
comment|/*uint16_t *ccInfo,*/
comment|/*t_List *ccNextDifferentNodesLst,*/
name|bool
modifier|*
name|isKeyTblAlloc
parameter_list|)
block|{
name|int
name|tmp
init|=
literal|0
decl_stmt|,
name|countOnes
init|=
literal|0
decl_stmt|;
name|t_FmPcdCcKeyParams
modifier|*
name|p_KeyParams
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|uint16_t
name|glblMask
init|=
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|icIndxMask
decl_stmt|;
name|uint16_t
name|countMask
init|=
call|(
name|uint16_t
call|)
argument_list|(
name|glblMask
operator|>>
literal|4
argument_list|)
decl_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
name|uint32_t
name|requiredAction
decl_stmt|;
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
if|if
condition|(
name|glblMask
operator|&
literal|0x000f
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"icIndxMask has to be with last nibble 0"
operator|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|countMask
condition|)
block|{
name|countOnes
operator|++
expr_stmt|;
name|countMask
operator|=
call|(
name|uint16_t
call|)
argument_list|(
name|countMask
operator|>>
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|POWER_OF_2
argument_list|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
argument_list|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"For Node of the type INDEXED numOfKeys has to be powerOfTwo"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|!=
operator|(
operator|(
name|uint32_t
operator|)
literal|1
operator|<<
name|countOnes
operator|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"For Node of the type IC_HASH_INDEXED numOfKeys has to be powerOfTwo"
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|ValidateNextEngineParams
argument_list|(
name|h_FmPcd
argument_list|,
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|ccNextEngineParamsForMiss
argument_list|)
expr_stmt|;
if|if
condition|(
name|GET_ERROR_TYPE
argument_list|(
name|err
argument_list|)
operator|!=
name|E_NOT_SUPPORTED
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
literal|"MissNextEngineParams for the node of the type IC_INDEX_HASH has to be UnInitialized"
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|tmp
operator|=
literal|0
init|;
name|tmp
operator|<
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|;
name|tmp
operator|++
control|)
block|{
name|p_KeyParams
operator|=
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|keyParams
index|[
name|tmp
index|]
expr_stmt|;
if|if
condition|(
name|p_KeyParams
operator|->
name|p_Mask
operator|||
name|p_KeyParams
operator|->
name|p_Key
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"For Node of the type IC_HASH_INDEXED p_Key or p_Mask has to be NULL"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|glblMask
operator|&
operator|(
name|tmp
operator|*
literal|16
operator|)
operator|)
operator|==
operator|(
name|tmp
operator|*
literal|16
operator|)
condition|)
block|{
name|err
operator|=
name|ValidateNextEngineParams
argument_list|(
name|h_FmPcd
argument_list|,
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
literal|"This index has to be initialized for the node of the type IC_INDEX_HASH according to settings of GlobalMask "
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_KeyParams
operator|->
name|ccNextEngineParams
operator|.
name|h_Manip
condition|)
block|{
name|err
operator|=
name|FmPcdManipCheckParamsForCcNextEgine
argument_list|(
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|,
operator|&
name|requiredAction
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
block|}
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|requiredAction
operator|=
name|requiredAction
expr_stmt|;
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|memcpy
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|nextEngineParams
argument_list|,
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineParams
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|err
operator|=
name|ValidateNextEngineParams
argument_list|(
name|h_FmPcd
argument_list|,
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|GET_ERROR_TYPE
argument_list|(
name|err
argument_list|)
operator|!=
name|E_NOT_SUPPORTED
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
literal|"This index has to be UnInitialized for the node of the type IC_INDEX_HASH according to settings of GlobalMask"
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
operator|*
name|isKeyTblAlloc
operator|=
name|FALSE
expr_stmt|;
name|memcpy
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|,
literal|2
argument_list|)
argument_list|,
operator|&
name|glblMask
argument_list|,
literal|2
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcModifyNextEngineParamTree
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPcdCcTree
parameter_list|,
name|uint8_t
name|grpId
parameter_list|,
name|uint8_t
name|index
parameter_list|,
name|t_FmPcdCcNextEngineParams
modifier|*
name|p_FmPcdCcNextEngineParams
parameter_list|,
name|t_List
modifier|*
name|h_OldLst
parameter_list|,
name|t_List
modifier|*
name|h_NewLst
parameter_list|,
name|t_Handle
modifier|*
name|h_AdditionalParams
parameter_list|)
block|{
name|t_FmPcdCcTree
modifier|*
name|p_FmPcdCcTree
init|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_FmPcdCcTree
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|uint16_t
name|keyIndex
decl_stmt|;
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_ModifyKeyParams
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
operator|(
name|grpId
operator|<=
literal|7
operator|)
argument_list|,
name|E_INVALID_VALUE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcdCcTree
argument_list|,
name|E_INVALID_VALUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|grpId
operator|>=
name|p_FmPcdCcTree
operator|->
name|numOfGrps
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
operator|(
literal|"grpId you asked> numOfGroup of relevant tree"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
operator|>=
name|p_FmPcdCcTree
operator|->
name|fmPcdGroupParam
index|[
name|grpId
index|]
operator|.
name|numOfEntriesInGroup
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
operator|(
literal|"index> numOfEntriesInGroup"
operator|)
argument_list|)
expr_stmt|;
name|keyIndex
operator|=
call|(
name|uint16_t
call|)
argument_list|(
name|p_FmPcdCcTree
operator|->
name|fmPcdGroupParam
index|[
name|grpId
index|]
operator|.
name|baseGroupEntry
operator|+
name|index
argument_list|)
expr_stmt|;
name|err
operator|=
name|ModifyKeyCommonPart1
argument_list|(
name|h_FmPcdCcTree
argument_list|,
name|keyIndex
argument_list|,
name|h_AdditionalParams
argument_list|,
name|e_MODIFY_STATE_CHANGE
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|p_ModifyKeyParams
operator|=
operator|(
name|t_FmPcdModifyCcKeyAdditionalParams
operator|*
operator|)
operator|*
name|h_AdditionalParams
expr_stmt|;
name|p_ModifyKeyParams
operator|->
name|tree
operator|=
name|TRUE
expr_stmt|;
name|err
operator|=
name|BuildNewNodeModifyNextEngine
argument_list|(
name|h_FmPcd
argument_list|,
name|h_FmPcdCcTree
argument_list|,
name|keyIndex
argument_list|,
name|p_FmPcdCcNextEngineParams
argument_list|,
name|h_OldLst
argument_list|,
name|h_NewLst
argument_list|,
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|XX_Free
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcRemoveKey
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPcdCcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|t_List
modifier|*
name|h_OldLst
parameter_list|,
name|t_List
modifier|*
name|h_NewLst
parameter_list|,
name|t_Handle
modifier|*
name|h_AdditionalParams
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_FmPcdCcNode
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_ModifyKeyParams
decl_stmt|;
if|if
condition|(
name|keyIndex
operator|>=
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
operator|(
literal|"impossible to remove key when numOfKeys<= keyIndex"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
operator|(
literal|"keyIndex you asked> numOfKeys of relevant node that was initialized"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
operator|!=
name|h_FmPcd
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"handler to FmPcd is diferent from one which was assigned to the node in the Init time"
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|ModifyKeyCommonPart1
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|h_AdditionalParams
argument_list|,
name|e_MODIFY_STATE_REMOVE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|p_ModifyKeyParams
operator|=
operator|(
name|t_FmPcdModifyCcKeyAdditionalParams
operator|*
operator|)
operator|*
name|h_AdditionalParams
expr_stmt|;
name|err
operator|=
name|BuildNewNodeRemoveKey
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|XX_Free
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|UpdatePtrWhichPointOnCrntMdfNode
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|p_ModifyKeyParams
argument_list|,
name|h_OldLst
argument_list|,
name|h_NewLst
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|ReleaseNewNodeCommonPart
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcModifyKey
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPcdCcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|uint8_t
name|keySize
parameter_list|,
name|uint8_t
modifier|*
name|p_Key
parameter_list|,
name|uint8_t
modifier|*
name|p_Mask
parameter_list|,
name|t_List
modifier|*
name|h_OldLst
parameter_list|,
name|t_List
modifier|*
name|h_NewLst
parameter_list|,
name|t_Handle
modifier|*
name|h_AdditionalParams
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_FmPcdCcNode
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_ModifyKeyParams
decl_stmt|;
if|if
condition|(
name|keyIndex
operator|>=
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"keyIndex> previousely cleared last index + 1"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
operator|>
name|FM_PCD_MAX_NUM_OF_CC_NODES
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"numOfKeys with new key can not be larger than 255"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|keySize
operator|!=
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"size for ModifyKey has to be the same as defined in SetNode"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
operator|!=
name|h_FmPcd
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"handler to FmPcd is diferent from one which was assigned to the node in the Init time"
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|ModifyKeyCommonPart1
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|h_AdditionalParams
argument_list|,
name|e_MODIFY_STATE_CHANGE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|p_ModifyKeyParams
operator|=
operator|(
name|t_FmPcdModifyCcKeyAdditionalParams
operator|*
operator|)
operator|*
name|h_AdditionalParams
expr_stmt|;
name|err
operator|=
name|BuildNewNodeModifyKey
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|p_Key
argument_list|,
name|p_Mask
argument_list|,
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|XX_Free
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|UpdatePtrWhichPointOnCrntMdfNode
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|p_ModifyKeyParams
argument_list|,
name|h_OldLst
argument_list|,
name|h_NewLst
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|ReleaseNewNodeCommonPart
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcModiyNextEngineParamNode
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPcdCcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|t_FmPcdCcNextEngineParams
modifier|*
name|p_FmPcdCcNextEngineParams
parameter_list|,
name|t_List
modifier|*
name|h_OldPointer
parameter_list|,
name|t_List
modifier|*
name|h_NewPointer
parameter_list|,
name|t_Handle
modifier|*
name|h_AdditionalParams
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_FmPcdCcNode
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_ModifyKeyParams
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_VALUE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
if|if
condition|(
name|keyIndex
operator|>=
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"keyIndex> previousely cleared last index + 1"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
operator|>
name|FM_PCD_MAX_NUM_OF_CC_NODES
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"numOfKeys with new key can not be larger than 255"
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|ModifyKeyCommonPart1
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|h_AdditionalParams
argument_list|,
name|e_MODIFY_STATE_CHANGE
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|p_ModifyKeyParams
operator|=
operator|(
name|t_FmPcdModifyCcKeyAdditionalParams
operator|*
operator|)
operator|*
name|h_AdditionalParams
expr_stmt|;
name|err
operator|=
name|BuildNewNodeModifyNextEngine
argument_list|(
name|h_FmPcd
argument_list|,
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|p_FmPcdCcNextEngineParams
argument_list|,
name|h_OldPointer
argument_list|,
name|h_NewPointer
argument_list|,
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|XX_Free
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcModifyMissNextEngineParamNode
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPcdCcNode
parameter_list|,
name|t_FmPcdCcNextEngineParams
modifier|*
name|p_FmPcdCcNextEngineParams
parameter_list|,
name|t_List
modifier|*
name|h_OldPointer
parameter_list|,
name|t_List
modifier|*
name|h_NewPointer
parameter_list|,
name|t_Handle
modifier|*
name|h_AdditionalParams
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_FmPcdCcNode
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|uint16_t
name|keyIndex
decl_stmt|;
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_ModifyKeyParams
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|E_INVALID_VALUE
argument_list|)
expr_stmt|;
name|keyIndex
operator|=
name|p_FmPcdCcNode
operator|->
name|numOfKeys
expr_stmt|;
name|err
operator|=
name|ModifyKeyCommonPart1
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|h_AdditionalParams
argument_list|,
name|e_MODIFY_STATE_CHANGE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|p_ModifyKeyParams
operator|=
operator|(
name|t_FmPcdModifyCcKeyAdditionalParams
operator|*
operator|)
operator|*
name|h_AdditionalParams
expr_stmt|;
name|err
operator|=
name|BuildNewNodeModifyNextEngine
argument_list|(
name|h_FmPcd
argument_list|,
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|p_FmPcdCcNextEngineParams
argument_list|,
name|h_OldPointer
argument_list|,
name|h_NewPointer
argument_list|,
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|XX_Free
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcAddKey
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPcdCcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|uint8_t
name|keySize
parameter_list|,
name|t_FmPcdCcKeyParams
modifier|*
name|p_FmPcdCcKeyParams
parameter_list|,
name|t_List
modifier|*
name|h_OldLst
parameter_list|,
name|t_List
modifier|*
name|h_NewLst
parameter_list|,
name|t_Handle
modifier|*
name|h_AdditionalParams
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_FmPcdCcNode
decl_stmt|;
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_ModifyKeyParams
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
if|if
condition|(
name|keyIndex
operator|>
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"keyIndex> previousely cleared last index + 1"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
operator|>
name|FM_PCD_MAX_NUM_OF_CC_NODES
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"numOfKeys with new key can not be larger than 255"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|keySize
operator|!=
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"keySize has to be defined as it was defined in initialization step."
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
operator|!=
name|h_FmPcd
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"handler to FmPcd is diferent from one which was assigned to the node in the Init time"
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|ModifyKeyCommonPart1
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|h_AdditionalParams
argument_list|,
name|e_MODIFY_STATE_ADD
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|p_ModifyKeyParams
operator|=
operator|(
name|t_FmPcdModifyCcKeyAdditionalParams
operator|*
operator|)
operator|*
name|h_AdditionalParams
expr_stmt|;
name|err
operator|=
name|BuildNewNodeAddOrMdfyKeyAndNextEngine
argument_list|(
name|h_FmPcd
argument_list|,
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|p_FmPcdCcKeyParams
argument_list|,
name|p_ModifyKeyParams
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|XX_Free
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|UpdatePtrWhichPointOnCrntMdfNode
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|p_ModifyKeyParams
argument_list|,
name|h_OldLst
argument_list|,
name|h_NewLst
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|ReleaseNewNodeCommonPart
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcModifyKeyAndNextEngine
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPcdCcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|uint8_t
name|keySize
parameter_list|,
name|t_FmPcdCcKeyParams
modifier|*
name|p_FmPcdCcKeyParams
parameter_list|,
name|t_List
modifier|*
name|h_OldLst
parameter_list|,
name|t_List
modifier|*
name|h_NewLst
parameter_list|,
name|t_Handle
modifier|*
name|h_AdditionalParams
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_FmPcdCcNode
decl_stmt|;
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_ModifyKeyParams
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
if|if
condition|(
name|keyIndex
operator|>
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"keyIndex> previousely cleared last index + 1"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
operator|>
name|FM_PCD_MAX_NUM_OF_CC_NODES
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"numOfKeys with new key can not be larger than 255"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|keySize
operator|!=
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"keySize has to be defined as it was defined in initialization step"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
operator|!=
name|h_FmPcd
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"handler to FmPcd is diferent from one which was assigned to the node in the Init time"
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|ModifyKeyCommonPart1
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|h_AdditionalParams
argument_list|,
name|e_MODIFY_STATE_CHANGE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|p_ModifyKeyParams
operator|=
operator|(
name|t_FmPcdModifyCcKeyAdditionalParams
operator|*
operator|)
operator|*
name|h_AdditionalParams
expr_stmt|;
name|err
operator|=
name|BuildNewNodeAddOrMdfyKeyAndNextEngine
argument_list|(
name|h_FmPcd
argument_list|,
name|p_FmPcdCcNode
argument_list|,
name|keyIndex
argument_list|,
name|p_FmPcdCcKeyParams
argument_list|,
name|p_ModifyKeyParams
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|ReleaseNewNodeCommonPart
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|UpdatePtrWhichPointOnCrntMdfNode
argument_list|(
name|p_FmPcdCcNode
argument_list|,
name|p_ModifyKeyParams
argument_list|,
name|h_OldLst
argument_list|,
name|h_NewLst
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|ReleaseNewNodeCommonPart
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_ModifyKeyParams
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcReleaseModifiedDataStructure
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_List
modifier|*
name|h_FmPcdOldPointersLst
parameter_list|,
name|t_List
modifier|*
name|h_FmPcdNewPointersLst
parameter_list|,
name|uint16_t
name|numOfGoodChanges
parameter_list|,
name|t_Handle
modifier|*
name|h_Params
parameter_list|)
block|{
name|t_FmPcdModifyCcKeyAdditionalParams
modifier|*
name|p_CcNewModifyAdditionalParams
init|=
operator|(
name|t_FmPcdModifyCcKeyAdditionalParams
operator|*
operator|)
operator|*
name|h_Params
decl_stmt|;
name|t_List
modifier|*
name|p_Pos
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_CcNodeInformation
name|ccNodeInfo
decl_stmt|,
modifier|*
name|p_CcNodeInformation
decl_stmt|;
name|t_Handle
name|h_Muram
decl_stmt|;
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNextNode
decl_stmt|;
name|t_List
modifier|*
name|p_UpdateLst
decl_stmt|;
name|UNUSED
argument_list|(
name|numOfGoodChanges
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcdOldPointersLst
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcdNewPointersLst
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
operator|(
name|numOfGoodChanges
operator|==
name|LIST_NumOfObjs
argument_list|(
name|h_FmPcdOldPointersLst
argument_list|)
operator|)
argument_list|,
name|E_INVALID_STATE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
operator|(
name|numOfGoodChanges
operator|==
name|LIST_NumOfObjs
argument_list|(
name|h_FmPcdNewPointersLst
argument_list|)
operator|)
argument_list|,
name|E_INVALID_STATE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
operator|(
name|LIST_NumOfObjs
argument_list|(
name|h_FmPcdOldPointersLst
argument_list|)
operator|==
name|LIST_NumOfObjs
argument_list|(
name|h_FmPcdNewPointersLst
argument_list|)
operator|)
argument_list|,
name|E_INVALID_STATE
argument_list|)
expr_stmt|;
comment|/*we don't update subtree of the new node with new tree because it was done in the previose stage*/
if|if
condition|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_NodeForAdd
condition|)
block|{
name|p_FmPcdCcNextNode
operator|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|p_CcNewModifyAdditionalParams
operator|->
name|h_NodeForAdd
expr_stmt|;
if|if
condition|(
operator|!
name|p_CcNewModifyAdditionalParams
operator|->
name|tree
condition|)
name|p_UpdateLst
operator|=
operator|&
name|p_FmPcdCcNextNode
operator|->
name|ccPrevNodesLst
expr_stmt|;
else|else
name|p_UpdateLst
operator|=
operator|&
name|p_FmPcdCcNextNode
operator|->
name|ccTreeIdLst
expr_stmt|;
name|p_CcNodeInformation
operator|=
name|FindNodeInfoInReleventLst
argument_list|(
name|p_UpdateLst
argument_list|,
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_CcNodeInformation
condition|)
name|p_CcNodeInformation
operator|->
name|index
operator|++
expr_stmt|;
else|else
block|{
name|memset
argument_list|(
operator|&
name|ccNodeInfo
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|ccNodeInfo
operator|.
name|h_CcNode
operator|=
operator|(
name|t_Handle
operator|)
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
expr_stmt|;
name|ccNodeInfo
operator|.
name|index
operator|=
literal|1
expr_stmt|;
name|EnqueueNodeInfoToRelevantLst
argument_list|(
name|p_UpdateLst
argument_list|,
operator|&
name|ccNodeInfo
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_NodeForRmv
condition|)
block|{
name|p_FmPcdCcNextNode
operator|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|p_CcNewModifyAdditionalParams
operator|->
name|h_NodeForRmv
expr_stmt|;
if|if
condition|(
operator|!
name|p_CcNewModifyAdditionalParams
operator|->
name|tree
condition|)
block|{
name|p_UpdateLst
operator|=
operator|&
name|p_FmPcdCcNextNode
operator|->
name|ccPrevNodesLst
expr_stmt|;
name|LIST_FOR_EACH
argument_list|(
argument|p_Pos
argument_list|,
argument|&p_FmPcdCcNextNode->ccTreesLst
argument_list|)
block|{
name|p_CcNodeInformation
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|p_Pos
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcNodeInformation
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
name|err
operator|=
name|FmPcdCcSetRequiredAction
argument_list|(
name|h_FmPcd
argument_list|,
name|UPDATE_CC_WITH_DELETE_TREE
argument_list|,
operator|&
operator|(
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
operator|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|nextEngineAndRequiredAction
index|[
name|p_CcNewModifyAdditionalParams
operator|->
name|keyIndex
index|]
argument_list|,
name|PTR_MOVE
argument_list|(
operator|(
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
operator|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|h_AdTable
argument_list|,
name|p_CcNewModifyAdditionalParams
operator|->
name|keyIndex
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
argument_list|,
literal|1
argument_list|,
name|p_CcNodeInformation
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|p_UpdateLst
operator|=
operator|&
name|p_FmPcdCcNextNode
operator|->
name|ccTreeIdLst
expr_stmt|;
name|err
operator|=
name|FmPcdCcSetRequiredAction
argument_list|(
name|h_FmPcd
argument_list|,
name|UPDATE_CC_WITH_DELETE_TREE
argument_list|,
operator|&
operator|(
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
operator|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|nextEngineAndRequiredAction
index|[
name|p_CcNewModifyAdditionalParams
operator|->
name|keyIndex
index|]
argument_list|,
name|UINT_TO_PTR
argument_list|(
operator|(
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
operator|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|ccTreeBaseAddr
operator|+
name|p_CcNewModifyAdditionalParams
operator|->
name|keyIndex
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
argument_list|,
literal|1
argument_list|,
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|err
condition|)
return|return
name|err
return|;
comment|/*we remove from the  subtree of the removed node tree because it wasn't done in the previose stage*/
comment|/*update ccPrevNodesLst or ccTreeIdLst of the removed node*/
comment|/*update of the nodeOwner*/
name|p_CcNodeInformation
operator|=
name|FindNodeInfoInReleventLst
argument_list|(
name|p_UpdateLst
argument_list|,
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcNodeInformation
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcNodeInformation
operator|->
name|index
argument_list|)
expr_stmt|;
name|p_CcNodeInformation
operator|->
name|index
operator|--
expr_stmt|;
if|if
condition|(
name|p_CcNodeInformation
operator|->
name|index
operator|==
literal|0
condition|)
name|DequeueNodeInfoFromRelevantLst
argument_list|(
name|p_UpdateLst
argument_list|,
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|LIST_NumOfObjs
argument_list|(
operator|&
name|p_FmPcdCcNextNode
operator|->
name|ccTreesLst
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|UpdateNodeOwner
argument_list|(
name|p_FmPcdCcNextNode
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_ManipForRmv
condition|)
name|FmPcdManipUpdateOwner
argument_list|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_ManipForRmv
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|h_Muram
operator|=
name|FmPcdGetMuramHandle
argument_list|(
name|h_FmPcd
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|h_Muram
argument_list|)
expr_stmt|;
comment|/*we release new AD which was allocated and updated for copy from to actual AD*/
name|LIST_FOR_EACH
argument_list|(
argument|p_Pos
argument_list|,
argument|h_FmPcdNewPointersLst
argument_list|)
block|{
name|p_CcNodeInformation
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|p_Pos
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcNodeInformation
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
name|FM_MURAM_FreeMem
argument_list|(
name|h_Muram
argument_list|,
name|p_CcNodeInformation
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
block|}
comment|/*free Old data structure if it has to be freed - new data structure was allocated*/
if|if
condition|(
name|p_CcNewModifyAdditionalParams
operator|->
name|p_AdTableOld
condition|)
name|FM_MURAM_FreeMem
argument_list|(
name|h_Muram
argument_list|,
name|p_CcNewModifyAdditionalParams
operator|->
name|p_AdTableOld
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_CcNewModifyAdditionalParams
operator|->
name|p_KeysMatchTableOld
condition|)
name|FM_MURAM_FreeMem
argument_list|(
name|h_Muram
argument_list|,
name|p_CcNewModifyAdditionalParams
operator|->
name|p_KeysMatchTableOld
argument_list|)
expr_stmt|;
comment|/*update current modified node with changed fields if it's required*/
if|if
condition|(
operator|!
name|p_CcNewModifyAdditionalParams
operator|->
name|tree
condition|)
block|{
if|if
condition|(
name|p_CcNewModifyAdditionalParams
operator|->
name|p_AdTableNew
condition|)
operator|(
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
operator|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|h_AdTable
operator|=
name|p_CcNewModifyAdditionalParams
operator|->
name|p_AdTableNew
expr_stmt|;
if|if
condition|(
name|p_CcNewModifyAdditionalParams
operator|->
name|numOfKeys
condition|)
operator|(
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
operator|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|numOfKeys
operator|=
name|p_CcNewModifyAdditionalParams
operator|->
name|numOfKeys
expr_stmt|;
if|if
condition|(
name|p_CcNewModifyAdditionalParams
operator|->
name|p_KeysMatchTableNew
condition|)
operator|(
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
operator|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|h_KeysMatchTable
operator|=
name|p_CcNewModifyAdditionalParams
operator|->
name|p_KeysMatchTableNew
expr_stmt|;
name|memcpy
argument_list|(
operator|(
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
operator|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|nextEngineAndRequiredAction
argument_list|,
operator|&
name|p_CcNewModifyAdditionalParams
operator|->
name|nextEngineAndRequiredAction
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineAndRequiredActionParams
argument_list|)
operator|*
operator|(
name|FM_PCD_MAX_NUM_OF_KEYS
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
name|memcpy
argument_list|(
operator|&
operator|(
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
operator|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|nextEngineAndRequiredAction
argument_list|,
operator|&
name|p_CcNewModifyAdditionalParams
operator|->
name|nextEngineAndRequiredAction
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineAndRequiredActionParams
argument_list|)
operator|*
operator|(
operator|(
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
operator|(
name|p_CcNewModifyAdditionalParams
operator|->
name|h_CurrentNode
operator|)
operator|)
operator|->
name|numOfEntries
operator|)
argument_list|)
expr_stmt|;
name|ReleaseLst
argument_list|(
name|h_FmPcdOldPointersLst
argument_list|)
expr_stmt|;
name|ReleaseLst
argument_list|(
name|h_FmPcdNewPointersLst
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_CcNewModifyAdditionalParams
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|uint32_t
name|FmPcdCcGetNodeAddrOffsetFromNodeInfo
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_Pointer
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|t_CcNodeInformation
modifier|*
name|p_CcNodeInfo
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
operator|(
name|uint32_t
operator|)
name|ILLEGAL_BASE
argument_list|)
expr_stmt|;
name|p_CcNodeInfo
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|h_Pointer
argument_list|)
expr_stmt|;
return|return
call|(
name|uint32_t
call|)
argument_list|(
name|XX_VirtToPhys
argument_list|(
name|p_CcNodeInfo
operator|->
name|h_CcNode
argument_list|)
operator|-
name|p_FmPcd
operator|->
name|physicalMuramBase
argument_list|)
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcGetGrpParams
parameter_list|(
name|t_Handle
name|h_FmPcdCcTree
parameter_list|,
name|uint8_t
name|grpId
parameter_list|,
name|uint32_t
modifier|*
name|p_GrpBits
parameter_list|,
name|uint8_t
modifier|*
name|p_GrpBase
parameter_list|)
block|{
name|t_FmPcdCcTree
modifier|*
name|p_FmPcdCcTree
init|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_FmPcdCcTree
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcdCcTree
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
if|if
condition|(
name|grpId
operator|>=
name|p_FmPcdCcTree
operator|->
name|numOfGrps
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
operator|(
literal|"grpId you asked> numOfGroup of relevant tree"
operator|)
argument_list|)
expr_stmt|;
operator|*
name|p_GrpBits
operator|=
name|p_FmPcdCcTree
operator|->
name|fmPcdGroupParam
index|[
name|grpId
index|]
operator|.
name|totalBitsMask
expr_stmt|;
operator|*
name|p_GrpBase
operator|=
name|p_FmPcdCcTree
operator|->
name|fmPcdGroupParam
index|[
name|grpId
index|]
operator|.
name|baseGroupEntry
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcBindTree
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPcdCcTree
parameter_list|,
name|uint32_t
modifier|*
name|p_Offset
parameter_list|,
name|t_Handle
name|h_FmPort
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|t_FmPcdCcTree
modifier|*
name|p_FmPcdCcTree
init|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_FmPcdCcTree
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|E_INVALID_STATE
argument_list|)
expr_stmt|;
name|FmPcdCcUpdateTreeOwner
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
operator|*
name|p_Offset
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|XX_VirtToPhys
argument_list|(
name|UINT_TO_PTR
argument_list|(
name|p_FmPcdCcTree
operator|->
name|ccTreeBaseAddr
argument_list|)
argument_list|)
operator|-
name|p_FmPcd
operator|->
name|physicalMuramBase
argument_list|)
expr_stmt|;
name|err
operator|=
name|CcUpdateParams
argument_list|(
name|h_FmPcd
argument_list|,
name|h_FmPort
argument_list|,
name|h_FmPcdCcTree
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcUnbindTree
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPcdCcTree
parameter_list|)
block|{
name|t_FmPcdCcTree
modifier|*
name|p_FmPcdCcTree
init|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_FmPcdCcTree
decl_stmt|;
name|UNUSED
argument_list|(
name|h_FmPcd
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|FmPcdCcUpdateTreeOwner
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcTreeTryLock
parameter_list|(
name|t_Handle
name|h_FmPcdCcTree
parameter_list|)
block|{
if|if
condition|(
name|TRY_LOCK
argument_list|(
name|NULL
argument_list|,
operator|&
operator|(
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_FmPcdCcTree
operator|)
operator|->
name|lock
argument_list|)
condition|)
return|return
name|E_OK
return|;
return|return
name|ERROR_CODE
argument_list|(
name|E_BUSY
argument_list|)
return|;
block|}
end_function

begin_function
name|t_Error
name|FmPcdCcNodeTreeTryLock
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_FmPcdCcNode
parameter_list|,
name|t_List
modifier|*
name|p_List
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_FmPcdCcNode
decl_stmt|;
name|t_List
modifier|*
name|p_Pos
decl_stmt|;
name|t_CcNodeInformation
modifier|*
name|p_CcNodeInfo
decl_stmt|,
name|nodeInfo
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|UNUSED
argument_list|(
name|h_FmPcd
argument_list|)
expr_stmt|;
if|if
condition|(
name|LIST_IsEmpty
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreesLst
argument_list|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_AVAILABLE
argument_list|,
operator|(
literal|"asked for more nodes in CC than MAX"
operator|)
argument_list|)
expr_stmt|;
name|LIST_FOR_EACH
argument_list|(
argument|p_Pos
argument_list|,
argument|&p_FmPcdCcNode->ccTreesLst
argument_list|)
block|{
name|p_CcNodeInfo
operator|=
name|CC_NODE_F_OBJECT
argument_list|(
name|p_Pos
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcNodeInfo
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
name|err
operator|=
name|FmPcdCcTreeTryLock
argument_list|(
name|p_CcNodeInfo
operator|->
name|h_CcNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|==
name|E_OK
condition|)
block|{
name|memset
argument_list|(
operator|&
name|nodeInfo
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|nodeInfo
operator|.
name|h_CcNode
operator|=
name|p_CcNodeInfo
operator|->
name|h_CcNode
expr_stmt|;
name|EnqueueNodeInfoToRelevantLst
argument_list|(
name|p_List
argument_list|,
operator|&
name|nodeInfo
argument_list|)
expr_stmt|;
block|}
else|else
name|FmPcdCcNodeTreeReleaseLock
argument_list|(
name|p_List
argument_list|)
expr_stmt|;
block|}
return|return
name|err
return|;
block|}
end_function

begin_function
name|t_Handle
name|FM_PCD_CcBuildTree
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_FmPcdCcTreeParams
modifier|*
name|p_PcdGroupsParam
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|,
name|j
init|=
literal|0
decl_stmt|,
name|k
init|=
literal|0
decl_stmt|;
name|t_FmPcdCcTree
modifier|*
name|p_FmPcdCcTree
decl_stmt|;
name|uint8_t
name|numOfEntries
decl_stmt|;
name|t_Handle
name|p_CcTreeTmp
decl_stmt|;
name|t_FmPcdCcGrpParams
modifier|*
name|p_FmPcdCcGroupParams
decl_stmt|;
name|t_FmPcdCcNextEngineAndRequiredActionParams
name|params
index|[
literal|16
index|]
decl_stmt|;
name|t_NetEnvParams
name|netEnvParams
decl_stmt|;
name|uint8_t
name|lastOne
init|=
literal|0
decl_stmt|;
name|uint32_t
name|requiredAction
init|=
literal|0
decl_stmt|;
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNextNode
decl_stmt|;
name|t_CcNodeInformation
name|ccNodeInfo
decl_stmt|,
modifier|*
name|p_CcInformation
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|p_PcdGroupsParam
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_PcdGroupsParam
operator|->
name|numOfGrps
operator|>
name|FM_PCD_MAX_NUM_OF_CC_GROUPS
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"numOfGrps should not exceed %d"
operator|,
name|FM_PCD_MAX_NUM_OF_CC_GROUPS
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|p_FmPcdCcTree
operator|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_FmPcdCcTree
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmPcdCcTree
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"PCD tree structure"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|memset
argument_list|(
name|p_FmPcdCcTree
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcTree
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|params
argument_list|,
literal|0
argument_list|,
literal|16
operator|*
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineParams
argument_list|)
argument_list|)
expr_stmt|;
name|INIT_LIST
argument_list|(
operator|&
name|p_FmPcdCcTree
operator|->
name|fmPortsLst
argument_list|)
expr_stmt|;
name|numOfEntries
operator|=
literal|0
expr_stmt|;
name|p_FmPcdCcTree
operator|->
name|netEnvId
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|PTR_TO_UINT
argument_list|(
name|p_PcdGroupsParam
operator|->
name|h_NetEnv
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_PcdGroupsParam
operator|->
name|numOfGrps
condition|;
name|i
operator|++
control|)
block|{
name|p_FmPcdCcGroupParams
operator|=
operator|&
name|p_PcdGroupsParam
operator|->
name|ccGrpParams
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcGroupParams
operator|->
name|numOfDistinctionUnits
operator|>
name|FM_PCD_MAX_NUM_OF_CC_UNITS
condition|)
block|{
name|DeleteTree
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"numOfDistinctionUnits (group %d) should not exceed %d"
operator|,
name|i
operator|,
name|FM_PCD_MAX_NUM_OF_CC_UNITS
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|p_FmPcdCcTree
operator|->
name|fmPcdGroupParam
index|[
name|i
index|]
operator|.
name|baseGroupEntry
operator|=
name|numOfEntries
expr_stmt|;
name|p_FmPcdCcTree
operator|->
name|fmPcdGroupParam
index|[
name|i
index|]
operator|.
name|numOfEntriesInGroup
operator|=
call|(
name|uint8_t
call|)
argument_list|(
literal|0x01
operator|<<
name|p_FmPcdCcGroupParams
operator|->
name|numOfDistinctionUnits
argument_list|)
expr_stmt|;
name|numOfEntries
operator|+=
name|p_FmPcdCcTree
operator|->
name|fmPcdGroupParam
index|[
name|i
index|]
operator|.
name|numOfEntriesInGroup
expr_stmt|;
if|if
condition|(
name|numOfEntries
operator|>
literal|16
condition|)
block|{
name|DeleteTree
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"numOfEntries can not be larger than 16"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|lastOne
condition|)
block|{
if|if
condition|(
name|p_FmPcdCcTree
operator|->
name|fmPcdGroupParam
index|[
name|i
index|]
operator|.
name|numOfEntriesInGroup
operator|>
name|lastOne
condition|)
block|{
name|DeleteTree
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_CONFLICT
argument_list|,
operator|(
literal|"numOfEntries per group must be set in descending order"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
name|lastOne
operator|=
name|p_FmPcdCcTree
operator|->
name|fmPcdGroupParam
index|[
name|i
index|]
operator|.
name|numOfEntriesInGroup
expr_stmt|;
name|netEnvParams
operator|.
name|netEnvId
operator|=
name|p_FmPcdCcTree
operator|->
name|netEnvId
expr_stmt|;
name|netEnvParams
operator|.
name|numOfDistinctionUnits
operator|=
name|p_FmPcdCcGroupParams
operator|->
name|numOfDistinctionUnits
expr_stmt|;
name|memcpy
argument_list|(
name|netEnvParams
operator|.
name|unitIds
argument_list|,
operator|&
name|p_FmPcdCcGroupParams
operator|->
name|unitIds
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
operator|)
operator|*
name|p_FmPcdCcGroupParams
operator|->
name|numOfDistinctionUnits
argument_list|)
expr_stmt|;
name|err
operator|=
name|PcdGetUnitsVector
argument_list|(
name|p_FmPcd
argument_list|,
operator|&
name|netEnvParams
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|DeleteTree
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|p_FmPcdCcTree
operator|->
name|fmPcdGroupParam
index|[
name|i
index|]
operator|.
name|totalBitsMask
operator|=
name|netEnvParams
operator|.
name|vector
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|p_FmPcdCcTree
operator|->
name|fmPcdGroupParam
index|[
name|i
index|]
operator|.
name|numOfEntriesInGroup
condition|;
name|j
operator|++
control|)
block|{
name|err
operator|=
name|ValidateNextEngineParams
argument_list|(
name|h_FmPcd
argument_list|,
operator|&
name|p_FmPcdCcGroupParams
operator|->
name|nextEnginePerEntriesInGrp
index|[
name|j
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|DeleteTree
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
name|NO_MSG
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
if|if
condition|(
name|p_FmPcdCcGroupParams
operator|->
name|nextEnginePerEntriesInGrp
index|[
name|j
index|]
operator|.
name|h_Manip
condition|)
block|{
name|err
operator|=
name|FmPcdManipCheckParamsForCcNextEgine
argument_list|(
operator|&
name|p_FmPcdCcGroupParams
operator|->
name|nextEnginePerEntriesInGrp
index|[
name|j
index|]
argument_list|,
operator|&
name|requiredAction
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|DeleteTree
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|memcpy
argument_list|(
operator|&
name|params
index|[
name|k
index|]
operator|.
name|nextEngineParams
argument_list|,
operator|&
name|p_FmPcdCcGroupParams
operator|->
name|nextEnginePerEntriesInGrp
index|[
name|j
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineParams
argument_list|)
argument_list|)
expr_stmt|;
name|requiredAction
operator||=
name|UPDATE_CC_WITH_TREE
expr_stmt|;
name|params
index|[
name|k
index|]
operator|.
name|requiredAction
operator|=
name|requiredAction
expr_stmt|;
name|k
operator|++
expr_stmt|;
block|}
block|}
name|p_FmPcdCcTree
operator|->
name|numOfEntries
operator|=
operator|(
name|uint8_t
operator|)
name|k
expr_stmt|;
name|p_FmPcdCcTree
operator|->
name|numOfGrps
operator|=
name|p_PcdGroupsParam
operator|->
name|numOfGrps
expr_stmt|;
name|p_FmPcdCcTree
operator|->
name|ccTreeBaseAddr
operator|=
name|PTR_TO_UINT
argument_list|(
name|FM_MURAM_AllocMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
name|h_FmPcd
argument_list|)
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
name|k
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
argument_list|,
name|FM_PCD_CC_AD_TABLE_ALIGN
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmPcdCcTree
operator|->
name|ccTreeBaseAddr
condition|)
block|{
name|DeleteTree
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"No memory"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|IOMemSet32
argument_list|(
name|UINT_TO_PTR
argument_list|(
name|p_FmPcdCcTree
operator|->
name|ccTreeBaseAddr
argument_list|)
argument_list|,
literal|0
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
name|k
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
argument_list|)
expr_stmt|;
name|p_CcTreeTmp
operator|=
name|UINT_TO_PTR
argument_list|(
name|p_FmPcdCcTree
operator|->
name|ccTreeBaseAddr
argument_list|)
expr_stmt|;
name|j
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numOfEntries
condition|;
name|i
operator|++
control|)
block|{
name|NextStepAd
argument_list|(
name|p_CcTreeTmp
argument_list|,
operator|&
name|params
index|[
name|i
index|]
operator|.
name|nextEngineParams
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
name|p_CcTreeTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_CcTreeTmp
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
argument_list|,
operator|&
name|params
index|[
name|i
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNextEngineAndRequiredActionParams
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
block|{
name|p_FmPcdCcNextNode
operator|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
if|if
condition|(
operator|!
name|IsNodeInModifiedState
argument_list|(
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNextNode
argument_list|)
condition|)
block|{
name|memset
argument_list|(
operator|&
name|ccNodeInfo
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|ccNodeInfo
operator|.
name|h_CcNode
operator|=
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcTree
expr_stmt|;
name|ccNodeInfo
operator|.
name|index
operator|=
literal|1
expr_stmt|;
name|EnqueueNodeInfoToRelevantLst
argument_list|(
operator|&
name|p_FmPcdCcNextNode
operator|->
name|ccTreeIdLst
argument_list|,
operator|&
name|ccNodeInfo
argument_list|)
expr_stmt|;
name|UpdateNodeWithModifiedState
argument_list|(
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNextNode
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|p_CcInformation
operator|=
name|FindNodeInfoInReleventLst
argument_list|(
operator|&
name|p_FmPcdCcNextNode
operator|->
name|ccTreeIdLst
argument_list|,
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcTree
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcInformation
argument_list|)
expr_stmt|;
name|p_CcInformation
operator|->
name|index
operator|++
expr_stmt|;
block|}
block|}
block|}
name|FmPcdIncNetEnvOwners
argument_list|(
name|h_FmPcd
argument_list|,
name|p_FmPcdCcTree
operator|->
name|netEnvId
argument_list|)
expr_stmt|;
name|p_CcTreeTmp
operator|=
name|UINT_TO_PTR
argument_list|(
name|p_FmPcdCcTree
operator|->
name|ccTreeBaseAddr
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_FmPcdCcTree
operator|->
name|numOfEntries
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
block|{
name|p_FmPcdCcNextNode
operator|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
if|if
condition|(
name|IsNodeInModifiedState
argument_list|(
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNextNode
argument_list|)
condition|)
name|UpdateNodeWithModifiedState
argument_list|(
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNextNode
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numOfEntries
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|requiredAction
condition|)
block|{
name|err
operator|=
name|FmPcdCcSetRequiredAction
argument_list|(
name|h_FmPcd
argument_list|,
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|requiredAction
argument_list|,
operator|&
name|p_FmPcdCcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
argument_list|,
name|p_CcTreeTmp
argument_list|,
literal|1
argument_list|,
name|p_FmPcdCcTree
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|DeleteTree
argument_list|(
name|p_FmPcdCcTree
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"No memory"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|p_CcTreeTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_CcTreeTmp
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|p_FmPcdCcTree
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_PCD_CcDeleteTree
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_CcTree
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|t_FmPcdCcTree
modifier|*
name|p_CcTree
init|=
operator|(
name|t_FmPcdCcTree
operator|*
operator|)
name|h_CcTree
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_CcTree
argument_list|,
name|E_INVALID_STATE
argument_list|)
expr_stmt|;
name|FmPcdDecNetEnvOwners
argument_list|(
name|h_FmPcd
argument_list|,
name|p_CcTree
operator|->
name|netEnvId
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_CcTree
operator|->
name|owners
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_SELECTION
argument_list|,
operator|(
literal|"the tree with this ID can not be removed because this tree is occupied, first - unbind this tree"
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_CcTree
operator|->
name|numOfEntries
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_CcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
name|UpdateNodeOwner
argument_list|(
name|p_CcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_CcTree
operator|->
name|numOfEntries
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_CcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
condition|)
name|FmPcdManipUpdateOwner
argument_list|(
name|p_CcTree
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|DeleteTree
argument_list|(
name|p_CcTree
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Handle
name|FM_PCD_CcSetNode
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_FmPcdCcNodeParams
modifier|*
name|p_CcNodeParam
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
decl_stmt|,
modifier|*
name|p_FmPcdCcNextNode
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|int
name|tmp
decl_stmt|,
name|size
decl_stmt|;
name|bool
name|glblMask
init|=
name|FALSE
decl_stmt|;
name|t_FmPcdCcKeyParams
modifier|*
name|p_KeyParams
decl_stmt|;
name|t_Handle
name|p_KeysMatchTblTmp
decl_stmt|;
name|t_Handle
name|p_AdTableTmp
decl_stmt|;
name|bool
name|fullField
init|=
name|FALSE
decl_stmt|;
name|ccPrivateInfo_t
name|icCode
init|=
name|CC_PRIVATE_INFO_NONE
decl_stmt|;
name|bool
name|isKeyTblAlloc
decl_stmt|,
name|fromIc
init|=
name|FALSE
decl_stmt|;
name|t_CcNodeInformation
name|ccNodeInfo
decl_stmt|,
modifier|*
name|p_CcInformation
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*     if (!p_CcNodeParam->keysParams.keySize ||         !p_CcNodeParam->keysParams.numOfKeys)     {         REPORT_ERROR(MAJOR, E_INVALID_STATE, ("At least one key of keySize> 0 must be defined."));         return NULL;     }     */
name|p_FmPcdCcNode
operator|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNode
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmPcdCcNode
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"No memory"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|memset
argument_list|(
name|p_FmPcdCcNode
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcNode
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
operator|=
operator|(
name|t_Handle
operator|)
name|XX_Malloc
argument_list|(
name|CC_GLBL_MASK_SIZE
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|,
literal|0
argument_list|,
name|CC_GLBL_MASK_SIZE
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|=
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|numOfKeys
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
operator|=
name|h_FmPcd
expr_stmt|;
name|INIT_LIST
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccPrevNodesLst
argument_list|)
expr_stmt|;
name|INIT_LIST
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreeIdLst
argument_list|)
expr_stmt|;
name|INIT_LIST
argument_list|(
operator|&
name|p_FmPcdCcNode
operator|->
name|ccTreesLst
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|type
operator|==
name|e_FM_PCD_EXTRACT_BY_HDR
operator|)
operator|&&
operator|(
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|hdr
operator|==
name|HEADER_TYPE_IPv4
operator|)
operator|||
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|hdr
operator|==
name|HEADER_TYPE_IPv6
operator|)
operator|)
operator|&&
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|type
operator|==
name|e_FM_PCD_EXTRACT_FULL_FIELD
operator|)
operator|&&
operator|(
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|extractByHdrType
operator|.
name|fullField
operator|.
name|ipv6
operator|==
name|NET_HEADER_FIELD_IPv6_HOP_LIMIT
operator|)
operator|||
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|extractByHdrType
operator|.
name|fullField
operator|.
name|ipv4
operator|==
name|NET_HEADER_FIELD_IPv4_TTL
operator|)
operator|)
condition|)
block|{
name|err
operator|=
name|Ipv4TtlOrIpv6HopLimiCheckParams
argument_list|(
name|h_FmPcd
argument_list|,
name|p_CcNodeParam
argument_list|,
name|p_FmPcdCcNode
argument_list|,
operator|&
name|isKeyTblAlloc
argument_list|)
expr_stmt|;
name|glblMask
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|type
operator|==
name|e_FM_PCD_EXTRACT_NON_HDR
operator|)
operator|&&
operator|(
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|src
operator|==
name|e_FM_PCD_EXTRACT_FROM_KEY
operator|)
operator|||
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|src
operator|==
name|e_FM_PCD_EXTRACT_FROM_HASH
operator|)
operator|||
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|src
operator|==
name|e_FM_PCD_EXTRACT_FROM_FLOW_ID
operator|)
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|src
operator|==
name|e_FM_PCD_EXTRACT_FROM_FLOW_ID
operator|)
operator|&&
operator|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|offset
operator|!=
literal|0
operator|)
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"In the case of the extraction from e_FM_PCD_EXTRACT_FROM_FLOW_ID offset has to be 0"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|icCode
operator|=
name|IcDefineCode
argument_list|(
name|p_CcNodeParam
argument_list|)
expr_stmt|;
name|fromIc
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|icCode
operator|==
name|CC_PRIVATE_INFO_NONE
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"user asked extraction from IC and field in internal context or action wasn't initialized in the right way"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|(
name|icCode
operator|==
name|CC_PRIVATE_INFO_IC_DEQ_FQID_INDEX_LOOKUP
operator|)
operator|||
operator|(
name|icCode
operator|==
name|CC_PRIVATE_INFO_IC_HASH_INDEX_LOOKUP
operator|)
condition|)
block|{
name|err
operator|=
name|IcHashIndexedCheckParams
argument_list|(
name|h_FmPcd
argument_list|,
name|p_CcNodeParam
argument_list|,
name|p_FmPcdCcNode
argument_list|,
operator|&
name|isKeyTblAlloc
argument_list|)
expr_stmt|;
name|glblMask
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|err
operator|=
name|CheckParams
argument_list|(
name|h_FmPcd
argument_list|,
name|p_CcNodeParam
argument_list|,
name|p_FmPcdCcNode
argument_list|,
operator|&
name|isKeyTblAlloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|glblMaskSize
condition|)
name|glblMask
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
else|else
block|{
name|err
operator|=
name|CheckParams
argument_list|(
name|h_FmPcd
argument_list|,
name|p_CcNodeParam
argument_list|,
name|p_FmPcdCcNode
argument_list|,
operator|&
name|isKeyTblAlloc
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|glblMaskSize
condition|)
name|glblMask
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|err
condition|)
block|{
name|DeleteNode
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
switch|switch
condition|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|type
condition|)
block|{
case|case
operator|(
name|e_FM_PCD_EXTRACT_BY_HDR
operator|)
case|:
switch|switch
condition|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|type
condition|)
block|{
case|case
operator|(
name|e_FM_PCD_EXTRACT_FULL_FIELD
operator|)
case|:
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|=
name|GetFullFieldParseCode
argument_list|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|hdr
argument_list|,
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|hdrIndex
argument_list|,
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|extractByHdrType
operator|.
name|fullField
argument_list|)
expr_stmt|;
name|GetSizeHeaderField
argument_list|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|hdr
argument_list|,
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|extractByHdrType
operator|.
name|fullField
argument_list|,
operator|&
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
argument_list|)
expr_stmt|;
name|fullField
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|!=
name|CC_PC_FF_TCI1
operator|)
operator|&&
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|!=
name|CC_PC_FF_TCI2
operator|)
operator|&&
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|!=
name|CC_PC_FF_MPLS1
operator|)
operator|&&
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|!=
name|CC_PC_FF_MPLS1
operator|)
operator|&&
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|!=
name|CC_PC_FF_IPV4IPTOS_TC1
operator|)
operator|&&
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|!=
name|CC_PC_FF_IPV4IPTOS_TC2
operator|)
operator|&&
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|!=
name|CC_PC_FF_IPTOS_IPV6TC1_IPV6FLOW1
operator|)
operator|&&
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|!=
name|CC_PC_FF_IPTOS_IPV6TC2_IPV6FLOW2
operator|)
operator|&&
name|glblMask
condition|)
block|{
name|glblMask
operator|=
name|FALSE
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|glblMaskSize
operator|=
literal|4
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|lclMask
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
operator|(
name|e_FM_PCD_EXTRACT_FROM_HDR
operator|)
case|:
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
operator|=
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|extractByHdrType
operator|.
name|fromHdr
operator|.
name|size
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|offset
operator|=
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|extractByHdrType
operator|.
name|fromHdr
operator|.
name|offset
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|=
name|GetPrParseCode
argument_list|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|hdr
argument_list|,
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|hdrIndex
argument_list|,
name|p_FmPcdCcNode
operator|->
name|offset
argument_list|,
name|glblMask
argument_list|,
operator|&
name|p_FmPcdCcNode
operator|->
name|prsArrayOffset
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
name|e_FM_PCD_EXTRACT_FROM_FIELD
operator|)
case|:
name|p_FmPcdCcNode
operator|->
name|offset
operator|=
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|extractByHdrType
operator|.
name|fromField
operator|.
name|offset
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
operator|=
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|extractByHdrType
operator|.
name|fromField
operator|.
name|size
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|=
name|GetFieldParseCode
argument_list|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|hdr
argument_list|,
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|extractByHdrType
operator|.
name|fromField
operator|.
name|field
argument_list|,
name|p_FmPcdCcNode
operator|->
name|offset
argument_list|,
operator|&
name|p_FmPcdCcNode
operator|->
name|prsArrayOffset
argument_list|,
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractByHdr
operator|.
name|hdrIndex
argument_list|)
expr_stmt|;
break|break;
default|default:
name|DeleteNode
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_SELECTION
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
break|break;
case|case
operator|(
name|e_FM_PCD_EXTRACT_NON_HDR
operator|)
case|:
comment|/* get the field code for the generic extract */
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
operator|=
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|size
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|offset
operator|=
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|offset
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|=
name|GetGenParseCode
argument_list|(
name|p_CcNodeParam
operator|->
name|extractCcParams
operator|.
name|extractNonHdr
operator|.
name|src
argument_list|,
name|p_FmPcdCcNode
operator|->
name|offset
argument_list|,
name|glblMask
argument_list|,
operator|&
name|p_FmPcdCcNode
operator|->
name|prsArrayOffset
argument_list|,
name|fromIc
argument_list|,
name|icCode
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|==
name|CC_PC_GENERIC_IC_HASH_INDEXED
condition|)
block|{
if|if
condition|(
operator|(
name|p_FmPcdCcNode
operator|->
name|offset
operator|+
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
operator|)
operator|>
literal|64
condition|)
block|{
name|DeleteNode
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_SELECTION
argument_list|,
operator|(
literal|"when node of the type CC_PC_GENERIC_IC_HASH_INDEXED offset + size can not be bigger then size of HASH 64 bits (8 bytes)"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
if|if
condition|(
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|==
name|CC_PC_GENERIC_IC_GMASK
operator|)
operator|||
operator|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|==
name|CC_PC_GENERIC_IC_HASH_INDEXED
operator|)
condition|)
block|{
name|p_FmPcdCcNode
operator|->
name|offset
operator|+=
name|p_FmPcdCcNode
operator|->
name|prsArrayOffset
expr_stmt|;
name|p_FmPcdCcNode
operator|->
name|prsArrayOffset
operator|=
literal|0
expr_stmt|;
block|}
break|break;
default|default:
name|DeleteNode
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_SELECTION
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|parseCode
operator|==
name|CC_PC_ILLEGAL
condition|)
block|{
name|DeleteNode
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"illeagl extraction type"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|(
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
operator|>
name|FM_PCD_MAX_SIZE_OF_KEY
operator|)
operator|||
operator|!
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
condition|)
block|{
name|DeleteNode
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"sizeOfExatrction can not be greater than 56 and not 0"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|keySize
operator|!=
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
condition|)
block|{
name|DeleteNode
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"keySize has to be equal to sizeOfExtraction"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|p_FmPcdCcNode
operator|->
name|userSizeOfExtraction
operator|=
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
expr_stmt|;
if|if
condition|(
operator|!
name|glblMask
condition|)
name|memset
argument_list|(
name|p_FmPcdCcNode
operator|->
name|p_GlblMask
argument_list|,
literal|0xff
argument_list|,
name|CC_GLBL_MASK_SIZE
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
name|err
operator|=
name|CheckAndSetManipParamsWithCcNodeParams
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
block|{
name|DeleteNode
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"keySize has to be equal to sizeOfExtraction"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|GetCcExtractKeySize
argument_list|(
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
argument_list|,
operator|&
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|lclMask
condition|)
name|size
operator|=
literal|2
operator|*
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
expr_stmt|;
else|else
name|size
operator|=
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
expr_stmt|;
if|if
condition|(
name|isKeyTblAlloc
condition|)
block|{
name|p_FmPcdCcNode
operator|->
name|h_KeysMatchTable
operator|=
operator|(
name|t_Handle
operator|)
name|FM_MURAM_AllocMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
argument_list|)
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
operator|*
operator|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
argument_list|)
argument_list|,
name|FM_PCD_CC_KEYS_MATCH_TABLE_ALIGN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmPcdCcNode
operator|->
name|h_KeysMatchTable
condition|)
block|{
name|DeleteNode
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"No memory in MURAM for KEY MATCH table"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|IOMemSet32
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
name|p_FmPcdCcNode
operator|->
name|h_KeysMatchTable
argument_list|,
literal|0
argument_list|,
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
operator|*
operator|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
name|p_FmPcdCcNode
operator|->
name|h_AdTable
operator|=
operator|(
name|t_Handle
operator|)
name|FM_MURAM_AllocMem
argument_list|(
name|FmPcdGetMuramHandle
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_FmPcd
argument_list|)
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
operator|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
argument_list|,
name|FM_PCD_CC_AD_TABLE_ALIGN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmPcdCcNode
operator|->
name|h_AdTable
condition|)
block|{
name|DeleteNode
argument_list|(
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"No memory in MURAM for AD table "
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|IOMemSet32
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
name|p_FmPcdCcNode
operator|->
name|h_AdTable
argument_list|,
literal|0
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
operator|(
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
operator|)
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
argument_list|)
expr_stmt|;
name|p_KeysMatchTblTmp
operator|=
name|p_FmPcdCcNode
operator|->
name|h_KeysMatchTable
expr_stmt|;
name|p_AdTableTmp
operator|=
name|p_FmPcdCcNode
operator|->
name|h_AdTable
expr_stmt|;
for|for
control|(
name|tmp
operator|=
literal|0
init|;
name|tmp
operator|<
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|;
name|tmp
operator|++
control|)
block|{
name|p_KeyParams
operator|=
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|keyParams
index|[
name|tmp
index|]
expr_stmt|;
if|if
condition|(
name|p_KeysMatchTblTmp
condition|)
block|{
name|Mem2IOCpy32
argument_list|(
operator|(
name|void
operator|*
operator|)
name|p_KeysMatchTblTmp
argument_list|,
name|p_KeyParams
operator|->
name|p_Key
argument_list|,
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|lclMask
operator|&&
name|p_KeyParams
operator|->
name|p_Mask
condition|)
name|Mem2IOCpy32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTblTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
name|p_KeyParams
operator|->
name|p_Mask
argument_list|,
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|lclMask
condition|)
name|IOMemSet32
argument_list|(
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTblTmp
argument_list|,
name|p_FmPcdCcNode
operator|->
name|ccKeySizeAccExtraction
argument_list|)
argument_list|,
literal|0xff
argument_list|,
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
argument_list|)
expr_stmt|;
name|p_KeysMatchTblTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_KeysMatchTblTmp
argument_list|,
name|size
operator|*
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|NextStepAd
argument_list|(
name|p_AdTableTmp
argument_list|,
operator|&
name|p_KeyParams
operator|->
name|ccNextEngineParams
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
name|p_AdTableTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdTableTmp
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
block|}
name|NextStepAd
argument_list|(
name|p_AdTableTmp
argument_list|,
operator|&
name|p_CcNodeParam
operator|->
name|keysParams
operator|.
name|ccNextEngineParamsForMiss
argument_list|,
name|p_FmPcd
argument_list|)
expr_stmt|;
if|if
condition|(
name|fullField
operator|==
name|TRUE
condition|)
name|p_FmPcdCcNode
operator|->
name|sizeOfExtraction
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|tmp
operator|=
literal|0
init|;
name|tmp
operator|<
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
condition|;
name|tmp
operator|++
control|)
block|{
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
block|{
name|p_FmPcdCcNextNode
operator|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
if|if
condition|(
operator|!
name|IsNodeInModifiedState
argument_list|(
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNextNode
argument_list|)
condition|)
block|{
name|memset
argument_list|(
operator|&
name|ccNodeInfo
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_CcNodeInformation
argument_list|)
argument_list|)
expr_stmt|;
name|ccNodeInfo
operator|.
name|h_CcNode
operator|=
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNode
expr_stmt|;
name|ccNodeInfo
operator|.
name|index
operator|=
literal|1
expr_stmt|;
name|EnqueueNodeInfoToRelevantLst
argument_list|(
operator|&
name|p_FmPcdCcNextNode
operator|->
name|ccPrevNodesLst
argument_list|,
operator|&
name|ccNodeInfo
argument_list|)
expr_stmt|;
name|UpdateNodeWithModifiedState
argument_list|(
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNextNode
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|p_CcInformation
operator|=
name|FindNodeInfoInReleventLst
argument_list|(
operator|&
name|p_FmPcdCcNextNode
operator|->
name|ccPrevNodesLst
argument_list|,
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_CcInformation
argument_list|)
expr_stmt|;
name|p_CcInformation
operator|->
name|index
operator|++
expr_stmt|;
block|}
block|}
block|}
for|for
control|(
name|tmp
operator|=
literal|0
init|;
name|tmp
operator|<
name|p_FmPcdCcNode
operator|->
name|numOfKeys
operator|+
literal|1
condition|;
name|tmp
operator|++
control|)
block|{
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
block|{
name|p_FmPcdCcNextNode
operator|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
expr_stmt|;
if|if
condition|(
name|IsNodeInModifiedState
argument_list|(
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNextNode
argument_list|)
condition|)
name|UpdateNodeWithModifiedState
argument_list|(
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNextNode
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
name|p_AdTableTmp
operator|=
name|p_FmPcdCcNode
operator|->
name|h_AdTable
expr_stmt|;
for|for
control|(
name|tmp
operator|=
literal|0
init|;
name|tmp
operator|<
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|;
name|tmp
operator|++
control|)
block|{
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|requiredAction
condition|)
block|{
name|err
operator|=
name|FmPcdCcSetRequiredAction
argument_list|(
name|h_FmPcd
argument_list|,
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|requiredAction
argument_list|,
operator|&
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
argument_list|,
name|p_AdTableTmp
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|FM_PCD_CcDeleteNode
argument_list|(
name|h_FmPcd
argument_list|,
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|p_AdTableTmp
operator|=
name|PTR_MOVE
argument_list|(
name|p_AdTableTmp
argument_list|,
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|requiredAction
condition|)
block|{
name|err
operator|=
name|FmPcdCcSetRequiredAction
argument_list|(
name|h_FmPcd
argument_list|,
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
operator|.
name|requiredAction
argument_list|,
operator|&
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|tmp
index|]
argument_list|,
name|p_AdTableTmp
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|FM_PCD_CcDeleteNode
argument_list|(
name|h_FmPcd
argument_list|,
operator|(
name|t_Handle
operator|)
name|p_FmPcdCcNode
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
return|return
name|p_FmPcdCcNode
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_PCD_CcDeleteNode
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_CcNode
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_CcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_CcNode
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|UNUSED
argument_list|(
name|h_FmPcd
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_CcNode
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_SELECTION
argument_list|,
operator|(
literal|"the node with this ID is not initialized"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_CcNode
operator|->
name|owners
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_SELECTION
argument_list|,
operator|(
literal|"the node with this ID can not be removed because this node is occupied, first - unbind this node"
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_CcNode
operator|->
name|numOfKeys
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_CcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
name|UpdateNodeOwner
argument_list|(
name|p_CcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|p_CcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
name|UpdateNodeOwner
argument_list|(
name|p_CcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|ccParams
operator|.
name|h_CcNode
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_PCD_CC_MANIP
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_CcNode
operator|->
name|numOfKeys
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_CcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
condition|)
name|FmPcdManipUpdateOwner
argument_list|(
name|p_CcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|p_CcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
condition|)
name|FmPcdManipUpdateOwner
argument_list|(
name|p_CcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|i
index|]
operator|.
name|nextEngineParams
operator|.
name|h_Manip
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* FM_PCD_CC_MANIP */
name|DeleteNode
argument_list|(
name|p_CcNode
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_PCD_CcNodeAddKey
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_CcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|uint8_t
name|keySize
parameter_list|,
name|t_FmPcdCcKeyParams
modifier|*
name|p_KeyParams
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
name|FmHcPcdCcAddKey
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|h_CcNode
argument_list|,
name|keyIndex
argument_list|,
name|keySize
argument_list|,
name|p_KeyParams
argument_list|)
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_PCD_CcNodeRemoveKey
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_CcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
name|FmHcPcdCcRemoveKey
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|h_CcNode
argument_list|,
name|keyIndex
argument_list|)
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_PCD_CcNodeModifyKey
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_CcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|uint8_t
name|keySize
parameter_list|,
name|uint8_t
modifier|*
name|p_Key
parameter_list|,
name|uint8_t
modifier|*
name|p_Mask
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
name|FmHcPcdCcModifyKey
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|h_CcNode
argument_list|,
name|keyIndex
argument_list|,
name|keySize
argument_list|,
name|p_Key
argument_list|,
name|p_Mask
argument_list|)
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_PCD_CcNodeModifyNextEngine
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_CcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|t_FmPcdCcNextEngineParams
modifier|*
name|p_FmPcdCcNextEngineParams
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
name|FmHcPcdCcModifyNodeNextEngine
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|h_CcNode
argument_list|,
name|keyIndex
argument_list|,
name|p_FmPcdCcNextEngineParams
argument_list|)
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_PCD_CcNodeModifyMissNextEngine
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_CcNode
parameter_list|,
name|t_FmPcdCcNextEngineParams
modifier|*
name|p_FmPcdCcNextEngineParams
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
name|FmHcPcdCcModifyNodeMissNextEngine
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|h_CcNode
argument_list|,
name|p_FmPcdCcNextEngineParams
argument_list|)
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_PCD_CcTreeModifyNextEngine
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_CcTree
parameter_list|,
name|uint8_t
name|grpId
parameter_list|,
name|uint8_t
name|index
parameter_list|,
name|t_FmPcdCcNextEngineParams
modifier|*
name|p_FmPcdCcNextEngineParams
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
name|FmHcPcdCcModifyTreeNextEngine
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|h_CcTree
argument_list|,
name|grpId
argument_list|,
name|index
argument_list|,
name|p_FmPcdCcNextEngineParams
argument_list|)
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_PCD_CcNodeModifyKeyAndNextEngine
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_CcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|,
name|uint8_t
name|keySize
parameter_list|,
name|t_FmPcdCcKeyParams
modifier|*
name|p_KeyParams
parameter_list|)
block|{
name|t_FmPcd
modifier|*
name|p_FmPcd
init|=
operator|(
name|t_FmPcd
operator|*
operator|)
name|h_FmPcd
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
return|return
name|FmHcPcdCcModifyKeyAndNextEngine
argument_list|(
name|p_FmPcd
operator|->
name|h_Hc
argument_list|,
name|h_CcNode
argument_list|,
name|keyIndex
argument_list|,
name|keySize
argument_list|,
name|p_KeyParams
argument_list|)
return|;
block|}
end_function

begin_function
name|uint32_t
name|FM_PCD_CcNodeGetKeyCounter
parameter_list|(
name|t_Handle
name|h_FmPcd
parameter_list|,
name|t_Handle
name|h_CcNode
parameter_list|,
name|uint8_t
name|keyIndex
parameter_list|)
block|{
name|t_FmPcdCcNode
modifier|*
name|p_FmPcdCcNode
init|=
operator|(
name|t_FmPcdCcNode
operator|*
operator|)
name|h_CcNode
decl_stmt|;
name|t_AdOfTypeResult
modifier|*
name|p_AdResult
init|=
name|NULL
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmPcd
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|h_CcNode
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DISABLE_SANITY_CHECKS
name|UNUSED
argument_list|(
name|h_FmPcd
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DISABLE_SANITY_CHECKS */
if|if
condition|(
name|keyIndex
operator|>=
name|p_FmPcdCcNode
operator|->
name|numOfKeys
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"keyIndex> numOfKeys defined for this node"
operator|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|p_AdResult
operator|=
name|PTR_MOVE
argument_list|(
name|p_FmPcdCcNode
operator|->
name|h_AdTable
argument_list|,
name|keyIndex
operator|*
name|FM_PCD_CC_AD_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_AdResult
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_CC
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"statistics updated only for entries where next engine not CC"
operator|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|(
operator|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_DONE
operator|)
operator|&&
operator|!
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|enqueueParams
operator|.
name|statisticsEn
operator|)
operator|||
operator|(
operator|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_KG
operator|)
operator|&&
operator|!
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|kgParams
operator|.
name|statisticsEn
operator|)
operator|||
operator|(
operator|(
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|nextEngine
operator|==
name|e_FM_PCD_PLCR
operator|)
operator|&&
operator|!
name|p_FmPcdCcNode
operator|->
name|nextEngineAndRequiredAction
index|[
name|keyIndex
index|]
operator|.
name|nextEngineParams
operator|.
name|params
operator|.
name|plcrParams
operator|.
name|statisticsEn
operator|)
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"statistics wasn't enable"
operator|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|GET_UINT32
argument_list|(
name|p_AdResult
operator|->
name|res
argument_list|)
return|;
block|}
end_function

end_unit

