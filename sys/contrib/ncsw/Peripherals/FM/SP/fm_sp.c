begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright 2008-2012 Freescale Semiconductor Inc.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions are met:  *     * Redistributions of source code must retain the above copyright  *       notice, this list of conditions and the following disclaimer.  *     * Redistributions in binary form must reproduce the above copyright  *       notice, this list of conditions and the following disclaimer in the  *       documentation and/or other materials provided with the distribution.  *     * Neither the name of Freescale Semiconductor nor the  *       names of its contributors may be used to endorse or promote products  *       derived from this software without specific prior written permission.  *  *  * ALTERNATIVELY, this software may be distributed under the terms of the  * GNU General Public License ("GPL") as published by the Free Software  * Foundation, either version 2 of that License or (at your option) any  * later version.  *  * THIS SOFTWARE IS PROVIDED BY Freescale Semiconductor ``AS IS'' AND ANY  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE  * DISCLAIMED. IN NO EVENT SHALL Freescale Semiconductor BE LIABLE FOR ANY  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/******************************************************************************  @File          fm_sp.c   @Description   FM PCD Storage profile  ... */
end_comment

begin_comment
comment|/***************************************************************************/
end_comment

begin_include
include|#
directive|include
file|"std_ext.h"
end_include

begin_include
include|#
directive|include
file|"error_ext.h"
end_include

begin_include
include|#
directive|include
file|"string_ext.h"
end_include

begin_include
include|#
directive|include
file|"debug_ext.h"
end_include

begin_include
include|#
directive|include
file|"net_ext.h"
end_include

begin_include
include|#
directive|include
file|"fm_vsp_ext.h"
end_include

begin_include
include|#
directive|include
file|"fm_sp.h"
end_include

begin_include
include|#
directive|include
file|"fm_common.h"
end_include

begin_include
include|#
directive|include
file|"fsl_fman_sp.h"
end_include

begin_if
if|#
directive|if
operator|(
name|DPAA_VERSION
operator|>=
literal|11
operator|)
end_if

begin_function
specifier|static
name|t_Error
name|CheckParamsGeneratedInternally
parameter_list|(
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
parameter_list|)
block|{
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|FmSpCheckIntContextParams
argument_list|(
operator|&
name|p_FmVspEntry
operator|->
name|intContext
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|FmSpCheckBufMargins
argument_list|(
operator|&
name|p_FmVspEntry
operator|->
name|bufMargins
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
specifier|static
name|t_Error
name|CheckParams
parameter_list|(
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
parameter_list|)
block|{
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|h_Fm
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|FmSpCheckBufPoolsParams
argument_list|(
operator|&
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|extBufPools
argument_list|,
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BackupBmPools
argument_list|,
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BufPoolDepletion
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|liodnOffset
operator|&
operator|~
name|FM_LIODN_OFFSET_MASK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"liodnOffset is larger than %d"
operator|,
name|FM_LIODN_OFFSET_MASK
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|FmVSPCheckRelativeProfile
argument_list|(
name|p_FmVspEntry
operator|->
name|h_Fm
argument_list|,
name|p_FmVspEntry
operator|->
name|portType
argument_list|,
name|p_FmVspEntry
operator|->
name|portId
argument_list|,
name|p_FmVspEntry
operator|->
name|relativeProfileId
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* (DPAA_VERSION>= 11) */
end_comment

begin_comment
comment|/*****************************************************************************/
end_comment

begin_comment
comment|/*              Inter-module API routines                                    */
end_comment

begin_comment
comment|/*****************************************************************************/
end_comment

begin_function
name|void
name|FmSpSetBufPoolsInAscOrderOfBufSizes
parameter_list|(
name|t_FmExtPools
modifier|*
name|p_FmExtPools
parameter_list|,
name|uint8_t
modifier|*
name|orderedArray
parameter_list|,
name|uint16_t
modifier|*
name|sizesArray
parameter_list|)
block|{
name|uint16_t
name|bufSize
init|=
literal|0
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|,
name|j
init|=
literal|0
decl_stmt|,
name|k
init|=
literal|0
decl_stmt|;
comment|/* First we copy the external buffers pools information to an ordered local array */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_FmExtPools
operator|->
name|numOfPoolsUsed
condition|;
name|i
operator|++
control|)
block|{
comment|/* get pool size */
name|bufSize
operator|=
name|p_FmExtPools
operator|->
name|extBufPool
index|[
name|i
index|]
operator|.
name|size
expr_stmt|;
comment|/* keep sizes in an array according to poolId for direct access */
name|sizesArray
index|[
name|p_FmExtPools
operator|->
name|extBufPool
index|[
name|i
index|]
operator|.
name|id
index|]
operator|=
name|bufSize
expr_stmt|;
comment|/* save poolId in an ordered array according to size */
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<=
name|i
condition|;
name|j
operator|++
control|)
block|{
comment|/* this is the next free place in the array */
if|if
condition|(
name|j
operator|==
name|i
condition|)
name|orderedArray
index|[
name|i
index|]
operator|=
name|p_FmExtPools
operator|->
name|extBufPool
index|[
name|i
index|]
operator|.
name|id
expr_stmt|;
else|else
block|{
comment|/* find the right place for this poolId */
if|if
condition|(
name|bufSize
operator|<
name|sizesArray
index|[
name|orderedArray
index|[
name|j
index|]
index|]
condition|)
block|{
comment|/* move the poolIds one place ahead to make room for this poolId */
for|for
control|(
name|k
operator|=
name|i
init|;
name|k
operator|>
name|j
condition|;
name|k
operator|--
control|)
name|orderedArray
index|[
name|k
index|]
operator|=
name|orderedArray
index|[
name|k
operator|-
literal|1
index|]
expr_stmt|;
comment|/* now k==j, this is the place for the new size */
name|orderedArray
index|[
name|k
index|]
operator|=
name|p_FmExtPools
operator|->
name|extBufPool
index|[
name|i
index|]
operator|.
name|id
expr_stmt|;
break|break;
block|}
block|}
block|}
block|}
block|}
end_function

begin_function
name|t_Error
name|FmSpCheckBufPoolsParams
parameter_list|(
name|t_FmExtPools
modifier|*
name|p_FmExtPools
parameter_list|,
name|t_FmBackupBmPools
modifier|*
name|p_FmBackupBmPools
parameter_list|,
name|t_FmBufPoolDepletion
modifier|*
name|p_FmBufPoolDepletion
parameter_list|)
block|{
name|int
name|i
init|=
literal|0
decl_stmt|,
name|j
init|=
literal|0
decl_stmt|;
name|bool
name|found
decl_stmt|;
name|uint8_t
name|count
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|p_FmExtPools
condition|)
block|{
if|if
condition|(
name|p_FmExtPools
operator|->
name|numOfPoolsUsed
operator|>
name|FM_PORT_MAX_NUM_OF_EXT_POOLS
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"numOfPoolsUsed can't be larger than %d"
operator|,
name|FM_PORT_MAX_NUM_OF_EXT_POOLS
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_FmExtPools
operator|->
name|numOfPoolsUsed
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_FmExtPools
operator|->
name|extBufPool
index|[
name|i
index|]
operator|.
name|id
operator|>=
name|BM_MAX_NUM_OF_POOLS
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"extBufPools.extBufPool[%d].id can't be larger than %d"
operator|,
name|i
operator|,
name|BM_MAX_NUM_OF_POOLS
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmExtPools
operator|->
name|extBufPool
index|[
name|i
index|]
operator|.
name|size
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"extBufPools.extBufPool[%d].size is 0"
operator|,
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|p_FmExtPools
operator|&&
operator|(
name|p_FmBackupBmPools
operator|||
name|p_FmBufPoolDepletion
operator|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"backupBmPools ot bufPoolDepletion can not be defined without external pools"
operator|)
argument_list|)
expr_stmt|;
comment|/* backup BM pools indication is valid only for some chip derivatives        (limited by the config routine) */
if|if
condition|(
name|p_FmBackupBmPools
condition|)
block|{
if|if
condition|(
name|p_FmBackupBmPools
operator|->
name|numOfBackupPools
operator|>=
name|p_FmExtPools
operator|->
name|numOfPoolsUsed
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"p_BackupBmPools must be smaller than extBufPools.numOfPoolsUsed"
operator|)
argument_list|)
expr_stmt|;
name|found
operator|=
name|FALSE
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_FmBackupBmPools
operator|->
name|numOfBackupPools
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|p_FmExtPools
operator|->
name|numOfPoolsUsed
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|p_FmBackupBmPools
operator|->
name|poolIds
index|[
name|i
index|]
operator|==
name|p_FmExtPools
operator|->
name|extBufPool
index|[
name|j
index|]
operator|.
name|id
condition|)
block|{
name|found
operator|=
name|TRUE
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|found
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"All p_BackupBmPools.poolIds must be included in extBufPools.extBufPool[n].id"
operator|)
argument_list|)
expr_stmt|;
else|else
name|found
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
comment|/* up to extBufPools.numOfPoolsUsed pools may be defined */
if|if
condition|(
name|p_FmBufPoolDepletion
operator|&&
name|p_FmBufPoolDepletion
operator|->
name|poolsGrpModeEnable
condition|)
block|{
if|if
condition|(
operator|(
name|p_FmBufPoolDepletion
operator|->
name|numOfPools
operator|>
name|p_FmExtPools
operator|->
name|numOfPoolsUsed
operator|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"bufPoolDepletion.numOfPools can't be larger than %d and can't be larger than numOfPoolsUsed"
operator|,
name|FM_PORT_MAX_NUM_OF_EXT_POOLS
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmBufPoolDepletion
operator|->
name|numOfPools
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"bufPoolDepletion.numOfPoolsToConsider can not be 0 when poolsGrpModeEnable=TRUE"
operator|)
argument_list|)
expr_stmt|;
name|found
operator|=
name|FALSE
expr_stmt|;
name|count
operator|=
literal|0
expr_stmt|;
comment|/* for each pool that is in poolsToConsider, check if it is defined            in extBufPool */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|BM_MAX_NUM_OF_POOLS
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_FmBufPoolDepletion
operator|->
name|poolsToConsider
index|[
name|i
index|]
condition|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|p_FmExtPools
operator|->
name|numOfPoolsUsed
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
name|p_FmExtPools
operator|->
name|extBufPool
index|[
name|j
index|]
operator|.
name|id
condition|)
block|{
name|found
operator|=
name|TRUE
expr_stmt|;
name|count
operator|++
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|found
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"Pools selected for depletion are not used."
operator|)
argument_list|)
expr_stmt|;
else|else
name|found
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
comment|/* check that the number of pools that we have checked is equal to the number announced by the user */
if|if
condition|(
name|count
operator|!=
name|p_FmBufPoolDepletion
operator|->
name|numOfPools
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"bufPoolDepletion.numOfPools is larger than the number of pools defined."
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|p_FmBufPoolDepletion
operator|&&
name|p_FmBufPoolDepletion
operator|->
name|singlePoolModeEnable
condition|)
block|{
comment|/* calculate vector for number of pools depletion */
name|found
operator|=
name|FALSE
expr_stmt|;
name|count
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|BM_MAX_NUM_OF_POOLS
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|p_FmBufPoolDepletion
operator|->
name|poolsToConsiderForSingleMode
index|[
name|i
index|]
condition|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|p_FmExtPools
operator|->
name|numOfPoolsUsed
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
name|p_FmExtPools
operator|->
name|extBufPool
index|[
name|j
index|]
operator|.
name|id
condition|)
block|{
name|found
operator|=
name|TRUE
expr_stmt|;
name|count
operator|++
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|found
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"Pools selected for depletion are not used."
operator|)
argument_list|)
expr_stmt|;
else|else
name|found
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|count
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"No pools defined for single buffer mode pool depletion."
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmSpCheckIntContextParams
parameter_list|(
name|t_FmSpIntContextDataCopy
modifier|*
name|p_FmSpIntContextDataCopy
parameter_list|)
block|{
comment|/* Check that divisible by 16 and not larger than 240 */
if|if
condition|(
name|p_FmSpIntContextDataCopy
operator|->
name|intContextOffset
operator|>
name|MAX_INT_OFFSET
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"intContext.intContextOffset can't be larger than %d"
operator|,
name|MAX_INT_OFFSET
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmSpIntContextDataCopy
operator|->
name|intContextOffset
operator|%
name|OFFSET_UNITS
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"intContext.intContextOffset has to be divisible by %d"
operator|,
name|OFFSET_UNITS
operator|)
argument_list|)
expr_stmt|;
comment|/* check that ic size+ic internal offset, does not exceed ic block size */
if|if
condition|(
name|p_FmSpIntContextDataCopy
operator|->
name|size
operator|+
name|p_FmSpIntContextDataCopy
operator|->
name|intContextOffset
operator|>
name|MAX_IC_SIZE
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"intContext.size + intContext.intContextOffset has to be smaller than %d"
operator|,
name|MAX_IC_SIZE
operator|)
argument_list|)
expr_stmt|;
comment|/* Check that divisible by 16 and not larger than 256 */
if|if
condition|(
name|p_FmSpIntContextDataCopy
operator|->
name|size
operator|%
name|OFFSET_UNITS
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"intContext.size  has to be divisible by %d"
operator|,
name|OFFSET_UNITS
operator|)
argument_list|)
expr_stmt|;
comment|/* Check that divisible by 16 and not larger than 4K */
if|if
condition|(
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
operator|>
name|MAX_EXT_OFFSET
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"intContext.extBufOffset can't be larger than %d"
operator|,
name|MAX_EXT_OFFSET
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
operator|%
name|OFFSET_UNITS
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"intContext.extBufOffset  has to be divisible by %d"
operator|,
name|OFFSET_UNITS
operator|)
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmSpCheckBufMargins
parameter_list|(
name|t_FmSpBufMargins
modifier|*
name|p_FmSpBufMargins
parameter_list|)
block|{
comment|/* Check the margin definition */
if|if
condition|(
name|p_FmSpBufMargins
operator|->
name|startMargins
operator|>
name|MAX_EXT_BUFFER_OFFSET
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"bufMargins.startMargins can't be larger than %d"
operator|,
name|MAX_EXT_BUFFER_OFFSET
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmSpBufMargins
operator|->
name|endMargins
operator|>
name|MAX_EXT_BUFFER_OFFSET
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"bufMargins.endMargins can't be larger than %d"
operator|,
name|MAX_EXT_BUFFER_OFFSET
operator|)
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmSpBuildBufferStructure
parameter_list|(
name|t_FmSpIntContextDataCopy
modifier|*
name|p_FmSpIntContextDataCopy
parameter_list|,
name|t_FmBufferPrefixContent
modifier|*
name|p_BufferPrefixContent
parameter_list|,
name|t_FmSpBufMargins
modifier|*
name|p_FmSpBufMargins
parameter_list|,
name|t_FmSpBufferOffsets
modifier|*
name|p_FmSpBufferOffsets
parameter_list|,
name|uint8_t
modifier|*
name|internalBufferOffset
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmSpIntContextDataCopy
argument_list|,
name|E_INVALID_VALUE
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmSpIntContextDataCopy
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_BufferPrefixContent
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmSpBufMargins
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmSpBufferOffsets
argument_list|)
expr_stmt|;
comment|/* Align start of internal context data to 16 byte */
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
operator|=
call|(
name|uint16_t
call|)
argument_list|(
operator|(
name|p_BufferPrefixContent
operator|->
name|privDataSize
operator|&
operator|(
name|OFFSET_UNITS
operator|-
literal|1
operator|)
operator|)
condition|?
operator|(
operator|(
name|p_BufferPrefixContent
operator|->
name|privDataSize
operator|+
name|OFFSET_UNITS
operator|)
operator|&
operator|~
call|(
name|uint16_t
call|)
argument_list|(
name|OFFSET_UNITS
operator|-
literal|1
argument_list|)
operator|)
else|:
name|p_BufferPrefixContent
operator|->
name|privDataSize
argument_list|)
expr_stmt|;
comment|/* Translate margin and intContext params to FM parameters */
comment|/* Initialize with illegal value. Later we'll set legal values. */
name|p_FmSpBufferOffsets
operator|->
name|prsResultOffset
operator|=
operator|(
name|uint32_t
operator|)
name|ILLEGAL_BASE
expr_stmt|;
name|p_FmSpBufferOffsets
operator|->
name|timeStampOffset
operator|=
operator|(
name|uint32_t
operator|)
name|ILLEGAL_BASE
expr_stmt|;
name|p_FmSpBufferOffsets
operator|->
name|hashResultOffset
operator|=
operator|(
name|uint32_t
operator|)
name|ILLEGAL_BASE
expr_stmt|;
name|p_FmSpBufferOffsets
operator|->
name|pcdInfoOffset
operator|=
operator|(
name|uint32_t
operator|)
name|ILLEGAL_BASE
expr_stmt|;
comment|/* Internally the driver supports 4 options        1. prsResult/timestamp/hashResult selection (in fact 8 options, but for simplicity we'll           relate to it as 1).        2. All IC context (from AD) not including debug.*/
comment|/* This 'if' covers option 2. We copy from beginning of context. */
if|if
condition|(
name|p_BufferPrefixContent
operator|->
name|passAllOtherPCDInfo
condition|)
block|{
name|p_FmSpIntContextDataCopy
operator|->
name|size
operator|=
literal|128
expr_stmt|;
comment|/* must be aligned to 16 */
comment|/* Start copying data after 16 bytes (FD) from the beginning of the internal context */
name|p_FmSpIntContextDataCopy
operator|->
name|intContextOffset
operator|=
literal|16
expr_stmt|;
if|if
condition|(
name|p_BufferPrefixContent
operator|->
name|passAllOtherPCDInfo
condition|)
name|p_FmSpBufferOffsets
operator|->
name|pcdInfoOffset
operator|=
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
expr_stmt|;
if|if
condition|(
name|p_BufferPrefixContent
operator|->
name|passPrsResult
condition|)
name|p_FmSpBufferOffsets
operator|->
name|prsResultOffset
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
operator|+
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_BufferPrefixContent
operator|->
name|passTimeStamp
condition|)
name|p_FmSpBufferOffsets
operator|->
name|timeStampOffset
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
operator|+
literal|48
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_BufferPrefixContent
operator|->
name|passHashResult
condition|)
name|p_FmSpBufferOffsets
operator|->
name|hashResultOffset
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
operator|+
literal|56
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* This case covers the options under 1 */
comment|/* Copy size must be in 16-byte granularity. */
name|p_FmSpIntContextDataCopy
operator|->
name|size
operator|=
call|(
name|uint16_t
call|)
argument_list|(
operator|(
name|p_BufferPrefixContent
operator|->
name|passPrsResult
condition|?
literal|32
else|:
literal|0
operator|)
operator|+
operator|(
operator|(
name|p_BufferPrefixContent
operator|->
name|passTimeStamp
operator|||
name|p_BufferPrefixContent
operator|->
name|passHashResult
operator|)
condition|?
literal|16
else|:
literal|0
operator|)
argument_list|)
expr_stmt|;
comment|/* Align start of internal context data to 16 byte */
name|p_FmSpIntContextDataCopy
operator|->
name|intContextOffset
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|p_BufferPrefixContent
operator|->
name|passPrsResult
condition|?
literal|32
else|:
operator|(
operator|(
name|p_BufferPrefixContent
operator|->
name|passTimeStamp
operator|||
name|p_BufferPrefixContent
operator|->
name|passHashResult
operator|)
condition|?
literal|64
else|:
literal|0
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_BufferPrefixContent
operator|->
name|passPrsResult
condition|)
name|p_FmSpBufferOffsets
operator|->
name|prsResultOffset
operator|=
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
expr_stmt|;
if|if
condition|(
name|p_BufferPrefixContent
operator|->
name|passTimeStamp
condition|)
name|p_FmSpBufferOffsets
operator|->
name|timeStampOffset
operator|=
name|p_BufferPrefixContent
operator|->
name|passPrsResult
condition|?
operator|(
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
operator|+
sizeof|sizeof
argument_list|(
name|t_FmPrsResult
argument_list|)
operator|)
else|:
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
expr_stmt|;
if|if
condition|(
name|p_BufferPrefixContent
operator|->
name|passHashResult
condition|)
comment|/* If PR is not requested, whether TS is requested or not, IC will be copied from TS */
name|p_FmSpBufferOffsets
operator|->
name|hashResultOffset
operator|=
name|p_BufferPrefixContent
operator|->
name|passPrsResult
condition|?
operator|(
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
operator|+
sizeof|sizeof
argument_list|(
name|t_FmPrsResult
argument_list|)
operator|+
literal|8
operator|)
else|:
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
operator|+
literal|8
expr_stmt|;
block|}
if|if
condition|(
name|p_FmSpIntContextDataCopy
operator|->
name|size
condition|)
name|p_FmSpBufMargins
operator|->
name|startMargins
operator|=
call|(
name|uint16_t
call|)
argument_list|(
name|p_FmSpIntContextDataCopy
operator|->
name|extBufOffset
operator|+
name|p_FmSpIntContextDataCopy
operator|->
name|size
argument_list|)
expr_stmt|;
else|else
comment|/* No Internal Context passing, STartMargin is immediately after privateInfo */
name|p_FmSpBufMargins
operator|->
name|startMargins
operator|=
name|p_BufferPrefixContent
operator|->
name|privDataSize
expr_stmt|;
comment|/* save extra space for manip in both external and internal buffers */
if|if
condition|(
name|p_BufferPrefixContent
operator|->
name|manipExtraSpace
condition|)
block|{
name|uint8_t
name|extraSpace
decl_stmt|;
ifdef|#
directive|ifdef
name|FM_CAPWAP_SUPPORT
if|if
condition|(
operator|(
name|p_BufferPrefixContent
operator|->
name|manipExtraSpace
operator|+
name|CAPWAP_FRAG_EXTRA_SPACE
operator|)
operator|>=
literal|256
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"p_BufferPrefixContent->manipExtraSpace should be less than %d"
operator|,
literal|256
operator|-
name|CAPWAP_FRAG_EXTRA_SPACE
operator|)
argument_list|)
expr_stmt|;
name|extraSpace
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|p_BufferPrefixContent
operator|->
name|manipExtraSpace
operator|+
name|CAPWAP_FRAG_EXTRA_SPACE
argument_list|)
expr_stmt|;
else|#
directive|else
name|extraSpace
operator|=
name|p_BufferPrefixContent
operator|->
name|manipExtraSpace
expr_stmt|;
endif|#
directive|endif
comment|/* FM_CAPWAP_SUPPORT */
name|p_FmSpBufferOffsets
operator|->
name|manipOffset
operator|=
name|p_FmSpBufMargins
operator|->
name|startMargins
expr_stmt|;
name|p_FmSpBufMargins
operator|->
name|startMargins
operator|+=
name|extraSpace
expr_stmt|;
operator|*
name|internalBufferOffset
operator|=
name|extraSpace
expr_stmt|;
block|}
comment|/* align data start */
name|tmp
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|p_FmSpBufMargins
operator|->
name|startMargins
operator|%
name|p_BufferPrefixContent
operator|->
name|dataAlign
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp
condition|)
name|p_FmSpBufMargins
operator|->
name|startMargins
operator|+=
operator|(
name|p_BufferPrefixContent
operator|->
name|dataAlign
operator|-
name|tmp
operator|)
expr_stmt|;
name|p_FmSpBufferOffsets
operator|->
name|dataOffset
operator|=
name|p_FmSpBufMargins
operator|->
name|startMargins
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_comment
comment|/*********************** End of inter-module routines ************************/
end_comment

begin_if
if|#
directive|if
operator|(
name|DPAA_VERSION
operator|>=
literal|11
operator|)
end_if

begin_comment
comment|/*****************************************************************************/
end_comment

begin_comment
comment|/*              API routines                                                 */
end_comment

begin_comment
comment|/*****************************************************************************/
end_comment

begin_function
name|t_Handle
name|FM_VSP_Config
parameter_list|(
name|t_FmVspParams
modifier|*
name|p_FmVspParams
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
name|NULL
decl_stmt|;
name|struct
name|fm_storage_profile_params
name|fm_vsp_params
decl_stmt|;
name|p_FmVspEntry
operator|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_FmVspEntry
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmVspEntry
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"p_StorageProfile allocation failed"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|memset
argument_list|(
name|p_FmVspEntry
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmVspEntry
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|=
operator|(
name|t_FmVspEntryDriverParams
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_FmVspEntryDriverParams
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"p_StorageProfile allocation failed"
operator|)
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_FmVspEntry
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|memset
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmVspEntryDriverParams
argument_list|)
argument_list|)
expr_stmt|;
name|fman_vsp_defconfig
argument_list|(
operator|&
name|fm_vsp_params
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaHeaderCacheAttr
operator|=
name|fm_vsp_params
operator|.
name|header_cache_attr
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaIntContextCacheAttr
operator|=
name|fm_vsp_params
operator|.
name|int_context_cache_attr
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaScatterGatherCacheAttr
operator|=
name|fm_vsp_params
operator|.
name|scatter_gather_cache_attr
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaSwapData
operator|=
name|fm_vsp_params
operator|.
name|dma_swap_data
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaWriteOptimize
operator|=
name|fm_vsp_params
operator|.
name|dma_write_optimize
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|noScatherGather
operator|=
name|fm_vsp_params
operator|.
name|no_scather_gather
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|bufferPrefixContent
operator|.
name|privDataSize
operator|=
name|DEFAULT_FM_SP_bufferPrefixContent_privDataSize
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|bufferPrefixContent
operator|.
name|passPrsResult
operator|=
name|DEFAULT_FM_SP_bufferPrefixContent_passPrsResult
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|bufferPrefixContent
operator|.
name|passTimeStamp
operator|=
name|DEFAULT_FM_SP_bufferPrefixContent_passTimeStamp
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|bufferPrefixContent
operator|.
name|passAllOtherPCDInfo
operator|=
name|DEFAULT_FM_SP_bufferPrefixContent_passTimeStamp
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|bufferPrefixContent
operator|.
name|dataAlign
operator|=
name|DEFAULT_FM_SP_bufferPrefixContent_dataAlign
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|liodnOffset
operator|=
name|p_FmVspParams
operator|->
name|liodnOffset
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|extBufPools
argument_list|,
operator|&
name|p_FmVspParams
operator|->
name|extBufPools
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmExtPools
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|h_Fm
operator|=
name|p_FmVspParams
operator|->
name|h_Fm
expr_stmt|;
name|p_FmVspEntry
operator|->
name|portType
operator|=
name|p_FmVspParams
operator|->
name|portParams
operator|.
name|portType
expr_stmt|;
name|p_FmVspEntry
operator|->
name|portId
operator|=
name|p_FmVspParams
operator|->
name|portParams
operator|.
name|portId
expr_stmt|;
name|p_FmVspEntry
operator|->
name|relativeProfileId
operator|=
name|p_FmVspParams
operator|->
name|relativeProfileId
expr_stmt|;
return|return
name|p_FmVspEntry
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_VSP_Init
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|struct
name|fm_storage_profile_params
name|fm_vsp_params
decl_stmt|;
name|uint8_t
name|orderedArray
index|[
name|FM_PORT_MAX_NUM_OF_EXT_POOLS
index|]
decl_stmt|;
name|uint16_t
name|sizesArray
index|[
name|BM_MAX_NUM_OF_POOLS
index|]
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|uint16_t
name|absoluteProfileId
init|=
literal|0
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|CHECK_INIT_PARAMETERS
argument_list|(
name|p_FmVspEntry
argument_list|,
name|CheckParams
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|orderedArray
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|uint8_t
argument_list|)
operator|*
name|FM_PORT_MAX_NUM_OF_EXT_POOLS
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|sizesArray
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|uint16_t
argument_list|)
operator|*
name|BM_MAX_NUM_OF_POOLS
argument_list|)
expr_stmt|;
name|err
operator|=
name|FmSpBuildBufferStructure
argument_list|(
operator|&
name|p_FmVspEntry
operator|->
name|intContext
argument_list|,
operator|&
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|bufferPrefixContent
argument_list|,
operator|&
name|p_FmVspEntry
operator|->
name|bufMargins
argument_list|,
operator|&
name|p_FmVspEntry
operator|->
name|bufferOffsets
argument_list|,
operator|&
name|p_FmVspEntry
operator|->
name|internalBufferOffset
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|err
operator|=
name|CheckParamsGeneratedInternally
argument_list|(
name|p_FmVspEntry
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmSpRegsBase
operator|=
operator|(
expr|struct
name|fm_pcd_storage_profile_regs
operator|*
operator|)
name|FmGetVSPBaseAddr
argument_list|(
name|p_FmVspEntry
operator|->
name|h_Fm
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmVspEntry
operator|->
name|p_FmSpRegsBase
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_VALUE
argument_list|,
operator|(
literal|"impossible to initialize SpRegsBase"
operator|)
argument_list|)
expr_stmt|;
comment|/* order external buffer pools in ascending order of buffer pools sizes */
name|FmSpSetBufPoolsInAscOrderOfBufSizes
argument_list|(
operator|&
operator|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|)
operator|->
name|extBufPools
argument_list|,
name|orderedArray
argument_list|,
name|sizesArray
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|extBufPools
operator|.
name|numOfPoolsUsed
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|extBufPools
operator|.
name|numOfPoolsUsed
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p_FmVspEntry
operator|->
name|extBufPools
operator|.
name|numOfPoolsUsed
condition|;
name|i
operator|++
control|)
block|{
name|p_FmVspEntry
operator|->
name|extBufPools
operator|.
name|extBufPool
index|[
name|i
index|]
operator|.
name|id
operator|=
name|orderedArray
index|[
name|i
index|]
expr_stmt|;
name|p_FmVspEntry
operator|->
name|extBufPools
operator|.
name|extBufPool
index|[
name|i
index|]
operator|.
name|size
operator|=
name|sizesArray
index|[
name|orderedArray
index|[
name|i
index|]
index|]
expr_stmt|;
block|}
comment|/* on user responsibility to fill it according requirement */
name|memset
argument_list|(
operator|&
name|fm_vsp_params
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|fm_storage_profile_params
argument_list|)
argument_list|)
expr_stmt|;
name|fm_vsp_params
operator|.
name|dma_swap_data
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaSwapData
expr_stmt|;
name|fm_vsp_params
operator|.
name|int_context_cache_attr
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaIntContextCacheAttr
expr_stmt|;
name|fm_vsp_params
operator|.
name|header_cache_attr
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaHeaderCacheAttr
expr_stmt|;
name|fm_vsp_params
operator|.
name|scatter_gather_cache_attr
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaScatterGatherCacheAttr
expr_stmt|;
name|fm_vsp_params
operator|.
name|dma_write_optimize
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaWriteOptimize
expr_stmt|;
name|fm_vsp_params
operator|.
name|liodn_offset
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|liodnOffset
expr_stmt|;
name|fm_vsp_params
operator|.
name|no_scather_gather
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|noScatherGather
expr_stmt|;
if|if
condition|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BufPoolDepletion
condition|)
block|{
name|fm_vsp_params
operator|.
name|buf_pool_depletion
operator|.
name|buf_pool_depletion_enabled
operator|=
name|TRUE
expr_stmt|;
name|fm_vsp_params
operator|.
name|buf_pool_depletion
operator|.
name|pools_grp_mode_enable
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BufPoolDepletion
operator|->
name|poolsGrpModeEnable
expr_stmt|;
name|fm_vsp_params
operator|.
name|buf_pool_depletion
operator|.
name|num_pools
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BufPoolDepletion
operator|->
name|numOfPools
expr_stmt|;
name|fm_vsp_params
operator|.
name|buf_pool_depletion
operator|.
name|pools_to_consider
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BufPoolDepletion
operator|->
name|poolsToConsider
expr_stmt|;
name|fm_vsp_params
operator|.
name|buf_pool_depletion
operator|.
name|single_pool_mode_enable
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BufPoolDepletion
operator|->
name|singlePoolModeEnable
expr_stmt|;
name|fm_vsp_params
operator|.
name|buf_pool_depletion
operator|.
name|pools_to_consider_for_single_mode
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BufPoolDepletion
operator|->
name|poolsToConsiderForSingleMode
expr_stmt|;
name|fm_vsp_params
operator|.
name|buf_pool_depletion
operator|.
name|has_pfc_priorities
operator|=
name|TRUE
expr_stmt|;
name|fm_vsp_params
operator|.
name|buf_pool_depletion
operator|.
name|pfc_priorities_en
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BufPoolDepletion
operator|->
name|pfcPrioritiesEn
expr_stmt|;
block|}
else|else
name|fm_vsp_params
operator|.
name|buf_pool_depletion
operator|.
name|buf_pool_depletion_enabled
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BackupBmPools
condition|)
block|{
name|fm_vsp_params
operator|.
name|backup_pools
operator|.
name|num_backup_pools
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BackupBmPools
operator|->
name|numOfBackupPools
expr_stmt|;
name|fm_vsp_params
operator|.
name|backup_pools
operator|.
name|pool_ids
operator|=
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BackupBmPools
operator|->
name|poolIds
expr_stmt|;
block|}
else|else
name|fm_vsp_params
operator|.
name|backup_pools
operator|.
name|num_backup_pools
operator|=
literal|0
expr_stmt|;
name|fm_vsp_params
operator|.
name|fm_ext_pools
operator|.
name|num_pools_used
operator|=
name|p_FmVspEntry
operator|->
name|extBufPools
operator|.
name|numOfPoolsUsed
expr_stmt|;
name|fm_vsp_params
operator|.
name|fm_ext_pools
operator|.
name|ext_buf_pool
operator|=
operator|(
expr|struct
name|fman_ext_pool_params
operator|*
operator|)
operator|&
name|p_FmVspEntry
operator|->
name|extBufPools
operator|.
name|extBufPool
expr_stmt|;
name|fm_vsp_params
operator|.
name|buf_margins
operator|=
operator|(
expr|struct
name|fman_sp_buf_margins
operator|*
operator|)
operator|&
name|p_FmVspEntry
operator|->
name|bufMargins
expr_stmt|;
name|fm_vsp_params
operator|.
name|int_context
operator|=
operator|(
expr|struct
name|fman_sp_int_context_data_copy
operator|*
operator|)
operator|&
name|p_FmVspEntry
operator|->
name|intContext
expr_stmt|;
comment|/* no check on err - it was checked earlier */
name|FmVSPGetAbsoluteProfileId
argument_list|(
name|p_FmVspEntry
operator|->
name|h_Fm
argument_list|,
name|p_FmVspEntry
operator|->
name|portType
argument_list|,
name|p_FmVspEntry
operator|->
name|portId
argument_list|,
name|p_FmVspEntry
operator|->
name|relativeProfileId
argument_list|,
operator|&
name|absoluteProfileId
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmSpRegsBase
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|fm_vsp_params
operator|.
name|int_context
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|fm_vsp_params
operator|.
name|buf_margins
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
operator|(
name|absoluteProfileId
operator|<=
name|FM_VSP_MAX_NUM_OF_ENTRIES
operator|)
argument_list|)
expr_stmt|;
comment|/* Set all registers related to VSP */
name|fman_vsp_init
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmSpRegsBase
argument_list|,
name|absoluteProfileId
argument_list|,
operator|&
name|fm_vsp_params
argument_list|,
name|FM_PORT_MAX_NUM_OF_EXT_POOLS
argument_list|,
name|BM_MAX_NUM_OF_POOLS
argument_list|,
name|FM_MAX_NUM_OF_PFC_PRIORITIES
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|absoluteSpId
operator|=
name|absoluteProfileId
expr_stmt|;
if|if
condition|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
condition|)
name|XX_Free
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|=
name|NULL
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_VSP_Free
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmVsp
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_FmVspEntry
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_VSP_ConfigBufferPrefixContent
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|t_FmBufferPrefixContent
modifier|*
name|p_FmBufferPrefixContent
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|bufferPrefixContent
argument_list|,
name|p_FmBufferPrefixContent
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmBufferPrefixContent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* if dataAlign was not initialized by user, we return to driver's default */
if|if
condition|(
operator|!
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|bufferPrefixContent
operator|.
name|dataAlign
condition|)
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|bufferPrefixContent
operator|.
name|dataAlign
operator|=
name|DEFAULT_FM_SP_bufferPrefixContent_dataAlign
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_VSP_ConfigDmaSwapData
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|e_FmDmaSwapOption
name|swapData
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaSwapData
operator|=
name|swapData
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_VSP_ConfigDmaIcCacheAttr
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|e_FmDmaCacheOption
name|intContextCacheAttr
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaIntContextCacheAttr
operator|=
name|intContextCacheAttr
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_VSP_ConfigDmaHdrAttr
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|e_FmDmaCacheOption
name|headerCacheAttr
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaHeaderCacheAttr
operator|=
name|headerCacheAttr
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_VSP_ConfigDmaScatterGatherAttr
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|e_FmDmaCacheOption
name|scatterGatherCacheAttr
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaScatterGatherCacheAttr
operator|=
name|scatterGatherCacheAttr
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_VSP_ConfigDmaWriteOptimize
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|bool
name|optimize
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|dmaWriteOptimize
operator|=
name|optimize
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_VSP_ConfigNoScatherGather
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|bool
name|noScatherGather
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|noScatherGather
operator|=
name|noScatherGather
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_VSP_ConfigPoolDepletion
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|t_FmBufPoolDepletion
modifier|*
name|p_BufPoolDepletion
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmVsp
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_BufPoolDepletion
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BufPoolDepletion
operator|=
operator|(
name|t_FmBufPoolDepletion
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_FmBufPoolDepletion
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BufPoolDepletion
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"p_BufPoolDepletion allocation failed"
operator|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BufPoolDepletion
argument_list|,
name|p_BufPoolDepletion
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmBufPoolDepletion
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FM_VSP_ConfigBackupPools
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|t_FmBackupBmPools
modifier|*
name|p_BackupBmPools
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|h_FmVsp
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_BackupBmPools
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BackupBmPools
operator|=
operator|(
name|t_FmBackupBmPools
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_FmBackupBmPools
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BackupBmPools
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"p_BackupBmPools allocation failed"
operator|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
operator|->
name|p_BackupBmPools
argument_list|,
name|p_BackupBmPools
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmBackupBmPools
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|uint32_t
name|FM_VSP_GetBufferDataOffset
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
operator|!
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_STATE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|p_FmVspEntry
operator|->
name|bufferOffsets
operator|.
name|dataOffset
return|;
block|}
end_function

begin_function
name|uint8_t
modifier|*
name|FM_VSP_GetBufferICInfo
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|char
modifier|*
name|p_Data
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
operator|!
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmVspEntry
operator|->
name|bufferOffsets
operator|.
name|pcdInfoOffset
operator|==
name|ILLEGAL_BASE
condition|)
return|return
name|NULL
return|;
return|return
operator|(
name|uint8_t
operator|*
operator|)
name|PTR_MOVE
argument_list|(
name|p_Data
argument_list|,
name|p_FmVspEntry
operator|->
name|bufferOffsets
operator|.
name|pcdInfoOffset
argument_list|)
return|;
block|}
end_function

begin_function
name|t_FmPrsResult
modifier|*
name|FM_VSP_GetBufferPrsResult
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|char
modifier|*
name|p_Data
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
operator|!
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmVspEntry
operator|->
name|bufferOffsets
operator|.
name|prsResultOffset
operator|==
name|ILLEGAL_BASE
condition|)
return|return
name|NULL
return|;
return|return
operator|(
name|t_FmPrsResult
operator|*
operator|)
name|PTR_MOVE
argument_list|(
name|p_Data
argument_list|,
name|p_FmVspEntry
operator|->
name|bufferOffsets
operator|.
name|prsResultOffset
argument_list|)
return|;
block|}
end_function

begin_function
name|uint64_t
modifier|*
name|FM_VSP_GetBufferTimeStamp
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|char
modifier|*
name|p_Data
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
operator|!
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmVspEntry
operator|->
name|bufferOffsets
operator|.
name|timeStampOffset
operator|==
name|ILLEGAL_BASE
condition|)
return|return
name|NULL
return|;
return|return
operator|(
name|uint64_t
operator|*
operator|)
name|PTR_MOVE
argument_list|(
name|p_Data
argument_list|,
name|p_FmVspEntry
operator|->
name|bufferOffsets
operator|.
name|timeStampOffset
argument_list|)
return|;
block|}
end_function

begin_function
name|uint8_t
modifier|*
name|FM_VSP_GetBufferHashResult
parameter_list|(
name|t_Handle
name|h_FmVsp
parameter_list|,
name|char
modifier|*
name|p_Data
parameter_list|)
block|{
name|t_FmVspEntry
modifier|*
name|p_FmVspEntry
init|=
operator|(
name|t_FmVspEntry
operator|*
operator|)
name|h_FmVsp
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|p_FmVspEntry
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
operator|!
name|p_FmVspEntry
operator|->
name|p_FmVspEntryDriverParams
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmVspEntry
operator|->
name|bufferOffsets
operator|.
name|hashResultOffset
operator|==
name|ILLEGAL_BASE
condition|)
return|return
name|NULL
return|;
return|return
operator|(
name|uint8_t
operator|*
operator|)
name|PTR_MOVE
argument_list|(
name|p_Data
argument_list|,
name|p_FmVspEntry
operator|->
name|bufferOffsets
operator|.
name|hashResultOffset
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* (DPAA_VERSION>= 11) */
end_comment

end_unit

