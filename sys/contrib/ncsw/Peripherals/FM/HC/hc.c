begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright 2008-2012 Freescale Semiconductor Inc.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions are met:  *     * Redistributions of source code must retain the above copyright  *       notice, this list of conditions and the following disclaimer.  *     * Redistributions in binary form must reproduce the above copyright  *       notice, this list of conditions and the following disclaimer in the  *       documentation and/or other materials provided with the distribution.  *     * Neither the name of Freescale Semiconductor nor the  *       names of its contributors may be used to endorse or promote products  *       derived from this software without specific prior written permission.  *  *  * ALTERNATIVELY, this software may be distributed under the terms of the  * GNU General Public License ("GPL") as published by the Free Software  * Foundation, either version 2 of that License or (at your option) any  * later version.  *  * THIS SOFTWARE IS PROVIDED BY Freescale Semiconductor ``AS IS'' AND ANY  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE  * DISCLAIMED. IN NO EVENT SHALL Freescale Semiconductor BE LIABLE FOR ANY  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|"std_ext.h"
end_include

begin_include
include|#
directive|include
file|"error_ext.h"
end_include

begin_include
include|#
directive|include
file|"sprint_ext.h"
end_include

begin_include
include|#
directive|include
file|"string_ext.h"
end_include

begin_include
include|#
directive|include
file|"fm_common.h"
end_include

begin_include
include|#
directive|include
file|"fm_hc.h"
end_include

begin_comment
comment|/**************************************************************************/
end_comment

begin_comment
comment|/**  @Description       defaults */
end_comment

begin_comment
comment|/***************************************************************************/
end_comment

begin_define
define|#
directive|define
name|DEFAULT_dataMemId
value|0
end_define

begin_define
define|#
directive|define
name|HC_HCOR_OPCODE_PLCR_PRFL
value|0x0
end_define

begin_define
define|#
directive|define
name|HC_HCOR_OPCODE_KG_SCM
value|0x1
end_define

begin_define
define|#
directive|define
name|HC_HCOR_OPCODE_SYNC
value|0x2
end_define

begin_define
define|#
directive|define
name|HC_HCOR_OPCODE_CC
value|0x3
end_define

begin_define
define|#
directive|define
name|HC_HCOR_OPCODE_CC_AGE_MASK
value|0x4
end_define

begin_define
define|#
directive|define
name|HC_HCOR_OPCODE_CC_CAPWAP_REASSM_TIMEOUT
value|0x5
end_define

begin_define
define|#
directive|define
name|HC_HCOR_OPCODE_CC_REASSM_TIMEOUT
value|0x10
end_define

begin_define
define|#
directive|define
name|HC_HCOR_OPCODE_CC_IP_FRAG_INITIALIZATION
value|0x11
end_define

begin_define
define|#
directive|define
name|HC_HCOR_OPCODE_CC_UPDATE_WITH_AGING
value|0x13
end_define

begin_define
define|#
directive|define
name|HC_HCOR_ACTION_REG_REASSM_TIMEOUT_ACTIVE_SHIFT
value|24
end_define

begin_define
define|#
directive|define
name|HC_HCOR_EXTRA_REG_REASSM_TIMEOUT_TSBS_SHIFT
value|24
end_define

begin_define
define|#
directive|define
name|HC_HCOR_EXTRA_REG_CC_AGING_ADD
value|0x80000000
end_define

begin_define
define|#
directive|define
name|HC_HCOR_EXTRA_REG_CC_AGING_REMOVE
value|0x40000000
end_define

begin_define
define|#
directive|define
name|HC_HCOR_EXTRA_REG_CC_AGING_CHANGE_MASK
value|0xC0000000
end_define

begin_define
define|#
directive|define
name|HC_HCOR_EXTRA_REG_CC_REMOVE_INDX_SHIFT
value|24
end_define

begin_define
define|#
directive|define
name|HC_HCOR_EXTRA_REG_CC_REMOVE_INDX_MASK
value|0x1F000000
end_define

begin_define
define|#
directive|define
name|HC_HCOR_ACTION_REG_REASSM_TIMEOUT_RES_SHIFT
value|16
end_define

begin_define
define|#
directive|define
name|HC_HCOR_ACTION_REG_REASSM_TIMEOUT_RES_MASK
value|0xF
end_define

begin_define
define|#
directive|define
name|HC_HCOR_ACTION_REG_IP_FRAG_SCRATCH_POOL_CMD_SHIFT
value|24
end_define

begin_define
define|#
directive|define
name|HC_HCOR_ACTION_REG_IP_FRAG_SCRATCH_POOL_BPID
value|16
end_define

begin_define
define|#
directive|define
name|HC_HCOR_GBL
value|0x20000000
end_define

begin_define
define|#
directive|define
name|HC_HCOR_KG_SCHEME_COUNTER
value|0x00000400
end_define

begin_if
if|#
directive|if
operator|(
name|DPAA_VERSION
operator|==
literal|10
operator|)
end_if

begin_define
define|#
directive|define
name|HC_HCOR_KG_SCHEME_REGS_MASK
value|0xFFFFF800
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|HC_HCOR_KG_SCHEME_REGS_MASK
value|0xFFFFFE00
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* (DPAA_VERSION == 10) */
end_comment

begin_define
define|#
directive|define
name|SIZE_OF_HC_FRAME_PORT_REGS
value|(sizeof(t_HcFrame)-sizeof(struct fman_kg_scheme_regs)+sizeof(t_FmPcdKgPortRegs))
end_define

begin_define
define|#
directive|define
name|SIZE_OF_HC_FRAME_SCHEME_REGS
value|sizeof(t_HcFrame)
end_define

begin_define
define|#
directive|define
name|SIZE_OF_HC_FRAME_PROFILES_REGS
value|(sizeof(t_HcFrame)-sizeof(struct fman_kg_scheme_regs)+sizeof(t_FmPcdPlcrProfileRegs))
end_define

begin_define
define|#
directive|define
name|SIZE_OF_HC_FRAME_PROFILE_CNT
value|(sizeof(t_HcFrame)-sizeof(t_FmPcdPlcrProfileRegs)+sizeof(uint32_t))
end_define

begin_define
define|#
directive|define
name|SIZE_OF_HC_FRAME_READ_OR_CC_DYNAMIC
value|16
end_define

begin_define
define|#
directive|define
name|HC_CMD_POOL_SIZE
value|(INTG_MAX_NUM_OF_CORES)
end_define

begin_define
define|#
directive|define
name|BUILD_FD
parameter_list|(
name|len
parameter_list|)
define|\
value|do {                                      \     memset(&fmFd, 0, sizeof(t_DpaaFD));   \     DPAA_FD_SET_ADDR(&fmFd, p_HcFrame);   \     DPAA_FD_SET_OFFSET(&fmFd, 0);         \     DPAA_FD_SET_LENGTH(&fmFd, len);       \ } while (0)
end_define

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__MWERKS__
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|__GNUC__
argument_list|)
end_if

begin_pragma
pragma|#
directive|pragma
name|pack
name|(
name|push
name|,
name|1
name|)
end_pragma

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* defined(__MWERKS__)&& ... */
end_comment

begin_typedef
typedef|typedef
struct|struct
name|t_FmPcdKgPortRegs
block|{
specifier|volatile
name|uint32_t
name|spReg
decl_stmt|;
specifier|volatile
name|uint32_t
name|cppReg
decl_stmt|;
block|}
name|t_FmPcdKgPortRegs
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
name|t_HcFrame
block|{
specifier|volatile
name|uint32_t
name|opcode
decl_stmt|;
specifier|volatile
name|uint32_t
name|actionReg
decl_stmt|;
specifier|volatile
name|uint32_t
name|extraReg
decl_stmt|;
specifier|volatile
name|uint32_t
name|commandSequence
decl_stmt|;
union|union
block|{
name|struct
name|fman_kg_scheme_regs
name|schemeRegs
decl_stmt|;
name|struct
name|fman_kg_scheme_regs
name|schemeRegsWithoutCounter
decl_stmt|;
name|t_FmPcdPlcrProfileRegs
name|profileRegs
decl_stmt|;
specifier|volatile
name|uint32_t
name|singleRegForWrite
decl_stmt|;
comment|/* for writing SP, CPP, profile counter */
name|t_FmPcdKgPortRegs
name|portRegsForRead
decl_stmt|;
specifier|volatile
name|uint32_t
name|clsPlanEntries
index|[
name|CLS_PLAN_NUM_PER_GRP
index|]
decl_stmt|;
name|t_FmPcdCcCapwapReassmTimeoutParams
name|ccCapwapReassmTimeout
decl_stmt|;
name|t_FmPcdCcReassmTimeoutParams
name|ccReassmTimeout
decl_stmt|;
block|}
name|hcSpecificData
union|;
block|}
name|t_HcFrame
typedef|;
end_typedef

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__MWERKS__
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|__GNUC__
argument_list|)
end_if

begin_pragma
pragma|#
directive|pragma
name|pack
name|(
name|pop
name|)
end_pragma

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* defined(__MWERKS__)&& ... */
end_comment

begin_typedef
typedef|typedef
struct|struct
name|t_FmHc
block|{
name|t_Handle
name|h_FmPcd
decl_stmt|;
name|t_Handle
name|h_HcPortDev
decl_stmt|;
name|t_FmPcdQmEnqueueCallback
modifier|*
name|f_QmEnqueue
decl_stmt|;
comment|/**< A callback for enqueuing frames to the QM */
name|t_Handle
name|h_QmArg
decl_stmt|;
comment|/**< A handle to the QM module */
name|uint8_t
name|dataMemId
decl_stmt|;
comment|/**< Memory partition ID for data buffers */
name|uint32_t
name|seqNum
index|[
name|HC_CMD_POOL_SIZE
index|]
decl_stmt|;
comment|/* FIFO of seqNum to use when                                                                taking buffer */
name|uint32_t
name|nextSeqNumLocation
decl_stmt|;
comment|/* seqNum location in seqNum[] for next buffer */
specifier|volatile
name|bool
name|enqueued
index|[
name|HC_CMD_POOL_SIZE
index|]
decl_stmt|;
comment|/* HC is active - frame is enqueued                                                                and not confirmed yet */
name|t_HcFrame
modifier|*
name|p_Frm
index|[
name|HC_CMD_POOL_SIZE
index|]
decl_stmt|;
block|}
name|t_FmHc
typedef|;
end_typedef

begin_function
specifier|static
name|t_Error
name|FillBufPool
parameter_list|(
name|t_FmHc
modifier|*
name|p_FmHc
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|HC_CMD_POOL_SIZE
condition|;
name|i
operator|++
control|)
block|{
ifdef|#
directive|ifdef
name|FM_LOCKUP_ALIGNMENT_ERRATA_FMAN_SW004
name|p_FmHc
operator|->
name|p_Frm
index|[
name|i
index|]
operator|=
operator|(
name|t_HcFrame
operator|*
operator|)
name|XX_MallocSmart
argument_list|(
operator|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
operator|+
operator|(
literal|16
operator|-
operator|(
sizeof|sizeof
argument_list|(
name|t_FmHc
argument_list|)
operator|%
literal|16
operator|)
operator|)
operator|)
argument_list|,
name|p_FmHc
operator|->
name|dataMemId
argument_list|,
literal|16
argument_list|)
expr_stmt|;
else|#
directive|else
name|p_FmHc
operator|->
name|p_Frm
index|[
name|i
index|]
operator|=
operator|(
name|t_HcFrame
operator|*
operator|)
name|XX_MallocSmart
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|,
name|p_FmHc
operator|->
name|dataMemId
argument_list|,
literal|16
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* FM_LOCKUP_ALIGNMENT_ERRATA_FMAN_SW004 */
if|if
condition|(
operator|!
name|p_FmHc
operator|->
name|p_Frm
index|[
name|i
index|]
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"FM HC frames!"
operator|)
argument_list|)
expr_stmt|;
block|}
comment|/* Initialize FIFO of seqNum to use during GetBuf */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|HC_CMD_POOL_SIZE
condition|;
name|i
operator|++
control|)
block|{
name|p_FmHc
operator|->
name|seqNum
index|[
name|i
index|]
operator|=
name|i
expr_stmt|;
block|}
name|p_FmHc
operator|->
name|nextSeqNumLocation
operator|=
literal|0
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
specifier|static
name|__inline__
name|t_HcFrame
modifier|*
name|GetBuf
parameter_list|(
name|t_FmHc
modifier|*
name|p_FmHc
parameter_list|,
name|uint32_t
modifier|*
name|p_SeqNum
parameter_list|)
block|{
name|uint32_t
name|intFlags
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
name|intFlags
operator|=
name|FmPcdLock
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_FmHc
operator|->
name|nextSeqNumLocation
operator|==
name|HC_CMD_POOL_SIZE
condition|)
block|{
comment|/* No more buffers */
name|FmPcdUnlock
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|intFlags
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
operator|*
name|p_SeqNum
operator|=
name|p_FmHc
operator|->
name|seqNum
index|[
name|p_FmHc
operator|->
name|nextSeqNumLocation
index|]
expr_stmt|;
name|p_FmHc
operator|->
name|nextSeqNumLocation
operator|++
expr_stmt|;
name|FmPcdUnlock
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|intFlags
argument_list|)
expr_stmt|;
return|return
name|p_FmHc
operator|->
name|p_Frm
index|[
operator|*
name|p_SeqNum
index|]
return|;
block|}
end_function

begin_function
specifier|static
name|__inline__
name|void
name|PutBuf
parameter_list|(
name|t_FmHc
modifier|*
name|p_FmHc
parameter_list|,
name|t_HcFrame
modifier|*
name|p_Buf
parameter_list|,
name|uint32_t
name|seqNum
parameter_list|)
block|{
name|uint32_t
name|intFlags
decl_stmt|;
name|UNUSED
argument_list|(
name|p_Buf
argument_list|)
expr_stmt|;
name|intFlags
operator|=
name|FmPcdLock
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmHc
operator|->
name|nextSeqNumLocation
argument_list|)
expr_stmt|;
name|p_FmHc
operator|->
name|nextSeqNumLocation
operator|--
expr_stmt|;
name|p_FmHc
operator|->
name|seqNum
index|[
name|p_FmHc
operator|->
name|nextSeqNumLocation
index|]
operator|=
name|seqNum
expr_stmt|;
name|FmPcdUnlock
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|intFlags
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|__inline__
name|t_Error
name|EnQFrm
parameter_list|(
name|t_FmHc
modifier|*
name|p_FmHc
parameter_list|,
name|t_DpaaFD
modifier|*
name|p_FmFd
parameter_list|,
name|uint32_t
name|seqNum
parameter_list|)
block|{
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|uint32_t
name|intFlags
decl_stmt|;
name|uint32_t
name|timeout
init|=
literal|100
decl_stmt|;
name|intFlags
operator|=
name|FmPcdLock
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
operator|!
name|p_FmHc
operator|->
name|enqueued
index|[
name|seqNum
index|]
argument_list|)
expr_stmt|;
name|p_FmHc
operator|->
name|enqueued
index|[
name|seqNum
index|]
operator|=
name|TRUE
expr_stmt|;
name|FmPcdUnlock
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|intFlags
argument_list|)
expr_stmt|;
name|DBG
argument_list|(
name|TRACE
argument_list|,
operator|(
literal|"Send Hc, SeqNum %d, buff@0x%x, fd offset 0x%x"
operator|,
name|seqNum
operator|,
name|DPAA_FD_GET_ADDR
argument_list|(
name|p_FmFd
argument_list|)
operator|,
name|DPAA_FD_GET_OFFSET
argument_list|(
name|p_FmFd
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|p_FmHc
operator|->
name|f_QmEnqueue
argument_list|(
name|p_FmHc
operator|->
name|h_QmArg
argument_list|,
operator|(
name|void
operator|*
operator|)
name|p_FmFd
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
operator|(
literal|"HC enqueue failed"
operator|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|p_FmHc
operator|->
name|enqueued
index|[
name|seqNum
index|]
operator|&&
operator|--
name|timeout
condition|)
name|XX_UDelay
argument_list|(
literal|100
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|timeout
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_TIMEOUT
argument_list|,
operator|(
literal|"HC Callback, timeout exceeded"
operator|)
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
name|t_Handle
name|FmHcConfigAndInit
parameter_list|(
name|t_FmHcParams
modifier|*
name|p_FmHcParams
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
decl_stmt|;
name|t_FmPortParams
name|fmPortParam
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|p_FmHc
operator|=
operator|(
name|t_FmHc
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_FmHc
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmHc
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC obj"
operator|)
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|memset
argument_list|(
name|p_FmHc
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmHc
argument_list|)
argument_list|)
expr_stmt|;
name|p_FmHc
operator|->
name|h_FmPcd
operator|=
name|p_FmHcParams
operator|->
name|h_FmPcd
expr_stmt|;
name|p_FmHc
operator|->
name|f_QmEnqueue
operator|=
name|p_FmHcParams
operator|->
name|params
operator|.
name|f_QmEnqueue
expr_stmt|;
name|p_FmHc
operator|->
name|h_QmArg
operator|=
name|p_FmHcParams
operator|->
name|params
operator|.
name|h_QmArg
expr_stmt|;
name|p_FmHc
operator|->
name|dataMemId
operator|=
name|DEFAULT_dataMemId
expr_stmt|;
name|err
operator|=
name|FillBufPool
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
name|FmHcFree
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|!
name|FmIsMaster
argument_list|(
name|p_FmHcParams
operator|->
name|h_Fm
argument_list|)
condition|)
return|return
operator|(
name|t_Handle
operator|)
name|p_FmHc
return|;
name|memset
argument_list|(
operator|&
name|fmPortParam
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|fmPortParam
argument_list|)
argument_list|)
expr_stmt|;
name|fmPortParam
operator|.
name|baseAddr
operator|=
name|p_FmHcParams
operator|->
name|params
operator|.
name|portBaseAddr
expr_stmt|;
name|fmPortParam
operator|.
name|portType
operator|=
name|e_FM_PORT_TYPE_OH_HOST_COMMAND
expr_stmt|;
name|fmPortParam
operator|.
name|portId
operator|=
name|p_FmHcParams
operator|->
name|params
operator|.
name|portId
expr_stmt|;
name|fmPortParam
operator|.
name|liodnBase
operator|=
name|p_FmHcParams
operator|->
name|params
operator|.
name|liodnBase
expr_stmt|;
name|fmPortParam
operator|.
name|h_Fm
operator|=
name|p_FmHcParams
operator|->
name|h_Fm
expr_stmt|;
name|fmPortParam
operator|.
name|specificParams
operator|.
name|nonRxParams
operator|.
name|errFqid
operator|=
name|p_FmHcParams
operator|->
name|params
operator|.
name|errFqid
expr_stmt|;
name|fmPortParam
operator|.
name|specificParams
operator|.
name|nonRxParams
operator|.
name|dfltFqid
operator|=
name|p_FmHcParams
operator|->
name|params
operator|.
name|confFqid
expr_stmt|;
name|fmPortParam
operator|.
name|specificParams
operator|.
name|nonRxParams
operator|.
name|qmChannel
operator|=
name|p_FmHcParams
operator|->
name|params
operator|.
name|qmChannel
expr_stmt|;
name|p_FmHc
operator|->
name|h_HcPortDev
operator|=
name|FM_PORT_Config
argument_list|(
operator|&
name|fmPortParam
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_FmHc
operator|->
name|h_HcPortDev
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
operator|(
literal|"FM HC port!"
operator|)
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|err
operator|=
name|FM_PORT_ConfigMaxFrameLength
argument_list|(
name|p_FmHc
operator|->
name|h_HcPortDev
argument_list|,
operator|(
name|uint16_t
operator|)
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
literal|"FM HC port init!"
operator|)
argument_list|)
expr_stmt|;
name|FmHcFree
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
comment|/* final init */
name|err
operator|=
name|FM_PORT_Init
argument_list|(
name|p_FmHc
operator|->
name|h_HcPortDev
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
literal|"FM HC port init!"
operator|)
argument_list|)
expr_stmt|;
name|FmHcFree
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|err
operator|=
name|FM_PORT_Enable
argument_list|(
name|p_FmHc
operator|->
name|h_HcPortDev
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
operator|(
literal|"FM HC port enable!"
operator|)
argument_list|)
expr_stmt|;
name|FmHcFree
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
operator|(
name|t_Handle
operator|)
name|p_FmHc
return|;
block|}
end_function

begin_function
name|void
name|FmHcFree
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|p_FmHc
condition|)
return|return;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|HC_CMD_POOL_SIZE
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|p_FmHc
operator|->
name|p_Frm
index|[
name|i
index|]
condition|)
name|XX_FreeSmart
argument_list|(
name|p_FmHc
operator|->
name|p_Frm
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
break|break;
if|if
condition|(
name|p_FmHc
operator|->
name|h_HcPortDev
condition|)
name|FM_PORT_Free
argument_list|(
name|p_FmHc
operator|->
name|h_HcPortDev
argument_list|)
expr_stmt|;
name|XX_Free
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****************************************************************************/
end_comment

begin_function
name|t_Error
name|FmHcSetFramesDataMemory
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|uint8_t
name|memId
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|int
name|i
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmHc
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_FmHc
operator|->
name|dataMemId
operator|=
name|memId
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|HC_CMD_POOL_SIZE
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|p_FmHc
operator|->
name|p_Frm
index|[
name|i
index|]
condition|)
name|XX_FreeSmart
argument_list|(
name|p_FmHc
operator|->
name|p_Frm
index|[
name|i
index|]
argument_list|)
expr_stmt|;
return|return
name|FillBufPool
argument_list|(
name|p_FmHc
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|FmHcTxConf
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_DpaaFD
modifier|*
name|p_Fd
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|uint32_t
name|intFlags
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
name|intFlags
operator|=
name|FmPcdLock
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|=
operator|(
name|t_HcFrame
operator|*
operator|)
name|PTR_MOVE
argument_list|(
name|DPAA_FD_GET_ADDR
argument_list|(
name|p_Fd
argument_list|)
argument_list|,
name|DPAA_FD_GET_OFFSET
argument_list|(
name|p_Fd
argument_list|)
argument_list|)
expr_stmt|;
name|DBG
argument_list|(
name|TRACE
argument_list|,
operator|(
literal|"Hc Conf, SeqNum %d, FD@0x%x, fd offset 0x%x"
operator|,
name|p_HcFrame
operator|->
name|commandSequence
operator|,
name|DPAA_FD_GET_ADDR
argument_list|(
name|p_Fd
argument_list|)
operator|,
name|DPAA_FD_GET_OFFSET
argument_list|(
name|p_Fd
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|p_FmHc
operator|->
name|enqueued
index|[
name|p_HcFrame
operator|->
name|commandSequence
index|]
operator|)
condition|)
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_INVALID_FRAME
argument_list|,
operator|(
literal|"Not an Host-Command frame received!"
operator|)
argument_list|)
expr_stmt|;
else|else
name|p_FmHc
operator|->
name|enqueued
index|[
name|p_HcFrame
operator|->
name|commandSequence
index|]
operator|=
name|FALSE
expr_stmt|;
name|FmPcdUnlock
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|intFlags
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdKgSetScheme
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_Handle
name|h_Scheme
parameter_list|,
name|struct
name|fman_kg_scheme_regs
modifier|*
name|p_SchemeRegs
parameter_list|,
name|bool
name|updateCounter
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|uint8_t
name|physicalSchemeId
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|physicalSchemeId
operator|=
name|FmPcdKgGetSchemeId
argument_list|(
name|h_Scheme
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_KG_SCM
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdKgBuildWriteSchemeActionReg
argument_list|(
name|physicalSchemeId
argument_list|,
name|updateCounter
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
name|HC_HCOR_KG_SCHEME_REGS_MASK
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
argument_list|,
name|p_SchemeRegs
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|fman_kg_scheme_regs
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|updateCounter
condition|)
block|{
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_dv0
operator|=
name|p_SchemeRegs
operator|->
name|kgse_dv0
expr_stmt|;
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_dv1
operator|=
name|p_SchemeRegs
operator|->
name|kgse_dv1
expr_stmt|;
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_ccbs
operator|=
name|p_SchemeRegs
operator|->
name|kgse_ccbs
expr_stmt|;
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_mv
operator|=
name|p_SchemeRegs
operator|->
name|kgse_mv
expr_stmt|;
block|}
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdKgDeleteScheme
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_Handle
name|h_Scheme
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|uint8_t
name|physicalSchemeId
init|=
name|FmPcdKgGetSchemeId
argument_list|(
name|h_Scheme
argument_list|)
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_KG_SCM
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdKgBuildWriteSchemeActionReg
argument_list|(
name|physicalSchemeId
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
name|HC_HCOR_KG_SCHEME_REGS_MASK
expr_stmt|;
name|memset
argument_list|(
operator|&
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|fman_kg_scheme_regs
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdKgCcGetSetParams
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_Handle
name|h_Scheme
parameter_list|,
name|uint32_t
name|requiredAction
parameter_list|,
name|uint32_t
name|value
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|uint8_t
name|relativeSchemeId
decl_stmt|;
name|uint8_t
name|physicalSchemeId
init|=
name|FmPcdKgGetSchemeId
argument_list|(
name|h_Scheme
argument_list|)
decl_stmt|;
name|uint32_t
name|tmpReg32
init|=
literal|0
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
comment|/* Scheme is locked by calling routine */
comment|/* WARNING - this lock will not be efficient if other HC routine will attempt to change      * "kgse_mode" or "kgse_om" without locking scheme !      */
name|relativeSchemeId
operator|=
name|FmPcdKgGetRelativeSchemeId
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|physicalSchemeId
argument_list|)
expr_stmt|;
if|if
condition|(
name|relativeSchemeId
operator|==
name|FM_PCD_KG_NUM_OF_SCHEMES
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_IN_RANGE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|FmPcdKgGetRequiredActionFlag
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
operator|||
operator|!
operator|(
name|FmPcdKgGetRequiredAction
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
operator|&
name|requiredAction
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|requiredAction
operator|&
name|UPDATE_NIA_ENQ_WITHOUT_DMA
operator|)
operator|&&
operator|(
name|FmPcdKgGetNextEngine
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
operator|==
name|e_FM_PCD_PLCR
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|FmPcdKgIsDirectPlcr
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
operator|==
name|FALSE
operator|)
operator|||
operator|(
name|FmPcdKgIsDistrOnPlcrProfile
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
operator|==
name|TRUE
operator|)
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_SUPPORTED
argument_list|,
operator|(
literal|"In this situation PP can not be with distribution and has to be shared"
operator|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|FmPcdPlcrCcGetSetParams
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|FmPcdKgGetRelativeProfileId
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
argument_list|,
name|requiredAction
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
else|else
comment|/* From here we deal with KG-Schemes only */
block|{
comment|/* Pre change general code */
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_KG_SCM
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdKgBuildReadSchemeActionReg
argument_list|(
name|physicalSchemeId
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
name|HC_HCOR_KG_SCHEME_REGS_MASK
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
name|SIZE_OF_HC_FRAME_READ_OR_CC_DYNAMIC
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
comment|/* specific change */
if|if
condition|(
operator|(
name|requiredAction
operator|&
name|UPDATE_NIA_ENQ_WITHOUT_DMA
operator|)
operator|&&
operator|(
operator|(
name|FmPcdKgGetNextEngine
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
operator|==
name|e_FM_PCD_DONE
operator|)
operator|&&
operator|(
name|FmPcdKgGetDoneAction
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
operator|==
name|e_FM_PCD_ENQ_FRAME
operator|)
operator|)
condition|)
block|{
name|tmpReg32
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_mode
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|tmpReg32
operator|&
operator|(
name|NIA_ENG_BMI
operator||
name|NIA_BMI_AC_ENQ_FRAME
operator|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_mode
operator|=
name|tmpReg32
operator||
name|NIA_BMI_AC_ENQ_FRAME_WITHOUT_DMA
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|requiredAction
operator|&
name|UPDATE_KG_NIA_CC_WA
operator|)
operator|&&
operator|(
name|FmPcdKgGetNextEngine
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|relativeSchemeId
argument_list|)
operator|==
name|e_FM_PCD_CC
operator|)
condition|)
block|{
name|tmpReg32
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_mode
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|tmpReg32
operator|&
operator|(
name|NIA_ENG_FM_CTL
operator||
name|NIA_FM_CTL_AC_CC
operator|)
argument_list|)
expr_stmt|;
name|tmpReg32
operator|&=
operator|~
name|NIA_FM_CTL_AC_CC
expr_stmt|;
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_mode
operator|=
name|tmpReg32
operator||
name|NIA_FM_CTL_AC_PRE_CC
expr_stmt|;
block|}
if|if
condition|(
name|requiredAction
operator|&
name|UPDATE_KG_OPT_MODE
condition|)
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_om
operator|=
name|value
expr_stmt|;
if|if
condition|(
name|requiredAction
operator|&
name|UPDATE_KG_NIA
condition|)
block|{
name|tmpReg32
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_mode
expr_stmt|;
name|tmpReg32
operator|&=
operator|~
operator|(
name|NIA_ENG_MASK
operator||
name|NIA_AC_MASK
operator|)
expr_stmt|;
name|tmpReg32
operator||=
name|value
expr_stmt|;
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_mode
operator|=
name|tmpReg32
expr_stmt|;
block|}
comment|/* Post change general code */
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_KG_SCM
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdKgBuildWriteSchemeActionReg
argument_list|(
name|physicalSchemeId
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
name|HC_HCOR_KG_SCHEME_REGS_MASK
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|uint32_t
name|FmHcPcdKgGetSchemeCounter
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_Handle
name|h_Scheme
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|uint32_t
name|retVal
decl_stmt|;
name|uint8_t
name|relativeSchemeId
decl_stmt|;
name|uint8_t
name|physicalSchemeId
init|=
name|FmPcdKgGetSchemeId
argument_list|(
name|h_Scheme
argument_list|)
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|relativeSchemeId
operator|=
name|FmPcdKgGetRelativeSchemeId
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|physicalSchemeId
argument_list|)
expr_stmt|;
if|if
condition|(
name|relativeSchemeId
operator|==
name|FM_PCD_KG_NUM_OF_SCHEMES
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_IN_RANGE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
comment|/* first read scheme and check that it is valid */
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_KG_SCM
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdKgBuildReadSchemeActionReg
argument_list|(
name|physicalSchemeId
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
name|HC_HCOR_KG_SCHEME_REGS_MASK
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
name|SIZE_OF_HC_FRAME_READ_OR_CC_DYNAMIC
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|FmPcdKgHwSchemeIsValid
argument_list|(
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_mode
argument_list|)
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_ALREADY_EXISTS
argument_list|,
operator|(
literal|"Scheme is invalid"
operator|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|retVal
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|schemeRegs
operator|.
name|kgse_spc
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
return|return
name|retVal
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdKgSetSchemeCounter
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_Handle
name|h_Scheme
parameter_list|,
name|uint32_t
name|value
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|uint8_t
name|relativeSchemeId
decl_stmt|,
name|physicalSchemeId
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|physicalSchemeId
operator|=
name|FmPcdKgGetSchemeId
argument_list|(
name|h_Scheme
argument_list|)
expr_stmt|;
name|relativeSchemeId
operator|=
name|FmPcdKgGetRelativeSchemeId
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|physicalSchemeId
argument_list|)
expr_stmt|;
if|if
condition|(
name|relativeSchemeId
operator|==
name|FM_PCD_KG_NUM_OF_SCHEMES
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NOT_IN_RANGE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
comment|/* first read scheme and check that it is valid */
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_KG_SCM
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdKgBuildWriteSchemeActionReg
argument_list|(
name|physicalSchemeId
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
name|HC_HCOR_KG_SCHEME_COUNTER
expr_stmt|;
comment|/* write counter */
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|singleRegForWrite
operator|=
name|value
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdKgSetClsPlan
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_FmPcdKgInterModuleClsPlanSet
modifier|*
name|p_Set
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|uint8_t
name|i
decl_stmt|,
name|idx
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|p_Set
operator|->
name|baseEntry
init|;
name|i
operator|<
operator|(
name|p_Set
operator|->
name|baseEntry
operator|+
name|p_Set
operator|->
name|numOfClsPlanEntries
operator|)
condition|;
name|i
operator|+=
literal|8
control|)
block|{
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_KG_SCM
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdKgBuildWriteClsPlanBlockActionReg
argument_list|(
call|(
name|uint8_t
call|)
argument_list|(
name|i
operator|/
name|CLS_PLAN_NUM_PER_GRP
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
name|HC_HCOR_KG_SCHEME_REGS_MASK
expr_stmt|;
name|idx
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|i
operator|-
name|p_Set
operator|->
name|baseEntry
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|clsPlanEntries
argument_list|,
operator|&
name|p_Set
operator|->
name|vectors
index|[
name|idx
index|]
argument_list|,
name|CLS_PLAN_NUM_PER_GRP
operator|*
sizeof|sizeof
argument_list|(
name|uint32_t
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
block|}
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdKgDeleteClsPlan
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|uint8_t
name|grpId
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_FmPcdKgInterModuleClsPlanSet
modifier|*
name|p_ClsPlanSet
decl_stmt|;
name|p_ClsPlanSet
operator|=
operator|(
name|t_FmPcdKgInterModuleClsPlanSet
operator|*
operator|)
name|XX_Malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|t_FmPcdKgInterModuleClsPlanSet
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_ClsPlanSet
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"Classification plan set"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_ClsPlanSet
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdKgInterModuleClsPlanSet
argument_list|)
argument_list|)
expr_stmt|;
name|p_ClsPlanSet
operator|->
name|baseEntry
operator|=
name|FmPcdKgGetClsPlanGrpBase
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|grpId
argument_list|)
expr_stmt|;
name|p_ClsPlanSet
operator|->
name|numOfClsPlanEntries
operator|=
name|FmPcdKgGetClsPlanGrpSize
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|grpId
argument_list|)
expr_stmt|;
name|ASSERT_COND
argument_list|(
name|p_ClsPlanSet
operator|->
name|numOfClsPlanEntries
operator|<=
name|FM_PCD_MAX_NUM_OF_CLS_PLANS
argument_list|)
expr_stmt|;
if|if
condition|(
name|FmHcPcdKgSetClsPlan
argument_list|(
name|p_FmHc
argument_list|,
name|p_ClsPlanSet
argument_list|)
operator|!=
name|E_OK
condition|)
block|{
name|XX_Free
argument_list|(
name|p_ClsPlanSet
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
name|XX_Free
argument_list|(
name|p_ClsPlanSet
argument_list|)
expr_stmt|;
name|FmPcdKgDestroyClsPlanGrp
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|grpId
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdCcCapwapTimeoutReassm
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_FmPcdCcCapwapReassmTimeoutParams
modifier|*
name|p_CcCapwapReassmTimeoutParams
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|h_FmHc
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_CC_CAPWAP_REASSM_TIMEOUT
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|ccCapwapReassmTimeout
argument_list|,
name|p_CcCapwapReassmTimeoutParams
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdCcCapwapReassmTimeoutParams
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdCcIpFragScratchPollCmd
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|bool
name|fill
parameter_list|,
name|t_FmPcdCcFragScratchPoolCmdParams
modifier|*
name|p_FmPcdCcFragScratchPoolCmdParams
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|h_FmHc
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_CC_IP_FRAG_INITIALIZATION
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
call|(
name|uint32_t
call|)
argument_list|(
operator|(
operator|(
name|fill
operator|==
name|TRUE
operator|)
condition|?
literal|0
else|:
literal|1
operator|)
operator|<<
name|HC_HCOR_ACTION_REG_IP_FRAG_SCRATCH_POOL_CMD_SHIFT
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator||=
name|p_FmPcdCcFragScratchPoolCmdParams
operator|->
name|bufferPoolId
operator|<<
name|HC_HCOR_ACTION_REG_IP_FRAG_SCRATCH_POOL_BPID
expr_stmt|;
if|if
condition|(
name|fill
operator|==
name|TRUE
condition|)
block|{
name|p_HcFrame
operator|->
name|extraReg
operator|=
name|p_FmPcdCcFragScratchPoolCmdParams
operator|->
name|numOfBuffers
expr_stmt|;
block|}
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
name|p_FmPcdCcFragScratchPoolCmdParams
operator|->
name|numOfBuffers
operator|=
name|p_HcFrame
operator|->
name|extraReg
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdCcTimeoutReassm
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_FmPcdCcReassmTimeoutParams
modifier|*
name|p_CcReassmTimeoutParams
parameter_list|,
name|uint8_t
modifier|*
name|p_Result
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|h_FmHc
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_CC_REASSM_TIMEOUT
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
call|(
name|uint32_t
call|)
argument_list|(
operator|(
name|p_CcReassmTimeoutParams
operator|->
name|activate
condition|?
literal|0
else|:
literal|1
operator|)
operator|<<
name|HC_HCOR_ACTION_REG_REASSM_TIMEOUT_ACTIVE_SHIFT
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
operator|(
name|p_CcReassmTimeoutParams
operator|->
name|tsbs
operator|<<
name|HC_HCOR_EXTRA_REG_REASSM_TIMEOUT_TSBS_SHIFT
operator|)
operator||
name|p_CcReassmTimeoutParams
operator|->
name|iprcpt
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
operator|*
name|p_Result
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|p_HcFrame
operator|->
name|actionReg
operator|>>
name|HC_HCOR_ACTION_REG_REASSM_TIMEOUT_RES_SHIFT
operator|)
operator|&
name|HC_HCOR_ACTION_REG_REASSM_TIMEOUT_RES_MASK
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdPlcrCcGetSetParams
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|uint16_t
name|absoluteProfileId
parameter_list|,
name|uint32_t
name|requiredAction
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|uint32_t
name|tmpReg32
init|=
literal|0
decl_stmt|;
name|uint32_t
name|requiredActionTmp
decl_stmt|,
name|requiredActionFlag
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|h_FmHc
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Profile is locked by calling routine */
comment|/* WARNING - this lock will not be efficient if other HC routine will attempt to change      * "fmpl_pegnia" "fmpl_peynia" or "fmpl_pernia" without locking Profile !      */
name|requiredActionTmp
operator|=
name|FmPcdPlcrGetRequiredAction
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|absoluteProfileId
argument_list|)
expr_stmt|;
name|requiredActionFlag
operator|=
name|FmPcdPlcrGetRequiredActionFlag
argument_list|(
name|p_FmHc
operator|->
name|h_FmPcd
argument_list|,
name|absoluteProfileId
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|requiredActionFlag
operator|||
operator|!
operator|(
name|requiredActionTmp
operator|&
name|requiredAction
operator|)
condition|)
block|{
if|if
condition|(
name|requiredAction
operator|&
name|UPDATE_NIA_ENQ_WITHOUT_DMA
condition|)
block|{
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
comment|/* first read scheme and check that it is valid */
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_PLCR_PRFL
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdPlcrBuildReadPlcrActionReg
argument_list|(
name|absoluteProfileId
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
literal|0x00008000
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
name|SIZE_OF_HC_FRAME_READ_OR_CC_DYNAMIC
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
name|tmpReg32
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|profileRegs
operator|.
name|fmpl_pegnia
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|tmpReg32
operator|&
operator|(
name|NIA_ENG_BMI
operator||
name|NIA_BMI_AC_ENQ_FRAME
operator|)
operator|)
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"Next engine of this policer profile has to be assigned to FM_PCD_DONE"
operator|)
argument_list|)
expr_stmt|;
block|}
name|tmpReg32
operator||=
name|NIA_BMI_AC_ENQ_FRAME_WITHOUT_DMA
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_PLCR_PRFL
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdPlcrBuildWritePlcrActionReg
argument_list|(
name|absoluteProfileId
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator||=
name|FmPcdPlcrBuildNiaProfileReg
argument_list|(
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
literal|0x00008000
expr_stmt|;
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|singleRegForWrite
operator|=
name|tmpReg32
expr_stmt|;
name|BUILD_FD
argument_list|(
name|SIZE_OF_HC_FRAME_PROFILE_CNT
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
name|tmpReg32
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|profileRegs
operator|.
name|fmpl_peynia
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|tmpReg32
operator|&
operator|(
name|NIA_ENG_BMI
operator||
name|NIA_BMI_AC_ENQ_FRAME
operator|)
operator|)
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"Next engine of this policer profile has to be assigned to FM_PCD_DONE"
operator|)
argument_list|)
expr_stmt|;
block|}
name|tmpReg32
operator||=
name|NIA_BMI_AC_ENQ_FRAME_WITHOUT_DMA
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_PLCR_PRFL
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdPlcrBuildWritePlcrActionReg
argument_list|(
name|absoluteProfileId
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator||=
name|FmPcdPlcrBuildNiaProfileReg
argument_list|(
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
literal|0x00008000
expr_stmt|;
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|singleRegForWrite
operator|=
name|tmpReg32
expr_stmt|;
name|BUILD_FD
argument_list|(
name|SIZE_OF_HC_FRAME_PROFILE_CNT
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
name|tmpReg32
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|profileRegs
operator|.
name|fmpl_pernia
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|tmpReg32
operator|&
operator|(
name|NIA_ENG_BMI
operator||
name|NIA_BMI_AC_ENQ_FRAME
operator|)
operator|)
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_STATE
argument_list|,
operator|(
literal|"Next engine of this policer profile has to be assigned to FM_PCD_DONE"
operator|)
argument_list|)
expr_stmt|;
block|}
name|tmpReg32
operator||=
name|NIA_BMI_AC_ENQ_FRAME_WITHOUT_DMA
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_PLCR_PRFL
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdPlcrBuildWritePlcrActionReg
argument_list|(
name|absoluteProfileId
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator||=
name|FmPcdPlcrBuildNiaProfileReg
argument_list|(
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
literal|0x00008000
expr_stmt|;
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|singleRegForWrite
operator|=
name|tmpReg32
expr_stmt|;
name|BUILD_FD
argument_list|(
name|SIZE_OF_HC_FRAME_PROFILE_CNT
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdPlcrSetProfile
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_Handle
name|h_Profile
parameter_list|,
name|t_FmPcdPlcrProfileRegs
modifier|*
name|p_PlcrRegs
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|uint16_t
name|profileIndx
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|profileIndx
operator|=
name|FmPcdPlcrProfileGetAbsoluteId
argument_list|(
name|h_Profile
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_PLCR_PRFL
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdPlcrBuildWritePlcrActionRegs
argument_list|(
name|profileIndx
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
literal|0x00008000
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|profileRegs
argument_list|,
name|p_PlcrRegs
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdPlcrProfileRegs
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdPlcrDeleteProfile
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_Handle
name|h_Profile
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|uint16_t
name|absoluteProfileId
init|=
name|FmPcdPlcrProfileGetAbsoluteId
argument_list|(
name|h_Profile
argument_list|)
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_PLCR_PRFL
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdPlcrBuildWritePlcrActionReg
argument_list|(
name|absoluteProfileId
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator||=
literal|0x00008000
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
literal|0x00008000
expr_stmt|;
name|memset
argument_list|(
operator|&
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|profileRegs
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_FmPcdPlcrProfileRegs
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdPlcrSetProfileCounter
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_Handle
name|h_Profile
parameter_list|,
name|e_FmPcdPlcrProfileCounters
name|counter
parameter_list|,
name|uint32_t
name|value
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|uint16_t
name|absoluteProfileId
init|=
name|FmPcdPlcrProfileGetAbsoluteId
argument_list|(
name|h_Profile
argument_list|)
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
comment|/* first read scheme and check that it is valid */
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_PLCR_PRFL
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdPlcrBuildWritePlcrActionReg
argument_list|(
name|absoluteProfileId
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator||=
name|FmPcdPlcrBuildCounterProfileReg
argument_list|(
name|counter
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
literal|0x00008000
expr_stmt|;
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|singleRegForWrite
operator|=
name|value
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
name|SIZE_OF_HC_FRAME_PROFILE_CNT
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|uint32_t
name|FmHcPcdPlcrGetProfileCounter
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|t_Handle
name|h_Profile
parameter_list|,
name|e_FmPcdPlcrProfileCounters
name|counter
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|uint16_t
name|absoluteProfileId
init|=
name|FmPcdPlcrProfileGetAbsoluteId
argument_list|(
name|h_Profile
argument_list|)
decl_stmt|;
name|t_Error
name|err
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|uint32_t
name|retVal
init|=
literal|0
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|SANITY_CHECK_RETURN_VALUE
argument_list|(
name|h_FmHc
argument_list|,
name|E_INVALID_HANDLE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* first read scheme and check that it is valid */
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
block|{
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_PLCR_PRFL
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdPlcrBuildReadPlcrActionReg
argument_list|(
name|absoluteProfileId
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
literal|0x00008000
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
name|SIZE_OF_HC_FRAME_READ_OR_CC_DYNAMIC
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|REPORT_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
switch|switch
condition|(
name|counter
condition|)
block|{
case|case
name|e_FM_PCD_PLCR_PROFILE_GREEN_PACKET_TOTAL_COUNTER
case|:
name|retVal
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|profileRegs
operator|.
name|fmpl_pegpc
expr_stmt|;
break|break;
case|case
name|e_FM_PCD_PLCR_PROFILE_YELLOW_PACKET_TOTAL_COUNTER
case|:
name|retVal
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|profileRegs
operator|.
name|fmpl_peypc
expr_stmt|;
break|break;
case|case
name|e_FM_PCD_PLCR_PROFILE_RED_PACKET_TOTAL_COUNTER
case|:
name|retVal
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|profileRegs
operator|.
name|fmpl_perpc
expr_stmt|;
break|break;
case|case
name|e_FM_PCD_PLCR_PROFILE_RECOLOURED_YELLOW_PACKET_TOTAL_COUNTER
case|:
name|retVal
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|profileRegs
operator|.
name|fmpl_perypc
expr_stmt|;
break|break;
case|case
name|e_FM_PCD_PLCR_PROFILE_RECOLOURED_RED_PACKET_TOTAL_COUNTER
case|:
name|retVal
operator|=
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|profileRegs
operator|.
name|fmpl_perrpc
expr_stmt|;
break|break;
default|default:
name|REPORT_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|E_INVALID_SELECTION
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
return|return
name|retVal
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcKgWriteSp
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|uint8_t
name|hardwarePortId
parameter_list|,
name|uint32_t
name|spReg
parameter_list|,
name|bool
name|add
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
comment|/* first read SP register */
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_KG_SCM
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdKgBuildReadPortSchemeBindActionReg
argument_list|(
name|hardwarePortId
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
name|HC_HCOR_KG_SCHEME_REGS_MASK
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
name|SIZE_OF_HC_FRAME_PORT_REGS
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
operator|)
operator|!=
name|E_OK
condition|)
block|{
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
block|}
comment|/* spReg is the first reg, so we can use it both for read and for write */
if|if
condition|(
name|add
condition|)
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|portRegsForRead
operator|.
name|spReg
operator||=
name|spReg
expr_stmt|;
else|else
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|portRegsForRead
operator|.
name|spReg
operator|&=
operator|~
name|spReg
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdKgBuildWritePortSchemeBindActionReg
argument_list|(
name|hardwarePortId
argument_list|)
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcKgWriteCpp
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|uint8_t
name|hardwarePortId
parameter_list|,
name|uint32_t
name|cppReg
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
comment|/* first read SP register */
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_KG_SCM
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|FmPcdKgBuildWritePortClsPlanBindActionReg
argument_list|(
name|hardwarePortId
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
name|HC_HCOR_KG_SCHEME_REGS_MASK
expr_stmt|;
name|p_HcFrame
operator|->
name|hcSpecificData
operator|.
name|singleRegForWrite
operator|=
name|cppReg
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdCcDoDynamicChange
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|,
name|uint32_t
name|oldAdAddrOffset
parameter_list|,
name|uint32_t
name|newAdAddrOffset
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|SANITY_CHECK_RETURN_ERROR
argument_list|(
name|p_FmHc
argument_list|,
name|E_INVALID_HANDLE
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_CC
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
name|newAdAddrOffset
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator||=
literal|0xc0000000
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
name|oldAdAddrOffset
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
name|SIZE_OF_HC_FRAME_READ_OR_CC_DYNAMIC
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MAJOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Error
name|FmHcPcdSync
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
name|t_HcFrame
modifier|*
name|p_HcFrame
decl_stmt|;
name|t_DpaaFD
name|fmFd
decl_stmt|;
name|t_Error
name|err
init|=
name|E_OK
decl_stmt|;
name|uint32_t
name|seqNum
decl_stmt|;
name|ASSERT_COND
argument_list|(
name|p_FmHc
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|=
name|GetBuf
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_HcFrame
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|E_NO_MEMORY
argument_list|,
operator|(
literal|"HC Frame object"
operator|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p_HcFrame
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
comment|/* first read SP register */
name|p_HcFrame
operator|->
name|opcode
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|HC_HCOR_GBL
operator||
name|HC_HCOR_OPCODE_SYNC
argument_list|)
expr_stmt|;
name|p_HcFrame
operator|->
name|actionReg
operator|=
literal|0
expr_stmt|;
name|p_HcFrame
operator|->
name|extraReg
operator|=
literal|0
expr_stmt|;
name|p_HcFrame
operator|->
name|commandSequence
operator|=
name|seqNum
expr_stmt|;
name|BUILD_FD
argument_list|(
sizeof|sizeof
argument_list|(
name|t_HcFrame
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|EnQFrm
argument_list|(
name|p_FmHc
argument_list|,
operator|&
name|fmFd
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
name|PutBuf
argument_list|(
name|p_FmHc
argument_list|,
name|p_HcFrame
argument_list|,
name|seqNum
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|E_OK
condition|)
name|RETURN_ERROR
argument_list|(
name|MINOR
argument_list|,
name|err
argument_list|,
name|NO_MSG
argument_list|)
expr_stmt|;
return|return
name|E_OK
return|;
block|}
end_function

begin_function
name|t_Handle
name|FmHcGetPort
parameter_list|(
name|t_Handle
name|h_FmHc
parameter_list|)
block|{
name|t_FmHc
modifier|*
name|p_FmHc
init|=
operator|(
name|t_FmHc
operator|*
operator|)
name|h_FmHc
decl_stmt|;
return|return
name|p_FmHc
operator|->
name|h_HcPortDev
return|;
block|}
end_function

end_unit

