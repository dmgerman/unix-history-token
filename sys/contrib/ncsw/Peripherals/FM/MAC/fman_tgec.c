begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright 2008-2012 Freescale Semiconductor Inc.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions are met:  *     * Redistributions of source code must retain the above copyright  *       notice, this list of conditions and the following disclaimer.  *     * Redistributions in binary form must reproduce the above copyright  *       notice, this list of conditions and the following disclaimer in the  *       documentation and/or other materials provided with the distribution.  *     * Neither the name of Freescale Semiconductor nor the  *       names of its contributors may be used to endorse or promote products  *       derived from this software without specific prior written permission.  *  *  * ALTERNATIVELY, this software may be distributed under the terms of the  * GNU General Public License ("GPL") as published by the Free Software  * Foundation, either version 2 of that License or (at your option) any  * later version.  *  * THIS SOFTWARE IS PROVIDED BY Freescale Semiconductor ``AS IS'' AND ANY  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE  * DISCLAIMED. IN NO EVENT SHALL Freescale Semiconductor BE LIABLE FOR ANY  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|"fsl_fman_tgec.h"
end_include

begin_function
name|void
name|fman_tgec_set_mac_address
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|uint8_t
modifier|*
name|adr
parameter_list|)
block|{
name|uint32_t
name|tmp0
decl_stmt|,
name|tmp1
decl_stmt|;
name|tmp0
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|adr
index|[
literal|0
index|]
operator||
name|adr
index|[
literal|1
index|]
operator|<<
literal|8
operator||
name|adr
index|[
literal|2
index|]
operator|<<
literal|16
operator||
name|adr
index|[
literal|3
index|]
operator|<<
literal|24
argument_list|)
expr_stmt|;
name|tmp1
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|adr
index|[
literal|4
index|]
operator||
name|adr
index|[
literal|5
index|]
operator|<<
literal|8
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp0
argument_list|,
operator|&
name|regs
operator|->
name|mac_addr_0
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp1
argument_list|,
operator|&
name|regs
operator|->
name|mac_addr_1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_tgec_reset_stat
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
name|tmp
operator||=
name|CMD_CFG_STAT_CLR
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
while|while
condition|(
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|command_config
argument_list|)
operator|&
name|CMD_CFG_STAT_CLR
condition|)
empty_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|GET_TGEC_CNTR_64
parameter_list|(
name|bn
parameter_list|)
define|\
value|(((uint64_t)ioread32be(&regs->bn ## _u)<< 32) | \ 			ioread32be(&regs->bn ## _l))
end_define

begin_function
name|uint64_t
name|fman_tgec_get_counter
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|enum
name|tgec_counters
name|reg_name
parameter_list|)
block|{
name|uint64_t
name|ret_val
decl_stmt|;
switch|switch
condition|(
name|reg_name
condition|)
block|{
case|case
name|E_TGEC_COUNTER_R64
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|r64
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_R127
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|r127
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_R255
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|r255
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_R511
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|r511
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_R1023
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|r1023
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_R1518
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|r1518
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_R1519X
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|r1519x
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_TRFRG
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|trfrg
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_TRJBR
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|trjbr
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_RDRP
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|rdrp
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_RALN
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|raln
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_TRUND
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|trund
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_TROVR
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|trovr
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_RXPF
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|rxpf
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_TXPF
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|txpf
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_ROCT
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|roct
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_RMCA
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|rmca
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_RBCA
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|rbca
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_RPKT
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|rpkt
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_RUCA
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|ruca
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_RERR
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|rerr
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_TOCT
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|toct
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_TMCA
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|tmca
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_TBCA
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|tbca
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_TUCA
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|tuca
argument_list|)
expr_stmt|;
break|break;
case|case
name|E_TGEC_COUNTER_TERR
case|:
name|ret_val
operator|=
name|GET_TGEC_CNTR_64
argument_list|(
name|terr
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ret_val
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|ret_val
return|;
block|}
end_function

begin_function
name|void
name|fman_tgec_enable
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|bool
name|apply_rx
parameter_list|,
name|bool
name|apply_tx
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
if|if
condition|(
name|apply_rx
condition|)
name|tmp
operator||=
name|CMD_CFG_RX_EN
expr_stmt|;
if|if
condition|(
name|apply_tx
condition|)
name|tmp
operator||=
name|CMD_CFG_TX_EN
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_tgec_disable
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|bool
name|apply_rx
parameter_list|,
name|bool
name|apply_tx
parameter_list|)
block|{
name|uint32_t
name|tmp_reg_32
decl_stmt|;
name|tmp_reg_32
operator|=
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
if|if
condition|(
name|apply_rx
condition|)
name|tmp_reg_32
operator|&=
operator|~
name|CMD_CFG_RX_EN
expr_stmt|;
if|if
condition|(
name|apply_tx
condition|)
name|tmp_reg_32
operator|&=
operator|~
name|CMD_CFG_TX_EN
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp_reg_32
argument_list|,
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_tgec_set_promiscuous
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|bool
name|val
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
condition|)
name|tmp
operator||=
name|CMD_CFG_PROMIS_EN
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|CMD_CFG_PROMIS_EN
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_tgec_reset_filter_table
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|512
condition|;
name|i
operator|++
control|)
name|iowrite32be
argument_list|(
name|i
operator|&
operator|~
name|TGEC_HASH_MCAST_EN
argument_list|,
operator|&
name|regs
operator|->
name|hashtable_ctrl
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_tgec_set_hash_table_entry
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|uint32_t
name|crc
parameter_list|)
block|{
name|uint32_t
name|hash
init|=
operator|(
name|crc
operator|>>
name|TGEC_HASH_MCAST_SHIFT
operator|)
operator|&
name|TGEC_HASH_ADR_MSK
decl_stmt|;
comment|/* Take 9 MSB bits */
name|iowrite32be
argument_list|(
name|hash
operator||
name|TGEC_HASH_MCAST_EN
argument_list|,
operator|&
name|regs
operator|->
name|hashtable_ctrl
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_tgec_set_hash_table
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|uint32_t
name|value
parameter_list|)
block|{
name|iowrite32be
argument_list|(
name|value
argument_list|,
operator|&
name|regs
operator|->
name|hashtable_ctrl
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_tgec_set_tx_pause_frames
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|uint16_t
name|pause_time
parameter_list|)
block|{
name|iowrite32be
argument_list|(
operator|(
name|uint32_t
operator|)
name|pause_time
argument_list|,
operator|&
name|regs
operator|->
name|pause_quant
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_tgec_set_rx_ignore_pause_frames
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|bool
name|en
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
if|if
condition|(
name|en
condition|)
name|tmp
operator||=
name|CMD_CFG_PAUSE_IGNORE
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|CMD_CFG_PAUSE_IGNORE
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_tgec_enable_1588_time_stamp
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|bool
name|en
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
name|tmp
operator|=
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
if|if
condition|(
name|en
condition|)
name|tmp
operator||=
name|CMD_CFG_EN_TIMESTAMP
expr_stmt|;
else|else
name|tmp
operator|&=
operator|~
name|CMD_CFG_EN_TIMESTAMP
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint32_t
name|fman_tgec_get_event
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|uint32_t
name|ev_mask
parameter_list|)
block|{
return|return
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|ievent
argument_list|)
operator|&
name|ev_mask
return|;
block|}
end_function

begin_function
name|void
name|fman_tgec_ack_event
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|uint32_t
name|ev_mask
parameter_list|)
block|{
name|iowrite32be
argument_list|(
name|ev_mask
argument_list|,
operator|&
name|regs
operator|->
name|ievent
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint32_t
name|fman_tgec_get_interrupt_mask
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|)
block|{
return|return
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|imask
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|fman_tgec_add_addr_in_paddr
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|uint8_t
modifier|*
name|adr
parameter_list|)
block|{
name|uint32_t
name|tmp0
decl_stmt|,
name|tmp1
decl_stmt|;
name|tmp0
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|adr
index|[
literal|0
index|]
operator||
name|adr
index|[
literal|1
index|]
operator|<<
literal|8
operator||
name|adr
index|[
literal|2
index|]
operator|<<
literal|16
operator||
name|adr
index|[
literal|3
index|]
operator|<<
literal|24
argument_list|)
expr_stmt|;
name|tmp1
operator|=
call|(
name|uint32_t
call|)
argument_list|(
name|adr
index|[
literal|4
index|]
operator||
name|adr
index|[
literal|5
index|]
operator|<<
literal|8
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp0
argument_list|,
operator|&
name|regs
operator|->
name|mac_addr_2
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp1
argument_list|,
operator|&
name|regs
operator|->
name|mac_addr_3
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_tgec_clear_addr_in_paddr
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|)
block|{
name|iowrite32be
argument_list|(
literal|0
argument_list|,
operator|&
name|regs
operator|->
name|mac_addr_2
argument_list|)
expr_stmt|;
name|iowrite32be
argument_list|(
literal|0
argument_list|,
operator|&
name|regs
operator|->
name|mac_addr_3
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint32_t
name|fman_tgec_get_revision
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|)
block|{
return|return
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|tgec_id
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|fman_tgec_enable_interrupt
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|uint32_t
name|ev_mask
parameter_list|)
block|{
name|iowrite32be
argument_list|(
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|imask
argument_list|)
operator||
name|ev_mask
argument_list|,
operator|&
name|regs
operator|->
name|imask
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fman_tgec_disable_interrupt
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|uint32_t
name|ev_mask
parameter_list|)
block|{
name|iowrite32be
argument_list|(
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|imask
argument_list|)
operator|&
operator|~
name|ev_mask
argument_list|,
operator|&
name|regs
operator|->
name|imask
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|uint16_t
name|fman_tgec_get_max_frame_len
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|)
block|{
return|return
operator|(
name|uint16_t
operator|)
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|maxfrm
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|fman_tgec_defconfig
parameter_list|(
name|struct
name|tgec_cfg
modifier|*
name|cfg
parameter_list|)
block|{
name|cfg
operator|->
name|wan_mode_enable
operator|=
name|DEFAULT_WAN_MODE_ENABLE
expr_stmt|;
name|cfg
operator|->
name|promiscuous_mode_enable
operator|=
name|DEFAULT_PROMISCUOUS_MODE_ENABLE
expr_stmt|;
name|cfg
operator|->
name|pause_forward_enable
operator|=
name|DEFAULT_PAUSE_FORWARD_ENABLE
expr_stmt|;
name|cfg
operator|->
name|pause_ignore
operator|=
name|DEFAULT_PAUSE_IGNORE
expr_stmt|;
name|cfg
operator|->
name|tx_addr_ins_enable
operator|=
name|DEFAULT_TX_ADDR_INS_ENABLE
expr_stmt|;
name|cfg
operator|->
name|loopback_enable
operator|=
name|DEFAULT_LOOPBACK_ENABLE
expr_stmt|;
name|cfg
operator|->
name|cmd_frame_enable
operator|=
name|DEFAULT_CMD_FRAME_ENABLE
expr_stmt|;
name|cfg
operator|->
name|rx_error_discard
operator|=
name|DEFAULT_RX_ERROR_DISCARD
expr_stmt|;
name|cfg
operator|->
name|send_idle_enable
operator|=
name|DEFAULT_SEND_IDLE_ENABLE
expr_stmt|;
name|cfg
operator|->
name|no_length_check_enable
operator|=
name|DEFAULT_NO_LENGTH_CHECK_ENABLE
expr_stmt|;
name|cfg
operator|->
name|lgth_check_nostdr
operator|=
name|DEFAULT_LGTH_CHECK_NOSTDR
expr_stmt|;
name|cfg
operator|->
name|time_stamp_enable
operator|=
name|DEFAULT_TIME_STAMP_ENABLE
expr_stmt|;
name|cfg
operator|->
name|tx_ipg_length
operator|=
name|DEFAULT_TX_IPG_LENGTH
expr_stmt|;
name|cfg
operator|->
name|max_frame_length
operator|=
name|DEFAULT_MAX_FRAME_LENGTH
expr_stmt|;
name|cfg
operator|->
name|pause_quant
operator|=
name|DEFAULT_PAUSE_QUANT
expr_stmt|;
ifdef|#
directive|ifdef
name|FM_TX_ECC_FRMS_ERRATA_10GMAC_A004
name|cfg
operator|->
name|skip_fman11_workaround
operator|=
name|FALSE
expr_stmt|;
endif|#
directive|endif
comment|/* FM_TX_ECC_FRMS_ERRATA_10GMAC_A004 */
block|}
end_function

begin_function
name|int
name|fman_tgec_init
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|,
name|struct
name|tgec_cfg
modifier|*
name|cfg
parameter_list|,
name|uint32_t
name|exception_mask
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
comment|/* Config */
name|tmp
operator|=
literal|0x40
expr_stmt|;
comment|/* CRC forward */
if|if
condition|(
name|cfg
operator|->
name|wan_mode_enable
condition|)
name|tmp
operator||=
name|CMD_CFG_WAN_MODE
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|promiscuous_mode_enable
condition|)
name|tmp
operator||=
name|CMD_CFG_PROMIS_EN
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|pause_forward_enable
condition|)
name|tmp
operator||=
name|CMD_CFG_PAUSE_FWD
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|pause_ignore
condition|)
name|tmp
operator||=
name|CMD_CFG_PAUSE_IGNORE
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|tx_addr_ins_enable
condition|)
name|tmp
operator||=
name|CMD_CFG_TX_ADDR_INS
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|loopback_enable
condition|)
name|tmp
operator||=
name|CMD_CFG_LOOPBACK_EN
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|cmd_frame_enable
condition|)
name|tmp
operator||=
name|CMD_CFG_CMD_FRM_EN
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|rx_error_discard
condition|)
name|tmp
operator||=
name|CMD_CFG_RX_ER_DISC
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|send_idle_enable
condition|)
name|tmp
operator||=
name|CMD_CFG_SEND_IDLE
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|no_length_check_enable
condition|)
name|tmp
operator||=
name|CMD_CFG_NO_LEN_CHK
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|time_stamp_enable
condition|)
name|tmp
operator||=
name|CMD_CFG_EN_TIMESTAMP
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|regs
operator|->
name|command_config
argument_list|)
expr_stmt|;
comment|/* Max Frame Length */
name|iowrite32be
argument_list|(
operator|(
name|uint32_t
operator|)
name|cfg
operator|->
name|max_frame_length
argument_list|,
operator|&
name|regs
operator|->
name|maxfrm
argument_list|)
expr_stmt|;
comment|/* Pause Time */
name|iowrite32be
argument_list|(
name|cfg
operator|->
name|pause_quant
argument_list|,
operator|&
name|regs
operator|->
name|pause_quant
argument_list|)
expr_stmt|;
comment|/* clear all pending events and set-up interrupts */
name|fman_tgec_ack_event
argument_list|(
name|regs
argument_list|,
literal|0xffffffff
argument_list|)
expr_stmt|;
name|fman_tgec_enable_interrupt
argument_list|(
name|regs
argument_list|,
name|exception_mask
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|fman_tgec_set_erratum_tx_fifo_corruption_10gmac_a007
parameter_list|(
name|struct
name|tgec_regs
modifier|*
name|regs
parameter_list|)
block|{
name|uint32_t
name|tmp
decl_stmt|;
comment|/* restore the default tx ipg Length */
name|tmp
operator|=
operator|(
name|ioread32be
argument_list|(
operator|&
name|regs
operator|->
name|tx_ipg_len
argument_list|)
operator|&
operator|~
name|TGEC_TX_IPG_LENGTH_MASK
operator|)
operator||
literal|12
expr_stmt|;
name|iowrite32be
argument_list|(
name|tmp
argument_list|,
operator|&
name|regs
operator|->
name|tx_ipg_len
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

