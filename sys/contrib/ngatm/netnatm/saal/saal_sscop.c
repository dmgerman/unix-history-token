begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1996-2003  *	Fraunhofer Institute for Open Communication Systems (FhG Fokus).  * 	All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * Author: Hartmut Brandt<harti@freebsd.org>  *  * $Begemot: libunimsg/netnatm/saal/saal_sscop.c,v 1.11 2004/07/08 08:22:13 brandt Exp $  *  * Core SSCOP code (ITU-T Q.2110)  */
end_comment

begin_include
include|#
directive|include
file|<netnatm/saal/sscop.h>
end_include

begin_include
include|#
directive|include
file|<netnatm/saal/sscoppriv.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|FAILURE
end_ifndef

begin_define
define|#
directive|define
name|FAILURE
parameter_list|(
name|S
parameter_list|)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|MKSTR
parameter_list|(
name|S
parameter_list|)
value|#S
end_define

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
specifier|const
name|sscop_sigs
index|[]
init|=
block|{
name|MKSTR
argument_list|(
name|SSCOP_ESTABLISH_request
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_ESTABLISH_indication
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_ESTABLISH_response
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_ESTABLISH_confirm
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RELEASE_request
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RELEASE_indication
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RELEASE_confirm
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_DATA_request
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_DATA_indication
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_UDATA_request
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_UDATA_indication
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RECOVER_indication
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RECOVER_response
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RESYNC_request
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RESYNC_indication
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RESYNC_response
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RESYNC_confirm
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RETRIEVE_request
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RETRIEVE_indication
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_RETRIEVE_COMPL_indication
argument_list|)
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
specifier|const
name|sscop_msigs
index|[]
init|=
block|{
name|MKSTR
argument_list|(
name|SSCOP_MDATA_request
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_MDATA_indication
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_MERROR_indication
argument_list|)
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
specifier|const
name|states
index|[]
init|=
block|{
name|MKSTR
argument_list|(
name|SSCOP_IDLE
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_OUT_PEND
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_IN_PEND
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_OUT_DIS_PEND
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_OUT_RESYNC_PEND
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_IN_RESYNC_PEND
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_OUT_REC_PEND
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_REC_PEND
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_IN_REC_PEND
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SSCOP_READY
argument_list|)
block|, }
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|SSCOP_DEBUG
end_ifdef

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
specifier|const
name|events
index|[]
init|=
block|{
name|MKSTR
argument_list|(
name|SIG_BGN
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_BGAK
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_END
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_ENDAK
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_RS
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_RSAK
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_BGREJ
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_SD
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_ER
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_POLL
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_STAT
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_USTAT
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_UD
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_MD
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_ERAK
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_T_CC
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_T_POLL
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_T_KA
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_T_NR
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_T_IDLE
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_PDU_Q
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_USER_DATA
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_ESTAB_REQ
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_ESTAB_RESP
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_RELEASE_REQ
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_RECOVER
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_SYNC_REQ
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_SYNC_RESP
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_UDATA
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_MDATA
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_UPDU_Q
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_MPDU_Q
argument_list|)
block|,
name|MKSTR
argument_list|(
name|SIG_RETRIEVE
argument_list|)
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
specifier|const
name|pdus
index|[]
init|=
block|{
literal|"illegale PDU type 0"
block|,
comment|/* no PDU type 0 */
name|MKSTR
argument_list|(
name|PDU_BGN
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_BGAK
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_END
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_ENDAK
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_RS
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_RSAK
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_BGREJ
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_SD
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_ER
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_POLL
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_STAT
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_USTAT
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_UD
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_MD
argument_list|)
block|,
name|MKSTR
argument_list|(
name|PDU_ERAK
argument_list|)
block|, }
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_expr_stmt
name|MEMINIT
argument_list|()
expr_stmt|;
end_expr_stmt

begin_function_decl
specifier|static
name|void
name|sscop_signal
parameter_list|(
name|struct
name|sscop
modifier|*
parameter_list|,
name|u_int
parameter_list|,
name|struct
name|sscop_msg
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|sscop_save_signal
parameter_list|(
name|struct
name|sscop
modifier|*
parameter_list|,
name|u_int
parameter_list|,
name|struct
name|sscop_msg
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|handle_sigs
parameter_list|(
name|struct
name|sscop
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|sscop_set_state
parameter_list|(
name|struct
name|sscop
modifier|*
parameter_list|,
name|u_int
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/************************************************************/
end_comment

begin_comment
comment|/************************************************************/
end_comment

begin_comment
comment|/*  * Queue macros  */
end_comment

begin_define
define|#
directive|define
name|SSCOP_MSG_FREE
parameter_list|(
name|MSG
parameter_list|)
define|\
value|do {								\ 	if(MSG) {							\ 		MBUF_FREE((MSG)->m);					\ 		MSG_FREE((MSG));					\ 	}								\     } while(0)
end_define

begin_define
define|#
directive|define
name|QFIND
parameter_list|(
name|Q
parameter_list|,
name|RN
parameter_list|)
define|\
value|({									\ 	struct sscop_msg *_msg = NULL, *_m;				\ 	MSGQ_FOREACH(_m, (Q)) {						\ 		if(_m->seqno == (RN)) {					\ 			_msg = _m;					\ 			break;						\ 		}							\ 	}								\ 	_msg;								\     })
end_define

begin_define
define|#
directive|define
name|QINSERT
parameter_list|(
name|Q
parameter_list|,
name|M
parameter_list|)
define|\
value|do {								\ 	struct sscop_msg *_msg = NULL, *_m;				\ 	MSGQ_FOREACH(_m, (Q)) {						\ 		if (_m->seqno> (M)->seqno) {				\ 			_msg = _m;					\ 			break;						\ 		}							\ 	}								\ 	if (_msg != NULL)							\ 		MSGQ_INSERT_BEFORE(_msg, (M));				\ 	else								\ 		MSGQ_APPEND((Q), (M));					\     } while (0)
end_define

begin_comment
comment|/*  * Send an error indication to the management plane.  */
end_comment

begin_define
define|#
directive|define
name|MAAL_ERROR
parameter_list|(
name|S
parameter_list|,
name|E
parameter_list|,
name|C
parameter_list|)
define|\
value|do {								\ 	VERBOSE(S, SSCOP_DBG_USIG, ((S), (S)->aarg,			\ 	    "MAA-Signal %s in state %s", 				\ 	    sscop_msigs[SSCOP_MERROR_indication], states[(S)->state]));	\ 	(S)->funcs->send_manage((S), (S)->aarg,				\ 	    SSCOP_MERROR_indication, NULL, (E), (C));			\     } while(0)
end_define

begin_define
define|#
directive|define
name|MAAL_DATA
parameter_list|(
name|S
parameter_list|,
name|M
parameter_list|)
define|\
value|do {								\ 	VERBOSE(S, SSCOP_DBG_USIG, ((S), (S)->aarg,			\ 	    "MAA-Signal %s in state %s",				\ 	    sscop_msigs[SSCOP_MDATA_indication], states[(S)->state]));	\ 	(S)->funcs->send_manage((S), (S)->aarg,				\ 	    SSCOP_MDATA_indication, (M), 0, 0);				\     } while(0)
end_define

begin_define
define|#
directive|define
name|AAL_DATA
parameter_list|(
name|S
parameter_list|,
name|D
parameter_list|,
name|M
parameter_list|,
name|N
parameter_list|)
define|\
value|do {								\ 	VERBOSE(S, SSCOP_DBG_USIG, ((S), (S)->aarg,			\ 	    "AA-Signal %s in state %s",					\ 	    sscop_sigs[D], states[(S)->state]));			\ 	(S)->funcs->send_upper((S), (S)->aarg, (D), (M), (N));		\     } while(0)
end_define

begin_define
define|#
directive|define
name|AAL_SIG
parameter_list|(
name|S
parameter_list|,
name|D
parameter_list|)
define|\
value|do {								\ 	VERBOSE(S, SSCOP_DBG_USIG, ((S), (S)->aarg,			\ 	    "AA-Signal %s in state %s",					\ 	    sscop_sigs[D], states[(S)->state]));			\ 	(S)->funcs->send_upper((S), (S)->aarg, (D), NULL, 0);		\     } while(0)
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|SSCOP_DEBUG
end_ifdef

begin_define
define|#
directive|define
name|AAL_SEND
parameter_list|(
name|S
parameter_list|,
name|M
parameter_list|)
value|do {						\ 	if (ISVERBOSE(S, SSCOP_DBG_PDU))				\ 		sscop_dump_pdu(S, "tx", (M));				\ 	(S)->funcs->send_lower((S), (S)->aarg, (M));			\     } while(0)
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|AAL_SEND
parameter_list|(
name|S
parameter_list|,
name|M
parameter_list|)
value|(S)->funcs->send_lower((S), (S)->aarg, (M))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Free a save user-to-user data buffer and set the pointer to zero  * to signal, that it is free.  */
end_comment

begin_define
define|#
directive|define
name|FREE_UU
parameter_list|(
name|F
parameter_list|)
define|\
value|do {								\ 		if(sscop->F) {						\ 			MBUF_FREE(sscop->F);				\ 			sscop->F = NULL;				\ 		}							\ 	} while(0)
end_define

begin_define
define|#
directive|define
name|SET_UU
parameter_list|(
name|F
parameter_list|,
name|U
parameter_list|)
define|\
value|do {								\ 		FREE_UU(F);						\ 		sscop->F = U->m;					\ 		U->m = NULL;						\ 		SSCOP_MSG_FREE(U);					\ 	} while(0)
end_define

begin_define
define|#
directive|define
name|AAL_UU_SIGNAL
parameter_list|(
name|S
parameter_list|,
name|SIG
parameter_list|,
name|M
parameter_list|,
name|PL
parameter_list|,
name|SN
parameter_list|)
define|\
value|do {								\ 		if(MBUF_LEN((M)->m)> 0) { 				\ 			MBUF_UNPAD((M)->m,(PL));			\ 			AAL_DATA((S), (SIG), (M)->m, (SN)); 		\ 			(M)->m = NULL;					\ 		} else {						\ 			AAL_DATA((S), (SIG), NULL, (SN));		\ 		}							\ 		SSCOP_MSG_FREE((M));					\ 	} while(0)
end_define

begin_macro
name|TIMER_FUNC
argument_list|(
argument|cc
argument_list|,
argument|CC
argument_list|)
end_macro

begin_macro
name|TIMER_FUNC
argument_list|(
argument|nr
argument_list|,
argument|NR
argument_list|)
end_macro

begin_macro
name|TIMER_FUNC
argument_list|(
argument|ka
argument_list|,
argument|KA
argument_list|)
end_macro

begin_macro
name|TIMER_FUNC
argument_list|(
argument|poll
argument_list|,
argument|POLL
argument_list|)
end_macro

begin_macro
name|TIMER_FUNC
argument_list|(
argument|idle
argument_list|,
argument|IDLE
argument_list|)
end_macro

begin_comment
comment|/************************************************************/
end_comment

begin_comment
comment|/*  * INSTANCE AND TYPE HANDLING.  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|SSCOP_DEBUG
end_ifdef

begin_function
specifier|static
name|void
name|sscop_dump_pdu
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
specifier|const
name|char
modifier|*
name|dir
parameter_list|,
specifier|const
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
parameter_list|)
block|{
name|u_int32_t
name|v1
decl_stmt|,
name|v2
decl_stmt|,
name|v3
decl_stmt|,
name|v4
decl_stmt|;
name|u_int
name|size
init|=
name|MBUF_LEN
argument_list|(
name|m
argument_list|)
decl_stmt|;
name|u_int
name|n
decl_stmt|,
name|i
decl_stmt|;
if|if
condition|(
name|size
operator|<
literal|8
condition|)
return|return;
name|v1
operator|=
name|MBUF_TRAIL32
argument_list|(
name|m
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|v2
operator|=
name|MBUF_TRAIL32
argument_list|(
name|m
argument_list|,
operator|-
literal|2
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|v1
operator|>>
literal|24
operator|)
operator|&
literal|0xf
condition|)
block|{
case|case
literal|0
case|:
return|return;
case|case
name|PDU_BGN
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s BGN n(mr)=%u n(sq)=%u pl=%u"
argument_list|,
name|dir
argument_list|,
name|v1
operator|&
literal|0xffffff
argument_list|,
name|v2
operator|&
literal|0xff
argument_list|,
operator|(
name|v1
operator|>>
literal|30
operator|)
operator|&
literal|0x3
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_BGAK
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s BGAK n(mr)=%u pl=%u"
argument_list|,
name|dir
argument_list|,
name|v1
operator|&
literal|0xffffff
argument_list|,
operator|(
name|v1
operator|>>
literal|30
operator|)
operator|&
literal|0x3
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_END
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s END r=%u s=%u pl=%u"
argument_list|,
name|dir
argument_list|,
operator|(
name|v1
operator|>>
literal|29
operator|)
operator|&
literal|1
argument_list|,
operator|(
name|v1
operator|>>
literal|28
operator|)
operator|&
literal|1
argument_list|,
operator|(
name|v1
operator|>>
literal|30
operator|)
operator|&
literal|0x3
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_ENDAK
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s ENDAK"
argument_list|,
name|dir
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_RS
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s RS n(mr)=%u n(sq)=%u pl=%u"
argument_list|,
name|dir
argument_list|,
name|v1
operator|&
literal|0xffffff
argument_list|,
name|v2
operator|&
literal|0xff
argument_list|,
operator|(
name|v1
operator|>>
literal|30
operator|)
operator|&
literal|0x3
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_RSAK
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s RSAK n(mr)=%u"
argument_list|,
name|dir
argument_list|,
name|v1
operator|&
literal|0xffffff
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_BGREJ
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s BGREJ pl=%u"
argument_list|,
name|dir
argument_list|,
operator|(
name|v1
operator|>>
literal|30
operator|)
operator|&
literal|0x3
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_SD
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s SD n(s)=%u pl=%u"
argument_list|,
name|dir
argument_list|,
name|v1
operator|&
literal|0xffffff
argument_list|,
operator|(
name|v1
operator|>>
literal|30
operator|)
operator|&
literal|0x3
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_ER
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s ER n(mr)=%u n(sq)=%u"
argument_list|,
name|dir
argument_list|,
name|v1
operator|&
literal|0xffffff
argument_list|,
name|v2
operator|&
literal|0xff
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_POLL
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s POLL n(s)=%u n(ps)=%u"
argument_list|,
name|dir
argument_list|,
name|v1
operator|&
literal|0xffffff
argument_list|,
name|v2
operator|&
literal|0xffffff
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_STAT
case|:
if|if
condition|(
name|size
operator|<
literal|12
condition|)
return|return;
name|v3
operator|=
name|MBUF_TRAIL32
argument_list|(
name|m
argument_list|,
operator|-
literal|3
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s STAT n(r)=%u n(mr)=%u n(ps)=%u"
argument_list|,
name|dir
argument_list|,
name|v1
operator|&
literal|0xffffff
argument_list|,
name|v2
operator|&
literal|0xffffff
argument_list|,
name|v3
operator|&
literal|0xffffff
argument_list|)
expr_stmt|;
name|n
operator|=
operator|(
name|size
operator|-
literal|12
operator|)
operator|/
literal|4
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|size
operator|-
literal|12
operator|)
operator|/
literal|4
condition|;
name|i
operator|++
operator|,
name|n
operator|--
control|)
block|{
name|v4
operator|=
name|MBUF_TRAIL32
argument_list|(
name|m
argument_list|,
operator|-
literal|4
operator|-
operator|(
name|int
operator|)
name|i
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"   LE(%u)=%u"
argument_list|,
name|n
argument_list|,
name|v4
operator|&
literal|0xffffff
argument_list|)
expr_stmt|;
block|}
return|return;
case|case
name|PDU_USTAT
case|:
if|if
condition|(
name|size
operator|<
literal|16
condition|)
return|return;
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s STAT n(r)=%u n(mr)=%u LE1=%u LE2=%u"
argument_list|,
name|dir
argument_list|,
name|v1
operator|&
literal|0xffffff
argument_list|,
name|v2
operator|&
literal|0xffffff
argument_list|,
name|MBUF_TRAIL32
argument_list|(
name|m
argument_list|,
operator|-
literal|4
argument_list|)
operator|&
literal|0xffffff
argument_list|,
name|MBUF_TRAIL32
argument_list|(
name|m
argument_list|,
operator|-
literal|3
argument_list|)
operator|&
literal|0xffffff
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_UD
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s UD pl=%u"
argument_list|,
name|dir
argument_list|,
operator|(
name|v1
operator|>>
literal|30
operator|)
operator|&
literal|0x3
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_MD
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s MD pl=%u"
argument_list|,
name|dir
argument_list|,
operator|(
name|v1
operator|>>
literal|30
operator|)
operator|&
literal|0x3
argument_list|)
expr_stmt|;
return|return;
case|case
name|PDU_ERAK
case|:
name|sscop
operator|->
name|funcs
operator|->
name|verbose
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|aarg
argument_list|,
literal|"%s ERAK n(mr)=%u"
argument_list|,
name|dir
argument_list|,
name|v1
operator|&
literal|0xffffff
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Initialize state of variables  */
end_comment

begin_function
specifier|static
name|void
name|sscop_init
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|sscop
operator|->
name|state
operator|=
name|SSCOP_IDLE
expr_stmt|;
name|sscop
operator|->
name|vt_sq
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|vr_sq
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|clear_buffers
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|ll_busy
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|rxq
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|sscop_clear
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|ka
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|idle
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|poll
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_bgn
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_bgak
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_bgrej
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_rs
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|uxq
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|mxq
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
name|SIGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|sigs
argument_list|)
expr_stmt|;
name|SIGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|saved_sigs
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Allocate instance memory, initialize the state of all variables.  */
end_comment

begin_function
name|struct
name|sscop
modifier|*
name|sscop_create
parameter_list|(
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|struct
name|sscop_funcs
modifier|*
name|funcs
parameter_list|)
block|{
name|struct
name|sscop
modifier|*
name|sscop
decl_stmt|;
name|MEMZALLOC
argument_list|(
name|sscop
argument_list|,
expr|struct
name|sscop
operator|*
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|sscop
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|sscop
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
name|a
operator|==
name|NULL
condition|)
name|sscop
operator|->
name|aarg
operator|=
name|sscop
expr_stmt|;
else|else
name|sscop
operator|->
name|aarg
operator|=
name|a
expr_stmt|;
name|sscop
operator|->
name|funcs
operator|=
name|funcs
expr_stmt|;
name|sscop
operator|->
name|maxk
operator|=
name|MAXK
expr_stmt|;
name|sscop
operator|->
name|maxj
operator|=
name|MAXJ
expr_stmt|;
name|sscop
operator|->
name|maxcc
operator|=
name|MAXCC
expr_stmt|;
name|sscop
operator|->
name|maxpd
operator|=
name|MAXPD
expr_stmt|;
name|sscop
operator|->
name|maxstat
operator|=
name|MAXSTAT
expr_stmt|;
name|sscop
operator|->
name|timercc
operator|=
name|TIMERCC
expr_stmt|;
name|sscop
operator|->
name|timerka
operator|=
name|TIMERKA
expr_stmt|;
name|sscop
operator|->
name|timernr
operator|=
name|TIMERNR
expr_stmt|;
name|sscop
operator|->
name|timerpoll
operator|=
name|TIMERPOLL
expr_stmt|;
name|sscop
operator|->
name|timeridle
operator|=
name|TIMERIDLE
expr_stmt|;
name|sscop
operator|->
name|robustness
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|poll_after_rex
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|mr
operator|=
name|MAXMR
expr_stmt|;
name|TIMER_INIT
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|TIMER_INIT
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
name|TIMER_INIT
argument_list|(
name|sscop
argument_list|,
name|ka
argument_list|)
expr_stmt|;
name|TIMER_INIT
argument_list|(
name|sscop
argument_list|,
name|poll
argument_list|)
expr_stmt|;
name|TIMER_INIT
argument_list|(
name|sscop
argument_list|,
name|idle
argument_list|)
expr_stmt|;
name|MSGQ_INIT
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|)
expr_stmt|;
name|MSGQ_INIT
argument_list|(
operator|&
name|sscop
operator|->
name|uxq
argument_list|)
expr_stmt|;
name|MSGQ_INIT
argument_list|(
operator|&
name|sscop
operator|->
name|mxq
argument_list|)
expr_stmt|;
name|MSGQ_INIT
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
name|MSGQ_INIT
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|)
expr_stmt|;
name|SIGQ_INIT
argument_list|(
operator|&
name|sscop
operator|->
name|sigs
argument_list|)
expr_stmt|;
name|SIGQ_INIT
argument_list|(
operator|&
name|sscop
operator|->
name|saved_sigs
argument_list|)
expr_stmt|;
name|sscop_init
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
return|return
operator|(
name|sscop
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Free all resources in a sscop instance  */
end_comment

begin_function
name|void
name|sscop_destroy
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|sscop_reset
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|MEMFREE
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Reset the SSCOP instance.  */
end_comment

begin_function
name|void
name|sscop_reset
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|sscop_clear
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_init
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|sscop_getparam
parameter_list|(
specifier|const
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_param
modifier|*
name|p
parameter_list|)
block|{
name|p
operator|->
name|timer_cc
operator|=
name|sscop
operator|->
name|timercc
expr_stmt|;
name|p
operator|->
name|timer_poll
operator|=
name|sscop
operator|->
name|timerpoll
expr_stmt|;
name|p
operator|->
name|timer_keep_alive
operator|=
name|sscop
operator|->
name|timerka
expr_stmt|;
name|p
operator|->
name|timer_no_response
operator|=
name|sscop
operator|->
name|timernr
expr_stmt|;
name|p
operator|->
name|timer_idle
operator|=
name|sscop
operator|->
name|timeridle
expr_stmt|;
name|p
operator|->
name|maxk
operator|=
name|sscop
operator|->
name|maxk
expr_stmt|;
name|p
operator|->
name|maxj
operator|=
name|sscop
operator|->
name|maxj
expr_stmt|;
name|p
operator|->
name|maxcc
operator|=
name|sscop
operator|->
name|maxcc
expr_stmt|;
name|p
operator|->
name|maxpd
operator|=
name|sscop
operator|->
name|maxpd
expr_stmt|;
name|p
operator|->
name|maxstat
operator|=
name|sscop
operator|->
name|maxstat
expr_stmt|;
name|p
operator|->
name|mr
operator|=
name|sscop
operator|->
name|mr
expr_stmt|;
name|p
operator|->
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|sscop
operator|->
name|robustness
condition|)
name|p
operator|->
name|flags
operator||=
name|SSCOP_ROBUST
expr_stmt|;
if|if
condition|(
name|sscop
operator|->
name|poll_after_rex
condition|)
name|p
operator|->
name|flags
operator||=
name|SSCOP_POLLREX
expr_stmt|;
block|}
end_function

begin_function
name|int
name|sscop_setparam
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_param
modifier|*
name|p
parameter_list|,
name|u_int
modifier|*
name|pmask
parameter_list|)
block|{
name|u_int
name|mask
init|=
operator|*
name|pmask
decl_stmt|;
comment|/* can change only in idle state */
if|if
condition|(
name|sscop
operator|->
name|state
operator|!=
name|SSCOP_IDLE
condition|)
return|return
operator|(
name|EISCONN
operator|)
return|;
operator|*
name|pmask
operator|=
literal|0
expr_stmt|;
comment|/* 	 * first check all parameters 	 */
if|if
condition|(
operator|(
name|mask
operator|&
name|SSCOP_SET_TCC
operator|)
operator|&&
name|p
operator|->
name|timer_cc
operator|==
literal|0
condition|)
operator|*
name|pmask
operator||=
name|SSCOP_SET_TCC
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|SSCOP_SET_TPOLL
operator|)
operator|&&
name|p
operator|->
name|timer_poll
operator|==
literal|0
condition|)
operator|*
name|pmask
operator||=
name|SSCOP_SET_TPOLL
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|SSCOP_SET_TKA
operator|)
operator|&&
name|p
operator|->
name|timer_keep_alive
operator|==
literal|0
condition|)
operator|*
name|pmask
operator||=
name|SSCOP_SET_TKA
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|SSCOP_SET_TNR
operator|)
operator|&&
name|p
operator|->
name|timer_no_response
operator|==
literal|0
condition|)
operator|*
name|pmask
operator||=
name|SSCOP_SET_TNR
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|SSCOP_SET_TIDLE
operator|)
operator|&&
name|p
operator|->
name|timer_idle
operator|==
literal|0
condition|)
operator|*
name|pmask
operator||=
name|SSCOP_SET_TIDLE
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|SSCOP_SET_MAXK
operator|)
operator|&&
name|p
operator|->
name|maxk
operator|>
name|MAXMAXK
condition|)
operator|*
name|pmask
operator||=
name|SSCOP_SET_MAXK
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|SSCOP_SET_MAXJ
operator|)
operator|&&
name|p
operator|->
name|maxj
operator|>
name|MAXMAXJ
condition|)
operator|*
name|pmask
operator||=
name|SSCOP_SET_MAXJ
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|SSCOP_SET_MAXCC
operator|)
operator|&&
name|p
operator|->
name|maxcc
operator|>
literal|255
condition|)
operator|*
name|pmask
operator||=
name|SSCOP_SET_MAXCC
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|SSCOP_SET_MAXPD
operator|)
operator|&&
name|p
operator|->
name|maxpd
operator|>=
operator|(
literal|1
operator|<<
literal|24
operator|)
condition|)
operator|*
name|pmask
operator||=
name|SSCOP_SET_MAXPD
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|SSCOP_SET_MAXSTAT
operator|)
operator|&&
operator|(
operator|(
name|p
operator|->
name|maxstat
operator|&
literal|1
operator|)
operator|==
literal|0
operator|||
name|p
operator|->
name|maxstat
operator|==
literal|1
operator|||
name|p
operator|->
name|maxstat
operator|==
literal|2
operator|||
name|p
operator|->
name|maxstat
operator|*
literal|4
operator|>
name|MAXMAXK
operator|-
literal|8
operator|)
condition|)
operator|*
name|pmask
operator||=
name|SSCOP_SET_MAXSTAT
expr_stmt|;
if|if
condition|(
operator|(
name|mask
operator|&
name|SSCOP_SET_MR
operator|)
operator|&&
name|p
operator|->
name|mr
operator|>=
operator|(
literal|1
operator|<<
literal|24
operator|)
operator|-
literal|1
condition|)
operator|*
name|pmask
operator||=
name|SSCOP_SET_MR
expr_stmt|;
if|if
condition|(
operator|*
name|pmask
condition|)
return|return
operator|(
name|EINVAL
operator|)
return|;
comment|/* 	 * now set it 	 */
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_TCC
condition|)
name|sscop
operator|->
name|timercc
operator|=
name|p
operator|->
name|timer_cc
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_TPOLL
condition|)
name|sscop
operator|->
name|timerpoll
operator|=
name|p
operator|->
name|timer_poll
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_TKA
condition|)
name|sscop
operator|->
name|timerka
operator|=
name|p
operator|->
name|timer_keep_alive
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_TNR
condition|)
name|sscop
operator|->
name|timernr
operator|=
name|p
operator|->
name|timer_no_response
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_TIDLE
condition|)
name|sscop
operator|->
name|timeridle
operator|=
name|p
operator|->
name|timer_idle
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_MAXK
condition|)
name|sscop
operator|->
name|maxk
operator|=
name|p
operator|->
name|maxk
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_MAXJ
condition|)
name|sscop
operator|->
name|maxj
operator|=
name|p
operator|->
name|maxj
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_MAXCC
condition|)
name|sscop
operator|->
name|maxcc
operator|=
name|p
operator|->
name|maxcc
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_MAXPD
condition|)
name|sscop
operator|->
name|maxpd
operator|=
name|p
operator|->
name|maxpd
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_MAXSTAT
condition|)
name|sscop
operator|->
name|maxstat
operator|=
name|p
operator|->
name|maxstat
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_MR
condition|)
name|sscop
operator|->
name|mr
operator|=
name|p
operator|->
name|mr
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_ROBUST
condition|)
name|sscop
operator|->
name|robustness
operator|=
operator|(
operator|(
name|p
operator|->
name|flags
operator|&
name|SSCOP_ROBUST
operator|)
operator|!=
literal|0
operator|)
expr_stmt|;
if|if
condition|(
name|mask
operator|&
name|SSCOP_SET_POLLREX
condition|)
name|sscop
operator|->
name|poll_after_rex
operator|=
operator|(
operator|(
name|p
operator|->
name|flags
operator|&
name|SSCOP_POLLREX
operator|)
operator|!=
literal|0
operator|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|enum
name|sscop_state
name|sscop_getstate
parameter_list|(
specifier|const
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
return|return
operator|(
name|sscop
operator|->
name|state
operator|)
return|;
block|}
end_function

begin_comment
comment|/************************************************************/
end_comment

begin_comment
comment|/*  * EXTERNAL INPUT SIGNAL MAPPING  */
end_comment

begin_comment
comment|/*  * Map AA signal to SSCOP internal signal  */
end_comment

begin_function
name|int
name|sscop_aasig
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|enum
name|sscop_aasig
name|sig
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
parameter_list|,
name|u_int
name|arg
parameter_list|)
block|{
name|struct
name|sscop_msg
modifier|*
name|msg
decl_stmt|;
if|if
condition|(
name|sig
operator|>=
sizeof|sizeof
argument_list|(
name|sscop_sigs
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|sscop_sigs
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|VERBOSE
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_INSIG
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"AA-Signal %u - bad signal"
operator|,
name|sig
operator|)
argument_list|)
expr_stmt|;
name|MBUF_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
return|return
operator|(
name|EINVAL
operator|)
return|;
block|}
name|VERBOSE
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_INSIG
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"AA-Signal %s in state %s with%s message"
operator|,
name|sscop_sigs
index|[
name|sig
index|]
operator|,
name|states
index|[
name|sscop
operator|->
name|state
index|]
operator|,
name|m
condition|?
literal|""
else|:
literal|"out"
operator|)
argument_list|)
expr_stmt|;
name|MSG_ALLOC
argument_list|(
name|msg
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate aasig"
argument_list|)
expr_stmt|;
name|MBUF_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
return|return
operator|(
name|ENOMEM
operator|)
return|;
block|}
switch|switch
condition|(
name|sig
condition|)
block|{
case|case
name|SSCOP_ESTABLISH_request
case|:
name|msg
operator|->
name|m
operator|=
name|m
expr_stmt|;
name|msg
operator|->
name|rexmit
operator|=
name|arg
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_ESTAB_REQ
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSCOP_ESTABLISH_response
case|:
name|msg
operator|->
name|m
operator|=
name|m
expr_stmt|;
name|msg
operator|->
name|rexmit
operator|=
name|arg
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_ESTAB_RESP
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSCOP_RELEASE_request
case|:
name|msg
operator|->
name|m
operator|=
name|m
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_RELEASE_REQ
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSCOP_DATA_request
case|:
name|msg
operator|->
name|m
operator|=
name|m
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_USER_DATA
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSCOP_UDATA_request
case|:
name|msg
operator|->
name|m
operator|=
name|m
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_UDATA
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSCOP_RECOVER_response
case|:
name|MBUF_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_RECOVER
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSCOP_RESYNC_request
case|:
name|msg
operator|->
name|m
operator|=
name|m
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_SYNC_REQ
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSCOP_RESYNC_response
case|:
name|MBUF_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_SYNC_RESP
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSCOP_RETRIEVE_request
case|:
name|MBUF_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|msg
operator|->
name|rexmit
operator|=
name|arg
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_RETRIEVE
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSCOP_ESTABLISH_indication
case|:
case|case
name|SSCOP_ESTABLISH_confirm
case|:
case|case
name|SSCOP_RELEASE_indication
case|:
case|case
name|SSCOP_RELEASE_confirm
case|:
case|case
name|SSCOP_DATA_indication
case|:
case|case
name|SSCOP_UDATA_indication
case|:
case|case
name|SSCOP_RECOVER_indication
case|:
case|case
name|SSCOP_RESYNC_indication
case|:
case|case
name|SSCOP_RESYNC_confirm
case|:
case|case
name|SSCOP_RETRIEVE_indication
case|:
case|case
name|SSCOP_RETRIEVE_COMPL_indication
case|:
name|MBUF_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
name|EINVAL
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Signal from layer management.  */
end_comment

begin_function
name|int
name|sscop_maasig
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|enum
name|sscop_maasig
name|sig
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
parameter_list|)
block|{
name|struct
name|sscop_msg
modifier|*
name|msg
decl_stmt|;
if|if
condition|(
name|sig
operator|>=
sizeof|sizeof
argument_list|(
name|sscop_msigs
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|sscop_msigs
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|VERBOSE
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_INSIG
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"MAA-Signal %u - bad signal"
operator|,
name|sig
operator|)
argument_list|)
expr_stmt|;
name|MBUF_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
return|return
operator|(
name|EINVAL
operator|)
return|;
block|}
name|VERBOSE
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_INSIG
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"MAA-Signal %s in state %s with%s message"
operator|,
name|sscop_msigs
index|[
name|sig
index|]
operator|,
name|states
index|[
name|sscop
operator|->
name|state
index|]
operator|,
name|m
condition|?
literal|""
else|:
literal|"out"
operator|)
argument_list|)
expr_stmt|;
name|MSG_ALLOC
argument_list|(
name|msg
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate maasig"
argument_list|)
expr_stmt|;
name|MBUF_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
return|return
operator|(
name|ENOMEM
operator|)
return|;
block|}
switch|switch
condition|(
name|sig
condition|)
block|{
case|case
name|SSCOP_MDATA_request
case|:
name|msg
operator|->
name|m
operator|=
name|m
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_MDATA
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSCOP_MDATA_indication
case|:
case|case
name|SSCOP_MERROR_indication
case|:
name|MBUF_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
operator|(
name|EINVAL
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Map PDU to SSCOP signal.  */
end_comment

begin_function
name|void
name|sscop_input
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
parameter_list|)
block|{
name|struct
name|sscop_msg
modifier|*
name|msg
decl_stmt|;
name|union
name|pdu
name|pdu
decl_stmt|;
name|u_int
name|size
decl_stmt|;
name|MSG_ALLOC
argument_list|(
name|msg
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate in pdu msg"
argument_list|)
expr_stmt|;
name|MBUF_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
return|return;
block|}
name|msg
operator|->
name|m
operator|=
name|m
expr_stmt|;
name|msg
operator|->
name|rexmit
operator|=
literal|0
expr_stmt|;
name|size
operator|=
name|MBUF_LEN
argument_list|(
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|%
literal|4
operator|!=
literal|0
operator|||
name|size
operator|<
literal|4
condition|)
goto|goto
name|err
goto|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_TRAIL32
argument_list|(
name|m
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|VERBOSE
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_PDU
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"got %s, size=%u"
operator|,
name|pdus
index|[
name|pdu
operator|.
name|sscop_type
index|]
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SSCOP_DEBUG
define|#
directive|define
name|ENSURE
parameter_list|(
name|C
parameter_list|,
name|F
parameter_list|)
value|if(!(C)) { VERBOSE(sscop, SSCOP_DBG_PDU, F); goto err; }
else|#
directive|else
define|#
directive|define
name|ENSURE
parameter_list|(
name|C
parameter_list|,
name|F
parameter_list|)
value|if(!(C)) goto err
endif|#
directive|endif
ifdef|#
directive|ifdef
name|SSCOP_DEBUG
if|if
condition|(
name|ISVERBOSE
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_PDU
argument_list|)
condition|)
name|sscop_dump_pdu
argument_list|(
name|sscop
argument_list|,
literal|"rx"
argument_list|,
name|m
argument_list|)
expr_stmt|;
endif|#
directive|endif
switch|switch
condition|(
name|pdu
operator|.
name|sscop_type
condition|)
block|{
default|default:
name|ENSURE
argument_list|(
literal|0
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"Bad PDU type %u"
operator|,
name|pdu
operator|.
name|sscop_type
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_BGN
case|:
name|ENSURE
argument_list|(
name|size
operator|>=
literal|8U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_BGN size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|>=
literal|8U
operator|+
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_BGN size=%u pl=%u"
operator|,
name|size
operator|,
name|pdu
operator|.
name|sscop_pl
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|<=
literal|8U
operator|+
name|sscop
operator|->
name|maxj
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_BGN size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_BGN
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_BGAK
case|:
name|ENSURE
argument_list|(
name|size
operator|>=
literal|8U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_BGAK size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|>=
literal|8U
operator|+
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_BGAK size=%u pl=%u"
operator|,
name|size
operator|,
name|pdu
operator|.
name|sscop_pl
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|<=
literal|8U
operator|+
name|sscop
operator|->
name|maxj
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_BGAK size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_BGAK
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_END
case|:
name|ENSURE
argument_list|(
name|size
operator|>=
literal|8U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_END size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|>=
literal|8U
operator|+
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_END size=%u pl=%u"
operator|,
name|size
operator|,
name|pdu
operator|.
name|sscop_pl
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|<=
literal|8U
operator|+
name|sscop
operator|->
name|maxj
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_END size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_END
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_ENDAK
case|:
name|ENSURE
argument_list|(
name|size
operator|==
literal|8U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_ENDAK size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_ENDAK
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_BGREJ
case|:
name|ENSURE
argument_list|(
name|size
operator|>=
literal|8U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_BGREJ size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|>=
literal|8U
operator|+
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_BGREJ size=%u pl=%u"
operator|,
name|size
operator|,
name|pdu
operator|.
name|sscop_pl
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|<=
literal|8U
operator|+
name|sscop
operator|->
name|maxj
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_BGREJ size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_BGREJ
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_SD
case|:
name|ENSURE
argument_list|(
name|size
operator|>=
literal|4U
operator|+
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_SD size=%u pl=%u"
operator|,
name|size
operator|,
name|pdu
operator|.
name|sscop_pl
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|<=
literal|4U
operator|+
name|sscop
operator|->
name|maxk
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_SD size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_SD
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_UD
case|:
name|ENSURE
argument_list|(
name|size
operator|>=
literal|4U
operator|+
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_UD size=%u pl=%u"
operator|,
name|size
operator|,
name|pdu
operator|.
name|sscop_pl
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|<=
literal|4U
operator|+
name|sscop
operator|->
name|maxk
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_UD size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_UD
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_MD
case|:
name|ENSURE
argument_list|(
name|size
operator|>=
literal|4U
operator|+
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_MD size=%u pl=%u"
operator|,
name|size
operator|,
name|pdu
operator|.
name|sscop_pl
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|<=
literal|4U
operator|+
name|sscop
operator|->
name|maxk
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_MD size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_MD
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_POLL
case|:
name|ENSURE
argument_list|(
name|size
operator|==
literal|8U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_POLL size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_POLL
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_STAT
case|:
name|ENSURE
argument_list|(
name|size
operator|>=
literal|12U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_STAT size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|<=
literal|12U
operator|+
literal|4
operator|*
name|sscop
operator|->
name|maxstat
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_STAT size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_STAT
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_RS
case|:
name|ENSURE
argument_list|(
name|size
operator|>=
literal|8U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_RS size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|>=
literal|8U
operator|+
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_RS size=%u pl=%u"
operator|,
name|size
operator|,
name|pdu
operator|.
name|sscop_pl
operator|)
argument_list|)
expr_stmt|;
name|ENSURE
argument_list|(
name|size
operator|<=
literal|8U
operator|+
name|sscop
operator|->
name|maxj
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_RS size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_RS
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_RSAK
case|:
name|ENSURE
argument_list|(
name|size
operator|==
literal|8U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_RSAK size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_RSAK
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_ER
case|:
name|ENSURE
argument_list|(
name|size
operator|==
literal|8U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_ER size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_ER
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_ERAK
case|:
name|ENSURE
argument_list|(
name|size
operator|==
literal|8U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_ERAK size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_ERAK
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|PDU_USTAT
case|:
name|ENSURE
argument_list|(
name|size
operator|==
literal|16U
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"PDU_ERAK size=%u"
operator|,
name|size
operator|)
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_USTAT
argument_list|,
name|msg
argument_list|)
expr_stmt|;
break|break;
block|}
undef|#
directive|undef
name|ENSURE
return|return;
name|err
label|:
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'U'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/************************************************************/
end_comment

begin_comment
comment|/*  * UTILITIES  */
end_comment

begin_comment
comment|/*  * Move the receiver window by N packets  */
end_comment

begin_function
name|u_int
name|sscop_window
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|u_int
name|n
parameter_list|)
block|{
name|sscop
operator|->
name|vr_mr
operator|+=
name|n
expr_stmt|;
return|return
operator|(
name|SEQNO_DIFF
argument_list|(
name|sscop
operator|->
name|vr_mr
argument_list|,
name|sscop
operator|->
name|vr_r
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Lower layer busy handling  */
end_comment

begin_function
name|u_int
name|sscop_setbusy
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|int
name|busy
parameter_list|)
block|{
name|u_int
name|old
init|=
name|sscop
operator|->
name|ll_busy
decl_stmt|;
if|if
condition|(
name|busy
operator|>
literal|0
condition|)
name|sscop
operator|->
name|ll_busy
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|busy
operator|==
literal|0
condition|)
block|{
name|sscop
operator|->
name|ll_busy
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|old
condition|)
name|handle_sigs
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|old
operator|)
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|sscop_signame
parameter_list|(
name|enum
name|sscop_aasig
name|sig
parameter_list|)
block|{
specifier|static
name|char
name|str
index|[
literal|40
index|]
decl_stmt|;
if|if
condition|(
name|sig
operator|>=
sizeof|sizeof
argument_list|(
name|sscop_sigs
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|sscop_sigs
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"BAD SSCOP_AASIG %u"
argument_list|,
name|sig
argument_list|)
expr_stmt|;
return|return
operator|(
name|str
operator|)
return|;
block|}
else|else
block|{
return|return
operator|(
name|sscop_sigs
index|[
name|sig
index|]
operator|)
return|;
block|}
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|sscop_msigname
parameter_list|(
name|enum
name|sscop_maasig
name|sig
parameter_list|)
block|{
specifier|static
name|char
name|str
index|[
literal|40
index|]
decl_stmt|;
if|if
condition|(
name|sig
operator|>=
sizeof|sizeof
argument_list|(
name|sscop_msigs
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|sscop_msigs
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"BAD SSCOP_MAASIG %u"
argument_list|,
name|sig
argument_list|)
expr_stmt|;
return|return
operator|(
name|str
operator|)
return|;
block|}
else|else
block|{
return|return
operator|(
name|sscop_msigs
index|[
name|sig
index|]
operator|)
return|;
block|}
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|sscop_statename
parameter_list|(
name|enum
name|sscop_state
name|s
parameter_list|)
block|{
specifier|static
name|char
name|str
index|[
literal|40
index|]
decl_stmt|;
if|if
condition|(
name|s
operator|>=
sizeof|sizeof
argument_list|(
name|states
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|states
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"BAD SSCOP_STATE %u"
argument_list|,
name|s
argument_list|)
expr_stmt|;
return|return
operator|(
name|str
operator|)
return|;
block|}
else|else
block|{
return|return
operator|(
name|states
index|[
name|s
index|]
operator|)
return|;
block|}
block|}
end_function

begin_comment
comment|/************************************************************/
end_comment

begin_comment
comment|/*  * MACROS  */
end_comment

begin_comment
comment|/*  * p 75: release buffers  */
end_comment

begin_function
specifier|static
name|void
name|m_release_buffers
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|rxq
operator|=
literal|0
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P 75: Prepare retrival  */
end_comment

begin_function
specifier|static
name|void
name|m_prepare_retrieval
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|struct
name|sscop_msg
modifier|*
name|msg
decl_stmt|;
if|if
condition|(
name|sscop
operator|->
name|clear_buffers
condition|)
block|{
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|)
expr_stmt|;
block|}
name|MSGQ_FOREACH
argument_list|(
argument|msg
argument_list|,
argument|&sscop->xbuf
argument_list|)
name|msg
operator|->
name|rexmit
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|rxq
operator|=
literal|0
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P 75: Prepare retrival  */
end_comment

begin_function
specifier|static
name|void
name|m_prepare_recovery
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|struct
name|sscop_msg
modifier|*
name|msg
decl_stmt|;
if|if
condition|(
name|sscop
operator|->
name|clear_buffers
condition|)
block|{
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|)
expr_stmt|;
block|}
name|MSGQ_FOREACH
argument_list|(
argument|msg
argument_list|,
argument|&sscop->xbuf
argument_list|)
name|msg
operator|->
name|rexmit
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|rxq
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P 75: Clear transmitter  */
end_comment

begin_function
specifier|static
name|void
name|m_clear_transmitter
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
if|if
condition|(
operator|!
name|sscop
operator|->
name|clear_buffers
condition|)
block|{
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * p 75: Deliver data  * Freeing the message is the responibility of the handler function.  */
end_comment

begin_function
specifier|static
name|void
name|m_deliver_data
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|struct
name|sscop_msg
modifier|*
name|msg
decl_stmt|;
name|u_int
name|sn
decl_stmt|;
if|if
condition|(
operator|(
name|msg
operator|=
name|MSGQ_GET
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|sscop
operator|->
name|clear_buffers
condition|)
block|{
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
return|return;
block|}
name|sn
operator|=
name|msg
operator|->
name|seqno
operator|+
literal|1
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DATA_indication
argument_list|,
name|msg
operator|->
name|m
argument_list|,
name|msg
operator|->
name|seqno
argument_list|)
expr_stmt|;
name|MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|msg
operator|=
name|MSGQ_GET
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|ASSERT
argument_list|(
name|msg
operator|->
name|seqno
operator|==
name|sn
argument_list|)
expr_stmt|;
if|if
condition|(
operator|++
name|sn
operator|==
name|SSCOP_MAXSEQNO
condition|)
name|sn
operator|=
literal|0
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DATA_indication
argument_list|,
name|msg
operator|->
name|m
argument_list|,
name|msg
operator|->
name|seqno
argument_list|)
expr_stmt|;
name|MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * P 75: Initialize state variables  */
end_comment

begin_function
specifier|static
name|void
name|m_initialize_state
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|sscop
operator|->
name|vt_s
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|vt_ps
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|vt_a
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|vt_pa
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|vt_pd
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|credit
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|vr_r
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|vr_h
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 76: Data retrieval  */
end_comment

begin_function
specifier|static
name|void
name|m_data_retrieval
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|u_int
name|rn
parameter_list|)
block|{
name|struct
name|sscop_msg
modifier|*
name|s
decl_stmt|;
if|if
condition|(
name|rn
operator|!=
name|SSCOP_RETRIEVE_UNKNOWN
condition|)
block|{
if|if
condition|(
name|rn
operator|>=
name|SSCOP_RETRIEVE_TOTAL
condition|)
name|rn
operator|=
name|sscop
operator|->
name|vt_a
expr_stmt|;
else|else
name|rn
operator|++
expr_stmt|;
while|while
condition|(
name|rn
operator|>=
name|sscop
operator|->
name|vt_a
operator|&&
name|rn
operator|<
name|sscop
operator|->
name|vt_s
condition|)
block|{
if|if
condition|(
name|rn
operator|==
name|SSCOP_MAXSEQNO
condition|)
name|rn
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|s
operator|=
name|QFIND
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|,
name|rn
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|MSGQ_REMOVE
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RETRIEVE_indication
argument_list|,
name|s
operator|->
name|m
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|MSG_FREE
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
name|rn
operator|++
expr_stmt|;
block|}
block|}
while|while
condition|(
operator|(
name|s
operator|=
name|MSGQ_GET
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RETRIEVE_indication
argument_list|,
name|s
operator|->
name|m
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|MSG_FREE
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
name|AAL_SIG
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RETRIEVE_COMPL_indication
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P 76: Detect retransmission. PDU type must already be stripped.  */
end_comment

begin_function
specifier|static
name|int
name|m_detect_retransmission
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|bgn
name|bgn
decl_stmt|;
name|bgn
operator|.
name|sscop_null
operator|=
name|MBUF_TRAIL32
argument_list|(
name|msg
operator|->
name|m
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|sscop
operator|->
name|vr_sq
operator|==
name|bgn
operator|.
name|sscop_bgns
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|sscop
operator|->
name|vr_sq
operator|=
name|bgn
operator|.
name|sscop_bgns
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * P 76: Set POLL timer  */
end_comment

begin_function
specifier|static
name|void
name|m_set_poll_timer
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
if|if
condition|(
name|MSGQ_EMPTY
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|)
operator|&&
name|sscop
operator|->
name|vt_s
operator|==
name|sscop
operator|->
name|vt_a
condition|)
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|ka
argument_list|)
expr_stmt|;
else|else
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|poll
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P 77: Reset data transfer timers  */
end_comment

begin_function
specifier|static
name|void
name|m_reset_data_xfer_timers
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|ka
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|idle
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|poll
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P 77: Set data transfer timers  */
end_comment

begin_function
specifier|static
name|void
name|m_set_data_xfer_timers
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|poll
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P 77: Initialize VR(MR)  */
end_comment

begin_function
specifier|static
name|void
name|m_initialize_mr
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|sscop
operator|->
name|vr_mr
operator|=
name|sscop
operator|->
name|mr
expr_stmt|;
block|}
end_function

begin_comment
comment|/************************************************************/
end_comment

begin_comment
comment|/*  * CONDITIONS  */
end_comment

begin_function
specifier|static
name|int
name|c_ready_pduq
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
if|if
condition|(
operator|!
name|sscop
operator|->
name|ll_busy
operator|&&
operator|(
name|sscop
operator|->
name|rxq
operator|!=
literal|0
operator|||
name|sscop
operator|->
name|vt_s
operator|<
name|sscop
operator|->
name|vt_ms
operator|||
name|TIMER_ISACT
argument_list|(
name|sscop
argument_list|,
name|idle
argument_list|)
operator|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/************************************************************/
end_comment

begin_comment
comment|/*  * SEND PDUS  */
end_comment

begin_comment
comment|/*  * Send BG PDU.  */
end_comment

begin_function
specifier|static
name|void
name|send_bgn
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|uu
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|bgn
name|bgn
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_BGN
expr_stmt|;
name|pdu
operator|.
name|sscop_ns
operator|=
name|sscop
operator|->
name|vr_mr
expr_stmt|;
name|bgn
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|bgn
operator|.
name|sscop_bgns
operator|=
name|sscop
operator|->
name|vt_sq
expr_stmt|;
if|if
condition|(
name|uu
condition|)
block|{
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_DUP
argument_list|(
name|uu
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate BGN"
argument_list|)
expr_stmt|;
return|return;
block|}
name|pdu
operator|.
name|sscop_pl
operator|+=
name|MBUF_PAD4
argument_list|(
name|m
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
literal|8
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate BGN"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|bgn
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send BGREJ PDU.  */
end_comment

begin_function
specifier|static
name|void
name|send_bgrej
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|uu
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|bgn
name|bgn
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_BGREJ
expr_stmt|;
name|bgn
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|uu
condition|)
block|{
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_DUP
argument_list|(
name|uu
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate BGREJ"
argument_list|)
expr_stmt|;
return|return;
block|}
name|pdu
operator|.
name|sscop_pl
operator|+=
name|MBUF_PAD4
argument_list|(
name|m
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
literal|8
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate BGREJ"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|bgn
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send BGAK PDU.  */
end_comment

begin_function
specifier|static
name|void
name|send_bgak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|uu
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|bgn
name|bgn
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_BGAK
expr_stmt|;
name|pdu
operator|.
name|sscop_ns
operator|=
name|sscop
operator|->
name|vr_mr
expr_stmt|;
name|bgn
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|uu
condition|)
block|{
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_DUP
argument_list|(
name|uu
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate BGAK"
argument_list|)
expr_stmt|;
return|return;
block|}
name|pdu
operator|.
name|sscop_pl
operator|+=
name|MBUF_PAD4
argument_list|(
name|m
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
literal|8
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate BGAK"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|bgn
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send SD PDU. The function makes a duplicate of the message.  */
end_comment

begin_function
specifier|static
name|void
name|send_sd
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
parameter_list|,
name|u_int
name|seqno
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_DUP
argument_list|(
name|m
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate SD"
argument_list|)
expr_stmt|;
return|return;
block|}
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_pl
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_SD
expr_stmt|;
name|pdu
operator|.
name|sscop_ns
operator|=
name|seqno
expr_stmt|;
name|pdu
operator|.
name|sscop_pl
operator|+=
name|MBUF_PAD4
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send a UD PDU. The caller must free the sscop msg part.  */
end_comment

begin_function
specifier|static
name|void
name|send_ud
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_UD
expr_stmt|;
name|pdu
operator|.
name|sscop_pl
operator|+=
name|MBUF_PAD4
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send a MD PDU. The caller must free the sscop msg part.  */
end_comment

begin_function
specifier|static
name|void
name|send_md
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_MD
expr_stmt|;
name|pdu
operator|.
name|sscop_pl
operator|+=
name|MBUF_PAD4
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send END PDU.  */
end_comment

begin_function
specifier|static
name|void
name|send_end
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|int
name|src
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|uu
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|sscop
operator|->
name|last_end_src
operator|=
name|src
expr_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_s
operator|=
name|src
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_END
expr_stmt|;
if|if
condition|(
name|uu
condition|)
block|{
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_DUP
argument_list|(
name|uu
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate END"
argument_list|)
expr_stmt|;
return|return;
block|}
name|pdu
operator|.
name|sscop_pl
operator|+=
name|MBUF_PAD4
argument_list|(
name|m
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
literal|8
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate END"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send USTAT PDU. List must be terminated by -1.  */
end_comment

begin_function
specifier|static
name|void
name|send_ustat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|ap
decl_stmt|;
name|int
name|f
decl_stmt|;
name|u_int
name|n
decl_stmt|;
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|seqno
name|seqno
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|sscop
argument_list|)
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|f
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|int
argument_list|)
operator|)
operator|>=
literal|0
condition|)
name|n
operator|++
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
name|n
operator|*
literal|4
operator|+
literal|8
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate USTAT"
argument_list|)
expr_stmt|;
return|return;
block|}
name|va_start
argument_list|(
name|ap
argument_list|,
name|sscop
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|f
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|int
argument_list|)
operator|)
operator|>=
literal|0
condition|)
block|{
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|seqno
operator|.
name|sscop_n
operator|=
name|f
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
block|}
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|seqno
operator|.
name|sscop_n
operator|=
name|sscop
operator|->
name|vr_mr
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_USTAT
expr_stmt|;
name|pdu
operator|.
name|sscop_ns
operator|=
name|sscop
operator|->
name|vr_r
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send ER PDU.  */
end_comment

begin_function
specifier|static
name|void
name|send_er
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|bgn
name|bgn
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_ER
expr_stmt|;
name|pdu
operator|.
name|sscop_ns
operator|=
name|sscop
operator|->
name|vr_mr
expr_stmt|;
name|bgn
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|bgn
operator|.
name|sscop_bgns
operator|=
name|sscop
operator|->
name|vt_sq
expr_stmt|;
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
literal|8
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate ER"
argument_list|)
expr_stmt|;
return|return;
block|}
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|bgn
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send POLL PDU.  */
end_comment

begin_function
specifier|static
name|void
name|send_poll
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|seqno
name|seqno
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|seqno
operator|.
name|sscop_n
operator|=
name|sscop
operator|->
name|vt_ps
expr_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_ns
operator|=
name|sscop
operator|->
name|vt_s
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_POLL
expr_stmt|;
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
literal|8
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate POLL"
argument_list|)
expr_stmt|;
return|return;
block|}
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send STAT PDU. List is already in buffer.  */
end_comment

begin_function
specifier|static
name|void
name|send_stat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|u_int
name|nps
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|seqno
name|seqno
decl_stmt|;
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|seqno
operator|.
name|sscop_n
operator|=
name|nps
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|seqno
operator|.
name|sscop_n
operator|=
name|sscop
operator|->
name|vr_mr
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_STAT
expr_stmt|;
name|pdu
operator|.
name|sscop_ns
operator|=
name|sscop
operator|->
name|vr_r
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send ENDAK PDU.  */
end_comment

begin_function
specifier|static
name|void
name|send_endak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|seqno
name|seqno
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_ENDAK
expr_stmt|;
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
literal|8
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate ENDAK"
argument_list|)
expr_stmt|;
return|return;
block|}
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send ERAK PDU.  */
end_comment

begin_function
specifier|static
name|void
name|send_erak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|seqno
name|seqno
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_ERAK
expr_stmt|;
name|pdu
operator|.
name|sscop_ns
operator|=
name|sscop
operator|->
name|vr_mr
expr_stmt|;
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
literal|8
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate ERAK"
argument_list|)
expr_stmt|;
return|return;
block|}
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send RS PDU  */
end_comment

begin_function
specifier|static
name|void
name|send_rs
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|int
name|resend
parameter_list|,
name|struct
name|SSCOP_MBUF_T
modifier|*
name|uu
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|bgn
name|bgn
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_RS
expr_stmt|;
name|pdu
operator|.
name|sscop_ns
operator|=
name|resend
condition|?
name|sscop
operator|->
name|rs_mr
else|:
name|sscop
operator|->
name|vr_mr
expr_stmt|;
name|bgn
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|bgn
operator|.
name|sscop_bgns
operator|=
name|resend
condition|?
name|sscop
operator|->
name|rs_sq
else|:
name|sscop
operator|->
name|vt_sq
expr_stmt|;
name|sscop
operator|->
name|rs_mr
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|sscop
operator|->
name|rs_sq
operator|=
name|bgn
operator|.
name|sscop_bgns
expr_stmt|;
if|if
condition|(
name|uu
condition|)
block|{
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_DUP
argument_list|(
name|uu
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate RS"
argument_list|)
expr_stmt|;
return|return;
block|}
name|pdu
operator|.
name|sscop_pl
operator|+=
name|MBUF_PAD4
argument_list|(
name|m
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
literal|8
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate RS"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|bgn
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Send RSAK pdu  */
end_comment

begin_function
specifier|static
name|void
name|send_rsak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|seqno
name|seqno
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|pdu
operator|.
name|sscop_type
operator|=
name|PDU_RSAK
expr_stmt|;
name|pdu
operator|.
name|sscop_ns
operator|=
name|sscop
operator|->
name|vr_mr
expr_stmt|;
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
literal|8
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate RSAK"
argument_list|)
expr_stmt|;
return|return;
block|}
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|pdu
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
name|AAL_SEND
argument_list|(
name|sscop
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/************************************************************/
end_comment

begin_comment
comment|/*  * P 31; IDLE&& AA-ESTABLISH-request  *	arg is UU data (opt).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_establish_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|u_int
name|br
init|=
name|uu
operator|->
name|rexmit
decl_stmt|;
name|SET_UU
argument_list|(
name|uu_bgn
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|m_clear_transmitter
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|clear_buffers
operator|=
name|br
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|vt_sq
operator|++
expr_stmt|;
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_bgn
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|uu_bgn
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P 31: IDLE&& BGN PDU  *	arg is the received PDU (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_bgn
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|bgn
name|bgn
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|sscop
operator|->
name|robustness
condition|)
block|{
name|bgn
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vr_sq
operator|=
name|bgn
operator|.
name|sscop_bgns
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|send_bgrej
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|uu_bgrej
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
block|}
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_PEND
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_ESTABLISH_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 31: IDLE&& ENDAK PDU  * p 34: OUT_PEND&& ENDAK PDU  * p 34: OUT_PEND&& SD PDU  * p 34: OUT_PEND&& ERAK PDU  * p 34: OUT_PEND&& END PDU  * p 34: OUT_PEND&& STAT PDU  * p 34: OUT_PEND&& USTAT PDU  * p 34: OUT_PEND&& POLL PDU  * p 36: OUT_PEND&& RS PDU  * p 36: OUT_PEND&& RSAK PDU  * p 40: OUTGOING_DISCONNECT_PENDING&& SD PDU  * p 40: OUTGOING_DISCONNECT_PENDING&& BGAK PDU  * p 40: OUTGOING_DISCONNECT_PENDING&& POLL PDU  * p 40: OUTGOING_DISCONNECT_PENDING&& STAT PDU  * p 40: OUTGOING_DISCONNECT_PENDING&& USTAT PDU  * p 41: OUTGOING_DISCONNECT_PENDING&& ERAK PDU  * p 42: OUTGOING_DISCONNECT_PENDING&& ER PDU  * p 42: OUTGOING_DISCONNECT_PENDING&& RS PDU  * p 42: OUTGOING_DISCONNECT_PENDING&& RSAK PDU  * p 43: OUTGOING_RESYNC&& ER PDU  * p 43: OUTGOING_RESYNC&& POLL PDU  * p 44: OUTGOING_RESYNC&& STAT PDU  * p 44: OUTGOING_RESYNC&& USTAT PDU  * p 45: OUTGOING_RESYNC&& BGAK PDU  * p 45: OUTGOING_RESYNC&& SD PDU  * p 45: OUTGOING_RESYNC&& ERAK PDU  * P 60: READY&& BGAK PDU  * P 60: READY&& ERAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ignore_pdu
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
name|__unused
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 31: IDLE&& END PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_end
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|send_endak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 31: IDLE&& ER PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_er
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'L'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 31: IDLE&& BGREJ PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_bgrej
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'D'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 32: IDLE&& POLL PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_poll
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'G'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 32: IDLE&& SD PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_sd
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'A'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 32: IDLE&& BGAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_bgak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'C'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 32: IDLE&& ERAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_erak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'M'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 32: IDLE&& STAT PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_stat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'H'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 32: IDLE&& USTAT PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_ustat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'I'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 33: IDLE& RS PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_rs
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'J'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 33: IDLE& RSAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_idle_rsak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'K'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 33: IDLE&& PDU_Q  * p XX: OUTPEND&& PDU_Q  * p 39: IN_PEND&& PDU_Q  * p 45: OUT_RESYNC_PEND&& PDU_Q  * p 48: IN_RESYNC_PEND&& PDU_Q  *	no arg  */
end_comment

begin_function
specifier|static
name|void
name|sscop_flush_pduq
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
name|__unused
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
if|#
directive|if
literal|0
block|MSGQ_CLEAR(&sscop->xq);
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/*  * p 34: OUT_PEND&& BGAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outpend_bgak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_ESTABLISH_confirm
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|m_initialize_state
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_set_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_READY
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P 34: OUT_PEND&& BGREJ PDU  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outpend_bgrej
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P 35: OUT_PEND&& TIMER_CC expiry  *	no arg  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outpend_tcc
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
if|if
condition|(
name|sscop
operator|->
name|vt_cc
operator|>=
name|sscop
operator|->
name|maxcc
condition|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'O'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sscop
operator|->
name|vt_cc
operator|++
expr_stmt|;
name|send_bgn
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|uu_bgn
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * P 35: OUT_PEND&& RELEASE_REQ  *	arg is UU  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outpend_release_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_end
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|0
argument_list|,
name|sscop
operator|->
name|uu_end
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_DIS_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P 36: OUT_PEND&& BGN PDU  *	arg is the received PDU (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outpend_bgn
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_bgak
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|uu_bgak
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_ESTABLISH_confirm
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|m_initialize_state
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_set_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_READY
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 37: IN_PEND&& AA-ESTABLISH.response  *	arg is UU  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_establish_resp
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|u_int
name|br
init|=
name|uu
operator|->
name|rexmit
decl_stmt|;
name|SET_UU
argument_list|(
name|uu_bgak
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|m_clear_transmitter
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|clear_buffers
operator|=
name|br
expr_stmt|;
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_bgak
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|uu_bgak
argument_list|)
expr_stmt|;
name|m_initialize_state
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_set_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_READY
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 37: IN_PEND&& AA-RELEASE.request  *	arg is uu.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_release_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_bgrej
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|send_bgrej
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|uu_bgrej
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 37: IN_PEND&& BGN PDU  *	arg is pdu. (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_bgn
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_ESTABLISH_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 37: IN_PEND&& ER PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_er
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'L'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 37: IN_PEND&& ENDAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_endak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'F'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 38: IN_PEND&& BGAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_bgak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'C'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 38: IN_PEND&& BGREJ PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_bgrej
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'D'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 38: IN_PEND&& SD PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_sd
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'A'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 38: IN_PEND&& USTAT PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_ustat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'I'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 38: IN_PEND&& STAT PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_stat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'H'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 38: IN_PEND&& POLL PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_poll
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'G'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 39: IN_PEND&& ERAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_erak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'M'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 39: IN_PEND& RS PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_rs
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'J'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 39: IN_PEND& RSAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_rsak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'K'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 39: IN_PEND&& END PDU  *	arg is pdu (freed).  *	no uui  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inpend_end
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|send_endak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_s
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 40: OUT_DIS_PEND&& SSCOP_ESTABLISH_request  *	no arg.  *	no uui.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outdis_establish_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_bgn
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|m_clear_transmitter
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|clear_buffers
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|vt_sq
operator|++
expr_stmt|;
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_bgn
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|uu_bgn
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 41: OUT_DIS_PEND&& END PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outdis_end
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|send_endak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_confirm
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 41: OUT_DIS_PEND&& ENDAK PDU  * p 41: OUT_DIS_PEND&& BGREJ PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outdis_endak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_confirm
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 41: OUT_DIS_PEND&& TIMER CC expiry  *	no arg  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outdis_cc
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
if|if
condition|(
name|sscop
operator|->
name|vt_cc
operator|>=
name|sscop
operator|->
name|maxcc
condition|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'O'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_SIG
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_confirm
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sscop
operator|->
name|vt_cc
operator|++
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|last_end_src
argument_list|,
name|sscop
operator|->
name|uu_end
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * p 42: OUT_DIS_PEND&& BGN PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outdis_bgn
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|FREE_UU
argument_list|(
name|uu_bgak
argument_list|)
expr_stmt|;
name|send_bgak
argument_list|(
name|sscop
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|last_end_src
argument_list|,
name|sscop
operator|->
name|uu_end
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_SIG
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_confirm
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_ESTABLISH_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_PEND
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * p 43: OUT_RESYNC_PEND&& BGN PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outsync_bgn
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|send_bgak
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|uu_bgak
argument_list|)
expr_stmt|;
name|send_rs
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|sscop
operator|->
name|uu_rs
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_ESTABLISH_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_PEND
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * p 43: OUT_RESYNC_PEND&& ENDAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outsync_endak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'F'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 43: OUT_RESYNC_PEND&& BGREJ PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outsync_bgrej
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'D'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 43: OUT_RESYNC_PEND&& END PDU  *	arg is pdu (freed).  *	no UU-data  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outsync_end
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|send_endak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_s
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 44: OUT_RESYNC&& TIMER CC expiry  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outsync_cc
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
name|__unused
parameter_list|)
block|{
if|if
condition|(
name|sscop
operator|->
name|vt_cc
operator|==
name|sscop
operator|->
name|maxcc
condition|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'O'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sscop
operator|->
name|vt_cc
operator|++
expr_stmt|;
name|send_rs
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|sscop
operator|->
name|uu_rs
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * p 44: OUT_RESYNC&& AA-RELEASE.request  *	arg is UU  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outsync_release_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_end
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|0
argument_list|,
name|sscop
operator|->
name|uu_end
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_DIS_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 45: OUT_RESYNC&& RS PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outsync_rs
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_rsak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RESYNC_confirm
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|m_initialize_state
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_set_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_READY
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 45: OUT_RESYNC&& RSAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outsync_rsak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_SIG
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RESYNC_confirm
argument_list|)
expr_stmt|;
name|m_initialize_state
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_set_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_READY
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 46: IN_RESYNC_PEND&& AA-RESYNC.response  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_sync_resp
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|noarg
name|__unused
parameter_list|)
block|{
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_rsak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_clear_transmitter
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_initialize_state
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_set_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_READY
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 46: IN_RESYNC_PEND&& AA-RELEASE.request  *	arg is uu  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_release_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_end
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|0
argument_list|,
name|sscop
operator|->
name|uu_end
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_DIS_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 46: IN_RESYNC_PEND&& ENDAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_endak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'F'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 46: IN_RESYNC_PEND&& BGREJ PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_bgrej
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'D'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 46: IN_RESYNC_PEND&& END PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_end
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|send_endak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_s
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 47: IN_RESYNC_PEND&& ER PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_er
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'L'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 47: IN_RESYNC_PEND&& BGN PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_bgn
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'B'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_ESTABLISH_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 47: IN_RESYNC_PEND&& SD PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_sd
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'A'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 47: IN_RESYNC_PEND&& POLL PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_poll
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'G'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 47: IN_RESYNC_PEND&& STAT PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_stat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'H'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 47: IN_RESYNC_PEND&& USTAT PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_ustat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'I'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 48: IN_RESYNC_PEND&& BGAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_bgak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'C'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 48: IN_RESYNC_PEND&& ERAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_erak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'M'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 48: IN_RESYNC_PEND&& RS PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_rs
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'J'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 48: IN_RESYNC_PEND&& RSAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_insync_rsak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'K'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 49: OUT_REC_PEND&& AA-DATA.request  *	arg is message (queued).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_userdata
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
if|if
condition|(
operator|!
name|sscop
operator|->
name|clear_buffers
condition|)
block|{
name|MSGQ_APPEND
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_PDU_Q
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * p 49: OUT_REC_PEND&& BGAK PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_bgak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'C'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 49: OUT_REC_PEND&& ERAK PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_erak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|m_deliver_data
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_SIG
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RECOVER_indication
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_REC_PEND
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 49: OUT_REC_PEND&& END PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_end
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|send_endak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_s
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 49: OUT_REC_PEND&& ENDAK PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_endak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'F'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 49: OUT_REC_PEND&& BGREJ PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_bgrej
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'D'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 50: OUT_REC_PEND&& TIMER CC expiry  *	no arg.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_cc
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
if|if
condition|(
name|sscop
operator|->
name|vt_cc
operator|>=
name|sscop
operator|->
name|maxcc
condition|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'O'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sscop
operator|->
name|vt_cc
operator|++
expr_stmt|;
name|send_er
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * p 50: OUT_REC_PEND&& SSCOP_RELEASE_request  *	arg is UU  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_release_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_end
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|0
argument_list|,
name|sscop
operator|->
name|uu_end
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_DIS_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 51: OUT_REC_PEND&& AA-RESYNC.request  *	arg is uu  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_sync_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_rs
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|vt_sq
operator|++
expr_stmt|;
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_rs
argument_list|(
name|sscop
argument_list|,
literal|0
argument_list|,
name|sscop
operator|->
name|uu_rs
argument_list|)
expr_stmt|;
name|m_clear_transmitter
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 51: OUT_REC_PEND&& BGN PDU  *	arg is pdu (freed).  *	no uui  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_bgn
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'B'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_ESTABLISH_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_PEND
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * p 51: OUT_REC_PEND&& ER PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_er
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'L'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_erak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_deliver_data
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_SIG
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RECOVER_indication
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_REC_PEND
argument_list|)
expr_stmt|;
block|}
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 52: OUT_REC_PEND&& SD PDU queued  *	no arg.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_pduq
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|sscop_save_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_PDU_Q
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 52: OUT_REC_PEND&& RSAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_rsak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'K'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 52: OUT_REC_PEND&& RS PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_outrec_rs
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'J'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RESYNC_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_RESYNC_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 53: REC_PEND&& BGAK PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_bgak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'C'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 53: REC_PEND&& END PDU  *	arg is pdu (freed)  *	no uui  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_end
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|send_endak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_s
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 53: REC_PEND&& ENDAK PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_endak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'F'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 53: REC_PEND&& BGREJ PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_bgrej
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'D'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 54: REC_PEND&& RELEASE  *	arg is UU  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_release_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_end
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|0
argument_list|,
name|sscop
operator|->
name|uu_end
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_DIS_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 54: REC_PEND&& RSAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_rsak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'K'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 54: REC_PEND&& RS PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_rs
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'J'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RESYNC_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_RESYNC_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 54: REC_PEND&& RECOVER response  *	no arg  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_recover
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
if|if
condition|(
operator|!
name|sscop
operator|->
name|clear_buffers
condition|)
block|{
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|)
expr_stmt|;
block|}
name|m_initialize_state
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_set_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_READY
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 54: REC_PEND&& RESYNC request  *	arg is uu  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_sync_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_rs
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|m_clear_transmitter
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|vt_sq
operator|++
expr_stmt|;
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_rs
argument_list|(
name|sscop
argument_list|,
literal|0
argument_list|,
name|sscop
operator|->
name|uu_rs
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_RESYNC_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 55: REC_PEND&& SD PDU queued  *	no arg  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_pduq
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|sscop_save_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_PDU_Q
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 55: REC_PEND&& ER PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_er
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|send_erak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'L'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 55: REC_PEND&& BGN PDU  *	arg is pdu (freed)  *	no uui  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_bgn
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'B'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_ESTABLISH_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 55: REC_PEND&& STAT PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_stat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'H'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 55: REC_PEND&& USTAT PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_rec_ustat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'I'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 56: IN_REC_PEND&& AA-RECOVER.response  *	no arg  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_recover
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
if|if
condition|(
operator|!
name|sscop
operator|->
name|clear_buffers
condition|)
block|{
name|MSGQ_CLEAR
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|)
expr_stmt|;
block|}
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_erak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_initialize_state
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_set_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_READY
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 56: IN_REC_PEND&& SD PDU queued  *	no arg  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_pduq
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|sscop_save_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_PDU_Q
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 56: IN_REC_PEND&& AA-RELEASE.request  *	arg is UU  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_release_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_end
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|0
argument_list|,
name|sscop
operator|->
name|uu_end
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_DIS_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 56: IN_REC_PEND&& END PDU  *	arg is pdu (freed).  *	no uui  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_end
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|send_endak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_s
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 56: IN_REC_PEND&& RESYNC_REQ  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_sync_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_rs
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|m_clear_transmitter
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|vt_sq
operator|++
expr_stmt|;
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_rs
argument_list|(
name|sscop
argument_list|,
literal|0
argument_list|,
name|sscop
operator|->
name|uu_rs
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_RESYNC_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 57: IN_REC_PEND&& ENDAK PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_endak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'F'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 57: IN_REC_PEND&& BGREJ PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_bgrej
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'D'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 57: IN_REC_PEND&& USTAT PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_ustat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'I'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 57: IN_REC_PEND&& STAT PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_stat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'H'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 57: IN_REC_PEND&& POLL PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_poll
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'G'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 57: IN_REC_PEND&& SD PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_sd
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'A'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 58: IN_REC_PEND&& RSAK PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_rsak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'K'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 58: IN_REC_PEND&& RS PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_rs
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'J'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RESYNC_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_RESYNC_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 59: IN_REC_PEND&& ER PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_er
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'L'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 59: IN_REC_PEND&& BGN PDU  *	arg is pdu (freed).  *	no uui  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_bgn
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'B'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_ESTABLISH_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 59: IN_REC_PEND&& BGAK PDU  *	arg is pdu (freed)  *	no uui  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_bgak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'C'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 59: IN_REC_PEND&& ERAK PDU  *	arg is pdu (freed)  *	no uui  */
end_comment

begin_function
specifier|static
name|void
name|sscop_inrec_erak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'M'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 60: READY&& RESYNC request  *	arg is UU  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_sync_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_rs
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|vt_sq
operator|++
expr_stmt|;
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_rs
argument_list|(
name|sscop
argument_list|,
literal|0
argument_list|,
name|sscop
operator|->
name|uu_rs
argument_list|)
expr_stmt|;
name|m_release_buffers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_RESYNC_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 60: READY&& AA-RELEASE.request  *	arg is uu.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_release_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|uu
parameter_list|)
block|{
name|SET_UU
argument_list|(
name|uu_end
argument_list|,
name|uu
argument_list|)
expr_stmt|;
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|0
argument_list|,
name|sscop
operator|->
name|uu_end
argument_list|)
expr_stmt|;
name|m_prepare_retrieval
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_DIS_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 61: READY&& ER PDU  *	arg is pdu (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_er
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
name|send_erak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|m_prepare_recovery
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_deliver_data
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_SIG
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RECOVER_indication
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_REC_PEND
argument_list|)
expr_stmt|;
block|}
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 61: READY&& BGN PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_bgn
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
name|send_bgak
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|uu_bgak
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_ESTABLISH_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|m_prepare_retrieval
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 62: READY&& ENDAK PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_endak
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'F'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|m_prepare_retrieval
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 62: READY&& BGREJ PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_bgrej
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'D'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|m_prepare_retrieval
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 62: READY&& RS PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_rs
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_detect_retransmission
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
condition|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
name|send_rsak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RESYNC_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|m_prepare_retrieval
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IN_RESYNC_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 62: READY&& END PDU  *	arg is pdu (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_end
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_endak
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|AAL_UU_SIGNAL
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|msg
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|,
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_s
argument_list|)
expr_stmt|;
name|m_prepare_retrieval
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 63: READY&& POLL expiry  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_tpoll
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
name|sscop
operator|->
name|vt_ps
operator|++
expr_stmt|;
name|send_poll
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_pd
operator|=
literal|0
expr_stmt|;
name|m_set_poll_timer
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 63: READY&& KEEP_ALIVE expiry  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_tka
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
name|sscop
operator|->
name|vt_ps
operator|++
expr_stmt|;
name|send_poll
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_pd
operator|=
literal|0
expr_stmt|;
name|m_set_poll_timer
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 63: READY&& IDLE expiry  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_tidle
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_ps
operator|++
expr_stmt|;
name|send_poll
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_pd
operator|=
literal|0
expr_stmt|;
name|m_set_poll_timer
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 63: READY&& NO_RESPONSE expiry  *	no arg  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_nr
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'P'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FREE_UU
argument_list|(
name|uu_end
argument_list|)
expr_stmt|;
name|send_end
argument_list|(
name|sscop
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_RELEASE_indication
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|m_prepare_retrieval
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_IDLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 63: READY&& AA-DATA.request  *	arg is message (queued).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_userdata
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MSGQ_APPEND
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_PDU_Q
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 64: READY&& SD PDU queued up  *	arg is unused.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_pduq
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
name|struct
name|sscop_msg
modifier|*
name|msg
decl_stmt|;
if|if
condition|(
name|sscop
operator|->
name|rxq
operator|!=
literal|0
condition|)
block|{
name|TAILQ_FOREACH
argument_list|(
argument|msg
argument_list|,
argument|&sscop->xbuf
argument_list|,
argument|link
argument_list|)
if|if
condition|(
name|msg
operator|->
name|rexmit
condition|)
break|break;
name|ASSERT
argument_list|(
name|msg
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|msg
operator|->
name|rexmit
operator|=
literal|0
expr_stmt|;
name|sscop
operator|->
name|rxq
operator|--
expr_stmt|;
name|send_sd
argument_list|(
name|sscop
argument_list|,
name|msg
operator|->
name|m
argument_list|,
name|msg
operator|->
name|seqno
argument_list|)
expr_stmt|;
name|msg
operator|->
name|poll_seqno
operator|=
name|sscop
operator|->
name|vt_ps
expr_stmt|;
if|if
condition|(
name|sscop
operator|->
name|poll_after_rex
operator|&&
name|sscop
operator|->
name|rxq
operator|==
literal|0
condition|)
goto|goto
name|poll
goto|;
comment|/* -> A */
else|else
goto|goto
name|maybe_poll
goto|;
comment|/* -> B */
block|}
if|if
condition|(
name|MSGQ_EMPTY
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|)
condition|)
return|return;
if|if
condition|(
name|sscop
operator|->
name|vt_s
operator|>=
name|sscop
operator|->
name|vt_ms
condition|)
block|{
comment|/* Send windows closed */
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|idle
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
goto|goto
name|poll
goto|;
comment|/* -> A */
block|}
else|else
block|{
name|msg
operator|=
name|MSGQ_GET
argument_list|(
operator|&
name|sscop
operator|->
name|xq
argument_list|)
expr_stmt|;
name|msg
operator|->
name|seqno
operator|=
name|sscop
operator|->
name|vt_s
expr_stmt|;
name|send_sd
argument_list|(
name|sscop
argument_list|,
name|msg
operator|->
name|m
argument_list|,
name|msg
operator|->
name|seqno
argument_list|)
expr_stmt|;
name|msg
operator|->
name|poll_seqno
operator|=
name|sscop
operator|->
name|vt_ps
expr_stmt|;
name|sscop
operator|->
name|vt_s
operator|++
expr_stmt|;
name|MSGQ_APPEND
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|,
name|msg
argument_list|)
expr_stmt|;
goto|goto
name|maybe_poll
goto|;
comment|/* -> B */
block|}
comment|/* 	 * p 65: Poll handling 	 */
name|maybe_poll
label|:
comment|/* label B */
name|sscop
operator|->
name|vt_pd
operator|++
expr_stmt|;
if|if
condition|(
name|TIMER_ISACT
argument_list|(
name|sscop
argument_list|,
name|poll
argument_list|)
condition|)
block|{
if|if
condition|(
name|sscop
operator|->
name|vt_pd
operator|<
name|sscop
operator|->
name|maxpd
condition|)
return|return;
block|}
else|else
block|{
if|if
condition|(
name|TIMER_ISACT
argument_list|(
name|sscop
argument_list|,
name|idle
argument_list|)
condition|)
block|{
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|idle
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|ka
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|sscop
operator|->
name|vt_pd
operator|<
name|sscop
operator|->
name|maxpd
condition|)
block|{
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|poll
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|poll
label|:
comment|/* label A */
name|sscop
operator|->
name|vt_ps
operator|++
expr_stmt|;
name|send_poll
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vt_pd
operator|=
literal|0
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|poll
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 67: common recovery start  */
end_comment

begin_function
specifier|static
name|void
name|sscop_recover
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|sscop
operator|->
name|vt_cc
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|vt_sq
operator|++
expr_stmt|;
name|m_initialize_mr
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|send_er
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|m_prepare_recovery
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|sscop_set_state
argument_list|(
name|sscop
argument_list|,
name|SSCOP_OUT_REC_PEND
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 66: READY&& SD PDU  *	arg is received message.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_sd
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|u_int
name|sn
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|msg
operator|->
name|seqno
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
comment|/* Fix padding */
name|MBUF_UNPAD
argument_list|(
name|msg
operator|->
name|m
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg
operator|->
name|seqno
operator|>=
name|sscop
operator|->
name|vr_mr
condition|)
block|{
comment|/* message outside window */
if|if
condition|(
name|sscop
operator|->
name|vr_h
operator|<
name|sscop
operator|->
name|vr_mr
condition|)
block|{
name|send_ustat
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|vr_h
argument_list|,
name|sscop
operator|->
name|vr_mr
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vr_h
operator|=
name|sscop
operator|->
name|vr_mr
expr_stmt|;
block|}
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|msg
operator|->
name|seqno
operator|==
name|sscop
operator|->
name|vr_r
condition|)
block|{
if|if
condition|(
name|msg
operator|->
name|seqno
operator|==
name|sscop
operator|->
name|vr_h
condition|)
block|{
name|sscop
operator|->
name|vr_r
operator|=
name|msg
operator|->
name|seqno
operator|+
literal|1
expr_stmt|;
name|sscop
operator|->
name|vr_h
operator|=
name|msg
operator|->
name|seqno
operator|+
literal|1
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DATA_indication
argument_list|,
name|msg
operator|->
name|m
argument_list|,
name|msg
operator|->
name|seqno
argument_list|)
expr_stmt|;
name|msg
operator|->
name|m
operator|=
name|NULL
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
for|for
control|(
init|;
condition|;
control|)
block|{
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DATA_indication
argument_list|,
name|msg
operator|->
name|m
argument_list|,
name|msg
operator|->
name|seqno
argument_list|)
expr_stmt|;
name|msg
operator|->
name|m
operator|=
name|NULL
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vr_r
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|msg
operator|=
name|MSGQ_PEEK
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
operator|)
operator|==
name|NULL
condition|)
break|break;
name|sn
operator|=
name|msg
operator|->
name|seqno
expr_stmt|;
name|ASSERT
argument_list|(
name|sn
operator|>=
name|sscop
operator|->
name|vr_r
argument_list|)
expr_stmt|;
if|if
condition|(
name|sn
operator|!=
name|sscop
operator|->
name|vr_r
condition|)
break|break;
name|msg
operator|=
name|MSGQ_GET
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
comment|/* Messages were lost */
comment|/* XXX Flow control */
if|if
condition|(
name|msg
operator|->
name|seqno
operator|==
name|sscop
operator|->
name|vr_h
condition|)
block|{
name|QINSERT
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vr_h
operator|++
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|sscop
operator|->
name|vr_h
operator|<
name|msg
operator|->
name|seqno
condition|)
block|{
name|QINSERT
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|send_ustat
argument_list|(
name|sscop
argument_list|,
name|sscop
operator|->
name|vr_h
argument_list|,
name|msg
operator|->
name|seqno
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|vr_h
operator|=
name|msg
operator|->
name|seqno
operator|+
literal|1
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|QFIND
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|,
name|msg
operator|->
name|seqno
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|QINSERT
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|,
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* error: start recovery */
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'Q'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_recover
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 67: READY&& POLL PDU  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_poll
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|seqno
name|seqno
decl_stmt|;
name|u_int
name|sn
decl_stmt|,
name|nps
decl_stmt|;
name|struct
name|SSCOP_MBUF_T
modifier|*
name|m
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|seqno
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_ns
operator|<
name|sscop
operator|->
name|vr_h
condition|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'Q'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_recover
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
return|return;
block|}
name|nps
operator|=
name|seqno
operator|.
name|sscop_n
expr_stmt|;
if|if
condition|(
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_ns
operator|>
name|sscop
operator|->
name|vr_mr
condition|)
name|sscop
operator|->
name|vr_h
operator|=
name|sscop
operator|->
name|vr_mr
expr_stmt|;
else|else
name|sscop
operator|->
name|vr_h
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
comment|/* build stat pdu */
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
name|sscop
operator|->
name|maxstat
operator|*
literal|4
operator|+
literal|12
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate STAT"
argument_list|)
expr_stmt|;
return|return;
block|}
name|sn
operator|=
name|sscop
operator|->
name|vr_r
expr_stmt|;
while|while
condition|(
name|sn
operator|!=
name|sscop
operator|->
name|vr_h
condition|)
block|{
comment|/* loop through burst we already have */
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
name|sn
operator|>=
name|sscop
operator|->
name|vr_h
condition|)
block|{
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|seqno
operator|.
name|sscop_n
operator|=
name|sn
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
if|if
condition|(
name|QFIND
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|,
name|sn
argument_list|)
operator|==
name|NULL
condition|)
break|break;
name|sn
operator|++
expr_stmt|;
block|}
comment|/* start of a hole */
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|seqno
operator|.
name|sscop_n
operator|=
name|sn
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
if|if
condition|(
name|MBUF_LEN
argument_list|(
name|m
argument_list|)
operator|/
literal|4
operator|>=
name|sscop
operator|->
name|maxstat
condition|)
block|{
name|send_stat
argument_list|(
name|sscop
argument_list|,
name|nps
argument_list|,
name|m
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|m
operator|=
name|MBUF_ALLOC
argument_list|(
name|sscop
operator|->
name|maxstat
operator|*
literal|4
operator|+
literal|12
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate STAT"
argument_list|)
expr_stmt|;
return|return;
block|}
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|seqno
operator|.
name|sscop_n
operator|=
name|sn
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
block|}
do|do
block|{
name|sn
operator|++
expr_stmt|;
block|}
do|while
condition|(
name|sn
operator|<
name|sscop
operator|->
name|vr_h
operator|&&
operator|!
name|QFIND
argument_list|(
operator|&
name|sscop
operator|->
name|rbuf
argument_list|,
name|sn
argument_list|)
condition|)
do|;
name|seqno
operator|.
name|sscop_null
operator|=
literal|0
expr_stmt|;
name|seqno
operator|.
name|sscop_n
operator|=
name|sn
expr_stmt|;
name|MBUF_APPEND32
argument_list|(
name|m
argument_list|,
name|seqno
operator|.
name|sscop_null
argument_list|)
expr_stmt|;
block|}
name|out
label|:
name|send_stat
argument_list|(
name|sscop
argument_list|,
name|nps
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 69: READY&& USTAT PDU  *	arg is msg (freed)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_ustat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|seqno
name|nmr
decl_stmt|,
name|sq1
decl_stmt|,
name|sq2
decl_stmt|;
name|u_int
name|cnt
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|nmr
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|sq2
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|sq1
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|cnt
operator|=
name|sq1
operator|.
name|sscop_n
operator|-
name|sq2
operator|.
name|sscop_n
expr_stmt|;
if|if
condition|(
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_ns
operator|<
name|sscop
operator|->
name|vt_a
operator|||
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_ns
operator|>=
name|sscop
operator|->
name|vt_s
condition|)
block|{
name|VERBERR
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_ERR
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"USTAT: N(R) outside VT(A)...VT(S)-1: N(R)=%u VT(A)=%u "
literal|"VT(S)=%u"
operator|,
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_ns
operator|,
name|sscop
operator|->
name|vt_a
operator|,
name|sscop
operator|->
name|vt_s
operator|)
argument_list|)
expr_stmt|;
goto|goto
name|err_f
goto|;
block|}
comment|/* Acknowledge all messages between VT(A) and N(R)-1. N(R) is the new 	 * next in sequence-SD-number of the receiver and means, it has all 	 * messages below N(R). Remove all message below N(R) from the 	 * transmission buffer. It may already be removed because of an 	 * earlier selective ACK in a STAT message. 	 */
while|while
condition|(
operator|(
name|msg
operator|=
name|MSGQ_PEEK
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|)
operator|)
operator|!=
name|NULL
operator|&&
name|msg
operator|->
name|seqno
operator|<
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_ns
condition|)
block|{
name|ASSERT
argument_list|(
name|msg
operator|->
name|seqno
operator|>=
name|sscop
operator|->
name|vt_a
argument_list|)
expr_stmt|;
name|MSGQ_REMOVE
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
comment|/* Update the in-sequence acknowledge and the send window */
name|sscop
operator|->
name|vt_a
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|nmr
operator|.
name|sscop_n
expr_stmt|;
comment|/* check, that the range of requested re-transmissions is between 	 * the in-sequence-ack and the highest up-to-now transmitted SD 	 */
if|if
condition|(
name|sq1
operator|.
name|sscop_n
operator|>=
name|sq2
operator|.
name|sscop_n
operator|||
operator|(
name|u_int
operator|)
name|sq1
operator|.
name|sscop_n
operator|<
name|sscop
operator|->
name|vt_a
operator|||
operator|(
name|u_int
operator|)
name|sq2
operator|.
name|sscop_n
operator|>=
name|sscop
operator|->
name|vt_s
condition|)
block|{
name|VERBERR
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_ERR
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"USTAT: seq1 or seq2 outside VT(A)...VT(S)-1 or seq1>=seq2:"
literal|" seq1=%u seq2=%u VT(A)=%u VT(S)=%u"
operator|,
name|sq1
operator|.
name|sscop_n
operator|,
name|sq2
operator|.
name|sscop_n
operator|,
name|sscop
operator|->
name|vt_a
operator|,
name|sscop
operator|->
name|vt_s
operator|)
argument_list|)
expr_stmt|;
goto|goto
name|err_f
goto|;
block|}
comment|/* 	 * Retransmit all messages from seq1 to seq2-1 	 */
do|do
block|{
comment|/* 		 * The message may not be in the transmit buffer if it was 		 * already acked by a STAT. This means, the receiver is 		 * confused. 		 */
if|if
condition|(
operator|(
name|msg
operator|=
name|QFIND
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|,
name|sq1
operator|.
name|sscop_n
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|VERBERR
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_ERR
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"USTAT: message %u not found in xmit buffer"
operator|,
name|sq1
operator|.
name|sscop_n
operator|)
argument_list|)
expr_stmt|;
goto|goto
name|err_f
goto|;
block|}
comment|/* 		 * If it is not yet in the re-transmission queue, put it there 		 */
if|if
condition|(
operator|!
name|msg
operator|->
name|rexmit
condition|)
block|{
name|msg
operator|->
name|rexmit
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|rxq
operator|++
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_PDU_Q
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
name|sq1
operator|.
name|sscop_n
operator|++
expr_stmt|;
block|}
do|while
condition|(
name|sq1
operator|.
name|sscop_n
operator|!=
name|sq2
operator|.
name|sscop_n
condition|)
do|;
comment|/* 	 * report the re-transmission to the management 	 */
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'V'
argument_list|,
name|cnt
argument_list|)
expr_stmt|;
return|return;
name|err_f
label|:
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'T'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_recover
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 70: READY&& STAT PDU  *	arg is msg (freed).  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ready_stat
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|union
name|seqno
name|nps
decl_stmt|,
name|nmr
decl_stmt|;
name|u_int
name|len
decl_stmt|,
name|seq1
decl_stmt|,
name|seq2
decl_stmt|,
name|cnt
decl_stmt|;
name|struct
name|sscop_msg
modifier|*
name|m
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|nmr
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|nps
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|len
operator|=
name|MBUF_LEN
argument_list|(
name|msg
operator|->
name|m
argument_list|)
operator|/
literal|4
expr_stmt|;
if|if
condition|(
operator|(
name|u_int
operator|)
name|nps
operator|.
name|sscop_n
operator|<
name|sscop
operator|->
name|vt_pa
operator|||
operator|(
name|u_int
operator|)
name|nps
operator|.
name|sscop_n
operator|>
name|sscop
operator|->
name|vt_ps
condition|)
block|{
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'R'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_recover
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_ns
operator|<
name|sscop
operator|->
name|vt_a
operator|||
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_ns
operator|>
name|sscop
operator|->
name|vt_s
condition|)
block|{
comment|/* 		 * The in-sequence acknowledge, i.e. the receivers's next 		 * expected in-sequence msg is outside the window between 		 * the transmitters in-sequence ack and highest seqno - 		 * the receiver seems to be confused. 		 */
name|VERBERR
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_ERR
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"STAT: N(R) outside VT(A)...VT(S)-1: N(R)=%u VT(A)=%u "
literal|"VT(S)=%u"
operator|,
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_ns
operator|,
name|sscop
operator|->
name|vt_a
operator|,
name|sscop
operator|->
name|vt_s
operator|)
argument_list|)
expr_stmt|;
name|err_H
label|:
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|m_reset_data_xfer_timers
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'S'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sscop_recover
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* Acknowledge all messages between VT(A) and N(R)-1. N(R) is the new 	 * next in sequence-SD-number of the receiver and means, it has all 	 * messages below N(R). Remove all message below N(R) from the 	 * transmission buffer. It may already be removed because of an 	 * earlier selective ACK in a STAT message. 	 */
while|while
condition|(
operator|(
name|m
operator|=
name|MSGQ_PEEK
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|)
operator|)
operator|!=
name|NULL
operator|&&
name|m
operator|->
name|seqno
operator|<
operator|(
name|u_int
operator|)
name|pdu
operator|.
name|sscop_ns
condition|)
block|{
name|ASSERT
argument_list|(
name|m
operator|->
name|seqno
operator|>=
name|sscop
operator|->
name|vt_a
argument_list|)
expr_stmt|;
name|MSGQ_REMOVE
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|,
name|m
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
block|}
comment|/* 	 * Update in-sequence ack, poll-ack and send window. 	 */
name|sscop
operator|->
name|vt_a
operator|=
name|pdu
operator|.
name|sscop_ns
expr_stmt|;
name|sscop
operator|->
name|vt_pa
operator|=
name|nps
operator|.
name|sscop_n
expr_stmt|;
name|sscop
operator|->
name|vt_ms
operator|=
name|nmr
operator|.
name|sscop_n
expr_stmt|;
name|cnt
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|len
operator|>
literal|1
condition|)
block|{
name|seq1
operator|=
name|MBUF_GET32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|len
operator|--
expr_stmt|;
if|if
condition|(
name|seq1
operator|>=
name|sscop
operator|->
name|vt_s
condition|)
block|{
name|VERBERR
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_ERR
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"STAT: seq1>= VT(S): seq1=%u VT(S)=%u"
operator|,
name|seq1
operator|,
name|sscop
operator|->
name|vt_s
operator|)
argument_list|)
expr_stmt|;
goto|goto
name|err_H
goto|;
block|}
for|for
control|(
init|;
condition|;
control|)
block|{
name|seq2
operator|=
name|MBUF_GET32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|len
operator|--
expr_stmt|;
if|if
condition|(
name|seq1
operator|>=
name|seq2
operator|||
name|seq2
operator|>
name|sscop
operator|->
name|vt_s
condition|)
block|{
name|VERBERR
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_ERR
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"STAT: seq1>= seq2 or "
literal|"seq2> VT(S): seq1=%u seq2=%u VT(S)=%u"
operator|,
name|seq1
operator|,
name|seq2
operator|,
name|sscop
operator|->
name|vt_s
operator|)
argument_list|)
expr_stmt|;
goto|goto
name|err_H
goto|;
block|}
do|do
block|{
comment|/* 				 * The receiver requests the re-transmission 				 * of some message, but has acknowledged it 				 * already in an earlier STAT (it isn't in the 				 * transmitt buffer anymore). 				 */
if|if
condition|(
operator|(
name|m
operator|=
name|QFIND
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|,
name|seq1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|VERBERR
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_ERR
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"STAT: message"
literal|" %u not found in xmit buffer"
operator|,
name|seq1
operator|)
argument_list|)
expr_stmt|;
goto|goto
name|err_H
goto|;
block|}
if|if
condition|(
name|m
operator|->
name|poll_seqno
operator|<
operator|(
name|u_int
operator|)
name|nps
operator|.
name|sscop_n
operator|&&
operator|(
name|u_int
operator|)
name|nps
operator|.
name|sscop_n
operator|<=
name|sscop
operator|->
name|vt_ps
condition|)
if|if
condition|(
operator|!
name|m
operator|->
name|rexmit
condition|)
block|{
name|m
operator|->
name|rexmit
operator|=
literal|1
expr_stmt|;
name|sscop
operator|->
name|rxq
operator|++
expr_stmt|;
name|cnt
operator|++
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_PDU_Q
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
block|}
do|while
condition|(
operator|++
name|seq1
operator|<
name|seq2
condition|)
do|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
break|break;
name|seq2
operator|=
name|MBUF_GET32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|len
operator|--
expr_stmt|;
if|if
condition|(
name|seq1
operator|>=
name|seq2
operator|||
name|seq2
operator|>
name|sscop
operator|->
name|vt_s
condition|)
block|{
name|VERBERR
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_ERR
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"STAT: seq1>= seq2 or "
literal|"seq2> VT(S): seq1=%u seq2=%u VT(S)=%u"
operator|,
name|seq1
operator|,
name|seq2
operator|,
name|sscop
operator|->
name|vt_s
operator|)
argument_list|)
expr_stmt|;
goto|goto
name|err_H
goto|;
block|}
comment|/* OK now the sucessful transmitted messages. Note, that 			 * some messages may already be out of the buffer because 			 * of earlier STATS */
do|do
block|{
if|if
condition|(
name|sscop
operator|->
name|clear_buffers
condition|)
block|{
if|if
condition|(
operator|(
name|m
operator|=
name|QFIND
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|,
name|seq1
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|MSGQ_REMOVE
argument_list|(
operator|&
name|sscop
operator|->
name|xbuf
argument_list|,
name|m
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|m
argument_list|)
expr_stmt|;
block|}
block|}
block|}
do|while
condition|(
operator|++
name|seq1
operator|!=
name|seq2
condition|)
do|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
break|break;
block|}
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'V'
argument_list|,
name|cnt
argument_list|)
expr_stmt|;
block|}
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
comment|/* label L: */
if|if
condition|(
name|sscop
operator|->
name|vt_s
operator|>=
name|sscop
operator|->
name|vt_ms
condition|)
block|{
comment|/* 		 * The receiver has closed the window: report to management 		 */
if|if
condition|(
name|sscop
operator|->
name|credit
condition|)
block|{
name|sscop
operator|->
name|credit
operator|=
literal|0
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'W'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|!
name|sscop
operator|->
name|credit
condition|)
block|{
comment|/* 		 * The window was forcefully closed above, but 		 * now re-opened. Report to management. 		 */
name|sscop
operator|->
name|credit
operator|=
literal|1
expr_stmt|;
name|MAAL_ERROR
argument_list|(
name|sscop
argument_list|,
literal|'X'
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIMER_ISACT
argument_list|(
name|sscop
argument_list|,
name|poll
argument_list|)
condition|)
block|{
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|TIMER_ISACT
argument_list|(
name|sscop
argument_list|,
name|idle
argument_list|)
condition|)
block|{
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|ka
argument_list|)
expr_stmt|;
name|TIMER_STOP
argument_list|(
name|sscop
argument_list|,
name|nr
argument_list|)
expr_stmt|;
name|TIMER_RESTART
argument_list|(
name|sscop
argument_list|,
name|idle
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * P. 73: any state& UDATA_REQUEST  *	arg is pdu (queued)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_udata_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MSGQ_APPEND
argument_list|(
operator|&
name|sscop
operator|->
name|uxq
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_UPDU_Q
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P. 73: any state& MDATA_REQUEST  *	arg is pdu (queued)  */
end_comment

begin_function
specifier|static
name|void
name|sscop_mdata_req
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|MSGQ_APPEND
argument_list|(
operator|&
name|sscop
operator|->
name|mxq
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|sscop_signal
argument_list|(
name|sscop
argument_list|,
name|SIG_MPDU_Q
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * P. 74: any state& UDATA queued  *	no arg.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_upduq
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
name|struct
name|sscop_msg
modifier|*
name|msg
decl_stmt|;
if|if
condition|(
name|sscop
operator|->
name|ll_busy
condition|)
return|return;
while|while
condition|(
operator|(
name|msg
operator|=
name|MSGQ_GET
argument_list|(
operator|&
name|sscop
operator|->
name|uxq
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|send_ud
argument_list|(
name|sscop
argument_list|,
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|msg
operator|->
name|m
operator|=
name|NULL
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * P. 74: any state& MDATA queued  *	no arg.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_mpduq
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|unused
name|__unused
parameter_list|)
block|{
name|struct
name|sscop_msg
modifier|*
name|msg
decl_stmt|;
if|if
condition|(
name|sscop
operator|->
name|ll_busy
condition|)
return|return;
while|while
condition|(
operator|(
name|msg
operator|=
name|MSGQ_GET
argument_list|(
operator|&
name|sscop
operator|->
name|mxq
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|send_md
argument_list|(
name|sscop
argument_list|,
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|msg
operator|->
name|m
operator|=
name|NULL
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * p 73: MD PDU  *	arg is PDU  */
end_comment

begin_function
specifier|static
name|void
name|sscop_md
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|MBUF_UNPAD
argument_list|(
name|msg
operator|->
name|m
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|)
expr_stmt|;
name|MAAL_DATA
argument_list|(
name|sscop
argument_list|,
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|msg
operator|->
name|m
operator|=
name|NULL
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 73: UD PDU  *	arg is PDU  */
end_comment

begin_function
specifier|static
name|void
name|sscop_ud
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|union
name|pdu
name|pdu
decl_stmt|;
name|pdu
operator|.
name|sscop_null
operator|=
name|MBUF_STRIP32
argument_list|(
name|msg
operator|->
name|m
argument_list|)
expr_stmt|;
name|MBUF_UNPAD
argument_list|(
name|msg
operator|->
name|m
argument_list|,
name|pdu
operator|.
name|sscop_pl
argument_list|)
expr_stmt|;
name|AAL_DATA
argument_list|(
name|sscop
argument_list|,
name|SSCOP_UDATA_indication
argument_list|,
name|msg
operator|->
name|m
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|msg
operator|->
name|m
operator|=
name|NULL
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * p 33: IDLE& RETRIEVE  * p 39: IN_PEND& RETRIEVE  * p 42: OUT_DIS_PEND& RETRIEVE  * p 48: IN_RESYNC_PEND& RETRIEVE  * p 53: REC_PEND& RETRIEVE  * p 58: IN_REC_PEND& RETRIEVE  */
end_comment

begin_function
specifier|static
name|void
name|sscop_retrieve
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|m_data_retrieval
argument_list|(
name|sscop
argument_list|,
name|msg
operator|->
name|rexmit
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/************************************************************/
end_comment

begin_comment
comment|/*  * GENERAL EVENT HANDLING  */
end_comment

begin_comment
comment|/*  * State/event matrix.  *  * Entries marked with Z are not specified in Q.2110, but are added for  * the sake of stability.  */
end_comment

begin_struct
specifier|static
struct|struct
block|{
name|void
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|(
name|struct
name|sscop
modifier|*
parameter_list|,
name|struct
name|sscop_msg
modifier|*
parameter_list|)
function_decl|;
name|int
function_decl|(
modifier|*
name|cond
function_decl|)
parameter_list|(
name|struct
name|sscop
modifier|*
parameter_list|)
function_decl|;
block|}
name|state_matrix
index|[
name|SSCOP_NSTATES
index|]
index|[
name|SIG_NUM
index|]
init|=
block|{
comment|/* SSCOP_IDLE */
block|{
comment|/* SIG_BGN */
block|{
name|sscop_idle_bgn
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGAK */
block|{
name|sscop_idle_bgak
block|,
name|NULL
block|}
block|,
comment|/* SIG_END */
block|{
name|sscop_idle_end
block|,
name|NULL
block|}
block|,
comment|/* SIG_ENDAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_RS */
block|{
name|sscop_idle_rs
block|,
name|NULL
block|}
block|,
comment|/* SIG_RSAK */
block|{
name|sscop_idle_rsak
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGREJ */
block|{
name|sscop_idle_bgrej
block|,
name|NULL
block|}
block|,
comment|/* SIG_SD */
block|{
name|sscop_idle_sd
block|,
name|NULL
block|}
block|,
comment|/* SIG_ER */
block|{
name|sscop_idle_er
block|,
name|NULL
block|}
block|,
comment|/* SIG_POLL */
block|{
name|sscop_idle_poll
block|,
name|NULL
block|}
block|,
comment|/* SIG_STAT */
block|{
name|sscop_idle_stat
block|,
name|NULL
block|}
block|,
comment|/* SIG_USTAT */
block|{
name|sscop_idle_ustat
block|,
name|NULL
block|}
block|,
comment|/* SIG_UD */
block|{
name|sscop_ud
block|,
name|NULL
block|}
block|,
comment|/* SIG_MD */
block|{
name|sscop_md
block|,
name|NULL
block|}
block|,
comment|/* SIG_ERAK */
block|{
name|sscop_idle_erak
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_CC */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_POLL */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_KA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_NR */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_IDLE */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_PDU_Q */
block|{
name|sscop_flush_pduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_USER_DATA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_REQ */
block|{
name|sscop_idle_establish_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_RELEASE_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_RECOVER */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_UDATA */
block|{
name|sscop_udata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_MDATA */
block|{
name|sscop_mdata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_UPDU_Q */
block|{
name|sscop_upduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_MPDU_Q */
block|{
name|sscop_mpduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_RETRIEVE */
block|{
name|sscop_retrieve
block|,
name|NULL
block|}
block|, 	}
block|,
comment|/* SSCOP_OUT_PEND */
block|{
comment|/* SIG_BGN */
block|{
name|sscop_outpend_bgn
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGAK */
block|{
name|sscop_outpend_bgak
block|,
name|NULL
block|}
block|,
comment|/* SIG_END */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_ENDAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_RS */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_RSAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGREJ */
block|{
name|sscop_outpend_bgrej
block|,
name|NULL
block|}
block|,
comment|/* SIG_SD */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_ER */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_POLL */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_STAT */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_USTAT */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_UD */
block|{
name|sscop_ud
block|,
name|NULL
block|}
block|,
comment|/* SIG_MD */
block|{
name|sscop_md
block|,
name|NULL
block|}
block|,
comment|/* SIG_ERAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_CC */
block|{
name|sscop_outpend_tcc
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_POLL */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_KA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_NR */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_IDLE */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_PDU_Q */
block|{
name|sscop_flush_pduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_USER_DATA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_RELEASE_REQ */
block|{
name|sscop_outpend_release_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_RECOVER */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_UDATA */
block|{
name|sscop_udata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_MDATA */
block|{
name|sscop_mdata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_UPDU_Q */
block|{
name|sscop_upduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_MPDU_Q */
block|{
name|sscop_mpduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_RETRIEVE */
block|{
name|NULL
block|,
name|NULL
block|}
block|, 	}
block|,
comment|/* SSCOP_IN_PEND */
block|{
comment|/* SIG_BGN */
block|{
name|sscop_inpend_bgn
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGAK */
block|{
name|sscop_inpend_bgak
block|,
name|NULL
block|}
block|,
comment|/* SIG_END */
block|{
name|sscop_inpend_end
block|,
name|NULL
block|}
block|,
comment|/* SIG_ENDAK */
block|{
name|sscop_inpend_endak
block|,
name|NULL
block|}
block|,
comment|/* SIG_RS */
block|{
name|sscop_inpend_rs
block|,
name|NULL
block|}
block|,
comment|/* SIG_RSAK */
block|{
name|sscop_inpend_rsak
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGREJ */
block|{
name|sscop_inpend_bgrej
block|,
name|NULL
block|}
block|,
comment|/* SIG_SD */
block|{
name|sscop_inpend_sd
block|,
name|NULL
block|}
block|,
comment|/* SIG_ER */
block|{
name|sscop_inpend_er
block|,
name|NULL
block|}
block|,
comment|/* SIG_POLL */
block|{
name|sscop_inpend_poll
block|,
name|NULL
block|}
block|,
comment|/* SIG_STAT */
block|{
name|sscop_inpend_stat
block|,
name|NULL
block|}
block|,
comment|/* SIG_USTAT */
block|{
name|sscop_inpend_ustat
block|,
name|NULL
block|}
block|,
comment|/* SIG_UD */
block|{
name|sscop_ud
block|,
name|NULL
block|}
block|,
comment|/* SIG_MD */
block|{
name|sscop_md
block|,
name|NULL
block|}
block|,
comment|/* SIG_ERAK */
block|{
name|sscop_inpend_erak
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_CC */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_POLL */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_KA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_NR */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_IDLE */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_PDU_Q */
block|{
name|sscop_flush_pduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_USER_DATA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_RESP */
block|{
name|sscop_inpend_establish_resp
block|,
name|NULL
block|}
block|,
comment|/* SIG_RELEASE_REQ */
block|{
name|sscop_inpend_release_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_RECOVER */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_UDATA */
block|{
name|sscop_udata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_MDATA */
block|{
name|sscop_mdata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_UPDU_Q */
block|{
name|sscop_upduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_MPDU_Q */
block|{
name|sscop_mpduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_RETRIEVE */
block|{
name|sscop_retrieve
block|,
name|NULL
block|}
block|, 	}
block|,
comment|/* SSCOP_OUT_DIS_PEND */
block|{
comment|/* SIG_BGN */
block|{
name|sscop_outdis_bgn
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_END */
block|{
name|sscop_outdis_end
block|,
name|NULL
block|}
block|,
comment|/* SIG_ENDAK */
block|{
name|sscop_outdis_endak
block|,
name|NULL
block|}
block|,
comment|/* SIG_RS */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_RSAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGREJ */
block|{
name|sscop_outdis_endak
block|,
name|NULL
block|}
block|,
comment|/* SIG_SD */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_ER */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_POLL */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_STAT */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_USTAT */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_UD */
block|{
name|sscop_ud
block|,
name|NULL
block|}
block|,
comment|/* SIG_MD */
block|{
name|sscop_md
block|,
name|NULL
block|}
block|,
comment|/* SIG_ERAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_CC */
block|{
name|sscop_outdis_cc
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_POLL */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_KA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_NR */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_IDLE */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_PDU_Q */
block|{
name|sscop_flush_pduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_USER_DATA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_REQ */
block|{
name|sscop_outdis_establish_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_RELEASE_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_RECOVER */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_UDATA */
block|{
name|sscop_udata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_MDATA */
block|{
name|sscop_mdata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_UPDU_Q */
block|{
name|sscop_upduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_MPDU_Q */
block|{
name|sscop_mpduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_RETRIEVE */
block|{
name|sscop_retrieve
block|,
name|NULL
block|}
block|, 	}
block|,
comment|/* SSCOP_OUT_RESYNC_PEND */
block|{
comment|/* SIG_BGN */
block|{
name|sscop_outsync_bgn
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_END */
block|{
name|sscop_outsync_end
block|,
name|NULL
block|}
block|,
comment|/* SIG_ENDAK */
block|{
name|sscop_outsync_endak
block|,
name|NULL
block|}
block|,
comment|/* SIG_RS */
block|{
name|sscop_outsync_rs
block|,
name|NULL
block|}
block|,
comment|/* SIG_RSAK */
block|{
name|sscop_outsync_rsak
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGREJ */
block|{
name|sscop_outsync_bgrej
block|,
name|NULL
block|}
block|,
comment|/* SIG_SD */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_ER */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_POLL */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_STAT */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_USTAT */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_UD */
block|{
name|sscop_ud
block|,
name|NULL
block|}
block|,
comment|/* SIG_MD */
block|{
name|sscop_md
block|,
name|NULL
block|}
block|,
comment|/* SIG_ERAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_CC */
block|{
name|sscop_outsync_cc
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_POLL */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_KA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_NR */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_IDLE */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_PDU_Q */
block|{
name|sscop_flush_pduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_USER_DATA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_RELEASE_REQ */
block|{
name|sscop_outsync_release_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_RECOVER */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_UDATA */
block|{
name|sscop_udata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_MDATA */
block|{
name|sscop_mdata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_UPDU_Q */
block|{
name|sscop_upduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_MPDU_Q */
block|{
name|sscop_mpduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_RETRIEVE */
block|{
name|NULL
block|,
name|NULL
block|}
block|, 	}
block|,
comment|/* SSCOP_IN_RESYNC_PEND */
block|{
comment|/* SIG_BGN */
block|{
name|sscop_insync_bgn
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGAK */
block|{
name|sscop_insync_bgak
block|,
name|NULL
block|}
block|,
comment|/* SIG_END */
block|{
name|sscop_insync_end
block|,
name|NULL
block|}
block|,
comment|/* SIG_ENDAK */
block|{
name|sscop_insync_endak
block|,
name|NULL
block|}
block|,
comment|/* SIG_RS */
block|{
name|sscop_insync_rs
block|,
name|NULL
block|}
block|,
comment|/* SIG_RSAK */
block|{
name|sscop_insync_rsak
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGREJ */
block|{
name|sscop_insync_bgrej
block|,
name|NULL
block|}
block|,
comment|/* SIG_SD */
block|{
name|sscop_insync_sd
block|,
name|NULL
block|}
block|,
comment|/* SIG_ER */
block|{
name|sscop_insync_er
block|,
name|NULL
block|}
block|,
comment|/* SIG_POLL */
block|{
name|sscop_insync_poll
block|,
name|NULL
block|}
block|,
comment|/* SIG_STAT */
block|{
name|sscop_insync_stat
block|,
name|NULL
block|}
block|,
comment|/* SIG_USTAT */
block|{
name|sscop_insync_ustat
block|,
name|NULL
block|}
block|,
comment|/* SIG_UD */
block|{
name|sscop_ud
block|,
name|NULL
block|}
block|,
comment|/* SIG_MD */
block|{
name|sscop_md
block|,
name|NULL
block|}
block|,
comment|/* SIG_ERAK */
block|{
name|sscop_insync_erak
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_CC */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_POLL */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_KA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_NR */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_IDLE */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_PDU_Q */
block|{
name|sscop_flush_pduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_USER_DATA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_RELEASE_REQ */
block|{
name|sscop_insync_release_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_RECOVER */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_RESP */
block|{
name|sscop_insync_sync_resp
block|,
name|NULL
block|}
block|,
comment|/* SIG_UDATA */
block|{
name|sscop_udata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_MDATA */
block|{
name|sscop_mdata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_UPDU_Q */
block|{
name|sscop_upduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_MPDU_Q */
block|{
name|sscop_mpduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_RETRIEVE */
block|{
name|sscop_retrieve
block|,
name|NULL
block|}
block|, 	}
block|,
comment|/* SSCOP_OUT_REC_PEND */
block|{
comment|/* SIG_BGN */
block|{
name|sscop_outrec_bgn
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGAK */
block|{
name|sscop_outrec_bgak
block|,
name|NULL
block|}
block|,
comment|/* SIG_END */
block|{
name|sscop_outrec_end
block|,
name|NULL
block|}
block|,
comment|/* SIG_ENDAK */
block|{
name|sscop_outrec_endak
block|,
name|NULL
block|}
block|,
comment|/* SIG_RS */
block|{
name|sscop_outrec_rs
block|,
name|NULL
block|}
block|,
comment|/* SIG_RSAK */
block|{
name|sscop_outrec_rsak
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGREJ */
block|{
name|sscop_outrec_bgrej
block|,
name|NULL
block|}
block|,
comment|/* SIG_SD */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_ER */
block|{
name|sscop_outrec_er
block|,
name|NULL
block|}
block|,
comment|/* SIG_POLL */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_STAT */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_USTAT */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_UD */
block|{
name|sscop_ud
block|,
name|NULL
block|}
block|,
comment|/* SIG_MD */
block|{
name|sscop_md
block|,
name|NULL
block|}
block|,
comment|/* SIG_ERAK */
block|{
name|sscop_outrec_erak
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_CC */
block|{
name|sscop_outrec_cc
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_POLL */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_KA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_NR */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_IDLE */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_PDU_Q */
block|{
name|sscop_outrec_pduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_USER_DATA */
block|{
name|sscop_outrec_userdata
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_RELEASE_REQ */
block|{
name|sscop_outrec_release_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_RECOVER */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_REQ */
block|{
name|sscop_outrec_sync_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_UDATA */
block|{
name|sscop_udata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_MDATA */
block|{
name|sscop_mdata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_UPDU_Q */
block|{
name|sscop_upduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_MPDU_Q */
block|{
name|sscop_mpduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_RETRIEVE */
block|{
name|NULL
block|,
name|NULL
block|}
block|, 	}
block|,
comment|/* SSCOP_REC_PEND */
block|{
comment|/* SIG_BGN */
block|{
name|sscop_rec_bgn
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGAK */
block|{
name|sscop_rec_bgak
block|,
name|NULL
block|}
block|,
comment|/* SIG_END */
block|{
name|sscop_rec_end
block|,
name|NULL
block|}
block|,
comment|/* SIG_ENDAK */
block|{
name|sscop_rec_endak
block|,
name|NULL
block|}
block|,
comment|/* SIG_RS */
block|{
name|sscop_rec_rs
block|,
name|NULL
block|}
block|,
comment|/* SIG_RSAK */
block|{
name|sscop_rec_rsak
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGREJ */
block|{
name|sscop_rec_bgrej
block|,
name|NULL
block|}
block|,
comment|/* SIG_SD */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_ER */
block|{
name|sscop_rec_er
block|,
name|NULL
block|}
block|,
comment|/* SIG_POLL */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_STAT */
block|{
name|sscop_rec_stat
block|,
name|NULL
block|}
block|,
comment|/* SIG_USTAT */
block|{
name|sscop_rec_ustat
block|,
name|NULL
block|}
block|,
comment|/* SIG_UD */
block|{
name|sscop_ud
block|,
name|NULL
block|}
block|,
comment|/* SIG_MD */
block|{
name|sscop_md
block|,
name|NULL
block|}
block|,
comment|/* SIG_ERAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_CC */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_POLL */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_KA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_NR */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_IDLE */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_PDU_Q */
block|{
name|sscop_rec_pduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_USER_DATA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_RELEASE_REQ */
block|{
name|sscop_rec_release_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_RECOVER */
block|{
name|sscop_rec_recover
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_REQ */
block|{
name|sscop_rec_sync_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_UDATA */
block|{
name|sscop_udata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_MDATA */
block|{
name|sscop_mdata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_UPDU_Q */
block|{
name|sscop_upduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_MPDU_Q */
block|{
name|sscop_mpduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_RETRIEVE */
block|{
name|sscop_retrieve
block|,
name|NULL
block|}
block|, 	}
block|,
comment|/* SSCOP_IN_REC_PEND */
block|{
comment|/* SIG_BGN */
block|{
name|sscop_inrec_bgn
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGAK */
block|{
name|sscop_inrec_bgak
block|,
name|NULL
block|}
block|,
comment|/* SIG_END */
block|{
name|sscop_inrec_end
block|,
name|NULL
block|}
block|,
comment|/* SIG_ENDAK */
block|{
name|sscop_inrec_endak
block|,
name|NULL
block|}
block|,
comment|/* SIG_RS */
block|{
name|sscop_inrec_rs
block|,
name|NULL
block|}
block|,
comment|/* SIG_RSAK */
block|{
name|sscop_inrec_rsak
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGREJ */
block|{
name|sscop_inrec_bgrej
block|,
name|NULL
block|}
block|,
comment|/* SIG_SD */
block|{
name|sscop_inrec_sd
block|,
name|NULL
block|}
block|,
comment|/* SIG_ER */
block|{
name|sscop_inrec_er
block|,
name|NULL
block|}
block|,
comment|/* SIG_POLL */
block|{
name|sscop_inrec_poll
block|,
name|NULL
block|}
block|,
comment|/* SIG_STAT */
block|{
name|sscop_inrec_stat
block|,
name|NULL
block|}
block|,
comment|/* SIG_USTAT */
block|{
name|sscop_inrec_ustat
block|,
name|NULL
block|}
block|,
comment|/* SIG_UD */
block|{
name|sscop_ud
block|,
name|NULL
block|}
block|,
comment|/* SIG_MD */
block|{
name|sscop_md
block|,
name|NULL
block|}
block|,
comment|/* SIG_ERAK */
block|{
name|sscop_inrec_erak
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_CC */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_POLL */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_KA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_NR */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_IDLE */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_PDU_Q */
block|{
name|sscop_inrec_pduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_USER_DATA */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_RELEASE_REQ */
block|{
name|sscop_inrec_release_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_RECOVER */
block|{
name|sscop_inrec_recover
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_REQ */
block|{
name|sscop_inrec_sync_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_UDATA */
block|{
name|sscop_udata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_MDATA */
block|{
name|sscop_mdata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_UPDU_Q */
block|{
name|sscop_upduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_MPDU_Q */
block|{
name|sscop_mpduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_RETRIEVE */
block|{
name|sscop_retrieve
block|,
name|NULL
block|}
block|, 	}
block|,
comment|/* SSCOP_READY */
block|{
comment|/* SIG_BGN */
block|{
name|sscop_ready_bgn
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_END */
block|{
name|sscop_ready_end
block|,
name|NULL
block|}
block|,
comment|/* SIG_ENDAK */
block|{
name|sscop_ready_endak
block|,
name|NULL
block|}
block|,
comment|/* SIG_RS */
block|{
name|sscop_ready_rs
block|,
name|NULL
block|}
block|,
comment|/* SIG_RSAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_BGREJ */
block|{
name|sscop_ready_bgrej
block|,
name|NULL
block|}
block|,
comment|/* SIG_SD */
block|{
name|sscop_ready_sd
block|,
name|NULL
block|}
block|,
comment|/* SIG_ER */
block|{
name|sscop_ready_er
block|,
name|NULL
block|}
block|,
comment|/* SIG_POLL */
block|{
name|sscop_ready_poll
block|,
name|NULL
block|}
block|,
comment|/* SIG_STAT */
block|{
name|sscop_ready_stat
block|,
name|NULL
block|}
block|,
comment|/* SIG_USTAT */
block|{
name|sscop_ready_ustat
block|,
name|NULL
block|}
block|,
comment|/* SIG_UD */
block|{
name|sscop_ud
block|,
name|NULL
block|}
block|,
comment|/* SIG_MD */
block|{
name|sscop_md
block|,
name|NULL
block|}
block|,
comment|/* SIG_ERAK */
block|{
name|sscop_ignore_pdu
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_CC */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_POLL */
block|{
name|sscop_ready_tpoll
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_KA */
block|{
name|sscop_ready_tka
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_NR */
block|{
name|sscop_ready_nr
block|,
name|NULL
block|}
block|,
comment|/* SIG_T_IDLE */
block|{
name|sscop_ready_tidle
block|,
name|NULL
block|}
block|,
comment|/* SIG_PDU_Q */
block|{
name|sscop_ready_pduq
block|,
name|c_ready_pduq
block|}
block|,
comment|/* SIG_USER_DATA */
block|{
name|sscop_ready_userdata
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_REQ */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_ESTAB_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_RELEASE_REQ */
block|{
name|sscop_ready_release_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_RECOVER */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_REQ */
block|{
name|sscop_ready_sync_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_SYNC_RESP */
block|{
name|NULL
block|,
name|NULL
block|}
block|,
comment|/* SIG_UDATA */
block|{
name|sscop_udata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_MDATA */
block|{
name|sscop_mdata_req
block|,
name|NULL
block|}
block|,
comment|/* SIG_UPDU_Q */
block|{
name|sscop_upduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_MPDU_Q */
block|{
name|sscop_mpduq
block|,
name|NULL
block|}
block|,
comment|/* SIG_RETRIEVE */
block|{
name|NULL
block|,
name|NULL
block|}
block|, 	}
block|}
struct|;
end_struct

begin_comment
comment|/*  * Try to execute a signal. It is executed if  *   - it is illegal (in this case it is effectively ignored)  *   - it has no condition  *   - its condition is true  * If it has a condition and that is false, the function does nothing and  * returns 0.  * If the signal gets executed, the signal function is responsible to release  * the message (if any).  */
end_comment

begin_function
specifier|static
name|int
name|sig_exec
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|u_int
name|sig
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|void
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|(
name|struct
name|sscop
modifier|*
parameter_list|,
name|struct
name|sscop_msg
modifier|*
parameter_list|)
function_decl|;
name|int
function_decl|(
modifier|*
name|cond
function_decl|)
parameter_list|(
name|struct
name|sscop
modifier|*
parameter_list|)
function_decl|;
name|func
operator|=
name|state_matrix
index|[
name|sscop
operator|->
name|state
index|]
index|[
name|sig
index|]
operator|.
name|func
expr_stmt|;
name|cond
operator|=
name|state_matrix
index|[
name|sscop
operator|->
name|state
index|]
index|[
name|sig
index|]
operator|.
name|cond
expr_stmt|;
if|if
condition|(
name|func
operator|==
name|NULL
condition|)
block|{
name|VERBOSE
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_BUG
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"no handler for %s in state %s - ignored"
operator|,
name|events
index|[
name|sig
index|]
operator|,
name|states
index|[
name|sscop
operator|->
name|state
index|]
operator|)
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
name|cond
operator|==
name|NULL
operator|||
call|(
modifier|*
name|cond
call|)
argument_list|(
name|sscop
argument_list|)
condition|)
block|{
name|VERBOSE
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_EXEC
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"executing %s in %s"
operator|,
name|events
index|[
name|sig
index|]
operator|,
name|states
index|[
name|sscop
operator|->
name|state
index|]
operator|)
argument_list|)
expr_stmt|;
call|(
modifier|*
name|func
call|)
argument_list|(
name|sscop
argument_list|,
name|msg
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|VERBOSE
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_EXEC
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"delaying %s in %s"
operator|,
name|events
index|[
name|sig
index|]
operator|,
name|states
index|[
name|sscop
operator|->
name|state
index|]
operator|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Deliver a signal to the given sscop  * If it is delivered from inside a signal handler - queue it. If not,  * execute it. After execution loop through the queue and execute all  * pending signals. Signals, that cannot be executed because of entry  * conditions are skipped.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_signal
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|u_int
name|sig
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|struct
name|sscop_sig
modifier|*
name|s
decl_stmt|;
name|VERBOSE
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_INSIG
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"got signal %s in state %s%s"
operator|,
name|events
index|[
name|sig
index|]
operator|,
name|states
index|[
name|sscop
operator|->
name|state
index|]
operator|,
name|sscop
operator|->
name|in_sig
condition|?
literal|" -- queuing"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
name|SIG_ALLOC
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate signal"
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
name|s
operator|->
name|sig
operator|=
name|sig
expr_stmt|;
name|s
operator|->
name|msg
operator|=
name|msg
expr_stmt|;
name|SIGQ_APPEND
argument_list|(
operator|&
name|sscop
operator|->
name|sigs
argument_list|,
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|sscop
operator|->
name|in_sig
condition|)
name|handle_sigs
argument_list|(
name|sscop
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Loop through the signal queue until we can't execute any signals.  */
end_comment

begin_function
specifier|static
name|void
name|handle_sigs
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
name|struct
name|sscop_sig
modifier|*
name|s
decl_stmt|;
name|sscop_sigq_head_t
name|dsigs
decl_stmt|,
name|q
decl_stmt|;
name|int
name|exec
decl_stmt|;
name|sscop
operator|->
name|in_sig
operator|++
expr_stmt|;
comment|/* 	 * Copy the current signal queue to the local one and empty 	 * the signal queue. Then loop through the signals. After one 	 * pass we have a list of delayed signals because of entry 	 * conditions and a new list of signals. Merge them. Repeat until 	 * the signal queue is either empty or contains only delayed signals. 	 */
name|SIGQ_INIT
argument_list|(
operator|&
name|q
argument_list|)
expr_stmt|;
name|SIGQ_INIT
argument_list|(
operator|&
name|dsigs
argument_list|)
expr_stmt|;
do|do
block|{
name|exec
operator|=
literal|0
expr_stmt|;
comment|/* 		 * Copy signal list and make sscop list empty 		 */
name|SIGQ_MOVE
argument_list|(
operator|&
name|sscop
operator|->
name|sigs
argument_list|,
operator|&
name|q
argument_list|)
expr_stmt|;
comment|/* 		 * Loop through the list 		 */
while|while
condition|(
operator|(
name|s
operator|=
name|SIGQ_GET
argument_list|(
operator|&
name|q
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|sig_exec
argument_list|(
name|sscop
argument_list|,
name|s
operator|->
name|sig
argument_list|,
name|s
operator|->
name|msg
argument_list|)
condition|)
block|{
name|exec
operator|=
literal|1
expr_stmt|;
name|SIG_FREE
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SIGQ_APPEND
argument_list|(
operator|&
name|dsigs
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* 		 * Merge lists by inserting delayed signals in front of 		 * the signal list. preserving the order. 		 */
name|SIGQ_PREPEND
argument_list|(
operator|&
name|dsigs
argument_list|,
operator|&
name|sscop
operator|->
name|sigs
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|exec
condition|)
do|;
name|sscop
operator|->
name|in_sig
operator|--
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Save a signal that should be executed only if state changes.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_save_signal
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|u_int
name|sig
parameter_list|,
name|struct
name|sscop_msg
modifier|*
name|msg
parameter_list|)
block|{
name|struct
name|sscop_sig
modifier|*
name|s
decl_stmt|;
name|SIG_ALLOC
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|==
name|NULL
condition|)
block|{
name|FAILURE
argument_list|(
literal|"sscop: cannot allocate signal"
argument_list|)
expr_stmt|;
name|SSCOP_MSG_FREE
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return;
block|}
name|s
operator|->
name|sig
operator|=
name|sig
expr_stmt|;
name|s
operator|->
name|msg
operator|=
name|msg
expr_stmt|;
name|SIGQ_APPEND
argument_list|(
operator|&
name|sscop
operator|->
name|saved_sigs
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Set a new state. If signals are waiting for a state change - append them to  * the signal queue, so they get executed.  */
end_comment

begin_function
specifier|static
name|void
name|sscop_set_state
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|u_int
name|nstate
parameter_list|)
block|{
name|VERBOSE
argument_list|(
name|sscop
argument_list|,
name|SSCOP_DBG_STATE
argument_list|,
operator|(
name|sscop
operator|,
name|sscop
operator|->
name|aarg
operator|,
literal|"changing state from %s to %s"
operator|,
name|states
index|[
name|sscop
operator|->
name|state
index|]
operator|,
name|states
index|[
name|nstate
index|]
operator|)
argument_list|)
expr_stmt|;
name|sscop
operator|->
name|state
operator|=
name|nstate
expr_stmt|;
name|SIGQ_MOVE
argument_list|(
operator|&
name|sscop
operator|->
name|saved_sigs
argument_list|,
operator|&
name|sscop
operator|->
name|sigs
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|sscop_setdebug
parameter_list|(
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|,
name|u_int
name|n
parameter_list|)
block|{
name|sscop
operator|->
name|debug
operator|=
name|n
expr_stmt|;
block|}
end_function

begin_function
name|u_int
name|sscop_getdebug
parameter_list|(
specifier|const
name|struct
name|sscop
modifier|*
name|sscop
parameter_list|)
block|{
return|return
operator|(
name|sscop
operator|->
name|debug
operator|)
return|;
block|}
end_function

end_unit

