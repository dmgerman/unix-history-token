begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2001-2003  *	Fraunhofer Institute for Open Communication Systems (FhG Fokus).  * 	All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * Author: Hartmut Brandt<harti@freebsd.org>  *  * $Begemot: libunimsg/netnatm/msg/uni_ie.c,v 1.16 2005/05/23 12:06:30 brandt_h Exp $  *  * Private definitions for the IE code file.  *  * This file includes the table generated automatically.  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|_KERNEL
end_ifdef

begin_include
include|#
directive|include
file|<sys/libkern.h>
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<netnatm/unimsg.h>
end_include

begin_include
include|#
directive|include
file|<netnatm/msg/unistruct.h>
end_include

begin_include
include|#
directive|include
file|<netnatm/msg/unimsglib.h>
end_include

begin_include
include|#
directive|include
file|<netnatm/msg/uniprint.h>
end_include

begin_include
include|#
directive|include
file|<netnatm/msg/priv.h>
end_include

begin_comment
comment|/*  * Define internal functions.  */
end_comment

begin_define
define|#
directive|define
name|DEF_IE_PRINT
parameter_list|(
name|Coding
parameter_list|,
name|IE
parameter_list|)
define|\
value|void uni_ie_print_##Coding##_##IE(struct uni_ie_##IE *ie, struct unicx *cx)
end_define

begin_define
define|#
directive|define
name|DEF_IE_CHECK
parameter_list|(
name|Coding
parameter_list|,
name|IE
parameter_list|)
define|\
value|int uni_ie_check_##Coding##_##IE(struct uni_ie_##IE *ie, struct unicx *cx)
end_define

begin_define
define|#
directive|define
name|DEF_IE_ENCODE
parameter_list|(
name|Coding
parameter_list|,
name|IE
parameter_list|)
define|\
value|int uni_ie_encode_##Coding##_##IE(struct uni_msg *msg, struct uni_ie_##IE *ie, struct unicx *cx)
end_define

begin_define
define|#
directive|define
name|DEF_IE_DECODE
parameter_list|(
name|Coding
parameter_list|,
name|IE
parameter_list|)
define|\
value|int uni_ie_decode_##Coding##_##IE(struct uni_ie_##IE *ie, struct uni_msg *msg, u_int ielen, struct unicx *cx)
end_define

begin_comment
comment|/*  * This structure is used to define value->string mappings. MKT() is used  * to generate a table entry. EOT() to end the table.  */
end_comment

begin_define
define|#
directive|define
name|MKT
parameter_list|(
name|V
parameter_list|,
name|N
parameter_list|)
value|{ #N, V }
end_define

begin_define
define|#
directive|define
name|EOT
parameter_list|()
value|{ NULL, 0 }
end_define

begin_comment
comment|/* library internal functions */
end_comment

begin_function_decl
specifier|static
name|void
name|uni_entry
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|struct
name|unicx
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|uni_print_iehdr
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|struct
name|uni_iehdr
modifier|*
name|h
parameter_list|,
name|struct
name|unicx
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|uni_print_ieend
parameter_list|(
name|struct
name|unicx
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|uni_putc
parameter_list|(
name|int
parameter_list|,
name|struct
name|unicx
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * Encoding  */
end_comment

begin_define
define|#
directive|define
name|APP_BYTE
parameter_list|(
name|M
parameter_list|,
name|B
parameter_list|)
value|do {					\ 	*(M)->b_wptr++ = (B);					\     } while (0)
end_define

begin_define
define|#
directive|define
name|APP_16BIT
parameter_list|(
name|M
parameter_list|,
name|B
parameter_list|)
value|do {					\ 	u_int _v = (B);						\ 	*(M)->b_wptr++ = _v>> 8; 				\ 	*(M)->b_wptr++ = _v;					\     } while (0)
end_define

begin_define
define|#
directive|define
name|APP_24BIT
parameter_list|(
name|M
parameter_list|,
name|B
parameter_list|)
value|do {					\ 	u_int _v = (B);						\ 	*(M)->b_wptr++ = _v>> 16;				\ 	*(M)->b_wptr++ = _v>> 8;				\ 	*(M)->b_wptr++ = _v;					\     } while (0)
end_define

begin_define
define|#
directive|define
name|APP_32BIT
parameter_list|(
name|M
parameter_list|,
name|B
parameter_list|)
value|do {					\ 	u_int _v = (B);						\ 	*(M)->b_wptr++ = _v>> 24;				\ 	*(M)->b_wptr++ = _v>> 16;				\ 	*(M)->b_wptr++ = _v>> 8;				\ 	*(M)->b_wptr++ = _v;					\     } while (0)
end_define

begin_define
define|#
directive|define
name|APP_BUF
parameter_list|(
name|M
parameter_list|,
name|B
parameter_list|,
name|L
parameter_list|)
value|do {					\ 	(void)memcpy((M)->b_wptr, (B), (L));			\ 	(M)->b_wptr += (L);					\     } while (0)
end_define

begin_define
define|#
directive|define
name|APP_SUB_BYTE
parameter_list|(
name|M
parameter_list|,
name|T
parameter_list|,
name|B
parameter_list|)
value|do { APP_BYTE(M, T); APP_BYTE(M, B); } while (0)
end_define

begin_define
define|#
directive|define
name|APP_SUB_16BIT
parameter_list|(
name|M
parameter_list|,
name|T
parameter_list|,
name|B
parameter_list|)
value|do { APP_BYTE(M, T); APP_16BIT(M, B); } while (0)
end_define

begin_define
define|#
directive|define
name|APP_SUB_24BIT
parameter_list|(
name|M
parameter_list|,
name|T
parameter_list|,
name|B
parameter_list|)
value|do { APP_BYTE(M, T); APP_24BIT(M, B); } while (0)
end_define

begin_define
define|#
directive|define
name|APP_SUB_32BIT
parameter_list|(
name|M
parameter_list|,
name|T
parameter_list|,
name|B
parameter_list|)
value|do { APP_BYTE(M, T); APP_32BIT(M, B); } while (0)
end_define

begin_define
define|#
directive|define
name|APP_OPT
parameter_list|(
name|M
parameter_list|,
name|F
parameter_list|,
name|P
parameter_list|,
name|T
parameter_list|)
value|do {				\ 	if ((F)& (P))						\ 		APP_BYTE((M), (T));				\     } while (0)
end_define

begin_define
define|#
directive|define
name|APP_OPT_BYTE
parameter_list|(
name|M
parameter_list|,
name|F
parameter_list|,
name|P
parameter_list|,
name|T
parameter_list|,
name|B
parameter_list|)
value|do {			\ 	if ((F)& (P))						\ 		APP_SUB_BYTE((M), (T), (B));			\     } while (0)
end_define

begin_define
define|#
directive|define
name|APP_OPT_16BIT
parameter_list|(
name|M
parameter_list|,
name|F
parameter_list|,
name|P
parameter_list|,
name|T
parameter_list|,
name|B
parameter_list|)
value|do {			\ 	if ((F)& (P))						\ 		APP_SUB_16BIT((M), (T), (B));			\     } while (0)
end_define

begin_define
define|#
directive|define
name|APP_OPT_24BIT
parameter_list|(
name|M
parameter_list|,
name|F
parameter_list|,
name|P
parameter_list|,
name|T
parameter_list|,
name|B
parameter_list|)
value|do {			\ 	if ((F)& (P))						\ 		APP_SUB_24BIT((M), (T), (B));			\     } while (0)
end_define

begin_define
define|#
directive|define
name|START_IE
parameter_list|(
name|TYPE
parameter_list|,
name|CODE
parameter_list|,
name|LEN
parameter_list|)
define|\
value|u_int ielen; 						\ 								\ 	if (uni_check_ie(CODE, (union uni_ieall *)ie, cx)) 	\ 		return (-1); 					\ 	if (uni_encode_ie_hdr(msg, CODE,&ie->h, (LEN), cx))	\ 		return (0);					\ 								\ 	ielen = msg->b_wptr - msg->b_rptr - 2;
end_define

begin_define
define|#
directive|define
name|START_IE2
parameter_list|(
name|TYPE
parameter_list|,
name|CODE
parameter_list|,
name|LEN
parameter_list|,
name|REALCODE
parameter_list|)
define|\
value|u_int ielen; 						\ 								\ 	if (uni_check_ie(CODE, (union uni_ieall *)ie, cx)) 	\ 		return (-1); 					\ 	if (uni_encode_ie_hdr(msg, REALCODE,&ie->h, (LEN), cx)) \ 		return (0);					\ 								\ 	ielen = msg->b_wptr - msg->b_rptr - 2;
end_define

begin_define
define|#
directive|define
name|SET_IE_LEN
parameter_list|(
name|M
parameter_list|)
value|do {					\ 	(M)->b_buf[ielen + 0] =					\ 	    (((M)->b_wptr - (M)->b_rptr) - ielen - 2)>> 8;	\ 	(M)->b_buf[ielen + 1] =					\ 	    (((M)->b_wptr - (M)->b_rptr) - ielen - 2)>> 0;	\     } while (0)
end_define

begin_comment
comment|/***********************************************************************/
end_comment

begin_comment
comment|/*  * Decoding  */
end_comment

begin_define
define|#
directive|define
name|IE_START
parameter_list|(
name|ERR
parameter_list|)
define|\
value|if (IE_ISPRESENT(*ie))						\ 		return (0);						\ 	if (ielen == 0) {						\ 		IE_SETEMPTY(*ie);					\ 		return (0);						\ 	}
end_define

begin_define
define|#
directive|define
name|IE_END
parameter_list|(
name|IE
parameter_list|)
define|\
value|IE_SETPRESENT(*ie);						\ 	if (uni_check_ie(UNI_IE_##IE, (union uni_ieall *)ie, cx) == 0) 	\ 		return (0);						\   rej:									\ 	ie->h.present = UNI_IE_ERROR | UNI_IE_PRESENT;			\ 	return (1);
end_define

begin_define
define|#
directive|define
name|DEC_GETF3
parameter_list|(
name|ID
parameter_list|,
name|F
parameter_list|,
name|P
parameter_list|)
define|\
value|case UNI_##ID##_ID:					\ 			if (ielen< 3)					\ 				goto rej;				\ 			ielen -= 3;					\ 		  	if (!(P& UNI_##ID##_P)) {			\ 		  		P |= UNI_##ID##_P;			\ 				ie->F  = *msg->b_rptr++<< 16;		\ 				ie->F |= *msg->b_rptr++<< 8;		\ 				ie->F |= *msg->b_rptr++;		\ 			} else						\ 				msg->b_rptr += 3;			\ 			break;
end_define

begin_define
define|#
directive|define
name|DEC_GETF1
parameter_list|(
name|ID
parameter_list|,
name|F
parameter_list|,
name|P
parameter_list|)
define|\
value|case UNI_##ID##_ID:					\ 			if (ielen< 1)					\ 				goto rej;				\ 			ielen--;					\ 		  	if (!(P& UNI_##ID##_P)) {			\ 		  		P |= UNI_##ID##_P;			\ 				ie->F = *msg->b_rptr++;			\ 			} else						\ 				msg->b_rptr++;				\ 			break;
end_define

begin_define
define|#
directive|define
name|PRINT_NPREFIX
value|(sizeof(((struct unicx *)0)->prefix) /		\ 	    sizeof(((struct unicx *)0)->prefix[0]))
end_define

begin_comment
comment|/*  * This is rather here than in privmsg.c because we need the APP macros.  */
end_comment

begin_function
name|int
name|uni_encode_msg_hdr
parameter_list|(
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|struct
name|uni_msghdr
modifier|*
name|h
parameter_list|,
name|enum
name|uni_msgtype
name|type
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
name|int
modifier|*
name|mlen
parameter_list|)
block|{
name|u_char
name|byte
decl_stmt|;
name|uni_msg_ensure
argument_list|(
name|msg
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|cx
operator|->
name|pnni
condition|?
name|PNNI_PROTO
else|:
name|UNI_PROTO
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|h
operator|->
name|cref
operator|.
name|cref
operator|>=
literal|1
operator|<<
literal|23
condition|)
return|return
operator|-
literal|1
return|;
name|APP_24BIT
argument_list|(
name|msg
argument_list|,
name|h
operator|->
name|cref
operator|.
name|cref
operator||
operator|(
name|h
operator|->
name|cref
operator|.
name|flag
condition|?
literal|0x800000
else|:
literal|0
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|byte
operator|=
literal|0x80
expr_stmt|;
if|if
condition|(
name|h
operator|->
name|act
operator|!=
name|UNI_MSGACT_DEFAULT
condition|)
name|byte
operator||=
literal|0x10
operator||
operator|(
name|h
operator|->
name|act
operator|&
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|cx
operator|->
name|pnni
operator|&&
name|h
operator|->
name|pass
condition|)
name|byte
operator||=
literal|0x08
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|byte
argument_list|)
expr_stmt|;
operator|*
name|mlen
operator|=
name|msg
operator|->
name|b_wptr
operator|-
name|msg
operator|->
name|b_rptr
expr_stmt|;
name|APP_16BIT
argument_list|(
name|msg
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Initialize printing. This must be called by all printing routines  * that are exported to the user.  */
end_comment

begin_function
name|void
name|uni_print_init
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|size_t
name|bufsiz
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
if|if
condition|(
name|cx
operator|->
name|dont_init
condition|)
return|return;
name|cx
operator|->
name|indent
operator|=
literal|0
expr_stmt|;
name|cx
operator|->
name|nprefix
operator|=
literal|0
expr_stmt|;
name|cx
operator|->
name|doindent
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|cx
operator|->
name|tabsiz
operator|==
literal|0
condition|)
name|cx
operator|->
name|tabsiz
operator|=
literal|4
expr_stmt|;
name|cx
operator|->
name|buf
operator|=
name|buf
expr_stmt|;
name|cx
operator|->
name|bufsiz
operator|=
name|bufsiz
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Append a character to the buffer if there is still space  */
end_comment

begin_function
specifier|static
name|void
name|uni_putc
parameter_list|(
name|int
name|c
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
if|if
condition|(
name|cx
operator|->
name|bufsiz
operator|>
literal|1
condition|)
block|{
operator|*
name|cx
operator|->
name|buf
operator|++
operator|=
name|c
expr_stmt|;
name|cx
operator|->
name|bufsiz
operator|--
expr_stmt|;
operator|*
name|cx
operator|->
name|buf
operator|=
literal|'\0'
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|uni_printf
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|u_int
name|n
decl_stmt|;
name|va_list
name|ap
decl_stmt|;
if|if
condition|(
name|cx
operator|->
name|bufsiz
operator|>
literal|1
condition|)
block|{
name|va_start
argument_list|(
name|ap
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|n
operator|=
name|vsnprintf
argument_list|(
name|cx
operator|->
name|buf
argument_list|,
name|cx
operator|->
name|bufsiz
argument_list|,
name|fmt
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|n
operator|<
name|cx
operator|->
name|bufsiz
condition|)
block|{
name|cx
operator|->
name|bufsiz
operator|-=
name|n
expr_stmt|;
name|cx
operator|->
name|buf
operator|+=
name|n
expr_stmt|;
block|}
else|else
block|{
name|cx
operator|->
name|buf
operator|+=
name|cx
operator|->
name|bufsiz
operator|-
literal|1
expr_stmt|;
name|cx
operator|->
name|bufsiz
operator|=
literal|1
expr_stmt|;
block|}
block|}
operator|*
name|cx
operator|->
name|buf
operator|=
literal|'\0'
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Print mode:  *	0 - print all into one line, fully prefixed  *	1 - print on multiple lines, full prefixed, but equal level  *	    entries on one line  *	2 - like 2, but only partial prefixed  *	3 - like 1, but each entry onto a new line  *	4 - like 2 + 3  */
end_comment

begin_comment
comment|/*  * If we are in multiline mode, end the current line and set the  * flag, that we need indentation. But prevent double new lines.  */
end_comment

begin_function
name|void
name|uni_print_eol
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
if|if
condition|(
name|cx
operator|->
name|multiline
condition|)
block|{
if|if
condition|(
operator|!
name|cx
operator|->
name|doindent
condition|)
block|{
name|uni_putc
argument_list|(
literal|'\n'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|doindent
operator|=
literal|1
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * New entry. Do the prefixing, indentation and spacing.  */
end_comment

begin_function
specifier|static
name|void
name|doprefix
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
specifier|const
name|char
modifier|*
name|s
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|cx
operator|->
name|multiline
operator|==
literal|0
condition|)
block|{
name|uni_putc
argument_list|(
literal|' '
argument_list|,
name|cx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|cx
operator|->
name|nprefix
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|cx
operator|->
name|prefix
index|[
name|i
index|]
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s."
argument_list|,
name|cx
operator|->
name|prefix
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|cx
operator|->
name|multiline
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|cx
operator|->
name|doindent
condition|)
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%*s"
argument_list|,
name|cx
operator|->
name|indent
operator|*
name|cx
operator|->
name|tabsiz
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|cx
operator|->
name|doindent
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|uni_putc
argument_list|(
literal|' '
argument_list|,
name|cx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|cx
operator|->
name|nprefix
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|cx
operator|->
name|prefix
index|[
name|i
index|]
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s."
argument_list|,
name|cx
operator|->
name|prefix
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|cx
operator|->
name|multiline
operator|==
literal|2
condition|)
block|{
if|if
condition|(
name|cx
operator|->
name|doindent
condition|)
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%*s"
argument_list|,
name|cx
operator|->
name|indent
operator|*
name|cx
operator|->
name|tabsiz
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|cx
operator|->
name|doindent
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|uni_putc
argument_list|(
literal|' '
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|cx
operator|->
name|multiline
operator|==
literal|3
condition|)
block|{
if|if
condition|(
name|cx
operator|->
name|doindent
condition|)
name|cx
operator|->
name|doindent
operator|=
literal|0
expr_stmt|;
else|else
name|uni_putc
argument_list|(
literal|'\n'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%*s"
argument_list|,
name|cx
operator|->
name|indent
operator|*
name|cx
operator|->
name|tabsiz
argument_list|,
literal|""
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|cx
operator|->
name|nprefix
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|cx
operator|->
name|prefix
index|[
name|i
index|]
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s."
argument_list|,
name|cx
operator|->
name|prefix
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|cx
operator|->
name|multiline
operator|==
literal|4
condition|)
block|{
if|if
condition|(
name|cx
operator|->
name|doindent
condition|)
name|cx
operator|->
name|doindent
operator|=
literal|0
expr_stmt|;
else|else
name|uni_putc
argument_list|(
literal|'\n'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%*s"
argument_list|,
name|cx
operator|->
name|indent
operator|*
name|cx
operator|->
name|tabsiz
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s"
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|uni_entry
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|doprefix
argument_list|(
name|cx
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|'='
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|uni_print_flag
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|doprefix
argument_list|(
name|cx
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Start a deeper level of indendation. If multiline is in effect,  * we end the current line.  */
end_comment

begin_function
name|void
name|uni_print_push_prefix
parameter_list|(
specifier|const
name|char
modifier|*
name|prefix
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
if|if
condition|(
name|cx
operator|->
name|nprefix
operator|<
name|PRINT_NPREFIX
condition|)
name|cx
operator|->
name|prefix
index|[
name|cx
operator|->
name|nprefix
operator|++
index|]
operator|=
name|prefix
expr_stmt|;
block|}
end_function

begin_function
name|void
name|uni_print_pop_prefix
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
if|if
condition|(
name|cx
operator|->
name|nprefix
operator|>
literal|0
condition|)
name|cx
operator|->
name|nprefix
operator|--
expr_stmt|;
block|}
end_function

begin_function
name|void
name|uni_print_tbl
parameter_list|(
specifier|const
name|char
modifier|*
name|entry
parameter_list|,
name|u_int
name|val
parameter_list|,
specifier|const
name|struct
name|uni_print_tbl
modifier|*
name|tbl
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
if|if
condition|(
name|entry
condition|)
name|uni_entry
argument_list|(
name|entry
argument_list|,
name|cx
argument_list|)
expr_stmt|;
while|while
condition|(
name|tbl
operator|->
name|name
condition|)
block|{
if|if
condition|(
name|tbl
operator|->
name|val
operator|==
name|val
condition|)
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s"
argument_list|,
name|tbl
operator|->
name|name
argument_list|)
expr_stmt|;
return|return;
block|}
name|tbl
operator|++
expr_stmt|;
block|}
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"ERROR(0x%x)"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|uni_print_entry
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
specifier|const
name|char
modifier|*
name|e
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|u_int
name|n
decl_stmt|;
name|va_list
name|ap
decl_stmt|;
name|uni_entry
argument_list|(
name|e
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|cx
operator|->
name|bufsiz
operator|>
literal|1
condition|)
block|{
name|va_start
argument_list|(
name|ap
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|n
operator|=
name|vsnprintf
argument_list|(
name|cx
operator|->
name|buf
argument_list|,
name|cx
operator|->
name|bufsiz
argument_list|,
name|fmt
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|n
operator|<
name|cx
operator|->
name|bufsiz
condition|)
block|{
name|cx
operator|->
name|bufsiz
operator|-=
name|n
expr_stmt|;
name|cx
operator|->
name|buf
operator|+=
name|n
expr_stmt|;
block|}
else|else
block|{
name|cx
operator|->
name|buf
operator|+=
name|cx
operator|->
name|bufsiz
operator|-
literal|1
expr_stmt|;
name|cx
operator|->
name|bufsiz
operator|=
literal|1
expr_stmt|;
block|}
block|}
operator|*
name|cx
operator|->
name|buf
operator|=
literal|'\0'
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**********************************************************************/
end_comment

begin_comment
comment|/*  * Printing information elements.  */
end_comment

begin_function
specifier|static
name|int
name|uni_print_iehdr
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|struct
name|uni_iehdr
modifier|*
name|h
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|act_tab
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_IEACT_CLEAR
argument_list|,
name|clear
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_IEACT_IGNORE
argument_list|,
name|ignore
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_IEACT_REPORT
argument_list|,
name|report
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_IEACT_MSG_IGNORE
argument_list|,
name|ignore
operator|-
name|msg
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_IEACT_MSG_REPORT
argument_list|,
name|report
operator|-
name|msg
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_IEACT_DEFAULT
argument_list|,
expr|default
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|cod_tab
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_CODING_ITU
argument_list|,
name|itut
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CODING_NET
argument_list|,
name|atmf
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
name|name
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
name|NULL
argument_list|,
name|h
operator|->
name|act
argument_list|,
name|act_tab
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
name|NULL
argument_list|,
name|h
operator|->
name|coding
argument_list|,
name|cod_tab
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|cx
operator|->
name|pnni
operator|&&
name|h
operator|->
name|pass
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|",pass"
argument_list|)
expr_stmt|;
if|if
condition|(
name|IE_ISEMPTY
argument_list|(
operator|*
operator|(
expr|struct
name|uni_ie_aal
operator|*
operator|)
name|h
argument_list|)
condition|)
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|",empty)"
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
name|IE_ISERROR
argument_list|(
operator|*
operator|(
expr|struct
name|uni_ie_aal
operator|*
operator|)
name|h
argument_list|)
condition|)
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|",error)"
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_push_prefix
argument_list|(
name|name
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|uni_print_ieend
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|--
expr_stmt|;
block|}
end_function

begin_function
name|void
name|uni_print_ie_internal
parameter_list|(
name|enum
name|uni_ietype
name|code
parameter_list|,
specifier|const
name|union
name|uni_ieall
modifier|*
name|ie
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
specifier|const
name|struct
name|iedecl
modifier|*
name|iedecl
decl_stmt|;
if|if
condition|(
operator|(
name|iedecl
operator|=
name|GET_IEDECL
argument_list|(
name|code
argument_list|,
name|ie
operator|->
name|h
operator|.
name|coding
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
call|(
modifier|*
name|iedecl
operator|->
name|print
call|)
argument_list|(
name|ie
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|uni_print_ie
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|size_t
name|size
parameter_list|,
name|enum
name|uni_ietype
name|code
parameter_list|,
specifier|const
name|union
name|uni_ieall
modifier|*
name|ie
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|uni_print_init
argument_list|(
name|buf
argument_list|,
name|size
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ie_internal
argument_list|(
name|code
argument_list|,
name|ie
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|uni_check_ie
parameter_list|(
name|enum
name|uni_ietype
name|code
parameter_list|,
name|union
name|uni_ieall
modifier|*
name|ie
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
specifier|const
name|struct
name|iedecl
modifier|*
name|iedecl
init|=
name|GET_IEDECL
argument_list|(
name|code
argument_list|,
name|ie
operator|->
name|h
operator|.
name|coding
argument_list|)
decl_stmt|;
if|if
condition|(
name|iedecl
operator|!=
name|NULL
condition|)
return|return
operator|(
name|iedecl
operator|->
name|check
argument_list|(
name|ie
argument_list|,
name|cx
argument_list|)
operator|)
return|;
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode a information element header.  * Returns -1 if the message is too short.  * Strip the header from the message.  * The header is stripped, even if it is too short.  */
end_comment

begin_function
name|int
name|uni_decode_ie_hdr
parameter_list|(
name|enum
name|uni_ietype
modifier|*
name|ietype
parameter_list|,
name|struct
name|uni_iehdr
modifier|*
name|hdr
parameter_list|,
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
name|u_int
modifier|*
name|ielen
parameter_list|)
block|{
name|u_int
name|len
decl_stmt|;
operator|*
name|ietype
operator|=
operator|(
expr|enum
name|uni_ietype
operator|)
literal|0
expr_stmt|;
operator|*
name|ielen
operator|=
literal|0
expr_stmt|;
name|hdr
operator|->
name|present
operator|=
literal|0
expr_stmt|;
name|hdr
operator|->
name|coding
operator|=
name|UNI_CODING_ITU
expr_stmt|;
name|hdr
operator|->
name|act
operator|=
name|UNI_IEACT_DEFAULT
expr_stmt|;
if|if
condition|(
operator|(
name|len
operator|=
name|uni_msg_len
argument_list|(
name|msg
argument_list|)
operator|)
operator|==
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
operator|*
name|ietype
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
if|if
condition|(
operator|--
name|len
operator|==
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|hdr
operator|->
name|coding
operator|=
operator|(
operator|*
name|msg
operator|->
name|b_rptr
operator|>>
literal|5
operator|)
operator|&
literal|3
expr_stmt|;
name|hdr
operator|->
name|present
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|&
literal|0x17
condition|)
block|{
case|case
literal|0x10
case|:
case|case
literal|0x11
case|:
case|case
literal|0x12
case|:
case|case
literal|0x15
case|:
case|case
literal|0x16
case|:
name|hdr
operator|->
name|act
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|&
literal|0x7
expr_stmt|;
break|break;
case|case
literal|0x00
case|:
case|case
literal|0x01
case|:
case|case
literal|0x02
case|:
case|case
literal|0x03
case|:
case|case
literal|0x04
case|:
case|case
literal|0x05
case|:
case|case
literal|0x06
case|:
case|case
literal|0x07
case|:
name|hdr
operator|->
name|act
operator|=
name|UNI_IEACT_DEFAULT
expr_stmt|;
break|break;
default|default:
comment|/* Q.2931 5.7.2 last sentence */
name|hdr
operator|->
name|act
operator|=
name|UNI_IEACT_REPORT
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|cx
operator|->
name|pnni
operator|&&
operator|(
operator|*
name|msg
operator|->
name|b_rptr
operator|&
literal|0x08
operator|)
condition|)
name|hdr
operator|->
name|pass
operator|=
literal|1
expr_stmt|;
else|else
name|hdr
operator|->
name|pass
operator|=
literal|0
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
if|if
condition|(
operator|--
name|len
operator|==
literal|0
condition|)
block|{
name|hdr
operator|->
name|present
operator|=
name|UNI_IE_ERROR
operator||
name|UNI_IE_PRESENT
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|len
operator|<
literal|2
condition|)
block|{
name|msg
operator|->
name|b_rptr
operator|+=
name|len
expr_stmt|;
name|hdr
operator|->
name|present
operator|=
name|UNI_IE_ERROR
operator||
name|UNI_IE_PRESENT
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
operator|*
name|ielen
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
operator|*
name|ielen
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode the body of an information element.  */
end_comment

begin_function
name|int
name|uni_decode_ie_body
parameter_list|(
name|enum
name|uni_ietype
name|ietype
parameter_list|,
name|union
name|uni_ieall
modifier|*
name|ie
parameter_list|,
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|u_int
name|ielen
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
specifier|const
name|struct
name|iedecl
modifier|*
name|iedecl
decl_stmt|;
name|u_char
modifier|*
name|end
decl_stmt|;
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|ielen
operator|>
name|uni_msg_len
argument_list|(
name|msg
argument_list|)
condition|)
block|{
comment|/* 		 * Information element too long -> content error. 		 * Q.2931 5.6.8.2 		 */
name|msg
operator|->
name|b_rptr
operator|=
name|msg
operator|->
name|b_wptr
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator|=
name|UNI_IE_ERROR
operator||
name|UNI_IE_PRESENT
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|iedecl
operator|=
name|GET_IEDECL
argument_list|(
name|ietype
argument_list|,
name|ie
operator|->
name|h
operator|.
name|coding
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
comment|/* 		 * entirly unknown IE. 		 * Q.2931 5.6.8.1 		 */
name|msg
operator|->
name|b_rptr
operator|+=
name|ielen
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator|=
name|UNI_IE_ERROR
operator||
name|UNI_IE_PRESENT
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|ielen
operator|>
name|iedecl
operator|->
name|maxlen
condition|)
block|{
comment|/* 		 * Information element too long -> content error. 		 * Q.2931 5.6.8.2 		 */
name|msg
operator|->
name|b_rptr
operator|+=
name|iedecl
operator|->
name|maxlen
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator|=
name|UNI_IE_ERROR
operator||
name|UNI_IE_PRESENT
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|end
operator|=
name|msg
operator|->
name|b_rptr
operator|+
name|ielen
expr_stmt|;
name|ret
operator|=
call|(
modifier|*
name|iedecl
operator|->
name|decode
call|)
argument_list|(
name|ie
argument_list|,
name|msg
argument_list|,
name|ielen
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|=
name|end
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_function
name|int
name|uni_encode_ie
parameter_list|(
name|enum
name|uni_ietype
name|code
parameter_list|,
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|union
name|uni_ieall
modifier|*
name|ie
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
specifier|const
name|struct
name|iedecl
modifier|*
name|iedecl
init|=
name|GET_IEDECL
argument_list|(
name|code
argument_list|,
name|ie
operator|->
name|h
operator|.
name|coding
argument_list|)
decl_stmt|;
if|if
condition|(
name|iedecl
operator|==
name|NULL
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
name|iedecl
operator|->
name|encode
argument_list|(
name|msg
argument_list|,
name|ie
argument_list|,
name|cx
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|int
name|uni_encode_ie_hdr
parameter_list|(
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|enum
name|uni_ietype
name|type
parameter_list|,
name|struct
name|uni_iehdr
modifier|*
name|h
parameter_list|,
name|u_int
name|len
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|u_char
name|byte
decl_stmt|;
name|uni_msg_ensure
argument_list|(
name|msg
argument_list|,
literal|4
operator|+
name|len
argument_list|)
expr_stmt|;
operator|*
name|msg
operator|->
name|b_wptr
operator|++
operator|=
name|type
expr_stmt|;
name|byte
operator|=
literal|0x80
operator||
operator|(
name|h
operator|->
name|coding
operator|<<
literal|5
operator|)
expr_stmt|;
if|if
condition|(
name|h
operator|->
name|act
operator|!=
name|UNI_IEACT_DEFAULT
condition|)
name|byte
operator||=
literal|0x10
operator||
operator|(
name|h
operator|->
name|act
operator|&
literal|7
operator|)
expr_stmt|;
if|if
condition|(
name|cx
operator|->
name|pnni
condition|)
name|byte
operator||=
name|h
operator|->
name|pass
operator|<<
literal|3
expr_stmt|;
operator|*
name|msg
operator|->
name|b_wptr
operator|++
operator|=
name|byte
expr_stmt|;
if|if
condition|(
name|h
operator|->
name|present
operator|&
name|UNI_IE_EMPTY
condition|)
block|{
operator|*
name|msg
operator|->
name|b_wptr
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|msg
operator|->
name|b_wptr
operator|++
operator|=
literal|4
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
operator|*
name|msg
operator|->
name|b_wptr
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|msg
operator|->
name|b_wptr
operator|++
operator|=
literal|0
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Printing messages.  */
end_comment

begin_function
specifier|static
name|void
name|uni_print_cref_internal
parameter_list|(
specifier|const
name|struct
name|uni_cref
modifier|*
name|cref
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"cref"
argument_list|,
literal|"%d."
argument_list|,
name|cref
operator|->
name|flag
argument_list|)
expr_stmt|;
if|if
condition|(
name|cref
operator|->
name|cref
operator|==
name|CREF_GLOBAL
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"GLOBAL"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|cref
operator|->
name|cref
operator|==
name|CREF_DUMMY
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"DUMMY"
argument_list|)
expr_stmt|;
else|else
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%d"
argument_list|,
name|cref
operator|->
name|cref
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|uni_print_cref
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|size_t
name|len
parameter_list|,
specifier|const
name|struct
name|uni_cref
modifier|*
name|cref
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|uni_print_init
argument_list|(
name|str
argument_list|,
name|len
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_cref_internal
argument_list|(
name|cref
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|uni_print_msghdr_internal
parameter_list|(
specifier|const
name|struct
name|uni_msghdr
modifier|*
name|hdr
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|tab
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_MSGACT_CLEAR
argument_list|,
name|clear
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_MSGACT_IGNORE
argument_list|,
name|ignore
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_MSGACT_REPORT
argument_list|,
name|report
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_MSGACT_DEFAULT
argument_list|,
expr|default
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
name|uni_print_cref_internal
argument_list|(
operator|&
name|hdr
operator|->
name|cref
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"act"
argument_list|,
name|hdr
operator|->
name|act
argument_list|,
name|tab
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|cx
operator|->
name|pnni
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"pass"
argument_list|,
literal|"%s"
argument_list|,
name|hdr
operator|->
name|pass
condition|?
literal|"yes"
else|:
literal|"no"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|uni_print_msghdr
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|size_t
name|len
parameter_list|,
specifier|const
name|struct
name|uni_msghdr
modifier|*
name|hdr
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|uni_print_init
argument_list|(
name|str
argument_list|,
name|len
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_msghdr_internal
argument_list|(
name|hdr
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|uni_print_internal
parameter_list|(
specifier|const
name|struct
name|uni_all
modifier|*
name|msg
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|uni_entry
argument_list|(
literal|"mtype"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg
operator|->
name|mtype
operator|>=
literal|256
operator|||
name|uni_msgtable
index|[
name|msg
operator|->
name|mtype
index|]
operator|==
name|NULL
condition|)
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"0x%02x(ERROR)"
argument_list|,
name|msg
operator|->
name|mtype
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s"
argument_list|,
name|uni_msgtable
index|[
name|msg
operator|->
name|mtype
index|]
operator|->
name|name
argument_list|)
expr_stmt|;
name|uni_print_msghdr_internal
argument_list|(
operator|&
name|msg
operator|->
name|u
operator|.
name|hdr
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
operator|(
operator|*
name|uni_msgtable
index|[
name|msg
operator|->
name|mtype
index|]
operator|->
name|print
operator|)
operator|(
operator|&
name|msg
operator|->
name|u
operator|,
name|cx
operator|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|cx
operator|->
name|multiline
operator|==
literal|0
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|uni_print
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|size_t
name|size
parameter_list|,
specifier|const
name|struct
name|uni_all
modifier|*
name|all
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|uni_print_init
argument_list|(
name|buf
argument_list|,
name|size
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_internal
argument_list|(
name|all
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|uni_print_msg_internal
parameter_list|(
name|u_int
name|mtype
parameter_list|,
specifier|const
name|union
name|uni_msgall
modifier|*
name|msg
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|uni_entry
argument_list|(
literal|"mtype"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|mtype
operator|>=
literal|256
operator|||
name|uni_msgtable
index|[
name|mtype
index|]
operator|==
name|NULL
condition|)
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"0x%02x(ERROR)"
argument_list|,
name|mtype
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s"
argument_list|,
name|uni_msgtable
index|[
name|mtype
index|]
operator|->
name|name
argument_list|)
expr_stmt|;
name|uni_print_msghdr_internal
argument_list|(
operator|&
name|msg
operator|->
name|hdr
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
operator|(
operator|*
name|uni_msgtable
index|[
name|mtype
index|]
operator|->
name|print
operator|)
operator|(
name|msg
operator|,
name|cx
operator|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|cx
operator|->
name|multiline
operator|==
literal|0
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|uni_print_msg
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|size_t
name|size
parameter_list|,
name|u_int
name|mtype
parameter_list|,
specifier|const
name|union
name|uni_msgall
modifier|*
name|all
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|uni_print_init
argument_list|(
name|buf
argument_list|,
name|size
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_msg_internal
argument_list|(
name|mtype
argument_list|,
name|all
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|uni_print_cx
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|size_t
name|size
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
specifier|static
specifier|const
name|char
modifier|*
name|acttab
index|[]
init|=
block|{
literal|"clr"
block|,
comment|/* 0x00 */
literal|"ign"
block|,
comment|/* 0x01 */
literal|"rep"
block|,
comment|/* 0x02 */
literal|"x03"
block|,
comment|/* 0x03 */
literal|"x04"
block|,
comment|/* 0x04 */
literal|"mig"
block|,
comment|/* 0x05 */
literal|"mrp"
block|,
comment|/* 0x06 */
literal|"x07"
block|,
comment|/* 0x07 */
literal|"def"
block|,
comment|/* 0x08 */
block|}
decl_stmt|;
specifier|static
specifier|const
name|char
modifier|*
name|errtab
index|[]
init|=
block|{
index|[
name|UNI_IERR_UNK
index|]
operator|=
literal|"unk"
block|,
comment|/* unknown IE */
index|[
name|UNI_IERR_LEN
index|]
operator|=
literal|"len"
block|,
comment|/* length error */
index|[
name|UNI_IERR_BAD
index|]
operator|=
literal|"bad"
block|,
comment|/* content error */
index|[
name|UNI_IERR_ACC
index|]
operator|=
literal|"acc"
block|,
comment|/* access element discarded */
index|[
name|UNI_IERR_MIS
index|]
operator|=
literal|"mis"
block|,
comment|/* missing IE */
block|}
decl_stmt|;
name|u_int
name|i
decl_stmt|;
name|uni_print_init
argument_list|(
name|buf
argument_list|,
name|size
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"q2932		%d\n"
argument_list|,
name|cx
operator|->
name|q2932
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"pnni		%d\n"
argument_list|,
name|cx
operator|->
name|pnni
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"git_hard	%d\n"
argument_list|,
name|cx
operator|->
name|git_hard
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"bearer_hard	%d\n"
argument_list|,
name|cx
operator|->
name|bearer_hard
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"cause_hard	%d\n"
argument_list|,
name|cx
operator|->
name|cause_hard
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"multiline	%d\n"
argument_list|,
name|cx
operator|->
name|multiline
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"tabsiz		%d\n"
argument_list|,
name|cx
operator|->
name|tabsiz
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"errcnt		%d ("
argument_list|,
name|cx
operator|->
name|errcnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|cx
operator|->
name|errcnt
condition|;
name|i
operator|++
control|)
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%02x[%s,%s%s]"
argument_list|,
name|cx
operator|->
name|err
index|[
name|i
index|]
operator|.
name|ie
argument_list|,
name|errtab
index|[
name|cx
operator|->
name|err
index|[
name|i
index|]
operator|.
name|err
index|]
argument_list|,
name|acttab
index|[
name|cx
operator|->
name|err
index|[
name|i
index|]
operator|.
name|act
index|]
argument_list|,
name|cx
operator|->
name|err
index|[
name|i
index|]
operator|.
name|man
condition|?
literal|",M"
else|:
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|!=
name|cx
operator|->
name|errcnt
operator|-
literal|1
condition|)
name|uni_putc
argument_list|(
literal|' '
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_include
include|#
directive|include
file|<netnatm/msg/uni_ietab.h>
end_include

begin_comment
comment|/*********************************************************************  *  * Cause  *  * References for this IE are:  *  *  Q.2931 pp. 69 (just a pointer to Q.2610)  *  Q.2610        (this is a small diff to Q.850)  *  Q.850         !!  *  UNI4.0 pp. 15  *  PNNI1.0 p. 198  *  * ITU-T and NET coding for different values.  */
end_comment

begin_struct
specifier|static
specifier|const
struct|struct
name|causetab
block|{
specifier|const
name|char
modifier|*
name|str
decl_stmt|;
name|enum
name|uni_diag
name|diag
decl_stmt|;
block|}
name|itu_causes
index|[
literal|128
index|]
init|=
block|{
define|#
directive|define
name|D
parameter_list|(
name|NAME
parameter_list|,
name|VAL
parameter_list|,
name|DIAG
parameter_list|,
name|STD
parameter_list|,
name|STR
parameter_list|)
value|[UNI_CAUSE_##NAME] = { STR, UNI_DIAG_##DIAG },
define|#
directive|define
name|N
parameter_list|(
name|NAME
parameter_list|,
name|VAL
parameter_list|,
name|DIAG
parameter_list|,
name|STD
parameter_list|,
name|STR
parameter_list|)
name|UNI_DECLARE_CAUSE_VALUES
undef|#
directive|undef
name|D
undef|#
directive|undef
name|N
block|}
struct|,
name|net_causes
index|[
literal|128
index|]
init|=
block|{
define|#
directive|define
name|D
parameter_list|(
name|NAME
parameter_list|,
name|VAL
parameter_list|,
name|DIAG
parameter_list|,
name|STD
parameter_list|,
name|STR
parameter_list|)
define|#
directive|define
name|N
parameter_list|(
name|NAME
parameter_list|,
name|VAL
parameter_list|,
name|DIAG
parameter_list|,
name|STD
parameter_list|,
name|STR
parameter_list|)
value|[UNI_CAUSE_##NAME] = { STR, UNI_DIAG_##DIAG },
name|UNI_DECLARE_CAUSE_VALUES
undef|#
directive|undef
name|D
undef|#
directive|undef
name|N
block|}
struct|;
end_struct

begin_function
name|enum
name|uni_diag
name|uni_diag
parameter_list|(
name|enum
name|uni_cause
name|cause
parameter_list|,
name|enum
name|uni_coding
name|code
parameter_list|)
block|{
if|if
condition|(
name|cause
operator|>=
literal|128
condition|)
return|return
operator|(
name|UNI_DIAG_NONE
operator|)
return|;
if|if
condition|(
name|code
operator|==
name|UNI_CODING_NET
condition|)
if|if
condition|(
name|net_causes
index|[
name|cause
index|]
operator|.
name|str
operator|!=
name|NULL
condition|)
return|return
operator|(
name|net_causes
index|[
name|cause
index|]
operator|.
name|diag
operator|)
return|;
if|if
condition|(
name|itu_causes
index|[
name|cause
index|]
operator|.
name|str
operator|!=
name|NULL
condition|)
return|return
operator|(
name|itu_causes
index|[
name|cause
index|]
operator|.
name|diag
operator|)
return|;
return|return
operator|(
name|UNI_DIAG_NONE
operator|)
return|;
block|}
end_function

begin_comment
comment|/**********************************************************************/
end_comment

begin_function
specifier|static
name|void
name|print_cause
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
name|struct
name|uni_ie_cause
modifier|*
name|ie
parameter_list|,
specifier|const
name|struct
name|causetab
modifier|*
name|tab1
parameter_list|,
specifier|const
name|struct
name|causetab
modifier|*
name|tab2
parameter_list|)
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|loc_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_CAUSE_LOC_USER
argument_list|,
name|user
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_LOC_PRIVLOC
argument_list|,
name|priv
operator|-
name|net
operator|:
name|loc
operator|-
name|user
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_LOC_PUBLOC
argument_list|,
name|pub
operator|-
name|net
operator|:
name|loc
operator|-
name|user
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_LOC_TRANSIT
argument_list|,
name|transit
operator|-
name|net
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_LOC_PUBREM
argument_list|,
name|pub
operator|-
name|net
operator|:
name|rem
operator|-
name|user
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_LOC_PRIVREM
argument_list|,
name|priv
operator|-
name|net
operator|:
name|rem
operator|-
name|user
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_LOC_INTERNAT
argument_list|,
name|int
operator|-
name|net
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_LOC_BEYOND
argument_list|,
name|beyond
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|pu_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_CAUSE_PU_PROVIDER
argument_list|,
name|provider
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_PU_USER
argument_list|,
name|user
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|na_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_CAUSE_NA_NORMAL
argument_list|,
name|normal
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_NA_ABNORMAL
argument_list|,
name|abnormal
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|cond_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_CAUSE_COND_UNKNOWN
argument_list|,
name|unknown
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_COND_PERM
argument_list|,
name|permanent
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_COND_TRANS
argument_list|,
name|transient
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|rej_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_CAUSE_REASON_USER
argument_list|,
name|user
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_REASON_IEMISS
argument_list|,
name|ie
operator|-
name|missing
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CAUSE_REASON_IESUFF
argument_list|,
name|ie
operator|-
name|not
operator|-
name|suff
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
name|char
name|buf
index|[
literal|100
index|]
decl_stmt|,
modifier|*
name|s
decl_stmt|;
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"cause"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
if|if
condition|(
name|ie
operator|->
name|cause
operator|<
literal|128
operator|&&
name|tab1
index|[
name|ie
operator|->
name|cause
index|]
operator|.
name|str
condition|)
name|strcpy
argument_list|(
name|buf
argument_list|,
name|tab1
index|[
name|ie
operator|->
name|cause
index|]
operator|.
name|str
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ie
operator|->
name|cause
operator|<
literal|128
operator|&&
name|tab2
operator|!=
name|NULL
operator|&&
name|tab2
index|[
name|ie
operator|->
name|cause
index|]
operator|.
name|str
operator|!=
name|NULL
condition|)
name|strcpy
argument_list|(
name|buf
argument_list|,
name|tab2
index|[
name|ie
operator|->
name|cause
index|]
operator|.
name|str
argument_list|)
expr_stmt|;
else|else
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"UNKNOWN-%u"
argument_list|,
name|ie
operator|->
name|cause
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|s
operator|=
name|buf
init|;
operator|*
name|s
operator|!=
literal|'\0'
condition|;
name|s
operator|++
control|)
if|if
condition|(
operator|*
name|s
operator|==
literal|' '
condition|)
operator|*
name|s
operator|=
literal|'_'
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"cause"
argument_list|,
literal|"%s"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"loc"
argument_list|,
name|ie
operator|->
name|loc
argument_list|,
name|loc_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_COND_P
condition|)
block|{
name|uni_print_tbl
argument_list|(
literal|"pu"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|pu
argument_list|,
name|pu_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"na"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|na
argument_list|,
name|na_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"condition"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|cond
argument_list|,
name|cond_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_REJ_P
condition|)
block|{
name|uni_print_tbl
argument_list|(
literal|"reject"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|reason
argument_list|,
name|rej_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_REJ_USER_P
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"user"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|user
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_REJ_IE_P
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"ie"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|ie
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_IE_P
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"ie"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|u
operator|.
name|ie
operator|.
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
condition|)
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"0x%02x"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|ie
operator|.
name|ie
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_TRAFFIC_P
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"traffic"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|u
operator|.
name|traffic
operator|.
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
condition|)
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"0x%02x"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|traffic
operator|.
name|traffic
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_VPCI_P
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"vpci"
argument_list|,
literal|"(%u,%u)"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|vpci
operator|.
name|vpci
argument_list|,
name|ie
operator|->
name|u
operator|.
name|vpci
operator|.
name|vci
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_MTYPE_P
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"mtype"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|mtype
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_TIMER_P
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|s
operator|=
name|buf
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|timer
index|[
name|i
index|]
operator|<
literal|' '
condition|)
block|{
operator|*
name|s
operator|++
operator|=
literal|'^'
expr_stmt|;
operator|*
name|s
operator|++
operator|=
name|ie
operator|->
name|u
operator|.
name|timer
index|[
name|i
index|]
operator|+
literal|'@'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|timer
index|[
name|i
index|]
operator|<=
literal|'~'
condition|)
operator|*
name|s
operator|++
operator|=
name|ie
operator|->
name|u
operator|.
name|timer
index|[
name|i
index|]
expr_stmt|;
else|else
block|{
operator|*
name|s
operator|++
operator|=
literal|'\\'
expr_stmt|;
operator|*
name|s
operator|++
operator|=
name|ie
operator|->
name|u
operator|.
name|timer
index|[
name|i
index|]
operator|/
literal|0100
operator|+
literal|'0'
expr_stmt|;
operator|*
name|s
operator|++
operator|=
operator|(
name|ie
operator|->
name|u
operator|.
name|timer
index|[
name|i
index|]
operator|%
literal|0100
operator|)
operator|/
literal|010
operator|+
literal|'0'
expr_stmt|;
operator|*
name|s
operator|++
operator|=
name|ie
operator|->
name|u
operator|.
name|timer
index|[
name|i
index|]
operator|%
literal|010
operator|+
literal|'0'
expr_stmt|;
block|}
block|}
operator|*
name|s
operator|++
operator|=
literal|'\0'
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"timer"
argument_list|,
literal|"\"%s\""
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_TNS_P
condition|)
block|{
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ie_internal
argument_list|(
name|UNI_IE_TNS
argument_list|,
operator|(
expr|union
name|uni_ieall
operator|*
operator|)
operator|&
name|ie
operator|->
name|u
operator|.
name|tns
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_NUMBER_P
condition|)
block|{
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ie_internal
argument_list|(
name|UNI_IE_CALLED
argument_list|,
operator|(
expr|union
name|uni_ieall
operator|*
operator|)
operator|&
name|ie
operator|->
name|u
operator|.
name|number
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_ATTR_P
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"attr"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|nattr
condition|;
name|i
operator|++
control|)
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"(%u"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|i
index|]
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|i
index|]
index|[
literal|0
index|]
operator|&
literal|0x80
operator|)
condition|)
block|{
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|",%u"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|i
index|]
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|i
index|]
index|[
literal|1
index|]
operator|&
literal|0x80
operator|)
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|",%u"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|i
index|]
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
block|}
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|cause
argument_list|)
end_macro

begin_block
block|{
name|print_cause
argument_list|(
name|cx
argument_list|,
name|ie
argument_list|,
name|itu_causes
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|cause
argument_list|)
end_macro

begin_block
block|{
name|print_cause
argument_list|(
name|cx
argument_list|,
name|ie
argument_list|,
name|net_causes
argument_list|,
name|itu_causes
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
specifier|const
name|char
modifier|*
name|uni_ie_cause2str
parameter_list|(
name|enum
name|uni_coding
name|coding
parameter_list|,
name|u_int
name|cause
parameter_list|)
block|{
if|if
condition|(
name|cause
operator|<
literal|128
condition|)
block|{
if|if
condition|(
name|coding
operator|==
name|UNI_CODING_ITU
condition|)
return|return
operator|(
name|itu_causes
index|[
name|cause
index|]
operator|.
name|str
operator|)
return|;
if|if
condition|(
name|coding
operator|==
name|UNI_CODING_NET
condition|)
block|{
if|if
condition|(
name|net_causes
index|[
name|cause
index|]
operator|.
name|str
operator|!=
name|NULL
condition|)
return|return
operator|(
name|net_causes
index|[
name|cause
index|]
operator|.
name|str
operator|)
return|;
return|return
operator|(
name|itu_causes
index|[
name|cause
index|]
operator|.
name|str
operator|)
return|;
block|}
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_comment
comment|/**********************************************************************/
end_comment

begin_function
specifier|static
name|int
name|check_cause
parameter_list|(
name|struct
name|uni_ie_cause
modifier|*
name|ie
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
specifier|const
name|struct
name|causetab
modifier|*
name|tab1
parameter_list|,
specifier|const
name|struct
name|causetab
modifier|*
name|tab2
parameter_list|)
block|{
specifier|static
specifier|const
name|u_int
name|mask
init|=
name|UNI_CAUSE_COND_P
operator||
name|UNI_CAUSE_REJ_P
operator||
name|UNI_CAUSE_REJ_USER_P
operator||
name|UNI_CAUSE_REJ_IE_P
operator||
name|UNI_CAUSE_IE_P
operator||
name|UNI_CAUSE_TRAFFIC_P
operator||
name|UNI_CAUSE_VPCI_P
operator||
name|UNI_CAUSE_MTYPE_P
operator||
name|UNI_CAUSE_TIMER_P
operator||
name|UNI_CAUSE_TNS_P
operator||
name|UNI_CAUSE_NUMBER_P
operator||
name|UNI_CAUSE_ATTR_P
operator||
name|UNI_CAUSE_PARAM_P
decl_stmt|;
specifier|const
name|struct
name|causetab
modifier|*
name|ptr
decl_stmt|;
if|if
condition|(
name|ie
operator|->
name|cause
operator|>=
literal|128
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
switch|switch
condition|(
name|ie
operator|->
name|loc
condition|)
block|{
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
case|case
name|UNI_CAUSE_LOC_USER
case|:
case|case
name|UNI_CAUSE_LOC_PRIVLOC
case|:
case|case
name|UNI_CAUSE_LOC_PUBLOC
case|:
case|case
name|UNI_CAUSE_LOC_TRANSIT
case|:
case|case
name|UNI_CAUSE_LOC_PUBREM
case|:
case|case
name|UNI_CAUSE_LOC_PRIVREM
case|:
case|case
name|UNI_CAUSE_LOC_INTERNAT
case|:
case|case
name|UNI_CAUSE_LOC_BEYOND
case|:
break|break;
block|}
if|if
condition|(
name|tab1
index|[
name|ie
operator|->
name|cause
index|]
operator|.
name|str
operator|!=
name|NULL
condition|)
name|ptr
operator|=
operator|&
name|tab1
index|[
name|ie
operator|->
name|cause
index|]
expr_stmt|;
elseif|else
if|if
condition|(
name|tab2
operator|!=
name|NULL
operator|&&
name|tab2
index|[
name|ie
operator|->
name|cause
index|]
operator|.
name|str
operator|!=
name|NULL
condition|)
name|ptr
operator|=
operator|&
name|tab2
index|[
name|ie
operator|->
name|cause
index|]
expr_stmt|;
else|else
return|return
operator|(
name|cx
operator|->
name|cause_hard
condition|?
operator|-
literal|1
else|:
literal|0
operator|)
return|;
switch|switch
condition|(
name|ptr
operator|->
name|diag
condition|)
block|{
case|case
name|UNI_DIAG_NONE
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
break|break;
block|}
break|break;
case|case
name|UNI_DIAG_COND
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
case|case
name|UNI_CAUSE_COND_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_DIAG_REJ
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
case|case
name|UNI_CAUSE_REJ_P
case|:
case|case
name|UNI_CAUSE_REJ_P
operator||
name|UNI_CAUSE_REJ_USER_P
case|:
case|case
name|UNI_CAUSE_REJ_P
operator||
name|UNI_CAUSE_REJ_IE_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_DIAG_CRATE
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
case|case
name|UNI_CAUSE_TRAFFIC_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_DIAG_IE
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
case|case
name|UNI_CAUSE_IE_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_DIAG_CHANID
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
case|case
name|UNI_CAUSE_VPCI_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_DIAG_MTYPE
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
case|case
name|UNI_CAUSE_MTYPE_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_DIAG_TIMER
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
case|case
name|UNI_CAUSE_TIMER_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_DIAG_TNS
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
case|case
name|UNI_CAUSE_TNS_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_DIAG_NUMBER
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
case|case
name|UNI_CAUSE_NUMBER_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_DIAG_ATTR
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
case|case
name|UNI_CAUSE_ATTR_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_DIAG_PARAM
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
if|if
condition|(
name|cx
operator|->
name|cause_hard
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
break|break;
case|case
literal|0
case|:
case|case
name|UNI_CAUSE_PARAM_P
case|:
break|break;
block|}
break|break;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_COND_P
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|pu
condition|)
block|{
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
case|case
name|UNI_CAUSE_PU_PROVIDER
case|:
case|case
name|UNI_CAUSE_PU_USER
case|:
break|break;
block|}
switch|switch
condition|(
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|na
condition|)
block|{
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
case|case
name|UNI_CAUSE_NA_NORMAL
case|:
case|case
name|UNI_CAUSE_NA_ABNORMAL
case|:
break|break;
block|}
switch|switch
condition|(
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|cond
condition|)
block|{
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
case|case
name|UNI_CAUSE_COND_UNKNOWN
case|:
case|case
name|UNI_CAUSE_COND_PERM
case|:
case|case
name|UNI_CAUSE_COND_TRANS
case|:
break|break;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_REJ_P
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|reason
condition|)
block|{
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
case|case
name|UNI_CAUSE_REASON_USER
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
case|case
name|UNI_CAUSE_REJ_P
case|:
case|case
name|UNI_CAUSE_REJ_P
operator||
name|UNI_CAUSE_REJ_USER_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_CAUSE_REASON_IEMISS
case|:
case|case
name|UNI_CAUSE_REASON_IESUFF
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
case|case
name|UNI_CAUSE_REJ_P
case|:
case|case
name|UNI_CAUSE_REJ_P
operator||
name|UNI_CAUSE_REJ_IE_P
case|:
break|break;
block|}
break|break;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_IE_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|ie
operator|.
name|len
operator|==
literal|0
operator|||
name|ie
operator|->
name|u
operator|.
name|ie
operator|.
name|len
operator|>
name|UNI_CAUSE_IE_N
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_TRAFFIC_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|traffic
operator|.
name|len
operator|==
literal|0
operator|||
name|ie
operator|->
name|u
operator|.
name|traffic
operator|.
name|len
operator|>
name|UNI_CAUSE_TRAFFIC_N
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_TNS_P
condition|)
block|{
if|if
condition|(
name|uni_check_ie
argument_list|(
name|UNI_IE_TNS
argument_list|,
operator|(
expr|union
name|uni_ieall
operator|*
operator|)
operator|&
name|ie
operator|->
name|u
operator|.
name|tns
argument_list|,
name|cx
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_NUMBER_P
condition|)
block|{
if|if
condition|(
name|uni_check_ie
argument_list|(
name|UNI_IE_CALLED
argument_list|,
operator|(
expr|union
name|uni_ieall
operator|*
operator|)
operator|&
name|ie
operator|->
name|u
operator|.
name|number
argument_list|,
name|cx
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_ATTR_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|nattr
operator|>
name|UNI_CAUSE_ATTR_N
operator|||
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|nattr
operator|==
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_PARAM_P
condition|)
block|{
name|cx
operator|=
name|cx
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|cause
argument_list|)
end_macro

begin_block
block|{
return|return
operator|(
name|check_cause
argument_list|(
name|ie
argument_list|,
name|cx
argument_list|,
name|itu_causes
argument_list|,
name|NULL
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|cause
argument_list|)
end_macro

begin_block
block|{
return|return
operator|(
name|check_cause
argument_list|(
name|ie
argument_list|,
name|cx
argument_list|,
name|net_causes
argument_list|,
name|itu_causes
argument_list|)
operator|)
return|;
block|}
end_block

begin_comment
comment|/**********************************************************************/
end_comment

begin_function
specifier|static
name|int
name|encode_cause
parameter_list|(
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|struct
name|uni_ie_cause
modifier|*
name|ie
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
name|START_IE
argument_list|(
name|cause
argument_list|,
name|UNI_IE_CAUSE
argument_list|,
literal|30
argument_list|)
expr_stmt|;
if|if
condition|(
name|IE_ISERROR
argument_list|(
operator|*
name|ie
argument_list|)
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x00
operator||
name|ie
operator|->
name|loc
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
name|ie
operator|->
name|loc
argument_list|)
expr_stmt|;
block|}
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
name|ie
operator|->
name|cause
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_COND_P
condition|)
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
operator|(
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|pu
operator|<<
literal|3
operator|)
operator||
operator|(
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|na
operator|<<
literal|2
operator|)
operator||
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|cond
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_REJ_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
operator|(
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|reason
operator|<<
literal|2
operator|)
operator||
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|cond
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_REJ_USER_P
condition|)
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|user
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_REJ_IE_P
condition|)
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|ie
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_IE_P
condition|)
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|ie
operator|.
name|ie
argument_list|,
name|ie
operator|->
name|u
operator|.
name|ie
operator|.
name|len
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_TRAFFIC_P
condition|)
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|traffic
operator|.
name|traffic
argument_list|,
name|ie
operator|->
name|u
operator|.
name|traffic
operator|.
name|len
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_VPCI_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|u
operator|.
name|vpci
operator|.
name|vpci
operator|>>
literal|8
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|u
operator|.
name|vpci
operator|.
name|vpci
operator|>>
literal|0
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|u
operator|.
name|vpci
operator|.
name|vci
operator|>>
literal|8
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|u
operator|.
name|vpci
operator|.
name|vci
operator|>>
literal|0
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_MTYPE_P
condition|)
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|mtype
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_TIMER_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|timer
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|timer
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|timer
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_TNS_P
condition|)
name|uni_encode_ie
argument_list|(
name|UNI_IE_TNS
argument_list|,
name|msg
argument_list|,
operator|(
expr|union
name|uni_ieall
operator|*
operator|)
operator|&
name|ie
operator|->
name|u
operator|.
name|tns
argument_list|,
name|cx
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_NUMBER_P
condition|)
name|uni_encode_ie
argument_list|(
name|UNI_IE_CALLED
argument_list|,
name|msg
argument_list|,
operator|(
expr|union
name|uni_ieall
operator|*
operator|)
operator|&
name|ie
operator|->
name|u
operator|.
name|number
argument_list|,
name|cx
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_ATTR_P
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|nattr
condition|;
name|i
operator|++
control|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|i
index|]
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|i
index|]
index|[
literal|0
index|]
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|i
index|]
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|i
index|]
index|[
literal|1
index|]
condition|)
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|i
index|]
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CAUSE_PARAM_P
condition|)
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|param
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|cause
argument_list|)
end_macro

begin_block
block|{
return|return
name|encode_cause
argument_list|(
name|msg
argument_list|,
name|ie
argument_list|,
name|cx
argument_list|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|cause
argument_list|)
end_macro

begin_block
block|{
return|return
name|encode_cause
argument_list|(
name|msg
argument_list|,
name|ie
argument_list|,
name|cx
argument_list|)
return|;
block|}
end_block

begin_comment
comment|/**********************************************************************/
end_comment

begin_function
specifier|static
name|int
name|decode_cause
parameter_list|(
name|struct
name|uni_ie_cause
modifier|*
name|ie
parameter_list|,
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|u_int
name|ielen
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
specifier|const
name|struct
name|causetab
modifier|*
name|tab1
parameter_list|,
specifier|const
name|struct
name|causetab
modifier|*
name|tab2
parameter_list|)
block|{
name|u_char
name|c
decl_stmt|;
specifier|const
name|struct
name|causetab
modifier|*
name|ptr
decl_stmt|;
name|enum
name|uni_ietype
name|ietype
decl_stmt|;
name|u_int
name|xielen
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|<
literal|2
operator|||
name|ielen
operator|>
literal|30
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|loc
operator|=
name|c
operator|&
literal|0xf
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|cause
operator|=
name|c
operator|&
literal|0x7f
expr_stmt|;
if|if
condition|(
name|tab1
index|[
name|ie
operator|->
name|cause
index|]
operator|.
name|str
operator|!=
name|NULL
condition|)
name|ptr
operator|=
operator|&
name|tab1
index|[
name|ie
operator|->
name|cause
index|]
expr_stmt|;
elseif|else
if|if
condition|(
name|tab2
operator|!=
name|NULL
operator|&&
name|tab2
index|[
name|ie
operator|->
name|cause
index|]
operator|.
name|str
operator|!=
name|NULL
condition|)
name|ptr
operator|=
operator|&
name|tab2
index|[
name|ie
operator|->
name|cause
index|]
expr_stmt|;
else|else
block|{
name|ptr
operator|=
name|NULL
expr_stmt|;
name|ielen
operator|=
literal|0
expr_stmt|;
comment|/* ignore diags */
block|}
if|if
condition|(
name|ielen
condition|)
block|{
switch|switch
condition|(
name|ptr
operator|->
name|diag
condition|)
block|{
case|case
name|UNI_DIAG_NONE
case|:
break|break;
case|case
name|UNI_DIAG_COND
case|:
if|if
condition|(
name|ielen
operator|<
literal|1
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_COND_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|pu
operator|=
operator|(
name|c
operator|>>
literal|3
operator|)
operator|&
literal|1
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|na
operator|=
operator|(
name|c
operator|>>
literal|2
operator|)
operator|&
literal|1
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|cond
operator|.
name|cond
operator|=
name|c
operator|&
literal|3
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
break|break;
case|case
name|UNI_DIAG_REJ
case|:
if|if
condition|(
name|ielen
operator|<
literal|1
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_REJ_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|reason
operator|=
operator|(
name|c
operator|>>
literal|2
operator|)
operator|&
literal|0x1f
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|cond
operator|=
name|c
operator|&
literal|3
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
if|if
condition|(
name|ielen
operator|>
literal|0
condition|)
block|{
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|reason
condition|)
block|{
case|case
name|UNI_CAUSE_REASON_USER
case|:
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_REJ_USER_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|user
operator|=
name|c
expr_stmt|;
break|break;
case|case
name|UNI_CAUSE_REASON_IEMISS
case|:
case|case
name|UNI_CAUSE_REASON_IESUFF
case|:
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_REJ_IE_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|rej
operator|.
name|ie
operator|=
name|c
expr_stmt|;
break|break;
block|}
block|}
break|break;
case|case
name|UNI_DIAG_CRATE
case|:
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_TRAFFIC_P
expr_stmt|;
while|while
condition|(
name|ielen
operator|&&
name|ie
operator|->
name|u
operator|.
name|traffic
operator|.
name|len
operator|<
name|UNI_CAUSE_TRAFFIC_N
condition|)
block|{
name|ie
operator|->
name|u
operator|.
name|traffic
operator|.
name|traffic
index|[
name|ie
operator|->
name|u
operator|.
name|traffic
operator|.
name|len
operator|++
index|]
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
block|}
break|break;
case|case
name|UNI_DIAG_IE
case|:
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_IE_P
expr_stmt|;
while|while
condition|(
name|ielen
operator|&&
name|ie
operator|->
name|u
operator|.
name|ie
operator|.
name|len
operator|<
name|UNI_CAUSE_IE_N
condition|)
block|{
name|ie
operator|->
name|u
operator|.
name|ie
operator|.
name|ie
index|[
name|ie
operator|->
name|u
operator|.
name|ie
operator|.
name|len
operator|++
index|]
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
block|}
break|break;
case|case
name|UNI_DIAG_CHANID
case|:
if|if
condition|(
name|ielen
operator|<
literal|4
condition|)
break|break;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_VPCI_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|vpci
operator|.
name|vpci
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|vpci
operator|.
name|vpci
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|vpci
operator|.
name|vci
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|vpci
operator|.
name|vci
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|-=
literal|4
expr_stmt|;
break|break;
case|case
name|UNI_DIAG_MTYPE
case|:
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_MTYPE_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|mtype
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
break|break;
case|case
name|UNI_DIAG_TIMER
case|:
if|if
condition|(
name|ielen
operator|<
literal|3
condition|)
break|break;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_TIMER_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|timer
index|[
literal|0
index|]
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|timer
index|[
literal|1
index|]
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|timer
index|[
literal|2
index|]
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|-=
literal|3
expr_stmt|;
break|break;
case|case
name|UNI_DIAG_TNS
case|:
if|if
condition|(
name|ielen
operator|<
literal|4
condition|)
break|break;
if|if
condition|(
name|uni_decode_ie_hdr
argument_list|(
operator|&
name|ietype
argument_list|,
operator|&
name|ie
operator|->
name|u
operator|.
name|tns
operator|.
name|h
argument_list|,
name|msg
argument_list|,
name|cx
argument_list|,
operator|&
name|xielen
argument_list|)
condition|)
break|break;
if|if
condition|(
name|ietype
operator|!=
name|UNI_IE_TNS
condition|)
break|break;
if|if
condition|(
name|uni_decode_ie_body
argument_list|(
name|ietype
argument_list|,
operator|(
expr|union
name|uni_ieall
operator|*
operator|)
operator|&
name|ie
operator|->
name|u
operator|.
name|tns
argument_list|,
name|msg
argument_list|,
name|xielen
argument_list|,
name|cx
argument_list|)
condition|)
break|break;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_TNS_P
expr_stmt|;
break|break;
case|case
name|UNI_DIAG_NUMBER
case|:
if|if
condition|(
name|ielen
operator|<
literal|4
condition|)
break|break;
if|if
condition|(
name|uni_decode_ie_hdr
argument_list|(
operator|&
name|ietype
argument_list|,
operator|&
name|ie
operator|->
name|u
operator|.
name|number
operator|.
name|h
argument_list|,
name|msg
argument_list|,
name|cx
argument_list|,
operator|&
name|xielen
argument_list|)
condition|)
break|break;
if|if
condition|(
name|ietype
operator|!=
name|UNI_IE_CALLED
condition|)
break|break;
if|if
condition|(
name|uni_decode_ie_body
argument_list|(
name|ietype
argument_list|,
operator|(
expr|union
name|uni_ieall
operator|*
operator|)
operator|&
name|ie
operator|->
name|u
operator|.
name|number
argument_list|,
name|msg
argument_list|,
name|xielen
argument_list|,
name|cx
argument_list|)
condition|)
break|break;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_NUMBER_P
expr_stmt|;
break|break;
case|case
name|UNI_DIAG_ATTR
case|:
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_ATTR_P
expr_stmt|;
while|while
condition|(
name|ielen
operator|>
literal|0
operator|&&
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|nattr
operator|<
name|UNI_CAUSE_ATTR_N
condition|)
block|{
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|nattr
index|]
index|[
literal|0
index|]
operator|=
name|c
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|0
operator|&&
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
block|{
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|nattr
index|]
index|[
literal|1
index|]
operator|=
name|c
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|0
operator|&&
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
block|{
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|attr
index|[
name|ie
operator|->
name|u
operator|.
name|attr
operator|.
name|nattr
index|]
index|[
literal|2
index|]
operator|=
name|c
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
block|}
block|}
block|}
break|break;
case|case
name|UNI_DIAG_PARAM
case|:
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CAUSE_PARAM_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|param
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
break|break;
block|}
block|}
name|IE_END
argument_list|(
name|CAUSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|cause
argument_list|)
end_macro

begin_block
block|{
return|return
name|decode_cause
argument_list|(
name|ie
argument_list|,
name|msg
argument_list|,
name|ielen
argument_list|,
name|cx
argument_list|,
name|itu_causes
argument_list|,
name|NULL
argument_list|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|cause
argument_list|)
end_macro

begin_block
block|{
return|return
name|decode_cause
argument_list|(
name|ie
argument_list|,
name|msg
argument_list|,
name|ielen
argument_list|,
name|cx
argument_list|,
name|net_causes
argument_list|,
name|itu_causes
argument_list|)
return|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Callstate  *  * References for this IE are:  *  *  Q.2931 pp. 59...60  *  UNI4.0 pp. 14  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|callstate
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_CALLSTATE_U0
argument_list|,
name|U0
operator|/
name|N0
operator|/
name|REST0
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U1
argument_list|,
name|U1
operator|/
name|N1
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U3
argument_list|,
name|U3
operator|/
name|N3
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U4
argument_list|,
name|U4
operator|/
name|N4
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U6
argument_list|,
name|U6
operator|/
name|N6
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U7
argument_list|,
name|U7
operator|/
name|N7
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U8
argument_list|,
name|U8
operator|/
name|N8
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U9
argument_list|,
name|U9
operator|/
name|N9
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U10
argument_list|,
name|U10
operator|/
name|N10
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U11
argument_list|,
name|U11
operator|/
name|N11
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U12
argument_list|,
name|U12
operator|/
name|N12
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_REST1
argument_list|,
name|REST1
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_REST2
argument_list|,
name|REST2
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U13
argument_list|,
name|U13
operator|/
name|N13
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CALLSTATE_U14
argument_list|,
name|U14
operator|/
name|N14
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"callstate"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"state"
argument_list|,
name|ie
operator|->
name|state
argument_list|,
name|tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|callstate
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|state
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_CALLSTATE_U0
case|:
case|case
name|UNI_CALLSTATE_U1
case|:
case|case
name|UNI_CALLSTATE_U3
case|:
case|case
name|UNI_CALLSTATE_U4
case|:
case|case
name|UNI_CALLSTATE_U6
case|:
case|case
name|UNI_CALLSTATE_U7
case|:
case|case
name|UNI_CALLSTATE_U8
case|:
case|case
name|UNI_CALLSTATE_U9
case|:
case|case
name|UNI_CALLSTATE_U10
case|:
case|case
name|UNI_CALLSTATE_U11
case|:
case|case
name|UNI_CALLSTATE_U12
case|:
case|case
name|UNI_CALLSTATE_REST1
case|:
case|case
name|UNI_CALLSTATE_REST2
case|:
case|case
name|UNI_CALLSTATE_U13
case|:
case|case
name|UNI_CALLSTATE_U14
case|:
break|break;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|callstate
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|callstate
argument_list|,
name|UNI_IE_CALLSTATE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|state
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|callstate
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|state
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|&
literal|0x3f
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
name|IE_END
argument_list|(
name|CALLSTATE
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Facility Information.  *  * References for this IE are:  *  *  Q.2932.1  *  * The standard allows only ROSE as protocol. We allow everything up to the  * maximum size.  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|facility
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"facility"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
if|if
condition|(
name|ie
operator|->
name|proto
operator|==
name|UNI_FACILITY_ROSE
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"proto"
argument_list|,
literal|"rose"
argument_list|)
expr_stmt|;
else|else
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"proto"
argument_list|,
literal|"0x%02x"
argument_list|,
name|ie
operator|->
name|proto
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"len"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"info"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|len
condition|;
name|i
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s0x%02x"
argument_list|,
name|i
operator|==
literal|0
condition|?
literal|""
else|:
literal|" "
argument_list|,
name|ie
operator|->
name|apdu
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|facility
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|len
operator|>
name|UNI_FACILITY_MAXAPDU
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|facility
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|facility
argument_list|,
name|UNI_IE_FACILITY
argument_list|,
literal|1
operator|+
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|proto
operator||
literal|0x80
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|apdu
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|facility
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
name|UNI_FACILITY_MAXAPDU
operator|+
literal|1
operator|||
name|ielen
operator|<
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|proto
operator|=
operator|(
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|)
operator|&
literal|0x1f
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|&
literal|0xe0
operator|)
operator|!=
literal|0x80
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|len
operator|=
name|ielen
expr_stmt|;
name|ielen
operator|=
literal|0
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|ie
operator|->
name|apdu
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
name|ie
operator|->
name|len
expr_stmt|;
name|IE_END
argument_list|(
name|FACILITY
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Notification Indicator  *  * References for this IE are:  *  *  Q.2931 p.  76  *  UNI4.0 p.  17  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|notify
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"notify"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"len"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"info"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|len
condition|;
name|i
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s0x%02x"
argument_list|,
name|i
operator|==
literal|0
condition|?
literal|""
else|:
literal|" "
argument_list|,
name|ie
operator|->
name|notify
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|notify
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|len
operator|>
name|UNI_NOTIFY_MAXLEN
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|notify
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|notify
argument_list|,
name|UNI_IE_NOTIFY
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|notify
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|IE_ISERROR
argument_list|(
operator|*
name|ie
argument_list|)
condition|)
block|{
comment|/* make it too long */
name|u_int
name|i
init|=
name|ie
operator|->
name|len
decl_stmt|;
while|while
condition|(
name|i
operator|<
name|UNI_NOTIFY_MAXLEN
operator|+
literal|1
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
block|}
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|notify
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
name|UNI_NOTIFY_MAXLEN
operator|||
name|ielen
operator|<
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|len
operator|=
name|ielen
expr_stmt|;
name|ielen
operator|=
literal|0
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|ie
operator|->
name|notify
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
name|ie
operator|->
name|len
expr_stmt|;
name|IE_END
argument_list|(
name|NOTIFY
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * End-to-end transit delay.  *  * References for this IE are:  *  *  Q.2931 pp. 70...71  *  UNI4.0 pp. 69...70  *  PNNI1.0 pp. 198...200  *  * Not clear, whether the new indicator should be used with NET coding or  * not.  *  * Only ITU-T coding allowed.  */
end_comment

begin_function
specifier|static
name|void
name|print_eetd
parameter_list|(
name|struct
name|uni_ie_eetd
modifier|*
name|ie
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
parameter_list|)
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"eetd"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_CUM_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"cum"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|cumulative
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_MAX_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|maximum
operator|==
name|UNI_EETD_ANYMAX
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"max"
argument_list|,
literal|"any"
argument_list|)
expr_stmt|;
else|else
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"max"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|maximum
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_PCTD_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"pnni_cum"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|pctd
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_PMTD_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"pnni_max"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|pmtd
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_NET_P
condition|)
name|uni_print_flag
argument_list|(
literal|"netgen"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|eetd
argument_list|)
end_macro

begin_block
block|{
name|print_eetd
argument_list|(
name|ie
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|eetd
argument_list|)
end_macro

begin_block
block|{
name|print_eetd
argument_list|(
name|ie
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|eetd
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_CUM_P
operator|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
operator|(
name|UNI_EETD_PMTD_P
operator||
name|UNI_EETD_PCTD_P
operator|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|eetd
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
operator|!
name|cx
operator|->
name|pnni
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_CUM_P
operator|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
operator|(
name|UNI_EETD_PMTD_P
operator||
name|UNI_EETD_PCTD_P
operator|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
else|else
block|{
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_MAX_P
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_CUM_P
operator|)
operator|&&
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_PCTD_P
operator|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|eetd
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|eetd
argument_list|,
name|UNI_IE_EETD
argument_list|,
literal|9
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_CUM_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|UNI_EETD_CTD_ID
argument_list|)
expr_stmt|;
name|APP_16BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|cumulative
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_MAX_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|UNI_EETD_MTD_ID
argument_list|)
expr_stmt|;
name|APP_16BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|maximum
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_PMTD_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|UNI_EETD_PMTD_ID
argument_list|)
expr_stmt|;
name|APP_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|pmtd
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_PCTD_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|UNI_EETD_PCTD_ID
argument_list|)
expr_stmt|;
name|APP_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|pctd
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EETD_NET_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|UNI_EETD_NET_ID
argument_list|)
expr_stmt|;
block|}
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|eetd
argument_list|)
end_macro

begin_block
block|{
return|return
operator|(
name|uni_ie_encode_itu_eetd
argument_list|(
name|msg
argument_list|,
name|ie
argument_list|,
name|cx
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|eetd
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
while|while
condition|(
name|ielen
operator|>
literal|0
condition|)
block|{
switch|switch
condition|(
name|ielen
operator|--
operator|,
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
case|case
name|UNI_EETD_CTD_ID
case|:
if|if
condition|(
name|ielen
operator|<
literal|2
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_EETD_CUM_P
expr_stmt|;
name|ie
operator|->
name|cumulative
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|cumulative
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|-=
literal|2
expr_stmt|;
break|break;
case|case
name|UNI_EETD_MTD_ID
case|:
if|if
condition|(
name|ielen
operator|<
literal|2
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_EETD_MAX_P
expr_stmt|;
name|ie
operator|->
name|maximum
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|maximum
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|-=
literal|2
expr_stmt|;
break|break;
case|case
name|UNI_EETD_PCTD_ID
case|:
if|if
condition|(
name|ielen
operator|<
literal|3
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_EETD_PCTD_P
expr_stmt|;
name|ie
operator|->
name|pctd
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|ie
operator|->
name|pctd
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|pctd
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|-=
literal|3
expr_stmt|;
break|break;
case|case
name|UNI_EETD_PMTD_ID
case|:
if|if
condition|(
name|ielen
operator|<
literal|3
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_EETD_PMTD_P
expr_stmt|;
name|ie
operator|->
name|pmtd
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|ie
operator|->
name|pmtd
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|pmtd
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|-=
literal|3
expr_stmt|;
break|break;
case|case
name|UNI_EETD_NET_ID
case|:
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_EETD_NET_P
expr_stmt|;
break|break;
default|default:
goto|goto
name|rej
goto|;
block|}
block|}
name|IE_END
argument_list|(
name|EETD
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|eetd
argument_list|)
end_macro

begin_block
block|{
return|return
operator|(
name|uni_ie_decode_itu_eetd
argument_list|(
name|ie
argument_list|,
name|msg
argument_list|,
name|ielen
argument_list|,
name|cx
argument_list|)
operator|)
return|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Called address  * Called subaddress  * Calling address  * Calling subaddress  * Connected address  * Connected subaddress  *  * References for this IE are:  *  *  Q.2931 pp. 60...68  *  ...A4  pp. 27...36  *  UNI4.0 pp. 14...15  *  Q.2951 pp. 28...40  *  * It is assumed, that the coding of the addr arrays is ok.  *  * Only ITU-T coding allowed.  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|screen_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_ADDR_SCREEN_NOT
argument_list|,
name|no
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_SCREEN_PASSED
argument_list|,
name|passed
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_SCREEN_FAILED
argument_list|,
name|failed
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_SCREEN_NET
argument_list|,
name|network
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|pres_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_ADDR_PRES
argument_list|,
name|allowed
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_RESTRICT
argument_list|,
name|restricted
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_NONUMBER
argument_list|,
name|no
operator|-
name|number
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|print_addr
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
name|struct
name|uni_addr
modifier|*
name|addr
parameter_list|)
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|plan_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_ADDR_UNKNOWN
argument_list|,
name|unknown
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_E164
argument_list|,
name|E164
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_ATME
argument_list|,
name|ATME
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_DATA
argument_list|,
name|data
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_PRIVATE
argument_list|,
name|private
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|type_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_ADDR_UNKNOWN
argument_list|,
name|unknown
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_INTERNATIONAL
argument_list|,
name|international
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_NATIONAL
argument_list|,
name|national
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_NETWORK
argument_list|,
name|network
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_SUBSCR
argument_list|,
name|subscriber
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_ADDR_ABBR
argument_list|,
name|abbreviated
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
name|u_int
name|i
decl_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"addr"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
name|NULL
argument_list|,
name|addr
operator|->
name|type
argument_list|,
name|type_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
name|NULL
argument_list|,
name|addr
operator|->
name|plan
argument_list|,
name|plan_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|addr
operator|->
name|plan
operator|==
name|UNI_ADDR_E164
condition|)
block|{
name|uni_putc
argument_list|(
literal|'"'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|addr
operator|->
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|addr
operator|->
name|addr
index|[
name|i
index|]
operator|<
literal|' '
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"^%c"
argument_list|,
name|addr
operator|->
name|addr
index|[
name|i
index|]
operator|+
literal|'@'
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|addr
operator|->
name|addr
index|[
name|i
index|]
operator|<=
literal|'~'
condition|)
name|uni_putc
argument_list|(
name|addr
operator|->
name|addr
index|[
name|i
index|]
argument_list|,
name|cx
argument_list|)
expr_stmt|;
else|else
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"\\%03o"
argument_list|,
name|addr
operator|->
name|addr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|uni_putc
argument_list|(
literal|'"'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|addr
operator|->
name|plan
operator|==
name|UNI_ADDR_ATME
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|addr
operator|->
name|len
condition|;
name|i
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%02x"
argument_list|,
name|addr
operator|->
name|addr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_addrsub
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
name|struct
name|uni_subaddr
modifier|*
name|addr
parameter_list|)
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|type_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_SUBADDR_NSAP
argument_list|,
name|NSAP
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_SUBADDR_ATME
argument_list|,
name|ATME
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_SUBADDR_USER
argument_list|,
name|USER
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
name|u_int
name|i
decl_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"addr"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
name|NULL
argument_list|,
name|addr
operator|->
name|type
argument_list|,
name|type_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|addr
operator|->
name|len
condition|;
name|i
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%02x"
argument_list|,
name|addr
operator|->
name|addr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|check_addr
parameter_list|(
name|struct
name|uni_addr
modifier|*
name|addr
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
switch|switch
condition|(
name|addr
operator|->
name|plan
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_ADDR_E164
case|:
if|if
condition|(
name|addr
operator|->
name|type
operator|!=
name|UNI_ADDR_INTERNATIONAL
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|addr
operator|->
name|len
operator|>
literal|15
operator|||
name|addr
operator|->
name|len
operator|==
literal|0
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|addr
operator|->
name|len
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|addr
operator|->
name|addr
index|[
name|i
index|]
operator|==
literal|0
operator|||
operator|(
name|addr
operator|->
name|addr
index|[
name|i
index|]
operator|&
literal|0x80
operator|)
condition|)
return|return
operator|-
literal|1
return|;
break|break;
case|case
name|UNI_ADDR_ATME
case|:
if|if
condition|(
name|addr
operator|->
name|type
operator|!=
name|UNI_ADDR_UNKNOWN
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|addr
operator|->
name|len
operator|!=
literal|20
condition|)
return|return
operator|-
literal|1
return|;
break|break;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|check_subaddr
parameter_list|(
name|struct
name|uni_subaddr
modifier|*
name|addr
parameter_list|)
block|{
switch|switch
condition|(
name|addr
operator|->
name|type
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_SUBADDR_NSAP
case|:
if|if
condition|(
name|addr
operator|->
name|len
operator|!=
literal|20
condition|)
return|return
operator|-
literal|1
return|;
break|break;
case|case
name|UNI_SUBADDR_ATME
case|:
if|if
condition|(
name|addr
operator|->
name|len
operator|>
literal|20
condition|)
return|return
operator|-
literal|1
return|;
break|break;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|check_screen
parameter_list|(
name|enum
name|uni_addr_screen
name|screen
parameter_list|,
name|enum
name|uni_addr_pres
name|pres
parameter_list|)
block|{
switch|switch
condition|(
name|pres
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_ADDR_PRES
case|:
case|case
name|UNI_ADDR_RESTRICT
case|:
case|case
name|UNI_ADDR_NONUMBER
case|:
break|break;
block|}
switch|switch
condition|(
name|screen
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_ADDR_SCREEN_NOT
case|:
case|case
name|UNI_ADDR_SCREEN_PASSED
case|:
case|case
name|UNI_ADDR_SCREEN_FAILED
case|:
case|case
name|UNI_ADDR_SCREEN_NET
case|:
break|break;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|encode_addr
parameter_list|(
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|struct
name|uni_addr
modifier|*
name|addr
parameter_list|,
name|u_int
name|flag
parameter_list|,
name|enum
name|uni_addr_screen
name|screen
parameter_list|,
name|enum
name|uni_addr_pres
name|pres
parameter_list|,
name|int
name|err
parameter_list|)
block|{
name|u_char
name|ext
init|=
name|err
condition|?
literal|0x00
else|:
literal|0x80
decl_stmt|;
if|if
condition|(
name|flag
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|addr
operator|->
name|type
operator|<<
literal|4
operator|)
operator||
name|addr
operator|->
name|plan
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ext
operator||
operator|(
name|pres
operator|<<
literal|5
operator|)
operator||
operator|(
name|screen
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ext
operator||
operator|(
name|addr
operator|->
name|type
operator|<<
literal|4
operator|)
operator||
name|addr
operator|->
name|plan
argument_list|)
expr_stmt|;
block|}
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|addr
operator|->
name|addr
argument_list|,
name|addr
operator|->
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|encode_subaddr
parameter_list|(
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|struct
name|uni_subaddr
modifier|*
name|addr
parameter_list|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
operator|(
name|addr
operator|->
name|type
operator|<<
literal|4
operator|)
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|addr
operator|->
name|addr
argument_list|,
name|addr
operator|->
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|decode_addr
parameter_list|(
name|struct
name|uni_addr
modifier|*
name|addr
parameter_list|,
name|u_int
name|ielen
parameter_list|,
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|u_int
name|plan
parameter_list|)
block|{
name|addr
operator|->
name|plan
operator|=
name|plan
operator|&
literal|0xf
expr_stmt|;
name|addr
operator|->
name|type
operator|=
operator|(
name|plan
operator|>>
literal|4
operator|)
operator|&
literal|0x7
expr_stmt|;
switch|switch
condition|(
name|addr
operator|->
name|plan
condition|)
block|{
case|case
name|UNI_ADDR_E164
case|:
if|if
condition|(
name|ielen
operator|>
literal|15
operator|||
name|ielen
operator|==
literal|0
condition|)
return|return
operator|-
literal|1
return|;
name|addr
operator|->
name|addr
index|[
name|ielen
index|]
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|UNI_ADDR_ATME
case|:
if|if
condition|(
name|ielen
operator|!=
literal|20
condition|)
return|return
operator|-
literal|1
return|;
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|addr
operator|->
name|addr
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
name|ielen
argument_list|)
expr_stmt|;
name|addr
operator|->
name|len
operator|=
name|ielen
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
name|ielen
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|decode_subaddr
parameter_list|(
name|struct
name|uni_subaddr
modifier|*
name|addr
parameter_list|,
name|u_int
name|ielen
parameter_list|,
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|u_int
name|type
parameter_list|)
block|{
switch|switch
condition|(
name|addr
operator|->
name|type
operator|=
operator|(
name|type
operator|>>
literal|4
operator|)
operator|&
literal|0x7
condition|)
block|{
case|case
name|UNI_SUBADDR_NSAP
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
operator|||
name|ielen
operator|>
literal|20
condition|)
return|return
operator|-
literal|1
return|;
break|break;
case|case
name|UNI_SUBADDR_ATME
case|:
if|if
condition|(
name|ielen
operator|!=
literal|20
condition|)
return|return
operator|-
literal|1
return|;
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|type
operator|&
literal|0x80
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|(
name|type
operator|&
literal|0x7
operator|)
operator|!=
literal|0
condition|)
return|return
operator|-
literal|1
return|;
name|addr
operator|->
name|len
operator|=
name|ielen
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|addr
operator|->
name|addr
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
name|ielen
argument_list|)
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
name|ielen
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/**********************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|called
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"called"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|print_addr
argument_list|(
name|cx
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|called
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|check_addr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|called
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|called
argument_list|,
name|UNI_IE_CALLED
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|encode_addr
argument_list|(
name|msg
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|IE_ISERROR
argument_list|(
operator|*
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|called
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|21
operator|||
name|ielen
operator|<
literal|1
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
if|if
condition|(
name|decode_addr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|,
name|ielen
argument_list|,
name|msg
argument_list|,
name|c
argument_list|)
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|CALLED
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/**********************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|calledsub
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"calledsub"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|print_addrsub
argument_list|(
name|cx
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|calledsub
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|check_subaddr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|calledsub
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|calledsub
argument_list|,
name|UNI_IE_CALLEDSUB
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|encode_subaddr
argument_list|(
name|msg
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|calledsub
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|21
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
name|decode_subaddr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|,
name|ielen
argument_list|,
name|msg
argument_list|,
name|c
argument_list|)
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|CALLEDSUB
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/**********************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|calling
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"calling"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|print_addr
argument_list|(
name|cx
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLING_SCREEN_P
condition|)
block|{
name|uni_print_tbl
argument_list|(
literal|"screening"
argument_list|,
name|ie
operator|->
name|screen
argument_list|,
name|screen_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"presentation"
argument_list|,
name|ie
operator|->
name|pres
argument_list|,
name|pres_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|calling
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|check_addr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLING_SCREEN_P
condition|)
if|if
condition|(
name|check_screen
argument_list|(
name|ie
operator|->
name|screen
argument_list|,
name|ie
operator|->
name|pres
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|calling
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|calling
argument_list|,
name|UNI_IE_CALLING
argument_list|,
literal|22
argument_list|)
expr_stmt|;
name|encode_addr
argument_list|(
name|msg
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLING_SCREEN_P
argument_list|,
name|ie
operator|->
name|screen
argument_list|,
name|ie
operator|->
name|pres
argument_list|,
name|IE_ISERROR
argument_list|(
operator|*
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|calling
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|,
name|plan
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|22
operator|||
name|ielen
operator|<
literal|1
condition|)
goto|goto
name|rej
goto|;
name|plan
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|plan
operator|&
literal|0x80
operator|)
condition|)
block|{
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CALLING_SCREEN_P
expr_stmt|;
name|ie
operator|->
name|pres
operator|=
operator|(
name|c
operator|>>
literal|5
operator|)
operator|&
literal|0x3
expr_stmt|;
name|ie
operator|->
name|screen
operator|=
name|c
operator|&
literal|0x3
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
block|}
if|if
condition|(
name|decode_addr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|,
name|ielen
argument_list|,
name|msg
argument_list|,
name|plan
argument_list|)
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|CALLING
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/**********************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|callingsub
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"callingsub"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|print_addrsub
argument_list|(
name|cx
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|callingsub
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|check_subaddr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|callingsub
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|callingsub
argument_list|,
name|UNI_IE_CALLINGSUB
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|encode_subaddr
argument_list|(
name|msg
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|callingsub
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|21
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
name|decode_subaddr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|,
name|ielen
argument_list|,
name|msg
argument_list|,
name|c
argument_list|)
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|CALLINGSUB
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/**********************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|conned
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"conned"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|print_addr
argument_list|(
name|cx
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CONNED_SCREEN_P
condition|)
block|{
name|uni_print_tbl
argument_list|(
literal|"screening"
argument_list|,
name|ie
operator|->
name|screen
argument_list|,
name|screen_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"presentation"
argument_list|,
name|ie
operator|->
name|pres
argument_list|,
name|pres_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|conned
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|check_addr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CONNED_SCREEN_P
condition|)
if|if
condition|(
name|check_screen
argument_list|(
name|ie
operator|->
name|screen
argument_list|,
name|ie
operator|->
name|pres
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|conned
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|conned
argument_list|,
name|UNI_IE_CONNED
argument_list|,
literal|22
argument_list|)
expr_stmt|;
name|encode_addr
argument_list|(
name|msg
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CONNED_SCREEN_P
argument_list|,
name|ie
operator|->
name|screen
argument_list|,
name|ie
operator|->
name|pres
argument_list|,
name|IE_ISERROR
argument_list|(
operator|*
name|ie
argument_list|)
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|conned
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|,
name|plan
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|22
operator|||
name|ielen
operator|<
literal|1
condition|)
goto|goto
name|rej
goto|;
name|plan
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|plan
operator|&
literal|0x80
operator|)
condition|)
block|{
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CONNED_SCREEN_P
expr_stmt|;
name|ie
operator|->
name|pres
operator|=
operator|(
name|c
operator|>>
literal|5
operator|)
operator|&
literal|0x3
expr_stmt|;
name|ie
operator|->
name|screen
operator|=
name|c
operator|&
literal|0x3
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
block|}
if|if
condition|(
name|decode_addr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|,
name|ielen
argument_list|,
name|msg
argument_list|,
name|plan
argument_list|)
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|CONNED
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/**********************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|connedsub
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"connedsub"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|print_addrsub
argument_list|(
name|cx
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|connedsub
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|check_subaddr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|connedsub
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|connedsub
argument_list|,
name|UNI_IE_CONNEDSUB
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|encode_subaddr
argument_list|(
name|msg
argument_list|,
operator|&
name|ie
operator|->
name|addr
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|connedsub
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|21
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
name|decode_subaddr
argument_list|(
operator|&
name|ie
operator|->
name|addr
argument_list|,
name|ielen
argument_list|,
name|msg
argument_list|,
name|c
argument_list|)
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|CONNEDSUB
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Endpoint reference.  *  * References for this IE are:  *  *  Q.2971 p.  14  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|epref
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"epref"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"epref"
argument_list|,
literal|"(%u,%u)"
argument_list|,
name|ie
operator|->
name|flag
argument_list|,
name|ie
operator|->
name|epref
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|epref
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|epref
operator|>=
operator|(
literal|2
operator|<<
literal|15
operator|)
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|epref
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|epref
argument_list|,
name|UNI_IE_EPREF
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|IE_ISERROR
argument_list|(
operator|*
name|ie
argument_list|)
condition|)
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0xff
argument_list|)
expr_stmt|;
else|else
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|flag
operator|<<
literal|7
operator|)
operator||
operator|(
operator|(
name|ie
operator|->
name|epref
operator|>>
literal|8
operator|)
operator|&
literal|0x7f
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|epref
operator|&
literal|0xff
operator|)
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|epref
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|3
condition|)
goto|goto
name|rej
goto|;
if|if
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|!=
literal|0
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|flag
operator|=
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
name|ie
operator|->
name|epref
operator|=
operator|(
name|c
operator|&
literal|0x7f
operator|)
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|epref
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|IE_END
argument_list|(
name|EPREF
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Endpoint state.  *  * References for this IE are:  *  *  Q.2971 pp. 14...15  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|epstate
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_EPSTATE_NULL
argument_list|,
name|null
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_EPSTATE_ADD_INIT
argument_list|,
name|add
operator|-
name|initiated
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_EPSTATE_ALERT_DLVD
argument_list|,
name|alerting
operator|-
name|delivered
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_EPSTATE_ADD_RCVD
argument_list|,
name|add
operator|-
name|received
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_EPSTATE_ALERT_RCVD
argument_list|,
name|alerting
operator|-
name|received
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_EPSTATE_ACTIVE
argument_list|,
name|active
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_EPSTATE_DROP_INIT
argument_list|,
name|drop
operator|-
name|initiated
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_EPSTATE_DROP_RCVD
argument_list|,
name|drop
operator|-
name|received
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"epstate"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"state"
argument_list|,
name|ie
operator|->
name|state
argument_list|,
name|tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|epstate
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|state
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_EPSTATE_NULL
case|:
case|case
name|UNI_EPSTATE_ADD_INIT
case|:
case|case
name|UNI_EPSTATE_ALERT_DLVD
case|:
case|case
name|UNI_EPSTATE_ADD_RCVD
case|:
case|case
name|UNI_EPSTATE_ALERT_RCVD
case|:
case|case
name|UNI_EPSTATE_DROP_INIT
case|:
case|case
name|UNI_EPSTATE_DROP_RCVD
case|:
case|case
name|UNI_EPSTATE_ACTIVE
case|:
break|break;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|epstate
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|epstate
argument_list|,
name|UNI_IE_EPSTATE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|state
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|epstate
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|state
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|&
literal|0x3f
expr_stmt|;
name|IE_END
argument_list|(
name|EPSTATE
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * ATM adaptation layer parameters  *  * References for this IE are:  *  *  Q.2931 pp. 43...49  *  Q.2931 Amd 2  *  UNI4.0 p.  9  *  * UNI4.0 states, that AAL2 is not supported. However we keep it. No  * parameters are associated with AAL2.  *  * Amd2 not checked. XXX  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|aal
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|aal_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_AAL_0
argument_list|,
name|VOICE
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL_1
argument_list|,
literal|1
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL_2
argument_list|,
literal|2
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL_4
argument_list|,
literal|3
operator|/
literal|4
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL_5
argument_list|,
literal|5
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL_USER
argument_list|,
name|USER
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|subtype_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_AAL1_SUB_NULL
argument_list|,
name|null
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_SUB_VOICE
argument_list|,
name|voice
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_SUB_CIRCUIT
argument_list|,
name|circuit
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_SUB_HQAUDIO
argument_list|,
name|hqaudio
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_SUB_VIDEO
argument_list|,
name|video
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|cbr_rate_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_AAL1_CBR_64
argument_list|,
literal|64
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_CBR_1544
argument_list|,
literal|1544
operator|(
name|DS1
operator|)
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_CBR_6312
argument_list|,
literal|6312
operator|(
name|DS2
operator|)
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_CBR_32064
argument_list|,
literal|32064
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_CBR_44736
argument_list|,
literal|44736
operator|(
name|DS3
operator|)
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_CBR_97728
argument_list|,
literal|97728
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_CBR_2048
argument_list|,
literal|2048
operator|(
name|E1
operator|)
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_CBR_8448
argument_list|,
literal|8448
operator|(
name|E2
operator|)
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_CBR_34368
argument_list|,
literal|34368
operator|(
name|E3
operator|)
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_CBR_139264
argument_list|,
literal|139264
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_CBR_N64
argument_list|,
name|Nx64
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_CBR_N8
argument_list|,
name|Nx8
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|screc_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_AAL1_SCREC_NULL
argument_list|,
name|null
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_SCREC_SRTS
argument_list|,
name|srts
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_SCREC_ACLK
argument_list|,
name|aclk
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|ecm_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_AAL1_ECM_NULL
argument_list|,
name|null
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_ECM_LOSS
argument_list|,
name|loss
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL1_ECM_DELAY
argument_list|,
name|delay
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|sscs_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_AAL_SSCS_NULL
argument_list|,
name|null
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL_SSCS_SSCOPA
argument_list|,
name|sscopa
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL_SSCS_SSCOPU
argument_list|,
name|sscopu
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_AAL_SSCS_FRAME
argument_list|,
name|frame
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"aal"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"type"
argument_list|,
name|ie
operator|->
name|type
argument_list|,
name|aal_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|type
condition|)
block|{
case|case
name|UNI_AAL_0
case|:
name|uni_print_push_prefix
argument_list|(
literal|"0"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_2
case|:
name|uni_print_push_prefix
argument_list|(
literal|"2"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_1
case|:
name|uni_print_push_prefix
argument_list|(
literal|"1"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"subtype"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|subtype
argument_list|,
name|subtype_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"cbr_rate"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|cbr_rate
argument_list|,
name|cbr_rate_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_MULT_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"mult"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|mult
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_SCREC_P
condition|)
name|uni_print_tbl
argument_list|(
literal|"screc"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|screc
argument_list|,
name|screc_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_ECM_P
condition|)
name|uni_print_tbl
argument_list|(
literal|"ecm"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|ecm
argument_list|,
name|ecm_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_BSIZE_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"bsize"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|bsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_PART_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"part"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|part
argument_list|)
expr_stmt|;
break|break;
case|case
name|UNI_AAL_4
case|:
name|uni_print_push_prefix
argument_list|(
literal|"4"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL4_CPCS_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"cpcs"
argument_list|,
literal|"(%u,%u)"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|fwd_cpcs
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|bwd_cpcs
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL4_MID_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"mid"
argument_list|,
literal|"(%u,%u)"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_low
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_high
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL4_SSCS_P
condition|)
name|uni_print_tbl
argument_list|(
literal|"sscs"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|sscs
argument_list|,
name|sscs_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
break|break;
case|case
name|UNI_AAL_5
case|:
name|uni_print_push_prefix
argument_list|(
literal|"5"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL5_CPCS_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"cpcs"
argument_list|,
literal|"(%u,%u)"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|fwd_cpcs
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|bwd_cpcs
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL5_SSCS_P
condition|)
name|uni_print_tbl
argument_list|(
literal|"sscs"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|sscs
argument_list|,
name|sscs_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
break|break;
case|case
name|UNI_AAL_USER
case|:
name|uni_print_push_prefix
argument_list|(
literal|"user"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|aalu
operator|.
name|len
operator|>
literal|4
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"info"
argument_list|,
literal|"ERROR(len=%u)"
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aalu
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|u_int
name|i
decl_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"info"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|u
operator|.
name|aalu
operator|.
name|len
condition|;
name|i
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s%u"
argument_list|,
operator|!
name|i
condition|?
literal|""
else|:
literal|","
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aalu
operator|.
name|user
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
name|cx
operator|->
name|indent
operator|--
expr_stmt|;
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|aal
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|type
operator|==
name|UNI_AAL_0
condition|)
block|{
empty_stmt|;
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|type
operator|==
name|UNI_AAL_1
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|subtype
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_AAL1_SUB_NULL
case|:
case|case
name|UNI_AAL1_SUB_VOICE
case|:
case|case
name|UNI_AAL1_SUB_CIRCUIT
case|:
case|case
name|UNI_AAL1_SUB_HQAUDIO
case|:
case|case
name|UNI_AAL1_SUB_VIDEO
case|:
break|break;
block|}
switch|switch
condition|(
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|cbr_rate
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_AAL1_CBR_64
case|:
case|case
name|UNI_AAL1_CBR_1544
case|:
case|case
name|UNI_AAL1_CBR_6312
case|:
case|case
name|UNI_AAL1_CBR_32064
case|:
case|case
name|UNI_AAL1_CBR_44736
case|:
case|case
name|UNI_AAL1_CBR_97728
case|:
case|case
name|UNI_AAL1_CBR_2048
case|:
case|case
name|UNI_AAL1_CBR_8448
case|:
case|case
name|UNI_AAL1_CBR_34368
case|:
case|case
name|UNI_AAL1_CBR_139264
case|:
if|if
condition|(
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_MULT_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
break|break;
case|case
name|UNI_AAL1_CBR_N64
case|:
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_MULT_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|mult
operator|<
literal|2
condition|)
return|return
operator|-
literal|1
return|;
break|break;
case|case
name|UNI_AAL1_CBR_N8
case|:
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_MULT_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|mult
operator|==
literal|0
operator|||
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|mult
operator|>
literal|7
condition|)
return|return
operator|-
literal|1
return|;
break|break;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_SCREC_P
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|screc
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_AAL1_SCREC_NULL
case|:
case|case
name|UNI_AAL1_SCREC_SRTS
case|:
case|case
name|UNI_AAL1_SCREC_ACLK
case|:
break|break;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_ECM_P
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|ecm
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_AAL1_ECM_NULL
case|:
case|case
name|UNI_AAL1_ECM_LOSS
case|:
case|case
name|UNI_AAL1_ECM_DELAY
case|:
break|break;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_BSIZE_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|bsize
operator|==
literal|0
condition|)
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_PART_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|part
operator|==
literal|0
operator|||
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|part
operator|>
literal|47
condition|)
return|return
operator|-
literal|1
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|type
operator|==
name|UNI_AAL_2
condition|)
block|{
empty_stmt|;
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|type
operator|==
name|UNI_AAL_4
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL4_MID_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_low
operator|>=
literal|1024
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_high
operator|>=
literal|1024
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_low
operator|>
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_high
condition|)
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL4_SSCS_P
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|sscs
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_AAL_SSCS_NULL
case|:
case|case
name|UNI_AAL_SSCS_SSCOPA
case|:
case|case
name|UNI_AAL_SSCS_SSCOPU
case|:
case|case
name|UNI_AAL_SSCS_FRAME
case|:
break|break;
block|}
block|}
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|type
operator|==
name|UNI_AAL_5
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL5_SSCS_P
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|sscs
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_AAL_SSCS_NULL
case|:
case|case
name|UNI_AAL_SSCS_SSCOPA
case|:
case|case
name|UNI_AAL_SSCS_SSCOPU
case|:
case|case
name|UNI_AAL_SSCS_FRAME
case|:
break|break;
block|}
block|}
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|type
operator|==
name|UNI_AAL_USER
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|u
operator|.
name|aalu
operator|.
name|len
operator|>
literal|4
condition|)
return|return
operator|-
literal|1
return|;
block|}
else|else
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|aal
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|aal
argument_list|,
name|UNI_IE_AAL
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|type
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|type
condition|)
block|{
case|case
name|UNI_AAL_0
case|:
break|break;
case|case
name|UNI_AAL_1
case|:
name|APP_SUB_BYTE
argument_list|(
name|msg
argument_list|,
name|UNI_AAL_SUB_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|subtype
argument_list|)
expr_stmt|;
name|APP_SUB_BYTE
argument_list|(
name|msg
argument_list|,
name|UNI_AAL_CBR_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|cbr_rate
argument_list|)
expr_stmt|;
name|APP_OPT_16BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_AAL1_MULT_P
argument_list|,
name|UNI_AAL_MULT_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|mult
argument_list|)
expr_stmt|;
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_AAL1_SCREC_P
argument_list|,
name|UNI_AAL_SCREC_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|screc
argument_list|)
expr_stmt|;
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_AAL1_ECM_P
argument_list|,
name|UNI_AAL_ECM_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|ecm
argument_list|)
expr_stmt|;
name|APP_OPT_16BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_AAL1_BSIZE_P
argument_list|,
name|UNI_AAL_BSIZE_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|bsize
argument_list|)
expr_stmt|;
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_AAL1_PART_P
argument_list|,
name|UNI_AAL_PART_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|part
argument_list|)
expr_stmt|;
break|break;
case|case
name|UNI_AAL_2
case|:
break|break;
case|case
name|UNI_AAL_4
case|:
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL4_CPCS_P
condition|)
block|{
name|APP_SUB_16BIT
argument_list|(
name|msg
argument_list|,
name|UNI_AAL_FWDCPCS_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|fwd_cpcs
argument_list|)
expr_stmt|;
name|APP_SUB_16BIT
argument_list|(
name|msg
argument_list|,
name|UNI_AAL_BWDCPCS_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|bwd_cpcs
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL4_MID_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|UNI_AAL_MID_ID
argument_list|)
expr_stmt|;
name|APP_16BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_low
argument_list|)
expr_stmt|;
name|APP_16BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_high
argument_list|)
expr_stmt|;
block|}
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_AAL4_SSCS_P
argument_list|,
name|UNI_AAL_SSCS_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|sscs
argument_list|)
expr_stmt|;
break|break;
case|case
name|UNI_AAL_5
case|:
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL5_CPCS_P
condition|)
block|{
name|APP_SUB_16BIT
argument_list|(
name|msg
argument_list|,
name|UNI_AAL_FWDCPCS_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|fwd_cpcs
argument_list|)
expr_stmt|;
name|APP_SUB_16BIT
argument_list|(
name|msg
argument_list|,
name|UNI_AAL_BWDCPCS_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|bwd_cpcs
argument_list|)
expr_stmt|;
block|}
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_AAL5_SSCS_P
argument_list|,
name|UNI_AAL_SSCS_ID
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|sscs
argument_list|)
expr_stmt|;
break|break;
case|case
name|UNI_AAL_USER
case|:
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aalu
operator|.
name|user
argument_list|,
name|ie
operator|->
name|u
operator|.
name|aalu
operator|.
name|len
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_comment
comment|/*  * XXX What should we do with multiple subtype occurences? Ignore  * or reject. Currently we reject.  */
end_comment

begin_function
specifier|static
name|int
name|decode_aal_1
parameter_list|(
name|struct
name|uni_ie_aal
modifier|*
name|ie
parameter_list|,
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|u_int
name|ielen
parameter_list|)
block|{
name|int
name|subtype_p
decl_stmt|,
name|cbr_p
decl_stmt|;
name|subtype_p
operator|=
name|cbr_p
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|ielen
operator|--
operator|>
literal|0
condition|)
block|{
switch|switch
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
case|case
name|UNI_AAL_SUB_ID
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
operator|||
name|subtype_p
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|--
expr_stmt|;
name|subtype_p
operator|=
literal|1
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|subtype
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_CBR_ID
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
operator|||
name|cbr_p
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|--
expr_stmt|;
name|cbr_p
operator|=
literal|1
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|cbr_rate
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_MULT_ID
case|:
if|if
condition|(
name|ielen
operator|<
literal|2
operator|||
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_MULT_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|-=
literal|2
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_AAL1_MULT_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|mult
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|mult
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_SCREC_ID
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
operator|||
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_SCREC_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_AAL1_SCREC_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|screc
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_ECM_ID
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
operator|||
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_ECM_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_AAL1_ECM_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|ecm
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_BSIZE_ID
case|:
if|if
condition|(
name|ielen
operator|<
literal|2
operator|||
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_BSIZE_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|-=
literal|2
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_AAL1_BSIZE_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|bsize
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|bsize
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_PART_ID
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
operator|||
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL1_PART_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_AAL1_PART_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal1
operator|.
name|part
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
block|}
if|if
condition|(
operator|!
name|subtype_p
operator|||
operator|!
name|cbr_p
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|decode_aal_4
parameter_list|(
name|struct
name|uni_ie_aal
modifier|*
name|ie
parameter_list|,
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|u_int
name|ielen
parameter_list|)
block|{
name|int
name|fcpcs_p
decl_stmt|,
name|bcpcs_p
decl_stmt|;
name|fcpcs_p
operator|=
name|bcpcs_p
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|ielen
operator|--
operator|>
literal|0
condition|)
block|{
switch|switch
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
case|case
name|UNI_AAL_FWDCPCS_ID
case|:
if|if
condition|(
name|ielen
operator|<
literal|2
operator|||
name|fcpcs_p
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|-=
literal|2
expr_stmt|;
name|fcpcs_p
operator|=
literal|1
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|fwd_cpcs
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|fwd_cpcs
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_BWDCPCS_ID
case|:
if|if
condition|(
name|ielen
operator|<
literal|2
operator|||
name|bcpcs_p
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|-=
literal|2
expr_stmt|;
name|bcpcs_p
operator|=
literal|1
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|bwd_cpcs
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|bwd_cpcs
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_MID_ID
case|:
if|if
condition|(
name|ielen
operator|<
literal|4
operator|||
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL4_MID_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|-=
literal|4
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_AAL4_MID_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_low
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_low
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_high
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|mid_high
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_SSCS_ID
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
operator|||
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL4_SSCS_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_AAL4_SSCS_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal4
operator|.
name|sscs
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
block|}
if|if
condition|(
name|fcpcs_p
operator|^
name|bcpcs_p
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|fcpcs_p
condition|)
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_AAL4_CPCS_P
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|decode_aal_5
parameter_list|(
name|struct
name|uni_ie_aal
modifier|*
name|ie
parameter_list|,
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|u_int
name|ielen
parameter_list|)
block|{
name|int
name|fcpcs_p
decl_stmt|,
name|bcpcs_p
decl_stmt|;
name|fcpcs_p
operator|=
name|bcpcs_p
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|ielen
operator|--
operator|>
literal|0
condition|)
block|{
switch|switch
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
case|case
name|UNI_AAL_FWDCPCS_ID
case|:
if|if
condition|(
name|ielen
operator|<
literal|2
operator|||
name|fcpcs_p
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|-=
literal|2
expr_stmt|;
name|fcpcs_p
operator|=
literal|1
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|fwd_cpcs
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|fwd_cpcs
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_BWDCPCS_ID
case|:
if|if
condition|(
name|ielen
operator|<
literal|2
operator|||
name|bcpcs_p
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|-=
literal|2
expr_stmt|;
name|bcpcs_p
operator|=
literal|1
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|bwd_cpcs
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|bwd_cpcs
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_AAL_SSCS_ID
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
operator|||
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_AAL5_SSCS_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_AAL5_SSCS_P
expr_stmt|;
name|ie
operator|->
name|u
operator|.
name|aal5
operator|.
name|sscs
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
block|}
if|if
condition|(
name|fcpcs_p
operator|^
name|bcpcs_p
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|fcpcs_p
condition|)
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_AAL5_CPCS_P
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|decode_aal_user
parameter_list|(
name|struct
name|uni_ie_aal
modifier|*
name|ie
parameter_list|,
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|u_int
name|ielen
parameter_list|)
block|{
if|if
condition|(
name|ielen
operator|>
literal|4
condition|)
return|return
operator|-
literal|1
return|;
name|ie
operator|->
name|u
operator|.
name|aalu
operator|.
name|len
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|ielen
operator|--
condition|)
name|ie
operator|->
name|u
operator|.
name|aalu
operator|.
name|user
index|[
name|ie
operator|->
name|u
operator|.
name|aalu
operator|.
name|len
operator|++
index|]
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|aal
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
name|DISC_ACC_ERR
argument_list|(
name|AAL
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ielen
operator|<
literal|1
operator|||
name|ielen
operator|>
literal|21
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
name|UNI_AAL_0
case|:
name|ie
operator|->
name|type
operator|=
name|c
expr_stmt|;
break|break;
case|case
name|UNI_AAL_1
case|:
name|ie
operator|->
name|type
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|decode_aal_1
argument_list|(
name|ie
argument_list|,
name|msg
argument_list|,
name|ielen
argument_list|)
condition|)
goto|goto
name|rej
goto|;
break|break;
case|case
name|UNI_AAL_2
case|:
name|ie
operator|->
name|type
operator|=
name|c
expr_stmt|;
break|break;
case|case
name|UNI_AAL_4
case|:
name|ie
operator|->
name|type
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|decode_aal_4
argument_list|(
name|ie
argument_list|,
name|msg
argument_list|,
name|ielen
argument_list|)
condition|)
goto|goto
name|rej
goto|;
break|break;
case|case
name|UNI_AAL_5
case|:
name|ie
operator|->
name|type
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|decode_aal_5
argument_list|(
name|ie
argument_list|,
name|msg
argument_list|,
name|ielen
argument_list|)
condition|)
goto|goto
name|rej
goto|;
break|break;
case|case
name|UNI_AAL_USER
case|:
name|ie
operator|->
name|type
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|decode_aal_user
argument_list|(
name|ie
argument_list|,
name|msg
argument_list|,
name|ielen
argument_list|)
condition|)
goto|goto
name|rej
goto|;
break|break;
default|default:
goto|goto
name|rej
goto|;
block|}
name|IE_END
argument_list|(
name|AAL
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Traffic descriptor.  * Alternate traffic descriptor.  * Minimum traffic descriptor.  *  * References for this IE are:  *  *  Q.2931 pp. 49...51  *  Q.2961  *  Q.2962  *  UNI4.0 pp. 9...10, 106...109  *  * The Q.s specify the coding. UNI4.0 adds frame discard and best-effort.  * Appendix in UNI4.0 lists the allowed combinations.  *  *		  PCR0 PCR1 SCR/MBS0 SCR/MBS1 BE TAG FDISC ABR  *  1	CBR.1 	  -    Y    -        -        -  N   Y/N   -  *  2	CBR.2 	  -    Y    -        -        -  N   Y/N   -    (*)  *  3	CBR.3 	  Y    Y    -        -        -  Y   Y/N   -    (*)  *  4	rt-VBR.1  -    Y    -        Y        -  N   Y/N   -  *  5	rt-VBR.2  -    Y    Y        -        -  N   Y/N   -  *  6	rt-VBR.3  -    Y    Y        -        -  Y   Y/N   -  *  7	rt-VBR.4  Y    Y    -        -        -  Y/N Y/N   -    (*)  *  8	rt-VBR.5  -    Y    -        -        -  N   Y/N   -    (*)  *  9	rt-VBR.6  -    Y    -        Y        -  N   Y/N   -    (*)  * 10	nrt-VBR.1 -    Y    -        Y        -  N   Y/N   -  * 11	nrt-VBR.2 -    Y    Y        -        -  N   Y/N   -  * 12	nrt-VBR.3 -    Y    Y        -        -  Y   Y/N   -  * 13	nrt-VBR.4 Y    Y    -        -        -  Y/N Y/N   -	(*)  * 14	nrt-VBR.5 -    Y    -        -        -  N   Y/N   -	(*)  * 15	nrt-VBR.6 -    Y    -        Y        -  N   Y/N   -	(*)  * 16	ABR	  -    Y    -        -        -  N   Y/N   O	(*)  * 17	UBR.1	  -    Y    -        -        Y  N   Y/N   -  * 18	UBR.2	  -    Y    -        -        Y  Y   Y/N   -  *  * Allow ITU-T and NET coding, because its not clear, whether the  * new fields in UNI4.0 should be used with NET coding or not.  * Does not allow for experimental codings yet.  */
end_comment

begin_function
specifier|static
name|void
name|print_ie_traffic_common
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
name|u_int
name|present
parameter_list|,
name|struct
name|uni_xtraffic
modifier|*
name|ie
parameter_list|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"fwd"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_FPCR0_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|fpcr0
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_FPCR1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|fpcr1
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_FSCR0_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|fscr0
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_FSCR1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|fscr1
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_FMBS0_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|fmbs0
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_FMBS1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|fmbs1
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_FABR1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|fabr1
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"bwd"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_BPCR0_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|bpcr0
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_BPCR1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|bpcr1
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_BSCR0_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|bscr0
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_BSCR1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|bscr1
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_BMBS0_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|bmbs0
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_BMBS1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|bmbs1
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_BABR1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|babr1
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_BEST_P
condition|)
name|uni_print_flag
argument_list|(
literal|"best_effort"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_MOPT_P
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"tag"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|ftag
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"fwd"
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|btag
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"bwd"
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"disc"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|fdisc
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"fwd"
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|bdisc
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"bwd"
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_struct
struct|struct
name|tallow
block|{
name|u_int
name|mask
decl_stmt|;
name|int
name|mopt_flag
decl_stmt|;
name|u_char
name|mopt_mask
decl_stmt|,
name|mopt_val
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|int
name|check_traffic
parameter_list|(
name|u_int
name|mask
parameter_list|,
name|u_int
name|mopt
parameter_list|,
name|struct
name|tallow
modifier|*
name|a
parameter_list|)
block|{
if|if
condition|(
name|mask
operator|!=
name|a
operator|->
name|mask
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|a
operator|->
name|mopt_flag
operator|==
literal|0
condition|)
block|{
comment|/* not allowed */
if|if
condition|(
name|mopt
operator|==
literal|0xffff
condition|)
return|return
literal|1
return|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|a
operator|->
name|mopt_flag
operator|<
literal|0
condition|)
block|{
comment|/* optional */
if|if
condition|(
name|mopt
operator|==
literal|0xffff
condition|)
return|return
literal|1
return|;
if|if
condition|(
operator|(
name|mopt
operator|&
name|a
operator|->
name|mopt_mask
operator|)
operator|==
name|a
operator|->
name|mopt_val
condition|)
return|return
literal|1
return|;
return|return
literal|0
return|;
block|}
comment|/* required */
if|if
condition|(
name|mopt
operator|==
literal|0xffff
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|(
name|mopt
operator|&
name|a
operator|->
name|mopt_mask
operator|)
operator|==
name|a
operator|->
name|mopt_val
condition|)
return|return
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|check_ie_traffic_common
parameter_list|(
name|struct
name|uni_xtraffic
modifier|*
name|ie
parameter_list|,
name|u_int
name|present
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
name|__unused
parameter_list|)
block|{
specifier|static
name|u_int
name|fmask
init|=
name|UNI_TRAFFIC_FPCR0_P
operator||
name|UNI_TRAFFIC_FPCR1_P
operator||
name|UNI_TRAFFIC_FSCR0_P
operator||
name|UNI_TRAFFIC_FSCR1_P
operator||
name|UNI_TRAFFIC_FMBS0_P
operator||
name|UNI_TRAFFIC_FMBS1_P
operator||
name|UNI_TRAFFIC_FABR1_P
decl_stmt|;
specifier|static
name|u_int
name|bmask
init|=
name|UNI_TRAFFIC_BPCR0_P
operator||
name|UNI_TRAFFIC_BPCR1_P
operator||
name|UNI_TRAFFIC_BSCR0_P
operator||
name|UNI_TRAFFIC_BSCR1_P
operator||
name|UNI_TRAFFIC_BMBS0_P
operator||
name|UNI_TRAFFIC_BMBS1_P
operator||
name|UNI_TRAFFIC_BABR1_P
decl_stmt|;
define|#
directive|define
name|DTAB
parameter_list|(
name|U
parameter_list|,
name|X
parameter_list|)
define|\
value|{ U##X##PCR1_P,							\ 	  -1, U##X##TAG,	0 },
comment|/* 1, 2, 8, 14 */
value|\ 	{ U##X##PCR0_P | U##X##PCR1_P,					\ 	  +1, U##X##TAG,	U##X##TAG },
comment|/* 3 */
value|\ 	{ U##X##PCR1_P | U##X##SCR1_P | U##X##MBS1_P,			\ 	  -1, U##X##TAG,	0 },
comment|/* 4, 9, 10, 15 */
value|\ 	{ U##X##PCR1_P | U##X##SCR0_P | U##X##MBS0_P,			\ 	  -1, 0,		0 },
comment|/* 5, 6, 11, 12 */
value|\ 	{ U##X##PCR0_P | U##X##PCR1_P,					\ 	  -1, 0,		0 },
comment|/* 7, 13 */
value|\ 	{ U##X##PCR1_P | U##X##ABR1_P,					\ 	  -1, U##X##TAG,	0 },
comment|/* 16a */
define|#
directive|define
name|DTABSIZE
value|6
specifier|static
name|struct
name|tallow
name|allow
index|[
literal|2
index|]
index|[
name|DTABSIZE
index|]
init|=
block|{
block|{
name|DTAB
argument_list|(
argument|UNI_TRAFFIC_
argument_list|,
argument|F
argument_list|)
block|}
block|,
block|{
name|DTAB
argument_list|(
argument|UNI_TRAFFIC_
argument_list|,
argument|B
argument_list|)
block|}
block|, 	}
decl_stmt|;
undef|#
directive|undef
name|DTAB
name|u_int
name|f
decl_stmt|,
name|b
decl_stmt|,
name|p
decl_stmt|,
name|m
decl_stmt|;
name|int
name|i
decl_stmt|;
name|f
operator|=
name|present
operator|&
name|fmask
expr_stmt|;
name|b
operator|=
name|present
operator|&
name|bmask
expr_stmt|;
name|p
operator|=
name|present
operator|&
operator|(
name|fmask
operator||
name|bmask
operator|)
expr_stmt|;
name|m
operator|=
operator|(
name|present
operator|&
name|UNI_TRAFFIC_MOPT_P
operator|)
condition|?
operator|(
operator|(
name|ie
operator|->
name|ftag
condition|?
name|UNI_TRAFFIC_FTAG
else|:
literal|0
operator|)
operator||
operator|(
name|ie
operator|->
name|btag
condition|?
name|UNI_TRAFFIC_BTAG
else|:
literal|0
operator|)
operator||
operator|(
name|ie
operator|->
name|fdisc
condition|?
name|UNI_TRAFFIC_FDISC
else|:
literal|0
operator|)
operator||
operator|(
name|ie
operator|->
name|bdisc
condition|?
name|UNI_TRAFFIC_BDISC
else|:
literal|0
operator|)
operator|)
else|:
literal|0xffff
expr_stmt|;
if|if
condition|(
name|present
operator|&
name|UNI_TRAFFIC_BEST_P
condition|)
block|{
comment|/* 		 * Lines 17 and 18 		 */
if|if
condition|(
name|p
operator|!=
operator|(
name|UNI_TRAFFIC_FPCR1_P
operator||
name|UNI_TRAFFIC_BPCR1_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
comment|/* 	 * Check forward and backward independent. There must be a higher 	 * level checking in the CAC 	 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|DTABSIZE
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|check_traffic
argument_list|(
name|f
argument_list|,
name|m
argument_list|,
operator|&
name|allow
index|[
literal|0
index|]
index|[
name|i
index|]
argument_list|)
condition|)
break|break;
if|if
condition|(
name|i
operator|==
name|DTABSIZE
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|DTABSIZE
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|check_traffic
argument_list|(
name|b
argument_list|,
name|m
argument_list|,
operator|&
name|allow
index|[
literal|1
index|]
index|[
name|i
index|]
argument_list|)
condition|)
break|break;
if|if
condition|(
name|i
operator|==
name|DTABSIZE
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|encode_traffic_common
parameter_list|(
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|struct
name|uni_xtraffic
modifier|*
name|ie
parameter_list|,
name|u_int
name|present
parameter_list|,
name|struct
name|unicx
modifier|*
name|cx
name|__unused
parameter_list|)
block|{
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_FPCR0_P
argument_list|,
name|UNI_TRAFFIC_FPCR0_ID
argument_list|,
name|ie
operator|->
name|fpcr0
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_BPCR0_P
argument_list|,
name|UNI_TRAFFIC_BPCR0_ID
argument_list|,
name|ie
operator|->
name|bpcr0
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_FPCR1_P
argument_list|,
name|UNI_TRAFFIC_FPCR1_ID
argument_list|,
name|ie
operator|->
name|fpcr1
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_BPCR1_P
argument_list|,
name|UNI_TRAFFIC_BPCR1_ID
argument_list|,
name|ie
operator|->
name|bpcr1
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_FSCR0_P
argument_list|,
name|UNI_TRAFFIC_FSCR0_ID
argument_list|,
name|ie
operator|->
name|fscr0
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_BSCR0_P
argument_list|,
name|UNI_TRAFFIC_BSCR0_ID
argument_list|,
name|ie
operator|->
name|bscr0
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_FSCR1_P
argument_list|,
name|UNI_TRAFFIC_FSCR1_ID
argument_list|,
name|ie
operator|->
name|fscr1
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_BSCR1_P
argument_list|,
name|UNI_TRAFFIC_BSCR1_ID
argument_list|,
name|ie
operator|->
name|bscr1
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_FMBS0_P
argument_list|,
name|UNI_TRAFFIC_FMBS0_ID
argument_list|,
name|ie
operator|->
name|fmbs0
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_BMBS0_P
argument_list|,
name|UNI_TRAFFIC_BMBS0_ID
argument_list|,
name|ie
operator|->
name|bmbs0
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_FMBS1_P
argument_list|,
name|UNI_TRAFFIC_FMBS1_ID
argument_list|,
name|ie
operator|->
name|fmbs1
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_BMBS1_P
argument_list|,
name|UNI_TRAFFIC_BMBS1_ID
argument_list|,
name|ie
operator|->
name|bmbs1
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_FABR1_P
argument_list|,
name|UNI_TRAFFIC_FABR1_ID
argument_list|,
name|ie
operator|->
name|fabr1
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_BABR1_P
argument_list|,
name|UNI_TRAFFIC_BABR1_ID
argument_list|,
name|ie
operator|->
name|babr1
argument_list|)
expr_stmt|;
name|APP_OPT
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_BEST_P
argument_list|,
name|UNI_TRAFFIC_BEST_ID
argument_list|)
expr_stmt|;
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|present
argument_list|,
name|UNI_TRAFFIC_MOPT_P
argument_list|,
name|UNI_TRAFFIC_MOPT_ID
argument_list|,
operator|(
name|ie
operator|->
name|ftag
condition|?
name|UNI_TRAFFIC_FTAG
else|:
literal|0
operator|)
operator||
operator|(
name|ie
operator|->
name|btag
condition|?
name|UNI_TRAFFIC_BTAG
else|:
literal|0
operator|)
operator||
operator|(
name|ie
operator|->
name|fdisc
condition|?
name|UNI_TRAFFIC_FDISC
else|:
literal|0
operator|)
operator||
operator|(
name|ie
operator|->
name|fdisc
condition|?
name|UNI_TRAFFIC_BDISC
else|:
literal|0
operator|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|decode_traffic_common
parameter_list|(
name|struct
name|uni_xtraffic
modifier|*
name|ie
parameter_list|,
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|u_int
name|ielen
parameter_list|,
name|u_int
modifier|*
name|present
parameter_list|)
block|{
name|u_char
name|c
decl_stmt|;
while|while
condition|(
name|ielen
operator|--
condition|)
block|{
switch|switch
condition|(
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
default|default:
name|rej
label|:
return|return
operator|-
literal|1
return|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_FPCR0
argument_list|,
name|fpcr0
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_BPCR0
argument_list|,
name|bpcr0
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_FPCR1
argument_list|,
name|fpcr1
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_BPCR1
argument_list|,
name|bpcr1
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_FSCR0
argument_list|,
name|fscr0
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_BSCR0
argument_list|,
name|bscr0
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_FSCR1
argument_list|,
name|fscr1
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_BSCR1
argument_list|,
name|bscr1
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_FMBS0
argument_list|,
name|fmbs0
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_BMBS0
argument_list|,
name|bmbs0
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_BMBS1
argument_list|,
name|bmbs1
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_FABR1
argument_list|,
name|fabr1
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_BABR1
argument_list|,
name|babr1
argument_list|,
operator|*
name|present
argument_list|)
expr_stmt|;
case|case
name|UNI_TRAFFIC_BEST_ID
case|:
operator|*
name|present
operator||=
name|UNI_TRAFFIC_BEST_P
expr_stmt|;
break|break;
case|case
name|UNI_TRAFFIC_MOPT_ID
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
return|return
operator|-
literal|1
return|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|*
name|present
operator|&
name|UNI_TRAFFIC_MOPT_P
operator|)
condition|)
block|{
operator|*
name|present
operator||=
name|UNI_TRAFFIC_MOPT_P
expr_stmt|;
name|ie
operator|->
name|ftag
operator|=
operator|(
operator|*
name|msg
operator|->
name|b_rptr
operator|&
name|UNI_TRAFFIC_FTAG
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
name|ie
operator|->
name|btag
operator|=
operator|(
operator|*
name|msg
operator|->
name|b_rptr
operator|&
name|UNI_TRAFFIC_BTAG
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
name|ie
operator|->
name|fdisc
operator|=
operator|(
operator|*
name|msg
operator|->
name|b_rptr
operator|&
name|UNI_TRAFFIC_FDISC
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
name|ie
operator|->
name|bdisc
operator|=
operator|(
operator|*
name|msg
operator|->
name|b_rptr
operator|&
name|UNI_TRAFFIC_BDISC
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
block|}
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*****************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|traffic
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"traffic"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|print_ie_traffic_common
argument_list|(
name|cx
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
operator|&
name|ie
operator|->
name|t
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|traffic
argument_list|)
end_macro

begin_block
block|{
return|return
name|check_ie_traffic_common
argument_list|(
operator|&
name|ie
operator|->
name|t
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|cx
argument_list|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|traffic
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|traffic
argument_list|,
name|UNI_IE_TRAFFIC
argument_list|,
literal|26
argument_list|)
expr_stmt|;
name|encode_traffic_common
argument_list|(
name|msg
argument_list|,
operator|&
name|ie
operator|->
name|t
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|traffic
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|30
condition|)
goto|goto
name|rej
goto|;
if|if
condition|(
name|decode_traffic_common
argument_list|(
operator|&
name|ie
operator|->
name|t
argument_list|,
name|msg
argument_list|,
name|ielen
argument_list|,
operator|&
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|TRAFFIC
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*****************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|atraffic
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"atraffic"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|print_ie_traffic_common
argument_list|(
name|cx
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
operator|&
name|ie
operator|->
name|t
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|atraffic
argument_list|)
end_macro

begin_block
block|{
return|return
name|check_ie_traffic_common
argument_list|(
operator|&
name|ie
operator|->
name|t
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|cx
argument_list|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|atraffic
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|traffic
argument_list|,
name|UNI_IE_ATRAFFIC
argument_list|,
literal|26
argument_list|)
expr_stmt|;
name|encode_traffic_common
argument_list|(
name|msg
argument_list|,
operator|&
name|ie
operator|->
name|t
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|atraffic
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|30
condition|)
goto|goto
name|rej
goto|;
if|if
condition|(
name|decode_traffic_common
argument_list|(
operator|&
name|ie
operator|->
name|t
argument_list|,
name|msg
argument_list|,
name|ielen
argument_list|,
operator|&
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|ATRAFFIC
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*****************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|mintraffic
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"mintraffic"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"pcr0"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_MINTRAFFIC_FPCR0_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|fpcr0
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_MINTRAFFIC_BPCR0_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|bpcr0
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"pcr1"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_MINTRAFFIC_FPCR1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|fpcr1
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_MINTRAFFIC_BPCR1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|bpcr1
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"abr1"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_MINTRAFFIC_FABR1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|fabr1
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_MINTRAFFIC_BABR1_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|babr1
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|mintraffic
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|abr
decl_stmt|;
name|u_int
name|xbr
decl_stmt|;
name|cx
operator|=
name|cx
expr_stmt|;
name|abr
operator|=
name|ie
operator|->
name|h
operator|.
name|present
operator|&
operator|(
name|UNI_MINTRAFFIC_FABR1_P
operator||
name|UNI_MINTRAFFIC_BABR1_P
operator|)
expr_stmt|;
name|xbr
operator|=
name|ie
operator|->
name|h
operator|.
name|present
operator|&
operator|(
name|UNI_MINTRAFFIC_FPCR0_P
operator||
name|UNI_MINTRAFFIC_BPCR0_P
operator||
name|UNI_MINTRAFFIC_FPCR1_P
operator||
name|UNI_MINTRAFFIC_BPCR1_P
operator|)
expr_stmt|;
if|if
condition|(
name|abr
operator|&&
name|xbr
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|mintraffic
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|mintraffic
argument_list|,
name|UNI_IE_MINTRAFFIC
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_MINTRAFFIC_FPCR0_P
argument_list|,
name|UNI_TRAFFIC_FPCR0_ID
argument_list|,
name|ie
operator|->
name|fpcr0
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_MINTRAFFIC_BPCR0_P
argument_list|,
name|UNI_TRAFFIC_BPCR0_ID
argument_list|,
name|ie
operator|->
name|bpcr0
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_MINTRAFFIC_FPCR1_P
argument_list|,
name|UNI_TRAFFIC_FPCR1_ID
argument_list|,
name|ie
operator|->
name|fpcr1
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_MINTRAFFIC_BPCR1_P
argument_list|,
name|UNI_TRAFFIC_BPCR1_ID
argument_list|,
name|ie
operator|->
name|bpcr1
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_MINTRAFFIC_FABR1_P
argument_list|,
name|UNI_TRAFFIC_FABR1_ID
argument_list|,
name|ie
operator|->
name|fabr1
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_MINTRAFFIC_BABR1_P
argument_list|,
name|UNI_TRAFFIC_BABR1_ID
argument_list|,
name|ie
operator|->
name|babr1
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|mintraffic
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|20
condition|)
goto|goto
name|rej
goto|;
while|while
condition|(
name|ielen
operator|--
condition|)
block|{
switch|switch
condition|(
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
default|default:
goto|goto
name|rej
goto|;
name|DEC_GETF3
argument_list|(
name|MINTRAFFIC_FPCR0
argument_list|,
name|fpcr0
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|MINTRAFFIC_BPCR0
argument_list|,
name|bpcr0
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|MINTRAFFIC_FPCR1
argument_list|,
name|fpcr1
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|MINTRAFFIC_BPCR1
argument_list|,
name|bpcr1
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|MINTRAFFIC_FABR1
argument_list|,
name|fabr1
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|MINTRAFFIC_BABR1
argument_list|,
name|babr1
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
block|}
block|}
name|IE_END
argument_list|(
name|MINTRAFFIC
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*****************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|mdcr
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|origin_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_MDCR_ORIGIN_USER
argument_list|,
name|user
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_MDCR_ORIGIN_NET
argument_list|,
name|net
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"mdcr"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"origin"
argument_list|,
name|ie
operator|->
name|origin
argument_list|,
name|origin_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"mdcr"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|fmdcr
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|bmdcr
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|mdcr
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
operator|(
name|ie
operator|->
name|origin
operator|!=
name|UNI_MDCR_ORIGIN_USER
operator|&&
name|ie
operator|->
name|origin
operator|!=
name|UNI_MDCR_ORIGIN_NET
operator|)
operator|||
name|ie
operator|->
name|fmdcr
operator|>=
operator|(
literal|1
operator|<<
literal|24
operator|)
operator|||
name|ie
operator|->
name|bmdcr
operator|>=
operator|(
literal|1
operator|<<
literal|24
operator|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|mdcr
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|mdcr
argument_list|,
name|UNI_IE_MDCR
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|origin
argument_list|)
expr_stmt|;
name|APP_SUB_24BIT
argument_list|(
name|msg
argument_list|,
name|UNI_TRAFFIC_FMDCR_ID
argument_list|,
name|ie
operator|->
name|fmdcr
argument_list|)
expr_stmt|;
name|APP_SUB_24BIT
argument_list|(
name|msg
argument_list|,
name|UNI_TRAFFIC_BMDCR_ID
argument_list|,
name|ie
operator|->
name|bmdcr
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|mdcr
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
define|#
directive|define
name|UNI_TRAFFIC_FMDCR_P
value|0x01
define|#
directive|define
name|UNI_TRAFFIC_BMDCR_P
value|0x02
name|u_int
name|p
init|=
literal|0
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|9
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|origin
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
while|while
condition|(
name|ielen
operator|--
condition|)
block|{
switch|switch
condition|(
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
default|default:
goto|goto
name|rej
goto|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_FMDCR
argument_list|,
name|fmdcr
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|TRAFFIC_BMDCR
argument_list|,
name|bmdcr
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|p
operator|!=
operator|(
name|UNI_TRAFFIC_FMDCR_P
operator||
name|UNI_TRAFFIC_BMDCR_P
operator|)
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|MDCR
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Connection identifier  *  * References for this IE are:  *  *  Q.2931 pp. 69...70  *  UNI4.0 pp. 15...16  *  PNNI1.0 p. 198  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|connid
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_CONNID_VCI
argument_list|,
name|exclusive
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CONNID_ANYVCI
argument_list|,
name|any
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CONNID_NOVCI
argument_list|,
name|no
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|assoc_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_CONNID_ASSOC
argument_list|,
name|associated
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CONNID_NONASSOC
argument_list|,
name|non
operator|-
name|associated
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"connid"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"mode"
argument_list|,
name|ie
operator|->
name|assoc
argument_list|,
name|assoc_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"connid"
argument_list|,
literal|"(%u,"
argument_list|,
name|ie
operator|->
name|vpci
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|type
operator|==
name|UNI_CONNID_VCI
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|vci
argument_list|)
expr_stmt|;
else|else
name|uni_print_tbl
argument_list|(
name|NULL
argument_list|,
name|ie
operator|->
name|type
argument_list|,
name|tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|connid
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|type
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_CONNID_VCI
case|:
case|case
name|UNI_CONNID_ANYVCI
case|:
case|case
name|UNI_CONNID_NOVCI
case|:
break|break;
block|}
if|#
directive|if
literal|0
comment|/* 	 * This field must be checked by the application to fulfil 	 * Q.2931Amd4 27) 5.2.3 last sentence 	 */
block|switch(ie->assoc) {  	  case UNI_CONNID_ASSOC: 		if(!cx->cx.pnni) 			return -1; 		break;  	  case UNI_CONNID_NONASSOC: 		break;  	  default: 		return -1; 	}
endif|#
directive|endif
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|connid
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|connid
argument_list|,
name|UNI_IE_CONNID
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
operator|(
name|ie
operator|->
name|assoc
operator|<<
literal|3
operator|)
operator||
name|ie
operator|->
name|type
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|vpci
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|vpci
operator|>>
literal|0
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|vci
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|vci
operator|>>
literal|0
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|connid
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|5
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|&
literal|0x80
operator|)
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|assoc
operator|=
operator|(
name|c
operator|>>
literal|3
operator|)
operator|&
literal|3
expr_stmt|;
name|ie
operator|->
name|type
operator|=
name|c
operator|&
literal|7
expr_stmt|;
name|ie
operator|->
name|vpci
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|vpci
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|vci
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|vci
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|IE_END
argument_list|(
name|CONNID
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Quality of Service  *  * References for this IE are:  *  *  Q.2931 pp. 72  *  UNI4.0 pp. 16...17  */
end_comment

begin_function
specifier|static
name|void
name|print_qos
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
name|struct
name|uni_ie_qos
modifier|*
name|ie
parameter_list|)
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|class_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_QOS_CLASS0
argument_list|,
name|Class0
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_QOS_CLASS1
argument_list|,
name|Class1
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_QOS_CLASS2
argument_list|,
name|Class2
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_QOS_CLASS3
argument_list|,
name|Class3
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_QOS_CLASS4
argument_list|,
name|Class4
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"qos"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"fwd"
argument_list|,
name|ie
operator|->
name|fwd
argument_list|,
name|class_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"bwd"
argument_list|,
name|ie
operator|->
name|bwd
argument_list|,
name|class_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|qos
argument_list|)
end_macro

begin_block
block|{
name|print_qos
argument_list|(
name|cx
argument_list|,
name|ie
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|qos
argument_list|)
end_macro

begin_block
block|{
name|print_qos
argument_list|(
name|cx
argument_list|,
name|ie
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|qos
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|fwd
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_QOS_CLASS0
case|:
break|break;
block|}
switch|switch
condition|(
name|ie
operator|->
name|bwd
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_QOS_CLASS0
case|:
break|break;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|qos
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|fwd
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_QOS_CLASS1
case|:
case|case
name|UNI_QOS_CLASS2
case|:
case|case
name|UNI_QOS_CLASS3
case|:
case|case
name|UNI_QOS_CLASS4
case|:
break|break;
block|}
switch|switch
condition|(
name|ie
operator|->
name|bwd
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_QOS_CLASS1
case|:
case|case
name|UNI_QOS_CLASS2
case|:
case|case
name|UNI_QOS_CLASS3
case|:
case|case
name|UNI_QOS_CLASS4
case|:
break|break;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|qos
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|qos
argument_list|,
name|UNI_IE_QOS
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|fwd
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|bwd
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|qos
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|qos
argument_list|,
name|UNI_IE_QOS
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|fwd
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|bwd
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|qos
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|2
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|fwd
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|bwd
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|IE_END
argument_list|(
name|QOS
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|qos
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|2
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|fwd
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|bwd
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|IE_END
argument_list|(
name|QOS
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Broadband Lower Layer Information  *  * References for this IE are:  *  *  Q.2931 pp. 53...54  *  UNI4.0 p.  12  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|bhli
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|type_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BHLI_ISO
argument_list|,
name|iso
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BHLI_USER
argument_list|,
name|user
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BHLI_VENDOR
argument_list|,
name|vendor
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"bhli"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"type"
argument_list|,
name|ie
operator|->
name|type
argument_list|,
name|type_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"len"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"info"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|len
condition|;
name|i
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|",0x%02x"
argument_list|,
name|ie
operator|->
name|info
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|bhli
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|type
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BHLI_ISO
case|:
case|case
name|UNI_BHLI_USER
case|:
case|case
name|UNI_BHLI_VENDOR
case|:
break|break;
block|}
if|if
condition|(
name|ie
operator|->
name|len
operator|>
literal|8
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|bhli
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|bhli
argument_list|,
name|UNI_IE_BHLI
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
name|ie
operator|->
name|type
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|info
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|bhli
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|9
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|type
operator|=
name|c
operator|&
literal|0x7f
expr_stmt|;
name|ie
operator|->
name|len
operator|=
name|ielen
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|ie
operator|->
name|info
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
name|ielen
argument_list|)
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
name|ielen
expr_stmt|;
name|IE_END
argument_list|(
name|BHLI
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Broadband bearer capabilities  *  * References for this IE are:  *  *  Q.2931 pp. 51...52  *  Q.2931 Amd 1  *  UNI4.0 pp. 10...12, 106...109  *  * UNI4.0 changed the meaning of byte 5a. Instead of 3 bit traffic type and  * 2 bit timing requirements there are now 7 bits ATM transfer capabilities.  * However the old format is still supported: it should be recognized on  * input, but never be generated on output. Mapping is left to the user of  * UNI.  *  * Amd 1 not checked XXX.  *  * The Appendix in UNI4.0 lists all the supported combinations of various  * traffic IE's. The check function implements part of it.  *  *			A		C		X		VP  * 1	CBR.1		7		.		7		7  * 2	CBR.2		-		.		4,5,6		5   (*)  * 3	CBR.3		-		.		4,5,6		5   (*)  * 4	rt-VBR.1	.		19		19		19  * 5	rt-VBR.2	.		9		1,9		9  * 6	rt-VBR.3	.		9		1,9		9  * 7	rt-VBR.4	.		.		1,9		.   (*)  * 8	rt-VBR.5	.		.		1,9		.   (*)  * 9	rt-VBR.6	.		9		1,9		9   (*)  * 10	nrt-VBR.1	.		11		11		11  * 11	nrt-VBR.2	.		-		-,0,2,8,10	-,10  * 12	nrt-VBR.3	.		-		-,0,2,8,10	-,10  * 13	nrt-VBR.4	.		-		-,0,2,8,10	.   (*)  * 14	nrt-VBR.5	.		-		-,0,2,8,10	.   (*)  * 15	nrt-VBR.6	.		-		-,0,2,8,10	-,10(*)  * 16	ABR		.		12		12		12  * 17	UBR.1		.		-		-,0,2,8,10	-,10  * 18	UBR.2		.		-		-,0,2,8,10	-,10  *  * (*) compatibility  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|bearer
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|bclass_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BEARER_A
argument_list|,
name|bcob
operator|-
name|A
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_C
argument_list|,
name|bcob
operator|-
name|C
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_X
argument_list|,
name|bcob
operator|-
name|X
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_TVP
argument_list|,
name|transparent
operator|-
name|VP
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|atc_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BEARER_ATC_CBR
argument_list|,
name|cbr
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATC_CBR1
argument_list|,
name|cbr1
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATC_VBR
argument_list|,
name|vbr
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATC_VBR1
argument_list|,
name|vbr1
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATC_NVBR
argument_list|,
name|nvbr
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATC_NVBR1
argument_list|,
name|nvbr1
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATC_ABR
argument_list|,
name|abr
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATCX_0
argument_list|,
name|x0
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATCX_1
argument_list|,
name|x1
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATCX_2
argument_list|,
name|x2
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATCX_4
argument_list|,
name|x4
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATCX_6
argument_list|,
name|x6
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_ATCX_8
argument_list|,
name|x8
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|cfg_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BEARER_P2P
argument_list|,
name|p2p
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_MP
argument_list|,
name|mp
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|clip_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BEARER_NOCLIP
argument_list|,
name|no
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BEARER_CLIP
argument_list|,
name|yes
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"bearer"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"class"
argument_list|,
name|ie
operator|->
name|bclass
argument_list|,
name|bclass_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BEARER_ATC_P
condition|)
block|{
name|uni_print_tbl
argument_list|(
literal|"atc"
argument_list|,
name|ie
operator|->
name|atc
argument_list|,
name|atc_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
name|uni_print_tbl
argument_list|(
literal|"clip"
argument_list|,
name|ie
operator|->
name|clip
argument_list|,
name|clip_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"cfg"
argument_list|,
name|ie
operator|->
name|cfg
argument_list|,
name|cfg_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_define
define|#
directive|define
name|QTYPE
parameter_list|(
name|C
parameter_list|,
name|A
parameter_list|)
value|((UNI_BEARER_##C<< 8) | UNI_BEARER_ATC_##A)
end_define

begin_define
define|#
directive|define
name|QTYPEX
parameter_list|(
name|C
parameter_list|,
name|A
parameter_list|)
value|((UNI_BEARER_##C<< 8) | UNI_BEARER_ATCX_##A)
end_define

begin_define
define|#
directive|define
name|QTYPE0
parameter_list|(
name|C
parameter_list|)
value|((UNI_BEARER_##C<< 8) | (1<< 16))
end_define

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|bearer
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
operator|(
name|ie
operator|->
name|bclass
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BEARER_ATC_P
operator|)
operator|==
literal|0
condition|?
operator|(
literal|1
operator|<<
literal|16
operator|)
else|:
name|ie
operator|->
name|atc
operator|)
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|QTYPE
argument_list|(
name|A
argument_list|,
name|CBR1
argument_list|)
case|:
comment|/* 1 */
case|case
name|QTYPE
argument_list|(
name|X
argument_list|,
name|CBR1
argument_list|)
case|:
comment|/* 1 */
case|case
name|QTYPE
argument_list|(
name|TVP
argument_list|,
name|CBR1
argument_list|)
case|:
comment|/* 1 */
case|case
name|QTYPE0
argument_list|(
name|A
argument_list|)
case|:
comment|/* 2,3 */
case|case
name|QTYPEX
argument_list|(
name|X
argument_list|,
literal|4
argument_list|)
case|:
comment|/* 2,3 */
case|case
name|QTYPE
argument_list|(
name|X
argument_list|,
name|CBR
argument_list|)
case|:
comment|/* 2,3 */
case|case
name|QTYPEX
argument_list|(
name|X
argument_list|,
literal|6
argument_list|)
case|:
comment|/* 2,3 */
case|case
name|QTYPE
argument_list|(
name|TVP
argument_list|,
name|CBR
argument_list|)
case|:
comment|/* 2,3 */
case|case
name|QTYPE
argument_list|(
name|C
argument_list|,
name|VBR1
argument_list|)
case|:
comment|/* 4 */
case|case
name|QTYPE
argument_list|(
name|X
argument_list|,
name|VBR1
argument_list|)
case|:
comment|/* 4 */
case|case
name|QTYPE
argument_list|(
name|TVP
argument_list|,
name|VBR1
argument_list|)
case|:
comment|/* 4 */
case|case
name|QTYPE
argument_list|(
name|C
argument_list|,
name|VBR
argument_list|)
case|:
comment|/* 5,6,9 */
case|case
name|QTYPEX
argument_list|(
name|X
argument_list|,
literal|1
argument_list|)
case|:
comment|/* 5,6,7,8,9 */
case|case
name|QTYPE
argument_list|(
name|X
argument_list|,
name|VBR
argument_list|)
case|:
comment|/* 5,6,7,8,9 */
case|case
name|QTYPE
argument_list|(
name|TVP
argument_list|,
name|VBR
argument_list|)
case|:
comment|/* 5,6,9 */
case|case
name|QTYPE
argument_list|(
name|C
argument_list|,
name|NVBR1
argument_list|)
case|:
comment|/* 10 */
case|case
name|QTYPE
argument_list|(
name|X
argument_list|,
name|NVBR1
argument_list|)
case|:
comment|/* 10 */
case|case
name|QTYPE
argument_list|(
name|TVP
argument_list|,
name|NVBR1
argument_list|)
case|:
comment|/* 10 */
case|case
name|QTYPE0
argument_list|(
name|C
argument_list|)
case|:
comment|/* 11,12,13,14,15,17,18 */
case|case
name|QTYPE0
argument_list|(
name|X
argument_list|)
case|:
comment|/* 11,12,13,14,15,17,18 */
case|case
name|QTYPEX
argument_list|(
name|X
argument_list|,
literal|0
argument_list|)
case|:
comment|/* 11,12,13,14,15,17,18 */
case|case
name|QTYPEX
argument_list|(
name|X
argument_list|,
literal|2
argument_list|)
case|:
comment|/* 11,12,13,14,15,17,18 */
case|case
name|QTYPEX
argument_list|(
name|X
argument_list|,
literal|8
argument_list|)
case|:
comment|/* 11,12,13,14,15,17,18 */
case|case
name|QTYPE
argument_list|(
name|X
argument_list|,
name|NVBR
argument_list|)
case|:
comment|/* 11,12,13,14,15,17,18 */
case|case
name|QTYPE0
argument_list|(
name|TVP
argument_list|)
case|:
comment|/* 11,12,15,17,18 */
case|case
name|QTYPE
argument_list|(
name|TVP
argument_list|,
name|NVBR
argument_list|)
case|:
comment|/* 11,12,15,17,18 */
case|case
name|QTYPE
argument_list|(
name|C
argument_list|,
name|ABR
argument_list|)
case|:
comment|/* 16 */
case|case
name|QTYPE
argument_list|(
name|X
argument_list|,
name|ABR
argument_list|)
case|:
comment|/* 16 */
case|case
name|QTYPE
argument_list|(
name|TVP
argument_list|,
name|ABR
argument_list|)
case|:
comment|/* 16 */
break|break;
block|}
switch|switch
condition|(
name|ie
operator|->
name|clip
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BEARER_NOCLIP
case|:
case|case
name|UNI_BEARER_CLIP
case|:
break|break;
block|}
switch|switch
condition|(
name|ie
operator|->
name|cfg
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BEARER_P2P
case|:
case|case
name|UNI_BEARER_MP
case|:
break|break;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_undef
undef|#
directive|undef
name|QTYPE
end_undef

begin_undef
undef|#
directive|undef
name|QTYPEX
end_undef

begin_undef
undef|#
directive|undef
name|QTYPE0
end_undef

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|bearer
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|bearer
argument_list|,
name|UNI_IE_BEARER
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|bclass
operator||
operator|(
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BEARER_ATC_P
operator|)
condition|?
literal|0
else|:
literal|0x80
operator|)
argument_list|)
expr_stmt|;
name|APP_OPT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_BEARER_ATC_P
argument_list|,
literal|0x80
operator||
name|ie
operator|->
name|atc
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
operator|(
name|ie
operator|->
name|clip
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|cfg
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|bearer
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|2
operator|&&
name|ielen
operator|!=
literal|3
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|bclass
operator|=
name|c
operator|&
literal|0x1f
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
block|{
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BEARER_ATC_P
expr_stmt|;
switch|switch
condition|(
name|c
operator|&
literal|0x7f
condition|)
block|{
comment|/* 		   * Real legal values 		   */
case|case
name|UNI_BEARER_ATC_CBR
case|:
case|case
name|UNI_BEARER_ATC_CBR1
case|:
case|case
name|UNI_BEARER_ATC_VBR
case|:
case|case
name|UNI_BEARER_ATC_VBR1
case|:
case|case
name|UNI_BEARER_ATC_NVBR
case|:
case|case
name|UNI_BEARER_ATC_NVBR1
case|:
case|case
name|UNI_BEARER_ATC_ABR
case|:
break|break;
comment|/* 		   * Compat values 		   */
case|case
name|UNI_BEARER_ATCX_0
case|:
case|case
name|UNI_BEARER_ATCX_1
case|:
case|case
name|UNI_BEARER_ATCX_2
case|:
case|case
name|UNI_BEARER_ATCX_4
case|:
case|case
name|UNI_BEARER_ATCX_6
case|:
case|case
name|UNI_BEARER_ATCX_8
case|:
break|break;
default|default:
goto|goto
name|rej
goto|;
block|}
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|atc
operator|=
name|c
operator|&
literal|0x7f
expr_stmt|;
block|}
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|clip
operator|=
operator|(
name|c
operator|>>
literal|5
operator|)
operator|&
literal|0x3
expr_stmt|;
name|ie
operator|->
name|cfg
operator|=
name|c
operator|&
literal|0x3
expr_stmt|;
name|IE_END
argument_list|(
name|BEARER
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Broadband Lower Layer Information  *  * References for this IE are:  *  *  Q.2931 pp. 54...59  *  UNI4.0 pp. 12...14  *  * UNI4.0 states, that layer 1 info is not supported.  * We allow a layer 1 protocol identifier.  *  * UNI4.0 states, that the layer information subelements are NOT position  * dependent. We allow them in any order on input, but generate always the  * definit order on output.  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|blli
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|l2_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BLLI_L2_BASIC
argument_list|,
name|basic
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_Q921
argument_list|,
name|Q921
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_X25LL
argument_list|,
name|X25
operator|-
name|LL
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_X25ML
argument_list|,
name|X25
operator|-
name|ML
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_LABP
argument_list|,
name|LAPB
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_HDLC_ARM
argument_list|,
name|HDLC
operator|-
name|ARM
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_HDLC_NRM
argument_list|,
name|HDLC
operator|-
name|NRM
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_HDLC_ABM
argument_list|,
name|HDLC
operator|-
name|ABM
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_LAN
argument_list|,
name|LAN
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_X75
argument_list|,
name|X75
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_Q922
argument_list|,
name|Q922
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_USER
argument_list|,
name|user
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2_ISO7776
argument_list|,
name|ISO7776
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|l2mode_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BLLI_L2NORM
argument_list|,
name|normal
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L2EXT
argument_list|,
name|extended
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|l3_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BLLI_L3_X25
argument_list|,
name|X25
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_ISO8208
argument_list|,
name|ISO8208
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_X223
argument_list|,
name|X223
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_CLMP
argument_list|,
name|CLMP
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_T70
argument_list|,
name|T70
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_TR9577
argument_list|,
name|TR9577
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_USER
argument_list|,
name|user
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_H310
argument_list|,
name|H310
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_H321
argument_list|,
name|H321
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|l3mode_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BLLI_L3NSEQ
argument_list|,
name|normal
operator|-
name|seq
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3ESEQ
argument_list|,
name|extended
operator|-
name|seq
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|l3psiz_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BLLI_L3_16
argument_list|,
literal|16
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_32
argument_list|,
literal|32
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_64
argument_list|,
literal|64
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_128
argument_list|,
literal|128
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_256
argument_list|,
literal|256
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_512
argument_list|,
literal|512
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_1024
argument_list|,
literal|1024
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_2048
argument_list|,
literal|2048
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_4096
argument_list|,
literal|4096
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|l3ttype_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BLLI_L3_TTYPE_RECV
argument_list|,
name|receive_only
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_TTYPE_SEND
argument_list|,
name|send_only
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_TTYPE_BOTH
argument_list|,
name|both
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|l3mux_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BLLI_L3_MUX_NOMUX
argument_list|,
name|NOMUX
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_MUX_TS
argument_list|,
name|TS
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_MUX_TSFEC
argument_list|,
name|TSFEC
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_MUX_PS
argument_list|,
name|PS
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_MUX_PSFEC
argument_list|,
name|PSFEC
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_MUX_H221
argument_list|,
name|H221
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|l3tcap_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_BLLI_L3_TCAP_NOIND
argument_list|,
name|noind
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_TCAP_AAL1
argument_list|,
name|aal1
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_TCAP_AAL5
argument_list|,
name|aal5
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_BLLI_L3_TCAP_AAL15
argument_list|,
name|aal1
operator|&
literal|5
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"blli"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L1_P
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"l1"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|l1
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_P
condition|)
block|{
name|uni_print_tbl
argument_list|(
literal|"l2"
argument_list|,
name|ie
operator|->
name|l2
argument_list|,
name|l2_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_push_prefix
argument_list|(
literal|"l2"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_USER_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"proto"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|l2_user
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_Q933_P
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"q933"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|l2_q933
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"mode"
argument_list|,
name|ie
operator|->
name|l2_mode
argument_list|,
name|l2mode_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_WSIZ_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"wsize"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|l2_wsiz
argument_list|)
expr_stmt|;
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|--
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_P
condition|)
block|{
name|uni_print_tbl
argument_list|(
literal|"l3"
argument_list|,
name|ie
operator|->
name|l3
argument_list|,
name|l3_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_push_prefix
argument_list|(
literal|"l3"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_USER_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"proto"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|l3_user
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_MODE_P
condition|)
name|uni_print_tbl
argument_list|(
literal|"mode"
argument_list|,
name|ie
operator|->
name|l3_mode
argument_list|,
name|l3mode_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_PSIZ_P
condition|)
name|uni_print_tbl
argument_list|(
literal|"packet-size"
argument_list|,
name|ie
operator|->
name|l3_psiz
argument_list|,
name|l3psiz_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_WSIZ_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"window-size"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|l3_wsiz
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_TTYPE_P
condition|)
block|{
name|uni_print_tbl
argument_list|(
literal|"ttype"
argument_list|,
name|ie
operator|->
name|l3_ttype
argument_list|,
name|l3ttype_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"tcap"
argument_list|,
name|ie
operator|->
name|l3_tcap
argument_list|,
name|l3tcap_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_MUX_P
condition|)
block|{
name|uni_print_tbl
argument_list|(
literal|"fmux"
argument_list|,
name|ie
operator|->
name|l3_fmux
argument_list|,
name|l3mux_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
literal|"bmux"
argument_list|,
name|ie
operator|->
name|l3_bmux
argument_list|,
name|l3mux_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_IPI_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"ipi"
argument_list|,
literal|"0x%02x"
argument_list|,
name|ie
operator|->
name|l3_ipi
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_SNAP_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"snap"
argument_list|,
literal|"%06x.%04x"
argument_list|,
name|ie
operator|->
name|oui
argument_list|,
name|ie
operator|->
name|pid
argument_list|)
expr_stmt|;
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|--
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|blli
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
comment|/* 	if(ie->h.present& UNI_BLLI_L1_P) 		; */
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_P
condition|)
block|{
specifier|static
name|u_int
name|mask
init|=
name|UNI_BLLI_L2_Q933_P
operator||
name|UNI_BLLI_L2_WSIZ_P
operator||
name|UNI_BLLI_L2_USER_P
decl_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|l2
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BLLI_L2_BASIC
case|:
case|case
name|UNI_BLLI_L2_Q921
case|:
case|case
name|UNI_BLLI_L2_LABP
case|:
case|case
name|UNI_BLLI_L2_LAN
case|:
case|case
name|UNI_BLLI_L2_X75
case|:
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
return|return
operator|-
literal|1
return|;
break|break;
case|case
name|UNI_BLLI_L2_X25LL
case|:
case|case
name|UNI_BLLI_L2_X25ML
case|:
case|case
name|UNI_BLLI_L2_HDLC_ARM
case|:
case|case
name|UNI_BLLI_L2_HDLC_NRM
case|:
case|case
name|UNI_BLLI_L2_HDLC_ABM
case|:
case|case
name|UNI_BLLI_L2_Q922
case|:
case|case
name|UNI_BLLI_L2_ISO7776
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
literal|0
case|:
case|case
name|UNI_BLLI_L2_Q933_P
case|:
case|case
name|UNI_BLLI_L2_Q933_P
operator||
name|UNI_BLLI_L2_WSIZ_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_BLLI_L2_USER
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
literal|0
case|:
comment|/* XXX ? */
case|case
name|UNI_BLLI_L2_USER_P
case|:
break|break;
block|}
break|break;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_Q933_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|l2_q933
operator|!=
literal|0
condition|)
return|return
operator|-
literal|1
return|;
switch|switch
condition|(
name|ie
operator|->
name|l2_mode
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BLLI_L2NORM
case|:
case|case
name|UNI_BLLI_L2EXT
case|:
break|break;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_WSIZ_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|l2_wsiz
operator|==
literal|0
operator|||
name|ie
operator|->
name|l2_wsiz
operator|>
literal|127
condition|)
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_USER_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|l2_user
operator|>
literal|127
condition|)
return|return
operator|-
literal|1
return|;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_P
condition|)
block|{
specifier|static
name|u_int
name|mask
init|=
name|UNI_BLLI_L3_MODE_P
operator||
name|UNI_BLLI_L3_PSIZ_P
operator||
name|UNI_BLLI_L3_WSIZ_P
operator||
name|UNI_BLLI_L3_USER_P
operator||
name|UNI_BLLI_L3_IPI_P
operator||
name|UNI_BLLI_L3_SNAP_P
operator||
name|UNI_BLLI_L3_TTYPE_P
operator||
name|UNI_BLLI_L3_MUX_P
decl_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|l3
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BLLI_L3_X25
case|:
case|case
name|UNI_BLLI_L3_ISO8208
case|:
case|case
name|UNI_BLLI_L3_X223
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
literal|0
case|:
case|case
name|UNI_BLLI_L3_MODE_P
case|:
case|case
name|UNI_BLLI_L3_MODE_P
operator||
name|UNI_BLLI_L3_PSIZ_P
case|:
case|case
name|UNI_BLLI_L3_MODE_P
operator||
name|UNI_BLLI_L3_PSIZ_P
operator||
name|UNI_BLLI_L3_WSIZ_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_BLLI_L3_CLMP
case|:
case|case
name|UNI_BLLI_L3_T70
case|:
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
return|return
operator|-
literal|1
return|;
break|break;
case|case
name|UNI_BLLI_L3_TR9577
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
literal|0
case|:
case|case
name|UNI_BLLI_L3_IPI_P
case|:
case|case
name|UNI_BLLI_L3_IPI_P
operator||
name|UNI_BLLI_L3_SNAP_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_BLLI_L3_H310
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
literal|0
case|:
case|case
name|UNI_BLLI_L3_TTYPE_P
case|:
case|case
name|UNI_BLLI_L3_TTYPE_P
operator||
name|UNI_BLLI_L3_MUX_P
case|:
break|break;
block|}
break|break;
case|case
name|UNI_BLLI_L3_USER
case|:
switch|switch
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|mask
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
literal|0
case|:
comment|/* XXX ? */
case|case
name|UNI_BLLI_L3_USER_P
case|:
break|break;
block|}
break|break;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_MODE_P
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|l3_mode
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BLLI_L3NSEQ
case|:
case|case
name|UNI_BLLI_L3ESEQ
case|:
break|break;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_PSIZ_P
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|l3_psiz
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BLLI_L3_16
case|:
case|case
name|UNI_BLLI_L3_32
case|:
case|case
name|UNI_BLLI_L3_64
case|:
case|case
name|UNI_BLLI_L3_128
case|:
case|case
name|UNI_BLLI_L3_256
case|:
case|case
name|UNI_BLLI_L3_512
case|:
case|case
name|UNI_BLLI_L3_1024
case|:
case|case
name|UNI_BLLI_L3_2048
case|:
case|case
name|UNI_BLLI_L3_4096
case|:
break|break;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_WSIZ_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|l3_wsiz
operator|==
literal|0
operator|||
name|ie
operator|->
name|l3_wsiz
operator|>
literal|127
condition|)
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_IPI_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|l3_ipi
operator|==
name|UNI_BLLI_L3_SNAP
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_SNAP_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
block|}
else|else
block|{
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_SNAP_P
condition|)
return|return
operator|-
literal|1
return|;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_USER_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|l3_user
operator|>
literal|127
condition|)
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_SNAP_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|oui
operator|>=
operator|(
literal|1
operator|<<
literal|24
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|pid
operator|>=
operator|(
literal|1
operator|<<
literal|16
operator|)
condition|)
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_TTYPE_P
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|l3_ttype
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BLLI_L3_TTYPE_RECV
case|:
case|case
name|UNI_BLLI_L3_TTYPE_SEND
case|:
case|case
name|UNI_BLLI_L3_TTYPE_BOTH
case|:
break|break;
block|}
switch|switch
condition|(
name|ie
operator|->
name|l3_tcap
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BLLI_L3_TCAP_NOIND
case|:
case|case
name|UNI_BLLI_L3_TCAP_AAL1
case|:
case|case
name|UNI_BLLI_L3_TCAP_AAL5
case|:
case|case
name|UNI_BLLI_L3_TCAP_AAL15
case|:
break|break;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_MUX_P
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|l3_fmux
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BLLI_L3_MUX_NOMUX
case|:
case|case
name|UNI_BLLI_L3_MUX_TS
case|:
case|case
name|UNI_BLLI_L3_MUX_TSFEC
case|:
case|case
name|UNI_BLLI_L3_MUX_PS
case|:
case|case
name|UNI_BLLI_L3_MUX_PSFEC
case|:
case|case
name|UNI_BLLI_L3_MUX_H221
case|:
break|break;
block|}
switch|switch
condition|(
name|ie
operator|->
name|l3_bmux
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_BLLI_L3_MUX_NOMUX
case|:
case|case
name|UNI_BLLI_L3_MUX_TS
case|:
case|case
name|UNI_BLLI_L3_MUX_TSFEC
case|:
case|case
name|UNI_BLLI_L3_MUX_PS
case|:
case|case
name|UNI_BLLI_L3_MUX_PSFEC
case|:
case|case
name|UNI_BLLI_L3_MUX_H221
case|:
break|break;
block|}
block|}
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|blli
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|blli
argument_list|,
name|UNI_IE_BLLI
argument_list|,
literal|13
argument_list|)
expr_stmt|;
if|if
condition|(
name|IE_ISERROR
argument_list|(
operator|*
name|ie
argument_list|)
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0xff
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0xff
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L1_P
condition|)
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|UNI_BLLI_L1_ID
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l1
operator||
literal|0x80
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_Q933_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|UNI_BLLI_L2_ID
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l2
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_WSIZ_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|l2_mode
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l2_q933
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|l2_wsiz
operator||
literal|0x80
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|l2_mode
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l2_q933
operator||
literal|0x80
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L2_USER_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|UNI_BLLI_L2_ID
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l2
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|l2_user
operator||
literal|0x80
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|UNI_BLLI_L2_ID
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l2
operator||
literal|0x80
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_MODE_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_PSIZ_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_WSIZ_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|UNI_BLLI_L3_ID
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l3
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|l3_mode
operator|<<
literal|5
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|l3_psiz
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|l3_wsiz
operator||
literal|0x80
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|UNI_BLLI_L3_ID
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l3
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|l3_mode
operator|<<
literal|5
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|l3_psiz
operator||
literal|0x80
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|UNI_BLLI_L3_ID
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l3
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|l3_mode
operator|<<
literal|5
operator|)
operator||
literal|0x80
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_USER_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|UNI_BLLI_L3_ID
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l3
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|l3_user
operator||
literal|0x80
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_IPI_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|UNI_BLLI_L3_ID
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l3
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
operator|(
name|ie
operator|->
name|l3_ipi
operator|>>
literal|1
operator|)
operator|&
literal|0x7f
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
operator|(
operator|(
name|ie
operator|->
name|l3_ipi
operator|&
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
literal|0x80
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_SNAP_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|oui
operator|>>
literal|16
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|oui
operator|>>
literal|8
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|oui
operator|>>
literal|0
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|pid
operator|>>
literal|8
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|pid
operator|>>
literal|0
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_TTYPE_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_BLLI_L3_MUX_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|l3_ttype
operator||
operator|(
name|ie
operator|->
name|l3_tcap
operator|<<
literal|4
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
operator|(
name|ie
operator|->
name|l3_fmux
operator|<<
literal|3
operator|)
operator||
name|ie
operator|->
name|l3_bmux
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
name|ie
operator|->
name|l3_ttype
operator||
operator|(
name|ie
operator|->
name|l3_tcap
operator|<<
literal|4
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|UNI_BLLI_L3_ID
operator|<<
literal|5
operator|)
operator||
name|ie
operator|->
name|l3
operator||
literal|0x80
argument_list|)
expr_stmt|;
block|}
block|}
name|out
label|:
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|blli
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|17
condition|)
goto|goto
name|rej
goto|;
while|while
condition|(
name|ielen
operator|--
condition|)
block|{
switch|switch
condition|(
operator|(
operator|(
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|)
operator|>>
literal|5
operator|)
operator|&
literal|0x3
condition|)
block|{
default|default:
goto|goto
name|rej
goto|;
case|case
name|UNI_BLLI_L1_ID
case|:
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L1_P
expr_stmt|;
name|ie
operator|->
name|l1
operator|=
name|c
operator|&
literal|0x1f
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
break|break;
case|case
name|UNI_BLLI_L2_ID
case|:
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L2_P
expr_stmt|;
name|ie
operator|->
name|l2
operator|=
name|c
operator|&
literal|0x1f
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
block|{
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|l2
operator|==
name|UNI_BLLI_L2_USER
condition|)
block|{
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L2_USER_P
expr_stmt|;
name|ie
operator|->
name|l2_user
operator|=
name|c
operator|&
literal|0x7f
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
block|}
else|else
block|{
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L2_Q933_P
expr_stmt|;
name|ie
operator|->
name|l2_q933
operator|=
name|c
operator|&
literal|0x3
expr_stmt|;
name|ie
operator|->
name|l2_mode
operator|=
operator|(
name|c
operator|>>
literal|5
operator|)
operator|&
literal|0x3
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
block|{
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L2_WSIZ_P
expr_stmt|;
name|ie
operator|->
name|l2_wsiz
operator|=
name|c
operator|&
literal|0x7f
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
block|}
block|}
block|}
break|break;
case|case
name|UNI_BLLI_L3_ID
case|:
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L3_P
expr_stmt|;
name|ie
operator|->
name|l3
operator|=
name|c
operator|&
literal|0x1f
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|l3
condition|)
block|{
default|default:
case|case
name|UNI_BLLI_L3_CLMP
case|:
case|case
name|UNI_BLLI_L3_T70
case|:
goto|goto
name|rej
goto|;
case|case
name|UNI_BLLI_L3_X25
case|:
case|case
name|UNI_BLLI_L3_ISO8208
case|:
case|case
name|UNI_BLLI_L3_X223
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|l3_mode
operator|=
operator|(
name|c
operator|>>
literal|5
operator|)
operator|&
literal|0x3
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L3_MODE_P
expr_stmt|;
if|if
condition|(
name|c
operator|&
literal|0x80
condition|)
break|break;
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|l3_psiz
operator|=
name|c
operator|&
literal|0xf
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L3_PSIZ_P
expr_stmt|;
if|if
condition|(
name|c
operator|&
literal|0x80
condition|)
break|break;
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|l3_wsiz
operator|=
name|c
operator|&
literal|0x7f
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L3_WSIZ_P
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
break|break;
case|case
name|UNI_BLLI_L3_TR9577
case|:
if|if
condition|(
name|ielen
operator|<
literal|2
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|-=
literal|2
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|l3_ipi
operator|=
operator|(
name|c
operator|<<
literal|1
operator|)
operator|&
literal|0xfe
expr_stmt|;
if|if
condition|(
name|c
operator|&
literal|0x80
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|l3_ipi
operator||=
name|c
operator|&
literal|1
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L3_IPI_P
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|l3_ipi
operator|!=
name|UNI_BLLI_L3_SNAP
condition|)
break|break;
if|if
condition|(
name|ielen
operator|<
literal|6
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|-=
literal|6
expr_stmt|;
if|if
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|!=
literal|0x80
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L3_SNAP_P
expr_stmt|;
name|ie
operator|->
name|oui
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|ie
operator|->
name|oui
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|oui
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|pid
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|pid
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
break|break;
case|case
name|UNI_BLLI_L3_H310
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|l3_ttype
operator|=
name|c
operator|&
literal|0xf
expr_stmt|;
name|ie
operator|->
name|l3_tcap
operator|=
operator|(
name|c
operator|>>
literal|4
operator|)
operator|&
literal|0x7
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L3_TTYPE_P
expr_stmt|;
if|if
condition|(
name|c
operator|&
literal|0x80
condition|)
break|break;
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|l3_fmux
operator|=
operator|(
name|c
operator|>>
literal|3
operator|)
operator|&
literal|7
expr_stmt|;
name|ie
operator|->
name|l3_bmux
operator|=
name|c
operator|&
literal|7
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L3_MUX_P
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
break|break;
case|case
name|UNI_BLLI_L3_USER
case|:
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|l3_user
operator|=
name|c
operator|&
literal|0x7f
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_BLLI_L3_USER_P
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
break|break;
block|}
block|}
break|break;
block|}
block|}
name|IE_END
argument_list|(
name|BLLI
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Broadband locking shift  * Broadband non-locking shift.  *  * References for this IE are:  *  *  Q.2931 pp. 41...42  *  UNI4.0 pp. 9  *  * Procedure not supported in UNI4.0, but IE's must be recognized.  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|lshift
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"locking_shift"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|lshift
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
name|ie
operator|=
name|ie
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|lshift
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|lshift
argument_list|,
name|UNI_IE_LSHIFT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
name|ie
operator|->
name|set
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|lshift
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|1
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|set
operator|=
name|c
operator|&
literal|7
expr_stmt|;
name|IE_END
argument_list|(
name|LSHIFT
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/***********************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|nlshift
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"nonlocking_shift"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|nlshift
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
name|ie
operator|=
name|ie
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|nlshift
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|nlshift
argument_list|,
name|UNI_IE_NLSHIFT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
name|ie
operator|->
name|set
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|nlshift
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|1
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|set
operator|=
name|c
operator|&
literal|7
expr_stmt|;
name|IE_END
argument_list|(
name|NLSHIFT
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Broadband Sending Complete Indicator  *  * References for this IE are:  *  *  Q.2931 pp. 74-75  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|scompl
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"sending_complete"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|scompl
argument_list|)
end_macro

begin_block
block|{
name|ie
operator|=
name|ie
expr_stmt|;
name|cx
operator|=
name|cx
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|scompl
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|scompl
argument_list|,
name|UNI_IE_SCOMPL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
literal|0x21
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|scompl
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|1
condition|)
goto|goto
name|rej
goto|;
if|if
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|!=
operator|(
literal|0x80
operator||
literal|0x21
operator|)
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|SCOMPL
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Broadband Repeat Indicator  *  * References for this IE are:  *  *  Q.2931 p.  73  *  PNNI1.0 p. 196  *  * Q.2931 has table 4-19. Only codepoints 0x2 and 0xa (for PNNI) supported.  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|repeat
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_REPEAT_PRIDESC
argument_list|,
name|desc
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_REPEAT_STACK
argument_list|,
name|stack
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"repeat"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"type"
argument_list|,
name|ie
operator|->
name|type
argument_list|,
name|tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|repeat
argument_list|)
end_macro

begin_block
block|{
switch|switch
condition|(
name|ie
operator|->
name|type
condition|)
block|{
case|case
name|UNI_REPEAT_PRIDESC
case|:
break|break;
case|case
name|UNI_REPEAT_STACK
case|:
if|if
condition|(
operator|!
name|cx
operator|->
name|pnni
condition|)
return|return
operator|-
literal|1
return|;
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|repeat
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|repeat
argument_list|,
name|UNI_IE_REPEAT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
name|ie
operator|->
name|type
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|repeat
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|1
condition|)
goto|goto
name|rej
goto|;
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|type
operator|=
name|c
operator|&
literal|0xf
expr_stmt|;
name|IE_END
argument_list|(
name|REPEAT
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Transit Network Selection  *  * References for this IE are:  *  *  Q.2931 pp. 75...76  *  UNI4.0 pp. 17  *  * According to UNI4.0 this is always National Network Id/Carried Id.  *  * ITU-T/Net coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|tns
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"tns"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"net"
argument_list|,
literal|"%u,\""
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|'"'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ie
operator|->
name|net
index|[
name|i
index|]
operator|<
literal|' '
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"^%c"
argument_list|,
name|ie
operator|->
name|net
index|[
name|i
index|]
operator|+
literal|'@'
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ie
operator|->
name|net
index|[
name|i
index|]
operator|<
literal|'~'
condition|)
name|uni_putc
argument_list|(
name|ie
operator|->
name|net
index|[
name|i
index|]
argument_list|,
name|cx
argument_list|)
expr_stmt|;
else|else
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"\\%03o"
argument_list|,
name|ie
operator|->
name|net
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|uni_putc
argument_list|(
literal|'"'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|tns
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|i
decl_stmt|;
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|len
operator|==
literal|0
operator|||
name|ie
operator|->
name|len
operator|>
name|UNI_TNS_MAXLEN
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|len
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|ie
operator|->
name|net
index|[
name|i
index|]
operator|<
literal|' '
operator|||
name|ie
operator|->
name|net
index|[
name|i
index|]
operator|>
literal|'~'
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|tns
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|tns
argument_list|,
name|UNI_IE_TNS
argument_list|,
name|ie
operator|->
name|len
operator|+
literal|1
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
operator|(
literal|0x2
operator|<<
literal|4
operator|)
operator||
literal|0x1
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|net
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|tns
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|<
literal|2
operator|||
name|ielen
operator|>
literal|5
condition|)
goto|goto
name|rej
goto|;
if|if
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|!=
operator|(
literal|0x80
operator||
operator|(
literal|0x2
operator|<<
literal|4
operator|)
operator||
literal|0x1
operator|)
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|len
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|ielen
operator|--
condition|)
name|ie
operator|->
name|net
index|[
name|ie
operator|->
name|len
operator|++
index|]
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|IE_END
argument_list|(
name|TNS
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Restart indicator  *  * References for this IE are:  *  *  Q.2931 pp. 73...74  *  UNI4.0 p.  17  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|restart
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_RESTART_CHANNEL
argument_list|,
name|channel
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_RESTART_PATH
argument_list|,
name|path
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_RESTART_ALL
argument_list|,
name|all
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"restart"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"class"
argument_list|,
name|ie
operator|->
name|rclass
argument_list|,
name|tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|restart
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|rclass
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_RESTART_CHANNEL
case|:
case|case
name|UNI_RESTART_PATH
case|:
case|case
name|UNI_RESTART_ALL
case|:
break|break;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|restart
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|restart
argument_list|,
name|UNI_IE_RESTART
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
name|ie
operator|->
name|rclass
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|restart
argument_list|)
end_macro

begin_block
block|{
name|u_char
name|c
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|rclass
operator|=
operator|(
name|c
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|)
operator|&
literal|0x7
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|c
operator|&
literal|0x80
operator|)
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|RESTART
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * User-to-user info.  *  * References for this IE are:  *  *  Q.2957  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|uu
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"uu"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"len"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"info"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|len
condition|;
name|i
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s0x%02x"
argument_list|,
name|i
operator|==
literal|0
condition|?
literal|""
else|:
literal|" "
argument_list|,
name|ie
operator|->
name|uu
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|uu
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|len
operator|>
name|UNI_UU_MAXLEN
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|uu
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|uu
argument_list|,
name|UNI_IE_UU
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|uu
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|uu
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
name|UNI_UU_MAXLEN
operator|||
name|ielen
operator|<
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|len
operator|=
name|ielen
expr_stmt|;
name|ielen
operator|=
literal|0
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|ie
operator|->
name|uu
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
name|ie
operator|->
name|len
expr_stmt|;
name|IE_END
argument_list|(
name|UU
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Generic Identifier Transport  *  * References for this IE are:  *  *  UNI4.0 pp. 26...28  *  * UNI4.0 prescribes a fixed format for this IE. We have a flag in the  * context structur, which tells us whether the check of this IE should be  * hard or soft. Probably it should be hard for end systems and soft for  * network nodes.  *  * Only Net Coding allowed. (XXX)  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|git
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|std_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_GIT_STD_DSMCC
argument_list|,
name|dsmcc
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_GIT_STD_H245
argument_list|,
name|H
literal|.245
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|type_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_GIT_TYPE_SESS
argument_list|,
name|sess
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_GIT_TYPE_RES
argument_list|,
name|res
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
name|u_int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|char
name|buf
index|[
literal|20
index|]
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"git"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"std"
argument_list|,
name|ie
operator|->
name|std
argument_list|,
name|std_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_push_prefix
argument_list|(
literal|"id"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|numsub
condition|;
name|i
operator|++
control|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%u"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
name|buf
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|uni_print_tbl
argument_list|(
name|NULL
argument_list|,
name|ie
operator|->
name|sub
index|[
name|i
index|]
operator|.
name|type
argument_list|,
name|type_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|ie
operator|->
name|sub
index|[
name|i
index|]
operator|.
name|len
condition|;
name|j
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|",0x%02x"
argument_list|,
name|ie
operator|->
name|sub
index|[
name|i
index|]
operator|.
name|val
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
name|cx
operator|->
name|indent
operator|--
expr_stmt|;
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|git
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|cx
operator|->
name|git_hard
condition|)
block|{
switch|switch
condition|(
name|ie
operator|->
name|std
condition|)
block|{
case|case
name|UNI_GIT_STD_DSMCC
case|:
case|case
name|UNI_GIT_STD_H245
case|:
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|numsub
operator|!=
literal|2
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|sub
index|[
literal|0
index|]
operator|.
name|type
operator|!=
name|UNI_GIT_TYPE_SESS
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|sub
index|[
literal|0
index|]
operator|.
name|len
operator|>
name|UNI_GIT_MAXSESS
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|sub
index|[
literal|1
index|]
operator|.
name|type
operator|!=
name|UNI_GIT_TYPE_RES
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|sub
index|[
literal|1
index|]
operator|.
name|len
operator|>
name|UNI_GIT_MAXRES
condition|)
return|return
operator|-
literal|1
return|;
block|}
else|else
block|{
if|if
condition|(
name|ie
operator|->
name|numsub
operator|>
name|UNI_GIT_MAXSUB
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|numsub
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|ie
operator|->
name|sub
index|[
name|i
index|]
operator|.
name|len
operator|>
name|UNI_GIT_MAXVAL
condition|)
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|git
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|i
decl_stmt|;
name|START_IE
argument_list|(
name|git
argument_list|,
name|UNI_IE_GIT
argument_list|,
literal|1
operator|+
name|ie
operator|->
name|numsub
operator|*
operator|(
literal|1
operator|+
name|UNI_GIT_MAXVAL
operator|)
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|std
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|numsub
condition|;
name|i
operator|++
control|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|sub
index|[
name|i
index|]
operator|.
name|type
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|sub
index|[
name|i
index|]
operator|.
name|len
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|sub
index|[
name|i
index|]
operator|.
name|val
argument_list|,
name|ie
operator|->
name|sub
index|[
name|i
index|]
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|git
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|1
operator|+
name|UNI_GIT_MAXSUB
operator|*
operator|(
literal|1
operator|+
name|UNI_GIT_MAXVAL
operator|)
operator|||
name|ielen
operator|<
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|std
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|numsub
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|ielen
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|numsub
operator|>=
name|UNI_GIT_MAXSUB
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|sub
index|[
name|ie
operator|->
name|numsub
index|]
operator|.
name|type
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
name|ielen
operator|==
literal|0
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|sub
index|[
name|ie
operator|->
name|numsub
index|]
operator|.
name|len
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|sub
index|[
name|ie
operator|->
name|numsub
index|]
operator|.
name|len
operator|>
name|UNI_GIT_MAXVAL
condition|)
goto|goto
name|rej
goto|;
if|if
condition|(
name|ie
operator|->
name|sub
index|[
name|ie
operator|->
name|numsub
index|]
operator|.
name|len
operator|>
operator|(
name|u_int
operator|)
name|ielen
condition|)
goto|goto
name|rej
goto|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|ie
operator|->
name|sub
index|[
name|ie
operator|->
name|numsub
index|]
operator|.
name|val
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
name|ie
operator|->
name|sub
index|[
name|ie
operator|->
name|numsub
index|]
operator|.
name|len
argument_list|)
expr_stmt|;
name|ielen
operator|-=
name|ie
operator|->
name|sub
index|[
name|ie
operator|->
name|numsub
index|]
operator|.
name|len
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
name|ie
operator|->
name|sub
index|[
name|ie
operator|->
name|numsub
index|]
operator|.
name|len
expr_stmt|;
name|ie
operator|->
name|numsub
operator|++
expr_stmt|;
block|}
name|IE_END
argument_list|(
name|GIT
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Additional ABR Parameters  * ABR Setup parameters  *  * References for this IE are:  *  *  	UNI4.0 pp. 78...82  *	PNNI1.0 p. 195  *  * Notes:  *	Only NET coding.  */
end_comment

begin_function
specifier|static
name|void
name|print_abr_rec
parameter_list|(
name|struct
name|unicx
modifier|*
name|cx
parameter_list|,
name|struct
name|uni_abr_rec
modifier|*
name|rec
parameter_list|)
block|{
if|if
condition|(
name|rec
operator|->
name|present
operator|&
name|UNI_ABR_REC_NRM_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"nrm"
argument_list|,
literal|"%d"
argument_list|,
name|rec
operator|->
name|nrm
argument_list|)
expr_stmt|;
if|if
condition|(
name|rec
operator|->
name|present
operator|&
name|UNI_ABR_REC_TRM_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"trm"
argument_list|,
literal|"%d"
argument_list|,
name|rec
operator|->
name|trm
argument_list|)
expr_stmt|;
if|if
condition|(
name|rec
operator|->
name|present
operator|&
name|UNI_ABR_REC_CDF_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"cdf"
argument_list|,
literal|"%d"
argument_list|,
name|rec
operator|->
name|cdf
argument_list|)
expr_stmt|;
if|if
condition|(
name|rec
operator|->
name|present
operator|&
name|UNI_ABR_REC_ADTF_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"adtf"
argument_list|,
literal|"%d"
argument_list|,
name|rec
operator|->
name|adtf
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|abradd
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"abradd"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_push_prefix
argument_list|(
literal|"fwd"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|print_abr_rec
argument_list|(
name|cx
argument_list|,
operator|&
name|ie
operator|->
name|fwd
argument_list|)
expr_stmt|;
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_push_prefix
argument_list|(
literal|"bwd"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|print_abr_rec
argument_list|(
name|cx
argument_list|,
operator|&
name|ie
operator|->
name|bwd
argument_list|)
expr_stmt|;
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|abradd
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
name|ie
operator|=
name|ie
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_function
specifier|static
name|u_int
name|encode_abr_rec
parameter_list|(
name|struct
name|uni_abr_rec
modifier|*
name|rec
parameter_list|)
block|{
name|u_int
name|ret
init|=
name|rec
operator|->
name|present
operator|&
literal|0xf000
decl_stmt|;
if|if
condition|(
name|ret
operator|&
name|UNI_ABR_REC_NRM_P
condition|)
name|ret
operator||=
operator|(
name|rec
operator|->
name|nrm
operator|&
literal|0x7
operator|)
operator|<<
literal|25
expr_stmt|;
if|if
condition|(
name|ret
operator|&
name|UNI_ABR_REC_TRM_P
condition|)
name|ret
operator||=
operator|(
name|rec
operator|->
name|trm
operator|&
literal|0x7
operator|)
operator|<<
literal|22
expr_stmt|;
if|if
condition|(
name|ret
operator|&
name|UNI_ABR_REC_CDF_P
condition|)
name|ret
operator||=
operator|(
name|rec
operator|->
name|cdf
operator|&
literal|0x7
operator|)
operator|<<
literal|19
expr_stmt|;
if|if
condition|(
name|ret
operator|&
name|UNI_ABR_REC_ADTF_P
condition|)
name|ret
operator||=
operator|(
name|rec
operator|->
name|adtf
operator|&
literal|0x3ff
operator|)
operator|<<
literal|9
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|abradd
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|abradd
argument_list|,
name|UNI_IE_ABRADD
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|APP_SUB_32BIT
argument_list|(
name|msg
argument_list|,
name|UNI_ABRADD_FADD_ID
argument_list|,
name|encode_abr_rec
argument_list|(
operator|&
name|ie
operator|->
name|fwd
argument_list|)
argument_list|)
expr_stmt|;
name|APP_SUB_32BIT
argument_list|(
name|msg
argument_list|,
name|UNI_ABRADD_BADD_ID
argument_list|,
name|encode_abr_rec
argument_list|(
operator|&
name|ie
operator|->
name|bwd
argument_list|)
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_function
specifier|static
name|int
name|decode_abr_rec
parameter_list|(
name|struct
name|uni_msg
modifier|*
name|msg
parameter_list|,
name|struct
name|uni_abr_rec
modifier|*
name|rec
parameter_list|)
block|{
name|u_int
name|val
decl_stmt|;
name|val
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|24
expr_stmt|;
name|val
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|val
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|val
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|0
expr_stmt|;
name|rec
operator|->
name|present
operator|=
name|val
operator|&
literal|0xf000
expr_stmt|;
name|rec
operator|->
name|nrm
operator|=
operator|(
name|val
operator|&
name|UNI_ABR_REC_NRM_P
operator|)
condition|?
operator|(
operator|(
name|val
operator|>>
literal|25
operator|)
operator|&
literal|0x7
operator|)
else|:
literal|0
expr_stmt|;
name|rec
operator|->
name|trm
operator|=
operator|(
name|val
operator|&
name|UNI_ABR_REC_TRM_P
operator|)
condition|?
operator|(
operator|(
name|val
operator|>>
literal|22
operator|)
operator|&
literal|0x7
operator|)
else|:
literal|0
expr_stmt|;
name|rec
operator|->
name|cdf
operator|=
operator|(
name|val
operator|&
name|UNI_ABR_REC_CDF_P
operator|)
condition|?
operator|(
operator|(
name|val
operator|>>
literal|19
operator|)
operator|&
literal|0x7
operator|)
else|:
literal|0
expr_stmt|;
name|rec
operator|->
name|adtf
operator|=
operator|(
name|val
operator|&
name|UNI_ABR_REC_ADTF_P
operator|)
condition|?
operator|(
operator|(
name|val
operator|>>
literal|9
operator|)
operator|&
literal|0x3ff
operator|)
else|:
literal|0
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|abradd
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|10
condition|)
goto|goto
name|rej
goto|;
while|while
condition|(
name|ielen
operator|--
condition|)
block|{
switch|switch
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
default|default:
goto|goto
name|rej
goto|;
case|case
name|UNI_ABRADD_FADD_ID
case|:
if|if
condition|(
name|decode_abr_rec
argument_list|(
name|msg
argument_list|,
operator|&
name|ie
operator|->
name|fwd
argument_list|)
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|-=
literal|4
expr_stmt|;
break|break;
case|case
name|UNI_ABRADD_BADD_ID
case|:
if|if
condition|(
name|decode_abr_rec
argument_list|(
name|msg
argument_list|,
operator|&
name|ie
operator|->
name|bwd
argument_list|)
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|-=
literal|4
expr_stmt|;
break|break;
block|}
block|}
name|IE_END
argument_list|(
name|ABRADD
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|abrsetup
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"abrsetup"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"rm_frt"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|rmfrt
argument_list|)
expr_stmt|;
name|uni_print_push_prefix
argument_list|(
literal|"fwd"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FICR_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"icr"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|ficr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FTBE_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"tbe"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|ftbe
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FRIF_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"rif"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|frif
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FRDF_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"rdf"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|frdf
argument_list|)
expr_stmt|;
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_push_prefix
argument_list|(
literal|"bwd"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BICR_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"icr"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|bicr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BTBE_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"tbe"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|btbe
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BRIF_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"rif"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|brif
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BRDF_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"rdf"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|brdf
argument_list|)
expr_stmt|;
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|abrsetup
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|cx
operator|->
name|pnni
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FICR_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BICR_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FTBE_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BTBE_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FRIF_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BRIF_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FRDF_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BRDF_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_RMFRT_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_RMFRT_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FICR_P
condition|)
if|if
condition|(
name|ie
operator|->
name|ficr
operator|>=
literal|1
operator|<<
literal|24
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BICR_P
condition|)
if|if
condition|(
name|ie
operator|->
name|bicr
operator|>=
literal|1
operator|<<
literal|24
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FTBE_P
condition|)
if|if
condition|(
name|ie
operator|->
name|ftbe
operator|>=
literal|1
operator|<<
literal|24
operator|||
name|ie
operator|->
name|ftbe
operator|==
literal|0
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BTBE_P
condition|)
if|if
condition|(
name|ie
operator|->
name|btbe
operator|>=
literal|1
operator|<<
literal|24
operator|||
name|ie
operator|->
name|btbe
operator|==
literal|0
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|rmfrt
operator|>=
literal|1
operator|<<
literal|24
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FRIF_P
condition|)
if|if
condition|(
name|ie
operator|->
name|frif
operator|>
literal|15
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_FRDF_P
condition|)
if|if
condition|(
name|ie
operator|->
name|frdf
operator|>
literal|15
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BRIF_P
condition|)
if|if
condition|(
name|ie
operator|->
name|brif
operator|>
literal|15
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_ABRSETUP_BRDF_P
condition|)
if|if
condition|(
name|ie
operator|->
name|brdf
operator|>
literal|15
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|abrsetup
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|abrsetup
argument_list|,
name|UNI_IE_ABRSETUP
argument_list|,
literal|32
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_ABRSETUP_FICR_P
argument_list|,
name|UNI_ABRSETUP_FICR_ID
argument_list|,
name|ie
operator|->
name|ficr
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_ABRSETUP_BICR_P
argument_list|,
name|UNI_ABRSETUP_BICR_ID
argument_list|,
name|ie
operator|->
name|bicr
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_ABRSETUP_FTBE_P
argument_list|,
name|UNI_ABRSETUP_FTBE_ID
argument_list|,
name|ie
operator|->
name|ftbe
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_ABRSETUP_BTBE_P
argument_list|,
name|UNI_ABRSETUP_BTBE_ID
argument_list|,
name|ie
operator|->
name|btbe
argument_list|)
expr_stmt|;
name|APP_SUB_24BIT
argument_list|(
name|msg
argument_list|,
name|UNI_ABRSETUP_RMFRT_ID
argument_list|,
name|ie
operator|->
name|rmfrt
argument_list|)
expr_stmt|;
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_ABRSETUP_FRIF_P
argument_list|,
name|UNI_ABRSETUP_FRIF_ID
argument_list|,
name|ie
operator|->
name|frif
argument_list|)
expr_stmt|;
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_ABRSETUP_BRIF_P
argument_list|,
name|UNI_ABRSETUP_BRIF_ID
argument_list|,
name|ie
operator|->
name|brif
argument_list|)
expr_stmt|;
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_ABRSETUP_FRDF_P
argument_list|,
name|UNI_ABRSETUP_FRDF_ID
argument_list|,
name|ie
operator|->
name|frdf
argument_list|)
expr_stmt|;
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_ABRSETUP_BRDF_P
argument_list|,
name|UNI_ABRSETUP_BRDF_ID
argument_list|,
name|ie
operator|->
name|brdf
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|abrsetup
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|<
literal|4
operator|||
name|ielen
operator|>
literal|32
condition|)
goto|goto
name|rej
goto|;
while|while
condition|(
name|ielen
operator|--
condition|)
block|{
switch|switch
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
default|default:
goto|goto
name|rej
goto|;
name|DEC_GETF3
argument_list|(
name|ABRSETUP_FICR
argument_list|,
name|ficr
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|ABRSETUP_BICR
argument_list|,
name|bicr
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|ABRSETUP_FTBE
argument_list|,
name|ftbe
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|ABRSETUP_BTBE
argument_list|,
name|btbe
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF1
argument_list|(
name|ABRSETUP_FRIF
argument_list|,
name|frif
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF1
argument_list|(
name|ABRSETUP_BRIF
argument_list|,
name|brif
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF1
argument_list|(
name|ABRSETUP_FRDF
argument_list|,
name|frdf
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF1
argument_list|(
name|ABRSETUP_BRDF
argument_list|,
name|brdf
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|ABRSETUP_RMFRT
argument_list|,
name|frif
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
block|}
block|}
name|IE_END
argument_list|(
name|ABRSETUP
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Broadband report type  *  * References for this IE are:  *  *  Q.2963.1  pp. 7...8  *  * Only ITU-T coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|report
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_REPORT_MODCONF
argument_list|,
name|modconf
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_REPORT_CLOCK
argument_list|,
name|clock
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_REPORT_EEAVAIL
argument_list|,
name|eeavail
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_REPORT_EEREQ
argument_list|,
name|eereq
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_REPORT_EECOMPL
argument_list|,
name|eecompl
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"report"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"type"
argument_list|,
name|ie
operator|->
name|report
argument_list|,
name|tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|report
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|report
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_REPORT_MODCONF
case|:
case|case
name|UNI_REPORT_CLOCK
case|:
case|case
name|UNI_REPORT_EEAVAIL
case|:
case|case
name|UNI_REPORT_EEREQ
case|:
case|case
name|UNI_REPORT_EECOMPL
case|:
break|break;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|report
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|report
argument_list|,
name|UNI_IE_REPORT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|report
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|report
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|report
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|IE_END
argument_list|(
name|REPORT
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Soft PVPC/PVCC  *  * References for this IE are:  *  *  PNNI1.0 pp. 201...203  *  * Only NET coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|calling_soft
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"calling_soft"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"vpi"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|vpi
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLING_SOFT_VCI_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"vci"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|vci
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|called_soft
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|tab
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_SOFT_SEL_ANY
argument_list|,
name|any
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_SOFT_SEL_REQ
argument_list|,
name|required
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_SOFT_SEL_ASS
argument_list|,
name|assigned
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"called_soft"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"selection"
argument_list|,
name|ie
operator|->
name|sel
argument_list|,
name|tab
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLED_SOFT_VPI_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"vpi"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|vpi
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLED_SOFT_VCI_P
condition|)
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"vci"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|vci
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|calling_soft
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|vpi
operator|>=
literal|1
operator|<<
literal|12
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|called_soft
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|sel
condition|)
block|{
case|case
name|UNI_SOFT_SEL_ANY
case|:
case|case
name|UNI_SOFT_SEL_REQ
case|:
case|case
name|UNI_SOFT_SEL_ASS
case|:
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLED_SOFT_VPI_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|vpi
operator|>=
literal|1
operator|<<
literal|12
condition|)
return|return
operator|-
literal|1
return|;
block|}
else|else
block|{
if|if
condition|(
name|ie
operator|->
name|sel
operator|!=
name|UNI_SOFT_SEL_ANY
condition|)
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLED_SOFT_VCI_P
condition|)
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLED_SOFT_VPI_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|calling_soft
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|calling_soft
argument_list|,
name|UNI_IE_CALLING_SOFT
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x81
argument_list|)
expr_stmt|;
name|APP_16BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|vpi
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLING_SOFT_VCI_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x82
argument_list|)
expr_stmt|;
name|APP_16BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|vci
argument_list|)
expr_stmt|;
block|}
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|called_soft
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|called_soft
argument_list|,
name|UNI_IE_CALLED_SOFT
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|sel
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLED_SOFT_VPI_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x81
argument_list|)
expr_stmt|;
name|APP_16BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|vpi
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CALLED_SOFT_VCI_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x82
argument_list|)
expr_stmt|;
name|APP_16BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|vci
argument_list|)
expr_stmt|;
block|}
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|calling_soft
argument_list|)
end_macro

begin_block
block|{
name|int
name|vci_seen
decl_stmt|,
name|vpi_seen
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|<
literal|3
condition|)
goto|goto
name|rej
goto|;
name|vci_seen
operator|=
literal|0
expr_stmt|;
name|vpi_seen
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|ielen
condition|)
block|{
switch|switch
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
case|case
literal|0x81
case|:
if|if
condition|(
operator|!
name|vpi_seen
condition|)
block|{
name|ie
operator|->
name|vpi
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|vpi
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
block|}
else|else
block|{
name|msg
operator|->
name|b_rptr
operator|+=
literal|2
expr_stmt|;
block|}
name|ielen
operator|-=
literal|3
expr_stmt|;
break|break;
case|case
literal|0x82
case|:
if|if
condition|(
operator|!
name|vci_seen
condition|)
block|{
name|ie
operator|->
name|vci
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|vci
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
block|}
else|else
block|{
name|msg
operator|->
name|b_rptr
operator|+=
literal|2
expr_stmt|;
block|}
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CALLING_SOFT_VCI_P
expr_stmt|;
name|ielen
operator|-=
literal|3
expr_stmt|;
break|break;
default|default:
goto|goto
name|rej
goto|;
block|}
block|}
if|if
condition|(
operator|!
name|vpi_seen
condition|)
goto|goto
name|rej
goto|;
name|IE_END
argument_list|(
name|CALLING_SOFT
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|called_soft
argument_list|)
end_macro

begin_block
block|{
name|int
name|vci_seen
decl_stmt|,
name|vpi_seen
decl_stmt|;
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|<
literal|3
condition|)
goto|goto
name|rej
goto|;
name|vci_seen
operator|=
literal|0
expr_stmt|;
name|vpi_seen
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|ielen
condition|)
block|{
switch|switch
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
case|case
literal|0x81
case|:
if|if
condition|(
operator|!
name|vpi_seen
condition|)
block|{
name|ie
operator|->
name|vpi
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|vpi
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|vpi_seen
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|msg
operator|->
name|b_rptr
operator|+=
literal|2
expr_stmt|;
block|}
name|ielen
operator|-=
literal|3
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CALLED_SOFT_VCI_P
expr_stmt|;
break|break;
case|case
literal|0x82
case|:
if|if
condition|(
operator|!
name|vci_seen
condition|)
block|{
name|ie
operator|->
name|vci
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|vci
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|vci_seen
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|msg
operator|->
name|b_rptr
operator|+=
literal|2
expr_stmt|;
block|}
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CALLED_SOFT_VCI_P
expr_stmt|;
name|ielen
operator|-=
literal|3
expr_stmt|;
break|break;
default|default:
goto|goto
name|rej
goto|;
block|}
block|}
name|IE_END
argument_list|(
name|CALLED_SOFT
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Crankback  *  * References for this IE are:  *  *  PNNI1.0 pp. 203...206  *  * Only NET coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|crankback
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|j
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"crankback"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"level"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|level
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|type
condition|)
block|{
case|case
name|UNI_CRANKBACK_IF
case|:
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"type"
argument_list|,
literal|"interface"
argument_list|)
expr_stmt|;
break|break;
case|case
name|UNI_CRANKBACK_NODE
case|:
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"type"
argument_list|,
literal|"node"
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"node"
argument_list|,
literal|"{%d/"
argument_list|,
name|ie
operator|->
name|id
operator|.
name|node
operator|.
name|level
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|21
condition|;
name|j
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%02x"
argument_list|,
name|ie
operator|->
name|id
operator|.
name|node
operator|.
name|id
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"}"
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
break|break;
case|case
name|UNI_CRANKBACK_LINK
case|:
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"type"
argument_list|,
literal|"link"
argument_list|)
expr_stmt|;
name|uni_print_push_prefix
argument_list|(
literal|"link"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"prec"
argument_list|,
literal|"{%d/"
argument_list|,
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|plevel
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|21
condition|;
name|j
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%02x"
argument_list|,
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|pid
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"}"
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"port"
argument_list|,
literal|"0x%04x"
argument_list|,
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|port
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"succ"
argument_list|,
literal|"{%d/"
argument_list|,
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|slevel
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|21
condition|;
name|j
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%02x"
argument_list|,
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|sid
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"}"
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|--
expr_stmt|;
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
break|break;
default|default:
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"type"
argument_list|,
literal|"0x%02x"
argument_list|,
name|ie
operator|->
name|type
argument_list|)
expr_stmt|;
break|break;
block|}
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"cause"
argument_list|,
literal|"0x%02x"
argument_list|,
name|ie
operator|->
name|cause
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CRANKBACK_TOP_P
condition|)
block|{
name|uni_print_push_prefix
argument_list|(
literal|"topol"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"dir"
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|dir
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"port"
argument_list|,
literal|"0x%04x"
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|port
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"avcr"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|avcr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CRANKBACK_TOPX_P
condition|)
block|{
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"crm"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|crm
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"vf"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|vf
argument_list|)
expr_stmt|;
block|}
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CRANKBACK_QOS_P
condition|)
block|{
name|uni_print_push_prefix
argument_list|(
literal|"qos"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"ctd"
argument_list|,
literal|"%savail"
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|ctd
condition|?
literal|""
else|:
literal|"un"
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"cdv"
argument_list|,
literal|"%savail"
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|cdv
condition|?
literal|""
else|:
literal|"un"
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"clr"
argument_list|,
literal|"%savail"
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|clr
condition|?
literal|""
else|:
literal|"un"
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"other"
argument_list|,
literal|"%savail"
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|other
condition|?
literal|""
else|:
literal|"un"
argument_list|)
expr_stmt|;
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|crankback
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|level
operator|>
literal|104
condition|)
return|return
operator|-
literal|1
return|;
switch|switch
condition|(
name|ie
operator|->
name|type
condition|)
block|{
case|case
name|UNI_CRANKBACK_IF
case|:
break|break;
case|case
name|UNI_CRANKBACK_NODE
case|:
if|if
condition|(
name|ie
operator|->
name|id
operator|.
name|node
operator|.
name|level
operator|>
literal|104
condition|)
return|return
operator|-
literal|1
return|;
break|break;
case|case
name|UNI_CRANKBACK_LINK
case|:
if|if
condition|(
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|plevel
operator|>
literal|104
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|slevel
operator|>
literal|104
condition|)
return|return
operator|-
literal|1
return|;
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CRANKBACK_TOP_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CRANKBACK_QOS_P
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|cause
operator|!=
name|UNI_CAUSE_CRATE_NAVL
condition|)
return|return
operator|-
literal|1
return|;
switch|switch
condition|(
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|dir
condition|)
block|{
case|case
literal|0x00
case|:
case|case
literal|0x01
case|:
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CRANKBACK_QOS_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|cause
operator|!=
name|UNI_CAUSE_QOS_NAVL
condition|)
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|crankback
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|crankback
argument_list|,
name|UNI_IE_CRANKBACK
argument_list|,
literal|72
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|level
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|type
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|type
condition|)
block|{
case|case
name|UNI_CRANKBACK_IF
case|:
break|break;
case|case
name|UNI_CRANKBACK_NODE
case|:
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|id
operator|.
name|node
operator|.
name|level
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|id
operator|.
name|node
operator|.
name|id
argument_list|,
literal|21
argument_list|)
expr_stmt|;
break|break;
case|case
name|UNI_CRANKBACK_LINK
case|:
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|plevel
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|pid
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|APP_32BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|port
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|slevel
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|sid
argument_list|,
literal|21
argument_list|)
expr_stmt|;
break|break;
block|}
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|cause
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CRANKBACK_TOP_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|dir
argument_list|)
expr_stmt|;
name|APP_32BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|port
argument_list|)
expr_stmt|;
name|APP_32BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|avcr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CRANKBACK_TOPX_P
condition|)
block|{
name|APP_32BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|crm
argument_list|)
expr_stmt|;
name|APP_32BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|vf
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_CRANKBACK_QOS_P
condition|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
operator|(
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|ctd
operator|<<
literal|3
operator|)
operator||
operator|(
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|cdv
operator|<<
literal|2
operator|)
operator||
operator|(
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|clr
operator|<<
literal|1
operator|)
operator||
operator|(
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|other
operator|)
argument_list|)
expr_stmt|;
block|}
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|crankback
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|<
literal|3
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|level
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|type
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|type
condition|)
block|{
default|default:
goto|goto
name|rej
goto|;
case|case
name|UNI_CRANKBACK_IF
case|:
break|break;
case|case
name|UNI_CRANKBACK_NODE
case|:
if|if
condition|(
name|ielen
operator|<
literal|22
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|id
operator|.
name|node
operator|.
name|level
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|ie
operator|->
name|id
operator|.
name|node
operator|.
name|id
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
literal|21
expr_stmt|;
name|ielen
operator|-=
literal|22
expr_stmt|;
break|break;
case|case
name|UNI_CRANKBACK_LINK
case|:
if|if
condition|(
name|ielen
operator|<
literal|48
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|plevel
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|pid
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
literal|21
expr_stmt|;
name|ielen
operator|-=
literal|22
expr_stmt|;
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|port
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|24
expr_stmt|;
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|port
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|port
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|port
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|0
expr_stmt|;
name|ielen
operator|-=
literal|4
expr_stmt|;
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|slevel
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|ie
operator|->
name|id
operator|.
name|link
operator|.
name|sid
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
literal|21
expr_stmt|;
name|ielen
operator|-=
literal|22
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|ielen
operator|<
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|cause
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|cause
operator|==
name|UNI_CAUSE_CRATE_NAVL
condition|)
block|{
if|if
condition|(
name|ielen
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|ielen
operator|!=
literal|9
operator|&&
name|ielen
operator|!=
literal|17
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|dir
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|port
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|24
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|port
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|port
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|port
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|0
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|avcr
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|24
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|avcr
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|avcr
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|avcr
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|0
expr_stmt|;
name|ielen
operator|-=
literal|9
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CRANKBACK_TOP_P
expr_stmt|;
if|if
condition|(
name|ielen
operator|>
literal|0
condition|)
block|{
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|crm
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|24
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|crm
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|crm
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|crm
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|0
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|vf
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|24
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|vf
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|vf
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|top
operator|.
name|vf
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|0
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CRANKBACK_TOPX_P
expr_stmt|;
name|ielen
operator|-=
literal|8
expr_stmt|;
block|}
block|}
block|}
elseif|else
if|if
condition|(
name|ie
operator|->
name|cause
operator|==
name|UNI_CAUSE_QOS_NAVL
condition|)
block|{
if|if
condition|(
name|ielen
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|ielen
operator|!=
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|ctd
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|>>
literal|3
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|cdv
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|>>
literal|2
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|clr
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|>>
literal|1
expr_stmt|;
name|ie
operator|->
name|diag
operator|.
name|qos
operator|.
name|other
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|>>
literal|0
expr_stmt|;
name|ie
operator|->
name|h
operator|.
name|present
operator||=
name|UNI_CRANKBACK_QOS_P
expr_stmt|;
name|ielen
operator|-=
literal|1
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|ielen
operator|>
literal|0
condition|)
goto|goto
name|rej
goto|;
block|}
name|IE_END
argument_list|(
name|CRANKBACK
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Designated transit list  *  * References for this IE are:  *  *  PNNI1.0 pp. 206...208  *  * Only NET coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|dtl
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|char
name|buf
index|[
literal|10
index|]
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"dtl"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"ptr"
argument_list|,
literal|"%d(%d)"
argument_list|,
name|ie
operator|->
name|ptr
argument_list|,
name|ie
operator|->
name|ptr
operator|/
name|UNI_DTL_LOGNP_SIZE
argument_list|)
expr_stmt|;
name|uni_print_push_prefix
argument_list|(
literal|"dtl"
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|cx
operator|->
name|indent
operator|++
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"{"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|num
condition|;
name|i
operator|++
control|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
name|buf
argument_list|,
literal|"{%d/"
argument_list|,
name|ie
operator|->
name|dtl
index|[
name|i
index|]
operator|.
name|node_level
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|21
condition|;
name|j
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%02x"
argument_list|,
name|ie
operator|->
name|dtl
index|[
name|i
index|]
operator|.
name|node_id
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|",%04x}"
argument_list|,
name|ie
operator|->
name|dtl
index|[
name|i
index|]
operator|.
name|port_id
argument_list|)
expr_stmt|;
name|uni_print_eol
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
name|cx
operator|->
name|indent
operator|--
expr_stmt|;
name|uni_print_pop_prefix
argument_list|(
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|dtl
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|i
decl_stmt|;
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|ptr
operator|%
name|UNI_DTL_LOGNP_SIZE
operator|!=
literal|0
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|ptr
operator|/
name|UNI_DTL_LOGNP_SIZE
operator|>
name|UNI_DTL_MAXNUM
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|num
operator|>
name|UNI_DTL_MAXNUM
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|num
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|ie
operator|->
name|dtl
index|[
name|i
index|]
operator|.
name|node_level
operator|>
literal|104
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|dtl
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|i
decl_stmt|;
name|START_IE
argument_list|(
name|dtl
argument_list|,
name|UNI_IE_DTL
argument_list|,
literal|2
operator|+
name|UNI_DTL_LOGNP_SIZE
operator|*
name|ie
operator|->
name|num
argument_list|)
expr_stmt|;
name|APP_16BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|ptr
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|num
condition|;
name|i
operator|++
control|)
block|{
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|UNI_DTL_LOGNP
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|dtl
index|[
name|i
index|]
operator|.
name|node_level
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|dtl
index|[
name|i
index|]
operator|.
name|node_id
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|APP_32BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|dtl
index|[
name|i
index|]
operator|.
name|port_id
argument_list|)
expr_stmt|;
block|}
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|dtl
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|<
literal|2
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|ptr
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|ptr
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|ielen
operator|%
name|UNI_DTL_LOGNP_SIZE
operator|!=
literal|0
condition|)
goto|goto
name|rej
goto|;
if|if
condition|(
name|ielen
operator|/
name|UNI_DTL_LOGNP_SIZE
operator|>
name|UNI_DTL_MAXNUM
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|num
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|ielen
condition|)
block|{
if|if
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|!=
name|UNI_DTL_LOGNP
condition|)
goto|goto
name|rej
goto|;
name|ielen
operator|--
expr_stmt|;
name|ie
operator|->
name|dtl
index|[
name|ie
operator|->
name|num
index|]
operator|.
name|node_level
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|ie
operator|->
name|dtl
index|[
name|ie
operator|->
name|num
index|]
operator|.
name|node_id
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
literal|21
expr_stmt|;
name|ielen
operator|-=
literal|21
expr_stmt|;
name|ie
operator|->
name|dtl
index|[
name|ie
operator|->
name|num
index|]
operator|.
name|port_id
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|24
expr_stmt|;
name|ie
operator|->
name|dtl
index|[
name|ie
operator|->
name|num
index|]
operator|.
name|port_id
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|ie
operator|->
name|dtl
index|[
name|ie
operator|->
name|num
index|]
operator|.
name|port_id
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|dtl
index|[
name|ie
operator|->
name|num
index|]
operator|.
name|port_id
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|0
expr_stmt|;
name|ielen
operator|-=
literal|4
expr_stmt|;
name|ie
operator|->
name|num
operator|++
expr_stmt|;
block|}
name|IE_END
argument_list|(
name|DTL
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Leaf initiated join call identifier.  * Leaf initiated join parameters.  * Leaf initiated join sequence number.  *  * References for this IE are:  *  *  UNI4.0 pp. 46...48  *  * Only NET coding allowed.  */
end_comment

begin_comment
comment|/**********************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|lij_callid
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|type_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_LIJ_IDTYPE_ROOT
argument_list|,
name|root
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"lij_callid"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"type"
argument_list|,
name|ie
operator|->
name|type
argument_list|,
name|type_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"id"
argument_list|,
literal|"0x%x"
argument_list|,
name|ie
operator|->
name|callid
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|lij_callid
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|type
condition|)
block|{
case|case
name|UNI_LIJ_IDTYPE_ROOT
case|:
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|lij_callid
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|lij_callid
argument_list|,
name|UNI_IE_LIJ_CALLID
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
name|ie
operator|->
name|type
argument_list|)
expr_stmt|;
name|APP_32BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|callid
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|lij_callid
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|5
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|type
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|&
literal|0xf
expr_stmt|;
name|ie
operator|->
name|callid
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|24
expr_stmt|;
name|ie
operator|->
name|callid
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|ie
operator|->
name|callid
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|callid
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|0
expr_stmt|;
name|IE_END
argument_list|(
name|LIJ_CALLID
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/**********************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|lij_param
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|lscreen_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_LIJ_SCREEN_NETJOIN
argument_list|,
name|netjoin
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"lij_param"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"screen"
argument_list|,
name|ie
operator|->
name|screen
argument_list|,
name|lscreen_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|lij_param
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|screen
condition|)
block|{
case|case
name|UNI_LIJ_SCREEN_NETJOIN
case|:
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|lij_param
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|lij_param
argument_list|,
name|UNI_IE_LIJ_PARAM
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
literal|0x80
operator||
name|ie
operator|->
name|screen
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|lij_param
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|screen
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|&
literal|0xf
expr_stmt|;
name|IE_END
argument_list|(
name|LIJ_PARAM
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/**********************************************************************/
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|lij_seqno
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"lij_seqno"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"seqno"
argument_list|,
literal|"0x%x"
argument_list|,
name|ie
operator|->
name|seqno
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|lij_seqno
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
name|ie
operator|=
name|ie
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|lij_seqno
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|lij_seqno
argument_list|,
name|UNI_IE_LIJ_SEQNO
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|APP_32BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|seqno
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|lij_seqno
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|4
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|seqno
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|24
expr_stmt|;
name|ie
operator|->
name|seqno
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|16
expr_stmt|;
name|ie
operator|->
name|seqno
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|8
expr_stmt|;
name|ie
operator|->
name|seqno
operator||=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|<<
literal|0
expr_stmt|;
name|IE_END
argument_list|(
name|LIJ_SEQNO
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Connection scope  *  * References for this IE are:  *  *  UNI4.0 pp. 57...58  *  * Only NET coding allowed.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|cscope
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|type_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG
argument_list|,
name|org
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|scope_tbl
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_LOC
argument_list|,
name|local_network
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_LOC_P1
argument_list|,
name|local_network_plus_one
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_LOC_P2
argument_list|,
name|local_network_plus_two
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_SITE_M1
argument_list|,
name|site_minus_one
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_SITE
argument_list|,
name|intra_site
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_SITE_P1
argument_list|,
name|site_plus_one
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_ORG_M1
argument_list|,
name|organisation_minus_one
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_ORG
argument_list|,
name|intra_organisation
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_ORG_P1
argument_list|,
name|organisation_plus_one
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_COMM_M1
argument_list|,
name|community_minus_one
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_COMM
argument_list|,
name|intra_community
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_COMM_P1
argument_list|,
name|community_plus_one
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_REG
argument_list|,
name|regional
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_INTER
argument_list|,
name|inter_regional
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_CSCOPE_ORG_GLOBAL
argument_list|,
name|global
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"cscope"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"type"
argument_list|,
name|ie
operator|->
name|type
argument_list|,
name|type_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|type
operator|==
name|UNI_CSCOPE_ORG
condition|)
name|uni_print_tbl
argument_list|(
literal|"scope"
argument_list|,
operator|(
name|u_int
operator|)
name|ie
operator|->
name|scope
argument_list|,
name|scope_tbl
argument_list|,
name|cx
argument_list|)
expr_stmt|;
else|else
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"scope"
argument_list|,
literal|"0x%02x"
argument_list|,
name|ie
operator|->
name|scope
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|cscope
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|type
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_CSCOPE_ORG
case|:
switch|switch
condition|(
name|ie
operator|->
name|scope
condition|)
block|{
default|default:
return|return
operator|-
literal|1
return|;
case|case
name|UNI_CSCOPE_ORG_LOC
case|:
case|case
name|UNI_CSCOPE_ORG_LOC_P1
case|:
case|case
name|UNI_CSCOPE_ORG_LOC_P2
case|:
case|case
name|UNI_CSCOPE_ORG_SITE_M1
case|:
case|case
name|UNI_CSCOPE_ORG_SITE
case|:
case|case
name|UNI_CSCOPE_ORG_SITE_P1
case|:
case|case
name|UNI_CSCOPE_ORG_ORG_M1
case|:
case|case
name|UNI_CSCOPE_ORG_ORG
case|:
case|case
name|UNI_CSCOPE_ORG_ORG_P1
case|:
case|case
name|UNI_CSCOPE_ORG_COMM_M1
case|:
case|case
name|UNI_CSCOPE_ORG_COMM
case|:
case|case
name|UNI_CSCOPE_ORG_COMM_P1
case|:
case|case
name|UNI_CSCOPE_ORG_REG
case|:
case|case
name|UNI_CSCOPE_ORG_INTER
case|:
case|case
name|UNI_CSCOPE_ORG_GLOBAL
case|:
break|break;
block|}
break|break;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|cscope
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|cscope
argument_list|,
name|UNI_IE_CSCOPE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|type
operator||
literal|0x80
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|scope
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|cscope
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|!=
literal|2
condition|)
goto|goto
name|rej
goto|;
if|if
condition|(
operator|(
operator|*
name|msg
operator|->
name|b_rptr
operator|&
literal|0xf0
operator|)
operator|!=
literal|0x80
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|type
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
operator|&
literal|0xf
expr_stmt|;
name|ie
operator|->
name|scope
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|IE_END
argument_list|(
name|CSCOPE
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*********************************************************************  *  * Extended Quality of Service  *  * References for this IE are:  *  *  	UNI4.0 pp. 70...72  *  * Notes:  *	Only NET coding.  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|net
argument_list|,
argument|exqos
argument_list|)
end_macro

begin_block
block|{
specifier|static
specifier|const
name|struct
name|uni_print_tbl
name|tab
index|[]
init|=
block|{
name|MKT
argument_list|(
name|UNI_EXQOS_USER
argument_list|,
name|user
argument_list|)
block|,
name|MKT
argument_list|(
name|UNI_EXQOS_NET
argument_list|,
name|net
argument_list|)
block|,
name|EOT
argument_list|()
block|}
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"exqos"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_tbl
argument_list|(
literal|"origin"
argument_list|,
name|ie
operator|->
name|origin
argument_list|,
name|tab
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"acceptable"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_FACC_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|facc
operator|==
name|UNI_EXQOS_ANY_CDV
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"ANY"
argument_list|)
expr_stmt|;
else|else
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|facc
argument_list|)
expr_stmt|;
block|}
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_BACC_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|bacc
operator|==
name|UNI_EXQOS_ANY_CDV
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"ANY"
argument_list|)
expr_stmt|;
else|else
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|bacc
argument_list|)
expr_stmt|;
block|}
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"cumulative"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_FCUM_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|fcum
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_BCUM_P
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|bcum
argument_list|)
expr_stmt|;
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"clrid"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_FCLR_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|fclr
operator|==
name|UNI_EXQOS_ANY_CLR
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"ANY"
argument_list|)
expr_stmt|;
else|else
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|fclr
argument_list|)
expr_stmt|;
block|}
name|uni_putc
argument_list|(
literal|','
argument_list|,
name|cx
argument_list|)
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_BCLR_P
condition|)
block|{
if|if
condition|(
name|ie
operator|->
name|bclr
operator|==
name|UNI_EXQOS_ANY_CLR
condition|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"ANY"
argument_list|)
expr_stmt|;
else|else
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%d"
argument_list|,
name|ie
operator|->
name|bclr
argument_list|)
expr_stmt|;
block|}
name|uni_putc
argument_list|(
literal|')'
argument_list|,
name|cx
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|net
argument_list|,
argument|exqos
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
switch|switch
condition|(
name|ie
operator|->
name|origin
condition|)
block|{
case|case
name|UNI_EXQOS_USER
case|:
case|case
name|UNI_EXQOS_NET
case|:
break|break;
default|default:
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_FACC_P
condition|)
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_FCUM_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_BACC_P
condition|)
if|if
condition|(
operator|!
operator|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_BCUM_P
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_FACC_P
condition|)
if|if
condition|(
name|ie
operator|->
name|facc
operator|>=
literal|1
operator|<<
literal|24
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_BACC_P
condition|)
if|if
condition|(
name|ie
operator|->
name|bacc
operator|>=
literal|1
operator|<<
literal|24
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_FCUM_P
condition|)
if|if
condition|(
name|ie
operator|->
name|fcum
operator|>=
literal|1
operator|<<
literal|24
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_BCUM_P
condition|)
if|if
condition|(
name|ie
operator|->
name|bcum
operator|>=
literal|1
operator|<<
literal|24
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_FCLR_P
condition|)
if|if
condition|(
name|ie
operator|->
name|fclr
operator|==
literal|0
operator|||
operator|(
name|ie
operator|->
name|fclr
operator|>
literal|15
operator|&&
name|ie
operator|->
name|fclr
operator|!=
name|UNI_EXQOS_ANY_CLR
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|ie
operator|->
name|h
operator|.
name|present
operator|&
name|UNI_EXQOS_BCLR_P
condition|)
if|if
condition|(
name|ie
operator|->
name|bclr
operator|==
literal|0
operator|||
operator|(
name|ie
operator|->
name|bclr
operator|>
literal|15
operator|&&
name|ie
operator|->
name|bclr
operator|!=
name|UNI_EXQOS_ANY_CLR
operator|)
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|net
argument_list|,
argument|exqos
argument_list|)
end_macro

begin_block
block|{
name|START_IE
argument_list|(
name|exqos
argument_list|,
name|UNI_IE_EXQOS
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|APP_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|origin
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_EXQOS_FACC_P
argument_list|,
name|UNI_EXQOS_FACC_ID
argument_list|,
name|ie
operator|->
name|facc
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_EXQOS_BACC_P
argument_list|,
name|UNI_EXQOS_BACC_ID
argument_list|,
name|ie
operator|->
name|bacc
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_EXQOS_FCUM_P
argument_list|,
name|UNI_EXQOS_FCUM_ID
argument_list|,
name|ie
operator|->
name|fcum
argument_list|)
expr_stmt|;
name|APP_OPT_24BIT
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_EXQOS_BCUM_P
argument_list|,
name|UNI_EXQOS_BCUM_ID
argument_list|,
name|ie
operator|->
name|bcum
argument_list|)
expr_stmt|;
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_EXQOS_FCLR_P
argument_list|,
name|UNI_EXQOS_FCLR_ID
argument_list|,
name|ie
operator|->
name|fclr
argument_list|)
expr_stmt|;
name|APP_OPT_BYTE
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|,
name|UNI_EXQOS_BCLR_P
argument_list|,
name|UNI_EXQOS_BCLR_ID
argument_list|,
name|ie
operator|->
name|bclr
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|net
argument_list|,
argument|exqos
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|<
literal|1
operator|||
name|ielen
operator|>
literal|21
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|origin
operator|=
operator|*
name|msg
operator|->
name|b_rptr
operator|++
expr_stmt|;
name|ielen
operator|--
expr_stmt|;
while|while
condition|(
name|ielen
operator|--
condition|)
block|{
switch|switch
condition|(
operator|*
name|msg
operator|->
name|b_rptr
operator|++
condition|)
block|{
default|default:
goto|goto
name|rej
goto|;
name|DEC_GETF3
argument_list|(
name|EXQOS_FACC
argument_list|,
name|facc
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|EXQOS_BACC
argument_list|,
name|bacc
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|EXQOS_FCUM
argument_list|,
name|fcum
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF3
argument_list|(
name|EXQOS_BCUM
argument_list|,
name|bcum
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF1
argument_list|(
name|EXQOS_FCLR
argument_list|,
name|fclr
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
name|DEC_GETF1
argument_list|(
name|EXQOS_BCLR
argument_list|,
name|bclr
argument_list|,
name|ie
operator|->
name|h
operator|.
name|present
argument_list|)
expr_stmt|;
block|}
block|}
name|IE_END
argument_list|(
name|EXQOS
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/**************************************************************  *  * Free form IE (for testing mainly)  */
end_comment

begin_macro
name|DEF_IE_PRINT
argument_list|(
argument|itu
argument_list|,
argument|unrec
argument_list|)
end_macro

begin_block
block|{
name|u_int
name|i
decl_stmt|;
if|if
condition|(
name|uni_print_iehdr
argument_list|(
literal|"unrec"
argument_list|,
operator|&
name|ie
operator|->
name|h
argument_list|,
name|cx
argument_list|)
condition|)
return|return;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"len"
argument_list|,
literal|"%u"
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|uni_print_entry
argument_list|(
name|cx
argument_list|,
literal|"data"
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ie
operator|->
name|len
condition|;
name|i
operator|++
control|)
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|"%s0x%02x"
argument_list|,
name|i
operator|==
literal|0
condition|?
literal|""
else|:
literal|" "
argument_list|,
name|ie
operator|->
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|uni_printf
argument_list|(
name|cx
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
name|uni_print_ieend
argument_list|(
name|cx
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DEF_IE_CHECK
argument_list|(
argument|itu
argument_list|,
argument|unrec
argument_list|)
end_macro

begin_block
block|{
name|cx
operator|=
name|cx
expr_stmt|;
if|if
condition|(
name|ie
operator|->
name|len
operator|>
sizeof|sizeof
argument_list|(
name|ie
operator|->
name|data
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_ENCODE
argument_list|(
argument|itu
argument_list|,
argument|unrec
argument_list|)
end_macro

begin_block
block|{
name|START_IE2
argument_list|(
name|unrec
argument_list|,
name|UNI_IE_UNREC
argument_list|,
name|ie
operator|->
name|len
argument_list|,
name|ie
operator|->
name|id
argument_list|)
expr_stmt|;
name|APP_BUF
argument_list|(
name|msg
argument_list|,
name|ie
operator|->
name|data
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|SET_IE_LEN
argument_list|(
name|msg
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|DEF_IE_DECODE
argument_list|(
argument|itu
argument_list|,
argument|unrec
argument_list|)
end_macro

begin_block
block|{
name|IE_START
argument_list|(
argument|;
argument_list|)
empty_stmt|;
if|if
condition|(
name|ielen
operator|>
sizeof|sizeof
argument_list|(
name|ie
operator|->
name|data
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|ie
operator|->
name|data
index|[
literal|0
index|]
argument_list|)
operator|||
name|ielen
operator|<
literal|1
condition|)
goto|goto
name|rej
goto|;
name|ie
operator|->
name|len
operator|=
name|ielen
expr_stmt|;
name|ielen
operator|=
literal|0
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|ie
operator|->
name|data
argument_list|,
name|msg
operator|->
name|b_rptr
argument_list|,
name|ie
operator|->
name|len
argument_list|)
expr_stmt|;
name|msg
operator|->
name|b_rptr
operator|+=
name|ie
operator|->
name|len
expr_stmt|;
name|IE_END
argument_list|(
name|UNREC
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

