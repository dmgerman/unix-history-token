begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************************************************* Copyright (C) 2015 Annapurna Labs Ltd.  This file may be licensed under the terms of the Annapurna Labs Commercial License Agreement.  Alternatively, this file can be distributed under the terms of the GNU General Public License V2 as published by the Free Software Foundation and can be found at http://www.gnu.org/licenses/gpl-2.0.html  Alternatively, redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:      *     Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.      *     Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  *******************************************************************************/
end_comment

begin_include
include|#
directive|include
file|"al_hal_serdes_25g.h"
end_include

begin_include
include|#
directive|include
file|"al_hal_serdes_25g_regs.h"
end_include

begin_include
include|#
directive|include
file|"al_hal_serdes_25g_internal_regs.h"
end_include

begin_define
define|#
directive|define
name|AL_SERDES_MB_MAX_DATA_LEN
value|8
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_WAIT_FOR_READY_TO
value|200
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RESET_TO
value|100
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RESET_NUM_RETRIES
value|5
end_define

begin_if
if|#
directive|if
operator|(
operator|!
name|defined
argument_list|(
name|AL_SERDES_BASIC_SERVICES_ONLY
argument_list|)
operator|)
operator|||
operator|(
name|AL_SERDES_BASIC_SERVICES_ONLY
operator|==
literal|0
operator|)
end_if

begin_define
define|#
directive|define
name|AL_SRDS_ADV_SRVC
parameter_list|(
name|func
parameter_list|)
value|func
end_define

begin_else
else|#
directive|else
end_else

begin_function
specifier|static
name|void
name|al_serdes_hssp_stub_func
parameter_list|(
name|void
parameter_list|)
block|{
name|al_err
argument_list|(
literal|"%s: not implemented service called!\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|AL_SRDS_ADV_SRVC
parameter_list|(
name|func
parameter_list|)
value|((typeof(func) *)al_serdes_hssp_stub_func)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|enum
name|al_serdes_type
name|al_serdes_25g_type_get
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|AL_SRDS_TYPE_25G
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|al_serdes_25g_reg_read
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|enum
name|al_serdes_reg_type
name|type
parameter_list|,
name|uint16_t
name|offset
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|)
block|{
name|struct
name|al_serdes_c_regs
name|__iomem
modifier|*
name|regs_base
init|=
name|obj
operator|->
name|regs_base
decl_stmt|;
name|uint32_t
name|addr
init|=
literal|0
decl_stmt|;
name|al_dbg
argument_list|(
literal|"%s(%p, %d, %d, %u)\n"
argument_list|,
name|__func__
argument_list|,
name|obj
argument_list|,
name|page
argument_list|,
name|type
argument_list|,
name|offset
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
name|data
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|page
condition|)
block|{
case|case
name|AL_SRDS_REG_PAGE_TOP
case|:
name|addr
operator|=
operator|(
name|SERDES_25G_TOP_BASE
operator|+
name|offset
operator|)
expr_stmt|;
break|break;
case|case
name|AL_SRDS_REG_PAGE_4_COMMON
case|:
name|addr
operator|=
operator|(
name|SERDES_25G_CM_BASE
operator|+
name|offset
operator|)
expr_stmt|;
break|break;
case|case
name|AL_SRDS_REG_PAGE_0_LANE_0
case|:
case|case
name|AL_SRDS_REG_PAGE_1_LANE_1
case|:
name|addr
operator|=
operator|(
name|SERDES_25G_LANE_BASE
operator|+
operator|(
name|page
operator|*
name|SERDES_25G_LANE_SIZE
operator|)
operator|+
name|offset
operator|)
expr_stmt|;
break|break;
default|default:
name|al_err
argument_list|(
literal|"%s: wrong serdes type %d\n"
argument_list|,
name|__func__
argument_list|,
name|type
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|reg_addr
argument_list|,
name|addr
argument_list|)
expr_stmt|;
operator|*
name|data
operator|=
name|al_reg_read32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|reg_data
argument_list|)
expr_stmt|;
name|al_dbg
argument_list|(
literal|"%s: return(%u)\n"
argument_list|,
name|__func__
argument_list|,
operator|*
name|data
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|al_serdes_25g_reg_write
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|enum
name|al_serdes_reg_type
name|type
parameter_list|,
name|uint16_t
name|offset
parameter_list|,
name|uint8_t
name|data
parameter_list|)
block|{
name|struct
name|al_serdes_c_regs
name|__iomem
modifier|*
name|regs_base
init|=
name|obj
operator|->
name|regs_base
decl_stmt|;
name|uint32_t
name|addr
init|=
literal|0
decl_stmt|;
name|al_dbg
argument_list|(
literal|"%s(%p, %d, %d, %u)\n"
argument_list|,
name|__func__
argument_list|,
name|obj
argument_list|,
name|page
argument_list|,
name|type
argument_list|,
name|offset
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
name|obj
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|page
condition|)
block|{
case|case
name|AL_SRDS_REG_PAGE_TOP
case|:
name|addr
operator|=
operator|(
name|SERDES_25G_TOP_BASE
operator|+
name|offset
operator|)
expr_stmt|;
break|break;
case|case
name|AL_SRDS_REG_PAGE_4_COMMON
case|:
name|addr
operator|=
operator|(
name|SERDES_25G_CM_BASE
operator|+
name|offset
operator|)
expr_stmt|;
break|break;
case|case
name|AL_SRDS_REG_PAGE_0_LANE_0
case|:
case|case
name|AL_SRDS_REG_PAGE_1_LANE_1
case|:
name|addr
operator|=
operator|(
name|SERDES_25G_LANE_BASE
operator|+
operator|(
name|page
operator|*
name|SERDES_25G_LANE_SIZE
operator|)
operator|+
name|offset
operator|)
expr_stmt|;
break|break;
default|default:
name|al_err
argument_list|(
literal|"%s: wrong serdes type %d\n"
argument_list|,
name|__func__
argument_list|,
name|type
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|reg_addr
argument_list|,
name|addr
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|reg_data
argument_list|,
operator|(
name|data
operator||
name|SERDES_C_GEN_REG_DATA_STRB_MASK
operator|)
argument_list|)
expr_stmt|;
name|al_dbg
argument_list|(
literal|"%s: write(%u)\n"
argument_list|,
name|__func__
argument_list|,
name|data
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|al_serdes_25g_reg_masked_read
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|uint16_t
name|offset
parameter_list|,
name|uint8_t
name|mask
parameter_list|,
name|uint8_t
name|shift
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|)
block|{
name|uint8_t
name|val
decl_stmt|;
name|int
name|status
init|=
literal|0
decl_stmt|;
name|status
operator|=
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
literal|0
argument_list|,
name|offset
argument_list|,
operator|&
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
return|return
name|status
return|;
operator|*
name|data
operator|=
name|AL_REG_FIELD_GET
argument_list|(
name|val
argument_list|,
name|mask
argument_list|,
name|shift
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|al_serdes_25g_reg_masked_write
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|uint16_t
name|offset
parameter_list|,
name|uint8_t
name|mask
parameter_list|,
name|uint8_t
name|shift
parameter_list|,
name|uint8_t
name|data
parameter_list|)
block|{
name|uint8_t
name|val
decl_stmt|;
name|int
name|status
init|=
literal|0
decl_stmt|;
name|status
operator|=
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
literal|0
argument_list|,
name|offset
argument_list|,
operator|&
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
return|return
name|status
return|;
name|val
operator|&=
operator|(
operator|~
name|mask
operator|)
expr_stmt|;
name|val
operator||=
operator|(
name|data
operator|<<
name|shift
operator|)
expr_stmt|;
return|return
name|al_serdes_25g_reg_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
literal|0
argument_list|,
name|offset
argument_list|,
name|val
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_define
define|#
directive|define
name|SERDES_25G_MB_RESP_BYTES
value|16
end_define

begin_define
define|#
directive|define
name|SERDES_25G_MB_TIMEOUT
value|5000000
end_define

begin_comment
comment|/* uSec */
end_comment

begin_function
specifier|static
name|int
name|al_serdes_25g_mailbox_send_cmd
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|uint8_t
name|cmd
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|,
name|uint8_t
name|data_len
parameter_list|)
block|{
name|uint8_t
name|val
decl_stmt|;
name|int
name|i
decl_stmt|;
name|uint32_t
name|timeout
init|=
name|SERDES_25G_MB_TIMEOUT
decl_stmt|;
if|if
condition|(
name|data_len
operator|>
name|AL_SERDES_MB_MAX_DATA_LEN
condition|)
block|{
name|al_err
argument_list|(
literal|"Cannot send command, data too long\n"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
comment|/* Wait for CMD_FLAG to clear */
while|while
condition|(
literal|1
condition|)
block|{
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_TOP_CMD_FLAG_ADDR
argument_list|,
operator|&
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
name|timeout
operator|==
literal|0
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: timeout occurred waiting to CMD_FLAG\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|timeout
operator|--
expr_stmt|;
name|al_udelay
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|data_len
condition|;
name|i
operator|++
control|)
block|{
name|al_serdes_25g_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
literal|0
argument_list|,
operator|(
name|SERDES_25G_TOP_CMD_DATA0_ADDR
operator|+
name|i
operator|)
argument_list|,
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
comment|/* this write will set CMD_FLAG automatically */
name|al_serdes_25g_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_TOP_CMD_ADDR
argument_list|,
name|cmd
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|al_serdes_25g_mailbox_recv_rsp
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|uint8_t
modifier|*
name|rsp_code
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|,
name|uint8_t
modifier|*
name|data_len
parameter_list|)
block|{
name|uint8_t
name|val
decl_stmt|;
name|int
name|i
decl_stmt|;
name|uint32_t
name|timeout
init|=
name|SERDES_25G_MB_TIMEOUT
decl_stmt|;
comment|/* wait for RSP_FLAG to set */
while|while
condition|(
literal|1
condition|)
block|{
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_TOP_RSP_FLAG_ADDR
argument_list|,
operator|&
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|==
literal|0x1
condition|)
break|break;
if|if
condition|(
name|timeout
operator|==
literal|0
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: timeout occurred waiting to RSP_FLAG\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
operator|*
name|data_len
operator|=
literal|0
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|timeout
operator|--
expr_stmt|;
name|al_udelay
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* Grab the response code and data */
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_TOP_RSP_ADDR
argument_list|,
name|rsp_code
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SERDES_25G_MB_RESP_BYTES
condition|;
name|i
operator|++
control|)
block|{
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
literal|0
argument_list|,
operator|(
name|SERDES_25G_TOP_RSP_DATA0_ADDR
operator|+
name|i
operator|)
argument_list|,
operator|&
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
comment|/* clear the RSP_FLAG (write 1 to clear) */
name|al_serdes_25g_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_TOP_RSP_FLAG_ADDR
argument_list|,
literal|0x1
argument_list|)
expr_stmt|;
operator|*
name|data_len
operator|=
name|SERDES_25G_MB_RESP_BYTES
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_25g_bist_rx_enable
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|al_bool
name|enable
parameter_list|)
block|{
if|if
condition|(
name|enable
condition|)
block|{
switch|switch
condition|(
name|lane
condition|)
block|{
case|case
literal|0
case|:
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN0_CLK_RX_ADDR
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN0_CLK_RX_CTRL_CG_EN_MASK
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN0_CLK_RX_CTRL_CG_EN_SHIFT
argument_list|,
literal|0x1
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN0_CLK_RX_ADDR
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN0_CLK_RX_CTRL_BIST_CG_EN_MASK
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN0_CLK_RX_CTRL_BIST_CG_EN_SHIFT
argument_list|,
literal|0x1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN1_CLK_RX_ADDR
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN1_CLK_RX_CTRL_CG_EN_MASK
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN1_CLK_RX_CTRL_CG_EN_SHIFT
argument_list|,
literal|0x1
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN1_CLK_RX_ADDR
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN1_CLK_RX_CTRL_BIST_CG_EN_MASK
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN1_CLK_RX_CTRL_BIST_CG_EN_SHIFT
argument_list|,
literal|0x1
argument_list|)
expr_stmt|;
break|break;
default|default:
name|al_err
argument_list|(
literal|"%s: Wrong serdes lane %d\n"
argument_list|,
name|__func__
argument_list|,
name|lane
argument_list|)
expr_stmt|;
return|return;
block|}
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_RX_BIST_LOSS_LOCK_CTRL4_ADDR
argument_list|,
name|SERDES_25G_LANE_RX_BIST_LOSS_LOCK_CTRL4_STOP_ON_LOSS_LOCK_MASK
argument_list|,
name|SERDES_25G_LANE_RX_BIST_LOSS_LOCK_CTRL4_STOP_ON_LOSS_LOCK_SHIFT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_ADDR
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_EN_MASK
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_EN_SHIFT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_ADDR
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_PATTERN_SEL_MASK
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_PATTERN_SEL_SHIFT
argument_list|,
literal|6
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* clear counters */
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_ADDR
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_CLEAR_BER_MASK
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_CLEAR_BER_SHIFT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_ADDR
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_CLEAR_BER_MASK
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_CLEAR_BER_SHIFT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_msleep
argument_list|(
name|AL_SERDES_25G_WAIT_FOR_READY_TO
argument_list|)
expr_stmt|;
comment|/* disable */
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_ADDR
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_EN_MASK
argument_list|,
name|SERDES_25G_LANE_RX_BIST_CTRL_EN_SHIFT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|// TODO: [Guy] change API to be per lane.
end_comment

begin_function
specifier|static
name|void
name|al_serdes_25g_bist_pattern_select
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_bist_pattern
name|pattern
parameter_list|,
name|uint8_t
modifier|*
name|user_data
parameter_list|)
block|{
name|enum
name|al_serdes_lane
name|lane
decl_stmt|;
name|uint8_t
name|val
init|=
literal|0
decl_stmt|;
switch|switch
condition|(
name|pattern
condition|)
block|{
case|case
name|AL_SRDS_BIST_PATTERN_USER
case|:
name|al_assert
argument_list|(
name|user_data
argument_list|)
expr_stmt|;
name|val
operator|=
name|SERDES_25G_LANE_TX_BIST_CTRL_PATTERN_PRBS_USER
expr_stmt|;
break|break;
case|case
name|AL_SRDS_BIST_PATTERN_PRBS7
case|:
name|val
operator|=
name|SERDES_25G_LANE_TX_BIST_CTRL_PATTERN_PRBS7
expr_stmt|;
break|break;
case|case
name|AL_SRDS_BIST_PATTERN_PRBS23
case|:
name|val
operator|=
name|SERDES_25G_LANE_TX_BIST_CTRL_PATTERN_PRBS23
expr_stmt|;
break|break;
case|case
name|AL_SRDS_BIST_PATTERN_PRBS31
case|:
name|val
operator|=
name|SERDES_25G_LANE_TX_BIST_CTRL_PATTERN_PRBS31
expr_stmt|;
break|break;
case|case
name|AL_SRDS_BIST_PATTERN_CLK1010
case|:
default|default:
name|al_err
argument_list|(
literal|"%s: invalid pattern (%d)\n"
argument_list|,
name|__func__
argument_list|,
name|pattern
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|lane
operator|=
name|AL_SRDS_LANE_0
init|;
name|lane
operator|<=
name|AL_SRDS_LANE_1
condition|;
name|lane
operator|++
control|)
block|{
if|if
condition|(
name|pattern
operator|==
name|AL_SRDS_BIST_PATTERN_USER
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SERDES_25G_LANE_TX_BIST_UDP_NUM_BYTES
condition|;
name|i
operator|++
control|)
name|al_serdes_25g_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_TX_BIST_UDP_ADDR
argument_list|(
name|i
argument_list|)
argument_list|,
name|user_data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_TX_BIST_CTRL_ADDR
argument_list|,
name|SERDES_25G_LANE_TX_BIST_CTRL_PATTERN_SEL_MASK
argument_list|,
name|SERDES_25G_LANE_TX_BIST_CTRL_PATTERN_SEL_SHIFT
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_25g_bist_tx_enable
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|al_bool
name|enable
parameter_list|)
block|{
if|if
condition|(
name|enable
condition|)
block|{
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_TX_BIST_CTRL_ADDR
argument_list|,
name|SERDES_25G_LANE_TX_BIST_CTRL_EN_MASK
argument_list|,
name|SERDES_25G_LANE_TX_BIST_CTRL_EN_SHIFT
argument_list|,
literal|0x1
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_TOP_DPL_TXDP_CTRL1_ADDR
argument_list|,
name|SERDES_25G_LANE_TOP_DPL_TXDP_CTRL1_DMUX_TXA_SEL_MASK
argument_list|,
name|SERDES_25G_LANE_TOP_DPL_TXDP_CTRL1_DMUX_TXA_SEL_SHIFT
argument_list|,
literal|0x2
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|lane
condition|)
block|{
case|case
name|AL_SRDS_LANE_0
case|:
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN0_CLK_TX_ADDR
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN0_CLK_TX_CTRL_BIST_CG_EN_MASK
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN0_CLK_TX_CTRL_BIST_CG_EN_SHIFT
argument_list|,
literal|0x1
argument_list|)
expr_stmt|;
break|break;
case|case
name|AL_SRDS_LANE_1
case|:
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN1_CLK_TX_ADDR
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN1_CLK_TX_CTRL_BIST_CG_EN_MASK
argument_list|,
name|SERDES_25G_TOP_CLOCK_LN1_CLK_TX_CTRL_BIST_CG_EN_SHIFT
argument_list|,
literal|0x1
argument_list|)
expr_stmt|;
break|break;
default|default:
name|al_err
argument_list|(
literal|"%s: Wrong serdes lane %d\n"
argument_list|,
name|__func__
argument_list|,
name|lane
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
else|else
block|{
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_TX_BIST_CTRL_ADDR
argument_list|,
name|SERDES_25G_LANE_TX_BIST_CTRL_EN_MASK
argument_list|,
name|SERDES_25G_LANE_TX_BIST_CTRL_EN_SHIFT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_25g_bist_rx_status
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|al_bool
modifier|*
name|is_locked
parameter_list|,
name|al_bool
modifier|*
name|err_cnt_overflow
parameter_list|,
name|uint32_t
modifier|*
name|err_cnt
parameter_list|)
block|{
name|uint8_t
name|status
decl_stmt|;
name|uint8_t
name|err1
decl_stmt|;
name|uint8_t
name|err2
decl_stmt|;
name|uint8_t
name|err3
decl_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_RX_BIST_STATUS_ADDR
argument_list|,
name|SERDES_25G_LANE_RX_BIST_STATUS_STATE_MASK
argument_list|,
name|SERDES_25G_LANE_RX_BIST_STATUS_STATE_SHIFT
argument_list|,
operator|&
name|status
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
literal|3
condition|)
block|{
operator|*
name|is_locked
operator|=
name|AL_FALSE
expr_stmt|;
return|return;
block|}
operator|*
name|is_locked
operator|=
name|AL_TRUE
expr_stmt|;
operator|*
name|err_cnt_overflow
operator|=
name|AL_FALSE
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_RX_BIST_BER_STATUS0_ADDR
argument_list|,
name|SERDES_25G_LANE_RX_BIST_BER_STATUS0_BIT_ERROR_COUNT_7_0_MASK
argument_list|,
name|SERDES_25G_LANE_RX_BIST_BER_STATUS0_BIT_ERROR_COUNT_7_0_SHIFT
argument_list|,
operator|&
name|err1
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_RX_BIST_BER_STATUS1_ADDR
argument_list|,
name|SERDES_25G_LANE_RX_BIST_BER_STATUS1_BIT_ERROR_COUNT_15_8_MASK
argument_list|,
name|SERDES_25G_LANE_RX_BIST_BER_STATUS1_BIT_ERROR_COUNT_15_8_SHIFT
argument_list|,
operator|&
name|err2
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_RX_BIST_BER_STATUS2_ADDR
argument_list|,
name|SERDES_25G_LANE_RX_BIST_BER_STATUS2_BIT_ERROR_COUNT_23_16_MASK
argument_list|,
name|SERDES_25G_LANE_RX_BIST_BER_STATUS2_BIT_ERROR_COUNT_23_16_SHIFT
argument_list|,
operator|&
name|err3
argument_list|)
expr_stmt|;
operator|*
name|err_cnt
operator|=
operator|(
name|err1
operator|+
operator|(
name|err2
operator|<<
literal|8
operator|)
operator|+
operator|(
name|err3
operator|<<
literal|16
operator|)
operator|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|SERDES_MB_CMD_SWING_CFG
value|0x83
end_define

begin_define
define|#
directive|define
name|SERDES_MB_CMD_SAMPLES_COUNT
value|0x84
end_define

begin_define
define|#
directive|define
name|SERDES_MB_CMD_START_MEASURE
value|0x82
end_define

begin_define
define|#
directive|define
name|SERDES_MB_RSP_CODE_0
value|0
end_define

begin_define
define|#
directive|define
name|SERDES_MB_RSP_CODE_1
value|1
end_define

begin_define
define|#
directive|define
name|SERDES_MB_RSP_CODE_2
value|2
end_define

begin_function
specifier|static
name|int
name|al_serdes_25g_eye_diag_run
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|int
name|x_start
parameter_list|,
name|int
name|x_stop
parameter_list|,
name|unsigned
name|int
name|x_step
parameter_list|,
name|int
name|y_start
parameter_list|,
name|int
name|y_stop
parameter_list|,
name|unsigned
name|int
name|y_step
parameter_list|,
name|uint64_t
name|ber_target
parameter_list|,
name|uint64_t
modifier|*
name|buf
parameter_list|,
name|uint32_t
name|buf_size
parameter_list|)
block|{
name|int
name|rc
decl_stmt|;
name|uint8_t
name|rsp_code
decl_stmt|;
name|uint8_t
name|data
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|data_len
decl_stmt|;
name|uint32_t
name|total_bits
decl_stmt|;
name|uint8_t
name|bits_left_curr_sample
decl_stmt|;
name|uint8_t
name|bits_left_curr_byte
decl_stmt|;
name|uint32_t
name|byte
init|=
literal|0
decl_stmt|;
name|uint32_t
name|x
init|=
literal|0
decl_stmt|;
name|uint32_t
name|x_samples
init|=
operator|(
operator|(
operator|(
name|x_stop
operator|-
name|x_start
operator|)
operator|/
name|x_step
operator|)
operator|+
literal|1
operator|)
decl_stmt|;
name|uint32_t
name|y
init|=
literal|0
decl_stmt|;
name|uint32_t
name|y_samples
init|=
operator|(
operator|(
operator|(
name|y_stop
operator|-
name|y_start
operator|)
operator|/
name|y_step
operator|)
operator|+
literal|1
operator|)
decl_stmt|;
name|uint8_t
name|sample_width
init|=
operator|(
literal|64
operator|-
name|__builtin_clzl
argument_list|(
name|ber_target
argument_list|)
operator|)
decl_stmt|;
name|uint8_t
name|msb
decl_stmt|;
name|uint8_t
name|lsb
decl_stmt|;
name|uint32_t
name|samples_left
init|=
operator|(
operator|(
name|x_samples
operator|*
name|y_samples
operator|)
operator|)
decl_stmt|;
name|uint8_t
name|sign
init|=
literal|0
decl_stmt|;
name|al_assert
argument_list|(
name|buf_size
operator|==
operator|(
name|samples_left
operator|*
sizeof|sizeof
argument_list|(
name|uint64_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|al_memset
argument_list|(
name|buf
argument_list|,
literal|0
argument_list|,
name|buf_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|y_start
operator|<
literal|0
condition|)
block|{
name|y_start
operator|*=
operator|-
literal|1
expr_stmt|;
name|sign
operator||=
literal|0x1
expr_stmt|;
block|}
if|if
condition|(
name|y_stop
operator|<
literal|0
condition|)
block|{
name|y_stop
operator|*=
operator|-
literal|1
expr_stmt|;
name|sign
operator||=
literal|0x2
expr_stmt|;
block|}
name|data
index|[
literal|0
index|]
operator|=
name|lane
expr_stmt|;
name|data
index|[
literal|1
index|]
operator|=
name|x_start
expr_stmt|;
name|data
index|[
literal|2
index|]
operator|=
name|x_stop
expr_stmt|;
name|data
index|[
literal|3
index|]
operator|=
name|x_step
expr_stmt|;
name|data
index|[
literal|4
index|]
operator|=
name|y_start
expr_stmt|;
name|data
index|[
literal|5
index|]
operator|=
name|y_stop
expr_stmt|;
name|data
index|[
literal|6
index|]
operator|=
name|sign
expr_stmt|;
name|data
index|[
literal|7
index|]
operator|=
name|y_step
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_mailbox_send_cmd
argument_list|(
name|obj
argument_list|,
name|SERDES_MB_CMD_SWING_CFG
argument_list|,
name|data
argument_list|,
literal|8
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: Failed to send command %d to mailbox.\n"
argument_list|,
name|__func__
argument_list|,
name|SERDES_MB_CMD_SWING_CFG
argument_list|)
expr_stmt|;
return|return
name|rc
return|;
block|}
name|rc
operator|=
name|al_serdes_25g_mailbox_recv_rsp
argument_list|(
name|obj
argument_list|,
operator|&
name|rsp_code
argument_list|,
name|data
argument_list|,
operator|&
name|data_len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|rc
operator|)
operator|||
operator|(
name|rsp_code
operator|!=
name|SERDES_MB_RSP_CODE_0
operator|)
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: Failed to send command %d to mailbox. rsp_code %d\n"
argument_list|,
name|__func__
argument_list|,
name|SERDES_MB_CMD_SWING_CFG
argument_list|,
name|rsp_code
argument_list|)
expr_stmt|;
return|return
operator|(
name|ETIMEDOUT
operator|)
return|;
block|}
name|al_assert
argument_list|(
name|sample_width
operator|<=
literal|40
argument_list|)
expr_stmt|;
name|data
index|[
literal|0
index|]
operator|=
name|lane
expr_stmt|;
name|data
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|ber_target
operator|>>
literal|32
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|data
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|ber_target
operator|>>
literal|24
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|data
index|[
literal|3
index|]
operator|=
operator|(
operator|(
name|ber_target
operator|>>
literal|16
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|data
index|[
literal|4
index|]
operator|=
operator|(
operator|(
name|ber_target
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|data
index|[
literal|5
index|]
operator|=
operator|(
name|ber_target
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_mailbox_send_cmd
argument_list|(
name|obj
argument_list|,
name|SERDES_MB_CMD_SAMPLES_COUNT
argument_list|,
name|data
argument_list|,
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: Failed to send command %d to mailbox.\n"
argument_list|,
name|__func__
argument_list|,
name|SERDES_MB_CMD_SAMPLES_COUNT
argument_list|)
expr_stmt|;
return|return
name|rc
return|;
block|}
name|rc
operator|=
name|al_serdes_25g_mailbox_recv_rsp
argument_list|(
name|obj
argument_list|,
operator|&
name|rsp_code
argument_list|,
name|data
argument_list|,
operator|&
name|data_len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|rc
operator|)
operator|||
operator|(
name|rsp_code
operator|!=
name|SERDES_MB_RSP_CODE_0
operator|)
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: Failed to send command %d to mailbox. rsp_code %d\n"
argument_list|,
name|__func__
argument_list|,
name|SERDES_MB_CMD_SAMPLES_COUNT
argument_list|,
name|rsp_code
argument_list|)
expr_stmt|;
return|return
operator|(
name|ETIMEDOUT
operator|)
return|;
block|}
name|rc
operator|=
name|al_serdes_25g_mailbox_send_cmd
argument_list|(
name|obj
argument_list|,
name|SERDES_MB_CMD_START_MEASURE
argument_list|,
name|data
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|bits_left_curr_sample
operator|=
name|sample_width
expr_stmt|;
while|while
condition|(
name|rsp_code
operator|!=
name|SERDES_MB_RSP_CODE_1
condition|)
block|{
name|uint8_t
name|num_bits
init|=
literal|0
decl_stmt|;
name|rc
operator|=
name|al_serdes_25g_mailbox_recv_rsp
argument_list|(
name|obj
argument_list|,
operator|&
name|rsp_code
argument_list|,
name|data
argument_list|,
operator|&
name|data_len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|rc
operator|!=
literal|0
operator|)
operator|||
operator|(
name|rsp_code
operator|>
name|SERDES_MB_RSP_CODE_2
operator|)
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: command %d return failure. rsp_code %d\n"
argument_list|,
name|__func__
argument_list|,
name|SERDES_MB_CMD_START_MEASURE
argument_list|,
name|rsp_code
argument_list|)
expr_stmt|;
return|return
operator|(
name|ETIMEDOUT
operator|)
return|;
block|}
name|byte
operator|=
literal|0
expr_stmt|;
name|total_bits
operator|=
name|data_len
operator|*
literal|8
expr_stmt|;
name|bits_left_curr_byte
operator|=
literal|8
expr_stmt|;
while|while
condition|(
name|total_bits
operator|>
literal|0
condition|)
block|{
name|num_bits
operator|=
name|al_min_t
argument_list|(
name|uint8_t
argument_list|,
name|bits_left_curr_sample
argument_list|,
name|bits_left_curr_byte
argument_list|)
expr_stmt|;
name|buf
index|[
operator|(
name|y
operator|*
name|x_samples
operator|)
operator|+
name|x
index|]
operator|<<=
name|num_bits
expr_stmt|;
name|msb
operator|=
name|bits_left_curr_byte
operator|-
literal|1
expr_stmt|;
name|lsb
operator|=
name|msb
operator|-
name|num_bits
operator|+
literal|1
expr_stmt|;
name|buf
index|[
operator|(
name|y
operator|*
name|x_samples
operator|)
operator|+
name|x
index|]
operator||=
operator|(
name|data
index|[
name|byte
index|]
operator|&
name|AL_FIELD_MASK
argument_list|(
name|msb
argument_list|,
name|lsb
argument_list|)
operator|>>
name|lsb
operator|)
expr_stmt|;
name|total_bits
operator|-=
name|num_bits
expr_stmt|;
name|bits_left_curr_byte
operator|-=
name|num_bits
expr_stmt|;
if|if
condition|(
operator|!
name|bits_left_curr_byte
condition|)
block|{
name|bits_left_curr_byte
operator|=
literal|8
expr_stmt|;
name|byte
operator|++
expr_stmt|;
block|}
name|bits_left_curr_sample
operator|-=
name|num_bits
expr_stmt|;
if|if
condition|(
operator|!
name|bits_left_curr_sample
condition|)
block|{
name|y
operator|++
expr_stmt|;
if|if
condition|(
name|y
operator|==
name|y_samples
condition|)
block|{
name|y
operator|=
literal|0
expr_stmt|;
name|x
operator|++
expr_stmt|;
block|}
name|samples_left
operator|--
expr_stmt|;
name|bits_left_curr_sample
operator|=
name|sample_width
expr_stmt|;
block|}
if|if
condition|(
name|samples_left
operator|==
literal|0
condition|)
break|break;
block|}
if|if
condition|(
operator|(
name|samples_left
operator|==
literal|0
operator|)
operator|&&
operator|(
name|rsp_code
operator|!=
name|SERDES_MB_RSP_CODE_1
operator|)
condition|)
block|{
name|rc
operator|=
name|al_serdes_25g_mailbox_recv_rsp
argument_list|(
name|obj
argument_list|,
operator|&
name|rsp_code
argument_list|,
name|data
argument_list|,
operator|&
name|data_len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|rc
operator|)
operator|||
operator|(
name|rsp_code
operator|==
name|SERDES_MB_RSP_CODE_0
operator|)
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: Parsed enough samples but f/w is still sending more\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
name|EIO
return|;
block|}
break|break;
block|}
block|}
if|if
condition|(
name|samples_left
operator|>
literal|0
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: Still need more samples but f/w has stopped sending them!?!?!?\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
name|EIO
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_define
define|#
directive|define
name|SERDES_25G_EYE_X_MIN
value|1
end_define

begin_define
define|#
directive|define
name|SERDES_25G_EYE_X_MAX
value|127
end_define

begin_define
define|#
directive|define
name|SERDES_25G_EYE_Y_MIN
value|-200
end_define

begin_define
define|#
directive|define
name|SERDES_25G_EYE_Y_MAX
value|200
end_define

begin_define
define|#
directive|define
name|SERDES_25G_EYE_SIZE_MAX_SAMPLES
value|401
end_define

begin_define
define|#
directive|define
name|SERDES_25G_EYE_SIZE_BER_TARGET
value|0xffff
end_define

begin_define
define|#
directive|define
name|SERDES_25G_EYE_SIZE_ERR_TH
value|10
end_define

begin_function
specifier|static
name|int
name|al_serdes_25g_calc_eye_size
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|int
modifier|*
name|width
parameter_list|,
name|int
modifier|*
name|height
parameter_list|)
block|{
name|uint64_t
name|samples
index|[
name|SERDES_25G_EYE_SIZE_MAX_SAMPLES
index|]
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|_width
init|=
literal|0
decl_stmt|;
name|int
name|_height
init|=
literal|0
decl_stmt|;
name|int
name|rc
decl_stmt|;
name|int
name|mid_x
init|=
operator|(
operator|(
name|SERDES_25G_EYE_X_MIN
operator|+
name|SERDES_25G_EYE_X_MAX
operator|)
operator|/
literal|2
operator|)
decl_stmt|;
name|int
name|mid_y
init|=
operator|(
operator|(
name|SERDES_25G_EYE_Y_MIN
operator|+
name|SERDES_25G_EYE_Y_MAX
operator|)
operator|/
literal|2
operator|)
decl_stmt|;
operator|*
name|height
operator|=
literal|0
expr_stmt|;
operator|*
name|width
operator|=
literal|0
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_eye_diag_run
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|mid_x
argument_list|,
name|mid_x
argument_list|,
literal|1
argument_list|,
name|SERDES_25G_EYE_Y_MIN
argument_list|,
name|SERDES_25G_EYE_Y_MAX
argument_list|,
literal|1
argument_list|,
name|SERDES_25G_EYE_SIZE_BER_TARGET
argument_list|,
name|samples
argument_list|,
operator|(
operator|(
name|SERDES_25G_EYE_Y_MAX
operator|-
name|SERDES_25G_EYE_Y_MIN
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|uint64_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: failed to run eye_diag\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
name|rc
return|;
block|}
for|for
control|(
name|i
operator|=
operator|(
name|mid_y
operator|-
name|SERDES_25G_EYE_Y_MIN
operator|)
init|;
operator|(
operator|(
name|samples
index|[
name|i
index|]
operator|<
name|SERDES_25G_EYE_SIZE_ERR_TH
operator|)
operator|&&
operator|(
name|i
operator|<
operator|(
name|SERDES_25G_EYE_Y_MAX
operator|-
name|SERDES_25G_EYE_Y_MIN
operator|+
literal|1
operator|)
operator|)
operator|)
condition|;
name|i
operator|++
operator|,
operator|(
name|_height
operator|)
operator|++
control|)
empty_stmt|;
for|for
control|(
name|i
operator|=
operator|(
name|mid_y
operator|-
name|SERDES_25G_EYE_Y_MIN
operator|)
init|;
operator|(
operator|(
name|samples
index|[
name|i
index|]
operator|<
name|SERDES_25G_EYE_SIZE_ERR_TH
operator|)
operator|&&
operator|(
name|i
operator|>=
literal|0
operator|)
operator|)
condition|;
name|i
operator|--
operator|,
operator|(
name|_height
operator|)
operator|++
control|)
empty_stmt|;
name|rc
operator|=
name|al_serdes_25g_eye_diag_run
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|SERDES_25G_EYE_X_MIN
argument_list|,
name|SERDES_25G_EYE_X_MAX
argument_list|,
literal|1
argument_list|,
name|mid_y
argument_list|,
name|mid_y
argument_list|,
literal|1
argument_list|,
name|SERDES_25G_EYE_SIZE_BER_TARGET
argument_list|,
name|samples
argument_list|,
operator|(
operator|(
name|SERDES_25G_EYE_X_MAX
operator|-
name|SERDES_25G_EYE_X_MIN
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|uint64_t
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: failed to run eye_diag\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
name|rc
return|;
block|}
for|for
control|(
name|i
operator|=
operator|(
name|mid_x
operator|-
name|SERDES_25G_EYE_X_MIN
operator|)
init|;
operator|(
operator|(
name|samples
index|[
name|i
index|]
operator|<
name|SERDES_25G_EYE_SIZE_ERR_TH
operator|)
operator|&&
operator|(
name|i
operator|<
operator|(
name|SERDES_25G_EYE_X_MAX
operator|-
name|SERDES_25G_EYE_X_MIN
operator|+
literal|1
operator|)
operator|)
operator|)
condition|;
name|i
operator|++
operator|,
operator|(
name|_width
operator|)
operator|++
control|)
empty_stmt|;
for|for
control|(
name|i
operator|=
operator|(
name|mid_x
operator|-
name|SERDES_25G_EYE_X_MIN
operator|)
init|;
operator|(
operator|(
name|samples
index|[
name|i
index|]
operator|<
name|SERDES_25G_EYE_SIZE_ERR_TH
operator|)
operator|&&
operator|(
name|i
operator|>=
literal|0
operator|)
operator|)
condition|;
name|i
operator|--
operator|,
operator|(
name|_width
operator|)
operator|++
control|)
empty_stmt|;
operator|*
name|height
operator|=
name|_height
expr_stmt|;
operator|*
name|width
operator|=
name|_width
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_25g_tx_advanced_params_set
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|void
modifier|*
name|tx_params
parameter_list|)
block|{
name|struct
name|al_serdes_adv_tx_params
modifier|*
name|params
init|=
name|tx_params
decl_stmt|;
name|uint32_t
name|timeout
init|=
literal|5000
decl_stmt|;
name|uint8_t
name|val
init|=
literal|0
decl_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL3_ADDR
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL3_TXEQ_CM1_MASK
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL3_TXEQ_CM1_SHIFT
argument_list|,
name|params
operator|->
name|c_minus_1
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL1_ADDR
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL1_TXEQ_C1_MASK
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL1_TXEQ_C1_SHIFT
argument_list|,
name|params
operator|->
name|c_plus_1
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL5_ADDR
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL5_DRV_SWING_MASK
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL5_DRV_SWING_SHIFT
argument_list|,
name|params
operator|->
name|total_driver_units
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL0_ADDR
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL0_REQ_MASK
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL0_REQ_SHIFT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* wait for acknowledge */
while|while
condition|(
literal|1
condition|)
block|{
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_STATUS0_ADDR
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_STATUS0_ACK_MASK
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_STATUS0_ACK_SHIFT
argument_list|,
operator|&
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|==
literal|1
condition|)
break|break;
if|if
condition|(
name|timeout
operator|==
literal|0
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: timeout occurred waiting to FW ack\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
break|break;
block|}
name|timeout
operator|--
expr_stmt|;
name|al_udelay
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL0_ADDR
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL0_REQ_MASK
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL0_REQ_SHIFT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_25g_tx_advanced_params_get
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|void
modifier|*
name|tx_params
parameter_list|)
block|{
name|struct
name|al_serdes_adv_tx_params
modifier|*
name|params
init|=
name|tx_params
decl_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL3_ADDR
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL3_TXEQ_CM1_MASK
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL3_TXEQ_CM1_SHIFT
argument_list|,
operator|&
name|params
operator|->
name|c_minus_1
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL1_ADDR
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL1_TXEQ_C1_MASK
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL1_TXEQ_C1_SHIFT
argument_list|,
operator|&
name|params
operator|->
name|c_plus_1
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL5_ADDR
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL5_DRV_SWING_MASK
argument_list|,
name|SERDES_25G_LANE_DRV_TXEQ_CTRL5_DRV_SWING_SHIFT
argument_list|,
operator|&
name|params
operator|->
name|total_driver_units
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|al_bool
name|al_serdes_25g_cdr_is_locked
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
name|uint8_t
name|reg
decl_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_CDR_RXCLK_DLPF_STATUS5_ADDR
argument_list|,
name|SERDES_25G_LANE_CDR_RXCLK_DLPF_STATUS5_LOCKED_MASK
argument_list|,
name|SERDES_25G_LANE_CDR_RXCLK_DLPF_STATUS5_LOCKED_SHIFT
argument_list|,
operator|&
name|reg
argument_list|)
expr_stmt|;
return|return
operator|!
operator|!
name|reg
return|;
block|}
end_function

begin_function
specifier|static
name|al_bool
name|al_serdes_25g_rx_valid
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
name|uint8_t
name|reg
decl_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_TOP_LN_STAT_CTRL0_ADDR
argument_list|,
name|SERDES_25G_LANE_TOP_LN_STAT_CTRL0_RXVALID_MASK
argument_list|,
name|SERDES_25G_LANE_TOP_LN_STAT_CTRL0_RXVALID_SHIFT
argument_list|,
operator|&
name|reg
argument_list|)
expr_stmt|;
return|return
operator|!
operator|!
name|reg
return|;
block|}
end_function

begin_function
specifier|static
name|al_bool
name|al_serdes_25g_signal_is_detected
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
name|struct
name|al_serdes_c_regs
name|__iomem
modifier|*
name|regs_base
init|=
name|obj
operator|->
name|regs_base
decl_stmt|;
name|uint32_t
name|reg
decl_stmt|;
name|al_bool
name|signal_detect
init|=
name|AL_FALSE
decl_stmt|;
name|reg
operator|=
name|al_reg_read32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
name|lane
index|]
operator|.
name|stat
argument_list|)
expr_stmt|;
name|signal_detect
operator|=
operator|(
operator|(
name|reg
operator|&
operator|(
name|SERDES_C_LANE_STAT_LN_STAT_LOS
operator||
name|SERDES_C_LANE_STAT_LN_STAT_LOS_DEGLITCH
operator|)
operator|)
condition|?
name|AL_FALSE
else|:
name|AL_TRUE
operator|)
expr_stmt|;
return|return
name|signal_detect
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|al_serdes_25g_rx_equalization
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
name|struct
name|al_serdes_c_regs
name|__iomem
modifier|*
name|regs_base
init|=
name|obj
operator|->
name|regs_base
decl_stmt|;
name|uint32_t
name|ready_mask
init|=
operator|(
name|SERDES_C_GEN_STATUS_CM0_RST_PD_READY
operator||
name|SERDES_C_GEN_STATUS_CM0_OK_O
operator|)
decl_stmt|;
name|uint32_t
name|reset_mask
decl_stmt|;
name|uint32_t
name|timeout
decl_stmt|;
name|uint32_t
name|reg_val
decl_stmt|;
name|uint32_t
name|retries
init|=
name|AL_SERDES_25G_RESET_NUM_RETRIES
decl_stmt|;
name|int
name|status
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|lane
operator|==
literal|0
condition|)
block|{
name|ready_mask
operator||=
name|SERDES_C_GEN_STATUS_LN0_RST_PD_READY
expr_stmt|;
name|reset_mask
operator|=
name|SERDES_C_GEN_RST_LN0_RST_N
expr_stmt|;
block|}
else|else
block|{
name|ready_mask
operator||=
name|SERDES_C_GEN_STATUS_LN1_RST_PD_READY
expr_stmt|;
name|reset_mask
operator|=
name|SERDES_C_GEN_RST_LN1_RST_N
expr_stmt|;
block|}
while|while
condition|(
name|retries
operator|>
literal|0
condition|)
block|{
name|timeout
operator|=
name|AL_SERDES_25G_WAIT_FOR_READY_TO
expr_stmt|;
name|status
operator|=
literal|0
expr_stmt|;
name|al_reg_write32_masked
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|rst
argument_list|,
name|reset_mask
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_msleep
argument_list|(
name|AL_SERDES_25G_RESET_TO
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_FEATURE_CTLE_ADAPT_MBS_CFG_ADDR
argument_list|,
name|SERDES_25G_LANE_FEATURE_CTLE_ADAPT_MBS_CFG_INIT0_EN_MASK
argument_list|,
name|SERDES_25G_LANE_FEATURE_CTLE_ADAPT_MBS_CFG_INIT0_EN_SHIFT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_EQ_MB_CTRL1_ADDR
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_EQ_MB_CTRL1_EQ_MBF_START_MASK
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_EQ_MB_CTRL1_EQ_MBF_START_SHIFT
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_EQ_MB_CTRL1_ADDR
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_EQ_MB_CTRL1_EQ_MBG_START_MASK
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_EQ_MB_CTRL1_EQ_MBG_START_SHIFT
argument_list|,
literal|15
argument_list|)
expr_stmt|;
name|al_msleep
argument_list|(
name|AL_SERDES_25G_RESET_TO
argument_list|)
expr_stmt|;
name|al_reg_write32_masked
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|rst
argument_list|,
name|reset_mask
argument_list|,
name|reset_mask
argument_list|)
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|reg_val
operator|=
name|al_reg_read32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|status
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|reg_val
operator|&
name|ready_mask
operator|)
operator|==
name|ready_mask
condition|)
break|break;
name|al_udelay
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|timeout
operator|--
expr_stmt|;
if|if
condition|(
name|timeout
operator|==
literal|0
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: Timeout waiting for serdes ready\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|status
operator|=
name|ETIMEDOUT
expr_stmt|;
name|retries
operator|--
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|status
condition|)
continue|continue;
while|while
condition|(
literal|1
condition|)
block|{
name|reg_val
operator|=
name|al_reg_read32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
name|lane
index|]
operator|.
name|stat
argument_list|)
expr_stmt|;
name|reg_val
operator|&=
operator|(
name|SERDES_C_LANE_STAT_LNX_STAT_OK
operator||
name|SERDES_C_LANE_STAT_LN_STAT_RXVALID
operator|)
expr_stmt|;
if|if
condition|(
name|reg_val
operator|==
operator|(
name|SERDES_C_LANE_STAT_LNX_STAT_OK
operator||
name|SERDES_C_LANE_STAT_LN_STAT_RXVALID
operator|)
condition|)
break|break;
name|al_udelay
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|timeout
operator|--
expr_stmt|;
if|if
condition|(
name|timeout
operator|==
literal|0
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: TO waiting for lane ready (%x)\n"
argument_list|,
name|__func__
argument_list|,
name|reg_val
argument_list|)
expr_stmt|;
name|status
operator|=
name|ETIMEDOUT
expr_stmt|;
name|retries
operator|--
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|status
condition|)
continue|continue;
break|break;
block|}
if|if
condition|(
name|retries
operator|==
literal|0
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: Failed to run equalization\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|status
operator|=
name|ETIMEDOUT
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_define
define|#
directive|define
name|AL_SERDES_25G_GCFSM2_READ_TIMEOUT
value|2000000
end_define

begin_comment
comment|/* uSec */
end_comment

begin_function
specifier|static
name|int
name|al_serdes_25g_gcfsm2_read
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|uint8_t
name|offset
parameter_list|,
name|uint16_t
modifier|*
name|data
parameter_list|)
block|{
name|int
name|status
init|=
literal|0
decl_stmt|;
name|uint32_t
name|timeout
init|=
name|AL_SERDES_25G_GCFSM2_READ_TIMEOUT
decl_stmt|;
name|uint8_t
name|ack
init|=
literal|0
decl_stmt|;
name|uint8_t
name|data_low
decl_stmt|,
name|data_high
decl_stmt|;
name|al_assert
argument_list|(
name|data
argument_list|)
expr_stmt|;
comment|/* Make sure GCFSM2 REQuest is off */
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL0_ADDR
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL0_REQ_MASK
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL0_REQ_SHIFT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Write GCFSM2 CMD; CMD=0 for Read Request */
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL1_ADDR
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL1_CMD_MASK
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL1_CMD_SHIFT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Write GCFSM2 the Address we wish to read */
name|al_serdes_25g_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL2_ADDR
argument_list|,
name|offset
argument_list|)
expr_stmt|;
comment|/* Issue a command REQuest */
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL0_ADDR
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL0_REQ_MASK
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL0_REQ_SHIFT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* Poll on GCFSM2 ACK */
while|while
condition|(
literal|1
condition|)
block|{
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_STATUS_ADDR
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_STATUS_ACK_MASK
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_STATUS_ACK_SHIFT
argument_list|,
operator|&
name|ack
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|||
operator|(
name|timeout
operator|==
literal|0
operator|)
condition|)
break|break;
name|timeout
operator|--
expr_stmt|;
name|al_udelay
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ack
condition|)
block|{
comment|/* Read 12bit of register value */
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_GCFSM2_READ_SHADOW_DATA_STATUS0_ADDR
argument_list|,
operator|&
name|data_low
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_GCFSM2_READ_SHADOW_DATA_STATUS1_ADDR
argument_list|,
name|SERDES_25G_LANE_GCFSM2_READ_SHADOW_DATA_STATUS1_11_8_MASK
argument_list|,
name|SERDES_25G_LANE_GCFSM2_READ_SHADOW_DATA_STATUS1_11_8_SHIFT
argument_list|,
operator|&
name|data_high
argument_list|)
expr_stmt|;
operator|*
name|data
operator|=
operator|(
name|data_high
operator|<<
literal|8
operator|)
operator||
name|data_low
expr_stmt|;
block|}
else|else
block|{
name|al_err
argument_list|(
literal|"%s: TO waiting for GCFSM2 req to complete (%x)\n"
argument_list|,
name|__func__
argument_list|,
name|offset
argument_list|)
expr_stmt|;
name|status
operator|=
name|ETIMEDOUT
expr_stmt|;
block|}
comment|/* Deassert the GCFSM2 REQuest */
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL0_ADDR
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL0_REQ_MASK
argument_list|,
name|SERDES_25G_LANE_GCFSM2_CMD_CTRL0_REQ_SHIFT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_enum
enum|enum
name|al_serdes_25g_rx_leq_fsm_opcode
block|{
name|AL_SERDES_25G_RX_LEQ_FSM_OPCODE_READ
init|=
literal|0x1
block|,
name|AL_SERDES_25G_RX_LEQ_FSM_OPCODE_WRITE
init|=
literal|0x2
block|, }
enum|;
end_enum

begin_enum
enum|enum
name|al_serdes_25g_rx_leq_fsm_target
block|{
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_AGC_SOURCE
init|=
literal|0x1
block|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_PLE_ATT
init|=
literal|0x2
block|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_EQ_LFG
init|=
literal|0x3
block|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_GN_APG
init|=
literal|0x4
block|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_GNEQ_CCL_LFG
init|=
literal|0x5
block|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_HFG_SQL
init|=
literal|0x6
block|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_EQ_MBF
init|=
literal|0x8
block|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_EQ_MBG
init|=
literal|0x9
block|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_VSCAN
init|=
literal|0xA
block|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_HSCAN
init|=
literal|0xB
block|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_EYE_INTF
init|=
literal|0xC
block|, }
enum|;
end_enum

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_LEQ_FSM_TIMEOUT
value|2000000
end_define

begin_comment
comment|/* uSec */
end_comment

begin_function
specifier|static
name|int
name|al_serdes_25g_rx_leq_fsm_op
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|enum
name|al_serdes_25g_rx_leq_fsm_opcode
name|opcode
parameter_list|,
name|enum
name|al_serdes_25g_rx_leq_fsm_target
name|target
parameter_list|,
name|uint8_t
name|val
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|,
name|uint8_t
modifier|*
name|err
parameter_list|)
block|{
name|uint32_t
name|reg
decl_stmt|;
name|uint32_t
name|timeout
init|=
name|AL_SERDES_25G_RX_LEQ_FSM_TIMEOUT
decl_stmt|;
name|uint8_t
name|ack
init|=
literal|0
decl_stmt|;
name|int
name|status
init|=
literal|0
decl_stmt|;
name|al_assert
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
name|err
argument_list|)
expr_stmt|;
comment|/* Write the OpCode& Target to LEQ FSM */
name|reg
operator|=
operator|(
name|target
operator|<<
literal|4
operator|)
operator||
name|opcode
expr_stmt|;
name|al_serdes_25g_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_CMD0_ADDR
argument_list|,
name|reg
argument_list|)
expr_stmt|;
comment|/* Write 0 as MiscOption value to LEQ FSM */
name|al_serdes_25g_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_CMD2_ADDR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Write the ArgumentValue to LEQ FSM if needed*/
if|if
condition|(
name|opcode
operator|==
name|AL_SERDES_25G_RX_LEQ_FSM_OPCODE_WRITE
condition|)
block|{
name|al_serdes_25g_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_CMD1_ADDR
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
comment|/* Issue an LEQ FSM Command Request */
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_CTRL0_ADDR
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_CTRL0_LEQ_FSM_CMD_REQ_MASK
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_CTRL0_LEQ_FSM_CMD_REQ_SHIFT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* Poll on LEQ FSM Command acknowledge */
while|while
condition|(
literal|1
condition|)
block|{
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_STATUS5_ADDR
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_STATUS5_LEQ_FSM_CMD_ACK_MASK
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_STATUS5_LEQ_FSM_CMD_ACK_SHIFT
argument_list|,
operator|&
name|ack
argument_list|)
expr_stmt|;
if|if
condition|(
name|ack
operator|||
operator|(
name|timeout
operator|==
literal|0
operator|)
condition|)
break|break;
name|timeout
operator|--
expr_stmt|;
name|al_udelay
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ack
condition|)
block|{
name|uint8_t
name|err1
decl_stmt|,
name|err2
decl_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_STATUS0_ADDR
argument_list|,
name|err
argument_list|)
expr_stmt|;
name|err1
operator|=
operator|(
operator|*
name|err
operator|&
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_STATUS0_LEQ_FSM_STATUS_ERROR1_MASK
operator|)
operator|>>
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_STATUS0_LEQ_FSM_STATUS_ERROR1_SHIFT
expr_stmt|;
name|err2
operator|=
operator|(
operator|*
name|err
operator|&
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_STATUS0_LEQ_FSM_STATUS_ERROR2_MASK
operator|)
operator|>>
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_STATUS0_LEQ_FSM_STATUS_ERROR2_SHIFT
expr_stmt|;
if|if
condition|(
name|err1
operator|||
name|err2
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: error in RX LEQ FSM req, err status 1=0x%x, err status 2=0x%x"
argument_list|,
name|__func__
argument_list|,
name|err1
argument_list|,
name|err2
argument_list|)
expr_stmt|;
name|status
operator|=
operator|-
name|EIO
expr_stmt|;
block|}
comment|/* Read LEQ FSM Command return Value */
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_STATUS3_ADDR
argument_list|,
name|data
argument_list|)
expr_stmt|;
comment|/* Clear an LEQ FSM Command Request */
name|al_serdes_25g_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_CTRL0_ADDR
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_CTRL0_LEQ_FSM_CMD_REQ_MASK
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_LEQ_FSM_CTRL0_LEQ_FSM_CMD_REQ_SHIFT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|al_err
argument_list|(
literal|"%s: TO waiting for RX LEQ FSM req to complete (opcode %x, target %x, val %x)\n"
argument_list|,
name|__func__
argument_list|,
name|opcode
argument_list|,
name|target
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|status
operator|=
name|ETIMEDOUT
expr_stmt|;
block|}
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/* enum values correspond to HW values, don't change! */
end_comment

begin_enum
enum|enum
name|al_serdes_25g_tbus_obj
block|{
name|AL_SERDES_25G_TBUS_OBJ_TOP
init|=
literal|0
block|,
name|AL_SERDES_25G_TBUS_OBJ_CMU
init|=
literal|1
block|,
name|AL_SERDES_25G_TBUS_OBJ_LANE
init|=
literal|2
block|, }
enum|;
end_enum

begin_define
define|#
directive|define
name|AL_SERDES_25G_TBUS_DELAY
value|1000
end_define

begin_comment
comment|/* uSec */
end_comment

begin_define
define|#
directive|define
name|AL_SERDES_25G_TBUS_ADDR_HIGH_SHIFT
value|5
end_define

begin_function
specifier|static
name|int
name|al_serdes_25g_tbus_read
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|enum
name|al_serdes_25g_tbus_obj
name|tbus_obj
parameter_list|,
name|uint8_t
name|offset
parameter_list|,
name|uint16_t
modifier|*
name|data
parameter_list|)
block|{
name|uint8_t
name|addr_high
decl_stmt|,
name|val_high
decl_stmt|,
name|val_low
decl_stmt|;
name|al_assert
argument_list|(
name|lane
operator|<
name|AL_SRDS_NUM_LANES
argument_list|)
expr_stmt|;
if|if
condition|(
name|tbus_obj
operator|==
name|AL_SERDES_25G_TBUS_OBJ_TOP
condition|)
name|addr_high
operator|=
name|AL_SERDES_25G_TBUS_OBJ_TOP
expr_stmt|;
elseif|else
if|if
condition|(
name|tbus_obj
operator|==
name|AL_SERDES_25G_TBUS_OBJ_CMU
condition|)
name|addr_high
operator|=
name|AL_SERDES_25G_TBUS_OBJ_CMU
expr_stmt|;
else|else
name|addr_high
operator|=
name|AL_SERDES_25G_TBUS_OBJ_LANE
operator|+
name|lane
expr_stmt|;
name|addr_high
operator|<<=
name|AL_SERDES_25G_TBUS_ADDR_HIGH_SHIFT
expr_stmt|;
name|al_serdes_25g_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_TOP_TBUS_ADDR_7_0_ADDR
argument_list|,
name|offset
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_TOP_TBUS_ADDR_15_8_ADDR
argument_list|,
name|addr_high
argument_list|)
expr_stmt|;
name|al_udelay
argument_list|(
name|AL_SERDES_25G_TBUS_DELAY
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_TOP_TBUS_DATA_7_0_ADDR
argument_list|,
operator|&
name|val_low
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_TOP
argument_list|,
name|SERDES_25G_TOP_TBUS_DATA_11_8_ADDR
argument_list|,
name|SERDES_25G_TOP_TBUS_DATA_11_8_MASK
argument_list|,
name|SERDES_25G_TOP_TBUS_DATA_11_8_SHIFT
argument_list|,
operator|&
name|val_high
argument_list|)
expr_stmt|;
operator|*
name|data
operator|=
operator|(
name|val_high
operator|<<
literal|8
operator|)
operator||
name|val_low
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_ADV_PARAMS_ATT_MASK
value|0x07
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_ADV_PARAMS_APG_MASK
value|0x03
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_ADV_PARAMS_LFG_MASK
value|0x1F
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_ADV_PARAMS_HFG_MASK
value|0x1F
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_ADV_PARAMS_MBG_MASK
value|0x0F
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_ADV_PARAMS_MBF_MASK
value|0x0F
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_ADV_PARAMS_DFE_TAP_CNT
value|8
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_ADV_PARAMS_DFE_TAP_MASK
value|0x1F
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_ADV_PARAMS_DFE_TAP_SIGN_SHIFT
value|7
end_define

begin_function
specifier|static
name|void
name|al_serdes_25g_rx_advanced_params_get
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|void
modifier|*
name|rx_params
parameter_list|)
block|{
name|struct
name|al_serdes_25g_adv_rx_params
modifier|*
name|params
init|=
name|rx_params
decl_stmt|;
name|uint8_t
name|value
decl_stmt|,
name|err
decl_stmt|;
name|int8_t
name|tap_weight
decl_stmt|;
name|uint8_t
name|tap_sign
decl_stmt|;
name|int8_t
modifier|*
name|tap_ptr_arr
index|[
name|AL_SERDES_25G_RX_ADV_PARAMS_DFE_TAP_CNT
index|]
decl_stmt|;
name|int
name|rc
decl_stmt|;
name|int
name|i
decl_stmt|;
name|rc
operator|=
name|al_serdes_25g_rx_leq_fsm_op
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_OPCODE_READ
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_PLE_ATT
argument_list|,
literal|0
argument_list|,
operator|&
name|value
argument_list|,
operator|&
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|||
name|err
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_rx_leq_fsm_op failed to read att, rc %d, err %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|,
name|err
argument_list|)
expr_stmt|;
return|return;
block|}
name|params
operator|->
name|att
operator|=
name|value
operator|&
name|AL_SERDES_25G_RX_ADV_PARAMS_ATT_MASK
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_rx_leq_fsm_op
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_OPCODE_READ
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_GN_APG
argument_list|,
literal|0
argument_list|,
operator|&
name|value
argument_list|,
operator|&
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|||
name|err
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_rx_leq_fsm_op failed to read apg, rc %d, err %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|,
name|err
argument_list|)
expr_stmt|;
return|return;
block|}
name|params
operator|->
name|apg
operator|=
name|value
operator|&
name|AL_SERDES_25G_RX_ADV_PARAMS_APG_MASK
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_rx_leq_fsm_op
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_OPCODE_READ
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_EQ_LFG
argument_list|,
literal|0
argument_list|,
operator|&
name|value
argument_list|,
operator|&
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|||
name|err
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_rx_leq_fsm_op failed to read lfg, rc %d, err %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|,
name|err
argument_list|)
expr_stmt|;
return|return;
block|}
name|params
operator|->
name|lfg
operator|=
name|value
operator|&
name|AL_SERDES_25G_RX_ADV_PARAMS_LFG_MASK
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_rx_leq_fsm_op
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_OPCODE_READ
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_HFG_SQL
argument_list|,
literal|0
argument_list|,
operator|&
name|value
argument_list|,
operator|&
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|||
name|err
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_rx_leq_fsm_op failed to read hfg, rc %d, err %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|,
name|err
argument_list|)
expr_stmt|;
return|return;
block|}
name|params
operator|->
name|hfg
operator|=
name|value
operator|&
name|AL_SERDES_25G_RX_ADV_PARAMS_HFG_MASK
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_rx_leq_fsm_op
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_OPCODE_READ
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_EQ_MBG
argument_list|,
literal|0
argument_list|,
operator|&
name|value
argument_list|,
operator|&
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|||
name|err
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_rx_leq_fsm_op failed to read mbg, rc %d, err %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|,
name|err
argument_list|)
expr_stmt|;
return|return;
block|}
name|params
operator|->
name|mbg
operator|=
name|value
operator|&
name|AL_SERDES_25G_RX_ADV_PARAMS_MBG_MASK
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_rx_leq_fsm_op
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_OPCODE_READ
argument_list|,
name|AL_SERDES_25G_RX_LEQ_FSM_TARGET_EQ_MBF
argument_list|,
literal|0
argument_list|,
operator|&
name|value
argument_list|,
operator|&
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|||
name|err
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_rx_leq_fsm_op failed to read mbf, rc %d, err %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|,
name|err
argument_list|)
expr_stmt|;
return|return;
block|}
name|params
operator|->
name|mbf
operator|=
name|value
operator|&
name|AL_SERDES_25G_RX_ADV_PARAMS_MBF_MASK
expr_stmt|;
name|tap_ptr_arr
index|[
literal|0
index|]
operator|=
operator|&
name|params
operator|->
name|dfe_first_tap_even0_ctrl
expr_stmt|;
name|tap_ptr_arr
index|[
literal|1
index|]
operator|=
operator|&
name|params
operator|->
name|dfe_first_tap_even1_ctrl
expr_stmt|;
name|tap_ptr_arr
index|[
literal|2
index|]
operator|=
operator|&
name|params
operator|->
name|dfe_first_tap_odd0_ctrl
expr_stmt|;
name|tap_ptr_arr
index|[
literal|3
index|]
operator|=
operator|&
name|params
operator|->
name|dfe_first_tap_odd1_ctrl
expr_stmt|;
name|tap_ptr_arr
index|[
literal|4
index|]
operator|=
operator|&
name|params
operator|->
name|dfe_second_tap_ctrl
expr_stmt|;
name|tap_ptr_arr
index|[
literal|5
index|]
operator|=
operator|&
name|params
operator|->
name|dfe_third_tap_ctrl
expr_stmt|;
name|tap_ptr_arr
index|[
literal|6
index|]
operator|=
operator|&
name|params
operator|->
name|dfe_fourth_tap_ctrl
expr_stmt|;
name|tap_ptr_arr
index|[
literal|7
index|]
operator|=
operator|&
name|params
operator|->
name|dfe_fifth_tap_ctrl
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AL_SERDES_25G_RX_ADV_PARAMS_DFE_TAP_CNT
condition|;
name|i
operator|++
control|)
block|{
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_DFE_REFCLK_TAP_VAL_STATUS0_ADDR
operator|+
name|i
argument_list|,
operator|&
name|value
argument_list|)
expr_stmt|;
name|tap_weight
operator|=
name|value
operator|&
name|AL_SERDES_25G_RX_ADV_PARAMS_DFE_TAP_MASK
expr_stmt|;
name|tap_sign
operator|=
operator|(
name|value
operator|&
name|AL_BIT
argument_list|(
name|AL_SERDES_25G_RX_ADV_PARAMS_DFE_TAP_SIGN_SHIFT
argument_list|)
operator|)
operator|>>
name|AL_SERDES_25G_RX_ADV_PARAMS_DFE_TAP_SIGN_SHIFT
expr_stmt|;
if|if
condition|(
name|tap_sign
operator|==
literal|0
condition|)
name|tap_weight
operator|=
literal|0
operator|-
name|tap_weight
expr_stmt|;
operator|*
name|tap_ptr_arr
index|[
name|i
index|]
operator|=
name|tap_weight
expr_stmt|;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|AL_SERDES_25G_TX_DIAG_GCFSM2_DCD_TRIM_ADDR
value|0x0B
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_TX_DIAG_GCFSM2_DCD_TRIM_MASK
value|0x3F
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_TX_DIAG_GCFSM2_DCD_TRIM_SIGN_SHIFT
value|7
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_TX_DIAG_GCFSM2_CLK_DELAY_ADDR
value|0x0C
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_TX_DIAG_GCFSM2_CLK_DELAY_MASK
value|0xFFF
end_define

begin_function
specifier|static
name|void
name|al_serdes_25g_tx_diag_info_get
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|void
modifier|*
name|tx_info
parameter_list|)
block|{
name|struct
name|al_serdes_25g_tx_diag_info
modifier|*
name|info
init|=
name|tx_info
decl_stmt|;
name|uint8_t
name|cal_x1
decl_stmt|,
name|cal_x1_fixed
decl_stmt|,
name|cal_x2
decl_stmt|,
name|cal_xp5_fixed
decl_stmt|;
name|uint16_t
name|val16
decl_stmt|,
name|sign
decl_stmt|;
name|uint8_t
name|val8
decl_stmt|,
name|abs
decl_stmt|;
name|int
name|rc
decl_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_TOP_AFE_TXCP_CTRL0_ADDR
argument_list|,
operator|&
name|val8
argument_list|)
expr_stmt|;
name|info
operator|->
name|regulated_supply
operator|=
name|val8
operator|&
name|SERDES_25G_LANE_TOP_AFE_TXCP_CTRL0_REG_TXCP_TRIM_MASK
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_gcfsm2_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_TX_DIAG_GCFSM2_DCD_TRIM_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_gcfsm2_read failed to read dcd_trim, rc %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|)
expr_stmt|;
return|return;
block|}
name|abs
operator|=
name|val16
operator|&
name|AL_SERDES_25G_TX_DIAG_GCFSM2_DCD_TRIM_MASK
expr_stmt|;
name|sign
operator|=
operator|(
name|val16
operator|&
name|AL_BIT
argument_list|(
name|AL_SERDES_25G_TX_DIAG_GCFSM2_DCD_TRIM_SIGN_SHIFT
argument_list|)
operator|)
operator|>>
name|AL_SERDES_25G_TX_DIAG_GCFSM2_DCD_TRIM_SIGN_SHIFT
expr_stmt|;
if|if
condition|(
name|sign
condition|)
name|info
operator|->
name|dcd_trim
operator|=
name|abs
expr_stmt|;
else|else
name|info
operator|->
name|dcd_trim
operator|=
literal|0
operator|-
name|abs
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_gcfsm2_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_TX_DIAG_GCFSM2_CLK_DELAY_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_gcfsm2_read failed to read clk_delay, rc %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|)
expr_stmt|;
return|return;
block|}
name|info
operator|->
name|clk_delay
operator|=
name|val16
operator|&
name|AL_SERDES_25G_TX_DIAG_GCFSM2_CLK_DELAY_MASK
expr_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_CM_TOP_AFE_TXTC_CTRL2_ADDR
argument_list|,
operator|&
name|val8
argument_list|)
expr_stmt|;
name|cal_x1
operator|=
operator|(
name|val8
operator|&
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL2_TXTC_CALP_X1_MASK
operator|)
operator|>>
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL2_TXTC_CALP_X1_SHIFT
expr_stmt|;
name|cal_x1_fixed
operator|=
operator|(
name|val8
operator|&
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL2_TXTC_CALP_X1_FIXED_MASK
operator|)
operator|>>
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL2_TXTC_CALP_X1_FIXED_SHIFT
expr_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_CM_TOP_AFE_TXTC_CTRL3_ADDR
argument_list|,
operator|&
name|val8
argument_list|)
expr_stmt|;
name|cal_x2
operator|=
operator|(
name|val8
operator|&
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL3_TXTC_CALP_X2_MASK
operator|)
operator|>>
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL3_TXTC_CALP_X2_SHIFT
expr_stmt|;
name|cal_xp5_fixed
operator|=
operator|(
name|val8
operator|&
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL3_TXTC_CALP_XP5_FIXED_MASK
operator|)
operator|>>
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL3_TXTC_CALP_XP5_FIXED_SHIFT
expr_stmt|;
name|info
operator|->
name|calp_multiplied_by_2
operator|=
literal|4
operator|*
name|cal_x2
operator|+
literal|2
operator|*
name|cal_x1
operator|+
literal|2
operator|*
name|cal_x1_fixed
operator|+
name|cal_xp5_fixed
expr_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_CM_TOP_AFE_TXTC_CTRL0_ADDR
argument_list|,
operator|&
name|val8
argument_list|)
expr_stmt|;
name|cal_x1
operator|=
operator|(
name|val8
operator|&
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL0_TXTC_CALN_X1_MASK
operator|)
operator|>>
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL0_TXTC_CALN_X1_SHIFT
expr_stmt|;
name|cal_x1_fixed
operator|=
operator|(
name|val8
operator|&
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL0_TXTC_CALN_X1_FIXED_MASK
operator|)
operator|>>
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL0_TXTC_CALN_X1_FIXED_SHIFT
expr_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_CM_TOP_AFE_TXTC_CTRL1_ADDR
argument_list|,
operator|&
name|val8
argument_list|)
expr_stmt|;
name|cal_x2
operator|=
operator|(
name|val8
operator|&
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL1_TXTC_CALN_X2_MASK
operator|)
operator|>>
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL1_TXTC_CALN_X2_SHIFT
expr_stmt|;
name|cal_xp5_fixed
operator|=
operator|(
name|val8
operator|&
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL1_TXTC_CALN_XP5_FIXED_MASK
operator|)
operator|>>
name|SERDES_25G_CMU_TOP_AFE_TXTC_CTRL1_TXTC_CALN_XP5_FIXED_SHIFT
expr_stmt|;
name|info
operator|->
name|caln_multiplied_by_2
operator|=
literal|4
operator|*
name|cal_x2
operator|+
literal|2
operator|*
name|cal_x1
operator|+
literal|2
operator|*
name|cal_x1_fixed
operator|+
name|cal_xp5_fixed
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_ABS_MASK
value|0x1F
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_MASK
value|0x3F
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_SIGN_SHIFT
value|5
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_HIGH_MASK
value|0xFC0
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_HIGH_SHIFT
value|6
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_LEQ_EQ_COUNT
value|5
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_GCFSM2_LEQ_EQ_ADDR
value|0
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_GCFSM2_LEQ_GAINSTAGE_ADDR
value|0x5
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_GCFSM2_SUMMER_EVEN_ADDR
value|0x6
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_GCFSM2_SUMMER_ODD_ADDR
value|0x7
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_GCFSM2_VSCAN_EVEN_ADDR
value|0x8
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_GCFSM2_VSCAN_ODD_ADDR
value|0x9
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_GCFSM2_CDR_VCO_FR_ADDR
value|0xF
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_GCFSM2_CDR_VCO_FR_MASK
value|0xFFF
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_TBUS_DATA_SLICER_EVEN_ADDR
value|0x11
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_TBUS_DATA_SLICER_ODD_ADDR
value|0x12
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_TBUS_EDGE_SLICER_ADDR
value|0x13
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_TBUS_EYE_SLICER_ADDR
value|0x23
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_TBUS_CDR_CLK_Q_ADDR
value|0x2
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_TBUS_CDR_CLK_I_ADDR
value|0x1
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_CDR_RXCLK_DLPF_L_ADDR
value|0x26
end_define

begin_define
define|#
directive|define
name|AL_SERDES_25G_RX_DIAG_CDR_RXCLK_DLPF_H_ADDR
value|0x27
end_define

begin_function
specifier|static
specifier|inline
name|void
name|al_serdes_25g_rx_diag_5bit_signed_set
parameter_list|(
name|uint8_t
name|packed_val
parameter_list|,
name|int8_t
modifier|*
name|ptr
parameter_list|)
block|{
name|uint8_t
name|abs
decl_stmt|,
name|sign
decl_stmt|;
name|abs
operator|=
name|packed_val
operator|&
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_ABS_MASK
expr_stmt|;
name|sign
operator|=
operator|(
name|packed_val
operator|&
name|AL_BIT
argument_list|(
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_SIGN_SHIFT
argument_list|)
operator|)
operator|>>
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_SIGN_SHIFT
expr_stmt|;
if|if
condition|(
name|sign
condition|)
operator|*
name|ptr
operator|=
name|abs
expr_stmt|;
else|else
operator|*
name|ptr
operator|=
literal|0
operator|-
name|abs
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_25g_rx_diag_info_get
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|void
modifier|*
name|rx_info
parameter_list|)
block|{
name|struct
name|al_serdes_25g_rx_diag_info
modifier|*
name|info
init|=
name|rx_info
decl_stmt|;
name|uint16_t
name|val16
decl_stmt|;
name|uint8_t
name|val8
decl_stmt|,
name|val8_2
decl_stmt|;
name|int
name|rc
decl_stmt|;
name|int
name|i
decl_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_LOS_REFCLK_CALIBRATION_STATUS0_ADDR
argument_list|,
operator|&
name|val8
argument_list|)
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|los_offset
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_LOS_REFCLK_CALIBRATION_STATUS1_ADDR
argument_list|,
operator|&
name|val8
argument_list|)
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|agc_offset
argument_list|)
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_gcfsm2_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_DIAG_GCFSM2_LEQ_GAINSTAGE_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_gcfsm2_read failed to read leq_gainstage, rc %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|)
expr_stmt|;
return|return;
block|}
name|val8
operator|=
operator|(
name|uint8_t
operator|)
name|val16
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|leq_gainstage_offset
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AL_SERDES_25G_RX_DIAG_LEQ_EQ_COUNT
condition|;
name|i
operator|++
control|)
block|{
name|rc
operator|=
name|al_serdes_25g_gcfsm2_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_DIAG_GCFSM2_LEQ_EQ_ADDR
operator|+
name|i
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_gcfsm2_read failed to read leq_eq %d, rc %d\n"
argument_list|,
name|__func__
argument_list|,
name|i
argument_list|,
name|rc
argument_list|)
expr_stmt|;
return|return;
block|}
name|val8
operator|=
operator|(
name|uint8_t
operator|)
name|val16
expr_stmt|;
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0
case|:
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|leq_eq1_offset
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|leq_eq2_offset
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|leq_eq3_offset
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|leq_eq4_offset
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|leq_eq5_offset
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
name|rc
operator|=
name|al_serdes_25g_gcfsm2_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_DIAG_GCFSM2_SUMMER_EVEN_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_gcfsm2_read failed to read summer_even_offset, rc %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|)
expr_stmt|;
return|return;
block|}
name|val8
operator|=
operator|(
name|uint8_t
operator|)
name|val16
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|summer_even_offset
argument_list|)
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_gcfsm2_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_DIAG_GCFSM2_SUMMER_ODD_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_gcfsm2_read failed to read summer_odd_offset, rc %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|)
expr_stmt|;
return|return;
block|}
name|val8
operator|=
operator|(
name|uint8_t
operator|)
name|val16
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|summer_odd_offset
argument_list|)
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_gcfsm2_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_DIAG_GCFSM2_VSCAN_EVEN_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_gcfsm2_read failed to read vscan_even_offset, rc %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|)
expr_stmt|;
return|return;
block|}
name|val8
operator|=
operator|(
name|uint8_t
operator|)
name|val16
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|vscan_even_offset
argument_list|)
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_gcfsm2_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_DIAG_GCFSM2_VSCAN_ODD_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_gcfsm2_read failed to read vscan_odd_offset, rc %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|)
expr_stmt|;
return|return;
block|}
name|val8
operator|=
operator|(
name|uint8_t
operator|)
name|val16
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|vscan_odd_offset
argument_list|)
expr_stmt|;
name|al_serdes_25g_tbus_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_TBUS_OBJ_LANE
argument_list|,
name|AL_SERDES_25G_RX_DIAG_TBUS_DATA_SLICER_EVEN_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
name|val8
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|val16
operator|&
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_MASK
argument_list|)
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|data_slicer_even0_offset
argument_list|)
expr_stmt|;
name|val8
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|val16
operator|&
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_HIGH_MASK
operator|)
operator|>>
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_HIGH_SHIFT
argument_list|)
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|data_slicer_even1_offset
argument_list|)
expr_stmt|;
name|al_serdes_25g_tbus_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_TBUS_OBJ_LANE
argument_list|,
name|AL_SERDES_25G_RX_DIAG_TBUS_DATA_SLICER_ODD_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
name|val8
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|val16
operator|&
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_MASK
argument_list|)
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|data_slicer_odd0_offset
argument_list|)
expr_stmt|;
name|val8
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|val16
operator|&
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_HIGH_MASK
operator|)
operator|>>
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_HIGH_SHIFT
argument_list|)
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|data_slicer_odd1_offset
argument_list|)
expr_stmt|;
name|al_serdes_25g_tbus_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_TBUS_OBJ_LANE
argument_list|,
name|AL_SERDES_25G_RX_DIAG_TBUS_EDGE_SLICER_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
name|val8
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|val16
operator|&
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_MASK
argument_list|)
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|edge_slicer_even_offset
argument_list|)
expr_stmt|;
name|val8
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|val16
operator|&
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_HIGH_MASK
operator|)
operator|>>
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_HIGH_SHIFT
argument_list|)
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|edge_slicer_odd_offset
argument_list|)
expr_stmt|;
name|al_serdes_25g_tbus_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_TBUS_OBJ_LANE
argument_list|,
name|AL_SERDES_25G_RX_DIAG_TBUS_EYE_SLICER_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
name|val8
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|val16
operator|&
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_MASK
argument_list|)
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|eye_slicer_even_offset
argument_list|)
expr_stmt|;
name|val8
operator|=
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|val16
operator|&
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_HIGH_MASK
operator|)
operator|>>
name|AL_SERDES_25G_RX_DIAG_SIGNED_5BIT_HIGH_SHIFT
argument_list|)
expr_stmt|;
name|al_serdes_25g_rx_diag_5bit_signed_set
argument_list|(
name|val8
argument_list|,
operator|&
name|info
operator|->
name|eye_slicer_odd_offset
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_PI_CTRL0_ADDR
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_PI_CTRL0_RXCDR_HSCAN_CLKQ_MASK
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_PI_CTRL0_RXCDR_HSCAN_CLKQ_SHIFT
argument_list|,
operator|&
name|info
operator|->
name|cdr_clk_q
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_PI_CTRL1_ADDR
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_PI_CTRL1_RXCDR_HSCAN_CLKI_MASK
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_PI_CTRL1_RXCDR_HSCAN_CLKI_SHIFT
argument_list|,
operator|&
name|info
operator|->
name|cdr_clk_i
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_PI_CTRL2_ADDR
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_PI_CTRL2_RXCDR_HSCAN_EYE_MASK
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_PI_CTRL2_RXCDR_HSCAN_EYE_SHIFT
argument_list|,
operator|&
name|info
operator|->
name|cdr_dll
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_VCO_CTRL2_ADDR
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_VCO_CTRL2_RXCDR_DOSC_MASK
argument_list|,
name|SERDES_25G_LANE_CDR_REFCLK_AFE_VCO_CTRL2_RXCDR_DOSC_SHIFT
argument_list|,
operator|&
name|info
operator|->
name|cdr_vco_dosc
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_CDR_RXCLK_LOAD_MODE_CTRL1_ADDR
argument_list|,
operator|&
name|val8_2
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_CDR_RXCLK_LOAD_MODE_CTRL0_ADDR
argument_list|,
operator|&
name|val8
argument_list|)
expr_stmt|;
name|val8_2
operator|&=
name|SERDES_25G_LANE_CDR_RXCLK_LOAD_MODE_CTRL1_DLPF_VAL_8_MASK
expr_stmt|;
name|info
operator|->
name|cdr_dlpf
operator|=
operator|(
name|uint16_t
operator|)
name|val8_2
operator|<<
literal|8
operator||
name|val8
expr_stmt|;
name|rc
operator|=
name|al_serdes_25g_gcfsm2_read
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|AL_SERDES_25G_RX_DIAG_GCFSM2_CDR_VCO_FR_ADDR
argument_list|,
operator|&
name|val16
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: al_serdes_25g_gcfsm2_read failed to read cdr_vco_fr, rc %d\n"
argument_list|,
name|__func__
argument_list|,
name|rc
argument_list|)
expr_stmt|;
return|return;
block|}
name|info
operator|->
name|cdr_vco_fr
operator|=
name|val16
operator|&
name|AL_SERDES_25G_RX_DIAG_GCFSM2_CDR_VCO_FR_MASK
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_AFE_PLE_CTRL0_ADDR
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_AFE_PLE_CTRL0_RXLEQ_PLE_BLW_ZERO_MASK
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_AFE_PLE_CTRL0_RXLEQ_PLE_BLW_ZERO_SHIFT
argument_list|,
operator|&
name|info
operator|->
name|ple_resistance
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
literal|0
argument_list|,
name|SERDES_25G_LANE_TOP_AFE_RXTERM_CTRL0_ADDR
argument_list|,
operator|&
name|val8
argument_list|)
expr_stmt|;
name|info
operator|->
name|rx_term_mode
operator|=
operator|(
name|val8
operator|&
name|SERDES_25G_LANE_TOP_AFE_RXTERM_CTRL0_RXTERM_HIZ_MASK
operator|)
operator|>>
name|SERDES_25G_LANE_TOP_AFE_RXTERM_CTRL0_RXTERM_HIZ_SHIFT
expr_stmt|;
name|info
operator|->
name|rx_coupling
operator|=
operator|(
name|val8
operator|&
name|SERDES_25G_LANE_TOP_AFE_RXTERM_CTRL0_RXTERM_VCM_GND_MASK
operator|)
operator|>>
name|SERDES_25G_LANE_TOP_AFE_RXTERM_CTRL0_RXTERM_VCM_GND_SHIFT
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_TOP_AFE_RXTERM_CTRL1_ADDR
argument_list|,
name|SERDES_25G_LANE_TOP_AFE_RXTERM_CTRL1_RXTERM_VAL_MASK
argument_list|,
name|SERDES_25G_LANE_TOP_AFE_RXTERM_CTRL1_RXTERM_VAL_SHIFT
argument_list|,
operator|&
name|info
operator|->
name|rx_term_cal_code
argument_list|)
expr_stmt|;
name|al_serdes_25g_reg_masked_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_AFE_BIAS_CTRL1_ADDR
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_AFE_BIAS_CTRL1_RXLEQ_BIASI_TRIM_MASK
argument_list|,
name|SERDES_25G_LANE_LEQ_REFCLK_AFE_BIAS_CTRL1_RXLEQ_BIASI_TRIM_SHIFT
argument_list|,
operator|&
name|info
operator|->
name|rx_sheet_res_cal_code
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
name|int
name|al_serdes_25g_handle_init
parameter_list|(
name|void
name|__iomem
modifier|*
name|serdes_regs_base
parameter_list|,
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|)
block|{
name|al_dbg
argument_list|(
literal|"%s(%p, %p)\n"
argument_list|,
name|__func__
argument_list|,
name|serdes_regs_base
argument_list|,
name|obj
argument_list|)
expr_stmt|;
name|al_memset
argument_list|(
name|obj
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|al_serdes_grp_obj
argument_list|)
argument_list|)
expr_stmt|;
name|obj
operator|->
name|regs_base
operator|=
operator|(
expr|struct
name|al_serdes_regs
operator|*
operator|)
name|serdes_regs_base
expr_stmt|;
name|obj
operator|->
name|type_get
operator|=
name|al_serdes_25g_type_get
expr_stmt|;
name|obj
operator|->
name|reg_read
operator|=
name|al_serdes_25g_reg_read
expr_stmt|;
name|obj
operator|->
name|reg_write
operator|=
name|al_serdes_25g_reg_write
expr_stmt|;
name|obj
operator|->
name|bist_overrides_enable
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|bist_overrides_disable
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|rx_rate_change
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|group_pm_set
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|lane_pm_set
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|pma_hard_reset_group
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|pma_hard_reset_lane
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|loopback_control
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|bist_pattern_select
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_bist_pattern_select
argument_list|)
expr_stmt|;
name|obj
operator|->
name|bist_tx_enable
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_bist_tx_enable
argument_list|)
expr_stmt|;
name|obj
operator|->
name|bist_tx_err_inject
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|bist_rx_enable
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_bist_rx_enable
argument_list|)
expr_stmt|;
name|obj
operator|->
name|bist_rx_status
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_bist_rx_status
argument_list|)
expr_stmt|;
name|obj
operator|->
name|tx_deemph_preset
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|tx_deemph_inc
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|tx_deemph_dec
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|eye_measure_run
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|eye_diag_sample
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|eye_diag_run
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_eye_diag_run
argument_list|)
expr_stmt|;
name|obj
operator|->
name|cdr_is_locked
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_cdr_is_locked
argument_list|)
expr_stmt|;
name|obj
operator|->
name|rx_valid
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_rx_valid
argument_list|)
expr_stmt|;
name|obj
operator|->
name|signal_is_detected
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_signal_is_detected
argument_list|)
expr_stmt|;
name|obj
operator|->
name|tx_advanced_params_set
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_tx_advanced_params_set
argument_list|)
expr_stmt|;
name|obj
operator|->
name|tx_advanced_params_get
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_tx_advanced_params_get
argument_list|)
expr_stmt|;
name|obj
operator|->
name|rx_advanced_params_set
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|rx_advanced_params_get
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_rx_advanced_params_get
argument_list|)
expr_stmt|;
name|obj
operator|->
name|tx_diag_info_get
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_tx_diag_info_get
argument_list|)
expr_stmt|;
name|obj
operator|->
name|rx_diag_info_get
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_rx_diag_info_get
argument_list|)
expr_stmt|;
name|obj
operator|->
name|mode_set_sgmii
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|mode_set_kr
operator|=
name|NULL
expr_stmt|;
name|obj
operator|->
name|rx_equalization
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_rx_equalization
argument_list|)
expr_stmt|;
name|obj
operator|->
name|calc_eye_size
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_25g_calc_eye_size
argument_list|)
expr_stmt|;
name|obj
operator|->
name|sris_config
operator|=
name|NULL
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

