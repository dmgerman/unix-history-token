begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************************************************* Copyright (C) 2015 Annapurna Labs Ltd.  This file may be licensed under the terms of the Annapurna Labs Commercial License Agreement.  Alternatively, this file can be distributed under the terms of the GNU General Public License V2 as published by the Free Software Foundation and can be found at http://www.gnu.org/licenses/gpl-2.0.html  Alternatively, redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:      *     Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.      *     Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  *******************************************************************************/
end_comment

begin_include
include|#
directive|include
file|"al_hal_serdes_hssp.h"
end_include

begin_include
include|#
directive|include
file|"al_hal_serdes_hssp_regs.h"
end_include

begin_include
include|#
directive|include
file|"al_hal_serdes_hssp_internal_regs.h"
end_include

begin_define
define|#
directive|define
name|SRDS_CORE_REG_ADDR
parameter_list|(
name|page
parameter_list|,
name|type
parameter_list|,
name|offset
parameter_list|)
define|\
value|(((page)<< 13) | ((type)<< 12) | (offset))
end_define

begin_comment
comment|/* Link Training configuration */
end_comment

begin_define
define|#
directive|define
name|AL_SERDES_TX_DEEMPH_SUM_MAX
value|0x1b
end_define

begin_comment
comment|/* c configurations */
end_comment

begin_define
define|#
directive|define
name|AL_SERDES_TX_DEEMPH_C_ZERO_MAX_VAL
value|0x1b
end_define

begin_define
define|#
directive|define
name|AL_SERDES_TX_DEEMPH_C_ZERO_MIN_VAL
value|0
end_define

begin_define
define|#
directive|define
name|AL_SERDES_TX_DEEMPH_C_ZERO_PRESET
value|AL_SERDES_TX_DEEMPH_C_ZERO_MAX_VAL
end_define

begin_comment
comment|/* c(+1) configurations */
end_comment

begin_define
define|#
directive|define
name|AL_SERDES_TX_DEEMPH_C_PLUS_MAX_VAL
value|0x9
end_define

begin_define
define|#
directive|define
name|AL_SERDES_TX_DEEMPH_C_PLUS_MIN_VAL
value|0
end_define

begin_define
define|#
directive|define
name|AL_SERDES_TX_DEEMPH_C_PLUS_PRESET
value|AL_SERDES_TX_DEEMPH_C_PLUS_MIN_VAL
end_define

begin_comment
comment|/* c(-1) configurations */
end_comment

begin_define
define|#
directive|define
name|AL_SERDES_TX_DEEMPH_C_MINUS_MAX_VAL
value|0x6
end_define

begin_define
define|#
directive|define
name|AL_SERDES_TX_DEEMPH_C_MINUS_MIN_VAL
value|0
end_define

begin_define
define|#
directive|define
name|AL_SERDES_TX_DEEMPH_C_MINUS_PRESET
value|AL_SERDES_TX_DEEMPH_C_MINUS_MIN_VAL
end_define

begin_comment
comment|/* Rx equal total delay = MDELAY * TRIES */
end_comment

begin_define
define|#
directive|define
name|AL_SERDES_RX_EQUAL_MDELAY
value|10
end_define

begin_define
define|#
directive|define
name|AL_SERDES_RX_EQUAL_TRIES
value|50
end_define

begin_comment
comment|/* Rx eye calculation delay = MDELAY * TRIES */
end_comment

begin_define
define|#
directive|define
name|AL_SERDES_RX_EYE_CAL_MDELAY
value|50
end_define

begin_define
define|#
directive|define
name|AL_SERDES_RX_EYE_CAL_TRIES
value|70
end_define

begin_if
if|#
directive|if
operator|(
operator|!
name|defined
argument_list|(
name|AL_SERDES_BASIC_SERVICES_ONLY
argument_list|)
operator|)
operator|||
operator|(
name|AL_SERDES_BASIC_SERVICES_ONLY
operator|==
literal|0
operator|)
end_if

begin_define
define|#
directive|define
name|AL_SRDS_ADV_SRVC
parameter_list|(
name|func
parameter_list|)
value|func
end_define

begin_else
else|#
directive|else
end_else

begin_function
specifier|static
name|void
name|al_serdes_hssp_stub_func
parameter_list|(
name|void
parameter_list|)
block|{
name|al_err
argument_list|(
literal|"%s: not implemented service called!\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|AL_SRDS_ADV_SRVC
parameter_list|(
name|func
parameter_list|)
value|((typeof(func) *)al_serdes_hssp_stub_func)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/**  * SERDES core reg read  */
end_comment

begin_function_decl
specifier|static
specifier|inline
name|uint8_t
name|al_serdes_grp_reg_read
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|enum
name|al_serdes_reg_type
name|type
parameter_list|,
name|uint16_t
name|offset
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**  * SERDES core reg write  */
end_comment

begin_function_decl
specifier|static
specifier|inline
name|void
name|al_serdes_grp_reg_write
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|enum
name|al_serdes_reg_type
name|type
parameter_list|,
name|uint16_t
name|offset
parameter_list|,
name|uint8_t
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**  * SERDES core masked reg write  */
end_comment

begin_function_decl
specifier|static
specifier|inline
name|void
name|al_serdes_grp_reg_masked_write
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|enum
name|al_serdes_reg_type
name|type
parameter_list|,
name|uint16_t
name|offset
parameter_list|,
name|uint8_t
name|mask
parameter_list|,
name|uint8_t
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**  * Lane Rx rate change software flow disable  */
end_comment

begin_function_decl
specifier|static
name|void
name|_al_serdes_lane_rx_rate_change_sw_flow_dis
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**  * Group Rx rate change software flow enable if all conditions met  */
end_comment

begin_function_decl
specifier|static
name|void
name|al_serdes_group_rx_rate_change_sw_flow_dis
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**  * Lane Rx rate change software flow enable if all conditions met  */
end_comment

begin_function_decl
specifier|static
name|void
name|_al_serdes_lane_rx_rate_change_sw_flow_en_cond
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**  * Group Rx rate change software flow enable if all conditions met  */
end_comment

begin_function_decl
specifier|static
name|void
name|al_serdes_group_rx_rate_change_sw_flow_en_cond
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|enum
name|al_serdes_type
name|al_serdes_hssp_type_get
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|AL_SRDS_TYPE_HSSP
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|al_serdes_reg_read
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|enum
name|al_serdes_reg_type
name|type
parameter_list|,
name|uint16_t
name|offset
parameter_list|,
name|uint8_t
modifier|*
name|data
parameter_list|)
block|{
name|int
name|status
init|=
literal|0
decl_stmt|;
name|al_dbg
argument_list|(
literal|"%s(%p, %d, %d, %u)\n"
argument_list|,
name|__func__
argument_list|,
name|obj
argument_list|,
name|page
argument_list|,
name|type
argument_list|,
name|offset
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
operator|(
operator|(
name|int
operator|)
name|page
operator|)
operator|>=
name|AL_SRDS_REG_PAGE_0_LANE_0
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
operator|(
operator|(
name|int
operator|)
name|page
operator|)
operator|<=
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
operator|(
operator|(
name|int
operator|)
name|type
operator|)
operator|>=
name|AL_SRDS_REG_TYPE_PMA
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
operator|(
operator|(
name|int
operator|)
name|type
operator|)
operator|<=
name|AL_SRDS_REG_TYPE_PCS
argument_list|)
expr_stmt|;
operator|*
name|data
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|type
argument_list|,
name|offset
argument_list|)
expr_stmt|;
name|al_dbg
argument_list|(
literal|"%s: return(%u)\n"
argument_list|,
name|__func__
argument_list|,
operator|*
name|data
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|al_serdes_reg_write
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|enum
name|al_serdes_reg_type
name|type
parameter_list|,
name|uint16_t
name|offset
parameter_list|,
name|uint8_t
name|data
parameter_list|)
block|{
name|int
name|status
init|=
literal|0
decl_stmt|;
name|al_dbg
argument_list|(
literal|"%s(%p, %d, %d, %u, %u)\n"
argument_list|,
name|__func__
argument_list|,
name|obj
argument_list|,
name|page
argument_list|,
name|type
argument_list|,
name|offset
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
operator|(
operator|(
name|int
operator|)
name|page
operator|)
operator|>=
name|AL_SRDS_REG_PAGE_0_LANE_0
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
operator|(
operator|(
name|int
operator|)
name|page
operator|)
operator|<=
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
operator|(
operator|(
name|int
operator|)
name|type
operator|)
operator|>=
name|AL_SRDS_REG_TYPE_PMA
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
operator|(
operator|(
name|int
operator|)
name|type
operator|)
operator|<=
name|AL_SRDS_REG_TYPE_PCS
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|type
argument_list|,
name|offset
argument_list|,
name|data
argument_list|)
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_PCSRX_DATAWIDTH_REG_NUM
operator|!=
name|SERDES_IREG_FLD_PCSTX_DATAWIDTH_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
literal|"Wrong assumption!"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_PCSRX_DIVRATE_REG_NUM
operator|!=
name|SERDES_IREG_FLD_PCSTX_DIVRATE_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
literal|"Wrong assumption!"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_CMNPCIEGEN3_LOCWREN_REG_NUM
operator|!=
name|SERDES_IREG_FLD_CMNPCS_LOCWREN_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
literal|"Wrong assumption!"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_CMNPCIEGEN3_LOCWREN_REG_NUM
operator|!=
name|SERDES_IREG_FLD_CMNPCSBIST_LOCWREN_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
literal|"Wrong assumption!"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_CMNPCIEGEN3_LOCWREN_REG_NUM
operator|!=
name|SERDES_IREG_FLD_CMNPCSPSTATE_LOCWREN_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
literal|"Wrong assumption!"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_LANEPCSPSTATE_LOCWREN_REG_NUM
operator|!=
name|SERDES_IREG_FLD_LB_LOCWREN_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
literal|"Wrong assumption!"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_LANEPCSPSTATE_LOCWREN_REG_NUM
operator|!=
name|SERDES_IREG_FLD_PCSRX_LOCWREN_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
literal|"Wrong assumption!"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_LANEPCSPSTATE_LOCWREN_REG_NUM
operator|!=
name|SERDES_IREG_FLD_PCSRXBIST_LOCWREN_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
literal|"Wrong assumption!"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_LANEPCSPSTATE_LOCWREN_REG_NUM
operator|!=
name|SERDES_IREG_FLD_PCSRXEQ_LOCWREN_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
literal|"Wrong assumption!"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_LANEPCSPSTATE_LOCWREN_REG_NUM
operator|!=
name|SERDES_IREG_FLD_PCSTX_LOCWREN_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
literal|"Wrong assumption!"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|al_serdes_bist_overrides_enable
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_rate
name|rate
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|uint8_t
name|rx_rate_val
decl_stmt|;
name|uint8_t
name|tx_rate_val
decl_stmt|;
switch|switch
condition|(
name|rate
condition|)
block|{
case|case
name|AL_SRDS_RATE_1_8
case|:
name|rx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSRX_DIVRATE_VAL_1_8
expr_stmt|;
name|tx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSTX_DIVRATE_VAL_1_8
expr_stmt|;
break|break;
case|case
name|AL_SRDS_RATE_1_4
case|:
name|rx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSRX_DIVRATE_VAL_1_4
expr_stmt|;
name|tx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSTX_DIVRATE_VAL_1_4
expr_stmt|;
break|break;
case|case
name|AL_SRDS_RATE_1_2
case|:
name|rx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSRX_DIVRATE_VAL_1_2
expr_stmt|;
name|tx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSTX_DIVRATE_VAL_1_2
expr_stmt|;
break|break;
case|case
name|AL_SRDS_RATE_FULL
case|:
name|rx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSRX_DIVRATE_VAL_1_1
expr_stmt|;
name|tx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSTX_DIVRATE_VAL_1_1
expr_stmt|;
break|break;
default|default:
name|al_err
argument_list|(
literal|"%s: invalid rate (%d)\n"
argument_list|,
name|__func__
argument_list|,
name|rate
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|rx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSRX_DIVRATE_VAL_1_1
expr_stmt|;
name|tx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSTX_DIVRATE_VAL_1_1
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AL_SRDS_NUM_LANES
condition|;
name|i
operator|++
control|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|i
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSRX_DATAWIDTH_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCSRX_DATAWIDTH_MASK
operator||
name|SERDES_IREG_FLD_PCSTX_DATAWIDTH_MASK
argument_list|,
name|SERDES_IREG_FLD_PCSRX_DATAWIDTH_VAL_20
operator||
name|SERDES_IREG_FLD_PCSTX_DATAWIDTH_VAL_20
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|i
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSRX_DIVRATE_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCSRX_DIVRATE_MASK
operator||
name|SERDES_IREG_FLD_PCSTX_DIVRATE_MASK
argument_list|,
name|rx_rate_val
operator||
name|tx_rate_val
argument_list|)
expr_stmt|;
block|}
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNPCIEGEN3_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_CMNPCIEGEN3_LOCWREN
operator||
name|SERDES_IREG_FLD_CMNPCS_LOCWREN
operator||
name|SERDES_IREG_FLD_CMNPCSBIST_LOCWREN
operator||
name|SERDES_IREG_FLD_CMNPCSPSTATE_LOCWREN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNPCIEGEN3_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_CMNPCIEGEN3_LOCWREN
operator||
name|SERDES_IREG_FLD_CMNPCS_LOCWREN
operator||
name|SERDES_IREG_FLD_CMNPCSBIST_LOCWREN
operator||
name|SERDES_IREG_FLD_CMNPCSPSTATE_LOCWREN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCS_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCS_LOCWREN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNPCS_TXENABLE_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_CMNPCS_TXENABLE
argument_list|,
name|SERDES_IREG_FLD_CMNPCS_TXENABLE
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AL_SRDS_NUM_LANES
condition|;
name|i
operator|++
control|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|i
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_LANEPCSPSTATE_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_LANEPCSPSTATE_LOCWREN
operator||
name|SERDES_IREG_FLD_LB_LOCWREN
operator||
name|SERDES_IREG_FLD_PCSRX_LOCWREN
operator||
name|SERDES_IREG_FLD_PCSRXBIST_LOCWREN
operator||
name|SERDES_IREG_FLD_PCSRXEQ_LOCWREN
operator||
name|SERDES_IREG_FLD_PCSTX_LOCWREN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|i
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSTXBIST_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCSTXBIST_LOCWREN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|i
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_TX_DRV_OVERRIDE_EN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_TX_DRV_OVERRIDE_EN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|i
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXLOCK2REF_OVREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXLOCK2REF_OVREN
argument_list|,
name|SERDES_IREG_FLD_RXLOCK2REF_OVREN
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_bist_overrides_disable
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNPCIEGEN3_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_CMNPCSBIST_LOCWREN
argument_list|,
name|SERDES_IREG_FLD_CMNPCSBIST_LOCWREN
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AL_SRDS_NUM_LANES
condition|;
name|i
operator|++
control|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|i
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_LANEPCSPSTATE_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_LB_LOCWREN
operator||
name|SERDES_IREG_FLD_PCSRXBIST_LOCWREN
argument_list|,
name|SERDES_IREG_FLD_LB_LOCWREN
operator||
name|SERDES_IREG_FLD_PCSRXBIST_LOCWREN
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|i
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSTXBIST_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCSTXBIST_LOCWREN
argument_list|,
name|SERDES_IREG_FLD_PCSTXBIST_LOCWREN
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_rx_rate_change
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_rate
name|rate
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|uint8_t
name|rx_rate_val
decl_stmt|;
switch|switch
condition|(
name|rate
condition|)
block|{
case|case
name|AL_SRDS_RATE_1_8
case|:
name|rx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSRX_DIVRATE_VAL_1_8
expr_stmt|;
break|break;
case|case
name|AL_SRDS_RATE_1_4
case|:
name|rx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSRX_DIVRATE_VAL_1_4
expr_stmt|;
break|break;
case|case
name|AL_SRDS_RATE_1_2
case|:
name|rx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSRX_DIVRATE_VAL_1_2
expr_stmt|;
break|break;
case|case
name|AL_SRDS_RATE_FULL
case|:
name|rx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSRX_DIVRATE_VAL_1_1
expr_stmt|;
break|break;
default|default:
name|al_err
argument_list|(
literal|"%s: invalid rate (%d)\n"
argument_list|,
name|__func__
argument_list|,
name|rate
argument_list|)
expr_stmt|;
name|rx_rate_val
operator|=
name|SERDES_IREG_FLD_PCSRX_DIVRATE_VAL_1_1
expr_stmt|;
break|break;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AL_SRDS_NUM_LANES
condition|;
name|i
operator|++
control|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|i
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSRX_DIVRATE_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCSRX_DIVRATE_MASK
argument_list|,
name|rx_rate_val
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_group_pm_set
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_pm
name|pm
parameter_list|)
block|{
name|uint8_t
name|pm_val
decl_stmt|;
switch|switch
condition|(
name|pm
condition|)
block|{
case|case
name|AL_SRDS_PM_PD
case|:
name|pm_val
operator|=
name|SERDES_IREG_FLD_CMNPCSPSTATE_SYNTH_VAL_PD
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P2
case|:
name|pm_val
operator|=
name|SERDES_IREG_FLD_CMNPCSPSTATE_SYNTH_VAL_P2
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P1
case|:
name|pm_val
operator|=
name|SERDES_IREG_FLD_CMNPCSPSTATE_SYNTH_VAL_P1
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P0S
case|:
name|pm_val
operator|=
name|SERDES_IREG_FLD_CMNPCSPSTATE_SYNTH_VAL_P0S
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P0
case|:
name|pm_val
operator|=
name|SERDES_IREG_FLD_CMNPCSPSTATE_SYNTH_VAL_P0
expr_stmt|;
break|break;
default|default:
name|al_err
argument_list|(
literal|"%s: invalid power mode (%d)\n"
argument_list|,
name|__func__
argument_list|,
name|pm
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|pm_val
operator|=
name|SERDES_IREG_FLD_CMNPCSPSTATE_SYNTH_VAL_P0
expr_stmt|;
block|}
if|if
condition|(
name|pm
operator|==
name|AL_SRDS_PM_PD
condition|)
name|al_serdes_group_rx_rate_change_sw_flow_dis
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNPCSPSTATE_SYNTH_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_CMNPCSPSTATE_SYNTH_MASK
argument_list|,
name|pm_val
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|!=
name|AL_SRDS_PM_PD
condition|)
name|al_serdes_group_rx_rate_change_sw_flow_en_cond
argument_list|(
name|obj
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_lane_rx_rate_change_sw_flow_en
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|201
argument_list|,
literal|0xfc
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|202
argument_list|,
literal|0xff
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|203
argument_list|,
literal|0xff
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|204
argument_list|,
literal|0xff
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|205
argument_list|,
literal|0x7f
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|205
argument_list|,
literal|0xff
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_lane_rx_rate_change_sw_flow_dis
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|205
argument_list|,
literal|0x7f
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_lane_pcie_rate_override_enable_set
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|al_bool
name|en
parameter_list|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PCS
argument_list|,
name|SERDES_IREG_FLD_PCS_VPCSIF_OVR_RATE_ENA_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCS_VPCSIF_OVR_RATE_ENA
argument_list|,
name|en
condition|?
name|SERDES_IREG_FLD_PCS_VPCSIF_OVR_RATE_ENA
else|:
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|al_bool
name|al_serdes_lane_pcie_rate_override_is_enabled
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
return|return
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PCS
argument_list|,
name|SERDES_IREG_FLD_PCS_VPCSIF_OVR_RATE_ENA_REG_NUM
argument_list|)
operator|&
name|SERDES_IREG_FLD_PCS_VPCSIF_OVR_RATE_ENA
operator|)
condition|?
name|AL_TRUE
else|:
name|AL_FALSE
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|enum
name|al_serdes_pcie_rate
name|al_serdes_lane_pcie_rate_get
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
return|return
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PCS
argument_list|,
name|SERDES_IREG_FLD_PCS_VPCSIF_OVR_RATE_REG_NUM
argument_list|)
operator|&
name|SERDES_IREG_FLD_PCS_VPCSIF_OVR_RATE_MASK
operator|)
operator|>>
name|SERDES_IREG_FLD_PCS_VPCSIF_OVR_RATE_SHIFT
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_lane_pcie_rate_set
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|enum
name|al_serdes_pcie_rate
name|rate
parameter_list|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PCS
argument_list|,
name|SERDES_IREG_FLD_PCS_VPCSIF_OVR_RATE_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCS_VPCSIF_OVR_RATE_MASK
argument_list|,
name|rate
operator|<<
name|SERDES_IREG_FLD_PCS_VPCSIF_OVR_RATE_SHIFT
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_lane_pm_set
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|enum
name|al_serdes_pm
name|rx_pm
parameter_list|,
name|enum
name|al_serdes_pm
name|tx_pm
parameter_list|)
block|{
name|uint8_t
name|rx_pm_val
decl_stmt|;
name|uint8_t
name|tx_pm_val
decl_stmt|;
switch|switch
condition|(
name|rx_pm
condition|)
block|{
case|case
name|AL_SRDS_PM_PD
case|:
name|rx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_RX_VAL_PD
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P2
case|:
name|rx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_RX_VAL_P2
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P1
case|:
name|rx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_RX_VAL_P1
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P0S
case|:
name|rx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_RX_VAL_P0S
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P0
case|:
name|rx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_RX_VAL_P0
expr_stmt|;
break|break;
default|default:
name|al_err
argument_list|(
literal|"%s: invalid rx power mode (%d)\n"
argument_list|,
name|__func__
argument_list|,
name|rx_pm
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|rx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_RX_VAL_P0
expr_stmt|;
block|}
switch|switch
condition|(
name|tx_pm
condition|)
block|{
case|case
name|AL_SRDS_PM_PD
case|:
name|tx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_TX_VAL_PD
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P2
case|:
name|tx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_TX_VAL_P2
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P1
case|:
name|tx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_TX_VAL_P1
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P0S
case|:
name|tx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_TX_VAL_P0S
expr_stmt|;
break|break;
case|case
name|AL_SRDS_PM_P0
case|:
name|tx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_TX_VAL_P0
expr_stmt|;
break|break;
default|default:
name|al_err
argument_list|(
literal|"%s: invalid tx power mode (%d)\n"
argument_list|,
name|__func__
argument_list|,
name|tx_pm
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|tx_pm_val
operator|=
name|SERDES_IREG_FLD_LANEPCSPSTATE_TX_VAL_P0
expr_stmt|;
block|}
if|if
condition|(
name|rx_pm
operator|==
name|AL_SRDS_PM_PD
condition|)
name|_al_serdes_lane_rx_rate_change_sw_flow_dis
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_LANEPCSPSTATE_RX_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_LANEPCSPSTATE_RX_MASK
argument_list|,
name|rx_pm_val
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_LANEPCSPSTATE_TX_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_LANEPCSPSTATE_TX_MASK
argument_list|,
name|tx_pm_val
argument_list|)
expr_stmt|;
if|if
condition|(
name|rx_pm
operator|!=
name|AL_SRDS_PM_PD
condition|)
name|_al_serdes_lane_rx_rate_change_sw_flow_en_cond
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_pma_hard_reset_group
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|al_bool
name|enable
parameter_list|)
block|{
if|if
condition|(
name|enable
condition|)
name|al_serdes_group_rx_rate_change_sw_flow_dis
argument_list|(
name|obj
argument_list|)
expr_stmt|;
comment|/* Enable Hard Reset Override */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_SYNTH_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_SYNTH_MASK
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_SYNTH_VAL_REGS
argument_list|)
expr_stmt|;
comment|/* Assert/Deassert Hard Reset Override */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_SYNTH_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_SYNTH_MASK
argument_list|,
name|enable
condition|?
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_SYNTH_VAL_ASSERT
else|:
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_SYNTH_VAL_DEASSERT
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|enable
condition|)
name|al_serdes_group_rx_rate_change_sw_flow_en_cond
argument_list|(
name|obj
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_pma_hard_reset_lane
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|al_bool
name|enable
parameter_list|)
block|{
if|if
condition|(
name|enable
condition|)
name|_al_serdes_lane_rx_rate_change_sw_flow_dis
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|)
expr_stmt|;
comment|/* Enable Hard Reset Override */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_MASK
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_VAL_REGS
argument_list|)
expr_stmt|;
comment|/* Assert/Deassert Hard Reset Override */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_MASK
argument_list|,
name|enable
condition|?
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_VAL_ASSERT
else|:
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_VAL_DEASSERT
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|enable
condition|)
name|_al_serdes_lane_rx_rate_change_sw_flow_en_cond
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_LB_RX2TXUNTIMEDEN_REG_NUM
operator|!=
expr|\
name|SERDES_IREG_FLD_LB_TX2RXBUFTIMEDEN_REG_NUM
operator|)
operator|||
expr|\
operator|(
name|SERDES_IREG_FLD_LB_TX2RXBUFTIMEDEN_REG_NUM
operator|!=
expr|\
name|SERDES_IREG_FLD_LB_TX2RXIOTIMEDEN_REG_NUM
operator|)
operator|||
expr|\
operator|(
name|SERDES_IREG_FLD_LB_TX2RXIOTIMEDEN_REG_NUM
operator|!=
expr|\
name|SERDES_IREG_FLD_LB_PARRX2TXTIMEDEN_REG_NUM
operator|)
operator|||
expr|\
operator|(
name|SERDES_IREG_FLD_LB_PARRX2TXTIMEDEN_REG_NUM
operator|!=
expr|\
name|SERDES_IREG_FLD_LB_CDRCLK2TXEN_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
error|Wrong assumption
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|al_serdes_loopback_control
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|enum
name|al_serdes_lb_mode
name|mode
parameter_list|)
block|{
name|uint8_t
name|val
init|=
literal|0
decl_stmt|;
switch|switch
condition|(
name|mode
condition|)
block|{
case|case
name|AL_SRDS_LB_MODE_OFF
case|:
break|break;
case|case
name|AL_SRDS_LB_MODE_PMA_IO_UN_TIMED_RX_TO_TX
case|:
name|val
operator|=
name|SERDES_IREG_FLD_LB_RX2TXUNTIMEDEN
expr_stmt|;
break|break;
case|case
name|AL_SRDS_LB_MODE_PMA_INTERNALLY_BUFFERED_SERIAL_TX_TO_RX
case|:
name|val
operator|=
name|SERDES_IREG_FLD_LB_TX2RXBUFTIMEDEN
expr_stmt|;
break|break;
case|case
name|AL_SRDS_LB_MODE_PMA_SERIAL_TX_IO_TO_RX_IO
case|:
name|val
operator|=
name|SERDES_IREG_FLD_LB_TX2RXIOTIMEDEN
expr_stmt|;
break|break;
case|case
name|AL_SRDS_LB_MODE_PMA_PARALLEL_RX_TO_TX
case|:
name|val
operator|=
name|SERDES_IREG_FLD_LB_PARRX2TXTIMEDEN
operator||
name|SERDES_IREG_FLD_LB_CDRCLK2TXEN
expr_stmt|;
break|break;
default|default:
name|al_err
argument_list|(
literal|"%s: invalid mode (%d)\n"
argument_list|,
name|__func__
argument_list|,
name|mode
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_LB_RX2TXUNTIMEDEN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_LB_RX2TXUNTIMEDEN
operator||
name|SERDES_IREG_FLD_LB_TX2RXBUFTIMEDEN
operator||
name|SERDES_IREG_FLD_LB_TX2RXIOTIMEDEN
operator||
name|SERDES_IREG_FLD_LB_PARRX2TXTIMEDEN
operator||
name|SERDES_IREG_FLD_LB_CDRCLK2TXEN
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_bist_pattern_select
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_bist_pattern
name|pattern
parameter_list|,
name|uint8_t
modifier|*
name|user_data
parameter_list|)
block|{
name|uint8_t
name|val
init|=
literal|0
decl_stmt|;
switch|switch
condition|(
name|pattern
condition|)
block|{
case|case
name|AL_SRDS_BIST_PATTERN_USER
case|:
name|al_assert
argument_list|(
name|user_data
argument_list|)
expr_stmt|;
name|val
operator|=
name|SERDES_IREG_FLD_CMNPCSBIST_MODESEL_VAL_USER
expr_stmt|;
break|break;
case|case
name|AL_SRDS_BIST_PATTERN_PRBS7
case|:
name|val
operator|=
name|SERDES_IREG_FLD_CMNPCSBIST_MODESEL_VAL_PRBS7
expr_stmt|;
break|break;
case|case
name|AL_SRDS_BIST_PATTERN_PRBS23
case|:
name|val
operator|=
name|SERDES_IREG_FLD_CMNPCSBIST_MODESEL_VAL_PRBS23
expr_stmt|;
break|break;
case|case
name|AL_SRDS_BIST_PATTERN_PRBS31
case|:
name|val
operator|=
name|SERDES_IREG_FLD_CMNPCSBIST_MODESEL_VAL_PRBS31
expr_stmt|;
break|break;
case|case
name|AL_SRDS_BIST_PATTERN_CLK1010
case|:
name|val
operator|=
name|SERDES_IREG_FLD_CMNPCSBIST_MODESEL_VAL_CLK1010
expr_stmt|;
break|break;
default|default:
name|al_err
argument_list|(
literal|"%s: invalid pattern (%d)\n"
argument_list|,
name|__func__
argument_list|,
name|pattern
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pattern
operator|==
name|AL_SRDS_BIST_PATTERN_USER
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SERDES_IREG_FLD_TX_BIST_PAT_NUM_BYTES
condition|;
name|i
operator|++
control|)
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_TX_BIST_PAT_REG_NUM
argument_list|(
name|i
argument_list|)
argument_list|,
name|user_data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNPCSBIST_MODESEL_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_CMNPCSBIST_MODESEL_MASK
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_bist_tx_enable
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|al_bool
name|enable
parameter_list|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSTXBIST_EN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCSTXBIST_EN
argument_list|,
name|enable
condition|?
name|SERDES_IREG_FLD_PCSTXBIST_EN
else|:
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_bist_tx_err_inject
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_TXBIST_BITERROR_EN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_TXBIST_BITERROR_EN
argument_list|,
name|SERDES_IREG_FLD_TXBIST_BITERROR_EN
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_TXBIST_BITERROR_EN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_TXBIST_BITERROR_EN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_bist_rx_enable
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|al_bool
name|enable
parameter_list|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSRXBIST_EN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCSRXBIST_EN
argument_list|,
name|enable
condition|?
name|SERDES_IREG_FLD_PCSRXBIST_EN
else|:
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_RXBIST_ERRCOUNT_OVERFLOW_REG_NUM
operator|!=
expr|\
name|SERDES_IREG_FLD_RXBIST_RXLOCKED_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
error|Wrong assumption
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|al_serdes_bist_rx_status
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|al_bool
modifier|*
name|is_locked
parameter_list|,
name|al_bool
modifier|*
name|err_cnt_overflow
parameter_list|,
name|uint32_t
modifier|*
name|err_cnt
parameter_list|)
block|{
name|uint8_t
name|status_reg_val
decl_stmt|;
name|uint16_t
name|err_cnt_msb_reg_val
decl_stmt|;
name|uint16_t
name|err_cnt_lsb_reg_val
decl_stmt|;
name|status_reg_val
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXBIST_RXLOCKED_REG_NUM
argument_list|)
expr_stmt|;
name|err_cnt_msb_reg_val
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXBIST_ERRCOUNT_MSB_REG_NUM
argument_list|)
expr_stmt|;
name|err_cnt_lsb_reg_val
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXBIST_ERRCOUNT_LSB_REG_NUM
argument_list|)
expr_stmt|;
operator|*
name|is_locked
operator|=
operator|(
name|status_reg_val
operator|&
name|SERDES_IREG_FLD_RXBIST_RXLOCKED
operator|)
condition|?
name|AL_TRUE
else|:
name|AL_FALSE
expr_stmt|;
operator|*
name|err_cnt_overflow
operator|=
operator|(
name|status_reg_val
operator|&
name|SERDES_IREG_FLD_RXBIST_ERRCOUNT_OVERFLOW
operator|)
condition|?
name|AL_TRUE
else|:
name|AL_FALSE
expr_stmt|;
operator|*
name|err_cnt
operator|=
operator|(
name|err_cnt_msb_reg_val
operator|<<
literal|8
operator|)
operator|+
name|err_cnt_lsb_reg_val
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
specifier|inline
name|uint8_t
name|al_serdes_grp_reg_read
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|enum
name|al_serdes_reg_type
name|type
parameter_list|,
name|uint16_t
name|offset
parameter_list|)
block|{
name|struct
name|al_serdes_regs
name|__iomem
modifier|*
name|regs_base
init|=
name|obj
operator|->
name|regs_base
decl_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|reg_addr
argument_list|,
name|SRDS_CORE_REG_ADDR
argument_list|(
name|page
argument_list|,
name|type
argument_list|,
name|offset
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|al_reg_read32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|reg_data
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
specifier|inline
name|void
name|al_serdes_grp_reg_write
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|enum
name|al_serdes_reg_type
name|type
parameter_list|,
name|uint16_t
name|offset
parameter_list|,
name|uint8_t
name|data
parameter_list|)
block|{
name|struct
name|al_serdes_regs
name|__iomem
modifier|*
name|regs_base
init|=
name|obj
operator|->
name|regs_base
decl_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|reg_addr
argument_list|,
name|SRDS_CORE_REG_ADDR
argument_list|(
name|page
argument_list|,
name|type
argument_list|,
name|offset
argument_list|)
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|reg_data
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
specifier|inline
name|void
name|al_serdes_ns_delay
parameter_list|(
name|int
name|cnt
parameter_list|)
block|{
name|al_udelay
argument_list|(
operator|(
name|cnt
operator|+
literal|999
operator|)
operator|/
literal|1000
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
specifier|inline
name|void
name|al_serdes_grp_reg_masked_write
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_reg_page
name|page
parameter_list|,
name|enum
name|al_serdes_reg_type
name|type
parameter_list|,
name|uint16_t
name|offset
parameter_list|,
name|uint8_t
name|mask
parameter_list|,
name|uint8_t
name|data
parameter_list|)
block|{
name|uint8_t
name|val
decl_stmt|;
name|enum
name|al_serdes_reg_page
name|start_page
init|=
name|page
decl_stmt|;
name|enum
name|al_serdes_reg_page
name|end_page
init|=
name|page
decl_stmt|;
name|enum
name|al_serdes_reg_page
name|iter_page
decl_stmt|;
if|if
condition|(
name|page
operator|==
name|AL_SRDS_REG_PAGE_0123_LANES_0123
condition|)
block|{
name|start_page
operator|=
name|AL_SRDS_REG_PAGE_0_LANE_0
expr_stmt|;
name|end_page
operator|=
name|AL_SRDS_REG_PAGE_3_LANE_3
expr_stmt|;
block|}
for|for
control|(
name|iter_page
operator|=
name|start_page
init|;
name|iter_page
operator|<=
name|end_page
condition|;
operator|++
name|iter_page
control|)
block|{
name|val
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
name|iter_page
argument_list|,
name|type
argument_list|,
name|offset
argument_list|)
expr_stmt|;
name|val
operator|&=
operator|~
name|mask
expr_stmt|;
name|val
operator||=
name|data
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|iter_page
argument_list|,
name|type
argument_list|,
name|offset
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|_al_serdes_lane_rx_rate_change_sw_flow_dis
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
name|al_bool
name|lane_sw_flow_enabled
decl_stmt|;
name|al_assert
argument_list|(
name|lane
operator|!=
name|AL_SRDS_LANES_0123
argument_list|)
expr_stmt|;
name|lane_sw_flow_enabled
operator|=
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|201
argument_list|)
operator|==
literal|0xfc
operator|)
operator|&&
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|202
argument_list|)
operator|==
literal|0xff
operator|)
operator|&&
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|203
argument_list|)
operator|==
literal|0xff
operator|)
operator|&&
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|204
argument_list|)
operator|==
literal|0xff
operator|)
operator|&&
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|205
argument_list|)
operator|==
literal|0xff
operator|)
expr_stmt|;
comment|/** 	 * Disable the Rx rate change software flow by clearing bit 7 of lane PMA register 205 	 * (RSTPDOVR_RX_OVREN) 	 */
if|if
condition|(
name|lane_sw_flow_enabled
condition|)
block|{
name|al_dbg
argument_list|(
literal|"%s(%d): actually disabling\n"
argument_list|,
name|__func__
argument_list|,
name|lane
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|205
argument_list|,
literal|0x80
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_group_rx_rate_change_sw_flow_dis
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|)
block|{
name|int
name|lane
decl_stmt|;
for|for
control|(
name|lane
operator|=
name|AL_SRDS_LANE_0
init|;
name|lane
operator|<
name|AL_SRDS_NUM_LANES
condition|;
name|lane
operator|++
control|)
name|_al_serdes_lane_rx_rate_change_sw_flow_dis
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|_al_serdes_lane_rx_rate_change_sw_flow_en_cond
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
name|al_bool
name|lane_sw_flow_almost_enabled
decl_stmt|;
name|al_bool
name|group_reset_enabled
decl_stmt|;
name|al_bool
name|lane_reset_enabled
decl_stmt|;
name|al_bool
name|group_pd_enabled
decl_stmt|;
name|al_bool
name|lane_pd_enabled
decl_stmt|;
name|al_assert
argument_list|(
name|lane
operator|!=
name|AL_SRDS_LANES_0123
argument_list|)
expr_stmt|;
name|lane_sw_flow_almost_enabled
operator|=
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|201
argument_list|)
operator|==
literal|0xfc
operator|)
operator|&&
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|202
argument_list|)
operator|==
literal|0xff
operator|)
operator|&&
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|203
argument_list|)
operator|==
literal|0xff
operator|)
operator|&&
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|204
argument_list|)
operator|==
literal|0xff
operator|)
operator|&&
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|205
argument_list|)
operator|==
literal|0x7f
operator|)
expr_stmt|;
name|group_reset_enabled
operator|=
operator|(
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_SYNTH_REG_NUM
argument_list|)
operator|&
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_SYNTH_MASK
operator|)
operator|==
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_SYNTH_VAL_REGS
operator|)
operator|&&
operator|(
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_SYNTH_REG_NUM
argument_list|)
operator|&
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_SYNTH_MASK
operator|)
operator|==
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_SYNTH_VAL_ASSERT
operator|)
expr_stmt|;
name|lane_reset_enabled
operator|=
operator|(
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_REG_NUM
argument_list|)
operator|&
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_MASK
operator|)
operator|==
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASSEN_VAL_REGS
operator|)
operator|&&
operator|(
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_REG_NUM
argument_list|)
operator|&
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_MASK
operator|)
operator|==
name|SERDES_IREG_FLD_CMNCTLPOR_HARDRSTBYPASS_VAL_ASSERT
operator|)
expr_stmt|;
name|group_pd_enabled
operator|=
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_CMNPCSPSTATE_SYNTH_REG_NUM
argument_list|)
operator|&
name|SERDES_IREG_FLD_CMNPCSPSTATE_SYNTH_MASK
operator|)
operator|==
name|SERDES_IREG_FLD_CMNPCSPSTATE_SYNTH_VAL_PD
expr_stmt|;
name|lane_pd_enabled
operator|=
operator|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_LANEPCSPSTATE_RX_REG_NUM
argument_list|)
operator|&
name|SERDES_IREG_FLD_LANEPCSPSTATE_RX_MASK
operator|)
operator|==
name|SERDES_IREG_FLD_LANEPCSPSTATE_RX_VAL_PD
expr_stmt|;
comment|/** 	 * Enable the Rx rate change software flow by setting bit 7 of lane PMA register 205 	 * (RSTPDOVR_RX_OVREN) 	 */
if|if
condition|(
name|lane_sw_flow_almost_enabled
operator|&&
operator|!
name|group_reset_enabled
operator|&&
operator|!
name|lane_reset_enabled
operator|&&
operator|!
name|group_pd_enabled
operator|&&
operator|!
name|lane_pd_enabled
condition|)
block|{
name|al_dbg
argument_list|(
literal|"%s(%d): actually enabling\n"
argument_list|,
name|__func__
argument_list|,
name|lane
argument_list|)
expr_stmt|;
name|al_serdes_ns_delay
argument_list|(
literal|500
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|205
argument_list|,
literal|0x80
argument_list|,
literal|0x80
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_group_rx_rate_change_sw_flow_en_cond
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|)
block|{
name|int
name|lane
decl_stmt|;
for|for
control|(
name|lane
operator|=
name|AL_SRDS_LANE_0
init|;
name|lane
operator|<
name|AL_SRDS_NUM_LANES
condition|;
name|lane
operator|++
control|)
name|_al_serdes_lane_rx_rate_change_sw_flow_en_cond
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|al_serdes_eye_measure_run
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|uint32_t
name|timeout
parameter_list|,
name|unsigned
name|int
modifier|*
name|value
parameter_list|)
block|{
name|struct
name|al_serdes_grp_obj
modifier|*
name|grp_obj
init|=
name|obj
decl_stmt|;
name|struct
name|al_serdes_regs
name|__iomem
modifier|*
name|regs_base
init|=
name|grp_obj
operator|->
name|regs_base
decl_stmt|;
name|uint32_t
name|reg
init|=
literal|0
decl_stmt|;
name|uint32_t
name|i
decl_stmt|;
name|struct
name|serdes_lane
modifier|*
name|lane_regs
decl_stmt|;
name|lane_regs
operator|=
operator|&
name|regs_base
operator|->
name|lane
index|[
name|lane
index|]
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|lane_regs
operator|->
name|ictl_multi_rxeq
argument_list|,
name|SERDES_LANE_ICTL_MULTI_RXEQ_START_L_A
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|timeout
condition|;
name|i
operator|++
control|)
block|{
name|reg
operator|=
name|al_reg_read32
argument_list|(
operator|&
name|lane_regs
operator|->
name|octl_multi
argument_list|)
expr_stmt|;
if|if
condition|(
name|reg
operator|&
name|SERDES_LANE_OCTL_MULTI_RXEQ_DONE_L_A
condition|)
break|break;
name|al_msleep
argument_list|(
literal|10
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|==
name|timeout
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: measure eye failed on timeout\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
name|ETIMEDOUT
return|;
block|}
operator|*
name|value
operator|=
name|al_reg_read32
argument_list|(
operator|&
name|lane_regs
operator|->
name|odat_multi_rxeq
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|lane_regs
operator|->
name|ictl_multi_rxeq
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|int
name|al_serdes_eye_diag_sample
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|unsigned
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|unsigned
name|int
name|timeout
parameter_list|,
name|unsigned
name|int
modifier|*
name|value
parameter_list|)
block|{
name|enum
name|al_serdes_reg_page
name|page
init|=
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
decl_stmt|;
name|uint32_t
name|i
decl_stmt|;
name|uint8_t
name|sample_count_orig_msb
decl_stmt|;
name|uint8_t
name|sample_count_orig_lsb
decl_stmt|;
name|al_assert
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
operator|(
operator|(
name|int
operator|)
name|page
operator|)
operator|>=
name|AL_SRDS_REG_PAGE_0_LANE_0
argument_list|)
expr_stmt|;
name|al_assert
argument_list|(
operator|(
operator|(
name|int
operator|)
name|page
operator|)
operator|<=
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|)
expr_stmt|;
comment|/* Obtain sample count by reading RXCALROAMEYEMEAS_COUNT */
name|sample_count_orig_msb
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_MSB_REG_NUM
argument_list|)
expr_stmt|;
name|sample_count_orig_lsb
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_LSB_REG_NUM
argument_list|)
expr_stmt|;
comment|/* Set sample count to ~100000 samples */
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_MSB_REG_NUM
argument_list|,
literal|0x13
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_LSB_REG_NUM
argument_list|,
literal|0x88
argument_list|)
expr_stmt|;
comment|/* BER Contour Overwrite */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* RXROAM_XORBITSEL = 0x1 or 0x0 */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXROAM_XORBITSEL_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXROAM_XORBITSEL
argument_list|,
name|SERDES_IREG_FLD_RXROAM_XORBITSEL_2ND
argument_list|)
expr_stmt|;
comment|/* Set X */
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMXADJUST_REG_NUM
argument_list|,
name|x
argument_list|)
expr_stmt|;
comment|/* Set Y */
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_REG_NUM
argument_list|,
name|y
operator|<
literal|32
condition|?
literal|31
operator|-
name|y
else|:
name|y
operator|+
literal|1
argument_list|)
expr_stmt|;
comment|/* Start Measurement by setting RXCALROAMEYEMEASIN_CYCLEEN = 0x1 */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_CYCLEEN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_CYCLEEN_START
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_CYCLEEN_START
argument_list|)
expr_stmt|;
comment|/* Check RXCALROAMEYEMEASDONE Signal (Polling Until 0x1) */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|timeout
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASDONE_REG_NUM
argument_list|)
operator|&
name|SERDES_IREG_FLD_RXCALROAMEYEMEASDONE
condition|)
break|break;
name|al_udelay
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|==
name|timeout
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: eye diagram sampling timed out!\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
name|ETIMEDOUT
return|;
block|}
comment|/* Stop Measurement by setting RXCALROAMEYEMEASIN_CYCLEEN = 0x0 */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_CYCLEEN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_CYCLEEN_START
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Obtain Error Counts by reading RXCALROAMEYEMEAS_ACC */
operator|*
name|value
operator|=
operator|(
operator|(
name|unsigned
name|int
operator|)
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEAS_ACC_MSB_REG_NUM
argument_list|)
operator|)
operator|<<
literal|8
operator||
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEAS_ACC_LSB_REG_NUM
argument_list|)
expr_stmt|;
comment|/* BER Contour Overwrite */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|page
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN
argument_list|)
expr_stmt|;
comment|/* Restore sample count */
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_MSB_REG_NUM
argument_list|,
name|sample_count_orig_msb
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_LSB_REG_NUM
argument_list|,
name|sample_count_orig_lsb
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_tx_deemph_set
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|uint32_t
name|c_zero
parameter_list|,
name|uint32_t
name|c_plus_1
parameter_list|,
name|uint32_t
name|c_minus_1
parameter_list|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_1_REG_NUM
argument_list|,
name|SERDES_IREG_TX_DRV_1_LEVN_MASK
argument_list|,
operator|(
operator|(
name|c_zero
operator|+
name|c_plus_1
operator|+
name|c_minus_1
operator|)
operator|<<
name|SERDES_IREG_TX_DRV_1_LEVN_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_2_REG_NUM
argument_list|,
name|SERDES_IREG_TX_DRV_2_LEVNM1_MASK
argument_list|,
operator|(
name|c_plus_1
operator|<<
name|SERDES_IREG_TX_DRV_2_LEVNM1_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_3_REG_NUM
argument_list|,
name|SERDES_IREG_TX_DRV_3_LEVNP1_MASK
argument_list|,
operator|(
name|c_minus_1
operator|<<
name|SERDES_IREG_TX_DRV_3_LEVNP1_SHIFT
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_tx_deemph_get
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|uint32_t
modifier|*
name|c_zero
parameter_list|,
name|uint32_t
modifier|*
name|c_plus_1
parameter_list|,
name|uint32_t
modifier|*
name|c_minus_1
parameter_list|)
block|{
name|uint32_t
name|reg
init|=
literal|0
decl_stmt|;
name|reg
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_2_REG_NUM
argument_list|)
expr_stmt|;
operator|*
name|c_plus_1
operator|=
operator|(
operator|(
name|reg
operator|&
name|SERDES_IREG_TX_DRV_2_LEVNM1_MASK
operator|)
operator|>>
name|SERDES_IREG_TX_DRV_2_LEVNM1_SHIFT
operator|)
expr_stmt|;
name|reg
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_3_REG_NUM
argument_list|)
expr_stmt|;
operator|*
name|c_minus_1
operator|=
operator|(
operator|(
name|reg
operator|&
name|SERDES_IREG_TX_DRV_3_LEVNP1_MASK
operator|)
operator|>>
name|SERDES_IREG_TX_DRV_3_LEVNP1_SHIFT
operator|)
expr_stmt|;
name|reg
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_1_REG_NUM
argument_list|)
expr_stmt|;
operator|*
name|c_zero
operator|=
operator|(
operator|(
operator|(
name|reg
operator|&
name|SERDES_IREG_TX_DRV_1_LEVN_MASK
operator|)
operator|>>
name|SERDES_IREG_TX_DRV_1_LEVN_SHIFT
operator|)
operator|-
operator|*
name|c_plus_1
operator|-
operator|*
name|c_minus_1
operator|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|al_bool
name|al_serdes_tx_deemph_inc
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|enum
name|al_serdes_tx_deemph_param
name|param
parameter_list|)
block|{
name|al_bool
name|ret
init|=
name|AL_TRUE
decl_stmt|;
name|uint32_t
name|c0
decl_stmt|;
name|uint32_t
name|c1
decl_stmt|;
name|uint32_t
name|c_1
decl_stmt|;
name|al_serdes_tx_deemph_get
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
operator|&
name|c0
argument_list|,
operator|&
name|c1
argument_list|,
operator|&
name|c_1
argument_list|)
expr_stmt|;
name|al_dbg
argument_list|(
literal|"%s: current txdeemph: c0 = 0x%x c1 = 0x%x c-1 = 0x%x\n"
argument_list|,
name|__func__
argument_list|,
name|c0
argument_list|,
name|c1
argument_list|,
name|c_1
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|param
condition|)
block|{
case|case
name|AL_SERDES_TX_DEEMP_C_ZERO
case|:
if|if
condition|(
name|c0
operator|==
name|AL_SERDES_TX_DEEMPH_C_ZERO_MAX_VAL
condition|)
return|return
name|AL_FALSE
return|;
name|c0
operator|++
expr_stmt|;
break|break;
case|case
name|AL_SERDES_TX_DEEMP_C_PLUS
case|:
if|if
condition|(
name|c1
operator|==
name|AL_SERDES_TX_DEEMPH_C_PLUS_MAX_VAL
condition|)
return|return
name|AL_FALSE
return|;
name|c1
operator|++
expr_stmt|;
break|break;
case|case
name|AL_SERDES_TX_DEEMP_C_MINUS
case|:
if|if
condition|(
name|c_1
operator|==
name|AL_SERDES_TX_DEEMPH_C_MINUS_MAX_VAL
condition|)
return|return
name|AL_FALSE
return|;
name|c_1
operator|++
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|(
name|c0
operator|+
name|c1
operator|+
name|c_1
operator|)
operator|>
name|AL_SERDES_TX_DEEMPH_SUM_MAX
condition|)
block|{
name|al_dbg
argument_list|(
literal|"%s: sum of all tx de-emphasis over the max limit\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
name|AL_FALSE
return|;
block|}
name|al_dbg
argument_list|(
literal|"%s: new txdeemph: c0 = 0x%x c1 = 0x%x c-1 = 0x%x\n"
argument_list|,
name|__func__
argument_list|,
name|c0
argument_list|,
name|c1
argument_list|,
name|c_1
argument_list|)
expr_stmt|;
name|al_serdes_tx_deemph_set
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|c0
argument_list|,
name|c1
argument_list|,
name|c_1
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|al_bool
name|al_serdes_tx_deemph_dec
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|enum
name|al_serdes_tx_deemph_param
name|param
parameter_list|)
block|{
name|al_bool
name|ret
init|=
name|AL_TRUE
decl_stmt|;
name|uint32_t
name|c0
decl_stmt|;
name|uint32_t
name|c1
decl_stmt|;
name|uint32_t
name|c_1
decl_stmt|;
name|al_serdes_tx_deemph_get
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
operator|&
name|c0
argument_list|,
operator|&
name|c1
argument_list|,
operator|&
name|c_1
argument_list|)
expr_stmt|;
name|al_dbg
argument_list|(
literal|"%s: current txdeemph: c0 = 0x%x c1 = 0x%x c-1 = 0x%x\n"
argument_list|,
name|__func__
argument_list|,
name|c0
argument_list|,
name|c1
argument_list|,
name|c_1
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|param
condition|)
block|{
case|case
name|AL_SERDES_TX_DEEMP_C_ZERO
case|:
if|if
condition|(
name|c0
operator|==
name|AL_SERDES_TX_DEEMPH_C_ZERO_MIN_VAL
condition|)
return|return
name|AL_FALSE
return|;
name|c0
operator|--
expr_stmt|;
break|break;
case|case
name|AL_SERDES_TX_DEEMP_C_PLUS
case|:
if|if
condition|(
name|c1
operator|==
name|AL_SERDES_TX_DEEMPH_C_PLUS_MIN_VAL
condition|)
return|return
name|AL_FALSE
return|;
name|c1
operator|--
expr_stmt|;
break|break;
case|case
name|AL_SERDES_TX_DEEMP_C_MINUS
case|:
if|if
condition|(
name|c_1
operator|==
name|AL_SERDES_TX_DEEMPH_C_MINUS_MIN_VAL
condition|)
return|return
name|AL_FALSE
return|;
name|c_1
operator|--
expr_stmt|;
break|break;
block|}
name|al_dbg
argument_list|(
literal|"%s: new txdeemph: c0 = 0x%x c1 = 0x%x c-1 = 0x%x\n"
argument_list|,
name|__func__
argument_list|,
name|c0
argument_list|,
name|c1
argument_list|,
name|c_1
argument_list|)
expr_stmt|;
name|al_serdes_tx_deemph_set
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|c0
argument_list|,
name|c1
argument_list|,
name|c_1
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_tx_deemph_preset
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
name|uint32_t
name|c0
decl_stmt|;
name|uint32_t
name|c1
decl_stmt|;
name|uint32_t
name|c_1
decl_stmt|;
name|c0
operator|=
name|AL_SERDES_TX_DEEMPH_C_ZERO_PRESET
expr_stmt|;
name|c1
operator|=
name|AL_SERDES_TX_DEEMPH_C_PLUS_PRESET
expr_stmt|;
name|c_1
operator|=
name|AL_SERDES_TX_DEEMPH_C_MINUS_PRESET
expr_stmt|;
name|al_dbg
argument_list|(
literal|"preset: new txdeemph: c0 = 0x%x c1 = 0x%x c-1 = 0x%x\n"
argument_list|,
name|c0
argument_list|,
name|c1
argument_list|,
name|c_1
argument_list|)
expr_stmt|;
name|al_serdes_tx_deemph_set
argument_list|(
name|obj
argument_list|,
name|lane
argument_list|,
name|c0
argument_list|,
name|c1
argument_list|,
name|c_1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|al_bool
name|al_serdes_signal_is_detected
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
name|uint32_t
name|reg
init|=
literal|0
decl_stmt|;
name|reg
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXRANDET_REG_NUM
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
name|reg
operator|&
name|SERDES_IREG_FLD_RXRANDET_STAT
operator|)
condition|?
name|AL_TRUE
else|:
name|AL_FALSE
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_tx_advanced_params_set
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|void
modifier|*
name|tx_params
parameter_list|)
block|{
name|uint8_t
name|reg
init|=
literal|0
decl_stmt|;
name|struct
name|al_serdes_adv_tx_params
modifier|*
name|params
init|=
name|tx_params
decl_stmt|;
if|if
condition|(
operator|!
name|params
operator|->
name|override
condition|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_TX_DRV_OVERRIDE_EN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_TX_DRV_OVERRIDE_EN
argument_list|,
name|SERDES_IREG_FLD_TX_DRV_OVERRIDE_EN
argument_list|)
expr_stmt|;
return|return;
block|}
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_TX_DRV_OVERRIDE_EN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_TX_DRV_OVERRIDE_EN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_TX_DRV_1_HLEV_MASK
argument_list|,
name|SERDES_IREG_TX_DRV_1_HLEV_SHIFT
argument_list|,
name|params
operator|->
name|amp
argument_list|)
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_TX_DRV_1_LEVN_MASK
argument_list|,
name|SERDES_IREG_TX_DRV_1_LEVN_SHIFT
argument_list|,
name|params
operator|->
name|total_driver_units
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_1_REG_NUM
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|reg
operator|=
literal|0
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_TX_DRV_2_LEVNM1_MASK
argument_list|,
name|SERDES_IREG_TX_DRV_2_LEVNM1_SHIFT
argument_list|,
name|params
operator|->
name|c_plus_1
argument_list|)
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_TX_DRV_2_LEVNM2_MASK
argument_list|,
name|SERDES_IREG_TX_DRV_2_LEVNM2_SHIFT
argument_list|,
name|params
operator|->
name|c_plus_2
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_2_REG_NUM
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|reg
operator|=
literal|0
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_TX_DRV_3_LEVNP1_MASK
argument_list|,
name|SERDES_IREG_TX_DRV_3_LEVNP1_SHIFT
argument_list|,
name|params
operator|->
name|c_minus_1
argument_list|)
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_TX_DRV_3_SLEW_MASK
argument_list|,
name|SERDES_IREG_TX_DRV_3_SLEW_SHIFT
argument_list|,
name|params
operator|->
name|slew_rate
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_3_REG_NUM
argument_list|,
name|reg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_tx_advanced_params_get
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|void
modifier|*
name|tx_params
parameter_list|)
block|{
name|struct
name|al_serdes_adv_tx_params
modifier|*
name|params
init|=
name|tx_params
decl_stmt|;
name|uint8_t
name|reg_val
init|=
literal|0
decl_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_1_REG_NUM
argument_list|,
operator|&
name|reg_val
argument_list|)
expr_stmt|;
name|params
operator|->
name|amp
operator|=
operator|(
name|reg_val
operator|&
name|SERDES_IREG_TX_DRV_1_HLEV_MASK
operator|)
operator|>>
name|SERDES_IREG_TX_DRV_1_HLEV_SHIFT
expr_stmt|;
name|params
operator|->
name|total_driver_units
operator|=
operator|(
name|reg_val
operator|&
name|SERDES_IREG_TX_DRV_1_LEVN_MASK
operator|)
operator|>>
name|SERDES_IREG_TX_DRV_1_LEVN_SHIFT
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_2_REG_NUM
argument_list|,
operator|&
name|reg_val
argument_list|)
expr_stmt|;
name|params
operator|->
name|c_plus_1
operator|=
operator|(
name|reg_val
operator|&
name|SERDES_IREG_TX_DRV_2_LEVNM1_MASK
operator|)
operator|>>
name|SERDES_IREG_TX_DRV_2_LEVNM1_SHIFT
expr_stmt|;
name|params
operator|->
name|c_plus_2
operator|=
operator|(
name|reg_val
operator|&
name|SERDES_IREG_TX_DRV_2_LEVNM2_MASK
operator|)
operator|>>
name|SERDES_IREG_TX_DRV_2_LEVNM2_SHIFT
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_TX_DRV_3_REG_NUM
argument_list|,
operator|&
name|reg_val
argument_list|)
expr_stmt|;
name|params
operator|->
name|c_minus_1
operator|=
operator|(
name|reg_val
operator|&
name|SERDES_IREG_TX_DRV_3_LEVNP1_MASK
operator|)
operator|>>
name|SERDES_IREG_TX_DRV_3_LEVNP1_SHIFT
expr_stmt|;
name|params
operator|->
name|slew_rate
operator|=
operator|(
name|reg_val
operator|&
name|SERDES_IREG_TX_DRV_3_SLEW_MASK
operator|)
operator|>>
name|SERDES_IREG_TX_DRV_3_SLEW_SHIFT
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_TX_DRV_OVERRIDE_EN_REG_NUM
argument_list|,
operator|&
name|reg_val
argument_list|)
expr_stmt|;
name|params
operator|->
name|override
operator|=
operator|(
operator|(
name|reg_val
operator|&
name|SERDES_IREG_FLD_TX_DRV_OVERRIDE_EN
operator|)
operator|==
literal|0
operator|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_rx_advanced_params_set
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|void
modifier|*
name|rx_params
parameter_list|)
block|{
name|struct
name|al_serdes_adv_rx_params
modifier|*
name|params
init|=
name|rx_params
decl_stmt|;
name|uint8_t
name|reg
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|params
operator|->
name|override
condition|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RX_DRV_OVERRIDE_EN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RX_DRV_OVERRIDE_EN
argument_list|,
name|SERDES_IREG_FLD_RX_DRV_OVERRIDE_EN
argument_list|)
expr_stmt|;
return|return;
block|}
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RX_DRV_OVERRIDE_EN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RX_DRV_OVERRIDE_EN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_RX_CALEQ_1_DCGAIN_MASK
argument_list|,
name|SERDES_IREG_RX_CALEQ_1_DCGAIN_SHIFT
argument_list|,
name|params
operator|->
name|dcgain
argument_list|)
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_RX_CALEQ_1_DFEPSTAP3DB_MASK
argument_list|,
name|SERDES_IREG_RX_CALEQ_1_DFEPSTAP3DB_SHIFT
argument_list|,
name|params
operator|->
name|dfe_3db_freq
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RX_CALEQ_1_REG_NUM
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|reg
operator|=
literal|0
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_RX_CALEQ_2_DFEPSTAPGAIN_MASK
argument_list|,
name|SERDES_IREG_RX_CALEQ_2_DFEPSTAPGAIN_SHIFT
argument_list|,
name|params
operator|->
name|dfe_gain
argument_list|)
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_RX_CALEQ_2_DFETAP1GAIN_MASK
argument_list|,
name|SERDES_IREG_RX_CALEQ_2_DFETAP1GAIN_SHIFT
argument_list|,
name|params
operator|->
name|dfe_first_tap_ctrl
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RX_CALEQ_2_REG_NUM
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|reg
operator|=
literal|0
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_RX_CALEQ_3_DFETAP2GAIN_MASK
argument_list|,
name|SERDES_IREG_RX_CALEQ_3_DFETAP2GAIN_SHIFT
argument_list|,
name|params
operator|->
name|dfe_secound_tap_ctrl
argument_list|)
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_RX_CALEQ_3_DFETAP3GAIN_MASK
argument_list|,
name|SERDES_IREG_RX_CALEQ_3_DFETAP3GAIN_SHIFT
argument_list|,
name|params
operator|->
name|dfe_third_tap_ctrl
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RX_CALEQ_3_REG_NUM
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|reg
operator|=
literal|0
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_RX_CALEQ_4_DFETAP4GAIN_MASK
argument_list|,
name|SERDES_IREG_RX_CALEQ_4_DFETAP4GAIN_SHIFT
argument_list|,
name|params
operator|->
name|dfe_fourth_tap_ctrl
argument_list|)
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_RX_CALEQ_4_LOFREQAGCGAIN_MASK
argument_list|,
name|SERDES_IREG_RX_CALEQ_4_LOFREQAGCGAIN_SHIFT
argument_list|,
name|params
operator|->
name|low_freq_agc_gain
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RX_CALEQ_4_REG_NUM
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|reg
operator|=
literal|0
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_RX_CALEQ_5_PRECAL_CODE_SEL_MASK
argument_list|,
name|SERDES_IREG_RX_CALEQ_5_PRECAL_CODE_SEL_SHIFT
argument_list|,
name|params
operator|->
name|precal_code_sel
argument_list|)
expr_stmt|;
name|AL_REG_FIELD_SET
argument_list|(
name|reg
argument_list|,
name|SERDES_IREG_RX_CALEQ_5_HIFREQAGCCAP_MASK
argument_list|,
name|SERDES_IREG_RX_CALEQ_5_HIFREQAGCCAP_SHIFT
argument_list|,
name|params
operator|->
name|high_freq_agc_boost
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RX_CALEQ_5_REG_NUM
argument_list|,
name|reg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|void
name|al_serdes_common_cfg_eth
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXEQ_LOOKUP_CODE_EN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXEQ_LOOKUP_CODE_EN_MASK
argument_list|,
operator|(
literal|0x1
operator|<<
name|SERDES_IREG_FLD_RXEQ_LOOKUP_CODE_EN_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXEQ_LOOKUP_LASTCODE_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXEQ_LOOKUP_LASTCODE_MASK
argument_list|,
operator|(
literal|0
operator|<<
name|SERDES_IREG_FLD_RXEQ_LOOKUP_LASTCODE_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXEQ_COARSE_RUN1_MASK_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXEQ_COARSE_RUN1_MASK_MASK
argument_list|,
operator|(
literal|0x2
operator|<<
name|SERDES_IREG_FLD_RXEQ_COARSE_RUN1_MASK_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXEQ_COARSE_RUN2_MASK_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXEQ_COARSE_RUN2_MASK_MASK
argument_list|,
operator|(
literal|0
operator|<<
name|SERDES_IREG_FLD_RXEQ_COARSE_RUN2_MASK_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXEQ_COARSE_STEP_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXEQ_COARSE_STEP_MASK
argument_list|,
operator|(
literal|0x1
operator|<<
name|SERDES_IREG_FLD_RXEQ_COARSE_STEP_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXEQ_COARSE_ITER_NUM_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXEQ_COARSE_ITER_NUM_MASK
argument_list|,
operator|(
literal|0x1
operator|<<
name|SERDES_IREG_FLD_RXEQ_COARSE_ITER_NUM_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXEQ_FINE_RUN1_MASK_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXEQ_FINE_RUN1_MASK_MASK
argument_list|,
operator|(
literal|0xf0
operator|<<
name|SERDES_IREG_FLD_RXEQ_FINE_RUN1_MASK_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXEQ_FINE_RUN2_MASK_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXEQ_FINE_RUN2_MASK_MASK
argument_list|,
operator|(
literal|0
operator|<<
name|SERDES_IREG_FLD_RXEQ_FINE_RUN2_MASK_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXEQ_FINE_STEP_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXEQ_FINE_STEP_MASK
argument_list|,
operator|(
literal|1
operator|<<
name|SERDES_IREG_FLD_RXEQ_FINE_STEP_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXEQ_FINE_ITER_NUM_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXEQ_FINE_ITER_NUM_MASK
argument_list|,
operator|(
literal|0x8
operator|<<
name|SERDES_IREG_FLD_RXEQ_FINE_ITER_NUM_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_BERTHRESHOLD1_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_BERTHRESHOLD1_MASK
argument_list|,
operator|(
literal|0
operator|<<
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_BERTHRESHOLD1_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_BERTHRESHOLD2_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_BERTHRESHOLD2_MASK
argument_list|,
operator|(
literal|0x64
operator|<<
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_BERTHRESHOLD2_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALCOARSE_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALCOARSE_MASK
argument_list|,
operator|(
literal|0x3
operator|<<
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALCOARSE_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALFINE_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALFINE_MASK
argument_list|,
operator|(
literal|0x1
operator|<<
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALFINE_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALCOARSE_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALCOARSE_MASK
argument_list|,
operator|(
literal|3
operator|<<
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALCOARSE_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALFINE_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALFINE_MASK
argument_list|,
operator|(
literal|1
operator|<<
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALFINE_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_MSB_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_MSB_MASK
argument_list|,
operator|(
literal|0xc
operator|<<
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_MSB_SHIFT
operator|)
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_LSB_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_LSB_MASK
argument_list|,
operator|(
literal|0xcc
operator|<<
name|SERDES_IREG_FLD_EYE_DIAG_SAMPLE_CNT_LSB_SHIFT
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_struct
struct|struct
name|al_serdes_mode_rx_tx_inv_state
block|{
name|al_bool
name|restore
decl_stmt|;
name|uint32_t
name|pipe_rst
decl_stmt|;
name|uint32_t
name|ipd_multi
index|[
name|AL_SRDS_NUM_LANES
index|]
decl_stmt|;
name|uint8_t
name|inv_value
index|[
name|AL_SRDS_NUM_LANES
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|al_serdes_mode_rx_tx_inv_state_save
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|struct
name|al_serdes_mode_rx_tx_inv_state
modifier|*
name|state
parameter_list|)
block|{
name|struct
name|al_serdes_regs
name|__iomem
modifier|*
name|regs_base
init|=
name|obj
operator|->
name|regs_base
decl_stmt|;
if|if
condition|(
name|al_reg_read32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|)
operator|&
name|SERDES_GEN_IRST_POR_B_A
condition|)
block|{
name|int
name|i
decl_stmt|;
name|state
operator|->
name|restore
operator|=
name|AL_TRUE
expr_stmt|;
name|state
operator|->
name|pipe_rst
operator|=
name|al_reg_read32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AL_SRDS_NUM_LANES
condition|;
name|i
operator|++
control|)
block|{
name|state
operator|->
name|inv_value
index|[
name|i
index|]
operator|=
name|al_serdes_grp_reg_read
argument_list|(
name|obj
argument_list|,
name|i
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_POLARITY_RX_REG_NUM
argument_list|)
expr_stmt|;
name|state
operator|->
name|ipd_multi
index|[
name|i
index|]
operator|=
name|al_reg_read32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
name|i
index|]
operator|.
name|ipd_multi
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|state
operator|->
name|restore
operator|=
name|AL_FALSE
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_mode_rx_tx_inv_state_restore
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|struct
name|al_serdes_mode_rx_tx_inv_state
modifier|*
name|state
parameter_list|)
block|{
name|struct
name|al_serdes_regs
name|__iomem
modifier|*
name|regs_base
init|=
name|obj
operator|->
name|regs_base
decl_stmt|;
if|if
condition|(
name|state
operator|->
name|restore
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AL_SRDS_NUM_LANES
condition|;
name|i
operator|++
control|)
block|{
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|i
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_POLARITY_RX_REG_NUM
argument_list|,
name|state
operator|->
name|inv_value
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
name|i
index|]
operator|.
name|ipd_multi
argument_list|,
name|state
operator|->
name|ipd_multi
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|al_reg_write32_masked
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|,
operator|(
name|SERDES_GEN_IRST_PIPE_RST_L0_B_A_SEL
operator|>>
name|i
operator|)
operator||
operator|(
name|SERDES_GEN_IRST_PIPE_RST_L0_B_A
operator|>>
name|i
operator|)
argument_list|,
name|state
operator|->
name|pipe_rst
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_mode_set_sgmii
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|)
block|{
name|struct
name|al_serdes_grp_obj
modifier|*
name|grp_obj
init|=
name|obj
decl_stmt|;
name|struct
name|al_serdes_regs
name|__iomem
modifier|*
name|regs_base
init|=
name|grp_obj
operator|->
name|regs_base
decl_stmt|;
name|struct
name|al_serdes_mode_rx_tx_inv_state
name|rx_tx_inv_state
decl_stmt|;
name|al_assert
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|al_serdes_mode_rx_tx_inv_state_save
argument_list|(
name|grp_obj
argument_list|,
operator|&
name|rx_tx_inv_state
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|,
literal|0x000000
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|0
index|]
operator|.
name|ictl_multi
argument_list|,
literal|0x10110010
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|1
index|]
operator|.
name|ictl_multi
argument_list|,
literal|0x10110010
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|2
index|]
operator|.
name|ictl_multi
argument_list|,
literal|0x10110010
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|3
index|]
operator|.
name|ictl_multi
argument_list|,
literal|0x10110010
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|ipd_multi_synth
argument_list|,
literal|0x0001
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|0
index|]
operator|.
name|ipd_multi
argument_list|,
literal|0x0003
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|1
index|]
operator|.
name|ipd_multi
argument_list|,
literal|0x0003
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|2
index|]
operator|.
name|ipd_multi
argument_list|,
literal|0x0003
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|3
index|]
operator|.
name|ipd_multi
argument_list|,
literal|0x0003
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|ictl_pcs
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|,
literal|0x001000
argument_list|)
expr_stmt|;
name|al_serdes_ns_delay
argument_list|(
literal|800
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|,
literal|0x000000
argument_list|)
expr_stmt|;
name|al_serdes_ns_delay
argument_list|(
literal|500
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|,
literal|0x001000
argument_list|)
expr_stmt|;
name|al_serdes_ns_delay
argument_list|(
literal|500
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|101
argument_list|,
literal|183
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|102
argument_list|,
literal|183
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|103
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|104
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|105
argument_list|,
literal|26
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|106
argument_list|,
literal|26
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|107
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|108
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|109
argument_list|,
literal|17
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|110
argument_list|,
literal|13
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|101
argument_list|,
literal|153
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|102
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|103
argument_list|,
literal|108
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|104
argument_list|,
literal|183
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|105
argument_list|,
literal|183
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|106
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|107
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|108
argument_list|,
literal|26
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|109
argument_list|,
literal|26
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|110
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|111
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|112
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|113
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|114
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|115
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|116
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|117
argument_list|,
literal|179
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|118
argument_list|,
literal|246
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|119
argument_list|,
literal|208
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|120
argument_list|,
literal|239
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|121
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|122
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|123
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|124
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|125
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|126
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|127
argument_list|,
literal|211
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|128
argument_list|,
literal|211
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|129
argument_list|,
literal|226
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|130
argument_list|,
literal|239
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|131
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|132
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|133
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|134
argument_list|,
literal|239
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|135
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|136
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|137
argument_list|,
literal|211
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|138
argument_list|,
literal|211
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|139
argument_list|,
literal|226
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|140
argument_list|,
literal|239
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|141
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|142
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|143
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|144
argument_list|,
literal|239
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|145
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|146
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|147
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|148
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|149
argument_list|,
literal|63
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|150
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|151
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|152
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|153
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|154
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|155
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|156
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|157
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|158
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|159
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|160
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|161
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|162
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|163
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|164
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0_LANE_0
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|7
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_1_LANE_1
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|7
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_2_LANE_2
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|7
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_3_LANE_3
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|7
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|13
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|48
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|49
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|54
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|55
argument_list|,
literal|180
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|93
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|165
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|41
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|354
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|355
argument_list|,
literal|58
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|356
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|357
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|358
argument_list|,
literal|62
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|359
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|701
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|87
argument_list|,
literal|0x1f
argument_list|)
expr_stmt|;
name|al_serdes_common_cfg_eth
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|al_serdes_mode_rx_tx_inv_state_restore
argument_list|(
name|grp_obj
argument_list|,
operator|&
name|rx_tx_inv_state
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|,
literal|0x0011F0
argument_list|)
expr_stmt|;
name|al_serdes_ns_delay
argument_list|(
literal|500
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_mode_set_kr
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|)
block|{
name|struct
name|al_serdes_grp_obj
modifier|*
name|grp_obj
init|=
name|obj
decl_stmt|;
name|struct
name|al_serdes_regs
name|__iomem
modifier|*
name|regs_base
init|=
name|grp_obj
operator|->
name|regs_base
decl_stmt|;
name|struct
name|al_serdes_mode_rx_tx_inv_state
name|rx_tx_inv_state
decl_stmt|;
name|al_assert
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|al_serdes_mode_rx_tx_inv_state_save
argument_list|(
name|grp_obj
argument_list|,
operator|&
name|rx_tx_inv_state
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|,
literal|0x000000
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|0
index|]
operator|.
name|ictl_multi
argument_list|,
literal|0x30330030
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|1
index|]
operator|.
name|ictl_multi
argument_list|,
literal|0x30330030
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|2
index|]
operator|.
name|ictl_multi
argument_list|,
literal|0x30330030
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|3
index|]
operator|.
name|ictl_multi
argument_list|,
literal|0x30330030
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|ipd_multi_synth
argument_list|,
literal|0x0001
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|0
index|]
operator|.
name|ipd_multi
argument_list|,
literal|0x0003
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|1
index|]
operator|.
name|ipd_multi
argument_list|,
literal|0x0003
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|2
index|]
operator|.
name|ipd_multi
argument_list|,
literal|0x0003
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|lane
index|[
literal|3
index|]
operator|.
name|ipd_multi
argument_list|,
literal|0x0003
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|ictl_pcs
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|,
literal|0x001000
argument_list|)
expr_stmt|;
name|al_serdes_ns_delay
argument_list|(
literal|800
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|,
literal|0x000000
argument_list|)
expr_stmt|;
name|al_serdes_ns_delay
argument_list|(
literal|500
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|,
literal|0x001000
argument_list|)
expr_stmt|;
name|al_serdes_ns_delay
argument_list|(
literal|500
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|101
argument_list|,
literal|189
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|102
argument_list|,
literal|189
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|103
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|104
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|105
argument_list|,
literal|27
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|106
argument_list|,
literal|27
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|107
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|108
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|109
argument_list|,
literal|119
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|110
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|101
argument_list|,
literal|170
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|102
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|103
argument_list|,
literal|108
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|104
argument_list|,
literal|189
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|105
argument_list|,
literal|189
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|106
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|107
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|108
argument_list|,
literal|27
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|109
argument_list|,
literal|27
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|110
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|111
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|112
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|113
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|114
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|115
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|116
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|117
argument_list|,
literal|179
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|118
argument_list|,
literal|246
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|119
argument_list|,
literal|208
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|120
argument_list|,
literal|239
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|121
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|122
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|123
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|124
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|125
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|126
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|127
argument_list|,
literal|211
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|128
argument_list|,
literal|211
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|129
argument_list|,
literal|226
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|130
argument_list|,
literal|239
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|131
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|132
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|133
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|134
argument_list|,
literal|239
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|135
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|136
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|137
argument_list|,
literal|211
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|138
argument_list|,
literal|211
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|139
argument_list|,
literal|226
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|140
argument_list|,
literal|239
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|141
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|142
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|143
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|144
argument_list|,
literal|239
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|145
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|146
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|147
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|148
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|149
argument_list|,
literal|63
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|150
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|151
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|152
argument_list|,
literal|17
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|153
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|154
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|155
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|156
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|157
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|158
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|159
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|160
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|161
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|162
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|163
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|164
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0_LANE_0
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|7
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_1_LANE_1
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|7
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_2_LANE_2
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|7
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_3_LANE_3
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|7
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|13
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|48
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|49
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|54
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|55
argument_list|,
literal|149
argument_list|)
expr_stmt|;
comment|/*Was 182*/
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|93
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|165
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|41
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|354
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|355
argument_list|,
literal|58
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|356
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|357
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|358
argument_list|,
literal|62
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|359
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|701
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_0123_LANES_0123
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
literal|87
argument_list|,
literal|0x1f
argument_list|)
expr_stmt|;
name|al_serdes_common_cfg_eth
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|al_serdes_mode_rx_tx_inv_state_restore
argument_list|(
name|grp_obj
argument_list|,
operator|&
name|rx_tx_inv_state
argument_list|)
expr_stmt|;
name|al_reg_write32
argument_list|(
operator|&
name|regs_base
operator|->
name|gen
operator|.
name|irst
argument_list|,
literal|0x0011F0
argument_list|)
expr_stmt|;
name|al_serdes_ns_delay
argument_list|(
literal|500
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_rx_advanced_params_get
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|void
modifier|*
name|rx_params
parameter_list|)
block|{
name|struct
name|al_serdes_adv_rx_params
modifier|*
name|params
init|=
name|rx_params
decl_stmt|;
name|uint8_t
name|temp_val
decl_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RX_CALEQ_1_REG_NUM
argument_list|,
operator|&
name|temp_val
argument_list|)
expr_stmt|;
name|params
operator|->
name|dcgain
operator|=
operator|(
name|temp_val
operator|&
name|SERDES_IREG_RX_CALEQ_1_DCGAIN_MASK
operator|)
operator|>>
name|SERDES_IREG_RX_CALEQ_1_DCGAIN_SHIFT
expr_stmt|;
name|params
operator|->
name|dfe_3db_freq
operator|=
operator|(
name|temp_val
operator|&
name|SERDES_IREG_RX_CALEQ_1_DFEPSTAP3DB_MASK
operator|)
operator|>>
name|SERDES_IREG_RX_CALEQ_1_DFEPSTAP3DB_SHIFT
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RX_CALEQ_2_REG_NUM
argument_list|,
operator|&
name|temp_val
argument_list|)
expr_stmt|;
name|params
operator|->
name|dfe_gain
operator|=
operator|(
name|temp_val
operator|&
name|SERDES_IREG_RX_CALEQ_2_DFEPSTAPGAIN_MASK
operator|)
operator|>>
name|SERDES_IREG_RX_CALEQ_2_DFEPSTAPGAIN_SHIFT
expr_stmt|;
name|params
operator|->
name|dfe_first_tap_ctrl
operator|=
operator|(
name|temp_val
operator|&
name|SERDES_IREG_RX_CALEQ_2_DFETAP1GAIN_MASK
operator|)
operator|>>
name|SERDES_IREG_RX_CALEQ_2_DFETAP1GAIN_SHIFT
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RX_CALEQ_3_REG_NUM
argument_list|,
operator|&
name|temp_val
argument_list|)
expr_stmt|;
name|params
operator|->
name|dfe_secound_tap_ctrl
operator|=
operator|(
name|temp_val
operator|&
name|SERDES_IREG_RX_CALEQ_3_DFETAP2GAIN_MASK
operator|)
operator|>>
name|SERDES_IREG_RX_CALEQ_3_DFETAP2GAIN_SHIFT
expr_stmt|;
name|params
operator|->
name|dfe_third_tap_ctrl
operator|=
operator|(
name|temp_val
operator|&
name|SERDES_IREG_RX_CALEQ_3_DFETAP3GAIN_MASK
operator|)
operator|>>
name|SERDES_IREG_RX_CALEQ_3_DFETAP3GAIN_SHIFT
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RX_CALEQ_4_REG_NUM
argument_list|,
operator|&
name|temp_val
argument_list|)
expr_stmt|;
name|params
operator|->
name|dfe_fourth_tap_ctrl
operator|=
operator|(
name|temp_val
operator|&
name|SERDES_IREG_RX_CALEQ_4_DFETAP4GAIN_MASK
operator|)
operator|>>
name|SERDES_IREG_RX_CALEQ_4_DFETAP4GAIN_SHIFT
expr_stmt|;
name|params
operator|->
name|low_freq_agc_gain
operator|=
operator|(
name|temp_val
operator|&
name|SERDES_IREG_RX_CALEQ_4_LOFREQAGCGAIN_MASK
operator|)
operator|>>
name|SERDES_IREG_RX_CALEQ_4_LOFREQAGCGAIN_SHIFT
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RX_CALEQ_5_REG_NUM
argument_list|,
operator|&
name|temp_val
argument_list|)
expr_stmt|;
name|params
operator|->
name|precal_code_sel
operator|=
operator|(
name|temp_val
operator|&
name|SERDES_IREG_RX_CALEQ_5_PRECAL_CODE_SEL_MASK
operator|)
operator|>>
name|SERDES_IREG_RX_CALEQ_5_PRECAL_CODE_SEL_SHIFT
expr_stmt|;
name|params
operator|->
name|high_freq_agc_boost
operator|=
operator|(
name|temp_val
operator|&
name|SERDES_IREG_RX_CALEQ_5_HIFREQAGCCAP_MASK
operator|)
operator|>>
name|SERDES_IREG_RX_CALEQ_5_HIFREQAGCCAP_SHIFT
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RX_DRV_OVERRIDE_EN_REG_NUM
argument_list|,
operator|&
name|temp_val
argument_list|)
expr_stmt|;
name|params
operator|->
name|override
operator|=
operator|(
operator|(
name|temp_val
operator|&
name|SERDES_IREG_FLD_RX_DRV_OVERRIDE_EN
operator|)
operator|==
literal|0
operator|)
expr_stmt|;
block|}
end_function

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_LOCWREN_REG_NUM
operator|!=
expr|\
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN_REG_NUM
operator|||
expr|\
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_LOCWREN_REG_NUM
operator|!=
expr|\
name|SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
error|Wrong assumption
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|al_serdes_rx_equalization
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|)
block|{
name|uint8_t
name|serdes_ireg_fld_rxcalroamyadjust_locwren_val
decl_stmt|;
name|uint8_t
name|serdes_ireg_fld_rxroam_xorbitsel_val
decl_stmt|;
name|uint8_t
name|serdes_ireg_fld_pcsrxeq_locwren_val
decl_stmt|;
name|uint8_t
name|serdes_ireg_fld_rxcal_locwren_val
decl_stmt|;
name|uint8_t
name|temp_val
decl_stmt|;
name|uint8_t
name|done
decl_stmt|;
name|int
name|test_score
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/* 	 * Make sure Roam Eye mechanism is not overridden 	 * Lane SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_LOCWREN = 1, 	 *	so Rx 4-Point Eye process is not overridden 	 * Lane SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN = 1, 	 *	so Eye Roam latch is not overridden 	 * Lane SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN = 1, 	 *	so Eye Roam latch 'X adjust' is not overridden 	 * Lane SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN = 1, 	 *	so Eye Roam latch 'Y adjust' is not overridden 	 * Lane SERDES_IREG_FLD_RXROAM_XORBITSEL = 0/1, 	 *	so Eye Roamlatch works on the right Eye position (XORBITSEL) 	 *	For most cases 0 is needed, but sometimes 1 is needed. 	 *	I couldn't sort out why is this so the code uses a global 	 *      XORBITSELmode variable, set by the user (GUI). Default is 0. 	 * control must be internal. At the end we restore original setting 	 */
comment|/* save current values for restoring them later in the end */
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCAL_LOCWREN_REG_NUM
argument_list|,
operator|&
name|serdes_ireg_fld_rxcal_locwren_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN_REG_NUM
argument_list|,
operator|&
name|serdes_ireg_fld_rxcalroamyadjust_locwren_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXROAM_XORBITSEL_REG_NUM
argument_list|,
operator|&
name|serdes_ireg_fld_rxroam_xorbitsel_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSRXEQ_LOCWREN_REG_NUM
argument_list|,
operator|&
name|serdes_ireg_fld_pcsrxeq_locwren_val
argument_list|)
expr_stmt|;
comment|/* 	 * Set Bits: 	 * SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_LOCWREN 	 * SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN 	 * SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN 	 * to return 4pt-RxEye and EyeRoam Latch to internal logic 	 * 	 * clear bit SERDES_IREG_FLD_RX_DRV_OVERRIDE_EN 	 * AGC/DFE controlled via PMA registers 	 */
name|temp_val
operator|=
name|serdes_ireg_fld_rxcal_locwren_val
expr_stmt|;
name|temp_val
operator||=
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_LOCWREN
expr_stmt|;
name|temp_val
operator||=
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN
expr_stmt|;
name|temp_val
operator||=
name|SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN
expr_stmt|;
name|temp_val
operator||=
name|SERDES_IREG_FLD_RX_DRV_OVERRIDE_EN
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCAL_LOCWREN_REG_NUM
argument_list|,
name|temp_val
argument_list|)
expr_stmt|;
comment|/* 	 * Set bit SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN 	 * to return EyeRoam Latch Y to internal logic 	 */
name|temp_val
operator|=
name|serdes_ireg_fld_rxcalroamyadjust_locwren_val
operator||
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN_REG_NUM
argument_list|,
name|temp_val
argument_list|)
expr_stmt|;
comment|/* 	 * Clear Bit: SERDES_IREG_FLD_RXROAM_XORBITSEL 	 * so XORBITSEL=0, needed for the Eye mapping. 	 */
name|temp_val
operator|=
name|serdes_ireg_fld_rxroam_xorbitsel_val
operator|&
operator|~
name|SERDES_IREG_FLD_RXROAM_XORBITSEL
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXROAM_XORBITSEL_REG_NUM
argument_list|,
name|temp_val
argument_list|)
expr_stmt|;
comment|/* 	 * Take Control from int.pin over RxEQ process. 	 * Clear Bit SERDES_IREG_FLD_PCSRXEQ_LOCWREN 	 * to override RxEQ via PMA 	 */
name|temp_val
operator|=
name|serdes_ireg_fld_pcsrxeq_locwren_val
operator|&
operator|~
name|SERDES_IREG_FLD_PCSRXEQ_LOCWREN
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSRXEQ_LOCWREN_REG_NUM
argument_list|,
name|temp_val
argument_list|)
expr_stmt|;
comment|/* 	 * Start/Stop RxEQ Cal is via PCSRXEQ_START: 1=START. 0=STOP. 	 * Clear Bit SERDES_IREG_FLD_PCSRXEQ_START 	 * to start fresh from Stop 	 */
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSRXEQ_START_REG_NUM
argument_list|,
operator|&
name|temp_val
argument_list|)
expr_stmt|;
name|temp_val
operator|&=
operator|~
name|SERDES_IREG_FLD_PCSRXEQ_START
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSRXEQ_START_REG_NUM
argument_list|,
name|temp_val
argument_list|)
expr_stmt|;
comment|/* Set Bit SERDES_IREG_FLD_PCSRXEQ_START 	 * to begin Rx Eq Cal */
name|temp_val
operator||=
name|SERDES_IREG_FLD_PCSRXEQ_START
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSRXEQ_START_REG_NUM
argument_list|,
name|temp_val
argument_list|)
expr_stmt|;
comment|/* Poll on RxEq Cal completion. SERDES_IREG_FLD_RXEQ_DONE. 1=Done. */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AL_SERDES_RX_EQUAL_TRIES
condition|;
operator|++
name|i
control|)
block|{
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASDONE_REG_NUM
argument_list|,
operator|&
name|done
argument_list|)
expr_stmt|;
name|done
operator|&=
name|SERDES_IREG_FLD_RXEQ_DONE
expr_stmt|;
comment|/* Check if RxEQ Cal is done */
if|if
condition|(
name|done
condition|)
break|break;
name|al_msleep
argument_list|(
name|AL_SERDES_RX_EQUAL_MDELAY
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|done
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: Timeout!\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
comment|/* Stop the RxEQ process. */
name|temp_val
operator|&=
operator|~
name|SERDES_IREG_FLD_PCSRXEQ_START
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSRXEQ_START_REG_NUM
argument_list|,
name|temp_val
argument_list|)
expr_stmt|;
comment|/* Get score */
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RXEQ_BEST_EYE_MSB_VAL_REG_NUM
argument_list|,
operator|&
name|temp_val
argument_list|)
expr_stmt|;
name|test_score
operator|=
call|(
name|int
call|)
argument_list|(
operator|(
name|temp_val
operator|&
literal|0xFF
operator|)
operator|<<
literal|6
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_RXEQ_BEST_EYE_LSB_VAL_REG_NUM
argument_list|,
operator|&
name|temp_val
argument_list|)
expr_stmt|;
name|test_score
operator|+=
call|(
name|int
call|)
argument_list|(
name|temp_val
operator|&
name|SERDES_IREG_RXEQ_BEST_EYE_LSB_VAL_MASK
argument_list|)
expr_stmt|;
comment|/* Restore start values */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCAL_LOCWREN_REG_NUM
argument_list|,
name|serdes_ireg_fld_rxcal_locwren_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN_REG_NUM
argument_list|,
name|serdes_ireg_fld_rxcalroamyadjust_locwren_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXROAM_XORBITSEL_REG_NUM
argument_list|,
name|serdes_ireg_fld_rxroam_xorbitsel_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PCSRXEQ_LOCWREN_REG_NUM
argument_list|,
name|serdes_ireg_fld_pcsrxeq_locwren_val
argument_list|)
expr_stmt|;
return|return
name|test_score
return|;
block|}
end_function

begin_if
if|#
directive|if
operator|(
name|SERDES_IREG_FLD_RXCAL_LOCWREN_REG_NUM
operator|!=
expr|\
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN_REG_NUM
operator|||
expr|\
name|SERDES_IREG_FLD_RXCAL_LOCWREN_REG_NUM
operator|!=
expr|\
name|SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN_REG_NUM
operator|||
expr|\
name|SERDES_IREG_FLD_RXCAL_LOCWREN_REG_NUM
operator|!=
expr|\
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_LOCWREN_REG_NUM
operator|)
end_if

begin_error
error|#
directive|error
error|Wrong assumption
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|al_serdes_calc_eye_size
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|enum
name|al_serdes_lane
name|lane
parameter_list|,
name|int
modifier|*
name|width
parameter_list|,
name|int
modifier|*
name|height
parameter_list|)
block|{
name|uint8_t
name|rxcaleyediagfsm_x_y_valweight_val
decl_stmt|;
name|uint8_t
name|rxcaleyediagfsm_xvalcoarse_val
decl_stmt|;
name|uint8_t
name|rxcaleyediagfsm_xvalfine_val
decl_stmt|;
name|uint8_t
name|rxcaleyediagfsm_yvalcoarse_val
decl_stmt|;
name|uint8_t
name|rxcaleyediagfsm_yvalfine_val
decl_stmt|;
name|uint8_t
name|rxlock2ref_locwren_val
decl_stmt|;
name|uint8_t
name|rxcal_locwren_val
decl_stmt|;
name|uint8_t
name|rxcalroamyadjust_locwren_val
decl_stmt|;
name|uint8_t
name|rxlock2ref_ovren_val
decl_stmt|;
name|int
name|i
decl_stmt|;
name|uint8_t
name|status
decl_stmt|;
name|uint8_t
name|reg_value
decl_stmt|;
comment|/* Save Registers */
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXLOCK2REF_LOCWREN_REG_NUM
argument_list|,
operator|&
name|rxlock2ref_locwren_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCAL_LOCWREN_REG_NUM
argument_list|,
operator|&
name|rxcal_locwren_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN_REG_NUM
argument_list|,
operator|&
name|rxcalroamyadjust_locwren_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXLOCK2REF_OVREN_REG_NUM
argument_list|,
operator|&
name|rxlock2ref_ovren_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_X_Y_VALWEIGHT_REG_NUM
argument_list|,
operator|&
name|rxcaleyediagfsm_x_y_valweight_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALCOARSE_REG_NUM
argument_list|,
operator|&
name|rxcaleyediagfsm_xvalcoarse_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALFINE_REG_NUM
argument_list|,
operator|&
name|rxcaleyediagfsm_xvalfine_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALCOARSE_REG_NUM
argument_list|,
operator|&
name|rxcaleyediagfsm_yvalcoarse_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALFINE_REG_NUM
argument_list|,
operator|&
name|rxcaleyediagfsm_yvalfine_val
argument_list|)
expr_stmt|;
comment|/* 	 * Clear Bit: 	 *	SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_LOCWREN 	 *	to override RxEQ via PMA 	 * Set Bits: 	 *	SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN, 	 *	SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN 	 *	to keep Eye Diag Roam controlled internally 	 */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCAL_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_LOCWREN
operator||
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN
operator||
name|SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMEYEMEASIN_LOCWREN
operator||
name|SERDES_IREG_FLD_RXCALROAMXADJUST_LOCWREN
argument_list|)
expr_stmt|;
comment|/* 	 * Set Bit: 	 *	 SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN 	 *	 to keep Eye Diag Roam controlled internally 	 */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN
argument_list|)
expr_stmt|;
comment|/* 	 * Clear Bit: 	 *	SERDES_IREG_FLD_RXROAM_XORBITSEL, 	 *	so XORBITSEL=0, needed for the Eye mapping 	 *  Set Bit: 	 *  SERDES_IREG_FLD_RXLOCK2REF_OVREN, 	 *  so RXLOCK2REF_OVREN=1, keeping lock to data, preventing data hit 	 */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXROAM_XORBITSEL_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXLOCK2REF_OVREN
operator||
name|SERDES_IREG_FLD_RXROAM_XORBITSEL
argument_list|,
name|SERDES_IREG_FLD_RXLOCK2REF_OVREN
argument_list|)
expr_stmt|;
comment|/* 	 * Clear Bit: 	 *	SERDES_IREG_FLD_RXLOCK2REF_LOCWREN, 	 *	so RXLOCK2REF_LOCWREN=0, to override control 	 */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXLOCK2REF_LOCWREN_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXLOCK2REF_LOCWREN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Width Calculation */
comment|/* Return Value = 0*Y + 1*X */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_X_Y_VALWEIGHT_REG_NUM
argument_list|,
literal|0x01
argument_list|)
expr_stmt|;
comment|/* X coarse scan step = 3 */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALCOARSE_REG_NUM
argument_list|,
literal|0x03
argument_list|)
expr_stmt|;
comment|/* X fine scan step = 1   */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALFINE_REG_NUM
argument_list|,
literal|0x01
argument_list|)
expr_stmt|;
comment|/* Y coarse scan step = 0 */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALCOARSE_REG_NUM
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
comment|/* Y fine scan step = 0   */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALFINE_REG_NUM
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
comment|/* 	 * Set Bit: 	 *	SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START, 	 *	to start Eye measurement 	 */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AL_SERDES_RX_EYE_CAL_TRIES
condition|;
operator|++
name|i
control|)
block|{
comment|/* Check if RxEQ Cal is done */
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_DONE_REG_NUM
argument_list|,
operator|&
name|status
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_DONE
condition|)
break|break;
name|al_msleep
argument_list|(
name|AL_SERDES_RX_EYE_CAL_MDELAY
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|&
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_ERR
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: eye measure error!\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|status
operator|&
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_DONE
operator|)
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: eye measure timeout!\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
comment|/*  Read Eye Opening Metrics, Bits: 	 *	SERDES_IREG_FLD_RXCALEYEDIAGFSM_EYESUM_LSB, 	 *	SERDES_IREG_FLD_RXCALEYEDIAGFSM_EYESUM_LSB 	 */
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_EYESUM_MSB_REG_NUM
argument_list|,
operator|&
name|reg_value
argument_list|)
expr_stmt|;
operator|*
name|width
operator|=
name|reg_value
operator|<<
literal|6
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_EYESUM_LSB_REG_NUM
argument_list|,
operator|&
name|reg_value
argument_list|)
expr_stmt|;
operator|*
name|width
operator|=
operator|+
name|reg_value
operator|&
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_EYESUM_LSB_MAKE
expr_stmt|;
comment|/* 	 * Clear Bit: 	 *	SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START, 	 *	to stop Eye measurement 	 */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Height Calculation */
comment|/* Return Value = 1*Y + 0*X */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_X_Y_VALWEIGHT_REG_NUM
argument_list|,
literal|0x10
argument_list|)
expr_stmt|;
comment|/* X coarse scan step = 0 */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALCOARSE_REG_NUM
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
comment|/* X fine scan step = 0   */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALFINE_REG_NUM
argument_list|,
literal|0x00
argument_list|)
expr_stmt|;
comment|/* Y coarse scan step = 3 */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALCOARSE_REG_NUM
argument_list|,
literal|0x03
argument_list|)
expr_stmt|;
comment|/* Y fine scan step = 1   */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALFINE_REG_NUM
argument_list|,
literal|0x01
argument_list|)
expr_stmt|;
comment|/* 	 * Set Bit: 	 *	SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START, 	 *	to start Eye measurement 	 */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AL_SERDES_RX_EYE_CAL_TRIES
condition|;
operator|++
name|i
control|)
block|{
comment|/* Check if RxEQ Cal is done */
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_DONE_REG_NUM
argument_list|,
operator|&
name|status
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_DONE
condition|)
break|break;
name|al_msleep
argument_list|(
name|AL_SERDES_RX_EYE_CAL_MDELAY
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|&
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_ERR
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: eye measure error!\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|status
operator|&
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_DONE
operator|)
condition|)
block|{
name|al_err
argument_list|(
literal|"%s: eye measure timeout!\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
comment|/*  Read Eye Opening Metrics, Bits: 	 *	SERDES_IREG_FLD_RXCALEYEDIAGFSM_EYESUM_LSB, 	 *	SERDES_IREG_FLD_RXCALEYEDIAGFSM_EYESUM_LSB 	 */
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_EYESUM_MSB_REG_NUM
argument_list|,
operator|&
name|reg_value
argument_list|)
expr_stmt|;
operator|*
name|height
operator|=
name|reg_value
operator|<<
literal|6
expr_stmt|;
name|al_serdes_reg_read
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_EYESUM_LSB_REG_NUM
argument_list|,
operator|&
name|reg_value
argument_list|)
expr_stmt|;
operator|*
name|height
operator|=
operator|+
name|reg_value
operator|&
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_EYESUM_LSB_MAKE
expr_stmt|;
comment|/* 	 * Clear Bit: 	 *	SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START, 	 *	to stop Eye measurement 	 */
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSMIN_START
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Restore Registers */
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_X_Y_VALWEIGHT_REG_NUM
argument_list|,
name|rxcaleyediagfsm_x_y_valweight_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALCOARSE_REG_NUM
argument_list|,
name|rxcaleyediagfsm_xvalcoarse_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_XVALFINE_REG_NUM
argument_list|,
name|rxcaleyediagfsm_xvalfine_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALCOARSE_REG_NUM
argument_list|,
name|rxcaleyediagfsm_yvalcoarse_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALEYEDIAGFSM_YVALFINE_REG_NUM
argument_list|,
name|rxcaleyediagfsm_yvalfine_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXLOCK2REF_LOCWREN_REG_NUM
argument_list|,
name|rxlock2ref_locwren_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCAL_LOCWREN_REG_NUM
argument_list|,
name|rxcal_locwren_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXCALROAMYADJUST_LOCWREN_REG_NUM
argument_list|,
name|rxcalroamyadjust_locwren_val
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
operator|(
expr|enum
name|al_serdes_reg_page
operator|)
name|lane
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXLOCK2REF_OVREN_REG_NUM
argument_list|,
name|rxlock2ref_ovren_val
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|al_serdes_sris_config
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|void
modifier|*
name|sris_params
parameter_list|)
block|{
name|struct
name|al_serdes_sris_params
modifier|*
name|params
init|=
name|sris_params
decl_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PPMDRIFTCOUNT1_REG_NUM
argument_list|,
operator|(
name|params
operator|->
name|ppm_drift_count
operator|&
name|AL_FIELD_MASK
argument_list|(
literal|7
argument_list|,
literal|0
argument_list|)
operator|)
operator|>>
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PPMDRIFTCOUNT2_REG_NUM
argument_list|,
operator|(
name|params
operator|->
name|ppm_drift_count
operator|&
name|AL_FIELD_MASK
argument_list|(
literal|15
argument_list|,
literal|8
argument_list|)
operator|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PPMDRIFTMAX1_REG_NUM
argument_list|,
operator|(
name|params
operator|->
name|ppm_drift_max
operator|&
name|AL_FIELD_MASK
argument_list|(
literal|7
argument_list|,
literal|0
argument_list|)
operator|)
operator|>>
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_PPMDRIFTMAX2_REG_NUM
argument_list|,
operator|(
name|params
operator|->
name|ppm_drift_max
operator|&
name|AL_FIELD_MASK
argument_list|(
literal|15
argument_list|,
literal|8
argument_list|)
operator|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_SYNTHPPMDRIFTMAX1_REG_NUM
argument_list|,
operator|(
name|params
operator|->
name|synth_ppm_drift_max
operator|&
name|AL_FIELD_MASK
argument_list|(
literal|7
argument_list|,
literal|0
argument_list|)
operator|)
operator|>>
literal|0
argument_list|)
expr_stmt|;
name|al_serdes_reg_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_SYNTHPPMDRIFTMAX2_REG_NUM
argument_list|,
operator|(
name|params
operator|->
name|synth_ppm_drift_max
operator|&
name|AL_FIELD_MASK
argument_list|(
literal|15
argument_list|,
literal|8
argument_list|)
operator|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PCS
argument_list|,
name|SERDES_IREG_FLD_PCS_EBUF_FULL_D2R1_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCS_EBUF_FULL_D2R1_REG_MASK
argument_list|,
operator|(
name|params
operator|->
name|full_d2r1
operator|)
operator|<<
name|SERDES_IREG_FLD_PCS_EBUF_FULL_D2R1_REG_SHIFT
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PCS
argument_list|,
name|SERDES_IREG_FLD_PCS_EBUF_FULL_PCIE_G3_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCS_EBUF_FULL_PCIE_G3_REG_MASK
argument_list|,
operator|(
name|params
operator|->
name|full_pcie_g3
operator|)
operator|<<
name|SERDES_IREG_FLD_PCS_EBUF_FULL_PCIE_G3_REG_SHIFT
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PCS
argument_list|,
name|SERDES_IREG_FLD_PCS_EBUF_RD_THRESHOLD_D2R1_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCS_EBUF_RD_THRESHOLD_D2R1_REG_MASK
argument_list|,
operator|(
name|params
operator|->
name|rd_threshold_d2r1
operator|)
operator|<<
name|SERDES_IREG_FLD_PCS_EBUF_RD_THRESHOLD_D2R1_REG_SHIFT
argument_list|)
expr_stmt|;
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PCS
argument_list|,
name|SERDES_IREG_FLD_PCS_EBUF_RD_THRESHOLD_PCIE_G3_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_PCS_EBUF_RD_THRESHOLD_PCIE_G3_REG_MASK
argument_list|,
operator|(
name|params
operator|->
name|rd_threshold_pcie_g3
operator|)
operator|<<
name|SERDES_IREG_FLD_PCS_EBUF_RD_THRESHOLD_PCIE_G3_REG_SHIFT
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|al_serdes_dcgain_set
parameter_list|(
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|,
name|uint8_t
name|dcgain
parameter_list|)
block|{
name|al_serdes_grp_reg_masked_write
argument_list|(
name|obj
argument_list|,
name|AL_SRDS_REG_PAGE_4_COMMON
argument_list|,
name|AL_SRDS_REG_TYPE_PMA
argument_list|,
name|SERDES_IREG_FLD_RXEQ_DCGAIN_LUP0_REG_NUM
argument_list|,
name|SERDES_IREG_FLD_RXEQ_DCGAIN_LUP0_MASK
argument_list|,
operator|(
name|dcgain
operator|<<
name|SERDES_IREG_FLD_RXEQ_DCGAIN_LUP0_SHIFT
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************/
end_comment

begin_function
name|int
name|al_serdes_hssp_handle_init
parameter_list|(
name|void
name|__iomem
modifier|*
name|serdes_regs_base
parameter_list|,
name|struct
name|al_serdes_grp_obj
modifier|*
name|obj
parameter_list|)
block|{
name|al_dbg
argument_list|(
literal|"%s(%p, %p)\n"
argument_list|,
name|__func__
argument_list|,
name|serdes_regs_base
argument_list|,
name|obj
argument_list|)
expr_stmt|;
name|al_memset
argument_list|(
name|obj
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|al_serdes_grp_obj
argument_list|)
argument_list|)
expr_stmt|;
name|obj
operator|->
name|regs_base
operator|=
operator|(
expr|struct
name|al_serdes_regs
operator|*
operator|)
name|serdes_regs_base
expr_stmt|;
name|obj
operator|->
name|type_get
operator|=
name|al_serdes_hssp_type_get
expr_stmt|;
name|obj
operator|->
name|reg_read
operator|=
name|al_serdes_reg_read
expr_stmt|;
name|obj
operator|->
name|reg_write
operator|=
name|al_serdes_reg_write
expr_stmt|;
name|obj
operator|->
name|bist_overrides_enable
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_bist_overrides_enable
argument_list|)
expr_stmt|;
name|obj
operator|->
name|bist_overrides_disable
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_bist_overrides_disable
argument_list|)
expr_stmt|;
name|obj
operator|->
name|rx_rate_change
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_rx_rate_change
argument_list|)
expr_stmt|;
name|obj
operator|->
name|rx_rate_change_sw_flow_en
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_lane_rx_rate_change_sw_flow_en
argument_list|)
expr_stmt|;
name|obj
operator|->
name|rx_rate_change_sw_flow_dis
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_lane_rx_rate_change_sw_flow_dis
argument_list|)
expr_stmt|;
name|obj
operator|->
name|pcie_rate_override_is_enabled
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_lane_pcie_rate_override_is_enabled
argument_list|)
expr_stmt|;
name|obj
operator|->
name|pcie_rate_override_enable_set
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_lane_pcie_rate_override_enable_set
argument_list|)
expr_stmt|;
name|obj
operator|->
name|pcie_rate_get
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_lane_pcie_rate_get
argument_list|)
expr_stmt|;
name|obj
operator|->
name|pcie_rate_set
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_lane_pcie_rate_set
argument_list|)
expr_stmt|;
name|obj
operator|->
name|group_pm_set
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_group_pm_set
argument_list|)
expr_stmt|;
name|obj
operator|->
name|lane_pm_set
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_lane_pm_set
argument_list|)
expr_stmt|;
name|obj
operator|->
name|pma_hard_reset_group
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_pma_hard_reset_group
argument_list|)
expr_stmt|;
name|obj
operator|->
name|pma_hard_reset_lane
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_pma_hard_reset_lane
argument_list|)
expr_stmt|;
name|obj
operator|->
name|loopback_control
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_loopback_control
argument_list|)
expr_stmt|;
name|obj
operator|->
name|bist_pattern_select
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_bist_pattern_select
argument_list|)
expr_stmt|;
name|obj
operator|->
name|bist_tx_enable
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_bist_tx_enable
argument_list|)
expr_stmt|;
name|obj
operator|->
name|bist_tx_err_inject
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_bist_tx_err_inject
argument_list|)
expr_stmt|;
name|obj
operator|->
name|bist_rx_enable
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_bist_rx_enable
argument_list|)
expr_stmt|;
name|obj
operator|->
name|bist_rx_status
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_bist_rx_status
argument_list|)
expr_stmt|;
name|obj
operator|->
name|tx_deemph_preset
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_tx_deemph_preset
argument_list|)
expr_stmt|;
name|obj
operator|->
name|tx_deemph_inc
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_tx_deemph_inc
argument_list|)
expr_stmt|;
name|obj
operator|->
name|tx_deemph_dec
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_tx_deemph_dec
argument_list|)
expr_stmt|;
name|obj
operator|->
name|eye_measure_run
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_eye_measure_run
argument_list|)
expr_stmt|;
name|obj
operator|->
name|eye_diag_sample
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_eye_diag_sample
argument_list|)
expr_stmt|;
name|obj
operator|->
name|signal_is_detected
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_signal_is_detected
argument_list|)
expr_stmt|;
name|obj
operator|->
name|tx_advanced_params_set
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_tx_advanced_params_set
argument_list|)
expr_stmt|;
name|obj
operator|->
name|tx_advanced_params_get
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_tx_advanced_params_get
argument_list|)
expr_stmt|;
name|obj
operator|->
name|rx_advanced_params_set
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_rx_advanced_params_set
argument_list|)
expr_stmt|;
name|obj
operator|->
name|rx_advanced_params_get
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_rx_advanced_params_get
argument_list|)
expr_stmt|;
name|obj
operator|->
name|mode_set_sgmii
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_mode_set_sgmii
argument_list|)
expr_stmt|;
name|obj
operator|->
name|mode_set_kr
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_mode_set_kr
argument_list|)
expr_stmt|;
name|obj
operator|->
name|rx_equalization
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_rx_equalization
argument_list|)
expr_stmt|;
name|obj
operator|->
name|calc_eye_size
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_calc_eye_size
argument_list|)
expr_stmt|;
name|obj
operator|->
name|sris_config
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_sris_config
argument_list|)
expr_stmt|;
name|obj
operator|->
name|dcgain_set
operator|=
name|AL_SRDS_ADV_SRVC
argument_list|(
name|al_serdes_dcgain_set
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

