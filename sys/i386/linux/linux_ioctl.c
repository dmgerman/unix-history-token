begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 1994-1995 SÃ¸ren Schmidt  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer  *    in this position and unchanged.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. The name of the author may not be used to endorse or promote products  *    derived from this software withough specific prior written permission  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<i386/linux/linux.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/proc.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl_compat.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_include
include|#
directive|include
file|<sys/filedesc.h>
end_include

begin_include
include|#
directive|include
file|<sys/tty.h>
end_include

begin_include
include|#
directive|include
file|<sys/termios.h>
end_include

begin_include
include|#
directive|include
file|<machine/console.h>
end_include

begin_struct
struct|struct
name|linux_termios
block|{
name|unsigned
name|long
name|c_iflag
decl_stmt|;
name|unsigned
name|long
name|c_oflag
decl_stmt|;
name|unsigned
name|long
name|c_cflag
decl_stmt|;
name|unsigned
name|long
name|c_lflag
decl_stmt|;
name|unsigned
name|char
name|c_line
decl_stmt|;
name|unsigned
name|char
name|c_cc
index|[
name|LINUX_NCCS
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|linux_winsize
block|{
name|unsigned
name|short
name|ws_row
decl_stmt|,
name|ws_col
decl_stmt|;
name|unsigned
name|short
name|ws_xpixel
decl_stmt|,
name|ws_ypixel
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|struct
name|speedtab
name|sptab
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|50
block|,
literal|1
block|}
block|,
block|{
literal|75
block|,
literal|2
block|}
block|,
block|{
literal|110
block|,
literal|3
block|}
block|,
block|{
literal|134
block|,
literal|4
block|}
block|,
block|{
literal|135
block|,
literal|4
block|}
block|,
block|{
literal|150
block|,
literal|5
block|}
block|,
block|{
literal|200
block|,
literal|6
block|}
block|,
block|{
literal|300
block|,
literal|7
block|}
block|,
block|{
literal|600
block|,
literal|8
block|}
block|,
block|{
literal|1200
block|,
literal|9
block|}
block|,
block|{
literal|1800
block|,
literal|10
block|}
block|,
block|{
literal|2400
block|,
literal|11
block|}
block|,
block|{
literal|4800
block|,
literal|12
block|}
block|,
block|{
literal|9600
block|,
literal|13
block|}
block|,
block|{
literal|19200
block|,
literal|14
block|}
block|,
block|{
literal|38400
block|,
literal|15
block|}
block|,
block|{
literal|57600
block|,
literal|4097
block|}
block|,
block|{
literal|115200
block|,
literal|4098
block|}
block|,
block|{
operator|-
literal|1
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|linux_to_bsd_speed
parameter_list|(
name|int
name|code
parameter_list|,
name|struct
name|speedtab
modifier|*
name|table
parameter_list|)
block|{
for|for
control|(
init|;
name|table
operator|->
name|sp_code
operator|!=
operator|-
literal|1
condition|;
name|table
operator|++
control|)
if|if
condition|(
name|table
operator|->
name|sp_code
operator|==
name|code
condition|)
return|return
operator|(
name|table
operator|->
name|sp_speed
operator|)
return|;
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|bsd_to_linux_speed
parameter_list|(
name|int
name|speed
parameter_list|,
name|struct
name|speedtab
modifier|*
name|table
parameter_list|)
block|{
for|for
control|(
init|;
name|table
operator|->
name|sp_speed
operator|!=
operator|-
literal|1
condition|;
name|table
operator|++
control|)
if|if
condition|(
name|table
operator|->
name|sp_speed
operator|==
name|speed
condition|)
return|return
operator|(
name|table
operator|->
name|sp_code
operator|)
return|;
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|bsd_to_linux_termios
parameter_list|(
name|struct
name|termios
modifier|*
name|bsd_termios
parameter_list|,
name|struct
name|linux_termios
modifier|*
name|linux_termios
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|speed
decl_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|printf
argument_list|(
literal|"LINUX: BSD termios structure (input):\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"i=%08x o=%08x c=%08x l=%08x ispeed=%d ospeed=%d\n"
argument_list|,
name|bsd_termios
operator|->
name|c_iflag
argument_list|,
name|bsd_termios
operator|->
name|c_oflag
argument_list|,
name|bsd_termios
operator|->
name|c_cflag
argument_list|,
name|bsd_termios
operator|->
name|c_lflag
argument_list|,
name|bsd_termios
operator|->
name|c_ispeed
argument_list|,
name|bsd_termios
operator|->
name|c_ospeed
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"c_cc "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NCCS
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%02x "
argument_list|,
name|bsd_termios
operator|->
name|c_cc
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|linux_termios
operator|->
name|c_iflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|IGNBRK
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_IGNBRK
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|BRKINT
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_BRKINT
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|IGNPAR
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_IGNPAR
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|PARMRK
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_PARMRK
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|INPCK
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_INPCK
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|ISTRIP
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_ISTRIP
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|INLCR
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_INLCR
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|IGNCR
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_IGNCR
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|ICRNL
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_ICRNL
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|IXON
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_IXANY
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|IXON
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_IXON
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|IXOFF
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_IXOFF
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_iflag
operator|&
name|IMAXBEL
condition|)
name|linux_termios
operator|->
name|c_iflag
operator||=
name|LINUX_IMAXBEL
expr_stmt|;
name|linux_termios
operator|->
name|c_oflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_oflag
operator|&
name|OPOST
condition|)
name|linux_termios
operator|->
name|c_oflag
operator||=
name|LINUX_OPOST
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_oflag
operator|&
name|ONLCR
condition|)
name|linux_termios
operator|->
name|c_oflag
operator||=
name|LINUX_ONLCR
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_oflag
operator|&
name|OXTABS
condition|)
name|linux_termios
operator|->
name|c_oflag
operator||=
name|LINUX_XTABS
expr_stmt|;
name|linux_termios
operator|->
name|c_cflag
operator|=
name|bsd_to_linux_speed
argument_list|(
name|bsd_termios
operator|->
name|c_ispeed
argument_list|,
name|sptab
argument_list|)
expr_stmt|;
name|linux_termios
operator|->
name|c_cflag
operator||=
operator|(
name|bsd_termios
operator|->
name|c_cflag
operator|&
name|CSIZE
operator|)
operator|>>
literal|4
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_cflag
operator|&
name|CSTOPB
condition|)
name|linux_termios
operator|->
name|c_cflag
operator||=
name|LINUX_CSTOPB
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_cflag
operator|&
name|CREAD
condition|)
name|linux_termios
operator|->
name|c_cflag
operator||=
name|LINUX_CREAD
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_cflag
operator|&
name|PARENB
condition|)
name|linux_termios
operator|->
name|c_cflag
operator||=
name|LINUX_PARENB
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_cflag
operator|&
name|PARODD
condition|)
name|linux_termios
operator|->
name|c_cflag
operator||=
name|LINUX_PARODD
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_cflag
operator|&
name|HUPCL
condition|)
name|linux_termios
operator|->
name|c_cflag
operator||=
name|LINUX_HUPCL
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_cflag
operator|&
name|CLOCAL
condition|)
name|linux_termios
operator|->
name|c_cflag
operator||=
name|LINUX_CLOCAL
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_cflag
operator|&
name|CRTSCTS
condition|)
name|linux_termios
operator|->
name|c_cflag
operator||=
name|LINUX_CRTSCTS
expr_stmt|;
name|linux_termios
operator|->
name|c_lflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|ISIG
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_ISIG
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|ICANON
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_ICANON
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|ECHO
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_ECHO
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|ECHOE
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_ECHOE
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|ECHOK
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_ECHOK
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|ECHONL
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_ECHONL
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|NOFLSH
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_NOFLSH
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|TOSTOP
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_TOSTOP
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|ECHOCTL
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_ECHOCTL
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|ECHOPRT
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_ECHOPRT
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|ECHOKE
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_ECHOKE
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|FLUSHO
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_FLUSHO
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|PENDIN
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_PENDIN
expr_stmt|;
if|if
condition|(
name|bsd_termios
operator|->
name|c_lflag
operator|&
name|IEXTEN
condition|)
name|linux_termios
operator|->
name|c_lflag
operator||=
name|LINUX_IEXTEN
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|LINUX_NCCS
condition|;
name|i
operator|++
control|)
name|linux_termios
operator|->
name|c_cc
index|[
name|i
index|]
operator|=
name|_POSIX_VDISABLE
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VINTR
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VINTR
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VQUIT
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VQUIT
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VERASE
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VERASE
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VKILL
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VKILL
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VEOF
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VEOF
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VEOL
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VEOL
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VMIN
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VMIN
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VTIME
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VTIME
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VEOL2
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VEOL2
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VSWTC
index|]
operator|=
name|_POSIX_VDISABLE
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VSUSP
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VSUSP
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VSTART
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VSTART
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VSTOP
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VSTOP
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VREPRINT
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VREPRINT
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VDISCARD
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VDISCARD
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VWERASE
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VWERASE
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VLNEXT
index|]
operator|=
name|bsd_termios
operator|->
name|c_cc
index|[
name|VLNEXT
index|]
expr_stmt|;
name|linux_termios
operator|->
name|c_line
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|printf
argument_list|(
literal|"LINUX: LINUX termios structure (output):\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"i=%08x o=%08x c=%08x l=%08x line=%d\n"
argument_list|,
name|linux_termios
operator|->
name|c_iflag
argument_list|,
name|linux_termios
operator|->
name|c_oflag
argument_list|,
name|linux_termios
operator|->
name|c_cflag
argument_list|,
name|linux_termios
operator|->
name|c_lflag
argument_list|,
name|linux_termios
operator|->
name|c_line
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"c_cc "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|LINUX_NCCS
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%02x "
argument_list|,
name|linux_termios
operator|->
name|c_cc
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|void
name|linux_to_bsd_termios
parameter_list|(
name|struct
name|linux_termios
modifier|*
name|linux_termios
parameter_list|,
name|struct
name|termios
modifier|*
name|bsd_termios
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|speed
decl_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|printf
argument_list|(
literal|"LINUX: LINUX termios structure (input):\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"i=%08x o=%08x c=%08x l=%08x line=%d\n"
argument_list|,
name|linux_termios
operator|->
name|c_iflag
argument_list|,
name|linux_termios
operator|->
name|c_oflag
argument_list|,
name|linux_termios
operator|->
name|c_cflag
argument_list|,
name|linux_termios
operator|->
name|c_lflag
argument_list|,
name|linux_termios
operator|->
name|c_line
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"c_cc "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|LINUX_NCCS
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%02x "
argument_list|,
name|linux_termios
operator|->
name|c_cc
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|bsd_termios
operator|->
name|c_iflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_IGNBRK
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|IGNBRK
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_BRKINT
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|BRKINT
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_IGNPAR
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|IGNPAR
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_PARMRK
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|PARMRK
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_INPCK
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|INPCK
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_ISTRIP
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|ISTRIP
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_INLCR
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|INLCR
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_IGNCR
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|IGNCR
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_ICRNL
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|ICRNL
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_IXON
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|IXANY
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_IXON
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|IXON
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_IXOFF
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|IXOFF
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_iflag
operator|&
name|LINUX_IMAXBEL
condition|)
name|bsd_termios
operator|->
name|c_iflag
operator||=
name|IMAXBEL
expr_stmt|;
name|bsd_termios
operator|->
name|c_oflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_oflag
operator|&
name|LINUX_OPOST
condition|)
name|bsd_termios
operator|->
name|c_oflag
operator||=
name|OPOST
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_oflag
operator|&
name|LINUX_ONLCR
condition|)
name|bsd_termios
operator|->
name|c_oflag
operator||=
name|ONLCR
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_oflag
operator|&
name|LINUX_XTABS
condition|)
name|bsd_termios
operator|->
name|c_oflag
operator||=
name|OXTABS
expr_stmt|;
name|bsd_termios
operator|->
name|c_cflag
operator|=
operator|(
name|linux_termios
operator|->
name|c_cflag
operator|&
name|LINUX_CSIZE
operator|)
operator|<<
literal|4
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_cflag
operator|&
name|LINUX_CSTOPB
condition|)
name|bsd_termios
operator|->
name|c_cflag
operator||=
name|CSTOPB
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_cflag
operator|&
name|LINUX_PARENB
condition|)
name|bsd_termios
operator|->
name|c_cflag
operator||=
name|PARENB
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_cflag
operator|&
name|LINUX_PARODD
condition|)
name|bsd_termios
operator|->
name|c_cflag
operator||=
name|PARODD
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_cflag
operator|&
name|LINUX_HUPCL
condition|)
name|bsd_termios
operator|->
name|c_cflag
operator||=
name|HUPCL
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_cflag
operator|&
name|LINUX_CLOCAL
condition|)
name|bsd_termios
operator|->
name|c_cflag
operator||=
name|CLOCAL
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_cflag
operator|&
name|LINUX_CRTSCTS
condition|)
name|bsd_termios
operator|->
name|c_cflag
operator||=
name|CRTSCTS
expr_stmt|;
name|bsd_termios
operator|->
name|c_lflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_ISIG
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|ISIG
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_ICANON
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|ICANON
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_ECHO
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|ECHO
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_ECHOE
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|ECHOE
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_ECHOK
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|ECHOK
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_ECHONL
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|ECHONL
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_NOFLSH
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|NOFLSH
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_TOSTOP
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|TOSTOP
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_ECHOCTL
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|ECHOCTL
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_ECHOPRT
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|ECHOPRT
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_ECHOKE
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|ECHOKE
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_FLUSHO
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|FLUSHO
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|LINUX_PENDIN
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|PENDIN
expr_stmt|;
if|if
condition|(
name|linux_termios
operator|->
name|c_lflag
operator|&
name|IEXTEN
condition|)
name|bsd_termios
operator|->
name|c_lflag
operator||=
name|IEXTEN
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NCCS
condition|;
name|i
operator|++
control|)
name|bsd_termios
operator|->
name|c_cc
index|[
name|i
index|]
operator|=
name|_POSIX_VDISABLE
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VINTR
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VINTR
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VQUIT
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VQUIT
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VERASE
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VERASE
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VKILL
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VKILL
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VEOF
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VEOF
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VEOL
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VEOL
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VMIN
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VMIN
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VTIME
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VTIME
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VEOL2
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VEOL2
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VSUSP
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VSUSP
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VSTART
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VSTART
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VSTOP
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VSTOP
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VREPRINT
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VREPRINT
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VDISCARD
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VDISCARD
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VWERASE
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VWERASE
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_cc
index|[
name|VLNEXT
index|]
operator|=
name|linux_termios
operator|->
name|c_cc
index|[
name|LINUX_VLNEXT
index|]
expr_stmt|;
name|bsd_termios
operator|->
name|c_ispeed
operator|=
name|bsd_termios
operator|->
name|c_ospeed
operator|=
name|linux_to_bsd_speed
argument_list|(
name|linux_termios
operator|->
name|c_cflag
operator|&
name|LINUX_CBAUD
argument_list|,
name|sptab
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|printf
argument_list|(
literal|"LINUX: BSD termios structure (output):\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"i=%08x o=%08x c=%08x l=%08x ispeed=%d ospeed=%d\n"
argument_list|,
name|bsd_termios
operator|->
name|c_iflag
argument_list|,
name|bsd_termios
operator|->
name|c_oflag
argument_list|,
name|bsd_termios
operator|->
name|c_cflag
argument_list|,
name|bsd_termios
operator|->
name|c_lflag
argument_list|,
name|bsd_termios
operator|->
name|c_ispeed
argument_list|,
name|bsd_termios
operator|->
name|c_ospeed
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"c_cc "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NCCS
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%02x "
argument_list|,
name|bsd_termios
operator|->
name|c_cc
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_struct
struct|struct
name|linux_ioctl_args
block|{
name|int
name|fd
decl_stmt|;
name|int
name|cmd
decl_stmt|;
name|int
name|arg
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|linux_ioctl
parameter_list|(
name|struct
name|proc
modifier|*
name|p
parameter_list|,
name|struct
name|linux_ioctl_args
modifier|*
name|args
parameter_list|,
name|int
modifier|*
name|retval
parameter_list|)
block|{
name|struct
name|termios
name|bsd_termios
decl_stmt|;
name|struct
name|winsize
name|bsd_winsize
decl_stmt|;
name|struct
name|linux_termios
name|linux_termios
decl_stmt|;
name|struct
name|linux_winsize
name|linux_winsize
decl_stmt|;
name|struct
name|filedesc
modifier|*
name|fdp
init|=
name|p
operator|->
name|p_fd
decl_stmt|;
name|struct
name|file
modifier|*
name|fp
decl_stmt|;
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|()
function_decl|;
name|int
name|bsd_line
decl_stmt|,
name|linux_line
decl_stmt|;
name|int
name|error
decl_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|printf
argument_list|(
literal|"Linux-emul(%d): ioctl(%d, %04x, *)\n"
argument_list|,
name|p
operator|->
name|p_pid
argument_list|,
name|args
operator|->
name|fd
argument_list|,
name|args
operator|->
name|cmd
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|(
name|unsigned
operator|)
name|args
operator|->
name|fd
operator|>=
name|fdp
operator|->
name|fd_nfiles
operator|||
operator|(
name|fp
operator|=
name|fdp
operator|->
name|fd_ofiles
index|[
name|args
operator|->
name|fd
index|]
operator|)
operator|==
literal|0
condition|)
return|return
name|EBADF
return|;
if|if
condition|(
operator|!
name|fp
operator|||
operator|(
name|fp
operator|->
name|f_flag
operator|&
operator|(
name|FREAD
operator||
name|FWRITE
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
return|return
name|EBADF
return|;
block|}
name|func
operator|=
name|fp
operator|->
name|f_ops
operator|->
name|fo_ioctl
expr_stmt|;
switch|switch
condition|(
name|args
operator|->
name|cmd
condition|)
block|{
case|case
name|LINUX_TCGETS
case|:
if|if
condition|(
operator|(
name|error
operator|=
call|(
modifier|*
name|func
call|)
argument_list|(
name|fp
argument_list|,
name|TIOCGETA
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|bsd_termios
argument_list|,
name|p
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
name|error
return|;
name|bsd_to_linux_termios
argument_list|(
operator|&
name|bsd_termios
argument_list|,
operator|&
name|linux_termios
argument_list|)
expr_stmt|;
return|return
name|copyout
argument_list|(
operator|(
name|caddr_t
operator|)
operator|&
name|linux_termios
argument_list|,
operator|(
name|caddr_t
operator|)
name|args
operator|->
name|arg
argument_list|,
sizeof|sizeof
argument_list|(
name|linux_termios
argument_list|)
argument_list|)
return|;
case|case
name|LINUX_TCSETS
case|:
name|linux_to_bsd_termios
argument_list|(
operator|(
expr|struct
name|linux_termios
operator|*
operator|)
name|args
operator|->
name|arg
argument_list|,
operator|&
name|bsd_termios
argument_list|)
expr_stmt|;
return|return
call|(
modifier|*
name|func
call|)
argument_list|(
name|fp
argument_list|,
name|TIOCSETA
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|bsd_termios
argument_list|,
name|p
argument_list|)
return|;
case|case
name|LINUX_TCSETSW
case|:
name|linux_to_bsd_termios
argument_list|(
operator|(
expr|struct
name|linux_termios
operator|*
operator|)
name|args
operator|->
name|arg
argument_list|,
operator|&
name|bsd_termios
argument_list|)
expr_stmt|;
return|return
call|(
modifier|*
name|func
call|)
argument_list|(
name|fp
argument_list|,
name|TIOCSETAW
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|bsd_termios
argument_list|,
name|p
argument_list|)
return|;
case|case
name|LINUX_TCSETSF
case|:
name|linux_to_bsd_termios
argument_list|(
operator|(
expr|struct
name|linux_termios
operator|*
operator|)
name|args
operator|->
name|arg
argument_list|,
operator|&
name|bsd_termios
argument_list|)
expr_stmt|;
return|return
call|(
modifier|*
name|func
call|)
argument_list|(
name|fp
argument_list|,
name|TIOCSETAF
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|bsd_termios
argument_list|,
name|p
argument_list|)
return|;
case|case
name|LINUX_TIOCGPGRP
case|:
name|args
operator|->
name|cmd
operator|=
name|TIOCGPGRP
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_TIOCSPGRP
case|:
name|args
operator|->
name|cmd
operator|=
name|TIOCSPGRP
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_TIOCGWINSZ
case|:
name|args
operator|->
name|cmd
operator|=
name|TIOCGWINSZ
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_TIOCSWINSZ
case|:
name|args
operator|->
name|cmd
operator|=
name|TIOCSWINSZ
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_FIONREAD
case|:
name|args
operator|->
name|cmd
operator|=
name|FIONREAD
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_FIONBIO
case|:
name|args
operator|->
name|cmd
operator|=
name|FIONBIO
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_FIOASYNC
case|:
name|args
operator|->
name|cmd
operator|=
name|FIOASYNC
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_FIONCLEX
case|:
name|args
operator|->
name|cmd
operator|=
name|FIONCLEX
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_FIOCLEX
case|:
name|args
operator|->
name|cmd
operator|=
name|FIOCLEX
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_TIOCEXCL
case|:
name|args
operator|->
name|cmd
operator|=
name|TIOCEXCL
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_TIOCNXCL
case|:
name|args
operator|->
name|cmd
operator|=
name|TIOCNXCL
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_TIOCCONS
case|:
name|args
operator|->
name|cmd
operator|=
name|TIOCCONS
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_TIOCNOTTY
case|:
name|args
operator|->
name|cmd
operator|=
name|TIOCNOTTY
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|p
argument_list|,
name|args
argument_list|,
name|retval
argument_list|)
return|;
case|case
name|LINUX_TIOCSETD
case|:
switch|switch
condition|(
name|args
operator|->
name|arg
condition|)
block|{
case|case
name|LINUX_N_TTY
case|:
name|bsd_line
operator|=
name|TTYDISC
expr_stmt|;
return|return
call|(
modifier|*
name|func
call|)
argument_list|(
name|fp
argument_list|,
name|TIOCSETD
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|bsd_line
argument_list|,
name|p
argument_list|)
return|;
case|case
name|LINUX_N_SLIP
case|:
name|bsd_line
operator|=
name|SLIPDISC
expr_stmt|;
return|return
call|(
modifier|*
name|func
call|)
argument_list|(
name|fp
argument_list|,
name|TIOCSETD
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|bsd_line
argument_list|,
name|p
argument_list|)
return|;
case|case
name|LINUX_N_PPP
case|:
name|bsd_line
operator|=
name|PPPDISC
expr_stmt|;
return|return
call|(
modifier|*
name|func
call|)
argument_list|(
name|fp
argument_list|,
name|TIOCSETD
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|bsd_line
argument_list|,
name|p
argument_list|)
return|;
default|default:
return|return
name|EINVAL
return|;
block|}
break|break;
case|case
name|LINUX_TIOCGETD
case|:
name|bsd_line
operator|=
name|TTYDISC
expr_stmt|;
if|if
condition|(
name|error
operator|=
call|(
modifier|*
name|func
call|)
argument_list|(
name|fp
argument_list|,
name|TIOCSETD
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|bsd_line
argument_list|,
name|p
argument_list|)
condition|)
return|return
name|error
return|;
switch|switch
condition|(
name|bsd_line
condition|)
block|{
case|case
name|TTYDISC
case|:
name|linux_line
operator|=
name|LINUX_N_TTY
expr_stmt|;
break|break;
case|case
name|SLIPDISC
case|:
name|linux_line
operator|=
name|LINUX_N_SLIP
expr_stmt|;
break|break;
case|case
name|PPPDISC
case|:
name|linux_line
operator|=
name|LINUX_N_PPP
expr_stmt|;
break|break;
default|default:
return|return
name|EINVAL
return|;
block|}
return|return
name|copyout
argument_list|(
operator|&
name|linux_line
argument_list|,
operator|(
name|caddr_t
operator|)
name|args
operator|->
name|arg
argument_list|,
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
return|;
block|}
name|uprintf
argument_list|(
literal|"LINUX: 'ioctl' fd=%d, typ=0x%x(%c), num=0x%x not implemented\n"
argument_list|,
name|args
operator|->
name|fd
argument_list|,
operator|(
name|args
operator|->
name|cmd
operator|&
literal|0xffff00
operator|)
operator|>>
literal|8
argument_list|,
operator|(
name|args
operator|->
name|cmd
operator|&
literal|0xffff00
operator|)
operator|>>
literal|8
argument_list|,
name|args
operator|->
name|cmd
operator|&
literal|0xff
argument_list|)
expr_stmt|;
return|return
name|EINVAL
return|;
block|}
end_function

end_unit

