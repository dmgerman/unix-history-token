begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * sound/configure.c  - Configuration program for the Linux Sound Driver  *  * Copyright by Hannu Savolainen 1993  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions are  * met: 1. Redistributions of source code must retain the above copyright  * notice, this list of conditions and the following disclaimer. 2.  * Redistributions in binary form must reproduce the above copyright notice,  * this list of conditions and the following disclaimer in the documentation  * and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND ANY  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE  * DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR  * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR  * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER  * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_define
define|#
directive|define
name|B
parameter_list|(
name|x
parameter_list|)
value|(1<< (x))
end_define

begin_comment
comment|/*  * Option numbers  */
end_comment

begin_define
define|#
directive|define
name|OPT_PAS
value|0
end_define

begin_define
define|#
directive|define
name|OPT_SB
value|1
end_define

begin_define
define|#
directive|define
name|OPT_ADLIB
value|2
end_define

begin_define
define|#
directive|define
name|OPT_LAST_MUTUAL
value|2
end_define

begin_define
define|#
directive|define
name|OPT_GUS
value|3
end_define

begin_define
define|#
directive|define
name|OPT_MPU401
value|4
end_define

begin_define
define|#
directive|define
name|OPT_UART6850
value|5
end_define

begin_define
define|#
directive|define
name|OPT_PSS
value|6
end_define

begin_define
define|#
directive|define
name|OPT_GUS16
value|7
end_define

begin_define
define|#
directive|define
name|OPT_GUSMAX
value|8
end_define

begin_define
define|#
directive|define
name|OPT_MSS
value|9
end_define

begin_define
define|#
directive|define
name|OPT_HIGHLEVEL
value|10
end_define

begin_comment
comment|/* This must be same than the next one */
end_comment

begin_define
define|#
directive|define
name|OPT_SBPRO
value|10
end_define

begin_define
define|#
directive|define
name|OPT_SB16
value|11
end_define

begin_define
define|#
directive|define
name|OPT_AUDIO
value|12
end_define

begin_define
define|#
directive|define
name|OPT_MIDI_AUTO
value|13
end_define

begin_define
define|#
directive|define
name|OPT_MIDI
value|14
end_define

begin_define
define|#
directive|define
name|OPT_YM3812_AUTO
value|15
end_define

begin_define
define|#
directive|define
name|OPT_YM3812
value|16
end_define

begin_define
define|#
directive|define
name|OPT_SEQUENCER
value|17
end_define

begin_define
define|#
directive|define
name|OPT_LAST
value|17
end_define

begin_comment
comment|/* Must be the same than the defined OPT */
end_comment

begin_define
define|#
directive|define
name|ANY_DEVS
value|(B(OPT_AUDIO)|B(OPT_MIDI)|B(OPT_SEQUENCER)|B(OPT_GUS)| \ 		  B(OPT_MPU401)|B(OPT_PSS)|B(OPT_GUS16)|B(OPT_GUSMAX)|B(OPT_MSS))
end_define

begin_comment
comment|/*  * Options that have been disabled for some reason (incompletely implemented  * and/or tested). Don't remove from this list before looking at file  * experimental.txt for further info.  */
end_comment

begin_define
define|#
directive|define
name|DISABLED_OPTIONS
value|(B(OPT_PSS))
end_define

begin_typedef
typedef|typedef
struct|struct
block|{
name|unsigned
name|long
name|conditions
decl_stmt|;
name|unsigned
name|long
name|exclusive_options
decl_stmt|;
name|char
name|macro
index|[
literal|20
index|]
decl_stmt|;
name|int
name|verify
decl_stmt|;
name|int
name|alias
decl_stmt|;
name|int
name|default_answ
decl_stmt|;
block|}
name|hw_entry
typedef|;
end_typedef

begin_comment
comment|/*  * The rule table for the driver options. The first field defines a set of  * options which must be selected before this entry can be selected. The  * second field is a set of options which are not allowed with this one. If  * the fourth field is zero, the option is selected without asking  * confirmation from the user.  *  * With this version of the rule table it is possible to select just one type of  * hardware.  *  * NOTE!        Keep the following table and the questions array in sync with the  * option numbering!  */
end_comment

begin_decl_stmt
name|hw_entry
name|hw_table
index|[]
init|=
block|{
comment|/*  * 0  */
block|{
literal|0
block|,
literal|0
block|,
literal|"PAS"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|"SB"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
name|B
argument_list|(
name|OPT_PAS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_SB
argument_list|)
block|,
literal|"ADLIB"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|"GUS"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|"MPU401"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|"UART6850"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|"PSS"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|B
argument_list|(
name|OPT_GUS
argument_list|)
block|,
literal|0
block|,
literal|"GUS16"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|B
argument_list|(
name|OPT_GUS
argument_list|)
block|,
name|B
argument_list|(
name|OPT_GUS16
argument_list|)
block|,
literal|"GUSMAX"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|"MSS"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|B
argument_list|(
name|OPT_SB
argument_list|)
block|,
name|B
argument_list|(
name|OPT_PAS
argument_list|)
block|,
literal|"SBPRO"
block|,
literal|1
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
name|B
argument_list|(
name|OPT_SB
argument_list|)
operator||
name|B
argument_list|(
name|OPT_SBPRO
argument_list|)
block|,
name|B
argument_list|(
name|OPT_PAS
argument_list|)
block|,
literal|"SB16"
block|,
literal|1
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
name|B
argument_list|(
name|OPT_PSS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_SB
argument_list|)
operator||
name|B
argument_list|(
name|OPT_PAS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_GUS
argument_list|)
block|,
literal|0
block|,
literal|"AUDIO"
block|,
literal|1
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
name|B
argument_list|(
name|OPT_MPU401
argument_list|)
block|,
literal|0
block|,
literal|"MIDI_AUTO"
block|,
literal|0
block|,
name|OPT_MIDI
block|,
literal|0
block|}
block|,
block|{
name|B
argument_list|(
name|OPT_PSS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_SB
argument_list|)
operator||
name|B
argument_list|(
name|OPT_PAS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_MPU401
argument_list|)
operator||
name|B
argument_list|(
name|OPT_GUS
argument_list|)
block|,
literal|0
block|,
literal|"MIDI"
block|,
literal|1
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
name|B
argument_list|(
name|OPT_ADLIB
argument_list|)
block|,
literal|0
block|,
literal|"YM3812_AUTO"
block|,
literal|0
block|,
name|OPT_YM3812
block|,
literal|0
block|}
block|,
block|{
name|B
argument_list|(
name|OPT_PSS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_SB
argument_list|)
operator||
name|B
argument_list|(
name|OPT_PAS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_ADLIB
argument_list|)
block|,
name|B
argument_list|(
name|OPT_YM3812_AUTO
argument_list|)
block|,
literal|"YM3812"
block|,
literal|1
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
name|B
argument_list|(
name|OPT_MIDI
argument_list|)
operator||
name|B
argument_list|(
name|OPT_YM3812
argument_list|)
operator||
name|B
argument_list|(
name|OPT_YM3812_AUTO
argument_list|)
operator||
name|B
argument_list|(
name|OPT_GUS
argument_list|)
block|,
literal|0
block|,
literal|"SEQUENCER"
block|,
literal|0
block|,
literal|0
block|,
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|questions
index|[]
init|=
block|{
literal|"ProAudioSpectrum 16 support"
block|,
literal|"SoundBlaster support"
block|,
literal|"AdLib support"
block|,
literal|"Gravis Ultrasound support"
block|,
literal|"MPU-401 support (NOT for SB16)"
block|,
literal|"6850 UART Midi support"
block|,
literal|"PSS (ECHO-ADI2111) support"
block|,
literal|"16 bit sampling option of GUS (_NOT_ GUS MAX)"
block|,
literal|"GUS MAX support"
block|,
literal|"Microsoft Sound System support"
block|,
literal|"SoundBlaster Pro support"
block|,
literal|"SoundBlaster 16 support"
block|,
literal|"digitized voice support"
block|,
literal|"This should not be asked"
block|,
literal|"MIDI interface support"
block|,
literal|"This should not be asked"
block|,
literal|"FM synthesizer (YM3812/OPL-3) support"
block|,
literal|"/dev/sequencer support"
block|,
literal|"Should I die"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|long
name|selected_options
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|sb_dma
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|can_select_option
parameter_list|(
name|int
name|nr
parameter_list|)
block|{
switch|switch
condition|(
name|nr
condition|)
block|{
case|case
literal|0
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"The SoundBlaster, AdLib and ProAudioSpectrum\n"
literal|"CARDS cannot be installed at the same time.\n\n"
literal|"However the PAS16 has a SB emulator so you could select"
literal|"the SoundBlaster DRIVER with it.\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"	- ProAudioSpectrum 16\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"	- SoundBlaster / SB Pro\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"          (Could be selected with a PAS16 also)\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"	- AdLib\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nDon't enable SoundBlaster if you have GUS at 0x220!\n\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPT_LAST_MUTUAL
operator|+
literal|1
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nThe following cards should work with any other cards.\n"
literal|"CAUTION! Don't enable MPU-401 if you don't have it.\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPT_HIGHLEVEL
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nSelect one or more of the following options\n"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|hw_table
index|[
name|nr
index|]
operator|.
name|conditions
condition|)
if|if
condition|(
operator|!
operator|(
name|hw_table
index|[
name|nr
index|]
operator|.
name|conditions
operator|&
name|selected_options
operator|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|hw_table
index|[
name|nr
index|]
operator|.
name|exclusive_options
condition|)
if|if
condition|(
name|hw_table
index|[
name|nr
index|]
operator|.
name|exclusive_options
operator|&
name|selected_options
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|DISABLED_OPTIONS
operator|&
name|B
argument_list|(
name|nr
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|think_positively
parameter_list|(
name|int
name|def_answ
parameter_list|)
block|{
name|char
name|answ
index|[
literal|512
index|]
decl_stmt|;
name|int
name|len
decl_stmt|;
if|if
condition|(
operator|(
name|len
operator|=
name|read
argument_list|(
literal|0
argument_list|,
operator|&
name|answ
argument_list|,
sizeof|sizeof
argument_list|(
name|answ
argument_list|)
argument_list|)
operator|)
operator|<
literal|1
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n\nERROR! Cannot read stdin\n"
argument_list|)
expr_stmt|;
name|perror
argument_list|(
literal|"stdin"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#undef CONFIGURE_SOUNDCARD\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#undef KERNEL_SOUNDCARD\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|len
operator|<
literal|2
condition|)
comment|/* 				 * There is an additional LF at the end 				 */
return|return
name|def_answ
return|;
name|answ
index|[
name|len
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|answ
argument_list|,
literal|"y"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|answ
argument_list|,
literal|"Y"
argument_list|)
condition|)
return|return
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|ask_value
parameter_list|(
name|char
modifier|*
name|format
parameter_list|,
name|int
name|default_answer
parameter_list|)
block|{
name|char
name|answ
index|[
literal|512
index|]
decl_stmt|;
name|int
name|len
decl_stmt|,
name|num
decl_stmt|;
name|play_it_again_Sam
label|:
if|if
condition|(
operator|(
name|len
operator|=
name|read
argument_list|(
literal|0
argument_list|,
operator|&
name|answ
argument_list|,
sizeof|sizeof
argument_list|(
name|answ
argument_list|)
argument_list|)
operator|)
operator|<
literal|1
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n\nERROR! Cannot read stdin\n"
argument_list|)
expr_stmt|;
name|perror
argument_list|(
literal|"stdin"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#undef CONFIGURE_SOUNDCARD\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#undef KERNEL_SOUNDCARD\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|len
operator|<
literal|2
condition|)
comment|/* 				 * There is an additional LF at the end 				 */
return|return
name|default_answer
return|;
name|answ
index|[
name|len
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|sscanf
argument_list|(
name|answ
argument_list|,
name|format
argument_list|,
operator|&
name|num
argument_list|)
operator|!=
literal|1
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Illegal format. Try again: "
argument_list|)
expr_stmt|;
goto|goto
name|play_it_again_Sam
goto|;
block|}
return|return
name|num
return|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|num
decl_stmt|,
name|def_size
decl_stmt|,
name|full_driver
init|=
literal|1
decl_stmt|;
name|char
name|answ
index|[
literal|10
index|]
decl_stmt|;
name|printf
argument_list|(
literal|"/*\tGenerated by configure. Don't edit!!!!\t*/\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nConfiguring the sound support\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Do you want to include full version of the sound driver (n/y) ? "
argument_list|)
expr_stmt|;
if|if
condition|(
name|think_positively
argument_list|(
literal|0
argument_list|)
condition|)
block|{
comment|/*  * Select all but some most dangerous cards. These cards are difficult to  * detect reliably or conflict with some other cards (SCSI, Mitsumi)  */
name|selected_options
operator|=
literal|0xffffffff
operator|&
operator|~
operator|(
name|B
argument_list|(
name|OPT_MPU401
argument_list|)
operator||
name|B
argument_list|(
name|OPT_UART6850
argument_list|)
operator||
name|B
argument_list|(
name|OPT_PSS
argument_list|)
operator|)
operator|&
operator|~
name|DISABLED_OPTIONS
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Note! MPU-401, PSS and 6850 UART drivers not enabled\n"
argument_list|)
expr_stmt|;
name|full_driver
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Do you want to DISABLE the Sound Driver (n/y) ?"
argument_list|)
expr_stmt|;
if|if
condition|(
name|think_positively
argument_list|(
literal|0
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"#undef CONFIGURE_SOUNDCARD\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#undef KERNEL_SOUNDCARD\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
comment|/*        * Partial driver        */
name|full_driver
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|OPT_LAST
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|can_select_option
argument_list|(
name|i
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|selected_options
operator|&
name|B
argument_list|(
name|i
argument_list|)
operator|)
condition|)
comment|/* 						 * Not selected yet 						 */
if|if
condition|(
operator|!
name|hw_table
index|[
name|i
index|]
operator|.
name|verify
condition|)
block|{
if|if
condition|(
name|hw_table
index|[
name|i
index|]
operator|.
name|alias
condition|)
name|selected_options
operator||=
name|B
argument_list|(
name|hw_table
index|[
name|i
index|]
operator|.
name|alias
argument_list|)
expr_stmt|;
else|else
name|selected_options
operator||=
name|B
argument_list|(
name|i
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|int
name|def_answ
init|=
name|hw_table
index|[
name|i
index|]
operator|.
name|default_answ
decl_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|def_answ
condition|?
literal|"  %s (y/n) ? "
else|:
literal|"  %s (n/y) ? "
argument_list|,
name|questions
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|think_positively
argument_list|(
name|def_answ
argument_list|)
condition|)
if|if
condition|(
name|hw_table
index|[
name|i
index|]
operator|.
name|alias
condition|)
name|selected_options
operator||=
name|B
argument_list|(
name|hw_table
index|[
name|i
index|]
operator|.
name|alias
argument_list|)
expr_stmt|;
else|else
name|selected_options
operator||=
name|B
argument_list|(
name|i
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_SBPRO
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Do you want support for the mixer of SG NX Pro ? "
argument_list|)
expr_stmt|;
if|if
condition|(
name|think_positively
argument_list|(
literal|0
argument_list|)
condition|)
name|printf
argument_list|(
literal|"#define __SGNXPRO__\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_SB16
argument_list|)
condition|)
name|selected_options
operator||=
name|B
argument_list|(
name|OPT_SBPRO
argument_list|)
expr_stmt|;
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_PSS
argument_list|)
condition|)
block|{
name|genld_again
label|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"if you wish to emulate the soundblaster and you have a DSPxxx.LD.\n"
literal|"then you must include the LD in the kernel.\n"
literal|"(do you wish to include a LD) ? "
argument_list|)
expr_stmt|;
if|if
condition|(
name|think_positively
argument_list|(
literal|0
argument_list|)
condition|)
block|{
name|char
name|path
index|[
literal|512
index|]
decl_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Enter the path to your LD file (pwd is sound): "
argument_list|)
expr_stmt|;
name|scanf
argument_list|(
literal|"%s"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"including LD file %s\n"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|selected_options
operator||=
name|B
argument_list|(
name|OPT_SB
argument_list|)
operator||
name|B
argument_list|(
name|OPT_MPU401
argument_list|)
operator||
name|B
argument_list|(
name|OPT_ADLIB
argument_list|)
expr_stmt|;
comment|/* Gen LD header */
block|{
name|int
name|fd
decl_stmt|;
name|int
name|count
decl_stmt|;
name|char
name|c
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|fd
operator|=
name|open
argument_list|(
name|path
argument_list|,
literal|0
argument_list|)
operator|)
operator|>
literal|0
condition|)
block|{
name|FILE
modifier|*
name|sf
init|=
name|fopen
argument_list|(
literal|"synth-ld.h"
argument_list|,
literal|"w"
argument_list|)
decl_stmt|;
name|fprintf
argument_list|(
name|sf
argument_list|,
literal|"/* automaticaly generated by configure */\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|sf
argument_list|,
literal|"unsigned char pss_synth[] = {\n"
argument_list|)
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|count
operator|=
name|read
argument_list|(
name|fd
argument_list|,
operator|&
name|c
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
name|i
operator|!=
literal|0
operator|&&
operator|(
name|i
operator|%
literal|10
operator|)
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|sf
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|sf
argument_list|,
literal|"0x%02x,"
argument_list|,
name|c
operator|&
literal|0xFFL
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|sf
argument_list|,
literal|"};\n"
literal|"#define pss_synthLen %d\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|sf
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"couldn't open %s as the ld file\n"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"try again with correct path? "
argument_list|)
expr_stmt|;
if|if
condition|(
name|think_positively
argument_list|(
literal|1
argument_list|)
condition|)
goto|goto
name|genld_again
goto|;
block|}
block|}
block|}
else|else
block|{
name|FILE
modifier|*
name|sf
init|=
name|fopen
argument_list|(
literal|"synth-ld.h"
argument_list|,
literal|"w"
argument_list|)
decl_stmt|;
name|fprintf
argument_list|(
name|sf
argument_list|,
literal|"/* automaticaly generated by configure */\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|sf
argument_list|,
literal|"unsigned char pss_synth[1];\n"
literal|"#define pss_synthLen 0\n"
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|sf
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
operator|(
name|selected_options
operator|&
name|ANY_DEVS
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"#undef CONFIGURE_SOUNDCARD\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#undef KERNEL_SOUNDCARD\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n*** This combination is useless. Sound driver disabled!!! ***\n\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"#define KERNEL_SOUNDCARD\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|OPT_LAST
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|hw_table
index|[
name|i
index|]
operator|.
name|alias
condition|)
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|i
argument_list|)
condition|)
name|printf
argument_list|(
literal|"#undef  EXCLUDE_%s\n"
argument_list|,
name|hw_table
index|[
name|i
index|]
operator|.
name|macro
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"#define EXCLUDE_%s\n"
argument_list|,
name|hw_table
index|[
name|i
index|]
operator|.
name|macro
argument_list|)
expr_stmt|;
comment|/*    * IRQ and DMA settings    */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|linux
argument_list|)
if|if
condition|(
operator|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_SB
argument_list|)
operator|)
operator|&&
name|selected_options
operator|&
operator|(
name|B
argument_list|(
name|OPT_AUDIO
argument_list|)
operator||
name|B
argument_list|(
name|OPT_MIDI
argument_list|)
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nI/O base for SB?\n"
literal|"The factory default is 220\n"
literal|"Enter the SB I/O base: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%x"
argument_list|,
literal|0x220
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"SB I/O base set to %03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define SBC_BASE 0x%03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nIRQ number for SoundBlaster?\n"
literal|"The IRQ address is defined by the jumpers on your card.\n"
literal|"The factory default is either 5 or 7 (depending on the model).\n"
literal|"Valid values are 9(=2), 5, 7 and 10.\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|7
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|!=
literal|9
operator|&&
name|num
operator|!=
literal|5
operator|&&
name|num
operator|!=
literal|7
operator|&&
name|num
operator|!=
literal|10
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|7
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"SoundBlaster IRQ set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define SBC_IRQ %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
if|if
condition|(
name|selected_options
operator|&
operator|(
name|B
argument_list|(
name|OPT_SBPRO
argument_list|)
operator||
name|B
argument_list|(
name|OPT_PAS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_PSS
argument_list|)
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nDMA channel for SoundBlaster?\n"
literal|"For SB 1.0, 1.5 and 2.0 this MUST be 1\n"
literal|"SB Pro supports DMA channels 0, 1 and 3 (jumper)\n"
literal|"For SB16 give the 8 bit DMA# here\n"
literal|"The default value is 1\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|<
literal|0
operator|||
name|num
operator|>
literal|3
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|1
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"SoundBlaster DMA set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define SBC_DMA %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|sb_dma
operator|=
name|num
expr_stmt|;
block|}
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_SB16
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n16 bit DMA channel for SoundBlaster 16?\n"
literal|"Possible values are 5, 6 or 7\n"
literal|"The default value is 6\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|num
operator|<
literal|5
operator|||
name|num
operator|>
literal|7
operator|)
operator|&&
operator|(
name|num
operator|!=
name|sb_dma
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|6
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"SoundBlaster DMA set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define SB16_DMA %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nI/O base for SB16 Midi?\n"
literal|"Possible values are 300 and 330\n"
literal|"The factory default is 330\n"
literal|"Enter the SB16 Midi I/O base: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%x"
argument_list|,
literal|0x330
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"SB16 Midi I/O base set to %03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define SB16MIDI_BASE 0x%03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_PAS
argument_list|)
condition|)
block|{
if|if
condition|(
name|selected_options
operator|&
operator|(
name|B
argument_list|(
name|OPT_AUDIO
argument_list|)
operator||
name|B
argument_list|(
name|OPT_MIDI
argument_list|)
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nIRQ number for ProAudioSpectrum?\n"
literal|"The recommended value is the IRQ used under DOS.\n"
literal|"Please refer to the ProAudioSpectrum User's Guide.\n"
literal|"The default value is 10.\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|6
operator|||
name|num
operator|<
literal|3
operator|||
name|num
operator|>
literal|15
operator|||
name|num
operator|==
literal|2
condition|)
comment|/* 								 * Illegal 								 */
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|10
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ProAudioSpectrum IRQ set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define PAS_IRQ %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_AUDIO
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nDMA number for ProAudioSpectrum?\n"
literal|"The recommended value is the DMA channel under DOS.\n"
literal|"Please refer to the ProAudioSpectrum User's Guide.\n"
literal|"The default value is 3\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|4
operator|||
name|num
operator|<
literal|0
operator|||
name|num
operator|>
literal|7
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|3
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nProAudioSpectrum DMA set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define PAS_DMA %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_GUS
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nI/O base for Gravis Ultrasound?\n"
literal|"Valid choices are 210, 220, 230, 240, 250 or 260\n"
literal|"The factory default is 220\n"
literal|"Enter the GUS I/O base: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%x"
argument_list|,
literal|0x220
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|num
operator|>
literal|0x260
operator|)
operator|||
operator|(
operator|(
name|num
operator|&
literal|0xf0f
operator|)
operator|!=
literal|0x200
operator|)
operator|||
operator|(
operator|(
name|num
operator|&
literal|0x0f0
operator|)
operator|>
literal|0x060
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|0x220
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_SB
argument_list|)
operator|)
operator|&&
operator|(
name|num
operator|==
literal|0x220
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"FATAL ERROR!!!!!!!!!!!!!!\n"
literal|"\t0x220 cannot be used if SoundBlaster is enabled.\n"
literal|"\tRun the config again.\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#undef CONFIGURE_SOUNDCARD\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#undef KERNEL_SOUNDCARD\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"GUS I/O base set to %03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define GUS_BASE 0x%03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nIRQ number for Gravis UltraSound?\n"
literal|"The recommended value is the IRQ used under DOS.\n"
literal|"Please refer to the Gravis Ultrasound User's Guide.\n"
literal|"The default value is 15.\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|15
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|6
operator|||
name|num
operator|<
literal|3
operator|||
name|num
operator|>
literal|15
operator|||
name|num
operator|==
literal|2
condition|)
comment|/* 							 * Invalid 							 */
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|15
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Gravis UltraSound IRQ set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define GUS_IRQ %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nDMA number for Gravis UltraSound?\n"
literal|"The recommended value is the DMA channel under DOS.\n"
literal|"Please refer to the Gravis Ultrasound User's Guide.\n"
literal|"The default value is 6\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|4
operator|||
name|num
operator|<
literal|0
operator|||
name|num
operator|>
literal|7
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|6
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nGravis UltraSound DMA set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define GUS_DMA %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_MPU401
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nI/O base for MPU-401?\n"
literal|"The factory default is 330\n"
literal|"Enter the MPU-401 I/O base: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%x"
argument_list|,
literal|0x330
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"MPU-401 I/O base set to %03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define MPU_BASE 0x%03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nIRQ number for MPU-401?\n"
literal|"Valid numbers are: 3, 4, 5, 7 and 9(=2).\n"
literal|"The default value is 9.\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|9
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|6
operator|||
name|num
operator|<
literal|3
operator|||
name|num
operator|>
literal|15
condition|)
comment|/* 						 * Used for floppy 						 */
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|5
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"MPU-401 IRQ set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define MPU_IRQ %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_UART6850
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nI/O base for 6850 UART Midi?\n"
literal|"Be carefull. No defaults.\n"
literal|"Enter the 6850 UART I/O base: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%x"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|0
condition|)
block|{
comment|/*  * Invalid value entered  */
name|printf
argument_list|(
literal|"#define EXCLUDE_UART6850\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"6850 UART I/O base set to %03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define U6850_BASE 0x%03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nIRQ number for 6850 UART?\n"
literal|"Valid numbers are: 3, 4, 5, 7 and 9(=2).\n"
literal|"The default value is 5.\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|5
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|6
operator|||
name|num
operator|<
literal|3
operator|||
name|num
operator|>
literal|15
condition|)
comment|/* 						 * Used for floppy 						 */
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|5
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"6850 UART IRQ set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define U6850_IRQ %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_PSS
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nI/O base for PSS?\n"
literal|"The factory default is 220\n"
literal|"Enter the PSS I/O base: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%x"
argument_list|,
literal|0x220
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"PSS I/O base set to %03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define PSS_BASE 0x%03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nIRQ number for PSS?\n"
literal|"Valid numbers are: 3, 4, 5, 7, 9(=2) or 10.\n"
literal|"The default value is 10.\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|6
operator|||
name|num
operator|<
literal|3
operator|||
name|num
operator|>
literal|15
condition|)
comment|/* Used for floppy */
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|7
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"PSS IRQ set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define PSS_IRQ %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nDMA number for ECHO-PSS?\n"
literal|"The default value is 3\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|4
operator|||
name|num
operator|<
literal|0
operator|||
name|num
operator|>
literal|7
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|3
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nECHO-PSS DMA set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define PSS_DMA %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_MSS
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nI/O base for MSS (MS Sound System)?\n"
literal|"The factory default is 530\n"
literal|"Other possible values are  604, E80 or F40\n"
literal|"Enter the MSS I/O base: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%x"
argument_list|,
literal|0x530
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"MSS I/O base set to %03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define MSS_BASE 0x%03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nIRQ number for MSS?\n"
literal|"Valid numbers are: 7, 9(=2), 10 and 11.\n"
literal|"The default value is 10.\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|6
operator|||
name|num
operator|<
literal|3
operator|||
name|num
operator|>
literal|15
condition|)
comment|/* Used for floppy */
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|7
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"MSS IRQ set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define MSS_IRQ %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nDMA number for MSS?\n"
literal|"Valid values are 1 and 3 (sometimes 0)"
literal|"The default value is 3\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|4
operator|||
name|num
operator|<
literal|0
operator|||
name|num
operator|>
literal|7
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|3
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nMSS DMA set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define MSS_DMA %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_GUS16
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nI/O base for GUS16 (GUS 16 bit sampling option)?\n"
literal|"The factory default is 530\n"
literal|"Other possible values are  604, E80 or F40\n"
literal|"Enter the GUS16 I/O base: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%x"
argument_list|,
literal|0x530
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"GUS16 I/O base set to %03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define GUS16_BASE 0x%03x\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nIRQ number for GUS16?\n"
literal|"Valid numbers are: 3, 4, 5, 7, or 9(=2).\n"
literal|"The default value is 7.\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|7
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|6
operator|||
name|num
operator|<
literal|3
operator|||
name|num
operator|>
literal|15
condition|)
comment|/* Used for floppy */
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|7
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"GUS16 IRQ set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define GUS16_IRQ %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nDMA number for GUS16?\n"
literal|"The default value is 3\n"
literal|"Enter the value: "
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|<
literal|0
operator|||
name|num
operator|>
literal|3
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
literal|3
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nGUS16 DMA set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define GUS16_DMA %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|selected_options
operator|&
name|B
argument_list|(
name|OPT_AUDIO
argument_list|)
condition|)
block|{
name|def_size
operator|=
literal|16384
expr_stmt|;
if|if
condition|(
name|selected_options
operator|&
operator|(
name|B
argument_list|(
name|OPT_SBPRO
argument_list|)
operator||
name|B
argument_list|(
name|OPT_PAS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_SB16
argument_list|)
operator|)
condition|)
name|def_size
operator|=
literal|32768
expr_stmt|;
ifndef|#
directive|ifndef
name|__386BSD__
if|if
condition|(
operator|(
name|selected_options
operator|&
operator|(
name|B
argument_list|(
name|OPT_PAS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_PAS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_GUS16
argument_list|)
operator||
name|B
argument_list|(
name|OPT_GUSMAX
argument_list|)
operator||
name|B
argument_list|(
name|OPT_MSS
argument_list|)
operator||
name|B
argument_list|(
name|OPT_PSS
argument_list|)
operator|)
operator|)
operator|&&
operator|!
name|full_driver
condition|)
name|def_size
operator|=
literal|65536
expr_stmt|;
comment|/* 				 * PAS16 or SB16 				 */
endif|#
directive|endif
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nSelect the DMA buffer size (4096, 16384, 32768 or 65536 bytes)\n"
literal|"%d is recommended value for this configuration.\n"
literal|"Enter the value: "
argument_list|,
name|def_size
argument_list|)
expr_stmt|;
name|num
operator|=
name|ask_value
argument_list|(
literal|"%d"
argument_list|,
name|def_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|!=
literal|4096
operator|&&
name|num
operator|!=
literal|16384
operator|&&
name|num
operator|!=
literal|32768
operator|&&
name|num
operator|!=
literal|65536
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"*** Illegal input! ***\n"
argument_list|)
expr_stmt|;
name|num
operator|=
name|def_size
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"The DMA buffer size set to %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"#define DSP_BUFFSIZE %d\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"#define SELECTED_SOUND_OPTIONS\t0x%08x\n"
argument_list|,
name|selected_options
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"The sound driver is now configured.\n"
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|SCO
argument_list|)
operator|||
name|defined
argument_list|(
name|ISC
argument_list|)
operator|||
name|defined
argument_list|(
name|SYSV
argument_list|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Remember to update the System file\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

