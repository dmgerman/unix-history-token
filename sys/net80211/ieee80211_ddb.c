begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2007-2008 Sam Leffler, Errno Consulting  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|"opt_ddb.h"
end_include

begin_include
include|#
directive|include
file|"opt_wlan.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|DDB
end_ifdef

begin_comment
comment|/*  * IEEE 802.11 DDB support  */
end_comment

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/vimage.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_dl.h>
end_include

begin_include
include|#
directive|include
file|<net/if_media.h>
end_include

begin_include
include|#
directive|include
file|<net/if_types.h>
end_include

begin_include
include|#
directive|include
file|<net/ethernet.h>
end_include

begin_include
include|#
directive|include
file|<net/vnet.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211_var.h>
end_include

begin_include
include|#
directive|include
file|<ddb/ddb.h>
end_include

begin_include
include|#
directive|include
file|<ddb/db_sym.h>
end_include

begin_define
define|#
directive|define
name|IEEE80211_MSG_BITS
define|\
value|"\20\3IOCTL\4WDS\5ACTION\6RATECTL\7ROAM\10INACT\11DOTH\12SUPERG" \ 	"\13WME\14ACL\15WPA\16RADKEYS\17RADDUMP\20RADIUS\21DOT1X\22POWER" \ 	"\23STATE\24OUTPUT\25SCAN\26AUTH\27ASSOC\30NODE\31ELEMID\32XRATE" \ 	"\33INPUT\34CRYPTO\35DUPMPKTS\36DEBUG\3711N"
end_define

begin_define
define|#
directive|define
name|IEEE80211_F_BITS
define|\
value|"\20\1TURBOP\2COMP\3FF\4BURST\5PRIVACY\6PUREG\10SCAN\11ASCAN\12SIBSS" \ 	"\13SHSLOT\14PMGTON\15DESBSSID\16WME\17BGSCAN\20SWRETRY\21TXPOW_FIXED" \ 	"\22IBSSON\23SHPREAMBLE\24DATAPAD\25USEPROT\26USERBARKER\27CSAPENDING" \ 	"\30WPA1\31WPA2\32DROPUNENC\33COUNTERM\34HIDESSID\35NOBRIDG\36PCF" \ 	"\37DOTH\40DWDS"
end_define

begin_define
define|#
directive|define
name|IEEE80211_FEXT_BITS
define|\
value|"\20\1NONHT_PR\2INACT\3SCANWAIT\4BGSCAN\5WPS\6TSN\7SCANREQ\10RESUME" \ 	"\12NONEPR_PR\13SWBMISS\14DFS\15DOTD\22WDSLEGACY\23PROBECHAN\24HT" \ 	"\25AMDPU_TX\26AMPDU_TX\27AMSDU_TX\30AMSDU_RX\31USEHT40\32PUREN" \ 	"\33SHORTGI20\34SHORTGI40\35HTCOMPAT\36RIFS"
end_define

begin_define
define|#
directive|define
name|IEEE80211_FVEN_BITS
value|"\20"
end_define

begin_define
define|#
directive|define
name|IEEE80211_C_BITS
define|\
value|"\20\1STA\7FF\10TURBOP\11IBSS\12PMGT" \ 	"\13HOSTAP\14AHDEMO\15SWRETRY\16TXPMGT\17SHSLOT\20SHPREAMBLE" \ 	"\21MONITOR\22DFS\30WPA1\31WPA2\32BURST\33WME\34WDS\36BGSCAN" \ 	"\37TXFRAG"
end_define

begin_define
define|#
directive|define
name|IEEE80211_C_CRYPTO_BITS
define|\
value|"\20\1WEP\2TKIP\3AES\4AES_CCM\5TKIPMIC\6CKIP\12PMGT"
end_define

begin_define
define|#
directive|define
name|IEEE80211_C_HTCAP_BITS
define|\
value|"\20\1LDPC\2CHWIDTH40\5GREENFIELD\6SHORTGI20\7SHORTGI40\10TXSTBC" \ 	"\21AMPDU\22AMSDU\23HT\24SMPS\25RIFS"
end_define

begin_comment
comment|/* NB: policy bits not included */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_CHAN_BITS
define|\
value|"\20\5TURBO\6CCK\7OFDM\0102GHZ\0115GHZ\12PASSIVE\13DYN\14GFSK" \ 	"\15STURBO\16HALF\17QUARTER\20HT20\21HT40U\22HT40D\23DFS"
end_define

begin_define
define|#
directive|define
name|IEEE80211_NODE_BITS
define|\
value|"\20\1AUTH\2QOS\3ERP\5PWR_MGT\6AREF\7HT\10HTCOMPAT\11WPS\12TSN" \ 	"\13AMPDU_RX\14AMPDU_TX\15MIMO_PS\16MIMO_RTS\17RIFS\20SGI20\21SGI40" \ 	"\22ASSOCID"
end_define

begin_define
define|#
directive|define
name|IEEE80211_ERP_BITS
define|\
value|"\20\1NON_ERP_PRESENT\2USE_PROTECTION\3LONG_PREAMBLE"
end_define

begin_define
define|#
directive|define
name|IEEE80211_CAPINFO_BITS
define|\
value|"\20\1ESS\2IBSS\3CF_POLLABLE\4CF_POLLREQ\5PRIVACY\6SHORT_PREAMBLE" \ 	"\7PBCC\10CHNL_AGILITY\11SPECTRUM_MGMT\13SHORT_SLOTTIME\14RSN" \ 	"\16DSSOFDM"
end_define

begin_define
define|#
directive|define
name|IEEE80211_HTCAP_BITS
define|\
value|"\20\1LDPC\2CHWIDTH40\5GREENFIELD\6SHORTGI20\7SHORTGI40\10TXSTBC" \ 	"\13DELBA\14AMSDU(7935)\15DSSSCCK40\16PSMP\1740INTOLERANT" \ 	"\20LSIGTXOPPROT"
end_define

begin_define
define|#
directive|define
name|IEEE80211_AGGR_BITS
define|\
value|"\20\1IMMEDIATE\2XCHGPEND\3RUNNING\4SETUP\5NAK"
end_define

begin_define
define|#
directive|define
name|DB_PRINTSYM
parameter_list|(
name|prefix
parameter_list|,
name|addr
parameter_list|)
define|\
value|db_printf(prefix " "); \ 	db_printsym((db_addr_t) addr, DB_STGY_ANY); \ 	db_printf("\n");
end_define

begin_function_decl
specifier|static
name|void
name|_db_show_sta
parameter_list|(
specifier|const
name|struct
name|ieee80211_node
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|_db_show_vap
parameter_list|(
specifier|const
name|struct
name|ieee80211vap
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|_db_show_com
parameter_list|(
specifier|const
name|struct
name|ieee80211com
modifier|*
parameter_list|,
name|int
name|showvaps
parameter_list|,
name|int
name|showsta
parameter_list|,
name|int
name|showprocs
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|_db_show_channel
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|struct
name|ieee80211_channel
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|_db_show_ssid
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
name|int
name|ix
parameter_list|,
name|int
name|len
parameter_list|,
specifier|const
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|_db_show_appie
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|struct
name|ieee80211_appie
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|_db_show_key
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
name|int
name|ix
parameter_list|,
specifier|const
name|struct
name|ieee80211_key
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|_db_show_roamparams
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|void
modifier|*
name|arg
parameter_list|,
specifier|const
name|struct
name|ieee80211_roamparam
modifier|*
name|rp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|_db_show_txparams
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|void
modifier|*
name|arg
parameter_list|,
specifier|const
name|struct
name|ieee80211_txparam
modifier|*
name|tp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|_db_show_stats
parameter_list|(
specifier|const
name|struct
name|ieee80211_stats
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_macro
name|DB_SHOW_COMMAND
argument_list|(
argument|sta
argument_list|,
argument|db_show_sta
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
operator|!
name|have_addr
condition|)
block|{
name|db_printf
argument_list|(
literal|"usage: show sta<addr>\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|_db_show_sta
argument_list|(
operator|(
specifier|const
expr|struct
name|ieee80211_node
operator|*
operator|)
name|addr
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DB_SHOW_COMMAND
argument_list|(
argument|vap
argument_list|,
argument|db_show_vap
argument_list|)
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|,
name|showprocs
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|have_addr
condition|)
block|{
name|db_printf
argument_list|(
literal|"usage: show vap<addr>\n"
argument_list|)
expr_stmt|;
return|return;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|modif
index|[
name|i
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
switch|switch
condition|(
name|modif
index|[
name|i
index|]
condition|)
block|{
case|case
literal|'a'
case|:
name|showprocs
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'p'
case|:
name|showprocs
operator|=
literal|1
expr_stmt|;
break|break;
block|}
name|_db_show_vap
argument_list|(
operator|(
specifier|const
expr|struct
name|ieee80211vap
operator|*
operator|)
name|addr
argument_list|,
name|showprocs
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DB_SHOW_COMMAND
argument_list|(
argument|com
argument_list|,
argument|db_show_com
argument_list|)
end_macro

begin_block
block|{
specifier|const
name|struct
name|ieee80211com
modifier|*
name|ic
decl_stmt|;
name|int
name|i
decl_stmt|,
name|showprocs
init|=
literal|0
decl_stmt|,
name|showvaps
init|=
literal|0
decl_stmt|,
name|showsta
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|have_addr
condition|)
block|{
name|db_printf
argument_list|(
literal|"usage: show com<addr>\n"
argument_list|)
expr_stmt|;
return|return;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|modif
index|[
name|i
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
switch|switch
condition|(
name|modif
index|[
name|i
index|]
condition|)
block|{
case|case
literal|'a'
case|:
name|showsta
operator|=
name|showvaps
operator|=
name|showprocs
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'s'
case|:
name|showsta
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'v'
case|:
name|showvaps
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'p'
case|:
name|showprocs
operator|=
literal|1
expr_stmt|;
break|break;
block|}
name|ic
operator|=
operator|(
specifier|const
expr|struct
name|ieee80211com
operator|*
operator|)
name|addr
expr_stmt|;
name|_db_show_com
argument_list|(
name|ic
argument_list|,
name|showvaps
argument_list|,
name|showsta
argument_list|,
name|showprocs
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DB_SHOW_ALL_COMMAND
argument_list|(
argument|vaps
argument_list|,
argument|db_show_all_vaps
argument_list|)
end_macro

begin_block
block|{
name|VNET_ITERATOR_DECL
argument_list|(
name|vnet_iter
argument_list|)
expr_stmt|;
specifier|const
name|struct
name|ifnet
modifier|*
name|ifp
decl_stmt|;
name|int
name|i
decl_stmt|,
name|showall
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|modif
index|[
name|i
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
switch|switch
condition|(
name|modif
index|[
name|i
index|]
condition|)
block|{
case|case
literal|'a'
case|:
name|showall
operator|=
literal|1
expr_stmt|;
break|break;
block|}
name|VNET_FOREACH
argument_list|(
argument|vnet_iter
argument_list|)
block|{
name|INIT_VNET_NET
argument_list|(
name|vnet_iter
argument_list|)
expr_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|ifp
argument_list|,
argument|&V_ifnet
argument_list|,
argument|if_list
argument_list|)
if|if
condition|(
name|ifp
operator|->
name|if_type
operator|==
name|IFT_IEEE80211
condition|)
block|{
specifier|const
name|struct
name|ieee80211com
modifier|*
name|ic
init|=
name|ifp
operator|->
name|if_l2com
decl_stmt|;
if|if
condition|(
operator|!
name|showall
condition|)
block|{
specifier|const
name|struct
name|ieee80211vap
modifier|*
name|vap
decl_stmt|;
name|db_printf
argument_list|(
literal|"%s: com %p vaps:"
argument_list|,
name|ifp
operator|->
name|if_xname
argument_list|,
name|ic
argument_list|)
expr_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|vap
argument_list|,
argument|&ic->ic_vaps
argument_list|,
argument|iv_next
argument_list|)
name|db_printf
argument_list|(
literal|" %s(%p)"
argument_list|,
name|vap
operator|->
name|iv_ifp
operator|->
name|if_xname
argument_list|,
name|vap
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
else|else
name|_db_show_com
argument_list|(
name|ic
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_function
specifier|static
name|void
name|_db_show_txampdu
parameter_list|(
specifier|const
name|char
modifier|*
name|sep
parameter_list|,
name|int
name|ix
parameter_list|,
specifier|const
name|struct
name|ieee80211_tx_ampdu
modifier|*
name|tap
parameter_list|)
block|{
name|db_printf
argument_list|(
literal|"%stxampdu[%d]: %p flags %b ac %u\n"
argument_list|,
name|sep
argument_list|,
name|ix
argument_list|,
name|tap
argument_list|,
name|tap
operator|->
name|txa_flags
argument_list|,
name|IEEE80211_AGGR_BITS
argument_list|,
name|tap
operator|->
name|txa_ac
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"%s  token %u qbytes %d qframes %d start %u wnd %u\n"
argument_list|,
name|sep
argument_list|,
name|tap
operator|->
name|txa_token
argument_list|,
name|tap
operator|->
name|txa_qbytes
argument_list|,
name|tap
operator|->
name|txa_qframes
argument_list|,
name|tap
operator|->
name|txa_start
argument_list|,
name|tap
operator|->
name|txa_wnd
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"%s  attempts %d nextrequest %d\n"
argument_list|,
name|sep
argument_list|,
name|tap
operator|->
name|txa_attempts
argument_list|,
name|tap
operator|->
name|txa_nextrequest
argument_list|)
expr_stmt|;
comment|/* XXX packet q + timer */
block|}
end_function

begin_function
specifier|static
name|void
name|_db_show_rxampdu
parameter_list|(
specifier|const
name|char
modifier|*
name|sep
parameter_list|,
name|int
name|ix
parameter_list|,
specifier|const
name|struct
name|ieee80211_rx_ampdu
modifier|*
name|rap
parameter_list|)
block|{
name|db_printf
argument_list|(
literal|"%srxampdu[%d]: %p flags 0x%x tid %u\n"
argument_list|,
name|sep
argument_list|,
name|ix
argument_list|,
name|rap
argument_list|,
name|rap
operator|->
name|rxa_flags
argument_list|,
name|ix
comment|/*XXX */
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"%s  qbytes %d qframes %d seqstart %u start %u wnd %u\n"
argument_list|,
name|sep
argument_list|,
name|rap
operator|->
name|rxa_qbytes
argument_list|,
name|rap
operator|->
name|rxa_qframes
argument_list|,
name|rap
operator|->
name|rxa_seqstart
argument_list|,
name|rap
operator|->
name|rxa_start
argument_list|,
name|rap
operator|->
name|rxa_wnd
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"%s  age %d nframes %d\n"
argument_list|,
name|sep
argument_list|,
name|rap
operator|->
name|rxa_age
argument_list|,
name|rap
operator|->
name|rxa_nframes
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|_db_show_sta
parameter_list|(
specifier|const
name|struct
name|ieee80211_node
modifier|*
name|ni
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|db_printf
argument_list|(
literal|"0x%p: mac %s refcnt %d\n"
argument_list|,
name|ni
argument_list|,
name|ether_sprintf
argument_list|(
name|ni
operator|->
name|ni_macaddr
argument_list|)
argument_list|,
name|ieee80211_node_refcnt
argument_list|(
name|ni
argument_list|)
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tvap %p wdsvap %p ic %p table %p\n"
argument_list|,
name|ni
operator|->
name|ni_vap
argument_list|,
name|ni
operator|->
name|ni_wdsvap
argument_list|,
name|ni
operator|->
name|ni_ic
argument_list|,
name|ni
operator|->
name|ni_table
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tflags=%b\n"
argument_list|,
name|ni
operator|->
name|ni_flags
argument_list|,
name|IEEE80211_NODE_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tscangen %u authmode %u ath_flags 0x%x ath_defkeyix %u\n"
argument_list|,
name|ni
operator|->
name|ni_scangen
argument_list|,
name|ni
operator|->
name|ni_authmode
argument_list|,
name|ni
operator|->
name|ni_ath_flags
argument_list|,
name|ni
operator|->
name|ni_ath_defkeyix
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tassocid 0x%x txpower %u vlan %u\n"
argument_list|,
name|ni
operator|->
name|ni_associd
argument_list|,
name|ni
operator|->
name|ni_txpower
argument_list|,
name|ni
operator|->
name|ni_vlan
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tjointime %d (%lu secs) challenge %p\n"
argument_list|,
name|ni
operator|->
name|ni_jointime
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|time_uptime
operator|-
name|ni
operator|->
name|ni_jointime
argument_list|)
argument_list|,
name|ni
operator|->
name|ni_challenge
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\ties: data %p len %d\n"
argument_list|,
name|ni
operator|->
name|ni_ies
operator|.
name|data
argument_list|,
name|ni
operator|->
name|ni_ies
operator|.
name|len
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\t[wpa_ie %p rsn_ie %p wme_ie %p ath_ie %p\n"
argument_list|,
name|ni
operator|->
name|ni_ies
operator|.
name|wpa_ie
argument_list|,
name|ni
operator|->
name|ni_ies
operator|.
name|rsn_ie
argument_list|,
name|ni
operator|->
name|ni_ies
operator|.
name|wme_ie
argument_list|,
name|ni
operator|->
name|ni_ies
operator|.
name|ath_ie
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\t htcap_ie %p htinfo_ie %p]\n"
argument_list|,
name|ni
operator|->
name|ni_ies
operator|.
name|htcap_ie
argument_list|,
name|ni
operator|->
name|ni_ies
operator|.
name|htinfo_ie
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\ttxseq %u rxseq %u fragno %u rxfragstamp %u\n"
argument_list|,
name|ni
operator|->
name|ni_txseqs
index|[
name|IEEE80211_NONQOS_TID
index|]
argument_list|,
name|ni
operator|->
name|ni_rxseqs
index|[
name|IEEE80211_NONQOS_TID
index|]
operator|>>
name|IEEE80211_SEQ_SEQ_SHIFT
argument_list|,
name|ni
operator|->
name|ni_rxseqs
index|[
name|IEEE80211_NONQOS_TID
index|]
operator|&
name|IEEE80211_SEQ_FRAG_MASK
argument_list|,
name|ni
operator|->
name|ni_rxfragstamp
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\trxfrag[0] %p rxfrag[1] %p rxfrag[2] %p\n"
argument_list|,
name|ni
operator|->
name|ni_rxfrag
index|[
literal|0
index|]
argument_list|,
name|ni
operator|->
name|ni_rxfrag
index|[
literal|1
index|]
argument_list|,
name|ni
operator|->
name|ni_rxfrag
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\trstamp %u avgrssi 0x%x (rssi %d) noise %d\n"
argument_list|,
name|ni
operator|->
name|ni_rstamp
argument_list|,
name|ni
operator|->
name|ni_avgrssi
argument_list|,
name|IEEE80211_RSSI_GET
argument_list|(
name|ni
operator|->
name|ni_avgrssi
argument_list|)
argument_list|,
name|ni
operator|->
name|ni_noise
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tintval %u capinfo %b\n"
argument_list|,
name|ni
operator|->
name|ni_intval
argument_list|,
name|ni
operator|->
name|ni_capinfo
argument_list|,
name|IEEE80211_CAPINFO_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tbssid %s"
argument_list|,
name|ether_sprintf
argument_list|(
name|ni
operator|->
name|ni_bssid
argument_list|)
argument_list|)
expr_stmt|;
name|_db_show_ssid
argument_list|(
literal|" essid "
argument_list|,
literal|0
argument_list|,
name|ni
operator|->
name|ni_esslen
argument_list|,
name|ni
operator|->
name|ni_essid
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|_db_show_channel
argument_list|(
literal|"\tchannel"
argument_list|,
name|ni
operator|->
name|ni_chan
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\terp %b dtim_period %u dtim_count %u\n"
argument_list|,
name|ni
operator|->
name|ni_erp
argument_list|,
name|IEEE80211_ERP_BITS
argument_list|,
name|ni
operator|->
name|ni_dtim_period
argument_list|,
name|ni
operator|->
name|ni_dtim_count
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\thtcap %b htparam 0x%x htctlchan %u ht2ndchan %u\n"
argument_list|,
name|ni
operator|->
name|ni_htcap
argument_list|,
name|IEEE80211_HTCAP_BITS
argument_list|,
name|ni
operator|->
name|ni_htparam
argument_list|,
name|ni
operator|->
name|ni_htctlchan
argument_list|,
name|ni
operator|->
name|ni_ht2ndchan
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\thtopmode 0x%x htstbc 0x%x chw %u\n"
argument_list|,
name|ni
operator|->
name|ni_htopmode
argument_list|,
name|ni
operator|->
name|ni_htstbc
argument_list|,
name|ni
operator|->
name|ni_chw
argument_list|)
expr_stmt|;
comment|/* XXX ampdu state */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|WME_NUM_AC
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|ni
operator|->
name|ni_tx_ampdu
index|[
name|i
index|]
operator|.
name|txa_flags
operator|&
name|IEEE80211_AGGR_SETUP
condition|)
name|_db_show_txampdu
argument_list|(
literal|"\t"
argument_list|,
name|i
argument_list|,
operator|&
name|ni
operator|->
name|ni_tx_ampdu
index|[
name|i
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|WME_NUM_TID
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|ni
operator|->
name|ni_rx_ampdu
index|[
name|i
index|]
operator|.
name|rxa_nframes
condition|)
name|_db_show_rxampdu
argument_list|(
literal|"\t"
argument_list|,
name|i
argument_list|,
operator|&
name|ni
operator|->
name|ni_rx_ampdu
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tinact %u inact_reload %u txrate %u\n"
argument_list|,
name|ni
operator|->
name|ni_inact
argument_list|,
name|ni
operator|->
name|ni_inact_reload
argument_list|,
name|ni
operator|->
name|ni_txrate
argument_list|)
expr_stmt|;
comment|/* XXX savedq */
comment|/* XXX wdsq */
block|}
end_function

begin_function
specifier|static
name|void
name|_db_show_vap
parameter_list|(
specifier|const
name|struct
name|ieee80211vap
modifier|*
name|vap
parameter_list|,
name|int
name|showprocs
parameter_list|)
block|{
specifier|const
name|struct
name|ieee80211com
modifier|*
name|ic
init|=
name|vap
operator|->
name|iv_ic
decl_stmt|;
name|int
name|i
decl_stmt|;
name|db_printf
argument_list|(
literal|"%p:"
argument_list|,
name|vap
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" bss %p"
argument_list|,
name|vap
operator|->
name|iv_bss
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" myaddr %s"
argument_list|,
name|ether_sprintf
argument_list|(
name|vap
operator|->
name|iv_myaddr
argument_list|)
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\topmode %s"
argument_list|,
name|ieee80211_opmode_name
index|[
name|vap
operator|->
name|iv_opmode
index|]
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" state %s"
argument_list|,
name|ieee80211_state_name
index|[
name|vap
operator|->
name|iv_state
index|]
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" ifp %p"
argument_list|,
name|vap
operator|->
name|iv_ifp
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tic %p"
argument_list|,
name|vap
operator|->
name|iv_ic
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" media %p"
argument_list|,
operator|&
name|vap
operator|->
name|iv_media
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" bpf_if %p"
argument_list|,
name|vap
operator|->
name|iv_rawbpf
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" mgtsend %p"
argument_list|,
operator|&
name|vap
operator|->
name|iv_mgtsend
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|struct sysctllog	*iv_sysctl;
comment|/* dynamic sysctl context */
endif|#
directive|endif
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tdebug=%b\n"
argument_list|,
name|vap
operator|->
name|iv_debug
argument_list|,
name|IEEE80211_MSG_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tflags=%b\n"
argument_list|,
name|vap
operator|->
name|iv_flags
argument_list|,
name|IEEE80211_F_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tflags_ext=%b\n"
argument_list|,
name|vap
operator|->
name|iv_flags_ext
argument_list|,
name|IEEE80211_FEXT_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tflags_ven=%b\n"
argument_list|,
name|vap
operator|->
name|iv_flags_ven
argument_list|,
name|IEEE80211_FVEN_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tcaps=%b\n"
argument_list|,
name|vap
operator|->
name|iv_caps
argument_list|,
name|IEEE80211_C_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\thtcaps=%b\n"
argument_list|,
name|vap
operator|->
name|iv_htcaps
argument_list|,
name|IEEE80211_C_HTCAP_BITS
argument_list|)
expr_stmt|;
name|_db_show_stats
argument_list|(
operator|&
name|vap
operator|->
name|iv_stats
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tinact_init %d"
argument_list|,
name|vap
operator|->
name|iv_inact_init
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" inact_auth %d"
argument_list|,
name|vap
operator|->
name|iv_inact_auth
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" inact_run %d"
argument_list|,
name|vap
operator|->
name|iv_inact_run
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" inact_probe %d"
argument_list|,
name|vap
operator|->
name|iv_inact_probe
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tdes_nssid %d"
argument_list|,
name|vap
operator|->
name|iv_des_nssid
argument_list|)
expr_stmt|;
if|if
condition|(
name|vap
operator|->
name|iv_des_nssid
condition|)
name|_db_show_ssid
argument_list|(
literal|" des_ssid[%u] "
argument_list|,
literal|0
argument_list|,
name|vap
operator|->
name|iv_des_ssid
index|[
literal|0
index|]
operator|.
name|len
argument_list|,
name|vap
operator|->
name|iv_des_ssid
index|[
literal|0
index|]
operator|.
name|ssid
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" des_bssid %s"
argument_list|,
name|ether_sprintf
argument_list|(
name|vap
operator|->
name|iv_des_bssid
argument_list|)
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tdes_mode %d"
argument_list|,
name|vap
operator|->
name|iv_des_mode
argument_list|)
expr_stmt|;
name|_db_show_channel
argument_list|(
literal|" des_chan"
argument_list|,
name|vap
operator|->
name|iv_des_chan
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|int			iv_nicknamelen;
comment|/* XXX junk */
block|uint8_t			iv_nickname[IEEE80211_NWID_LEN];
endif|#
directive|endif
name|db_printf
argument_list|(
literal|"\tbgscanidle %u"
argument_list|,
name|vap
operator|->
name|iv_bgscanidle
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" bgscanintvl %u"
argument_list|,
name|vap
operator|->
name|iv_bgscanintvl
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" scanvalid %u"
argument_list|,
name|vap
operator|->
name|iv_scanvalid
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tscanreq_duration %u"
argument_list|,
name|vap
operator|->
name|iv_scanreq_duration
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" scanreq_mindwell %u"
argument_list|,
name|vap
operator|->
name|iv_scanreq_mindwell
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" scanreq_maxdwell %u"
argument_list|,
name|vap
operator|->
name|iv_scanreq_maxdwell
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" scanreq_flags 0x%x"
argument_list|,
name|vap
operator|->
name|iv_scanreq_flags
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tscanreq_nssid %d"
argument_list|,
name|vap
operator|->
name|iv_scanreq_nssid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|vap
operator|->
name|iv_scanreq_nssid
condition|;
name|i
operator|++
control|)
name|_db_show_ssid
argument_list|(
literal|" scanreq_ssid[%u]"
argument_list|,
name|i
argument_list|,
name|vap
operator|->
name|iv_scanreq_ssid
index|[
name|i
index|]
operator|.
name|len
argument_list|,
name|vap
operator|->
name|iv_scanreq_ssid
index|[
name|i
index|]
operator|.
name|ssid
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" roaming %d"
argument_list|,
name|vap
operator|->
name|iv_roaming
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|IEEE80211_MODE_11A
init|;
name|i
operator|<
name|IEEE80211_MODE_MAX
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|isset
argument_list|(
name|ic
operator|->
name|ic_modecaps
argument_list|,
name|i
argument_list|)
condition|)
block|{
name|_db_show_roamparams
argument_list|(
literal|"\troamparms[%s]"
argument_list|,
name|ieee80211_phymode_name
index|[
name|i
index|]
argument_list|,
operator|&
name|vap
operator|->
name|iv_roamparms
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|db_printf
argument_list|(
literal|"\tbmissthreshold %u"
argument_list|,
name|vap
operator|->
name|iv_bmissthreshold
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" bmiss_max %u"
argument_list|,
name|vap
operator|->
name|iv_bmiss_count
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" bmiss_max %d"
argument_list|,
name|vap
operator|->
name|iv_bmiss_max
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tswbmiss_count %u"
argument_list|,
name|vap
operator|->
name|iv_swbmiss_count
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" swbmiss_period %u"
argument_list|,
name|vap
operator|->
name|iv_swbmiss_period
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" swbmiss %p"
argument_list|,
operator|&
name|vap
operator|->
name|iv_swbmiss
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tampdu_rxmax %d"
argument_list|,
name|vap
operator|->
name|iv_ampdu_rxmax
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" ampdu_density %d"
argument_list|,
name|vap
operator|->
name|iv_ampdu_density
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" ampdu_limit %d"
argument_list|,
name|vap
operator|->
name|iv_ampdu_limit
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" amsdu_limit %d"
argument_list|,
name|vap
operator|->
name|iv_amsdu_limit
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tmax_aid %u"
argument_list|,
name|vap
operator|->
name|iv_max_aid
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" aid_bitmap %p"
argument_list|,
name|vap
operator|->
name|iv_aid_bitmap
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tsta_assoc %u"
argument_list|,
name|vap
operator|->
name|iv_sta_assoc
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" ps_sta %u"
argument_list|,
name|vap
operator|->
name|iv_ps_sta
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" ps_pending %u"
argument_list|,
name|vap
operator|->
name|iv_ps_pending
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" tim_len %u"
argument_list|,
name|vap
operator|->
name|iv_tim_len
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" tim_bitmap %p"
argument_list|,
name|vap
operator|->
name|iv_tim_bitmap
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tdtim_period %u"
argument_list|,
name|vap
operator|->
name|iv_dtim_period
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" dtim_count %u"
argument_list|,
name|vap
operator|->
name|iv_dtim_count
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" set_tim %p"
argument_list|,
name|vap
operator|->
name|iv_set_tim
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" csa_count %d"
argument_list|,
name|vap
operator|->
name|iv_csa_count
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\trtsthreshold %u"
argument_list|,
name|vap
operator|->
name|iv_rtsthreshold
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" fragthreshold %u"
argument_list|,
name|vap
operator|->
name|iv_fragthreshold
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" inact_timer %d"
argument_list|,
name|vap
operator|->
name|iv_inact_timer
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|IEEE80211_MODE_11A
init|;
name|i
operator|<
name|IEEE80211_MODE_MAX
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|isset
argument_list|(
name|ic
operator|->
name|ic_modecaps
argument_list|,
name|i
argument_list|)
condition|)
block|{
name|_db_show_txparams
argument_list|(
literal|"\ttxparms[%s]"
argument_list|,
name|ieee80211_phymode_name
index|[
name|i
index|]
argument_list|,
operator|&
name|vap
operator|->
name|iv_txparms
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
comment|/* application-specified IE's to attach to mgt frames */
name|_db_show_appie
argument_list|(
literal|"\tappie_beacon"
argument_list|,
name|vap
operator|->
name|iv_appie_beacon
argument_list|)
expr_stmt|;
name|_db_show_appie
argument_list|(
literal|"\tappie_probereq"
argument_list|,
name|vap
operator|->
name|iv_appie_probereq
argument_list|)
expr_stmt|;
name|_db_show_appie
argument_list|(
literal|"\tappie_proberesp"
argument_list|,
name|vap
operator|->
name|iv_appie_proberesp
argument_list|)
expr_stmt|;
name|_db_show_appie
argument_list|(
literal|"\tappie_assocreq"
argument_list|,
name|vap
operator|->
name|iv_appie_assocreq
argument_list|)
expr_stmt|;
name|_db_show_appie
argument_list|(
literal|"\tappie_asscoresp"
argument_list|,
name|vap
operator|->
name|iv_appie_assocresp
argument_list|)
expr_stmt|;
name|_db_show_appie
argument_list|(
literal|"\tappie_wpa"
argument_list|,
name|vap
operator|->
name|iv_appie_wpa
argument_list|)
expr_stmt|;
if|if
condition|(
name|vap
operator|->
name|iv_wpa_ie
operator|!=
name|NULL
operator|||
name|vap
operator|->
name|iv_rsn_ie
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|vap
operator|->
name|iv_wpa_ie
operator|!=
name|NULL
condition|)
name|db_printf
argument_list|(
literal|"\twpa_ie %p"
argument_list|,
name|vap
operator|->
name|iv_wpa_ie
argument_list|)
expr_stmt|;
if|if
condition|(
name|vap
operator|->
name|iv_rsn_ie
operator|!=
name|NULL
condition|)
name|db_printf
argument_list|(
literal|"\trsn_ie %p"
argument_list|,
name|vap
operator|->
name|iv_rsn_ie
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|db_printf
argument_list|(
literal|"\tmax_keyix %u"
argument_list|,
name|vap
operator|->
name|iv_max_keyix
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" def_txkey %d"
argument_list|,
name|vap
operator|->
name|iv_def_txkey
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IEEE80211_WEP_NKID
condition|;
name|i
operator|++
control|)
name|_db_show_key
argument_list|(
literal|"\tnw_keys[%u]"
argument_list|,
name|i
argument_list|,
operator|&
name|vap
operator|->
name|iv_nw_keys
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tauth %p"
argument_list|,
name|vap
operator|->
name|iv_auth
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" ec %p"
argument_list|,
name|vap
operator|->
name|iv_ec
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" acl %p"
argument_list|,
name|vap
operator|->
name|iv_acl
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" as %p"
argument_list|,
name|vap
operator|->
name|iv_as
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|showprocs
condition|)
block|{
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_key_alloc"
argument_list|,
name|vap
operator|->
name|iv_key_alloc
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_key_delete"
argument_list|,
name|vap
operator|->
name|iv_key_delete
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_key_set"
argument_list|,
name|vap
operator|->
name|iv_key_set
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_key_update_begin"
argument_list|,
name|vap
operator|->
name|iv_key_update_begin
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_key_update_end"
argument_list|,
name|vap
operator|->
name|iv_key_update_end
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_opdetach"
argument_list|,
name|vap
operator|->
name|iv_opdetach
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_input"
argument_list|,
name|vap
operator|->
name|iv_input
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_recv_mgmt"
argument_list|,
name|vap
operator|->
name|iv_recv_mgmt
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_deliver_data"
argument_list|,
name|vap
operator|->
name|iv_deliver_data
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_bmiss"
argument_list|,
name|vap
operator|->
name|iv_bmiss
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_reset"
argument_list|,
name|vap
operator|->
name|iv_reset
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_update_beacon"
argument_list|,
name|vap
operator|->
name|iv_update_beacon
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_newstate"
argument_list|,
name|vap
operator|->
name|iv_newstate
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tiv_output"
argument_list|,
name|vap
operator|->
name|iv_output
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|_db_show_com
parameter_list|(
specifier|const
name|struct
name|ieee80211com
modifier|*
name|ic
parameter_list|,
name|int
name|showvaps
parameter_list|,
name|int
name|showsta
parameter_list|,
name|int
name|showprocs
parameter_list|)
block|{
name|struct
name|ieee80211vap
modifier|*
name|vap
decl_stmt|;
name|db_printf
argument_list|(
literal|"%p:"
argument_list|,
name|ic
argument_list|)
expr_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|vap
argument_list|,
argument|&ic->ic_vaps
argument_list|,
argument|iv_next
argument_list|)
name|db_printf
argument_list|(
literal|" %s(%p)"
argument_list|,
name|vap
operator|->
name|iv_ifp
operator|->
name|if_xname
argument_list|,
name|vap
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tifp %p"
argument_list|,
name|ic
operator|->
name|ic_ifp
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" comlock %p"
argument_list|,
operator|&
name|ic
operator|->
name|ic_comlock
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|_db_show_stats
argument_list|(
operator|&
name|ic
operator|->
name|ic_stats
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\theadroom %d"
argument_list|,
name|ic
operator|->
name|ic_headroom
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" phytype %d"
argument_list|,
name|ic
operator|->
name|ic_phytype
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" opmode %s"
argument_list|,
name|ieee80211_opmode_name
index|[
name|ic
operator|->
name|ic_opmode
index|]
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tmedia %p"
argument_list|,
operator|&
name|ic
operator|->
name|ic_media
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" myaddr %s"
argument_list|,
name|ether_sprintf
argument_list|(
name|ic
operator|->
name|ic_myaddr
argument_list|)
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" inact %p"
argument_list|,
operator|&
name|ic
operator|->
name|ic_inact
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tflags=%b\n"
argument_list|,
name|ic
operator|->
name|ic_flags
argument_list|,
name|IEEE80211_F_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tflags_ext=%b\n"
argument_list|,
name|ic
operator|->
name|ic_flags_ext
argument_list|,
name|IEEE80211_FEXT_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tflags_ven=%b\n"
argument_list|,
name|ic
operator|->
name|ic_flags_ven
argument_list|,
name|IEEE80211_FVEN_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tcaps=%b\n"
argument_list|,
name|ic
operator|->
name|ic_caps
argument_list|,
name|IEEE80211_C_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tcryptocaps=%b\n"
argument_list|,
name|ic
operator|->
name|ic_cryptocaps
argument_list|,
name|IEEE80211_C_CRYPTO_BITS
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\thtcaps=%b\n"
argument_list|,
name|ic
operator|->
name|ic_htcaps
argument_list|,
name|IEEE80211_HTCAP_BITS
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|uint8_t			ic_modecaps[2];
comment|/* set of mode capabilities */
endif|#
directive|endif
name|db_printf
argument_list|(
literal|"\tcurmode %u"
argument_list|,
name|ic
operator|->
name|ic_curmode
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" promisc %u"
argument_list|,
name|ic
operator|->
name|ic_promisc
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" allmulti %u"
argument_list|,
name|ic
operator|->
name|ic_allmulti
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" nrunning %u"
argument_list|,
name|ic
operator|->
name|ic_nrunning
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tbintval %u"
argument_list|,
name|ic
operator|->
name|ic_bintval
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" lintval %u"
argument_list|,
name|ic
operator|->
name|ic_lintval
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" holdover %u"
argument_list|,
name|ic
operator|->
name|ic_holdover
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" txpowlimit %u"
argument_list|,
name|ic
operator|->
name|ic_txpowlimit
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|struct ieee80211_rateset ic_sup_rates[IEEE80211_MODE_MAX];
endif|#
directive|endif
comment|/* 	 * Channel state: 	 * 	 * ic_channels is the set of available channels for the device; 	 *    it is setup by the driver 	 * ic_nchans is the number of valid entries in ic_channels 	 * ic_chan_avail is a bit vector of these channels used to check 	 *    whether a channel is available w/o searching the channel table. 	 * ic_chan_active is a (potentially) constrained subset of 	 *    ic_chan_avail that reflects any mode setting or user-specified 	 *    limit on the set of channels to use/scan 	 * ic_curchan is the current channel the device is set to; it may 	 *    be different from ic_bsschan when we are off-channel scanning 	 *    or otherwise doing background work 	 * ic_bsschan is the channel selected for operation; it may 	 *    be undefined (IEEE80211_CHAN_ANYC) 	 * ic_prevchan is a cached ``previous channel'' used to optimize 	 *    lookups when switching back+forth between two channels 	 *    (e.g. for dynamic turbo) 	 */
name|db_printf
argument_list|(
literal|"\tnchans %d"
argument_list|,
name|ic
operator|->
name|ic_nchans
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|struct ieee80211_channel ic_channels[IEEE80211_CHAN_MAX]; 	uint8_t			ic_chan_avail[IEEE80211_CHAN_BYTES]; 	uint8_t			ic_chan_active[IEEE80211_CHAN_BYTES]; 	uint8_t			ic_chan_scan[IEEE80211_CHAN_BYTES];
endif|#
directive|endif
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|_db_show_channel
argument_list|(
literal|"\tcurchan"
argument_list|,
name|ic
operator|->
name|ic_curchan
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|_db_show_channel
argument_list|(
literal|"\tbsschan"
argument_list|,
name|ic
operator|->
name|ic_bsschan
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|_db_show_channel
argument_list|(
literal|"\tprevchan"
argument_list|,
name|ic
operator|->
name|ic_prevchan
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tregdomain %p"
argument_list|,
operator|&
name|ic
operator|->
name|ic_regdomain
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|_db_show_channel
argument_list|(
literal|"\tcsa_newchan"
argument_list|,
name|ic
operator|->
name|ic_csa_newchan
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" csa_count %d"
argument_list|,
name|ic
operator|->
name|ic_csa_count
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"dfs %p"
argument_list|,
operator|&
name|ic
operator|->
name|ic_dfs
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tscan %p"
argument_list|,
name|ic
operator|->
name|ic_scan
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" lastdata %d"
argument_list|,
name|ic
operator|->
name|ic_lastdata
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" lastscan %d"
argument_list|,
name|ic
operator|->
name|ic_lastscan
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tmax_keyix %d"
argument_list|,
name|ic
operator|->
name|ic_max_keyix
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" sta %p"
argument_list|,
operator|&
name|ic
operator|->
name|ic_sta
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" wme %p"
argument_list|,
operator|&
name|ic
operator|->
name|ic_wme
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tprotmode %d"
argument_list|,
name|ic
operator|->
name|ic_protmode
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" nonerpsta %u"
argument_list|,
name|ic
operator|->
name|ic_nonerpsta
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" longslotsta %u"
argument_list|,
name|ic
operator|->
name|ic_longslotsta
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" lastnonerp %d"
argument_list|,
name|ic
operator|->
name|ic_lastnonerp
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tsta_assoc %u"
argument_list|,
name|ic
operator|->
name|ic_sta_assoc
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" ht_sta_assoc %u"
argument_list|,
name|ic
operator|->
name|ic_ht_sta_assoc
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" ht40_sta_assoc %u"
argument_list|,
name|ic
operator|->
name|ic_ht40_sta_assoc
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\tcurhtprotmode 0x%x"
argument_list|,
name|ic
operator|->
name|ic_curhtprotmode
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" htprotmode %d"
argument_list|,
name|ic
operator|->
name|ic_htprotmode
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" lastnonht %d"
argument_list|,
name|ic
operator|->
name|ic_lastnonht
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|showprocs
condition|)
block|{
name|DB_PRINTSYM
argument_list|(
literal|"\tic_vap_create"
argument_list|,
name|ic
operator|->
name|ic_vap_create
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_vap_delete"
argument_list|,
name|ic
operator|->
name|ic_vap_delete
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
comment|/* operating mode attachment */
block|ieee80211vap_attach	ic_vattach[IEEE80211_OPMODE_MAX];
endif|#
directive|endif
name|DB_PRINTSYM
argument_list|(
literal|"\tic_newassoc"
argument_list|,
name|ic
operator|->
name|ic_newassoc
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_getradiocaps"
argument_list|,
name|ic
operator|->
name|ic_getradiocaps
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_setregdomain"
argument_list|,
name|ic
operator|->
name|ic_setregdomain
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_send_mgmt"
argument_list|,
name|ic
operator|->
name|ic_send_mgmt
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_raw_xmit"
argument_list|,
name|ic
operator|->
name|ic_raw_xmit
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_updateslot"
argument_list|,
name|ic
operator|->
name|ic_updateslot
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_update_mcast"
argument_list|,
name|ic
operator|->
name|ic_update_mcast
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_update_promisc"
argument_list|,
name|ic
operator|->
name|ic_update_promisc
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_node_alloc"
argument_list|,
name|ic
operator|->
name|ic_node_alloc
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_node_free"
argument_list|,
name|ic
operator|->
name|ic_node_free
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_node_cleanup"
argument_list|,
name|ic
operator|->
name|ic_node_cleanup
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_node_getrssi"
argument_list|,
name|ic
operator|->
name|ic_node_getrssi
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_node_getsignal"
argument_list|,
name|ic
operator|->
name|ic_node_getsignal
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_node_getmimoinfo"
argument_list|,
name|ic
operator|->
name|ic_node_getmimoinfo
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_scan_start"
argument_list|,
name|ic
operator|->
name|ic_scan_start
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_scan_end"
argument_list|,
name|ic
operator|->
name|ic_scan_end
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_set_channel"
argument_list|,
name|ic
operator|->
name|ic_set_channel
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_scan_curchan"
argument_list|,
name|ic
operator|->
name|ic_scan_curchan
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_scan_mindwell"
argument_list|,
name|ic
operator|->
name|ic_scan_mindwell
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_recv_action"
argument_list|,
name|ic
operator|->
name|ic_recv_action
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_send_action"
argument_list|,
name|ic
operator|->
name|ic_send_action
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_addba_request"
argument_list|,
name|ic
operator|->
name|ic_addba_request
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_addba_response"
argument_list|,
name|ic
operator|->
name|ic_addba_response
argument_list|)
expr_stmt|;
name|DB_PRINTSYM
argument_list|(
literal|"\tic_addba_stop"
argument_list|,
name|ic
operator|->
name|ic_addba_stop
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|showvaps
operator|&&
operator|!
name|TAILQ_EMPTY
argument_list|(
operator|&
name|ic
operator|->
name|ic_vaps
argument_list|)
condition|)
block|{
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|vap
argument_list|,
argument|&ic->ic_vaps
argument_list|,
argument|iv_next
argument_list|)
name|_db_show_vap
argument_list|(
name|vap
argument_list|,
name|showprocs
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|showsta
operator|&&
operator|!
name|TAILQ_EMPTY
argument_list|(
operator|&
name|ic
operator|->
name|ic_sta
operator|.
name|nt_node
argument_list|)
condition|)
block|{
specifier|const
name|struct
name|ieee80211_node_table
modifier|*
name|nt
init|=
operator|&
name|ic
operator|->
name|ic_sta
decl_stmt|;
specifier|const
name|struct
name|ieee80211_node
modifier|*
name|ni
decl_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|ni
argument_list|,
argument|&nt->nt_node
argument_list|,
argument|ni_list
argument_list|)
block|{
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|_db_show_sta
argument_list|(
name|ni
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|_db_show_channel
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|c
parameter_list|)
block|{
name|db_printf
argument_list|(
literal|"%s "
argument_list|,
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|==
name|NULL
condition|)
name|db_printf
argument_list|(
literal|"<NULL>"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|c
operator|==
name|IEEE80211_CHAN_ANYC
condition|)
name|db_printf
argument_list|(
literal|"<ANY>"
argument_list|)
expr_stmt|;
else|else
name|db_printf
argument_list|(
literal|"[%u (%u) flags=%b maxreg %u maxpow %u minpow %u state 0x%x extieee %u]"
argument_list|,
name|c
operator|->
name|ic_freq
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|,
name|c
operator|->
name|ic_flags
argument_list|,
name|IEEE80211_CHAN_BITS
argument_list|,
name|c
operator|->
name|ic_maxregpower
argument_list|,
name|c
operator|->
name|ic_maxpower
argument_list|,
name|c
operator|->
name|ic_minpower
argument_list|,
name|c
operator|->
name|ic_state
argument_list|,
name|c
operator|->
name|ic_extieee
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|_db_show_ssid
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
name|int
name|ix
parameter_list|,
name|int
name|len
parameter_list|,
specifier|const
name|uint8_t
modifier|*
name|ssid
parameter_list|)
block|{
specifier|const
name|uint8_t
modifier|*
name|p
decl_stmt|;
name|int
name|i
decl_stmt|;
name|db_printf
argument_list|(
name|tag
argument_list|,
name|ix
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|IEEE80211_NWID_LEN
condition|)
name|len
operator|=
name|IEEE80211_NWID_LEN
expr_stmt|;
comment|/* determine printable or not */
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|p
operator|=
name|ssid
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
operator|,
name|p
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|p
operator|<
literal|' '
operator|||
operator|*
name|p
operator|>
literal|0x7e
condition|)
break|break;
block|}
if|if
condition|(
name|i
operator|==
name|len
condition|)
block|{
name|db_printf
argument_list|(
literal|"\""
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|p
operator|=
name|ssid
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
operator|,
name|p
operator|++
control|)
name|db_printf
argument_list|(
literal|"%c"
argument_list|,
operator|*
name|p
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"\""
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|db_printf
argument_list|(
literal|"0x"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|p
operator|=
name|ssid
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
operator|,
name|p
operator|++
control|)
name|db_printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
name|p
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|_db_show_appie
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|struct
name|ieee80211_appie
modifier|*
name|ie
parameter_list|)
block|{
specifier|const
name|uint8_t
modifier|*
name|p
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|ie
operator|==
name|NULL
condition|)
return|return;
name|db_printf
argument_list|(
literal|"%s [0x"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|p
operator|=
name|ie
operator|->
name|ie_data
init|;
name|i
operator|<
name|ie
operator|->
name|ie_len
condition|;
name|i
operator|++
operator|,
name|p
operator|++
control|)
name|db_printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
name|p
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|"]\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|_db_show_key
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
name|int
name|ix
parameter_list|,
specifier|const
name|struct
name|ieee80211_key
modifier|*
name|wk
parameter_list|)
block|{
specifier|static
specifier|const
name|uint8_t
name|zerodata
index|[
name|IEEE80211_KEYBUF_SIZE
index|]
decl_stmt|;
specifier|const
name|struct
name|ieee80211_cipher
modifier|*
name|cip
init|=
name|wk
operator|->
name|wk_cipher
decl_stmt|;
name|int
name|keylen
init|=
name|wk
operator|->
name|wk_keylen
decl_stmt|;
if|if
condition|(
operator|(
name|wk
operator|->
name|wk_flags
operator|&
name|IEEE80211_KEY_DEVKEY
operator|)
operator|==
literal|0
condition|)
return|return;
name|db_printf
argument_list|(
name|tag
argument_list|,
name|ix
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|cip
operator|->
name|ic_cipher
condition|)
block|{
case|case
name|IEEE80211_CIPHER_WEP
case|:
comment|/* compatibility */
name|db_printf
argument_list|(
literal|" wepkey %u:%s"
argument_list|,
name|wk
operator|->
name|wk_keyix
argument_list|,
name|keylen
operator|<=
literal|5
condition|?
literal|"40-bit"
else|:
name|keylen
operator|<=
literal|13
condition|?
literal|"104-bit"
else|:
literal|"128-bit"
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_CIPHER_TKIP
case|:
if|if
condition|(
name|keylen
operator|>
literal|128
operator|/
literal|8
condition|)
name|keylen
operator|-=
literal|128
operator|/
literal|8
expr_stmt|;
comment|/* ignore MIC for now */
name|db_printf
argument_list|(
literal|" TKIP %u:%u-bit"
argument_list|,
name|wk
operator|->
name|wk_keyix
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_CIPHER_AES_OCB
case|:
name|db_printf
argument_list|(
literal|" AES-OCB %u:%u-bit"
argument_list|,
name|wk
operator|->
name|wk_keyix
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_CIPHER_AES_CCM
case|:
name|db_printf
argument_list|(
literal|" AES-CCM %u:%u-bit"
argument_list|,
name|wk
operator|->
name|wk_keyix
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_CIPHER_CKIP
case|:
name|db_printf
argument_list|(
literal|" CKIP %u:%u-bit"
argument_list|,
name|wk
operator|->
name|wk_keyix
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_CIPHER_NONE
case|:
name|db_printf
argument_list|(
literal|" NULL %u:%u-bit"
argument_list|,
name|wk
operator|->
name|wk_keyix
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
default|default:
name|db_printf
argument_list|(
literal|" UNKNOWN (0x%x) %u:%u-bit"
argument_list|,
name|cip
operator|->
name|ic_cipher
argument_list|,
name|wk
operator|->
name|wk_keyix
argument_list|,
literal|8
operator|*
name|keylen
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|memcmp
argument_list|(
name|wk
operator|->
name|wk_key
argument_list|,
name|zerodata
argument_list|,
name|keylen
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|int
name|i
decl_stmt|;
name|db_printf
argument_list|(
literal|"<"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|keylen
condition|;
name|i
operator|++
control|)
name|db_printf
argument_list|(
literal|"%02x"
argument_list|,
name|wk
operator|->
name|wk_key
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|">"
argument_list|)
expr_stmt|;
if|if
condition|(
name|cip
operator|->
name|ic_cipher
operator|!=
name|IEEE80211_CIPHER_WEP
operator|&&
name|wk
operator|->
name|wk_keyrsc
index|[
name|IEEE80211_NONQOS_TID
index|]
operator|!=
literal|0
condition|)
name|db_printf
argument_list|(
literal|" rsc %ju"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|wk
operator|->
name|wk_keyrsc
index|[
name|IEEE80211_NONQOS_TID
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|cip
operator|->
name|ic_cipher
operator|!=
name|IEEE80211_CIPHER_WEP
operator|&&
name|wk
operator|->
name|wk_keytsc
operator|!=
literal|0
condition|)
name|db_printf
argument_list|(
literal|" tsc %ju"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|wk
operator|->
name|wk_keytsc
argument_list|)
expr_stmt|;
if|if
condition|(
name|wk
operator|->
name|wk_flags
operator|!=
literal|0
condition|)
block|{
specifier|const
name|char
modifier|*
name|sep
init|=
literal|" "
decl_stmt|;
if|if
condition|(
name|wk
operator|->
name|wk_flags
operator|&
name|IEEE80211_KEY_XMIT
condition|)
name|db_printf
argument_list|(
literal|"%stx"
argument_list|,
name|sep
argument_list|)
operator|,
name|sep
operator|=
literal|"+"
expr_stmt|;
if|if
condition|(
name|wk
operator|->
name|wk_flags
operator|&
name|IEEE80211_KEY_RECV
condition|)
name|db_printf
argument_list|(
literal|"%srx"
argument_list|,
name|sep
argument_list|)
operator|,
name|sep
operator|=
literal|"+"
expr_stmt|;
if|if
condition|(
name|wk
operator|->
name|wk_flags
operator|&
name|IEEE80211_KEY_DEFAULT
condition|)
name|db_printf
argument_list|(
literal|"%sdef"
argument_list|,
name|sep
argument_list|)
operator|,
name|sep
operator|=
literal|"+"
expr_stmt|;
if|if
condition|(
name|wk
operator|->
name|wk_flags
operator|&
name|IEEE80211_KEY_SWCRYPT
condition|)
name|db_printf
argument_list|(
literal|"%sswcrypt"
argument_list|,
name|sep
argument_list|)
operator|,
name|sep
operator|=
literal|"+"
expr_stmt|;
if|if
condition|(
name|wk
operator|->
name|wk_flags
operator|&
name|IEEE80211_KEY_SWMIC
condition|)
name|db_printf
argument_list|(
literal|"%sswmic"
argument_list|,
name|sep
argument_list|)
operator|,
name|sep
operator|=
literal|"+"
expr_stmt|;
block|}
name|db_printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|printrate
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
name|int
name|v
parameter_list|)
block|{
if|if
condition|(
name|v
operator|==
name|IEEE80211_FIXED_RATE_NONE
condition|)
name|db_printf
argument_list|(
literal|" %s<none>"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|v
operator|==
literal|11
condition|)
name|db_printf
argument_list|(
literal|" %s 5.5"
argument_list|,
name|tag
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|v
operator|&
name|IEEE80211_RATE_MCS
condition|)
name|db_printf
argument_list|(
literal|" %s MCS%d"
argument_list|,
name|tag
argument_list|,
name|v
operator|&
operator|~
name|IEEE80211_RATE_MCS
argument_list|)
expr_stmt|;
else|else
name|db_printf
argument_list|(
literal|" %s %d"
argument_list|,
name|tag
argument_list|,
name|v
operator|/
literal|2
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|_db_show_roamparams
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|void
modifier|*
name|arg
parameter_list|,
specifier|const
name|struct
name|ieee80211_roamparam
modifier|*
name|rp
parameter_list|)
block|{
name|db_printf
argument_list|(
name|tag
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|rp
operator|->
name|rssi
operator|&
literal|1
condition|)
name|db_printf
argument_list|(
literal|" rssi %u.5"
argument_list|,
name|rp
operator|->
name|rssi
operator|/
literal|2
argument_list|)
expr_stmt|;
else|else
name|db_printf
argument_list|(
literal|" rssi %u"
argument_list|,
name|rp
operator|->
name|rssi
operator|/
literal|2
argument_list|)
expr_stmt|;
name|printrate
argument_list|(
literal|"rate"
argument_list|,
name|rp
operator|->
name|rate
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|_db_show_txparams
parameter_list|(
specifier|const
name|char
modifier|*
name|tag
parameter_list|,
specifier|const
name|void
modifier|*
name|arg
parameter_list|,
specifier|const
name|struct
name|ieee80211_txparam
modifier|*
name|tp
parameter_list|)
block|{
name|db_printf
argument_list|(
name|tag
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printrate
argument_list|(
literal|"ucastrate"
argument_list|,
name|tp
operator|->
name|ucastrate
argument_list|)
expr_stmt|;
name|printrate
argument_list|(
literal|"mcastrate"
argument_list|,
name|tp
operator|->
name|mcastrate
argument_list|)
expr_stmt|;
name|printrate
argument_list|(
literal|"mgmtrate"
argument_list|,
name|tp
operator|->
name|mgmtrate
argument_list|)
expr_stmt|;
name|db_printf
argument_list|(
literal|" maxretry %d"
argument_list|,
name|tp
operator|->
name|maxretry
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|_db_show_stats
parameter_list|(
specifier|const
name|struct
name|ieee80211_stats
modifier|*
name|is
parameter_list|)
block|{ }
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* DDB */
end_comment

end_unit

