begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Largely written by Julian Elischer (julian@tfs.com)  * for TRW Financial Systems.  *  * TRW Financial Systems, in accordance with their agreement with Carnegie  * Mellon University, makes this software available to CMU to distribute  * or use in any manner that they see fit as long as this message is kept with  * the software. For this reason TFS also grants any other persons or  * organisations permission to use or modify this software.  *  * TFS supplies this software to be publicly redistributed  * on the understanding that TFS is not responsible for the correct  * functioning of this software in any circumstances.  *  * Ported to run under 386BSD by Julian Elischer (julian@tfs.com) Sept 1992  *  * $FreeBSD$  */
end_comment

begin_comment
comment|/*  * SCSI general  interface description  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|_SCSI_SCSI_ALL_H
end_ifndef

begin_define
define|#
directive|define
name|_SCSI_SCSI_ALL_H
value|1
end_define

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|_KERNEL
end_ifdef

begin_include
include|#
directive|include
file|"opt_scsi.h"
end_include

begin_comment
comment|/*  * This is the number of seconds we wait for devices to settle after a SCSI  * bus reset.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|SCSI_DELAY
end_ifndef

begin_define
define|#
directive|define
name|SCSI_DELAY
value|2000
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * If someone sets this to 0, we assume that they want the minimum  * allowable bus settle delay.  All devices need _some_ sort of bus settle  * delay, so we'll set it to a minimum value of 100ms.  */
end_comment

begin_if
if|#
directive|if
operator|(
name|SCSI_DELAY
operator|==
literal|0
operator|)
end_if

begin_undef
undef|#
directive|undef
name|SCSI_DELAY
end_undef

begin_define
define|#
directive|define
name|SCSI_DELAY
value|100
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Make sure the user isn't using seconds instead of milliseconds.  */
end_comment

begin_if
if|#
directive|if
operator|(
name|SCSI_DELAY
operator|<
literal|100
operator|)
end_if

begin_error
error|#
directive|error
literal|"SCSI_DELAY is in milliseconds, not seconds!  Please use a larger value"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* _KERNEL */
end_comment

begin_comment
comment|/*  * SCSI command format  */
end_comment

begin_comment
comment|/*  * Define dome bits that are in ALL (or a lot of) scsi commands  */
end_comment

begin_define
define|#
directive|define
name|SCSI_CTL_LINK
value|0x01
end_define

begin_define
define|#
directive|define
name|SCSI_CTL_FLAG
value|0x02
end_define

begin_define
define|#
directive|define
name|SCSI_CTL_VENDOR
value|0xC0
end_define

begin_define
define|#
directive|define
name|SCSI_CMD_LUN
value|0xA0
end_define

begin_comment
comment|/* these two should not be needed */
end_comment

begin_define
define|#
directive|define
name|SCSI_CMD_LUN_SHIFT
value|5
end_define

begin_comment
comment|/* LUN in the cmd is no longer SCSI */
end_comment

begin_define
define|#
directive|define
name|SCSI_MAX_CDBLEN
value|16
end_define

begin_comment
comment|/*  					 * 16 byte commands are in the  					 * SCSI-3 spec  					 */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CAM_MAX_CDBLEN
argument_list|)
operator|&&
operator|(
name|CAM_MAX_CDBLEN
operator|<
name|SCSI_MAX_CDBLEN
operator|)
end_if

begin_error
error|#
directive|error
literal|"CAM_MAX_CDBLEN cannot be less than SCSI_MAX_CDBLEN"
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* 6byte CDBs special case 0 length to be 256 */
end_comment

begin_define
define|#
directive|define
name|SCSI_CDB6_LEN
parameter_list|(
name|len
parameter_list|)
value|((len) == 0 ? 256 : len)
end_define

begin_comment
comment|/*  * This type defines actions to be taken when a particular sense code is  * received.  Right now, these flags are only defined to take up 16 bits,  * but can be expanded in the future if necessary.  */
end_comment

begin_typedef
typedef|typedef
enum|enum
block|{
name|SS_NOP
init|=
literal|0x000000
block|,
comment|/* Do nothing */
name|SS_RETRY
init|=
literal|0x010000
block|,
comment|/* Retry the command */
name|SS_FAIL
init|=
literal|0x020000
block|,
comment|/* Bail out */
name|SS_START
init|=
literal|0x030000
block|,
comment|/* Send a Start Unit command to the device, 				 * then retry the original command. 				 */
name|SS_TUR
init|=
literal|0x040000
block|,
comment|/* Send a Test Unit Ready command to the 				 * device, then retry the original command. 				 */
name|SS_REQSENSE
init|=
literal|0x050000
block|,
comment|/* Send a RequestSense command to the 				 * device, then retry the original command. 				 */
name|SS_MASK
init|=
literal|0xff0000
block|}
name|scsi_sense_action
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
block|{
name|SSQ_NONE
init|=
literal|0x0000
block|,
name|SSQ_DECREMENT_COUNT
init|=
literal|0x0100
block|,
comment|/* Decrement the retry count */
name|SSQ_MANY
init|=
literal|0x0200
block|,
comment|/* send lots of recovery commands */
name|SSQ_RANGE
init|=
literal|0x0400
block|,
comment|/* 					    * This table entry represents the 					    * end of a range of ASCQs that 					    * have identical error actions 					    * and text. 					    */
name|SSQ_PRINT_SENSE
init|=
literal|0x0800
block|,
name|SSQ_MASK
init|=
literal|0xff00
block|}
name|scsi_sense_action_qualifier
typedef|;
end_typedef

begin_comment
comment|/* Mask for error status values */
end_comment

begin_define
define|#
directive|define
name|SS_ERRMASK
value|0xff
end_define

begin_comment
comment|/* The default, retyable, error action */
end_comment

begin_define
define|#
directive|define
name|SS_RDEF
value|SS_RETRY|SSQ_DECREMENT_COUNT|SSQ_PRINT_SENSE|EIO
end_define

begin_comment
comment|/* The retyable, error action, with table specified error code */
end_comment

begin_define
define|#
directive|define
name|SS_RET
value|SS_RETRY|SSQ_DECREMENT_COUNT|SSQ_PRINT_SENSE
end_define

begin_comment
comment|/* Fatal error action, with table specified error code */
end_comment

begin_define
define|#
directive|define
name|SS_FATAL
value|SS_FAIL|SSQ_PRINT_SENSE
end_define

begin_struct
struct|struct
name|scsi_generic
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|bytes
index|[
literal|11
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_request_sense
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|unused
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|length
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_test_unit_ready
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|unused
index|[
literal|3
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_send_diag
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
define|#
directive|define
name|SSD_UOL
value|0x01
define|#
directive|define
name|SSD_DOL
value|0x02
define|#
directive|define
name|SSD_SELFTEST
value|0x04
define|#
directive|define
name|SSD_PF
value|0x10
name|u_int8_t
name|unused
index|[
literal|1
index|]
decl_stmt|;
name|u_int8_t
name|paramlen
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_sense
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|unused
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|length
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_inquiry
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
define|#
directive|define
name|SI_EVPD
value|0x01
name|u_int8_t
name|page_code
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|length
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_mode_sense_6
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
define|#
directive|define
name|SMS_DBD
value|0x08
name|u_int8_t
name|page
decl_stmt|;
define|#
directive|define
name|SMS_PAGE_CODE
value|0x3F
define|#
directive|define
name|SMS_VENDOR_SPECIFIC_PAGE
value|0x00
define|#
directive|define
name|SMS_DISCONNECT_RECONNECT_PAGE
value|0x02
define|#
directive|define
name|SMS_PERIPHERAL_DEVICE_PAGE
value|0x09
define|#
directive|define
name|SMS_CONTROL_MODE_PAGE
value|0x0A
define|#
directive|define
name|SMS_ALL_PAGES_PAGE
value|0x3F
define|#
directive|define
name|SMS_PAGE_CTRL_MASK
value|0xC0
define|#
directive|define
name|SMS_PAGE_CTRL_CURRENT
value|0x00
define|#
directive|define
name|SMS_PAGE_CTRL_CHANGEABLE
value|0x40
define|#
directive|define
name|SMS_PAGE_CTRL_DEFAULT
value|0x80
define|#
directive|define
name|SMS_PAGE_CTRL_SAVED
value|0xC0
name|u_int8_t
name|unused
decl_stmt|;
name|u_int8_t
name|length
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_mode_sense_10
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
comment|/* same bits as small version */
name|u_int8_t
name|page
decl_stmt|;
comment|/* same bits as small version */
name|u_int8_t
name|unused
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_mode_select_6
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
define|#
directive|define
name|SMS_SP
value|0x01
define|#
directive|define
name|SMS_PF
value|0x10
name|u_int8_t
name|unused
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|length
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_mode_select_10
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
comment|/* same bits as small version */
name|u_int8_t
name|unused
index|[
literal|5
index|]
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  * When sending a mode select to a tape drive, the medium type must be 0.  */
end_comment

begin_struct
struct|struct
name|scsi_mode_hdr_6
block|{
name|u_int8_t
name|datalen
decl_stmt|;
name|u_int8_t
name|medium_type
decl_stmt|;
name|u_int8_t
name|dev_specific
decl_stmt|;
name|u_int8_t
name|block_descr_len
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_mode_hdr_10
block|{
name|u_int8_t
name|datalen
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|medium_type
decl_stmt|;
name|u_int8_t
name|dev_specific
decl_stmt|;
name|u_int8_t
name|reserved
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|block_descr_len
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_mode_block_descr
block|{
name|u_int8_t
name|density_code
decl_stmt|;
name|u_int8_t
name|num_blocks
index|[
literal|3
index|]
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|block_len
index|[
literal|3
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_log_sense
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
define|#
directive|define
name|SLS_SP
value|0x01
define|#
directive|define
name|SLS_PPC
value|0x02
name|u_int8_t
name|page
decl_stmt|;
define|#
directive|define
name|SLS_PAGE_CODE
value|0x3F
define|#
directive|define
name|SLS_ALL_PAGES_PAGE
value|0x00
define|#
directive|define
name|SLS_OVERRUN_PAGE
value|0x01
define|#
directive|define
name|SLS_ERROR_WRITE_PAGE
value|0x02
define|#
directive|define
name|SLS_ERROR_READ_PAGE
value|0x03
define|#
directive|define
name|SLS_ERROR_READREVERSE_PAGE
value|0x04
define|#
directive|define
name|SLS_ERROR_VERIFY_PAGE
value|0x05
define|#
directive|define
name|SLS_ERROR_NONMEDIUM_PAGE
value|0x06
define|#
directive|define
name|SLS_ERROR_LASTN_PAGE
value|0x07
define|#
directive|define
name|SLS_PAGE_CTRL_MASK
value|0xC0
define|#
directive|define
name|SLS_PAGE_CTRL_THRESHOLD
value|0x00
define|#
directive|define
name|SLS_PAGE_CTRL_CUMULATIVE
value|0x40
define|#
directive|define
name|SLS_PAGE_CTRL_THRESH_DEFAULT
value|0x80
define|#
directive|define
name|SLS_PAGE_CTRL_CUMUL_DEFAULT
value|0xC0
name|u_int8_t
name|reserved
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|paramptr
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_log_select
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
comment|/*	SLS_SP				0x01 */
define|#
directive|define
name|SLS_PCR
value|0x02
name|u_int8_t
name|page
decl_stmt|;
comment|/*	SLS_PAGE_CTRL_MASK		0xC0 */
comment|/*	SLS_PAGE_CTRL_THRESHOLD		0x00 */
comment|/*	SLS_PAGE_CTRL_CUMULATIVE	0x40 */
comment|/*	SLS_PAGE_CTRL_THRESH_DEFAULT	0x80 */
comment|/*	SLS_PAGE_CTRL_CUMUL_DEFAULT	0xC0 */
name|u_int8_t
name|reserved
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_log_header
block|{
name|u_int8_t
name|page
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|datalen
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_log_param_header
block|{
name|u_int8_t
name|param_code
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|param_control
decl_stmt|;
define|#
directive|define
name|SLP_LP
value|0x01
define|#
directive|define
name|SLP_LBIN
value|0x02
define|#
directive|define
name|SLP_TMC_MASK
value|0x0C
define|#
directive|define
name|SLP_TMC_ALWAYS
value|0x00
define|#
directive|define
name|SLP_TMC_EQUAL
value|0x04
define|#
directive|define
name|SLP_TMC_NOTEQUAL
value|0x08
define|#
directive|define
name|SLP_TMC_GREATER
value|0x0C
define|#
directive|define
name|SLP_ETC
value|0x10
define|#
directive|define
name|SLP_TSD
value|0x20
define|#
directive|define
name|SLP_DS
value|0x40
define|#
directive|define
name|SLP_DU
value|0x80
name|u_int8_t
name|param_len
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_control_page
block|{
name|u_int8_t
name|page_code
decl_stmt|;
name|u_int8_t
name|page_length
decl_stmt|;
name|u_int8_t
name|rlec
decl_stmt|;
define|#
directive|define
name|SCB_RLEC
value|0x01
comment|/*Report Log Exception Cond*/
name|u_int8_t
name|queue_flags
decl_stmt|;
define|#
directive|define
name|SCP_QUEUE_ALG_MASK
value|0xF0
define|#
directive|define
name|SCP_QUEUE_ALG_RESTRICTED
value|0x00
define|#
directive|define
name|SCP_QUEUE_ALG_UNRESTRICTED
value|0x10
define|#
directive|define
name|SCP_QUEUE_ERR
value|0x02
comment|/*Queued I/O aborted for CACs*/
define|#
directive|define
name|SCP_QUEUE_DQUE
value|0x01
comment|/*Queued I/O disabled*/
name|u_int8_t
name|eca_and_aen
decl_stmt|;
define|#
directive|define
name|SCP_EECA
value|0x80
comment|/*Enable Extended CA*/
define|#
directive|define
name|SCP_RAENP
value|0x04
comment|/*Ready AEN Permission*/
define|#
directive|define
name|SCP_UAAENP
value|0x02
comment|/*UA AEN Permission*/
define|#
directive|define
name|SCP_EAENP
value|0x01
comment|/*Error AEN Permission*/
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|aen_holdoff_period
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_reserve
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|unused
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|length
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_release
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|unused
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|length
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_prevent
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|unused
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|how
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|PR_PREVENT
value|0x01
end_define

begin_define
define|#
directive|define
name|PR_ALLOW
value|0x00
end_define

begin_struct
struct|struct
name|scsi_sync_cache
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|begin_lba
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|lb_count
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_changedef
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|unused1
decl_stmt|;
name|u_int8_t
name|how
decl_stmt|;
name|u_int8_t
name|unused
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|datalen
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_read_buffer
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
define|#
directive|define
name|RWB_MODE
value|0x07
define|#
directive|define
name|RWB_MODE_HDR_DATA
value|0x00
define|#
directive|define
name|RWB_MODE_DATA
value|0x02
define|#
directive|define
name|RWB_MODE_DOWNLOAD
value|0x04
define|#
directive|define
name|RWB_MODE_DOWNLOAD_SAVE
value|0x05
name|u_int8_t
name|buffer_id
decl_stmt|;
name|u_int8_t
name|offset
index|[
literal|3
index|]
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|3
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_write_buffer
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|buffer_id
decl_stmt|;
name|u_int8_t
name|offset
index|[
literal|3
index|]
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|3
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_rw_6
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|addr
index|[
literal|3
index|]
decl_stmt|;
comment|/* only 5 bits are valid in the MSB address byte */
define|#
directive|define
name|SRW_TOPADDR
value|0x1F
name|u_int8_t
name|length
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_rw_10
block|{
name|u_int8_t
name|opcode
decl_stmt|;
define|#
directive|define
name|SRW10_RELADDR
value|0x01
define|#
directive|define
name|SRW10_FUA
value|0x08
define|#
directive|define
name|SRW10_DPO
value|0x10
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|addr
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_rw_12
block|{
name|u_int8_t
name|opcode
decl_stmt|;
define|#
directive|define
name|SRW12_RELADDR
value|0x01
define|#
directive|define
name|SRW12_FUA
value|0x08
define|#
directive|define
name|SRW12_DPO
value|0x10
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|addr
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_start_stop_unit
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
define|#
directive|define
name|SSS_IMMED
value|0x01
name|u_int8_t
name|reserved
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|how
decl_stmt|;
define|#
directive|define
name|SSS_START
value|0x01
define|#
directive|define
name|SSS_LOEJ
value|0x02
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|SC_SCSI_1
value|0x01
end_define

begin_define
define|#
directive|define
name|SC_SCSI_2
value|0x03
end_define

begin_comment
comment|/*  * Opcodes  */
end_comment

begin_define
define|#
directive|define
name|TEST_UNIT_READY
value|0x00
end_define

begin_define
define|#
directive|define
name|REQUEST_SENSE
value|0x03
end_define

begin_define
define|#
directive|define
name|READ_6
value|0x08
end_define

begin_define
define|#
directive|define
name|WRITE_6
value|0x0a
end_define

begin_define
define|#
directive|define
name|INQUIRY
value|0x12
end_define

begin_define
define|#
directive|define
name|MODE_SELECT_6
value|0x15
end_define

begin_define
define|#
directive|define
name|MODE_SENSE_6
value|0x1a
end_define

begin_define
define|#
directive|define
name|START_STOP_UNIT
value|0x1b
end_define

begin_define
define|#
directive|define
name|START_STOP
value|0x1b
end_define

begin_define
define|#
directive|define
name|RESERVE
value|0x16
end_define

begin_define
define|#
directive|define
name|RELEASE
value|0x17
end_define

begin_define
define|#
directive|define
name|RECEIVE_DIAGNOSTIC
value|0x1c
end_define

begin_define
define|#
directive|define
name|SEND_DIAGNOSTIC
value|0x1d
end_define

begin_define
define|#
directive|define
name|PREVENT_ALLOW
value|0x1e
end_define

begin_define
define|#
directive|define
name|READ_CAPACITY
value|0x25
end_define

begin_define
define|#
directive|define
name|READ_10
value|0x28
end_define

begin_define
define|#
directive|define
name|WRITE_10
value|0x2a
end_define

begin_define
define|#
directive|define
name|POSITION_TO_ELEMENT
value|0x2b
end_define

begin_define
define|#
directive|define
name|SYNCHRONIZE_CACHE
value|0x35
end_define

begin_define
define|#
directive|define
name|WRITE_BUFFER
value|0x3b
end_define

begin_define
define|#
directive|define
name|READ_BUFFER
value|0x3c
end_define

begin_define
define|#
directive|define
name|CHANGE_DEFINITION
value|0x40
end_define

begin_define
define|#
directive|define
name|LOG_SELECT
value|0x4c
end_define

begin_define
define|#
directive|define
name|LOG_SENSE
value|0x4d
end_define

begin_define
define|#
directive|define
name|MODE_SELECT_10
value|0x55
end_define

begin_define
define|#
directive|define
name|MODE_SENSE_10
value|0x5A
end_define

begin_define
define|#
directive|define
name|MOVE_MEDIUM
value|0xa5
end_define

begin_define
define|#
directive|define
name|READ_12
value|0xa8
end_define

begin_define
define|#
directive|define
name|WRITE_12
value|0xaa
end_define

begin_define
define|#
directive|define
name|READ_ELEMENT_STATUS
value|0xb8
end_define

begin_comment
comment|/*  * Device Types  */
end_comment

begin_define
define|#
directive|define
name|T_DIRECT
value|0x00
end_define

begin_define
define|#
directive|define
name|T_SEQUENTIAL
value|0x01
end_define

begin_define
define|#
directive|define
name|T_PRINTER
value|0x02
end_define

begin_define
define|#
directive|define
name|T_PROCESSOR
value|0x03
end_define

begin_define
define|#
directive|define
name|T_WORM
value|0x04
end_define

begin_define
define|#
directive|define
name|T_CDROM
value|0x05
end_define

begin_define
define|#
directive|define
name|T_SCANNER
value|0x06
end_define

begin_define
define|#
directive|define
name|T_OPTICAL
value|0x07
end_define

begin_define
define|#
directive|define
name|T_CHANGER
value|0x08
end_define

begin_define
define|#
directive|define
name|T_COMM
value|0x09
end_define

begin_define
define|#
directive|define
name|T_ASC0
value|0x0a
end_define

begin_define
define|#
directive|define
name|T_ASC1
value|0x0b
end_define

begin_define
define|#
directive|define
name|T_STORARRAY
value|0x0c
end_define

begin_define
define|#
directive|define
name|T_ENCLOSURE
value|0x0d
end_define

begin_define
define|#
directive|define
name|T_RBC
value|0x0e
end_define

begin_define
define|#
directive|define
name|T_OCRW
value|0x0f
end_define

begin_define
define|#
directive|define
name|T_NODEVICE
value|0x1F
end_define

begin_define
define|#
directive|define
name|T_ANY
value|0xFF
end_define

begin_comment
comment|/* Used in Quirk table matches */
end_comment

begin_define
define|#
directive|define
name|T_REMOV
value|1
end_define

begin_define
define|#
directive|define
name|T_FIXED
value|0
end_define

begin_comment
comment|/*  * This length is the initial inquiry length used by the probe code, as      * well as the legnth necessary for scsi_print_inquiry() to function   * correctly.  If either use requires a different length in the future,   * the two values should be de-coupled.  */
end_comment

begin_define
define|#
directive|define
name|SHORT_INQUIRY_LENGTH
value|36
end_define

begin_struct
struct|struct
name|scsi_inquiry_data
block|{
name|u_int8_t
name|device
decl_stmt|;
define|#
directive|define
name|SID_TYPE
parameter_list|(
name|inq_data
parameter_list|)
value|((inq_data)->device& 0x1f)
define|#
directive|define
name|SID_QUAL
parameter_list|(
name|inq_data
parameter_list|)
value|(((inq_data)->device& 0xE0)>> 5)
define|#
directive|define
name|SID_QUAL_LU_CONNECTED
value|0x00
comment|/* 					 * The specified peripheral device 					 * type is currently connected to 					 * logical unit.  If the target cannot 					 * determine whether or not a physical 					 * device is currently connected, it 					 * shall also use this peripheral 					 * qualifier when returning the INQUIRY 					 * data.  This peripheral qualifier 					 * does not mean that the device is 					 * ready for access by the initiator. 					 */
define|#
directive|define
name|SID_QUAL_LU_OFFLINE
value|0x01
comment|/* 					 * The target is capable of supporting 					 * the specified peripheral device type 					 * on this logical unit; however, the 					 * physical device is not currently 					 * connected to this logical unit. 					 */
define|#
directive|define
name|SID_QUAL_RSVD
value|0x02
define|#
directive|define
name|SID_QUAL_BAD_LU
value|0x03
comment|/* 					 * The target is not capable of 					 * supporting a physical device on 					 * this logical unit. For this 					 * peripheral qualifier the peripheral 					 * device type shall be set to 1Fh to 					 * provide compatibility with previous 					 * versions of SCSI. All other 					 * peripheral device type values are 					 * reserved for this peripheral 					 * qualifier. 					 */
define|#
directive|define
name|SID_QUAL_IS_VENDOR_UNIQUE
parameter_list|(
name|inq_data
parameter_list|)
value|((SID_QUAL(inq_data)& 0x08) != 0)
name|u_int8_t
name|dev_qual2
decl_stmt|;
define|#
directive|define
name|SID_QUAL2
value|0x7F
define|#
directive|define
name|SID_IS_REMOVABLE
parameter_list|(
name|inq_data
parameter_list|)
value|(((inq_data)->dev_qual2& 0x80) != 0)
name|u_int8_t
name|version
decl_stmt|;
define|#
directive|define
name|SID_ANSI_REV
parameter_list|(
name|inq_data
parameter_list|)
value|((inq_data)->version& 0x07)
define|#
directive|define
name|SCSI_REV_0
value|0
define|#
directive|define
name|SCSI_REV_CCS
value|1
define|#
directive|define
name|SCSI_REV_2
value|2
define|#
directive|define
name|SCSI_REV_SPC
value|3
define|#
directive|define
name|SCSI_REV_SPC2
value|4
define|#
directive|define
name|SID_ECMA
value|0x38
define|#
directive|define
name|SID_ISO
value|0xC0
name|u_int8_t
name|response_format
decl_stmt|;
define|#
directive|define
name|SID_AENC
value|0x80
define|#
directive|define
name|SID_TrmIOP
value|0x40
name|u_int8_t
name|additional_length
decl_stmt|;
name|u_int8_t
name|reserved
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|flags
decl_stmt|;
define|#
directive|define
name|SID_SftRe
value|0x01
define|#
directive|define
name|SID_CmdQue
value|0x02
define|#
directive|define
name|SID_Linked
value|0x08
define|#
directive|define
name|SID_Sync
value|0x10
define|#
directive|define
name|SID_WBus16
value|0x20
define|#
directive|define
name|SID_WBus32
value|0x40
define|#
directive|define
name|SID_RelAdr
value|0x80
define|#
directive|define
name|SID_VENDOR_SIZE
value|8
name|char
name|vendor
index|[
name|SID_VENDOR_SIZE
index|]
decl_stmt|;
define|#
directive|define
name|SID_PRODUCT_SIZE
value|16
name|char
name|product
index|[
name|SID_PRODUCT_SIZE
index|]
decl_stmt|;
define|#
directive|define
name|SID_REVISION_SIZE
value|4
name|char
name|revision
index|[
name|SID_REVISION_SIZE
index|]
decl_stmt|;
comment|/* 	 * The following fields were taken from SCSI Primary Commands - 2 	 * (SPC-2) Revision 14, Dated 11 November 1999 	 */
define|#
directive|define
name|SID_VENDOR_SPECIFIC_0_SIZE
value|20
name|u_int8_t
name|vendor_specific0
index|[
name|SID_VENDOR_SPECIFIC_0_SIZE
index|]
decl_stmt|;
comment|/* 	 * An extension of SCSI Parallel Specific Values 	 */
define|#
directive|define
name|SID_SPI_IUS
value|0x01
define|#
directive|define
name|SID_SPI_QAS
value|0x02
define|#
directive|define
name|SID_SPI_CLOCK_ST
value|0x00
define|#
directive|define
name|SID_SPI_CLOCK_DT
value|0x04
define|#
directive|define
name|SID_SPI_CLOCK_DT_ST
value|0x0C
define|#
directive|define
name|SID_SPI_MASK
value|0x0F
name|u_int8_t
name|spi3data
decl_stmt|;
name|u_int8_t
name|reserved2
decl_stmt|;
comment|/* 	 * Version Descriptors, stored 2 byte values. 	 */
name|u_int8_t
name|version1
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|version2
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|version3
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|version4
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|version5
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|version6
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|version7
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|version8
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|reserved3
index|[
literal|22
index|]
decl_stmt|;
define|#
directive|define
name|SID_VENDOR_SPECIFIC_1_SIZE
value|160
name|u_int8_t
name|vendor_specific1
index|[
name|SID_VENDOR_SPECIFIC_1_SIZE
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_vpd_unit_serial_number
block|{
name|u_int8_t
name|device
decl_stmt|;
name|u_int8_t
name|page_code
decl_stmt|;
define|#
directive|define
name|SVPD_UNIT_SERIAL_NUMBER
value|0x80
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|length
decl_stmt|;
comment|/* serial number length */
define|#
directive|define
name|SVPD_SERIAL_NUM_SIZE
value|251
name|u_int8_t
name|serial_num
index|[
name|SVPD_SERIAL_NUM_SIZE
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_read_capacity
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
name|byte2
decl_stmt|;
name|u_int8_t
name|addr
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|unused
index|[
literal|3
index|]
decl_stmt|;
name|u_int8_t
name|control
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_read_capacity_data
block|{
name|u_int8_t
name|addr
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|length
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_sense_data
block|{
name|u_int8_t
name|error_code
decl_stmt|;
define|#
directive|define
name|SSD_ERRCODE
value|0x7F
define|#
directive|define
name|SSD_CURRENT_ERROR
value|0x70
define|#
directive|define
name|SSD_DEFERRED_ERROR
value|0x71
define|#
directive|define
name|SSD_ERRCODE_VALID
value|0x80
name|u_int8_t
name|segment
decl_stmt|;
name|u_int8_t
name|flags
decl_stmt|;
define|#
directive|define
name|SSD_KEY
value|0x0F
define|#
directive|define
name|SSD_KEY_NO_SENSE
value|0x00
define|#
directive|define
name|SSD_KEY_RECOVERED_ERROR
value|0x01
define|#
directive|define
name|SSD_KEY_NOT_READY
value|0x02
define|#
directive|define
name|SSD_KEY_MEDIUM_ERROR
value|0x03
define|#
directive|define
name|SSD_KEY_HARDWARE_ERROR
value|0x04
define|#
directive|define
name|SSD_KEY_ILLEGAL_REQUEST
value|0x05
define|#
directive|define
name|SSD_KEY_UNIT_ATTENTION
value|0x06
define|#
directive|define
name|SSD_KEY_DATA_PROTECT
value|0x07
define|#
directive|define
name|SSD_KEY_BLANK_CHECK
value|0x08
define|#
directive|define
name|SSD_KEY_Vendor_Specific
value|0x09
define|#
directive|define
name|SSD_KEY_COPY_ABORTED
value|0x0a
define|#
directive|define
name|SSD_KEY_ABORTED_COMMAND
value|0x0b
define|#
directive|define
name|SSD_KEY_EQUAL
value|0x0c
define|#
directive|define
name|SSD_KEY_VOLUME_OVERFLOW
value|0x0d
define|#
directive|define
name|SSD_KEY_MISCOMPARE
value|0x0e
define|#
directive|define
name|SSD_KEY_RESERVED
value|0x0f
define|#
directive|define
name|SSD_ILI
value|0x20
define|#
directive|define
name|SSD_EOM
value|0x40
define|#
directive|define
name|SSD_FILEMARK
value|0x80
name|u_int8_t
name|info
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|extra_len
decl_stmt|;
name|u_int8_t
name|cmd_spec_info
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|add_sense_code
decl_stmt|;
name|u_int8_t
name|add_sense_code_qual
decl_stmt|;
name|u_int8_t
name|fru
decl_stmt|;
name|u_int8_t
name|sense_key_spec
index|[
literal|3
index|]
decl_stmt|;
define|#
directive|define
name|SSD_SCS_VALID
value|0x80
define|#
directive|define
name|SSD_FIELDPTR_CMD
value|0x40
define|#
directive|define
name|SSD_BITPTR_VALID
value|0x08
define|#
directive|define
name|SSD_BITPTR_VALUE
value|0x07
define|#
directive|define
name|SSD_MIN_SIZE
value|18
name|u_int8_t
name|extra_bytes
index|[
literal|14
index|]
decl_stmt|;
define|#
directive|define
name|SSD_FULL_SIZE
value|sizeof(struct scsi_sense_data)
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_mode_header_6
block|{
name|u_int8_t
name|data_length
decl_stmt|;
comment|/* Sense data length */
name|u_int8_t
name|medium_type
decl_stmt|;
name|u_int8_t
name|dev_spec
decl_stmt|;
name|u_int8_t
name|blk_desc_len
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_mode_header_10
block|{
name|u_int8_t
name|data_length
index|[
literal|2
index|]
decl_stmt|;
comment|/* Sense data length */
name|u_int8_t
name|medium_type
decl_stmt|;
name|u_int8_t
name|dev_spec
decl_stmt|;
name|u_int8_t
name|unused
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|blk_desc_len
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_mode_page_header
block|{
name|u_int8_t
name|page_code
decl_stmt|;
name|u_int8_t
name|page_length
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_mode_blk_desc
block|{
name|u_int8_t
name|density
decl_stmt|;
name|u_int8_t
name|nblocks
index|[
literal|3
index|]
decl_stmt|;
name|u_int8_t
name|reserved
decl_stmt|;
name|u_int8_t
name|blklen
index|[
literal|3
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|SCSI_DEFAULT_DENSITY
value|0x00
end_define

begin_comment
comment|/* use 'default' density */
end_comment

begin_define
define|#
directive|define
name|SCSI_SAME_DENSITY
value|0x7f
end_define

begin_comment
comment|/* use 'same' density->= SCSI-2 only */
end_comment

begin_comment
comment|/*  * Status Byte  */
end_comment

begin_define
define|#
directive|define
name|SCSI_STATUS_OK
value|0x00
end_define

begin_define
define|#
directive|define
name|SCSI_STATUS_CHECK_COND
value|0x02
end_define

begin_define
define|#
directive|define
name|SCSI_STATUS_COND_MET
value|0x04
end_define

begin_define
define|#
directive|define
name|SCSI_STATUS_BUSY
value|0x08
end_define

begin_define
define|#
directive|define
name|SCSI_STATUS_INTERMED
value|0x10
end_define

begin_define
define|#
directive|define
name|SCSI_STATUS_INTERMED_COND_MET
value|0x14
end_define

begin_define
define|#
directive|define
name|SCSI_STATUS_RESERV_CONFLICT
value|0x18
end_define

begin_define
define|#
directive|define
name|SCSI_STATUS_CMD_TERMINATED
value|0x22
end_define

begin_comment
comment|/* Obsolete in SAM-2 */
end_comment

begin_define
define|#
directive|define
name|SCSI_STATUS_QUEUE_FULL
value|0x28
end_define

begin_define
define|#
directive|define
name|SCSI_STATUS_ACA_ACTIVE
value|0x30
end_define

begin_define
define|#
directive|define
name|SCSI_STATUS_TASK_ABORTED
value|0x40
end_define

begin_struct
struct|struct
name|scsi_inquiry_pattern
block|{
name|u_int8_t
name|type
decl_stmt|;
name|u_int8_t
name|media_type
decl_stmt|;
define|#
directive|define
name|SIP_MEDIA_REMOVABLE
value|0x01
define|#
directive|define
name|SIP_MEDIA_FIXED
value|0x02
specifier|const
name|char
modifier|*
name|vendor
decl_stmt|;
specifier|const
name|char
modifier|*
name|product
decl_stmt|;
specifier|const
name|char
modifier|*
name|revision
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_static_inquiry_pattern
block|{
name|u_int8_t
name|type
decl_stmt|;
name|u_int8_t
name|media_type
decl_stmt|;
name|char
name|vendor
index|[
name|SID_VENDOR_SIZE
operator|+
literal|1
index|]
decl_stmt|;
name|char
name|product
index|[
name|SID_PRODUCT_SIZE
operator|+
literal|1
index|]
decl_stmt|;
name|char
name|revision
index|[
name|SID_REVISION_SIZE
operator|+
literal|1
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_sense_quirk_entry
block|{
name|struct
name|scsi_inquiry_pattern
name|inq_pat
decl_stmt|;
name|int
name|num_sense_keys
decl_stmt|;
name|int
name|num_ascs
decl_stmt|;
name|struct
name|sense_key_table_entry
modifier|*
name|sense_key_info
decl_stmt|;
name|struct
name|asc_table_entry
modifier|*
name|asc_info
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|sense_key_table_entry
block|{
name|u_int8_t
name|sense_key
decl_stmt|;
name|u_int32_t
name|action
decl_stmt|;
specifier|const
name|char
modifier|*
name|desc
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|asc_table_entry
block|{
name|u_int8_t
name|asc
decl_stmt|;
name|u_int8_t
name|ascq
decl_stmt|;
name|u_int32_t
name|action
decl_stmt|;
specifier|const
name|char
modifier|*
name|desc
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|op_table_entry
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int16_t
name|opmask
decl_stmt|;
specifier|const
name|char
modifier|*
name|desc
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|scsi_op_quirk_entry
block|{
name|struct
name|scsi_inquiry_pattern
name|inq_pat
decl_stmt|;
name|int
name|num_ops
decl_stmt|;
name|struct
name|op_table_entry
modifier|*
name|op_table
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
enum|enum
block|{
name|SSS_FLAG_NONE
init|=
literal|0x00
block|,
name|SSS_FLAG_PRINT_COMMAND
init|=
literal|0x01
block|}
name|scsi_sense_string_flags
typedef|;
end_typedef

begin_struct_decl
struct_decl|struct
name|ccb_scsiio
struct_decl|;
end_struct_decl

begin_struct_decl
struct_decl|struct
name|cam_periph
struct_decl|;
end_struct_decl

begin_union_decl
union_decl|union
name|ccb
union_decl|;
end_union_decl

begin_ifndef
ifndef|#
directive|ifndef
name|_KERNEL
end_ifndef

begin_struct_decl
struct_decl|struct
name|cam_device
struct_decl|;
end_struct_decl

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|extern
specifier|const
name|char
modifier|*
name|scsi_sense_key_text
index|[]
decl_stmt|;
end_decl_stmt

begin_struct_decl
struct_decl|struct
name|sbuf
struct_decl|;
end_struct_decl

begin_function_decl
name|__BEGIN_DECLS
name|void
name|scsi_sense_desc
parameter_list|(
name|int
name|sense_key
parameter_list|,
name|int
name|asc
parameter_list|,
name|int
name|ascq
parameter_list|,
name|struct
name|scsi_inquiry_data
modifier|*
name|inq_data
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|sense_key_desc
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|asc_desc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|scsi_sense_action
name|scsi_error_action
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|struct
name|scsi_inquiry_data
modifier|*
name|inq_data
parameter_list|,
name|u_int32_t
name|sense_flags
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|const
name|char
modifier|*
name|scsi_status_string
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|)
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|_KERNEL
end_ifdef

begin_function_decl
name|int
name|scsi_command_string
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|struct
name|sbuf
modifier|*
name|sb
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|scsi_sense_sbuf
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|struct
name|sbuf
modifier|*
name|sb
parameter_list|,
name|scsi_sense_string_flags
name|flags
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|scsi_sense_string
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|char
modifier|*
name|str
parameter_list|,
name|int
name|str_len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_sense_print
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|scsi_interpret_sense
parameter_list|(
name|union
name|ccb
modifier|*
name|ccb
parameter_list|,
name|u_int32_t
name|sense_flags
parameter_list|,
name|u_int32_t
modifier|*
name|relsim_flags
parameter_list|,
name|u_int32_t
modifier|*
name|reduction
parameter_list|,
name|u_int32_t
modifier|*
name|timeout
parameter_list|,
name|scsi_sense_action
name|error_action
parameter_list|)
function_decl|;
end_function_decl

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* _KERNEL */
end_comment

begin_function_decl
name|int
name|scsi_command_string
parameter_list|(
name|struct
name|cam_device
modifier|*
name|device
parameter_list|,
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|struct
name|sbuf
modifier|*
name|sb
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|scsi_sense_sbuf
parameter_list|(
name|struct
name|cam_device
modifier|*
name|device
parameter_list|,
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|struct
name|sbuf
modifier|*
name|sb
parameter_list|,
name|scsi_sense_string_flags
name|flags
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|scsi_sense_string
parameter_list|(
name|struct
name|cam_device
modifier|*
name|device
parameter_list|,
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|char
modifier|*
name|str
parameter_list|,
name|int
name|str_len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_sense_print
parameter_list|(
name|struct
name|cam_device
modifier|*
name|device
parameter_list|,
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|FILE
modifier|*
name|ofile
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|scsi_interpret_sense
parameter_list|(
name|struct
name|cam_device
modifier|*
name|device
parameter_list|,
name|union
name|ccb
modifier|*
name|ccb
parameter_list|,
name|u_int32_t
name|sense_flags
parameter_list|,
name|u_int32_t
modifier|*
name|relsim_flags
parameter_list|,
name|u_int32_t
modifier|*
name|reduction
parameter_list|,
name|u_int32_t
modifier|*
name|timeout
parameter_list|,
name|scsi_sense_action
name|error_action
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* _KERNEL */
end_comment

begin_define
define|#
directive|define
name|SF_RETRY_UA
value|0x01
end_define

begin_define
define|#
directive|define
name|SF_NO_PRINT
value|0x02
end_define

begin_define
define|#
directive|define
name|SF_QUIET_IR
value|0x04
end_define

begin_comment
comment|/* Be quiet about Illegal Request reponses */
end_comment

begin_define
define|#
directive|define
name|SF_PRINT_ALWAYS
value|0x08
end_define

begin_function_decl
specifier|const
name|char
modifier|*
name|scsi_op_desc
parameter_list|(
name|u_int16_t
name|opcode
parameter_list|,
name|struct
name|scsi_inquiry_data
modifier|*
name|inq_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|scsi_cdb_string
parameter_list|(
name|u_int8_t
modifier|*
name|cdb_ptr
parameter_list|,
name|char
modifier|*
name|cdb_string
parameter_list|,
name|size_t
name|len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_print_inquiry
parameter_list|(
name|struct
name|scsi_inquiry_data
modifier|*
name|inq_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|u_int
name|scsi_calc_syncsrate
parameter_list|(
name|u_int
name|period_factor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|u_int
name|scsi_calc_syncparam
parameter_list|(
name|u_int
name|period
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_test_unit_ready
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_request_sense
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|void
modifier|*
name|data_ptr
parameter_list|,
name|u_int8_t
name|dxfer_len
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_inquiry
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|u_int8_t
modifier|*
name|inq_buf
parameter_list|,
name|u_int32_t
name|inq_len
parameter_list|,
name|int
name|evpd
parameter_list|,
name|u_int8_t
name|page_code
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_mode_sense
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|int
name|dbd
parameter_list|,
name|u_int8_t
name|page_code
parameter_list|,
name|u_int8_t
name|page
parameter_list|,
name|u_int8_t
modifier|*
name|param_buf
parameter_list|,
name|u_int32_t
name|param_len
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_mode_select
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|int
name|scsi_page_fmt
parameter_list|,
name|int
name|save_pages
parameter_list|,
name|u_int8_t
modifier|*
name|param_buf
parameter_list|,
name|u_int32_t
name|param_len
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_log_sense
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|u_int8_t
name|page_code
parameter_list|,
name|u_int8_t
name|page
parameter_list|,
name|int
name|save_pages
parameter_list|,
name|int
name|ppc
parameter_list|,
name|u_int32_t
name|paramptr
parameter_list|,
name|u_int8_t
modifier|*
name|param_buf
parameter_list|,
name|u_int32_t
name|param_len
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_log_select
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|u_int8_t
name|page_code
parameter_list|,
name|int
name|save_pages
parameter_list|,
name|int
name|pc_reset
parameter_list|,
name|u_int8_t
modifier|*
name|param_buf
parameter_list|,
name|u_int32_t
name|param_len
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_read_capacity
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|struct
name|scsi_read_capacity_data
modifier|*
name|rcap_buf
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_prevent
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|u_int8_t
name|action
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_synchronize_cache
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|u_int32_t
name|begin_lba
parameter_list|,
name|u_int16_t
name|lb_count
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_read_write
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|int
name|readop
parameter_list|,
name|u_int8_t
name|byte2
parameter_list|,
name|int
name|minimum_cmd_size
parameter_list|,
name|u_int32_t
name|lba
parameter_list|,
name|u_int32_t
name|block_count
parameter_list|,
name|u_int8_t
modifier|*
name|data_ptr
parameter_list|,
name|u_int32_t
name|dxfer_len
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|scsi_start_stop
parameter_list|(
name|struct
name|ccb_scsiio
modifier|*
name|csio
parameter_list|,
name|u_int32_t
name|retries
parameter_list|,
name|void
function_decl|(
modifier|*
name|cbfcnp
function_decl|)
parameter_list|(
name|struct
name|cam_periph
modifier|*
parameter_list|,
name|union
name|ccb
modifier|*
parameter_list|)
parameter_list|,
name|u_int8_t
name|tag_action
parameter_list|,
name|int
name|start
parameter_list|,
name|int
name|load_eject
parameter_list|,
name|int
name|immediate
parameter_list|,
name|u_int8_t
name|sense_len
parameter_list|,
name|u_int32_t
name|timeout
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|scsi_inquiry_match
parameter_list|(
name|caddr_t
name|inqbuffer
parameter_list|,
name|caddr_t
name|table_entry
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|scsi_static_inquiry_match
parameter_list|(
name|caddr_t
name|inqbuffer
parameter_list|,
name|caddr_t
name|table_entry
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|__inline
name|void
name|scsi_extract_sense
parameter_list|(
name|struct
name|scsi_sense_data
modifier|*
name|sense
parameter_list|,
name|int
modifier|*
name|error_code
parameter_list|,
name|int
modifier|*
name|sense_key
parameter_list|,
name|int
modifier|*
name|asc
parameter_list|,
name|int
modifier|*
name|ascq
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|__inline
name|void
name|scsi_ulto2b
parameter_list|(
name|u_int32_t
name|val
parameter_list|,
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|__inline
name|void
name|scsi_ulto3b
parameter_list|(
name|u_int32_t
name|val
parameter_list|,
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|__inline
name|void
name|scsi_ulto4b
parameter_list|(
name|u_int32_t
name|val
parameter_list|,
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|__inline
name|u_int32_t
name|scsi_2btoul
parameter_list|(
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|__inline
name|u_int32_t
name|scsi_3btoul
parameter_list|(
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|__inline
name|int32_t
name|scsi_3btol
parameter_list|(
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|__inline
name|u_int32_t
name|scsi_4btoul
parameter_list|(
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|__inline
name|void
modifier|*
name|find_mode_page_6
parameter_list|(
name|struct
name|scsi_mode_header_6
modifier|*
name|mode_header
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|__inline
name|void
modifier|*
name|find_mode_page_10
parameter_list|(
name|struct
name|scsi_mode_header_10
modifier|*
name|mode_header
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
name|__inline
name|void
name|scsi_extract_sense
parameter_list|(
name|struct
name|scsi_sense_data
modifier|*
name|sense
parameter_list|,
name|int
modifier|*
name|error_code
parameter_list|,
name|int
modifier|*
name|sense_key
parameter_list|,
name|int
modifier|*
name|asc
parameter_list|,
name|int
modifier|*
name|ascq
parameter_list|)
block|{
operator|*
name|error_code
operator|=
name|sense
operator|->
name|error_code
operator|&
name|SSD_ERRCODE
expr_stmt|;
operator|*
name|sense_key
operator|=
name|sense
operator|->
name|flags
operator|&
name|SSD_KEY
expr_stmt|;
operator|*
name|asc
operator|=
operator|(
name|sense
operator|->
name|extra_len
operator|>=
literal|5
operator|)
condition|?
name|sense
operator|->
name|add_sense_code
else|:
literal|0
expr_stmt|;
operator|*
name|ascq
operator|=
operator|(
name|sense
operator|->
name|extra_len
operator|>=
literal|6
operator|)
condition|?
name|sense
operator|->
name|add_sense_code_qual
else|:
literal|0
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|__inline
name|void
name|scsi_ulto2b
parameter_list|(
name|u_int32_t
name|val
parameter_list|,
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
block|{
name|bytes
index|[
literal|0
index|]
operator|=
operator|(
name|val
operator|>>
literal|8
operator|)
operator|&
literal|0xff
expr_stmt|;
name|bytes
index|[
literal|1
index|]
operator|=
name|val
operator|&
literal|0xff
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|__inline
name|void
name|scsi_ulto3b
parameter_list|(
name|u_int32_t
name|val
parameter_list|,
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
block|{
name|bytes
index|[
literal|0
index|]
operator|=
operator|(
name|val
operator|>>
literal|16
operator|)
operator|&
literal|0xff
expr_stmt|;
name|bytes
index|[
literal|1
index|]
operator|=
operator|(
name|val
operator|>>
literal|8
operator|)
operator|&
literal|0xff
expr_stmt|;
name|bytes
index|[
literal|2
index|]
operator|=
name|val
operator|&
literal|0xff
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|__inline
name|void
name|scsi_ulto4b
parameter_list|(
name|u_int32_t
name|val
parameter_list|,
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
block|{
name|bytes
index|[
literal|0
index|]
operator|=
operator|(
name|val
operator|>>
literal|24
operator|)
operator|&
literal|0xff
expr_stmt|;
name|bytes
index|[
literal|1
index|]
operator|=
operator|(
name|val
operator|>>
literal|16
operator|)
operator|&
literal|0xff
expr_stmt|;
name|bytes
index|[
literal|2
index|]
operator|=
operator|(
name|val
operator|>>
literal|8
operator|)
operator|&
literal|0xff
expr_stmt|;
name|bytes
index|[
literal|3
index|]
operator|=
name|val
operator|&
literal|0xff
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|__inline
name|u_int32_t
name|scsi_2btoul
parameter_list|(
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
block|{
name|u_int32_t
name|rv
decl_stmt|;
name|rv
operator|=
operator|(
name|bytes
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|bytes
index|[
literal|1
index|]
expr_stmt|;
return|return
operator|(
name|rv
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|__inline
name|u_int32_t
name|scsi_3btoul
parameter_list|(
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
block|{
name|u_int32_t
name|rv
decl_stmt|;
name|rv
operator|=
operator|(
name|bytes
index|[
literal|0
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|bytes
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|bytes
index|[
literal|2
index|]
expr_stmt|;
return|return
operator|(
name|rv
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|__inline
name|int32_t
name|scsi_3btol
parameter_list|(
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
block|{
name|u_int32_t
name|rc
init|=
name|scsi_3btoul
argument_list|(
name|bytes
argument_list|)
decl_stmt|;
if|if
condition|(
name|rc
operator|&
literal|0x00800000
condition|)
name|rc
operator||=
literal|0xff000000
expr_stmt|;
return|return
operator|(
name|int32_t
operator|)
name|rc
return|;
block|}
end_function

begin_function
specifier|static
name|__inline
name|u_int32_t
name|scsi_4btoul
parameter_list|(
name|u_int8_t
modifier|*
name|bytes
parameter_list|)
block|{
name|u_int32_t
name|rv
decl_stmt|;
name|rv
operator|=
operator|(
name|bytes
index|[
literal|0
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
name|bytes
index|[
literal|1
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|bytes
index|[
literal|2
index|]
operator|<<
literal|8
operator|)
operator||
name|bytes
index|[
literal|3
index|]
expr_stmt|;
return|return
operator|(
name|rv
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Given the pointer to a returned mode sense buffer, return a pointer to  * the start of the first mode page.  */
end_comment

begin_function
specifier|static
name|__inline
name|void
modifier|*
name|find_mode_page_6
parameter_list|(
name|struct
name|scsi_mode_header_6
modifier|*
name|mode_header
parameter_list|)
block|{
name|void
modifier|*
name|page_start
decl_stmt|;
name|page_start
operator|=
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
name|u_int8_t
operator|*
operator|)
operator|&
name|mode_header
index|[
literal|1
index|]
operator|+
name|mode_header
operator|->
name|blk_desc_len
operator|)
expr_stmt|;
return|return
operator|(
name|page_start
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|__inline
name|void
modifier|*
name|find_mode_page_10
parameter_list|(
name|struct
name|scsi_mode_header_10
modifier|*
name|mode_header
parameter_list|)
block|{
name|void
modifier|*
name|page_start
decl_stmt|;
name|page_start
operator|=
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
name|u_int8_t
operator|*
operator|)
operator|&
name|mode_header
index|[
literal|1
index|]
operator|+
name|scsi_2btoul
argument_list|(
name|mode_header
operator|->
name|blk_desc_len
argument_list|)
operator|)
expr_stmt|;
return|return
operator|(
name|page_start
operator|)
return|;
block|}
end_function

begin_macro
name|__END_DECLS
end_macro

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*_SCSI_SCSI_ALL_H*/
end_comment

end_unit

