begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $FreeBSD$  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|_MACHINE_HYPERVISOR_API_H
end_ifndef

begin_define
define|#
directive|define
name|_MACHINE_HYPERVISOR_API_H
end_define

begin_include
include|#
directive|include
file|<machine/hypervisorvar.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|_ASM
end_ifndef

begin_typedef
typedef|typedef
name|uint64_t
name|devhandle_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|uint64_t
name|pci_device_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|uint32_t
name|pci_config_offset_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|uint8_t
name|pci_config_size_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
union|union
name|pci_cfg_data
block|{
name|uint8_t
name|b
decl_stmt|;
name|uint16_t
name|w
decl_stmt|;
name|uint32_t
name|dw
decl_stmt|;
name|uint64_t
name|qw
decl_stmt|;
block|}
name|pci_cfg_data_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|uint64_t
name|tsbid_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|uint32_t
name|pages_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
name|io_attributes
block|{
name|PCI_MAP_ATTR_READ
init|=
operator|(
name|uint32_t
operator|)
literal|0x01
block|,
name|PCI_MAP_ATTR_WRITE
init|=
operator|(
name|uint32_t
operator|)
literal|0x02
block|, }
name|io_attributes_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
name|io_sync_direction
block|{
name|IO_SYNC_DEVICE
init|=
operator|(
name|uint32_t
operator|)
literal|0x01
block|,
name|IO_SYNC_CPU
init|=
operator|(
name|uint32_t
operator|)
literal|0x02
block|, }
name|io_sync_direction_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|uint64_t
name|io_page_list_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|uint64_t
name|r_addr_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|uint64_t
name|io_addr_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
name|trap_trace_entry
block|{
name|uint8_t
name|tte_type
decl_stmt|;
comment|/* Hypervisor or guest entry. */
name|uint8_t
name|tte_hpstat
decl_stmt|;
comment|/* Hyper-privileged state. */
name|uint8_t
name|tte_tl
decl_stmt|;
comment|/* Trap level. */
name|uint8_t
name|tte_gl
decl_stmt|;
comment|/* Global register level. */
name|uint16_t
name|tte_tt
decl_stmt|;
comment|/* Trap type.*/
name|uint16_t
name|tte_tag
decl_stmt|;
comment|/* Extended trap identifier. */
name|uint64_t
name|tte_tstate
decl_stmt|;
comment|/* Trap state. */
name|uint64_t
name|tte_tick
decl_stmt|;
comment|/* Tick. */
name|uint64_t
name|tte_tpc
decl_stmt|;
comment|/* Trap PC. */
name|uint64_t
name|tte_f1
decl_stmt|;
comment|/* Entry specific. */
name|uint64_t
name|tte_f2
decl_stmt|;
comment|/* Entry specific. */
name|uint64_t
name|tte_f3
decl_stmt|;
comment|/* Entry specific. */
name|uint64_t
name|tte_f4
decl_stmt|;
comment|/* Entry specific. */
block|}
name|trap_trace_entry_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
name|ldc_state_info
block|{
name|uint64_t
name|lsi_head_offset
decl_stmt|;
name|uint64_t
name|lsi_tail_offset
decl_stmt|;
name|uint64_t
name|lse_channel_state
decl_stmt|;
block|}
name|ldc_state_info_t
typedef|;
end_typedef

begin_define
define|#
directive|define
name|LDC_CHANNEL_DOWN
value|0
end_define

begin_define
define|#
directive|define
name|LDC_CHANNEL_UP
value|1
end_define

begin_function_decl
specifier|extern
name|uint64_t
name|hv_mmu_map_perm_addr
parameter_list|(
name|void
modifier|*
parameter_list|,
name|int
parameter_list|,
name|uint64_t
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_mmu_unmap_perm_addr
parameter_list|(
name|void
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_set_ctx0
parameter_list|(
name|uint64_t
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_set_ctxnon0
parameter_list|(
name|uint64_t
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|SET_MMU_STATS
end_ifdef

begin_function_decl
specifier|extern
name|uint64_t
name|hv_mmu_set_stat_area
parameter_list|(
name|uint64_t
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* SET_MMU_STATS */
end_comment

begin_function_decl
specifier|extern
name|uint64_t
name|hv_cpu_qconf
parameter_list|(
name|int
name|queue
parameter_list|,
name|uint64_t
name|paddr
parameter_list|,
name|int
name|size
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_cpu_mondo_send
parameter_list|(
name|int
name|n
parameter_list|,
name|vm_paddr_t
name|cpu_list_ra
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_cpu_yield
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_cpu_state
parameter_list|(
name|uint64_t
name|cpuid
parameter_list|,
name|uint64_t
modifier|*
name|cpu_state
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_mem_scrub
parameter_list|(
name|uint64_t
name|real_addr
parameter_list|,
name|uint64_t
name|length
parameter_list|,
name|uint64_t
modifier|*
name|scrubbed_len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_mem_sync
parameter_list|(
name|uint64_t
name|real_addr
parameter_list|,
name|uint64_t
name|length
parameter_list|,
name|uint64_t
modifier|*
name|flushed_len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_service_recv
parameter_list|(
name|uint64_t
name|s_id
parameter_list|,
name|uint64_t
name|buf_pa
parameter_list|,
name|uint64_t
name|size
parameter_list|,
name|uint64_t
modifier|*
name|recv_bytes
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_service_send
parameter_list|(
name|uint64_t
name|s_id
parameter_list|,
name|uint64_t
name|buf_pa
parameter_list|,
name|uint64_t
name|size
parameter_list|,
name|uint64_t
modifier|*
name|send_bytes
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_service_getstatus
parameter_list|(
name|uint64_t
name|s_id
parameter_list|,
name|uint64_t
modifier|*
name|vreg
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_service_setstatus
parameter_list|(
name|uint64_t
name|s_id
parameter_list|,
name|uint64_t
name|bits
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_service_clrstatus
parameter_list|(
name|uint64_t
name|s_id
parameter_list|,
name|uint64_t
name|bits
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_mach_desc
parameter_list|(
name|uint64_t
name|buffer_ra
parameter_list|,
name|uint64_t
modifier|*
name|buffer_sizep
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_ttrace_buf_info
parameter_list|(
name|uint64_t
modifier|*
parameter_list|,
name|uint64_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_ttrace_buf_conf
parameter_list|(
name|uint64_t
parameter_list|,
name|uint64_t
parameter_list|,
name|uint64_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_ttrace_enable
parameter_list|(
name|uint64_t
parameter_list|,
name|uint64_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_ttrace_freeze
parameter_list|(
name|uint64_t
parameter_list|,
name|uint64_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_ttrace_addentry
parameter_list|(
name|uint64_t
parameter_list|,
name|uint64_t
parameter_list|,
name|uint64_t
parameter_list|,
name|uint64_t
parameter_list|,
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_dump_buf_update
parameter_list|(
name|uint64_t
parameter_list|,
name|uint64_t
parameter_list|,
name|uint64_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int64_t
name|hv_cnputchar
parameter_list|(
name|uint8_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int64_t
name|hv_cngetchar
parameter_list|(
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int64_t
name|hv_cnwrite
parameter_list|(
name|uint64_t
name|buf_raddr
parameter_list|,
name|uint64_t
name|size
parameter_list|,
name|uint64_t
modifier|*
name|nwritten
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int64_t
name|hv_cnread
parameter_list|(
name|uint64_t
name|buf_raddr
parameter_list|,
name|uint64_t
name|size
parameter_list|,
name|uint64_t
modifier|*
name|nread
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|hv_cnputs
parameter_list|(
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_tod_get
parameter_list|(
name|uint64_t
modifier|*
name|seconds
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hv_tod_set
parameter_list|(
name|uint64_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_intr_devino_to_sysino
parameter_list|(
name|uint64_t
name|dev_hdl
parameter_list|,
name|uint32_t
name|devino
parameter_list|,
name|uint64_t
modifier|*
name|sysino
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_intr_getvalid
parameter_list|(
name|uint64_t
name|sysino
parameter_list|,
name|int
modifier|*
name|intr_valid_state
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_intr_setvalid
parameter_list|(
name|uint64_t
name|sysino
parameter_list|,
name|int
name|intr_valid_state
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_intr_getstate
parameter_list|(
name|uint64_t
name|sysino
parameter_list|,
name|int
modifier|*
name|intr_state
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_intr_setstate
parameter_list|(
name|uint64_t
name|sysino
parameter_list|,
name|int
name|intr_state
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_intr_gettarget
parameter_list|(
name|uint64_t
name|sysino
parameter_list|,
name|uint32_t
modifier|*
name|cpuid
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_intr_settarget
parameter_list|(
name|uint64_t
name|sysino
parameter_list|,
name|uint32_t
name|cpuid
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_peek
parameter_list|(
name|devhandle_t
name|dev_hdl
parameter_list|,
name|uint64_t
name|r_addr
parameter_list|,
name|uint64_t
name|size
parameter_list|,
name|uint32_t
modifier|*
name|err_flag
parameter_list|,
name|uint64_t
modifier|*
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_poke
parameter_list|(
name|devhandle_t
name|dev_hdl
parameter_list|,
name|uint64_t
name|r_addr
parameter_list|,
name|uint64_t
name|size
parameter_list|,
name|uint64_t
name|data
parameter_list|,
name|uint64_t
name|pcidev
parameter_list|,
name|uint32_t
modifier|*
name|err_flag
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_ldc_tx_qconf
parameter_list|(
name|uint64_t
name|ldc_id
parameter_list|,
name|uint64_t
name|base_raddr
parameter_list|,
name|uint64_t
name|nentries
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_ldc_tx_qinfo
parameter_list|(
name|uint64_t
name|ldc_id
parameter_list|,
name|uint64_t
modifier|*
name|base_raddr
parameter_list|,
name|uint64_t
modifier|*
name|nentries
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_ldc_tx_get_state
parameter_list|(
name|uint64_t
name|ldc_id
parameter_list|,
name|ldc_state_info_t
modifier|*
name|info
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_ldc_tx_set_qtail
parameter_list|(
name|uint64_t
name|ldc_id
parameter_list|,
name|uint64_t
name|tail_offset
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_ldc_rx_get_state
parameter_list|(
name|uint64_t
name|ldc_id
parameter_list|,
name|ldc_state_info_t
modifier|*
name|info
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_ldc_rx_qconf
parameter_list|(
name|uint64_t
name|ldc_id
parameter_list|,
name|uint64_t
name|base_raddr
parameter_list|,
name|uint64_t
name|nentries
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_ldc_rx_qinfo
parameter_list|(
name|uint64_t
name|ldc_id
parameter_list|,
name|uint64_t
modifier|*
name|base_raddr
parameter_list|,
name|uint64_t
modifier|*
name|nentries
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_ldc_rx_set_qhead
parameter_list|(
name|uint64_t
name|ldc_id
parameter_list|,
name|uint64_t
name|head_offset
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_config_get
parameter_list|(
name|devhandle_t
name|dev_hdl
parameter_list|,
name|pci_device_t
name|pci_device
parameter_list|,
name|pci_config_offset_t
name|off
parameter_list|,
name|pci_config_size_t
name|size
parameter_list|,
name|pci_cfg_data_t
modifier|*
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_config_put
parameter_list|(
name|devhandle_t
name|dev_hdl
parameter_list|,
name|pci_device_t
name|pci_device
parameter_list|,
name|pci_config_offset_t
name|off
parameter_list|,
name|pci_config_size_t
name|size
parameter_list|,
name|pci_cfg_data_t
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_iommu_map
parameter_list|(
name|devhandle_t
name|dev_hdl
parameter_list|,
name|tsbid_t
name|tsbid
parameter_list|,
name|pages_t
name|pages
parameter_list|,
name|io_attributes_t
name|io_attributes
parameter_list|,
name|io_page_list_t
modifier|*
name|io_page_list_p
parameter_list|,
name|pages_t
modifier|*
name|pages_mapped
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_iommu_demap
parameter_list|(
name|devhandle_t
name|dev_hdl
parameter_list|,
name|tsbid_t
name|tsbid
parameter_list|,
name|pages_t
name|pages
parameter_list|,
name|pages_t
modifier|*
name|pages_demapped
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_iommu_getmap
parameter_list|(
name|devhandle_t
name|dev_hdl
parameter_list|,
name|tsbid_t
name|tsbid
parameter_list|,
name|io_attributes_t
modifier|*
name|attributes_p
parameter_list|,
name|r_addr_t
modifier|*
name|r_addr_p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_iommu_getbypass
parameter_list|(
name|devhandle_t
name|dev_hdl
parameter_list|,
name|r_addr_t
name|ra
parameter_list|,
name|io_attributes_t
name|io_attributes
parameter_list|,
name|io_addr_t
modifier|*
name|io_addr_p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|uint64_t
name|hvio_dma_sync
parameter_list|(
name|devhandle_t
name|dev_hdl
parameter_list|,
name|r_addr_t
name|ra
parameter_list|,
name|size_t
name|num_bytes
parameter_list|,
name|uint64_t
name|io_sync_direction
parameter_list|,
name|size_t
modifier|*
name|bytes_synched
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|hv_magic_trap_on
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|hv_magic_trap_off
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|hv_sim_read
parameter_list|(
name|uint64_t
name|offset
parameter_list|,
name|vm_paddr_t
name|buffer_ra
parameter_list|,
name|uint64_t
name|size
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|hv_sim_write
parameter_list|(
name|uint64_t
name|offset
parameter_list|,
name|vm_paddr_t
name|buffer_ra
parameter_list|,
name|uint64_t
name|size
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* _MACHINE_HYPERVISOR_API_H */
end_comment

end_unit

