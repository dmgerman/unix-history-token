begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/************************************************************************** ** **  $Id: pcisupport.c,v 1.101 1999/05/06 21:21:30 julian Exp $ ** **  Device driver for DEC/INTEL PCI chipsets. ** **  FreeBSD ** **------------------------------------------------------------------------- ** **  Written for FreeBSD by **	wolf@cologne.de 	Wolfgang Stanglmeier **	se@mi.Uni-Koeln.de	Stefan Esser ** **------------------------------------------------------------------------- ** ** Copyright (c) 1994,1995 Stefan Esser.  All rights reserved. ** ** Redistribution and use in source and binary forms, with or without ** modification, are permitted provided that the following conditions ** are met: ** 1. Redistributions of source code must retain the above copyright **    notice, this list of conditions and the following disclaimer. ** 2. Redistributions in binary form must reproduce the above copyright **    notice, this list of conditions and the following disclaimer in the **    documentation and/or other materials provided with the distribution. ** 3. The name of the author may not be used to endorse or promote products **    derived from this software without specific prior written permission. ** ** THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR ** IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES ** OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. ** IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, ** INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT ** NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, ** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY ** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT ** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF ** THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. ** *************************************************************************** */
end_comment

begin_include
include|#
directive|include
file|"opt_bus.h"
end_include

begin_include
include|#
directive|include
file|"opt_pci.h"
end_include

begin_include
include|#
directive|include
file|"opt_smp.h"
end_include

begin_include
include|#
directive|include
file|"intpm.h"
end_include

begin_include
include|#
directive|include
file|"alpm.h"
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/malloc.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/bus.h>
end_include

begin_include
include|#
directive|include
file|<pci/pcivar.h>
end_include

begin_include
include|#
directive|include
file|<pci/pcireg.h>
end_include

begin_include
include|#
directive|include
file|<vm/vm.h>
end_include

begin_include
include|#
directive|include
file|<vm/vm_object.h>
end_include

begin_include
include|#
directive|include
file|<vm/pmap.h>
end_include

begin_comment
comment|/*--------------------------------------------------------- ** **	Intel chipsets for 486 / Pentium processor ** **--------------------------------------------------------- */
end_comment

begin_function_decl
specifier|static
name|void
name|chipset_attach
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|int
name|unit
parameter_list|)
function_decl|;
end_function_decl

begin_struct
struct|struct
name|condmsg
block|{
name|unsigned
name|char
name|port
decl_stmt|;
name|unsigned
name|char
name|mask
decl_stmt|;
name|unsigned
name|char
name|value
decl_stmt|;
name|char
name|flags
decl_stmt|;
specifier|const
name|char
modifier|*
name|text
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|char
modifier|*
name|generic_pci_bridge
parameter_list|(
name|pcici_t
name|tag
parameter_list|)
block|{
name|char
modifier|*
name|descr
decl_stmt|,
name|tmpbuf
index|[
literal|120
index|]
decl_stmt|;
name|unsigned
name|classreg
init|=
name|pci_conf_read
argument_list|(
name|tag
argument_list|,
name|PCI_CLASS_REG
argument_list|)
decl_stmt|;
if|if
condition|(
operator|(
name|classreg
operator|&
name|PCI_CLASS_MASK
operator|)
operator|==
name|PCI_CLASS_BRIDGE
condition|)
block|{
name|unsigned
name|id
init|=
name|pci_conf_read
argument_list|(
name|tag
argument_list|,
name|PCI_ID_REG
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|classreg
operator|>>
literal|16
operator|&
literal|0xff
condition|)
block|{
case|case
literal|0
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"Host to PCI"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to ISA"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to EISA"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to PCI"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to PCMCIA"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to CardBus"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|snprintf
argument_list|(
name|tmpbuf
argument_list|,
sizeof|sizeof
argument_list|(
name|tmpbuf
argument_list|)
argument_list|,
literal|"PCI to 0x%x"
argument_list|,
name|classreg
operator|>>
literal|16
operator|&
literal|0xff
argument_list|)
expr_stmt|;
break|break;
block|}
name|snprintf
argument_list|(
name|tmpbuf
operator|+
name|strlen
argument_list|(
name|tmpbuf
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|tmpbuf
argument_list|)
operator|-
name|strlen
argument_list|(
name|tmpbuf
argument_list|)
argument_list|,
literal|" bridge (vendor=%04x device=%04x)"
argument_list|,
name|id
operator|&
literal|0xffff
argument_list|,
operator|(
name|id
operator|>>
literal|16
operator|)
operator|&
literal|0xffff
argument_list|)
expr_stmt|;
name|descr
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|tmpbuf
argument_list|)
operator|+
literal|1
argument_list|,
name|M_DEVBUF
argument_list|,
name|M_WAITOK
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|descr
argument_list|,
name|tmpbuf
argument_list|)
expr_stmt|;
return|return
name|descr
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * XXX Both fixbushigh_orion() and fixbushigh_i1225() are bogus in that way,  * that they store the highest bus number to scan in this device's config   * data, though it is about PCI buses attached to the CPU independently!  * The same goes for fixbushigh_450nx.  */
end_comment

begin_function
specifier|static
name|void
name|fixbushigh_orion
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|pci_set_secondarybus
argument_list|(
name|dev
argument_list|,
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0x4a
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|pci_set_subordinatebus
argument_list|(
name|dev
argument_list|,
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0x4b
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|fixbushigh_i1225
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|int
name|sublementarybus
decl_stmt|;
name|sublementarybus
operator|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0x41
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|sublementarybus
operator|!=
literal|0xff
condition|)
block|{
name|pci_set_secondarybus
argument_list|(
name|dev
argument_list|,
name|sublementarybus
operator|+
literal|1
argument_list|)
expr_stmt|;
name|pci_set_subordinatebus
argument_list|(
name|dev
argument_list|,
name|sublementarybus
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * This reads the PCI config space for the 82451NX MIOC in the 450NX  * chipset to determine the PCI bus configuration.  *  * Assuming the BIOS has set up the MIOC properly, this will correctly  * report the number of PCI busses in the system.  *  * A small problem is that the Host to PCI bridge control is in the MIOC,  * while the host-pci bridges are separate PCI devices.  So it really  * isn't easily possible to set up the subordinatebus mappings as the  * 82454NX PCI expander bridges are probed, although that makes the  * most sense.  */
end_comment

begin_function
specifier|static
name|void
name|fixbushigh_450nx
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|int
name|subordinatebus
decl_stmt|;
name|unsigned
name|long
name|devmap
decl_stmt|;
comment|/* 	 * Read the DEVMAP field, so we know which fields to check. 	 * If the Host-PCI bridge isn't marked as present by the BIOS, 	 * we have to assume it doesn't exist. 	 * If this doesn't find all the PCI busses, complain to the 	 * BIOS vendor.  There is nothing more we can do. 	 */
name|devmap
operator|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0xd6
argument_list|,
literal|2
argument_list|)
operator|&
literal|0x3c
expr_stmt|;
if|if
condition|(
operator|!
name|devmap
condition|)
name|panic
argument_list|(
literal|"450NX MIOC: No host to PCI bridges marked present.\n"
argument_list|)
expr_stmt|;
comment|/* 	 * Since the buses are configured in order, we just have to 	 * find the highest bus, and use those numbers. 	 */
if|if
condition|(
name|devmap
operator|&
literal|0x20
condition|)
block|{
comment|/* B1 */
name|subordinatebus
operator|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0xd5
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|devmap
operator|&
literal|0x10
condition|)
block|{
comment|/* A1 */
name|subordinatebus
operator|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0xd4
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|devmap
operator|&
literal|0x8
condition|)
block|{
comment|/* B0 */
name|subordinatebus
operator|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0xd2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
comment|/* if (devmap& 0x4) */
block|{
comment|/* A0 */
name|subordinatebus
operator|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0xd1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|subordinatebus
operator|==
literal|255
condition|)
block|{
name|printf
argument_list|(
literal|"fixbushigh_450nx: bogus highest PCI bus %d"
argument_list|,
name|subordinatebus
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|NBUS
name|subordinatebus
operator|=
name|NBUS
operator|-
literal|2
expr_stmt|;
else|#
directive|else
name|subordinatebus
operator|=
literal|10
expr_stmt|;
endif|#
directive|endif
name|printf
argument_list|(
literal|", reduced to %d\n"
argument_list|,
name|subordinatebus
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bootverbose
condition|)
name|printf
argument_list|(
literal|"fixbushigh_450nx: subordinatebus is %d\n"
argument_list|,
name|subordinatebus
argument_list|)
expr_stmt|;
name|pci_set_secondarybus
argument_list|(
name|dev
argument_list|,
name|subordinatebus
argument_list|)
expr_stmt|;
name|pci_set_subordinatebus
argument_list|(
name|dev
argument_list|,
name|subordinatebus
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|fixbushigh_Ross
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|int
name|secondarybus
decl_stmt|;
comment|/* just guessing the secondary bus register number ... */
name|secondarybus
operator|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0x45
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|secondarybus
operator|!=
literal|0
condition|)
block|{
name|pci_set_secondarybus
argument_list|(
name|dev
argument_list|,
name|secondarybus
operator|+
literal|1
argument_list|)
expr_stmt|;
name|pci_set_subordinatebus
argument_list|(
name|dev
argument_list|,
name|secondarybus
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|fixwsc_natoma
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|int
name|pmccfg
decl_stmt|;
name|pmccfg
operator|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0x50
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|SMP
argument_list|)
if|if
condition|(
name|pmccfg
operator|&
literal|0x8000
condition|)
block|{
name|printf
argument_list|(
literal|"Correcting Natoma config for SMP\n"
argument_list|)
expr_stmt|;
name|pmccfg
operator|&=
operator|~
literal|0x8000
expr_stmt|;
name|pci_write_config
argument_list|(
name|dev
argument_list|,
literal|0x50
argument_list|,
literal|2
argument_list|,
name|pmccfg
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
if|if
condition|(
operator|(
name|pmccfg
operator|&
literal|0x8000
operator|)
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Correcting Natoma config for non-SMP\n"
argument_list|)
expr_stmt|;
name|pmccfg
operator||=
literal|0x8000
expr_stmt|;
name|pci_write_config
argument_list|(
name|dev
argument_list|,
literal|0x50
argument_list|,
literal|2
argument_list|,
name|pmccfg
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|PCI_QUIET
end_ifndef

begin_define
define|#
directive|define
name|M_XX
value|0
end_define

begin_comment
comment|/* end of list */
end_comment

begin_define
define|#
directive|define
name|M_EQ
value|1
end_define

begin_comment
comment|/* mask and return true if equal */
end_comment

begin_define
define|#
directive|define
name|M_NE
value|2
end_define

begin_comment
comment|/* mask and return true if not equal */
end_comment

begin_define
define|#
directive|define
name|M_TR
value|3
end_define

begin_comment
comment|/* don't read config, always true */
end_comment

begin_define
define|#
directive|define
name|M_EN
value|4
end_define

begin_comment
comment|/* mask and print "enabled" if true, "disabled" if false */
end_comment

begin_define
define|#
directive|define
name|M_NN
value|5
end_define

begin_comment
comment|/* opposite sense of M_EN */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82425ex
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tClock "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x06
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"25"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x06
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"33"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"??"
block|, }
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"MHz, L1 Cache "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"Disabled\n"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x09
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"Write-through\n"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x09
block|,
literal|0x09
block|,
name|M_EQ
block|,
literal|"Write-back\n"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tL2 Cache "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x07
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"Disabled"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"64KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"128KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|"256KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"512KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"64KB Write-back"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"128KB Write-back"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|"256KB Write-back"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"512KB Write-back"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|", 3-"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", 2-"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3-3-3"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"2-2-2"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"1-1-1"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x06
block|,
name|M_EQ
block|,
literal|"?-?-?"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"/4-2-2-2\n"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"/3-2-2-2\n"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"/?-?-?-?\n"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x18
block|,
name|M_EQ
block|,
literal|"/2-1-1-1\n"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tDRAM: "
block|}
block|,
block|{
literal|0x56
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"Fast Code Read, "
block|}
block|,
block|{
literal|0x56
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"Fast Data Read, "
block|}
block|,
block|{
literal|0x56
block|,
literal|0x08
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"Fast Write, "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"Pipelined CAS"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x2e
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"\n\t"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"Timing: RAS: "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"4"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"1.5"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|"1"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" Clocks, CAS Read: "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"2/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"1.5/0.5"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"1/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|", CAS Write: "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"2/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"1/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\tCPU-to-PCI Byte Merging\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\tCPU-to-PCI Bursting\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\tPCI Posted Writes\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\tDRAM Parity Disabled\n"
block|}
block|,
block|{
literal|0x48
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\tPCI IDE controller: Primary (1F0h-1F7h,3F6h,3F7h)"
block|}
block|,
block|{
literal|0x48
block|,
literal|0x03
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\tPCI IDE controller: Secondary (170h-177h,376h,377h)"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\tRTC (70-77h)\n"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\tKeyboard (60,62,64,66h)\n"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x08
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"\tIRQ12/M Mouse Function\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82424zx
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tCPU: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"486DX"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"486SX"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"486DX2 or 486DX4"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|"Overdrive (writeback)"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|", bus="
block|}
block|,
block|{
literal|0x50
block|,
literal|0x03
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"25MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"33MHz"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_TR
block|,
literal|", CPU->Memory posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x30
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"\n\tWarning:"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|" NO cache parity!"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x10
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|" NO DRAM parity!"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tWarning: refresh OFF! "
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCache: "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"None"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"64KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x41
block|,
name|M_EQ
block|,
literal|"128KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x81
block|,
name|M_EQ
block|,
literal|"256KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0xc1
block|,
name|M_EQ
block|,
literal|"512KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" writethrough"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" writeback"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", cache clocks="
block|}
block|,
block|{
literal|0x52
block|,
literal|0x05
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"3-1-1-1"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x05
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|"2-1-1-1"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tDRAM:"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|" page mode"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|" code fetch"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x43
block|,
name|M_EQ
block|,
literal|","
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x42
block|,
name|M_EQ
block|,
literal|" and"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x40
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|" read"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" and"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x41
block|,
name|M_EQ
block|,
literal|" and"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" write"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|","
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" memory clocks="
block|}
block|,
block|{
literal|0x55
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"X-2-2-2"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"X-1-2-1"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCPU->PCI: posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|", burst mode "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tPCI->Memory: posting "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82434lx
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tCPU: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0x82
block|,
name|M_EQ
block|,
literal|"Pentium, 60MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0x83
block|,
name|M_EQ
block|,
literal|"Pentium, 66MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0xa2
block|,
name|M_EQ
block|,
literal|"Pentium, 90MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0xa3
block|,
name|M_EQ
block|,
literal|"Pentium, 100MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xc2
block|,
literal|0x82
block|,
name|M_NE
block|,
literal|"(unknown)"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" (primary cache OFF)"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_TR
block|,
literal|", CPU->Memory posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_NE
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x08
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|", read around write"
block|}
block|,
block|{
literal|0x70
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tWarning: Cache parity disabled!"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"\n\tWarning: DRAM parity mask!"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tWarning: refresh OFF! "
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCache: "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"None"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x81
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|""
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x81
block|,
name|M_EQ
block|,
literal|"256KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0xc1
block|,
name|M_EQ
block|,
literal|"512KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" writethrough"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" writeback"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", cache clocks="
block|}
block|,
block|{
literal|0x52
block|,
literal|0x21
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"3-2-2-2/4-2-2-2"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x21
block|,
literal|0x21
block|,
name|M_EQ
block|,
literal|"3-1-1-1"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tCache flags: "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x11
block|,
literal|0x11
block|,
name|M_EQ
block|,
literal|" cache-all"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x09
block|,
literal|0x09
block|,
name|M_EQ
block|,
literal|" byte-control"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x05
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|" powersaver"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tDRAM:"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x10
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" page mode"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" memory clocks="
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"X-4-4-4 (70ns)"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"X-4-4-4/X-3-3-3 (60ns)"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|"???"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0xc0
block|,
name|M_EQ
block|,
literal|"X-3-3-3 (50ns)"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|", RAS-wait"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", CAS-wait"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCPU->PCI: posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|", burst mode "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|", PCI clocks="
block|}
block|,
block|{
literal|0x54
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"2-2-2-2"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"2-1-1-1"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tPCI->Memory: posting "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tRefresh:"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" CAS#/RAS#(Hidden)"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" RAS#Only"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x05
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|" BurstOf4"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82378
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tBus Modes:"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|" Bus Park,"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|" Bus Lock,"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" Resource Lock,"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" GAT"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"\n\tCoprocessor errors enabled"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x10
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"\n\tMouse function enabled"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x30
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"\n\tIDE controller: Primary (1F0h-1F7h,3F6h,3F7h)"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x30
block|,
literal|0x30
block|,
name|M_EQ
block|,
literal|"\n\tIDE controller: Secondary (170h-177h,376h,377h)"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x28
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 3F0h,3F1h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x24
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 3F2h-3F7h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x28
block|,
literal|0x28
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 370h,371h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x24
block|,
literal|0x24
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 372h-377h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\n\tKeyboard controller: 60h,62h,64h,66h"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tRTC: 70h-77h"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x80
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|"\n\tConfiguration RAM: 0C00h,0800h-08FFh"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x40
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"\n\tPort 92: enabled"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x03
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port A: COM1 (3F8h-3FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port A: COM2 (2F8h-2FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x0c
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port B: COM1 (3F8h-3FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x0c
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port B: COM2 (2F8h-2FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x30
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tParallel Port: LPT1 (3BCh-3BFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x30
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tParallel Port: LPT2 (378h-37Fh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x30
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"\n\tParallel Port: LPT3 (278h-27Fh)"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82437fx
index|[]
init|=
block|{
comment|/* PCON -- PCI Control Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tCPU Inactivity timer: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0xe0
block|,
name|M_EQ
block|,
literal|"8"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0xd0
block|,
name|M_EQ
block|,
literal|"7"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0xc0
block|,
name|M_EQ
block|,
literal|"6"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0xb0
block|,
name|M_EQ
block|,
literal|"5"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0xa0
block|,
name|M_EQ
block|,
literal|"4"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x90
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"1"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" clocks\n\tPeer Concurrency: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x08
block|,
literal|0x08
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCPU-to-PCI Write Bursting: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_NN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tPCI Streaming: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_NN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tBus Concurrency: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_NN
block|,
literal|0
block|}
block|,
comment|/* CC -- Cache Control Regsiter */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCache:"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|" 512K"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|" 256K"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" NO"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" pipelined-burst"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|" burst"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|" asynchronous"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x30
block|,
name|M_EQ
block|,
literal|" dual-bank pipelined-burst"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" secondary; L1 "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* DRAMC -- DRAM Control Register */
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"Warning: refresh OFF!\n"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tDRAM:"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" no memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|" 512K-640K memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|" 15M-16M memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", 50 MHz refresh"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|", 60 MHz refresh"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|", 66 MHz refresh"
block|}
block|,
comment|/* DRAMT = DRAM Timing Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tRead burst timing: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"x-4-4-4/x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"x-3-3-3/x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"x-2-2-2/x-3-3-3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x60
block|,
name|M_EQ
block|,
literal|"???"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tWrite burst timing: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"x-3-3-3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"x-2-2-2"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x18
block|,
name|M_EQ
block|,
literal|"???"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tRAS-CAS delay: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" clocks\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82437vx
index|[]
init|=
block|{
comment|/* PCON -- PCI Control Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tPCI Concurrency: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x08
block|,
literal|0x08
block|,
name|M_EN
block|,
literal|0
block|}
block|,
comment|/* CC -- Cache Control Regsiter */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCache:"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|" 512K"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|" 256K"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" NO"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" pipelined-burst"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|" burst"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|" asynchronous"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x30
block|,
name|M_EQ
block|,
literal|" dual-bank pipelined-burst"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" secondary; L1 "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* DRAMC -- DRAM Control Register */
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"Warning: refresh OFF!\n"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tDRAM:"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" no memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|" 512K-640K memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|" 15M-16M memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", 50 MHz refresh"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|", 60 MHz refresh"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|", 66 MHz refresh"
block|}
block|,
comment|/* DRAMT = DRAM Timing Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tRead burst timing: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"x-4-4-4/x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"x-3-3-3/x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"x-2-2-2/x-3-3-3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x60
block|,
name|M_EQ
block|,
literal|"???"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tWrite burst timing: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"x-3-3-3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"x-2-2-2"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x18
block|,
name|M_EQ
block|,
literal|"???"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tRAS-CAS delay: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" clocks\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82371fb
index|[]
init|=
block|{
comment|/* IORT -- ISA I/O Recovery Timer Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tI/O Recovery Timing: 8-bit "
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x40
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3.5"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x48
block|,
name|M_EQ
block|,
literal|"1"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x50
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x58
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x60
block|,
name|M_EQ
block|,
literal|"4"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x68
block|,
name|M_EQ
block|,
literal|"5"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x70
block|,
name|M_EQ
block|,
literal|"6"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x78
block|,
name|M_EQ
block|,
literal|"7"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"8"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" clocks, 16-bit "
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3.5"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x07
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|"1"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x07
block|,
literal|0x06
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x07
block|,
literal|0x07
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x07
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"4"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" clocks\n"
block|}
block|,
comment|/* XBCS -- X-Bus Chip Select Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tExtended BIOS: "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x80
block|,
literal|0x80
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tLower BIOS: "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x40
block|,
literal|0x40
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCoprocessor IRQ13: "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tMouse IRQ12: "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x10
block|,
literal|0x10
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tInterrupt Routing: "
block|}
block|,
define|#
directive|define
name|PIRQ
parameter_list|(
name|x
parameter_list|,
name|n
parameter_list|)
define|\
value|{ 0x00, 0x00, 0x00, M_TR, n ": " }, \     { x, 0x80, 0x80, M_EQ, "disabled" }, \     { x, 0xc0, 0x40, M_EQ, "[shared] " }, \     { x, 0x8f, 0x03, M_EQ, "IRQ3" }, \     { x, 0x8f, 0x04, M_EQ, "IRQ4" }, \     { x, 0x8f, 0x05, M_EQ, "IRQ5" }, \     { x, 0x8f, 0x06, M_EQ, "IRQ6" }, \     { x, 0x8f, 0x07, M_EQ, "IRQ7" }, \     { x, 0x8f, 0x09, M_EQ, "IRQ9" }, \     { x, 0x8f, 0x0a, M_EQ, "IRQ10" }, \     { x, 0x8f, 0x0b, M_EQ, "IRQ11" }, \     { x, 0x8f, 0x0c, M_EQ, "IRQ12" }, \     { x, 0x8f, 0x0e, M_EQ, "IRQ14" }, \     { x, 0x8f, 0x0f, M_EQ, "IRQ15" }
comment|/* Interrupt routing */
name|PIRQ
argument_list|(
literal|0x60
argument_list|,
literal|"A"
argument_list|)
block|,
name|PIRQ
argument_list|(
literal|0x61
argument_list|,
literal|", B"
argument_list|)
block|,
name|PIRQ
argument_list|(
literal|0x62
argument_list|,
literal|", C"
argument_list|)
block|,
name|PIRQ
argument_list|(
literal|0x63
argument_list|,
literal|", D"
argument_list|)
block|,
name|PIRQ
argument_list|(
literal|0x70
argument_list|,
literal|"\n\t\tMB0"
argument_list|)
block|,
name|PIRQ
argument_list|(
literal|0x71
argument_list|,
literal|", MB1"
argument_list|)
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
undef|#
directive|undef
name|PIRQ
comment|/* XXX - do DMA routing, too? */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82371fb2
index|[]
init|=
block|{
comment|/* IDETM -- IDE Timing Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tPrimary IDE: "
block|}
block|,
block|{
literal|0x41
block|,
literal|0x80
block|,
literal|0x80
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tSecondary IDE: "
block|}
block|,
block|{
literal|0x43
block|,
literal|0x80
block|,
literal|0x80
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* end of list */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|writeconfig
parameter_list|(
name|device_t
name|dev
parameter_list|,
specifier|const
name|struct
name|condmsg
modifier|*
name|tbl
parameter_list|)
block|{
while|while
condition|(
name|tbl
operator|->
name|flags
operator|!=
name|M_XX
condition|)
block|{
specifier|const
name|char
modifier|*
name|text
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|tbl
operator|->
name|flags
operator|==
name|M_TR
condition|)
block|{
name|text
operator|=
name|tbl
operator|->
name|text
expr_stmt|;
block|}
else|else
block|{
name|unsigned
name|char
name|v
init|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
name|tbl
operator|->
name|port
argument_list|,
literal|1
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|tbl
operator|->
name|flags
condition|)
block|{
case|case
name|M_EQ
case|:
if|if
condition|(
operator|(
name|v
operator|&
name|tbl
operator|->
name|mask
operator|)
operator|==
name|tbl
operator|->
name|value
condition|)
name|text
operator|=
name|tbl
operator|->
name|text
expr_stmt|;
break|break;
case|case
name|M_NE
case|:
if|if
condition|(
operator|(
name|v
operator|&
name|tbl
operator|->
name|mask
operator|)
operator|!=
name|tbl
operator|->
name|value
condition|)
name|text
operator|=
name|tbl
operator|->
name|text
expr_stmt|;
break|break;
case|case
name|M_EN
case|:
name|text
operator|=
operator|(
name|v
operator|&
name|tbl
operator|->
name|mask
operator|)
condition|?
literal|"enabled"
else|:
literal|"disabled"
expr_stmt|;
break|break;
case|case
name|M_NN
case|:
name|text
operator|=
operator|(
name|v
operator|&
name|tbl
operator|->
name|mask
operator|)
condition|?
literal|"disabled"
else|:
literal|"enabled"
expr_stmt|;
block|}
block|}
if|if
condition|(
name|text
condition|)
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|tbl
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|DUMPCONFIGSPACE
end_ifdef

begin_function
specifier|static
name|void
name|dumpconfigspace
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|int
name|reg
decl_stmt|;
name|printf
argument_list|(
literal|"configuration space registers:"
argument_list|)
expr_stmt|;
for|for
control|(
name|reg
operator|=
literal|0
init|;
name|reg
operator|<
literal|0x100
condition|;
name|reg
operator|+=
literal|4
control|)
block|{
if|if
condition|(
operator|(
name|reg
operator|&
literal|0x0f
operator|)
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"\n%02x:\t"
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%08x "
argument_list|,
name|pci_read_config
argument_list|(
name|dev
argument_list|,
name|reg
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* DUMPCONFIGSPACE */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* PCI_QUIET */
end_comment

begin_function
specifier|static
name|void
name|chipset_attach
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|int
name|unit
parameter_list|)
block|{
ifndef|#
directive|ifndef
name|PCI_QUIET
if|if
condition|(
operator|!
name|bootverbose
condition|)
return|return;
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
literal|0x04868086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82425ex
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x04838086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82424zx
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x04a38086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82434lx
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x04848086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82378
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x122d8086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82437fx
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x70308086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82437vx
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x70008086
case|:
case|case
literal|0x122e8086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82371fb
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x70108086
case|:
case|case
literal|0x12308086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82371fb2
argument_list|)
expr_stmt|;
break|break;
if|#
directive|if
literal|0
block|case 0x00011011:
comment|/* DEC 21050 */
block|case 0x00221014:
comment|/* IBM xxx */
block|writeconfig (dev, conf_pci2pci); 		break;
endif|#
directive|endif
block|}
empty_stmt|;
endif|#
directive|endif
comment|/* PCI_QUIET */
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|pci_bridge_type
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|char
modifier|*
name|descr
decl_stmt|,
name|tmpbuf
index|[
literal|120
index|]
decl_stmt|;
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|!=
name|PCIC_BRIDGE
condition|)
return|return
name|NULL
return|;
switch|switch
condition|(
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
name|PCIS_BRIDGE_HOST
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"Host to PCI"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_ISA
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to ISA"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_EISA
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to EISA"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_MCA
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to MCA"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_PCI
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to PCI"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_PCMCIA
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to PCMCIA"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_NUBUS
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to NUBUS"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_CARDBUS
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to CardBus"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|snprintf
argument_list|(
name|tmpbuf
argument_list|,
sizeof|sizeof
argument_list|(
name|tmpbuf
argument_list|)
argument_list|,
literal|"PCI to 0x%x"
argument_list|,
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|snprintf
argument_list|(
name|tmpbuf
operator|+
name|strlen
argument_list|(
name|tmpbuf
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|tmpbuf
argument_list|)
operator|-
name|strlen
argument_list|(
name|tmpbuf
argument_list|)
argument_list|,
literal|" bridge (vendor=%04x device=%04x)"
argument_list|,
name|pci_get_vendor
argument_list|(
name|dev
argument_list|)
argument_list|,
name|pci_get_device
argument_list|(
name|dev
argument_list|)
argument_list|)
expr_stmt|;
name|descr
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|tmpbuf
argument_list|)
operator|+
literal|1
argument_list|,
name|M_DEVBUF
argument_list|,
name|M_WAITOK
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|descr
argument_list|,
name|tmpbuf
argument_list|)
expr_stmt|;
return|return
name|descr
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|pcib_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
literal|0x84cb8086
case|:
return|return
operator|(
literal|"Intel 82454NX PCI Expander Bridge"
operator|)
return|;
case|case
literal|0x00221014
case|:
return|return
operator|(
literal|"IBM 82351 PCI-PCI bridge"
operator|)
return|;
case|case
literal|0x00011011
case|:
return|return
operator|(
literal|"DEC 21050 PCI-PCI bridge"
operator|)
return|;
case|case
literal|0x124b8086
case|:
return|return
operator|(
literal|"Intel 82380FB mobile PCI to PCI bridge"
operator|)
return|;
comment|/* VLSI -- vendor 0x1004 */
case|case
literal|0x01021004
case|:
return|return
operator|(
literal|"VLSI 82C534 Eagle II PCI Bus bridge"
operator|)
return|;
case|case
literal|0x01031004
case|:
return|return
operator|(
literal|"VLSI 82C538 Eagle II PCI Docking bridge"
operator|)
return|;
comment|/* XXX Here is MVP3, I got the datasheet but NO M/B to test it  */
comment|/* totally. Please let me know if anything wrong.            -F */
case|case
literal|0x85981106
case|:
return|return
operator|(
literal|"VIA 82C598MVP (Apollo MVP3) PCI-PCI bridge"
operator|)
return|;
comment|/* AcerLabs -- vendor 0x10b9 */
comment|/* Funny : The datasheet told me vendor id is "10b8",sub-vendor */
comment|/* id is '10b9" but the register always shows "10b9". -Foxfair  */
case|case
literal|0x524710b9
case|:
return|return
operator|(
literal|"AcerLabs M5247 PCI-PCI(AGP Supported) bridge"
operator|)
return|;
case|case
literal|0x524310b9
case|:
comment|/* 5243 seems like 5247, need more info to divide*/
return|return
operator|(
literal|"AcerLabs M5243 PCI-PCI bridge"
operator|)
return|;
block|}
empty_stmt|;
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIC_BRIDGE
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_BRIDGE_PCI
condition|)
return|return
name|pci_bridge_type
argument_list|(
name|dev
argument_list|)
return|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pcib_probe
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|desc
decl_stmt|;
name|desc
operator|=
name|pcib_match
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|desc
condition|)
block|{
name|device_set_desc_copy
argument_list|(
name|dev
argument_list|,
name|desc
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|ENXIO
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pcib_attach
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|struct
name|pci_devinfo
modifier|*
name|dinfo
decl_stmt|;
name|pcicfgregs
modifier|*
name|cfg
decl_stmt|;
name|dinfo
operator|=
name|device_get_ivars
argument_list|(
name|dev
argument_list|)
expr_stmt|;
name|cfg
operator|=
operator|&
name|dinfo
operator|->
name|cfg
expr_stmt|;
name|chipset_attach
argument_list|(
name|dev
argument_list|,
name|device_get_unit
argument_list|(
name|dev
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|secondarybus
condition|)
block|{
name|device_add_child
argument_list|(
name|dev
argument_list|,
literal|"pci"
argument_list|,
name|cfg
operator|->
name|secondarybus
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|bus_generic_attach
argument_list|(
name|dev
argument_list|)
return|;
block|}
else|else
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|device_method_t
name|pcib_methods
index|[]
init|=
block|{
comment|/* Device interface */
name|DEVMETHOD
argument_list|(
name|device_probe
argument_list|,
name|pcib_probe
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_attach
argument_list|,
name|pcib_attach
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_shutdown
argument_list|,
name|bus_generic_shutdown
argument_list|)
block|,
comment|/* Bus interface */
name|DEVMETHOD
argument_list|(
name|bus_print_child
argument_list|,
name|bus_generic_print_child
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_alloc_resource
argument_list|,
name|bus_generic_alloc_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_release_resource
argument_list|,
name|bus_generic_release_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_activate_resource
argument_list|,
name|bus_generic_activate_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_deactivate_resource
argument_list|,
name|bus_generic_deactivate_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_setup_intr
argument_list|,
name|bus_generic_setup_intr
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_teardown_intr
argument_list|,
name|bus_generic_teardown_intr
argument_list|)
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|driver_t
name|pcib_driver
init|=
block|{
literal|"pcib"
block|,
name|pcib_methods
block|,
name|DRIVER_TYPE_MISC
block|,
literal|1
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|devclass_t
name|pcib_devclass
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DRIVER_MODULE
argument_list|(
name|pcib
argument_list|,
name|pci
argument_list|,
name|pcib_driver
argument_list|,
name|pcib_devclass
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|eisab_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
literal|0x04828086
case|:
comment|/* Recognize this specifically, it has PCI-HOST class (!) */
return|return
operator|(
literal|"Intel 82375EB PCI-EISA bridge"
operator|)
return|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|isab_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|unsigned
name|rev
decl_stmt|;
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
literal|0x04848086
case|:
name|rev
operator|=
name|pci_get_revid
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|rev
operator|==
literal|3
condition|)
return|return
operator|(
literal|"Intel 82378ZB PCI to ISA bridge"
operator|)
return|;
return|return
operator|(
literal|"Intel 82378IB PCI to ISA bridge"
operator|)
return|;
case|case
literal|0x122e8086
case|:
return|return
operator|(
literal|"Intel 82371FB PCI to ISA bridge"
operator|)
return|;
case|case
literal|0x70008086
case|:
return|return
operator|(
literal|"Intel 82371SB PCI to ISA bridge"
operator|)
return|;
case|case
literal|0x71108086
case|:
return|return
operator|(
literal|"Intel 82371AB PCI to ISA bridge"
operator|)
return|;
comment|/* VLSI -- vendor 0x1004 */
case|case
literal|0x00061004
case|:
return|return
operator|(
literal|"VLSI 82C593 PCI to ISA bridge"
operator|)
return|;
comment|/* VIA Technologies -- vendor 0x1106  	 * Note that the old Apollo Master chipset is not in here, as VIA 	 * does not seem to have any docs on their website for it, and I do 	 * not have a Master board in my posession. -LC */
case|case
literal|0x05861106
case|:
comment|/* south bridge section -- IDE is covered in ide_pci.c */
return|return
operator|(
literal|"VIA 82C586 PCI-ISA bridge"
operator|)
return|;
comment|/* AcerLabs -- vendor 0x10b9 */
comment|/* Funny : The datasheet told me vendor id is "10b8",sub-vendor */
comment|/* id is '10b9" but the register always shows "10b9". -Foxfair  */
case|case
literal|0x153310b9
case|:
return|return
operator|(
literal|"AcerLabs M1533 portable PCI-ISA bridge"
operator|)
return|;
case|case
literal|0x154310b9
case|:
return|return
operator|(
literal|"AcerLabs M1543 desktop PCI-ISA bridge"
operator|)
return|;
comment|/* SiS -- vendor 0x1039 */
case|case
literal|0x00081039
case|:
return|return
operator|(
literal|"SiS 85c503 PCI-ISA bridge"
operator|)
return|;
comment|/* Cyrix -- vendor 0x1078 */
case|case
literal|0x00001078
case|:
return|return
operator|(
literal|"Cyrix Cx5510 PCI-ISA bridge"
operator|)
return|;
case|case
literal|0x01001078
case|:
return|return
operator|(
literal|"Cyrix Cx5530 PCI-ISA bridge"
operator|)
return|;
comment|/* NEC -- vendor 0x1033 */
comment|/* The "C-bus" is 16-bits bus on PC98. */
case|case
literal|0x00011033
case|:
return|return
operator|(
literal|"NEC 0001 PCI to PC-98 C-bus bridge"
operator|)
return|;
case|case
literal|0x002c1033
case|:
return|return
operator|(
literal|"NEC 002C PCI to PC-98 C-bus bridge"
operator|)
return|;
case|case
literal|0x003b1033
case|:
return|return
operator|(
literal|"NEC 003B PCI to PC-98 C-bus bridge"
operator|)
return|;
block|}
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIC_BRIDGE
operator|&&
operator|(
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_BRIDGE_ISA
operator|||
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_BRIDGE_EISA
operator|)
condition|)
return|return
name|pci_bridge_type
argument_list|(
name|dev
argument_list|)
return|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|isab_probe
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|desc
decl_stmt|;
name|int
name|is_eisa
decl_stmt|;
name|is_eisa
operator|=
literal|0
expr_stmt|;
name|desc
operator|=
name|eisab_match
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|desc
condition|)
name|is_eisa
operator|=
literal|1
expr_stmt|;
else|else
name|desc
operator|=
name|isab_match
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|desc
condition|)
block|{
name|device_set_desc_copy
argument_list|(
name|dev
argument_list|,
name|desc
argument_list|)
expr_stmt|;
comment|/* In case of a generic EISA bridge */
if|if
condition|(
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_BRIDGE_EISA
condition|)
name|is_eisa
operator|=
literal|1
expr_stmt|;
comment|/* For PCI-EISA bridge, add both eisa and isa */
comment|/* Don't bother adding more than one EISA bus */
if|if
condition|(
name|is_eisa
operator|&&
operator|!
name|devclass_get_device
argument_list|(
name|devclass_find
argument_list|(
literal|"isa"
argument_list|)
argument_list|,
literal|0
argument_list|)
condition|)
name|device_add_child
argument_list|(
name|dev
argument_list|,
literal|"eisa"
argument_list|,
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Don't bother adding more than one ISA bus */
if|if
condition|(
operator|!
name|devclass_get_device
argument_list|(
name|devclass_find
argument_list|(
literal|"isa"
argument_list|)
argument_list|,
literal|0
argument_list|)
condition|)
name|device_add_child
argument_list|(
name|dev
argument_list|,
literal|"isa"
argument_list|,
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|ENXIO
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|device_method_t
name|isab_methods
index|[]
init|=
block|{
comment|/* Device interface */
name|DEVMETHOD
argument_list|(
name|device_probe
argument_list|,
name|isab_probe
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_attach
argument_list|,
name|bus_generic_attach
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_shutdown
argument_list|,
name|bus_generic_shutdown
argument_list|)
block|,
comment|/* Bus interface */
name|DEVMETHOD
argument_list|(
name|bus_print_child
argument_list|,
name|bus_generic_print_child
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_alloc_resource
argument_list|,
name|bus_generic_alloc_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_release_resource
argument_list|,
name|bus_generic_release_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_activate_resource
argument_list|,
name|bus_generic_activate_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_deactivate_resource
argument_list|,
name|bus_generic_deactivate_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_setup_intr
argument_list|,
name|bus_generic_setup_intr
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_teardown_intr
argument_list|,
name|bus_generic_teardown_intr
argument_list|)
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|driver_t
name|isab_driver
init|=
block|{
literal|"isab"
block|,
name|isab_methods
block|,
name|DRIVER_TYPE_MISC
block|,
literal|1
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|devclass_t
name|isab_devclass
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DRIVER_MODULE
argument_list|(
name|isab
argument_list|,
name|pci
argument_list|,
name|isab_driver
argument_list|,
name|isab_devclass
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|chip_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|unsigned
name|rev
decl_stmt|;
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
literal|0x00088086
case|:
comment|/* Silently ignore this one! What is it, anyway ??? */
return|return
operator|(
literal|""
operator|)
return|;
case|case
literal|0x71108086
case|:
comment|/* 		 * On my laptop (Tecra 8000DVD), this device has a 		 * bogus subclass 0x80 so make sure that it doesn't 		 * match the generic 'chip' driver by accident. 		 */
return|return
name|NULL
return|;
case|case
literal|0x12258086
case|:
name|fixbushigh_i1225
argument_list|(
name|dev
argument_list|)
expr_stmt|;
return|return
operator|(
literal|"Intel 824?? host to PCI bridge"
operator|)
return|;
case|case
literal|0x71908086
case|:
return|return
operator|(
literal|"Intel 82443BX host to PCI bridge"
operator|)
return|;
case|case
literal|0x71918086
case|:
return|return
operator|(
literal|"Intel 82443BX host to AGP bridge"
operator|)
return|;
case|case
literal|0x71928086
case|:
return|return
operator|(
literal|"Intel 82443BX host to PCI bridge (AGP disabled)"
operator|)
return|;
case|case
literal|0x71a08086
case|:
return|return
operator|(
literal|"Intel 82443GX host to PCI bridge"
operator|)
return|;
case|case
literal|0x71a18086
case|:
return|return
operator|(
literal|"Intel 82443GX host to AGP bridge"
operator|)
return|;
case|case
literal|0x71a28086
case|:
return|return
operator|(
literal|"Intel 82443GX host to PCI bridge (AGP disabled)"
operator|)
return|;
case|case
literal|0x84c48086
case|:
name|fixbushigh_orion
argument_list|(
name|dev
argument_list|)
expr_stmt|;
return|return
operator|(
literal|"Intel 82454KX/GX (Orion) host to PCI bridge"
operator|)
return|;
case|case
literal|0x84ca8086
case|:
name|fixbushigh_450nx
argument_list|(
name|dev
argument_list|)
expr_stmt|;
return|return
operator|(
literal|"Intel 82451NX Memory and I/O Controller"
operator|)
return|;
case|case
literal|0x04868086
case|:
return|return
operator|(
literal|"Intel 82425EX PCI system controller"
operator|)
return|;
case|case
literal|0x04838086
case|:
return|return
operator|(
literal|"Intel 82424ZX (Saturn) cache DRAM controller"
operator|)
return|;
case|case
literal|0x04a38086
case|:
name|rev
operator|=
name|pci_get_revid
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|rev
operator|==
literal|16
operator|||
name|rev
operator|==
literal|17
condition|)
return|return
operator|(
literal|"Intel 82434NX (Neptune) PCI cache memory controller"
operator|)
return|;
return|return
operator|(
literal|"Intel 82434LX (Mercury) PCI cache memory controller"
operator|)
return|;
case|case
literal|0x122d8086
case|:
return|return
operator|(
literal|"Intel 82437FX PCI cache memory controller"
operator|)
return|;
case|case
literal|0x12348086
case|:
return|return
operator|(
literal|"Intel 82371MX mobile PCI I/O IDE accelerator (MPIIX)"
operator|)
return|;
case|case
literal|0x12358086
case|:
return|return
operator|(
literal|"Intel 82437MX mobile PCI cache memory controller"
operator|)
return|;
case|case
literal|0x12508086
case|:
return|return
operator|(
literal|"Intel 82439"
operator|)
return|;
case|case
literal|0x70308086
case|:
return|return
operator|(
literal|"Intel 82437VX PCI cache memory controller"
operator|)
return|;
case|case
literal|0x71008086
case|:
return|return
operator|(
literal|"Intel 82439TX System Controller (MTXC)"
operator|)
return|;
case|case
literal|0x71138086
case|:
return|return
operator|(
literal|"Intel 82371AB Power management controller"
operator|)
return|;
case|case
literal|0x12378086
case|:
name|fixwsc_natoma
argument_list|(
name|dev
argument_list|)
expr_stmt|;
return|return
operator|(
literal|"Intel 82440FX (Natoma) PCI and memory controller"
operator|)
return|;
case|case
literal|0x84c58086
case|:
return|return
operator|(
literal|"Intel 82453KX/GX (Orion) PCI memory controller"
operator|)
return|;
comment|/* SiS -- vendor 0x1039 */
case|case
literal|0x04961039
case|:
return|return
operator|(
literal|"SiS 85c496"
operator|)
return|;
case|case
literal|0x04061039
case|:
return|return
operator|(
literal|"SiS 85c501"
operator|)
return|;
case|case
literal|0x06011039
case|:
return|return
operator|(
literal|"SiS 85c601"
operator|)
return|;
comment|/* VLSI -- vendor 0x1004 */
case|case
literal|0x00051004
case|:
return|return
operator|(
literal|"VLSI 82C592 Host to PCI bridge"
operator|)
return|;
case|case
literal|0x01011004
case|:
return|return
operator|(
literal|"VLSI 82C532 Eagle II Peripheral Controller"
operator|)
return|;
case|case
literal|0x01041004
case|:
return|return
operator|(
literal|"VLSI 82C535 Eagle II System Controller"
operator|)
return|;
case|case
literal|0x01051004
case|:
return|return
operator|(
literal|"VLSI 82C147 IrDA Controller"
operator|)
return|;
comment|/* VIA Technologies -- vendor 0x1106  	 * Note that the old Apollo Master chipset is not in here, as VIA 	 * does not seem to have any docs on their website for it, and I do 	 * not have a Master board in my posession. -LC */
case|case
literal|0x05851106
case|:
return|return
operator|(
literal|"VIA 82C585 (Apollo VP1/VPX) system controller"
operator|)
return|;
case|case
literal|0x05951106
case|:
case|case
literal|0x15951106
case|:
return|return
operator|(
literal|"VIA 82C595 (Apollo VP2) system controller"
operator|)
return|;
case|case
literal|0x05971106
case|:
return|return
operator|(
literal|"VIA 82C597 (Apollo VP3) system controller"
operator|)
return|;
comment|/* XXX Here is MVP3, I got the datasheet but NO M/B to test it  */
comment|/* totally. Please let me know if anything wrong.            -F */
comment|/* XXX need info on the MVP3 -- any takers? */
case|case
literal|0x05981106
case|:
return|return
operator|(
literal|"VIA 82C598MVP (Apollo MVP3) host bridge"
operator|)
return|;
case|case
literal|0x30401106
case|:
return|return
operator|(
literal|"VIA 82C586B ACPI interface"
operator|)
return|;
if|#
directive|if
literal|0
comment|/* XXX New info added-in */
block|case 0x05711106: 		return("VIA 82C586B IDE controller"); 	case 0x30381106: 		return("VIA 82C586B USB controller");
endif|#
directive|endif
comment|/* NEC -- vendor 0x1033 */
case|case
literal|0x00021033
case|:
return|return
operator|(
literal|"NEC 0002 PCI to PC-98 local bus bridge"
operator|)
return|;
case|case
literal|0x00161033
case|:
return|return
operator|(
literal|"NEC 0016 PCI to PC-98 local bus bridge"
operator|)
return|;
comment|/* AcerLabs -- vendor 0x10b9 */
comment|/* Funny : The datasheet told me vendor id is "10b8",sub-vendor */
comment|/* id is '10b9" but the register always shows "10b9". -Foxfair  */
case|case
literal|0x154110b9
case|:
return|return
operator|(
literal|"AcerLabs M1541 (Aladdin-V) PCI host bridge"
operator|)
return|;
comment|/* NEC -- vendor 0x1033 */
comment|/* PCI to C-bus bridge */
comment|/* The following chipsets are PCI to PC98 C-bus bridge. 	 * The C-bus is the 16-bits bus on PC98 and it should be probed as 	 * PCI to ISA bridge.  Because class of the C-bus is not defined, 	 * C-bus bridges are recognized as "other bridge."  To make C-bus 	 * bridge be recognized as ISA bridge, this function returns NULL. 	 */
case|case
literal|0x00011033
case|:
case|case
literal|0x002c1033
case|:
case|case
literal|0x003b1033
case|:
return|return
name|NULL
return|;
block|}
empty_stmt|;
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIC_BRIDGE
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|!=
name|PCIS_BRIDGE_PCI
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|!=
name|PCIS_BRIDGE_ISA
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|!=
name|PCIS_BRIDGE_EISA
condition|)
return|return
name|pci_bridge_type
argument_list|(
name|dev
argument_list|)
return|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|chip_probe
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|desc
decl_stmt|;
name|desc
operator|=
name|chip_match
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|desc
condition|)
block|{
name|device_set_desc_copy
argument_list|(
name|dev
argument_list|,
name|desc
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|ENXIO
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|chip_attach
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|chipset_attach
argument_list|(
name|dev
argument_list|,
name|device_get_unit
argument_list|(
name|dev
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|device_method_t
name|chip_methods
index|[]
init|=
block|{
comment|/* Device interface */
name|DEVMETHOD
argument_list|(
name|device_probe
argument_list|,
name|chip_probe
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_attach
argument_list|,
name|chip_attach
argument_list|)
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|driver_t
name|chip_driver
init|=
block|{
literal|"chip"
block|,
name|chip_methods
block|,
name|DRIVER_TYPE_MISC
block|,
literal|1
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|devclass_t
name|chip_devclass
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DRIVER_MODULE
argument_list|(
name|chip
argument_list|,
name|pci
argument_list|,
name|chip_driver
argument_list|,
name|chip_devclass
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/*--------------------------------------------------------- ** **	Catchall driver for VGA devices ** **	By Garrett Wollman **<wollman@halloran-eldar.lcs.mit.edu> ** **--------------------------------------------------------- */
end_comment

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|vga_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
comment|/* int data = pci_conf_read(tag, PCI_CLASS_REG); */
name|u_int
name|id
init|=
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|vendor
decl_stmt|,
modifier|*
name|chip
decl_stmt|,
modifier|*
name|type
decl_stmt|;
return|return
literal|0
return|;
comment|/* XXX interferes with syscons */
name|vendor
operator|=
name|chip
operator|=
name|type
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|id
condition|)
block|{
case|case
literal|0x10c8
case|:
name|vendor
operator|=
literal|"NeoMagic"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0004
case|:
name|chip
operator|=
literal|"NM2160 laptop"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x102b
case|:
name|vendor
operator|=
literal|"Matrox"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0518
case|:
name|chip
operator|=
literal|"MGA 2085PX"
expr_stmt|;
break|break;
case|case
literal|0x0519
case|:
name|chip
operator|=
literal|"MGA 2064W"
expr_stmt|;
break|break;
case|case
literal|0x051a
case|:
name|chip
operator|=
literal|"MGA 1024SG/1064SG/1164SG"
expr_stmt|;
break|break;
case|case
literal|0x051b
case|:
name|chip
operator|=
literal|"MGA 2164W"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1002
case|:
name|vendor
operator|=
literal|"ATI"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x4158
case|:
name|chip
operator|=
literal|"Mach32"
expr_stmt|;
break|break;
case|case
literal|0x4758
case|:
name|chip
operator|=
literal|"Mach64-GX"
expr_stmt|;
break|break;
case|case
literal|0x4358
case|:
name|chip
operator|=
literal|"Mach64-CX"
expr_stmt|;
break|break;
case|case
literal|0x4354
case|:
name|chip
operator|=
literal|"Mach64-CT"
expr_stmt|;
break|break;
case|case
literal|0x4554
case|:
name|chip
operator|=
literal|"Mach64-ET"
expr_stmt|;
break|break;
case|case
literal|0x5654
case|:
name|chip
operator|=
literal|"Mach64-VT"
expr_stmt|;
break|break;
case|case
literal|0x4754
case|:
name|chip
operator|=
literal|"Mach64-GT"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1005
case|:
name|vendor
operator|=
literal|"Avance Logic"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x2301
case|:
name|chip
operator|=
literal|"ALG2301"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x100c
case|:
name|vendor
operator|=
literal|"Tseng Labs"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x3202
case|:
case|case
literal|0x3205
case|:
case|case
literal|0x3206
case|:
case|case
literal|0x3207
case|:
name|chip
operator|=
literal|"ET4000 W32P"
expr_stmt|;
break|break;
case|case
literal|0x3208
case|:
name|chip
operator|=
literal|"ET6000"
expr_stmt|;
break|break;
case|case
literal|0x4702
case|:
name|chip
operator|=
literal|"ET6300"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x100e
case|:
name|vendor
operator|=
literal|"Weitek"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x9001
case|:
name|chip
operator|=
literal|"P9000"
expr_stmt|;
break|break;
case|case
literal|0x9100
case|:
name|chip
operator|=
literal|"P9100"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1013
case|:
name|vendor
operator|=
literal|"Cirrus Logic"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0038
case|:
name|chip
operator|=
literal|"GD7548"
expr_stmt|;
break|break;
case|case
literal|0x00a0
case|:
name|chip
operator|=
literal|"GD5430"
expr_stmt|;
break|break;
case|case
literal|0x00a4
case|:
case|case
literal|0x00a8
case|:
name|chip
operator|=
literal|"GD5434"
expr_stmt|;
break|break;
case|case
literal|0x00ac
case|:
name|chip
operator|=
literal|"GD5436"
expr_stmt|;
break|break;
case|case
literal|0x00b8
case|:
name|chip
operator|=
literal|"GD5446"
expr_stmt|;
break|break;
case|case
literal|0x00d0
case|:
name|chip
operator|=
literal|"GD5462"
expr_stmt|;
break|break;
case|case
literal|0x00d4
case|:
name|chip
operator|=
literal|"GD5464"
expr_stmt|;
break|break;
case|case
literal|0x1200
case|:
name|chip
operator|=
literal|"GD7542"
expr_stmt|;
break|break;
case|case
literal|0x1202
case|:
name|chip
operator|=
literal|"GD7543"
expr_stmt|;
break|break;
case|case
literal|0x1204
case|:
name|chip
operator|=
literal|"GD7541"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1023
case|:
name|vendor
operator|=
literal|"Trident"
expr_stmt|;
break|break;
comment|/* let default deal with it */
case|case
literal|0x102c
case|:
name|vendor
operator|=
literal|"Chips& Technologies"
expr_stmt|;
if|if
condition|(
operator|(
name|id
operator|>>
literal|16
operator|)
operator|==
literal|0x00d8
condition|)
name|chip
operator|=
literal|"65545"
expr_stmt|;
break|break;
case|case
literal|0x1033
case|:
name|vendor
operator|=
literal|"NEC"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0009
case|:
name|type
operator|=
literal|"PCI to PC-98 Core Graph bridge"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1039
case|:
name|vendor
operator|=
literal|"SiS"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0001
case|:
name|chip
operator|=
literal|"86c201"
expr_stmt|;
break|break;
case|case
literal|0x0002
case|:
name|chip
operator|=
literal|"86c202"
expr_stmt|;
break|break;
case|case
literal|0x0205
case|:
name|chip
operator|=
literal|"86c205"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x105d
case|:
name|vendor
operator|=
literal|"Number Nine"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x2309
case|:
case|case
literal|0x2339
case|:
name|chip
operator|=
literal|"Imagine 128"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1142
case|:
name|vendor
operator|=
literal|"Alliance"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x3210
case|:
name|chip
operator|=
literal|"PM6410"
expr_stmt|;
break|break;
case|case
literal|0x6422
case|:
name|chip
operator|=
literal|"PM6422"
expr_stmt|;
break|break;
case|case
literal|0x6424
case|:
name|chip
operator|=
literal|"PMAT24"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1236
case|:
name|vendor
operator|=
literal|"Sigma Designs"
expr_stmt|;
if|if
condition|(
operator|(
name|id
operator|>>
literal|16
operator|)
operator|==
literal|0x6401
condition|)
name|chip
operator|=
literal|"64GX"
expr_stmt|;
break|break;
case|case
literal|0x5333
case|:
name|vendor
operator|=
literal|"S3"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x8811
case|:
name|chip
operator|=
literal|"Trio"
expr_stmt|;
break|break;
case|case
literal|0x8812
case|:
name|chip
operator|=
literal|"Aurora 64"
expr_stmt|;
break|break;
case|case
literal|0x8814
case|:
case|case
literal|0x8901
case|:
name|chip
operator|=
literal|"Trio 64"
expr_stmt|;
break|break;
case|case
literal|0x8902
case|:
name|chip
operator|=
literal|"Plato"
expr_stmt|;
break|break;
case|case
literal|0x8880
case|:
name|chip
operator|=
literal|"868"
expr_stmt|;
break|break;
case|case
literal|0x88b0
case|:
name|chip
operator|=
literal|"928"
expr_stmt|;
break|break;
case|case
literal|0x88c0
case|:
case|case
literal|0x88c1
case|:
name|chip
operator|=
literal|"864"
expr_stmt|;
break|break;
case|case
literal|0x88d0
case|:
case|case
literal|0x88d1
case|:
name|chip
operator|=
literal|"964"
expr_stmt|;
break|break;
case|case
literal|0x88f0
case|:
name|chip
operator|=
literal|"968"
expr_stmt|;
break|break;
case|case
literal|0x5631
case|:
name|chip
operator|=
literal|"ViRGE"
expr_stmt|;
break|break;
case|case
literal|0x883d
case|:
name|chip
operator|=
literal|"ViRGE VX"
expr_stmt|;
break|break;
case|case
literal|0x8a01
case|:
name|chip
operator|=
literal|"ViRGE DX/GX"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0xedd8
case|:
name|vendor
operator|=
literal|"ARK Logic"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0xa091
case|:
name|chip
operator|=
literal|"1000PV"
expr_stmt|;
break|break;
case|case
literal|0xa099
case|:
name|chip
operator|=
literal|"2000PV"
expr_stmt|;
break|break;
case|case
literal|0xa0a1
case|:
name|chip
operator|=
literal|"2000MT"
expr_stmt|;
break|break;
case|case
literal|0xa0a9
case|:
name|chip
operator|=
literal|"2000MI"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x3d3d
case|:
name|vendor
operator|=
literal|"3D Labs"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0001
case|:
name|chip
operator|=
literal|"300SX"
expr_stmt|;
break|break;
case|case
literal|0x0002
case|:
name|chip
operator|=
literal|"500TX"
expr_stmt|;
break|break;
case|case
literal|0x0003
case|:
name|chip
operator|=
literal|"Delta"
expr_stmt|;
break|break;
case|case
literal|0x0004
case|:
name|chip
operator|=
literal|"PerMedia"
expr_stmt|;
break|break;
block|}
break|break;
block|}
if|if
condition|(
name|vendor
operator|&&
name|chip
condition|)
block|{
name|char
modifier|*
name|buf
decl_stmt|;
name|int
name|len
decl_stmt|;
if|if
condition|(
name|type
operator|==
literal|0
condition|)
block|{
name|type
operator|=
literal|"SVGA controller"
expr_stmt|;
block|}
name|len
operator|=
name|strlen
argument_list|(
name|vendor
argument_list|)
operator|+
name|strlen
argument_list|(
name|chip
argument_list|)
operator|+
name|strlen
argument_list|(
name|type
argument_list|)
operator|+
literal|4
expr_stmt|;
name|MALLOC
argument_list|(
name|buf
argument_list|,
name|char
operator|*
argument_list|,
name|len
argument_list|,
name|M_TEMP
argument_list|,
name|M_NOWAIT
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
condition|)
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s %s %s"
argument_list|,
name|vendor
argument_list|,
name|chip
argument_list|,
name|type
argument_list|)
expr_stmt|;
return|return
name|buf
return|;
block|}
switch|switch
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
name|PCIC_OLD
case|:
if|if
condition|(
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|!=
name|PCIS_OLD_VGA
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|type
operator|==
literal|0
condition|)
name|type
operator|=
literal|"VGA-compatible display device"
expr_stmt|;
break|break;
case|case
name|PCIC_DISPLAY
case|:
if|if
condition|(
name|type
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|!=
name|PCIS_DISPLAY_VGA
condition|)
name|type
operator|=
literal|"VGA-compatible display device"
expr_stmt|;
else|else
block|{
comment|/* 				 * If it isn't a vga display device, 				 * don't pretend we found one. 				 */
name|type
operator|=
literal|"Display device"
expr_stmt|;
return|return
literal|0
return|;
block|}
block|}
break|break;
default|default:
return|return
literal|0
return|;
block|}
empty_stmt|;
comment|/* 	 * If we got here, we know for sure it's some sort of display 	 * device, but we weren't able to identify it specifically. 	 * At a minimum we can return the type, but we'd like to 	 * identify the vendor and chip ID if at all possible. 	 * (Some of the checks above intentionally don't bother for 	 * vendors where we know the chip ID is the same as the 	 * model number.) 	 */
if|if
condition|(
name|vendor
condition|)
block|{
name|char
modifier|*
name|buf
decl_stmt|;
name|int
name|len
decl_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|vendor
argument_list|)
operator|+
name|strlen
argument_list|(
name|type
argument_list|)
operator|+
literal|2
operator|+
literal|6
operator|+
literal|4
operator|+
literal|1
expr_stmt|;
name|MALLOC
argument_list|(
name|buf
argument_list|,
name|char
operator|*
argument_list|,
name|len
argument_list|,
name|M_TEMP
argument_list|,
name|M_NOWAIT
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
condition|)
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s model %04x %s"
argument_list|,
name|vendor
argument_list|,
name|id
operator|>>
literal|16
argument_list|,
name|type
argument_list|)
expr_stmt|;
return|return
name|buf
return|;
block|}
return|return
name|type
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|vga_probe
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|desc
decl_stmt|;
name|desc
operator|=
name|vga_match
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|desc
condition|)
block|{
name|device_set_desc
argument_list|(
name|dev
argument_list|,
name|desc
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|ENXIO
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|vga_attach
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
comment|/* **	If the assigned addresses are remapped, **	the console driver has to be informed about the new address. */
if|#
directive|if
literal|0
block|vm_offset_t va; 	vm_offset_t pa; 	int reg; 	for (reg = PCI_MAP_REG_START; reg< PCI_MAP_REG_END; reg += 4) 		(void) pci_map_mem (tag, reg,&va,&pa);
endif|#
directive|endif
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|device_method_t
name|vga_methods
index|[]
init|=
block|{
comment|/* Device interface */
name|DEVMETHOD
argument_list|(
name|device_probe
argument_list|,
name|vga_probe
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_attach
argument_list|,
name|vga_attach
argument_list|)
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|driver_t
name|vga_driver
init|=
block|{
literal|"vga"
block|,
name|vga_methods
block|,
name|DRIVER_TYPE_MISC
block|,
literal|1
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|devclass_t
name|vga_devclass
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DRIVER_MODULE
argument_list|(
name|vga
argument_list|,
name|pci
argument_list|,
name|vga_driver
argument_list|,
name|vga_devclass
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/*--------------------------------------------------------- ** **	Devices to ignore ** **--------------------------------------------------------- */
end_comment

begin_function
specifier|static
name|int
name|ign_probe
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
literal|0x10001042ul
case|:
comment|/* wd */
return|return
literal|0
return|;
comment|/*		return ("SMC FDC 37c665");*/
block|}
empty_stmt|;
return|return
name|ENXIO
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ign_attach
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|device_method_t
name|ign_methods
index|[]
init|=
block|{
comment|/* Device interface */
name|DEVMETHOD
argument_list|(
name|device_probe
argument_list|,
name|ign_probe
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_attach
argument_list|,
name|ign_attach
argument_list|)
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|driver_t
name|ign_driver
init|=
block|{
literal|"ign"
block|,
name|ign_methods
block|,
name|DRIVER_TYPE_MISC
block|,
literal|1
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|devclass_t
name|ign_devclass
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DRIVER_MODULE
argument_list|(
name|ign
argument_list|,
name|pci
argument_list|,
name|ign_driver
argument_list|,
name|ign_devclass
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_expr_stmt

end_unit

