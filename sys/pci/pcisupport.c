begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/************************************************************************** ** **  $Id: pcisupport.c,v 1.18 1995/08/15 09:43:42 se Exp $ ** **  Device driver for DEC/INTEL PCI chipsets. ** **  FreeBSD ** **------------------------------------------------------------------------- ** **  Written for FreeBSD by **	wolf@cologne.de 	Wolfgang Stanglmeier **	se@mi.Uni-Koeln.de	Stefan Esser ** **------------------------------------------------------------------------- ** ** Copyright (c) 1994,1995 Stefan Esser.  All rights reserved. ** ** Redistribution and use in source and binary forms, with or without ** modification, are permitted provided that the following conditions ** are met: ** 1. Redistributions of source code must retain the above copyright **    notice, this list of conditions and the following disclaimer. ** 2. Redistributions in binary form must reproduce the above copyright **    notice, this list of conditions and the following disclaimer in the **    documentation and/or other materials provided with the distribution. ** 3. The name of the author may not be used to endorse or promote products **    derived from this software without specific prior written permission. ** ** THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR ** IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES ** OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. ** IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, ** INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT ** NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, ** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY ** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT ** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF ** THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. ** *************************************************************************** */
end_comment

begin_define
define|#
directive|define
name|__PCISUPPORT_C__
value|"pl4 95/03/21"
end_define

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/devconf.h>
end_include

begin_include
include|#
directive|include
file|<machine/cpu.h>
end_include

begin_include
include|#
directive|include
file|<pci/pcivar.h>
end_include

begin_include
include|#
directive|include
file|<pci/pcireg.h>
end_include

begin_comment
comment|/*--------------------------------------------------------- ** **	Intel chipsets for 486 / Pentium processor ** **--------------------------------------------------------- */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|chipset_probe
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|pcidi_t
name|type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|chipset_attach
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|int
name|unit
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|u_long
name|chipset_count
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|pci_device
name|chipset_device
init|=
block|{
literal|"chip"
block|,
name|chipset_probe
block|,
name|chipset_attach
block|,
operator|&
name|chipset_count
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DATA_SET
argument_list|(
name|pcidevice_set
argument_list|,
name|chipset_device
argument_list|)
expr_stmt|;
end_expr_stmt

begin_struct
struct|struct
name|condmsg
block|{
name|unsigned
name|char
name|port
decl_stmt|;
name|unsigned
name|char
name|mask
decl_stmt|;
name|unsigned
name|char
name|value
decl_stmt|;
name|char
name|flags
decl_stmt|;
name|char
modifier|*
name|text
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|char
modifier|*
name|chipset_probe
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|pcidi_t
name|type
parameter_list|)
block|{
name|u_long
name|data
decl_stmt|;
name|unsigned
name|rev
decl_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
literal|0x04868086
case|:
return|return
operator|(
literal|"Intel 82425EX PCI system controller"
operator|)
return|;
case|case
literal|0x04848086
case|:
name|rev
operator|=
operator|(
name|unsigned
operator|)
name|pci_conf_read
argument_list|(
name|tag
argument_list|,
name|PCI_CLASS_REG
argument_list|)
operator|&
literal|0xff
expr_stmt|;
if|if
condition|(
name|rev
operator|==
literal|3
condition|)
return|return
operator|(
literal|"Intel 82378ZB PCI-ISA bridge"
operator|)
return|;
return|return
operator|(
literal|"Intel 82378IB PCI-ISA bridge"
operator|)
return|;
case|case
literal|0x04838086
case|:
return|return
operator|(
literal|"Intel 82424ZX (Saturn) cache DRAM controller"
operator|)
return|;
case|case
literal|0x04828086
case|:
return|return
operator|(
literal|"Intel 82375EB PCI-EISA bridge"
operator|)
return|;
ifdef|#
directive|ifdef
name|undef
case|case
literal|0x04868086
case|:
return|return
operator|(
literal|"Intel 82430ZX (Aries)"
operator|)
return|;
endif|#
directive|endif
case|case
literal|0x04a38086
case|:
name|rev
operator|=
operator|(
name|unsigned
operator|)
name|pci_conf_read
argument_list|(
name|tag
argument_list|,
name|PCI_CLASS_REG
argument_list|)
operator|&
literal|0xff
expr_stmt|;
if|if
condition|(
name|rev
operator|==
literal|16
operator|||
name|rev
operator|==
literal|17
condition|)
return|return
operator|(
literal|"Intel 82434NX (Neptune) PCI cache memory controller"
operator|)
return|;
return|return
operator|(
literal|"Intel 82434LX (Mercury) PCI cache memory controller"
operator|)
return|;
case|case
literal|0x122d8086
case|:
return|return
operator|(
literal|"Intel 82437 (Triton)"
operator|)
return|;
case|case
literal|0x122e8086
case|:
return|return
operator|(
literal|"Intel 82371 (Triton)"
operator|)
return|;
case|case
literal|0x12308086
case|:
return|return
operator|(
literal|"Intel 82438 (Triton)"
operator|)
return|;
case|case
literal|0x04961039
case|:
return|return
operator|(
literal|"SiS 85c496"
operator|)
return|;
case|case
literal|0x04061039
case|:
return|return
operator|(
literal|"SiS 85c501"
operator|)
return|;
case|case
literal|0x00081039
case|:
return|return
operator|(
literal|"SiS 85c503"
operator|)
return|;
case|case
literal|0x06011039
case|:
return|return
operator|(
literal|"SiS 85c601"
operator|)
return|;
case|case
literal|0x00011011
case|:
return|return
operator|(
literal|"DEC 21050 PCI-PCI bridge"
operator|)
return|;
block|}
empty_stmt|;
comment|/* 	**	check classes 	*/
name|data
operator|=
name|pci_conf_read
argument_list|(
name|tag
argument_list|,
name|PCI_CLASS_REG
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|data
operator|&
operator|(
name|PCI_CLASS_MASK
operator||
name|PCI_SUBCLASS_MASK
operator|)
condition|)
block|{
case|case
name|PCI_CLASS_BRIDGE
operator||
name|PCI_SUBCLASS_BRIDGE_HOST
case|:
return|return
operator|(
literal|"CPU-PCI bridge"
operator|)
return|;
case|case
name|PCI_CLASS_BRIDGE
operator||
name|PCI_SUBCLASS_BRIDGE_ISA
case|:
return|return
operator|(
literal|"PCI-ISA bridge"
operator|)
return|;
case|case
name|PCI_CLASS_BRIDGE
operator||
name|PCI_SUBCLASS_BRIDGE_EISA
case|:
return|return
operator|(
literal|"PCI-EISA bridge"
operator|)
return|;
case|case
name|PCI_CLASS_BRIDGE
operator||
name|PCI_SUBCLASS_BRIDGE_MC
case|:
return|return
operator|(
literal|"PCI-MC bridge"
operator|)
return|;
case|case
name|PCI_CLASS_BRIDGE
operator||
name|PCI_SUBCLASS_BRIDGE_PCI
case|:
return|return
operator|(
literal|"PCI-PCI bridge"
operator|)
return|;
case|case
name|PCI_CLASS_BRIDGE
operator||
name|PCI_SUBCLASS_BRIDGE_PCMCIA
case|:
return|return
operator|(
literal|"PCI-PCMCIA bridge"
operator|)
return|;
block|}
empty_stmt|;
return|return
operator|(
operator|(
name|char
operator|*
operator|)
literal|0
operator|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|M_EQ
value|0
end_define

begin_comment
comment|/* mask and return true if equal */
end_comment

begin_define
define|#
directive|define
name|M_NE
value|1
end_define

begin_comment
comment|/* mask and return true if not equal */
end_comment

begin_define
define|#
directive|define
name|TRUE
value|2
end_define

begin_comment
comment|/* don't read config, always true */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82425ex
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\tClock "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x06
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"25"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x06
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"33"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"??"
block|, }
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"MHz, L1 Cache "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"Disabled\n"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x09
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"Write-through\n"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x09
block|,
literal|0x09
block|,
name|M_EQ
block|,
literal|"Write-back\n"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\tL2 Cache "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x07
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"Disabled"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"64KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"128KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|"256KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"512KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"64KB Write-back"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"128KB Write-back"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|"256KB Write-back"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"512KB Write-back"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|", 3-"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", 2-"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3-3-3"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"2-2-2"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"1-1-1"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x06
block|,
name|M_EQ
block|,
literal|"?-?-?"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"/4-2-2-2\n"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"/3-2-2-2\n"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"/?-?-?-?\n"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x18
block|,
name|M_EQ
block|,
literal|"/2-1-1-1\n"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\tDRAM: "
block|}
block|,
block|{
literal|0x56
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"Fast Code Read, "
block|}
block|,
block|{
literal|0x56
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"Fast Data Read, "
block|}
block|,
block|{
literal|0x56
block|,
literal|0x08
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"Fast Write, "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"Pipelined CAS"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x2e
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"\n\t"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"Timing: RAS: "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"4"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"1.5"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|"1"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|" Clocks, CAS Read: "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"2/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"1.5/0.5"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"1/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|", CAS Write: "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"2/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"1/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\tCPU-to-PCI Byte Merging\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\tCPU-to-PCI Bursting\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\tPCI Posted Writes\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\tDRAM Parity Disabled\n"
block|}
block|,
block|{
literal|0x48
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\tPCI IDE controller: Primary (1F0h-1F7h,3F6h,3F7h)"
block|}
block|,
block|{
literal|0x48
block|,
literal|0x03
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\tPCI IDE controller: Secondary (170h-177h,376h,377h)"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\tRTC (70-77h)\n"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\tKeyboard (60,62,64,66h)\n"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x08
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"\tIRQ12/M Mouse Function\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82424zx
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\tCPU: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"486DX"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"486SX"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"486DX2 or 486DX4"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|"Overdrive (writeback)"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|", bus="
block|}
block|,
block|{
literal|0x50
block|,
literal|0x03
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"25MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"33MHz"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|TRUE
block|,
literal|", CPU->Memory posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x30
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"\n\tWarning:"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|" NO cache parity!"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x10
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|" NO DRAM parity!"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tWarning: refresh OFF! "
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n\tCache: "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"None"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"64KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x41
block|,
name|M_EQ
block|,
literal|"128KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x81
block|,
name|M_EQ
block|,
literal|"256KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0xc1
block|,
name|M_EQ
block|,
literal|"512KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" writethrough"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" writeback"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", cache clocks="
block|}
block|,
block|{
literal|0x52
block|,
literal|0x05
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"3-1-1-1"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x05
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|"2-1-1-1"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n\tDRAM:"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|" page mode"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|" code fetch"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x43
block|,
name|M_EQ
block|,
literal|","
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x42
block|,
name|M_EQ
block|,
literal|" and"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x40
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|" read"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" and"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x41
block|,
name|M_EQ
block|,
literal|" and"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" write"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|","
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|" memory clocks="
block|}
block|,
block|{
literal|0x55
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"X-2-2-2"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"X-1-2-1"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n\tCPU->PCI: posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|", burst mode "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n\tPCI->Memory: posting "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82434lx
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\tCPU: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0x82
block|,
name|M_EQ
block|,
literal|"Pentium, 60MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0x83
block|,
name|M_EQ
block|,
literal|"Pentium, 66MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0xa2
block|,
name|M_EQ
block|,
literal|"Pentium, 90MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0xa3
block|,
name|M_EQ
block|,
literal|"Pentium, 100MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xc2
block|,
literal|0x82
block|,
name|M_NE
block|,
literal|"(unknown)"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" (primary cache OFF)"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|TRUE
block|,
literal|", CPU->Memory posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_NE
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x08
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|", read around write"
block|}
block|,
block|{
literal|0x70
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tWarning: Cache parity disabled!"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"\n\tWarning: DRAM parity mask!"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tWarning: refresh OFF! "
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n\tCache: "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"None"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x81
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|""
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x81
block|,
name|M_EQ
block|,
literal|"256KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0xc1
block|,
name|M_EQ
block|,
literal|"512KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" writethrough"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" writeback"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", cache clocks="
block|}
block|,
block|{
literal|0x52
block|,
literal|0x21
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"3-2-2-2/4-2-2-2"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x21
block|,
literal|0x21
block|,
name|M_EQ
block|,
literal|"3-1-1-1"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tCache flags: "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x11
block|,
literal|0x11
block|,
name|M_EQ
block|,
literal|" cache-all"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x09
block|,
literal|0x09
block|,
name|M_EQ
block|,
literal|" byte-control"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x05
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|" powersaver"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n\tDRAM:"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x10
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" page mode"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|" memory clocks="
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"X-4-4-4 (70ns)"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"X-4-4-4/X-3-3-3 (60ns)"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|"???"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0xc0
block|,
name|M_EQ
block|,
literal|"X-3-3-3 (50ns)"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|", RAS-wait"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", CAS-wait"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n\tCPU->PCI: posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|", burst mode "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x04
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|", PCI clocks="
block|}
block|,
block|{
literal|0x54
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"2-2-2-2"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"2-1-1-1"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n\tPCI->Memory: posting "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tRefresh:"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" CAS#/RAS#(Hidden)"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" RAS#Only"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x05
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|" BurstOf4"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82378
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\tBus Modes:"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|" Bus Park,"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|" Bus Lock,"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" Resource Lock,"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" GAT"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"\n\tCoprocessor errors enabled"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x10
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"\n\tMouse function enabled"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x30
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"\n\tIDE controller: Primary (1F0h-1F7h,3F6h,3F7h)"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x30
block|,
literal|0x30
block|,
name|M_EQ
block|,
literal|"\n\tIDE controller: Secondary (170h-177h,376h,377h)"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x28
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 3F0h,3F1h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x24
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 3F2h-3F7h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x28
block|,
literal|0x28
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 370h,371h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x24
block|,
literal|0x24
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 372h-377h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\n\tKeyboard controller: 60h,62h,64h,66h"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tRTC: 70h-77h"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x80
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|"\n\tConfiguration RAM: 0C00h,0800h-08FFh"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x40
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"\n\tPort 92: enabled"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x03
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port A: COM1 (3F8h-3FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port A: COM2 (2F8h-2FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x0c
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port B: COM1 (3F8h-3FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x0c
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port B: COM2 (2F8h-2FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x30
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tParallel Port: LPT1 (3BCh-3BFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x30
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tParallel Port: LPT2 (378h-37Fh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x30
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"\n\tParallel Port: LPT3 (278h-27Fh)"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|TRUE
block|,
literal|"\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|char
name|confread
parameter_list|(
name|pcici_t
name|config_id
parameter_list|,
name|int
name|port
parameter_list|)
block|{
name|unsigned
name|long
name|portw
init|=
name|port
operator|&
operator|~
literal|3
decl_stmt|;
name|unsigned
name|long
name|ports
init|=
operator|(
name|port
operator|-
name|portw
operator|)
operator|<<
literal|3
decl_stmt|;
name|unsigned
name|long
name|l
init|=
name|pci_conf_read
argument_list|(
name|config_id
argument_list|,
name|portw
argument_list|)
decl_stmt|;
return|return
operator|(
name|l
operator|>>
name|ports
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|writeconfig
parameter_list|(
name|pcici_t
name|config_id
parameter_list|,
specifier|const
name|struct
name|condmsg
modifier|*
name|tbl
parameter_list|)
block|{
while|while
condition|(
name|tbl
operator|->
name|text
condition|)
block|{
name|int
name|cond
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|tbl
operator|->
name|flags
operator|==
name|TRUE
condition|)
block|{
name|cond
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|unsigned
name|char
name|v
init|=
operator|(
name|unsigned
name|char
operator|)
name|confread
argument_list|(
name|config_id
argument_list|,
name|tbl
operator|->
name|port
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|tbl
operator|->
name|flags
condition|)
block|{
case|case
name|M_EQ
case|:
if|if
condition|(
operator|(
name|v
operator|&
name|tbl
operator|->
name|mask
operator|)
operator|==
name|tbl
operator|->
name|value
condition|)
name|cond
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|M_NE
case|:
if|if
condition|(
operator|(
name|v
operator|&
name|tbl
operator|->
name|mask
operator|)
operator|!=
name|tbl
operator|->
name|value
condition|)
name|cond
operator|=
literal|1
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|cond
condition|)
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tbl
operator|->
name|text
argument_list|)
expr_stmt|;
name|tbl
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|chipset_attach
parameter_list|(
name|pcici_t
name|config_id
parameter_list|,
name|int
name|unit
parameter_list|)
block|{
if|if
condition|(
operator|!
name|bootverbose
condition|)
return|return;
switch|switch
condition|(
name|pci_conf_read
argument_list|(
name|config_id
argument_list|,
name|PCI_ID_REG
argument_list|)
condition|)
block|{
case|case
literal|0x04868086
case|:
name|writeconfig
argument_list|(
name|config_id
argument_list|,
name|conf82425ex
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x04838086
case|:
name|writeconfig
argument_list|(
name|config_id
argument_list|,
name|conf82424zx
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x04a38086
case|:
name|writeconfig
argument_list|(
name|config_id
argument_list|,
name|conf82434lx
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x04848086
case|:
name|writeconfig
argument_list|(
name|config_id
argument_list|,
name|conf82378
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x04828086
case|:
name|printf
argument_list|(
literal|"\t[40] %lx [50] %lx [54] %lx\n"
argument_list|,
name|pci_conf_read
argument_list|(
name|config_id
argument_list|,
literal|0x40
argument_list|)
argument_list|,
name|pci_conf_read
argument_list|(
name|config_id
argument_list|,
literal|0x50
argument_list|)
argument_list|,
name|pci_conf_read
argument_list|(
name|config_id
argument_list|,
literal|0x54
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
empty_stmt|;
block|}
end_function

begin_comment
comment|/*--------------------------------------------------------- ** **	Catchall driver for VGA devices ** **	By Garrett Wollman **<wollman@halloran-eldar.lcs.mit.edu> ** **--------------------------------------------------------- */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|vga_probe
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|pcidi_t
name|type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|vga_attach
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|int
name|unit
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|u_long
name|vga_count
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|pci_device
name|vga_device
init|=
block|{
literal|"vga"
block|,
name|vga_probe
block|,
name|vga_attach
block|,
operator|&
name|vga_count
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DATA_SET
argument_list|(
name|pcidevice_set
argument_list|,
name|vga_device
argument_list|)
expr_stmt|;
end_expr_stmt

begin_function
specifier|static
name|char
modifier|*
name|vga_probe
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|pcidi_t
name|type
parameter_list|)
block|{
name|int
name|data
init|=
name|pci_conf_read
argument_list|(
name|tag
argument_list|,
name|PCI_CLASS_REG
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|data
operator|&
name|PCI_CLASS_MASK
condition|)
block|{
case|case
name|PCI_CLASS_PREHISTORIC
case|:
if|if
condition|(
operator|(
name|data
operator|&
name|PCI_SUBCLASS_MASK
operator|)
operator|!=
name|PCI_SUBCLASS_PREHISTORIC_VGA
condition|)
break|break;
case|case
name|PCI_CLASS_DISPLAY
case|:
if|if
condition|(
operator|(
name|data
operator|&
name|PCI_SUBCLASS_MASK
operator|)
operator|==
name|PCI_SUBCLASS_DISPLAY_VGA
condition|)
return|return
literal|"VGA-compatible display device"
return|;
else|else
return|return
operator|(
literal|"Display device"
operator|)
return|;
block|}
empty_stmt|;
return|return
operator|(
operator|(
name|char
operator|*
operator|)
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|vga_attach
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|int
name|unit
parameter_list|)
block|{
comment|/* **	If the assigned addresses are remapped, **	the console driver has to be informed about the new address. */
if|#
directive|if
literal|0
block|vm_offset_t va; 	vm_offset_t pa; 	int reg; 	for (reg = PCI_MAP_REG_START; reg< PCI_MAP_REG_END; reg += 4) 		(void) pci_map_mem (tag, reg,&va,&pa);
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/*--------------------------------------------------------- ** **	Hook for loadable pci drivers ** **--------------------------------------------------------- */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|lkm_probe
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|pcidi_t
name|type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|lkm_attach
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|int
name|unit
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|u_long
name|lkm_count
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|pci_device
name|lkm_device
init|=
block|{
literal|"lkm"
block|,
name|lkm_probe
block|,
name|lkm_attach
block|,
operator|&
name|lkm_count
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DATA_SET
argument_list|(
name|pcidevice_set
argument_list|,
name|lkm_device
argument_list|)
expr_stmt|;
end_expr_stmt

begin_function
specifier|static
name|char
modifier|*
name|lkm_probe
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|pcidi_t
name|type
parameter_list|)
block|{
comment|/* 	**	Not yet! 	**	(Should try to load a matching driver) 	*/
return|return
operator|(
operator|(
name|char
operator|*
operator|)
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|lkm_attach
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|int
name|unit
parameter_list|)
block|{}
end_function

begin_comment
comment|/*--------------------------------------------------------- ** **	Devices to ignore ** **--------------------------------------------------------- */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|ign_probe
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|pcidi_t
name|type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ign_attach
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|int
name|unit
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|u_long
name|ign_count
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|pci_device
name|ign_device
init|=
block|{
name|NULL
block|,
name|ign_probe
block|,
name|ign_attach
block|,
operator|&
name|ign_count
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DATA_SET
argument_list|(
name|pcidevice_set
argument_list|,
name|ign_device
argument_list|)
expr_stmt|;
end_expr_stmt

begin_function
specifier|static
name|char
modifier|*
name|ign_probe
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|pcidi_t
name|type
parameter_list|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
case|case
literal|0x10001042ul
case|:
comment|/* wd */
return|return
operator|(
literal|""
operator|)
return|;
comment|/*		return ("SMC FDC 37c665");*/
block|}
empty_stmt|;
return|return
operator|(
operator|(
name|char
operator|*
operator|)
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|ign_attach
parameter_list|(
name|pcici_t
name|tag
parameter_list|,
name|int
name|unit
parameter_list|)
block|{}
end_function

end_unit

