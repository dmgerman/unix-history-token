begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/************************************************************************** ** ** $FreeBSD$ ** **  Device driver for DEC/INTEL PCI chipsets. ** **  FreeBSD ** **------------------------------------------------------------------------- ** **  Written for FreeBSD by **	wolf@cologne.de 	Wolfgang Stanglmeier **	se@mi.Uni-Koeln.de	Stefan Esser ** **------------------------------------------------------------------------- ** ** Copyright (c) 1994,1995 Stefan Esser.  All rights reserved. ** ** Redistribution and use in source and binary forms, with or without ** modification, are permitted provided that the following conditions ** are met: ** 1. Redistributions of source code must retain the above copyright **    notice, this list of conditions and the following disclaimer. ** 2. Redistributions in binary form must reproduce the above copyright **    notice, this list of conditions and the following disclaimer in the **    documentation and/or other materials provided with the distribution. ** 3. The name of the author may not be used to endorse or promote products **    derived from this software without specific prior written permission. ** ** THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR ** IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES ** OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. ** IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, ** INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT ** NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, ** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY ** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT ** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF ** THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. ** *************************************************************************** */
end_comment

begin_include
include|#
directive|include
file|"opt_bus.h"
end_include

begin_include
include|#
directive|include
file|"opt_pci.h"
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/malloc.h>
end_include

begin_include
include|#
directive|include
file|<sys/kernel.h>
end_include

begin_include
include|#
directive|include
file|<sys/bus.h>
end_include

begin_include
include|#
directive|include
file|<pci/pcivar.h>
end_include

begin_include
include|#
directive|include
file|<pci/pcireg.h>
end_include

begin_include
include|#
directive|include
file|<vm/vm.h>
end_include

begin_include
include|#
directive|include
file|<vm/vm_object.h>
end_include

begin_include
include|#
directive|include
file|<vm/pmap.h>
end_include

begin_comment
comment|/*--------------------------------------------------------- ** **	Intel chipsets for 486 / Pentium processor ** **--------------------------------------------------------- */
end_comment

begin_function_decl
specifier|static
name|void
name|chipset_attach
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|int
name|unit
parameter_list|)
function_decl|;
end_function_decl

begin_struct
struct|struct
name|condmsg
block|{
name|unsigned
name|char
name|port
decl_stmt|;
name|unsigned
name|char
name|mask
decl_stmt|;
name|unsigned
name|char
name|value
decl_stmt|;
name|char
name|flags
decl_stmt|;
specifier|const
name|char
modifier|*
name|text
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|fixbushigh_i1225
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|int
name|sublementarybus
decl_stmt|;
name|sublementarybus
operator|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0x41
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|sublementarybus
operator|!=
literal|0xff
condition|)
block|{
name|pci_set_secondarybus
argument_list|(
name|dev
argument_list|,
name|sublementarybus
operator|+
literal|1
argument_list|)
expr_stmt|;
name|pci_set_subordinatebus
argument_list|(
name|dev
argument_list|,
name|sublementarybus
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|fixwsc_natoma
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|int
name|pmccfg
decl_stmt|;
name|pmccfg
operator|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0x50
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|SMP
argument_list|)
if|if
condition|(
name|pmccfg
operator|&
literal|0x8000
condition|)
block|{
name|printf
argument_list|(
literal|"Correcting Natoma config for SMP\n"
argument_list|)
expr_stmt|;
name|pmccfg
operator|&=
operator|~
literal|0x8000
expr_stmt|;
name|pci_write_config
argument_list|(
name|dev
argument_list|,
literal|0x50
argument_list|,
name|pmccfg
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
if|if
condition|(
operator|(
name|pmccfg
operator|&
literal|0x8000
operator|)
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Correcting Natoma config for non-SMP\n"
argument_list|)
expr_stmt|;
name|pmccfg
operator||=
literal|0x8000
expr_stmt|;
name|pci_write_config
argument_list|(
name|dev
argument_list|,
literal|0x50
argument_list|,
name|pmccfg
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|PCI_QUIET
end_ifndef

begin_define
define|#
directive|define
name|M_XX
value|0
end_define

begin_comment
comment|/* end of list */
end_comment

begin_define
define|#
directive|define
name|M_EQ
value|1
end_define

begin_comment
comment|/* mask and return true if equal */
end_comment

begin_define
define|#
directive|define
name|M_NE
value|2
end_define

begin_comment
comment|/* mask and return true if not equal */
end_comment

begin_define
define|#
directive|define
name|M_TR
value|3
end_define

begin_comment
comment|/* don't read config, always true */
end_comment

begin_define
define|#
directive|define
name|M_EN
value|4
end_define

begin_comment
comment|/* mask and print "enabled" if true, "disabled" if false */
end_comment

begin_define
define|#
directive|define
name|M_NN
value|5
end_define

begin_comment
comment|/* opposite sense of M_EN */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82425ex
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tClock "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x06
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"25"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x06
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"33"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"??"
block|, }
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"MHz, L1 Cache "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"Disabled\n"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x09
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"Write-through\n"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x09
block|,
literal|0x09
block|,
name|M_EQ
block|,
literal|"Write-back\n"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tL2 Cache "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x07
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"Disabled"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"64KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"128KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|"256KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"512KB Write-through"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"64KB Write-back"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"128KB Write-back"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|"256KB Write-back"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x0f
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"512KB Write-back"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|", 3-"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", 2-"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3-3-3"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"2-2-2"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"1-1-1"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x06
block|,
literal|0x06
block|,
name|M_EQ
block|,
literal|"?-?-?"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"/4-2-2-2\n"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"/3-2-2-2\n"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"/?-?-?-?\n"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x18
block|,
literal|0x18
block|,
name|M_EQ
block|,
literal|"/2-1-1-1\n"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tDRAM: "
block|}
block|,
block|{
literal|0x56
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"Fast Code Read, "
block|}
block|,
block|{
literal|0x56
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"Fast Data Read, "
block|}
block|,
block|{
literal|0x56
block|,
literal|0x08
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"Fast Write, "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"Pipelined CAS"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x2e
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"\n\t"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"Timing: RAS: "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"4"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"1.5"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|"1"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" Clocks, CAS Read: "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"2/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"1.5/0.5"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"1/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|", CAS Write: "
block|}
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"2/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"1/1"
block|, }
block|,
block|{
literal|0x57
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\tCPU-to-PCI Byte Merging\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\tCPU-to-PCI Bursting\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\tPCI Posted Writes\n"
block|}
block|,
block|{
literal|0x40
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\tDRAM Parity Disabled\n"
block|}
block|,
block|{
literal|0x48
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\tPCI IDE controller: Primary (1F0h-1F7h,3F6h,3F7h)"
block|}
block|,
block|{
literal|0x48
block|,
literal|0x03
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\tPCI IDE controller: Secondary (170h-177h,376h,377h)"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\tRTC (70-77h)\n"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\tKeyboard (60,62,64,66h)\n"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x08
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"\tIRQ12/M Mouse Function\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82424zx
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tCPU: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"486DX"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"486SX"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"486DX2 or 486DX4"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|"Overdrive (writeback)"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|", bus="
block|}
block|,
block|{
literal|0x50
block|,
literal|0x03
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"25MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"33MHz"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_TR
block|,
literal|", CPU->Memory posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x30
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"\n\tWarning:"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|" NO cache parity!"
block|}
block|,
block|{
literal|0x56
block|,
literal|0x10
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|" NO DRAM parity!"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tWarning: refresh OFF! "
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCache: "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"None"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"64KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x41
block|,
name|M_EQ
block|,
literal|"128KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x81
block|,
name|M_EQ
block|,
literal|"256KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0xc1
block|,
name|M_EQ
block|,
literal|"512KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" writethrough"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" writeback"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", cache clocks="
block|}
block|,
block|{
literal|0x52
block|,
literal|0x05
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"3-1-1-1"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x05
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|"2-1-1-1"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tDRAM:"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|" page mode"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|" code fetch"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x43
block|,
name|M_EQ
block|,
literal|","
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x42
block|,
name|M_EQ
block|,
literal|" and"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x40
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|" read"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" and"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x41
block|,
name|M_EQ
block|,
literal|" and"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" write"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x43
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|","
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" memory clocks="
block|}
block|,
block|{
literal|0x55
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"X-2-2-2"
block|}
block|,
block|{
literal|0x55
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"X-1-2-1"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCPU->PCI: posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|", burst mode "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tPCI->Memory: posting "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82434lx
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tCPU: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0x82
block|,
name|M_EQ
block|,
literal|"Pentium, 60MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0x83
block|,
name|M_EQ
block|,
literal|"Pentium, 66MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0xa2
block|,
name|M_EQ
block|,
literal|"Pentium, 90MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe3
block|,
literal|0xa3
block|,
name|M_EQ
block|,
literal|"Pentium, 100MHz"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xc2
block|,
literal|0x82
block|,
name|M_NE
block|,
literal|"(unknown)"
block|}
block|,
block|{
literal|0x50
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" (primary cache OFF)"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_TR
block|,
literal|", CPU->Memory posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_NE
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x08
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|", read around write"
block|}
block|,
block|{
literal|0x70
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tWarning: Cache parity disabled!"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x20
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"\n\tWarning: DRAM parity mask!"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tWarning: refresh OFF! "
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCache: "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"None"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x81
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|""
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0x81
block|,
name|M_EQ
block|,
literal|"256KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc1
block|,
literal|0xc1
block|,
name|M_EQ
block|,
literal|"512KB"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" writethrough"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" writeback"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", cache clocks="
block|}
block|,
block|{
literal|0x52
block|,
literal|0x21
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"3-2-2-2/4-2-2-2"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x21
block|,
literal|0x21
block|,
name|M_EQ
block|,
literal|"3-1-1-1"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tCache flags: "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x11
block|,
literal|0x11
block|,
name|M_EQ
block|,
literal|" cache-all"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x09
block|,
literal|0x09
block|,
name|M_EQ
block|,
literal|" byte-control"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x05
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|" powersaver"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tDRAM:"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x10
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" page mode"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" memory clocks="
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"X-4-4-4 (70ns)"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"X-4-4-4/X-3-3-3 (60ns)"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|"???"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0xc0
block|,
name|M_EQ
block|,
literal|"X-3-3-3 (50ns)"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|", RAS-wait"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", CAS-wait"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCPU->PCI: posting "
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x53
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|", burst mode "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|", PCI clocks="
block|}
block|,
block|{
literal|0x54
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"2-2-2-2"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"2-1-1-1"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tPCI->Memory: posting "
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_NE
block|,
literal|"ON"
block|}
block|,
block|{
literal|0x54
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"OFF"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tRefresh:"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x03
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|" CAS#/RAS#(Hidden)"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" RAS#Only"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x05
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|" BurstOf4"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82378
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tBus Modes:"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|" Bus Park,"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|" Bus Lock,"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" Resource Lock,"
block|}
block|,
block|{
literal|0x41
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|" GAT"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"\n\tCoprocessor errors enabled"
block|}
block|,
block|{
literal|0x4d
block|,
literal|0x10
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"\n\tMouse function enabled"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x30
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"\n\tIDE controller: Primary (1F0h-1F7h,3F6h,3F7h)"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x30
block|,
literal|0x30
block|,
name|M_EQ
block|,
literal|"\n\tIDE controller: Secondary (170h-177h,376h,377h)"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x28
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 3F0h,3F1h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x24
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 3F2h-3F7h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x28
block|,
literal|0x28
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 370h,371h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x24
block|,
literal|0x24
block|,
name|M_EQ
block|,
literal|"\n\tFloppy controller: 372h-377h "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x02
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|"\n\tKeyboard controller: 60h,62h,64h,66h"
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x01
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tRTC: 70h-77h"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x80
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|"\n\tConfiguration RAM: 0C00h,0800h-08FFh"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x40
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"\n\tPort 92: enabled"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x03
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port A: COM1 (3F8h-3FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x03
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port A: COM2 (2F8h-2FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x0c
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port B: COM1 (3F8h-3FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x0c
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tSerial Port B: COM2 (2F8h-2FFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x30
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"\n\tParallel Port: LPT1 (3BCh-3BFh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x30
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"\n\tParallel Port: LPT2 (378h-37Fh)"
block|}
block|,
block|{
literal|0x4f
block|,
literal|0x30
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"\n\tParallel Port: LPT3 (278h-27Fh)"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82437fx
index|[]
init|=
block|{
comment|/* PCON -- PCI Control Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tCPU Inactivity timer: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0xe0
block|,
name|M_EQ
block|,
literal|"8"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0xd0
block|,
name|M_EQ
block|,
literal|"7"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0xc0
block|,
name|M_EQ
block|,
literal|"6"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0xb0
block|,
name|M_EQ
block|,
literal|"5"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0xa0
block|,
name|M_EQ
block|,
literal|"4"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x90
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x50
block|,
literal|0xe0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"1"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" clocks\n\tPeer Concurrency: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x08
block|,
literal|0x08
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCPU-to-PCI Write Bursting: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_NN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tPCI Streaming: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x02
block|,
literal|0x00
block|,
name|M_NN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tBus Concurrency: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_NN
block|,
literal|0
block|}
block|,
comment|/* CC -- Cache Control Regsiter */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCache:"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|" 512K"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|" 256K"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" NO"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" pipelined-burst"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|" burst"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|" asynchronous"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x30
block|,
name|M_EQ
block|,
literal|" dual-bank pipelined-burst"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" secondary; L1 "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* DRAMC -- DRAM Control Register */
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"Warning: refresh OFF!\n"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tDRAM:"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" no memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|" 512K-640K memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|" 15M-16M memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", 50 MHz refresh"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|", 60 MHz refresh"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|", 66 MHz refresh"
block|}
block|,
comment|/* DRAMT = DRAM Timing Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tRead burst timing: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"x-4-4-4/x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"x-3-3-3/x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"x-2-2-2/x-3-3-3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x60
block|,
name|M_EQ
block|,
literal|"???"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tWrite burst timing: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"x-3-3-3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"x-2-2-2"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x18
block|,
name|M_EQ
block|,
literal|"???"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tRAS-CAS delay: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" clocks\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82437vx
index|[]
init|=
block|{
comment|/* PCON -- PCI Control Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tPCI Concurrency: "
block|}
block|,
block|{
literal|0x50
block|,
literal|0x08
block|,
literal|0x08
block|,
name|M_EN
block|,
literal|0
block|}
block|,
comment|/* CC -- Cache Control Regsiter */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCache:"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|" 512K"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|" 256K"
block|}
block|,
block|{
literal|0x52
block|,
literal|0xc0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" NO"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" pipelined-burst"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|" burst"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|" asynchronous"
block|}
block|,
block|{
literal|0x52
block|,
literal|0x30
block|,
literal|0x30
block|,
name|M_EQ
block|,
literal|" dual-bank pipelined-burst"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" secondary; L1 "
block|}
block|,
block|{
literal|0x52
block|,
literal|0x01
block|,
literal|0x00
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* DRAMC -- DRAM Control Register */
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"Warning: refresh OFF!\n"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tDRAM:"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|" no memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|" 512K-640K memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xc0
block|,
literal|0x80
block|,
name|M_EQ
block|,
literal|" 15M-16M memory hole"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x01
block|,
name|M_EQ
block|,
literal|", 50 MHz refresh"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x02
block|,
name|M_EQ
block|,
literal|", 60 MHz refresh"
block|}
block|,
block|{
literal|0x57
block|,
literal|0x07
block|,
literal|0x03
block|,
name|M_EQ
block|,
literal|", 66 MHz refresh"
block|}
block|,
comment|/* DRAMT = DRAM Timing Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tRead burst timing: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"x-4-4-4/x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x20
block|,
name|M_EQ
block|,
literal|"x-3-3-3/x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"x-2-2-2/x-3-3-3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x60
block|,
literal|0x60
block|,
name|M_EQ
block|,
literal|"???"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tWrite burst timing: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"x-4-4-4"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x08
block|,
name|M_EQ
block|,
literal|"x-3-3-3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x10
block|,
name|M_EQ
block|,
literal|"x-2-2-2"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x18
block|,
literal|0x18
block|,
name|M_EQ
block|,
literal|"???"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tRAS-CAS delay: "
block|}
block|,
block|{
literal|0x58
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x58
block|,
literal|0x04
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" clocks\n"
block|}
block|,
comment|/* end marker */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82371fb
index|[]
init|=
block|{
comment|/* IORT -- ISA I/O Recovery Timer Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tI/O Recovery Timing: 8-bit "
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x40
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3.5"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x48
block|,
name|M_EQ
block|,
literal|"1"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x50
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x58
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x60
block|,
name|M_EQ
block|,
literal|"4"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x68
block|,
name|M_EQ
block|,
literal|"5"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x70
block|,
name|M_EQ
block|,
literal|"6"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x78
block|,
name|M_EQ
block|,
literal|"7"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x78
block|,
literal|0x40
block|,
name|M_EQ
block|,
literal|"8"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" clocks, 16-bit "
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x04
block|,
literal|0x00
block|,
name|M_EQ
block|,
literal|"3.5"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x07
block|,
literal|0x05
block|,
name|M_EQ
block|,
literal|"1"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x07
block|,
literal|0x06
block|,
name|M_EQ
block|,
literal|"2"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x07
block|,
literal|0x07
block|,
name|M_EQ
block|,
literal|"3"
block|}
block|,
block|{
literal|0x4c
block|,
literal|0x07
block|,
literal|0x04
block|,
name|M_EQ
block|,
literal|"4"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|" clocks\n"
block|}
block|,
comment|/* XBCS -- X-Bus Chip Select Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tExtended BIOS: "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x80
block|,
literal|0x80
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tLower BIOS: "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x40
block|,
literal|0x40
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tCoprocessor IRQ13: "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x20
block|,
literal|0x20
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tMouse IRQ12: "
block|}
block|,
block|{
literal|0x4e
block|,
literal|0x10
block|,
literal|0x10
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tInterrupt Routing: "
block|}
block|,
define|#
directive|define
name|PIRQ
parameter_list|(
name|x
parameter_list|,
name|n
parameter_list|)
define|\
value|{ 0x00, 0x00, 0x00, M_TR, n ": " }, \     { x, 0x80, 0x80, M_EQ, "disabled" }, \     { x, 0xc0, 0x40, M_EQ, "[shared] " }, \     { x, 0x8f, 0x03, M_EQ, "IRQ3" }, \     { x, 0x8f, 0x04, M_EQ, "IRQ4" }, \     { x, 0x8f, 0x05, M_EQ, "IRQ5" }, \     { x, 0x8f, 0x06, M_EQ, "IRQ6" }, \     { x, 0x8f, 0x07, M_EQ, "IRQ7" }, \     { x, 0x8f, 0x09, M_EQ, "IRQ9" }, \     { x, 0x8f, 0x0a, M_EQ, "IRQ10" }, \     { x, 0x8f, 0x0b, M_EQ, "IRQ11" }, \     { x, 0x8f, 0x0c, M_EQ, "IRQ12" }, \     { x, 0x8f, 0x0e, M_EQ, "IRQ14" }, \     { x, 0x8f, 0x0f, M_EQ, "IRQ15" }
comment|/* Interrupt routing */
name|PIRQ
argument_list|(
literal|0x60
argument_list|,
literal|"A"
argument_list|)
block|,
name|PIRQ
argument_list|(
literal|0x61
argument_list|,
literal|", B"
argument_list|)
block|,
name|PIRQ
argument_list|(
literal|0x62
argument_list|,
literal|", C"
argument_list|)
block|,
name|PIRQ
argument_list|(
literal|0x63
argument_list|,
literal|", D"
argument_list|)
block|,
name|PIRQ
argument_list|(
literal|0x70
argument_list|,
literal|"\n\t\tMB0"
argument_list|)
block|,
name|PIRQ
argument_list|(
literal|0x71
argument_list|,
literal|", MB1"
argument_list|)
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
undef|#
directive|undef
name|PIRQ
comment|/* XXX - do DMA routing, too? */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|condmsg
name|conf82371fb2
index|[]
init|=
block|{
comment|/* IDETM -- IDE Timing Register */
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\tPrimary IDE: "
block|}
block|,
block|{
literal|0x41
block|,
literal|0x80
block|,
literal|0x80
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n\tSecondary IDE: "
block|}
block|,
block|{
literal|0x43
block|,
literal|0x80
block|,
literal|0x80
block|,
name|M_EN
block|,
literal|0
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
literal|0x00
block|,
name|M_TR
block|,
literal|"\n"
block|}
block|,
comment|/* end of list */
block|{
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|writeconfig
parameter_list|(
name|device_t
name|dev
parameter_list|,
specifier|const
name|struct
name|condmsg
modifier|*
name|tbl
parameter_list|)
block|{
while|while
condition|(
name|tbl
operator|->
name|flags
operator|!=
name|M_XX
condition|)
block|{
specifier|const
name|char
modifier|*
name|text
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|tbl
operator|->
name|flags
operator|==
name|M_TR
condition|)
block|{
name|text
operator|=
name|tbl
operator|->
name|text
expr_stmt|;
block|}
else|else
block|{
name|unsigned
name|char
name|v
init|=
name|pci_read_config
argument_list|(
name|dev
argument_list|,
name|tbl
operator|->
name|port
argument_list|,
literal|1
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|tbl
operator|->
name|flags
condition|)
block|{
case|case
name|M_EQ
case|:
if|if
condition|(
operator|(
name|v
operator|&
name|tbl
operator|->
name|mask
operator|)
operator|==
name|tbl
operator|->
name|value
condition|)
name|text
operator|=
name|tbl
operator|->
name|text
expr_stmt|;
break|break;
case|case
name|M_NE
case|:
if|if
condition|(
operator|(
name|v
operator|&
name|tbl
operator|->
name|mask
operator|)
operator|!=
name|tbl
operator|->
name|value
condition|)
name|text
operator|=
name|tbl
operator|->
name|text
expr_stmt|;
break|break;
case|case
name|M_EN
case|:
name|text
operator|=
operator|(
name|v
operator|&
name|tbl
operator|->
name|mask
operator|)
condition|?
literal|"enabled"
else|:
literal|"disabled"
expr_stmt|;
break|break;
case|case
name|M_NN
case|:
name|text
operator|=
operator|(
name|v
operator|&
name|tbl
operator|->
name|mask
operator|)
condition|?
literal|"disabled"
else|:
literal|"enabled"
expr_stmt|;
block|}
block|}
if|if
condition|(
name|text
condition|)
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|tbl
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|DUMPCONFIGSPACE
end_ifdef

begin_function
specifier|static
name|void
name|dumpconfigspace
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|int
name|reg
decl_stmt|;
name|printf
argument_list|(
literal|"configuration space registers:"
argument_list|)
expr_stmt|;
for|for
control|(
name|reg
operator|=
literal|0
init|;
name|reg
operator|<
literal|0x100
condition|;
name|reg
operator|+=
literal|4
control|)
block|{
if|if
condition|(
operator|(
name|reg
operator|&
literal|0x0f
operator|)
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"\n%02x:\t"
argument_list|,
name|reg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%08x "
argument_list|,
name|pci_read_config
argument_list|(
name|dev
argument_list|,
name|reg
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* DUMPCONFIGSPACE */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* PCI_QUIET */
end_comment

begin_function
specifier|static
name|void
name|chipset_attach
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|int
name|unit
parameter_list|)
block|{
ifndef|#
directive|ifndef
name|PCI_QUIET
if|if
condition|(
operator|!
name|bootverbose
condition|)
return|return;
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
literal|0x04868086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82425ex
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x04838086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82424zx
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x04a38086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82434lx
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x04848086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82378
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x122d8086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82437fx
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x70308086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82437vx
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x70008086
case|:
case|case
literal|0x122e8086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82371fb
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x70108086
case|:
case|case
literal|0x12308086
case|:
name|writeconfig
argument_list|(
name|dev
argument_list|,
name|conf82371fb2
argument_list|)
expr_stmt|;
break|break;
if|#
directive|if
literal|0
block|case 0x00011011:
comment|/* DEC 21050 */
block|case 0x00221014:
comment|/* IBM xxx */
block|writeconfig (dev, conf_pci2pci); 		break;
endif|#
directive|endif
block|}
empty_stmt|;
endif|#
directive|endif
comment|/* PCI_QUIET */
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|pci_bridge_type
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|char
modifier|*
name|descr
decl_stmt|,
name|tmpbuf
index|[
literal|120
index|]
decl_stmt|;
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|!=
name|PCIC_BRIDGE
condition|)
return|return
name|NULL
return|;
switch|switch
condition|(
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
name|PCIS_BRIDGE_HOST
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"Host to PCI"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_ISA
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to ISA"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_EISA
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to EISA"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_MCA
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to MCA"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_PCI
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to PCI"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_PCMCIA
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to PCMCIA"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_NUBUS
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to NUBUS"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_CARDBUS
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to CardBus"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PCIS_BRIDGE_OTHER
case|:
name|strcpy
argument_list|(
name|tmpbuf
argument_list|,
literal|"PCI to Other"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|snprintf
argument_list|(
name|tmpbuf
argument_list|,
sizeof|sizeof
argument_list|(
name|tmpbuf
argument_list|)
argument_list|,
literal|"PCI to 0x%x"
argument_list|,
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|snprintf
argument_list|(
name|tmpbuf
operator|+
name|strlen
argument_list|(
name|tmpbuf
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|tmpbuf
argument_list|)
operator|-
name|strlen
argument_list|(
name|tmpbuf
argument_list|)
argument_list|,
literal|" bridge (vendor=%04x device=%04x)"
argument_list|,
name|pci_get_vendor
argument_list|(
name|dev
argument_list|)
argument_list|,
name|pci_get_device
argument_list|(
name|dev
argument_list|)
argument_list|)
expr_stmt|;
name|descr
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|tmpbuf
argument_list|)
operator|+
literal|1
argument_list|,
name|M_DEVBUF
argument_list|,
name|M_WAITOK
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|descr
argument_list|,
name|tmpbuf
argument_list|)
expr_stmt|;
return|return
name|descr
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|pcib_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
comment|/* Intel -- vendor 0x8086 */
case|case
literal|0x71818086
case|:
return|return
operator|(
literal|"Intel 82443LX (440 LX) PCI-PCI (AGP) bridge"
operator|)
return|;
case|case
literal|0x71918086
case|:
return|return
operator|(
literal|"Intel 82443BX (440 BX) PCI-PCI (AGP) bridge"
operator|)
return|;
case|case
literal|0x71A18086
case|:
return|return
operator|(
literal|"Intel 82443GX (440 GX) PCI-PCI (AGP) bridge"
operator|)
return|;
case|case
literal|0x84cb8086
case|:
return|return
operator|(
literal|"Intel 82454NX PCI Expander Bridge"
operator|)
return|;
case|case
literal|0x11318086
case|:
return|return
operator|(
literal|"Intel 82801BA/BAM (ICH2) PCI-PCI (AGP) bridge"
operator|)
return|;
case|case
literal|0x124b8086
case|:
return|return
operator|(
literal|"Intel 82380FB mobile PCI to PCI bridge"
operator|)
return|;
case|case
literal|0x24188086
case|:
return|return
operator|(
literal|"Intel 82801AA (ICH) Hub to PCI bridge"
operator|)
return|;
case|case
literal|0x24288086
case|:
return|return
operator|(
literal|"Intel 82801AB (ICH0) Hub to PCI bridge"
operator|)
return|;
case|case
literal|0x244e8086
case|:
return|return
operator|(
literal|"Intel 82801BA/BAM (ICH2) Hub to PCI bridge"
operator|)
return|;
case|case
literal|0x1a318086
case|:
return|return
operator|(
literal|"Intel 82845 PCI-PCI (AGP) bridge"
operator|)
return|;
comment|/* VLSI -- vendor 0x1004 */
case|case
literal|0x01021004
case|:
return|return
operator|(
literal|"VLSI 82C534 Eagle II PCI Bus bridge"
operator|)
return|;
case|case
literal|0x01031004
case|:
return|return
operator|(
literal|"VLSI 82C538 Eagle II PCI Docking bridge"
operator|)
return|;
comment|/* VIA Technologies -- vendor 0x1106 */
case|case
literal|0x83051106
case|:
return|return
operator|(
literal|"VIA 8363 (Apollo KT133) PCI-PCI (AGP) bridge"
operator|)
return|;
case|case
literal|0x85981106
case|:
return|return
operator|(
literal|"VIA 82C598MVP (Apollo MVP3) PCI-PCI (AGP) bridge"
operator|)
return|;
comment|/* AcerLabs -- vendor 0x10b9 */
comment|/* Funny : The datasheet told me vendor id is "10b8",sub-vendor */
comment|/* id is '10b9" but the register always shows "10b9". -Foxfair  */
case|case
literal|0x524710b9
case|:
return|return
operator|(
literal|"AcerLabs M5247 PCI-PCI(AGP Supported) bridge"
operator|)
return|;
case|case
literal|0x524310b9
case|:
comment|/* 5243 seems like 5247, need more info to divide*/
return|return
operator|(
literal|"AcerLabs M5243 PCI-PCI bridge"
operator|)
return|;
comment|/* AMD -- vendor 0x1022 */
case|case
literal|0x70071022
case|:
return|return
operator|(
literal|"AMD-751 PCI-PCI (1x/2x AGP) bridge"
operator|)
return|;
case|case
literal|0x700f1022
case|:
return|return
operator|(
literal|"AMD-761 PCI-PCI (4x AGP) bridge"
operator|)
return|;
comment|/* DEC -- vendor 0x1011 */
case|case
literal|0x00011011
case|:
return|return
operator|(
literal|"DEC 21050 PCI-PCI bridge"
operator|)
return|;
case|case
literal|0x00211011
case|:
return|return
operator|(
literal|"DEC 21052 PCI-PCI bridge"
operator|)
return|;
case|case
literal|0x00221011
case|:
return|return
operator|(
literal|"DEC 21150 PCI-PCI bridge"
operator|)
return|;
case|case
literal|0x00241011
case|:
return|return
operator|(
literal|"DEC 21152 PCI-PCI bridge"
operator|)
return|;
case|case
literal|0x00251011
case|:
return|return
operator|(
literal|"DEC 21153 PCI-PCI bridge"
operator|)
return|;
case|case
literal|0x00261011
case|:
return|return
operator|(
literal|"DEC 21154 PCI-PCI bridge"
operator|)
return|;
comment|/* Others */
case|case
literal|0x00221014
case|:
return|return
operator|(
literal|"IBM 82351 PCI-PCI bridge"
operator|)
return|;
comment|/* UMC United Microelectronics 0x1060 */
case|case
literal|0x88811060
case|:
return|return
operator|(
literal|"UMC UM8881 HB4 486 PCI Chipset"
operator|)
return|;
block|}
empty_stmt|;
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIC_BRIDGE
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_BRIDGE_PCI
condition|)
return|return
name|pci_bridge_type
argument_list|(
name|dev
argument_list|)
return|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pcib_probe
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|desc
decl_stmt|;
name|desc
operator|=
name|pcib_match
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|desc
condition|)
block|{
name|device_set_desc_copy
argument_list|(
name|dev
argument_list|,
name|desc
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|ENXIO
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pcib_attach
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|u_int8_t
name|secondary
decl_stmt|;
name|chipset_attach
argument_list|(
name|dev
argument_list|,
name|device_get_unit
argument_list|(
name|dev
argument_list|)
argument_list|)
expr_stmt|;
name|secondary
operator|=
name|pci_get_secondarybus
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|secondary
condition|)
block|{
name|device_add_child
argument_list|(
name|dev
argument_list|,
literal|"pci"
argument_list|,
name|secondary
argument_list|)
expr_stmt|;
return|return
name|bus_generic_attach
argument_list|(
name|dev
argument_list|)
return|;
block|}
else|else
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pcib_read_ivar
parameter_list|(
name|device_t
name|dev
parameter_list|,
name|device_t
name|child
parameter_list|,
name|int
name|which
parameter_list|,
name|u_long
modifier|*
name|result
parameter_list|)
block|{
if|if
condition|(
name|which
operator|==
name|PCIB_IVAR_HOSE
condition|)
block|{
comment|/* 		 * Pass up to parent bus. 		 */
operator|*
name|result
operator|=
name|pci_get_hose
argument_list|(
name|dev
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
return|return
name|ENOENT
return|;
block|}
end_function

begin_comment
comment|/*  * Route an interrupt across a PCI bridge.  */
end_comment

begin_function
specifier|static
name|int
name|pcib_route_interrupt
parameter_list|(
name|device_t
name|pcib
parameter_list|,
name|device_t
name|dev
parameter_list|,
name|int
name|pin
parameter_list|)
block|{
name|device_t
name|bus
decl_stmt|;
name|int
name|parent_intpin
decl_stmt|;
name|int
name|intnum
decl_stmt|;
name|device_printf
argument_list|(
name|pcib
argument_list|,
literal|"Hi!\n"
argument_list|)
expr_stmt|;
comment|/*	 	 * 	 * The PCI standard defines a swizzle of the child-side device/intpin 	 * to the parent-side intpin as follows. 	 * 	 * device = device on child bus 	 * child_intpin = intpin on child bus slot (0-3) 	 * parent_intpin = intpin on parent bus slot (0-3) 	 * 	 * parent_intpin = (device + child_intpin) % 4 	 */
name|parent_intpin
operator|=
operator|(
name|pci_get_slot
argument_list|(
name|pcib
argument_list|)
operator|+
operator|(
name|pin
operator|-
literal|1
operator|)
operator|)
operator|%
literal|4
expr_stmt|;
comment|/* 	 * Our parent is a PCI bus.  Its parent must export the pci interface 	 * which includes the ability to route interrupts. 	 */
name|bus
operator|=
name|device_get_parent
argument_list|(
name|pcib
argument_list|)
expr_stmt|;
name|intnum
operator|=
name|PCI_ROUTE_INTERRUPT
argument_list|(
name|device_get_parent
argument_list|(
name|bus
argument_list|)
argument_list|,
name|pcib
argument_list|,
name|parent_intpin
operator|+
literal|1
argument_list|)
expr_stmt|;
name|device_printf
argument_list|(
name|pcib
argument_list|,
literal|"routed slot %d INT%c to irq %d\n"
argument_list|,
name|pci_get_slot
argument_list|(
name|dev
argument_list|)
argument_list|,
literal|'A'
operator|+
name|pin
operator|-
literal|1
argument_list|,
name|intnum
argument_list|)
expr_stmt|;
return|return
operator|(
name|intnum
operator|)
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|device_method_t
name|pcib_methods
index|[]
init|=
block|{
comment|/* Device interface */
name|DEVMETHOD
argument_list|(
name|device_probe
argument_list|,
name|pcib_probe
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_attach
argument_list|,
name|pcib_attach
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_shutdown
argument_list|,
name|bus_generic_shutdown
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_suspend
argument_list|,
name|bus_generic_suspend
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_resume
argument_list|,
name|bus_generic_resume
argument_list|)
block|,
comment|/* Bus interface */
name|DEVMETHOD
argument_list|(
name|bus_print_child
argument_list|,
name|bus_generic_print_child
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_read_ivar
argument_list|,
name|pcib_read_ivar
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_alloc_resource
argument_list|,
name|bus_generic_alloc_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_release_resource
argument_list|,
name|bus_generic_release_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_activate_resource
argument_list|,
name|bus_generic_activate_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_deactivate_resource
argument_list|,
name|bus_generic_deactivate_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_setup_intr
argument_list|,
name|bus_generic_setup_intr
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_teardown_intr
argument_list|,
name|bus_generic_teardown_intr
argument_list|)
block|,
comment|/* pci interface */
name|DEVMETHOD
argument_list|(
name|pci_route_interrupt
argument_list|,
name|pcib_route_interrupt
argument_list|)
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|driver_t
name|pcib_driver
init|=
block|{
literal|"pcib"
block|,
name|pcib_methods
block|,
literal|1
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|devclass_t
name|pcib_devclass
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DRIVER_MODULE
argument_list|(
name|pcib
argument_list|,
name|pci
argument_list|,
name|pcib_driver
argument_list|,
name|pcib_devclass
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|eisab_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
literal|0x04828086
case|:
comment|/* Recognize this specifically, it has PCI-HOST class (!) */
return|return
operator|(
literal|"Intel 82375EB PCI-EISA bridge"
operator|)
return|;
block|}
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIC_BRIDGE
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_BRIDGE_EISA
condition|)
return|return
name|pci_bridge_type
argument_list|(
name|dev
argument_list|)
return|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|isab_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|unsigned
name|rev
decl_stmt|;
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
literal|0x04848086
case|:
name|rev
operator|=
name|pci_get_revid
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|rev
operator|==
literal|3
condition|)
return|return
operator|(
literal|"Intel 82378ZB PCI to ISA bridge"
operator|)
return|;
return|return
operator|(
literal|"Intel 82378IB PCI to ISA bridge"
operator|)
return|;
case|case
literal|0x122e8086
case|:
return|return
operator|(
literal|"Intel 82371FB PCI to ISA bridge"
operator|)
return|;
case|case
literal|0x70008086
case|:
return|return
operator|(
literal|"Intel 82371SB PCI to ISA bridge"
operator|)
return|;
case|case
literal|0x71108086
case|:
return|return
operator|(
literal|"Intel 82371AB PCI to ISA bridge"
operator|)
return|;
case|case
literal|0x71988086
case|:
return|return
operator|(
literal|"Intel 82443MX PCI to ISA bridge"
operator|)
return|;
case|case
literal|0x24108086
case|:
return|return
operator|(
literal|"Intel 82801AA (ICH) PCI to LPC bridge"
operator|)
return|;
case|case
literal|0x24208086
case|:
return|return
operator|(
literal|"Intel 82801AB (ICH0) PCI to LPC bridge"
operator|)
return|;
case|case
literal|0x24408086
case|:
return|return
operator|(
literal|"Intel 82801BA/BAM (ICH2) PCI to LPC bridge"
operator|)
return|;
comment|/* VLSI -- vendor 0x1004 */
case|case
literal|0x00061004
case|:
return|return
operator|(
literal|"VLSI 82C593 PCI to ISA bridge"
operator|)
return|;
comment|/* VIA Technologies -- vendor 0x1106 */
case|case
literal|0x05861106
case|:
comment|/* south bridge section */
return|return
operator|(
literal|"VIA 82C586 PCI-ISA bridge"
operator|)
return|;
case|case
literal|0x05961106
case|:
return|return
operator|(
literal|"VIA 82C596B PCI-ISA bridge"
operator|)
return|;
case|case
literal|0x06861106
case|:
return|return
operator|(
literal|"VIA 82C686 PCI-ISA bridge"
operator|)
return|;
comment|/* AcerLabs -- vendor 0x10b9 */
comment|/* Funny : The datasheet told me vendor id is "10b8",sub-vendor */
comment|/* id is '10b9" but the register always shows "10b9". -Foxfair  */
case|case
literal|0x153310b9
case|:
return|return
operator|(
literal|"AcerLabs M1533 portable PCI-ISA bridge"
operator|)
return|;
case|case
literal|0x154310b9
case|:
return|return
operator|(
literal|"AcerLabs M1543 desktop PCI-ISA bridge"
operator|)
return|;
comment|/* SiS -- vendor 0x1039 */
case|case
literal|0x00081039
case|:
return|return
operator|(
literal|"SiS 85c503 PCI-ISA bridge"
operator|)
return|;
comment|/* Cyrix -- vendor 0x1078 */
case|case
literal|0x00001078
case|:
return|return
operator|(
literal|"Cyrix Cx5510 PCI-ISA bridge"
operator|)
return|;
case|case
literal|0x01001078
case|:
return|return
operator|(
literal|"Cyrix Cx5530 PCI-ISA bridge"
operator|)
return|;
comment|/* NEC -- vendor 0x1033 */
comment|/* The "C-bus" is 16-bits bus on PC98. */
case|case
literal|0x00011033
case|:
return|return
operator|(
literal|"NEC 0001 PCI to PC-98 C-bus bridge"
operator|)
return|;
case|case
literal|0x002c1033
case|:
return|return
operator|(
literal|"NEC 002C PCI to PC-98 C-bus bridge"
operator|)
return|;
case|case
literal|0x003b1033
case|:
return|return
operator|(
literal|"NEC 003B PCI to PC-98 C-bus bridge"
operator|)
return|;
comment|/* UMC United Microelectronics 0x1060 */
case|case
literal|0x886a1060
case|:
return|return
operator|(
literal|"UMC UM8886 ISA Bridge with EIDE"
operator|)
return|;
comment|/* Cypress -- vendor 0x1080 */
case|case
literal|0xc6931080
case|:
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIC_BRIDGE
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_BRIDGE_ISA
condition|)
return|return
operator|(
literal|"Cypress 82C693 PCI-ISA bridge"
operator|)
return|;
break|break;
comment|/* ServerWorks -- vendor 0x1166 */
case|case
literal|0x02001166
case|:
return|return
operator|(
literal|"ServerWorks IB6566 PCI to ISA bridge"
operator|)
return|;
block|}
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIC_BRIDGE
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_BRIDGE_ISA
condition|)
return|return
name|pci_bridge_type
argument_list|(
name|dev
argument_list|)
return|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|isab_probe
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|desc
decl_stmt|;
name|int
name|is_eisa
decl_stmt|;
name|is_eisa
operator|=
literal|0
expr_stmt|;
name|desc
operator|=
name|eisab_match
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|desc
condition|)
name|is_eisa
operator|=
literal|1
expr_stmt|;
else|else
name|desc
operator|=
name|isab_match
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|desc
condition|)
block|{
comment|/* 		 * For a PCI-EISA bridge, add both eisa and isa. 		 * Only add one instance of eisa or isa for now. 		 */
name|device_set_desc_copy
argument_list|(
name|dev
argument_list|,
name|desc
argument_list|)
expr_stmt|;
if|if
condition|(
name|is_eisa
operator|&&
operator|!
name|devclass_get_device
argument_list|(
name|devclass_find
argument_list|(
literal|"eisa"
argument_list|)
argument_list|,
literal|0
argument_list|)
condition|)
name|device_add_child
argument_list|(
name|dev
argument_list|,
literal|"eisa"
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|devclass_get_device
argument_list|(
name|devclass_find
argument_list|(
literal|"isa"
argument_list|)
argument_list|,
literal|0
argument_list|)
condition|)
name|device_add_child
argument_list|(
name|dev
argument_list|,
literal|"isa"
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|ENXIO
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|isab_attach
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|chipset_attach
argument_list|(
name|dev
argument_list|,
name|device_get_unit
argument_list|(
name|dev
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|bus_generic_attach
argument_list|(
name|dev
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|device_method_t
name|isab_methods
index|[]
init|=
block|{
comment|/* Device interface */
name|DEVMETHOD
argument_list|(
name|device_probe
argument_list|,
name|isab_probe
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_attach
argument_list|,
name|isab_attach
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_shutdown
argument_list|,
name|bus_generic_shutdown
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_suspend
argument_list|,
name|bus_generic_suspend
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_resume
argument_list|,
name|bus_generic_resume
argument_list|)
block|,
comment|/* Bus interface */
name|DEVMETHOD
argument_list|(
name|bus_print_child
argument_list|,
name|bus_generic_print_child
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_alloc_resource
argument_list|,
name|bus_generic_alloc_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_release_resource
argument_list|,
name|bus_generic_release_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_activate_resource
argument_list|,
name|bus_generic_activate_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_deactivate_resource
argument_list|,
name|bus_generic_deactivate_resource
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_setup_intr
argument_list|,
name|bus_generic_setup_intr
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|bus_teardown_intr
argument_list|,
name|bus_generic_teardown_intr
argument_list|)
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|driver_t
name|isab_driver
init|=
block|{
literal|"isab"
block|,
name|isab_methods
block|,
literal|1
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|devclass_t
name|isab_devclass
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DRIVER_MODULE
argument_list|(
name|isab
argument_list|,
name|pci
argument_list|,
name|isab_driver
argument_list|,
name|isab_devclass
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_function
specifier|const
name|char
modifier|*
name|pci_usb_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
comment|/* Intel -- vendor 0x8086 */
case|case
literal|0x70208086
case|:
return|return
operator|(
literal|"Intel 82371SB (PIIX3) USB controller"
operator|)
return|;
case|case
literal|0x71128086
case|:
return|return
operator|(
literal|"Intel 82371AB/EB (PIIX4) USB controller"
operator|)
return|;
case|case
literal|0x24128086
case|:
return|return
operator|(
literal|"Intel 82801AA (ICH) USB controller"
operator|)
return|;
case|case
literal|0x24228086
case|:
return|return
operator|(
literal|"Intel 82801AB (ICH0) USB controller"
operator|)
return|;
case|case
literal|0x24428086
case|:
return|return
operator|(
literal|"Intel 82801BA/BAM (ICH2) USB controller USB-A"
operator|)
return|;
case|case
literal|0x24448086
case|:
return|return
operator|(
literal|"Intel 82801BA/BAM (ICH2) USB controller USB-B"
operator|)
return|;
comment|/* VIA Technologies -- vendor 0x1106 (0x1107 on the Apollo Master) */
case|case
literal|0x30381106
case|:
return|return
operator|(
literal|"VIA 83C572 USB controller"
operator|)
return|;
comment|/* AcerLabs -- vendor 0x10b9 */
case|case
literal|0x523710b9
case|:
return|return
operator|(
literal|"AcerLabs M5237 (Aladdin-V) USB controller"
operator|)
return|;
comment|/* OPTi -- vendor 0x1045 */
case|case
literal|0xc8611045
case|:
return|return
operator|(
literal|"OPTi 82C861 (FireLink) USB controller"
operator|)
return|;
comment|/* NEC -- vendor 0x1033 */
case|case
literal|0x00351033
case|:
return|return
operator|(
literal|"NEC uPD 9210 USB controller"
operator|)
return|;
comment|/* CMD Tech -- vendor 0x1095 */
case|case
literal|0x06701095
case|:
return|return
operator|(
literal|"CMD Tech 670 (USB0670) USB controller"
operator|)
return|;
case|case
literal|0x06731095
case|:
return|return
operator|(
literal|"CMD Tech 673 (USB0673) USB controller"
operator|)
return|;
block|}
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIC_SERIALBUS
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_SERIALBUS_USB
condition|)
block|{
if|if
condition|(
name|pci_get_progif
argument_list|(
name|dev
argument_list|)
operator|==
literal|0x00
comment|/* UHCI */
condition|)
block|{
return|return
operator|(
literal|"UHCI USB controller"
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|pci_get_progif
argument_list|(
name|dev
argument_list|)
operator|==
literal|0x10
comment|/* OHCI */
condition|)
block|{
return|return
operator|(
literal|"OHCI USB controller"
operator|)
return|;
block|}
else|else
block|{
return|return
operator|(
literal|"USB controller"
operator|)
return|;
block|}
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|pci_ata_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
comment|/* Intel -- vendor 0x8086 */
case|case
literal|0x12308086
case|:
return|return
operator|(
literal|"Intel PIIX ATA controller"
operator|)
return|;
case|case
literal|0x70108086
case|:
return|return
operator|(
literal|"Intel PIIX3 ATA controller"
operator|)
return|;
case|case
literal|0x71118086
case|:
return|return
operator|(
literal|"Intel PIIX4 ATA controller"
operator|)
return|;
case|case
literal|0x12348086
case|:
return|return
operator|(
literal|"Intel 82371MX mobile PCI ATA accelerator (MPIIX)"
operator|)
return|;
comment|/* Promise -- vendor 0x105a */
case|case
literal|0x4d33105a
case|:
return|return
operator|(
literal|"Promise Ultra/33 ATA controller"
operator|)
return|;
case|case
literal|0x4d38105a
case|:
return|return
operator|(
literal|"Promise Ultra/66 ATA controller"
operator|)
return|;
comment|/* AcerLabs -- vendor 0x10b9 */
case|case
literal|0x522910b9
case|:
return|return
operator|(
literal|"AcerLabs Aladdin ATA controller"
operator|)
return|;
comment|/* VIA Technologies -- vendor 0x1106 (0x1107 on the Apollo Master) */
case|case
literal|0x05711106
case|:
switch|switch
condition|(
name|pci_read_config
argument_list|(
name|dev
argument_list|,
literal|0x08
argument_list|,
literal|1
argument_list|)
condition|)
block|{
case|case
literal|1
case|:
return|return
operator|(
literal|"VIA 85C586 ATA controller"
operator|)
return|;
case|case
literal|6
case|:
return|return
operator|(
literal|"VIA 85C586 ATA controller"
operator|)
return|;
block|}
comment|/* FALL THROUGH */
case|case
literal|0x15711106
case|:
return|return
operator|(
literal|"VIA Apollo ATA controller"
operator|)
return|;
comment|/* CMD Tech -- vendor 0x1095 */
case|case
literal|0x06401095
case|:
return|return
operator|(
literal|"CMD 640 ATA controller"
operator|)
return|;
case|case
literal|0x06461095
case|:
return|return
operator|(
literal|"CMD 646 ATA controller"
operator|)
return|;
comment|/* Cypress -- vendor 0x1080 */
case|case
literal|0xc6931080
case|:
return|return
operator|(
literal|"Cypress 82C693 ATA controller"
operator|)
return|;
comment|/* Cyrix -- vendor 0x1078 */
case|case
literal|0x01021078
case|:
return|return
operator|(
literal|"Cyrix 5530 ATA controller"
operator|)
return|;
comment|/* SiS -- vendor 0x1039 */
case|case
literal|0x55131039
case|:
return|return
operator|(
literal|"SiS 5591 ATA controller"
operator|)
return|;
comment|/* Highpoint tech -- vendor 0x1103 */
case|case
literal|0x00041103
case|:
return|return
operator|(
literal|"HighPoint HPT366 ATA controller"
operator|)
return|;
block|}
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIC_STORAGE
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_STORAGE_IDE
condition|)
return|return
operator|(
literal|"Unknown PCI ATA controller"
operator|)
return|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|chip_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|unsigned
name|rev
decl_stmt|;
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
comment|/* Intel -- vendor 0x8086 */
case|case
literal|0x00088086
case|:
comment|/* Silently ignore this one! What is it, anyway ??? */
return|return
operator|(
literal|""
operator|)
return|;
case|case
literal|0x71108086
case|:
comment|/* 		 * On my laptop (Tecra 8000DVD), this device has a 		 * bogus subclass 0x80 so make sure that it doesn't 		 * match the generic 'chip' driver by accident. 		 */
return|return
name|NULL
return|;
case|case
literal|0x12258086
case|:
name|fixbushigh_i1225
argument_list|(
name|dev
argument_list|)
expr_stmt|;
return|return
operator|(
literal|"Intel 824?? host to PCI bridge"
operator|)
return|;
case|case
literal|0x71808086
case|:
return|return
operator|(
literal|"Intel 82443LX (440 LX) host to PCI bridge"
operator|)
return|;
case|case
literal|0x71908086
case|:
return|return
operator|(
literal|"Intel 82443BX (440 BX) host to PCI bridge"
operator|)
return|;
case|case
literal|0x71928086
case|:
return|return
operator|(
literal|"Intel 82443BX host to PCI bridge (AGP disabled)"
operator|)
return|;
case|case
literal|0x71a08086
case|:
return|return
operator|(
literal|"Intel 82443GX host to PCI bridge"
operator|)
return|;
case|case
literal|0x71a18086
case|:
return|return
operator|(
literal|"Intel 82443GX host to AGP bridge"
operator|)
return|;
case|case
literal|0x71a28086
case|:
return|return
operator|(
literal|"Intel 82443GX host to PCI bridge (AGP disabled)"
operator|)
return|;
case|case
literal|0x84c48086
case|:
return|return
operator|(
literal|"Intel 82454KX/GX (Orion) host to PCI bridge"
operator|)
return|;
case|case
literal|0x84ca8086
case|:
return|return
operator|(
literal|"Intel 82451NX Memory and I/O controller"
operator|)
return|;
case|case
literal|0x04868086
case|:
return|return
operator|(
literal|"Intel 82425EX PCI system controller"
operator|)
return|;
case|case
literal|0x04838086
case|:
return|return
operator|(
literal|"Intel 82424ZX (Saturn) cache DRAM controller"
operator|)
return|;
case|case
literal|0x04a38086
case|:
name|rev
operator|=
name|pci_get_revid
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|rev
operator|==
literal|16
operator|||
name|rev
operator|==
literal|17
condition|)
return|return
operator|(
literal|"Intel 82434NX (Neptune) PCI cache memory controller"
operator|)
return|;
return|return
operator|(
literal|"Intel 82434LX (Mercury) PCI cache memory controller"
operator|)
return|;
case|case
literal|0x122d8086
case|:
return|return
operator|(
literal|"Intel 82437FX PCI cache memory controller"
operator|)
return|;
case|case
literal|0x12358086
case|:
return|return
operator|(
literal|"Intel 82437MX mobile PCI cache memory controller"
operator|)
return|;
case|case
literal|0x12508086
case|:
return|return
operator|(
literal|"Intel 82439HX PCI cache memory controller"
operator|)
return|;
case|case
literal|0x70308086
case|:
return|return
operator|(
literal|"Intel 82437VX PCI cache memory controller"
operator|)
return|;
case|case
literal|0x71008086
case|:
return|return
operator|(
literal|"Intel 82439TX System controller (MTXC)"
operator|)
return|;
case|case
literal|0x71138086
case|:
return|return
operator|(
literal|"Intel 82371AB Power management controller"
operator|)
return|;
case|case
literal|0x719b8086
case|:
return|return
operator|(
literal|"Intel 82443MX Power management controller"
operator|)
return|;
case|case
literal|0x12378086
case|:
name|fixwsc_natoma
argument_list|(
name|dev
argument_list|)
expr_stmt|;
return|return
operator|(
literal|"Intel 82440FX (Natoma) PCI and memory controller"
operator|)
return|;
case|case
literal|0x84c58086
case|:
return|return
operator|(
literal|"Intel 82453KX/GX (Orion) PCI memory controller"
operator|)
return|;
case|case
literal|0x71208086
case|:
return|return
operator|(
literal|"Intel 82810 (i810 GMCH) Host To Hub bridge"
operator|)
return|;
case|case
literal|0x71228086
case|:
return|return
operator|(
literal|"Intel 82810-DC100 (i810-DC100 GMCH) Host To Hub bridge"
operator|)
return|;
case|case
literal|0x71248086
case|:
return|return
operator|(
literal|"Intel 82810E (i810E GMCH) Host To Hub bridge"
operator|)
return|;
case|case
literal|0x24158086
case|:
return|return
operator|(
literal|"Intel 82801AA (ICH) AC'97 Audio Controller"
operator|)
return|;
case|case
literal|0x24258086
case|:
return|return
operator|(
literal|"Intel 82801AB (ICH0) AC'97 Audio Controller"
operator|)
return|;
comment|/* Sony -- vendor 0x104d */
case|case
literal|0x8009104d
case|:
return|return
operator|(
literal|"Sony CXD1847A FireWire Host Controller"
operator|)
return|;
comment|/* SiS -- vendor 0x1039 */
case|case
literal|0x04961039
case|:
return|return
operator|(
literal|"SiS 85c496 PCI/VL Bridge"
operator|)
return|;
case|case
literal|0x04061039
case|:
return|return
operator|(
literal|"SiS 85c501"
operator|)
return|;
case|case
literal|0x06011039
case|:
return|return
operator|(
literal|"SiS 85c601"
operator|)
return|;
case|case
literal|0x55911039
case|:
return|return
operator|(
literal|"SiS 5591 host to PCI bridge"
operator|)
return|;
case|case
literal|0x00011039
case|:
return|return
operator|(
literal|"SiS 5591 host to AGP bridge"
operator|)
return|;
comment|/* VLSI -- vendor 0x1004 */
case|case
literal|0x00051004
case|:
return|return
operator|(
literal|"VLSI 82C592 Host to PCI bridge"
operator|)
return|;
case|case
literal|0x01011004
case|:
return|return
operator|(
literal|"VLSI 82C532 Eagle II Peripheral controller"
operator|)
return|;
case|case
literal|0x01041004
case|:
return|return
operator|(
literal|"VLSI 82C535 Eagle II System controller"
operator|)
return|;
case|case
literal|0x01051004
case|:
return|return
operator|(
literal|"VLSI 82C147 IrDA controller"
operator|)
return|;
comment|/* VIA Technologies -- vendor 0x1106 (0x1107 on the Apollo Master) */
case|case
literal|0x15761107
case|:
return|return
operator|(
literal|"VIA 82C570 (Apollo Master) system controller"
operator|)
return|;
case|case
literal|0x05851106
case|:
return|return
operator|(
literal|"VIA 82C585 (Apollo VP1/VPX) system controller"
operator|)
return|;
case|case
literal|0x05951106
case|:
case|case
literal|0x15951106
case|:
return|return
operator|(
literal|"VIA 82C595 (Apollo VP2) system controller"
operator|)
return|;
case|case
literal|0x05971106
case|:
return|return
operator|(
literal|"VIA 82C597 (Apollo VP3) system controller"
operator|)
return|;
comment|/* XXX Here is MVP3, I got the datasheet but NO M/B to test it  */
comment|/* totally. Please let me know if anything wrong.            -F */
comment|/* XXX need info on the MVP3 -- any takers? */
case|case
literal|0x05981106
case|:
return|return
operator|(
literal|"VIA 82C598MVP (Apollo MVP3) host bridge"
operator|)
return|;
case|case
literal|0x30401106
case|:
return|return
operator|(
literal|"VIA 82C586B ACPI interface"
operator|)
return|;
case|case
literal|0x30571106
case|:
return|return
operator|(
literal|"VIA 82C686 ACPI interface"
operator|)
return|;
case|case
literal|0x30581106
case|:
return|return
operator|(
literal|"VIA 82C686 AC97 Audio"
operator|)
return|;
case|case
literal|0x30681106
case|:
return|return
operator|(
literal|"VIA 82C686 AC97 Modem"
operator|)
return|;
comment|/* AMD -- vendor 0x1022 */
case|case
literal|0x70061022
case|:
return|return
operator|(
literal|"AMD-751 host to PCI bridge"
operator|)
return|;
case|case
literal|0x700e1022
case|:
return|return
operator|(
literal|"AMD-761 host to PCI bridge"
operator|)
return|;
comment|/* NEC -- vendor 0x1033 */
case|case
literal|0x00021033
case|:
return|return
operator|(
literal|"NEC 0002 PCI to PC-98 local bus bridge"
operator|)
return|;
case|case
literal|0x00161033
case|:
return|return
operator|(
literal|"NEC 0016 PCI to PC-98 local bus bridge"
operator|)
return|;
comment|/* AcerLabs -- vendor 0x10b9 */
comment|/* Funny : The datasheet told me vendor id is "10b8",sub-vendor */
comment|/* id is '10b9" but the register always shows "10b9". -Foxfair  */
case|case
literal|0x154110b9
case|:
return|return
operator|(
literal|"AcerLabs M1541 (Aladdin-V) PCI host bridge"
operator|)
return|;
case|case
literal|0x710110b9
case|:
return|return
operator|(
literal|"AcerLabs M15x3 Power Management Unit"
operator|)
return|;
comment|/* OPTi -- vendor 0x1045 */
case|case
literal|0xc8221045
case|:
return|return
operator|(
literal|"OPTi 82C822 host to PCI Bridge"
operator|)
return|;
comment|/* Texas Instruments -- vendor 0x104c */
case|case
literal|0xac1c104c
case|:
return|return
operator|(
literal|"Texas Instruments PCI1225 CardBus controller"
operator|)
return|;
case|case
literal|0xac50104c
case|:
return|return
operator|(
literal|"Texas Instruments PCI1410 CardBus controller"
operator|)
return|;
case|case
literal|0xac51104c
case|:
return|return
operator|(
literal|"Texas Instruments PCI1420 CardBus controller"
operator|)
return|;
case|case
literal|0xac1b104c
case|:
return|return
operator|(
literal|"Texas Instruments PCI1450 CardBus controller"
operator|)
return|;
case|case
literal|0xac52104c
case|:
return|return
operator|(
literal|"Texas Instruments PCI1451 CardBus controller"
operator|)
return|;
comment|/* NeoMagic -- vendor 0x10c8 */
case|case
literal|0x800510c8
case|:
return|return
operator|(
literal|"NeoMagic MagicMedia 256AX Audio controller"
operator|)
return|;
case|case
literal|0x800610c8
case|:
return|return
operator|(
literal|"NeoMagic MagicMedia 256ZX Audio controller"
operator|)
return|;
comment|/* ESS Technology Inc -- vendor 0x125d */
case|case
literal|0x1978125d
case|:
return|return
operator|(
literal|"ESS Technology Maestro 2E Audio controller"
operator|)
return|;
comment|/* Toshiba -- vendor 0x1179 */
case|case
literal|0x07011179
case|:
return|return
operator|(
literal|"Toshiba Fast Infra Red controller"
operator|)
return|;
comment|/* NEC -- vendor 0x1033 */
comment|/* PCI to C-bus bridge */
comment|/* The following chipsets are PCI to PC98 C-bus bridge. 	 * The C-bus is the 16-bits bus on PC98 and it should be probed as 	 * PCI to ISA bridge.  Because class of the C-bus is not defined, 	 * C-bus bridges are recognized as "other bridge."  To make C-bus 	 * bridge be recognized as ISA bridge, this function returns NULL. 	 */
case|case
literal|0x00011033
case|:
case|case
literal|0x002c1033
case|:
case|case
literal|0x003b1033
case|:
return|return
name|NULL
return|;
block|}
empty_stmt|;
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIC_BRIDGE
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|!=
name|PCIS_BRIDGE_PCI
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|!=
name|PCIS_BRIDGE_ISA
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|!=
name|PCIS_BRIDGE_EISA
condition|)
return|return
name|pci_bridge_type
argument_list|(
name|dev
argument_list|)
return|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|chip_probe
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|desc
decl_stmt|;
name|desc
operator|=
name|chip_match
argument_list|(
name|dev
argument_list|)
expr_stmt|;
if|if
condition|(
name|desc
condition|)
block|{
if|if
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIC_BRIDGE
operator|&&
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_BRIDGE_HOST
condition|)
block|{
comment|/* 			 * Suppress printing this device since the nexus 			 * has already described it. 			 */
name|device_quiet
argument_list|(
name|dev
argument_list|)
expr_stmt|;
block|}
name|device_set_desc_copy
argument_list|(
name|dev
argument_list|,
name|desc
argument_list|)
expr_stmt|;
return|return
operator|-
literal|10000
return|;
comment|/* Low match priority */
block|}
return|return
name|ENXIO
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|chip_attach
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|chipset_attach
argument_list|(
name|dev
argument_list|,
name|device_get_unit
argument_list|(
name|dev
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|device_method_t
name|chip_methods
index|[]
init|=
block|{
comment|/* Device interface */
name|DEVMETHOD
argument_list|(
name|device_probe
argument_list|,
name|chip_probe
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_attach
argument_list|,
name|chip_attach
argument_list|)
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|driver_t
name|chip_driver
init|=
block|{
literal|"chip"
block|,
name|chip_methods
block|,
literal|1
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|devclass_t
name|chip_devclass
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DRIVER_MODULE
argument_list|(
name|chip
argument_list|,
name|pci
argument_list|,
name|chip_driver
argument_list|,
name|chip_devclass
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/*--------------------------------------------------------- ** **	Catchall driver for VGA devices ** **	By Garrett Wollman **<wollman@halloran-eldar.lcs.mit.edu> ** **--------------------------------------------------------- */
end_comment

begin_function
specifier|const
name|char
modifier|*
name|pci_vga_match
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
name|u_int
name|id
init|=
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|vendor
decl_stmt|,
modifier|*
name|chip
decl_stmt|,
modifier|*
name|type
decl_stmt|;
name|vendor
operator|=
name|chip
operator|=
name|type
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|id
operator|&
literal|0xffff
condition|)
block|{
case|case
literal|0x003d
case|:
name|vendor
operator|=
literal|"Real 3D"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x00d1
case|:
name|chip
operator|=
literal|"i740"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x10c8
case|:
name|vendor
operator|=
literal|"NeoMagic"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0003
case|:
name|chip
operator|=
literal|"MagicGraph 128ZV"
expr_stmt|;
break|break;
case|case
literal|0x0004
case|:
name|chip
operator|=
literal|"MagicGraph 128XD"
expr_stmt|;
break|break;
case|case
literal|0x0005
case|:
name|chip
operator|=
literal|"MagicMedia 256AV"
expr_stmt|;
break|break;
case|case
literal|0x0006
case|:
name|chip
operator|=
literal|"MagicMedia 256ZX"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x121a
case|:
name|vendor
operator|=
literal|"3Dfx"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0001
case|:
name|chip
operator|=
literal|"Voodoo"
expr_stmt|;
break|break;
case|case
literal|0x0002
case|:
name|chip
operator|=
literal|"Voodoo 2"
expr_stmt|;
break|break;
case|case
literal|0x0003
case|:
name|chip
operator|=
literal|"Voodoo Banshee"
expr_stmt|;
break|break;
case|case
literal|0x0005
case|:
name|chip
operator|=
literal|"Voodoo 3"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x102b
case|:
name|vendor
operator|=
literal|"Matrox"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0518
case|:
name|chip
operator|=
literal|"MGA 2085PX"
expr_stmt|;
break|break;
case|case
literal|0x0519
case|:
name|chip
operator|=
literal|"MGA Millennium 2064W"
expr_stmt|;
break|break;
case|case
literal|0x051a
case|:
name|chip
operator|=
literal|"MGA 1024SG/1064SG/1164SG"
expr_stmt|;
break|break;
case|case
literal|0x051b
case|:
name|chip
operator|=
literal|"MGA Millennium II 2164W"
expr_stmt|;
break|break;
case|case
literal|0x051f
case|:
name|chip
operator|=
literal|"MGA Millennium II 2164WA-B AG"
expr_stmt|;
break|break;
case|case
literal|0x0520
case|:
name|chip
operator|=
literal|"MGA G200"
expr_stmt|;
break|break;
case|case
literal|0x0521
case|:
name|chip
operator|=
literal|"MGA G200 AGP"
expr_stmt|;
break|break;
case|case
literal|0x0525
case|:
name|chip
operator|=
literal|"MGA G400 AGP"
expr_stmt|;
break|break;
case|case
literal|0x0d10
case|:
name|chip
operator|=
literal|"MGA Impression"
expr_stmt|;
break|break;
case|case
literal|0x1000
case|:
name|chip
operator|=
literal|"MGA G100"
expr_stmt|;
break|break;
case|case
literal|0x1001
case|:
name|chip
operator|=
literal|"MGA G100 AGP"
expr_stmt|;
break|break;
case|case
literal|0x2527
case|:
name|chip
operator|=
literal|"MGA G550 AGP"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1002
case|:
name|vendor
operator|=
literal|"ATI"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x4158
case|:
name|chip
operator|=
literal|"Mach32"
expr_stmt|;
break|break;
case|case
literal|0x4354
case|:
name|chip
operator|=
literal|"Mach64-CT"
expr_stmt|;
break|break;
case|case
literal|0x4358
case|:
name|chip
operator|=
literal|"Mach64-CX"
expr_stmt|;
break|break;
case|case
literal|0x4554
case|:
name|chip
operator|=
literal|"Mach64-ET"
expr_stmt|;
break|break;
case|case
literal|0x4654
case|:
case|case
literal|0x5654
case|:
name|chip
operator|=
literal|"Mach64-VT"
expr_stmt|;
break|break;
case|case
literal|0x4742
case|:
name|chip
operator|=
literal|"Mach64-GB"
expr_stmt|;
break|break;
case|case
literal|0x4744
case|:
name|chip
operator|=
literal|"Mach64-GD"
expr_stmt|;
break|break;
case|case
literal|0x4749
case|:
name|chip
operator|=
literal|"Mach64-GI"
expr_stmt|;
break|break;
case|case
literal|0x474d
case|:
name|chip
operator|=
literal|"Mach64-GM"
expr_stmt|;
break|break;
case|case
literal|0x474e
case|:
name|chip
operator|=
literal|"Mach64-GN"
expr_stmt|;
break|break;
case|case
literal|0x474f
case|:
name|chip
operator|=
literal|"Mach64-GO"
expr_stmt|;
break|break;
case|case
literal|0x4750
case|:
name|chip
operator|=
literal|"Mach64-GP"
expr_stmt|;
break|break;
case|case
literal|0x4751
case|:
name|chip
operator|=
literal|"Mach64-GQ"
expr_stmt|;
break|break;
case|case
literal|0x4752
case|:
name|chip
operator|=
literal|"Mach64-GR"
expr_stmt|;
break|break;
case|case
literal|0x4753
case|:
name|chip
operator|=
literal|"Mach64-GS"
expr_stmt|;
break|break;
case|case
literal|0x4754
case|:
name|chip
operator|=
literal|"Mach64-GT"
expr_stmt|;
break|break;
case|case
literal|0x4755
case|:
name|chip
operator|=
literal|"Mach64-GU"
expr_stmt|;
break|break;
case|case
literal|0x4756
case|:
name|chip
operator|=
literal|"Mach64-GV"
expr_stmt|;
break|break;
case|case
literal|0x4757
case|:
name|chip
operator|=
literal|"Mach64-GW"
expr_stmt|;
break|break;
case|case
literal|0x4758
case|:
name|chip
operator|=
literal|"Mach64-GX"
expr_stmt|;
break|break;
case|case
literal|0x4c4d
case|:
name|chip
operator|=
literal|"Mobility-1"
expr_stmt|;
break|break;
case|case
literal|0x4c52
case|:
name|chip
operator|=
literal|"RageMobility-P/M"
expr_stmt|;
break|break;
case|case
literal|0x475a
case|:
name|chip
operator|=
literal|"Mach64-GZ"
expr_stmt|;
break|break;
case|case
literal|0x5245
case|:
name|chip
operator|=
literal|"Rage128-RE"
expr_stmt|;
break|break;
case|case
literal|0x5246
case|:
name|chip
operator|=
literal|"Rage128-RF"
expr_stmt|;
break|break;
case|case
literal|0x524b
case|:
name|chip
operator|=
literal|"Rage128-RK"
expr_stmt|;
break|break;
case|case
literal|0x524c
case|:
name|chip
operator|=
literal|"Rage128-RL"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1005
case|:
name|vendor
operator|=
literal|"Avance Logic"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x2301
case|:
name|chip
operator|=
literal|"ALG2301"
expr_stmt|;
break|break;
case|case
literal|0x2302
case|:
name|chip
operator|=
literal|"ALG2302"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x100c
case|:
name|vendor
operator|=
literal|"Tseng Labs"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x3202
case|:
case|case
literal|0x3205
case|:
case|case
literal|0x3206
case|:
case|case
literal|0x3207
case|:
name|chip
operator|=
literal|"ET4000 W32P"
expr_stmt|;
break|break;
case|case
literal|0x3208
case|:
name|chip
operator|=
literal|"ET6000/ET6100"
expr_stmt|;
break|break;
case|case
literal|0x4702
case|:
name|chip
operator|=
literal|"ET6300"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x100e
case|:
name|vendor
operator|=
literal|"Weitek"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x9001
case|:
name|chip
operator|=
literal|"P9000"
expr_stmt|;
break|break;
case|case
literal|0x9100
case|:
name|chip
operator|=
literal|"P9100"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1013
case|:
name|vendor
operator|=
literal|"Cirrus Logic"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0038
case|:
name|chip
operator|=
literal|"GD7548"
expr_stmt|;
break|break;
case|case
literal|0x0040
case|:
name|chip
operator|=
literal|"GD7555"
expr_stmt|;
break|break;
case|case
literal|0x004c
case|:
name|chip
operator|=
literal|"GD7556"
expr_stmt|;
break|break;
case|case
literal|0x00a0
case|:
name|chip
operator|=
literal|"GD5430"
expr_stmt|;
break|break;
case|case
literal|0x00a4
case|:
case|case
literal|0x00a8
case|:
name|chip
operator|=
literal|"GD5434"
expr_stmt|;
break|break;
case|case
literal|0x00ac
case|:
name|chip
operator|=
literal|"GD5436"
expr_stmt|;
break|break;
case|case
literal|0x00b8
case|:
name|chip
operator|=
literal|"GD5446"
expr_stmt|;
break|break;
case|case
literal|0x00bc
case|:
name|chip
operator|=
literal|"GD5480"
expr_stmt|;
break|break;
case|case
literal|0x00d0
case|:
name|chip
operator|=
literal|"GD5462"
expr_stmt|;
break|break;
case|case
literal|0x00d4
case|:
case|case
literal|0x00d5
case|:
name|chip
operator|=
literal|"GD5464"
expr_stmt|;
break|break;
case|case
literal|0x00d6
case|:
name|chip
operator|=
literal|"GD5465"
expr_stmt|;
break|break;
case|case
literal|0x1200
case|:
name|chip
operator|=
literal|"GD7542"
expr_stmt|;
break|break;
case|case
literal|0x1202
case|:
name|chip
operator|=
literal|"GD7543"
expr_stmt|;
break|break;
case|case
literal|0x1204
case|:
name|chip
operator|=
literal|"GD7541"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1023
case|:
name|vendor
operator|=
literal|"Trident"
expr_stmt|;
break|break;
comment|/* let default deal with it */
case|case
literal|0x102c
case|:
name|vendor
operator|=
literal|"Chips& Technologies"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x00b8
case|:
name|chip
operator|=
literal|"64310"
expr_stmt|;
break|break;
case|case
literal|0x00d8
case|:
name|chip
operator|=
literal|"65545"
expr_stmt|;
break|break;
case|case
literal|0x00dc
case|:
name|chip
operator|=
literal|"65548"
expr_stmt|;
break|break;
case|case
literal|0x00c0
case|:
name|chip
operator|=
literal|"69000"
expr_stmt|;
break|break;
case|case
literal|0x00e0
case|:
name|chip
operator|=
literal|"65550"
expr_stmt|;
break|break;
case|case
literal|0x00e4
case|:
name|chip
operator|=
literal|"65554"
expr_stmt|;
break|break;
case|case
literal|0x00e5
case|:
name|chip
operator|=
literal|"65555"
expr_stmt|;
break|break;
case|case
literal|0x00f4
case|:
name|chip
operator|=
literal|"68554"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1033
case|:
name|vendor
operator|=
literal|"NEC"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0009
case|:
name|type
operator|=
literal|"PCI to PC-98 Core Graph bridge"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1039
case|:
name|vendor
operator|=
literal|"SiS"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0001
case|:
name|chip
operator|=
literal|"86c201"
expr_stmt|;
break|break;
case|case
literal|0x0002
case|:
name|chip
operator|=
literal|"86c202"
expr_stmt|;
break|break;
case|case
literal|0x0205
case|:
name|chip
operator|=
literal|"86c205"
expr_stmt|;
break|break;
case|case
literal|0x0215
case|:
name|chip
operator|=
literal|"86c215"
expr_stmt|;
break|break;
case|case
literal|0x0225
case|:
name|chip
operator|=
literal|"86c225"
expr_stmt|;
break|break;
case|case
literal|0x0200
case|:
name|chip
operator|=
literal|"5597/98"
expr_stmt|;
break|break;
case|case
literal|0x6326
case|:
name|chip
operator|=
literal|"6326"
expr_stmt|;
break|break;
case|case
literal|0x6306
case|:
name|chip
operator|=
literal|"530/620"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x105d
case|:
name|vendor
operator|=
literal|"Number Nine"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x2309
case|:
name|chip
operator|=
literal|"Imagine 128"
expr_stmt|;
break|break;
case|case
literal|0x2339
case|:
name|chip
operator|=
literal|"Imagine 128 II"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1142
case|:
name|vendor
operator|=
literal|"Alliance"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x3210
case|:
name|chip
operator|=
literal|"PM6410"
expr_stmt|;
break|break;
case|case
literal|0x6422
case|:
name|chip
operator|=
literal|"PM6422"
expr_stmt|;
break|break;
case|case
literal|0x6424
case|:
name|chip
operator|=
literal|"PMAT24"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1163
case|:
name|vendor
operator|=
literal|"Rendition Verite"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0001
case|:
name|chip
operator|=
literal|"V1000"
expr_stmt|;
break|break;
case|case
literal|0x2000
case|:
name|chip
operator|=
literal|"V2000"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x1236
case|:
name|vendor
operator|=
literal|"Sigma Designs"
expr_stmt|;
if|if
condition|(
operator|(
name|id
operator|>>
literal|16
operator|)
operator|==
literal|0x6401
condition|)
name|chip
operator|=
literal|"REALmagic64/GX"
expr_stmt|;
break|break;
case|case
literal|0x5333
case|:
name|vendor
operator|=
literal|"S3"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x8811
case|:
name|chip
operator|=
literal|"Trio"
expr_stmt|;
break|break;
case|case
literal|0x8812
case|:
name|chip
operator|=
literal|"Aurora 64"
expr_stmt|;
break|break;
case|case
literal|0x8814
case|:
name|chip
operator|=
literal|"Trio 64UV+"
expr_stmt|;
break|break;
case|case
literal|0x8901
case|:
name|chip
operator|=
literal|"Trio 64V2/DX/GX"
expr_stmt|;
break|break;
case|case
literal|0x8902
case|:
name|chip
operator|=
literal|"Plato"
expr_stmt|;
break|break;
case|case
literal|0x8904
case|:
name|chip
operator|=
literal|"Trio3D"
expr_stmt|;
break|break;
case|case
literal|0x8880
case|:
name|chip
operator|=
literal|"868"
expr_stmt|;
break|break;
case|case
literal|0x88b0
case|:
name|chip
operator|=
literal|"928"
expr_stmt|;
break|break;
case|case
literal|0x88c0
case|:
case|case
literal|0x88c1
case|:
name|chip
operator|=
literal|"864"
expr_stmt|;
break|break;
case|case
literal|0x88d0
case|:
case|case
literal|0x88d1
case|:
name|chip
operator|=
literal|"964"
expr_stmt|;
break|break;
case|case
literal|0x88f0
case|:
name|chip
operator|=
literal|"968"
expr_stmt|;
break|break;
case|case
literal|0x5631
case|:
name|chip
operator|=
literal|"ViRGE"
expr_stmt|;
break|break;
case|case
literal|0x883d
case|:
name|chip
operator|=
literal|"ViRGE VX"
expr_stmt|;
break|break;
case|case
literal|0x8a01
case|:
name|chip
operator|=
literal|"ViRGE DX/GX"
expr_stmt|;
break|break;
case|case
literal|0x8a10
case|:
name|chip
operator|=
literal|"ViRGE GX2"
expr_stmt|;
break|break;
case|case
literal|0x8a13
case|:
name|chip
operator|=
literal|"Trio3D/2X"
expr_stmt|;
break|break;
case|case
literal|0x8a20
case|:
case|case
literal|0x8a21
case|:
name|chip
operator|=
literal|"Savage3D"
expr_stmt|;
break|break;
case|case
literal|0x8a22
case|:
name|chip
operator|=
literal|"Savage 4"
expr_stmt|;
break|break;
case|case
literal|0x8c01
case|:
name|chip
operator|=
literal|"ViRGE MX"
expr_stmt|;
break|break;
case|case
literal|0x8c03
case|:
name|chip
operator|=
literal|"ViRGE MX+"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0xedd8
case|:
name|vendor
operator|=
literal|"ARK Logic"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0xa091
case|:
name|chip
operator|=
literal|"1000PV"
expr_stmt|;
break|break;
case|case
literal|0xa099
case|:
name|chip
operator|=
literal|"2000PV"
expr_stmt|;
break|break;
case|case
literal|0xa0a1
case|:
name|chip
operator|=
literal|"2000MT"
expr_stmt|;
break|break;
case|case
literal|0xa0a9
case|:
name|chip
operator|=
literal|"2000MI"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x3d3d
case|:
name|vendor
operator|=
literal|"3D Labs"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0001
case|:
name|chip
operator|=
literal|"300SX"
expr_stmt|;
break|break;
case|case
literal|0x0002
case|:
name|chip
operator|=
literal|"500TX"
expr_stmt|;
break|break;
case|case
literal|0x0003
case|:
name|chip
operator|=
literal|"Delta"
expr_stmt|;
break|break;
case|case
literal|0x0004
case|:
name|chip
operator|=
literal|"PerMedia"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x10de
case|:
name|vendor
operator|=
literal|"NVidia"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0008
case|:
name|chip
operator|=
literal|"NV1"
expr_stmt|;
break|break;
case|case
literal|0x0020
case|:
name|chip
operator|=
literal|"Riva TNT"
expr_stmt|;
break|break;
case|case
literal|0x0028
case|:
name|chip
operator|=
literal|"Riva TNT2"
expr_stmt|;
break|break;
case|case
literal|0x0029
case|:
name|chip
operator|=
literal|"Riva Ultra TNT2"
expr_stmt|;
break|break;
case|case
literal|0x002c
case|:
name|chip
operator|=
literal|"Riva Vanta TNT2"
expr_stmt|;
break|break;
case|case
literal|0x002d
case|:
name|chip
operator|=
literal|"Riva Ultra Vanta TNT2"
expr_stmt|;
break|break;
case|case
literal|0x00a0
case|:
name|chip
operator|=
literal|"Riva Integrated TNT2"
expr_stmt|;
break|break;
case|case
literal|0x0100
case|:
name|chip
operator|=
literal|"GeForce 256"
expr_stmt|;
break|break;
case|case
literal|0x0101
case|:
name|chip
operator|=
literal|"GeForce DDR"
expr_stmt|;
break|break;
case|case
literal|0x0103
case|:
name|chip
operator|=
literal|"Quadro"
expr_stmt|;
break|break;
case|case
literal|0x0150
case|:
case|case
literal|0x0151
case|:
case|case
literal|0x0152
case|:
name|chip
operator|=
literal|"GeForce2 GTS"
expr_stmt|;
break|break;
case|case
literal|0x0153
case|:
name|chip
operator|=
literal|"Quadro2"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x12d2
case|:
name|vendor
operator|=
literal|"NVidia/SGS-Thomson"
expr_stmt|;
name|type
operator|=
literal|"graphics accelerator"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0018
case|:
name|chip
operator|=
literal|"Riva128"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x104a
case|:
name|vendor
operator|=
literal|"SGS-Thomson"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x0008
case|:
name|chip
operator|=
literal|"STG2000"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x8086
case|:
name|vendor
operator|=
literal|"Intel"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x7121
case|:
name|chip
operator|=
literal|"82810 (i810 GMCH)"
expr_stmt|;
break|break;
case|case
literal|0x7123
case|:
name|chip
operator|=
literal|"82810-DC100 (i810-DC100 GMCH)"
expr_stmt|;
break|break;
case|case
literal|0x7125
case|:
name|chip
operator|=
literal|"82810E (i810E GMCH)"
expr_stmt|;
break|break;
case|case
literal|0x7800
case|:
name|chip
operator|=
literal|"i740 AGP"
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x10ea
case|:
name|vendor
operator|=
literal|"Intergraphics"
expr_stmt|;
switch|switch
condition|(
name|id
operator|>>
literal|16
condition|)
block|{
case|case
literal|0x1680
case|:
name|chip
operator|=
literal|"IGA-1680"
expr_stmt|;
break|break;
case|case
literal|0x1682
case|:
name|chip
operator|=
literal|"IGA-1682"
expr_stmt|;
break|break;
block|}
break|break;
block|}
if|if
condition|(
name|vendor
operator|&&
name|chip
condition|)
block|{
name|char
modifier|*
name|buf
decl_stmt|;
name|int
name|len
decl_stmt|;
if|if
condition|(
name|type
operator|==
literal|0
condition|)
name|type
operator|=
literal|"SVGA controller"
expr_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|vendor
argument_list|)
operator|+
name|strlen
argument_list|(
name|chip
argument_list|)
operator|+
name|strlen
argument_list|(
name|type
argument_list|)
operator|+
literal|4
expr_stmt|;
name|MALLOC
argument_list|(
name|buf
argument_list|,
name|char
operator|*
argument_list|,
name|len
argument_list|,
name|M_TEMP
argument_list|,
name|M_NOWAIT
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
condition|)
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s %s %s"
argument_list|,
name|vendor
argument_list|,
name|chip
argument_list|,
name|type
argument_list|)
expr_stmt|;
return|return
name|buf
return|;
block|}
switch|switch
condition|(
name|pci_get_class
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
name|PCIC_OLD
case|:
if|if
condition|(
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|!=
name|PCIS_OLD_VGA
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|type
operator|==
literal|0
condition|)
name|type
operator|=
literal|"VGA-compatible display device"
expr_stmt|;
break|break;
case|case
name|PCIC_DISPLAY
case|:
if|if
condition|(
name|type
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|pci_get_subclass
argument_list|(
name|dev
argument_list|)
operator|==
name|PCIS_DISPLAY_VGA
condition|)
name|type
operator|=
literal|"VGA-compatible display device"
expr_stmt|;
else|else
block|{
comment|/* 				 * If it isn't a vga display device, 				 * don't pretend we found one. 				 */
return|return
literal|0
return|;
block|}
block|}
break|break;
default|default:
return|return
literal|0
return|;
block|}
empty_stmt|;
comment|/* 	 * If we got here, we know for sure it's some sort of display 	 * device, but we weren't able to identify it specifically. 	 * At a minimum we can return the type, but we'd like to 	 * identify the vendor and chip ID if at all possible. 	 * (Some of the checks above intentionally don't bother for 	 * vendors where we know the chip ID is the same as the 	 * model number.) 	 */
if|if
condition|(
name|vendor
condition|)
block|{
name|char
modifier|*
name|buf
decl_stmt|;
name|int
name|len
decl_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|vendor
argument_list|)
operator|+
name|strlen
argument_list|(
name|type
argument_list|)
operator|+
literal|2
operator|+
literal|6
operator|+
literal|4
operator|+
literal|1
expr_stmt|;
name|MALLOC
argument_list|(
name|buf
argument_list|,
name|char
operator|*
argument_list|,
name|len
argument_list|,
name|M_TEMP
argument_list|,
name|M_NOWAIT
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
condition|)
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s model %04x %s"
argument_list|,
name|vendor
argument_list|,
name|id
operator|>>
literal|16
argument_list|,
name|type
argument_list|)
expr_stmt|;
return|return
name|buf
return|;
block|}
return|return
name|type
return|;
block|}
end_function

begin_comment
comment|/*--------------------------------------------------------- ** **	Devices to ignore ** **--------------------------------------------------------- */
end_comment

begin_function
specifier|static
name|int
name|ign_probe
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
switch|switch
condition|(
name|pci_get_devid
argument_list|(
name|dev
argument_list|)
condition|)
block|{
case|case
literal|0x10001042ul
case|:
comment|/* wd */
return|return
literal|0
return|;
comment|/*		return ("SMC FDC 37c665");*/
block|}
empty_stmt|;
return|return
name|ENXIO
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ign_attach
parameter_list|(
name|device_t
name|dev
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
specifier|static
name|device_method_t
name|ign_methods
index|[]
init|=
block|{
comment|/* Device interface */
name|DEVMETHOD
argument_list|(
name|device_probe
argument_list|,
name|ign_probe
argument_list|)
block|,
name|DEVMETHOD
argument_list|(
name|device_attach
argument_list|,
name|ign_attach
argument_list|)
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|driver_t
name|ign_driver
init|=
block|{
literal|"ign"
block|,
name|ign_methods
block|,
literal|1
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|devclass_t
name|ign_devclass
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|DRIVER_MODULE
argument_list|(
name|ign
argument_list|,
name|pci
argument_list|,
name|ign_driver
argument_list|,
name|ign_devclass
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_expr_stmt

end_unit

