begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2001 Networks Associates Technology, Inc.  * All rights reserved.  *  * This software was developed for the FreeBSD Project by NAI Labs, the  * Security Research Division of Network Associates, Inc. under  * DARPA/SPAWAR contract N66001-01-C-8035 ("CBOSS"), as part of the DARPA  * CHATS research program.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. The name of the author may not be used to endorse or promote  *    products derived from this software without specific prior written  *    permission.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $Id$  * $FreeBSD$  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|LOMAC_PLM_H
end_ifndef

begin_define
define|#
directive|define
name|LOMAC_PLM_H
end_define

begin_enum
enum|enum
name|plm_level
block|{
name|LOW
block|,
name|SUBJ
block|,
name|HIGH
block|}
enum|;
end_enum

begin_enum
enum|enum
name|plm_flags
block|{
name|PLM_NOFLAGS
block|,
comment|/* rule applies to this node and its children */
name|PLM_CHILDOF
comment|/* rule applies to node's children, not the node */
block|}
enum|;
end_enum

begin_define
define|#
directive|define
name|LOWWRITE
value|LN_ATTR_LOWWRITE
end_define

begin_define
define|#
directive|define
name|LOWNOOPEN
value|LN_ATTR_LOWNOOPEN
end_define

begin_define
define|#
directive|define
name|NONETDEMOTE
value|LN_ATTR_NONETDEMOTE
end_define

begin_define
define|#
directive|define
name|NODEMOTE
value|LN_ATTR_NODEMOTE
end_define

begin_decl_stmt
specifier|static
name|u_int
name|plm_levelflags_to_node_flags
index|[
literal|3
index|]
index|[
literal|2
index|]
init|=
block|{
block|{
name|LN_LOWEST_LEVEL
block|,
name|LN_INHERIT_LOW
block|}
block|,
block|{
name|LN_SUBJ_LEVEL
block|,
name|LN_INHERIT_SUBJ
block|}
block|,
block|{
name|LN_HIGHEST_LEVEL
block|,
name|LN_INHERIT_HIGH
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
struct|struct
name|plm_rule
block|{
name|enum
name|plm_level
name|level
decl_stmt|;
comment|/* LOMAC level */
name|enum
name|plm_flags
name|flags
decl_stmt|;
comment|/* flags for PLM evaluation */
name|unsigned
name|int
name|attr
decl_stmt|;
comment|/* LN_ATTR_MASK of flags */
specifier|const
name|char
modifier|*
name|path
decl_stmt|;
comment|/* absolute path for this PLM rule */
block|}
name|plm_rule_t
typedef|;
end_typedef

begin_comment
comment|/* The `plm' array maps levels onto all of the files in the filesystem */
end_comment

begin_decl_stmt
specifier|static
name|plm_rule_t
name|plm
index|[]
init|=
block|{
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/"
block|}
block|,
comment|/* everything initially inherits high level */
block|{
name|HIGH
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|NONETDEMOTE
block|,
literal|"/sbin/dhclient"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/var"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_CHILDOF
block|,
name|LOWWRITE
block|,
literal|"/dev"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|LOWNOOPEN
block|,
literal|"/dev/mdctl"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|LOWNOOPEN
block|,
literal|"/dev/pci"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|LOWNOOPEN
block|,
literal|"/dev/kmem"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|LOWNOOPEN
block|,
literal|"/dev/mem"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|LOWNOOPEN
block|,
literal|"/dev/io"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/etc"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|LOWWRITE
block|,
literal|"/tmp"
block|}
block|,
block|{
name|SUBJ
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/tmp"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/tmp/.X11-unix"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_CHILDOF
block|,
name|LOWWRITE
block|,
literal|"/tmp/.X11-unix"
block|}
block|,
block|{
name|SUBJ
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/proc"
block|}
block|,
block|{
name|LOW
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/mnt"
block|}
block|,
comment|/* all nfs mounts are low */
block|{
name|LOW
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/home"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|NONETDEMOTE
block|,
literal|"/usr/bin/env-nonetdemote"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|NODEMOTE
block|,
literal|"/usr/bin/env-nodemote"
block|}
block|,
block|{
name|LOW
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/usr/home"
block|}
block|,
block|{
name|LOW
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/var/lib"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|LOWWRITE
block|,
literal|"/var/tmp"
block|}
block|,
block|{
name|SUBJ
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/var/tmp"
block|}
block|,
block|{
name|LOW
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/var/tmp/vi.recover"
block|}
block|,
block|{
name|SUBJ
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/var/tmp/vi.recover"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|LOWWRITE
block|,
literal|"/usr/tmp"
block|}
block|,
block|{
name|SUBJ
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/usr/tmp"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/usr/tmp/.X11-unix"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_CHILDOF
block|,
name|LOWWRITE
block|,
literal|"/usr/tmp/.X11-unix"
block|}
block|,
block|{
name|LOW
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/var/mail"
block|}
block|,
block|{
name|LOW
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/var/mail"
block|}
block|,
block|{
name|LOW
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/var/spool/mqueue"
block|}
block|,
block|{
name|LOW
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/var/spool/mqueue"
block|}
block|,
block|{
name|LOW
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/dev/log"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/home/ftp"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/usr/home/ftp"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/mnt/cdrom"
block|}
block|,
comment|/* cdrom is high */
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/home/samba"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/usr/home/samba"
block|}
block|,
block|{
name|LOW
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/dev/printer"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_CHILDOF
block|,
literal|0
block|,
literal|"/var/log"
block|}
block|,
block|{
name|LOW
block|,
name|PLM_NOFLAGS
block|,
literal|0
block|,
literal|"/var/log/sendmail.st"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|LOWWRITE
block|,
literal|"/var/run/utmp"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|LOWWRITE
block|,
literal|"/var/log/lastlog"
block|}
block|,
block|{
name|HIGH
block|,
name|PLM_NOFLAGS
block|,
name|LOWWRITE
block|,
literal|"/var/log/wtmp"
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* LOMAC_PLM_H */
end_comment

end_unit

