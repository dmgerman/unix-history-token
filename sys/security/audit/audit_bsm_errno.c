begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2008 Apple Inc.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1.  Redistributions of source code must retain the above copyright  *     notice, this list of conditions and the following disclaimer.  * 2.  Redistributions in binary form must reproduce the above copyright  *     notice, this list of conditions and the following disclaimer in the  *     documentation and/or other materials provided with the distribution.  * 3.  Neither the name of Apple Inc. ("Apple") nor the names of  *     its contributors may be used to endorse or promote products derived  *     from this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR  * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,  * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING  * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  * POSSIBILITY OF SUCH DAMAGE.   *  * P4: //depot/projects/trustedbsd/openbsm/libbsm/bsm_errno.c#12  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<bsm/audit_errno.h>
end_include

begin_include
include|#
directive|include
file|<bsm/libbsm.h>
end_include

begin_include
include|#
directive|include
file|<sys/errno.h>
end_include

begin_comment
comment|/*  * Different operating systems use different numeric constants for different  * error numbers, and sometimes error numbers don't exist in more than one  * operating system.  These routines convert between BSM and local error  * number spaces, subject to the above realities.  BSM error numbers are  * stored in a single 8-bit character, so don't have a byte order.  */
end_comment

begin_struct
struct|struct
name|bsm_errors
block|{
name|int
name|be_bsm_error
decl_stmt|;
name|int
name|be_os_error
decl_stmt|;
specifier|const
name|char
modifier|*
name|be_strerror
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|ERRNO_NO_LOCAL_MAPPING
value|-600
end_define

begin_comment
comment|/*  * Mapping table -- please maintain in numeric sorted order with respect to  * the BSM constant.  Today we do a linear lookup, but could switch to a  * binary search if it makes sense.  We only ifdef errors that aren't  * generally available, but it does make the table a lot more ugly.  *  * XXXRW: It would be nice to have a similar ordered table mapping to BSM  * constant from local constant, but the order of local constants varies by  * OS.  Really we need to build that table at compile-time but don't do that  * yet.  *  * XXXRW: We currently embed English-language error strings here, but should  * support catalogues; these are only used if the OS doesn't have an error  * string using strerror(3).  */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|bsm_errors
name|bsm_errors
index|[]
init|=
block|{
block|{
name|BSM_ESUCCESS
block|,
literal|0
block|,
literal|"Success"
block|}
block|,
block|{
name|BSM_EPERM
block|,
name|EPERM
block|,
literal|"Operation not permitted"
block|}
block|,
block|{
name|BSM_ENOENT
block|,
name|ENOENT
block|,
literal|"No such file or directory"
block|}
block|,
block|{
name|BSM_ESRCH
block|,
name|ESRCH
block|,
literal|"No such process"
block|}
block|,
block|{
name|BSM_EINTR
block|,
name|EINTR
block|,
literal|"Interrupted system call"
block|}
block|,
block|{
name|BSM_EIO
block|,
name|EIO
block|,
literal|"Input/output error"
block|}
block|,
block|{
name|BSM_ENXIO
block|,
name|ENXIO
block|,
literal|"Device not configured"
block|}
block|,
block|{
name|BSM_E2BIG
block|,
name|E2BIG
block|,
literal|"Argument list too long"
block|}
block|,
block|{
name|BSM_ENOEXEC
block|,
name|ENOEXEC
block|,
literal|"Exec format error"
block|}
block|,
block|{
name|BSM_EBADF
block|,
name|EBADF
block|,
literal|"BAd file descriptor"
block|}
block|,
block|{
name|BSM_ECHILD
block|,
name|ECHILD
block|,
literal|"No child processes"
block|}
block|,
block|{
name|BSM_EAGAIN
block|,
name|EAGAIN
block|,
literal|"Resource temporarily unavailable"
block|}
block|,
block|{
name|BSM_ENOMEM
block|,
name|ENOMEM
block|,
literal|"Cannot allocate memory"
block|}
block|,
block|{
name|BSM_EACCES
block|,
name|EACCES
block|,
literal|"Permission denied"
block|}
block|,
block|{
name|BSM_EFAULT
block|,
name|EFAULT
block|,
literal|"Bad address"
block|}
block|,
block|{
name|BSM_ENOTBLK
block|,
name|ENOTBLK
block|,
literal|"Block device required"
block|}
block|,
block|{
name|BSM_EBUSY
block|,
name|EBUSY
block|,
literal|"Device busy"
block|}
block|,
block|{
name|BSM_EEXIST
block|,
name|EEXIST
block|,
literal|"File exists"
block|}
block|,
block|{
name|BSM_EXDEV
block|,
name|EXDEV
block|,
literal|"Cross-device link"
block|}
block|,
block|{
name|BSM_ENODEV
block|,
name|ENODEV
block|,
literal|"Operation not supported by device"
block|}
block|,
block|{
name|BSM_ENOTDIR
block|,
name|ENOTDIR
block|,
literal|"Not a directory"
block|}
block|,
block|{
name|BSM_EISDIR
block|,
name|EISDIR
block|,
literal|"Is a directory"
block|}
block|,
block|{
name|BSM_EINVAL
block|,
name|EINVAL
block|,
literal|"Invalid argument"
block|}
block|,
block|{
name|BSM_ENFILE
block|,
name|ENFILE
block|,
literal|"Too many open files in system"
block|}
block|,
block|{
name|BSM_EMFILE
block|,
name|EMFILE
block|,
literal|"Too many open files"
block|}
block|,
block|{
name|BSM_ENOTTY
block|,
name|ENOTTY
block|,
literal|"Inappropriate ioctl for device"
block|}
block|,
block|{
name|BSM_ETXTBSY
block|,
name|ETXTBSY
block|,
literal|"Text file busy"
block|}
block|,
block|{
name|BSM_EFBIG
block|,
name|EFBIG
block|,
literal|"File too large"
block|}
block|,
block|{
name|BSM_ENOSPC
block|,
name|ENOSPC
block|,
literal|"No space left on device"
block|}
block|,
block|{
name|BSM_ESPIPE
block|,
name|ESPIPE
block|,
literal|"Illegal seek"
block|}
block|,
block|{
name|BSM_EROFS
block|,
name|EROFS
block|,
literal|"Read-only file system"
block|}
block|,
block|{
name|BSM_EMLINK
block|,
name|EMLINK
block|,
literal|"Too many links"
block|}
block|,
block|{
name|BSM_EPIPE
block|,
name|EPIPE
block|,
literal|"Broken pipe"
block|}
block|,
block|{
name|BSM_EDOM
block|,
name|EDOM
block|,
literal|"Numerical argument out of domain"
block|}
block|,
block|{
name|BSM_ERANGE
block|,
name|ERANGE
block|,
literal|"Result too large"
block|}
block|,
block|{
name|BSM_ENOMSG
block|,
name|ENOMSG
block|,
literal|"No message of desired type"
block|}
block|,
block|{
name|BSM_EIDRM
block|,
name|EIDRM
block|,
literal|"Identifier removed"
block|}
block|,
block|{
name|BSM_ECHRNG
block|,
ifdef|#
directive|ifdef
name|ECHRNG
name|ECHRNG
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Channel number out of range"
block|}
block|,
block|{
name|BSM_EL2NSYNC
block|,
ifdef|#
directive|ifdef
name|EL2NSYNC
name|EL2NSYNC
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Level 2 not synchronized"
block|}
block|,
block|{
name|BSM_EL3HLT
block|,
ifdef|#
directive|ifdef
name|EL3HLT
name|EL3HLT
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Level 3 halted"
block|}
block|,
block|{
name|BSM_EL3RST
block|,
ifdef|#
directive|ifdef
name|EL3RST
name|EL3RST
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Level 3 reset"
block|}
block|,
block|{
name|BSM_ELNRNG
block|,
ifdef|#
directive|ifdef
name|ELNRNG
name|ELNRNG
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Link number out of range"
block|}
block|,
block|{
name|BSM_EUNATCH
block|,
ifdef|#
directive|ifdef
name|EUNATCH
name|EUNATCH
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Protocol driver not attached"
block|}
block|,
block|{
name|BSM_ENOCSI
block|,
ifdef|#
directive|ifdef
name|ENOCSI
name|ENOCSI
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"No CSI structure available"
block|}
block|,
block|{
name|BSM_EL2HLT
block|,
ifdef|#
directive|ifdef
name|EL2HLT
name|EL2HLT
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Level 2 halted"
block|}
block|,
block|{
name|BSM_EDEADLK
block|,
name|EDEADLK
block|,
literal|"Resource deadlock avoided"
block|}
block|,
block|{
name|BSM_ENOLCK
block|,
name|ENOLCK
block|,
literal|"No locks available"
block|}
block|,
block|{
name|BSM_ECANCELED
block|,
name|ECANCELED
block|,
literal|"Operation canceled"
block|}
block|,
block|{
name|BSM_ENOTSUP
block|,
name|ENOTSUP
block|,
literal|"Operation not supported"
block|}
block|,
block|{
name|BSM_EDQUOT
block|,
name|EDQUOT
block|,
literal|"Disc quota exceeded"
block|}
block|,
block|{
name|BSM_EBADE
block|,
ifdef|#
directive|ifdef
name|EBADE
name|EBADE
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Invalid exchange"
block|}
block|,
block|{
name|BSM_EBADR
block|,
ifdef|#
directive|ifdef
name|EBADR
name|EBADR
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Invalid request descriptor"
block|}
block|,
block|{
name|BSM_EXFULL
block|,
ifdef|#
directive|ifdef
name|EXFULL
name|EXFULL
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Exchange full"
block|}
block|,
block|{
name|BSM_ENOANO
block|,
ifdef|#
directive|ifdef
name|ENOANO
name|ENOANO
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"No anode"
block|}
block|,
block|{
name|BSM_EBADRQC
block|,
ifdef|#
directive|ifdef
name|EBADRQC
name|EBADRQC
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Invalid request descriptor"
block|}
block|,
block|{
name|BSM_EBADSLT
block|,
ifdef|#
directive|ifdef
name|EBADSLT
name|EBADSLT
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Invalid slot"
block|}
block|,
block|{
name|BSM_EDEADLOCK
block|,
ifdef|#
directive|ifdef
name|EDEADLOCK
name|EDEADLOCK
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Resource deadlock avoided"
block|}
block|,
block|{
name|BSM_EBFONT
block|,
ifdef|#
directive|ifdef
name|EBFONT
name|EBFONT
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Bad font file format"
block|}
block|,
block|{
name|BSM_EOWNERDEAD
block|,
ifdef|#
directive|ifdef
name|EOWNERDEAD
name|EOWNERDEAD
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Process died with the lock"
block|}
block|,
block|{
name|BSM_ENOTRECOVERABLE
block|,
ifdef|#
directive|ifdef
name|ENOTRECOVERABLE
name|ENOTRECOVERABLE
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Lock is not recoverable"
block|}
block|,
block|{
name|BSM_ENOSTR
block|,
ifdef|#
directive|ifdef
name|ENOSTR
name|ENOSTR
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Device not a stream"
block|}
block|,
block|{
name|BSM_ENONET
block|,
ifdef|#
directive|ifdef
name|ENONET
name|ENONET
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Machine is not on the network"
block|}
block|,
block|{
name|BSM_ENOPKG
block|,
ifdef|#
directive|ifdef
name|ENOPKG
name|ENOPKG
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Package not installed"
block|}
block|,
block|{
name|BSM_EREMOTE
block|,
name|EREMOTE
block|,
literal|"Too many levels of remote in path"
block|}
block|,
block|{
name|BSM_ENOLINK
block|,
ifdef|#
directive|ifdef
name|ENOLINK
name|ENOLINK
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Link has been severed"
block|}
block|,
block|{
name|BSM_EADV
block|,
ifdef|#
directive|ifdef
name|EADV
name|EADV
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Advertise error"
block|}
block|,
block|{
name|BSM_ESRMNT
block|,
ifdef|#
directive|ifdef
name|ESRMNT
name|ESRMNT
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"srmount error"
block|}
block|,
block|{
name|BSM_ECOMM
block|,
ifdef|#
directive|ifdef
name|ECOMM
name|ECOMM
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Communication error on send"
block|}
block|,
block|{
name|BSM_EPROTO
block|,
ifdef|#
directive|ifdef
name|EPROTO
name|EPROTO
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Protocol error"
block|}
block|,
block|{
name|BSM_ELOCKUNMAPPED
block|,
ifdef|#
directive|ifdef
name|ELOCKUNMAPPED
name|ELOCKUNMAPPED
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Locked lock was unmapped"
block|}
block|,
block|{
name|BSM_ENOTACTIVE
block|,
ifdef|#
directive|ifdef
name|ENOTACTIVE
name|ENOTACTIVE
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Facility is not active"
block|}
block|,
block|{
name|BSM_EMULTIHOP
block|,
ifdef|#
directive|ifdef
name|EMULTIHOP
name|EMULTIHOP
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Multihop attempted"
block|}
block|,
block|{
name|BSM_EBADMSG
block|,
ifdef|#
directive|ifdef
name|EBADMSG
name|EBADMSG
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Bad message"
block|}
block|,
block|{
name|BSM_ENAMETOOLONG
block|,
name|ENAMETOOLONG
block|,
literal|"File name too long"
block|}
block|,
block|{
name|BSM_EOVERFLOW
block|,
name|EOVERFLOW
block|,
literal|"Value too large to be stored in data type"
block|}
block|,
block|{
name|BSM_ENOTUNIQ
block|,
ifdef|#
directive|ifdef
name|ENOTUNIQ
name|ENOTUNIQ
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Given log name not unique"
block|}
block|,
block|{
name|BSM_EBADFD
block|,
ifdef|#
directive|ifdef
name|EBADFD
name|EBADFD
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Given f.d. invalid for this operation"
block|}
block|,
block|{
name|BSM_EREMCHG
block|,
ifdef|#
directive|ifdef
name|EREMCHG
name|EREMCHG
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Remote address changed"
block|}
block|,
block|{
name|BSM_ELIBACC
block|,
ifdef|#
directive|ifdef
name|ELIBACC
name|ELIBACC
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Can't access a needed shared lib"
block|}
block|,
block|{
name|BSM_ELIBBAD
block|,
ifdef|#
directive|ifdef
name|ELIBBAD
name|ELIBBAD
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Accessing a corrupted shared lib"
block|}
block|,
block|{
name|BSM_ELIBSCN
block|,
ifdef|#
directive|ifdef
name|ELIBSCN
name|ELIBSCN
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|".lib section in a.out corrupted"
block|}
block|,
block|{
name|BSM_ELIBMAX
block|,
ifdef|#
directive|ifdef
name|ELIBMAX
name|ELIBMAX
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Attempting to link in too many libs"
block|}
block|,
block|{
name|BSM_ELIBEXEC
block|,
ifdef|#
directive|ifdef
name|ELIBEXEC
name|ELIBEXEC
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Attempting to exec a shared library"
block|}
block|,
block|{
name|BSM_EILSEQ
block|,
name|EILSEQ
block|,
literal|"Illegal byte sequence"
block|}
block|,
block|{
name|BSM_ENOSYS
block|,
name|ENOSYS
block|,
literal|"Function not implemented"
block|}
block|,
block|{
name|BSM_ELOOP
block|,
name|ELOOP
block|,
literal|"Too many levels of symbolic links"
block|}
block|,
block|{
name|BSM_ERESTART
block|,
ifdef|#
directive|ifdef
name|ERESTART
name|ERESTART
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Restart syscall"
block|}
block|,
block|{
name|BSM_ESTRPIPE
block|,
ifdef|#
directive|ifdef
name|ESTRPIPE
name|ESTRPIPE
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"If pipe/FIFO, don't sleep in stream head"
block|}
block|,
block|{
name|BSM_ENOTEMPTY
block|,
name|ENOTEMPTY
block|,
literal|"Directory not empty"
block|}
block|,
block|{
name|BSM_EUSERS
block|,
name|EUSERS
block|,
literal|"Too many users"
block|}
block|,
block|{
name|BSM_ENOTSOCK
block|,
name|ENOTSOCK
block|,
literal|"Socket operation on non-socket"
block|}
block|,
block|{
name|BSM_EDESTADDRREQ
block|,
name|EDESTADDRREQ
block|,
literal|"Destination address required"
block|}
block|,
block|{
name|BSM_EMSGSIZE
block|,
name|EMSGSIZE
block|,
literal|"Message too long"
block|}
block|,
block|{
name|BSM_EPROTOTYPE
block|,
name|EPROTOTYPE
block|,
literal|"Protocol wrong type for socket"
block|}
block|,
block|{
name|BSM_ENOPROTOOPT
block|,
name|ENOPROTOOPT
block|,
literal|"Protocol not available"
block|}
block|,
block|{
name|BSM_EPROTONOSUPPORT
block|,
name|EPROTONOSUPPORT
block|,
literal|"Protocol not supported"
block|}
block|,
block|{
name|BSM_ESOCKTNOSUPPORT
block|,
name|ESOCKTNOSUPPORT
block|,
literal|"Socket type not supported"
block|}
block|,
block|{
name|BSM_EOPNOTSUPP
block|,
name|EOPNOTSUPP
block|,
literal|"Operation not supported"
block|}
block|,
block|{
name|BSM_EPFNOSUPPORT
block|,
name|EPFNOSUPPORT
block|,
literal|"Protocol family not supported"
block|}
block|,
block|{
name|BSM_EAFNOSUPPORT
block|,
name|EAFNOSUPPORT
block|,
literal|"Address family not supported by protocol family"
block|}
block|,
block|{
name|BSM_EADDRINUSE
block|,
name|EADDRINUSE
block|,
literal|"Address already in use"
block|}
block|,
block|{
name|BSM_EADDRNOTAVAIL
block|,
name|EADDRNOTAVAIL
block|,
literal|"Can't assign requested address"
block|}
block|,
block|{
name|BSM_ENETDOWN
block|,
name|ENETDOWN
block|,
literal|"Network is down"
block|}
block|,
block|{
name|BSM_ENETRESET
block|,
name|ENETRESET
block|,
literal|"Network dropped connection on reset"
block|}
block|,
block|{
name|BSM_ECONNABORTED
block|,
name|ECONNABORTED
block|,
literal|"Software caused connection abort"
block|}
block|,
block|{
name|BSM_ECONNRESET
block|,
name|ECONNRESET
block|,
literal|"Connection reset by peer"
block|}
block|,
block|{
name|BSM_ENOBUFS
block|,
name|ENOBUFS
block|,
literal|"No buffer space available"
block|}
block|,
block|{
name|BSM_EISCONN
block|,
name|EISCONN
block|,
literal|"Socket is already connected"
block|}
block|,
block|{
name|BSM_ENOTCONN
block|,
name|ENOTCONN
block|,
literal|"Socket is not connected"
block|}
block|,
block|{
name|BSM_ESHUTDOWN
block|,
name|ESHUTDOWN
block|,
literal|"Can't send after socket shutdown"
block|}
block|,
block|{
name|BSM_ETOOMANYREFS
block|,
name|ETOOMANYREFS
block|,
literal|"Too many references: can't splice"
block|}
block|,
block|{
name|BSM_ETIMEDOUT
block|,
name|ETIMEDOUT
block|,
literal|"Operation timed out"
block|}
block|,
block|{
name|BSM_ECONNREFUSED
block|,
name|ECONNREFUSED
block|,
literal|"Connection refused"
block|}
block|,
block|{
name|BSM_EHOSTDOWN
block|,
name|EHOSTDOWN
block|,
literal|"Host is down"
block|}
block|,
block|{
name|BSM_EHOSTUNREACH
block|,
name|EHOSTUNREACH
block|,
literal|"No route to host"
block|}
block|,
block|{
name|BSM_EALREADY
block|,
name|EALREADY
block|,
literal|"Operation already in progress"
block|}
block|,
block|{
name|BSM_EINPROGRESS
block|,
name|EINPROGRESS
block|,
literal|"Operation now in progress"
block|}
block|,
block|{
name|BSM_ESTALE
block|,
name|ESTALE
block|,
literal|"Stale NFS file handle"
block|}
block|,
block|{
name|BSM_EPWROFF
block|,
ifdef|#
directive|ifdef
name|EPWROFF
name|EPWROFF
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Device power is off"
block|}
block|,
block|{
name|BSM_EDEVERR
block|,
ifdef|#
directive|ifdef
name|EDEVERR
name|EDEVERR
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Device error"
block|}
block|,
block|{
name|BSM_EBADEXEC
block|,
ifdef|#
directive|ifdef
name|EBADEXEC
name|EBADEXEC
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Bad executable"
block|}
block|,
block|{
name|BSM_EBADARCH
block|,
ifdef|#
directive|ifdef
name|EBADARCH
name|EBADARCH
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Bad CPU type in executable"
block|}
block|,
block|{
name|BSM_ESHLIBVERS
block|,
ifdef|#
directive|ifdef
name|ESHLIBVERS
name|ESHLIBVERS
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Shared library version mismatch"
block|}
block|,
block|{
name|BSM_EBADMACHO
block|,
ifdef|#
directive|ifdef
name|EBADMACHO
name|EBADMACHO
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Malfored Macho file"
block|}
block|,
block|{
name|BSM_EPOLICY
block|,
ifdef|#
directive|ifdef
name|EPOLICY
name|EPOLICY
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Operation failed by policy"
block|}
block|,
block|{
name|BSM_EDOTDOT
block|,
ifdef|#
directive|ifdef
name|EDOTDOT
name|EDOTDOT
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"RFS specific error"
block|}
block|,
block|{
name|BSM_EUCLEAN
block|,
ifdef|#
directive|ifdef
name|EUCLEAN
name|EUCLEAN
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Structure needs cleaning"
block|}
block|,
block|{
name|BSM_ENOTNAM
block|,
ifdef|#
directive|ifdef
name|ENOTNAM
name|ENOTNAM
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Not a XENIX named type file"
block|}
block|,
block|{
name|BSM_ENAVAIL
block|,
ifdef|#
directive|ifdef
name|ENAVAIL
name|ENAVAIL
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"No XENIX semaphores available"
block|}
block|,
block|{
name|BSM_EISNAM
block|,
ifdef|#
directive|ifdef
name|EISNAM
name|EISNAM
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Is a named type file"
block|}
block|,
block|{
name|BSM_EREMOTEIO
block|,
ifdef|#
directive|ifdef
name|EREMOTEIO
name|EREMOTEIO
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Remote I/O error"
block|}
block|,
block|{
name|BSM_ENOMEDIUM
block|,
ifdef|#
directive|ifdef
name|ENOMEDIUM
name|ENOMEDIUM
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"No medium found"
block|}
block|,
block|{
name|BSM_EMEDIUMTYPE
block|,
ifdef|#
directive|ifdef
name|EMEDIUMTYPE
name|EMEDIUMTYPE
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Wrong medium type"
block|}
block|,
block|{
name|BSM_ENOKEY
block|,
ifdef|#
directive|ifdef
name|ENOKEY
name|ENOKEY
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Required key not available"
block|}
block|,
block|{
name|BSM_EKEYEXPIRED
block|,
ifdef|#
directive|ifdef
name|EKEEXPIRED
name|EKEYEXPIRED
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Key has expired"
block|}
block|,
block|{
name|BSM_EKEYREVOKED
block|,
ifdef|#
directive|ifdef
name|EKEYREVOKED
name|EKEYREVOKED
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Key has been revoked"
block|}
block|,
block|{
name|BSM_EKEYREJECTED
block|,
ifdef|#
directive|ifdef
name|EKEREJECTED
name|EKEYREJECTED
block|,
else|#
directive|else
name|ERRNO_NO_LOCAL_MAPPING
block|,
endif|#
directive|endif
literal|"Key was rejected by service"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|int
name|bsm_errors_count
init|=
sizeof|sizeof
argument_list|(
name|bsm_errors
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|bsm_errors
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
specifier|const
name|struct
name|bsm_errors
modifier|*
name|au_bsm_error_lookup_errno
parameter_list|(
name|int
name|error
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
name|error
operator|==
name|ERRNO_NO_LOCAL_MAPPING
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|bsm_errors_count
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|bsm_errors
index|[
name|i
index|]
operator|.
name|be_os_error
operator|==
name|error
condition|)
return|return
operator|(
operator|&
name|bsm_errors
index|[
name|i
index|]
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|struct
name|bsm_errors
modifier|*
name|au_bsm_error_lookup_bsm
parameter_list|(
name|u_char
name|bsm_error
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|bsm_errors_count
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|bsm_errors
index|[
name|i
index|]
operator|.
name|be_bsm_error
operator|==
name|bsm_error
condition|)
return|return
operator|(
operator|&
name|bsm_errors
index|[
name|i
index|]
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Converstion from a BSM error to a local error number may fail if either  * OpenBSM doesn't recognize the error on the wire, or because there is no  * appropriate local mapping.  However, we don't allow conversion to BSM to  * fail, we just convert to BSM_UKNOWNERR.  */
end_comment

begin_function
name|int
name|au_bsm_to_errno
parameter_list|(
name|u_char
name|bsm_error
parameter_list|,
name|int
modifier|*
name|errorp
parameter_list|)
block|{
specifier|const
name|struct
name|bsm_errors
modifier|*
name|bsme
decl_stmt|;
name|bsme
operator|=
name|au_bsm_error_lookup_bsm
argument_list|(
name|bsm_error
argument_list|)
expr_stmt|;
if|if
condition|(
name|bsme
operator|==
name|NULL
operator|||
name|bsme
operator|->
name|be_os_error
operator|==
name|ERRNO_NO_LOCAL_MAPPING
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
operator|*
name|errorp
operator|=
name|bsme
operator|->
name|be_os_error
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|u_char
name|au_errno_to_bsm
parameter_list|(
name|int
name|error
parameter_list|)
block|{
specifier|const
name|struct
name|bsm_errors
modifier|*
name|bsme
decl_stmt|;
comment|/* 	 * We should never be passed this libbsm-internal constant, and 	 * because it is ambiguous we just return an error. 	 */
if|if
condition|(
name|error
operator|==
name|ERRNO_NO_LOCAL_MAPPING
condition|)
return|return
operator|(
name|BSM_UNKNOWNERR
operator|)
return|;
name|bsme
operator|=
name|au_bsm_error_lookup_errno
argument_list|(
name|error
argument_list|)
expr_stmt|;
if|if
condition|(
name|bsme
operator|==
name|NULL
condition|)
return|return
operator|(
name|BSM_UNKNOWNERR
operator|)
return|;
return|return
operator|(
name|bsme
operator|->
name|be_bsm_error
operator|)
return|;
block|}
end_function

begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|KERNEL
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|_KERNEL
argument_list|)
end_if

begin_function
specifier|const
name|char
modifier|*
name|au_strerror
parameter_list|(
name|u_char
name|bsm_error
parameter_list|)
block|{
specifier|const
name|struct
name|bsm_errors
modifier|*
name|bsme
decl_stmt|;
name|bsme
operator|=
name|au_bsm_error_lookup_bsm
argument_list|(
name|bsm_error
argument_list|)
expr_stmt|;
if|if
condition|(
name|bsme
operator|==
name|NULL
condition|)
return|return
operator|(
literal|"Unrecognized BSM error"
operator|)
return|;
if|if
condition|(
name|bsme
operator|->
name|be_os_error
operator|!=
name|ERRNO_NO_LOCAL_MAPPING
condition|)
return|return
operator|(
name|strerror
argument_list|(
name|bsme
operator|->
name|be_os_error
argument_list|)
operator|)
return|;
return|return
operator|(
name|bsme
operator|->
name|be_strerror
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

