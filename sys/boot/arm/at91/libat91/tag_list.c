begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************************************************  *  * Filename: tag_list.c  *  * Instantiation of basic routines that create linux-boot tag list.  *  * Revision information:  *  * 22AUG2004	kb_admin	initial creation  *  * BEGIN_KBDD_BLOCK  * No warranty, expressed or implied, is included with this software.  It is  * provided "AS IS" and no warranty of any kind including statutory or aspects  * relating to merchantability or fitness for any purpose is provided.  All  * intellectual property rights of others is maintained with the respective  * owners.  This software is not copyrighted and is intended for reference  * only.  * END_BLOCK  *  * $FreeBSD$  *****************************************************************************/
end_comment

begin_comment
comment|/******************************* GLOBALS *************************************/
end_comment

begin_comment
comment|/********************** PRIVATE FUNCTIONS/DATA/DEFINES ***********************/
end_comment

begin_define
define|#
directive|define
name|u32
value|unsigned
end_define

begin_define
define|#
directive|define
name|u16
value|unsigned short
end_define

begin_define
define|#
directive|define
name|u8
value|unsigned char
end_define

begin_include
include|#
directive|include
file|"/usr/src/arm/linux/include/asm/setup.h"
end_include

begin_define
define|#
directive|define
name|PAGE_SIZE
value|0x1000
end_define

begin_define
define|#
directive|define
name|MEM_SIZE
value|0x2000000
end_define

begin_define
define|#
directive|define
name|PHYS_OFFSET
value|0x20000000
end_define

begin_comment
comment|/*************************** GLOBAL FUNCTIONS ********************************/
end_comment

begin_comment
comment|/*  * .KB_C_FN_DEFINITION_START  * void InitTagList(char*, void *)  *  This global function populates a linux-boot style tag list from the  * string passed in the pointer at the location specified.  * .KB_C_FN_DEFINITION_END  */
end_comment

begin_function
name|void
name|InitTagList
parameter_list|(
name|char
modifier|*
name|parms
parameter_list|,
name|void
modifier|*
name|output
parameter_list|)
block|{
name|char
modifier|*
name|src
decl_stmt|,
modifier|*
name|dst
decl_stmt|;
name|struct
name|tag
modifier|*
name|tagList
init|=
operator|(
expr|struct
name|tag
operator|*
operator|)
name|output
decl_stmt|;
name|tagList
operator|->
name|hdr
operator|.
name|size
operator|=
name|tag_size
argument_list|(
name|tag_core
argument_list|)
expr_stmt|;
name|tagList
operator|->
name|hdr
operator|.
name|tag
operator|=
name|ATAG_CORE
expr_stmt|;
name|tagList
operator|->
name|u
operator|.
name|core
operator|.
name|flags
operator|=
literal|1
expr_stmt|;
name|tagList
operator|->
name|u
operator|.
name|core
operator|.
name|pagesize
operator|=
name|PAGE_SIZE
expr_stmt|;
name|tagList
operator|->
name|u
operator|.
name|core
operator|.
name|rootdev
operator|=
literal|0xff
expr_stmt|;
name|tagList
operator|=
name|tag_next
argument_list|(
name|tagList
argument_list|)
expr_stmt|;
name|tagList
operator|->
name|hdr
operator|.
name|size
operator|=
name|tag_size
argument_list|(
name|tag_mem32
argument_list|)
expr_stmt|;
name|tagList
operator|->
name|hdr
operator|.
name|tag
operator|=
name|ATAG_MEM
expr_stmt|;
name|tagList
operator|->
name|u
operator|.
name|mem
operator|.
name|size
operator|=
name|MEM_SIZE
expr_stmt|;
name|tagList
operator|->
name|u
operator|.
name|mem
operator|.
name|start
operator|=
name|PHYS_OFFSET
expr_stmt|;
name|tagList
operator|=
name|tag_next
argument_list|(
name|tagList
argument_list|)
expr_stmt|;
name|tagList
operator|->
name|hdr
operator|.
name|size
operator|=
name|tag_size
argument_list|(
name|tag_cmdline
argument_list|)
expr_stmt|;
name|tagList
operator|->
name|hdr
operator|.
name|tag
operator|=
name|ATAG_CMDLINE
expr_stmt|;
name|src
operator|=
name|parms
expr_stmt|;
name|dst
operator|=
name|tagList
operator|->
name|u
operator|.
name|cmdline
operator|.
name|cmdline
expr_stmt|;
while|while
condition|(
operator|*
name|src
condition|)
block|{
operator|*
name|dst
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
block|}
operator|*
name|dst
operator|=
literal|0
expr_stmt|;
name|tagList
operator|->
name|hdr
operator|.
name|size
operator|+=
operator|(
call|(
name|unsigned
call|)
argument_list|(
name|src
operator|-
name|parms
argument_list|)
operator|+
literal|1
operator|)
operator|/
sizeof|sizeof
argument_list|(
name|unsigned
argument_list|)
expr_stmt|;
name|tagList
operator|=
name|tag_next
argument_list|(
name|tagList
argument_list|)
expr_stmt|;
name|tagList
operator|->
name|hdr
operator|.
name|size
operator|=
literal|0
expr_stmt|;
name|tagList
operator|->
name|hdr
operator|.
name|tag
operator|=
name|ATAG_NONE
expr_stmt|;
block|}
end_function

end_unit

